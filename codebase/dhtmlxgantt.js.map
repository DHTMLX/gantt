{"version":3,"file":"dhtmlxgantt.js","sources":["../sources/core/ui/utils/dom_helpers.js","../sources/utils/global.js","../sources/ext/click_drag/eventsManager.ts","../sources/utils/eventable.js","../sources/utils/helpers.js","../sources/ext/click_drag/selectedRegion.ts","../sources/ext/drag_timeline/eventsManager.ts","../sources/utils/utils.js","../sources/core/ui/timeline/scales.js","../sources/ext/keyboard_navigation/modals.js","../sources/ext/quick_info/quickInfo.ts","../sources/core/ui/utils/dom_event_scope.js","../sources/ext/tooltip/tooltip.ts","../sources/ext/tooltip/tooltipManager.ts","../sources/ext/undo/monitor.ts","../sources/ext/undo/undo.ts","../sources/ext/extensions_gpl.ts","../sources/ext/click_drag/index.ts","../sources/ext/drag_timeline/index.ts","../sources/ext/fullscreen/index.ts","../sources/ext/keyboard_navigation.js","../sources/ext/keyboard_navigation/common/keyboard_shortcuts.js","../sources/ext/keyboard_navigation/common/eventhandler.js","../sources/ext/keyboard_navigation/common/trap_modal_focus.js","../sources/ext/keyboard_navigation/elements/gantt_node.js","../sources/ext/keyboard_navigation/elements/nav_node.js","../sources/ext/keyboard_navigation/elements/header_cell.js","../sources/ext/keyboard_navigation/elements/task_row.js","../sources/ext/keyboard_navigation/elements/task_cell.js","../sources/ext/keyboard_navigation/core.js","../sources/ext/quick_info/index.ts","../sources/ext/tooltip/index.ts","../sources/ext/undo/index.ts","../sources/ext/marker.js","../sources/ext/multiselect.js","../sources/ext/export_api/index.ts","../sources/core/ui/timeline/scales_ignore.js","../sources/constants/index.js","../sources/ext/extension_manager.ts","../sources/utils/env.js","../sources/core/common/serialize.ts","../sources/core/common/ajax.js","../sources/core/common/date_parsers/fast_version.ts","../sources/core/common/date_parsers/csp_compliant_version.ts","../sources/core/common/date.js","../node_modules/remote-client/dist/remote.es6.js","../sources/core/remote/remote_events.js","../sources/utils/timeout.js","../sources/core/common/state.js","../sources/utils/promise.js","../sources/core/facades/datastore_tasks.js","../sources/core/datastore/power_array.js","../sources/utils/placeholder_task.js","../sources/core/datastore/datastore.js","../sources/core/common/split_task_helpers.ts","../sources/core/datastore/treedatastore.js","../sources/utils/is_headless.js","../sources/core/datastore/datastore_render.js","../sources/core/facades/datastore.js","../sources/core/datastore/select.js","../sources/core/facades/datastore_links.js","../sources/core/gantt_data_range.js","../sources/utils/task_tree_helpers.js","../sources/core/dataprocessor/data_processor_events.ts","../sources/core/dataprocessor/simple_storage.ts","../sources/core/dataprocessor/data_processor.ts","../sources/core/dataprocessor/extend_gantt.ts","../sources/core/dataprocessor/index.js","../sources/core/plugins/batch_update.js","../sources/core/plugins/wbs.js","../sources/core/plugins/resources.js","../sources/core/plugins/resource_assignments.js","../sources/core/plugins/new_task_placeholder.js","../sources/core/plugins/auto_task_types.js","../sources/core/common/duration_formatter_numeric.ts","../sources/core/common/link_formatter_simple.ts","../sources/core/plugins/formatters.js","../sources/core/plugins/empty_state_screen.ts","../sources/core/ui/render/baseline_helper.js","../sources/core/plugins/baselines.js","../sources/core/plugins/remote_events/remote_events.ts","../sources/core/plugins/remote_events/handlers.js","../sources/core/plugins/remote_events/index.js","../sources/core/loading/parsing.js","../sources/core/worktime/calendar_arguments_helper.js","../sources/core/worktime/strategy/work_calendar_merger.js","../sources/core/worktime/strategy/work_unit_cache/workunit_map_cache.ts","../sources/core/worktime/strategy/work_unit_cache/workunit_object_cache.ts","../sources/core/worktime/strategy/work_unit_cache/larger_units_helper.ts","../sources/core/worktime/strategy/work_unit_cache/date_duration_cache.ts","../sources/core/worktime/strategy/calendar_strategy.js","../sources/core/worktime/strategy/work_unit_cache/index.ts","../sources/core/worktime/legacy_resource_config.js","../sources/core/worktime/calendar_manager.js","../sources/core/worktime/dynamic_resource_calendars.js","../sources/core/worktime/strategy/no_work_time.js","../sources/core/worktime/time_calculator.js","../sources/core/facades/worktime_calendars.js","../sources/core/data.js","../sources/core/ui/resize_listener.js","../sources/core/gantt_core.js","../sources/core/common/assert.js","../sources/locale/locale_ar.ts","../sources/locale/locale_be.ts","../sources/locale/locale_ca.ts","../sources/locale/locale_cn.ts","../sources/locale/locale_cs.ts","../sources/locale/locale_da.ts","../sources/locale/locale_de.ts","../sources/locale/locale_el.ts","../sources/locale/locale_en.ts","../sources/locale/locale_es.ts","../sources/locale/locale_fa.ts","../sources/locale/locale_fi.ts","../sources/locale/locale_fr.ts","../sources/locale/locale_he.ts","../sources/locale/locale_hr.ts","../sources/locale/locale_hu.ts","../sources/locale/locale_id.ts","../sources/locale/locale_it.ts","../sources/locale/locale_jp.ts","../sources/locale/locale_kr.ts","../sources/locale/locale_manager.ts","../sources/locale/locale_nb.ts","../sources/locale/locale_nl.ts","../sources/locale/locale_no.ts","../sources/locale/locale_pl.ts","../sources/locale/locale_pt.ts","../sources/locale/locale_ro.ts","../sources/locale/locale_ru.ts","../sources/locale/locale_si.ts","../sources/locale/locale_sk.ts","../sources/locale/locale_sv.ts","../sources/locale/locale_tr.ts","../sources/locale/locale_ua.ts","../sources/factory/make_instance_common.js","../sources/core/common/services.js","../sources/core/common/config.ts","../sources/core/common/dnd.js","../sources/core/common/templates.js","../sources/core/datastore/datastore_hooks.js","../sources/core/plugins/index.js","../sources/core/plugins/auto_scheduling_config.js","../sources/core/grid_column_api.gpl.js","../sources/core/tasks.js","../sources/core/worktime/work_time.js","../sources/core/data_task_types.gpl.js","../sources/core/cached_functions.js","../sources/core/destructor.js","../sources/locale/index.ts","../sources/core/ui/message.js","../sources/core/ui/configurable.js","../sources/core/ui/ui_factory.js","../sources/core/ui/mouse.js","../sources/core/ui/render/viewport/is_in_viewport.js","../sources/core/ui/render/is_legacy_smart_render.js","../sources/core/ui/render/viewport/get_grid_row_rectangle.js","../sources/core/ui/render/viewport/get_visible_bars_range.js","../sources/core/ui/render/render_factory.js","../sources/core/ui/render/layer_engine.js","../sources/core/ui/render/viewport/get_bar_rectangle.js","../sources/core/ui/render/viewport/factory/get_visible_link_range.js","../sources/core/ui/render/viewport/get_link_rectangle.js","../sources/core/ui/render/viewport/is_link_in_viewport.js","../sources/core/ui/gantt_layers.js","../sources/core/ui/layout/cell.js","../sources/utils/extends.js","../sources/core/ui/layout/layout.js","../sources/core/ui/layout/view_layout.js","../sources/core/ui/layout/view_cell.js","../sources/core/ui/layout/scrollbar_cell.js","../sources/core/ui/row_position_mixin.js","../sources/core/ui/row_position_fixed_height.js","../sources/core/ui/timeline/tasks_canvas_render.gpl.js","../sources/core/ui/timeline/timeline.js","../sources/core/ui/timeline/timeline_layers_gpl.js","../sources/core/ui/plugins/column_grid_dnd/scrollable_grid.ts","../sources/core/ui/plugins/column_grid_dnd/column_grid_dnd.ts","../sources/core/ui/mouse_event_container.js","../sources/core/ui/grid/grid.js","../sources/core/ui/resource_store_mixin.js","../sources/core/ui/grid/grid_resize.gpl.js","../sources/core/ui/grid/task_grid_row_resize.js","../sources/core/ui/grid/resource_grid_lightbox.js","../sources/core/ui/grid/editors/keyboard_mappings/default.js","../sources/core/ui/grid/editors/keyboard_mappings/keyboard_navigation.js","../sources/core/ui/grid/editors/editors/base.js","../sources/core/ui/grid/editors/editors/text.js","../sources/core/ui/grid/editors/editors/number.js","../sources/core/ui/grid/editors/editors/select.js","../sources/core/ui/grid/editors/editors/date.js","../sources/core/ui/grid/editors/editors/predecessor.js","../sources/core/ui/grid/editors/editors/duration.js","../sources/core/ui/grid/editors/linked_properties.js","../sources/core/ui/grid/editors/controller.js","../sources/core/ui/grid/editors/keyboard_mappings.js","../sources/core/ui/render/viewport/is_bar_in_viewport.js","../sources/core/ui/render/task_bar_render.js","../sources/core/ui/render/task_bar_smart_render.js","../sources/core/ui/render/dummy_layer.js","../sources/core/ui/render/viewport/get_bg_row_rectangle.js","../sources/core/ui/render/viewport/get_visible_cells_range.js","../sources/core/ui/render/viewport/is_column_visible.js","../sources/core/ui/render/prerender/task_bg_placeholder.js","../sources/core/ui/render/link_render.js","../sources/core/ui/render/viewport/is_grid_row_in_viewport.js","../sources/core/resource_timetable_builder.js","../sources/core/ui/grid/tasks_grid_dnd.js","../sources/core/ui/grid/tasks_grid_dnd_marker_helpers/drop_target.js","../sources/core/ui/grid/tasks_grid_dnd_marker_helpers/locked_level.js","../sources/core/ui/grid/tasks_grid_dnd_marker_helpers/highlight.js","../sources/core/ui/grid/tasks_grid_dnd_marker.js","../sources/core/ui/grid/tasks_grid_dnd_marker_helpers/multi_level.js","../sources/core/ui/grid/main_grid_initializer.js","../sources/core/ui/timeline/tasks_dnd.js","../sources/core/ui/timeline/links_dnd.js","../sources/core/ui/timeline/main_timeline_initializer.js","../sources/core/ui/main_layout_initializer.js","../sources/core/ui/index.js","../sources/core/ui/layout/resizer_cell.gpl.js","../sources/core/ui/render/task_grid_line_render.js","../sources/core/ui/render/task_bg_render.js","../sources/core/ui/render/task_rollup_render.js","../sources/core/ui/render/resource_matrix_render.js","../sources/core/ui/render/task_grid_row_resize_render.js","../sources/core/ui/skin.js","../sources/core/ui/plugins/autoscroll.js","../sources/core/ui/plugins/jquery_hooks.js","../sources/core/ui/plugins/dhtmlx_hooks.js","../sources/core/ui/plugins/timeline_zoom.ts","../sources/core/ui/touch.js","../sources/core/ui/lightbox/controls/base_control.js","../sources/core/ui/utils/html_helpers.js","../sources/core/ui/lightbox/controls/select_control.js","../sources/core/ui/lightbox/controls/parent_control.js","../sources/core/ui/lightbox/controls/resource_selector_control.js","../sources/core/ui/lightbox/index.js","../sources/core/ui/lightbox/controls/template_control.js","../sources/core/ui/lightbox/controls/textarea_control.js","../sources/core/ui/lightbox/controls/time_control.js","../sources/core/ui/lightbox/controls/checkbox_control.js","../sources/core/ui/lightbox/controls/radio_control.js","../sources/core/ui/lightbox/controls/duration_control.js","../sources/core/ui/lightbox/controls/constraint_control.js","../sources/core/ui/lightbox/controls/typeselect_control.js","../sources/core/ui/lightbox/controls/baseline_control.js","../sources/core/ui_core.js","../sources/core/data_task_layers.gpl.js","../sources/core/facades/layout.js","../sources/css/skins/skyblue.js","../sources/css/skins/dark.js","../sources/css/skins/meadow.js","../sources/css/skins/terrace.js","../sources/css/skins/broadway.js","../sources/css/skins/material.js","../sources/css/skins/contrast_black.js","../sources/css/skins/contrast_white.js","../sources/core/ui/plugins/index.js","../sources/core/ui/lightbox/lightbox_optional_time.js","../sources/core/ui/wai_aria.js","../sources/dhtmlxgantt.gpl.ts","../sources/factory/make_instance_web.js","../sources/core/loading/ajax_loading.js"],"sourcesContent":["//returns position of html element on the page\r\nfunction getNodePosition(elem) {\r\n\tvar top=0, left=0, right=0, bottom=0;\r\n\tif (elem.getBoundingClientRect) { //HTML5 method\r\n\t\tvar box = elem.getBoundingClientRect();\r\n\t\tvar body = document.body;\r\n\t\tvar docElem = (document.documentElement ||\r\n\t\t\tdocument.body.parentNode ||\r\n\t\t\tdocument.body);\r\n\r\n\t\tvar scrollTop = window.pageYOffset || docElem.scrollTop || body.scrollTop;\r\n\t\tvar scrollLeft = window.pageXOffset || docElem.scrollLeft || body.scrollLeft;\r\n\t\tvar clientTop = docElem.clientTop || body.clientTop || 0;\r\n\t\tvar clientLeft = docElem.clientLeft || body.clientLeft || 0;\r\n\t\ttop  = box.top +  scrollTop - clientTop;\r\n\t\tleft = box.left + scrollLeft - clientLeft;\r\n\r\n\t\tright = document.body.offsetWidth - box.right;\r\n\t\tbottom = document.body.offsetHeight - box.bottom;\r\n\t} else { //fallback to naive approach\r\n\t\twhile(elem) {\r\n\t\t\ttop = top + parseInt(elem.offsetTop,10);\r\n\t\t\tleft = left + parseInt(elem.offsetLeft,10);\r\n\t\t\telem = elem.offsetParent;\r\n\t\t}\r\n\r\n\t\tright = document.body.offsetWidth - elem.offsetWidth - left;\r\n\t\tbottom = document.body.offsetHeight - elem.offsetHeight - top;\r\n\t}\r\n\treturn { y: Math.round(top), x: Math.round(left), width:elem.offsetWidth, height:elem.offsetHeight, right: Math.round(right), bottom: Math.round(bottom) };\r\n}\r\n\r\nfunction isVisible(node){\r\n\tvar display = false,\r\n\t\tvisibility = false;\r\n\tif(window.getComputedStyle){\r\n\t\tvar style = window.getComputedStyle(node, null);\r\n\t\tdisplay = style[\"display\"];\r\n\t\tvisibility = style[\"visibility\"];\r\n\t}else if(node.currentStyle){\r\n\t\tdisplay = node.currentStyle[\"display\"];\r\n\t\tvisibility = node.currentStyle[\"visibility\"];\r\n\t}\r\n\treturn (display != \"none\" && visibility != \"hidden\");\r\n}\r\n\r\nfunction hasNonNegativeTabIndex(node){\r\n\treturn !isNaN(node.getAttribute(\"tabindex\")) && (node.getAttribute(\"tabindex\")*1 >= 0);\r\n}\r\n\r\nfunction hasHref(node){\r\n\tvar canHaveHref = {\"a\": true, \"area\": true};\r\n\tif(canHaveHref[node.nodeName.loLowerCase()]){\r\n\t\treturn !!node.getAttribute(\"href\");\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nfunction isEnabled(node){\r\n\tvar canDisable = {\"input\":true, \"select\":true, \"textarea\":true, \"button\":true, \"object\":true};\r\n\tif(canDisable[node.nodeName.toLowerCase()]){\r\n\t\treturn !node.hasAttribute(\"disabled\");\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n\r\nfunction getFocusableNodes(root){\r\n\tvar nodes = root.querySelectorAll([\r\n\t\t\"a[href]\",\r\n\t\t\"area[href]\",\r\n\t\t\"input\",\r\n\t\t\"select\",\r\n\t\t\"textarea\",\r\n\t\t\"button\",\r\n\t\t\"iframe\",\r\n\t\t\"object\",\r\n\t\t\"embed\",\r\n\t\t\"[tabindex]\",\r\n\t\t\"[contenteditable]\"\r\n\t].join(\", \"));\r\n\r\n\tvar nodesArray = Array.prototype.slice.call(nodes, 0);\r\n\t\r\n\tfor(var i = 0; i < nodesArray.length; i++){\r\n\t\tnodesArray[i].$position = i;\r\n\t\t// we remember original nodes order, \r\n\t\t// so when we sort them by tabindex we ensure order of nodes with same tabindex is preserved, \r\n\t\t// since some browsers do unstable sort\r\n\t}\r\n\t\r\n\t// use tabindex to sort focusable nodes\r\n\tnodesArray.sort(function(a, b) {\r\n\t\tif(a.tabIndex === 0 && b.tabIndex !== 0){\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\tif(a.tabIndex !== 0 && b.tabIndex === 0){\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\t\r\n\t\tif (a.tabIndex === b.tabIndex){\r\n\t\t\t// ensure we do stable sort\r\n\t\t\treturn a.$position - b.$position;\r\n\t\t}\r\n\t\tif (a.tabIndex < b.tabIndex) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\treturn 1;\r\n\t});\r\n\t\r\n\tfor(var i = 0; i < nodesArray.length; i++){\r\n\t\tvar node = nodesArray[i];\r\n\t\tvar isValid = (hasNonNegativeTabIndex(node)  || isEnabled(node) || hasHref(node)) && isVisible(node);\r\n\t\tif(!isValid){\r\n\t\t\tnodesArray.splice(i, 1);\r\n\t\t\ti--;\r\n\t\t}\r\n\t}\r\n\treturn nodesArray;\r\n}\r\n\r\nfunction getScrollSize(){\r\n\tvar div = document.createElement(\"div\");\r\n\tdiv.style.cssText=\"visibility:hidden;position:absolute;left:-1000px;width:100px;padding:0px;margin:0px;height:110px;min-height:100px;overflow-y:scroll;\";\r\n\r\n\tdocument.body.appendChild(div);\r\n\tvar width = div.offsetWidth-div.clientWidth;\r\n\tdocument.body.removeChild(div);\r\n\r\n\treturn Math.max(width, 15);\r\n}\r\n\r\nfunction getClassName(node){\r\n\tif(!node) return \"\";\r\n\r\n\tvar className = node.className || \"\";\r\n\tif(className.baseVal)//'className' exist but not a string - IE svg element in DOM\r\n\t\tclassName = className.baseVal;\r\n\r\n\tif(!className.indexOf)\r\n\t\tclassName = \"\";\r\n\r\n\treturn _trimString(className);\r\n}\r\n\r\nfunction addClassName(node, className){\r\n\tif (className && node.className.indexOf(className) === -1) {\r\n\t\tnode.className += \" \" + className;\r\n\t}\r\n}\r\n\r\nfunction removeClassName(node, name) {\r\n\tname = name.split(\" \");\r\n\tfor (var i = 0; i < name.length; i++) {\r\n\t\tvar regEx = new RegExp(\"\\\\s?\\\\b\" + name[i] + \"\\\\b(?![-_.])\", \"\");\r\n\t\tnode.className = node.className.replace(regEx, \"\");\r\n\t}\r\n}\r\n\r\nfunction hasClass(element, className){\r\n\tif ('classList' in element) {\r\n\t\treturn element.classList.contains(className);\r\n\t} else { \r\n\t\treturn new RegExp(\"\\\\b\" + className + \"\\\\b\").test(element.className);\r\n\t}\r\n}\r\n\r\nfunction toNode(node) {\r\n\tif (typeof node === \"string\") {\r\n\t\treturn (document.getElementById(node) || document.querySelector(node) || document.body);\r\n\t}\r\n\treturn node || document.body;\r\n}\r\n\r\nvar _slave;\r\nfunction insertNode(node, newone) {\r\n\tif(!_slave){\r\n\t\t_slave = document.createElement(\"div\");\r\n\t}\r\n\t_slave.innerHTML = newone;\r\n\tvar child = _slave.firstChild;\r\n\tnode.appendChild(child);\r\n\treturn child;\r\n}\r\n\r\nfunction removeNode(node) {\r\n\tif (node && node.parentNode) {\r\n\t\tnode.parentNode.removeChild(node);\r\n\t}\r\n}\r\n\r\nfunction getChildNodes(node, css) {\r\n\tvar ch = node.childNodes;\r\n\tvar len = ch.length;\r\n\tvar out = [];\r\n\tfor (var i = 0; i < len; i++) {\r\n\t\tvar obj = ch[i];\r\n\t\tif (obj.className && obj.className.indexOf(css) !== -1) {\r\n\t\t\tout.push(obj);\r\n\t\t}\r\n\t}\r\n\treturn out;\r\n}\r\n\r\nfunction getTargetNode(e) {\r\n\tvar trg;\r\n\tif (e.tagName)\r\n\t\ttrg = e;\r\n\telse {\r\n\t\te = e || window.event;\r\n\t\ttrg = e.target || e.srcElement;\r\n\t\tif (trg.shadowRoot && e.composedPath) {\r\n\t\t\ttrg = e.composedPath()[0];\r\n\t\t}\r\n\t}\r\n\treturn trg;\r\n}\r\n\r\nfunction locateAttribute(e, attribute) {\r\n\tif(!attribute) return;\r\n\r\n\tvar trg = getTargetNode(e);\r\n\r\n\twhile (trg){\r\n\t\tif (trg.getAttribute){\t//text nodes has not getAttribute\r\n\t\t\tvar test = trg.getAttribute(attribute);\r\n\t\t\tif (test) return trg;\r\n\t\t}\r\n\t\t// GS-2941. With the `host`, Gantt will continue iteration outside the ShadowDOM\r\n\t\ttrg = trg.parentNode || trg.host;\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction _trimString(str){\r\n\tvar func = String.prototype.trim || function(){ return this.replace(/^\\s+|\\s+$/g, \"\"); };\r\n\treturn func.apply(str);\r\n}\r\n\r\nfunction locateClassName(e, classname, strict){\r\n\tvar trg = getTargetNode(e);\r\n\tvar css = \"\";\r\n\r\n\tif(strict === undefined)\r\n\t\tstrict = true;\r\n\r\n\twhile (trg){\r\n\t\tcss = getClassName(trg);\r\n\t\tif(css){\r\n\t\t\tvar ind = css.indexOf(classname);\r\n\t\t\tif (ind >= 0){\r\n\t\t\t\tif (!strict)\r\n\t\t\t\t\treturn trg;\r\n\r\n\t\t\t\t//check that we have exact match\r\n\t\t\t\tvar left = (ind === 0) || (!_trimString(css.charAt(ind - 1)));\r\n\t\t\t\tvar right = ((ind + classname.length >= css.length)) || (!_trimString(css.charAt(ind + classname.length)));\r\n\r\n\t\t\t\tif (left && right)\r\n\t\t\t\t\treturn trg;\r\n\t\t\t}\r\n\t\t}\r\n\t\ttrg=trg.parentNode;\r\n\t}\r\n\treturn null;\r\n}\r\n\r\n/*\r\nevent position relatively to DOM element\r\n */\r\nfunction getRelativeEventPosition(ev, node){\r\n\tconst d = document.documentElement;\r\n\tconst box = getNodePosition(node);\r\n\t//GS-2809: condition to check event(mouse or touch)\r\n\tconst { clientX, clientY } = ev.touches?.[0] ?? ev;\r\n\treturn {\r\n\t\tx: clientX + d.scrollLeft - d.clientLeft - box.x + node.scrollLeft,\r\n\t\ty: clientY + d.scrollTop - d.clientTop - box.y + node.scrollTop\r\n\t};\r\n}\r\n\r\nfunction getRelativeNodePosition(child, parent){\r\n\tconst childPos = getNodePosition(child);\r\n\tconst parentPos = getNodePosition(parent);\r\n\treturn {\r\n\t\tx: childPos.x - parentPos.x,\r\n\t\ty: childPos.y - parentPos.y\r\n\t};\r\n}\r\n\r\nfunction isChildOf(child, parent){\r\n\tif(!child || !parent){\r\n\t\treturn false;\r\n\t}\r\n\r\n\twhile(child && child != parent) {\r\n\t\tchild = child.parentNode;\r\n\t}\r\n\r\n\treturn child === parent;\r\n}\r\n\r\nfunction closest(element, selector){\r\n\tif(element.closest){\r\n\t\treturn element.closest(selector);\r\n\t}else if(element.matches || element.msMatchesSelector || element.webkitMatchesSelector){\r\n\t\tvar el = element;\r\n\t\tif (!document.documentElement.contains(el)) return null;\r\n\t\tdo {\r\n\t\t\tvar method = el.matches || el.msMatchesSelector || el.webkitMatchesSelector;\r\n\r\n\t\t\tif (method.call(el, selector)) return el;\r\n\t\t\tel = el.parentElement || el.parentNode;\r\n\t\t} while (el !== null && el.nodeType === 1); \r\n\t\treturn null;\r\n\t}else{\r\n\t\t// eslint-disable-next-line no-console\r\n\t\tconsole.error(\"Your browser is not supported\");\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nfunction getClosestSizedElement(element) {\r\n\twhile (element) {\r\n\t\tif (element.offsetWidth > 0 && element.offsetHeight > 0) {\r\n\t\t\treturn element;\r\n\t\t}\r\n\t\telement = element.parentElement;\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction isShadowDomSupported() {\r\n\treturn document.head.createShadowRoot || document.head.attachShadow;\r\n}\r\n\r\n/**\r\n * Returns element that has the browser focus, or null if no element has focus.\r\n * Works with shadow DOM, so it's prefereed to use this function instead of document.activeElement directly.\r\n * @returns HTMLElement\r\n */\r\nfunction getActiveElement(){\r\n\tvar activeElement = document.activeElement;\r\n\tif (activeElement.shadowRoot) {\r\n\t\tactiveElement = activeElement.shadowRoot.activeElement;\r\n\t}\r\n\tif (activeElement === document.body && document.getSelection) {\r\n\t\tactiveElement = document.getSelection().focusNode || document.body;\r\n\t}\r\n\r\n\treturn activeElement;\r\n}\r\n\r\n/**\r\n * Returns document.body or the host node of the ShadowRoot, if the element is attached to ShadowDom\r\n * @param {HTMLElement} element \r\n * @returns HTMLElement\r\n */\r\nfunction getRootNode(element) {\r\n\tif (!element) {\r\n\t\treturn document.body;\r\n\t}\r\n\tif (!isShadowDomSupported()) {\r\n\t\treturn document.body;\r\n\t}\r\n\twhile (element.parentNode && (element = element.parentNode)) {\r\n\t\tif (element instanceof ShadowRoot) {\r\n\t\t\treturn element.host;\r\n\t\t}\r\n\t}\r\n\treturn document.body;\r\n}\r\n\r\nfunction hasShadowParent(element) {\r\n\treturn !!getRootNode(element);\r\n}\r\n\r\nexport {\r\n\tgetNodePosition,\r\n\tgetFocusableNodes,\r\n\tgetScrollSize,\r\n\tgetClassName,\r\n\taddClassName,\r\n\tremoveClassName,\r\n\tinsertNode,\r\n\tremoveNode,\r\n\tgetChildNodes,\r\n\ttoNode,\r\n\tlocateClassName,\r\n\tlocateAttribute,\r\n\tgetTargetNode,\r\n\tgetRelativeEventPosition,\r\n\tisChildOf,\r\n\thasClass,\r\n\tclosest,\r\n\tgetRootNode,\r\n\thasShadowParent,\r\n\tisShadowDomSupported,\r\n\tgetActiveElement,\r\n\tgetRelativeNodePosition,\r\n\tgetClosestSizedElement\r\n};","\r\n/* eslint-disable no-restricted-globals */\r\nvar globalScope;\r\nif(typeof window !== \"undefined\"){\r\n\tglobalScope = window;\r\n}else{\r\n\tglobalScope = global;\r\n}\r\n/* eslint-enable no-restricted-globals */\r\n\r\nexport default globalScope;","import * as domHelpers from \"../../core/ui/utils/dom_helpers\";\r\nimport global from \"../../utils/global\";\r\nimport { SelectedRegion } from \"./selectedRegion\";\r\n\r\nexport class EventsManager {\r\n\tprivate _mouseDown: boolean = false;\r\n\tprivate _touchStarts: boolean = false;\r\n\tprivate _touchActive: boolean = false;\r\n\tprivate _longTapTimer: any = false;\r\n\tprivate _domEvents: any;\r\n\tprivate _originPosition: string;\r\n\tprivate _gantt: any;\r\n\tprivate _restoreOriginPosition: () => void;\r\n\tconstructor(gantt: any) {\r\n\t\tthis._gantt = gantt;\r\n\t\tthis._domEvents = gantt._createDomEventScope();\r\n\t}\r\n\r\n\tattach(selectedRegion: SelectedRegion, useKey?: \"shiftKey\" | \"ctrlKey\" | \"altKey\", ignore?: any): void {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst _target = selectedRegion.getViewPort();\r\n\t\tthis._originPosition = global.getComputedStyle(_target).display;\r\n\t\tthis._restoreOriginPosition = () => {\r\n\t\t\t_target.style.position = this._originPosition;\r\n\t\t};\r\n\t\tif (this._originPosition === \"static\") {\r\n\t\t\t_target.style.position = \"relative\";\r\n\t\t}\r\n\t\tconst state = gantt.$services.getService(\"state\");\r\n\t\tstate.registerProvider(\"clickDrag\", () => {\r\n\t\t\tconst result = { autoscroll: false };\r\n\t\t\treturn result;\r\n\t\t});\r\n\r\n\r\n\t\tlet scheduledDndCoordinates:any = null;\r\n\t\tconst startDragAndDrop = () => {\r\n\t\t\tif (!scheduledDndCoordinates) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis._mouseDown = true;\r\n\t\t\tselectedRegion.setStart(gantt.copy(scheduledDndCoordinates));\r\n\t\t\tselectedRegion.setPosition(gantt.copy(scheduledDndCoordinates));\r\n\t\t\tselectedRegion.setEnd(gantt.copy(scheduledDndCoordinates));\r\n\t\t\tscheduledDndCoordinates = null;\r\n\t\t};\r\n\r\n\t\t// mouse events\r\n\t\tthis._domEvents.attach(_target, \"mousedown\", (event) => {\r\n\t\t\tstartDrag(event);\r\n\t\t});\r\n\t\tconst eventElement = domHelpers.getRootNode(gantt.$root) || document.body;\r\n\t\tthis._domEvents.attach(eventElement, \"mouseup\", (event) => {\r\n\t\t\tstopDrag(event);\r\n\t\t});\r\n\t\tthis._domEvents.attach(_target, \"mousemove\", (event) => {\r\n\t\t\tdragMove(event);\r\n\t\t});\r\n\r\n\t\t// touch events\r\n\t\tthis._domEvents.attach(_target, \"touchstart\", (event) => {\r\n\t\t\tthis._touchStarts = true;\r\n\t\t\tthis._longTapTimer = setTimeout(()=> {\r\n\t\t\t\tif (this._touchStarts){\r\n\t\t\t\t\tstartDrag(getTouchEvent (event));\r\n\t\t\t\t\tthis._touchStarts = false;\r\n\t\t\t\t\tthis._touchActive = true;\r\n\t\t\t\t}\r\n\t\t\t}, this._gantt.config.touch_drag);\r\n\t\t});\r\n\r\n\t\tthis._domEvents.attach(eventElement, \"touchend\", (event) => {\r\n\t\t\tthis._touchStarts = false;\r\n\t\t\tthis._touchActive = false;\r\n\t\t\tclearTimeout(this._longTapTimer);\r\n\t\t\tstopDrag(getTouchEvent (event));\r\n\t\t});\r\n\t\tthis._domEvents.attach(_target, \"touchmove\", (event) => {\r\n\t\t\tif (this._touchActive){\r\n\t\t\t\tlet filterTargets = getFilterTargets();\r\n\t\t\t\tif (filterTargets && gantt.utils.dom.closest(event.target, filterTargets)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tdragMove(getTouchEvent (event));\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t} else {\r\n\t\t\t\tthis._touchStarts = false;\r\n\t\t\t\tclearTimeout(this._longTapTimer);\t\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfunction getTouchEvent (event){\r\n\t\t\tconst touchEvent = event.changedTouches && event.changedTouches[0] || event;\r\n\t\t\treturn touchEvent;\r\n\t\t}\r\n\r\n\t\tconst getFilterTargets = () => {\r\n\t\t\tlet filterTargets = \".gantt_task_line, .gantt_task_link\";\r\n\t\t\tif (ignore !== undefined) {\r\n\t\t\t\tif (ignore instanceof Array) {\r\n\t\t\t\t\tfilterTargets = ignore.join(\", \");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfilterTargets = ignore;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn filterTargets;\r\n\t\t};\r\n\r\n\t\tconst startDrag: any = (event) => {\r\n\t\t\tscheduledDndCoordinates = null;\r\n\t\t\tlet filterTargets = getFilterTargets();\r\n\t\t\tif (filterTargets) {\r\n\t\t\t\tif (gantt.utils.dom.closest(event.target, filterTargets)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tstate.registerProvider(\"clickDrag\", () => {\r\n\t\t\t\tconst result = { autoscroll: this._mouseDown };\r\n\t\t\t\treturn result;\r\n\t\t\t});\r\n\r\n\t\t\tif (useKey && event[useKey] !== true) { return; }\r\n\t\t\tscheduledDndCoordinates = this._getCoordinates(event, selectedRegion);\r\n\t\t};\r\n\r\n\t\tconst stopDrag: any = (event) => {\r\n\t\t\tscheduledDndCoordinates = null;\r\n\t\t\tif (useKey && event[useKey] !== true) { return; }\r\n\t\t\tif (this._mouseDown === true) {\r\n\t\t\t\tthis._mouseDown = false;\r\n\t\t\t\tconst coordinates = this._getCoordinates(event, selectedRegion);\r\n\t\t\t\tselectedRegion.dragEnd(coordinates);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tconst dragMove: any = (event) => {\r\n\t\t\tif (useKey && event[useKey] !== true) { return; }\r\n\t\t\t// GS-854. If we don't have useKey for the click_drag extension,\r\n\t\t\t// check the drag_timeline to not simultaneously use both extensions\r\n\t\t\tconst dragTimeline = this._gantt.ext.clickDrag;\r\n\t\t\tconst dragTimelineUseKey = (this._gantt.config.drag_timeline || {}).useKey;\r\n\t\t\tif (dragTimeline && dragTimelineUseKey) {\r\n\t\t\t\tif (!useKey && event[dragTimelineUseKey]) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet coordinates:any = null;\r\n\t\t\tif(!this._mouseDown && scheduledDndCoordinates){\r\n\t\t\t\tcoordinates = this._getCoordinates(event, selectedRegion);\r\n\t\t\t\tif(Math.abs(scheduledDndCoordinates.relative.left - coordinates.relative.left) > 5){\r\n\t\t\t\t\t// add small threshold not to start dnd on simple click\r\n\t\t\t\t\tstartDragAndDrop();\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (this._mouseDown === true) {\r\n\t\t\t\tcoordinates = this._getCoordinates(event, selectedRegion);\r\n\t\t\t\tselectedRegion.setEnd(coordinates);\r\n\t\t\t\tselectedRegion.render();\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tdetach(): void {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis._domEvents.detachAll();\r\n\t\tif(this._restoreOriginPosition){\r\n\t\t\tthis._restoreOriginPosition();\r\n\t\t}\r\n\r\n\t\tconst state = gantt.$services.getService(\"state\");\r\n\t\tstate.unregisterProvider(\"clickDrag\");\r\n\t}\r\n\r\n\tdestructor(): void {\r\n\t\tthis.detach();\r\n\t}\r\n\r\n\tprivate _getCoordinates(event: MouseEvent, selectedRegion: SelectedRegion) {\r\n\t\tconst viewPort = selectedRegion.getViewPort();\r\n\t\tconst viewPortBounds = viewPort.getBoundingClientRect();\r\n\t\tconst { clientX, clientY } = event;\r\n\t\tconst result = {\r\n\t\t\tabsolute: {\r\n\t\t\t\tleft: clientX,\r\n\t\t\t\ttop: clientY\r\n\t\t\t},\r\n\t\t\trelative: {\r\n\t\t\t\tleft: clientX - viewPortBounds.left + viewPort.scrollLeft,\r\n\t\t\t\ttop: clientY - viewPortBounds.top + viewPort.scrollTop\r\n\t\t\t}\r\n\t\t};\r\n\t\treturn result;\r\n\t}\r\n}","var EventHost = function(){\r\n\tthis._silent_mode = false;\r\n\tthis.listeners = {};\r\n};\r\n\r\nEventHost.prototype = {\r\n\t_silentStart: function() {\r\n\t\tthis._silent_mode = true;\r\n\t},\r\n\t_silentEnd: function() {\r\n\t\tthis._silent_mode = false;\r\n\t}\r\n};\r\n\r\nvar\tcreateEventStorage = function(obj) {\r\n\tvar handlers = {};\r\n\tvar index = 0;\r\n\tvar eventStorage = function(){\r\n\t\tvar combinedResult = true;\r\n\t\tfor(var i in handlers){\r\n\t\t\tvar handlerResult = handlers[i].apply(obj, arguments);\r\n\t\t\tcombinedResult=combinedResult && handlerResult;\r\n\t\t}\r\n\t\treturn combinedResult;\r\n\t};\r\n\teventStorage.addEvent=function(handler, settings){\r\n\t\tif (typeof (handler) == \"function\"){\r\n\t\t\tvar handlerId;\r\n\t\t\tif(settings && settings.id){\r\n\t\t\t\thandlerId = settings.id;\r\n\t\t\t}else{\r\n\t\t\t\thandlerId = index;\r\n\t\t\t\tindex++;\r\n\t\t\t}\r\n\r\n\t\t\tif(settings && settings.once){\r\n\t\t\t\tvar originalHandler = handler;\r\n\t\t\t\thandler = function(){\r\n\t\t\t\t\toriginalHandler();\r\n\t\t\t\t\teventStorage.removeEvent(handlerId);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\thandlers[handlerId] = handler;\r\n\t\t\treturn handlerId;\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n\teventStorage.removeEvent=function(id){\r\n\t\tdelete handlers[id];\r\n\t};\r\n\r\n\teventStorage.clear = function(){\r\n\t\thandlers = {};\r\n\t};\r\n\r\n\treturn eventStorage;\r\n};\r\n\r\nfunction makeEventable(obj){\r\n\r\n\tvar eventHost = new EventHost();\r\n\tobj.attachEvent=function(eventName, handler, settings){\r\n\t\teventName = 'ev_'+eventName.toLowerCase();\r\n\t\tif (!eventHost.listeners[eventName]){\r\n\t\t\teventHost.listeners[eventName] = createEventStorage(this);\r\n\t\t}\r\n\r\n\t\tif(settings && settings.thisObject){\r\n\t\t\thandler = handler.bind(settings.thisObject);\r\n\t\t}\r\n\r\n\t\tvar innerId = eventHost.listeners[eventName].addEvent(handler, settings);\r\n\r\n\t\tvar handlerId = (eventName+':'+innerId); //return ID (ev_eventname:1)\r\n\t\tif(settings && settings.id){\r\n\t\t\thandlerId = settings.id;\r\n\t\t}\r\n\t\treturn handlerId;\r\n\t};\r\n\r\n\tobj.attachAll = function(callback){\r\n\t\tthis.attachEvent('listen_all', callback);\r\n\t};\r\n\r\n\tobj.callEvent=function(name, eventArguments){\r\n\t\tif (eventHost._silent_mode) return true;\r\n\r\n\t\tvar handlerName = 'ev_'+name.toLowerCase();\r\n\r\n\t\tvar listeners = eventHost.listeners;\r\n\t\tif (listeners['ev_listen_all']){\r\n\t\t\tlisteners['ev_listen_all'].apply(this, [name].concat(eventArguments));\r\n\t\t}\r\n\r\n\t\tif (listeners[handlerName])\r\n\t\t\treturn listeners[handlerName].apply(this, eventArguments);\r\n\t\treturn true;\r\n\t};\r\n\r\n\tobj.checkEvent=function(name){\r\n\t\tvar listeners = eventHost.listeners;\r\n\t\treturn (!!listeners['ev_'+name.toLowerCase()]);\r\n\t};\r\n\r\n\tobj.detachEvent=function(id){\r\n\t\tif (id){\r\n\t\t\tvar listeners = eventHost.listeners;\r\n\t\t\tfor(var i in listeners){\r\n\t\t\t\tlisteners[i].removeEvent(id); //remove event\r\n\t\t\t}\r\n\r\n\t\t\tvar list = id.split(':');//get EventName and ID\r\n\t\t\tvar listeners = eventHost.listeners;\r\n\t\t\tif(list.length === 2){\r\n\t\t\t\tvar eventName = list[0];\r\n\t\t\t\tvar eventId = list[1];\r\n\t\t\t\tif(listeners[eventName]){\r\n\t\t\t\t\tlisteners[eventName].removeEvent(eventId); //remove event\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tobj.detachAllEvents = function(){\r\n\t\tfor (var name in eventHost.listeners) {\r\n\t\t\teventHost.listeners[name].clear();\r\n\t\t}\r\n\t};\r\n\r\n}\r\n\r\nexport default makeEventable;","var units = {\r\n\t\"second\": 1,\r\n\t\"minute\": 60,\r\n\t\"hour\": 60 * 60,\r\n\t\"day\": 60 * 60 * 24,\r\n\t\"week\": 60 * 60 * 24 * 7,\r\n\t\"month\": 60 * 60 * 24 * 30,\r\n\t\"quarter\": 60 * 60 * 24 * 30 * 3,\r\n\t\"year\": 60 * 60 * 24 * 365\r\n};\r\nfunction getSecondsInUnit(unit){\r\n\treturn units[unit] || units.hour;\r\n}\r\n\r\nfunction forEach(arr, callback) {\r\n\tif (arr.forEach) {\r\n\t\tarr.forEach(callback);\r\n\t} else {\r\n\t\tvar workArray = arr.slice();\r\n\t\tfor (var i = 0; i < workArray.length; i++) {\r\n\t\t\tcallback(workArray[i], i);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction arrayMap(arr, callback) {\r\n\tif (arr.map) {\r\n\t\treturn arr.map(callback);\r\n\t} else {\r\n\t\tvar workArray = arr.slice();\r\n\t\tvar resArray = [];\r\n\r\n\t\tfor (var i = 0; i < workArray.length; i++) {\r\n\t\t\tresArray.push(callback(workArray[i], i));\r\n\t\t}\r\n\t\treturn resArray;\r\n\t}\r\n}\r\n\r\n\r\nfunction arrayFind(arr, callback) {\r\n\tif (arr.find) {\r\n\t\treturn arr.find(callback);\r\n\t} else {\r\n\t\tfor (var i = 0; i < arr.length; i++) {\r\n\t\t\tif (callback(arr[i], i)) {\r\n\t\t\t\treturn arr[i];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction arrayIncludes(arr, item) {\r\n\tif(arr.includes){\r\n\t\treturn arr.includes(item);\r\n\t}else{\r\n\t\tfor (var i = 0; i < arr.length; i++) {\r\n\t\t\tif (arr[i] === item) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\n// iframe-safe array type check instead of using instanceof\r\nfunction isArray(obj){\r\n\tif(Array.isArray){\r\n\t\treturn Array.isArray(obj);\r\n\t}else{\r\n\t\t// close enough\r\n\t\treturn (obj && obj.length !== undefined && obj.pop && obj.push);\r\n\t}\r\n}\r\n\r\n// non-primitive string object, e.g. new String(\"abc\")\r\nfunction isStringObject(obj){\r\n\treturn obj && typeof obj === \"object\"\r\n\t\t&& Function.prototype.toString.call(obj.constructor) === \"function String() { [native code] }\";\r\n}\r\n\r\n// non-primitive number object, e.g. new Number(5)\r\nfunction isNumberObject(obj){\r\n\treturn obj && typeof obj === \"object\"\r\n\t\t&& Function.prototype.toString.call(obj.constructor) === \"function Number() { [native code] }\";\r\n}\r\n\r\n// non-primitive number object, e.g. new Boolean(true)\r\nfunction isBooleanObject(obj){\r\n\treturn obj && typeof obj === \"object\"\r\n\t\t&& Function.prototype.toString.call(obj.constructor) === \"function Boolean() { [native code] }\";\r\n}\r\n\r\nfunction isDate(obj) {\r\n\tif (obj && typeof obj === \"object\") {\r\n\t\treturn !!(obj.getFullYear && obj.getMonth && obj.getDate);\r\n\t} else {\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nfunction isValidDate(obj){\r\n\treturn isDate(obj) && !isNaN(obj.getTime());\r\n}\r\n\r\nfunction arrayFilter(arr, callback) {\r\n\tvar result = [];\r\n\r\n\tif (arr.filter) {\r\n\t\treturn arr.filter(callback);\r\n\t} else {\r\n\t\tfor (var i = 0; i < arr.length; i++) {\r\n\t\t\tif (callback(arr[i], i)) {\r\n\t\t\t\tresult[result.length] = arr[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n}\r\n\r\nfunction hashToArray(hash) {\r\n\tvar result = [];\r\n\r\n\tfor (var key in hash) {\r\n\t\tif (hash.hasOwnProperty(key)) {\r\n\t\t\tresult.push(hash[key]);\r\n\t\t}\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nfunction arraySome(arr, callback) {\r\n\tif (arr.length === 0) return false;\r\n\r\n\tfor (var i = 0; i < arr.length; i++) {\r\n\t\tif (callback(arr[i], i, arr)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nfunction arrayDifference(arr, callback) {\r\n\treturn arrayFilter(arr, function(item, i) {\r\n\t\treturn !callback(item, i);\r\n\t});\r\n}\r\n\r\nfunction throttle (callback, timeout) {\r\n\tvar wait = false;\r\n\r\n\treturn function () {\r\n\t\tif (!wait) {\r\n\t\t\tcallback.apply(null, arguments);\r\n\t\t\twait = true;\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\twait = false;\r\n\t\t\t}, timeout);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction delay (callback, timeout){\r\n\tvar timer;\r\n\r\n\tvar result = function() {\r\n\t\tresult.$cancelTimeout();\r\n\t\tresult.$pending = true;\r\n\t\tvar args = Array.prototype.slice.call(arguments);\r\n\t\ttimer = setTimeout(function(){\r\n\t\t\tcallback.apply(this, args);\r\n\t\t\tresult.$pending = false;\r\n\t\t}, timeout);\r\n\t};\r\n\r\n\tresult.$pending = false;\r\n\tresult.$cancelTimeout = function(){\r\n\t\tclearTimeout(timer);\r\n\t\tresult.$pending = false;\r\n\t};\r\n\tresult.$execute = function(){\r\n\t\tvar args = Array.prototype.slice.call(arguments);\r\n\t\tcallback.apply(this, args);\r\n\t\tresult.$cancelTimeout();\r\n\t};\r\n\r\n\treturn result;\r\n}\r\n\r\nfunction sortArrayOfHash(arr, field, desc) {\r\n\tvar compare = function(a, b) {\r\n\t\treturn a < b;\r\n\t};\r\n\r\n\tarr.sort(function(a, b) {\r\n\t\tif (a[field] === b[field]) return 0;\r\n\r\n\t\treturn desc ? compare(a[field], b[field]) : compare(b[field], a[field]);\r\n\t});\r\n}\r\n\r\nfunction objectKeys(obj) {\r\n\tif (Object.keys) {\r\n\t\treturn Object.keys(obj);\r\n\t}\r\n\tvar result = [];\r\n\tvar key;\r\n\tfor (key in obj) {\r\n\t\tif (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n\t\t\tresult.push(key);\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}\r\n\r\nfunction isEventable(obj) {\r\n\treturn obj.attachEvent && obj.detachEvent;\r\n}\r\n\r\n//GS-1090: A task should be able to have the id = 0\r\nfunction replaceValidZeroId(id, rootId) {\r\n\tif (checkZeroId(id) && !checkZeroId(rootId)){\r\n\t\tid = \"0\";\r\n\t}\r\n\treturn id;\r\n}\r\n\r\nfunction checkZeroId(id) {\r\n\tif (id === 0){\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nfunction findBinary(array, target) {\r\n\t// modified binary search, target value not exactly match array elements, looking for closest one\r\n\r\n\tvar low = 0, high = array.length - 1, i, item, prev;\r\n\twhile (low <= high) {\r\n\r\n\t\ti = Math.floor((low + high) / 2);\r\n\t\titem = +array[i];\r\n\t\tprev = +array[i - 1];\r\n\t\tif (item < target) {\r\n\t\t\tlow = i + 1;\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif (item > target) {\r\n\t\t\tif (!(!isNaN(prev) && prev < target)) {\r\n\t\t\t\thigh = i - 1;\r\n\t\t\t\tcontinue;\r\n\t\t\t} else {\r\n\t\t\t\t// if target is between 'i' and 'i-1' return 'i - 1'\r\n\t\t\t\treturn i - 1;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\twhile (+array[i] == +array[i + 1]) i++;\r\n\r\n\t\treturn i;\r\n\t}\r\n\treturn array.length - 1;\r\n}\r\n\r\nexport {\r\n\tgetSecondsInUnit,\r\n\tforEach,\r\n\tarrayMap,\r\n\tarrayIncludes,\r\n\tarrayFind,\r\n\tarrayFilter,\r\n\tarrayDifference,\r\n\tarraySome,\r\n\thashToArray,\r\n\tsortArrayOfHash,\r\n\tthrottle,\r\n\tisArray,\r\n\tisDate,\r\n\tisValidDate,\r\n\tisStringObject,\r\n\tisNumberObject,\r\n\tisBooleanObject,\r\n\tdelay,\r\n\tobjectKeys,\r\n\tisEventable,\r\n\treplaceValidZeroId,\r\n\tcheckZeroId,\r\n\tfindBinary\r\n};","import eventable from \"../../utils/eventable\";\r\nimport { isEventable } from \"../../utils/helpers\";\r\n\r\nexport interface ISelectedRegionConfig {\r\n\tclassName?: string;\r\n\trender?: (startPoint: IPoint, endPoint: IPoint) => HTMLElement;\r\n\tviewPort?: HTMLElement;\r\n\tuseRequestAnimationFrame: boolean;\r\n\tcallback?: (startPoint: IPoint, endPoint: IPoint, startDate: Date, endDate: Date, tasksByDate: any[], tasksByIndex: any[]) => void;\r\n\tsingleRow: boolean;\r\n}\r\n\r\ninterface ICoordinates {\r\n\tleft: number;\r\n\ttop: number;\r\n}\r\n\r\nexport interface IPoint {\r\n\tabsolute: ICoordinates;\r\n\trelative: ICoordinates;\r\n}\r\n\r\nexport class SelectedRegion {\r\n\trender: () => void;\r\n\tprivate _viewPort: HTMLElement & eventable;\r\n\tprivate _el: HTMLElement = document.createElement(\"div\");\r\n\tprivate _callback: (startPoint: IPoint, endPoint: IPoint, startDate: Date, endDate: Date, tasksByDate: any[], tasksByIndex: any[]) => void;\r\n\tprivate _startPoint: IPoint;\r\n\tprivate _endPoint: IPoint;\r\n\tprivate _positionPoint: IPoint;\r\n\tprivate _useRequestAnimationFrame: boolean;\r\n\tprivate _startDate: Date;\r\n\tprivate _endDate: Date;\r\n\tprivate _singleRow: boolean;\r\n\tprivate _gantt: any;\r\n\tprivate _view: any;\r\n\r\n\tconstructor(config: ISelectedRegionConfig, gantt: any, view: any) {\r\n\t\tthis._gantt = gantt;\r\n\t\tthis._view = view;\r\n\t\tthis._viewPort = config.viewPort;\r\n\t\tthis._el.classList.add(config.className);\r\n\t\tif (typeof config.callback === \"function\") {\r\n\t\t\tthis._callback = config.callback;\r\n\t\t}\r\n\r\n\t\tthis.render = () => {\r\n\t\t\tlet node;\r\n\t\t\tif(config.render){\r\n\t\t\t\tnode = config.render(this._startPoint, this._endPoint);\r\n\t\t\t}else{\r\n\t\t\t\tnode = this.defaultRender(this._startPoint, this._endPoint);\r\n\t\t\t}\r\n\r\n\t\t\tif(node !== this._el){\r\n\t\t\t\tif(this._el && this._el.parentNode){\r\n\t\t\t\t\tthis._el.parentNode.removeChild(this._el);\r\n\t\t\t\t}\r\n\t\t\t\tthis._el = node;\r\n\t\t\t}\r\n\r\n\t\t\tif (config.className !== \"\") {\r\n\t\t\t\tthis._el.classList.add(config.className);\r\n\t\t\t}\r\n\t\t\tthis.draw();\r\n\t\t};\r\n\r\n\t\tif (!isEventable(this._viewPort)) {\r\n\t\t\teventable(this._viewPort);\r\n\t\t}\r\n\t\tthis._singleRow = config.singleRow;\r\n\t\tthis._useRequestAnimationFrame = config.useRequestAnimationFrame;\r\n\t}\r\n\r\n\tdefaultRender = (start: IPoint, end: IPoint) => {\r\n\t\tif(!this._el){\r\n\t\t\tthis._el = document.createElement(\"div\");\r\n\t\t}\r\n\t\tconst node = this._el;\r\n\t\t// const gantt = this._gantt;\r\n\r\n\t\tconst top = Math.min(start.relative.top, end.relative.top);\r\n\t\tconst bottom = Math.max(start.relative.top, end.relative.top);\r\n\t\tconst left = Math.min(start.relative.left, end.relative.left);\r\n\t\tconst right = Math.max(start.relative.left, end.relative.left);\r\n\r\n\t\tif (this._singleRow) {\r\n\t\t\tconst pos = this._getTaskPositionByTop(this._startPoint.relative.top);\r\n\t\t\tnode.style.height = pos.height + \"px\";\r\n\t\t\tnode.style.top = pos.top + \"px\";\r\n\t\t} else {\r\n\t\t\tnode.style.height = Math.abs(bottom - top) + \"px\";\r\n\t\t\tnode.style.top = top + \"px\";\r\n\t\t}\r\n\t\tnode.style.width = Math.abs(right - left) + \"px\";\r\n\t\tnode.style.left = left + \"px\";\r\n\t\treturn node;\r\n\t};\r\n\r\n\tdraw() {\r\n\t\tif (this._useRequestAnimationFrame) {\r\n\t\t\treturn requestAnimationFrame(() => {\r\n\t\t\t\tthis._viewPort.appendChild(this.getElement());\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tthis._viewPort.appendChild(this.getElement());\r\n\t\t}\r\n\t}\r\n\r\n\tclear() {\r\n\t\tif (this._useRequestAnimationFrame) {\r\n\t\t\treturn requestAnimationFrame(() => {\r\n\t\t\t\tif (!this._el.parentNode) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis._viewPort.removeChild(this._el);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tif (!this._el.parentNode) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis._viewPort.removeChild(this._el);\r\n\t\t}\r\n\t}\r\n\r\n\tgetElement() {\r\n\t\treturn this._el;\r\n\t}\r\n\r\n\tgetViewPort() {\r\n\t\treturn this._viewPort;\r\n\t}\r\n\r\n\tsetStart(startPoint: IPoint) {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis._startPoint = startPoint;\r\n\t\tthis._startDate = gantt.dateFromPos(this._startPoint.relative.left);\r\n\t\tthis._viewPort.callEvent(\"onBeforeDrag\", [this._startPoint]);\r\n\t}\r\n\r\n\tsetEnd(endPoint: IPoint) {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis._endPoint = endPoint;\r\n\t\tif (this._singleRow) {\r\n\t\t\tconst pos = this._getTaskPositionByTop(this._startPoint.relative.top);\r\n\t\t\tthis._endPoint.relative.top = pos.top;\r\n\t\t}\r\n\t\tthis._endDate = gantt.dateFromPos(this._endPoint.relative.left);\r\n\t\tif (this._startPoint.relative.left > this._endPoint.relative.left) {\r\n\t\t\tthis._positionPoint = {\r\n\t\t\t\trelative: { left: this._endPoint.relative.left, top: this._positionPoint.relative.top },\r\n\t\t\t\tabsolute: { left: this._endPoint.absolute.left, top: this._positionPoint.absolute.top }\r\n\t\t\t};\r\n\t\t}\r\n\t\tif (this._startPoint.relative.top > this._endPoint.relative.top) {\r\n\t\t\tthis._positionPoint = {\r\n\t\t\t\trelative: { left: this._positionPoint.relative.left, top: this._endPoint.relative.top },\r\n\t\t\t\tabsolute: { left: this._positionPoint.absolute.left, top: this._endPoint.absolute.top }\r\n\t\t\t};\r\n\t\t}\r\n\r\n\r\n\t\tthis._viewPort.callEvent(\"onDrag\", [this._startPoint, this._endPoint]);\r\n\t}\r\n\r\n\tsetPosition(positionPoint: IPoint) {\r\n\t\tthis._positionPoint = positionPoint;\r\n\t}\r\n\r\n\tdragEnd(endPoint: IPoint) {\r\n\t\tconst gantt = this._gantt;\r\n\t\tif(endPoint.relative.left < 0){\r\n\t\t\tendPoint.relative.left = 0;\r\n\t\t}\r\n\t\tthis._viewPort.callEvent(\"onBeforeDragEnd\", [this._startPoint, endPoint]);\r\n\t\tthis.setEnd(endPoint);\r\n\t\t// GS-1422. The endDate can be null if we drag the mouse outside the Gantt container\r\n\t\tthis._endDate = this._endDate || gantt.getState().max_date;\r\n\r\n\t\tif (this._startDate.valueOf() > this._endDate.valueOf()) {\r\n\t\t\t[ this._startDate, this._endDate ] = [ this._endDate, this._startDate ];\r\n\t\t}\r\n\t\tthis.clear();\r\n\t\tconst tasksByTime = gantt.getTaskByTime(this._startDate, this._endDate);\r\n\t\tconst tasksByIndex = this._getTasksByTop(this._startPoint.relative.top, this._endPoint.relative.top);\r\n\r\n\t\tthis._viewPort.callEvent(\"onDragEnd\", [this._startPoint, this._endPoint]);\r\n\t\tif (this._callback) {\r\n\t\t\tthis._callback(this._startPoint, this._endPoint, this._startDate, this._endDate, tasksByTime, tasksByIndex);\r\n\t\t}\r\n\t}\r\n\r\n\tgetInBounds() {\r\n\t\treturn this._singleRow;\r\n\t}\r\n\r\n\tprivate _getTasksByTop(start: number, end:number) {\r\n\t\tconst gantt = this._gantt;\r\n\t\tlet startValue = start;\r\n\t\tlet endValue = end;\r\n\t\tif (start > end) {\r\n\t\t\tstartValue = end;\r\n\t\t\tendValue = start;\r\n\t\t}\r\n\t\tconst startIndex = this._getTaskPositionByTop(startValue).index;\r\n\t\tconst endIndex = this._getTaskPositionByTop(endValue).index;\r\n\t\tconst result = [];\r\n\t\tfor (let i = startIndex; i <= endIndex; i++) {\r\n\t\t\tconst task = gantt.getTaskByIndex(i);\r\n\t\t\tif (task) {\r\n\t\t\t\tresult.push(gantt.getTaskByIndex(i));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprivate _getTaskPositionByTop(top: number){\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst view = this._view;\r\n\t\tconst index = view.getItemIndexByTopPosition(top);\r\n\t\tconst task = gantt.getTaskByIndex(index);\r\n\t\tif(task){\r\n\t\t\tconst height = view.getItemHeight(task.id);\r\n\t\t\tconst itemTop = view.getItemTop(task.id);\r\n\t\t\treturn {\r\n\t\t\t\ttop: itemTop || 0,\r\n\t\t\t\theight: height || 0,\r\n\t\t\t\tindex\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tconst dataHeight = view.getTotalHeight();\r\n\t\t\treturn {\r\n\t\t\t\ttop: top > dataHeight ? dataHeight : 0,\r\n\t\t\t\theight: gantt.config.row_height,\r\n\t\t\t\tindex: top > dataHeight ? gantt.getTaskCount() : 0\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n}","interface IPoint {\r\n\tx: number;\r\n\ty: number;\r\n}\r\n\r\nlet _dragInProgress: boolean = false;\r\n\r\nexport class EventsManager {\r\n\tstatic create(gantt: any) {\r\n\t\treturn new EventsManager(gantt);\r\n\t}\r\n\tstatic _isDragInProgress() {\r\n\t\treturn _dragInProgress;\r\n\t}\r\n\tprivate _mouseDown: boolean = false;\r\n\tprivate _startPoint: IPoint;\r\n\tprivate _scrollState: IPoint;\r\n\tprivate _originAutoscroll: boolean;\r\n\tprivate _domEvents: any;\r\n\tprivate _timeline: any;\r\n\tprivate _gantt: any;\r\n\tprivate _trace: IPoint[];\r\n\tprivate _originalReadonly: boolean;\r\n\r\n\tconstructor(gantt: any) {\r\n\t\tthis._gantt = gantt;\r\n\t\tthis._domEvents = gantt._createDomEventScope();\r\n\t\tthis._trace = [];\r\n\t}\r\n\r\n\tdestructor() {\r\n\t\tthis._domEvents.detachAll();\r\n\t}\r\n\r\n\tattach(timeline: any): void {\r\n\t\tthis._timeline = timeline;\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis._domEvents.attach(timeline.$task, \"mousedown\", (event) => {\r\n\t\t\tif (!gantt.config.drag_timeline) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst { useKey,ignore, enabled } = gantt.config.drag_timeline;\r\n\t\t\tif(enabled === false) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet filterTargets = \".gantt_task_line, .gantt_task_link\";\r\n\t\t\tif(ignore !== undefined) {\r\n\t\t\t\tif(ignore instanceof Array){\r\n\t\t\t\t\tfilterTargets = ignore.join(\", \");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfilterTargets = ignore;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (filterTargets) {\r\n\t\t\t\tif (gantt.utils.dom.closest(event.target, filterTargets)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (useKey && event[useKey] !== true) { return; }\r\n\r\n\t\t\tthis._startDrag(event);\r\n\t\t});\r\n\r\n\t\tthis._domEvents.attach(document, \"keydown\", (event) => {\r\n\t\t\tif (!gantt.config.drag_timeline) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst { useKey } = gantt.config.drag_timeline;\r\n\t\t\tif (useKey && event[useKey] === true) {\r\n\t\t\t\tthis._applyDndReadyStyles();\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis._domEvents.attach(document, \"keyup\", (event) => {\r\n\t\t\tif (!gantt.config.drag_timeline) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst { useKey } = gantt.config.drag_timeline;\r\n\t\t\tif (useKey && event[useKey] === false) {\r\n\t\t\t\tthis._clearDndReadyStyles();\r\n\t\t\t\tthis._stopDrag(event);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis._domEvents.attach(document, \"mouseup\", (event) => {\r\n\t\t\tthis._stopDrag(event);\r\n\t\t});\r\n\t\tthis._domEvents.attach(gantt.$root, \"mouseup\", (event) => {\r\n\t\t\tthis._stopDrag(event);\r\n\t\t});\r\n\t\tthis._domEvents.attach(document, \"mouseleave\", (event) => {\r\n\t\t\tthis._stopDrag(event);\r\n\t\t});\r\n\t\tthis._domEvents.attach(gantt.$root, \"mouseleave\", (event) => {\r\n\t\t\tthis._stopDrag(event);\r\n\t\t});\r\n\r\n\t\tthis._domEvents.attach(gantt.$root, \"mousemove\", (event) => {\r\n\t\t\tif (!gantt.config.drag_timeline) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst { useKey } = gantt.config.drag_timeline;\r\n\t\t\tif (useKey && event[useKey] !== true) { return; }\r\n\t\t\t// GS-854. If we don't have useKey for the drag_timeline extension,\r\n\t\t\t// check the click_drag to not simultaneously use both extensions\r\n\t\t\tconst clickDrag = this._gantt.ext.clickDrag;\r\n\t\t\tconst clickDragUseKey = (this._gantt.config.click_drag || {}).useKey;\r\n\t\t\tif (clickDrag && clickDragUseKey) {\r\n\t\t\t\tif (!useKey && event[clickDragUseKey]) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this._mouseDown === true) {\r\n\t\t\t\tthis._trace.push({ x: event.clientX, y: event.clientY });\r\n\t\t\t\tconst scrollPosition: IPoint = this._countNewScrollPosition({ x: event.clientX, y: event.clientY });\r\n\t\t\t\tthis._setScrollPosition(timeline, scrollPosition);\r\n\t\t\t\tthis._scrollState = scrollPosition;\r\n\t\t\t\tthis._startPoint = { x: event.clientX, y: event.clientY };\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprivate _calculateDirectionVector = () => {\r\n\t\tconst traceSteps = 10;\r\n\t\tif(this._trace.length >= traceSteps) {\r\n\t\t\tconst dots = this._trace.slice(this._trace.length - traceSteps);\r\n\r\n\t\t\tconst vectors = [];\r\n\t\t\tfor(let i = 1; i < dots.length; i++) {\r\n\t\t\t\tvectors.push({\r\n\t\t\t\t\tx: dots[i].x - dots[i - 1].x,\r\n\t\t\t\t\ty: dots[i].y - dots[i - 1].y\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tconst resultVector = {x:0, y:0};\r\n\r\n\t\t\tvectors.forEach((vector) => {\r\n\t\t\t\tresultVector.x += vector.x;\r\n\t\t\t\tresultVector.y += vector.y;\r\n\t\t\t});\r\n\r\n\t\t\tconst magnitude = Math.sqrt(resultVector.x*resultVector.x + resultVector.y*resultVector.y);\r\n\t\t\tconst angleDegrees = Math.atan2(Math.abs(resultVector.y), Math.abs(resultVector.x)) * 180 / Math.PI;\r\n\r\n\t\t\treturn {\r\n\t\t\t\tmagnitude,\r\n\t\t\t\tangleDegrees\r\n\t\t\t};\r\n\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n\r\n\tprivate _applyDndReadyStyles = (): void => {\r\n\t\tthis._timeline.$task.classList.add(\"gantt_timeline_move_available\");\r\n\t};\r\n\r\n\tprivate _clearDndReadyStyles = (): void => {\r\n\t\tthis._timeline.$task.classList.remove(\"gantt_timeline_move_available\");\r\n\t};\r\n\r\n\tprivate _getScrollPosition = (timeline: any): IPoint => {\r\n\t\tconst gantt = this._gantt;\r\n\t\treturn {\r\n\t\t\tx: gantt.$ui.getView(timeline.$config.scrollX).getScrollState().position,\r\n\t\t\ty: gantt.$ui.getView(timeline.$config.scrollY).getScrollState().position\r\n\t\t};\r\n\t};\r\n\tprivate _countNewScrollPosition = (coords: IPoint): IPoint => {\r\n\t\tconst vector = this._calculateDirectionVector();\r\n\t\tlet shiftX = this._startPoint.x - coords.x;\r\n\t\tlet shiftY = this._startPoint.y - coords.y;\r\n\t\tif(vector){\r\n\t\t\tif(vector.angleDegrees < 15){\r\n\t\t\t\tshiftY = 0;\r\n\t\t\t} else if(vector.angleDegrees > 75){\r\n\t\t\t\tshiftX = 0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst result = {\r\n\t\t\tx: this._scrollState.x + shiftX,\r\n\t\t\ty: this._scrollState.y + shiftY\r\n\t\t};\r\n\t\treturn result;\r\n\t};\r\n\tprivate _setScrollPosition = (timeline: any, coords: IPoint): void => {\r\n\t\tconst gantt = this._gantt;\r\n\t\trequestAnimationFrame(() => {\r\n\t\t\tgantt.scrollLayoutCell(timeline.$id, coords.x, coords.y);\r\n\t\t});\r\n\t};\r\n\tprivate _stopDrag = (event: Event): void => {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis._trace = [];\r\n\t\tgantt.$root.classList.remove(\"gantt_noselect\");\r\n\r\n\t\t// We need to set the readonly mode because with the key modifiers, \r\n\t\t// users may expect to start dragging the timeline on the task and link coordinates\r\n\t\tif(this._originalReadonly !== undefined && this._mouseDown){\r\n\t\t\tgantt.config.readonly = this._originalReadonly;\r\n\t\t\tif(gantt.config.drag_timeline && gantt.config.drag_timeline.render){\r\n\t\t\t\tgantt.render();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(this._originAutoscroll !== undefined){\r\n\t\t\tgantt.config.autoscroll = this._originAutoscroll;\r\n\t\t}\r\n\r\n\t\tif(gantt.config.drag_timeline){\r\n\t\t\tconst { useKey } = gantt.config.drag_timeline;\r\n\t\t\tif (useKey && event[useKey] !== true) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._mouseDown = false;\r\n\t\t_dragInProgress = false;\r\n\t};\r\n\r\n\tprivate _startDrag = (event: any) : void => {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis._originAutoscroll = gantt.config.autoscroll;\r\n\t\tgantt.config.autoscroll = false;\r\n\t\t_dragInProgress = true;\r\n\r\n\t\tgantt.$root.classList.add(\"gantt_noselect\");\r\n\t\tthis._originalReadonly = gantt.config.readonly;\r\n\t\tgantt.config.readonly = true;\r\n\r\n\t\tif(gantt.config.drag_timeline && gantt.config.drag_timeline.render){\r\n\t\t\tgantt.render();\r\n\t\t}\r\n\r\n\t\tthis._trace = [];\r\n\t\tthis._mouseDown = true;\r\n\t\tconst { x, y } = this._getScrollPosition(this._timeline);\r\n\t\tthis._scrollState = { x, y };\r\n\t\tthis._startPoint = { x: event.clientX, y: event.clientY };\r\n\t\tthis._trace.push(this._startPoint);\r\n\t};\r\n}","import * as helpers from \"./helpers\";\r\n\r\nvar plainObjectConstructor = ({}).constructor.toString();\r\nfunction isCustomType(object){\r\n\tvar constructorString = object.constructor.toString();\r\n\r\n\treturn constructorString !== plainObjectConstructor;\r\n}\r\n\r\nfunction isExternalType(object){\r\n\t// react elements are not plain objects, but they are not custom types either\r\n\t// can't deep copy them\r\n\treturn object.$$typeof && object.$$typeof.toString().includes(\"react.\");\r\n}\r\n\r\nfunction copy(object) {\r\n\tvar i, result; // iterator, types array, result\r\n\r\n\tif (object && typeof object == \"object\") {\r\n\r\n\t\tswitch (true){\r\n\t\t\tcase (helpers.isDate(object)):\r\n\t\t\t\tresult = new Date(object);\r\n\t\t\t\tbreak;\r\n\t\t\tcase (helpers.isArray(object)):\r\n\t\t\t\tresult = new Array(object.length);\r\n\t\t\t\tfor(i = 0; i < object.length; i++){\r\n\t\t\t\t\tresult[i] = copy(object[i]);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t/*\t\tcase (helpers.isStringObject(object)):\r\n\t\t\t\tresult = new String(object);\r\n\t\t\t\tbreak;\r\n\t\t\tcase (helpers.isNumberObject(object)):\r\n\t\t\t\tresult = new Number(object);\r\n\t\t\t\tbreak;\r\n\t\t\tcase (helpers.isBooleanObject(object)):\r\n\t\t\t\tresult = new Boolean(object);\r\n\t\t\t\tbreak;*/\r\n\t\t\tdefault:\r\n\t\t\t\tif(isCustomType(object)){\r\n\t\t\t\t\tresult = Object.create(object);\r\n\t\t\t\t}else if (isExternalType(object)){\r\n\t\t\t\t\tresult = object;\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult = {};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (i in object) {\r\n\t\t\t\t\tif (Object.prototype.hasOwnProperty.apply(object, [i]))\r\n\t\t\t\t\t\tresult[i] = copy(object[i]);\r\n\t\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\treturn result || object;\r\n}\r\n\r\nfunction mixin (target, source, force){\r\n\tfor (var f in source)\r\n\t\tif (((target[f] === undefined) || force)) target[f]=source[f];\r\n\treturn target;\r\n}\r\n\r\nfunction defined(obj) {\r\n\treturn typeof(obj) != \"undefined\";\r\n}\r\n\r\nvar seed;\r\nfunction uid() {\r\n\tif (!seed)\r\n\t\tseed = (new Date()).valueOf();\r\n\r\n\tseed++;\r\n\treturn seed;\r\n}\r\n\r\n//creates function with specified \"this\" pointer\r\nfunction bind(functor, object){\r\n\tif(functor.bind)\r\n\t\treturn functor.bind(object);\r\n\telse\r\n\t\treturn function(){ return functor.apply(object,arguments); };\r\n}\r\n\r\nfunction event(el, event, handler, capture){\r\n\tif (el.addEventListener)\r\n\t\tel.addEventListener(event, handler, capture === undefined ? false : capture);\r\n\r\n\telse if (el.attachEvent)\r\n\t\tel.attachEvent(\"on\"+event, handler);\r\n}\r\n\r\nfunction eventRemove(el, event, handler, capture){\r\n\tif (el.removeEventListener)\r\n\t\tel.removeEventListener(event, handler, capture === undefined ? false : capture);\r\n\r\n\telse if (el.detachEvent)\r\n\t\tel.detachEvent(\"on\"+event, handler);\r\n}\r\n\r\nexport {\r\n\tcopy,\r\n\tdefined,\r\n\tmixin,\r\n\tuid,\r\n\tbind,\r\n\tevent,\r\n\teventRemove\r\n};","import * as utils from \"../../../utils/utils\";\r\n\r\nfunction ScaleHelper(gantt){\r\n\tvar dateHelper = gantt.date;\r\n\tvar services = gantt.$services;\r\n\r\n\treturn {\r\n\t\tgetSum: function (sizes, from, to) {\r\n\t\t\tif (to === undefined)\r\n\t\t\t\tto = sizes.length - 1;\r\n\t\t\tif (from === undefined)\r\n\t\t\t\tfrom = 0;\r\n\r\n\t\t\tvar summ = 0;\r\n\t\t\tfor (var i = from; i <= to; i++)\r\n\t\t\t\tsumm += sizes[i];\r\n\r\n\t\t\treturn summ;\r\n\t\t},\r\n\t\tsetSumWidth: function (sum_width, scale, from, to) {\r\n\t\t\tvar parts = scale.width;\r\n\r\n\t\t\tif (to === undefined)\r\n\t\t\t\tto = parts.length - 1;\r\n\t\t\tif (from === undefined)\r\n\t\t\t\tfrom = 0;\r\n\t\t\tvar length = to - from + 1;\r\n\r\n\t\t\tif (from > parts.length - 1 || length <= 0 || to > parts.length - 1)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tvar oldWidth = this.getSum(parts, from, to);\r\n\r\n\t\t\tvar diff = sum_width - oldWidth;\r\n\r\n\t\t\tthis.adjustSize(diff, parts, from, to);\r\n\t\t\tthis.adjustSize(-diff, parts, to + 1);\r\n\r\n\t\t\tscale.full_width = this.getSum(parts);\r\n\t\t},\r\n\t\tsplitSize: function (width, count) {\r\n\t\t\tvar arr = [];\r\n\t\t\tfor (var i = 0; i < count; i++) arr[i] = 0;\r\n\r\n\t\t\tthis.adjustSize(width, arr);\r\n\t\t\treturn arr;\r\n\r\n\t\t},\r\n\t\tadjustSize: function (width, parts, from, to) {\r\n\t\t\tif (!from)\r\n\t\t\t\tfrom = 0;\r\n\t\t\tif (to === undefined)\r\n\t\t\t\tto = parts.length - 1;\r\n\r\n\t\t\tvar length = to - from + 1;\r\n\r\n\t\t\tvar full = this.getSum(parts, from, to);\r\n\r\n\t\t\tfor (var i = from; i <= to; i++) {\r\n\t\t\t\tvar share = Math.floor(width * (full ? (parts[i] / full) : (1 / length)));\r\n\r\n\t\t\t\tfull -= parts[i];\r\n\t\t\t\twidth -= share;\r\n\t\t\t\tlength--;\r\n\r\n\t\t\t\tparts[i] += share;\r\n\t\t\t}\r\n\t\t\tparts[parts.length - 1] += width;\r\n\t\t},\r\n\t\tsortScales: function (scales) {\r\n\t\t\tfunction cellSize(unit, step) {\r\n\t\t\t\tvar d = new Date(1970, 0, 1);\r\n\t\t\t\treturn dateHelper.add(d, step, unit) - d;\r\n\t\t\t}\r\n\r\n\t\t\tscales.sort(function (a, b) {\r\n\t\t\t\tif (cellSize(a.unit, a.step) < cellSize(b.unit, b.step)) {\r\n\t\t\t\t\treturn 1;\r\n\t\t\t\t} else if (cellSize(a.unit, a.step) > cellSize(b.unit, b.step)) {\r\n\t\t\t\t\treturn -1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tfor (var i = 0; i < scales.length; i++) {\r\n\t\t\t\tscales[i].index = i;\r\n\t\t\t}\r\n\t\t},\r\n\t\t_prepareScaleObject: function(scale){\r\n\t\t\tvar format = scale.format;\r\n\t\t\tif(!format){\r\n\t\t\t\tformat = scale.template || scale.date || \"%d %M\";\r\n\t\t\t}\r\n\r\n\t\t\tif(typeof format === \"string\"){\r\n\t\t\t\tformat = gantt.date.date_to_str(format);\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\tunit: scale.unit || \"day\",\r\n\t\t\t\tstep: scale.step || 1,\r\n\t\t\t\tformat: format,\r\n\t\t\t\tcss: scale.css,\r\n\t\t\t\tprojection: scale.projection || null,\r\n\t\t\t\tcolumn_width: scale.column_width || null\r\n\t\t\t};\r\n\t\t},\r\n\t\tprimaryScale: function(config) {\r\n\t\t\tconst scaleConfig = config || gantt.config;\r\n\r\n\t\t\tconst primaryScale = scaleConfig.scales[0];\r\n\t\t\tconst result = {\r\n\t\t\t\tunit: primaryScale.unit,\r\n\t\t\t\tstep: primaryScale.step,\r\n\t\t\t\ttemplate: primaryScale.template,\r\n\t\t\t\tformat: primaryScale.format,\r\n\t\t\t\tdate: primaryScale.date,\r\n\t\t\t\tcss: primaryScale.css || gantt.templates.scale_cell_class,\r\n\t\t\t\tprojection: primaryScale.projection || null,\r\n\t\t\t\tcolumn_width: primaryScale.column_width || null\r\n\t\t\t};\r\n\r\n\t\t\treturn this._prepareScaleObject(result);\r\n\t\t},\r\n\t\tgetAdditionalScales: function(config) {\r\n\t\t\tconst scaleConfig = config || gantt.config;\r\n\t\t\tconst scales = scaleConfig.scales.slice(1);\r\n\r\n\t\t\treturn scales.map(function(scale){\r\n\t\t\t\treturn this._prepareScaleObject(scale);\r\n\t\t\t}.bind(this));\r\n\t\t},\r\n\t\tprepareConfigs: function (scales, min_coll_width, container_width, scale_height, minDate, maxDate, rtl) {\r\n\t\t\tvar heights = this.splitSize(scale_height, scales.length);\r\n\t\t\tvar full_width = container_width;\r\n\r\n\t\t\tvar configs = [];\r\n\t\t\tfor (var i = scales.length - 1; i >= 0; i--) {\r\n\t\t\t\tvar main_scale = (i == scales.length - 1);\r\n\t\t\t\tvar cfg = this.initScaleConfig(scales[i], minDate, maxDate);\r\n\t\t\t\tif (main_scale) {\r\n\t\t\t\t\tthis.processIgnores(cfg);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(main_scale && cfg.column_width){\r\n\t\t\t\t\tfull_width = cfg.column_width * (cfg.display_count || cfg.count);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.initColSizes(cfg, min_coll_width, full_width, heights[i]);\r\n\t\t\t\tthis.limitVisibleRange(cfg);\r\n\r\n\t\t\t\tif (main_scale) {\r\n\t\t\t\t\tfull_width = cfg.full_width;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconfigs.unshift(cfg);\r\n\t\t\t}\r\n\r\n\r\n\t\t\tfor (var i = 0; i < configs.length - 1; i++) {\r\n\t\t\t\tthis.alineScaleColumns(configs[configs.length - 1], configs[i]);\r\n\t\t\t}\r\n\t\t\tfor (var i = 0; i < configs.length; i++) {\r\n\r\n\t\t\t\tif(rtl){\r\n\t\t\t\t\tthis.reverseScale(configs[i]);\r\n\t\t\t\t}\r\n\t\t\t\tthis.setPosSettings(configs[i]);\r\n\t\t\t}\r\n\t\t\treturn configs;\r\n\r\n\t\t},\r\n\r\n\t\treverseScale: function(scale){\r\n\t\t\tscale.width = scale.width.reverse();\r\n\t\t\tscale.trace_x = scale.trace_x.reverse();\r\n\r\n\t\t\tvar indexes = scale.trace_indexes;\r\n\t\t\tscale.trace_indexes = {};\r\n\t\t\tscale.trace_index_transition = {};\r\n\t\t\tscale.rtl = true;\r\n\t\t\tfor(var i = 0; i < scale.trace_x.length; i++){\r\n\t\t\t\tscale.trace_indexes[scale.trace_x[i].valueOf()] = i;\r\n\t\t\t\tscale.trace_index_transition[indexes[scale.trace_x[i].valueOf()]] = i;\r\n\t\t\t}\r\n\t\t\treturn scale;\r\n\t\t},\r\n\r\n\t\tsetPosSettings: function (config) {\r\n\t\t\tfor (var i = 0, len = config.trace_x.length; i < len; i++) {\r\n\t\t\t\tconfig.left.push((config.width[i - 1] || 0) + (config.left[i - 1] || 0));\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_ignore_time_config: function (date, scale) {\r\n\r\n\t\t\tif (gantt.config.skip_off_time) {\r\n\t\t\t\tvar skip = true;\r\n\t\t\t\tvar probe = date;\r\n\r\n\t\t\t\t// check dates in case custom scale unit, e.g. {unit: \"month\", step: 3}\r\n\t\t\t\tfor (var i = 0; i < scale.step; i++) {\r\n\t\t\t\t\tif (i) {\r\n\t\t\t\t\t\tprobe = dateHelper.add(date, i, scale.unit);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tskip = skip && !this.isWorkTime(probe, scale.unit);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn skip;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\t//defined in an extension\r\n\t\tprocessIgnores: function (config) {\r\n\t\t\tconfig.ignore_x = {};\r\n\t\t\tconfig.display_count = config.count;\r\n\t\t},\r\n\t\tinitColSizes: function (config, min_col_width, full_width, line_height) {\r\n\t\t\tvar cont_width = full_width;\r\n\r\n\t\t\tconfig.height = line_height;\r\n\r\n\t\t\tvar column_count = config.display_count === undefined ? config.count : config.display_count;\r\n\r\n\t\t\tif (!column_count)\r\n\t\t\t\tcolumn_count = 1;\r\n\r\n\t\t\tconst fixedMode = !isNaN(config.column_width*1) && config.column_width*1 > 0;\r\n\t\t\tif (fixedMode) {\r\n\t\t\t\tconst baseCellWidth = config.column_width*1;\r\n\t\t\t\tconfig.col_width = baseCellWidth;\r\n\t\t\t\tcont_width = baseCellWidth * column_count;\r\n\t\t\t} else {\r\n\t\t\t\tconfig.col_width = Math.floor(cont_width / column_count);\r\n\t\t\t\tif (min_col_width) {\r\n\t\t\t\t\tif (config.col_width < min_col_width) {\r\n\t\t\t\t\t\tconfig.col_width = min_col_width;\r\n\t\t\t\t\t\tcont_width = config.col_width * column_count;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconfig.width = [];\r\n\t\t\tvar ignores = config.ignore_x || {};\r\n\t\t\tfor (var i = 0; i < config.trace_x.length; i++) {\r\n\t\t\t\tif (ignores[config.trace_x[i].valueOf()] || (config.display_count == config.count)) {\r\n\t\t\t\t\tif(fixedMode){\r\n\t\t\t\t\t\tconfig.width[i] = config.col_width;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconfig.width[i] = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// width of month columns should be proportional month duration\r\n\t\t\t\t\tvar width = 1;\r\n\t\t\t\t\tif (config.unit == \"month\") {\r\n\t\t\t\t\t\tvar days = Math.round((dateHelper.add(config.trace_x[i], config.step, config.unit) - config.trace_x[i]) / (1000 * 60 * 60 * 24));\r\n\t\t\t\t\t\twidth = days;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconfig.width[i] = width;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(!fixedMode){\r\n\t\t\t\tthis.adjustSize(cont_width - this.getSum(config.width)/* 1 width per column from the code above */, config.width);\r\n\t\t\t}\r\n\r\n\t\t\tconfig.full_width = this.getSum(config.width);\r\n\t\t},\r\n\t\tinitScaleConfig: function (config, min_date, max_date) {\r\n\t\t\tvar cfg = utils.mixin({\r\n\t\t\t\tcount: 0,\r\n\t\t\t\tcol_width: 0,\r\n\t\t\t\tfull_width: 0,\r\n\t\t\t\theight: 0,\r\n\t\t\t\twidth: [],\r\n\t\t\t\tleft: [],\r\n\t\t\t\ttrace_x: [],\r\n\t\t\t\ttrace_indexes: {},\r\n\t\t\t\tmin_date: new Date(min_date),\r\n\t\t\t\tmax_date: new Date(max_date)\r\n\t\t\t}, config);\r\n\r\n\t\t\tthis.eachColumn(config.unit, config.step, min_date, max_date, function (date) {\r\n\t\t\t\tcfg.count++;\r\n\t\t\t\tcfg.trace_x.push(new Date(date));\r\n\t\t\t\tcfg.trace_indexes[date.valueOf()] = cfg.trace_x.length - 1;\r\n\t\t\t});\r\n\r\n\t\t\tcfg.trace_x_ascending = cfg.trace_x.slice();\r\n\t\t\treturn cfg;\r\n\t\t},\r\n\t\titerateScales: function (lower_scale, upper_scale, from, to, callback) {\r\n\t\t\tvar upper_dates = upper_scale.trace_x;\r\n\t\t\tvar lower_dates = lower_scale.trace_x;\r\n\r\n\t\t\tvar prev = from || 0;\r\n\t\t\tvar end = to || (lower_dates.length - 1);\r\n\t\t\tvar prevUpper = 0;\r\n\r\n\r\n\t\t\tfor (var up = 1; up < upper_dates.length; up++) {\r\n\t\t\t\tvar target_index = (lower_scale.trace_indexes[+upper_dates[up]]);\r\n\t\t\t\tif (target_index !== undefined && target_index <= end) {\r\n\t\t\t\t\tif (callback) {\r\n\t\t\t\t\t\tcallback.apply(this, [prevUpper, up, prev, target_index]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tprev = target_index;\r\n\t\t\t\t\tprevUpper = up;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\talineScaleColumns: function (lower_scale, upper_scale, from, to) {\r\n\t\t\tthis.iterateScales(lower_scale, upper_scale, from, to, function (upper_start, upper_end, lower_start, lower_end) {\r\n\t\t\t\tvar targetWidth = this.getSum(lower_scale.width, lower_start, lower_end - 1);\r\n\t\t\t\tvar actualWidth = this.getSum(upper_scale.width, upper_start, upper_end - 1);\r\n\t\t\t\tif (actualWidth != targetWidth) {\r\n\t\t\t\t\tthis.setSumWidth(targetWidth, upper_scale, upper_start, upper_end - 1);\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\teachColumn: function (unit, step, min_date, max_date, callback) {\r\n\t\t\tvar start = new Date(min_date),\r\n\t\t\t\tend = new Date(max_date);\r\n\t\t\tif (dateHelper[unit + \"_start\"]) {\r\n\t\t\t\tstart = dateHelper[unit + \"_start\"](start);\r\n\t\t\t}\r\n\r\n\t\t\tvar curr = new Date(start);\r\n\t\t\tif (+curr >= +end) {\r\n\t\t\t\tend = dateHelper.add(curr, step, unit);\r\n\t\t\t}\r\n\t\t\twhile (+curr < +end) {\r\n\t\t\t\tcallback.call(this, new Date(curr));\r\n\t\t\t\tvar tzOffset = curr.getTimezoneOffset();\r\n\t\t\t\tcurr = dateHelper.add(curr, step, unit);\r\n\t\t\t\tcurr = gantt._correct_dst_change(curr, tzOffset, step, unit);\r\n\t\t\t\tif (dateHelper[unit + '_start'])\r\n\t\t\t\t\tcurr = dateHelper[unit + \"_start\"](curr);\r\n\t\t\t}\r\n\t\t},\r\n\t\tlimitVisibleRange: function (cfg) {\r\n\t\t\tvar dates = cfg.trace_x;\r\n\r\n\t\t\tvar left = 0, right = cfg.width.length - 1;\r\n\t\t\tvar diff = 0;\r\n\t\t\tif (+dates[0] < +cfg.min_date && left != right) {\r\n\t\t\t\tvar width = Math.floor(cfg.width[0] * ((dates[1] - cfg.min_date) / (dates[1] - dates[0])));\r\n\t\t\t\tdiff += cfg.width[0] - width;\r\n\t\t\t\tcfg.width[0] = width;\r\n\r\n\t\t\t\tdates[0] = new Date(cfg.min_date);\r\n\t\t\t}\r\n\r\n\t\t\tvar last = dates.length - 1;\r\n\t\t\tvar lastDate = dates[last];\r\n\t\t\tvar outDate = dateHelper.add(lastDate, cfg.step, cfg.unit);\r\n\t\t\tif (+outDate > +cfg.max_date && last > 0) {\r\n\t\t\t\tvar width = cfg.width[last] - Math.floor(cfg.width[last] * ((outDate - cfg.max_date) / (outDate - lastDate)));\r\n\t\t\t\tdiff += cfg.width[last] - width;\r\n\t\t\t\tcfg.width[last] = width;\r\n\t\t\t}\r\n\r\n\t\t\tif (diff) {\r\n\t\t\t\tvar full = this.getSum(cfg.width);\r\n\t\t\t\tvar shared = 0;\r\n\t\t\t\tfor (var i = 0; i < cfg.width.length; i++) {\r\n\t\t\t\t\tvar share = Math.floor(diff * (cfg.width[i] / full));\r\n\t\t\t\t\tcfg.width[i] += share;\r\n\t\t\t\t\tshared += share;\r\n\t\t\t\t}\r\n\t\t\t\tthis.adjustSize(diff - shared, cfg.width);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default ScaleHelper;\r\n","export default function(gantt) {\r\n\r\n\t(function () {\r\n\t\tvar modalsStack = [];\r\n\r\n\t\tfunction isModal() {\r\n\t\t\treturn !!modalsStack.length;\r\n\t\t}\r\n\r\n\t\tfunction afterPopup(box) {\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tif (!isModal()){\r\n\t\t\t\t\tif(!gantt.$destroyed){\r\n\t\t\t\t\t\tgantt.focus();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, 1);\r\n\t\t}\r\n\r\n\t\tfunction startModal(box) {\r\n\t\t\tgantt.eventRemove(box, \"keydown\", trapFocus);\r\n\t\t\tgantt.event(box, \"keydown\", trapFocus);\r\n\t\t\tmodalsStack.push(box);\r\n\t\t\t//gantt.$keyboardNavigation.dispatcher.disable();\r\n\t\t}\r\n\r\n\t\tfunction endModal() {\r\n\t\t\tvar box = modalsStack.pop();\r\n\t\t\tif (box) {\r\n\t\t\t\tgantt.eventRemove(box, \"keydown\", trapFocus);\r\n\t\t\t}\r\n\t\t\tafterPopup(box);\r\n\r\n\t\t}\r\n\r\n\r\n\t\tfunction isTopModal(box) {\r\n\t\t\treturn box == modalsStack[modalsStack.length - 1];\r\n\t\t}\r\n\r\n\t\tfunction trapFocus(event) {\r\n\t\t\tvar target = event.currentTarget;\r\n\t\t\tif (!isTopModal(target)) return;\r\n\r\n\t\t\tgantt.$keyboardNavigation.trapFocus(target, event);\r\n\t\t}\r\n\r\n\t\tfunction traceLightbox() {\r\n\t\t\tstartModal(gantt.getLightbox());\r\n\t\t}\r\n\r\n\t\tgantt.attachEvent(\"onLightbox\", traceLightbox);\r\n\t\tgantt.attachEvent(\"onAfterLightbox\", endModal);\r\n\t\tgantt.attachEvent(\"onLightboxChange\", function () {\r\n\t\t\tendModal();\r\n\t\t\ttraceLightbox();\r\n\t\t});\r\n\r\n\r\n\t\tgantt.attachEvent(\"onAfterQuickInfo\", function () {\r\n\t\t\tafterPopup();\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onMessagePopup\", function (box) {\r\n\t\t\tsaveFocus();\r\n\t\t\tstartModal(box);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterMessagePopup\", function () {\r\n\t\t\tendModal();\r\n\t\t\trestoreFocus();\r\n\t\t});\r\n\r\n\t\tvar focusElement = null;\r\n\r\n\t\tfunction saveFocus() {\r\n\t\t\tfocusElement = gantt.utils.dom.getActiveElement();\r\n\t\t}\r\n\r\n\t\tfunction restoreFocus() {\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tif (focusElement && focusElement.focus) {\r\n\t\t\t\t\tfocusElement.focus();\r\n\t\t\t\t\tfocusElement = null;\r\n\t\t\t\t}\r\n\t\t\t}, 1);\r\n\t\t}\r\n\r\n\t\tgantt.$keyboardNavigation.isModal = isModal;\r\n\r\n\r\n\t})();\r\n\r\n};","\r\ninterface IQuickInfoContainer{\r\n\tparent: HTMLElement;\r\n\txViewport: HTMLElement;\r\n\tyViewport: HTMLElement;\r\n}\r\n\r\nexport class QuickInfo {\r\n\tprivate _quickInfoTask: TaskID;\r\n\tprivate _quickInfoBoxId: number | string;\r\n\tprivate _quickInfoBox: HTMLElement;\r\n\tprivate _quickInfoReadonly: boolean | null;\r\n\tprivate _container: HTMLElement;\r\n\tprivate _gantt: any;\r\n\r\n\tconstructor(gantt: any) {\r\n\t\tthis._gantt = gantt;\r\n\t}\r\n\r\n\t// show at coordinates:\r\n\t// show(x: number, y: number)\r\n\t// show for a task:\r\n\t// show(id: TaskID)\r\n\tshow : {\r\n\t\t(x: number, y: number) : void;\r\n\t\t(id: TaskID) : void;\r\n\t} = (id: TaskID | number, y? : number) : void => {\r\n\t\tif (y === undefined) {\r\n\t\t\tthis._showForTask(id);\r\n\t\t} else {\r\n\t\t\tthis._showAtCoordinates(id as number, y);\r\n\t\t}\r\n\t};\r\n\r\n\thide = (forced?: boolean) : any => {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst qi = this._quickInfoBox;\r\n\t\tthis._quickInfoBoxId = 0;\r\n\t\tconst taskId = this._quickInfoTask;\r\n\t\tthis._quickInfoTask = null;\r\n\r\n\t\tif (qi && qi.parentNode){\r\n\r\n\t\t\tif (gantt.config.quick_info_detached) {\r\n\t\t\t\tgantt.callEvent(\"onAfterQuickInfo\", [taskId]);\r\n\t\t\t\treturn qi.parentNode.removeChild(qi);\r\n\t\t\t}\r\n\r\n\t\t\tqi.className += \" gantt_qi_hidden\";\r\n\t\t\tif (qi.style.right === \"auto\"){\r\n\t\t\t\tqi.style.left = \"-350px\";\r\n\t\t\t} else {\r\n\t\t\t\tqi.style.right = \"-350px\";\r\n\t\t\t}\r\n\r\n\t\t\tif (forced) {\r\n\t\t\t\tqi.style.left = qi.style.right = \"\";\r\n\t\t\t\tqi.parentNode.removeChild(qi);\r\n\t\t\t}\r\n\t\t\tgantt.callEvent(\"onAfterQuickInfo\", [taskId]);\r\n\t\t}\r\n\t};\r\n\r\n\tgetNode = (): HTMLElement => {\r\n\t\tif(this._quickInfoBox) {\r\n\t\t\treturn this._quickInfoBox;\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n\r\n\tsetContainer = (container: string|HTMLElement): void => {\r\n\t\tif(container){\r\n\t\t\tthis._container = typeof container === \"string\" ? document.getElementById(container) : container;\r\n\t\t}\r\n\t};\r\n\r\n\tsetContent = (content?: IQuickInfoContent) => {\r\n\t\tconst gantt = this._gantt;\r\n\r\n\t\tconst defaultContent = {\r\n\t\t\ttaskId: null,\r\n\t\t\theader: {\r\n\t\t\t\ttitle: \"\",\r\n\t\t\t\tdate: \"\"\r\n\t\t\t},\r\n\t\t\tcontent: \"\",\r\n\t\t\tbuttons: gantt.config.quickinfo_buttons\r\n\t\t};\r\n\r\n\t\tif(!content){\r\n\t\t\tcontent = defaultContent;\r\n\t\t}\r\n\r\n\t\tif(!content.taskId){\r\n\t\t\tcontent.taskId = defaultContent.taskId;\r\n\t\t}\r\n\r\n\t\tif(!content.header){\r\n\t\t\tcontent.header = defaultContent.header;\r\n\t\t}\r\n\r\n\t\tif(!content.header.title){\r\n\t\t\tcontent.header.title = defaultContent.header.title;\r\n\t\t}\r\n\t\tif(!content.header.date){\r\n\t\t\tcontent.header.date = defaultContent.header.date;\r\n\t\t}\r\n\t\tif(!content.content){\r\n\t\t\tcontent.content = defaultContent.content;\r\n\t\t}\r\n\t\tif(!content.buttons){\r\n\t\t\tcontent.buttons = defaultContent.buttons;\r\n\t\t}\r\n\r\n\r\n\t\tlet qi = this.getNode();\r\n\t\tif(!qi){\r\n\t\t\tqi = this._createQuickInfoElement();\r\n\t\t}\r\n\r\n\t\tif(content.taskId){\r\n\t\t\tthis._quickInfoBoxId = content.taskId;\r\n\t\t}\r\n\r\n\t\tconst titleBox = qi.querySelector(\".gantt_cal_qi_title\") as HTMLElement;\r\n\t\tconst titleContent = titleBox.querySelector(\".gantt_cal_qi_tcontent\");\r\n\t\tconst titleDate = titleBox.querySelector(\".gantt_cal_qi_tdate\");\r\n\t\tconst main = qi.querySelector(\".gantt_cal_qi_content\");\r\n\t\tconst controls = qi.querySelector(\".gantt_cal_qi_controls\") as HTMLElement;\r\n\r\n\t\tgantt._waiAria.quickInfoHeader(qi, [content.header.title, content.header.date].join(\" \"));\r\n\r\n\t\ttitleContent.innerHTML = content.header.title;\r\n\t\ttitleDate.innerHTML = content.header.date;\r\n\r\n\t\tif(!content.header.title && !content.header.date){\r\n\t\t\ttitleBox.style.display = \"none\";\r\n\t\t}else{\r\n\t\t\ttitleBox.style.display = \"\";\r\n\t\t}\r\n\t\tmain.innerHTML = content.content;\r\n\r\n\t\tconst buttons = content.buttons;\r\n\t\tif(!buttons.length){\r\n\t\t\tcontrols.style.display = \"none\";\r\n\t\t}else{\r\n\t\t\tcontrols.style.display = \"\";\r\n\t\t}\r\n\t\tlet html = \"\";\r\n\t\tfor (let i = 0; i < buttons.length; i++){\r\n\r\n\t\t\tconst ariaAttr = gantt._waiAria.quickInfoButtonAttrString(gantt.locale.labels[buttons[i]]);\r\n\r\n\t\t\thtml += `<div class=\"gantt_qi_big_icon ${buttons[i]} dhx_gantt_${buttons[i]}\" title=\"${gantt.locale.labels[buttons[i]]}\" ${ariaAttr}>\r\n            <div class='dhx_menu_icon dhx_gantt_icon ${buttons[i]} gantt_menu_icon dhx_gantt_${buttons[i]}'></div>\r\n            <div>${gantt.locale.labels[buttons[i]]}</div>\r\n         </div>`;\r\n\t\t}\r\n\t\tcontrols.innerHTML = html;\r\n\r\n\t\tgantt.eventRemove(qi, \"click\", this._qiButtonClickHandler);\r\n\t\tgantt.eventRemove(qi, \"keypress\", this._qiKeyPressHandler);\r\n\r\n\t\tgantt.event(qi, \"click\", this._qiButtonClickHandler);\r\n\t\tgantt.event(qi, \"keypress\", this._qiKeyPressHandler);\r\n\t};\r\n\r\n\tprivate _qiButtonClickHandler = (ev) => {\r\n\t\tthis._qi_button_click(ev.target);\r\n\t};\r\n\r\n\tprivate _qiKeyPressHandler = (e) => {\r\n\r\n\t\tconst code = e.which;\r\n\t\tif (code === 13 || code === 32){\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis._qi_button_click(e.target);\r\n\t\t\t},1);\r\n\t\t}\r\n\t};\r\n\r\n\tprivate _showAtCoordinates(x: number, y: number) : void {\r\n\t\tthis.hide(true);\r\n\t\tthis._quickInfoBoxId = 0;\r\n\t\tthis._quickInfoTask = null;\r\n\t\tif(!this._quickInfoBox){\r\n\t\t\tthis._createQuickInfoElement();\r\n\t\t\tthis.setContent();\r\n\t\t}\r\n\r\n\t\tthis._appendAtCoordinates(x, y);\r\n\t\tthis._gantt.callEvent(\"onQuickInfo\", [null]);\r\n\t}\r\n\r\n\tprivate _showForTask(id: TaskID) : void {\r\n\t\tconst gantt = this._gantt;\r\n\t\tif ((\r\n\t\t\tid === this._quickInfoBoxId &&\r\n\t\t\tgantt.utils.dom.isChildOf(this._quickInfoBox, document.body)\r\n\t\t) || !gantt.config.show_quick_info) {\r\n\t\t\t// not show if the quick info is already displayed for this task, or if it shouldn't be displayed\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.hide(true);\r\n\t\tconst offset = 6; // offset TASK <> QI-BOX in 'px'\r\n\t\tconst container = this._getContainer();\r\n\t\tconst pos = this._get_event_counter_part(id, offset, container.xViewport, container.yViewport);\r\n\r\n\t\tif (pos){\r\n\t\t\tthis._quickInfoBox = this._init_quick_info(id);\r\n\t\t\tthis._quickInfoTask = id;\r\n\t\t\tthis._quickInfoBox.className = this._prepare_quick_info_classname(id);\r\n\r\n\t\t\tthis._fill_quick_data(id);\r\n\t\t\tthis._show_quick_info(pos, offset);\r\n\t\t\tgantt.callEvent(\"onQuickInfo\", [id]);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _get_event_counter_part(id: TaskID, offset: number, xViewport: HTMLElement, yViewport: HTMLElement) : any {\r\n\t\tconst gantt = this._gantt;\r\n\t\tlet domEv = gantt.getTaskNode(id);\r\n\t\tif (!domEv) {\r\n\t\t\tdomEv = gantt.getTaskRowNode(id);\r\n\t\t\tif (!domEv) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet left = 0;\r\n\t\tconst top = offset + domEv.offsetTop + domEv.offsetHeight;\r\n\r\n\t\tlet node = domEv;\r\n\r\n\t\tif (gantt.utils.dom.isChildOf(node, xViewport)) {\r\n\t\t\twhile (node && node !== xViewport){\r\n\t\t\t\tleft += node.offsetLeft;\r\n\t\t\t\tnode = node.offsetParent;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst scroll = gantt.getScrollState();\r\n\r\n\t\tif(node){\r\n\t\t\tconst dx = (left + domEv.offsetWidth/2) - scroll.x > (xViewport.offsetWidth/2) ? 1 : 0;\r\n\t\t\tconst dy = (top + domEv.offsetHeight/2) - scroll.y > (yViewport.offsetHeight/2) ? 1 : 0;\r\n\r\n\t\t\treturn { left, top, dx, dy, width:domEv.offsetWidth, height:domEv.offsetHeight };\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprivate _createQuickInfoElement() : HTMLElement {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst qi = document.createElement(\"div\");\r\n\t\tqi.className += \"gantt_cal_quick_info\";\r\n\t\tgantt._waiAria.quickInfoAttr(qi);\r\n\r\n\t\t// title\r\n\t\tconst ariaAttr = gantt._waiAria.quickInfoHeaderAttrString();\r\n\t\tvar html = `\r\n\t\t<div class=\"gantt_cal_qi_tcontrols\">\r\n\t\t\t<a class=\"gantt_cal_qi_close_btn dhx_gantt_icon dhx_gantt_icon_close\"></a>\r\n\t\t</div>\r\n\t\t<div class=\"gantt_cal_qi_title\" ${ariaAttr}>\r\n\t\t\t\t\r\n\t\t\t\t<div class=\"gantt_cal_qi_tcontent\"></div>\r\n\t\t\t\t<div class=\"gantt_cal_qi_tdate\"></div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"gantt_cal_qi_content\"></div>`;\r\n\r\n\t\t//buttons\r\n\t\thtml += \"<div class=\\\"gantt_cal_qi_controls\\\">\";\r\n\r\n\t\thtml += \"</div>\";\r\n\r\n\t\tqi.innerHTML = html;\r\n\r\n\r\n\t\tif (gantt.config.quick_info_detached) {\r\n\t\t\tconst container = this._getContainer();\r\n\t\t\tgantt.event(container.parent, \"scroll\", () => { this.hide(); });\r\n\t\t}\r\n\r\n\t\tthis._quickInfoBox = qi;\r\n\t\treturn qi;\r\n\t}\r\n\r\n\tprivate _init_quick_info(id: TaskID) : HTMLElement {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst task = gantt.getTask(id);\r\n\t\t\r\n\r\n\t\tif(typeof this._quickInfoReadonly === \"boolean\"){\r\n\t\t\tif(gantt.isReadonly(task) !== this._quickInfoReadonly){\r\n\t\t\t\tthis.hide(true);\r\n\t\t\t\tthis._quickInfoBox = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._quickInfoReadonly = gantt.isReadonly(task);\r\n\r\n\t\tif (!this._quickInfoBox){\r\n\t\t\tthis._quickInfoBox = this._createQuickInfoElement();\r\n\t\t}\r\n\r\n\t\treturn this._quickInfoBox;\r\n\t}\r\n\r\n\tprivate _prepare_quick_info_classname(id: TaskID) : string {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst task = gantt.getTask(id);\r\n\t\tconst taskType = gantt.getTaskType(task);\r\n\r\n\t\tlet css = `gantt_cal_quick_info gantt_${taskType}`;\r\n\t\tconst template = gantt.templates.quick_info_class(task.start_date, task.end_date, task);\r\n\r\n\t\tif(template){\r\n\t\t\tcss += \" \" + template;\r\n\t\t}\r\n\t\treturn css;\r\n\t}\r\n\r\n\tprivate _fill_quick_data(id: TaskID) : void {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst ev = gantt.getTask(id);\r\n\r\n\t\tthis._quickInfoBoxId = id;\r\n\r\n\t\tlet allowedButtons = [];\r\n\t\tif (this._quickInfoReadonly){\r\n\t\t\tconst buttons = gantt.config.quickinfo_buttons;\r\n\t\t\tconst isEditor = {icon_delete: true, icon_edit: true};\r\n\t\t\tfor (let i = 0; i < buttons.length; i++){\r\n\t\t\t\tif(this._quickInfoReadonly && isEditor[buttons[i]]){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tallowedButtons.push(buttons[i]);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tallowedButtons = gantt.config.quickinfo_buttons;\r\n\t\t}\r\n\r\n\t\tthis.setContent({\r\n\t\t\theader: {\r\n\t\t\t\ttitle: gantt.templates.quick_info_title(ev.start_date, ev.end_date, ev),\r\n\t\t\t\tdate: gantt.templates.quick_info_date(ev.start_date, ev.end_date, ev)\r\n\t\t\t},\r\n\t\t\tcontent: gantt.templates.quick_info_content(ev.start_date, ev.end_date, ev),\r\n\t\t\tbuttons: allowedButtons\r\n\t\t});\r\n\t}\r\n\r\n\tprivate _appendAtCoordinates(x: number, y: number): void {\r\n\t\tconst qi = this._quickInfoBox;\r\n\t\tconst container = this._getContainer();\r\n\t\tif (!qi.parentNode ||\r\n\t\t\tqi.parentNode.nodeName.toLowerCase() === \"#document-fragment\"){ // IE8\r\n\t\t\tcontainer.parent.appendChild(qi);\r\n\t\t}\r\n\r\n\t\tqi.style.left = x + \"px\";\r\n\t\tqi.style.top = y + \"px\";\r\n\t}\r\n\r\n\tprivate _show_quick_info(pos: any, offset: number) : void {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst qi = this._quickInfoBox;\r\n\t\tif (gantt.config.quick_info_detached) {\r\n\t\t\tconst container = this._getContainer();\r\n\t\t\tif (!qi.parentNode ||\r\n\t\t\t\tqi.parentNode.nodeName.toLowerCase() === \"#document-fragment\"){ // IE8\r\n\t\t\t\tcontainer.parent.appendChild(qi);\r\n\t\t\t}\r\n\t\t\tconst width = qi.offsetWidth;\r\n\t\t\tconst popupHeight = qi.offsetHeight;\r\n\r\n\t\t\tconst scrolls = gantt.getScrollState();\r\n\t\t\tconst xViewport = container.xViewport;\r\n\t\t\tconst yViewport = container.yViewport;\r\n\t\t\tconst screenWidth = xViewport.offsetWidth + scrolls.x - width;\r\n\r\n\t\t\tconst relativePopupTop = pos.top - scrolls.y;\r\n\t\t\tconst relativePopupBottom = relativePopupTop + popupHeight;\r\n\r\n\t\t\tlet top = pos.top;\r\n\t\t\tif(relativePopupBottom > yViewport.offsetHeight / 2){\r\n\t\t\t\ttop = pos.top - (popupHeight + pos.height + 2*offset);\r\n\t\t\t\tif(top < scrolls.y && relativePopupBottom <= yViewport.offsetHeight){\r\n\t\t\t\t\ttop = pos.top;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (top < scrolls.y) {\r\n\t\t\t\ttop = scrolls.y;\r\n\t\t\t}\r\n\r\n\t\t\tconst x = Math.min(Math.max(scrolls.x, pos.left - pos.dx*(width - pos.width)), screenWidth);\r\n\t\t\tconst y = top;\r\n\r\n\t\t\tthis._appendAtCoordinates(x, y);\r\n\t\t} else {\r\n\t\t\tqi.style.top = 20 + \"px\";\r\n\t\t\tif (pos.dx === 1){\r\n\t\t\t\tqi.style.right = \"auto\";\r\n\t\t\t\tqi.style.left = \"-300px\";\r\n\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tqi.style.left = \"10px\";\r\n\t\t\t\t},1);\r\n\t\t\t} else {\r\n\t\t\t\tqi.style.left = \"auto\";\r\n\t\t\t\tqi.style.right = \"-300px\";\r\n\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tqi.style.right = \"10px\";\r\n\t\t\t\t},1);\r\n\t\t\t}\r\n\t\t\tqi.className += \" gantt_qi_\"+(pos.dx === 1 ? \"left\" : \"right\");\r\n\t\t\tgantt.$root.appendChild(qi);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _qi_button_click(node: any) : void {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst box = this._quickInfoBox;\r\n\t\tif (!node || node === box){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(node.closest(\".gantt_cal_qi_close_btn\")){\r\n\t\t\tthis.hide();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst mask = node.className;\r\n\t\tif (mask.indexOf(\"_icon\") !== -1){\r\n\t\t\tconst id = this._quickInfoBoxId;\r\n\t\t\tgantt.$click.buttons[mask.split(\" \")[1].replace(\"icon_\",\"\")](id);\r\n\t\t} else {\r\n\t\t\tthis._qi_button_click(node.parentNode);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _getContainer(): IQuickInfoContainer{\r\n\t\tconst gantt = this._gantt;\r\n\t\tlet container = this._container ? this._container : gantt.$task_data;\r\n\t\tif (container && container.offsetHeight && container.offsetWidth) {\r\n\t\t\treturn {\r\n\t\t\t\tparent: container,\r\n\t\t\t\txViewport: gantt.$task,\r\n\t\t\t\tyViewport: gantt.$task_data\r\n\t\t\t};\r\n\t\t}\r\n\t\tcontainer = this._container ? this._container : gantt.$grid_data;\r\n\t\tif (container && container.offsetHeight && container.offsetWidth) {\r\n\t\t\treturn {\r\n\t\t\t\tparent: container,\r\n\t\t\t\txViewport: gantt.$grid,\r\n\t\t\t\tyViewport: gantt.$grid_data\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tparent: this._container ? this._container : gantt.$layout,\r\n\t\t\txViewport: gantt.$layout,\r\n\t\t\tyViewport: gantt.$layout\r\n\t\t};\r\n\t}\r\n}\r\n","import * as utils from \"../../../utils/utils\";\r\n\r\nfunction createScope(addEvent, removeEvent) {\r\n\taddEvent = addEvent || utils.event;\r\n\tremoveEvent = removeEvent || utils.eventRemove;\r\n\r\n\tvar handlers = [];\r\n\r\n\tvar eventScope = {\r\n\t\tattach: function(el, event, callback, capture){\r\n\t\t\thandlers.push({element: el, event:event, callback: callback, capture: capture});\r\n\t\t\taddEvent(el, event, callback, capture);\r\n\t\t},\r\n\t\tdetach: function(el, event, callback, capture){\r\n\t\t\tremoveEvent(el, event, callback, capture);\r\n\t\t\tfor(var i = 0; i < handlers.length; i++){\r\n\t\t\t\tvar handler = handlers[i];\r\n\t\t\t\tif (handler.element === el && handler.event === event && handler.callback === callback && handler.capture === capture) {\r\n\t\t\t\t\thandlers.splice(i, 1);\r\n\t\t\t\t\ti--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tdetachAll: function () {\r\n\t\t\tvar staticArray = handlers.slice();\r\n\t\t\t// original handlers array can be spliced on every iteration\r\n\t\t\tfor (var i = 0; i < staticArray.length; i++){\r\n\t\t\t\tvar handler = staticArray[i];\r\n\t\t\t\teventScope.detach(handler.element, handler.event, handler.callback, handler.capture);\r\n\t\t\t\teventScope.detach(handler.element, handler.event, handler.callback, undefined);\r\n\t\t\t\teventScope.detach(handler.element, handler.event, handler.callback, false);\r\n\t\t\t\teventScope.detach(handler.element, handler.event, handler.callback, true);\r\n\t\t\t}\r\n\t\t\thandlers.splice(0, handlers.length);\r\n\t\t},\r\n\t\textend: function(){\r\n\t\t\treturn createScope(this.event, this.eventRemove);\r\n\t\t}\r\n\t};\r\n\r\n\treturn eventScope;\r\n}\r\n\r\nexport default createScope;","import * as domHelpers from \"../../core/ui/utils/dom_helpers\";\r\n\r\n/* eslint-disable no-restricted-globals */\r\n\r\ninterface IViewPosition{\r\n\ttop: number;\r\n\tleft: number;\r\n}\r\n\r\ninterface IViewBox extends IViewPosition{\r\n\twidth: number;\r\n\theight: number;\r\n\tbottom: number;\r\n\tright: number;\r\n}\r\n\r\nexport class Tooltip {\r\n\tprivate _root: HTMLElement;\r\n\tprivate _tooltipNode: HTMLElement;\r\n\tprivate _gantt: any;\r\n\r\n\tconstructor(gantt: any){\r\n\t\tthis._gantt = gantt;\r\n\t}\r\n\r\n\tgetNode() : HTMLElement {\r\n\t\tconst gantt = this._gantt;\r\n\t\tif (!this._tooltipNode){\r\n\t\t\tthis._tooltipNode = document.createElement(\"div\");\r\n\t\t\tthis._tooltipNode.className = \"gantt_tooltip\";\r\n\t\t\tgantt._waiAria.tooltipAttr(this._tooltipNode);\r\n\t\t}\r\n\t\treturn this._tooltipNode;\r\n\t}\r\n\r\n\tsetViewport(node: HTMLElement):Tooltip{\r\n\t\tthis._root = node;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tshow(left: number, top: number): Tooltip;\r\n\tshow(event: MouseEvent): Tooltip;\r\n\tshow(left: number | MouseEvent, top?: number): Tooltip {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst container = document.body;\r\n\t\tconst node = this.getNode();\r\n\r\n\t\tif(!domHelpers.isChildOf(node, container)){\r\n\t\t\tthis.hide();\r\n\t\t\t// GS-2463. Don't put the node beyond the body coordinates\r\n\t\t\t// as it may trigger the resize event\r\n\t\t\tnode.style.top = node.style.top || \"0px\";\r\n\t\t\tnode.style.left = node.style.left || \"0px\";\r\n\t\t\tcontainer.appendChild(node);\r\n\t\t}\r\n\r\n\t\tif (this._isLikeMouseEvent(left)) {\r\n\t\t\tconst position = this._calculateTooltipPosition(left as MouseEvent);\r\n\t\t\ttop = position.top;\r\n\t\t\tleft = position.left;\r\n\t\t}\r\n\r\n\t\tnode.style.top = top + \"px\";\r\n\t\tnode.style.left = left + \"px\";\r\n\r\n\t\tgantt._waiAria.tooltipVisibleAttr(node);\r\n\t\treturn this;\r\n\t}\r\n\thide() : Tooltip{\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst node = this.getNode();\r\n\t\tif(node && node.parentNode){\r\n\t\t\tnode.parentNode.removeChild(node);\r\n\t\t}\r\n\t\tgantt._waiAria.tooltipHiddenAttr(node);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetContent(html: string) : Tooltip{\r\n\t\tconst node = this.getNode();\r\n\t\tnode.innerHTML = html;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t// it is for salesforce, because it proxies event to it own events\r\n\tprivate _isLikeMouseEvent(event: any): boolean {\r\n\t\tif (!event || typeof event !== \"object\") {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn \"clientX\" in event && \"clientY\" in event;\r\n\t}\r\n\r\n\tprivate _getViewPort() : HTMLElement {\r\n\t\treturn this._root || document.body;\r\n\t}\r\n\r\n\r\n\tprivate _calculateTooltipPosition(event: MouseEvent): IViewPosition{\r\n\t\tconst gantt = this._gantt;\r\n\t\t// top/left coordinates inside the viewport by mouse position\r\n\t\tconst viewport =  this._getViewPortSize();\r\n\t\tconst tooltipNode = this.getNode();\r\n\t\tconst tooltip: IViewBox = {\r\n\t\t\ttop:0,\r\n\t\t\tleft: 0,\r\n\t\t\twidth: tooltipNode.offsetWidth,\r\n\t\t\theight: tooltipNode.offsetHeight,\r\n\t\t\tbottom: 0,\r\n\t\t\tright: 0\r\n\t\t};\r\n\r\n\t\tconst offsetX = gantt.config.tooltip_offset_x;\r\n\t\tconst offsetY = gantt.config.tooltip_offset_y;\r\n\r\n\t\tconst container = document.body;\r\n\t\tconst mouse = domHelpers.getRelativeEventPosition(event, container);\r\n\t\tconst containerPos = domHelpers.getNodePosition(container);\r\n\t\tmouse.y += containerPos.y; // to fix margin collapsing\r\n\r\n\t\ttooltip.top = mouse.y;\r\n\t\ttooltip.left = mouse.x;\r\n\t\ttooltip.top += offsetY;\r\n\t\ttooltip.left += offsetX;\r\n\t\ttooltip.bottom = tooltip.top + tooltip.height;\r\n\t\ttooltip.right = tooltip.left + tooltip.width;\r\n\r\n\t\tconst scrollTop = window.scrollY + container.scrollTop; // to fix margin collapsing\r\n\t\t// edge cases when the tooltip element can be partially hidden by edges of the viewport\r\n\t\tif(tooltip.top < viewport.top - scrollTop){\r\n\t\t\ttooltip.top = viewport.top;\r\n\t\t\ttooltip.bottom = tooltip.top + tooltip.height;\r\n\t\t}else if(tooltip.bottom > viewport.bottom){\r\n\t\t\ttooltip.bottom = viewport.bottom;\r\n\t\t\ttooltip.top = tooltip.bottom - tooltip.height;\r\n\t\t}\r\n\r\n\t\tif(tooltip.left < viewport.left){\r\n\t\t\ttooltip.left = viewport.left;\r\n\t\t\ttooltip.right = viewport.left + tooltip.width;\r\n\t\t}else if(tooltip.right > viewport.right){\r\n\t\t\ttooltip.right = viewport.right;\r\n\t\t\ttooltip.left = tooltip.right - tooltip.width;\r\n\t\t}\r\n\r\n\t\tif(mouse.x >= tooltip.left && mouse.x <= tooltip.right) {\r\n\t\t\ttooltip.left = mouse.x - tooltip.width - offsetX;\r\n\t\t\ttooltip.right = tooltip.left + tooltip.width;\r\n\t\t}\r\n\r\n\t\tif(mouse.y >= tooltip.top && mouse.y <= tooltip.bottom) {\r\n\t\t\ttooltip.top = mouse.y - tooltip.height - offsetY;\r\n\t\t\ttooltip.bottom = tooltip.top + tooltip.height;\r\n\t\t}\r\n\r\n\t\t// GS-2827: when tooltip width too long\r\n\t\tif(tooltip.left < 0){\r\n\t\t\ttooltip.left = 0;\r\n\t\t}\r\n\t\tif(tooltip.right < 0){\r\n\t\t\ttooltip.right = 0;\r\n\t\t}\r\n\r\n\t\treturn tooltip;\r\n\t}\r\n\r\n\tprivate _getViewPortSize() : IViewBox {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst container = this._getViewPort();\r\n\t\tlet viewport = container;\r\n\t\tlet scrollTop = window.scrollY + document.body.scrollTop;\r\n\t\tlet scrollLeft = window.scrollX + document.body.scrollLeft;\r\n\t\tlet pos;\r\n\t\t// support for the initial tooltip mode where the tooltip element was attached to the data area of gantt\r\n\t\tif(container === gantt.$task_data){\r\n\t\t\tviewport = gantt.$task;\r\n\t\t\tscrollTop = 0;\r\n\t\t\tscrollLeft = 0;\r\n\t\t\tpos = domHelpers.getNodePosition(gantt.$task);\r\n\t\t}else{\r\n\t\t\tpos = domHelpers.getNodePosition(viewport);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tleft:pos.x + scrollLeft,\r\n\t\t\ttop: pos.y + scrollTop,\r\n\t\t\twidth: pos.width,\r\n\t\t\theight: pos.height,\r\n\t\t\tbottom: pos.y + pos.height + scrollTop,\r\n\t\t\tright: pos.x + pos.width + scrollLeft\r\n\t\t};\r\n\t}\r\n}\r\n","import domEventsScope from \"../../core/ui/utils/dom_event_scope\";\r\nimport * as domHelpers from \"../../core/ui/utils/dom_helpers\";\r\nimport * as helpers from \"../../utils/helpers\";\r\nimport { Tooltip } from \"./tooltip\";\r\n\r\ninterface ITrackerTarget {\r\n\tselector: string;\r\n\tonmouseenter: (event: MouseEvent, node: HTMLElement) => void;\r\n\tonmousemove: (event: MouseEvent, node: HTMLElement) => void;\r\n\tonmouseleave: (event: MouseEvent, node: HTMLElement) => void;\r\n\tglobal: boolean;\r\n}\r\n\r\ninterface ITooltipConfig {\r\n\tselector: string;\r\n\thtml: (event: MouseEvent, node: HTMLElement) => string;\r\n\tglobal: boolean;\r\n}\r\n\r\nexport class TooltipManager{\r\n\ttooltip: Tooltip;\r\n\tprotected _domEvents: any;\r\n\tprivate _listeners: object = {};\r\n\tprivate _gantt: any;\r\n\tprivate delayShow: any;\r\n\tprivate delayHide: any;\r\n\r\n\tconstructor(gantt: any) {\r\n\t\tthis.tooltip = new Tooltip(gantt);\r\n\t\tthis._gantt = gantt;\r\n\t\tthis._domEvents = domEventsScope();\r\n\t\tthis._initDelayedFunctions();\r\n\t}\r\n\r\n\tdestructor(): void{\r\n\t\tthis.tooltip.hide();\r\n\t\tthis._domEvents.detachAll();\r\n\t}\r\n\thideTooltip(): void{\r\n\t\tthis.delayHide();\r\n\t}\r\n\tattach(config: ITrackerTarget): void {\r\n\t\tlet root = document.body;\r\n\t\tconst gantt = this._gantt;\r\n\t\tif(!config.global){\r\n\t\t\troot = gantt.$root;\r\n\t\t}\r\n\r\n\t\tlet watchableTarget = null;\r\n\t\tconst handler = (event) => {\r\n\t\t\tconst eventTarget = domHelpers.getTargetNode(event);\r\n\t\t\tconst targetNode = domHelpers.closest(eventTarget, config.selector);\r\n\t\t\tif(domHelpers.isChildOf(eventTarget, this.tooltip.getNode())){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst doOnMouseEnter = () => {\r\n\t\t\t\twatchableTarget = targetNode;\r\n\t\t\t\tconfig.onmouseenter(event, targetNode);\r\n\t\t\t};\r\n\r\n\t\t\tif(watchableTarget){\r\n\t\t\t\tif(targetNode && targetNode === watchableTarget){\r\n\t\t\t\t\tconfig.onmousemove(event, targetNode);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tconfig.onmouseleave(event, watchableTarget);\r\n\t\t\t\t\twatchableTarget = null;\r\n\r\n\t\t\t\t\tif(targetNode && targetNode !== watchableTarget){\r\n\t\t\t\t\t\tdoOnMouseEnter();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tif(targetNode){\r\n\t\t\t\t\tdoOnMouseEnter();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.detach(config.selector);\r\n\t\tthis._domEvents.attach(root, \"mousemove\", handler);\r\n\t\tthis._listeners[config.selector] = {\r\n\t\t\tnode: root,\r\n\t\t\thandler\r\n\t\t};\r\n\t}\r\n\r\n\tdetach(selector: string): void {\r\n\t\tconst listener = this._listeners[selector];\r\n\t\tif(listener){\r\n\t\t\tthis._domEvents.detach(listener.node, \"mousemove\", listener.handler);\r\n\t\t}\r\n\t}\r\n\r\n\ttooltipFor(config: ITooltipConfig): void {\r\n\t\tconst cloneDomEvent = (event: MouseEvent) => {\r\n\t\t\tlet clone = event;\r\n\t\t\t// making events survive timeout in ie\r\n\t\t\t// tslint:disable-next-line no-string-literal\r\n\t\t\tif(document[\"createEventObject\"] && !document.createEvent){\r\n\t\t\t\t// tslint:disable-next-line no-string-literal\r\n\t\t\t\tclone = document[\"createEventObject\"](event);\r\n\t\t\t}\r\n\t\t\treturn clone;\r\n\t\t};\r\n\t\tthis._initDelayedFunctions();\r\n\t\tthis.attach({\r\n\t\t\tselector: config.selector,\r\n\t\t\tglobal: config.global,\r\n\t\t\tonmouseenter:(event: MouseEvent, node: HTMLElement) => {\r\n\t\t\t\tconst html = config.html(event, node);\r\n\t\t\t\tif(html){\r\n\t\t\t\t\tthis.delayShow(cloneDomEvent(event), html);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonmousemove:(event: MouseEvent, node: HTMLElement) => {\r\n\t\t\t\tconst html = config.html(event, node);\r\n\t\t\t\tif(html){\r\n\t\t\t\t\tthis.delayShow(cloneDomEvent(event), html);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.delayShow.$cancelTimeout();\r\n\t\t\t\t\tthis.delayHide();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonmouseleave:() => {\r\n\t\t\t\tthis.delayShow.$cancelTimeout();\r\n\t\t\t\tthis.delayHide();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprivate _initDelayedFunctions(){\r\n\t\tconst gantt = this._gantt;\r\n\t\t// reset delayed functions in order to apply current values of tooltip_timeout\r\n\t\tif(this.delayShow){\r\n\t\t\tthis.delayShow.$cancelTimeout();\r\n\t\t}\r\n\t\tif(this.delayHide){\r\n\t\t\tthis.delayHide.$cancelTimeout();\r\n\t\t}\r\n\t\tthis.tooltip.hide();\r\n\r\n\t\tthis.delayShow = helpers.delay((event: MouseEvent, html: string) => {\r\n\t\t\tif(gantt.callEvent(\"onBeforeTooltip\", [event]) === false) {\r\n\t\t\t\tthis.tooltip.hide();\r\n\t\t\t} else {\r\n\t\t\t\tthis.tooltip.setContent(html);\r\n\t\t\t\tthis.tooltip.show(event);\r\n\t\t\t}\r\n\t\t}, gantt.config.tooltip_timeout || 1);\r\n\r\n\t\tthis.delayHide = helpers.delay(() => {\r\n\t\t\tthis.delayShow.$cancelTimeout();\r\n\t\t\tthis.tooltip.hide();\r\n\t\t}, gantt.config.tooltip_hide_timeout || 1);\r\n\t}\r\n\r\n}","import { IInlineEditState, IMonitor, IUndo, IUndoCommand, TActionType, TEntityType, TUndoValue } from \"./types\";\r\n\r\nconst noTrack = {\r\n\tonBeforeUndo: \"onAfterUndo\",\r\n\tonBeforeRedo: \"onAfterRedo\"\r\n};\r\n\r\nconst batchActions = [\r\n\t\"onTaskDragStart\",\r\n\t\"onAfterTaskUpdate\",\r\n\t\"onAfterParentExpand\",\r\n\t\"onAfterTaskDelete\",\r\n\t\"onBeforeBatchUpdate\"\r\n];\r\n\r\nexport class Monitor implements IMonitor {\r\n\tprivate _batchAction = null;\r\n\tprivate _batchMode = false;\r\n\tprivate _ignore = false;\r\n\tprivate _ignoreMoveEvents = false;\r\n\tprivate _initialTasks = {};\r\n\tprivate _initialLinks = {};\r\n\tprivate _nestedTasks =  {};\r\n\tprivate _nestedLinks = {};\r\n\tprivate _timeout;\r\n\tprivate _gantt: any;\r\n\tprivate _undo: IUndo;\r\n\r\n\tconstructor(undo: IUndo, gantt: any) {\r\n\t\tthis._undo = undo;\r\n\t\tthis._gantt = gantt;\r\n\t\tthis._attachEvents();\r\n\t}\r\n\r\n\tstore(id: TaskID | LinkID, type: TEntityType, overwrite: boolean = false) {\r\n\t\tif (type === this._gantt.config.undo_types.task) {\r\n\t\t\treturn this._storeTask(id, overwrite);\r\n\t\t}\r\n\t\tif (type === this._gantt.config.undo_types.link) {\r\n\t\t\treturn this._storeLink(id, overwrite);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tisMoveEventsIgnored() {\r\n\t\treturn this._ignoreMoveEvents;\r\n\t}\r\n\ttoggleIgnoreMoveEvents(newValue?: boolean) {\r\n\t\tthis._ignoreMoveEvents = newValue || false;\r\n\t}\r\n\tstartIgnore() {\r\n\t\tthis._ignore = true;\r\n\t}\r\n\tstopIgnore() {\r\n\t\tthis._ignore = false;\r\n\t}\r\n\tstartBatchAction() {\r\n\t\t// try catching updates made from event handlers using timeout\r\n\t\tif (!this._timeout){\r\n\t\t\tthis._timeout = setTimeout(() => {\r\n\t\t\t\tthis.stopBatchAction();\r\n\t\t\t\tthis._timeout = null;\r\n\t\t\t}, 10);\r\n\t\t}\r\n\r\n\r\n\t\tif (this._ignore || this._batchMode) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._batchMode = true;\r\n\t\tthis._batchAction = this._undo.action.create();\r\n\t}\r\n\tstopBatchAction() {\r\n\t\tif (this._ignore) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst undo = this._undo;\r\n\t\tif (this._batchAction) {\r\n\t\t\tundo.logAction(this._batchAction);\r\n\t\t}\r\n\t\tthis._batchMode = false;\r\n\t\tthis._batchAction = null;\r\n\t}\r\n\tonTaskAdded(task: ITask) {\r\n\t\tif (!this._ignore) {\r\n\t\t\tthis._storeTaskCommand(task, this._undo.command.type.add);\r\n\t\t}\r\n\t}\r\n\tonTaskUpdated(task: ITask) {\r\n\t\tif (!this._ignore) {\r\n\t\t\tthis._storeTaskCommand(task, this._undo.command.type.update);\r\n\t\t}\r\n\t}\r\n\tonTaskMoved(task: ITask) {\r\n\t\tif (!this._ignore) {\r\n\t\t\t(task as any).$local_index = this._gantt.getTaskIndex(task.id);\r\n\t\t\tthis._storeEntityCommand(\r\n\t\t\t\ttask,\r\n\t\t\t\tthis.getInitialTask(task.id),\r\n\t\t\t\tthis._undo.command.type.move,\r\n\t\t\t\tthis._undo.command.entity.task\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\tonTaskDeleted(task: ITask) {\r\n\t\tif (!this._ignore) {\r\n\t\t\tthis._storeTaskCommand(task, this._undo.command.type.remove);\r\n\t\t\tif (this._nestedTasks[task.id]) {\r\n\t\t\t\tconst children = this._nestedTasks[task.id];\r\n\t\t\t\tfor (let i = 0; i < children.length; i++) {\r\n\t\t\t\t\tthis._storeTaskCommand(children[i], this._undo.command.type.remove);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this._nestedLinks[task.id]) {\r\n\t\t\t\tconst childrenLinks = this._nestedLinks[task.id];\r\n\t\t\t\tfor (let i = 0; i < childrenLinks.length; i++) {\r\n\t\t\t\t\tthis._storeLinkCommand(childrenLinks[i], this._undo.command.type.remove);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tonLinkAdded(link: ILink) {\r\n\t\tif (!this._ignore) {\r\n\t\t\tthis._storeLinkCommand(link, this._undo.command.type.add);\r\n\t\t}\r\n\t}\r\n\tonLinkUpdated(link: ILink) {\r\n\t\tif (!this._ignore) {\r\n\t\t\tthis._storeLinkCommand(link, this._undo.command.type.update);\r\n\t\t}\r\n\t}\r\n\tonLinkDeleted(link: ILink) {\r\n\t\tif (!this._ignore) {\r\n\t\t\tthis._storeLinkCommand(link, this._undo.command.type.remove);\r\n\t\t}\r\n\t}\r\n\tsetNestedTasks(id: TaskID, taskIds: TaskID[]) {\r\n\t\tconst gantt = this._gantt;\r\n\t\tlet task = null;\r\n\t\tconst tasks = [];\r\n\t\tlet\tlinkIds = this._getLinks(gantt.getTask(id));\r\n\r\n\t\tfor (let i = 0; i < taskIds.length; i++) {\r\n\t\t\ttask = this.setInitialTask(taskIds[i]);\r\n\t\t\tlinkIds = linkIds.concat(this._getLinks(task));\r\n\t\t\ttasks.push(task);\r\n\t\t}\r\n\r\n\t\tconst uniqueLinks = {};\r\n\t\tfor (let i = 0; i < linkIds.length; i++) {\r\n\t\t\tuniqueLinks[linkIds[i]] = true;\r\n\t\t}\r\n\t\tconst links = [];\r\n\t\tfor (const i in uniqueLinks) {\r\n\t\t\tlinks.push(this.setInitialLink(i));\r\n\t\t}\r\n\t\tthis._nestedTasks[id] = tasks;\r\n\t\tthis._nestedLinks[id] = links;\r\n\t}\r\n\tsetInitialTask(id: TaskID, overwrite?: boolean) {\r\n\t\tconst gantt = this._gantt;\r\n\t\tif (overwrite || (!this._initialTasks[id] || !this._batchMode)) {\r\n\t\t\tconst task = gantt.copy(gantt.getTask(id));\r\n\t\t\ttask.$index = gantt.getGlobalTaskIndex(id);\r\n\t\t\ttask.$local_index = gantt.getTaskIndex(id);\r\n\t\t\tthis.setInitialTaskObject(id, task);\r\n\t\t}\r\n\t\treturn this._initialTasks[id];\r\n\t}\r\n\tgetInitialTask(id: TaskID) {\r\n\t\treturn this._initialTasks[id];\r\n\t}\r\n\tclearInitialTasks() {\r\n\t\tthis._initialTasks = {};\r\n\t}\r\n\tsetInitialTaskObject(id: TaskID, object: ITask) {\r\n\t\tthis._initialTasks[id] = object;\r\n\t}\r\n\tsetInitialLink(id: LinkID, overwrite?: boolean) {\r\n\t\tif (!this._initialLinks[id] || !this._batchMode) {\r\n\t\t\tthis._initialLinks[id] = this._gantt.copy(this._gantt.getLink(id));\r\n\t\t}\r\n\t\treturn this._initialLinks[id];\r\n\t}\r\n\tgetInitialLink(id: LinkID) {\r\n\t\treturn this._initialLinks[id];\r\n\t}\r\n\tclearInitialLinks() {\r\n\t\tthis._initialLinks = {};\r\n\t}\r\n\tprivate _attachEvents() {\r\n\t\tlet deleteCacheCooldown = null;\r\n\t\tconst gantt = this._gantt;\r\n\r\n\t\tconst saveInitialAll = () => {\r\n\t\t\tif (!deleteCacheCooldown) {\r\n\t\t\t\tdeleteCacheCooldown = setTimeout(() => {\r\n\t\t\t\t\tdeleteCacheCooldown = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.clearInitialTasks();\r\n\t\t\t\tgantt.eachTask((task: ITask) => {\r\n\t\t\t\t\tthis.setInitialTask(task.id);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.clearInitialLinks();\r\n\t\t\t\tgantt.getLinks().forEach((link: ILink) => {\r\n\t\t\t\t\tthis.setInitialLink(link.id);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t\tconst getMoveObjectByTaskId = (id: TaskID) => {\r\n\t\t\treturn gantt.copy(gantt.getTask(id));\r\n\t\t};\r\n\r\n\t\tfor (const i in noTrack) {\r\n\t\t\tgantt.attachEvent(i, () => {\r\n\t\t\t\tthis.startIgnore();\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t\tgantt.attachEvent(noTrack[i], () => {\r\n\t\t\t\tthis.stopIgnore();\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfor (let i  = 0; i < batchActions.length; i++) {\r\n\t\t\tgantt.attachEvent(batchActions[i], () => {\r\n\t\t\t\tthis.startBatchAction();\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tgantt.attachEvent(\"onParse\", () => {\r\n\t\t\tthis._undo.clearUndoStack();\r\n\t\t\tthis._undo.clearRedoStack();\r\n\t\t\tsaveInitialAll();\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterTaskAdd\", (id: TaskID, task: ITask) => {\r\n\t\t\tthis.setInitialTask(id, true);\r\n\t\t\tthis.onTaskAdded(task);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterTaskUpdate\", (id: TaskID, task: ITask) => {\r\n\t\t\tthis.onTaskUpdated(task);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterParentExpand\", (id: TaskID, task: ITask) => {\r\n\t\t\tthis.onTaskUpdated(task);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterTaskDelete\", (id: TaskID, task: ITask) => {\r\n\t\t\tthis.onTaskDeleted(task);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterLinkAdd\", (id: LinkID, link: ILink) => {\r\n\t\t\tthis.setInitialLink(id, true);\r\n\t\t\tthis.onLinkAdded(link);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterLinkUpdate\", (id: LinkID, link: ILink) => {\r\n\t\t\tthis.onLinkUpdated(link);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterLinkDelete\", (id: LinkID, link: ILink) => {\r\n\t\t\tthis.onLinkDeleted(link);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onRowDragEnd\", (id: TaskID, target: TaskID) => {\r\n\t\t\tthis.onTaskMoved(getMoveObjectByTaskId(id));\r\n\t\t\tthis.toggleIgnoreMoveEvents();\r\n\t\t\treturn true;\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onBeforeTaskDelete\", (id: TaskID) => {\r\n\t\t\tthis.store(id, gantt.config.undo_types.task);\r\n\t\t\tconst nested = [];\r\n\r\n\t\t\t// remember task indexes in case their being deleted in a loop, so they could be restored in the correct order\r\n\t\t\tsaveInitialAll();\r\n\r\n\t\t\tgantt.eachTask((task: ITask) => {\r\n\t\t\t\tnested.push(task.id);\r\n\t\t\t}, id);\r\n\t\t\tthis.setNestedTasks(id, nested);\r\n\t\t\treturn true;\r\n\t\t});\r\n\t\tconst datastore = gantt.getDatastore(\"task\");\r\n\r\n\t\tdatastore.attachEvent(\"onBeforeItemMove\", (id: TaskID, parent: TaskID, tindex: number) => {\r\n\t\t\tif (!this.isMoveEventsIgnored()) {\r\n\t\t\t\tsaveInitialAll();\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tdatastore.attachEvent(\"onAfterItemMove\", (id: TaskID, parent: TaskID, tindex: number) => {\r\n\t\t\tif (!this.isMoveEventsIgnored()) {\r\n\t\t\t\tthis.onTaskMoved(getMoveObjectByTaskId(id));\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onRowDragStart\", (id: TaskID, target: TaskID, e: Event) => {\r\n\t\t\tthis.toggleIgnoreMoveEvents(true);\r\n\t\t\tsaveInitialAll();\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tlet dragId = null;\r\n\t\tlet projectDrag = false;\r\n\t\tgantt.attachEvent(\"onBeforeTaskDrag\", (taskId: TaskID) => {\r\n\t\t\tdragId = gantt.getState().drag_id;\r\n\t\t\tif (dragId === taskId){\r\n\t\t\t\tconst task = gantt.getTask(taskId);\r\n\t\t\t\tif (gantt.isSummaryTask(task) && gantt.config.drag_project){\r\n\t\t\t\t\tprojectDrag = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// GS-99. Store the initial task dates before multiple drag\r\n\t\t\tif (gantt.plugins().multiselect){\r\n\t\t\t\tconst selectedIds = gantt.getSelectedTasks();\r\n\t\t\t\tif (selectedIds.length > 1){\r\n\t\t\t\t\tselectedIds.forEach((id)=>{\r\n\t\t\t\t\t\tthis.store(id, gantt.config.undo_types.task, true);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this.store(taskId, gantt.config.undo_types.task);\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onAfterTaskDrag\", (taskId: TaskID) => {\r\n\t\t\t// if we drag multiple tasks and other tasks move to another date after that,\r\n\t\t\t// auto-scheduling/correct work time should occur in anoher command.\r\n\t\t\t// otherwise, when we undo the changes, the task constraint is not restored correctly\r\n\t\t\tconst multipleDrag = projectDrag || (gantt.plugins().multiselect && gantt.getSelectedTasks().length > 1);\r\n\t\t\tif (multipleDrag && dragId === taskId){\r\n\t\t\t\tprojectDrag = false;\r\n\t\t\t\tdragId = null;\r\n\t\t\t\tthis.stopBatchAction();\r\n\t\t\t}\r\n\t\t\t// GS-99. When dragging multiple tasks, we need to store the initial tasks\r\n\t\t\tthis.store(taskId, gantt.config.undo_types.task, true);\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onLightbox\", (taskId: TaskID) => this.store(taskId, gantt.config.undo_types.task));\r\n\r\n\t\tgantt.attachEvent(\"onBeforeTaskAutoSchedule\", (task: ITask) => {\r\n\t\t\tthis.store(task.id, gantt.config.undo_types.task, true);\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tif (gantt.ext.inlineEditors) {\r\n\t\t\t// remove the onGanttLayoutReady wrapper when GS-1288 is merged\r\n\t\t\tlet onBeforeEditStartId = null;\r\n\t\t\tlet onEditStart = null;\r\n\t\t\tgantt.attachEvent(\"onGanttLayoutReady\", () => {\r\n\t\t\t\tif (onBeforeEditStartId) {\r\n\t\t\t\t\tgantt.ext.inlineEditors.detachEvent(onBeforeEditStartId);\r\n\t\t\t\t}\r\n\t\t\t\tif (onEditStart) {\r\n\t\t\t\t\tgantt.ext.inlineEditors.detachEvent(onEditStart);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tonEditStart = gantt.ext.inlineEditors.attachEvent(\"onEditStart\", (state: IInlineEditState) => {\r\n\t\t\t\t\t// GS-2598: skip saving changes of resource lightbox grid\r\n\t\t\t\t\tif(gantt.$data.tempAssignmentsStore && gantt._lightbox_id){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.store(state.id, gantt.config.undo_types.task);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// GS-99. If another inline editor is opened and we open a new inline editor,\r\n\t\t\t\t// we shouldn't use the batchAction\r\n\t\t\t\tonBeforeEditStartId = gantt.ext.inlineEditors.attachEvent(\"onBeforeEditStart\", (state: IInlineEditState) => {\r\n\t\t\t\t\tthis.stopBatchAction();\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _storeCommand(command: IUndoCommand) {\r\n\t\tconst undo = this._undo;\r\n\t\tundo.updateConfigs();\r\n\r\n\t\tif (!undo.undoEnabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this._batchMode) {\r\n\t\t\tthis._batchAction.commands.push(command);\r\n\t\t} else {\r\n\t\t\tconst action = undo.action.create([command]);\r\n\t\t\tundo.logAction(action);\r\n\t\t}\r\n\t}\r\n\tprivate _storeEntityCommand(obj: TUndoValue, old: TUndoValue, actionType: TActionType, entityType: TEntityType) {\r\n\t\tconst undo = this._undo;\r\n\t\tconst command = undo.command.create(obj, old, actionType, entityType);\r\n\t\tthis._storeCommand(command);\r\n\t}\r\n\tprivate _storeTaskCommand(obj: ITask, type: TActionType) {\r\n\t\tif(this._gantt.isTaskExists(obj.id)){\r\n\t\t\t(obj as any).$local_index = this._gantt.getTaskIndex(obj.id);\r\n\t\t}\r\n\r\n\t\tthis._storeEntityCommand(obj, this.getInitialTask(obj.id), type, this._undo.command.entity.task);\r\n\t}\r\n\tprivate _storeLinkCommand(obj: ILink, type: TActionType) {\r\n\t\tthis._storeEntityCommand(obj, this.getInitialLink(obj.id), type, this._undo.command.entity.link);\r\n\t}\r\n\tprivate _getLinks(task: ITask) {\r\n\t\treturn task.$source.concat(task.$target);\r\n\t}\r\n\tprivate _storeTask(taskId: TaskID, overwrite: boolean = false) {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis.setInitialTask(taskId, overwrite);\r\n\t\tgantt.eachTask((child: ITask) => {\r\n\t\t\tthis.setInitialTask(child.id);\r\n\t\t}, taskId);\r\n\t\treturn true;\r\n\t}\r\n\tprivate _storeLink(linkId: LinkID, overwrite: boolean = false) {\r\n\t\tthis.setInitialLink(linkId, overwrite);\r\n\t\treturn true;\r\n\t}\r\n}","import { IUndo, IUndoCommand, IUndoCommands, IUndoPropAction, IUndoPropCommand, TActionType, TEntityType, TUndoStack, TUndoValue } from \"./types\";\r\n\r\nconst MAX_UNDO_STEPS = 100;\r\n\r\nexport class Undo implements IUndo {\r\n\r\n\tmaxSteps = MAX_UNDO_STEPS;\r\n\tundoEnabled = true;\r\n\tredoEnabled = true;\r\n\taction: IUndoPropAction = {\r\n\t\tcreate: (commands?: IUndoCommand[]): IUndoCommands => {\r\n\t\t\treturn { commands: (commands ? commands.slice() : []) };\r\n\t\t},\r\n\t\tinvert: (action: IUndoCommands): IUndoCommands => {\r\n\t\t\tconst gantt = this._gantt;\r\n\t\t\tconst revert = gantt.copy(action);\r\n\t\t\tconst commands = this.command;\r\n\t\t\tfor (let i = 0; i < action.commands.length; i++) {\r\n\t\t\t\tconst command = revert.commands[i] = commands.invert(revert.commands[i]);\r\n\t\t\t\tif (command.type === commands.type.update || command.type === commands.type.move) {\r\n\t\t\t\t\t[command.value, command.oldValue] = [command.oldValue, command.value];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn revert as IUndoCommands;\r\n\t\t}\r\n\t};\r\n\tcommand: IUndoPropCommand = {\r\n\t\t// entities that require different processing for undoing-redoing changes (gantt.config.undo_types)\r\n\t\tentity: null,\r\n\r\n\t\t// types of traced actions (gantt.config.undo_actions)\r\n\t\ttype: null,\r\n\r\n\t\tcreate: (value: TUndoValue, oldValue: TUndoValue, type: TActionType, entity: TEntityType): IUndoCommand => {\r\n\t\t\tconst gantt = this._gantt;\r\n\t\t\treturn {\r\n\t\t\t\tentity,\r\n\t\t\t\ttype,\r\n\t\t\t\tvalue: gantt.copy(value),\r\n\t\t\t\toldValue: gantt.copy(oldValue || value)\r\n\t\t\t};\r\n\t\t},\r\n\t\tinvert: (command: IUndoCommand): IUndoCommand => {\r\n\t\t\tconst gantt = this._gantt;\r\n\t\t\tconst revert = gantt.copy(command);\r\n\t\t\trevert.type = this.command.inverseCommands(command.type);\r\n\t\t\treturn revert;\r\n\t\t},\r\n\t\tinverseCommands: (command: TActionType): TActionType => {\r\n\t\t\tconst gantt = this._gantt;\r\n\t\t\tconst types = this.command.type;\r\n\t\t\tswitch (command) {\r\n\t\t\t\tcase types.update:\r\n\t\t\t\t\treturn types.update;\r\n\t\t\t\tcase types.remove:\r\n\t\t\t\t\treturn types.add;\r\n\t\t\t\tcase types.add:\r\n\t\t\t\t\treturn types.remove;\r\n\t\t\t\tcase types.move:\r\n\t\t\t\t\treturn types.move;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tgantt.assert(false, \"Invalid command \"+ command);\r\n\t\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tprivate _undoStack = [];\r\n\tprivate _redoStack = [];\r\n\tprivate _gantt: any;\r\n\r\n\tconstructor(gantt: any){\r\n\t\tthis._gantt = gantt;\r\n\t}\r\n\tgetUndoStack() {\r\n\t\treturn this._undoStack;\r\n\t}\r\n\tsetUndoStack(stack: []) {\r\n\t\tthis._undoStack = stack;\r\n\t}\r\n\r\n\tgetRedoStack() {\r\n\t\treturn this._redoStack;\r\n\t}\r\n\tsetRedoStack(stack: []) {\r\n\t\tthis._redoStack = stack;\r\n\t}\r\n\r\n\tclearUndoStack() {\r\n\t\tthis._undoStack = [];\r\n\t}\r\n\r\n\tclearRedoStack() {\r\n\t\tthis._redoStack = [];\r\n\t}\r\n\r\n\tupdateConfigs() {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis.maxSteps = gantt.config.undo_steps || MAX_UNDO_STEPS;\r\n\t\tthis.command.entity = gantt.config.undo_types;\r\n\t\tthis.command.type = gantt.config.undo_actions;\r\n\t\tthis.undoEnabled = !!gantt.config.undo;\r\n\t\tthis.redoEnabled = !!gantt.config.redo; // GS-873, Redo should work even when the `gantt.config.undo` is disabled.\r\n\t}\r\n\r\n\tundo() {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis.updateConfigs();\r\n\t\tif (!this.undoEnabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst action = this._pop(this._undoStack);\r\n\t\tif (action) {\r\n\t\t\tthis._reorderCommands(action);\r\n\t\t}\r\n\t\tif (gantt.callEvent(\"onBeforeUndo\", [action]) !== false) {\r\n\t\t\tif (action) {\r\n\t\t\t\tthis._applyAction(this.action.invert(action));\r\n\t\t\t\tthis._push(this._redoStack, gantt.copy(action));\r\n\t\t\t\tgantt.callEvent(\"onAfterUndo\", [action]);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tgantt.callEvent(\"onAfterUndo\", [null]);\r\n\t}\r\n\r\n\tredo() {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis.updateConfigs();\r\n\t\tif (!this.redoEnabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst action = this._pop(this._redoStack);\r\n\t\tif (action) {\r\n\t\t\tthis._reorderCommands(action);\r\n\t\t}\r\n\r\n\t\tif (gantt.callEvent(\"onBeforeRedo\", [action]) !== false) {\r\n\t\t\tif (action) {\r\n\t\t\t\tthis._applyAction(action);\r\n\t\t\t\tthis._push(this._undoStack, gantt.copy(action));\r\n\t\t\t\tgantt.callEvent(\"onAfterRedo\", [action]);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tgantt.callEvent(\"onAfterRedo\", [null]);\r\n\t}\r\n\r\n\t// storeUndo:\r\n\tlogAction(action: IUndoCommands) {\r\n\t\tthis._push(this._undoStack, action);\r\n\t\tthis._redoStack = [];\r\n\t}\r\n\r\n\tprivate _push(stack: TUndoStack, action: IUndoCommands): IUndoCommands {\r\n\t\tconst gantt = this._gantt;\r\n\t\tif (!action.commands.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst event = stack === this._undoStack ? \"onBeforeUndoStack\" : \"onBeforeRedoStack\";\r\n\t\tif (gantt.callEvent(event, [action]) === false){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// commands can be removed from event handler\r\n\t\tif (!action.commands.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tstack.push(action);\r\n\t\twhile (stack.length > this.maxSteps) {\r\n\t\t\tstack.shift();\r\n\t\t}\r\n\t\treturn action;\r\n\t}\r\n\r\n\tprivate _pop(stack: TUndoStack): IUndoCommands {\r\n\t\treturn stack.pop();\r\n\t}\r\n\r\n\tprivate _reorderCommands(action) {\r\n\t\t// firstly process tasks and only then links\r\n\t\t// in order to ensure links are added not earlier than their tasks\r\n\t\t// firstly to 'move' actions and only then updates\r\n\t\tconst weights = { any: 0, link:1, task:2 };\r\n\t\tconst actionWeights = { move: 1, any:0 };\r\n\t\taction.commands.sort(function(a, b) {\r\n\t\t\tif (a.entity === \"task\" && b.entity === \"task\") {\r\n\t\t\t\tif (a.type !== b.type) {\r\n\t\t\t\t\treturn (actionWeights[b.type] || 0) - (actionWeights[a.type] || 0);\r\n\t\t\t\t} else if (a.type === \"move\" && a.oldValue && b.oldValue && b.oldValue.parent === a.oldValue.parent) {\r\n\t\t\t\t\treturn a.oldValue.$index - b.oldValue.$index;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst weightA = weights[a.entity] || weights.any;\r\n\t\t\t\tconst weightB = weights[b.entity] || weights.any;\r\n\t\t\t\treturn weightB - weightA;\r\n\t\t\t}\r\n\r\n\t\t});\r\n\t}\r\n\r\n\tprivate _applyAction(action: IUndoCommands) {\r\n\t\tlet command = null;\r\n\t\tconst entities = this.command.entity;\r\n\t\tconst actions = this.command.type;\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst methods = {};\r\n\t\tmethods[entities.task] = {\r\n\t\t\tadd: \"addTask\",\r\n\t\t\tget: \"getTask\",\r\n\t\t\tupdate: \"updateTask\",\r\n\t\t\tremove: \"deleteTask\",\r\n\t\t\tmove: \"moveTask\",\r\n\t\t\tisExists: \"isTaskExists\"\r\n\t\t};\r\n\t\tmethods[entities.link] = {\r\n\t\t\tadd: \"addLink\",\r\n\t\t\tget: \"getLink\",\r\n\t\t\tupdate: \"updateLink\",\r\n\t\t\tremove: \"deleteLink\",\r\n\t\t\tisExists: \"isLinkExists\"\r\n\t\t};\r\n\r\n\t\tgantt.batchUpdate(function() {\r\n\t\t\t// it is logical to undo actions from the last one to the first one\r\n\t\t\t// but we have to do it from the first one because the order\r\n\t\t\t// of tasks ($index and $local_index) depends on the existing tasks\r\n\t\t\tfor (let i = 0; i < action.commands.length; i++) {\r\n\t\t\t\tcommand = action.commands[i];\r\n\t\t\t\tconst method = methods[command.entity][command.type];\r\n\t\t\t\tconst getMethod = methods[command.entity].get;\r\n\t\t\t\tconst check = methods[command.entity].isExists;\r\n\r\n\t\t\t\tif (command.type === actions.add) {\r\n\t\t\t\t\tgantt[method](command.oldValue, command.oldValue.parent, command.oldValue.$local_index);\r\n\t\t\t\t} else if (command.type === actions.remove) {\r\n\t\t\t\t\tif (gantt[check](command.value.id)) {\r\n\t\t\t\t\t\tgantt[method](command.value.id);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command.type === actions.update) {\r\n\t\t\t\t\tconst item = gantt[getMethod](command.value.id);\r\n\t\t\t\t\tfor(const prop in command.value){\r\n\t\t\t\t\t\tconst internalProperty = prop.startsWith(\"$\") || prop.startsWith(\"_\");\r\n\t\t\t\t\t\tconst whitelist = [\"$open\"];\r\n\t\t\t\t\t\tlet copyProperty = !internalProperty;\r\n\t\t\t\t\t\tif (whitelist.indexOf(prop) > -1){\r\n\t\t\t\t\t\t\tcopyProperty = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(copyProperty){\r\n\t\t\t\t\t\t\titem[prop] = command.value[prop];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tgantt[method](command.value.id);\r\n\t\t\t\t} else if (command.type === actions.move) {\r\n\t\t\t\t\tgantt[method](command.value.id, command.value.$local_index, command.value.parent);\r\n\t\t\t\t\t// GS-680: We should send the changes to the server after we undo vertical reorder\r\n\t\t\t\t\tgantt.callEvent(\"onRowDragEnd\", [command.value.id]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}","\r\nimport click_drag from \"./click_drag\";\r\nimport drag_timeline from \"./drag_timeline\";\r\nimport export_api from \"./export_api\";\r\nimport fullscreen from \"./fullscreen\";\r\nimport keyboard_navigation from \"./keyboard_navigation\";\r\nimport marker from \"./marker\";\r\nimport multiselect from \"./multiselect\";\r\nimport quick_info from \"./quick_info\";\r\nimport tooltip from \"./tooltip\";\r\nimport undo from \"./undo\";\r\n\r\nexport default {\r\n\tclick_drag,\r\n\tdrag_timeline,\r\n\tfullscreen,\r\n\tkeyboard_navigation,\r\n\tquick_info,\r\n\ttooltip,\r\n\tundo,\r\n\tmarker,\r\n\tmultiselect,\r\n\texport_api\r\n};","import { EventsManager } from \"./eventsManager\";\r\nimport { ISelectedRegionConfig, SelectedRegion } from \"./selectedRegion\";\r\n\r\nexport default function(gantt: any){\r\n\tif (!gantt.ext) {\r\n\t\tgantt.ext = {};\r\n\t}\r\n\r\n\tconst defaultConfig: ISelectedRegionConfig = {\r\n\t\tclassName: \"gantt_click_drag_rect\",\r\n\t\tuseRequestAnimationFrame: true,\r\n\t\tcallback: undefined,\r\n\t\tsingleRow: false\r\n\t};\r\n\r\n\tfunction setClickDrag(){\r\n\t\tconst config: ISelectedRegionConfig = { viewPort: gantt.$task_data, ...defaultConfig };\r\n\t\tif (gantt.ext.clickDrag){\r\n\t\t\tgantt.ext.clickDrag.destructor();\r\n\t\t}\r\n\t\tgantt.ext.clickDrag = new EventsManager(gantt);\r\n\t\tconst clickDrag = gantt.config.click_drag;\r\n\t\tconfig.render = clickDrag.render || defaultConfig.render;\r\n\t\tconfig.className = clickDrag.className || defaultConfig.className;\r\n\t\tconfig.callback = clickDrag.callback || defaultConfig.callback;\r\n\t\tconfig.viewPort = clickDrag.viewPort || gantt.$task_data;\r\n\t\tconfig.useRequestAnimationFrame = clickDrag.useRequestAnimationFrame === undefined ?\r\n\t\t\tdefaultConfig.useRequestAnimationFrame : clickDrag.useRequestAnimationFrame;\r\n\r\n\t\tconfig.singleRow = clickDrag.singleRow === undefined ? defaultConfig.singleRow : clickDrag.singleRow;\r\n\t\tconst timeline = gantt.$ui.getView(\"timeline\");\r\n\t\tconst selectedRegion = new SelectedRegion(config, gantt, timeline);\r\n\t\tgantt.ext.clickDrag.attach(selectedRegion, clickDrag.useKey, clickDrag.ignore);\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onGanttReady\", () => {\r\n\t\tif (gantt.config.click_drag){\r\n\t\t\tsetClickDrag();\r\n\t\t}\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onGanttLayoutReady\", function(){\r\n\t\tif (gantt.$container && gantt.config.click_drag){\r\n\t\t\tgantt.attachEvent(\"onGanttRender\", function(){\r\n\t\t\t\tsetClickDrag();\r\n\t\t\t}, {once:true});\r\n\t\t}\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onDestroy\", () => {\r\n\t\tif (gantt.ext.clickDrag){\r\n\t\t\tgantt.ext.clickDrag.destructor();\r\n\t\t}\r\n\t});\r\n\r\n}","import { EventsManager } from \"./eventsManager\";\r\nexport default function(gantt: any){\r\n\tif (!gantt.ext){\r\n\t\tgantt.ext = {};\r\n\t}\r\n\r\n\tgantt.ext.dragTimeline = {\r\n\t\tcreate: () => EventsManager.create(gantt),\r\n\t\t_isDragInProgress: () => EventsManager._isDragInProgress\r\n\t};\r\n\r\n\tgantt.config.drag_timeline = {\r\n\t\tenabled: true,\r\n\t\trender: false\r\n\t};\r\n}","export default function(gantt: any){\r\n\r\ninterface IBody extends HTMLElement {\r\n\tmsRequestFullscreen?: () => void;\r\n\tmozRequestFullScreen?: () => void;\r\n\twebkitRequestFullscreen?: (ALLOW_KEYBOARD_INPUT: any) => void;\r\n}\r\n\r\n\r\ninterface IConsole extends Console {\r\n\twarning?: (str: string) => void;\r\n}\r\n\r\ninterface IDocument extends Document {\r\n\tfullscreenElement: Element;\r\n\tmozFullScreenElement?: Element;\r\n\twebkitFullscreenElement?: Element;\r\n\tmsFullscreenElement?: Element;\r\n\twebkitFullscreenEnabled?: boolean;\r\n\tmozFullScreenEnabled?: boolean;\r\n\tmsFullscreenEnabled?: boolean;\r\n\tmsExitFullscreen?: () => void;\r\n\tmozCancelFullScreen?: () => void;\r\n\twebkitExitFullscreen?: () => void;\r\n}\r\n\r\ninterface IElement extends Element {\r\n\tALLOW_KEYBOARD_INPUT?: boolean;\r\n}\r\n\r\ninterface IElementSizes extends ISizes {\r\n\tmodified: boolean;\r\n}\r\n\r\ninterface ISizes {\r\n\twidth: null | string;\r\n\theight: null | string;\r\n\ttop: null | string;\r\n\tleft: null | string;\r\n\tposition: null | string;\r\n\tzIndex: null | number;\r\n}\r\n\r\nfunction isExpanded() {\r\n\tconst element = ((document as IDocument).fullscreenElement ||\r\n\t\t(document as IDocument).mozFullScreenElement ||\r\n\t\t(document as IDocument).webkitFullscreenElement ||\r\n\t\t(document as IDocument).msFullscreenElement);\r\n\treturn !!(element && element === document.body);\r\n}\r\n\r\nfunction isFullscreenAvailable() {\r\n\ttry {\r\n\t\treturn (document as IDocument).fullscreenEnabled ||\r\n\t\t\t(document as IDocument).webkitFullscreenEnabled ||\r\n\t\t\t(document as IDocument).mozFullScreenEnabled ||\r\n\t\t\t(document as IDocument).msFullscreenEnabled;\r\n\t} catch (e) {\r\n\t\t// eslint-disable-next-line no-console\r\n\t\tconsole.error(\"Fullscreen is not available:\", e); \r\n\t}\r\n}\r\n\r\nconst state = gantt.$services.getService(\"state\");\r\nstate.registerProvider(\"fullscreen\", () => {\r\n\tif (isFullscreenAvailable()){\r\n\t\treturn { fullscreen: isExpanded() };\r\n\t} else {\r\n\t\treturn undefined;\r\n\t}\r\n});\r\n\r\nlet backupBodyPadding = {\r\n\toverflow: null,\r\n\tpadding: null,\r\n\tpaddingTop: null,\r\n\tpaddingRight: null,\r\n\tpaddingBottom: null,\r\n\tpaddingLeft: null\r\n};\r\n\r\nconst backupElementSizes: IElementSizes = {\r\n\twidth: null,\r\n\theight: null,\r\n\ttop: null,\r\n\tleft: null,\r\n\tposition: null,\r\n\tzIndex: null,\r\n\tmodified: false\r\n};\r\n\r\nlet backupPositioning = null;\r\nfunction resetParentPositioning(root){\r\n\tlet parent = root.parentNode;\r\n\tconst positions = [];\r\n\twhile(parent && parent.style){\r\n\t\tpositions.push({\r\n\t\t\telement: parent,\r\n\t\t\toriginalPositioning: parent.style.position\r\n\t\t});\r\n\t\tparent.style.position = \"static\";\r\n\t\tparent = parent.parentNode;\r\n\t}\r\n\treturn positions;\r\n}\r\n\r\nfunction restoreParentPositioning(positions: any[]){\r\n\tpositions.forEach(record => {\r\n\t\trecord.element.style.position = record.originalPositioning;\r\n\t});\r\n}\r\n\r\n// expand gantt root element to fullscreen automatically\r\nfunction setFullScreenSizes() {\r\n\tconst root = gantt.ext.fullscreen.getFullscreenElement();\r\n\tconst body = document.body;\r\n\tupdateSizes(root.style, backupElementSizes);\r\n\tbackupBodyPadding = {\r\n\t\toverflow: body.style.overflow,\r\n\t\tpadding: body.style.padding ? body.style.padding : null,\r\n\t\tpaddingTop: body.style.paddingTop ? body.style.paddingTop : null,\r\n\t\tpaddingRight: body.style.paddingRight ? body.style.paddingRight : null,\r\n\t\tpaddingBottom: body.style.paddingBottom ? body.style.paddingBottom : null,\r\n\t\tpaddingLeft: body.style.paddingLeft ? body.style.paddingLeft : null\r\n\t};\r\n\r\n\tif (body.style.padding) {\r\n\t\tbody.style.padding = \"0\";\r\n\t}\r\n\tif (body.style.paddingTop) {\r\n\t\tbody.style.paddingTop = \"0\";\r\n\t}\r\n\tif (body.style.paddingRight) {\r\n\t\tbody.style.paddingRight = \"0\";\r\n\t}\r\n\tif (body.style.paddingBottom) {\r\n\t\tbody.style.paddingBottom = \"0\";\r\n\t}\r\n\tif (body.style.paddingLeft) {\r\n\t\tbody.style.paddingLeft = \"0\";\r\n\t}\r\n\r\n\tbody.style.overflow = \"hidden\";\r\n\r\n\troot.style.width = \"100vw\";\r\n\troot.style.height = \"100vh\";\r\n\troot.style.top = \"0px\";\r\n\troot.style.left = \"0px\";\r\n\troot.style.position = \"absolute\";\r\n\troot.style.zIndex = 1;\r\n\tbackupElementSizes.modified = true;\r\n\tbackupPositioning = resetParentPositioning(root);\r\n}\r\n\r\nfunction restoreSizes() {\r\n\tconst root = gantt.ext.fullscreen.getFullscreenElement();\r\n\tconst body = document.body;\r\n\tif (backupElementSizes.modified) {\r\n\t\tif (backupBodyPadding.padding) {\r\n\t\t\tbody.style.padding = backupBodyPadding.padding;\r\n\t\t}\r\n\t\tif (backupBodyPadding.paddingTop) {\r\n\t\t\tbody.style.paddingTop = backupBodyPadding.paddingTop;\r\n\t\t}\r\n\t\tif (backupBodyPadding.paddingRight) {\r\n\t\t\tbody.style.paddingRight = backupBodyPadding.paddingRight;\r\n\t\t}\r\n\t\tif (backupBodyPadding.paddingBottom) {\r\n\t\t\tbody.style.paddingBottom = backupBodyPadding.paddingBottom;\r\n\t\t}\r\n\t\tif (backupBodyPadding.paddingLeft) {\r\n\t\t\tbody.style.paddingLeft = backupBodyPadding.paddingLeft;\r\n\t\t}\r\n\r\n\t\tbody.style.overflow = backupBodyPadding.overflow;\r\n\t\tbackupBodyPadding = {\r\n\t\t\toverflow: null,\r\n\t\t\tpadding: null,\r\n\t\t\tpaddingTop: null,\r\n\t\t\tpaddingRight: null,\r\n\t\t\tpaddingBottom: null,\r\n\t\t\tpaddingLeft: null\r\n\t\t};\r\n\t\tupdateSizes(backupElementSizes, root.style);\r\n\t\tbackupElementSizes.modified = false;\r\n\t}\r\n\trestoreParentPositioning(backupPositioning);\r\n\tbackupPositioning = null;\r\n}\r\n\r\nfunction updateSizes(source: ISizes, target: ISizes) {\r\n\ttarget.width = source.width;\r\n\ttarget.height = source.height;\r\n\ttarget.top = source.top;\r\n\ttarget.left = source.left;\r\n\ttarget.position = source.position;\r\n\ttarget.zIndex = source.zIndex;\r\n}\r\n\r\nfunction addDOMEvents() {\r\n\tgantt.event(document, \"webkitfullscreenchange\", onFullScreenChange);\r\n\tgantt.event(document, \"mozfullscreenchange\", onFullScreenChange);\r\n\tgantt.event(document, \"MSFullscreenChange\", onFullScreenChange);\r\n\t// For IE on Win 10\r\n\tgantt.event(document, \"fullscreenChange\", onFullScreenChange);\r\n\tgantt.event(document, \"fullscreenchange\", onFullScreenChange);\r\n}\r\n\r\nlet expandGantt = false;\r\nfunction onFullScreenChange() {\r\n\tif (!gantt.$container) {\r\n\t\t// do nothing if gantt is not yet initialized\r\n\t\treturn;\r\n\t}\r\n\tlet event: \"onExpand\" | \"onCollapse\";\r\n\tconst isBodyExpanded = isExpanded();\r\n\r\n\tif (isBodyExpanded) {\r\n\t\tif (expandGantt) {\r\n\t\t\tevent = \"onExpand\";\r\n\t\t\tsetFullScreenSizes();\r\n\t\t}\r\n\t} else if (expandGantt) {\r\n\t\texpandGantt = false;\r\n\t\tevent = \"onCollapse\";\r\n\t\trestoreSizes();\r\n\t}\r\n\tsetTimeout(() => {\r\n\t\tgantt.render();\r\n\t});\r\n\tsetTimeout(() => {\r\n\t\tgantt.callEvent(event, [gantt.ext.fullscreen.getFullscreenElement()]);\r\n\t});\r\n}\r\n\r\nfunction cantFullscreen() {\r\n\tif (!gantt.$container) { // check is gantt initialized or not\r\n\t\treturn true;\r\n\t}\r\n\tif (!gantt.ext.fullscreen.getFullscreenElement()) {\r\n\t\treturn true;\r\n\t}\r\n\tif (!isFullscreenAvailable()) {\r\n\t\t// eslint-disable-next-line no-console\r\n\t\tconst method = (console as IConsole).warning || console.log;\r\n\t\tmethod(\"The `fullscreen` feature not being allowed, or full-screen mode not being supported\");\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\ngantt.ext.fullscreen = {\r\n\texpand(): void {\r\n\t\tif (cantFullscreen()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (isExpanded()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!gantt.callEvent(\"onBeforeExpand\", [this.getFullscreenElement()])) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\texpandGantt = true;\r\n\r\n\t\t// we switch body to fullscreen and then expand fullscreen element to viewport\r\n\t\t// we do it to correct display common elements: lightboxes, tooltip etc.\r\n\t\tconst element = document.body as IBody;\r\n\t\tconst requestArguments = element.webkitRequestFullscreen ?\r\n\t\t\t[(Element as unknown as IElement).ALLOW_KEYBOARD_INPUT] : [];\r\n\r\n\t\tconst requestFullscreen = element.msRequestFullscreen ||\r\n\t\t\telement.mozRequestFullScreen ||\r\n\t\t\telement.webkitRequestFullscreen ||\r\n\t\t\telement.requestFullscreen;\r\n\r\n\t\tif (requestFullscreen) {\r\n\t\t\trequestFullscreen.apply(element, requestArguments);\r\n\t\t}\r\n\t},\r\n\tcollapse(): void {\r\n\t\tif (cantFullscreen()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!isExpanded()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!gantt.callEvent(\"onBeforeCollapse\", [this.getFullscreenElement()])) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst requestExitFullscreen = (document as IDocument).msExitFullscreen ||\r\n\t\t\t(document as IDocument).mozCancelFullScreen ||\r\n\t\t\t(document as IDocument).webkitExitFullscreen ||\r\n\t\t\t(document as IDocument).exitFullscreen;\r\n\r\n\t\tif (requestExitFullscreen) {\r\n\t\t\trequestExitFullscreen.apply(document);\r\n\t\t}\r\n\t},\r\n\ttoggle(): void {\r\n\t\tif (cantFullscreen()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!isExpanded()) {\r\n\t\t\tthis.expand();\r\n\t\t} else {\r\n\t\t\tthis.collapse();\r\n\t\t}\r\n\r\n\t},\r\n\tgetFullscreenElement(): HTMLElement {\r\n\t\treturn gantt.$root;\r\n\t}\r\n};\r\n\r\ngantt.expand = function() {\r\n\tgantt.ext.fullscreen.expand();\r\n};\r\n\r\ngantt.collapse = function(){\r\n\tgantt.ext.fullscreen.collapse();\r\n};\r\n\r\ngantt.attachEvent(\"onGanttReady\", addDOMEvents);\r\n\r\n}","import eventable from \"../utils/eventable\";\r\nimport * as domHelpers from \"../core/ui/utils/dom_helpers\";\r\n\r\nimport keyboard_shortcuts from \"./keyboard_navigation/common/keyboard_shortcuts\";\r\nimport eventhandler from \"./keyboard_navigation/common/eventhandler\";\r\nimport trap_modal_focus from \"./keyboard_navigation/common/trap_modal_focus\";\r\nimport gantt_node from \"./keyboard_navigation/elements/gantt_node\";\r\nimport nav_node from \"./keyboard_navigation/elements/nav_node\";\r\nimport header_cell from \"./keyboard_navigation/elements/header_cell\";\r\nimport task_row from \"./keyboard_navigation/elements/task_row\";\r\nimport task_cell from \"./keyboard_navigation/elements/task_cell\";\r\nimport modals from \"./keyboard_navigation/modals\";\r\nimport core from \"./keyboard_navigation/core\";\r\n\r\n\r\n\r\nexport default function(gantt){\r\n\tfunction setupKeyNav(gantt){\r\n\t\tgantt.config.keyboard_navigation = true;\r\n\t\tgantt.config.keyboard_navigation_cells = false;\r\n\r\n\t\tgantt.$keyboardNavigation = {};\r\n\r\n\t\tgantt._compose = function(){\r\n\t\t\tvar parts = Array.prototype.slice.call(arguments, 0);\r\n\t\t\tvar res = {};\r\n\t\t\tfor(var i = 0; i < parts.length; i++){\r\n\t\t\t\tvar obj = parts[i];\r\n\t\t\t\tif(typeof obj == \"function\"){\r\n\t\t\t\t\tobj = new obj();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor(var p in obj){\r\n\t\t\t\t\tres[p] = obj[p];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t};\r\n\r\n\t\tkeyboard_shortcuts(gantt);\r\n\t\teventhandler(gantt);\r\n\t\ttrap_modal_focus(gantt);\r\n\t\tgantt_node(gantt);\r\n\t\tnav_node(gantt);\r\n\t\theader_cell(gantt);\r\n\t\ttask_row(gantt);\r\n\t\ttask_cell(gantt);\r\n\t\tmodals(gantt);\r\n\t\tcore(gantt);\r\n\r\n\r\n\t\t(function(){\r\n\t\t\tvar dispatcher = gantt.$keyboardNavigation.dispatcher;\r\n\r\n\t\t\tdispatcher.isTaskFocused = function(id){\r\n\t\t\t\tvar node = dispatcher.activeNode;\r\n\t\t\t\tif(node instanceof gantt.$keyboardNavigation.TaskRow || node instanceof gantt.$keyboardNavigation.TaskCell) {\r\n\t\t\t\t\tif (node.taskId == id) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t};\r\n\r\n\t\t\tvar keyDownHandler = function(e){\r\n\t\t\t\tif(!gantt.config.keyboard_navigation) return;\r\n\t\t\t\t// GS-734 & GS-1078: we don't need keyboard navigation inside inline editors\r\n\t\t\t\tif(!gantt.config.keyboard_navigation_cells && isInlineEditorCell(e)) return;\r\n\r\n\t\t\t\tif (isNoKeyboardNavigationElement(e) || isLightboxElement(e)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn dispatcher.keyDownHandler(e);\r\n\t\t\t};\r\n\r\n\t\t\tvar focusHandler = function(e){\r\n\t\t\t\tif(dispatcher.$preventDefault){\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tgantt.$container.blur();\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t// do nothing if key-nav focus is already planned\r\n\t\t\t\t} else if (!dispatcher.awaitsFocus()) {\r\n\t\t\t\t\t// otherwise - re-focus key-nav element on gantt focus\r\n\t\t\t\t\tdispatcher.focusGlobalNode();\r\n\t\t\t\t}\r\n\r\n\t\t\t};\r\n\r\n\t\t\tvar reFocusActiveNode = function(){\r\n\t\t\t\tif(!dispatcher.isEnabled())\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tconst outsideGantt = !domHelpers.isChildOf(document.activeElement, gantt.$container) && document.activeElement.localName != \"body\";\r\n\t\t\t\tvar activeNode = dispatcher.getActiveNode();\r\n\t\t\t\tif(!activeNode || outsideGantt)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tvar domElement = activeNode.getNode();\r\n\t\t\t\tvar top, left;\r\n\t\t\t\tif(domElement && domElement.parentNode){\r\n\t\t\t\t\ttop = domElement.parentNode.scrollTop;\r\n\t\t\t\t\tleft = domElement.parentNode.scrollLeft;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tactiveNode.focus(true);\r\n\r\n\t\t\t\tif(domElement && domElement.parentNode){\r\n\t\t\t\t\tdomElement.parentNode.scrollTop = top;\r\n\t\t\t\t\tdomElement.parentNode.scrollLeft = left;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\r\n\t\t\tgantt.attachEvent(\"onDataRender\", function(){\r\n\t\t\t\tif(!gantt.config.keyboard_navigation) return;\r\n\t\t\t\treFocusActiveNode();\r\n\t\t\t});\r\n\r\n\t\t\tgantt.attachEvent(\"onGanttRender\", function(){\r\n\t\t\t\t//GS-2230: in case if `getGanttInstance` created without container\r\n\t\t\t\tif(!gantt.$root) return;\r\n\t\t\t\tgantt.eventRemove(gantt.$root, \"keydown\", keyDownHandler);\r\n\t\t\t\tgantt.eventRemove(gantt.$container, \"focus\", focusHandler);\r\n\t\t\t\tgantt.eventRemove(gantt.$container, \"mousedown\", mousedownHandler);\r\n\r\n\t\t\t\tif(gantt.config.keyboard_navigation){\r\n\r\n\t\t\t\t\tgantt.event(gantt.$root, \"keydown\", keyDownHandler);\r\n\t\t\t\t\tgantt.event(gantt.$container, \"focus\", focusHandler);\r\n\t\t\t\t\tgantt.event(gantt.$container, \"mousedown\", mousedownHandler);\r\n\t\t\t\t\tgantt.$container.setAttribute(\"tabindex\", \"0\");\r\n\r\n\t\t\t\t}else{\r\n\t\t\t\t\tgantt.$container.removeAttribute(\"tabindex\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tfunction getTaskNodeConstructor(){\r\n\t\t\t\tif (gantt.config.keyboard_navigation_cells) {\r\n\t\t\t\t\treturn gantt.$keyboardNavigation.TaskCell;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn gantt.$keyboardNavigation.TaskRow;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction isInlineEditorCell(e){\r\n\t\t\t\treturn !!domHelpers.closest(e.target, \".gantt_grid_editor_placeholder\");\r\n\t\t\t}\r\n\t\t\t// GS-1445. Cancel keyboard navigation within custom elements\r\n\t\t\tfunction isNoKeyboardNavigationElement(e){\r\n\t\t\t\treturn !!domHelpers.closest(e.target, \".no_keyboard_navigation\");\r\n\t\t\t}\r\n\t\t\tfunction isLightboxElement(e){\r\n\t\t\t\treturn !!domHelpers.closest(e.target, \".gantt_cal_light\");\r\n\t\t\t}\r\n\r\n\t\t\tfunction mousedownHandler(e){\r\n\t\t\t\tif(!gantt.config.keyboard_navigation) return true;\r\n\t\t\t\t// GS-734 & GS-1078: we don't need keyboard navigation inside inline editors\r\n\t\t\t\tif(!gantt.config.keyboard_navigation_cells && isInlineEditorCell(e)) return true;\r\n\r\n\t\t\t\tif (isNoKeyboardNavigationElement(e)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar focusNode;\r\n\t\t\t\tvar locateTask = dispatcher.fromDomElement(e);\r\n\t\t\t\tif(locateTask){\r\n\t\t\t\t\t//var node = getTaskNodeConstructor();\r\n\t\t\t\t\tif(dispatcher.activeNode instanceof gantt.$keyboardNavigation.TaskCell && domHelpers.isChildOf(e.target, gantt.$task)){\r\n\t\t\t\t\t\tlocateTask = new gantt.$keyboardNavigation.TaskCell(locateTask.taskId, dispatcher.activeNode.columnIndex);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfocusNode = locateTask;\r\n\t\t\t\t\t// GS-1541 and GS-1542. If you click on the task row element (possible with custom styles)\r\n\t\t\t\t\t// or the task bar element, there is no information about the target grid cell,\r\n\t\t\t\t\t// so we need to set focus on the first visible cell\r\n\t\t\t\t\tconst visibleGrid = gantt.config.show_grid && gantt.$ui.getView(\"grid\");\r\n\t\t\t\t\tif(visibleGrid && gantt.config.keyboard_navigation_cells){\r\n\t\t\t\t\t\tconst taskRow = e.target.classList.contains(\"gantt_row\");\r\n\t\t\t\t\t\tconst taskBar = e.target.closest(\".gantt_task_line\");\r\n\r\n\t\t\t\t\t\tconst gridLeft = gantt.utils.dom.getNodePosition(gantt.$grid).x;\r\n\t\t\t\t\t\tconst gridRight = gridLeft + gantt.$grid.offsetWidth;\r\n\t\t\t\t\t\tconst nodePosition = gantt.utils.dom.getNodePosition(document.activeElement).x;\r\n\t\t\t\t\t\tconst nodeHidden = nodePosition < gridLeft || gridRight < nodePosition;\r\n\r\n\t\t\t\t\t\tif (taskRow || (taskBar && nodeHidden)){\r\n\t\t\t\t\t\t\tlet scrollPosition = gantt.$grid.scrollLeft;\r\n\t\t\t\t\t\t\tconst rightPosition = scrollPosition + gantt.$grid.offsetWidth;\r\n\t\t\t\t\t\t\tlet positionX = 0;\r\n\t\t\t\t\t\t\tif (taskRow){\r\n\t\t\t\t\t\t\t\tscrollPosition = gantt.utils.dom.getRelativeEventPosition(e, gantt.$grid).x;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tfor (let i = 0; i < gantt.config.columns.length; i++) {\r\n\t\t\t\t\t\t\t\tconst column = gantt.config.columns[i];\r\n\t\t\t\t\t\t\t\tif (column.hide){\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tpositionX += column.width;\r\n\t\t\t\t\t\t\t\tif (scrollPosition < positionX){\r\n\t\t\t\t\t\t\t\t\tif (rightPosition < positionX){\r\n\t\t\t\t\t\t\t\t\t\tpositionX -= column.width;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tfocusNode.columnIndex = i;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (focusNode) {\r\n\t\t\t\t\tif (!dispatcher.isEnabled()) {\r\n\t\t\t\t\t\tdispatcher.activeNode = focusNode;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdispatcher.delay(function () {\r\n\t\t\t\t\t\t\tdispatcher.setActiveNode(focusNode);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// empty click should drop focus from gantt, insert of reselecting default node\r\n\t\t\t\t\tdispatcher.$preventDefault = true;\r\n\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\tdispatcher.$preventDefault = false;\r\n\t\t\t\t\t}, 300);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar onReady = gantt.attachEvent(\"onGanttReady\", function(){\r\n\t\t\t\t// restore focus on repainted tasks\r\n\t\t\t\tgantt.detachEvent(onReady);\r\n\r\n\t\t\t\tgantt.$data.tasksStore.attachEvent(\"onStoreUpdated\", function(id){\r\n\t\t\t\t\tif (gantt.config.keyboard_navigation && dispatcher.isEnabled()) {\r\n\t\t\t\t\t\tconst currentNode = dispatcher.getActiveNode();\r\n\t\t\t\t\t\tconst grid = gantt.$ui.getView(\"grid\");\r\n\t\t\t\t\t\tif (!grid || !grid.$grid_data){\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst top = grid.getItemTop(id);\r\n\t\t\t\t\t\tconst gridDataTopScroll = grid.$grid_data.scrollTop;\r\n\t\t\t\t\t\tconst gridDataBottomScroll = gridDataTopScroll + grid.$grid_data.getBoundingClientRect().height;\r\n\t\t\t\t\t\tif(currentNode && currentNode.taskId == id){\r\n\t\t\t\t\t\t\t// GS-2539: Don't refocus the node if it is selected and outside the visible range in the grid\r\n\t\t\t\t\t\t\tif(gridDataTopScroll <= top && gridDataBottomScroll >= top){\r\n\t\t\t\t\t\t\t\treFocusActiveNode();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(gantt._smart_render){\r\n\t\t\t\t\tvar updateRender = gantt._smart_render._redrawTasks;\r\n\t\t\t\t\tgantt._smart_render._redrawTasks = function(renderers, items){\r\n\t\t\t\t\t\tif(gantt.config.keyboard_navigation && dispatcher.isEnabled()){\r\n\t\t\t\t\t\t\tvar currentNode = dispatcher.getActiveNode();\r\n\t\t\t\t\t\t\tif(currentNode && currentNode.taskId !== undefined){\r\n\t\t\t\t\t\t\t\tvar focusedItemVisible = false;\r\n\t\t\t\t\t\t\t\tfor(var i = 0; i < items.length; i++){\r\n\t\t\t\t\t\t\t\t\tif(items[i].id == currentNode.taskId && items[i].start_date){\r\n\t\t\t\t\t\t\t\t\t\tfocusedItemVisible = true;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif(!focusedItemVisible){\r\n\t\t\t\t\t\t\t\t\titems.push(gantt.getTask(currentNode.taskId));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar res = updateRender.apply(this, arguments);\r\n\r\n\t\t\t\t\t\treturn res;\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\r\n\t\t\tlet createdTaskId = null;\r\n\t\t\tlet keepFocusOnNewTask = false;\r\n\t\t\tgantt.attachEvent(\"onTaskCreated\", function (task) {\r\n\t\t\t\tcreatedTaskId = task.id;\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\r\n\t\t\tgantt.attachEvent(\"onAfterTaskAdd\", function(id,item){\r\n\t\t\t\tif(!gantt.config.keyboard_navigation) return true;\r\n\t\t\t\tif(dispatcher.isEnabled()){\r\n\r\n\t\t\t\t\t// GS-1394. After adding a new task, the focus shouldn't change to the placeholder task\r\n\t\t\t\t\tif (id == createdTaskId) {\r\n\t\t\t\t\t\tkeepFocusOnNewTask = true;\r\n\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\tkeepFocusOnNewTask = false;\r\n\t\t\t\t\t\t\tcreatedTaskId = null;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (keepFocusOnNewTask && item.type == gantt.config.types.placeholder) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar columnIndex = 0;\r\n\t\t\t\t\tvar node = dispatcher.activeNode;\r\n\t\t\t\t\tif(node instanceof gantt.$keyboardNavigation.TaskCell){\r\n\t\t\t\t\t\tcolumnIndex = node.columnIndex;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar nodeConstructor = getTaskNodeConstructor();\r\n\r\n\t\t\t\t\tif (item.type == gantt.config.types.placeholder && gantt.config.placeholder_task.focusOnCreate === false) {\r\n\t\t\t\t\t\t// do not focus on the placeholder task\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdispatcher.setActiveNode(new nodeConstructor(id, columnIndex));\r\n\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tgantt.attachEvent(\"onTaskIdChange\", function(oldId, newId){\r\n\t\t\t\tif(!gantt.config.keyboard_navigation) return true;\r\n\r\n\t\t\t\tvar node = dispatcher.activeNode;\r\n\t\t\t\tif(dispatcher.isTaskFocused(oldId)){\r\n\t\t\t\t\tnode.taskId = newId;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\r\n\t\t\tvar interval = setInterval(function(){\r\n\t\t\t\tif(!gantt.config.keyboard_navigation) return;\r\n\t\t\t\tif(!dispatcher.isEnabled()){\r\n\t\t\t\t\tdispatcher.enable();\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}, 500);\r\n\r\n\t\t\tgantt.attachEvent(\"onDestroy\", function(){\r\n\t\t\t\tclearInterval(interval);\r\n\t\t\t});\r\n\r\n\t\t\tfunction getScopeName(obj){\r\n\t\t\t\tif(obj instanceof gantt.$keyboardNavigation.GanttNode){\r\n\t\t\t\t\treturn \"gantt\";\r\n\t\t\t\t}else if(obj instanceof gantt.$keyboardNavigation.HeaderCell){\r\n\t\t\t\t\treturn \"headerCell\";\r\n\t\t\t\t}else if(obj instanceof gantt.$keyboardNavigation.TaskRow){\r\n\t\t\t\t\treturn \"taskRow\";\r\n\t\t\t\t}else if(obj instanceof gantt.$keyboardNavigation.TaskCell){\r\n\t\t\t\t\treturn \"taskCell\";\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tfunction getScope(mode){\r\n\t\t\t\tvar scopes = {\r\n\t\t\t\t\t\"gantt\":gantt.$keyboardNavigation.GanttNode,\r\n\t\t\t\t\t\"headerCell\": gantt.$keyboardNavigation.HeaderCell,\r\n\t\t\t\t\t\"taskRow\": gantt.$keyboardNavigation.TaskRow,\r\n\t\t\t\t\t\"taskCell\": gantt.$keyboardNavigation.TaskCell\r\n\t\t\t\t};\r\n\r\n\t\t\t\treturn scopes[mode] || scopes.gantt;\r\n\t\t\t}\r\n\r\n\t\t\tfunction findVisibleColumnIndex(columnName) {\r\n\t\t\t\tvar columns = gantt.getGridColumns();\r\n\t\t\t\tfor (var i = 0; i < columns.length; i++){\r\n\t\t\t\t\tif(columns[i].name == columnName){\r\n\t\t\t\t\t\treturn i;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\r\n\t\t\tvar keyNavFacade = {};\r\n\t\t\teventable(keyNavFacade);\r\n\t\t\tgantt.mixin(keyNavFacade, {\r\n\t\t\t\taddShortcut: function(shortcut, handler, scope){\r\n\t\t\t\t\tvar scopeObject = getScope(scope);\r\n\t\t\t\t\tif(scopeObject){\r\n\t\t\t\t\t\tscopeObject.prototype.bind(shortcut, handler);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tgetShortcutHandler: function(shortcut, scope){\r\n\t\t\t\t\tvar commands = gantt.$keyboardNavigation.shortcuts.parse(shortcut);\r\n\t\t\t\t\tif(commands.length){\r\n\t\t\t\t\t\treturn keyNavFacade.getCommandHandler(commands[0], scope);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tgetCommandHandler: function(command, scope){\r\n\t\t\t\t\tvar scopeObject = getScope(scope);\r\n\t\t\t\t\tif(scopeObject){\r\n\t\t\t\t\t\tif(command){\r\n\t\t\t\t\t\t\treturn scopeObject.prototype.findHandler(command);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tremoveShortcut: function(shortcut, scope){\r\n\t\t\t\t\tvar scopeObject = getScope(scope);\r\n\t\t\t\t\tif(scopeObject){\r\n\t\t\t\t\t\tscopeObject.prototype.unbind(shortcut);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tfocus: function(config){\r\n\t\t\t\t\tvar type = config ? config.type : null;\r\n\t\t\t\t\tvar constructor = getScope(type);\r\n\t\t\t\t\tvar node;\r\n\t\t\t\t\tswitch (type){\r\n\t\t\t\t\t\tcase \"taskCell\":\r\n\t\t\t\t\t\t\tnode = new constructor(config.id, findVisibleColumnIndex(config.column));\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"taskRow\":\r\n\t\t\t\t\t\t\tnode = new constructor(config.id);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"headerCell\":\r\n\t\t\t\t\t\t\tnode = new constructor(findVisibleColumnIndex(config.column));\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdispatcher.delay(function(){\r\n\t\t\t\t\t\tif(node){\r\n\t\t\t\t\t\t\tdispatcher.setActiveNode(node);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tdispatcher.enable();\r\n\t\t\t\t\t\t\tif(!dispatcher.getActiveNode()){\r\n\r\n\t\t\t\t\t\t\t\tdispatcher.setDefaultNode();\r\n\t\t\t\t\t\t\t}else{\r\n\r\n\t\t\t\t\t\t\t\tif(!dispatcher.awaitsFocus()){\r\n\t\t\t\t\t\t\t\t\tdispatcher.enable();\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\r\n\t\t\t\tgetActiveNode: function(){\r\n\t\t\t\t\tif(dispatcher.isEnabled()){\r\n\t\t\t\t\t\tvar node = dispatcher.getActiveNode();\r\n\t\t\t\t\t\tvar scope = getScopeName(node);\r\n\t\t\t\t\t\tvar columns = gantt.getGridColumns();\r\n\t\t\t\t\t\tswitch (scope){\r\n\t\t\t\t\t\t\tcase \"taskCell\":\r\n\t\t\t\t\t\t\t\treturn {type:\"taskCell\", id:node.taskId, column:columns[node.columnIndex].name};\r\n\t\t\t\t\t\t\tcase \"taskRow\":\r\n\t\t\t\t\t\t\t\treturn {type:\"taskRow\", id:node.taskId};\r\n\t\t\t\t\t\t\tcase \"headerCell\":\r\n\t\t\t\t\t\t\t\treturn {type:\"headerCell\", column:columns[node.index].name};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tgantt.$keyboardNavigation.facade = keyNavFacade;\r\n\r\n\t\t\tgantt.ext.keyboardNavigation = keyNavFacade;\r\n\t\t\tgantt.focus = function(){\r\n\t\t\t\tkeyNavFacade.focus();\r\n\t\t\t};\r\n\t\t\tgantt.addShortcut = keyNavFacade.addShortcut;\r\n\t\t\tgantt.getShortcutHandler = keyNavFacade.getShortcutHandler;\r\n\t\t\tgantt.removeShortcut = keyNavFacade.removeShortcut;\r\n\t\t})();\r\n\r\n\r\n\t}\r\n\r\n\tsetupKeyNav(gantt);\r\n\r\n\r\n\r\n};","export default function(gantt) {\r\n\r\n\tgantt.$keyboardNavigation.shortcuts = {\r\n\t\tcreateCommand: function () {\r\n\t\t\treturn {\r\n\t\t\t\tmodifiers: {\r\n\t\t\t\t\t\"shift\": false,\r\n\t\t\t\t\t\"alt\": false,\r\n\t\t\t\t\t\"ctrl\": false,\r\n\t\t\t\t\t\"meta\": false\r\n\t\t\t\t},\r\n\t\t\t\tkeyCode: null\r\n\t\t\t};\r\n\t\t},\r\n\t\tparse: function (shortcut) {\r\n\t\t\tvar commands = [];\r\n\r\n\t\t\tvar expr = this.getExpressions(this.trim(shortcut));\r\n\t\t\tfor (var i = 0; i < expr.length; i++) {\r\n\t\t\t\tvar words = this.getWords(expr[i]);\r\n\r\n\t\t\t\tvar command = this.createCommand();\r\n\r\n\t\t\t\tfor (var j = 0; j < words.length; j++) {\r\n\t\t\t\t\tif (this.commandKeys[words[j]]) {\r\n\t\t\t\t\t\tcommand.modifiers[words[j]] = true;\r\n\t\t\t\t\t} else if (this.specialKeys[words[j]]) {\r\n\t\t\t\t\t\tcommand.keyCode = this.specialKeys[words[j]];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcommand.keyCode = words[j].charCodeAt(0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcommands.push(command);\r\n\t\t\t}\r\n\t\t\treturn commands;\r\n\t\t},\r\n\r\n\t\tgetCommandFromEvent: function (domEvent) {\r\n\t\t\tvar command = this.createCommand();\r\n\t\t\tcommand.modifiers.shift = !!domEvent.shiftKey;\r\n\t\t\tcommand.modifiers.alt = !!domEvent.altKey;\r\n\t\t\tcommand.modifiers.ctrl = !!domEvent.ctrlKey;\r\n\t\t\tcommand.modifiers.meta = !!domEvent.metaKey;\r\n\t\t\tcommand.keyCode = domEvent.which || domEvent.keyCode;\r\n\r\n\t\t\tif(command.keyCode >= 96 && command.keyCode <= 105){\r\n\t\t\t\t// numpad keys 96-105 -> 48-57\r\n\t\t\t\tcommand.keyCode -= 48;//convert numpad  number code to regular number code\r\n\t\t\t}\r\n\r\n\t\t\tvar printableKey = String.fromCharCode(command.keyCode);\r\n\t\t\tif (printableKey) {\r\n\t\t\t\tcommand.keyCode = printableKey.toLowerCase().charCodeAt(0);\r\n\t\t\t}\r\n\t\t\treturn command;\r\n\t\t},\r\n\r\n\t\tgetHashFromEvent: function (domEvent) {\r\n\t\t\treturn this.getHash(this.getCommandFromEvent(domEvent));\r\n\t\t},\r\n\r\n\t\tgetHash: function (command) {\r\n\t\t\tvar parts = [];\r\n\t\t\tfor (var i in command.modifiers) {\r\n\t\t\t\tif (command.modifiers[i]) {\r\n\t\t\t\t\tparts.push(i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tparts.push(command.keyCode);\r\n\r\n\t\t\treturn parts.join(this.junctionChar);\r\n\t\t},\r\n\r\n\t\tgetExpressions: function (shortcut) {\r\n\t\t\treturn shortcut.split(this.junctionChar);\r\n\t\t},\r\n\t\tgetWords: function (term) {\r\n\t\t\treturn term.split(this.combinationChar);\r\n\t\t},\r\n\t\ttrim: function (shortcut) {\r\n\t\t\treturn shortcut.replace(/\\s/g, \"\");\r\n\t\t},\r\n\t\tjunctionChar: \",\",\r\n\t\tcombinationChar: \"+\",\r\n\t\tcommandKeys: {\r\n\t\t\t\"shift\": 16,\r\n\t\t\t\"alt\": 18,\r\n\t\t\t\"ctrl\": 17,\r\n\t\t\t\"meta\": true\r\n\t\t},\r\n\t\tspecialKeys: {\r\n\t\t\t\"backspace\": 8,\r\n\t\t\t\"tab\": 9,\r\n\t\t\t\"enter\": 13,\r\n\t\t\t\"esc\": 27,\r\n\t\t\t\"space\": 32,\r\n\t\t\t\"up\": 38,\r\n\t\t\t\"down\": 40,\r\n\t\t\t\"left\": 37,\r\n\t\t\t\"right\": 39,\r\n\t\t\t\"home\": 36,\r\n\t\t\t\"end\": 35,\r\n\t\t\t\"pageup\": 33,\r\n\t\t\t\"pagedown\": 34,\r\n\t\t\t\"delete\": 46,\r\n\t\t\t\"insert\": 45,\r\n\t\t\t\"plus\": 107,\r\n\t\t\t\"f1\": 112,\r\n\t\t\t\"f2\": 113,\r\n\t\t\t\"f3\": 114,\r\n\t\t\t\"f4\": 115,\r\n\t\t\t\"f5\": 116,\r\n\t\t\t\"f6\": 117,\r\n\t\t\t\"f7\": 118,\r\n\t\t\t\"f8\": 119,\r\n\t\t\t\"f9\": 120,\r\n\t\t\t\"f10\": 121,\r\n\t\t\t\"f11\": 122,\r\n\t\t\t\"f12\": 123\r\n\t\t}\r\n\t};\r\n};","export default function(gantt) {\r\n\r\n\tgantt.$keyboardNavigation.EventHandler = {\r\n\t\t_handlers: null,\r\n\t\tfindHandler: function (command) {\r\n\t\t\tif (!this._handlers) this._handlers = {};\r\n\t\t\tvar shortcuts = gantt.$keyboardNavigation.shortcuts;\r\n\t\t\tvar hash = shortcuts.getHash(command);\r\n\r\n\t\t\treturn this._handlers[hash];\r\n\t\t},\r\n\r\n\t\tdoAction: function (command, e) {\r\n\t\t\tvar handler = this.findHandler(command);\r\n\t\t\tif (handler) {\r\n\t\t\t\tvar eventFacade = gantt.$keyboardNavigation.facade;\r\n\r\n\t\t\t\tif(eventFacade.callEvent(\"onBeforeAction\", [command, e]) === false){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\thandler.call(this, e);\r\n\r\n\t\t\t\tif (e.preventDefault) e.preventDefault();\r\n\t\t\t\telse e.returnValue = false;\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\tbind: function (shortcut, handler) {\r\n\t\t\tif (!this._handlers) this._handlers = {};\r\n\r\n\t\t\tvar shortcuts = gantt.$keyboardNavigation.shortcuts;\r\n\r\n\t\t\tvar commands = shortcuts.parse(shortcut);\r\n\t\t\tfor (var i = 0; i < commands.length; i++) {\r\n\t\t\t\tthis._handlers[shortcuts.getHash(commands[i])] = handler;\r\n\t\t\t}\r\n\t\t},\r\n\t\tunbind: function (shortcut) {\r\n\t\t\tvar shortcuts = gantt.$keyboardNavigation.shortcuts;\r\n\r\n\t\t\tvar commands = shortcuts.parse(shortcut);\r\n\t\t\tfor (var i = 0; i < commands.length; i++) {\r\n\t\t\t\tif (this._handlers[shortcuts.getHash(commands[i])]) {\r\n\t\t\t\t\tdelete this._handlers[shortcuts.getHash(commands[i])];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tbindAll: function (map) {\r\n\t\t\tfor (var i in map) {\r\n\t\t\t\tthis.bind(i, map[i]);\r\n\t\t\t}\r\n\t\t},\r\n\t\tinitKeys: function () {\r\n\t\t\tif (!this._handlers)\r\n\t\t\t\tthis._handlers = {};\r\n\t\t\tif (this.keys) {\r\n\t\t\t\tthis.bindAll(this.keys);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n};","import * as domHelpers from \"../../../core/ui/utils/dom_helpers\";\r\n\r\nexport default function(gantt) {\r\n\r\n\t(function () {\r\n\t\t\r\n\t\tgantt.$keyboardNavigation.getFocusableNodes = domHelpers.getFocusableNodes;\r\n\r\n\t\tgantt.$keyboardNavigation.trapFocus = function trapFocus(root, e) {\r\n\t\t\tif (e.keyCode != 9) return false;\r\n\r\n\t\t\tvar focusable = gantt.$keyboardNavigation.getFocusableNodes(root);\r\n\t\t\tvar currentFocus = domHelpers.getActiveElement();\r\n\t\t\tvar currentIndex = -1;\r\n\t\t\tfor (var i = 0; i < focusable.length; i++) {\r\n\t\t\t\tif (focusable[i] == currentFocus) {\r\n\t\t\t\t\tcurrentIndex = i;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (e.shiftKey) {\r\n\t\t\t\t// back tab\r\n\t\t\t\tif (currentIndex <= 0) {\r\n\t\t\t\t\t// go to the last element if we focused on the first\r\n\t\t\t\t\tvar lastItem = focusable[focusable.length - 1];\r\n\t\t\t\t\tif (lastItem) {\r\n\t\t\t\t\t\tlastItem.focus();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\t\t\t\t// forward tab\r\n\t\t\t\tif (currentIndex >= focusable.length - 1) {\r\n\t\t\t\t\t// forward tab from last element should go back to the first element\r\n\t\t\t\t\tvar firstItem = focusable[0];\r\n\t\t\t\t\tif (firstItem) {\r\n\t\t\t\t\t\tfirstItem.focus();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t};\r\n\t})();\r\n\r\n};","export default function(gantt) {\r\n\r\n\tgantt.$keyboardNavigation.GanttNode = function () {\r\n\t};\r\n\r\n\tgantt.$keyboardNavigation.GanttNode.prototype = gantt._compose(\r\n\t\tgantt.$keyboardNavigation.EventHandler,\r\n\t\t{\r\n\r\n\t\t\tfocus: function () {\r\n\t\t\t\tgantt.focus();\r\n\t\t\t},\r\n\r\n\t\t\tblur: function () {\r\n\r\n\t\t\t},\r\n\r\n\t\t\tisEnabled: function () {\r\n\t\t\t\treturn gantt.$container.hasAttribute(\"tabindex\");\r\n\t\t\t},\r\n\r\n\t\t\tscrollHorizontal: function scrollHorizontal(dir) {\r\n\t\t\t\tvar date = gantt.dateFromPos(gantt.getScrollState().x);\r\n\t\t\t\tvar scale = gantt.getScale();\r\n\t\t\t\tvar step = dir < 0 ? -scale.step : scale.step;\r\n\t\t\t\tdate = gantt.date.add(date, step, scale.unit);\r\n\t\t\t\tgantt.scrollTo(gantt.posFromDate(date));\r\n\t\t\t},\r\n\r\n\t\t\tscrollVertical: function scrollVertical(dir) {\r\n\t\t\t\tvar top = gantt.getScrollState().y;\r\n\t\t\t\tvar step = gantt.config.row_height;\r\n\t\t\t\tgantt.scrollTo(null, top + (dir < 0 ? -1 : 1) * step);\r\n\t\t\t},\r\n\r\n\t\t\tkeys: {\r\n\t\t\t\t\"alt+left\": function (e) {\r\n\t\t\t\t\tthis.scrollHorizontal(-1);\r\n\t\t\t\t},\r\n\t\t\t\t\"alt+right\": function (e) {\r\n\t\t\t\t\tthis.scrollHorizontal(1);\r\n\t\t\t\t},\r\n\t\t\t\t\"alt+up\": function (e) {\r\n\t\t\t\t\tthis.scrollVertical(-1);\r\n\t\t\t\t},\r\n\t\t\t\t\"alt+down\": function (e) {\r\n\t\t\t\t\tthis.scrollVertical(1);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// undo\r\n\t\t\t\t\"ctrl+z\": function () {\r\n\t\t\t\t\tif (gantt.undo) gantt.undo();\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// redo\r\n\t\t\t\t\"ctrl+r\": function () {\r\n\t\t\t\t\tif (gantt.redo) gantt.redo();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\r\n\tgantt.$keyboardNavigation.GanttNode.prototype.bindAll(gantt.$keyboardNavigation.GanttNode.prototype.keys);\r\n\r\n};","export default function(gantt) {\r\n\r\n\tgantt.$keyboardNavigation.KeyNavNode = function () {\r\n\t};\r\n\r\n\tgantt.$keyboardNavigation.KeyNavNode.prototype = gantt._compose(\r\n\t\tgantt.$keyboardNavigation.EventHandler,\r\n\t\t{\r\n\t\t\tisValid: function () {\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t\tfallback: function () {\r\n\t\t\t\treturn null;\r\n\t\t\t},\r\n\r\n\t\t\tmoveTo: function (element) {\r\n\t\t\t\tgantt.$keyboardNavigation.dispatcher.setActiveNode(element);\r\n\t\t\t},\r\n\r\n\t\t\tcompareTo: function (b) {\r\n\t\t\t\t// good enough comparison of two random objects\r\n\t\t\t\tif (!b) return false;\r\n\t\t\t\tfor (var i in this) {\r\n\t\t\t\t\tif (!!this[i] != !!b[i]) return false;\r\n\r\n\t\t\t\t\tvar canStringifyThis = !!(this[i] && this[i].toString);\r\n\t\t\t\t\tvar canStringifyThat = !!(b[i] && b[i].toString);\r\n\t\t\t\t\tif (canStringifyThat != canStringifyThis) return false;\r\n\t\t\t\t\tif (!(canStringifyThat && canStringifyThis)) {\r\n\t\t\t\t\t\tif (b[i] != this[i]) return false;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (b[i].toString() != this[i].toString())\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\r\n\t\t\tgetNode: function () {\r\n\t\t\t},\r\n\t\t\tfocus: function () {\r\n\t\t\t\tvar node = this.getNode();\r\n\t\t\t\tif(!node)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tvar eventFacade = gantt.$keyboardNavigation.facade;\r\n\r\n\t\t\t\tif(eventFacade.callEvent(\"onBeforeFocus\", [node]) === false){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (node) {\r\n\t\t\t\t\tnode.setAttribute(\"tabindex\", \"-1\");\r\n\t\t\t\t\tif(!node.$eventAttached){\r\n\t\t\t\t\t\tnode.$eventAttached = true;\r\n\t\t\t\t\t\tgantt.event(node, \"focus\",function(e){\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}, false);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//node.className += \" gantt_focused\";\r\n\t\t\t\t\tif (gantt.utils.dom.isChildOf(document.activeElement, node)){\r\n\t\t\t\t\t\tnode = document.activeElement;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (node.focus) node.focus();\r\n\r\n\t\t\t\t\teventFacade.callEvent(\"onFocus\", [this.getNode()]);\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\t\t\tblur: function () {\r\n\t\t\t\tvar node = this.getNode();\r\n\t\t\t\tif (node) {\r\n\t\t\t\t\tvar eventFacade = gantt.$keyboardNavigation.facade;\r\n\t\t\t\t\teventFacade.callEvent(\"onBlur\", [node]);\r\n\t\t\t\t\tnode.setAttribute(\"tabindex\", \"-1\");\r\n\t\t\t\t\t//node.className = (node.className || \"\").replace(/ ?gantt_focused/g, \"\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\r\n};","import * as domHelpers from \"../../../core/ui/utils/dom_helpers\";\r\n\r\nexport default function(gantt) {\r\n\r\n\tgantt.$keyboardNavigation.HeaderCell = function (index) {\r\n\t\tthis.index = index || 0;\r\n\t};\r\n\r\n\tgantt.$keyboardNavigation.HeaderCell.prototype = gantt._compose(\r\n\t\tgantt.$keyboardNavigation.KeyNavNode,\r\n\t\t{\r\n\t\t\t_handlers: null,\r\n\r\n\t\t\tisValid: function () {\r\n\t\t\t\tif (!gantt.config.show_grid) {\r\n\t\t\t\t\tif (gantt.getVisibleTaskCount())\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\treturn !!gantt.getGridColumns()[this.index] || !gantt.getVisibleTaskCount();\r\n\t\t\t},\r\n\t\t\tfallback: function () {\r\n\t\t\t\tif (!gantt.config.show_grid) {\r\n\t\t\t\t\tif (gantt.getVisibleTaskCount()) {\r\n\t\t\t\t\t\treturn new gantt.$keyboardNavigation.TaskRow();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t\tvar visibleColumns = gantt.getGridColumns();\r\n\t\t\t\tvar index = this.index;\r\n\t\t\t\twhile (index >= 0) {\r\n\t\t\t\t\tif (visibleColumns[index])\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tindex--;\r\n\t\t\t\t}\r\n\t\t\t\tif (visibleColumns[index]) {\r\n\t\t\t\t\treturn new gantt.$keyboardNavigation.HeaderCell(index);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tfromDomElement: function(el){\r\n\t\t\t\tvar cellElement = domHelpers.locateClassName(el, \"gantt_grid_head_cell\");\r\n\t\t\t\tif(cellElement){\r\n\t\t\t\t\tvar index = 0;\r\n\t\t\t\t\twhile(cellElement && cellElement.previousSibling){\r\n\t\t\t\t\t\tcellElement = cellElement.previousSibling;\r\n\t\t\t\t\t\tindex += 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn new gantt.$keyboardNavigation.HeaderCell(index);\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tgetNode: function () {\r\n\t\t\t\tconst scale = gantt.$grid_scale;\r\n\t\t\t\tif (!scale){\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t\tconst cells = scale.childNodes;\r\n\t\t\t\treturn cells[this.index];\r\n\t\t\t},\r\n\r\n\r\n\t\t\tkeys: {\r\n\r\n\t\t\t\t\"left\": function () {\r\n\t\t\t\t\tif (this.index > 0) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.HeaderCell(this.index - 1));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"right\": function () {\r\n\t\t\t\t\tvar columns = gantt.getGridColumns();\r\n\t\t\t\t\tif (this.index < columns.length - 1) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.HeaderCell(this.index + 1));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"down\": function () {\r\n\t\t\t\t\tvar taskRow;\r\n\t\t\t\t\tvar rootLevel = gantt.getChildren(gantt.config.root_id);\r\n\t\t\t\t\tif (gantt.isTaskExists(rootLevel[0])) {\r\n\t\t\t\t\t\ttaskRow = rootLevel[0];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (taskRow) {\r\n\t\t\t\t\t\tif (gantt.config.keyboard_navigation_cells) {\r\n\t\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(taskRow, this.index));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskRow(taskRow));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\t\"end\": function () {\r\n\t\t\t\t\tvar columns = gantt.getGridColumns();\r\n\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.HeaderCell(columns.length - 1));\r\n\t\t\t\t},\r\n\t\t\t\t\"home\": function () {\r\n\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.HeaderCell(0));\r\n\t\t\t\t},\r\n\r\n\r\n\t\t\t\t// press header button\r\n\t\t\t\t\"enter, space\": function () {\r\n\t\t\t\t\tvar node = domHelpers.getActiveElement();\r\n\t\t\t\t\tnode.click();\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// add new task\r\n\t\t\t\t\"ctrl+enter\": function () {\r\n\t\t\t\t\tif (gantt.isReadonly(this)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgantt.createTask({}, this.taskId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\r\n\tgantt.$keyboardNavigation.HeaderCell.prototype.bindAll(gantt.$keyboardNavigation.HeaderCell.prototype.keys);\r\n\r\n};","export default function(gantt) {\r\n\r\n\tgantt.$keyboardNavigation.TaskRow = function (taskId) {\r\n\t\tif (!taskId) {\r\n\t\t\tvar rootLevel = gantt.getChildren(gantt.config.root_id);\r\n\t\t\tif (rootLevel[0]) {\r\n\t\t\t\ttaskId = rootLevel[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.taskId = taskId;\r\n\t\tif (gantt.isTaskExists(this.taskId)) {\r\n\t\t\tthis.index = gantt.getTaskIndex(this.taskId);\r\n\t\t\tthis.globalIndex = gantt.getGlobalTaskIndex(this.taskId);\r\n\t\t\tthis.splitItem = !!gantt.getTask(this.taskId).$split_subtask;\r\n\t\t\tthis.parentId = gantt.getParent(this.taskId);\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.$keyboardNavigation.TaskRow.prototype = gantt._compose(\r\n\t\tgantt.$keyboardNavigation.KeyNavNode,\r\n\t\t{\r\n\t\t\t_handlers: null,\r\n\t\t\tisValid: function () {\r\n\t\t\t\treturn gantt.isTaskExists(this.taskId) && (gantt.getTaskIndex(this.taskId) > -1);\r\n\t\t\t},\r\n\t\t\tfallback: function () {\r\n\t\t\t\tif (!gantt.getVisibleTaskCount()) {\r\n\t\t\t\t\tvar header = new gantt.$keyboardNavigation.HeaderCell();\r\n\t\t\t\t\tif (!header.isValid()) return null;\r\n\t\t\t\t\telse return header;\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tif(!this.splitItem){\r\n\t\t\t\t\t\tvar nextIndex = -1;\r\n\t\t\t\t\t\t// GS-1393. When Gantt tries to restore the focus, it should rely on the global index\r\n\t\t\t\t\t\tif (gantt.getTaskByIndex(this.globalIndex - 1)) {\r\n\t\t\t\t\t\t\tnextIndex = this.globalIndex - 1;\r\n\t\t\t\t\t\t} else if (gantt.getTaskByIndex(this.globalIndex + 1)) {\r\n\t\t\t\t\t\t\tnextIndex = this.globalIndex + 1;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar globalIndex = this.globalIndex;\r\n\t\t\t\t\t\t\twhile (globalIndex >= 0) {\r\n\t\t\t\t\t\t\t\tif (gantt.getTaskByIndex(globalIndex)) {\r\n\t\t\t\t\t\t\t\t\tnextIndex = globalIndex;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tglobalIndex--;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (nextIndex > -1) {\r\n\t\t\t\t\t\t\treturn new gantt.$keyboardNavigation.TaskRow(gantt.getTaskByIndex(nextIndex).id);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\t\treturn new gantt.$keyboardNavigation.TaskRow(this.parentId);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tfromDomElement: function(el){\r\n\t\t\t\tif(gantt.config.keyboard_navigation_cells){\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar taskId = gantt.locate(el);\r\n\t\t\t\tif(gantt.isTaskExists(taskId)){\r\n\t\t\t\t\treturn new gantt.$keyboardNavigation.TaskRow(taskId);\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tgetNode: function () {\r\n\t\t\t\tif (gantt.isTaskExists(this.taskId) && gantt.isTaskVisible(this.taskId)) {\r\n\t\t\t\t\tif (gantt.config.show_grid) {\r\n\t\t\t\t\t\treturn gantt.$grid.querySelector(`.gantt_row[${gantt.config.task_attribute}=\"${String(this.taskId).replaceAll('\"', '\\\\\"')}\"]`);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn gantt.getTaskNode(this.taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tfocus: function (keptFocus) {\r\n\t\t\t\tif(!keptFocus) {\r\n\t\t\t\t\tconst pos = gantt.getTaskPosition(gantt.getTask(this.taskId));\r\n\t\t\t\t\tconst height = gantt.getTaskHeight(this.taskId);\r\n\t\t\t\t\tconst scroll = gantt.getScrollState();\r\n\r\n\t\t\t\t\tlet viewWidth;\r\n\t\t\t\t\tif(gantt.$task){\r\n\t\t\t\t\t\tviewWidth = gantt.$task.offsetWidth;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tviewWidth = scroll.inner_width;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet viewHeight;\r\n\t\t\t\t\tif(gantt.$grid_data || gantt.$task_data){\r\n\t\t\t\t\t\tviewHeight = (gantt.$grid_data || gantt.$task_data).offsetHeight;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tviewHeight = scroll.inner_height;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst visibleTimeline = gantt.config.show_chart && gantt.$ui.getView(\"timeline\");\r\n\r\n\t\t\t\t\tif (pos.top < scroll.y || pos.top + height > (scroll.y + viewHeight)) {\r\n\t\t\t\t\t\t// GS-2346: additional scrolling to be sure that the task will be in the required range\r\n\t\t\t\t\t\tgantt.scrollTo(null, pos.top - 20);\r\n\t\t\t\t\t} else if (gantt.config.scroll_on_click && visibleTimeline) {\r\n\t\t\t\t\t\t// horizontal scroll activated\r\n\t\t\t\t\t\tif (pos.left > (scroll.x + viewWidth)) { // scroll forward to the start of the task\r\n\t\t\t\t\t\t\tgantt.scrollTo(pos.left - gantt.config.task_scroll_offset);\r\n\t\t\t\t\t\t} else if (pos.left + pos.width < scroll.x) {  // scroll back to the end of the task\r\n\t\t\t\t\t\t\tgantt.scrollTo(pos.left + pos.width - gantt.config.task_scroll_offset);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgantt.$keyboardNavigation.KeyNavNode.prototype.focus.apply(this, [keptFocus]);\r\n\r\n\t\t\t\t// GS-152 if there are scrollbars with custom names, change their scroll position\r\n\t\t\t\tscrollGrid();\r\n\r\n\t\t\t\tfunction scrollGrid() {\r\n\t\t\t\t\tvar grid = gantt.$ui.getView(\"grid\");\r\n\t\t\t\t\tif (!grid || !grid.$grid_data){\r\n\t\t\t\t\t\t// GS-1805. Don't try to focus the row that doesn't exist\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar scrollPositionX = parseInt(grid.$grid.scrollLeft);\r\n\t\t\t\t\tvar scrollPositionY = parseInt(grid.$grid_data.scrollTop);\r\n\r\n\t\t\t\t\tvar attachedScrollbarHorizontal = grid.$config.scrollX;\r\n\r\n\t\t\t\t\tif (attachedScrollbarHorizontal && grid.$config.scrollable) {\r\n\t\t\t\t\t\tvar scrollbarHorizontal = gantt.$ui.getView(attachedScrollbarHorizontal);\r\n\t\t\t\t\t\tif (scrollbarHorizontal) {\r\n\t\t\t\t\t\t\tscrollbarHorizontal.scrollTo(scrollPositionX, scrollPositionY);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar attachedScrollbarVertical = grid.$config.scrollY;\r\n\r\n\t\t\t\t\tif (attachedScrollbarVertical) {\r\n\t\t\t\t\t\tvar scrollbarVertical = gantt.$ui.getView(attachedScrollbarVertical);\r\n\t\t\t\t\t\tif (scrollbarVertical) {\r\n\t\t\t\t\t\t\tscrollbarVertical.scrollTo(scrollPositionX, scrollPositionY);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\r\n\t\t\tkeys: {\r\n\t\t\t\t\"pagedown\": function () {\r\n\t\t\t\t\tif (gantt.getVisibleTaskCount()) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskRow(gantt.getTaskByIndex(gantt.getVisibleTaskCount() - 1).id));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"pageup\": function () {\r\n\t\t\t\t\tif (gantt.getVisibleTaskCount()) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskRow(gantt.getTaskByIndex(0).id));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"up\": function () {\r\n\t\t\t\t\tvar nextElement = null;\r\n\t\t\t\t\tvar prevTask = gantt.getPrev(this.taskId);\r\n\t\t\t\t\tif (!gantt.isTaskExists(prevTask)) {\r\n\t\t\t\t\t\tnextElement = new gantt.$keyboardNavigation.HeaderCell();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnextElement = new gantt.$keyboardNavigation.TaskRow(prevTask);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.moveTo(nextElement);\r\n\t\t\t\t},\r\n\t\t\t\t\"down\": function () {\r\n\t\t\t\t\tvar nextTask = gantt.getNext(this.taskId);\r\n\t\t\t\t\tif (gantt.isTaskExists(nextTask)) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskRow(nextTask));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\t\"shift+down\": function(){\r\n\t\t\t\t\tif(gantt.hasChild(this.taskId) && !gantt.getTask(this.taskId).$open){\r\n\t\t\t\t\t\tgantt.open(this.taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"shift+up\": function(){\r\n\t\t\t\t\tif(gantt.hasChild(this.taskId) && gantt.getTask(this.taskId).$open){\r\n\t\t\t\t\t\tgantt.close(this.taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"shift+right\": function() {\r\n\t\t\t\t\tif (gantt.isReadonly(this)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar prevId = gantt.getPrevSibling(this.taskId);\r\n\t\t\t\t\tif(gantt.isTaskExists(prevId) && !gantt.isChildOf(this.taskId, prevId)){\r\n\t\t\t\t\t\tvar parent = gantt.getTask(prevId);\r\n\t\t\t\t\t\tparent.$open = true;\r\n\t\t\t\t\t\tvar result = gantt.moveTask(this.taskId, -1, prevId);\r\n\t\t\t\t\t\tif(result !== false)\r\n\t\t\t\t\t\t\tgantt.updateTask(this.taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"shift+left\": function() {\r\n\t\t\t\t\tif (gantt.isReadonly(this)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar parent = gantt.getParent(this.taskId);\r\n\t\t\t\t\tif(gantt.isTaskExists(parent)){\r\n\t\t\t\t\t\tvar result =  gantt.moveTask(this.taskId, gantt.getTaskIndex(parent) + 1, gantt.getParent(parent));\r\n\t\t\t\t\t\tif(result !== false)\r\n\t\t\t\t\t\t\tgantt.updateTask(this.taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// select\r\n\t\t\t\t\"space\": function (e) {\r\n\t\t\t\t\tif (!gantt.isSelectedTask(this.taskId)) {\r\n\t\t\t\t\t\tgantt.selectTask(this.taskId);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tgantt.unselectTask(this.taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// collapse\r\n\t\t\t\t\"ctrl+left\": function (e) {\r\n\t\t\t\t\tgantt.close(this.taskId);\r\n\t\t\t\t},\r\n\t\t\t\t// expand\r\n\t\t\t\t\"ctrl+right\": function (e) {\r\n\t\t\t\t\tgantt.open(this.taskId);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// delete task\r\n\t\t\t\t\"delete\": function (e) {\r\n\t\t\t\t\tif (gantt.isReadonly(this)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgantt.$click.buttons[\"delete\"](this.taskId);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// open lightbox\r\n\t\t\t\t\"enter\": function () {\r\n\t\t\t\t\tif (gantt.isReadonly(this)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgantt.showLightbox(this.taskId);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// add subtask\r\n\t\t\t\t\"ctrl+enter\": function () {\r\n\t\t\t\t\tif (gantt.isReadonly(this)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgantt.createTask({}, this.taskId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\tgantt.$keyboardNavigation.TaskRow.prototype.bindAll(gantt.$keyboardNavigation.TaskRow.prototype.keys);\r\n\r\n};","import * as domHelpers from \"../../../core/ui/utils/dom_helpers\";\r\nimport {replaceValidZeroId} from \"../../../utils/helpers\";\r\n\r\nexport default function(gantt) {\r\n\r\n\r\n\tgantt.$keyboardNavigation.TaskCell = function (taskId, index) {\r\n\t\ttaskId = replaceValidZeroId(taskId, gantt.config.root_id);\r\n\t\tif (!taskId) {\r\n\t\t\tvar rootLevel = gantt.getChildren(gantt.config.root_id);\r\n\t\t\tif (rootLevel[0]) {\r\n\t\t\t\ttaskId = rootLevel[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.taskId = taskId;\r\n\t\tthis.columnIndex = index || 0;\r\n\t\t// provided task may not exist, in this case node will be detectes as invalid\r\n\t\tif (gantt.isTaskExists(this.taskId)) {\r\n\t\t\tthis.index = gantt.getTaskIndex(this.taskId);\r\n\t\t\tthis.globalIndex = gantt.getGlobalTaskIndex(this.taskId);\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.$keyboardNavigation.TaskCell.prototype = gantt._compose(\r\n\t\tgantt.$keyboardNavigation.TaskRow,\r\n\t\t{\r\n\t\t\t_handlers: null,\r\n\t\t\tisValid: function () {\r\n\r\n\t\t\t\treturn gantt.$keyboardNavigation.TaskRow.prototype.isValid.call(this) && !!gantt.getGridColumns()[this.columnIndex];\r\n\t\t\t},\r\n\t\t\tfallback: function () {\r\n\r\n\t\t\t\tvar node = gantt.$keyboardNavigation.TaskRow.prototype.fallback.call(this);\r\n\t\t\t\tvar result = node;\r\n\t\t\t\tif (node instanceof gantt.$keyboardNavigation.TaskRow) {\r\n\t\t\t\t\tvar visibleColumns = gantt.getGridColumns();\r\n\t\t\t\t\tvar index = this.columnIndex;\r\n\t\t\t\t\twhile (index >= 0) {\r\n\t\t\t\t\t\tif (visibleColumns[index])\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tindex--;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (visibleColumns[index]) {\r\n\t\t\t\t\t\tresult = new gantt.$keyboardNavigation.TaskCell(node.taskId, index);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn result;\r\n\t\t\t},\r\n\r\n\t\t\tfromDomElement: function(el){\r\n\t\t\t\tif(!gantt.config.keyboard_navigation_cells){\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar taskId = gantt.locate(el);\r\n\t\t\t\tif(gantt.isTaskExists(taskId)){\r\n\t\t\t\t\tvar index = 0;\r\n\t\t\t\t\tvar cellElement = domHelpers.locateAttribute(el, \"data-column-index\");\r\n\r\n\t\t\t\t\tif(cellElement){\r\n\t\t\t\t\t\tindex = cellElement.getAttribute(\"data-column-index\")*1;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn new gantt.$keyboardNavigation.TaskCell(taskId, index);\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tgetNode: function () {\r\n\t\t\t\tif (gantt.isTaskExists(this.taskId) && (gantt.isTaskVisible(this.taskId) || gantt.config.show_tasks_outside_timescale)) {\r\n\t\t\t\t\tif (gantt.config.show_grid && gantt.$grid) {\r\n\t\t\t\t\t\tvar row = gantt.$grid.querySelector(\".gantt_row[\" + gantt.config.task_attribute + \"='\" + this.taskId + \"']\");\r\n\t\t\t\t\t\tif(!row)\r\n\t\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t\treturn row.querySelector(\"[data-column-index='\"+this.columnIndex+\"']\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn gantt.getTaskNode(this.taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tkeys: {\r\n\t\t\t\t\"up\": function () {\r\n\r\n\t\t\t\t\tvar nextElement = null;\r\n\t\t\t\t\tvar prevTask = gantt.getPrev(this.taskId);\r\n\t\t\t\t\tif (!gantt.isTaskExists(prevTask)) {\r\n\t\t\t\t\t\tnextElement = new gantt.$keyboardNavigation.HeaderCell(this.columnIndex);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnextElement = new gantt.$keyboardNavigation.TaskCell(prevTask, this.columnIndex);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.moveTo(nextElement);\r\n\t\t\t\t},\r\n\t\t\t\t\"down\": function () {\r\n\t\t\t\t\tvar nextTask = gantt.getNext(this.taskId);\r\n\t\t\t\t\tif (gantt.isTaskExists(nextTask)) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(nextTask, this.columnIndex));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"left\": function () {\r\n\t\t\t\t\tif (this.columnIndex > 0) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(this.taskId, this.columnIndex - 1));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"right\": function () {\r\n\t\t\t\t\tvar columns = gantt.getGridColumns();\r\n\t\t\t\t\tif (this.columnIndex < columns.length - 1) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(this.taskId, this.columnIndex + 1));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\t\"end\": function () {\r\n\t\t\t\t\tvar columns = gantt.getGridColumns();\r\n\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(this.taskId, columns.length - 1));\r\n\t\t\t\t},\r\n\t\t\t\t\"home\": function () {\r\n\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(this.taskId, 0));\r\n\t\t\t\t},\r\n\t\t\t\t\"pagedown\": function () {\r\n\t\t\t\t\tif (gantt.getVisibleTaskCount()) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(gantt.getTaskByIndex(gantt.getVisibleTaskCount() - 1).id, this.columnIndex));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"pageup\": function () {\r\n\t\t\t\t\tif (gantt.getVisibleTaskCount()) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(gantt.getTaskByIndex(0).id, this.columnIndex));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\r\n\r\n\tgantt.$keyboardNavigation.TaskCell.prototype.bindAll(gantt.$keyboardNavigation.TaskRow.prototype.keys);\r\n\tgantt.$keyboardNavigation.TaskCell.prototype.bindAll(gantt.$keyboardNavigation.TaskCell.prototype.keys);\r\n\r\n};","export default function(gantt) {\r\n\r\n\tgantt.$keyboardNavigation.dispatcher = {\r\n\t\tisActive: false,\r\n\t\tactiveNode: null,\r\n\t\tglobalNode: new gantt.$keyboardNavigation.GanttNode(),\r\n\r\n\t\tenable: function () {\r\n\t\t\tthis.isActive = true;\r\n\t\t\tthis.setActiveNode(this.getActiveNode());\r\n\t\t},\r\n\r\n\t\tdisable: function () {\r\n\t\t\tthis.isActive = false;\r\n\t\t},\r\n\r\n\t\tisEnabled: function () {\r\n\t\t\treturn !!this.isActive;\r\n\t\t},\r\n\r\n\t\tgetDefaultNode: function () {\r\n\t\t\tvar node;\r\n\t\t\tif (gantt.config.keyboard_navigation_cells) {\r\n\t\t\t\tnode = new gantt.$keyboardNavigation.TaskCell();\r\n\t\t\t} else {\r\n\t\t\t\tnode = new gantt.$keyboardNavigation.TaskRow();\r\n\t\t\t}\r\n\r\n\t\t\tif (!node.isValid()) {\r\n\t\t\t\tnode = node.fallback();\r\n\t\t\t}\r\n\t\t\treturn node;\r\n\t\t},\r\n\r\n\t\tsetDefaultNode: function () {\r\n\t\t\tthis.setActiveNode(this.getDefaultNode());\r\n\t\t},\r\n\r\n\t\tgetActiveNode: function () {\r\n\t\t\tvar node = this.activeNode;\r\n\t\t\tif (node && !node.isValid()) {\r\n\t\t\t\tnode = node.fallback();\r\n\t\t\t}\r\n\t\t\treturn node;\r\n\t\t},\r\n\r\n\t\tfromDomElement: function(e){\r\n\t\t\tvar inputs = [\r\n\t\t\t\tgantt.$keyboardNavigation.TaskRow,\r\n\t\t\t\tgantt.$keyboardNavigation.TaskCell,\r\n\t\t\t\tgantt.$keyboardNavigation.HeaderCell\r\n\t\t\t];\r\n\t\t\tfor(var i = 0; i < inputs.length; i++){\r\n\t\t\t\tif(inputs[i].prototype.fromDomElement){\r\n\t\t\t\t\tvar node = inputs[i].prototype.fromDomElement(e);\r\n\t\t\t\t\tif(node) return node;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\r\n\t\tfocusGlobalNode: function () {\r\n\t\t\tthis.blurNode(this.globalNode);\r\n\t\t\tthis.focusNode(this.globalNode);\r\n\t\t},\r\n\r\n\t\tsetActiveNode: function (el) {\r\n\t\t\t//console.trace()\r\n\t\t\tvar focusChanged = true;\r\n\t\t\tif (this.activeNode) {\r\n\t\t\t\tif (this.activeNode.compareTo(el)) {\r\n\t\t\t\t\tfocusChanged = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.isEnabled()) {\r\n\t\t\t\tif(focusChanged)\r\n\t\t\t\t\tthis.blurNode(this.activeNode);\r\n\r\n\t\t\t\tthis.activeNode = el;\r\n\t\t\t\tthis.focusNode(this.activeNode, !focusChanged);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tfocusNode: function (el, keptFocus) {\r\n\t\t\tif (el && el.focus) {\r\n\t\t\t\tel.focus(keptFocus);\r\n\t\t\t}\r\n\t\t},\r\n\t\tblurNode: function (el) {\r\n\t\t\tif (el && el.blur) {\r\n\t\t\t\tel.blur();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tkeyDownHandler: function (e) {\r\n\r\n\t\t\tif (gantt.$keyboardNavigation.isModal())\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (!this.isEnabled())\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif(e.defaultPrevented){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar ganttNode = this.globalNode;\r\n\r\n\t\t\tvar command = gantt.$keyboardNavigation.shortcuts.getCommandFromEvent(e);\r\n\r\n\t\t\tvar activeElement = this.getActiveNode();\r\n\t\t\tvar eventFacade = gantt.$keyboardNavigation.facade;\r\n\t\t\tif(eventFacade.callEvent(\"onKeyDown\", [command, e]) === false){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (!activeElement) {\r\n\t\t\t\tthis.setDefaultNode();\r\n\t\t\t} else if (activeElement.findHandler(command)) {\r\n\t\t\t\tactiveElement.doAction(command, e);\r\n\t\t\t} else if (ganttNode.findHandler(command)) {\r\n\t\t\t\tganttNode.doAction(command, e);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\t_timeout: null,\r\n\t\tawaitsFocus: function(){\r\n\t\t\treturn this._timeout !== null;\r\n\t\t},\r\n\t\tdelay: function(callback, delay){\r\n\r\n\t\t\tclearTimeout(this._timeout);\r\n\t\t\tthis._timeout = setTimeout(gantt.bind(function(){\r\n\t\t\t\tthis._timeout = null;\r\n\t\t\t\tcallback();\r\n\t\t\t}, this)  , delay || 1);\r\n\r\n\t\t},\r\n\t\tclearDelay: function(){\r\n\t\t\tclearTimeout(this._timeout);\r\n\t\t}\r\n\t};\r\n\r\n};","import { QuickInfo } from \"./quickInfo\";\r\n\r\nexport default function(gantt: any){\r\n\r\nif (!gantt.ext) {\r\n\tgantt.ext = {};\r\n}\r\ngantt.ext.quickInfo = new QuickInfo(gantt);\r\n\r\ngantt.config.quickinfo_buttons = [\"icon_edit\", \"icon_delete\"];\r\ngantt.config.quick_info_detached = true;\r\ngantt.config.show_quick_info = true;\r\n\r\ngantt.templates.quick_info_title = function(start, end, ev){ return ev.text.substr(0,50); };\r\ngantt.templates.quick_info_content = function(start, end, ev){ return ev.details || ev.text; };\r\ngantt.templates.quick_info_date = function(start, end, ev){\r\n\treturn gantt.templates.task_time(start, end, ev);\r\n};\r\ngantt.templates.quick_info_class = function(start, end, task){ return \"\"; };\r\n\r\ngantt.attachEvent(\"onTaskClick\", function(id,e){\r\n\t// GS-1460 and GS-1787. Don't show Quick Info when clicking on the add, collapse, and expand buttons\r\n\tconst addButton = gantt.utils.dom.closest(e.target, \".gantt_add\");\r\n\tconst collapseButton = gantt.utils.dom.closest(e.target, \".gantt_close\");\r\n\tconst expandButton = gantt.utils.dom.closest(e.target, \".gantt_open\");\r\n\tconst showQuickInfo = !addButton && !collapseButton && !expandButton;\r\n\tif (showQuickInfo){\r\n\t\tsetTimeout(function() {\r\n\t\t\tgantt.ext.quickInfo.show(id);\r\n\t\t}, 0);\r\n\t}\r\n\r\n\treturn true;\r\n});\r\n\r\nconst events = [\"onViewChange\", \"onLightbox\", \"onBeforeTaskDelete\", \"onBeforeDrag\"];\r\nconst hidingFunction = function(){\r\n\tgantt.ext.quickInfo.hide();\r\n\treturn true;\r\n};\r\nfor (let i=0; i<events.length; i++){\r\n\tgantt.attachEvent(events[i], hidingFunction);\r\n}\r\n// GS-957: We don't want to hide QuickInfo when we click on it.\r\ngantt.attachEvent(\"onEmptyClick\", function(e){\r\n\tlet hideQuickInfo = true;\r\n\tconst parent = document.querySelector(\".gantt_cal_quick_info\");\r\n\tif (parent){\r\n\t\tconst quickInfoClick = gantt.utils.dom.isChildOf(e.target, parent);\r\n\t\tif (quickInfoClick){\r\n\t\t\thideQuickInfo = false;\r\n\t\t}\r\n\t}\r\n\tif (hideQuickInfo){\r\n\t\thidingFunction();\r\n\t}\r\n});\r\nfunction clearQuickInfo() {\r\n\tgantt.ext.quickInfo.hide();\r\n\tgantt.ext.quickInfo._quickInfoBox = null;\r\n\treturn true;\r\n}\r\ngantt.attachEvent(\"onGanttReady\", clearQuickInfo);\r\ngantt.attachEvent(\"onDestroy\", clearQuickInfo);\r\n\r\n// eslint-disable-next-line no-restricted-globals\r\ngantt.event(window, \"keydown\", function(e){\r\n\tif (e.keyCode === 27){\r\n\t\tgantt.ext.quickInfo.hide();\r\n\t}\r\n});\r\n\r\ngantt.showQuickInfo = function(){\r\n\tgantt.ext.quickInfo.show.apply(gantt.ext.quickInfo, arguments);\r\n};\r\ngantt.hideQuickInfo = function(){\r\n\tgantt.ext.quickInfo.hide.apply(gantt.ext.quickInfo, arguments);\r\n};\r\n\r\n}","import {TooltipManager} from \"./tooltipManager\";\r\n\r\nexport default function(gantt: any){\r\n\r\ngantt.config.tooltip_timeout = 30;\r\ngantt.config.tooltip_offset_y = 20;\r\ngantt.config.tooltip_offset_x = 10;\r\ngantt.config.tooltip_hide_timeout = 30;\r\n\r\n\r\n\r\nconst tooltipManager = new TooltipManager(gantt);\r\n\r\ngantt.ext.tooltips = tooltipManager;\r\n\r\ngantt.attachEvent(\"onGanttReady\", function(){\r\n\t//GS-2230: in case if `getGanttInstance` created without container\r\n\tif(!gantt.$root) return;\r\n\ttooltipManager.tooltipFor({\r\n\t\tselector: \"[\"+gantt.config.task_attribute+\"]:not(.gantt_task_row)\",\r\n\t\thtml: (event: MouseEvent) => {\r\n\t\t\tif (gantt.config.touch && !gantt.config.touch_tooltip) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst targetTaskId = gantt.locate(event);\r\n\t\t\tif(gantt.isTaskExists(targetTaskId)){\r\n\t\t\t\tconst task = gantt.getTask(targetTaskId);\r\n\t\t\t\treturn gantt.templates.tooltip_text(task.start_date, task.end_date, task);\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\tglobal: false\r\n\t});\r\n});\r\n\r\ngantt.attachEvent(\"onDestroy\", function() {\r\n\ttooltipManager.destructor();\r\n});\r\n\r\ngantt.attachEvent(\"onLightbox\", function() {\r\n\ttooltipManager.hideTooltip();\r\n});\r\nconst isLinkCreate = () => {\r\n\tconst state = gantt.getState();\r\n\treturn !!state.link_source_id;\r\n};\r\ngantt.attachEvent(\"onBeforeTooltip\", function() {\r\n\tif (isLinkCreate()){\r\n\t\treturn false;\r\n\t}\r\n});\r\n\r\ngantt.attachEvent(\"onGanttScroll\", function(){\r\n\ttooltipManager.hideTooltip();\r\n});\r\n\r\n}","import { Monitor } from \"./monitor\";\r\nimport { IMonitor, IUndoCommand, TEntityType, TUndoStack } from \"./types\";\r\nimport { Undo } from \"./undo\";\r\n\r\nexport default function(gantt: any){\r\n\r\nconst _undo = new Undo(gantt);\r\nconst monitor: IMonitor = new Monitor(_undo, gantt);\r\n\r\ngantt.config.undo = true;\r\ngantt.config.redo = true;\r\n\r\n/**\r\n * entities that require different processing for undoing-redoing changes\r\n * @type {{link: string, task: string}}\r\n */\r\ngantt.config.undo_types = {\r\n\tlink: \"link\",\r\n\ttask: \"task\"\r\n};\r\n\r\n/**\r\n * types of traced actions\r\n * @type {{update: string, remove: string, add: string}}\r\n */\r\ngantt.config.undo_actions = {\r\n\tupdate: \"update\",\r\n\tremove: \"remove\", // remove item from datastore\r\n\tadd: \"add\",\r\n\tmove: \"move\" // move task in grid\r\n};\r\n\r\nif (!gantt.ext) {\r\n\tgantt.ext = {};\r\n}\r\n\r\ngantt.ext.undo = {\r\n\tundo: () => _undo.undo(),\r\n\tredo: () => _undo.redo(),\r\n\tgetUndoStack: () => _undo.getUndoStack(),\r\n\tsetUndoStack: (stack:[]) => _undo.setUndoStack(stack),\r\n\tgetRedoStack: () => _undo.getRedoStack(),\r\n\tsetRedoStack: (stack:[]) => _undo.setRedoStack(stack),\r\n\tclearUndoStack: () => _undo.clearUndoStack(),\r\n\tclearRedoStack: () => _undo.clearRedoStack(),\r\n\tsaveState: (id: TaskID | LinkID, type: TEntityType) => monitor.store(id, type, true),\r\n\tgetInitialState: (id: TaskID | LinkID, type: TEntityType) => {\r\n\t\tif(type === gantt.config.undo_types.link){\r\n\t\t\treturn monitor.getInitialLink(id);\r\n\t\t}else{\r\n\t\t\treturn monitor.getInitialTask(id);\r\n\t\t}\r\n\t}\r\n};\r\n\r\ngantt.undo = gantt.ext.undo.undo;\r\ngantt.redo = gantt.ext.undo.redo;\r\ngantt.getUndoStack = gantt.ext.undo.getUndoStack;\r\ngantt.getRedoStack = gantt.ext.undo.getRedoStack;\r\ngantt.clearUndoStack = gantt.ext.undo.clearUndoStack;\r\ngantt.clearRedoStack = gantt.ext.undo.clearRedoStack;\r\n\r\nfunction isEqualIds(first: TaskID, second: TaskID){\r\n\treturn String(first) === String(second);\r\n};\r\n\r\nfunction updTask(task: ITask, oldId: TaskID, newId: TaskID) {\r\n\tif (!task) { return; }\r\n\r\n\tif (isEqualIds(task.id, oldId)) {\r\n\t\ttask.id = newId;\r\n\t}\r\n\r\n\tif (isEqualIds(task.parent, oldId)) {\r\n\t\ttask.parent = newId;\r\n\t}\r\n}\r\n\r\nfunction changeTaskCommandId(command: IUndoCommand, oldId: TaskID, newId: TaskID) {\r\n\tupdTask(command.value, oldId, newId);\r\n\tupdTask(command.oldValue, oldId, newId);\r\n}\r\n\r\nfunction updLink(link: ILink, oldTaskId: TaskID, newTaskId: TaskID) {\r\n\tif (!link) { return; }\r\n\tif (isEqualIds(link.source, oldTaskId)) {\r\n\t\tlink.source = newTaskId;\r\n\t}\r\n\tif (isEqualIds(link.target, oldTaskId)) {\r\n\t\tlink.target = newTaskId;\r\n\t}\r\n}\r\n\r\nfunction changeLinkCommandId(command: IUndoCommand, oldId: LinkID, newId: LinkID) {\r\n\tupdLink(command.value, oldId, newId);\r\n\tupdLink(command.oldValue, oldId, newId);\r\n}\r\n\r\nfunction updateTasksIds(log: TUndoStack, oldId: TaskID, newId: TaskID) {\r\n\tconst undo = _undo;\r\n\r\n\tfor (let i = 0; i < log.length; i++) {\r\n\t\tconst entry = log[i];\r\n\t\tfor (let j = 0; j < entry.commands.length; j++) {\r\n\t\t\tif (entry.commands[j].entity === undo.command.entity.task) {\r\n\t\t\t\tchangeTaskCommandId(entry.commands[j], oldId, newId);\r\n\t\t\t} else if (entry.commands[j].entity === undo.command.entity.link) {\r\n\t\t\t\tchangeLinkCommandId(entry.commands[j], oldId, newId);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction updateLinksIds(log: TUndoStack, oldId: LinkID, newId: LinkID) {\r\n\tconst undo = _undo;\r\n\r\n\tfor (let i = 0; i < log.length; i++) {\r\n\t\tconst entry = log[i];\r\n\t\tfor (let j = 0; j < entry.commands.length; j++) {\r\n\t\t\tconst command = entry.commands[j];\r\n\t\t\tif (command.entity === undo.command.entity.link) {\r\n\t\t\t\tif (command.value && command.value.id === oldId) {\r\n\t\t\t\t\tcommand.value.id = newId;\r\n\t\t\t\t}\r\n\t\t\t\tif (command.oldValue && command.oldValue.id === oldId) {\r\n\t\t\t\t\tcommand.oldValue.id = newId;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\ngantt.attachEvent(\"onTaskIdChange\", (oldId: TaskID, newId: TaskID) => {\r\n\tconst undo = _undo;\r\n\tupdateTasksIds(undo.getUndoStack(), oldId, newId);\r\n\tupdateTasksIds(undo.getRedoStack(), oldId, newId);\r\n});\r\n\r\ngantt.attachEvent(\"onLinkIdChange\", (oldId: LinkID, newId: LinkID) => {\r\n\tconst undo = _undo;\r\n\tupdateLinksIds(undo.getUndoStack(), oldId, newId);\r\n\tupdateLinksIds(undo.getRedoStack(), oldId, newId);\r\n});\r\n\r\ngantt.attachEvent(\"onGanttReady\", () => {\r\n\t_undo.updateConfigs();\r\n});\r\n\r\n}","\r\nexport default function(gantt){\r\n\r\nif(!gantt._markers) {\r\n\tgantt._markers = gantt.createDatastore({\r\n\t\tname: \"marker\",\r\n\t\tinitItem: function (marker) {\r\n\t\t\tmarker.id = marker.id || gantt.uid();\r\n\t\t\treturn marker;\r\n\t\t}\r\n\t});\r\n}\r\n\r\ngantt.config.show_markers = true;\r\n\r\nfunction render_marker(marker){\r\n\tif(!gantt.config.show_markers)\r\n\t\treturn false;\r\n\r\n\tif(!marker.start_date)\r\n\t\treturn false;\r\n\r\n\tvar state = gantt.getState();\r\n\tif(+marker.start_date > +state.max_date)\r\n\t\treturn;\r\n\tif((!marker.end_date || +marker.end_date < +state.min_date) && +marker.start_date < +state.min_date)\r\n\t\treturn;\r\n\r\n\tvar div = document.createElement(\"div\");\r\n\r\n\tdiv.setAttribute(\"data-marker-id\", marker.id);\r\n\r\n\tvar css = \"gantt_marker\";\r\n\tif(gantt.templates.marker_class)\r\n\t\tcss += \" \" + gantt.templates.marker_class(marker);\r\n\r\n\tif(marker.css){\r\n\t\tcss += \" \" + marker.css;\r\n\t}\r\n\r\n\tif(gantt.templates.marker_class)\r\n\t\tcss += \" \" + gantt.templates.marker_class(marker);\r\n\r\n\tif(marker.title){\r\n\t\tdiv.title = marker.title;\r\n\t}\r\n\tdiv.className = css;\r\n\r\n\tvar start = gantt.posFromDate(marker.start_date);\r\n\tdiv.style.left = start + \"px\";\r\n\tlet markerHeight = Math.max(gantt.getRowTop(gantt.getVisibleTaskCount()), 0) + \"px\";\r\n\tif (gantt.config.timeline_placeholder && gantt.$task_data){\r\n\t\tmarkerHeight = gantt.$task_data.scrollHeight + \"px\";\r\n\t}\r\n\tdiv.style.height = markerHeight;\r\n\tif(marker.end_date){\r\n\t\tvar end = gantt.posFromDate(marker.end_date);\r\n\t\tdiv.style.width = Math.max((end - start), 0) + \"px\";\r\n\r\n\t}\r\n\r\n\tif(marker.text){\r\n\t\tlet content = null;\r\n\t\tif(typeof marker.text === \"function\"){\r\n\t\t\tcontent = marker.text(marker);\r\n\t\t}else {\r\n\t\t\tcontent = marker.text;\r\n\t\t}\r\n\t\tif(content){\r\n\t\t\tif(gantt.config.external_render && gantt.config.external_render.isElement(content)){\r\n\t\t\t\tdiv.innerHTML = \"<div class='gantt_marker_content' ></div>\";\r\n\t\t\t\tgantt.config.external_render.renderElement(content, div.querySelector(\".gantt_marker_content\"));\r\n\t\t\t}else{\r\n\t\t\t\tdiv.innerHTML = \"<div class='gantt_marker_content' >\" + marker.text + \"</div>\";\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\r\n\t\t\r\n\t}\r\n\r\n\treturn div;\r\n}\r\n\r\nfunction initMarkerArea(){\r\n\t// GS-481. Reset $marker_area if there is no timeline\r\n\tif(!gantt.$task_data || !gantt.$root.contains(gantt.$task_data)){\r\n\t\tgantt.$marker_area = null;\r\n\t\treturn;\r\n\t}\r\n\r\n\t// GS-2084. Don't add $marker_area when it already exists\r\n\tif(gantt.$marker_area && gantt.$task_data.contains(gantt.$marker_area)){\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar markerArea = document.createElement(\"div\");\r\n\tmarkerArea.className = \"gantt_marker_area\";\r\n\tgantt.$task_data.appendChild(markerArea);\r\n\tgantt.$marker_area = markerArea;\r\n}\r\n\r\ngantt.attachEvent(\"onBeforeGanttRender\", function(){\r\n\tif(!gantt.$marker_area)\r\n\t\tinitMarkerArea();\r\n});\r\n\r\ngantt.attachEvent(\"onDataRender\", function(){\r\n\tif(!gantt.$marker_area){\r\n\t\tinitMarkerArea();\r\n\t\tgantt.renderMarkers();\r\n\t}\r\n});\r\n\r\ngantt.attachEvent(\"onGanttLayoutReady\", function(){\r\n\t// GS-1304 - markers should attach when layout is initialized, both on gantt.init and gantt.resetLayout\r\n\t// wait for \"onBeforeGanttRender\", so all layout elements will be in DOM\r\n\tgantt.attachEvent(\"onBeforeGanttRender\", function(){\r\n\t\t// GS-882. If markers are rendered in the onDataRender handler, \r\n\t\t// they are not attached to the layer, so we need to remove the DOM elements\r\n\t\tif (gantt.$marker_area) {\r\n\t\t\tgantt.$marker_area.innerHTML = \"\";\r\n\t\t}\r\n\t\tinitMarkerArea();\r\n\r\n\t\tvar layers = gantt.$services.getService(\"layers\");\r\n\t\tvar markerRenderer = layers.createDataRender({\r\n\t\t\tname: \"marker\",\r\n\t\t\tdefaultContainer: function(){ return gantt.$marker_area;}\r\n\t\t});\r\n\t\tmarkerRenderer.addLayer(render_marker);\r\n\t}, {once: true});\r\n});\r\n\r\ngantt.getMarker = function(id){\r\n\tif(!this._markers) return null;\r\n\r\n\treturn this._markers.getItem(id);\r\n};\r\n\r\ngantt.addMarker = function(marker){\r\n\treturn this._markers.addItem(marker);\r\n};\r\n\r\ngantt.deleteMarker = function(id){\r\n\tif(!this._markers.exists(id))\r\n\t\treturn false;\r\n\r\n\tthis._markers.removeItem(id);\r\n\treturn true;\r\n};\r\ngantt.updateMarker = function(id){\r\n\tthis._markers.refresh(id);\r\n};\r\n\r\ngantt._getMarkers = function(){\r\n\treturn this._markers.getItems();\r\n};\r\n\r\ngantt.renderMarkers = function () {\r\n\tthis._markers.refresh();\r\n};\r\n\r\n};","import {replaceValidZeroId} from \"../utils/helpers\";\r\n\r\nexport default function(gantt){\r\n\r\ngantt.config.multiselect = true;\r\ngantt.config.multiselect_one_level = false;\r\n\r\ngantt._multiselect = {\r\n\t_selected: {},\r\n\t_one_level: false,\r\n\t_active: true,\r\n\t_first_selected_when_shift: null,\r\n\tgetDefaultSelected: function() {\r\n\t\tvar selected = this.getSelected();\r\n\t\treturn selected.length ? selected[selected.length - 1] : null;\r\n\t},\r\n\tsetFirstSelected: function(id) {\r\n\t\tthis._first_selected_when_shift = id;\r\n\t},\r\n\tgetFirstSelected: function() {\r\n\t\treturn this._first_selected_when_shift;\r\n\t},\r\n\tisActive: function() {\r\n\t\tthis.updateState();\r\n\t\treturn this._active;\r\n\t},\r\n\tupdateState: function() {\r\n\t\tthis._one_level = gantt.config.multiselect_one_level;\r\n\t\tvar active = this._active;\r\n\t\tthis._active = gantt.config.select_task;\r\n\t\tif (this._active != active) {\r\n\t\t\tthis.reset();\r\n\t\t}\r\n\t},\r\n\treset: function () {\r\n\t\tthis._selected = {};\r\n\t},\r\n\tsetLastSelected: function (id) {\r\n\t\tgantt.$data.tasksStore.silent(function(){\r\n\t\t\tvar store = gantt.$data.tasksStore;\r\n\t\t\tif (id)\r\n\t\t\t\tstore.select(id+\"\");\r\n\t\t\telse\r\n\t\t\t\tstore.unselect(null);\r\n\t\t});\r\n\t},\r\n\tgetLastSelected: function () {\r\n\t\tvar last = gantt.$data.tasksStore.getSelectedId();\r\n\t\tif (last && gantt.isTaskExists(last))\r\n\t\t\treturn last;\r\n\t\treturn null;\r\n\t},\r\n\tselect: function (id, e) {\r\n\t\tif (id && gantt.callEvent(\"onBeforeTaskMultiSelect\", [id, true, e]) && gantt.callEvent(\"onBeforeTaskSelected\", [id])) {\r\n\t\t\tthis._selected[id] = true;\r\n\t\t\tthis.setLastSelected(id);\r\n\t\t\tthis.afterSelect(id);\r\n\t\t\tgantt.callEvent(\"onTaskMultiSelect\", [id, true, e]);\r\n\t\t\tgantt.callEvent(\"onTaskSelected\", [id]);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\ttoggle: function (id, e) {\r\n\t\tif (this._selected[id]) {\r\n\t\t\tthis.unselect(id, e);\r\n\t\t} else {\r\n\t\t\tthis.select(id, e);\r\n\t\t}\r\n\t},\r\n\tunselect: function (id, e) {\r\n\t\tif (id && gantt.callEvent(\"onBeforeTaskMultiSelect\", [id, false, e])) {\r\n\t\t\tthis._selected[id] = false;\r\n\t\t\tif (this.getLastSelected() == id)\r\n\t\t\t\tthis.setLastSelected(this.getDefaultSelected());\r\n\t\t\tthis.afterSelect(id);\r\n\t\t\tgantt.callEvent(\"onTaskMultiSelect\", [id, false, e]);\r\n\t\t\tgantt.callEvent(\"onTaskUnselected\", [id]);\r\n\t\t}\r\n\t},\r\n\tisSelected: function (id) {\r\n\t\treturn !!(gantt.isTaskExists(id) && this._selected[id]);\r\n\t},\r\n\tgetSelected: function () {\r\n\t\tvar res = [];\r\n\t\tfor (var i in this._selected) {\r\n\t\t\tif (this._selected[i] && gantt.isTaskExists(i)) {\r\n\t\t\t\tres.push(i);\r\n\t\t\t} else {\r\n\t\t\t\tthis._selected[i] = false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tres.sort(function(a, b) {\r\n\t\t\treturn gantt.getGlobalTaskIndex(a) > gantt.getGlobalTaskIndex(b) ? 1 : -1;\r\n\t\t});\r\n\t\treturn res;\r\n\t},\r\n\tforSelected: function (callback) {\r\n\t\tvar selected = this.getSelected();\r\n\t\tfor (var i = 0; i < selected.length; i++) {\r\n\t\t\tcallback(selected[i]);\r\n\t\t}\r\n\t},\r\n\tisSameLevel: function(id) {\r\n\t\tif (!this._one_level)\r\n\t\t\treturn true;\r\n\t\tvar last = this.getLastSelected();\r\n\t\tif (!last)\r\n\t\t\treturn true;\r\n\t\tif (!(gantt.isTaskExists(last) && gantt.isTaskExists(id)))\r\n\t\t\treturn true;\r\n\t\treturn !!(gantt.calculateTaskLevel(gantt.getTask(last)) == gantt.calculateTaskLevel(gantt.getTask(id)));\r\n\t},\r\n\tafterSelect: function(id) {\r\n\t\tif (gantt.isTaskExists(id)){\r\n\t\t\t// FIXME: quick workaround to prevent re-filtering inside refresh on multiselect\r\n\t\t\tgantt._quickRefresh(function(){\r\n\t\t\t\tgantt.refreshTask(id);\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\tdoSelection: function(e) {\r\n\t\tif (!this.isActive())\r\n\t\t\treturn false;\r\n\r\n\t\t// deny selection when click on 'expand' or 'collapse' icons\r\n\t\tif (gantt._is_icon_open_click(e))\r\n\t\t\treturn false;\r\n\r\n\t\tvar target_ev = gantt.locate(e);\r\n\t\tif (!target_ev)\r\n\t\t\treturn false;\r\n\r\n\t\tif (!gantt.callEvent(\"onBeforeMultiSelect\", [e]))\r\n\t\t\treturn false;\r\n\r\n\t\tvar selected = this.getSelected();\r\n\t\tvar defaultLast = this.getFirstSelected();\r\n\t\tvar isLast = false;\r\n\t\tvar last = this.getLastSelected();\r\n\t\tvar multiSelect = gantt.config.multiselect;\r\n\r\n\r\n\t\tvar singleSelection = (function () {\r\n\t\t\t// GS-719: If the multiselect extension is added we still need a way\r\n\t\t\t// to open the inline editors after clicking on the cells in the grid\r\n\t\t\tconst controller = gantt.ext.inlineEditors;\r\n\t\t\tif(controller && controller.getState){\r\n\t\t\t\tconst state = controller.getState();\r\n\t\t\t\tconst cell = controller.locateCell(e.target);\r\n\r\n\t\t\t\tif (gantt.config.inline_editors_multiselect_open && cell && controller.getEditorConfig(cell.columnName)) {\r\n\t\t\t\t\tif (controller.isVisible() && state.id == cell.id && state.columnName == cell.columnName) {\r\n\t\t\t\t\t\t// do nothing if editor is already active in this cell\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcontroller.startEdit(cell.id, cell.columnName);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.setFirstSelected(target_ev);\r\n\r\n\t\t\tif (!this.isSelected(target_ev)) {\r\n\t\t\t\tthis.select(target_ev, e);\r\n\t\t\t}\r\n\t\t\tselected = this.getSelected();\r\n\t\t\tfor (var i = 0; i < selected.length; i++) {\r\n\t\t\t\tif (selected[i] !== target_ev) {\r\n\t\t\t\t\tthis.unselect(selected[i], e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}).bind(this);\r\n\r\n\t\tvar blockSelection = (function(){\r\n\t\t\tif (!last)\r\n\t\t\t\tlast = target_ev;\r\n\t\t\telse if (target_ev) {\r\n\t\t\t\tvar first_indx = gantt.getGlobalTaskIndex(this.getFirstSelected());\r\n\t\t\t\tvar target_indx = gantt.getGlobalTaskIndex(target_ev);\r\n\t\t\t\tvar last_indx = gantt.getGlobalTaskIndex(last);\r\n\t\t\t\t// GS-1969: if the selected tasks are collapsed, need to remove them\r\n\t\t\t\tif(first_indx == -1 || last_indx == -1){\r\n\t\t\t\t\tfirst_indx = target_indx;\r\n\t\t\t\t\tthis.reset();\r\n\t\t\t\t}\r\n\t\t\t\t// clear prev selection\r\n\t\t\t\tvar tmp = last;\r\n\t\t\t\twhile (gantt.getGlobalTaskIndex(tmp) !== first_indx) {\r\n\t\t\t\t\tthis.unselect(tmp, e);\r\n\t\t\t\t\ttmp = (first_indx > last_indx) ? gantt.getNext(tmp) : gantt.getPrev(tmp);\r\n\t\t\t\t}\r\n\t\t\t\ttmp = target_ev;\r\n\t\t\t\twhile (gantt.getGlobalTaskIndex(tmp) !== first_indx) {\r\n\t\t\t\t\tif (this.select(tmp, e) && !isLast) {\r\n\t\t\t\t\t\tisLast = true;\r\n\t\t\t\t\t\tdefaultLast = tmp;\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttmp = (first_indx > target_indx) ? gantt.getNext(tmp) : gantt.getPrev(tmp);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}).bind(this);\r\n\r\n\r\n\t\tif (multiSelect && (e.ctrlKey || e.metaKey)) {\r\n\t\t\tif (!this.isSelected(target_ev))\r\n\t\t\t\tthis.setFirstSelected(target_ev);\r\n\r\n\t\t\tif (target_ev) {\r\n\t\t\t\tthis.toggle(target_ev, e);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\telse if (multiSelect && e.shiftKey) {\r\n\t\t\tif (!gantt.isTaskExists(this.getFirstSelected()) || this.getFirstSelected() === null) {\r\n\t\t\t\tthis.setFirstSelected(target_ev);\r\n\t\t\t}\r\n\r\n\t\t\tif (selected.length) { // select a group of tasks\r\n\t\t\t\tblockSelection();\r\n\t\t\t}\r\n\t\t\telse { // select a task when no task is selected and Shift is pressed\r\n\t\t\t\tsingleSelection();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\telse { // no key press or no multiple selection on the mouse click\r\n\t\t\tsingleSelection();\r\n\t\t}\r\n\r\n\r\n\t\tif (this.isSelected(target_ev)) {\r\n\t\t\tthis.setLastSelected(target_ev);\r\n\t\t} else if (defaultLast) {\r\n\t\t\tif (target_ev == last)\r\n\t\t\t\tthis.setLastSelected(e.shiftKey ? defaultLast : this.getDefaultSelected());\r\n\t\t} else {\r\n\t\t\tthis.setLastSelected(null);\r\n\t\t}\r\n\r\n\t\tif (!this.getSelected().length)\r\n\t\t\tthis.setLastSelected(null);\r\n\r\n\t\tif (!this.getLastSelected() || !this.isSelected(this.getFirstSelected()))\r\n\t\t\tthis.setFirstSelected(this.getLastSelected());\r\n\r\n\t\treturn true;\r\n\t}\r\n};\r\n\r\n(function(){\r\n\tvar old_selectTask = gantt.selectTask;\r\n\tgantt.selectTask = function(id) {\r\n\t\tid = replaceValidZeroId(id, this.config.root_id);\r\n\t\tif (!id)\r\n\t\t\treturn false;\r\n\t\tvar multiselect = gantt._multiselect;\r\n\t\tvar res = id;\r\n\t\tif (multiselect.isActive()) {\r\n\t\t\tif (multiselect.select(id, null)) {\r\n\t\t\t\tmultiselect.setLastSelected(id);\r\n\t\t\t}\r\n\t\t\tmultiselect.setFirstSelected(multiselect.getLastSelected());\r\n\t\t} else {\r\n\t\t\tres = old_selectTask.call(this, id);\r\n\t\t}\r\n\t\treturn res;\r\n\t};\r\n\r\n\tvar old_unselectTask = gantt.unselectTask;\r\n\tgantt.unselectTask = function(id) {\r\n\t\tvar multiselect = gantt._multiselect;\r\n\t\tvar isActive = multiselect.isActive();\r\n\t\tid = id || multiselect.getLastSelected();\r\n\t\tif(id && isActive) {\r\n\t\t\tmultiselect.unselect(id, null);\r\n\t\t\tif (id == multiselect.getLastSelected())\r\n\t\t\t\tmultiselect.setLastSelected(null);\r\n\t\t\tgantt.refreshTask(id);\r\n\t\t\tmultiselect.setFirstSelected(multiselect.getLastSelected());\r\n\t\t}\r\n\t\tvar res = id;\r\n\t\tif (!isActive)\r\n\t\t\tres = old_unselectTask.call(this, id);\r\n\t\treturn res;\r\n\t};\r\n\r\n\tgantt.toggleTaskSelection = function(id) {\r\n\t\tvar multiselect = gantt._multiselect;\r\n\t\tif (id && multiselect.isActive()) {\r\n\t\t\tmultiselect.toggle(id);\r\n\t\t\tmultiselect.setFirstSelected(multiselect.getLastSelected());\r\n\t\t}\r\n\t};\r\n\tgantt.getSelectedTasks = function() {\r\n\t\tvar multiselect = gantt._multiselect;\r\n\t\tmultiselect.isActive();\r\n\t\treturn multiselect.getSelected();\r\n\t};\r\n\tgantt.eachSelectedTask = function(callback){\r\n\t\treturn this._multiselect.forSelected(callback);\r\n\t};\r\n\tgantt.isSelectedTask = function(id){\r\n\t\treturn this._multiselect.isSelected(id);\r\n\t};\r\n\tgantt.getLastSelectedTask = function(){\r\n\t\treturn this._multiselect.getLastSelected();\r\n\t};\r\n\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\t\tvar old_isSelected = gantt.$data.tasksStore.isSelected;\r\n\t\tgantt.$data.tasksStore.isSelected = function(id){\r\n\t\t\tif (gantt._multiselect.isActive()) {\r\n\t\t\t\treturn gantt._multiselect.isSelected(id);\r\n\t\t\t}\r\n\t\t\treturn old_isSelected.call(this, id);\r\n\t\t};\r\n\t});\r\n})();\r\n\r\ngantt.attachEvent(\"onTaskIdChange\", function (id, new_id) {\r\n\tvar multiselect = gantt._multiselect;\r\n\tif (!multiselect.isActive())\r\n\t\treturn true;\r\n\tif (gantt.isSelectedTask(id)) {\r\n\t\tmultiselect.unselect(id, null);\r\n\t\tmultiselect.select(new_id, null);\r\n\t}\r\n});\r\n\r\ngantt.attachEvent(\"onAfterTaskDelete\", function (id, item) {\r\n\tvar multiselect = gantt._multiselect;\r\n\tif (!multiselect.isActive())\r\n\t\treturn true;\r\n\r\n\tif (multiselect._selected[id]) {\r\n\t\t// GS-1057: don't unselect the task here because the task is already unselected \r\n\t\t// it was in the select.js file before it was deleted\r\n\t\t// multiselect.unselect(id, null);\r\n\t\tmultiselect._selected[id] = false;\r\n\t\tmultiselect.setLastSelected(multiselect.getDefaultSelected());\r\n\t}\r\n\r\n\tmultiselect.forSelected(function (task_id) {\r\n\t\tif (!gantt.isTaskExists(task_id))\r\n\t\t\tmultiselect.unselect(task_id, null);\r\n\t});\r\n});\r\n\r\ngantt.attachEvent(\"onBeforeTaskMultiSelect\", function(id, state, e){\r\n\tconst multiselect = gantt._multiselect;\r\n\tif (state && multiselect.isActive()) {\r\n\t\t//GS-1321: prevent unselecting task\r\n\t\tlet oldSelectedId = gantt.getSelectedId();\r\n\t\tlet oldSelectedTask = null;\r\n\t\tif (oldSelectedId) {\r\n\t\t\toldSelectedTask = gantt.getTask(oldSelectedId);\r\n\t\t}\r\n\t\tlet newSelectedTask = gantt.getTask(id);\r\n\t\tlet differentTreeLevel = false;\r\n\t\tif (oldSelectedTask && oldSelectedTask.$level != newSelectedTask.$level){\r\n\t\t\tdifferentTreeLevel = true;\r\n\t\t}\r\n\r\n\t\tif (gantt.config.multiselect_one_level && differentTreeLevel && !e.ctrlKey && !e.shiftKey) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif (multiselect._one_level) {\r\n\t\t\treturn multiselect.isSameLevel(id);\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n});\r\n\r\ngantt.attachEvent(\"onTaskClick\", function(id, e) {\r\n\tif (gantt._multiselect.doSelection(e))\r\n\t\tgantt.callEvent(\"onMultiSelect\", [e]);\r\n\treturn true;\r\n});\r\n\r\n};","/* eslint-disable */\r\n\r\nimport ScaleHelper from \"../../core/ui/timeline/scales_ignore\";\r\nimport * as helpers from \"../../utils/helpers\";\r\n\r\nexport default function(gantt: any) {\r\n\r\n\tgantt.ext = gantt.ext || {};\r\n\r\n\tgantt.ext.export_api = gantt.ext.export_api || {\r\n\r\n\t\t_apiUrl: \"https://export.dhtmlx.com/gantt\",\r\n\r\n\t\t_preparePDFConfigRaw(config:any, type:any){\r\n\t\t\tlet previousDateRage:any = null;\r\n\t\t\tif (config.start && config.end){\r\n\t\t\t\tpreviousDateRage = {\r\n\t\t\t\t\tstart_date: gantt.config.start_date,\r\n\t\t\t\t\tend_date: gantt.config.end_date,\r\n\t\t\t\t};\r\n\t\t\t\tgantt.config.start_date = gantt.date.str_to_date(gantt.config.date_format)(config.start);\r\n\t\t\t\tgantt.config.end_date = gantt.date.str_to_date(gantt.config.date_format)(config.end);\r\n\t\t\t}\r\n\r\n\t\t\tconfig = gantt.mixin(config, {\r\n\t\t\t\tname: \"gantt.\" + type, data: gantt.ext.export_api._serializeHtml()\r\n\t\t\t});\r\n\r\n\t\t\tif (previousDateRage){\r\n\t\t\t\tgantt.config.start_date = previousDateRage.start_date;\r\n\t\t\t\tgantt.config.end_date = previousDateRage.end_date;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_prepareConfigPDF(config:any, type:any){\r\n\t\t\tconfig = gantt.mixin((config || {}), {\r\n\t\t\t\tname: \"gantt.\" + type,\r\n\t\t\t\tdata: gantt.ext.export_api._serializeAll(),\r\n\t\t\t\tconfig: gantt.config\r\n\t\t\t});\r\n\t\t\tgantt.ext.export_api._fixColumns(config.config.columns);\r\n\t\t\treturn config;\r\n\t\t},\r\n\r\n\t\t_pdfExportRouter(config:any, type:any){\r\n\t\t\tif (config && config.raw) {\r\n\t\t\t\tgantt.ext.export_api._preparePDFConfigRaw(config, type);\r\n\t\t\t} else {\r\n\t\t\t\tconfig = gantt.ext.export_api._prepareConfigPDF(config, type);\r\n\t\t\t}\r\n\t\t\tconfig.version = gantt.version;\r\n\t\t\tgantt.ext.export_api._sendToExport(config, type);\r\n\t\t},\r\n\r\n\t\texportToPDF(config:any) {\r\n\t\t\tgantt.ext.export_api._pdfExportRouter(config, \"pdf\");\r\n\t\t},\r\n\r\n\t\texportToPNG(config:any) {\r\n\t\t\tgantt.ext.export_api._pdfExportRouter(config, \"png\");\r\n\t\t},\r\n\r\n\r\n\t\texportToICal(config:any) {\r\n\t\t\tconfig = gantt.mixin((config || {}), {\r\n\t\t\t\tname: \"gantt.ical\",\r\n\t\t\t\tdata: gantt.ext.export_api._serializePlain().data,\r\n\t\t\t\tversion: gantt.version\r\n\t\t\t});\r\n\t\t\tgantt.ext.export_api._sendToExport(config, \"ical\");\r\n\t\t},\r\n\r\n\t\texportToExcel(config:any) {\r\n\t\t\tconfig = config || {};\r\n\r\n\t\t\tlet tasks;\r\n\t\t\tlet dates: any = [];\r\n\t\t\tlet state;\r\n\t\t\tlet scroll;\r\n\t\t\t// GS-2124, we need to get all task nodes to correctly obtain the colors\r\n\t\t\tconst smartRendering = gantt.config.smart_rendering;\r\n\t\t\tif (config.visual === \"base-colors\"){\r\n\t\t\t\tgantt.config.smart_rendering = false;\r\n\t\t\t}\r\n\r\n\t\t\tif (config.start || config.end) {\r\n\t\t\t\tstate = gantt.getState();\r\n\t\t\t\tdates = [gantt.config.start_date, gantt.config.end_date];\r\n\t\t\t\tscroll = gantt.getScrollState();\r\n\t\t\t\tconst convert = gantt.date.str_to_date(gantt.config.date_format);\r\n\t\t\t\ttasks = gantt.eachTask;\r\n\r\n\t\t\t\tif (config.start){\r\n\t\t\t\t\tgantt.config.start_date = convert(config.start);\r\n\t\t\t\t}\r\n\t\t\t\tif (config.end){\r\n\t\t\t\t\tgantt.config.end_date = convert(config.end);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgantt.render();\r\n\t\t\t\tgantt.config.smart_rendering = smartRendering;\r\n\r\n\t\t\t\tgantt.eachTask = gantt.ext.export_api._eachTaskTimed(gantt.config.start_date, gantt.config.end_date);\r\n\t\t\t} else if (config.visual === \"base-colors\"){\r\n\t\t\t\tgantt.render();\r\n\t\t\t\tgantt.config.smart_rendering = smartRendering;\r\n\t\t\t}\r\n\r\n\t\t\tconfig = gantt.mixin(config, {\r\n\t\t\t\tname: \"gantt.xlsx\",\r\n\t\t\t\ttitle: \"Tasks\",\r\n\t\t\t\tdata: gantt.ext.export_api._serializeTimeline(config),\r\n\t\t\t\tcolumns: gantt.ext.export_api._serializeGrid({ raw: config.raw, rawDates: true }),\r\n\t\t\t\tversion: gantt.version\r\n\t\t\t});\r\n\r\n\t\t\tif (config.visual){\r\n\t\t\t\tconfig.scales = gantt.ext.export_api._serializeScales(config);\r\n\t\t\t}\r\n\r\n\t\t\tgantt.ext.export_api._sendToExport(config, \"excel\");\r\n\r\n\t\t\tif (config.start || config.end) {\r\n\t\t\t\tgantt.config.start_date = state.min_date;\r\n\t\t\t\tgantt.config.end_date = state.max_date;\r\n\t\t\t\tgantt.eachTask = tasks;\r\n\r\n\t\t\t\tgantt.render();\r\n\t\t\t\tgantt.scrollTo(scroll.x, scroll.y);\r\n\r\n\t\t\t\tgantt.config.start_date = dates[0];\r\n\t\t\t\tgantt.config.end_date = dates[1];\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\texportToJSON(config:any) {\r\n\t\t\tconfig = gantt.mixin((config || {}), {\r\n\t\t\t\tname: \"gantt.json\",\r\n\t\t\t\tdata: gantt.ext.export_api._serializeAll(),\r\n\t\t\t\tconfig: gantt.config,\r\n\t\t\t\tcolumns: gantt.ext.export_api._serializeGrid(),\r\n\t\t\t\tworktime: gantt.ext.export_api._getWorktimeSettings(),\r\n\t\t\t\tversion: gantt.version\r\n\t\t\t});\r\n\t\t\tgantt.ext.export_api._sendToExport(config, \"json\");\r\n\t\t},\r\n\r\n\r\n\t\timportFromExcel(config:any) {\r\n\t\t\ttry {\r\n\t\t\t\tconst formData = config.data;\r\n\t\t\t\tif (formData instanceof File) {\r\n\t\t\t\t\tconst data = new FormData();\r\n\t\t\t\t\tdata.append(\"file\", formData);\r\n\t\t\t\t\tconfig.data = data;\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {}\r\n\t\t\tgantt.ext.export_api._sendImportAjaxExcel(config);\r\n\t\t},\r\n\r\n\t\timportFromMSProject(config:any) {\r\n\t\t\tconst formData = config.data;\r\n\t\t\ttry {\r\n\t\t\t\tif (formData  instanceof File) {\r\n\t\t\t\t\tconst data = new FormData();\r\n\t\t\t\t\tdata.append(\"file\", formData);\r\n\t\t\t\t\tconfig.data = data;\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {}\r\n\t\t\tgantt.ext.export_api._sendImportAjaxMSP(config);\r\n\t\t},\r\n\r\n\t\timportFromPrimaveraP6(config:any) {\r\n\t\t\tconfig.type = \"primaveraP6-parse\";\r\n\t\t\treturn gantt.importFromMSProject(config);\r\n\t\t},\r\n\r\n\t\texportToMSProject(config:any) {\r\n\t\t\tconfig = config || {};\r\n\t\t\tconfig.skip_circular_links = config.skip_circular_links === undefined ? true : !!config.skip_circular_links;\r\n\r\n\t\t\tconst oldXmlFormat = gantt.templates.xml_format;\r\n\t\t\tconst oldFormatDate = gantt.templates.format_date;\r\n\t\t\tconst oldXmlDate = gantt.config.xml_date;\r\n\t\t\tconst oldDateFormat = gantt.config.date_format;\r\n\r\n\t\t\tconst exportServiceDateFormat = \"%d-%m-%Y %H:%i:%s\";\r\n\r\n\t\t\tgantt.config.xml_date = exportServiceDateFormat;\r\n\t\t\tgantt.config.date_format = exportServiceDateFormat;\r\n\t\t\tgantt.templates.xml_format = gantt.date.date_to_str(exportServiceDateFormat);\r\n\t\t\tgantt.templates.format_date = gantt.date.date_to_str(exportServiceDateFormat);\r\n\t\t\tconst data = gantt.ext.export_api._serializeAll();\r\n\r\n\t\t\tgantt.ext.export_api._customProjectProperties(data, config);\r\n\r\n\t\t\tgantt.ext.export_api._customTaskProperties(data, config);\r\n\r\n\t\t\tif (config.skip_circular_links) {\r\n\t\t\t\tgantt.ext.export_api._clearRecLinks(data);\r\n\t\t\t}\r\n\r\n\t\t\tconfig = gantt.ext.export_api._exportConfig(data, config);\r\n\r\n\t\t\tgantt.ext.export_api._sendToExport(config, config.type || \"msproject\");\r\n\t\t\tgantt.config.xml_date = oldXmlDate;\r\n\t\t\tgantt.config.date_format = oldDateFormat;\r\n\t\t\tgantt.templates.xml_format = oldXmlFormat;\r\n\t\t\tgantt.templates.format_date = oldFormatDate;\r\n\r\n\t\t\tgantt.config.$custom_data = null;\r\n\t\t\tgantt.config.custom = null;\r\n\t\t},\r\n\r\n\t\texportToPrimaveraP6(config:any) {\r\n\t\t\tconfig = config || {};\r\n\t\t\tconfig.type = \"primaveraP6\";\r\n\t\t\treturn gantt.exportToMSProject(config);\r\n\t\t},\r\n\r\n\t\t_fixColumns(columns:any) {\r\n\t\t\tfor (let i = 0; i < columns.length; i++) {\r\n\t\t\t\tcolumns[i].label = columns[i].label || gantt.locale.labels[\"column_\" + columns[i].name];\r\n\t\t\t\tif (typeof columns[i].width === \"string\") {\r\n\t\t\t\t\tcolumns[i].width = columns[i].width * 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_xdr(url:any, pack:any, cb:any) {\r\n\t\t\tgantt.ajax.post(url, pack, cb);\r\n\t\t},\r\n\r\n\t\t_markColumns(base:any) {\r\n\t\t\tconst columns = base.config.columns;\r\n\t\t\tif (columns){\r\n\t\t\t\tfor (let i = 0; i < columns.length; i++) {\r\n\t\t\t\t\tif (columns[i].template){\r\n\t\t\t\t\t\tcolumns[i].$template = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\t_sendImportAjaxExcel(config:any) {\r\n\t\t\tconst url = config.server || gantt.ext.export_api._apiUrl;\r\n\t\t\tconst store = config.store || 0;\r\n\t\t\tconst formData = config.data;\r\n\t\t\tconst callback = config.callback;\r\n\r\n\t\t\tformData.append(\"type\", \"excel-parse\");\r\n\t\t\tformData.append(\"data\", JSON.stringify({\r\n\t\t\t\tsheet: config.sheet || 0\r\n\t\t\t}));\r\n\r\n\t\t\tif (store){\r\n\t\t\t\tformData.append(\"store\", store);\r\n\t\t\t}\r\n\r\n\t\t\tconst xhr = new XMLHttpRequest();\r\n\t\t\txhr.onreadystatechange = function(e) {\r\n\t\t\t\tif (xhr.readyState === 4 && xhr.status === 0) {// network error\r\n\t\t\t\t\tif (callback) {\r\n\t\t\t\t\t\tcallback(null);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\txhr.onload = function() {\r\n\t\t\t\tconst fail = xhr.status > 400;\r\n\t\t\t\tlet info = null;\r\n\r\n\t\t\t\tif (!fail) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tinfo = JSON.parse(xhr.responseText);\r\n\t\t\t\t\t} catch (e) { }\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (callback) {\r\n\t\t\t\t\tcallback(info);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\txhr.open(\"POST\", url, true);\r\n\t\t\txhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\r\n\t\t\txhr.send(formData);\r\n\t\t},\r\n\r\n\r\n\t\t_ajaxToExport(data:any, type:any, callback:any) {\r\n\t\t\tdelete data.callback;\r\n\r\n\t\t\tconst url = data.server || gantt.ext.export_api._apiUrl;\r\n\t\t\tconst pack = \"type=\" + type + \"&store=1&data=\" + encodeURIComponent(JSON.stringify(data));\r\n\r\n\t\t\tconst cb = function(loader:any) {\r\n\t\t\t\tconst xdoc = loader.xmlDoc || loader;\r\n\t\t\t\tconst fail = xdoc.status > 400;\r\n\t\t\t\tlet info = null;\r\n\r\n\t\t\t\tif (!fail) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tinfo = JSON.parse(xdoc.responseText);\r\n\t\t\t\t\t} catch (e) { }\r\n\t\t\t\t}\r\n\t\t\t\tcallback(info);\r\n\t\t\t};\r\n\r\n\t\t\tgantt.ext.export_api._xdr(url, pack, cb);\r\n\t\t},\r\n\t\t_serializableGanttConfig(config:any) {\r\n\t\t\tconst result = gantt.mixin({}, config);\r\n\r\n\t\t\tif (result.columns) {\r\n\t\t\t\tresult.columns = result.columns.map(function(col:any) {\r\n\t\t\t\t\tconst copy = gantt.mixin({}, col);\r\n\t\t\t\t\tdelete copy.editor;\r\n\t\t\t\t\treturn copy;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tdelete result.editor_types;\r\n\t\t\treturn result;\r\n\t\t},\r\n\r\n\t\t_sendToExport(data:any, type:any) {\r\n\t\t\tconst convert = gantt.date.date_to_str(gantt.config.date_format || gantt.config.xml_date);\r\n\t\t\tif(!data.skin){\r\n\t\t\t\tdata.skin = gantt.skin;\r\n\t\t\t}\r\n\t\t\tif (data.config) {\r\n\t\t\t\tdata.config = gantt.copy(gantt.ext.export_api._serializableGanttConfig(data.config));\r\n\t\t\t\tgantt.ext.export_api._markColumns(data, type);\r\n\r\n\t\t\t\tif (data.config.start_date && data.config.end_date) {\r\n\t\t\t\t\tif (data.config.start_date instanceof Date) {\r\n\t\t\t\t\t\tdata.config.start_date = convert(data.config.start_date);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (data.config.end_date instanceof Date) {\r\n\t\t\t\t\t\tdata.config.end_date = convert(data.config.end_date);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (data.callback) {\r\n\t\t\t\treturn gantt.ext.export_api._ajaxToExport(data, type, data.callback);\r\n\t\t\t}\r\n\r\n\t\t\tconst form = gantt.ext.export_api._createHiddenForm();\r\n\t\t\tform.firstChild.action = data.server || gantt.ext.export_api._apiUrl;\r\n\t\t\tform.firstChild.childNodes[0].value = JSON.stringify(data);\r\n\t\t\tform.firstChild.childNodes[1].value = type;\r\n\t\t\tform.firstChild.submit();\r\n\t\t},\r\n\r\n\t\t_createHiddenForm() {\r\n\t\t\tif (!gantt.ext.export_api._hidden_export_form) {\r\n\t\t\t\tconst t = gantt.ext.export_api._hidden_export_form = document.createElement(\"div\");\r\n\t\t\t\tt.style.display = \"none\";\r\n\t\t\t\tt.innerHTML = \"<form method='POST' target='_blank'><textarea name='data' style='width:0px; height:0px;' readonly='true'></textarea><input type='hidden' name='type' value=''></form>\";\r\n\t\t\t\tdocument.body.appendChild(t);\r\n\t\t\t}\r\n\t\t\treturn gantt.ext.export_api._hidden_export_form;\r\n\t\t},\r\n\r\n\r\n\t\t_copyObjectBase(obj: any) {\r\n\t\t\tconst copy: any = {\r\n\t\t\t\tstart_date: undefined,\r\n\t\t\t\tend_date: undefined,\r\n\t\t\t\tconstraint_date: undefined,\r\n\t\t\t\tdeadline: undefined\r\n\t\t\t};\r\n\t\t\tfor (const key in obj) {\r\n\t\t\t\tif (key.charAt(0) === \"$\" || key === \"baselines\"){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tcopy[key] = obj[key];\r\n\t\t\t}\r\n\t\t\tconst formatDate = gantt.templates.xml_format || gantt.templates.format_date;\r\n\r\n\t\t\tcopy.start_date = formatDate(copy.start_date);\r\n\t\t\tif (copy.end_date){\r\n\t\t\t\tcopy.end_date = formatDate(copy.end_date);\r\n\t\t\t}\r\n\t\t\tif (copy.constraint_date){\r\n\t\t\t\tcopy.constraint_date = formatDate(copy.constraint_date);\r\n\t\t\t}\r\n\t\t\tif (copy.deadline){\r\n\t\t\t\tcopy.deadline = formatDate(copy.deadline);\r\n\t\t\t}\r\n\r\n\t\t\treturn copy;\r\n\t\t},\r\n\r\n\r\n\t\t_color_box: null,\r\n\t\t_color_hash: {},\r\n\r\n\t\t_getStyles(css:any) {\r\n\t\t\tif (!gantt.ext.export_api._color_box) {\r\n\t\t\t\tgantt.ext.export_api._color_box = document.createElement(\"DIV\");\r\n\t\t\t\tgantt.ext.export_api._color_box.style.cssText = \"position:absolute; display:none;\";\r\n\t\t\t\tdocument.body.appendChild(gantt.ext.export_api._color_box);\r\n\t\t\t}\r\n\t\t\tif (gantt.ext.export_api._color_hash[css]){\r\n\t\t\t\treturn gantt.ext.export_api._color_hash[css];\r\n\t\t\t}\r\n\r\n\t\t\tgantt.ext.export_api._color_box.className = css;\r\n\t\t\tconst color = gantt.ext.export_api._getColor(gantt.ext.export_api._color_box, \"color\");\r\n\t\t\tconst backgroundColor = gantt.ext.export_api._getColor(gantt.ext.export_api._color_box, \"backgroundColor\");\r\n\t\t\treturn (gantt.ext.export_api._color_hash[css] = color + \";\" + backgroundColor);\r\n\t\t},\r\n\r\n\r\n\t\t_getMinutesWorktimeSettings(parsedRanges:any) {\r\n\t\t\tconst minutes:any = [];\r\n\t\t\tparsedRanges.forEach(function(range:any) {\r\n\t\t\t\tminutes.push(range.startMinute);\r\n\t\t\t\tminutes.push(range.endMinute);\r\n\t\t\t});\r\n\t\t\treturn minutes;\r\n\t\t},\r\n\r\n\t\t_getWorktimeSettings() {\r\n\r\n\t\t\tconst defaultWorkTimes = {\r\n\t\t\t\thours: [0, 24],\r\n\t\t\t\tminutes: null,\r\n\t\t\t\tdates: { 0: true, 1: true, 2: true, 3: true, 4: true, 5: true, 6: true }\r\n\t\t\t};\r\n\r\n\t\t\tlet time: any;\r\n\t\t\tif (!gantt.config.work_time) {\r\n\t\t\t\ttime = defaultWorkTimes;\r\n\t\t\t} else {\r\n\t\t\t\tconst wTime = gantt._working_time_helper;\r\n\t\t\t\tif (wTime && wTime.get_calendar) {\r\n\t\t\t\t\ttime = wTime.get_calendar();\r\n\t\t\t\t} else if (wTime) {\r\n\t\t\t\t\ttime = {\r\n\t\t\t\t\t\thours: wTime.hours,\r\n\t\t\t\t\t\tminutes: null,\r\n\t\t\t\t\t\tdates: wTime.dates\r\n\t\t\t\t\t};\r\n\t\t\t\t} else if (gantt.config.worktimes && gantt.config.worktimes.global) {\r\n\t\t\t\t\tconst settings = gantt.config.worktimes.global;\r\n\r\n\t\t\t\t\tif (settings.parsed) {\r\n\t\t\t\t\t\tconst minutes = gantt.ext.export_api._getMinutesWorktimeSettings(settings.parsed.hours);\r\n\t\t\t\t\t\ttime = {\r\n\t\t\t\t\t\t\thours: null,\r\n\t\t\t\t\t\t\tminutes,\r\n\t\t\t\t\t\t\tdates: {}\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tfor (const i in settings.parsed.dates) {\r\n\t\t\t\t\t\t\tif (Array.isArray(settings.parsed.dates[i])) {\r\n\t\t\t\t\t\t\t\ttime.dates[i] = gantt.ext.export_api._getMinutesWorktimeSettings(settings.parsed.dates[i]);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttime.dates[i] = settings.parsed.dates[i];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttime = {\r\n\t\t\t\t\t\t\thours: settings.hours,\r\n\t\t\t\t\t\t\tminutes: null,\r\n\t\t\t\t\t\t\tdates: settings.dates\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttime = defaultWorkTimes;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn time;\r\n\t\t},\r\n\r\n\r\n\t\t_eachTaskTimed(start:any, end:any) {\r\n\t\t\treturn function(code:any, parent:any, master:any) {\r\n\t\t\t\tparent = parent || gantt.config.root_id;\r\n\t\t\t\tmaster = master || gantt;\r\n\r\n\t\t\t\tconst branch = gantt.getChildren(parent);\r\n\t\t\t\tif (branch){\r\n\t\t\t\t\tfor (let i = 0; i < branch.length; i++) {\r\n\t\t\t\t\t\tconst item = gantt._pull[branch[i]];\r\n\t\t\t\t\t\tif ((!start || item.end_date > start) && (!end || item.start_date < end)){\r\n\t\t\t\t\t\t\tcode.call(master, item);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (gantt.hasChild(item.id)){\r\n\t\t\t\t\t\t\tgantt.eachTask(code, item.id, master);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\r\n\r\n\t\t// patch broken json serialization in gantt 2.1\r\n\t\t_originalCopyObject: gantt.json._copyObject,\r\n\r\n\t\t_copyObjectPlainICal(task: any) {\r\n\t\t\tconst text = gantt.templates.task_text(task.start_date, task.end_date, task);\r\n\r\n\t\t\tconst copy = gantt.ext.export_api._copyObjectBase(task);\r\n\t\t\tcopy.text = text || copy.text;\r\n\r\n\t\t\treturn copy;\r\n\t\t},\r\n\r\n\t\t_copyObjectPlainExcel(task: any) {\r\n\t\t\tconst text = gantt.templates.task_text(task.start_date, task.end_date, task);\r\n\r\n\t\t\tconst copy = gantt.json.serializeTask(task);\r\n\t\t\tcopy.text = text || copy.text;\r\n\r\n\t\t\treturn copy;\r\n\t\t},\r\n\r\n\t\t_getColor(node:any, style:any) {\r\n\t\t\tlet value = node.currentStyle ? node.currentStyle[style] : getComputedStyle(node, null)[style];\r\n\t\t\t// if we get the black background color for the progress bar, \r\n\t\t\t// most likely, it is the transparent color.\r\n\t\t\t// In that case, we need to confirm that and return the color of the task bar\r\n\t\t\tif (node.closest(\".gantt_task_progress\") && value === \"rgba(0, 0, 0, 0.15)\"){\r\n\t\t\t\tnode = node.parentNode.parentNode;\r\n\t\t\t\tvalue = node.currentStyle ? node.currentStyle[style] : getComputedStyle(node, null)[style];\r\n\t\t\t}\r\n\t\t\tconst rgb = value.replace(/\\s/g, \"\").match(/^rgba?\\((\\d+),(\\d+),(\\d+)/i);\r\n\t\t\treturn ((rgb && rgb.length === 4) ?\r\n\t\t\t\t(\"0\" + parseInt(rgb[1], 10).toString(16)).slice(-2) +\r\n\t\t\t\t(\"0\" + parseInt(rgb[2], 10).toString(16)).slice(-2) +\r\n\t\t\t\t(\"0\" + parseInt(rgb[3], 10).toString(16)).slice(-2) : value).replace(\"#\", \"\");\r\n\t\t},\r\n\r\n\r\n\t\t// excel serialization\r\n\t\t_copyObjectTable(obj:any) {\r\n\t\t\t// Excel interprets UTC time as local time in every timezone, send local time instead of actual UTC time.\r\n\t\t\t// https://github.com/SheetJS/js-xlsx/issues/126#issuecomment-60531614\r\n\t\t\tconst toISOstring = gantt.date.date_to_str(\"%Y-%m-%dT%H:%i:%s.000Z\");\r\n\r\n\t\t\tconst copy = gantt.ext.export_api._copyObjectColumns(obj, gantt.ext.export_api._copyObjectPlainExcel(obj));\r\n\t\t\tif (copy.start_date){\r\n\t\t\t\tif (typeof copy.start_date === \"string\"){\r\n\t\t\t\t\tcopy.original_start_date = gantt.date.str_to_date(gantt.config.date_format)(copy.start_date);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcopy.original_start_date = copy.start_date;\r\n\t\t\t\t\tcopy.start_date = toISOstring(obj.start_date);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (copy.end_date){\r\n\t\t\t\tif (typeof copy.end_date === \"string\"){\r\n\t\t\t\t\tcopy.original_end_date = gantt.date.str_to_date(gantt.config.date_format)(copy.end_date);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcopy.original_end_date = copy.end_date;\r\n\t\t\t\t\tcopy.end_date = toISOstring(obj.end_date);\r\n\t\t\t\t}\r\n\t\t\t} else if (copy.original_start_date){\r\n\t\t\t\tcopy.original_end_date = gantt.calculateEndDate({\r\n\t\t\t\t\tstart_date: copy.original_start_date,\r\n\t\t\t\t\tduration: copy.duration,\r\n\t\t\t\t\ttask: copy\r\n\t\t\t\t});\r\n\t\t\t\tcopy.end_date = toISOstring(copy.original_end_date);\r\n\t\t\t}\r\n\r\n\t\t\treturn copy;\r\n\t\t},\r\n\r\n\t\t_generatedScales: null,\r\n\t\t_generateScales(){\r\n\t\t\tconst state = gantt.getState();\r\n\t\t\tconst scaleHelper = ScaleHelper(gantt);\r\n\t\t\tconst scales = [scaleHelper.primaryScale(gantt.config)].concat(scaleHelper.getSubScales(gantt.config));\r\n\r\n\t\t\tconst scalesConfig = scaleHelper.prepareConfigs(scales, gantt.config.min_column_width, 1000, gantt.config.scale_height - 1, state.min_date, state.max_date, gantt.config.rtl);\r\n\t\t\tgantt.ext.export_api._generatedScales = scalesConfig;\r\n\t\t\treturn scalesConfig;\r\n\t\t},\r\n\r\n\t\t_getDayIndex (scales:any, date:any){\r\n\t\t\tlet days = scales.trace_indexes\r\n\t\t\tif (days[+date]) {\r\n\t\t\t\treturn days[+date]\r\n\t\t\t} else {\r\n\t\t\t\tdays = scales.trace_x;\r\n\t\t\t\tconst state = gantt.getState();\r\n\r\n\t\t\t\tif (+date <= state.min_date) {\r\n\t\t\t\t\tif (gantt.config.rtl) {\r\n\t\t\t\t\t\treturn days.length;\r\n\t\t\t\t\t} else{\r\n\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (+date >= state.max_date) {\r\n\t\t\t\t\tif (gantt.config.rtl) {\r\n\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn days.length;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tconst index = helpers.findBinary(days, +date);\r\n\t\t\t\treturn index;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_copyObjectColors(obj:any, config:any) {\r\n\t\t\tconst copy = gantt.ext.export_api._copyObjectTable(obj);\r\n\r\n\t\t\tlet startDate = copy.original_start_date;\r\n\t\t\tlet endDate = copy.original_end_date;\r\n\r\n\t\t\tlet getDayIndex = gantt.columnIndexByDate;\r\n\r\n\t\t\tlet scales;\r\n\t\t\tif (gantt.ext.export_api._generatedScales){ \r\n\t\t\t\tconst allScales = gantt.ext.export_api._generatedScales;\r\n\t\t\t\tscales = allScales[allScales.length - 1];\r\n\r\n\t\t\t\tcopy.$start = gantt.ext.export_api._getDayIndex(scales, startDate);\r\n\t\t\t\tcopy.$end = gantt.ext.export_api._getDayIndex(scales, endDate);\r\n\t\t\t} else {\r\n\t\t\t\tscales = gantt.getScale();\r\n\t\t\t\tcopy.$start = getDayIndex.call(gantt, startDate);\r\n\t\t\t\tcopy.$end = getDayIndex.call(gantt, endDate);\r\n\t\t\t}\r\n\r\n\t\t\t// GS-2100. Correct bar position considering hidden cells\r\n\t\t\tlet hiddenCells = 0;\r\n\t\t\tconst scaleCellsWidth = scales.width;\r\n\t\t\tif (scaleCellsWidth.indexOf(0) > -1) {\r\n\t\t\t\tlet i = 0;\r\n\t\t\t\tfor (i; i < copy.$start; i++) {\r\n\t\t\t\t\tif (!scaleCellsWidth[i]) {\r\n\t\t\t\t\t\thiddenCells++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcopy.$start -= hiddenCells;\r\n\r\n\t\t\t\tfor (i; i < copy.$end; i++) {\r\n\t\t\t\t\tif (!scaleCellsWidth[i]) {\r\n\t\t\t\t\t\thiddenCells++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcopy.$end -= hiddenCells;\r\n\t\t\t}\r\n\r\n\t\t\tcopy.$level = obj.$level;\r\n\t\t\tcopy.$type = obj.$rendered_type;\r\n\r\n\t\t\tconst tmps = gantt.templates;\r\n\t\t\tcopy.$text = tmps.task_text(obj.start, obj.end_date, obj);\r\n\t\t\tcopy.$left = tmps.leftside_text ? tmps.leftside_text(obj.start, obj.end_date, obj) : \"\";\r\n\t\t\tcopy.$right = tmps.rightside_text ? tmps.rightside_text(obj.start, obj.end_date, obj) : \"\";\r\n\r\n\t\t\tconst node = gantt.getTaskNode && gantt.getTaskNode(obj.id);\r\n\t\t\tif (node && node.firstChild) {\r\n\t\t\t\tlet targetNode = node;\r\n\t\t\t\tif (config.visual !== \"base-colors\"){\r\n\t\t\t\t\ttargetNode = node.querySelector(\".gantt_task_progress\")\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet color = gantt.ext.export_api._getColor(targetNode, \"backgroundColor\");\r\n\t\t\t\tif (color === \"363636\"){\r\n\t\t\t\t\tcolor = gantt.ext.export_api._getColor(node, \"backgroundColor\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcopy.$color = color;\r\n\t\t\t} else if (obj.color){\r\n\t\t\t\tcopy.$color = obj.color;\r\n\t\t\t} else {\r\n\t\t\t\tconst cellCss = gantt.templates.task_class(obj.start, obj.end, obj);\r\n\t\t\t\tif (cellCss){\r\n\t\t\t\t\tconst styles = gantt.ext.export_api._getStyles(cellCss);\r\n\t\t\t\t\tcopy.$color = styles.split(\";\")[1]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn copy;\r\n\t\t},\r\n\r\n\t\t_copyObjectColumns(obj:any, copy:any) {\r\n\t\t\tfor (let i = 0; i < gantt.config.columns.length; i++) {\r\n\t\t\t\tconst ct = gantt.config.columns[i].template;\r\n\t\t\t\tif (ct) {\r\n\t\t\t\t\tlet val = ct(obj);\r\n\t\t\t\t\tif (val instanceof Date){\r\n\t\t\t\t\t\tval = gantt.templates.date_grid(val, obj);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcopy[\"_\" + i] = val;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn copy;\r\n\t\t},\r\n\r\n\t\t_copyObjectAll(obj:any) {\r\n\t\t\tconst copy = gantt.ext.export_api._copyObjectBase(obj);\r\n\r\n\t\t\tconst templates = [\r\n\t\t\t\t\"leftside_text\",\r\n\t\t\t\t\"rightside_text\",\r\n\t\t\t\t\"task_text\",\r\n\t\t\t\t\"progress_text\",\r\n\t\t\t\t\"task_class\"\r\n\t\t\t];\r\n\r\n\t\t\t// serialize all text templates\r\n\t\t\tfor (let i = 0; i < templates.length; i++) {\r\n\t\t\t\tconst template = gantt.templates[templates[i]];\r\n\t\t\t\tif (template){\r\n\t\t\t\t\tcopy[\"$\" + i] = template(obj.start_date, obj.end_date, obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tgantt.ext.export_api._copyObjectColumns(obj, copy);\r\n\t\t\tcopy.open = obj.$open;\r\n\t\t\treturn copy;\r\n\t\t},\r\n\r\n\r\n\t\t_serializeHtml() {\r\n\t\t\tconst smartScales = gantt.config.smart_scales;\r\n\t\t\tconst smartRendering = gantt.config.smart_rendering;\r\n\t\t\tif (smartScales || smartRendering) {\r\n\t\t\t\tgantt.config.smart_rendering = false;\r\n\t\t\t\tgantt.config.smart_scales = false;\r\n\t\t\t\tgantt.render();\r\n\t\t\t}\r\n\r\n\t\t\tconst html = gantt.$container.parentNode.innerHTML;\r\n\r\n\t\t\tif (smartScales || smartRendering) {\r\n\t\t\t\tgantt.config.smart_scales = smartScales;\r\n\t\t\t\tgantt.config.smart_rendering = smartRendering;\r\n\t\t\t\tgantt.render();\r\n\t\t\t}\r\n\r\n\t\t\treturn html;\r\n\t\t},\r\n\r\n\t\t_serializeAll() {\r\n\t\t\tgantt.json._copyObject = gantt.ext.export_api._copyObjectAll;\r\n\t\t\tconst data = gantt.ext.export_api._exportSerialize();\r\n\t\t\tgantt.json._copyObject = gantt.ext.export_api._originalCopyObject;\r\n\t\t\treturn data;\r\n\t\t},\r\n\r\n\t\t_serializePlain() {\r\n\t\t\tconst oldXmlFormat = gantt.templates.xml_format;\r\n\t\t\tconst oldFormatDate = gantt.templates.format_date;\r\n\t\t\tgantt.templates.xml_format = gantt.date.date_to_str(\"%Y%m%dT%H%i%s\", true);\r\n\t\t\tgantt.templates.format_date = gantt.date.date_to_str(\"%Y%m%dT%H%i%s\", true);\r\n\t\t\tgantt.json._copyObject = gantt.ext.export_api._copyObjectPlainICal;\r\n\r\n\t\t\tconst data = gantt.ext.export_api._exportSerialize();\r\n\r\n\t\t\tgantt.templates.xml_format = oldXmlFormat;\r\n\t\t\tgantt.templates.format_date = oldFormatDate;\r\n\t\t\tgantt.json._copyObject = gantt.ext.export_api._originalCopyObject;\r\n\r\n\t\t\tdelete data.links;\r\n\t\t\treturn data;\r\n\t\t},\r\n\r\n\t\t_getRaw() {\r\n\t\t\tconst timeline = gantt.$ui.getView(\"timeline\");\r\n\t\t\tif (timeline && gantt.config.show_chart) {\r\n\t\t\t\tlet availWidth = timeline.$config.width;\r\n\t\t\t\tif (gantt.config.autosize === \"x\" || gantt.config.autosize === \"xy\") {\r\n\t\t\t\t\tavailWidth = Math.max(gantt.config.autosize_min_width, 0);\r\n\t\t\t\t}\r\n\t\t\t\tconst state = gantt.getState();\r\n\t\t\t\tconst scales = timeline._getScales();\r\n\t\t\t\tconst minWidth = gantt.config.min_column_width;\r\n\t\t\t\tconst height = gantt.config.scale_height - 1;\r\n\t\t\t\tconst rtl = gantt.config.rtl;\r\n\r\n\t\t\t\treturn timeline.$scaleHelper.prepareConfigs(scales, minWidth, availWidth, height, state.min_date, state.max_date, rtl);\r\n\t\t\t} else {\r\n\t\t\t\treturn gantt.ext.export_api._generateScales();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_serializeTimeline(config:any) {\r\n\t\t\tgantt.ext.export_api._generatedScales = null;\r\n\t\t\tlet scales;\r\n\t\t\tif (config.visual){\r\n\t\t\t\tscales = gantt.ext.export_api._getRaw(config.start, config.end);\r\n\t\t\t}\r\n\t\t\tif (config.data){\r\n\t\t\t\tconfig.custom_dataset = true;\r\n\t\t\t}\r\n\r\n\t\t\tlet tasks = config.data || gantt.serialize().data;\r\n\t\t\ttasks.forEach(function(task:any, index:any){\r\n\t\t\t\tif (config.visual){\r\n\t\t\t\t\t// Save split tasks dates inside the parent object\r\n\t\t\t\t\tif (task.render == \"split\"){\r\n\t\t\t\t\t\tconst children:any = [];\r\n\t\t\t\t\t\tif (config.custom_dataset){\r\n\t\t\t\t\t\t\ttasks.forEach(function(child:any){\r\n\t\t\t\t\t\t\t\tif (child.parent == task.id){\r\n\t\t\t\t\t\t\t\t\tconst childBar = gantt.ext.export_api._copyObjectColors(child, config);\r\n\t\t\t\t\t\t\t\t\tchildBar.$split_subtask = true;\r\n\t\t\t\t\t\t\t\t\tchildren.push(childBar);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tgantt.eachTask(function(child:any){\r\n\t\t\t\t\t\t\t\tconst childBar = gantt.ext.export_api._copyObjectColors(child, config);\r\n\t\t\t\t\t\t\t\tchildren.push(childBar);\r\n\t\t\t\t\t\t\t}, task.id);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ttask.split_bars = [];\r\n\r\n\t\t\t\t\t\t// Skip overlap children\r\n\t\t\t\t\t\tconst skippedTasks:any = {};\r\n\t\t\t\t\t\tfor (let i = 0; i < children.length; i++) {\r\n\t\t\t\t\t\t\tconst child = children[i];\r\n\t\t\t\t\t\t\tfor (let j = 0; j < children.length; j++) {\r\n\t\t\t\t\t\t\t\tconst sibling = children[j];\r\n\t\t\t\t\t\t\t\tif (child.id == sibling.id || skippedTasks[sibling.id]){\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tconst overlap = +child.original_start_date < +sibling.original_start_date && +sibling.original_start_date <= +child.original_end_date;\r\n\t\t\t\t\t\t\t\t// const overlap = +child.original_start_date < +sibling.original_end_date && +sibling.original_end_date <= +child.original_end_date;\r\n\t\t\t\t\t\t\t\tconst cover = +sibling.original_start_date <= +child.original_start_date && +child.original_end_date <= +sibling.original_end_date;\r\n\t\t\t\t\t\t\t\tif (overlap){\r\n\t\t\t\t\t\t\t\t\tchild.original_end_date = sibling.original_start_date;\r\n\t\t\t\t\t\t\t\t\tchild.end_date = sibling.start_date;\r\n\t\t\t\t\t\t\t\t\tchild.$end = sibling.$start;\r\n\t\t\t\t\t\t\t\t\t// child.original_start_date = sibling.original_end_date;\r\n\t\t\t\t\t\t\t\t\t// child.start_date = sibling.end_date;\r\n\t\t\t\t\t\t\t\t\t// child.$start = sibling.$end;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (cover){\r\n\t\t\t\t\t\t\t\t\t// skip the task as it won't be visible\r\n\t\t\t\t\t\t\t\t\tskippedTasks[child.id] = true;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (!skippedTasks[child.id]){\r\n\t\t\t\t\t\t\t\ttask.split_bars.push(child)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ttasks[index] = task;\r\n\t\t\t\t\t} else if (!task.$split_subtask){\r\n\t\t\t\t\t\ttasks[index] = gantt.ext.export_api._copyObjectColors(task, config);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\ttasks[index] = gantt.ext.export_api._copyObjectTable(task);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t\t// Filter tasks\r\n\t\t\tif (config.raw && !config.data){\r\n\t\t\t\tconst taskStore = gantt.getDatastore(\"task\");\r\n\t\t\t\tconst filteredIds = taskStore.visibleOrder;\r\n\t\t\t\tif (tasks.length !== filteredIds.length){\r\n\t\t\t\t\tconst filteredDataset:any = [];\r\n\t\t\t\t\ttasks.forEach(function(task:any){\r\n\t\t\t\t\t\tif (filteredIds.indexOf(task.id) > -1){\r\n\t\t\t\t\t\t\tfilteredDataset.push(task);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\ttasks = filteredDataset;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (config.cellColors) {\r\n\t\t\t\tconst css = gantt.templates.timeline_cell_class || gantt.templates.task_cell_class;\r\n\t\t\t\tif (css) {\r\n\t\t\t\t\tlet steps = scales[0].trace_x;\r\n\t\t\t\t\tfor (let i = 1; i < scales.length; i++){\r\n\t\t\t\t\t\tif (scales[i].trace_x.length > steps.length){\r\n\t\t\t\t\t\t\tsteps = scales[i].trace_x;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (let i = 0; i < tasks.length; i++) {\r\n\t\t\t\t\t\ttasks[i].styles = [];\r\n\t\t\t\t\t\tconst task = gantt.getTask(tasks[i].id);\r\n\t\t\t\t\t\tfor (let j = 0; j < steps.length; j++) {\r\n\t\t\t\t\t\t\tconst date = steps[j];\r\n\t\t\t\t\t\t\tconst cellCss = css(task, date);\r\n\t\t\t\t\t\t\tif (cellCss){\r\n\t\t\t\t\t\t\t\ttasks[i].styles.push({ index: j, styles: gantt.ext.export_api._getStyles(cellCss) });\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn tasks;\r\n\t\t},\r\n\r\n\t\t_serializeScales(config:any) {\r\n\t\t\tconst scales:any = [];\r\n\t\t\tconst raw = gantt.ext.export_api._getRaw();\r\n\r\n\t\t\tlet min = Infinity;\r\n\t\t\tlet max = 0;\r\n\t\t\tfor (let i = 0; i < raw.length; i++) {\r\n\t\t\t\tmin = Math.min(min, raw[i].col_width);\r\n\t\t\t}\r\n\r\n\t\t\tfor (let i = 0; i < raw.length; i++) {\r\n\t\t\t\tlet start = 0;\r\n\t\t\t\tlet end = 0;\r\n\t\t\t\tconst row:any = [];\r\n\r\n\t\t\t\tscales.push(row);\r\n\t\t\t\tconst step = raw[i];\r\n\t\t\t\tmax = Math.max(max, step.trace_x.length);\r\n\t\t\t\tconst template = step.format || step.template || gantt.date.date_to_str(step.date);\r\n\r\n\t\t\t\tfor (let j = 0; j < step.trace_x.length; j++) {\r\n\t\t\t\t\tconst date = step.trace_x[j];\r\n\t\t\t\t\tend = start + Math.round(step.width[j] / min);\r\n\r\n\t\t\t\t\tconst scaleCell = { text: template(date), start, end, styles: \"\" };\r\n\r\n\t\t\t\t\tif (config.cellColors) {\r\n\t\t\t\t\t\tconst css = step.css || gantt.templates.scaleCell_class;\r\n\t\t\t\t\t\tif (css) {\r\n\t\t\t\t\t\t\tconst scaleCss = css(date);\r\n\t\t\t\t\t\t\tif (scaleCss){\r\n\t\t\t\t\t\t\t\tscaleCell.styles = gantt.ext.export_api._getStyles(scaleCss);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\trow.push(scaleCell);\r\n\t\t\t\t\tstart = end;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn { width: max, height: scales.length, data: scales };\r\n\t\t},\r\n\r\n\t\t_serializeGrid(config:any) {\r\n\t\t\tgantt.exportMode = true;\r\n\r\n\t\t\tconst columns:any = [];\r\n\t\t\tconst cols = gantt.config.columns;\r\n\r\n\t\t\tlet ccount = 0;\r\n\t\t\tfor (let i = 0; i < cols.length; i++) {\r\n\t\t\t\tif (cols[i].name === \"add\" || cols[i].name === \"buttons\") {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (config && config.raw && cols[i].hide){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcolumns[ccount] = {\r\n\t\t\t\t\tid: ((cols[i].template) ? (\"_\" + i) : cols[i].name),\r\n\t\t\t\t\theader: cols[i].label || gantt.locale.labels[\"column_\" + cols[i].name],\r\n\t\t\t\t\twidth: (cols[i].width ? Math.floor(cols[i].width / 4) : \"\"),\r\n\t\t\t\t\ttree: cols[i].tree || false\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (cols[i].name === \"duration\"){\r\n\t\t\t\t\tcolumns[ccount].type = \"number\";\r\n\t\t\t\t}\r\n\t\t\t\tif (cols[i].name === \"start_date\" || cols[i].name === \"end_date\") {\r\n\t\t\t\t\tcolumns[ccount].type = \"date\";\r\n\t\t\t\t\tif (config && config.rawDates){\r\n\t\t\t\t\t\tcolumns[ccount].id = cols[i].name;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tccount++;\r\n\t\t\t}\r\n\r\n\t\t\tgantt.exportMode = false;\r\n\t\t\treturn columns;\r\n\t\t},\r\n\r\n\t\t_exportSerialize() {\r\n\t\t\tgantt.exportMode = true;\r\n\r\n\t\t\tconst xmlFormat = gantt.templates.xml_format;\r\n\t\t\tconst formatDate = gantt.templates.format_date;\r\n\r\n\t\t\t// use configuration date format for serialization so date could be parsed on the export\r\n\t\t\t// required when custom format date function is defined\r\n\t\t\tgantt.templates.xml_format =\r\n\t\t\t\tgantt.templates.format_date =\r\n\t\t\t\tgantt.date.date_to_str(gantt.config.date_format || gantt.config.xml_date);\r\n\r\n\t\t\tconst data = gantt.serialize();\r\n\r\n\t\t\tgantt.templates.xml_format = xmlFormat;\r\n\t\t\tgantt.templates.format_date = formatDate;\r\n\t\t\tgantt.exportMode = false;\r\n\t\t\treturn data;\r\n\t\t},\r\n\r\n\r\n\t\t_setLevel(data:any) {\r\n\t\t\tfor (let i = 0; i < data.length; i++) {\r\n\t\t\t\t// tslint:disable-next-line triple-equals\r\n\t\t\t\tif (data[i].parent == 0) {\r\n\t\t\t\t\tdata[i]._lvl = 1;\r\n\t\t\t\t}\r\n\t\t\t\tfor (let j = i + 1; j < data.length; j++) {\r\n\t\t\t\t\t// tslint:disable-next-line triple-equals\r\n\t\t\t\t\tif (data[i].id == data[j].parent) {\r\n\t\t\t\t\t\tdata[j]._lvl = data[i]._lvl + 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_clearLevel(data:any) {\r\n\t\t\tfor (let i = 0; i < data.length; i++) {\r\n\t\t\t\tdelete data[i]._lvl;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_clearRecLinks(data:any) {\r\n\t\t\tgantt.ext.export_api._setLevel(data.data);\r\n\t\t\tconst tasks:any = {};\r\n\t\t\tfor (let i = 0; i < data.data.length; i++) {\r\n\t\t\t\ttasks[data.data[i].id] = data.data[i];\r\n\t\t\t}\r\n\r\n\t\t\tconst links:any = {};\r\n\r\n\t\t\tfor (let i = 0; i < data.links.length; i++) {\r\n\t\t\t\tconst link = data.links[i];\r\n\t\t\t\tif (gantt.isTaskExists(link.source) && gantt.isTaskExists(link.target) &&\r\n\t\t\t\t\ttasks[link.source] && tasks[link.target]) {\r\n\t\t\t\t\tlinks[link.id] = link;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (const j in links) {\r\n\t\t\t\tgantt.ext.export_api._makeLinksSameLevel(links[j], tasks);\r\n\t\t\t}\r\n\r\n\t\t\tconst skippedLinks = {};\r\n\t\t\tfor (const j in tasks) {\r\n\t\t\t\tgantt.ext.export_api._clearCircDependencies(tasks[j], links, tasks, {}, skippedLinks, null);\r\n\t\t\t}\r\n\r\n\t\t\tif (Object.keys(links)) {\r\n\t\t\t\tgantt.ext.export_api._clearLinksSameLevel(links, tasks);\r\n\t\t\t}\r\n\r\n\t\t\tfor (let i = 0; i < data.links.length; i++) {\r\n\t\t\t\tif (!links[data.links[i].id]) {\r\n\t\t\t\t\tdata.links.splice(i, 1);\r\n\t\t\t\t\ti--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tgantt.ext.export_api._clearLevel(data.data);\r\n\t\t},\r\n\r\n\t\t_clearCircDependencies(task:any, links:any, tasks:any, usedTasks:any, skippedLinks:any, prevLink:any) {\r\n\t\t\tconst sources = task.$_source;\r\n\t\t\tif (!sources) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (usedTasks[task.id]) {\r\n\t\t\t\tgantt.ext.export_api._onCircDependencyFind(prevLink, links, usedTasks, skippedLinks);\r\n\t\t\t}\r\n\r\n\t\t\tusedTasks[task.id] = true;\r\n\r\n\t\t\tconst targets:any = {};\r\n\r\n\t\t\tfor (let i = 0; i < sources.length; i++) {\r\n\t\t\t\tif (skippedLinks[sources[i]]) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tconst curLink = links[sources[i]];\r\n\t\t\t\tconst targetTask = tasks[curLink._target];\r\n\t\t\t\tif (targets[targetTask.id]) { // two link from one task to another\r\n\t\t\t\t\tgantt.ext.export_api._onCircDependencyFind(curLink, links, usedTasks, skippedLinks);\r\n\t\t\t\t}\r\n\t\t\t\ttargets[targetTask.id] = true;\r\n\t\t\t\tgantt.ext.export_api._clearCircDependencies(targetTask, links, tasks, usedTasks, skippedLinks, curLink);\r\n\t\t\t}\r\n\t\t\tusedTasks[task.id] = false;\r\n\t\t},\r\n\r\n\t\t_onCircDependencyFind(link:any, links:any, usedTasks:any, skippedLinks:any) {\r\n\t\t\tif (link) {\r\n\t\t\t\tif (gantt.callEvent(\"onExportCircularDependency\", [link.id, link])) {\r\n\t\t\t\t\tdelete links[link.id];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdelete usedTasks[link._source];\r\n\t\t\t\tdelete usedTasks[link._target];\r\n\t\t\t\tskippedLinks[link.id] = true;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_makeLinksSameLevel(link:any, tasks:any) {\r\n\t\t\tlet task;\r\n\t\t\tlet targetLvl;\r\n\t\t\tconst linkT:any = {\r\n\t\t\t\ttarget: tasks[link.target],\r\n\t\t\t\tsource: tasks[link.source]\r\n\t\t\t};\r\n\t\t\t// tslint:disable-next-line triple-equals\r\n\t\t\tif (linkT.target._lvl != linkT.source._lvl) {\r\n\t\t\t\tif (linkT.target._lvl < linkT.source._lvl) {\r\n\t\t\t\t\ttask = \"source\";\r\n\t\t\t\t\ttargetLvl = linkT.target._lvl;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttask = \"target\";\r\n\t\t\t\t\ttargetLvl = linkT.source._lvl;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdo {\r\n\t\t\t\t\tconst parent = tasks[linkT[task].parent];\r\n\t\t\t\t\tif (!parent) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlinkT[task] = parent;\r\n\t\t\t\t} while (linkT[task]._lvl < targetLvl);\r\n\r\n\t\t\t\tlet sourceParent = tasks[linkT.source.parent];\r\n\t\t\t\tlet\ttargetParent = tasks[linkT.target.parent];\r\n\t\t\t\t// tslint:disable-next-line triple-equals\r\n\t\t\t\twhile (sourceParent && targetParent && sourceParent.id != targetParent.id) {\r\n\t\t\t\t\tlinkT.source = sourceParent;\r\n\t\t\t\t\tlinkT.target = targetParent;\r\n\t\t\t\t\tsourceParent = tasks[linkT.source.parent];\r\n\t\t\t\t\ttargetParent = tasks[linkT.target.parent];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlink._target = linkT.target.id;\r\n\t\t\tlink._source = linkT.source.id;\r\n\r\n\t\t\tif (!linkT.target.$_target){\r\n\t\t\t\tlinkT.target.$_target = [];\r\n\t\t\t}\r\n\t\t\tlinkT.target.$_target.push(link.id);\r\n\r\n\t\t\tif (!linkT.source.$_source){\r\n\t\t\t\tlinkT.source.$_source = [];\r\n\t\t\t}\r\n\t\t\tlinkT.source.$_source.push(link.id);\r\n\t\t},\r\n\r\n\t\t_clearLinksSameLevel(links:any, tasks:any) {\r\n\t\t\tfor (const link in links) {\r\n\t\t\t\tdelete links[link]._target;\r\n\t\t\t\tdelete links[link]._source;\r\n\t\t\t}\r\n\r\n\t\t\tfor (const task in tasks) {\r\n\t\t\t\tdelete tasks[task].$_source;\r\n\t\t\t\tdelete tasks[task].$_target;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\t_customProjectProperties(data:any, config:any) {\r\n\t\t\tif (config && config.project) {\r\n\t\t\t\tfor (const i in config.project) {\r\n\t\t\t\t\tif (!gantt.config.$custom_data){\r\n\t\t\t\t\t\tgantt.config.$custom_data = {};\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgantt.config.$custom_data[i] = typeof config.project[i] === \"function\" ? config.project[i](gantt.config) : config.project[i];\r\n\t\t\t\t}\r\n\t\t\t\tdelete config.project;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_customTaskProperties(data:any, config:any) {\r\n\t\t\tif (config && config.tasks) {\r\n\t\t\t\tdata.data.forEach(function(el:any) {\r\n\t\t\t\t\tfor (const i in config.tasks) {\r\n\t\t\t\t\t\tif (!el.$custom_data){\r\n\t\t\t\t\t\t\tel.$custom_data = {};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tel.$custom_data[i] = typeof config.tasks[i] === \"function\" ? config.tasks[i](el, gantt.config) : config.tasks[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tdelete config.tasks;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_exportConfig(data:any, config:any) {\r\n\t\t\tconst projectName = config.name || \"gantt.xml\";\r\n\t\t\tdelete config.name;\r\n\r\n\t\t\tgantt.config.custom = config;\r\n\r\n\t\t\tconst time = gantt.ext.export_api._getWorktimeSettings();\r\n\r\n\t\t\tconst projectDates = gantt.getSubtaskDates();\r\n\t\t\tif (projectDates.start_date && projectDates.end_date) {\r\n\t\t\t\tconst formatDate = gantt.templates.format_date || gantt.templates.xml_format;\r\n\t\t\t\tgantt.config.start_end = {\r\n\t\t\t\t\tstart_date: formatDate(projectDates.start_date),\r\n\t\t\t\t\tend_date: formatDate(projectDates.end_date)\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tconst autoSchedulingConfig = gantt._getAutoSchedulingConfig();\r\n\r\n\t\t\tconst manual = !!(autoSchedulingConfig.enabled);\r\n\r\n\t\t\tconst res:any = {\r\n\t\t\t\tcallback: config.callback || null,\r\n\t\t\t\tconfig: gantt.config,\r\n\t\t\t\tdata,\r\n\t\t\t\tmanual,\r\n\t\t\t\tname: projectName,\r\n\t\t\t\tworktime: time\r\n\t\t\t};\r\n\t\t\tfor (const i in config) {\r\n\t\t\t\tres[i] = config[i];\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t},\r\n\r\n\r\n\t\t_sendImportAjaxMSP(config:any) {\r\n\t\t\tconst url = config.server || gantt.ext.export_api._apiUrl;\r\n\t\t\tconst store = config.store || 0;\r\n\t\t\tconst formData = config.data;\r\n\t\t\tconst callback = config.callback;\r\n\r\n\t\t\tconst settings = {\r\n\t\t\t\tdurationUnit: config.durationUnit || undefined,\r\n\t\t\t\tprojectProperties: config.projectProperties || undefined,\r\n\t\t\t\ttaskProperties: config.taskProperties || undefined,\r\n\t\t\t\tresourceProperties: config.resourceProperties || undefined,\r\n\t\t\t};\r\n\r\n\t\t\tformData.append(\"type\", config.type || \"msproject-parse\");\r\n\t\t\tformData.append(\"data\", JSON.stringify(settings));\r\n\r\n\t\t\tif (store){\r\n\t\t\t\tformData.append(\"store\", store);\r\n\t\t\t}\r\n\r\n\t\t\tconst xhr = new XMLHttpRequest();\r\n\t\t\txhr.onreadystatechange = function(e) {\r\n\t\t\t\tif (xhr.readyState === 4 && xhr.status === 0) {// network error\r\n\t\t\t\t\tif (callback) {\r\n\t\t\t\t\t\tcallback(null);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\txhr.onload = function(){\r\n\t\t\t\tconst fail = xhr.status > 400;\r\n\t\t\t\tlet info = null;\r\n\r\n\t\t\t\tif (!fail) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tinfo = JSON.parse(xhr.responseText);\r\n\t\t\t\t\t} catch (e) { }\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (callback) {\r\n\t\t\t\t\tcallback(info);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\txhr.open(\"POST\", url, true);\r\n\t\t\txhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\r\n\t\t\txhr.send(formData);\r\n\t\t}\r\n\r\n\t};\r\n\r\n\r\n\tgantt.exportToPDF = gantt.ext.export_api.exportToPDF;\r\n\tgantt.exportToPNG = gantt.ext.export_api.exportToPNG;\r\n\tgantt.exportToICal = gantt.ext.export_api.exportToICal;\r\n\tgantt.exportToExcel = gantt.ext.export_api.exportToExcel;\r\n\tgantt.exportToJSON = gantt.ext.export_api.exportToJSON;\r\n\tgantt.importFromExcel = gantt.ext.export_api.importFromExcel;\r\n\tgantt.importFromMSProject = gantt.ext.export_api.importFromMSProject;\r\n\tgantt.exportToMSProject = gantt.ext.export_api.exportToMSProject;\r\n\tgantt.importFromPrimaveraP6 = gantt.ext.export_api.importFromPrimaveraP6;\r\n\tgantt.exportToPrimaveraP6 = gantt.ext.export_api.exportToPrimaveraP6;\r\n\r\n\r\n\treturn gantt.ext.export_api;\r\n}\r\n","\r\nimport ScaleHelper from \"./scales\";\r\n\r\nfunction ScaleIgnoreHelper(gantt){\r\n\tvar helper = new ScaleHelper(gantt);\r\n\r\n\thelper.processIgnores = function (config) {\r\n\t\tvar display_count = config.count;\r\n\t\tconfig.ignore_x = {};\r\n\t\tif (gantt.ignore_time || gantt.config.skip_off_time) {\r\n\t\t\tvar ignore = gantt.ignore_time || function () {\r\n\t\t\t\treturn false;\r\n\t\t\t};\r\n\t\t\tdisplay_count = 0;\r\n\r\n\t\t\tfor (var i = 0; i < config.trace_x.length; i++) {\r\n\r\n\t\t\t\tif (ignore.call(gantt, config.trace_x[i]) || this._ignore_time_config.call(gantt, config.trace_x[i], config)) {\r\n\t\t\t\t\tconfig.ignore_x[config.trace_x[i].valueOf()] = true;\r\n\t\t\t\t\tconfig.ignored_colls = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdisplay_count++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tconfig.display_count = display_count;\r\n\t};\r\n\r\n\treturn helper;\r\n}\r\n\r\nexport default ScaleIgnoreHelper;","export default {\r\n\tKEY_CODES: {\r\n\t\tUP: 38,\r\n\t\tDOWN: 40,\r\n\t\tLEFT: 37,\r\n\t\tRIGHT: 39,\r\n\t\tSPACE: 32,\r\n\t\tENTER: 13,\r\n\t\tDELETE: 46,\r\n\t\tESC: 27,\r\n\t\tTAB: 9\r\n\t}\r\n};","export default class ExtensionsManager{\r\n\tprivate _extensions:{[key:string]: GanttPlugin };\r\n\r\n\tconstructor(config: {[key:string]: GanttPlugin }){\r\n\t\tthis._extensions = {};\r\n\t\tfor(const i in config){\r\n\t\t\tthis._extensions[i] = config[i];\r\n\t\t}\r\n\t}\r\n\r\n\taddExtension = (name: string, ext: GanttPlugin) => {\r\n\t\tthis._extensions[name] = ext;\r\n\t};\r\n\r\n\tgetExtension = (name: string): GanttPlugin => {\r\n\t\treturn this._extensions[name];\r\n\t};\r\n}","import global from \"./global\";\r\n\r\n/* eslint-disable no-restricted-globals */\r\nvar isWindowAwailable = typeof window !== \"undefined\";\r\n\r\n/* eslint-enable no-restricted-globals */\r\n\r\nconst nav = typeof navigator !== \"undefined\" ? navigator : {userAgent:\"\"};\r\n\r\nexport default {\r\n\tisIE: isWindowAwailable && (nav.userAgent.indexOf(\"MSIE\") >= 0 || nav.userAgent.indexOf(\"Trident\") >= 0),\r\n\tisOpera: isWindowAwailable && (nav.userAgent.indexOf(\"Opera\") >= 0 || nav.userAgent.indexOf(\"OPR\") >= 0),\r\n\tisChrome: isWindowAwailable && (nav.userAgent.indexOf(\"Chrome\") >= 0),\r\n\tisSafari: isWindowAwailable && (nav.userAgent.indexOf(\"Safari\") >= 0 || nav.userAgent.indexOf(\"Konqueror\") >= 0),\r\n\tisFF: isWindowAwailable && (nav.userAgent.indexOf(\"Firefox\") >= 0),\r\n\tisIPad: isWindowAwailable && (nav.userAgent.search(/iPad/gi) >= 0),\r\n\tisEdge: isWindowAwailable && (nav.userAgent.indexOf(\"Edge\")!=-1),\r\n\tisNode: (!isWindowAwailable || typeof navigator == \"undefined\" || (typeof PRODUCTION !== \"undefined\" && PRODUCTION === \"test\")),\r\n\tisSalesforce: isWindowAwailable && (!!global[\"Sfdc\"] || !!global[\"$A\"] || global[\"Aura\"])\r\n};\r\n","export default function serialize(data: object | string) {\r\n\tif (typeof data === \"string\" || typeof data === \"number\") {\r\n\t\treturn data;\r\n\t}\r\n\r\n\tlet result = \"\";\r\n\r\n\tfor (const key in data) {\r\n\t\tlet serialized = \"\";\r\n\t\tif (data.hasOwnProperty(key)) {\r\n\t\t\tif (typeof data[key] === \"string\") {\r\n\t\t\t\tserialized = encodeURIComponent(data[key]);\r\n\t\t\t} else if (typeof data[key] === \"number\") {\r\n\t\t\t\tserialized = String(data[key]);\r\n\t\t\t} else {\r\n\t\t\t\tserialized = encodeURIComponent(JSON.stringify(data[key]));\r\n\t\t\t}\r\n\t\t\tserialized = key + \"=\" + serialized;\r\n\r\n\t\t\tif (result.length) {\r\n\t\t\t\tserialized = \"&\" + serialized;\r\n\t\t\t}\r\n\t\t\tresult += serialized;\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}\r\n","import env from \"../../utils/env\";\r\nimport global from \"../../utils/global\";\r\nimport serialize from \"./serialize\";\r\n\r\nfunction createConfig(method, args) {\r\n\tvar result = {\r\n\t\tmethod: method\r\n\t};\r\n\r\n\tif (args.length === 0) {\r\n\t\tthrow new Error(\"Arguments list of query is wrong.\");\r\n\t}\r\n\tif (args.length === 1) {\r\n\t\tif (typeof args[0] === \"string\") {\r\n\t\t\tresult.url = args[0];\r\n\t\t\tresult.async = true;\r\n\t\t} else {\r\n\t\t\tresult.url = args[0].url;\r\n\t\t\tresult.async = (args[0].async || true);\r\n\t\t\tresult.callback = args[0].callback;\r\n\t\t\tresult.headers = args[0].headers;\r\n\t\t}\r\n\t\tif (method === \"POST\" || \"PUT\") {\r\n\t\t\tif (args[0].data) {\r\n\t\t\t\tif (typeof args[0].data !== \"string\") {\r\n\t\t\t\t\tresult.data = serialize(args[0].data);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult.data = args[0].data;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tresult.data = \"\";\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tresult.url = args[0];\r\n\tswitch(method) {\r\n\t\tcase \"GET\":\r\n\t\tcase \"DELETE\":\r\n\t\t\tresult.callback = args[1];\r\n\t\t\tresult.headers = args[2];\r\n\t\tbreak;\r\n\t\tcase \"POST\":\r\n\t\tcase \"PUT\":\r\n\t\t\tif (args[1]) {\r\n\t\t\t\tif (typeof args[1] !== \"string\") {\r\n\t\t\t\t\tresult.data = serialize(args[1]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult.data = args[1];\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tresult.data = \"\";\r\n\t\t\t}\r\n\t\t\tresult.callback = args[2];\r\n\t\t\tresult.headers = args[3];\r\n\t\tbreak;\r\n\t}\r\n\treturn result;\r\n}\r\n\r\nexport default function(gantt) {\r\n\treturn {\r\n\r\n\t\t// if false - dhxr param will added to prevent caching on client side (default),\r\n\t\t// if true - do not add extra params\r\n\t\tcache: true,\r\n\r\n\t\t// default method for load/loadStruct, post/get allowed\r\n\t\t// get - since 4.1.1, this should fix 412 error for macos safari\r\n\t\tmethod: \"get\",\r\n\r\n\t\tparse: function(data) {\r\n\t\t\tif (typeof data !== \"string\") return data;\r\n\r\n\t\t\tvar obj;\r\n\t\t\tdata = data.replace(/^[\\s]+/,\"\");\r\n\t\t\tif (typeof DOMParser !== \"undefined\" && !env.isIE) { // ff,ie9\r\n\t\t\t\tobj = (new DOMParser()).parseFromString(data, \"text/xml\");\r\n\t\t\t} else if (typeof global.ActiveXObject !== \"undefined\") {\r\n\t\t\t\tobj = new global.ActiveXObject(\"Microsoft.XMLDOM\");\r\n\t\t\t\tobj.async = \"false\";\r\n\t\t\t\tobj.loadXML(data);\r\n\t\t\t}\r\n\t\t\treturn obj;\r\n\t\t},\r\n\t\txmltop: function(tagname, xhr, obj) {\r\n\t\t\tif (typeof xhr.status == \"undefined\" || xhr.status < 400) {\r\n\t\t\t\tvar xml = (!xhr.responseXML) ? this.parse(xhr.responseText || xhr) : (xhr.responseXML || xhr);\r\n\t\t\t\tif (xml && xml.documentElement !== null && !xml.getElementsByTagName(\"parsererror\").length) {\r\n\t\t\t\t\treturn xml.getElementsByTagName(tagname)[0];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (obj !== -1) gantt.callEvent(\"onLoadXMLError\",[\"Incorrect XML\", arguments[1], obj]);\r\n\t\t\treturn document.createElement(\"DIV\");\r\n\t\t},\r\n\t\txpath: function(xpathExp, docObj) {\r\n\t\t\tif (!docObj.nodeName) docObj = docObj.responseXML || docObj;\r\n\t\t\tif (env.isIE) {\r\n\t\t\t\treturn docObj.selectNodes(xpathExp)||[];\r\n\t\t\t} else {\r\n\t\t\t\tvar rows = [];\r\n\t\t\t\tvar first;\r\n\t\t\t\tvar col = (docObj.ownerDocument||docObj).evaluate(xpathExp, docObj, null, XPathResult.ANY_TYPE, null);\r\n\r\n\t\t\t\twhile (true){\r\n\t\t\t\t\tfirst = col.iterateNext();\r\n\t\t\t\t\tif(first){\r\n\t\t\t\t\t\trows.push(first);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn rows;\r\n\t\t\t}\r\n\t\t},\r\n\t\tquery: function(config) {\r\n\t\t\treturn this._call(\r\n\t\t\t\t(config.method || \"GET\"),\r\n\t\t\t\tconfig.url,\r\n\t\t\t\tconfig.data || \"\",\r\n\t\t\t\t(config.async || true),\r\n\t\t\t\tconfig.callback,\r\n\t\t\t\tconfig.headers\r\n\t\t\t);\r\n\t\t},\r\n\t\tget: function(url, onLoad, headers) {\r\n\t\t\tvar config = createConfig(\"GET\", arguments);\r\n\t\t\treturn this.query(config);\r\n\t\t},\r\n\t\tgetSync: function(url, headers) {\r\n\t\t\tvar config = createConfig(\"GET\", arguments);\r\n\t\t\tconfig.async = false;\r\n\t\t\treturn this.query(config);\r\n\t\t},\r\n\t\tput: function(url, postData, onLoad, headers) {\r\n\t\t\tvar config = createConfig(\"PUT\", arguments);\r\n\t\t\treturn this.query(config);\r\n\t\t},\r\n\t\tdel: function(url, onLoad, headers) {\r\n\t\t\t/**\r\n\t\t\t * https://tools.ietf.org/html/rfc7231#section-4.3.5\r\n\t\t\t * A payload within a DELETE request message has no defined semantics;\r\n\t\t\t * sending a payload body on a DELETE request might cause some existing\r\n\t\t\t * implementations to reject the request.\r\n\t\t\t */\r\n\t\t\tvar config = createConfig(\"DELETE\", arguments);\r\n\t\t\treturn this.query(config);\r\n\t\t},\r\n\t\tpost: function(url, postData, onLoad, headers) {\r\n\t\t\tif (arguments.length == 1) {\r\n\t\t\t\tpostData = \"\";\r\n\t\t\t} else if (arguments.length == 2 && typeof(postData) == \"function\") {\r\n\t\t\t\tonLoad = postData;\r\n\t\t\t\tpostData = \"\";\r\n\t\t\t}\r\n\t\t\tvar config = createConfig(\"POST\", arguments);\r\n\t\t\treturn this.query(config);\r\n\t\t},\r\n\t\tpostSync: function(url, postData, headers) {\r\n\t\t\tpostData = (postData === null ? \"\" : String(postData));\r\n\r\n\t\t\tvar config = createConfig(\"POST\", arguments);\r\n\t\t\tconfig.async = false;\r\n\t\t\treturn this.query(config);\r\n\t\t},\r\n\t\t_call: function(method, url, postData, async, onLoad, headers) {\r\n\t\t\treturn new gantt.Promise(function(resolve, reject) {\r\n\t\t\t\tvar t = (typeof XMLHttpRequest !== undefined ? new XMLHttpRequest() : new global.ActiveXObject(\"Microsoft.XMLHTTP\"));\r\n\t\t\t\tvar isQt = (navigator.userAgent.match(/AppleWebKit/) !== null && navigator.userAgent.match(/Qt/) !== null && navigator.userAgent.match(/Safari/) !== null);\r\n\r\n\t\t\t\tif (!!async) {\r\n\t\t\t\t\tt.onreadystatechange = function() {\r\n\t\t\t\t\t\tif ((t.readyState == 4) || (isQt && t.readyState == 3)) { // what for long response and status 404?\r\n\t\t\t\t\t\t\tconst errorStatus = t.status < 200 || t.status > 299;\r\n\t\t\t\t\t\t\tif (errorStatus || t.responseText === \"\")\r\n\t\t\t\t\t\t\t\tif (!gantt.callEvent(\"onAjaxError\", [t])) return;\r\n\r\n\t\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\t\tif (typeof(onLoad) == \"function\") {\r\n\t\t\t\t\t\t\t\t\tonLoad.apply(global, [{xmlDoc:t, filePath:url}]); // dhtmlx-compat, response.xmlDoc.responseXML/responseText\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tresolve(t);\r\n\t\t\t\t\t\t\t\tif (typeof(onLoad) == \"function\") {\r\n\t\t\t\t\t\t\t\t\tonLoad = null;\r\n\t\t\t\t\t\t\t\t\tt = null;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}, 0);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvar noCache = !this || !this.cache;\r\n\t\t\t\tif (method == \"GET\" && noCache) {\r\n\t\t\t\t\turl += (url.indexOf(\"?\")>=0?\"&\":\"?\")+\"dhxr\"+new Date().getTime()+\"=1\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tt.open(method, url, async);\r\n\r\n\t\t\t\tif (headers){\r\n\t\t\t\t\tfor (var key in headers)\r\n\t\t\t\t\t\tt.setRequestHeader(key, headers[key]);\r\n\t\t\t\t} else if (method.toUpperCase() == \"POST\" || method == \"PUT\" || method == \"DELETE\") {\r\n\t\t\t\t\tt.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\r\n\t\t\t\t} else if (method == \"GET\") {\r\n\t\t\t\t\tpostData = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tt.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\r\n\r\n\t\t\t\tt.send(postData);\r\n\r\n\t\t\t\tif (!async) return {xmlDoc:t, filePath:url}; // dhtmlx-compat, response.xmlDoc.responseXML/responseText\r\n\t\t\t});\r\n\t\t},\r\n\t\turlSeparator: function(str){\r\n\t\t\tif (str.indexOf(\"?\") != -1)\r\n\t\t\t\treturn \"&\";\r\n\t\t\telse\r\n\t\t\t\treturn \"?\";\r\n\t\t}\r\n\t};\r\n};\r\n","const dateToStr = (format: string, utc: boolean, gantt) => {\r\n\tformat = format.replace(/%[a-zA-Z]/g, (a) => {\r\n\t\tswitch (a) {\r\n\t\t\tcase \"%d\":\r\n\t\t\t\treturn `\"+to_fixed(date.get${utc?\"UTC\":\"\"}Date())+\"`;\r\n\t\t\tcase \"%m\":\r\n\t\t\t\treturn `\"+to_fixed((date.get${utc?\"UTC\":\"\"}Month()+1))+\"`;\r\n\t\t\tcase \"%j\":\r\n\t\t\t\treturn `\"+date.get${utc?\"UTC\":\"\"}Date()+\"`;\r\n\t\t\tcase \"%n\":\r\n\t\t\t\treturn `\"+(date.get${utc?\"UTC\":\"\"}Month()+1)+\"`;\r\n\t\t\tcase \"%y\":\r\n\t\t\t\treturn `\"+to_fixed(date.get${utc?\"UTC\":\"\"}FullYear()%100)+\"`;\r\n\t\t\tcase \"%Y\":\r\n\t\t\t\treturn `\"+date.get${utc?\"UTC\":\"\"}FullYear()+\"`;\r\n\t\t\tcase \"%D\":\r\n\t\t\t\treturn `\"+locale.date.day_short[date.get${utc?\"UTC\":\"\"}Day()]+\"`;\r\n\t\t\tcase \"%l\":\r\n\t\t\t\treturn `\"+locale.date.day_full[date.get${utc?\"UTC\":\"\"}Day()]+\"`;\r\n\t\t\tcase \"%M\":\r\n\t\t\t\treturn `\"+locale.date.month_short[date.get${utc?\"UTC\":\"\"}Month()]+\"`;\r\n\t\t\tcase \"%F\":\r\n\t\t\t\treturn `\"+locale.date.month_full[date.get${utc?\"UTC\":\"\"}Month()]+\"`;\r\n\t\t\tcase \"%h\":\r\n\t\t\t\treturn `\"+to_fixed((date.get${utc?\"UTC\":\"\"}Hours()+11)%12+1)+\"`;\r\n\t\t\tcase \"%g\":\r\n\t\t\t\treturn `\"+((date.get${utc?\"UTC\":\"\"}Hours()+11)%12+1)+\"`;\r\n\t\t\tcase \"%G\":\r\n\t\t\t\treturn `\"+date.get${utc?\"UTC\":\"\"}Hours()+\"`;\r\n\t\t\tcase \"%H\":\r\n\t\t\t\treturn `\"+to_fixed(date.get${utc?\"UTC\":\"\"}Hours())+\"`;\r\n\t\t\tcase \"%i\":\r\n\t\t\t\treturn `\"+to_fixed(date.get${utc?\"UTC\":\"\"}Minutes())+\"`;\r\n\t\t\tcase \"%a\":\r\n\t\t\t\treturn `\"+(date.get${utc?\"UTC\":\"\"}Hours()>11?\"pm\":\"am\")+\"`;\r\n\t\t\tcase \"%A\":\r\n\t\t\t\treturn `\"+(date.get${utc?\"UTC\":\"\"}Hours()>11?\"PM\":\"AM\")+\"`;\r\n\t\t\tcase \"%s\":\r\n\t\t\t\treturn `\"+to_fixed(date.get${utc?\"UTC\":\"\"}Seconds())+\"`;\r\n\t\t\tcase \"%W\":\r\n\t\t\t\treturn `\"+to_fixed(getISOWeek(date))+\"`;\r\n\t\t\tcase \"%w\":\r\n\t\t\t\treturn `\"+to_fixed(getWeek(date))+\"`;\r\n\t\t\tdefault:\r\n\t\t\t\treturn a;\r\n\t\t}\r\n\t});\r\n\r\n\t// tslint:disable-next-line: function-constructor\r\n\tconst dateToStrFn = new Function(\"date\", \"to_fixed\", \"locale\", \"getISOWeek\", \"getWeek\", `return \"${format}\";`);\r\n\r\n\treturn (date: Date) => {\r\n\t\treturn dateToStrFn(date, gantt.date.to_fixed, gantt.locale, gantt.date.getISOWeek, gantt.date.getWeek);\r\n\t};\r\n};\r\n\r\n\r\nconst strToDate = (format: string, utc: boolean, gantt:any) => {\r\n\tlet splt = \"var temp=date.match(/[a-zA-Z]+|[0-9]+/g);\";\r\n\tconst mask = format.match(/%[a-zA-Z]/g);\r\n\tfor (let i = 0; i < mask.length; i++) {\r\n\t\tswitch (mask[i]) {\r\n\t\t\tcase \"%j\":\r\n\t\t\tcase \"%d\":\r\n\t\t\t\tsplt += `set[2]=temp[${i}]||1;`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%n\":\r\n\t\t\tcase \"%m\":\r\n\t\t\t\tsplt += `set[1]=(temp[${i}]||1)-1;`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%y\":\r\n\t\t\t\tsplt += `set[0]=temp[${i}]*1+(temp[${i}]>50?1900:2000);`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%g\":\r\n\t\t\tcase \"%G\":\r\n\t\t\tcase \"%h\":\r\n\t\t\tcase \"%H\":\r\n\t\t\t\tsplt += `set[3]=temp[${i}]||0;`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%i\":\r\n\t\t\t\tsplt += `set[4]=temp[${i}]||0;`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%Y\":\r\n\t\t\t\tsplt += `set[0]=temp[${i}]||0;`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%a\":\r\n\t\t\tcase \"%A\":\r\n\t\t\t\tsplt += `set[3]=set[3]%12+((temp[${i}]||'').toLowerCase()=='am'?0:12);`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%s\":\r\n\t\t\t\tsplt += `set[5]=temp[${i}]||0;`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%M\":\r\n\t\t\t\tsplt += `set[1]=locale.date.month_short_hash[temp[${i}]]||0;`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%F\":\r\n\t\t\t\tsplt += `set[1]=locale.date.month_full_hash[temp[${i}]]||0;`;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tlet code = \"set[0],set[1],set[2],set[3],set[4],set[5]\";\r\n\tif (utc) { code = ` Date.UTC(${code})`; }\r\n\t// tslint:disable-next-line: function-constructor\r\n\tconst strToDateFn = new Function(\"date\", \"locale\", `var set=[0,0,1,0,0,0]; ${splt} return new Date(${code});`);\r\n\r\n\treturn (dateString) => {\r\n\t\treturn strToDateFn(dateString, gantt.locale);\r\n\t};\r\n};\r\n\r\nconst fastVersion = {\r\n\tdate_to_str: dateToStr,\r\n\tstr_to_date: strToDate\r\n};\r\n\r\nexport default fastVersion;","const dateToStr = (format: string, utc: boolean, gantt) => {\r\n\treturn (date) => {\r\n\t\treturn format.replace(/%[a-zA-Z]/g, (a) => {\r\n\t\t\tswitch (a) {\r\n\t\t\t\tcase \"%d\": return utc ? gantt.date.to_fixed(date.getUTCDate()) : gantt.date.to_fixed(date.getDate());\r\n\t\t\t\tcase \"%m\": return utc ? gantt.date.to_fixed((date.getUTCMonth() + 1)) : gantt.date.to_fixed((date.getMonth() + 1));\r\n\t\t\t\tcase \"%j\": return utc ? date.getUTCDate() : date.getDate();\r\n\t\t\t\tcase \"%n\": return utc ? (date.getUTCMonth() + 1) : (date.getMonth() + 1);\r\n\t\t\t\tcase \"%y\": return utc ? gantt.date.to_fixed(date.getUTCFullYear() % 100) : gantt.date.to_fixed(date.getFullYear() % 100);\r\n\t\t\t\tcase \"%Y\": return utc ? date.getUTCFullYear() : date.getFullYear();\r\n\t\t\t\tcase \"%D\": return utc ? gantt.locale.date.day_short[date.getUTCDay()] : gantt.locale.date.day_short[date.getDay()];\r\n\t\t\t\tcase \"%l\": return utc ? gantt.locale.date.day_full[date.getUTCDay()] : gantt.locale.date.day_full[date.getDay()];\r\n\t\t\t\tcase \"%M\": return utc ? gantt.locale.date.month_short[date.getUTCMonth()] : gantt.locale.date.month_short[date.getMonth()];\r\n\t\t\t\tcase \"%F\": return utc ? gantt.locale.date.month_full[date.getUTCMonth()] : gantt.locale.date.month_full[date.getMonth()];\r\n\t\t\t\tcase \"%h\": return utc ? gantt.date.to_fixed((date.getUTCHours() + 11) % 12 + 1) : gantt.date.to_fixed((date.getHours() + 11) % 12 + 1);\r\n\t\t\t\tcase \"%g\": return utc ? ((date.getUTCHours() + 11) % 12 + 1) : ((date.getHours() + 11) % 12 + 1);\r\n\t\t\t\tcase \"%G\": return utc ? date.getUTCHours() : date.getHours();\r\n\t\t\t\tcase \"%H\": return utc ? gantt.date.to_fixed(date.getUTCHours()) : gantt.date.to_fixed(date.getHours());\r\n\t\t\t\tcase \"%i\": return utc ? gantt.date.to_fixed(date.getUTCMinutes()) : gantt.date.to_fixed(date.getMinutes());\r\n\t\t\t\tcase \"%a\": return utc ? (date.getUTCHours() > 11 ? \"pm\" : \"am\") : (date.getHours() > 11 ? \"pm\" : \"am\");\r\n\t\t\t\tcase \"%A\": return utc ? (date.getUTCHours() > 11 ? \"PM\" : \"AM\") : (date.getHours() > 11 ? \"PM\" : \"AM\");\r\n\t\t\t\tcase \"%s\": return utc ? gantt.date.to_fixed(date.getUTCSeconds()) : gantt.date.to_fixed(date.getSeconds());\r\n\t\t\t\tcase \"%W\": return utc ? gantt.date.to_fixed(gantt.date.getUTCISOWeek(date)) : gantt.date.to_fixed(gantt.date.getISOWeek(date));\r\n\t\t\t\tcase \"%w\": return gantt.date.to_fixed(gantt.date.getWeek(date));\r\n\t\t\t\tdefault: return a;\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n};\r\nconst strToDate = (format: string, utc: boolean, gantt:any) => {\r\n\treturn (date: string) => {\r\n\t\tconst set: Array<string|number> = [0, 0, 1, 0, 0, 0];\r\n\t\tconst temp = date.match(/[a-zA-Z]+|[0-9]+/g);\r\n\t\tconst mask = format.match(/%[a-zA-Z]/g);\r\n\r\n\t\tfor (let i = 0; i < mask.length; i++) {\r\n\t\t\tswitch (mask[i]) {\r\n\t\t\t\tcase \"%j\":\r\n\t\t\t\tcase \"%d\":\r\n\t\t\t\t\tset[2] = temp[i] as unknown as number || 1;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%n\":\r\n\t\t\t\tcase \"%m\":\r\n\t\t\t\t\tset[1] = (temp[i] as unknown as number || 1) - 1;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%y\":\r\n\t\t\t\t\tset[0] = temp[i] as unknown as number * 1 + ((temp[i] as unknown as number) > 50 ? 1900 : 2000);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%g\":\r\n\t\t\t\tcase \"%G\":\r\n\t\t\t\tcase \"%h\":\r\n\t\t\t\tcase \"%H\":\r\n\t\t\t\t\tset[3] = temp[i] as unknown as number || 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%i\":\r\n\t\t\t\t\tset[4] = temp[i] as unknown as number || 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%Y\":\r\n\t\t\t\t\tset[0] = temp[i] as unknown as number || 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%a\":\r\n\t\t\t\tcase \"%A\":\r\n\t\t\t\t\tset[3] = set[3] as number % 12 + ((temp[i] || \"\").toLowerCase() === \"am\" ? 0 : 12);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%s\":\r\n\t\t\t\t\tset[5] = temp[i] || 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%M\":\r\n\t\t\t\t\tset[1] = gantt.locale.date.month_short_hash[temp[i]] || 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%F\":\r\n\t\t\t\t\tset[1] = gantt.locale.date.month_full_hash[temp[i]] || 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (utc) {\r\n\t\t\treturn new Date(Date.UTC(\r\n\t\t\t\tset[0] as number,\r\n\t\t\t\tset[1] as number,\r\n\t\t\t\tset[2] as number,\r\n\t\t\t\tset[3] as number,\r\n\t\t\t\tset[4] as number,\r\n\t\t\t\tset[5] as number\r\n\t\t\t));\r\n\t\t}\r\n\t\treturn new Date(\r\n\t\t\tset[0] as number,\r\n\t\t\tset[1] as number,\r\n\t\t\tset[2] as number,\r\n\t\t\tset[3] as number,\r\n\t\t\tset[4] as number,\r\n\t\t\tset[5] as number\r\n\t\t);\r\n\t};\r\n\r\n};\r\n\r\n\r\nconst cspVersion = {\r\n\tdate_to_str: dateToStr,\r\n\tstr_to_date: strToDate\r\n};\r\n\r\nexport default cspVersion;","/*\r\n %d - the day as a number with a leading zero ( 01 to 31 );\r\n %j - the day as a number without a leading zero ( 1 to 31 );\r\n %D - the day as an abbreviation ( Sun to Sat );\r\n %l - the day as a full name ( Sunday to Saturday );\r\n %W - the ISO-8601 week number of the year. Weeks start on Monday; 1)\r\n %m - the month as a number without a leading zero ( 1 to 12 );\r\n %n - the month as a number with a leading zero ( 01 to 12);\r\n %M - the month as an abbreviation ( Jan to Dec );\r\n %F - the month as a full name ( January to December );\r\n %y - the year as a two-digit number ( 00 to 99 );\r\n %Y - the year as a four-digit number ( 19009999 );\r\n %h - the hour based on the 12-hour clock ( 00 to 11 );\r\n %H - the hour based on the 24-hour clock ( 00 to 23 );\r\n %i - the minute as a number with a leading zero ( 00 to 59 );\r\n %s - the second as a number without a leading zero ( 00 to 59 ); 2)\r\n %a - displays am (for times from midnight until noon) and pm (for times from noon until midnight);\r\n %A - displays AM (for times from midnight until noon) and PM (for times from noon until midnight).\r\n*/\r\n\r\nimport fastVersion from \"./date_parsers/fast_version\";\r\nimport cspCompliantVersion from \"./date_parsers/csp_compliant_version\";\r\n\r\nexport default function(gantt) {\r\n\tvar canUseCsp = null;\r\n\tfunction cspAutoCheck() {\r\n\t\ttry {\r\n\t\t\tnew Function(\"canUseCsp = false;\");\r\n\t\t} catch(e) {\r\n\t\t\tcanUseCsp = true;\r\n\t\t}\r\n\t}\r\n\tfunction useCsp() {\r\n\t\tvar result = false;\r\n\t\tif (gantt.config.csp === \"auto\") {\r\n\t\t\tif(canUseCsp === null) {\r\n\t\t\t\tcspAutoCheck();\r\n\t\t\t}\r\n\t\t\tresult = canUseCsp;\r\n\t\t} else {\r\n\t\t\tresult = gantt.config.csp;\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tvar dateHelper = {\r\n\t\tinit: function () {\r\n\t\t\tvar locale = gantt.locale;\r\n\r\n\t\t\tvar s = locale.date.month_short;\r\n\t\t\tvar t = locale.date.month_short_hash = {};\r\n\t\t\tfor (var i = 0; i < s.length; i++)\r\n\t\t\t\tt[s[i]] = i;\r\n\r\n\t\t\tvar s = locale.date.month_full;\r\n\t\t\tvar t = locale.date.month_full_hash = {};\r\n\t\t\tfor (var i = 0; i < s.length; i++)\r\n\t\t\t\tt[s[i]] = i;\r\n\t\t},\r\n\t\tdate_part: function (date) {\r\n\t\t\tvar old = new Date(date);\r\n\t\t\tdate.setHours(0);\r\n\t\t\tthis.hour_start(date);\r\n\t\t\tif (date.getHours() && //shift to yesterday on dst\r\n\t\t\t\t(date.getDate() < old.getDate() || date.getMonth() < old.getMonth() || date.getFullYear() < old.getFullYear()))\r\n\t\t\t\tdate.setTime(date.getTime() + 60 * 60 * 1000 * (24 - date.getHours()));\r\n\t\t\treturn date;\r\n\t\t},\r\n\t\ttime_part: function (date) {\r\n\t\t\treturn (date.valueOf() / 1000 - date.getTimezoneOffset() * 60) % 86400;\r\n\t\t},\r\n\t\tweek_start: function (date) {\r\n\t\t\tvar shift = date.getDay();\r\n\t\t\tif (gantt.config.start_on_monday) {\r\n\t\t\t\tif (shift === 0) shift = 6;\r\n\t\t\t\telse shift--;\r\n\t\t\t}\r\n\t\t\treturn this.date_part(this.add(date, -1 * shift, \"day\"));\r\n\t\t},\r\n\t\tmonth_start: function (date) {\r\n\t\t\tdate.setDate(1);\r\n\t\t\treturn this.date_part(date);\r\n\t\t},\r\n\t\tquarter_start: function (date) {\r\n\t\t\tthis.month_start(date);\r\n\t\t\tvar m = date.getMonth(),\r\n\t\t\t\tres_month;\r\n\r\n\t\t\tif (m >= 9) {\r\n\t\t\t\tres_month = 9;\r\n\t\t\t} else if (m >= 6) {\r\n\t\t\t\tres_month = 6;\r\n\t\t\t} else if (m >= 3) {\r\n\t\t\t\tres_month = 3;\r\n\t\t\t} else {\r\n\t\t\t\tres_month = 0;\r\n\t\t\t}\r\n\r\n\t\t\tdate.setMonth(res_month);\r\n\t\t\treturn date;\r\n\t\t},\r\n\t\tyear_start: function (date) {\r\n\t\t\tdate.setMonth(0);\r\n\t\t\treturn this.month_start(date);\r\n\t\t},\r\n\t\tday_start: function (date) {\r\n\t\t\treturn this.date_part(date);\r\n\t\t},\r\n\t\thour_start: function (date) {\r\n\t\t\tif (date.getMinutes())\r\n\t\t\t\tdate.setMinutes(0);\r\n\t\t\tthis.minute_start(date);\r\n\r\n\t\t\treturn date;\r\n\t\t},\r\n\t\tminute_start: function (date) {\r\n\t\t\tif (date.getSeconds())\r\n\t\t\t\tdate.setSeconds(0);\r\n\t\t\tif (date.getMilliseconds())\r\n\t\t\t\tdate.setMilliseconds(0);\r\n\t\t\treturn date;\r\n\t\t},\r\n\t\t_add_days: function (modifiedDate, inc, originalDate) {\r\n\r\n\t\t\tmodifiedDate.setDate(modifiedDate.getDate() + inc);\r\n\t\t\tvar incCondition = inc >= 0;\r\n\t\t\tvar getHoursCondition = !originalDate.getHours() && modifiedDate.getHours(); //shift to yesterday on dst\r\n\t\t\tvar getDateCondition = (modifiedDate.getDate() <= originalDate.getDate() || modifiedDate.getMonth() < originalDate.getMonth() || modifiedDate.getFullYear() < originalDate.getFullYear());\r\n\t\t\tif (incCondition && getHoursCondition && getDateCondition){\r\n\t\t\t\tmodifiedDate.setTime(modifiedDate.getTime() + 60 * 60 * 1000 * (24 - modifiedDate.getHours()));\r\n\t\t\t}\r\n\t\t\tvar worktimeCalculation = inc > 1;\r\n\t\t\tif (worktimeCalculation && getHoursCondition){\r\n\t\t\t\t// try to shift the modified Date to 00:00\r\n\t\t\t\tmodifiedDate.setHours(0);\r\n\t\t\t}\r\n\t\t\treturn modifiedDate;\r\n\t\t},\r\n\r\n\t\tadd: function (date, inc, mode) {\r\n\t\t\t/*jsl:ignore*/\r\n\t\t\tvar ndate = new Date(date.valueOf());\r\n\t\t\tswitch (mode) {\r\n\t\t\t\tcase \"day\":\r\n\t\t\t\t\tndate = this._add_days(ndate, inc, date);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"week\":\r\n\t\t\t\t\tndate = this._add_days(ndate, inc * 7, date);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"month\":\r\n\t\t\t\t\tndate.setMonth(ndate.getMonth() + inc);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"year\":\r\n\t\t\t\t\tndate.setYear(ndate.getFullYear() + inc);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"hour\":\r\n\t\t\t\t\t/*\r\n\t\t\t\t\t\tadding hours/minutes via setHour(getHour() + inc) gives weird result when\r\n\t\t\t\t\t\tadding one hour to the time before switch to a Daylight Saving time\r\n\r\n\t\t\t\t\t\texample: //Sun Mar 30 2014 01:00:00 GMT+0100 (W. Europe Standard Time)\r\n\t\t\t\t\t\tnew Date(2014, 02, 30, 1).setHours(2)\r\n\t\t\t\t\t\t>>Sun Mar 30 2014 01:00:00 GMT+0100 (W. Europe Standard Time)\r\n\r\n\t\t\t\t\t\tsetTime seems working as expected\r\n\t\t\t\t\t */\r\n\t\t\t\t\tndate.setTime(ndate.getTime() + inc * 60 * 60 * 1000);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"minute\":\r\n\r\n\t\t\t\t\tndate.setTime(ndate.getTime() + inc * 60 * 1000);\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn this[\"add_\" + mode](date, inc, mode);\r\n\t\t\t}\r\n\t\t\treturn ndate;\r\n\t\t\t/*jsl:end*/\r\n\t\t},\r\n\t\tadd_quarter: function (date, inc) {\r\n\t\t\treturn this.add(date, inc * 3, \"month\");\r\n\t\t},\r\n\r\n\t\tto_fixed: function (num) {\r\n\t\t\tif (num < 10) return \"0\" + num;\r\n\t\t\treturn num;\r\n\t\t},\r\n\t\tcopy: function (date) {\r\n\t\t\treturn new Date(date.valueOf());\r\n\t\t},\r\n\t\tdate_to_str: function (format, utc) {\r\n\t\t\tvar result = fastVersion;\r\n\t\t\tif (useCsp()) {\r\n\t\t\t\tresult = cspCompliantVersion;\r\n\t\t\t}\r\n\t\t\treturn result.date_to_str(format, utc, gantt);\r\n\t\t},\r\n\t\tstr_to_date: function (format, utc) {\r\n\t\t\tvar result = fastVersion;\r\n\t\t\tif (useCsp()) {\r\n\t\t\t\tresult = cspCompliantVersion;\r\n\t\t\t}\r\n\t\t\treturn result.str_to_date(format, utc, gantt);\r\n\t\t},\r\n\t\tgetISOWeek: function (ndate) {\r\n\t\t\treturn gantt.date._getWeekNumber(ndate, true);\r\n\t\t},\r\n\t\t_getWeekNumber: function(ndate, isoWeek){\r\n\t\t\tif (!ndate) return false;\r\n\t\t\tvar nday = ndate.getDay();\r\n\t\t\tif(isoWeek){\r\n\t\t\t\tif (nday === 0) {\r\n\t\t\t\t\tnday = 7;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar first_thursday = new Date(ndate.valueOf());\r\n\t\t\tfirst_thursday.setDate(ndate.getDate() + (4 - nday));\r\n\t\t\tvar year_number = first_thursday.getFullYear(); // year of the first Thursday\r\n\t\t\tvar ordinal_date = Math.round((first_thursday.getTime() - new Date(year_number, 0, 1).getTime()) / 86400000); //ordinal date of the first Thursday - 1 (so not really ordinal date)\r\n\t\t\tvar week_number = 1 + Math.floor(ordinal_date / 7);\r\n\t\t\treturn week_number;\r\n\t\t},\r\n\r\n\t\tgetWeek: function(ndate){\r\n\t\t\treturn gantt.date._getWeekNumber(ndate, gantt.config.start_on_monday);\r\n\t\t},\r\n\t\tgetUTCISOWeek: function (ndate) {\r\n\t\t\treturn gantt.date.getISOWeek(ndate);\r\n\t\t},\r\n\t\tconvert_to_utc: function (date) {\r\n\t\t\treturn new Date(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds());\r\n\t\t},\r\n\t\tparseDate: function (date, format) {\r\n\t\t\t// raw date may be of type string, number (timestamp) or something else\r\n\t\t\t// do not check for instanceof Date explicitly, since we may swap native date with different date implementation at some point\r\n\t\t\tif (date && !date.getFullYear) {\r\n\t\t\t\tif (typeof(format) !== \"function\") {\r\n\t\t\t\t\tif (typeof(format) === \"string\") {\r\n\t\t\t\t\t\tif (format === \"parse_date\" || format === \"xml_date\") {\r\n\t\t\t\t\t\t\tformat = gantt.defined(gantt.templates.xml_date) ? gantt.templates.xml_date : gantt.templates.parse_date;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tformat = gantt.defined(gantt.templates[format]) ? gantt.templates[format] : gantt.date.str_to_date(format);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tformat = gantt.defined(gantt.templates.xml_date) ? gantt.templates.xml_date : gantt.templates.parse_date;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (date) {\r\n\t\t\t\t\tdate = format(date);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdate = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn date;\r\n\t\t}\r\n\t};\r\n\treturn dateHelper;\r\n};","class t{constructor(t){const{url:e,token:s}=t;this._url=e,this._token=s,this._mode=1,this._seed=1,this._queue=[],this.data={},this.api={},this._events={}}headers(){return{Accept:\"application/json\",\"Content-Type\":\"application/json\",\"Remote-Token\":this._token}}fetch(t,e){const s={credentials:\"include\",headers:this.headers()};return e&&(s.method=\"POST\",s.body=e),fetch(t,s).then(t=>t.json())}load(t){return t&&(this._url=t),this.fetch(this._url).then(t=>this.parse(t))}parse(t){const{key:e,websocket:s}=t;e&&(this._token=t.key);for(const e in t.data)this.data[e]=t.data[e];for(const e in t.api){const s=this.api[e]={},i=t.api[e];for(const t in i)s[t]=this._wrapper(e+\".\"+t)}return s&&this.connect(),this}connect(){const t=this._socket;t&&(this._socket=null,t.onclose=function(){},t.close()),this._mode=2,this._socket=function(t,e,s,i){let n=e;\"/\"===n[0]&&(n=document.location.protocol+\"//\"+document.location.host+e);n=n.replace(/^http(s|):/,\"ws$1:\");const o=-1!=n.indexOf(\"?\")?\"&\":\"?\";n=`${n}${o}token=${s}&ws=1`;const r=new WebSocket(n);return r.onclose=()=>setTimeout(()=>t.connect(),2e3),r.onmessage=e=>{const s=JSON.parse(e.data);switch(s.action){case\"result\":t.result(s.body,[]);break;case\"event\":t.fire(s.body.name,s.body.value);break;case\"start\":i();break;default:t.onError(s.data)}},r}(this,this._url,this._token,()=>(this._mode=3,this._send(),this._resubscribe(),this))}_wrapper(t){return function(){const e=[].slice.call(arguments);let s=null;const i=new Promise((i,n)=>{s={data:{id:this._uid(),name:t,args:e},status:1,resolve:i,reject:n},this._queue.push(s)});return this.onCall(s,i),3===this._mode?this._send(s):setTimeout(()=>this._send(),1),i}.bind(this)}_uid(){return(this._seed++).toString()}_send(t){if(2==this._mode)return void setTimeout(()=>this._send(),100);const e=t?[t]:this._queue.filter(t=>1===t.status);if(!e.length)return;const s=e.map(t=>(t.status=2,t.data));3!==this._mode?this.fetch(this._url,JSON.stringify(s)).catch(t=>this.onError(t)).then(t=>this.result(t,s)):this._socket.send(JSON.stringify({action:\"call\",body:s}))}result(t,e){const s={};if(t)for(let e=0;e<t.length;e++)s[t[e].id]=t[e];else for(let t=0;t<e.length;t++)s[e[t].id]={id:e[t].id,error:\"Network Error\",data:null};for(let t=this._queue.length-1;t>=0;t--){const e=this._queue[t],i=s[e.data.id];i&&(this.onResponse(e,i),i.error?e.reject(i.error):e.resolve(i.data),this._queue.splice(t,1))}}on(t,e){const s=this._uid();let i=this._events[t];const n=!!i;return n||(i=this._events[t]=[]),i.push({id:s,handler:e}),n||3!=this._mode||this._socket.send(JSON.stringify({action:\"subscribe\",name:t})),{name:t,id:s}}_resubscribe(){if(3==this._mode)for(const t in this._events)this._socket.send(JSON.stringify({action:\"subscribe\",name:t}))}detach(t){if(!t){if(3==this._mode)for(const t in this._events)this._socket.send(JSON.stringify({action:\"unsubscribe\",key:t}));return void(this._events={})}const{id:e,name:s}=t,i=this._events[s];if(i){const t=i.filter(t=>t.id!=e);t.length?this._events[s]=t:(delete this._events[s],3==this._mode&&this._socket.send(JSON.stringify({action:\"unsubscribe\",name:s})))}}fire(t,e){const s=this._events[t];if(s)for(let t=0;t<s.length;t++)s[t].handler(e)}onError(t){return null}onCall(t,e){}onResponse(t,e){}}export{t as Client};\n//# sourceMappingURL=remote.es6.js.map\n","import * as remote_client from \"remote-client\";\r\nexport const remoteEvents = function(url, token) {\r\n    const remote = new remote_client.Client({\r\n      url,\r\n      token\r\n    });\r\n\r\n    // temporary patch, as we do not want credentials\r\n    remote.fetch = function (url, body) {\r\n      const req = {\r\n        headers: this.headers()\r\n      };\r\n      if (body) {\r\n        req.method = \"POST\";\r\n        req.body = body;\r\n      }\r\n\r\n      return fetch(url, req).then((res) => res.json());\r\n    };\r\n\r\n    this._ready = remote.load().then((back) => (this._remote = back));\r\n\r\n    function ready() {\r\n      return this._ready;\r\n    }\r\n  \r\n    function on(name, handler) {\r\n      this.ready().then((back) => {\r\n        if (typeof name === \"string\") back.on(name, handler);\r\n        else {\r\n          for (const key in name) {\r\n            back.on(key, name[key]);\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    this.ready = ready;\r\n    this.on = on;\r\n  };\r\n\r\n","function checkTimeout(host, updPerSecond){\r\n\tif (!updPerSecond)\r\n\t\treturn true;\r\n\t\r\n\tif (host._on_timeout)\r\n\t\treturn false;\r\n\t\r\n\tvar timeout = Math.ceil(1000/updPerSecond);\r\n\tif (timeout < 2) return true;\r\n\r\n\tsetTimeout(function(){\r\n\t\tdelete host._on_timeout;\r\n\t}, timeout);\r\n\r\n\thost._on_timeout = true;\r\n\treturn true;\r\n}\r\n\r\nexport default checkTimeout;","import * as utils from \"../../utils/utils\";\r\n\r\nvar StateService = (function(){\r\n\tvar stateProviders = {};\r\n\r\n\tfunction getState(name){\r\n\t\tvar provider = stateProviders[name];\r\n\t\tif(provider){\r\n\t\t\treturn stateProviders[name].method();\r\n\t\t}else{\r\n\t\t\tvar res = {};\r\n\t\t\tfor(var i in stateProviders){\r\n\t\t\t\tif(!stateProviders[i].internal)\r\n\t\t\t\t\tutils.mixin(res, stateProviders[i].method(), true);\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction registerProvider(name, provider, internal){\r\n\t\tstateProviders[name] = { method: provider, internal: internal};\r\n\t}\r\n\r\n\tfunction unregisterProvider(name){\r\n\t\tdelete stateProviders[name];\r\n\t}\r\n\r\n\treturn {\r\n\t\tgetState: getState,\r\n\t\tregisterProvider: registerProvider,\r\n\t\tunregisterProvider: unregisterProvider\r\n\t};\r\n});\r\n\r\nexport default StateService;\r\n\r\n","export default Promise;","import * as utils from \"../../utils/utils\";\r\nimport {replaceValidZeroId} from \"../../utils/helpers\";\r\n\r\nvar createTasksDatastoreFacade = function(){\r\n\treturn {\r\n\tgetTask: function (id) {\r\n\t\tid = replaceValidZeroId(id, this.config.root_id);\r\n\t\tthis.assert(id, \"Invalid argument for gantt.getTask\");\r\n\t\tvar task = this.$data.tasksStore.getItem(id);\r\n\t\tthis.assert(task, \"Task not found id=\" + id);\r\n\t\treturn task;\r\n\t},\r\n\tgetTaskByTime: function (from, to) {\r\n\t\tvar p = this.$data.tasksStore.getItems();\r\n\r\n\t\tvar res = [];\r\n\r\n\t\tif (!(from || to)) {\r\n\t\t\tres = p;\r\n\t\t} else {\r\n\t\t\tfrom = +from || -Infinity;\r\n\t\t\tto = +to || Infinity;\r\n\t\t\tfor (var t = 0; t < p.length; t++){\r\n\t\t\t\tvar task = p[t];\r\n\t\t\t\tif (+task.start_date < to && +task.end_date > from)\r\n\t\t\t\t\tres.push(task);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn res;\r\n\t},\r\n\tisTaskExists: function (id) {\r\n\t\tif(!this.$data || !this.$data.tasksStore){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn this.$data.tasksStore.exists(id);\r\n\t},\r\n\tupdateTask: function (id, item) {\r\n\t\tif (!utils.defined(item)) item = this.getTask(id);\r\n\t\tthis.$data.tasksStore.updateItem(id, item);\r\n\t\tif(this.isTaskExists(id))\r\n\t\t\tthis.refreshTask(id);\r\n\t},\r\n\taddTask: function (item, parent, index) {\r\n\t\tif (!utils.defined(item.id))\r\n\t\t\titem.id = utils.uid();\r\n\r\n\t\t//GS-761: assert unique ID\r\n\t\tif (this.isTaskExists(item.id)){\r\n\t\t\tvar task = this.getTask(item.id);\r\n\t\t\tif (task.$index != item.$index) {\r\n\t\t\t\t// Someone may try to mistakenly add a task with the same ID, and most likely\r\n\t\t\t\t// use the string format for the dates. Gantt shouldn't break in this scenario\r\n\t\t\t\tif (item.start_date && typeof item.start_date === \"string\"){\r\n\t\t\t\t\titem.start_date = this.date.parseDate(item.start_date, \"parse_date\");\r\n\t\t\t\t}\r\n\t\t\t\tif (item.end_date && typeof item.end_date === \"string\"){\r\n\t\t\t\t\titem.end_date = this.date.parseDate(item.end_date, \"parse_date\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn this.$data.tasksStore.updateItem(item.id, item);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tif (!utils.defined(parent)) parent = this.getParent(item) || 0;\r\n\t\tif (!this.isTaskExists(parent)) parent = this.config.root_id;\r\n\t\tthis.setParent(item, parent);\r\n\r\n\t\t// GS-1583. Save the $open state to the Undo Stack\r\n\t\tif (this.getState().lightbox && this.isTaskExists(parent)) {\r\n\t\t\tvar parentObj = this.getTask(parent);\r\n\t\t\tthis.callEvent(\"onAfterParentExpand\", [parent, parentObj]);\r\n\t\t}\r\n\t\treturn this.$data.tasksStore.addItem(item, index, parent);\r\n\t},\r\n\tdeleteTask: function (id) {\r\n\t\tid = replaceValidZeroId(id, this.config.root_id);\r\n\t\treturn this.$data.tasksStore.removeItem(id);\r\n\t},\r\n\tgetTaskCount: function () {\r\n\t\treturn this.$data.tasksStore.count();\r\n\t},\r\n\tgetVisibleTaskCount: function () {\r\n\t\treturn this.$data.tasksStore.countVisible();\r\n\t},\r\n\tgetTaskIndex: function (id) {\r\n\t\treturn this.$data.tasksStore.getBranchIndex(id);\r\n\t},\r\n\tgetGlobalTaskIndex: function (id) {\r\n\t\tid = replaceValidZeroId(id, this.config.root_id);\r\n\t\tthis.assert(id, \"Invalid argument\");\r\n\t\treturn this.$data.tasksStore.getIndexById(id);\r\n\t},\r\n\teachTask: function (code, parent, master) {\r\n\t\treturn this.$data.tasksStore.eachItem(utils.bind(code, master||this), parent);\r\n\t},\r\n\teachParent: function (callback, startTask, master) {\r\n\t\treturn this.$data.tasksStore.eachParent(utils.bind(callback, master || this), startTask);\r\n\t},\r\n\tchangeTaskId: function (oldid, newid) {\r\n\t\tthis.$data.tasksStore.changeId(oldid, newid);\r\n\t\tvar task = this.$data.tasksStore.getItem(newid);\r\n\r\n\t\tvar links = [];\r\n\r\n\t\tif (task.$source) {\r\n\t\t\tlinks = links.concat(task.$source);\r\n\t\t}\r\n\t\tif (task.$target) {\r\n\t\t\tlinks = links.concat(task.$target);\r\n\t\t}\r\n\r\n\t\tfor (var i = 0; i < links.length; i++) {\r\n\t\t\tvar link = this.getLink(links[i]);\r\n\t\t\tif (link.source == oldid) {\r\n\t\t\t\tlink.source = newid;\r\n\t\t\t}\r\n\t\t\tif (link.target == oldid) {\r\n\t\t\t\tlink.target = newid;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tcalculateTaskLevel: function (item) {\r\n\t\treturn this.$data.tasksStore.calculateItemLevel(item);\r\n\t},\r\n\tgetNext: function (id) {\r\n\t\treturn this.$data.tasksStore.getNext(id);\r\n\t},\r\n\tgetPrev: function (id) {\r\n\t\treturn this.$data.tasksStore.getPrev(id);\r\n\t},\r\n\tgetParent: function (id) {\r\n\t\treturn this.$data.tasksStore.getParent(id);\r\n\t},\r\n\tsetParent: function (task, new_pid, silent) {\r\n\t\treturn this.$data.tasksStore.setParent(task, new_pid, silent);\r\n\t},\r\n\tgetSiblings: function (id) {\r\n\t\treturn this.$data.tasksStore.getSiblings(id).slice();\r\n\t},\r\n\tgetNextSibling: function (id) {\r\n\t\treturn this.$data.tasksStore.getNextSibling(id);\r\n\t},\r\n\tgetPrevSibling: function (id) {\r\n\t\treturn this.$data.tasksStore.getPrevSibling(id);\r\n\t},\r\n\tgetTaskByIndex: function(index){\r\n\t\tvar id = this.$data.tasksStore.getIdByIndex(index);\r\n\t\tif(this.isTaskExists(id)){\r\n\t\t\treturn this.getTask(id);\r\n\t\t}else{\r\n\t\t\treturn null;\r\n\t\t}\r\n\t},\r\n\tgetChildren: function (id) {\r\n\t\tif(!this.hasChild(id)){\r\n\t\t\treturn [];\r\n\t\t}else{\r\n\t\t\treturn this.$data.tasksStore.getChildren(id).slice();\r\n\t\t}\r\n\t},\r\n\thasChild: function (id) {\r\n\t\treturn this.$data.tasksStore.hasChild(id);\r\n\t},\r\n\topen: function (id) {\r\n\t\tthis.$data.tasksStore.open(id);\r\n\t},\r\n\tclose: function (id) {\r\n\t\tthis.$data.tasksStore.close(id);\r\n\t},\r\n\tmoveTask: function (sid, tindex, parent) {\r\n\t\tparent = replaceValidZeroId(parent, this.config.root_id);\r\n\t\treturn this.$data.tasksStore.move.apply(this.$data.tasksStore, arguments);\r\n\t},\r\n\tsort: function(field, desc, parent, silent) {\r\n\t\tvar render = !silent;//4th argument to cancel redraw after sorting\r\n\r\n\t\tthis.$data.tasksStore.sort(field, desc, parent);\r\n\t\tthis.callEvent(\"onAfterSort\", [field, desc, parent]);\r\n\r\n\t\tif (render) {\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t}\r\n};\r\n};\r\n\r\nexport default createTasksDatastoreFacade;\r\n\r\n\r\n","import * as utils from \"../../utils/utils\";\r\n\r\nvar $powerArray  = {\r\n\t$create: function(array){\r\n\t\treturn utils.mixin(array || [], this);\r\n\t},\r\n\t//remove element at specified position\r\n\t$removeAt:function(pos,len){\r\n\t\tif (pos>=0) this.splice(pos,(len||1));\r\n\t},\r\n\t//find element in collection and remove it\r\n\t$remove:function(value){\r\n\t\tthis.$removeAt(this.$find(value));\r\n\t},\r\n\t//add element to collection at specific position\r\n\t$insertAt:function(data,pos){\r\n\t\tif (!pos && pos!==0) \t//add to the end by default\r\n\t\t\tthis.push(data);\r\n\t\telse {\r\n\t\t\tvar b = this.splice(pos,(this.length-pos));\r\n\t\t\tthis[pos] = data;\r\n\t\t\tthis.push.apply(this,b); //reconstruct array without loosing this pointer\r\n\t\t}\r\n\t},\r\n\t//return index of element, -1 if it doesn't exists\r\n\t$find:function(data){\r\n\t\tfor (var i=0; i<this.length; i++)\r\n\t\t\tif (data==this[i]) return i;\r\n\t\treturn -1;\r\n\t},\r\n\t//execute some method for each element of array\r\n\t$each:function(functor,master){\r\n\t\tfor (var i=0; i < this.length; i++)\r\n\t\t\tfunctor.call((master||this),this[i]);\r\n\t},\r\n\t//create new array from source, by using results of functor\r\n\t$map:function(functor,master){\r\n\t\tfor (var i=0; i < this.length; i++)\r\n\t\t\tthis[i]=functor.call((master||this),this[i]);\r\n\t\treturn this;\r\n\t},\r\n\t$filter:function(functor, master){\r\n\t\tfor (var i=0; i < this.length; i++)\r\n\t\t\tif (!functor.call((master||this),this[i])){\r\n\t\t\t\tthis.splice(i,1);\r\n\t\t\t\ti--;\r\n\t\t\t}\r\n\t\treturn this;\r\n\t}\r\n};\r\n\r\nexport default $powerArray;","/**\r\n * Check the over task or draggble task is placeholder task\r\n */\r\n\r\nexport default function isPlaceholderTask(id, gantt, store, config) {\r\n\t// return false;\r\n\tvar config = gantt ? gantt.config : config;\r\n\tif (config && config.placeholder_task) {\r\n\t\tif (store.exists(id)){\r\n\t\t\tvar item = store.getItem(id);\r\n\t\t\treturn item.type === config.types.placeholder;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n};","import powerArray from \"./power_array\";\r\nimport * as utils from \"../../utils/utils\";\r\nimport eventable from \"../../utils/eventable\";\r\nimport isPlaceholderTask from \"../../utils/placeholder_task\";\r\n\r\nvar DataStore = function(config){\r\n\tthis.pull = {};\r\n\tthis.$initItem = config.initItem;\r\n\tthis.visibleOrder = powerArray.$create();\r\n\tthis.fullOrder = powerArray.$create();\r\n\tthis._skip_refresh = false;\r\n\tthis._filterRule = null;\r\n\tthis._searchVisibleOrder = {};\r\n\tthis._indexRangeCache = {};\r\n\tthis._getItemsCache = null;\r\n\tthis.$config = config;\r\n\teventable(this);\r\n\r\n\tthis._attachDataChange(function(){\r\n\t\tthis._indexRangeCache = {};\r\n\t\tthis._getItemsCache = null;\r\n\t\treturn true;\r\n\t});\r\n\treturn this;\r\n};\r\nDataStore.prototype = {\r\n\r\n\t_attachDataChange: function(callback){\r\n\t\tthis.attachEvent(\"onClearAll\", callback);\r\n\t\tthis.attachEvent(\"onBeforeParse\", callback);\r\n\t\tthis.attachEvent(\"onBeforeUpdate\", callback);\r\n\t\tthis.attachEvent(\"onBeforeDelete\", callback);\r\n\t\tthis.attachEvent(\"onBeforeAdd\", callback);\r\n\t\tthis.attachEvent(\"onParse\", callback);\r\n\t\tthis.attachEvent(\"onBeforeFilter\", callback);\r\n\t},\r\n\t_parseInner: function(data){\r\n\t\tvar item = null,\r\n\t\t\tloaded = [];\r\n\t\tfor(var i = 0, len = data.length; i< len; i++){\r\n\t\t\titem = data[i];\r\n\t\t\tif(this.$initItem){\r\n\t\t\t\tif(this.$config.copyOnParse()){\r\n\t\t\t\t\titem = utils.copy(item);\r\n\t\t\t\t}\r\n\t\t\t\titem = this.$initItem(item);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(this.callEvent(\"onItemLoading\", [item])){\r\n\t\t\t\tif (!this.pull.hasOwnProperty(item.id)) {\r\n\t\t\t\t\tthis.fullOrder.push(item.id);\r\n\t\t\t\t}\r\n\t\t\t\tloaded.push(item);\r\n\t\t\t\tthis.pull[item.id] = item;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn loaded;\r\n\t},\r\n\tparse: function(data){\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tthis.callEvent(\"onBeforeParse\", [data]);\r\n\t\t}\r\n\t\tvar loaded = this._parseInner(data);\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tthis.refresh();\r\n\t\t\tthis.callEvent(\"onParse\", [loaded]);\r\n\t\t}\r\n\t},\r\n\tgetItem: function(id){\r\n\t\treturn this.pull[id];\r\n\t},\r\n\r\n\t_updateOrder: function(code){\r\n\t\tcode.call(this.visibleOrder);\r\n\t\tcode.call(this.fullOrder);\r\n\t},\r\n\tupdateItem: function(id, item){\r\n\t\tif (!utils.defined(item)) item = this.getItem(id);\r\n\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tif (this.callEvent(\"onBeforeUpdate\", [item.id, item]) === false) return false;\r\n\t\t}\r\n\t\t// This is how it worked before updating the properties:\r\n\t\t// this.pull[id]=item;\r\n\t\tutils.mixin(this.pull[id],item, true);\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tthis.callEvent(\"onAfterUpdate\", [item.id, item]);\r\n\t\t\tthis.callEvent(\"onStoreUpdated\", [item.id, item, \"update\"]);\r\n\t\t}\r\n\t},\r\n\r\n\t_removeItemInner: function(id){\r\n\t\t//clear from collections\r\n\t\t//this.visibleOrder.$remove(id);\r\n\t\tthis._updateOrder(function(){ this.$remove(id);});\r\n\t\tdelete this.pull[id];\r\n\t},\r\n\r\n\tremoveItem: function(id){\r\n\t\t//utils.assert(this.exists(id), \"Not existing ID in remove command\"+id);\r\n\r\n\t\tvar obj = this.getItem(id);\t//save for later event\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tif (this.callEvent(\"onBeforeDelete\", [obj.id, obj]) === false) return false;\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onAfterDeleteConfirmed\", [obj.id, obj]);\r\n\t\tthis._removeItemInner(id);\r\n\t\t\r\n\t\tif (this.isSilent()) {\r\n\t\t\tthis.callEvent(\"onAfterSilentDelete\", [obj.id, obj]);\r\n\t\t}\r\n\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tthis.filter();\r\n\t\t\tthis.callEvent(\"onAfterDelete\", [obj.id, obj]);\r\n\t\t\t//repaint signal\r\n\t\t\tthis.callEvent(\"onStoreUpdated\", [obj.id, obj, \"delete\"]);\r\n\t\t}\r\n\t},\r\n\r\n\t_addItemInner: function(item, index){\r\n\t\t//in case of treetable order is sent as 3rd parameter\r\n\t\t//var order = index;\r\n\r\n\t\tif(this.exists(item.id)){\r\n\t\t\tthis.silent(function(){this.updateItem(item.id, item);});\r\n\t\t}else{\r\n\t\t\tvar order = this.visibleOrder;\r\n\r\n\t\t\t//by default item is added to the end of the list\r\n\t\t\tvar data_size = order.length;\r\n\r\n\t\t\tif (!utils.defined(index) || index < 0)\r\n\t\t\t\tindex = data_size;\r\n\t\t\t//check to prevent too big indexes\r\n\t\t\tif (index > data_size){\r\n\t\t\t\t//dhx.log(\"Warning\",\"DataStore:add\",\"Index of out of bounds\");\r\n\t\t\t\tindex = Math.min(order.length,index);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\t//gantt.assert(!this.exists(id), \"Not unique ID\");\r\n\r\n\t\tthis.pull[item.id]=item;\r\n\t\tthis._updateOrder(function(){\r\n\t\t\tif(this.$find(item.id) === -1)\r\n\t\t\t\tthis.$insertAt(item.id,index);\r\n\t\t});\r\n\t\tthis.filter();\r\n\t\t//order.$insertAt(item.id,index);\r\n\t},\r\n\r\n\r\n\tisVisible: function(id){\r\n\t\treturn this.visibleOrder.$find(id) > -1;\r\n\t},\r\n\tgetVisibleItems: function(){\r\n\t\treturn this.getIndexRange();\r\n\t},\r\n\r\n\taddItem: function(item, index){\r\n\t\tif (!utils.defined(item.id))\r\n\t\t\titem.id = utils.uid();\r\n\r\n\t\tif(this.$initItem){\r\n\t\t\titem = this.$initItem(item);\r\n\t\t}\r\n\r\n\t\tif (!this.isSilent()){\r\n\t\t\tif (this.callEvent(\"onBeforeAdd\", [item.id, item]) === false) return false;\r\n\t\t}\r\n\r\n\r\n\t\tthis._addItemInner(item, index);\r\n\r\n\t\tif (!this.isSilent()){\r\n\t\t\tthis.callEvent(\"onAfterAdd\",[item.id, item]);\r\n\t\t\t//repaint signal\r\n\t\t\tthis.callEvent(\"onStoreUpdated\",[item.id,item,\"add\"]);\r\n\t\t} else {\r\n\t\t\tif(this.sync_link){\r\n\t\t\t\tthis.sync_link(item);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn item.id;\r\n\t},\r\n\r\n\t_changeIdInner: function(oldId, newId){\r\n\t\tif(this.pull[oldId])\r\n\t\t\tthis.pull[newId] = this.pull[oldId];\r\n\r\n\t\tvar visibleOrder = this._searchVisibleOrder[oldId];\r\n\t\tthis.pull[newId].id = newId;\r\n\t\tthis._updateOrder(function(){\r\n\t\t\tthis[this.$find(oldId)] = newId;\r\n\t\t});\r\n\t\tthis._searchVisibleOrder[newId] = visibleOrder;\r\n\t\tdelete this._searchVisibleOrder[oldId];\r\n\r\n\t\t//this.visibleOrder[this.visibleOrder.$find(oldId)]=newId;\r\n\t\tdelete this.pull[oldId];\r\n\t},\r\n\tchangeId: function(oldId, newId){\r\n\t\tthis._changeIdInner(oldId, newId);\r\n\r\n\t\tthis.callEvent(\"onIdChange\", [oldId, newId]);\r\n\r\n\t},\r\n\texists: function(id){\r\n\t\treturn !!(this.pull[id]);\r\n\t},\r\n\r\n\t_moveInner: function(sindex, tindex){\r\n\t\tvar id = this.getIdByIndex(sindex);\r\n\r\n\t\tthis._updateOrder(function(){\r\n\t\t\tthis.$removeAt(sindex);\r\n\t\t\tthis.$insertAt(id,Math.min(this.length, tindex));\r\n\t\t});\r\n\t\t//this.visibleOrder.$removeAt(sindex);\t//remove at old position\r\n\t\t//if (sindex<tindex) tindex--;\t//correct shift, caused by element removing\r\n\t\t//this.visibleOrder.$insertAt(id,Math.min(this.visibleOrder.length, tindex));\t//insert at new position\r\n\t},\r\n\r\n\tmove: function(sindex, tindex){\r\n\t\t//gantt.assert(sindex>=0 && tindex>=0, \"DataStore::move\",\"Incorrect indexes\");\r\n\r\n\t\tvar id = this.getIdByIndex(sindex);\r\n\t\tvar obj = this.getItem(id);\r\n\t\tthis._moveInner(sindex, tindex);\r\n\r\n\t\tif (!this.isSilent()) {\r\n\t\t\t//repaint signal\r\n\t\t\tthis.callEvent(\"onStoreUpdated\", [obj.id, obj, \"move\"]);\r\n\t\t}\r\n\t},\r\n\tclearAll: function(){\r\n\t\tif(this.$destroyed){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// GS-956 We need to unselect the resource as its ID is cached\r\n\t\tthis.silent(function(){\r\n\t\t\tthis.unselect();\r\n\t\t});\r\n\t\tthis.pull = {};\r\n\t\tthis.visibleOrder = powerArray.$create();\r\n\t\tthis.fullOrder = powerArray.$create();\r\n\t\tif (this.isSilent()) return;\r\n\t\tthis.callEvent(\"onClearAll\",[]);\r\n\t\tthis.refresh();\r\n\t},\r\n\r\n\tsilent:function(code, master){\r\n\t\tvar alreadySilent = false;\r\n\t\tif(this.isSilent()) {\r\n\t\t\talreadySilent = true;\r\n\t\t}\r\n\t\tthis._skip_refresh = true;\r\n\t\tcode.call(master||this);\r\n\t\t\r\n\t\tif (!alreadySilent) {\r\n\t\t\tthis._skip_refresh = false;\r\n\t\t}\r\n\t},\r\n\tisSilent: function(){\r\n\t\treturn !!this._skip_refresh;\r\n\t},\r\n\r\n\tarraysEqual: function (arr1, arr2) {\r\n\t\tif(arr1.length !== arr2.length)\r\n\t\t\treturn false;\r\n\t\tfor(var i = 0; i < arr1.length; i++) {\r\n\t\t\tif(arr1[i] !== arr2[i])\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\trefresh: function(id, quick){\r\n\t\tif(this.$destroyed){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.isSilent()) return;\r\n\r\n\t\tvar item;\r\n\t\tif(id){\r\n\t\t\titem = this.getItem(id);\r\n\t\t}\r\n\r\n\t\tvar args;\r\n\t\tif (id){\r\n\t\t\targs = [id, item, \"paint\"];\r\n\t\t}else{\r\n\t\t\targs = [null,null,null];\r\n\t\t}\r\n\r\n\t\tif(this.callEvent(\"onBeforeStoreUpdate\", args) === false){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar skipFilter = this._quick_refresh && !this._mark_recompute;\r\n\t\tthis._mark_recompute = false;\r\n\t\tif(id){\r\n\t\t\t// if item changes visible order (e.g. expand-collapse branch) - do a complete repaint\r\n\t\t\tif(!quick && !skipFilter){\r\n\t\t\t\tvar oldOrder = this.visibleOrder;\r\n\t\t\t\tthis.filter();\r\n\t\t\t\tif(!this.arraysEqual(oldOrder, this.visibleOrder)){\r\n\t\t\t\t\tid = undefined;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}else if(!skipFilter){\r\n\t\t\tthis.filter();\r\n\t\t}\r\n\r\n\t\tif (id){\r\n\t\t\targs = [id, item, \"paint\"];\r\n\t\t}else{\r\n\t\t\targs = [null,null,null];\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onStoreUpdated\",args);\r\n\t},\r\n\r\n\tcount: function(){\r\n\t\treturn this.fullOrder.length;\r\n\t},\r\n\tcountVisible: function(){\r\n\t\treturn this.visibleOrder.length;\r\n\t},\r\n\r\n\tsort: function(sort){},\r\n\r\n\tserialize: function(){},\r\n\r\n\teachItem: function(code){\r\n\t\tfor (var i=0; i<this.fullOrder.length; i++) {\r\n\t\t\tvar item = this.getItem(this.fullOrder[i]);\r\n\t\t\tcode.call(this, item);\r\n\t\t}\r\n\t},\r\n\r\n\tfind: function(filter) {\r\n\t\tvar result = [];\r\n\t\tthis.eachItem(function(item) {\r\n\t\t\tif(filter(item)){\r\n\t\t\t\tresult.push(item);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t},\r\n\r\n\tfilter: function(rule){\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tthis.callEvent(\"onBeforeFilter\", []);\r\n\t\t}\r\n\t\tthis.callEvent(\"onPreFilter\", []);\r\n\t\tvar filteredOrder = powerArray.$create();\r\n\t\tvar placeholderIds = [];\r\n\t\tthis.eachItem(function(item){\r\n\t\t\tif(this.callEvent(\"onFilterItem\", [item.id, item])){\r\n\t\t\t\tif(isPlaceholderTask(item.id, null, this, this._ganttConfig)){\r\n\t\t\t\t\tplaceholderIds.push(item.id);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfilteredOrder.push(item.id);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfor(var i = 0; i < placeholderIds.length; i++){\r\n\t\t\tfilteredOrder.push(placeholderIds[i]);\r\n\t\t}\r\n\r\n\t\tthis.visibleOrder = filteredOrder;\r\n\t\tthis._searchVisibleOrder = {};\r\n\t\tfor(var i = 0; i < this.visibleOrder.length; i++){\r\n\t\t\tthis._searchVisibleOrder[this.visibleOrder[i]] = i;\r\n\t\t}\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tthis.callEvent(\"onFilter\", []);\r\n\t\t}\r\n\t},\r\n\r\n\tgetIndexRange: function(from, to){\r\n\t\tvar max = Math.min((to||Infinity),this.countVisible()-1);\r\n\t\tvar min = from||0;\r\n\r\n\t\tvar cacheKey = min + '-' + max;\r\n\t\tif(this._indexRangeCache[cacheKey]){\r\n\t\t\treturn this._indexRangeCache[cacheKey].slice();\r\n\t\t}\r\n\r\n\t\tvar ret= [];\r\n\t\tfor (var i=min; i <= max; i++)\r\n\t\t\tret.push(this.getItem(this.visibleOrder[i]));\r\n\r\n\t\tthis._indexRangeCache[cacheKey] = ret.slice();\r\n\t\treturn ret;\r\n\t},\r\n\tgetItems: function(){\r\n\t\tif(this._getItemsCache){\r\n\t\t\treturn this._getItemsCache.slice();\r\n\t\t}\r\n\r\n\t\tvar res = [];\r\n\t\tfor(var i in this.pull){\r\n\t\t\tres.push(this.pull[i]);\r\n\t\t}\r\n\t\tthis._getItemsCache = res.slice();\r\n\r\n\t\treturn res;\r\n\t},\r\n\r\n\tgetIdByIndex: function(index){\r\n\t\treturn this.visibleOrder[index];\r\n\t},\r\n\tgetIndexById: function(id){\r\n\t\tvar res = this._searchVisibleOrder[id];\r\n\t\tif(res === undefined){\r\n\t\t\tres = -1;\r\n\t\t}\r\n\t\treturn res;\r\n\t},\r\n\t_getNullIfUndefined: function(value){\r\n\t\tif(value === undefined){\r\n\t\t\treturn null;\r\n\t\t}else{\r\n\t\t\treturn value;\r\n\t\t}\r\n\t},\r\n\tgetFirst: function(){\r\n\t\treturn this._getNullIfUndefined(this.visibleOrder[0]);\r\n\t},\r\n\tgetLast: function(){\r\n\t\treturn this._getNullIfUndefined(this.visibleOrder[this.visibleOrder.length-1]);\r\n\t},\r\n\tgetNext: function(id){\r\n\t\treturn this._getNullIfUndefined(this.visibleOrder[this.getIndexById(id) + 1]);\r\n\t},\r\n\tgetPrev: function(id){\r\n\t\treturn this._getNullIfUndefined(this.visibleOrder[this.getIndexById(id) - 1]);\r\n\t},\r\n\tdestructor: function(){\r\n\t\tthis.callEvent(\"onDestroy\", []);\r\n\t\tthis.detachAllEvents();\r\n\t\tthis.$destroyed = true;\r\n\t\tthis.pull = null;\r\n\t\tthis.$initItem = null;\r\n\t\tthis.visibleOrder = null;\r\n\t\tthis.fullOrder = null;\r\n\t\tthis._skip_refresh = null;\r\n\t\tthis._filterRule = null;\r\n\t\tthis._searchVisibleOrder = null;\r\n\t\tthis._indexRangeCache = {};\r\n\t}\r\n};\r\n\r\nexport default DataStore;","export default class SplitTasksHelper {\r\n\r\n\t_datastore: any = null;\r\n\r\n\tconstructor (datastore: any) {\r\n\t\tthis._datastore = datastore;\r\n\t}\r\n\tisSplitItem = (item: any) => {\r\n\t\treturn (item.render == \"split\" && this._datastore.hasChild(item.id));\r\n\t};\r\n\tisSubrowSplitItem = (item: any) => {\r\n\t\treturn (item.split_placement == \"subrow\");\r\n\t};\r\n\tisDefaultSplitItem = (item: any) => {\r\n\t\treturn (item.split_placement == \"auto\" || item.split_placement === undefined);\r\n\t};\r\n\tisInlineSplitItem = (item: any) => {\r\n\t\treturn (item.split_placement == \"inline\");\r\n\t};\r\n};","import powerArray from \"./power_array\";\r\nimport * as utils from \"../../utils/utils\";\r\nimport * as helpers from \"../../utils/helpers\";\r\nimport DataStore from \"./datastore\";\r\nimport isPlaceholderTask from \"../../utils/placeholder_task\";\r\nimport {replaceValidZeroId} from \"../../utils/helpers\";\r\nimport SplitTasksHelper from \"../common/split_task_helpers\";\r\n\r\nvar TreeDataStore = function(config){\r\n\tDataStore.apply(this, [config]);\r\n\tthis._branches = {};\r\n\tthis._splitTaskHelper = new SplitTasksHelper(this);\r\n\r\n\tthis.pull = {};\r\n\t//GS-761 Update existing item instead of adding it to the new position\r\n\tthis.$initItem = function (item){\r\n\t\tvar loadedItem = item;\r\n\t\tif(config.initItem){\r\n\t\t\tloadedItem = config.initItem(loadedItem);\r\n\t\t}\r\n\t\tvar existingItem = this.getItem(item.id);\r\n\t\tif(existingItem && !isEqualIds(existingItem.parent,loadedItem.parent)){\r\n\t\t\tthis.move(loadedItem.id, loadedItem.$index || -1, loadedItem.parent || this._ganttConfig.root_id);\r\n\t\t}\r\n\t\treturn loadedItem;\r\n\t};\r\n\tthis.$parentProperty = config.parentProperty || \"parent\";\r\n\r\n\tif(typeof config.rootId !== \"function\"){\r\n\t\tthis.$getRootId = (function(val){\r\n\t\t\treturn function(){return val;};\r\n\t\t})(config.rootId || 0);\r\n\t}else{\r\n\t\tthis.$getRootId = config.rootId;\r\n\t}\r\n\r\n\t// TODO: replace with live reference to gantt config\r\n\tthis.$openInitially = config.openInitially;\r\n\r\n\tthis.visibleOrder = powerArray.$create();\r\n\tthis.fullOrder = powerArray.$create();\r\n\tthis._searchVisibleOrder = {};\r\n\tthis._indexRangeCache = {};\r\n\tthis._eachItemMainRangeCache = null;\r\n\tthis._getItemsCache = null;\r\n\tthis._skip_refresh = false;\r\n\r\n\tthis._ganttConfig = null;\r\n\tif(config.getConfig){\r\n\t\tthis._ganttConfig = config.getConfig();\r\n\t}\r\n\r\n\tvar splitParents = {};\r\n\tvar splitItems = {};\r\n\r\n\tvar taskOpenState = {};\r\n\tvar taskVisibility = {};\r\n\tvar haveSplitItems = false;\r\n\r\n\tthis._attachDataChange(function(){\r\n\t\tthis._indexRangeCache = {};\r\n\t\tthis._eachItemMainRangeCache = null;\r\n\t\tthis._getItemsCache = null;\r\n\t\treturn true;\r\n\t});\r\n\r\n\tthis.attachEvent(\"onPreFilter\", function(){\r\n\t\tthis._indexRangeCache = {};\r\n\t\tthis._eachItemMainRangeCache = null;\r\n\r\n\t\tsplitParents = {};\r\n\t\tsplitItems = {};\r\n\t\ttaskOpenState = {};\r\n\t\ttaskVisibility = {};\r\n\t\thaveSplitItems = false;\r\n\r\n\t\tthis.eachItem(function(item){\r\n\t\t\tvar parent = this.getParent(item.id);\r\n\t\t\tif(item.$open && taskOpenState[parent] !== false){\r\n\t\t\t\ttaskOpenState[item.id] = true;\r\n\t\t\t}else{\r\n\t\t\t\ttaskOpenState[item.id] = false;\r\n\t\t\t}\r\n\r\n\t\t\tif(this._isSplitItem(item)){\r\n\t\t\t\thaveSplitItems = true;\r\n\t\t\t\tsplitParents[item.id] = true;\r\n\t\t\t\tsplitItems[item.id] = true;\r\n\t\t\t}\r\n\r\n\r\n\t\t\tif(haveSplitItems && splitItems[parent]){\r\n\t\t\t\tif(this._isDefaultItem(item) || this._isInlineChildItem(item)) splitItems[item.id] = true;\r\n\t\t\t}\r\n\r\n\r\n\t\t\tif(taskOpenState[parent] || taskOpenState[parent] === undefined || this._isInlineChildItem(item)){\r\n\t\t\t\ttaskVisibility[item.id] = true;\r\n\t\t\t}else{\r\n\t\t\t\ttaskVisibility[item.id] = false;\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\tthis.attachEvent(\"onFilterItem\", function(id, item){\r\n\r\n\t\tvar canOpenSplitTasks = false;\r\n\t\tif(this._ganttConfig){\r\n\t\t\tvar canOpenSplitTasks = this._ganttConfig.open_split_tasks;\r\n\t\t}\r\n\r\n\t\tvar open = taskVisibility[item.id];\r\n\r\n\t\tif(haveSplitItems){\r\n\t\t\tif(open && splitItems[item.id] && !splitParents[item.id]){\r\n\t\t\t\topen = !!canOpenSplitTasks;\r\n\t\t\t}\r\n\r\n\t\t\tif(splitItems[item.id] && !splitParents[item.id]){\r\n\t\t\t\tif(!this._isSplitChildItem(item)) item.$split_subtask = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\titem.$expanded_branch = !!taskVisibility[item.id];\r\n\t\tif(this._isInlineChildItem(item)){\r\n\t\t\topen = false;\r\n\t\t}\r\n\t\treturn !!open;\r\n\t});\r\n\r\n\tthis.attachEvent(\"onFilter\", function(){\r\n\t\tsplitParents = {};\r\n\t\tsplitItems = {};\r\n\r\n\t\ttaskOpenState = {};\r\n\t\ttaskVisibility = {};\r\n\t});\r\n\r\n\treturn this;\r\n};\r\n\r\nTreeDataStore.prototype = utils.mixin({\r\n\r\n\t\t_buildTree: function(data){\r\n\t\t\tvar item = null;\r\n\t\t\tvar rootId = this.$getRootId();\r\n\t\t\tfor (var i = 0, len = data.length; i < len; i++){\r\n\t\t\t\titem = data[i];\r\n\t\t\t\tthis.setParent(item, replaceValidZeroId(this.getParent(item), rootId) || rootId);\r\n\t\t\t}\r\n\r\n\t\t\t// calculating $level for each item\r\n\t\t\tfor (var i = 0, len = data.length; i < len; i++){\r\n\t\t\t\titem = data[i];\r\n\t\t\t\tthis._add_branch(item);\r\n\t\t\t\titem.$level = this.calculateItemLevel(item);\r\n\t\t\t\titem.$local_index = this.getBranchIndex(item.id);\r\n\r\n\t\t\t\tif (!utils.defined(item.$open)) {\r\n\t\t\t\t\titem.$open = utils.defined(item.open) ? item.open : this.$openInitially();\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\tthis._updateOrder();\r\n\t\t},\r\n\t\t_isSplitItem: function(item){\r\n\t\t\treturn this._splitTaskHelper.isSplitItem(item);\r\n\t\t},\r\n\t\t_isSplitChildItem: function(item){\r\n\t\t\treturn this._splitTaskHelper.isSubrowSplitItem(item);\r\n\t\t},\r\n\t\t_isDefaultItem: function(item){\r\n\t\t\treturn this._splitTaskHelper.isDefaultSplitItem(item);\r\n\t\t},\r\n\t\t_isInlineChildItem: function(item){\r\n\t\t\treturn this._splitTaskHelper.isInlineSplitItem(item);\r\n\t\t},\r\n\t\tparse: function(data){\r\n\t\t\tif (!this._skip_refresh) {\r\n\t\t\t\tthis.callEvent(\"onBeforeParse\", [data]);\r\n\t\t\t}\r\n\t\t\tvar loaded = this._parseInner(data);\r\n\t\t\tthis._buildTree(loaded);\r\n\t\t\tthis.filter();\r\n\t\t\tif (!this._skip_refresh) {\r\n\t\t\t\tthis.callEvent(\"onParse\", [loaded]);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_addItemInner: function(item, index){\r\n\r\n\t\t\tvar parent = this.getParent(item);\r\n\r\n\t\t\tif(!utils.defined(parent)){\r\n\t\t\t\tparent = this.$getRootId();\r\n\t\t\t\tthis.setParent(item, parent);\r\n\t\t\t}\r\n\r\n\t\t\tvar parentIndex = this.getIndexById(parent);\r\n\t\t\tvar targetIndex = parentIndex + Math.min(Math.max(index, 0), this.visibleOrder.length);\r\n\r\n\t\t\tif(targetIndex*1 !== targetIndex){\r\n\t\t\t\ttargetIndex = undefined;\r\n\t\t\t}\r\n\t\t\tDataStore.prototype._addItemInner.call(this, item, targetIndex);\r\n\t\t\tthis.setParent(item, parent);\r\n\r\n\t\t\tif(item.hasOwnProperty(\"$rendered_parent\")){\r\n\t\t\t\tthis._move_branch(item, item.$rendered_parent);\r\n\t\t\t}\r\n\t\t\tthis._add_branch(item, index);\r\n\t\t},\r\n\t\t_changeIdInner: function(oldId, newId){\r\n\t\t\tvar children = this.getChildren(oldId);\r\n\t\t\tvar visibleOrder = this._searchVisibleOrder[oldId];\r\n\r\n\t\t\tDataStore.prototype._changeIdInner.call(this, oldId, newId);\r\n\r\n\t\t\tvar parent = this.getParent(newId);\r\n\r\n\t\t\tthis._replace_branch_child(parent, oldId, newId);\r\n\r\n\t\t\tif(this._branches[oldId]){\r\n\t\t\t\tthis._branches[newId] = this._branches[oldId];\r\n\t\t\t}\r\n\t\t\tfor(var i = 0; i < children.length; i++){\r\n\t\t\t\tvar child = this.getItem(children[i]);\r\n\t\t\t\tchild[this.$parentProperty] = newId;\r\n\t\t\t\tchild.$rendered_parent = newId;\r\n\t\t\t}\r\n\r\n\t\t\tthis._searchVisibleOrder[newId] = visibleOrder;\r\n\t\t\tdelete this._branches[oldId];\r\n\t\t},\r\n\r\n\t\t_traverseBranches: function(code, parent){\r\n\t\t\tif (!utils.defined(parent)) {\r\n\t\t\t\tparent = this.$getRootId();\r\n\t\t\t}\r\n\t\t\tvar branch = this._branches[parent];\r\n\t\t\tif (branch) {\r\n\t\t\t\tfor (var i = 0; i < branch.length; i++) {\r\n\t\t\t\t\tvar itemId = branch[i];\r\n\t\t\t\t\tcode.call(this, itemId);\r\n\t\t\t\t\tif (this._branches[itemId])\r\n\t\t\t\t\t\tthis._traverseBranches(code, itemId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_updateOrder: function(code){\r\n\r\n\t\t\tthis.fullOrder = powerArray.$create();\r\n\t\t\tthis._traverseBranches(function(taskId){\r\n\t\t\t\tthis.fullOrder.push(taskId);\r\n\t\t\t});\r\n\r\n\t\t\tif(code)\r\n\t\t\t\tDataStore.prototype._updateOrder.call(this, code);\r\n\t\t},\r\n\r\n\t\t_removeItemInner: function(id){\r\n\r\n\t\t\tvar items = [];\r\n\t\t\tthis.eachItem(function(child){\r\n\t\t\t\titems.push(child);\r\n\t\t\t}, id);\r\n\r\n\t\t\titems.push(this.getItem(id));\r\n\r\n\t\t\tfor(var i = 0; i < items.length; i++){\r\n\r\n\t\t\t\tthis._move_branch(items[i], this.getParent(items[i]), null);\r\n\t\t\t\tDataStore.prototype._removeItemInner.call(this, items[i].id);\r\n\t\t\t\tthis._move_branch(items[i], this.getParent(items[i]), null);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tmove: function(sid, tindex, parent){\r\n\t\t\t//target id as 4th parameter\r\n\t\t\tvar id = arguments[3];\r\n\t\t\tvar config = this._ganttConfig || {};\r\n\t\t\tvar root_id = config.root_id || 0;\r\n\t\t\tid = replaceValidZeroId(id, root_id);\r\n\t\t\tif (id) {\r\n\t\t\t\tif (id === sid) return;\r\n\r\n\t\t\t\tparent = this.getParent(id);\r\n\t\t\t\ttindex = this.getBranchIndex(id);\r\n\t\t\t}\r\n\t\t\tif(isEqualIds(sid, parent)){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (!utils.defined(parent)) {\r\n\t\t\t\tparent = this.$getRootId();\r\n\t\t\t}\r\n\t\t\tvar source = this.getItem(sid);\r\n\t\t\tvar source_pid = this.getParent(source.id);\r\n\r\n\t\t\tvar tbranch = this.getChildren(parent);\r\n\t\t\tconst siblings = this.getSiblings(sid);\r\n\r\n\t\t\tif (tindex == -1)\r\n\t\t\t\ttindex = tbranch.length + 1;\r\n\t\t\tif (isEqualIds(source_pid, parent)) {\r\n\t\t\t\tvar sindex = this.getBranchIndex(sid);\r\n\t\t\t\tif (sindex == tindex) return;\r\n\t\t\t\t//GS-3004: prevent reorder single task in the root tree\r\n\t\t\t\tif (parent === gantt.config.root_id && siblings.length <= 1) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\r\n\t\t\tif(this.callEvent(\"onBeforeItemMove\", [sid, parent, tindex]) === false)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\tvar placeholderIds = [];\r\n\t\t\tfor(var i = 0; i < tbranch.length; i++){\r\n\t\t\t\tif (isPlaceholderTask(tbranch[i], null, this, this._ganttConfig)){\r\n\t\t\t\t\tplaceholderIds.push(tbranch[i]);\r\n\t\t\t\t\ttbranch.splice(i, 1);\r\n\t\t\t\t\ti--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._replace_branch_child(source_pid, sid);\r\n\t\t\ttbranch = this.getChildren(parent);\r\n\r\n\t\t\tvar tid = tbranch[tindex];\r\n\t\t\ttid = replaceValidZeroId(tid, root_id);\r\n\t\t\tif (!tid) //adding as last element\r\n\t\t\t\ttbranch.push(sid);\r\n\t\t\telse\r\n\t\t\t\ttbranch = tbranch.slice(0, tindex).concat([ sid ]).concat(tbranch.slice(tindex));\r\n\r\n\t\t\tif (placeholderIds.length){\r\n\t\t\t\ttbranch = tbranch.concat(placeholderIds);\r\n\t\t\t}\r\n\t\t\t// GS-2423 to return initial parent to the task before it will be moved\r\n\t\t\tif (!isEqualIds(source.$rendered_parent, source_pid) && !isEqualIds(source_pid, parent)){\r\n\t\t\t\tsource.$rendered_parent = source_pid;\r\n\t\t\t}\r\n\t\t\tthis.setParent(source, parent);\r\n\t\t\tthis._branches[parent] = tbranch;\r\n\r\n\t\t\tvar diff = this.calculateItemLevel(source) - source.$level;\r\n\t\t\tsource.$level += diff;\r\n\t\t\tthis.eachItem(function(item){\r\n\t\t\t\titem.$level += diff;\r\n\t\t\t}, source.id, this);\r\n\r\n\r\n\t\t\tthis._moveInner(this.getIndexById(sid), this.getIndexById(parent) + tindex);\r\n\r\n\t\t\tthis.callEvent(\"onAfterItemMove\", [sid, parent, tindex]);\r\n\t\t\tthis.refresh();\r\n\t\t},\r\n\r\n\t\tgetBranchIndex: function(id){\r\n\t\t\tvar branch = this.getChildren(this.getParent(id));\r\n\t\t\tlet index = branch.indexOf(id + \"\");\r\n\t\t\tif (index == -1){\r\n\t\t\t\tindex = branch.indexOf(+id);\r\n\t\t\t}\r\n\t\t\treturn index;\r\n\t\t},\r\n\t\thasChild: function(id){\r\n\t\t\tvar branch = this._branches[id];\r\n\t\t\treturn branch && branch.length;\r\n\t\t},\r\n\t\tgetChildren: function(id){\r\n\t\t\tvar branch = this._branches[id];\r\n\t\t\treturn branch ? branch : powerArray.$create();\r\n\t\t},\r\n\r\n\t\tisChildOf: function(childId, parentId){\r\n\t\t\tif (!this.exists(childId))\r\n\t\t\t\treturn false;\r\n\t\t\tif (parentId === this.$getRootId())\r\n\t\t\t\treturn true;\r\n\r\n\t\t\tif (!this.hasChild(parentId))\r\n\t\t\t\treturn false;\r\n\r\n\t\t\tvar item = this.getItem(childId);\r\n\t\t\tvar pid = this.getParent(childId);\r\n\r\n\t\t\tvar parent = this.getItem(parentId);\r\n\t\t\tif(parent.$level >= item.$level){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\twhile (item && this.exists(pid)) {\r\n\t\t\t\titem = this.getItem(pid);\r\n\r\n\t\t\t\tif (item && isEqualIds(item.id, parentId))\r\n\t\t\t\t\treturn true;\r\n\t\t\t\tpid = this.getParent(item);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\tgetSiblings: function(id){\r\n\t\t\tif(!this.exists(id)){\r\n\t\t\t\treturn powerArray.$create();\r\n\t\t\t}\r\n\t\t\tvar parent = this.getParent(id);\r\n\t\t\treturn this.getChildren(parent);\r\n\r\n\t\t},\r\n\t\tgetNextSibling: function(id){\r\n\t\t\tvar siblings = this.getSiblings(id);\r\n\t\t\tfor(var i= 0, len = siblings.length; i < len; i++){\r\n\t\t\t\tif(isEqualIds(siblings[i], id)){\r\n\t\t\t\t\tvar nextSibling = siblings[i+1];\r\n\t\t\t\t\tif (nextSibling === 0 && i > 0){\r\n\t\t\t\t\t\tnextSibling = \"0\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn nextSibling || null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\tgetPrevSibling: function(id){\r\n\t\t\tvar siblings = this.getSiblings(id);\r\n\t\t\tfor(var i= 0, len = siblings.length; i < len; i++){\r\n\t\t\t\tif(isEqualIds(siblings[i], id)){\r\n\t\t\t\t\tvar previousSibling = siblings[i-1];\r\n\t\t\t\t\tif (previousSibling === 0 && i > 0){\r\n\t\t\t\t\t\tpreviousSibling = \"0\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn previousSibling || null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\tgetParent: function(id){\r\n\t\t\tvar item = null;\r\n\t\t\tif(id.id !== undefined){\r\n\t\t\t\titem = id;\r\n\t\t\t}else{\r\n\t\t\t\titem = this.getItem(id);\r\n\t\t\t}\r\n\r\n\t\t\tvar parent;\r\n\t\t\tif(item){\r\n\t\t\t\tparent = item[this.$parentProperty];\r\n\t\t\t}else{\r\n\t\t\t\tparent = this.$getRootId();\r\n\t\t\t}\r\n\t\t\treturn parent;\r\n\r\n\t\t},\r\n\r\n\t\tclearAll: function(){\r\n\t\t\tthis._branches = {};\r\n\t\t\tDataStore.prototype.clearAll.call(this);\r\n\t\t},\r\n\r\n\t\tcalculateItemLevel: function(item){\r\n\t\t\tvar level = 0;\r\n\t\t\tthis.eachParent(function(){\r\n\t\t\t\tlevel++;\r\n\t\t\t}, item);\r\n\t\t\treturn level;\r\n\t\t},\r\n\r\n\t\t_setParentInner: function(item, new_pid, silent){\r\n\t\t\tif(!silent){\r\n\t\t\t\tif(item.hasOwnProperty(\"$rendered_parent\")){\r\n\t\t\t\t\tthis._move_branch(item, item.$rendered_parent, new_pid);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis._move_branch(item, item[this.$parentProperty], new_pid);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetParent: function(item, new_pid, silent){\r\n\t\t\tthis._setParentInner(item, new_pid, silent);\r\n\r\n\t\t\titem[this.$parentProperty] = new_pid;\r\n\t\t},\r\n\r\n\t\t_eachItemCached: function(code, cache){\r\n\t\t\tfor(var i = 0, len = cache.length; i < len; i++){\r\n\t\t\t\tcode.call(this, cache[i]);\r\n\t\t\t}\r\n\t\t},\r\n\t\t_eachItemIterate: function(code, startId, cache){\r\n\t\t\tvar itemsStack = this.getChildren(startId);\r\n\t\t\tif(itemsStack.length){\r\n\t\t\t\titemsStack = itemsStack.slice().reverse();\r\n\t\t\t}\r\n\t\t\twhile(itemsStack.length){\r\n\t\t\t\tvar itemId = itemsStack.pop();\r\n\t\t\t\tvar item = this.getItem(itemId);\r\n\t\t\t\tcode.call(this, item);\r\n\t\t\t\tif(cache){\r\n\t\t\t\t\tcache.push(item);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(this.hasChild(item.id)){\r\n\t\t\t\t\tvar children = this.getChildren(item.id);\r\n\t\t\t\t\tvar len = children.length;\r\n\t\t\t\t\tfor(var i = len - 1; i >= 0; i--){\r\n\t\t\t\t\t\titemsStack.push(children[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\teachItem: function(code, parent){\r\n\t\t\tvar rootId = this.$getRootId();\r\n\t\t\tif (!utils.defined(parent)) {\r\n\t\t\t\tparent = rootId;\r\n\t\t\t}\r\n\t\t\tvar startId = replaceValidZeroId(parent, rootId) || rootId;\r\n\r\n\t\t\tvar useCache = false;\r\n\t\t\tvar buildCache = false;\r\n\t\t\tvar cache = null;\r\n\t\t\tif(startId === rootId){\r\n\t\t\t\tif(this._eachItemMainRangeCache){\r\n\t\t\t\t\tuseCache = true;\r\n\t\t\t\t\tcache = this._eachItemMainRangeCache;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tbuildCache = true;\r\n\t\t\t\t\tcache = this._eachItemMainRangeCache = [];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(useCache){\r\n\t\t\t\tthis._eachItemCached(code, cache);\r\n\t\t\t}else{\r\n\t\t\t\tthis._eachItemIterate(code, startId, buildCache ? cache : null);\r\n\t\t\t}\r\n\t\t},\r\n\t\teachParent: function(code, startItem) {\r\n\t\t\tvar parentsHash = {};\r\n\t\t\tvar item = startItem;\r\n\t\t\tvar parent = this.getParent(item);\r\n\r\n\t\t\twhile (this.exists(parent)) {\r\n\t\t\t\tif (parentsHash[parent]) {\r\n\t\t\t\t\tthrow new Error(\"Invalid tasks tree. Cyclic reference has been detected on task \" + parent);\r\n\t\t\t\t}\r\n\t\t\t\tparentsHash[parent] = true;\r\n\t\t\t\titem = this.getItem(parent);\r\n\t\t\t\tcode.call(this, item);\r\n\t\t\t\tparent = this.getParent(item);\r\n\t\t\t}\r\n\t\t},\r\n\t\t_add_branch: function(item, index, parent){\r\n\t\t\tvar pid = parent === undefined ? this.getParent(item) : parent;\r\n\t\t\tif (!this.hasChild(pid))\r\n\t\t\t\tthis._branches[pid] = powerArray.$create();\r\n\t\t\tvar branch = this.getChildren(pid);\r\n\t\t\tvar added_already = branch.indexOf(item.id + \"\") > -1 || branch.indexOf(+item.id) > -1;\r\n\t\t\tif(!added_already){\r\n\t\t\t\tif(index*1 == index){\r\n\r\n\t\t\t\t\tbranch.splice(index, 0, item.id);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tbranch.push(item.id);\r\n\t\t\t\t}\r\n\r\n\t\t\t\titem.$rendered_parent = pid;\r\n\t\t\t}\r\n\t\t},\r\n\t\t_move_branch: function(item, old_parent, new_parent){\r\n\t\t\tthis._eachItemMainRangeCache = null;\r\n\t\t\t//this.setParent(item, new_parent);\r\n\t\t\t//this._sync_parent(task);\r\n\t\t\tthis._replace_branch_child(old_parent, item.id);\r\n\t\t\tif(this.exists(new_parent) || isEqualIds(new_parent, this.$getRootId())){\r\n\r\n\t\t\t\tthis._add_branch(item, undefined, new_parent);\r\n\t\t\t}else{\r\n\t\t\t\tdelete this._branches[item.id];\r\n\t\t\t}\r\n\t\t\titem.$level =  this.calculateItemLevel(item);\r\n\t\t\tthis.eachItem(function(child){\r\n\t\t\t\tchild.$level = this.calculateItemLevel(child);\r\n\t\t\t}, item.id);\r\n\t\t},\r\n\r\n\t\t_replace_branch_child: function(node, old_id, new_id){\r\n\t\t\tvar branch = this.getChildren(node);\r\n\t\t\tif (branch && node !== undefined){\r\n\t\t\t\tvar newbranch = powerArray.$create();\r\n\r\n\t\t\t\tlet index = branch.indexOf(old_id + \"\");\r\n\t\t\t\tif (index == -1 && !isNaN(+old_id)){\r\n\t\t\t\t\tindex = branch.indexOf(+old_id);\r\n\t\t\t\t} \r\n\r\n\t\t\t\tif (index > -1){\r\n\t\t\t\t\tif (new_id){\r\n\t\t\t\t\t\tbranch.splice(index, 1, new_id);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbranch.splice(index, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tnewbranch = branch;\r\n\r\n\t\t\t\tthis._branches[node] = newbranch;\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\tsort: function(field, desc, parent){\r\n\t\t\tif (!this.exists(parent)) {\r\n\t\t\t\tparent = this.$getRootId();\r\n\t\t\t}\r\n\r\n\t\t\tif (!field) field = \"order\";\r\n\t\t\tvar criteria = (typeof(field) == \"string\") ? (function(a, b) {\r\n\t\t\t\tif (a[field] == b[field] ||\r\n\t\t\t\t\t(helpers.isDate(a[field]) && helpers.isDate(b[field]) && a[field].valueOf() == b[field].valueOf()))\r\n\t\t\t\t{\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar result = a[field] > b[field];\r\n\t\t\t\treturn result ? 1 : -1;\r\n\t\t\t}) : field;\r\n\r\n\t\t\tif (desc) {\r\n\t\t\t\tvar original_criteria = criteria;\r\n\t\t\t\tcriteria = function (a, b) {\r\n\t\t\t\t\treturn original_criteria(b, a);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tvar els = this.getChildren(parent);\r\n\r\n\t\t\tif (els){\r\n\t\t\t\tvar temp = [];\r\n\t\t\t\tfor (var i = els.length - 1; i >= 0; i--)\r\n\t\t\t\t\ttemp[i] = this.getItem(els[i]);\r\n\r\n\t\t\t\ttemp.sort(criteria);\r\n\r\n\t\t\t\tfor (var i = 0; i < temp.length; i++) {\r\n\t\t\t\t\tels[i] = temp[i].id;\r\n\t\t\t\t\tthis.sort(field, desc, els[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tfilter: function(rule){\r\n\t\t\tfor(let i in this.pull){\r\n\t\t\t\tconst renderedParent = this.pull[i].$rendered_parent;\r\n\t\t\t\tconst actualParent = this.getParent(this.pull[i]);\r\n\t\t\t\t//GS-2339: could be different types of the ids\r\n\t\t\t\tif(!isEqualIds(renderedParent,actualParent)){\r\n\t\t\t\t\tthis._move_branch(this.pull[i], renderedParent, actualParent);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn DataStore.prototype.filter.apply(this, arguments);\r\n\t\t},\r\n\r\n\t\topen: function(id){\r\n\t\t\tif(this.exists(id)){\r\n\t\t\t\tthis.getItem(id).$open = true;\r\n\t\t\t\t// GS-2170. Do not recalculate the indexes and dates as they will be recalculated later\r\n\t\t\t\tthis._skipTaskRecalculation = true;\r\n\t\t\t\tthis.callEvent(\"onItemOpen\", [id]);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tclose: function(id){\r\n\t\t\tif(this.exists(id)){\r\n\t\t\t\tthis.getItem(id).$open = false;\r\n\t\t\t\t// GS-2170. Do not recalculate the indexes and dates as they will be recalculated later\r\n\t\t\t\tthis._skipTaskRecalculation = true;\r\n\t\t\t\tthis.callEvent(\"onItemClose\", [id]);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdestructor: function(){\r\n\t\t\tDataStore.prototype.destructor.call(this);\r\n\t\t\tthis._branches = null;\r\n\t\t\tthis._indexRangeCache = {};\r\n\t\t\tthis._eachItemMainRangeCache = null;\r\n\t\t}\r\n\t},\r\n\tDataStore.prototype\r\n);\r\n\r\nfunction isEqualIds(first, second){\r\n\treturn String(first) === String(second);\r\n};\r\n\r\nexport default TreeDataStore;","import env from \"./env\";\r\n\r\nexport default function(gantt){\r\n\treturn env.isNode || !gantt.$root;\r\n};","import isHeadless from \"../../utils/is_headless\";\r\n\r\nconst storeRenderCreator = function(name, gantt){\r\n\r\n\tconst store = gantt.getDatastore(name);\r\n\r\n\tconst itemRepainter = {\r\n\t\trenderItem: function(id, renderer){\r\n\r\n\t\t\tconst renders = renderer.getLayers();\r\n\r\n\t\t\tconst item = store.getItem(id);\r\n\t\t\tif(item && store.isVisible(id)) {\r\n\t\t\t\tfor (let i = 0; i < renders.length; i++)\r\n\t\t\t\t\trenders[i].render_item(item);\r\n\t\t\t}\r\n\t\t},\r\n\t\trenderItems: function(renderer){\r\n\t\t\tconst renderers = renderer.getLayers();\r\n\t\t\tfor (let i = 0; i < renderers.length; i++) {\r\n\t\t\t\trenderers[i].clear();\r\n\t\t\t}\r\n\r\n\t\t\tlet allData = null;\r\n\r\n\t\t\tconst loadedRanges = {};\r\n\t\t\tfor (let i = 0; i < renderers.length; i++) {\r\n\t\t\t\tconst layer = renderers[i];\r\n\t\t\t\tlet layerData;\r\n\t\t\t\tif(layer.get_visible_range){\r\n\r\n\t\t\t\t\tvar range = layer.get_visible_range(store);\r\n\t\t\t\t\tif(range.start !== undefined && range.end !== undefined){\r\n\t\t\t\t\t\tvar key = range.start + \" - \" + range.end;\r\n\t\t\t\t\t\tif(loadedRanges[key]){\r\n\t\t\t\t\t\t\tlayerData = loadedRanges[key];\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tlayerData = store.getIndexRange(range.start, range.end);\r\n\t\t\t\t\t\t\tloadedRanges[key] = layerData;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else if(range.ids !== undefined){\r\n\t\t\t\t\t\tlayerData = range.ids.map(function(id){\r\n\t\t\t\t\t\t\treturn store.getItem(id);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tthrow new Error(\"Invalid range returned from 'getVisibleRange' of the layer\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif(!allData){\r\n\t\t\t\t\t\tallData = store.getVisibleItems();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlayerData = allData;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (layer.prepare_data) {\r\n\t\t\t\t\t// GS-1605. Highlight timeline cells below tasks and in an empty chart\r\n\t\t\t\t\tlayer.prepare_data(layerData);\r\n\t\t\t\t}\r\n\r\n\t\t\t\trenderers[i].render_items(layerData);\r\n\t\t\t}\r\n\t\t},\r\n\t\tupdateItems: function(layer) {\r\n\t\t\tif(layer.update_items){\r\n\t\t\t\tlet data = [];\r\n\t\t\t\tif(layer.get_visible_range){\r\n\r\n\t\t\t\t\tvar range = layer.get_visible_range(store);\r\n\t\t\t\t\tif(range.start !== undefined && range.end !== undefined){\r\n\t\t\t\t\t\tdata = store.getIndexRange(range.start, range.end);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(range.ids !== undefined){\r\n\t\t\t\t\t\tlet extraDataArr = range.ids.map(function(id){\r\n\t\t\t\t\t\t\treturn store.getItem(id);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t// GS-2502: range.ids might not exist in other datastores\r\n\t\t\t\t\t\tif(extraDataArr.length > 0){\r\n\t\t\t\t\t\t\textraDataArr = extraDataArr.filter(element => element !== undefined);\r\n\t\t\t\t\t\t\tdata = data.concat(extraDataArr);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif((range.start == undefined || range.end == undefined) && range.ids == undefined)  {\r\n\t\t\t\t\t\tthrow new Error(\"Invalid range returned from 'getVisibleRange' of the layer\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdata = store.getVisibleItems();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (layer.prepare_data) {\r\n\t\t\t\t\t// GS-1605. Highlight timeline cells below tasks and in an empty chart\r\n\t\t\t\t\tlayer.prepare_data(data, layer);\r\n\t\t\t\t}\r\n\t\t\t\tlayer.update_items(data);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tstore.attachEvent(\"onStoreUpdated\", function(id, item, action){\r\n\t\tif(isHeadless(gantt)){\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tconst renderer = gantt.$services.getService(\"layers\").getDataRender(name);\r\n\t\tif(renderer){\r\n\t\t\trenderer.onUpdateRequest = function(layer){\r\n\t\t\t\titemRepainter.updateItems(layer);\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n\r\n\tfunction skipRepaint(gantt){\r\n\t\tconst state = gantt.$services.getService(\"state\");\r\n\t\tif(state.getState(\"batchUpdate\").batch_update){\r\n\t\t\treturn true;\r\n\t\t}else{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tstore.attachEvent(\"onStoreUpdated\", function(id, item, action){\r\n\t\tif(skipRepaint(gantt)){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!id || action == \"move\" || action == \"delete\"){\r\n\t\t\tstore.callEvent(\"onBeforeRefreshAll\", []);\r\n\t\t\tstore.callEvent(\"onAfterRefreshAll\", []);\r\n\t\t}else{\r\n\t\t\tstore.callEvent(\"onBeforeRefreshItem\", [item.id]);\r\n\t\t\tstore.callEvent(\"onAfterRefreshItem\", [item.id]);\r\n\t\t}\r\n\t});\r\n\r\n\tstore.attachEvent(\"onAfterRefreshAll\", function(){\r\n\t\tif(isHeadless(gantt)){\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tconst renderer = gantt.$services.getService(\"layers\").getDataRender(name);\r\n\t\tif(renderer && !skipRepaint(gantt)){\r\n\t\t\titemRepainter.renderItems(renderer);\r\n\t\t}\r\n\t});\r\n\tstore.attachEvent(\"onAfterRefreshItem\", function(id){\r\n\t\tif(isHeadless(gantt)){\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tconst renderer = gantt.$services.getService(\"layers\").getDataRender(name);\r\n\t\tif(renderer){\r\n\t\t\titemRepainter.renderItem(id, renderer);\r\n\t\t}\r\n\t});\r\n\r\n\t// TODO: probably can be done more in a more efficient way\r\n\tstore.attachEvent(\"onItemOpen\", function(){\r\n\t\tif(isHeadless(gantt) || store.isSilent()){\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tgantt.render();\r\n\t});\r\n\r\n\tstore.attachEvent(\"onItemClose\", function(){\r\n\t\tif(isHeadless(gantt) || store.isSilent()){\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tgantt.render();\r\n\t});\r\n\r\n\tfunction refreshId(renders, oldId, newId, item) {\r\n\t\tfor (let i = 0; i < renders.length; i++) {\r\n\t\t\trenders[i].change_id(oldId, newId);\r\n\t\t}\r\n\t}\r\n\r\n\tstore.attachEvent(\"onIdChange\", function(oldId, newId){\r\n\t\tif(isHeadless(gantt)){\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// in case of linked datastores (tasks <-> links), id change should recalculate something in linked datastore before any repaint\r\n\t\t// use onBeforeIdChange for this hook.\r\n\t\t// TODO: use something more reasonable instead\r\n\t\tstore.callEvent(\"onBeforeIdChange\", [oldId, newId]);\r\n\r\n\t\tif(skipRepaint(gantt)){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!store.isSilent()){\r\n\t\t\tconst renderer = gantt.$services.getService(\"layers\").getDataRender(name);\r\n\t\t\tif(renderer){ // missing check for renderer GS-1814\r\n\t\t\t\trefreshId(renderer.getLayers(), oldId, newId, store.getItem(newId));\r\n\t\t\t\titemRepainter.renderItem(newId, renderer);\r\n\t\t\t}else{\r\n\t\t\t\t// GS-1814 repaint ui to apply new id when the datastore don't have own renderer\r\n\t\t\t\tgantt.render();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n};\r\n\r\nexport default {\r\n\tbindDataStore: storeRenderCreator\r\n};","import * as utils from \"../../utils/utils\";\r\nimport createTasksFacade from \"./datastore_tasks\";\r\nimport createLinksFacade from \"./datastore_links\";\r\nimport DataStore from \"../datastore/datastore\";\r\nimport TreeDataStore from \"../datastore/treedatastore\";\r\nimport createDatastoreSelect from \"../datastore/select\";\r\nimport datastoreRender from \"../datastore/datastore_render\";\r\nimport isHeadless from \"../../utils/is_headless\";\r\nimport {replaceValidZeroId} from \"../../utils/helpers\";\r\n\r\nfunction getDatastores(){\r\n\tvar storeNames = this.$services.getService(\"datastores\");\r\n\tvar res = [];\r\n\tfor(var i = 0; i < storeNames.length; i++){\r\n\t\tvar store = this.getDatastore(storeNames[i]);\r\n\t\tif(!store.$destroyed){\r\n\t\t\tres.push(store);\r\n\t\t}\r\n\t}\r\n\treturn res;\r\n}\r\n\r\nvar createDatastoreFacade = function(){\r\n\treturn {\r\n\tcreateDatastore: function(config){\r\n\r\n\t\tvar $StoreType = (config.type || \"\").toLowerCase() == \"treedatastore\" ? TreeDataStore : DataStore;\r\n\r\n\t\tif (config) {\r\n\t\t\tvar self = this;\r\n\t\t\tconfig.openInitially = function(){ return self.config.open_tree_initially; };\r\n\t\t\tconfig.copyOnParse = function(){ return self.config.deepcopy_on_parse; };\r\n\t\t}\r\n\r\n\t\tvar store = new $StoreType(config);\r\n\t\tthis.mixin(store, createDatastoreSelect(store));\r\n\r\n\t\tif (config.name) {\r\n\t\t\tvar servicePrefix = \"datastore:\";\r\n\t\t\tvar storeAccessName = servicePrefix + config.name;\r\n\r\n\t\t\tstore.attachEvent(\"onDestroy\", function(){\r\n\t\t\t\tthis.$services.dropService(storeAccessName);\r\n\t\t\t\tvar storeList = this.$services.getService(\"datastores\");\r\n\t\t\t\tfor(var i = 0; i < storeList.length; i++){\r\n\t\t\t\t\tif(storeList[i] === config.name){\r\n\t\t\t\t\t\tstoreList.splice(i, 1);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}.bind(this));\r\n\r\n\t\t\tthis.$services.dropService(storeAccessName);\r\n\t\t\tthis.$services.setService(storeAccessName, function() { return store; } );\r\n\r\n\t\t\tvar storeList = this.$services.getService(\"datastores\");\r\n\t\t\tif (!storeList) {\r\n\t\t\t\tstoreList = [];\r\n\t\t\t\tthis.$services.setService(\"datastores\", function() { return storeList; });\r\n\t\t\t\tstoreList.push(config.name);\r\n\t\t\t} else if (storeList.indexOf(config.name) < 0) {\r\n\t\t\t\tstoreList.push(config.name);\r\n\t\t\t}\r\n\r\n\t\t\tdatastoreRender.bindDataStore(config.name, this);\r\n\r\n\t\t}\r\n\r\n\t\treturn store;\r\n\t},\r\n\tgetDatastore: function(name){\r\n\t\treturn this.$services.getService(\"datastore:\" + name);\r\n\t},\r\n\t_getDatastores: getDatastores,\r\n\r\n\trefreshData: function () {\r\n\t\tvar scrollState;\r\n\t\tif(!isHeadless(this)){\r\n\t\t\tscrollState = this.getScrollState();\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onBeforeDataRender\", []);\r\n\r\n\t\tvar stores = getDatastores.call(this);\r\n\t\tfor(var i = 0; i < stores.length; i++){\r\n\t\t\tstores[i].refresh();\r\n\t\t}\r\n\r\n\t\tif(this.config.preserve_scroll && !isHeadless(this)){\r\n\t\t\tif(scrollState.x || scrollState.y){\r\n\t\t\t\tthis.scrollTo(scrollState.x, scrollState.y);\r\n\t\t\t}\r\n\t\t\t// GS-2866: need to restore the scroll position after resizing the resource view\r\n\t\t\t// in case if it was increased\r\n\t\t\tconst scrollbarsInfo = this.$layout.getScrollbarsInfo();\r\n\t\t\tscrollbarsInfo.forEach((scroll_info) => {\r\n\t\t\t\tconst scroll = this.$ui.getView(scroll_info.id);\r\n\t\t\t\tif(!scroll) return;\r\n\t\t\t\tconst scrollbarNodeVisible = this.utils.dom.isChildOf(scroll.$view, this.$container);\r\n\t\t\t\tscroll_info.boundViews.forEach((viewName) => {\r\n\t\t\t\t\tconst view = this.$ui.getView(viewName);\r\n\t\t\t\t\tif(scroll_info.y){\r\n\t\t\t\t\t\tif(view && !scrollbarNodeVisible){\r\n\t\t\t\t\t\t\tview.scrollTo(undefined, 0);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.callEvent(\"onDataRender\", []);\r\n\r\n\t},\r\n\r\n\tisChildOf: function(childId, parentId){\r\n\t\treturn this.$data.tasksStore.isChildOf(childId, parentId);\r\n\t},\r\n\r\n\trefreshTask: function (taskId, refresh_links) {\r\n\t\tvar task = this.getTask(taskId);\r\n\t\tvar self = this;\r\n\t\tfunction refreshLinks(){\r\n\t\t\tif (refresh_links !== undefined && !refresh_links)\r\n\t\t\t\treturn;\r\n\t\t\tfor (var i = 0; i < task.$source.length; i++) {\r\n\t\t\t\tself.refreshLink(task.$source[i]);\r\n\t\t\t}\r\n\t\t\tfor (var i = 0; i < task.$target.length; i++) {\r\n\t\t\t\tself.refreshLink(task.$target[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (task && this.isTaskVisible(taskId)) {\r\n\t\t\tthis.$data.tasksStore.refresh(taskId, !!this.getState(\"tasksDnd\").drag_id || refresh_links === false);// do quick refresh during drag and drop\r\n\t\t\trefreshLinks();\r\n\t\t}else if(this.isTaskExists(taskId) && this.isTaskExists(this.getParent(taskId)) && !this._bulk_dnd){\r\n\t\t\tthis.refreshTask(this.getParent(taskId));\r\n\r\n\t\t\tvar hasSplitParent = false;\r\n\t\t\tthis.eachParent(function(parent){\r\n\t\t\t\tif(hasSplitParent || this.isSplitTask(parent)){\r\n\t\t\t\t\thasSplitParent = true;\r\n\t\t\t\t}\r\n\t\t\t}, taskId);\r\n\t\t\tif(hasSplitParent){\r\n\t\t\t\trefreshLinks();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t},\r\n\trefreshLink: function (linkId) {\r\n\t\tthis.$data.linksStore.refresh(linkId, !!this.getState(\"tasksDnd\").drag_id);// do quick refresh during drag and drop\r\n\t},\r\n\r\n\tsilent: function(code){\r\n\t\tvar gantt = this;\r\n\t\tgantt.$data.tasksStore.silent(function(){\r\n\t\t\tgantt.$data.linksStore.silent(function(){\r\n\t\t\t\tcode();\r\n\t\t\t});\r\n\t\t});\r\n\t},\r\n\r\n\tclearAll: function () {\r\n\t\tvar stores = getDatastores.call(this);\r\n\t\t\r\n\t\t// clear all stores without invoking clearAll event\r\n\t\t// in order to prevent calling handlers when only some stores are cleared\r\n\t\tfor(var i = 0; i < stores.length; i++){\r\n\t\t\tstores[i].silent(function(){\r\n\t\t\t\tstores[i].clearAll();\t\r\n\t\t\t});\r\n\t\t}\r\n\t\t// run clearAll again to invoke events\r\n\t\tfor(var i = 0; i < stores.length; i++){\r\n\t\t\tstores[i].clearAll();\t\r\n\t\t}\r\n\r\n\t\tthis._update_flags();\r\n\t\tthis.userdata = {};\r\n\t\tthis.callEvent(\"onClear\", []);\r\n\t\tthis.render();\r\n\t},\r\n\t_clear_data: function () {\r\n\t\tthis.$data.tasksStore.clearAll();\r\n\t\tthis.$data.linksStore.clearAll();\r\n\t\tthis._update_flags();\r\n\t\tthis.userdata = {};\r\n\t},\r\n\r\n\tselectTask: function(id){\r\n\t\tvar store = this.$data.tasksStore;\r\n\t\tif(!this.config.select_task)\r\n\t\t\treturn false;\r\n\t\tid = replaceValidZeroId(id, this.config.root_id);\r\n\t\tif (id){\r\n\t\t\tlet oldSelectId = this.getSelectedId();\r\n\t\t\t// Don't repaint the resource panel as the data didn't change\r\n\t\t\tstore._skipResourceRepaint = true;\r\n\t\t\tstore.select(id);\r\n\t\t\tstore._skipResourceRepaint = false;\r\n\t\t\t// GS-730. Split task is not included in the tree, \r\n\t\t\t// so the datastore renderer will think that the task is not visible\r\n\t\t\tif (oldSelectId && store.pull[oldSelectId].$split_subtask && oldSelectId != id) {\r\n\t\t\t\tthis.refreshTask(oldSelectId);\r\n\t\t\t}\r\n\t\t\tif (store.pull[id].$split_subtask && oldSelectId != id) {// GS-1850. Do not repaint split task after double click\r\n\t\t\t\tthis.refreshTask(id);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn store.getSelectedId();\r\n\t},\r\n\tunselectTask: function(id){\r\n\t\tvar store = this.$data.tasksStore;\r\n\t\tstore.unselect(id);\r\n\t\t// GS-730. Split task is not included in the tree, \r\n\t\t// so the datastore renderer will think that the task is not visible\r\n\t\tif (id && store.pull[id].$split_subtask) {\r\n\t\t\tthis.refreshTask(id);\r\n\t\t}\r\n\t},\r\n\tisSelectedTask: function(id){\r\n\t\treturn this.$data.tasksStore.isSelected(id);\r\n\t},\r\n\tgetSelectedId: function() {\r\n\t\treturn this.$data.tasksStore.getSelectedId();\r\n\t}\r\n};\r\n};\r\n\r\nfunction createFacade(){\r\n\tvar res = utils.mixin({}, createDatastoreFacade());\r\n\tutils.mixin(res, createTasksFacade());\r\n\tutils.mixin(res, createLinksFacade());\r\n\treturn res;\r\n}\r\n\r\n\r\n\r\n\r\nexport default {create: createFacade};","function createDataStoreSelectMixin(store){\r\n\tvar selectedId = null;\r\n\r\n\tvar deleteItem = store._removeItemInner;\r\n\t\r\n\tfunction unselect(id){\r\n\t\tselectedId = null;\r\n\t\tthis.callEvent(\"onAfterUnselect\", [id]);\r\n\t}\r\n\r\n\tstore._removeItemInner = function(id){\r\n\t\tif(selectedId == id){\r\n\t\t\tunselect.call(this, id);\r\n\t\t}\r\n\r\n\t\tif(selectedId && this.eachItem){\r\n\t\t\tthis.eachItem(function(subItem){\r\n\t\t\t\tif(subItem.id == selectedId){\r\n\t\t\t\t\tunselect.call(this, subItem.id);\r\n\t\t\t\t}\r\n\t\t\t}, id);\r\n\t\t}\r\n\r\n\t\treturn deleteItem.apply(this, arguments);\r\n\t};\r\n\r\n\tstore.attachEvent(\"onIdChange\", function(oldId, newId) {\r\n\t\tif (store.getSelectedId() == oldId) {\r\n\t\t\tstore.silent(function () {\r\n\t\t\t\tstore.unselect(oldId);\r\n\t\t\t\tstore.select(newId);\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\treturn {\r\n\t\tselect: function(id){\r\n\t\t\tif (id){\r\n\r\n\t\t\t\tif(selectedId == id)\r\n\t\t\t\t\treturn selectedId;\r\n\r\n\t\t\t\tif(!this._skip_refresh) {\r\n\t\t\t\t\tif (!this.callEvent(\"onBeforeSelect\", [id])) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.unselect();\r\n\r\n\t\t\t\tselectedId = id;\r\n\r\n\t\t\t\tif(!this._skip_refresh) {\r\n\t\t\t\t\tthis.refresh(id);\r\n\t\t\t\t\tthis.callEvent(\"onAfterSelect\", [id]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn selectedId;\r\n\t\t},\r\n\t\tgetSelectedId: function(){\r\n\t\t\treturn selectedId;\r\n\t\t},\r\n\t\tisSelected: function(id){\r\n\t\t\treturn id == selectedId;\r\n\t\t},\r\n\t\tunselect: function(id){\r\n\t\t\tvar id = id || selectedId;\r\n\t\t\tif(!id)\r\n\t\t\t\treturn;\r\n\t\t\tselectedId = null;\r\n\t\t\tif(!this._skip_refresh){\r\n\t\t\t\tthis.refresh(id);\r\n\t\t\t\tunselect.call(this, id);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default createDataStoreSelectMixin;","import * as utils from \"../../utils/utils\";\r\n\r\n\r\nvar createLinksStoreFacade = function(){\r\n\treturn {\r\n\tgetLinkCount: function () {\r\n\t\treturn this.$data.linksStore.count();\r\n\t},\r\n\r\n\tgetLink : function (id) {\r\n\t\treturn this.$data.linksStore.getItem(id);\r\n\t},\r\n\r\n\tgetLinks : function () {\r\n\t\treturn this.$data.linksStore.getItems();\r\n\t},\r\n\r\n\tisLinkExists : function (id) {\r\n\t\treturn this.$data.linksStore.exists(id);\r\n\t},\r\n\r\n\taddLink : function (link) {\r\n\t\treturn this.$data.linksStore.addItem(link);\r\n\t},\r\n\r\n\tupdateLink : function (id, data) {\r\n\t\tif (!utils.defined(data))\r\n\t\t\tdata = this.getLink(id);\r\n\t\tthis.$data.linksStore.updateItem(id, data);\r\n\t},\r\n\r\n\tdeleteLink : function (id) {\r\n\t\treturn this.$data.linksStore.removeItem(id);\r\n\t},\r\n\r\n\tchangeLinkId : function (oldid, newid) {\r\n\t\treturn this.$data.linksStore.changeId(oldid, newid);\r\n\t}\r\n};\r\n};\r\n\r\nexport default createLinksStoreFacade;","import ScaleHelper from \"./ui/timeline/scales_ignore\";\r\nimport PrimaryScaleHelper from \"./ui/timeline/scales\";\r\n\r\nfunction resolveConfigRange(unit, gantt){\r\n\tvar range = {\r\n\t\tstart_date:null,\r\n\t\tend_date:null\r\n\t};\r\n\r\n\tif (gantt.config.start_date && gantt.config.end_date) {\r\n\t\trange.start_date = gantt.date[unit + \"_start\"](new Date(gantt.config.start_date));\r\n\r\n\t\tvar end = new Date(gantt.config.end_date);\r\n\t\tvar start_interval = gantt.date[unit + \"_start\"](new Date(end));\r\n\t\tif (+end != +start_interval) {\r\n\t\t\tend = gantt.date.add(start_interval, 1, unit);\r\n\t\t} else {\r\n\t\t\tend = start_interval;\r\n\t\t}\r\n\r\n\t\trange.end_date = end;\r\n\t}\r\n\treturn range;\r\n}\r\n\r\nfunction _scale_range_unit(gantt) {\r\n\tconst primaryScale = (new PrimaryScaleHelper(gantt)).primaryScale();\r\n\tlet unit = primaryScale.unit;\r\n\tlet step = primaryScale.step;\r\n\tif (gantt.config.scale_offset_minimal) {\r\n\r\n\t\tconst helper = new ScaleHelper(gantt);\r\n\t\tconst scales = [helper.primaryScale()].concat(helper.getAdditionalScales());\r\n\r\n\t\thelper.sortScales(scales);\r\n\t\tunit = scales[scales.length - 1].unit;\r\n\t\tstep = scales[scales.length - 1].step || 1;\r\n\t}\r\n\treturn { unit:unit, step:step };\r\n}\r\n\r\nfunction _init_tasks_range(gantt) {\r\n\tvar cfg = _scale_range_unit(gantt);\r\n\tvar unit = cfg.unit,\r\n\t\tstep = cfg.step;\r\n\tvar range = resolveConfigRange(unit, gantt);\r\n\r\n\t// GS-1544: Show correct date range if we have tasks or only projects\r\n\tif(!(range.start_date && range.end_date)){\r\n\t\tvar onlyProjectTasks = true;\r\n\t\tvar tasks = gantt.getTaskByTime();\r\n\t\tfor (var i = 0; i < tasks.length; i++) {\r\n\t\t\tvar task = tasks[i];\r\n\t\t\tif (task.type !== gantt.config.types.project){\r\n\t\t\t\tonlyProjectTasks = false;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (tasks.length && onlyProjectTasks){\r\n\t\t\tvar start_date = tasks[0].start_date;\r\n\t\t\tvar end_date = gantt.date.add(start_date, 1, gantt.config.duration_unit);\r\n\t\t\trange = {\r\n\t\t\t\tstart_date: new Date(start_date),\r\n\t\t\t\tend_date: new Date(end_date)\r\n\t\t\t};\r\n\t\t} else{\r\n\t\t\trange = gantt.getSubtaskDates();\r\n\t\t}\r\n\r\n\t\tif(!range.start_date || !range.end_date){\r\n\t\t\trange = {\r\n\t\t\t\tstart_date: new Date(),\r\n\t\t\t\tend_date: new Date()\r\n\t\t\t};\r\n\t\t}\r\n\t\t// extend the displayed date range including the constraints, deadlines and baselines\r\n\t\tgantt.eachTask(function(task){\r\n\t\t\tif (gantt.config.deadlines && task.deadline){\r\n\t\t\t\textendRangeForDates(range, task.deadline, task.deadline);\r\n\t\t\t}\r\n\t\t\tif (task.constraint_date && task.constraint_type){\r\n\t\t\t\tif (gantt._getAutoSchedulingConfig().apply_constraints && gantt.config.constraint_types && task.constraint_type !== gantt.config.constraint_types.ASAP && task.constraint_type !== gantt.config.constraint_types.ALAP){\r\n\t\t\t\t\textendRangeForDates(range, task.constraint_date, task.constraint_date);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (gantt.config.baselines && task.baselines){\r\n\t\t\t\ttask.baselines.forEach(function(baseline){\r\n\t\t\t\t\textendRangeForDates(range, baseline.start_date, baseline.end_date);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\trange.start_date = gantt.date[unit + \"_start\"](range.start_date);\r\n\t\trange.start_date = gantt.calculateEndDate({\r\n\t\t\tstart_date: gantt.date[unit + \"_start\"](range.start_date),\r\n\t\t\tduration: -1,\r\n\t\t\tunit: unit,\r\n\t\t\tstep:step\r\n\t\t});//one free column before first task\r\n\r\n\t\trange.end_date = gantt.date[unit + \"_start\"](range.end_date);\r\n\t\trange.end_date = gantt.calculateEndDate({start_date: range.end_date, duration: 2, unit: unit, step:step});//one free column after last task\r\n\t}\r\n\r\n\tgantt._min_date = range.start_date;\r\n\tgantt._max_date = range.end_date;\r\n}\r\n\r\nfunction extendRangeForDates(range, start_date, end_date){\r\n\tif (start_date < range.start_date){\r\n\t\trange.start_date = new Date(start_date);\r\n\t}\r\n\tif (end_date > range.end_date){\r\n\t\trange.end_date = new Date(end_date);\r\n\t}\r\n}\r\n\r\nfunction _adjust_scales(gantt) {\r\n\tif (gantt.config.fit_tasks) {\r\n\t\tvar old_min = +gantt._min_date,\r\n\t\t\told_max = +gantt._max_date;\r\n\t\t//this._init_tasks_range();\r\n\t\tif (+gantt._min_date != old_min || +gantt._max_date != old_max) {\r\n\t\t\tgantt.render();\r\n\r\n\t\t\tgantt.callEvent(\"onScaleAdjusted\", []);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nexport default function updateTasksRange(gantt){\r\n\t_init_tasks_range(gantt);\r\n\t_adjust_scales(gantt);\r\n};\r\n","function copyLinkIdsArray(gantt, linkIds, targetHash){\r\n\tfor(var i = 0; i < linkIds.length; i++) {\r\n\t\tif(gantt.isLinkExists(linkIds[i])){\r\n\t\t\ttargetHash[linkIds[i]] = gantt.getLink(linkIds[i]);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction copyLinkIds(gantt, task, targetHash){\r\n\tcopyLinkIdsArray(gantt, task.$source, targetHash);\r\n\tcopyLinkIdsArray(gantt, task.$target, targetHash);\r\n}\r\n\r\nfunction getSubtreeLinks(gantt, rootId){\r\n\tvar res = {};\r\n\r\n\tif(gantt.isTaskExists(rootId)){\r\n\t\tcopyLinkIds(gantt, gantt.getTask(rootId), res);\r\n\t}\r\n\r\n\tgantt.eachTask(function(child){\r\n\t\tcopyLinkIds(gantt, child, res);\r\n\t}, rootId);\r\n\r\n\treturn res;\r\n}\r\n\r\nfunction getSubtreeTasks(gantt, rootId){\r\n\tvar res = {};\r\n\r\n\tgantt.eachTask(function(child){\r\n\t\tres[child.id] = child;\r\n\t}, rootId);\r\n\r\n\treturn res;\r\n}\r\n\r\nexport default {\r\n\tgetSubtreeLinks: getSubtreeLinks,\r\n\tgetSubtreeTasks: getSubtreeTasks\r\n};","import * as helpers from \"../../utils/helpers\";\r\nimport treeHelper from \"../../utils/task_tree_helpers\";\r\n\r\n\r\nexport default class DataProcessorEvents {\r\n\tprotected _dataProcessorHandlers: any[];\r\n\tprotected $gantt: any;\r\n\tprotected $dp: any;\r\n\r\n\tconstructor(gantt: any, dp: any) {\r\n\t\tthis.$gantt = gantt;\r\n\t\tthis.$dp = dp;\r\n\t\tthis._dataProcessorHandlers = [];\r\n\t}\r\n\r\n\tattach() {\r\n\t\tconst dp = this.$dp;\r\n\t\tconst gantt = this.$gantt;\r\n\t\tconst cascadeDelete = {};\r\n\r\n\t\tconst clientSideDelete = (id) => {\r\n\t\t\treturn this.clientSideDelete(id, dp, gantt);\r\n\t\t};\r\n\r\n\t\tfunction getTaskLinks(task) {\r\n\t\t\tlet _links = [];\r\n\r\n\t\t\tif (task.$source) {\r\n\t\t\t\t_links = _links.concat(task.$source);\r\n\t\t\t}\r\n\t\t\tif (task.$target) {\r\n\t\t\t\t_links = _links.concat(task.$target);\r\n\t\t\t}\r\n\r\n\t\t\treturn _links;\r\n\t\t}\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterTaskAdd\", function(id, item) { // tslint:disable-line\r\n\t\t\tif (gantt.isTaskExists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"tasks\");\r\n\t\t\t\tdp.setUpdated(id, true, \"inserted\");\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterTaskUpdate\", function(id, item) { // tslint:disable-line\r\n\t\t\tif (gantt.isTaskExists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"tasks\");\r\n\t\t\t\tdp.setUpdated(id, true);\r\n\r\n\t\t\t\t// gantt can be destroyed/reinitialized after dp.setUpdated\r\n\t\t\t\tif(gantt._sendTaskOrder){\r\n\t\t\t\t\tgantt._sendTaskOrder(id, item);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onBeforeTaskDelete\", function(id, item) { // tslint:disable-line\r\n\t\t\tif (gantt.config.cascade_delete) {\r\n\t\t\t\tcascadeDelete[id] = {\r\n\t\t\t\t\ttasks: treeHelper.getSubtreeTasks(gantt, id),\r\n\t\t\t\t\tlinks: treeHelper.getSubtreeLinks(gantt, id)\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t// GS-631. Keep the deleted item in Gantt until we receive the successful response from the server\r\n\t\t\tif (dp.deleteAfterConfirmation) {\r\n\t\t\t\tdp.setGanttMode(\"tasks\");\r\n\t\t\t\tdp.setUpdated(id, true, \"deleted\");\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}));\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterTaskDelete\", function(id, item) { // tslint:disable-line\r\n\t\t\tdp.setGanttMode(\"tasks\");\r\n\r\n\t\t\t// not send delete request if item is not inserted into the db - just remove it from the client\r\n\t\t\tconst needDbDelete = !clientSideDelete(id);\r\n\t\t\tconst needCascadeDelete = gantt.config.cascade_delete && cascadeDelete[id];\r\n\t\t\tif (!needDbDelete && !needCascadeDelete) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (needCascadeDelete) {\r\n\t\t\t\tconst dpMode = dp.updateMode;\r\n\t\t\t\tdp.setUpdateMode(\"off\");\r\n\r\n\t\t\t\tconst cascade = cascadeDelete[id];\r\n\t\t\t\tfor (const i in cascade.tasks) {\r\n\t\t\t\t\tif (!clientSideDelete(i)) {\r\n\t\t\t\t\t\tdp.storeItem(cascade.tasks[i]);\r\n\t\t\t\t\t\tdp.setUpdated(i, true, \"deleted\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tdp.setGanttMode(\"links\");\r\n\t\t\t\tfor (const i in cascade.links) {\r\n\t\t\t\t\tif (!clientSideDelete(i)) {\r\n\t\t\t\t\t\tdp.storeItem(cascade.links[i]);\r\n\t\t\t\t\t\tdp.setUpdated(i, true, \"deleted\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcascadeDelete[id] = null;\r\n\r\n\t\t\t\tif (dpMode !== \"off\") {\r\n\t\t\t\t\tdp.sendAllData();\r\n\t\t\t\t}\r\n\t\t\t\tdp.setGanttMode(\"tasks\");\r\n\t\t\t\tdp.setUpdateMode(dpMode);\r\n\t\t\t}\r\n\r\n\t\t\tif (needDbDelete){\r\n\t\t\t\tdp.storeItem(item);\r\n\t\t\t\tif (!dp.deleteAfterConfirmation){\r\n\t\t\t\t\tdp.setUpdated(id, true, \"deleted\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n\t\t\tif (dp.updateMode !== \"off\" && !dp._tSend) {\r\n\t\t\t\tdp.sendAllData();\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterLinkUpdate\", function(id, item) { // tslint:disable-line\r\n\t\t\tif (gantt.isLinkExists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"links\");\r\n\t\t\t\tdp.setUpdated(id, true);\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterLinkAdd\", function(id, item) { // tslint:disable-line\r\n\t\t\tif (gantt.isLinkExists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"links\");\r\n\t\t\t\tdp.setUpdated(id, true,\"inserted\");\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterLinkDelete\", function(id, item) { // tslint:disable-line\r\n\t\t\tdp.setGanttMode(\"links\");\r\n\r\n\t\t\tconst needDbDelete = !clientSideDelete(id);\r\n\t\t\tif (!needDbDelete) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdp.storeItem(item);\r\n\t\t\tdp.setUpdated(id, true,\"deleted\");\r\n\t\t}));\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onRowDragEnd\", function(id, target) { // tslint:disable-line\r\n\t\t\tgantt._sendTaskOrder(id, gantt.getTask(id));\r\n\t\t}));\r\n\r\n\t\tlet tasks = null;\r\n\t\tlet links = null;\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onTaskIdChange\", function(oldId, newId) { // tslint:disable-line\r\n\t\t\tif (!dp._waitMode) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst children = gantt.getChildren(newId);\r\n\t\t\tif (children.length) {\r\n\t\t\t\ttasks = tasks || {};\r\n\r\n\t\t\t\tfor (let i = 0; i < children.length; i++) {\r\n\t\t\t\t\tconst ch = this.getTask(children[i]);\r\n\t\t\t\t\ttasks[ch.id] = ch;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst item = this.getTask(newId);\r\n\t\t\tconst itemLinks = getTaskLinks(item);\r\n\r\n\t\t\tif (itemLinks.length) {\r\n\t\t\t\tlinks = links || {};\r\n\r\n\t\t\t\tfor (let i = 0; i < itemLinks.length; i++) {\r\n\t\t\t\t\tconst link = this.getLink(itemLinks[i]);\r\n\t\t\t\t\tlinks[link.id] = link;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tdp.attachEvent(\"onAfterUpdateFinish\", function() {\r\n\t\t\tif (tasks || links) {\r\n\t\t\t\tgantt.batchUpdate(function() {\r\n\t\t\t\t\tfor (const id in tasks) {\r\n\t\t\t\t\t\tgantt.updateTask(tasks[id].id);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (const id in links) {\r\n\t\t\t\t\t\tgantt.updateLink(links[id].id);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttasks = null;\r\n\t\t\t\t\tlinks = null;\r\n\t\t\t\t});\r\n\t\t\t\tif (tasks) {\r\n\t\t\t\t\tgantt._dp.setGanttMode(\"tasks\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tgantt._dp.setGanttMode(\"links\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tdp.attachEvent(\"onBeforeDataSending\", function() {\r\n\t\t\tif (this._tMode === \"CUSTOM\") {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tlet url = this._serverProcessor;\r\n\t\t\tif (this._tMode === \"REST-JSON\" || this._tMode === \"REST\") {\r\n\t\t\t\tconst mode = this._ganttMode;\r\n\r\n\t\t\t\turl = url.substring(0, url.indexOf(\"?\") > -1 ? url.indexOf(\"?\") : url.length);\r\n\t\t\t\t// editing=true&\r\n\t\t\t\tthis.serverProcessor = url + (url.slice(-1) === \"/\" ? \"\" : \"/\") + mode;\r\n\t\t\t} else {\r\n\t\t\t\tconst pluralizedMode = this._ganttMode + \"s\";\r\n\t\t\t\tthis.serverProcessor = url + gantt.ajax.urlSeparator(url) + \"gantt_mode=\" + pluralizedMode;\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tdp.attachEvent(\"insertCallback\", function insertCallback(upd, id, parent, mode) { // tslint:disable-line\r\n\t\t\tconst data = upd.data || gantt.xml._xmlNodeToJSON(upd.firstChild);\r\n\t\t\tconst methods = {\r\n\t\t\t\tadd: gantt.addTask,\r\n\t\t\t\tisExist: gantt.isTaskExists\r\n\t\t\t};\r\n\t\t\tif (mode === \"links\") {\r\n\t\t\t\tmethods.add = gantt.addLink;\r\n\t\t\t\tmethods.isExist = gantt.isLinkExists;\r\n\t\t\t}\r\n\t\t\tif (methods.isExist.call(gantt, id)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdata.id = id;\r\n\t\t\tmethods.add.call(gantt, data);\r\n\t\t});\r\n\r\n\t\tdp.attachEvent(\"updateCallback\", function updateCallback(upd, id) {\r\n\t\t\tconst data = upd.data || gantt.xml._xmlNodeToJSON(upd.firstChild);\r\n\t\t\tif (!gantt.isTaskExists(id)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst objData = gantt.getTask(id);\r\n\t\t\tfor (const key in data) {\r\n\t\t\t\tlet property = data[key];\r\n\t\t\t\tswitch (key) {\r\n\t\t\t\t\tcase \"id\":\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\tcase \"start_date\":\r\n\t\t\t\t\tcase \"end_date\":\r\n\t\t\t\t\t\tproperty = gantt.defined(gantt.templates.xml_date) ? gantt.templates.xml_date(property) : gantt.templates.parse_date(property);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"duration\":\r\n\t\t\t\t\t\tobjData.end_date = gantt.calculateEndDate({start_date: objData.start_date, duration: property, task:objData});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tobjData[key] = property;\r\n\t\t\t}\r\n\t\t\tgantt.updateTask(id);\r\n\t\t\tgantt.refreshData();\r\n\t\t});\r\n\t\tdp.attachEvent(\"deleteCallback\", function deleteCallback(upd, id, parent, mode) { // tslint:disable-line\r\n\t\t\tconst methods = {\r\n\t\t\t\tdelete: gantt.deleteTask,\r\n\t\t\t\tisExist: gantt.isTaskExists\r\n\t\t\t};\r\n\t\t\tif (mode === \"links\") {\r\n\t\t\t\tmethods.delete = gantt.deleteLink;\r\n\t\t\t\tmethods.isExist = gantt.isLinkExists;\r\n\t\t\t} else if(mode === \"assignment\") {\r\n\t\t\t\tmethods.delete = function(val) {\r\n\t\t\t\t\tgantt.$data.assignmentsStore.remove(val);\r\n\t\t\t\t};\r\n\t\t\t\tmethods.isExist = function(val){\r\n\t\t\t\t\treturn gantt.$data.assignmentsStore.exists(val);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif (methods.isExist.call(gantt, id)) {\r\n\t\t\t\tmethods.delete.call(gantt, id);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.handleResourceCRUD(dp, gantt);\r\n\t\tthis.handleResourceAssignmentCRUD(dp, gantt);\r\n\t\tthis.handleBaselineCRUD(dp, gantt);\r\n\t}\r\n\r\n\tclientSideDelete(id, dp, gantt){\r\n\t\tconst updated = dp.updatedRows.slice();\r\n\t\tlet clientOnly = false;\r\n\r\n\t\tif(gantt.getUserData(id, \"!nativeeditor_status\", dp._ganttMode) === \"true_deleted\"){\r\n\t\t\tclientOnly = true;\r\n\t\t\tdp.setUpdated(id,false);\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < updated.length && !dp._in_progress[id]; i++) {\r\n\t\t\tif (updated[i] === id) {\r\n\t\t\t\tif (gantt.getUserData(id, \"!nativeeditor_status\", dp._ganttMode) === \"inserted\") {\r\n\t\t\t\t\tclientOnly = true;\r\n\t\t\t\t}\r\n\t\t\t\tdp.setUpdated(id,false);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn clientOnly;\r\n\t}\r\n\r\n\thandleResourceAssignmentCRUD(dp, gantt){\r\n\t\tif(!gantt.config.resources || gantt.config.resources.dataprocessor_assignments !== true){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst assignmentsStore = gantt.getDatastore(gantt.config.resource_assignment_store);\r\n\t\tconst insertedTasks = {};\r\n\t\tconst pendingAssignments = {};\r\n\r\n\t\tgantt.attachEvent(\"onBeforeTaskAdd\", function(id, task){\r\n\t\t\tinsertedTasks[id] = true;\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tfunction putAssignmentToQueue(item){\r\n\t\t\tpendingAssignments[item.id] = item;\r\n\t\t\tinsertedTasks[item.task_id] = true;\r\n\t\t}\r\n\r\n\t\tfunction insertResourceAssignment(assignment){\r\n\t\t\tconst id = assignment.id;\r\n\t\t\tif (assignmentsStore.exists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"assignment\");\r\n\t\t\t\tdp.setUpdated(id, true,\"inserted\");\r\n\t\t\t}\r\n\t\t\tdelete pendingAssignments[id];\r\n\t\t}\r\n\r\n\t\tgantt.attachEvent(\"onTaskIdChange\", function(id, newId){\r\n\t\t\tdelete insertedTasks[id];\r\n\t\t});\r\n\r\n\t\tassignmentsStore.attachEvent(\"onAfterAdd\", (id, item) => {\r\n\t\t\tif(insertedTasks[item.task_id]){\r\n\t\t\t\t// inserting assignment of new task\r\n\t\t\t\t// task is not saved yet, need to wait till it gets permanent id and save assigmnents after that\r\n\t\t\t\tputAssignmentToQueue(item);\r\n\t\t\t}else{\r\n\t\t\t\tinsertResourceAssignment(item);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tassignmentsStore.attachEvent(\"onAfterUpdate\", (id, item) => {\r\n\t\t\tif (assignmentsStore.exists(id)) {\r\n\t\t\t\tif(pendingAssignments[id]){\r\n\t\t\t\t\tinsertResourceAssignment(item);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdp.setGanttMode(\"assignment\");\r\n\t\t\t\t\tdp.setUpdated(id, true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tassignmentsStore.attachEvent(\"onAfterDelete\", (id, item) => {\r\n\t\t\tdp.setGanttMode(\"assignment\");\r\n\r\n\t\t\tconst needDbDelete = !this.clientSideDelete(id, dp, gantt);\r\n\t\t\tif (!needDbDelete) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdp.storeItem(item);\r\n\t\t\tdp.setUpdated(id, true,\"deleted\");\r\n\t\t});\r\n\r\n\t}\r\n\r\n\thandleResourceCRUD(dp, gantt){\r\n\t\tif(!gantt.config.resources || gantt.config.resources.dataprocessor_resources !== true){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst resourcesStore = gantt.getDatastore(gantt.config.resource_store);\r\n\r\n\t\tfunction insertResource(resource){\r\n\t\t\tconst id = resource.id;\r\n\t\t\tif (resourcesStore.exists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"resource\");\r\n\t\t\t\tdp.setUpdated(id, true,\"inserted\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tresourcesStore.attachEvent(\"onAfterAdd\", (id, item) => {\r\n\t\t\tinsertResource(item);\r\n\t\t});\r\n\r\n\t\tresourcesStore.attachEvent(\"onAfterUpdate\", (id, item) => {\r\n\t\t\tif (resourcesStore.exists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"resource\");\r\n\t\t\t\tdp.setUpdated(id, true);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tresourcesStore.attachEvent(\"onAfterDelete\", (id, item) => {\r\n\t\t\tdp.setGanttMode(\"resource\");\r\n\r\n\t\t\tconst needDbDelete = !this.clientSideDelete(id, dp, gantt);\r\n\t\t\tif (!needDbDelete) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdp.storeItem(item);\r\n\t\t\tdp.setUpdated(id, true,\"deleted\");\r\n\t\t});\r\n\r\n\t}\r\n\r\n\thandleBaselineCRUD(dp, gantt){\r\n\t\tif(!gantt.config.baselines || gantt.config.baselines.dataprocessor_baselines !== true){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst baselineStore = gantt.getDatastore(gantt.config.baselines.datastore);\r\n\r\n\t\tfunction insertResource(resource){\r\n\t\t\tconst id = resource.id;\r\n\t\t\tif (baselineStore.exists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"baseline\");\r\n\t\t\t\tdp.setUpdated(id, true,\"inserted\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tbaselineStore.attachEvent(\"onAfterAdd\", (id, item) => {\r\n\t\t\tinsertResource(item);\r\n\t\t});\r\n\r\n\t\tbaselineStore.attachEvent(\"onAfterUpdate\", (id, item) => {\r\n\t\t\tif (baselineStore.exists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"baseline\");\r\n\t\t\t\tdp.setUpdated(id, true);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tbaselineStore.attachEvent(\"onAfterDelete\", (id, item) => {\r\n\t\t\tdp.setGanttMode(\"baseline\");\r\n\r\n\t\t\tconst needDbDelete = !this.clientSideDelete(id, dp, gantt);\r\n\t\t\tif (!needDbDelete) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdp.storeItem(item);\r\n\t\t\tdp.setUpdated(id, true,\"deleted\");\r\n\t\t});\r\n\t}\r\n\r\n\tdetach() {\r\n\t\thelpers.forEach(this._dataProcessorHandlers, (e) => {\r\n\t\t\tthis.$gantt.detachEvent(e);\r\n\t\t});\r\n\t\tthis._dataProcessorHandlers = [];\r\n\t}\r\n}\r\n","import * as utils from \"../../utils/utils\";\r\n\r\nexport default class SimpleStorage {\r\n\tpublic static create = () : SimpleStorage => {\r\n\t\treturn new SimpleStorage();\r\n\t};\r\n\r\n\tprotected _storage: { [id: string]: any; };\r\n\r\n\tprotected constructor() {\r\n\t\tthis._storage = {};\r\n\t}\r\n\r\n\tpublic clear = (): void => {\r\n\t\tthis._storage = {};\r\n\t};\r\n\r\n\tpublic storeItem = (item: any): void => {\r\n\t\tthis._storage[item.id] = utils.copy(item);\r\n\t};\r\n\r\n\tpublic getStoredItem = (id: string): any => {\r\n\t\treturn this._storage[id] || null;\r\n\t};\r\n}","import eventable from \"../../utils/eventable\";\r\nimport * as helpers from \"../../utils/helpers\";\r\nimport * as utils from \"../../utils/utils\";\r\nimport DataProcessorEvents from \"./data_processor_events\";\r\nimport extendGantt from \"./extend_gantt\";\r\nimport SimpleStorage from \"./simple_storage\";\r\nimport global from \"../../utils/global\";\r\n\r\nexport interface DataProcessor { // tslint:disable-line\r\n\t$gantt: any;\r\n\tdetachAllEvents: any;\r\n\tattachEvent: any;\r\n\tcallEvent: any;\r\n\r\n\tserverProcessor: string;\r\n\taction_param: string;\r\n\tupdatedRows: any[];\r\n\tautoUpdate: boolean;\r\n\tupdateMode: string;\r\n\tmessages: any[];\r\n\tstyles: object;\r\n\tdnd: any;\r\n\tdeleteAfterConfirmation?: any;\r\n}\r\n\r\nexport function createDataProcessor(config: any) {\r\n\tlet router;\r\n\tlet tMode;\r\n\tlet headers;\r\n\tif (config instanceof Function) {\r\n\t\trouter = config;\r\n\t} else if (config.hasOwnProperty(\"router\")) {\r\n\t\trouter = config.router;\r\n\t} else if (config.hasOwnProperty(\"assignment\") || config.hasOwnProperty(\"baseline\") || config.hasOwnProperty(\"link\") || config.hasOwnProperty(\"task\")) {\r\n\t\trouter = config;\r\n\t} else if(config.hasOwnProperty(\"headers\")){\r\n\t\t// GS-2312 for custom headers\r\n\t\theaders = config.headers;\r\n\t}\r\n\tif (router) {\r\n\t\ttMode = \"CUSTOM\";\r\n\t} else {\r\n\t\ttMode = config.mode || \"REST-JSON\";\r\n\t}\r\n\tconst gantt = this; // tslint:disable-line\r\n\tconst dp = new DataProcessor(config.url);\r\n\r\n\r\n\tdp.init(gantt);\r\n\tdp.setTransactionMode({\r\n\t\tmode: tMode,\r\n\t\trouter,\r\n\t\theaders\r\n\t}, config.batchUpdate);\r\n\tif(config.deleteAfterConfirmation){\r\n\t\tdp.deleteAfterConfirmation = config.deleteAfterConfirmation;\r\n\t}\r\n\treturn dp;\r\n}\r\n\r\nexport class DataProcessor {\r\n\tpublic modes: object;\r\n\tpublic serverProcessor: string;\r\n\tpublic action_param: string; // tslint:disable-line\r\n\tpublic updatedRows: any[];\r\n\tpublic autoUpdate: boolean;\r\n\tpublic updateMode: string;\r\n\tpublic messages: any[];\r\n\tpublic styles: object;\r\n\tpublic dnd: any;\r\n\r\n\tprotected _tMode: string;\r\n\tprotected _headers: any;\r\n\tprotected _payload: any;\r\n\tprotected _postDelim: string;\r\n\tprotected _waitMode: number;\r\n\tprotected _in_progress: object; // tslint:disable-line\r\n\tprotected _invalid: object;\r\n\tprotected _storage: SimpleStorage;\r\n\tprotected _tSend: boolean;\r\n\tprotected _serializeAsJson: boolean;\r\n\tprotected _router: any;\r\n\tprotected _utf: boolean;\r\n\tprotected _methods: any[];\r\n\tprotected _user: any;\r\n\tprotected _uActions: object;\r\n\tprotected _needUpdate: boolean;\r\n\tprotected _ganttMode: \"task\"|\"link\";\r\n\tprotected _routerParametersFormat: \"parameters\"|\"object\";\r\n\r\n\tprotected _silent_mode: any; // tslint:disable-line\r\n\tprotected _updateBusy: any;\r\n\tprotected _serverProcessor: any;\r\n\tprotected _initialized: boolean;\r\n\r\n\tconstructor(serverProcessorURL?) {\r\n\t\tthis.serverProcessor = serverProcessorURL;\r\n\t\tthis.action_param = \"!nativeeditor_status\";\r\n\r\n\t\tthis.updatedRows = []; // ids of updated rows\r\n\r\n\t\tthis.autoUpdate = true;\r\n\t\tthis.updateMode = \"cell\";\r\n\t\tthis._headers = null;\r\n\t\tthis._payload = null;\r\n\t\tthis._postDelim = \"_\";\r\n\t\tthis._routerParametersFormat = \"parameters\";\r\n\r\n\t\tthis._waitMode = 0;\r\n\t\tthis._in_progress = {}; // ?\r\n\t\tthis._storage = SimpleStorage.create();\r\n\t\tthis._invalid = {};\r\n\t\tthis.messages = [];\r\n\r\n\t\tthis.styles = {\r\n\t\t\tupdated: \"font-weight:bold;\",\r\n\t\t\tinserted: \"font-weight:bold;\",\r\n\t\t\tdeleted: \"text-decoration : line-through;\",\r\n\t\t\tinvalid: \"background-color:FFE0E0;\",\r\n\t\t\tinvalid_cell: \"border-bottom:2px solid red;\",\r\n\t\t\terror: \"color:red;\",\r\n\t\t\tclear: \"font-weight:normal;text-decoration:none;\"\r\n\t\t};\r\n\t\tthis.enableUTFencoding(true);\r\n\t\teventable(this);\r\n\t}\r\n\r\n\tsetTransactionMode(mode:any, total?:any) {\r\n\t\tif (typeof mode === \"object\") {\r\n\t\t\tthis._tMode = mode.mode || this._tMode;\r\n\r\n\t\t\tif (utils.defined(mode.headers)) {\r\n\t\t\t\tthis._headers = mode.headers;\r\n\t\t\t}\r\n\r\n\t\t\tif (utils.defined(mode.payload)) {\r\n\t\t\t\tthis._payload = mode.payload;\r\n\t\t\t}\r\n\t\t\tthis._tSend = !!total;\r\n\t\t} else {\r\n\t\t\tthis._tMode = mode;\r\n\t\t\tthis._tSend = total;\r\n\t\t}\r\n\r\n\t\tif (this._tMode === \"REST\") {\r\n\t\t\tthis._tSend = false;\r\n\t\t}\r\n\r\n\t\tif (this._tMode === \"JSON\" || this._tMode === \"REST-JSON\") {\r\n\t\t\tthis._tSend = false;\r\n\t\t\tthis._serializeAsJson = true;\r\n\t\t\tthis._headers = this._headers || {};\r\n\t\t\tthis._headers[\"Content-Type\"] = \"application/json\";\r\n\t\t}else{\r\n\t\t\tif(this._headers && !this._headers[\"Content-Type\"]){\r\n\t\t\t\tthis._headers[\"Content-Type\"] = \"application/x-www-form-urlencoded\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._tMode === \"CUSTOM\") {\r\n\t\t\tthis._tSend = false;\r\n\t\t\tthis._router = mode.router;\r\n\t\t}\r\n\t}\r\n\r\n\tescape(data:any) {\r\n\t\tif (this._utf) {\r\n\t\t\treturn encodeURIComponent(data);\r\n\t\t} else {\r\n\t\t\treturn escape(data);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: allows to set escaping mode\r\n\t * @param: true - utf based escaping, simple - use current page encoding\r\n\t * @type: public\r\n\t */\r\n\tenableUTFencoding(mode:boolean) {\r\n\t\tthis._utf = !!mode;\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: get state of updating\r\n\t * @returns:   true - all in sync with server, false - some items not updated yet.\r\n\t * @type: public\r\n\t */\r\n\tgetSyncState() {\r\n\t\treturn !this.updatedRows.length;\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: set if rows should be send to server automatically\r\n\t * @param: mode - \"row\" - based on row selection changed, \"cell\" - based on cell editing finished, \"off\" - manual data sending\r\n\t * @type: public\r\n\t */\r\n\tsetUpdateMode(mode: string, dnd: any) {\r\n\t\tthis.autoUpdate = (mode === \"cell\");\r\n\t\tthis.updateMode = mode;\r\n\t\tthis.dnd = dnd;\r\n\t}\r\n\r\n\tignore(code: any, master: any) {\r\n\t\tthis._silent_mode = true;\r\n\t\tcode.call(master || global);\r\n\t\tthis._silent_mode = false;\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: mark row as updated/normal. check mandatory fields, initiate autoupdate (if turned on)\r\n\t * @param: rowId - id of row to set update-status for\r\n\t * @param: state - true for \"updated\", false for \"not updated\"\r\n\t * @param: mode - update mode name\r\n\t * @type: public\r\n\t */\r\n\tsetUpdated(rowId:number|string, state: boolean, mode?: string) {\r\n\t\tif (this._silent_mode) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst ind = this.findRow(rowId);\r\n\r\n\t\tmode = mode || \"updated\";\r\n\t\tconst existing = this.$gantt.getUserData(rowId, this.action_param, this._ganttMode);\r\n\t\tif (existing && mode === \"updated\") {\r\n\t\t\tmode = existing;\r\n\t\t}\r\n\t\tif (state) {\r\n\t\t\tthis.set_invalid(rowId, false); // clear previous error flag\r\n\t\t\tthis.updatedRows[ind] = rowId;\r\n\t\t\tthis.$gantt.setUserData(rowId, this.action_param, mode, this._ganttMode);\r\n\t\t\tif (this._in_progress[rowId]) {\r\n\t\t\t\tthis._in_progress[rowId] = \"wait\";\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (!this.is_invalid(rowId)) {\r\n\t\t\t\tthis.updatedRows.splice(ind, 1);\r\n\t\t\t\tthis.$gantt.setUserData(rowId, this.action_param, \"\", this._ganttMode);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.markRow(rowId, state, mode);\r\n\t\tif (state && this.autoUpdate) {\r\n\t\t\tthis.sendData(rowId);\r\n\t\t}\r\n\t}\r\n\r\n\tmarkRow(id: number | string, state: boolean, mode: string) {\r\n\t\tlet str = \"\";\r\n\t\tconst invalid = this.is_invalid(id);\r\n\t\tif (invalid) {\r\n\t\t\tstr = this.styles[invalid];\r\n\t\t\tstate = true;\r\n\t\t}\r\n\t\tif (this.callEvent(\"onRowMark\", [id, state, mode, invalid])) {\r\n\t\t\t// default logic\r\n\t\t\tstr = this.styles[state ? mode : \"clear\"] + \" \" + str;\r\n\r\n\t\t\tthis.$gantt[this._methods[0]](id, str);\r\n\r\n\t\t\tif (invalid && invalid.details) {\r\n\t\t\t\tstr += this.styles[invalid + \"_cell\"];\r\n\t\t\t\tfor (let i = 0; i < invalid.details.length; i++) {\r\n\t\t\t\t\tif (invalid.details[i]) {\r\n\t\t\t\t\t\tthis.$gantt[this._methods[1]](id, i, str);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetActionByState(state: string):string {\r\n\t\tif (state === \"inserted\") {\r\n\t\t\treturn \"create\";\r\n\t\t}\r\n\r\n\t\tif (state === \"updated\") {\r\n\t\t\treturn \"update\";\r\n\t\t}\r\n\r\n\t\tif (state === \"deleted\") {\r\n\t\t\treturn \"delete\";\r\n\t\t}\r\n\r\n\t\t// reorder\r\n\t\treturn \"update\";\r\n\t}\r\n\r\n\tgetState(id: number | string) {\r\n\t\treturn this.$gantt.getUserData(id, this.action_param, this._ganttMode);\r\n\t}\r\n\r\n\tis_invalid(id: number | string) {\r\n\t\treturn this._invalid[id];\r\n\t}\r\n\r\n\tset_invalid(id: number | string, mode: any, details?) {\r\n\t\tif (details) {\r\n\t\t\tmode = {\r\n\t\t\t\tvalue: mode,\r\n\t\t\t\tdetails,\r\n\t\t\t\ttoString: function() { // tslint:disable-line\r\n\t\t\t\t\treturn this.value.toString();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t\tthis._invalid[id] = mode;\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: check mandatory fields and verify values of cells, initiate update (if specified). Can be redefined in order to provide custom validation\r\n\t * @param: rowId - id of row to set update-status for\r\n\t * @type: public\r\n\t */\r\n\t// tslint:disable-next-line\r\n\tcheckBeforeUpdate(rowId: number | string) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: send row(s) values to server\r\n\t * @param: rowId - id of row which data to send. If not specified, then all \"updated\" rows will be send\r\n\t * @type: public\r\n\t */\r\n\tsendData(rowId?: any) {\r\n\t\tif (this.$gantt.editStop) {\r\n\t\t\tthis.$gantt.editStop();\r\n\t\t}\r\n\r\n\t\tif (typeof rowId === \"undefined\" || this._tSend) {\r\n\r\n\t\t\tconst pendingUpdateModes = [];\r\n\t\t\tif(this.modes){\r\n\t\t\t\tconst knownModes = [\"task\", \"link\", \"assignment\", \"baseline\"];\r\n\t\t\t\tknownModes.forEach((mode) => {\r\n\t\t\t\t\tif(this.modes[mode] && this.modes[mode].updatedRows.length){\r\n\t\t\t\t\t\tpendingUpdateModes.push(mode);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (pendingUpdateModes.length){\r\n\t\t\t\tfor(let i = 0; i < pendingUpdateModes.length; i++){\r\n\t\t\t\t\tthis.setGanttMode(pendingUpdateModes[i]);\r\n\t\t\t\t\tthis.sendAllData();\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t} else {\r\n\t\t\t\treturn this.sendAllData();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._in_progress[rowId]) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tthis.messages = [];\r\n\t\tif (!this.checkBeforeUpdate(rowId) && this.callEvent(\"onValidationError\", [rowId, this.messages])) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tthis._beforeSendData(this._getRowData(rowId), rowId);\r\n\t}\r\n\r\n\tserialize(data: any, id: any) {\r\n\t\tif (this._serializeAsJson) {\r\n\t\t\treturn  this._serializeAsJSON(data);\r\n\t\t}\r\n\r\n\t\tif (typeof data === \"string\") {\r\n\t\t\treturn data;\r\n\t\t}\r\n\t\tif (typeof id !== \"undefined\") {\r\n\t\t\treturn this.serialize_one(data, \"\");\r\n\t\t} else {\r\n\t\t\tconst stack = [];\r\n\t\t\tconst keys = [];\r\n\t\t\tfor (const key in data) {\r\n\t\t\t\tif (data.hasOwnProperty(key)) {\r\n\t\t\t\t\tstack.push(this.serialize_one(data[key], key + this._postDelim));\r\n\t\t\t\t\tkeys.push(key);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tstack.push(\"ids=\" + this.escape(keys.join(\",\")));\r\n\t\t\tif (this.$gantt.security_key) {\r\n\t\t\t\tstack.push(\"dhx_security=\" + this.$gantt.security_key);\r\n\t\t\t}\r\n\t\t\treturn stack.join(\"&\");\r\n\t\t}\r\n\t}\r\n\r\n\tserialize_one(data: any, pref: string) {\r\n\t\tif (typeof data === \"string\") {\r\n\t\t\treturn data;\r\n\t\t}\r\n\t\tconst stack: string[] = [];\r\n\t\tlet serialized = \"\";\r\n\t\tfor (const key in data)\r\n\t\t\tif (data.hasOwnProperty(key)) {\r\n\t\t\t\tif ((key === \"id\" ||\r\n\t\t\t\t\tkey == this.action_param) && // tslint:disable-line\r\n\t\t\t\t\tthis._tMode === \"REST\") {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (typeof data[key] === \"string\" || typeof data[key] === \"number\") {\r\n\t\t\t\t\tserialized = String(data[key]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tserialized = JSON.stringify(data[key]);\r\n\t\t\t\t}\r\n\t\t\t\tstack.push(this.escape((pref || \"\") + key) + \"=\" + this.escape(serialized));\r\n\t\t\t}\r\n\t\treturn stack.join(\"&\");\r\n\t}\r\n\r\n\tsendAllData() {\r\n\t\tif (!this.updatedRows.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.messages = [];\r\n\t\tlet valid: any = true;\r\n\r\n\t\tthis._forEachUpdatedRow(function(rowId) {\r\n\t\t\tvalid = valid && this.checkBeforeUpdate(rowId);\r\n\t\t});\r\n\r\n\t\tif (!valid && !this.callEvent(\"onValidationError\", [\"\", this.messages])) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (this._tSend) {\r\n\t\t\tthis._sendData(this._getAllData());\r\n\t\t} else {\r\n\t\t\t// this.updatedRows can be spliced from onBeforeUpdate via dp.setUpdated false\r\n\t\t\t// use an iterator instead of for(var i = 0; i < this.updatedRows; i++) then\r\n\t\t\tthis._forEachUpdatedRow(function(rowId) {\r\n\t\t\t\tif (!this._in_progress[rowId]) {\r\n\t\t\t\t\tif (this.is_invalid(rowId)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._beforeSendData(this._getRowData(rowId), rowId);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tfindRow(pattern: any) {\r\n\t\tlet i = 0;\r\n\t\tfor (i = 0; i < this.updatedRows.length; i++) {\r\n\t\t\tif (pattern == this.updatedRows[i]) { // tslint:disable-line\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn i;\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: define custom actions\r\n\t * @param: name - name of action, same as value of action attribute\r\n\t * @param: handler - custom function, which receives a XMl response content for action\r\n\t * @type: private\r\n\t */\r\n\tdefineAction(name: string, handler: any) {\r\n\t\tif (!this._uActions) {\r\n\t\t\tthis._uActions = {};\r\n\t\t}\r\n\t\tthis._uActions[name] = handler;\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: used in combination with setOnBeforeUpdateHandler to create custom client-server transport system\r\n\t * @param: sid - id of item before update\r\n\t * @param: tid - id of item after up0ate\r\n\t * @param: action - action name\r\n\t * @type: public\r\n\t * @topic: 0\r\n\t */\r\n\tafterUpdateCallback(sid: number | string, tid: number | string, action: string, btag: any, ganttMode: string) {\r\n\t\tif(!this.$gantt){\r\n\t\t\t// destructor has been called before the callback\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.setGanttMode(ganttMode);\r\n\r\n\t\tconst marker = sid;\r\n\t\tconst correct = (action !== \"error\" && action !== \"invalid\");\r\n\t\tif (!correct) {\r\n\t\t\tthis.set_invalid(sid, action);\r\n\t\t}\r\n\t\tif ((this._uActions) && (this._uActions[action]) && (!this._uActions[action](btag))) {\r\n\t\t\treturn (delete this._in_progress[marker]);\r\n\t\t}\r\n\r\n\t\tif (this._in_progress[marker] !== \"wait\") {\r\n\t\t\tthis.setUpdated(sid, false);\r\n\t\t}\r\n\r\n\t\tconst originalSid = sid;\r\n\r\n\t\tswitch (action) {\r\n\t\t\tcase \"inserted\":\r\n\t\t\tcase \"insert\":\r\n\t\t\t\tif (tid != sid) { // tslint:disable-line\r\n\t\t\t\t\tthis.setUpdated(sid, false);\r\n\t\t\t\t\tthis.$gantt[this._methods[2]](sid, tid);\r\n\t\t\t\t\tsid = tid;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"delete\":\r\n\t\t\tcase \"deleted\":\r\n\t\t\t\tif(!this.deleteAfterConfirmation || this._ganttMode !== \"task\"){\r\n\t\t\t\t\tthis.$gantt.setUserData(sid, this.action_param, \"true_deleted\", this._ganttMode);\r\n\t\t\t\t\tthis.$gantt[this._methods[3]](sid);\r\n\t\t\t\t\tdelete this._in_progress[marker];\r\n\t\t\t\t\treturn this.callEvent(\"onAfterUpdate\", [sid, action, tid, btag]);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif (this._ganttMode === \"task\" && this.$gantt.isTaskExists(sid)) {\r\n\t\t\t\t\t\tthis.$gantt.setUserData(sid, this.action_param, \"true_deleted\", this._ganttMode);\r\n\t\t\t\t\t\tconst task = this.$gantt.getTask(sid);\r\n\t\t\t\t\t\tthis.$gantt.silent(() => {\r\n\t\t\t\t\t\t\tthis.$gantt.deleteTask(sid);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tthis.$gantt.callEvent(\"onAfterTaskDelete\", [sid, task]);\r\n\t\t\t\t\t\tthis.$gantt.render();\r\n\t\t\t\t\t\tdelete this._in_progress[marker];\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn this.callEvent(\"onAfterUpdate\", [sid, action, tid, btag]);\r\n\t\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (this._in_progress[marker] !== \"wait\") {\r\n\t\t\tif (correct) {\r\n\t\t\t\tthis.$gantt.setUserData(sid, this.action_param, \"\", this._ganttMode);\r\n\t\t\t}\r\n\t\t\tdelete this._in_progress[marker];\r\n\t\t} else {\r\n\t\t\tdelete this._in_progress[marker];\r\n\t\t\tthis.setUpdated(tid, true, this.$gantt.getUserData(sid, this.action_param, this._ganttMode));\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onAfterUpdate\", [originalSid, action, tid, btag]);\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: response from server\r\n\t * @param: xml - XMLLoader object with response XML\r\n\t * @type: private\r\n\t */\r\n\tafterUpdate(that: any, xml: any, id?:any) {\r\n\t\tlet _xml;\r\n\t\tif (arguments.length === 3) {\r\n\t\t\t_xml = arguments[1];\r\n\t\t} else {\r\n\t\t\t// old dataprocessor\r\n\t\t\t_xml = arguments[4];\r\n\t\t}\r\n\t\tlet mode = this.getGanttMode();\r\n\t\tconst reqUrl = _xml.filePath || _xml.url;\r\n\r\n\t\tif (this._tMode !== \"REST\" && this._tMode !== \"REST-JSON\") {\r\n\t\t\tif (reqUrl.indexOf(\"gantt_mode=links\") !== -1) {\r\n\t\t\t\tmode = \"link\";\r\n\t\t\t} else if (reqUrl.indexOf(\"gantt_mode=assignments\") !== -1) {\r\n\t\t\t\tmode = \"assignment\";\r\n\t\t\t} else if (reqUrl.indexOf(\"gantt_mode=baselines\") !== -1) {\r\n\t\t\t\tmode = \"baseline\";\r\n\t\t\t} else {\r\n\t\t\t\tmode = \"task\";\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (reqUrl.indexOf(\"/link\") >= 0) {\r\n\t\t\t\tmode = \"link\";\r\n\t\t\t} else if(reqUrl.indexOf(\"/assignment\") >= 0){\r\n\t\t\t\tmode = \"assignment\";\r\n\t\t\t} else if(reqUrl.indexOf(\"/baseline\") >= 0){\r\n\t\t\t\tmode = \"baseline\";\r\n\t\t\t} else {\r\n\t\t\t\tmode = \"task\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.setGanttMode(mode);\r\n\r\n\t\tconst ajax = this.$gantt.ajax;\r\n\t\t// try to use json first\r\n\t\tlet tag;\r\n\r\n\t\ttry {\r\n\t\t\ttag = JSON.parse(xml.xmlDoc.responseText);\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\t} catch (e) {\r\n\r\n\t\t\t// empty response also can be processed by json handler\r\n\t\t\tif (!xml.xmlDoc.responseText.length) {\r\n\t\t\t\ttag = {};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst processCallback = (itemId: any) => {\r\n\t\t\tconst action = tag.action || this.getState(itemId) || \"updated\";\r\n\t\t\tconst sid = tag.sid || itemId[0];\r\n\t\t\tconst tid = tag.tid || itemId[0];\r\n\t\t\tthat.afterUpdateCallback(sid, tid, action, tag, mode);\r\n\t\t};\r\n\t\tif (tag) {\r\n\t\t\t// GS-753. When multiple tasks are updated, unhighlight all of them\r\n\t\t\tif (Array.isArray(id) && id.length > 1) {\r\n\t\t\t\tid.forEach((taskId) => processCallback(taskId));\r\n\t\t\t} else {\r\n\t\t\t\tprocessCallback(id);\r\n\t\t\t}\r\n\t\t\tthat.finalizeUpdate();\r\n\t\t\tthis.setGanttMode(mode);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// xml response\r\n\t\tconst top = ajax.xmltop(\"data\", xml.xmlDoc); // fix incorrect content type in IE\r\n\t\tif (!top) {\r\n\t\t\treturn this.cleanUpdate(id);\r\n\t\t}\r\n\t\tconst atag = ajax.xpath(\"//data/action\", top);\r\n\t\tif (!atag.length) {\r\n\t\t\treturn this.cleanUpdate(id);\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < atag.length; i++) {\r\n\t\t\tconst btag = atag[i];\r\n\t\t\tconst action = btag.getAttribute(\"type\");\r\n\t\t\tconst sid = btag.getAttribute(\"sid\");\r\n\t\t\tconst tid = btag.getAttribute(\"tid\");\r\n\r\n\t\t\tthat.afterUpdateCallback(sid, tid, action, btag, mode);\r\n\t\t}\r\n\t\tthat.finalizeUpdate();\r\n\t}\r\n\r\n\tcleanUpdate(id: any[]) {\r\n\t\tif (id) {\r\n\t\t\tfor (let i = 0; i < id.length; i++) {\r\n\t\t\t\tdelete this._in_progress[id[i]];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfinalizeUpdate() {\r\n\t\tif (this._waitMode) {\r\n\t\t\tthis._waitMode--;\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onAfterUpdateFinish\", []);\r\n\t\tif (!this.updatedRows.length) {\r\n\t\t\tthis.callEvent(\"onFullSync\", []);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: initializes data-processor\r\n\t * @param: gantt - dhtmlxGantt object to attach this data-processor to\r\n\t * @type: public\r\n\t */\r\n\tinit(gantt: any) {\r\n\t\tif (this._initialized) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.$gantt = gantt;\r\n\t\tif (this.$gantt._dp_init) {\r\n\t\t\tthis.$gantt._dp_init(this);\r\n\t\t}\r\n\r\n\t\tthis._setDefaultTransactionMode();\r\n\r\n\t\tthis.styles = {\r\n\t\t\tupdated:\"gantt_updated\",\r\n\t\t\torder:\"gantt_updated\",\r\n\t\t\tinserted:\"gantt_inserted\",\r\n\t\t\tdeleted:\"gantt_deleted\",\r\n\t\t\tdelete_confirmation:\"gantt_deleted\",\r\n\t\t\tinvalid:\"gantt_invalid\",\r\n\t\t\terror:\"gantt_error\",\r\n\t\t\tclear:\"\"\r\n\t\t};\r\n\r\n\t\tthis._methods=[\"_row_style\",\"setCellTextStyle\",\"_change_id\",\"_delete_task\"];\r\n\t\textendGantt(this.$gantt, this);\r\n\t\tconst dataProcessorEvents = new DataProcessorEvents(this.$gantt, this);\r\n\t\tdataProcessorEvents.attach();\r\n\t\tthis.attachEvent(\"onDestroy\", function() {\r\n\t\t\tdelete this.setGanttMode;\r\n\t\t\tdelete this._getRowData;\r\n\r\n\t\t\tdelete this.$gantt._dp;\r\n\t\t\tdelete this.$gantt._change_id;\r\n\t\t\tdelete this.$gantt._row_style;\r\n\t\t\tdelete this.$gantt._delete_task;\r\n\t\t\tdelete this.$gantt._sendTaskOrder;\r\n\t\t\tdelete this.$gantt;\r\n\r\n\t\t\tdataProcessorEvents.detach();\r\n\t\t});\r\n\t\tthis.$gantt.callEvent(\"onDataProcessorReady\", [this]);\r\n\t\tthis._initialized = true;\r\n\t}\r\n\r\n\tsetOnAfterUpdate(handler) {\r\n\t\tthis.attachEvent(\"onAfterUpdate\", handler);\r\n\t}\r\n\r\n\tsetOnBeforeUpdateHandler(handler) {\r\n\t\tthis.attachEvent(\"onBeforeDataSending\", handler);\r\n\t}\r\n\r\n\t/* starts autoupdate mode\r\n\t\t@param interval time interval for sending update requests\r\n\t*/\r\n\tsetAutoUpdate(interval, user) {\r\n\t\tinterval = interval || 2000;\r\n\r\n\t\tthis._user = user || (new Date()).valueOf();\r\n\t\tthis._needUpdate = false;\r\n\r\n\t\tthis._updateBusy = false;\r\n\r\n\t\tthis.attachEvent(\"onAfterUpdate\", this.afterAutoUpdate); // arguments sid, action, tid, xml_node;\r\n\r\n\t\tthis.attachEvent(\"onFullSync\", this.fullSync);\r\n\r\n\t\tsetInterval(() => {\r\n\t\t\tthis.loadUpdate();\r\n\t\t}, interval);\r\n\t}\r\n\r\n\t/* process updating request response\r\n\t\tif status == collision version is deprecated\r\n\t\tset flag for autoupdating immediately\r\n\t*/\r\n\tafterAutoUpdate(sid, action, tid, xml_node) { // tslint:disable-line\r\n\t\tif (action === \"collision\") {\r\n\t\t\tthis._needUpdate = true;\r\n\t\t\treturn false;\r\n\t\t} else {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\t/* callback function for onFillSync event\r\n\t\tcall update function if it's need\r\n\t*/\r\n\tfullSync() {\r\n\t\tif (this._needUpdate) {\r\n\t\t\tthis._needUpdate = false;\r\n\t\t\tthis.loadUpdate();\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/* sends query to the server and call callback function\r\n\t*/\r\n\tgetUpdates(url, callback) {\r\n\t\tconst ajax = this.$gantt.ajax;\r\n\t\tif (this._updateBusy) {\r\n\t\t\treturn false;\r\n\t\t} else {\r\n\t\t\tthis._updateBusy = true;\r\n\t\t}\r\n\r\n\t\tajax.get(url, callback);\r\n\r\n\t}\r\n\r\n\t/* loads updates and processes them\r\n\t*/\r\n\tloadUpdate() {\r\n\t\tconst ajax = this.$gantt.ajax;\r\n\t\tconst version = this.$gantt.getUserData(0, \"version\", this._ganttMode);\r\n\t\tlet url = this.serverProcessor + ajax.urlSeparator(this.serverProcessor) + [\"dhx_user=\" + this._user, \"dhx_version=\" + version].join(\"&\");\r\n\t\turl = url.replace(\"editing=true&\", \"\");\r\n\t\tthis.getUpdates(url, (xml) => {\r\n\t\t\tconst vers = ajax.xpath(\"//userdata\", xml);\r\n\t\t\tthis.$gantt.setUserData(0, \"version\", this._getXmlNodeValue(vers[0]), this._ganttMode);\r\n\r\n\t\t\tconst updates = ajax.xpath(\"//update\", xml);\r\n\t\t\tif (updates.length) {\r\n\t\t\t\tthis._silent_mode = true;\r\n\r\n\t\t\t\tfor (let i = 0; i < updates.length; i++) {\r\n\t\t\t\t\tconst status = updates[i].getAttribute(\"status\");\r\n\t\t\t\t\tconst id = updates[i].getAttribute(\"id\");\r\n\t\t\t\t\tconst parent = updates[i].getAttribute(\"parent\");\r\n\t\t\t\t\tswitch (status) {\r\n\t\t\t\t\t\tcase \"inserted\":\r\n\t\t\t\t\t\t\tthis.callEvent(\"insertCallback\", [updates[i], id, parent]);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"updated\":\r\n\t\t\t\t\t\t\tthis.callEvent(\"updateCallback\", [updates[i], id, parent]);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"deleted\":\r\n\t\t\t\t\t\t\tthis.callEvent(\"deleteCallback\", [updates[i], id, parent]);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._silent_mode = false;\r\n\t\t\t}\r\n\r\n\t\t\tthis._updateBusy = false;\r\n\t\t});\r\n\t}\r\n\r\n\tdestructor() {\r\n\t\tthis.callEvent(\"onDestroy\", []);\r\n\t\tthis.detachAllEvents();\r\n\r\n\t\tthis.updatedRows = [];\r\n\t\tthis._in_progress = {}; // ?\r\n\t\tthis._invalid = {};\r\n\t\tthis._storage.clear();\r\n\t\tthis._storage = null;\r\n\t\tthis._headers = null;\r\n\t\tthis._payload = null;\r\n\t\tdelete this._initialized;\r\n\t}\r\n\r\n\tsetGanttMode(mode) {\r\n\t\tif (mode === \"tasks\") {\r\n\t\t\tmode = \"task\";\r\n\t\t} else if (mode === \"links\") {\r\n\t\t\tmode = \"link\";\r\n\t\t}\r\n\r\n\t\tconst modes = this.modes || {};\r\n\t\tconst ganttMode = this.getGanttMode();\r\n\t\tif (ganttMode) {\r\n\t\t\tmodes[ganttMode] = {\r\n\t\t\t\t_in_progress : this._in_progress,\r\n\t\t\t\t_invalid: this._invalid,\r\n\t\t\t\t_storage: this._storage,\r\n\t\t\t\tupdatedRows : this.updatedRows\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tlet newState = modes[mode];\r\n\t\tif (!newState) {\r\n\t\t\tnewState = modes[mode] = {\r\n\t\t\t\t_in_progress : {},\r\n\t\t\t\t_invalid : {},\r\n\t\t\t\t_storage : SimpleStorage.create(),\r\n\t\t\t\tupdatedRows : []\r\n\t\t\t};\r\n\t\t}\r\n\t\tthis._in_progress = newState._in_progress;\r\n\t\tthis._invalid = newState._invalid;\r\n\t\tthis._storage = newState._storage;\r\n\t\tthis.updatedRows = newState.updatedRows;\r\n\t\tthis.modes = modes;\r\n\t\tthis._ganttMode = mode;\r\n\t}\r\n\tgetGanttMode():string {\r\n\t\treturn this._ganttMode;\r\n\t}\r\n\r\n\tstoreItem(item) {\r\n\t\tthis._storage.storeItem(item);\r\n\t}\r\n\r\n\turl(url: string) {\r\n\t\tthis.serverProcessor = this._serverProcessor = url;\r\n\t}\r\n\r\n\tprotected _beforeSendData(data: any, rowId: any) {\r\n\t\tif (!this.callEvent(\"onBeforeUpdate\", [rowId, this.getState(rowId), data])) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tthis._sendData(data, rowId);\r\n\t}\r\n\r\n\tprotected _serializeAsJSON(data: any) {\r\n\t\tif (typeof data === \"string\") {\r\n\t\t\treturn data;\r\n\t\t}\r\n\r\n\t\tconst copy = utils.copy(data);\r\n\t\tif (this._tMode === \"REST-JSON\") {\r\n\t\t\tdelete copy.id;\r\n\t\t\tdelete copy[this.action_param];\r\n\t\t}\r\n\r\n\t\treturn JSON.stringify(copy);\r\n\t}\r\n\r\n\tprotected _applyPayload(url: string) {\r\n\t\tconst ajax = this.$gantt.ajax;\r\n\t\tif (this._payload) {\r\n\t\t\tfor (const key in this._payload) {\r\n\t\t\t\turl = url + ajax.urlSeparator(url) + this.escape(key) + \"=\" + this.escape(this._payload[key]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn url;\r\n\t}\r\n\r\n\t// GET/POST/JSON modes of the dataProcessor didn't send the whole data items in 'delete' requests\r\n\t// clear extra info from the data in order not to change the request format\r\n\tprotected _cleanupArgumentsBeforeSend(dataToSend: any) {\r\n\t\tlet processedData;\r\n\t\tif(dataToSend[this.action_param] === undefined){// hash of updated items, and not an individual item\r\n\t\t\tprocessedData = {};\r\n\t\t\tfor(const i in dataToSend) {\r\n\t\t\t\tprocessedData[i] = this._cleanupArgumentsBeforeSend(dataToSend[i]);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tprocessedData = this._cleanupItemBeforeSend(dataToSend);\r\n\t\t}\r\n\t\treturn processedData;\r\n\t}\r\n\tprotected _cleanupItemBeforeSend(updatedItem: any) {\r\n\t\tlet output = null;\r\n\t\tif(updatedItem){\r\n\t\t\tif(updatedItem[this.action_param] === \"deleted\"){\r\n\t\t\t\toutput = {};\r\n\t\t\t\toutput.id = updatedItem.id;\r\n\t\t\t\toutput[this.action_param] = updatedItem[this.action_param];\r\n\t\t\t}else{\r\n\t\t\t\toutput = updatedItem;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn output;\r\n\t}\r\n\r\n\tprotected _sendData(dataToSend: any, rowId?: any) {\r\n\t\tif (!dataToSend) {\r\n\t\t\treturn; // nothing to send\r\n\t\t}\r\n\t\tif (!this.callEvent(\"onBeforeDataSending\", rowId ? [rowId, this.getState(rowId), dataToSend] : [null, null, dataToSend])) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (rowId) {\r\n\t\t\tthis._in_progress[rowId] = (new Date()).valueOf();\r\n\t\t}\r\n\r\n\t\tconst ajax = this.$gantt.ajax;\r\n\r\n\t\tif (this._tMode === \"CUSTOM\") {\r\n\t\t\tconst taskState = this.getState(rowId);\r\n\t\t\tconst taskAction = this.getActionByState(taskState);\r\n\t\t\tdelete dataToSend[this.action_param]; // not send !nativeeditor_status parameter in router mode\r\n\t\t\tconst ganttMode = this.getGanttMode();\r\n\t\t\tconst _onResolvedCreateUpdate = (tag) => {\r\n\t\t\t\tlet action = taskState || \"updated\";\r\n\t\t\t\tlet sid = rowId;\r\n\t\t\t\tlet tid = rowId;\r\n\r\n\t\t\t\tif (tag) {\r\n\t\t\t\t\taction = tag.action || taskState;\r\n\t\t\t\t\tsid = tag.sid || sid;\r\n\t\t\t\t\ttid = tag.id || tag.tid || tid;\r\n\t\t\t\t}\r\n\t\t\t\tthis.afterUpdateCallback(sid, tid, action, tag, ganttMode);\r\n\t\t\t};\r\n\r\n\t\t\tlet actionPromise;\r\n\t\t\tif (this._router instanceof Function) {\r\n\t\t\t\tif(this._routerParametersFormat === \"object\"){\r\n\t\t\t\t\tconst obj = {\r\n\t\t\t\t\t\tentity: ganttMode,\r\n\t\t\t\t\t\taction: taskAction,\r\n\t\t\t\t\t\tdata: dataToSend,\r\n\t\t\t\t\t\tid: rowId\r\n\t\t\t\t\t};\r\n\t\t\t\t\tactionPromise = this._router(obj);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tactionPromise = this._router(ganttMode, taskAction, dataToSend, rowId);\r\n\t\t\t\t}\r\n\t\t\t} else if (this._router[ganttMode] instanceof Function) {\r\n\t\t\t\tactionPromise = this._router[ganttMode](taskAction, dataToSend, rowId);\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconst errorMsgStart = \"Incorrect configuration of gantt.createDataProcessor\";\r\n\t\t\t\tconst errorMsgEnd = `\r\nYou need to either add missing properties to the dataProcessor router object or to use a router function.\r\nSee https://docs.dhtmlx.com/gantt/desktop__server_side.html#customrouting and https://docs.dhtmlx.com/gantt/api__gantt_createdataprocessor.html for details.`;\r\n\r\n\t\t\t\tif(!this._router[ganttMode]){\r\n\t\t\t\t\tthrow new Error(`${errorMsgStart}: router for the **${ganttMode}** entity is not defined. ${errorMsgEnd}`);\r\n\t\t\t\t}\r\n\t\t\t\tswitch (taskState) {\r\n\t\t\t\t\tcase \"inserted\":\r\n\t\t\t\t\t\tif(!this._router[ganttMode].create){\r\n\t\t\t\t\t\t\tthrow new Error(`${errorMsgStart}: **create** action for the **${ganttMode}** entity is not defined. ${errorMsgEnd}`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tactionPromise = this._router[ganttMode].create(dataToSend);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"deleted\":\r\n\t\t\t\t\t\tif(!this._router[ganttMode].delete){\r\n\t\t\t\t\t\t\tthrow new Error(`${errorMsgStart}: **delete** action for the **${ganttMode}** entity is not defined. ${errorMsgEnd}`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tactionPromise = this._router[ganttMode].delete(rowId);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tif(!this._router[ganttMode].update){\r\n\t\t\t\t\t\t\tthrow new Error(`${errorMsgStart}: **update**\" action for the **${ganttMode}** entity is not defined. ${errorMsgEnd}`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tactionPromise = this._router[ganttMode].update(dataToSend, rowId);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(actionPromise){\r\n\t\t\t\t// neither promise nor {tid: newId} response object\r\n\t\t\t\tif(!actionPromise.then &&\r\n\t\t\t\t\t(actionPromise.id === undefined && actionPromise.tid === undefined && actionPromise.action === undefined)){\r\n\t\t\t\t\tthrow new Error(\"Incorrect router return value. A Promise or a response object is expected\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(actionPromise.then){\r\n\t\t\t\t\tactionPromise.then(_onResolvedCreateUpdate).catch((error) => {\r\n\t\t\t\t\t\tif(error && error.action){\r\n\t\t\t\t\t\t\t_onResolvedCreateUpdate(error);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t_onResolvedCreateUpdate({ action: \"error\", value: error});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\t// custom method may return a response object in case of sync action\r\n\t\t\t\t\t_onResolvedCreateUpdate(actionPromise);\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\t_onResolvedCreateUpdate(null);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet queryParams: any;\r\n\t\tqueryParams = {\r\n\t\t\tcallback: (xml) => {\r\n\t\t\t\tconst ids = [];\r\n\r\n\t\t\t\tif (rowId) {\r\n\t\t\t\t\tids.push(rowId);\r\n\t\t\t\t} else if (dataToSend) {\r\n\t\t\t\t\tfor (const key in dataToSend) {\r\n\t\t\t\t\t\tids.push(key);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn this.afterUpdate(this, xml, ids);\r\n\t\t\t},\r\n\t\t\theaders: this._headers\r\n\t\t};\r\n\r\n\t\tconst dhxVersion = \"dhx_version=\" + this.$gantt.getUserData(0, \"version\", this._ganttMode);\r\n\t\tconst urlParams = this.serverProcessor + (this._user ? (ajax.urlSeparator(this.serverProcessor) + [\"dhx_user=\" + this._user, dhxVersion].join(\"&\")) : \"\");\r\n\t\tlet url: any = this._applyPayload(urlParams);\r\n\t\tlet data;\r\n\r\n\t\tswitch (this._tMode) {\r\n\t\t\tcase \"GET\":\r\n\t\t\t\tdata = this._cleanupArgumentsBeforeSend(dataToSend);\r\n\t\t\t\tqueryParams.url = url + ajax.urlSeparator(url) + this.serialize(data, rowId);\r\n\t\t\t\tqueryParams.method = \"GET\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"POST\":\r\n\t\t\t\tdata = this._cleanupArgumentsBeforeSend(dataToSend);\r\n\t\t\t\tqueryParams.url = url;\r\n\t\t\t\tqueryParams.method = \"POST\";\r\n\t\t\t\tqueryParams.data = this.serialize(data, rowId);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"JSON\":\r\n\t\t\t\tdata = {};\r\n\t\t\t\tconst preprocessedData = this._cleanupItemBeforeSend(dataToSend);\r\n\t\t\t\tfor (const key in preprocessedData) {\r\n\t\t\t\t\tif (key === this.action_param || key === \"id\" || key === \"gr_id\") {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdata[key] = preprocessedData[key];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tqueryParams.url = url;\r\n\t\t\t\tqueryParams.method = \"POST\";\r\n\t\t\t\tqueryParams.data = JSON.stringify({\r\n\t\t\t\t\tid: rowId,\r\n\t\t\t\t\taction: dataToSend[this.action_param],\r\n\t\t\t\t\tdata\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"REST\":\r\n\t\t\tcase \"REST-JSON\":\r\n\t\t\t\turl = urlParams.replace(/(&|\\?)editing=true/, \"\");\r\n\t\t\t\tdata = \"\";\r\n\r\n\t\t\t\tswitch (this.getState(rowId)) {\r\n\t\t\t\t\tcase \"inserted\":\r\n\t\t\t\t\t\tqueryParams.method = \"POST\";\r\n\t\t\t\t\t\tqueryParams.data = this.serialize(dataToSend, rowId);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"deleted\":\r\n\t\t\t\t\t\tqueryParams.method = \"DELETE\";\r\n\t\t\t\t\t\turl = url + (url.slice(-1) === \"/\" ? \"\" : \"/\") + rowId;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tqueryParams.method = \"PUT\";\r\n\t\t\t\t\t\tqueryParams.data = this.serialize(dataToSend, rowId);\r\n\t\t\t\t\t\turl = url + (url.slice(-1) === \"/\" ? \"\" : \"/\") + rowId;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tqueryParams.url = this._applyPayload(url);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tthis._waitMode++;\r\n\t\treturn ajax.query(queryParams);\r\n\t}\r\n\r\n\tprotected _forEachUpdatedRow(code: any) {\r\n\t\tconst updatedRows = this.updatedRows.slice();\r\n\t\tfor (let i = 0; i < updatedRows.length; i++) {\r\n\t\t\tconst rowId = updatedRows[i];\r\n\t\t\tif (this.$gantt.getUserData(rowId, this.action_param, this._ganttMode)) {\r\n\t\t\t\tcode.call(this, rowId);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _setDefaultTransactionMode() {\r\n\t\tif (this.serverProcessor) {\r\n\t\t\tthis.setTransactionMode(\"POST\", true);\r\n\t\t\tthis.serverProcessor += (this.serverProcessor.indexOf(\"?\") !== -1 ? \"&\" : \"?\") + \"editing=true\";\r\n\t\t\tthis._serverProcessor = this.serverProcessor;\r\n\t\t}\r\n\t}\r\n\r\n\t/* returns xml node value\r\n\t\t@param node\r\n\t\t\txml node\r\n\t*/\r\n\tprotected _getXmlNodeValue(node) {\r\n\t\tif (node.firstChild) {\r\n\t\t\treturn node.firstChild.nodeValue;\r\n\t\t}\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tprotected _getAllData() {\r\n\t\tconst out = {};\r\n\t\tlet hasOne = false;\r\n\r\n\t\tthis._forEachUpdatedRow(function(id) {\r\n\t\t\tif (this._in_progress[id] || this.is_invalid(id)){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst row = this._getRowData(id);\r\n\t\t\tif (!this.callEvent(\"onBeforeUpdate\", [id, this.getState(id), row])) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tout[id] = row;\r\n\t\t\thasOne = true;\r\n\t\t\tthis._in_progress[id] = (new Date()).valueOf();\r\n\t\t});\r\n\r\n\t\treturn hasOne ? out : null;\r\n\t}\r\n\r\n\tprotected _prepareDate(value: Date) : string {\r\n\t\treturn this.$gantt.defined(this.$gantt.templates.xml_format) ? this.$gantt.templates.xml_format(value) : this.$gantt.templates.format_date(value);\r\n\t}\r\n\r\n\tprotected _prepareArray(value: any[], traversedObjects: object[]) : any[] {\r\n\t\ttraversedObjects.push(value);\r\n\r\n\t\treturn value.map((item) => {\r\n\t\t\tif(helpers.isDate(item)){\r\n\t\t\t\treturn this._prepareDate(item);\r\n\t\t\t} else if (Array.isArray(item) && !helpers.arrayIncludes(traversedObjects, item)){\r\n\t\t\t\treturn this._prepareArray(item, traversedObjects);\r\n\t\t\t} else if (item && typeof item === \"object\" && !helpers.arrayIncludes(traversedObjects, item)) {\r\n\t\t\t\treturn this._prepareObject(item, traversedObjects);\r\n\t\t\t} else {\r\n\t\t\t\treturn item;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected _prepareObject(rawItem: any, traversedObjects: object[]) : any {\r\n\t\tconst processedItem = {};\r\n\t\ttraversedObjects.push(rawItem);\r\n\r\n\t\tfor (const key in rawItem) {\r\n\t\t\tif (key.substr(0, 1) === \"$\") {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tconst value = rawItem[key];\r\n\t\t\tif (helpers.isDate(value)) {\r\n\t\t\t\tprocessedItem[key] = this._prepareDate(value);\r\n\t\t\t} else if(value === null) {\r\n\t\t\t\tprocessedItem[key] = \"\";\r\n\t\t\t} else if (Array.isArray(value) && !helpers.arrayIncludes(traversedObjects, value)){\r\n\t\t\t\tprocessedItem[key] = this._prepareArray(value, traversedObjects);\r\n\t\t\t} else if (value && typeof value === \"object\" && !helpers.arrayIncludes(traversedObjects, value)) {\r\n\t\t\t\tprocessedItem[key] = this._prepareObject(value, traversedObjects);\r\n\t\t\t} else {\r\n\t\t\t\tprocessedItem[key] = value;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn processedItem;\r\n\t}\r\n\r\n\tprotected _prepareDataItem(rawItem: any): any {\r\n\t\tconst processedItem = this._prepareObject(rawItem, []);\r\n\r\n\t\tprocessedItem[this.action_param] = this.$gantt.getUserData(rawItem.id, this.action_param, this._ganttMode);\r\n\t\treturn processedItem;\r\n\t}\r\n\r\n\tprotected getStoredItem(id){\r\n\t\treturn this._storage.getStoredItem(id);\r\n\t}\r\n\r\n\tprotected _getRowData(id) {\r\n\t\tlet dataItem;\r\n\t\tconst gantt = this.$gantt;\r\n\t\tif (this.getGanttMode() === \"task\") {\r\n\t\t\tif(gantt.isTaskExists(id)){\r\n\t\t\t\tdataItem =this.$gantt.getTask(id);\r\n\t\t\t}\r\n\t\t} else if (this.getGanttMode() === \"assignment\") {\r\n\t\t\tif(this.$gantt.$data.assignmentsStore.exists(id)){\r\n\t\t\t\tdataItem =this.$gantt.$data.assignmentsStore.getItem(id);\r\n\t\t\t}\r\n\t\t} else if (this.getGanttMode() === \"baseline\") {\r\n\t\t\tif(this.$gantt.$data.baselineStore.exists(id)){\r\n\t\t\t\tdataItem =this.$gantt.$data.baselineStore.getItem(id);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(gantt.isLinkExists(id)){\r\n\t\t\t\tdataItem =this.$gantt.getLink(id);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!dataItem) {\r\n\t\t\tdataItem = this.getStoredItem(id);\r\n\t\t}\r\n\r\n\t\tif (!dataItem) {\r\n\t\t\tdataItem = { id };\r\n\t\t}\r\n\r\n\t\treturn this._prepareDataItem(dataItem);\r\n\t}\r\n}","\r\nexport default function extendGantt(gantt: any, dp: any) {\r\n\tgantt.getUserData = function(id, name, store) {\r\n\t\tif (!this.userdata) {\r\n\t\t\tthis.userdata = {};\r\n\t\t}\r\n\t\tthis.userdata[store] = this.userdata[store] || {};\r\n\t\tif (this.userdata[store][id] && this.userdata[store][id][name]) {\r\n\t\t\treturn this.userdata[store][id][name];\r\n\t\t}\r\n\t\treturn \"\";\r\n\t};\r\n\tgantt.setUserData = function(id, name, value, store) {\r\n\t\tif (!this.userdata) {\r\n\t\t\tthis.userdata = {};\r\n\t\t}\r\n\t\tthis.userdata[store] = this.userdata[store] || {};\r\n\t\tthis.userdata[store][id] = this.userdata[store][id] || {};\r\n\t\tthis.userdata[store][id][name] = value;\r\n\t};\r\n\r\n\tgantt._change_id = function(oldId, newId) {\r\n\t\tswitch (this._dp._ganttMode) {\r\n\t\t\tcase \"task\":\r\n\t\t\t\tthis.changeTaskId(oldId, newId);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"link\":\r\n\t\t\t\tthis.changeLinkId(oldId, newId);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"assignment\":\r\n\t\t\t\tthis.$data.assignmentsStore.changeId(oldId, newId);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"resource\":\r\n\t\t\t\tthis.$data.resourcesStore.changeId(oldId, newId);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"baseline\":\r\n\t\t\t\tthis.$data.baselineStore.changeId(oldId, newId);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(`Invalid mode of the dataProcessor after database id is received: ${this._dp._ganttMode}, new id: ${newId}`);\r\n\t\t}\r\n\t};\r\n\r\n\tgantt._row_style = function(rowId, classname){\r\n\t\tif (this._dp._ganttMode !== \"task\") {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!gantt.isTaskExists(rowId)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst task = gantt.getTask(rowId);\r\n\t\ttask.$dataprocessor_class = classname;\r\n\t\tgantt.refreshTask(rowId);\r\n\t};\r\n\r\n\t// fake method for dataprocessor\r\n\tgantt._delete_task = function(rowId, node) {}; // tslint:disable-line\r\n\r\n\tgantt._sendTaskOrder = function(id, item){\r\n\t\tif (item.$drop_target) {\r\n\t\t\tthis._dp.setGanttMode(\"task\");\r\n\t\t\tthis.getTask(id).target = item.$drop_target;\r\n\t\t\tthis._dp.setUpdated(id, true,\"order\");\r\n\t\t\tdelete this.getTask(id).$drop_target;\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.setDp = function() {\r\n\t\tthis._dp = dp;\r\n\t};\r\n\r\n\tgantt.setDp();\r\n}","import * as DataProcessor from \"./data_processor\";\r\nexport default {\r\n\tDEPRECATED_api: function(server) {\r\n\t\treturn new (DataProcessor.DataProcessor)(server);\r\n\t},\r\n\tcreateDataProcessor: DataProcessor.createDataProcessor\r\n};","import global from \"../../utils/global\";\r\n\r\nfunction createMethod(gantt){\r\n\tvar methods = {};\r\n\tvar isActive = false;\r\n\tfunction disableMethod(methodName, dummyMethod){\r\n\t\tdummyMethod = typeof dummyMethod == \"function\" ? dummyMethod : function(){};\r\n\r\n\t\tif(!methods[methodName]){\r\n\t\t\tmethods[methodName] = this[methodName];\r\n\t\t\tthis[methodName] = dummyMethod;\r\n\t\t}\r\n\t}\r\n\tfunction restoreMethod(methodName){\r\n\t\tif(methods[methodName]){\r\n\t\t\tthis[methodName] = methods[methodName];\r\n\t\t\tmethods[methodName] = null;\r\n\t\t}\r\n\t}\r\n\tfunction disableMethods(methodsHash){\r\n\t\tfor(var i in methodsHash){\r\n\t\t\tdisableMethod.call(this, i, methodsHash[i]);\r\n\t\t}\r\n\t}\r\n\tfunction restoreMethods(){\r\n\t\tfor(var i in methods){\r\n\t\t\trestoreMethod.call(this, i);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction batchUpdatePayload(callback){\r\n\t\ttry{\r\n\t\t\tcallback();\r\n\t\t}catch(e){\r\n\t\t\tglobal.console.error(e);\r\n\t\t}\r\n\t}\r\n\r\n\tvar state = gantt.$services.getService(\"state\");\r\n\tstate.registerProvider(\"batchUpdate\", function(){\r\n\t\treturn {\r\n\t\t\tbatch_update: isActive\r\n\t\t};\r\n\t}, false);\r\n\r\n\treturn function batchUpdate(callback, noRedraw) {\r\n\t\tif(isActive){\r\n\t\t\t// batch mode is already active\r\n\t\t\tbatchUpdatePayload(callback);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar call_dp = (this._dp && this._dp.updateMode != \"off\");\r\n\t\tvar dp_mode;\r\n\t\tif (call_dp){\r\n\t\t\tdp_mode = this._dp.updateMode;\r\n\t\t\tthis._dp.setUpdateMode(\"off\");\r\n\t\t}\r\n\r\n\t\t// temporary disable some methods while updating multiple tasks\r\n\t\tvar resetProjects = {};\r\n\t\tvar methods = {\r\n\t\t\t\"render\":true,\r\n\t\t\t\"refreshData\":true,\r\n\t\t\t\"refreshTask\":true,\r\n\t\t\t\"refreshLink\":true,\r\n\t\t\t\"resetProjectDates\":function(task){\r\n\t\t\t\tresetProjects[task.id] = task;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tdisableMethods.call(this, methods);\r\n\r\n\t\tisActive = true;\r\n\t\tthis.callEvent(\"onBeforeBatchUpdate\", []);\r\n\r\n\t\tbatchUpdatePayload(callback);\r\n\r\n\t\tthis.callEvent(\"onAfterBatchUpdate\", []);\r\n\r\n\t\trestoreMethods.call(this);\r\n\r\n\t\t// do required updates after changes applied\r\n\t\tfor(var i in resetProjects){\r\n\t\t\tthis.resetProjectDates(resetProjects[i]);\r\n\t\t}\r\n\r\n\t\tisActive = false;\r\n\r\n\t\tif(!noRedraw){\r\n\t\t\tthis.render();\r\n\t\t}\r\n\r\n\t\tif (call_dp) {\r\n\t\t\tthis._dp.setUpdateMode(dp_mode);\r\n\t\t\tthis._dp.setGanttMode(\"task\");\r\n\t\t\tthis._dp.sendData();\r\n\t\t\tthis._dp.setGanttMode(\"link\");\r\n\t\t\tthis._dp.sendData();\r\n\t\t}\r\n\t};\r\n\r\n\r\n\r\n}\r\n\r\nexport default function(gantt){\r\n\tgantt.batchUpdate = createMethod(gantt);\r\n};","const createWbs = (function(gantt){\r\n\treturn {\r\n\t_needRecalc: true,\r\n\treset: function(){\r\n\t\tthis._needRecalc = true;\r\n\t},\r\n\t_isRecalcNeeded: function(){\r\n\t\treturn (!this._isGroupSort() && this._needRecalc);\r\n\t},\r\n\t_isGroupSort: function() {\r\n\t\treturn !!(gantt.getState().group_mode);\r\n\t},\r\n\t_getWBSCode: function(task) {\r\n\t\tif(!task) return \"\";\r\n\r\n\t\tif(this._isRecalcNeeded()){\r\n\t\t\tthis._calcWBS();\r\n\t\t}\r\n\r\n\t\tif(task.$virtual) return \"\";\r\n\t\tif(this._isGroupSort()) return task.$wbs || \"\";\r\n\r\n\t\tif(!task.$wbs) {\r\n\t\t\tthis.reset();\r\n\t\t\tthis._calcWBS();\r\n\t\t}\r\n\t\treturn task.$wbs;\r\n\t},\r\n\t_setWBSCode: function(task, value) {\r\n\t\ttask.$wbs = value;\r\n\t},\r\n\tgetWBSCode: function(task) {\r\n\t\treturn this._getWBSCode(task);\r\n\t},\r\n\tgetByWBSCode: function(code){\r\n\t\tlet parts = code.split(\".\");\r\n\t\tlet currentNode = gantt.config.root_id;\r\n\t\tfor(let i = 0; i < parts.length; i++){\r\n\t\t\tconst children = gantt.getChildren(currentNode);\r\n\t\t\tlet index = parts[i]*1 - 1;\r\n\t\t\tif(gantt.isTaskExists(children[index])){\r\n\t\t\t\tcurrentNode = children[index];\r\n\t\t\t}else{\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(gantt.isTaskExists(currentNode)){\r\n\t\t\treturn gantt.getTask(currentNode);\r\n\t\t}else{\r\n\t\t\treturn null;\r\n\t\t}\r\n\t},\r\n\t_calcWBS: function() {\r\n\t\tif(!this._isRecalcNeeded()) return;\r\n\r\n\t\tlet _isFirst = true;\r\n\t\tgantt.eachTask(function(ch) {\r\n\t\t\tif(ch.type == gantt.config.types.placeholder) return;\r\n\t\t\tif(_isFirst) {\r\n\t\t\t\t_isFirst = false;\r\n\t\t\t\tthis._setWBSCode(ch, \"1\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst _prevSibling = this._getPrevNonPlaceholderSibling(ch.id);\r\n\t\t\tif (_prevSibling !== null) {\r\n\t\t\t\tthis._increaseWBS(ch, _prevSibling);\r\n\t\t\t} else {\r\n\t\t\t\tlet _parent = gantt.getParent(ch.id);\r\n\t\t\t\tthis._setWBSCode(ch, gantt.getTask(_parent).$wbs + \".1\");\r\n\t\t\t}\r\n\t\t}, gantt.config.root_id, this);\r\n\r\n\t\tthis._needRecalc = false;\r\n\t},\r\n\t_increaseWBS: function(task, siblingiId){\r\n\t\tlet _wbs = gantt.getTask(siblingiId).$wbs;\r\n\t\tif(_wbs) {\r\n\t\t\t_wbs = _wbs.split(\".\");\r\n\t\t\t_wbs[_wbs.length-1]++;\r\n\t\t\tthis._setWBSCode(task, _wbs.join(\".\"));\r\n\t\t}\r\n\t},\r\n\t_getPrevNonPlaceholderSibling: function(childId) {\r\n\t\tlet prevSibling;\r\n\t\tlet currentId = childId;\r\n\t\tdo {\r\n\t\t\tprevSibling = gantt.getPrevSibling(currentId);\r\n\t\t\tcurrentId = prevSibling;\r\n\t\t} while (prevSibling !== null && gantt.getTask(prevSibling).type == gantt.config.types.placeholder);\r\n\t\treturn prevSibling;\r\n   }\r\n};\r\n});\r\n\r\nexport default function(gantt){\r\n\tconst wbs = createWbs(gantt);\r\n\tgantt.getWBSCode = function getWBSCode(task) {\r\n\t\treturn wbs.getWBSCode(task);\r\n\t};\r\n\r\n\tgantt.getTaskByWBSCode = function(code) {\r\n\t\treturn wbs.getByWBSCode(code);\r\n\t};\r\n\r\n\tfunction resetCache(){\r\n\t\twbs.reset();\r\n\t\treturn true;\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onAfterTaskMove\", resetCache);\r\n\tgantt.attachEvent(\"onBeforeParse\", resetCache);\r\n\tgantt.attachEvent(\"onAfterTaskDelete\", resetCache);\r\n\tgantt.attachEvent(\"onAfterTaskAdd\", resetCache);\r\n\tgantt.attachEvent(\"onAfterSort\", resetCache);\r\n\r\n};\r\n","import * as helpers from \"../../utils/helpers\";\r\nimport * as dom_helpers from \"../ui/utils/dom_helpers\";\r\nfunction createResourceMethods(gantt){\r\n\r\n\tvar resourceTaskCache = {};\r\n\tvar singleResourceCacheBuilt = false;\r\n\r\n\tgantt.$data.tasksStore.attachEvent(\"onStoreUpdated\", function(){\r\n\t\tresourceTaskCache = {};\r\n\t\tsingleResourceCacheBuilt = false;\r\n\t});\r\n\tgantt.attachEvent(\"onBeforeGanttRender\", function(){\r\n\t\tresourceTaskCache = {};\r\n\t});\r\n\r\n\tfunction getTaskBy(propertyName, propertyValue, typeFilter) {\r\n\t\tif (typeof propertyName == \"function\") {\r\n\t\t\treturn filterResourceTasks(propertyName);\r\n\t\t} else {\r\n\t\t\tif (helpers.isArray(propertyValue)) {\r\n\t\t\t\treturn getResourceTasks(propertyName, propertyValue, typeFilter);\r\n\t\t\t} else {\r\n\t\t\t\treturn getResourceTasks(propertyName, [propertyValue], typeFilter);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction filterResourceTasks(filter) {\r\n\t\tvar res = [];\r\n\t\tgantt.eachTask(function (task) {\r\n\t\t\tif (filter(task)) {\r\n\t\t\t\tres.push(task);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn res;\r\n\t}\r\n\r\n\tvar falsyValuePrefix = String(Math.random());\r\n\tfunction resourceHashFunction(value){\r\n\t\tif (value === null){\r\n\t\t\treturn falsyValuePrefix + String(value);\r\n\t\t}\r\n\t\treturn String(value);\r\n\t}\r\n\r\n\tfunction getCacheKey(resourceIds, property, typeFilter) {\r\n\t\tif (Array.isArray(resourceIds)) {\r\n\t\t\treturn resourceIds.map(function (value) {\r\n\t\t\t\treturn resourceHashFunction(value);\r\n\t\t\t}).join(\"_\") + `_${property}_${typeFilter}`;\r\n\t\t} else {\r\n\t\t\treturn resourceHashFunction(resourceIds) + `_${property}_${typeFilter}`;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getResourceTasks(property, resourceIds, typeFilter) {\r\n\t\tvar res;\r\n\t\tvar cacheKey = getCacheKey(resourceIds, property, JSON.stringify(typeFilter));\r\n\t\tvar matchingResources = {};\r\n\t\thelpers.forEach(resourceIds, function(resourceId) {\r\n\t\t\tmatchingResources[resourceHashFunction(resourceId)] = true;\r\n\t\t});\r\n\r\n\t\tif (!resourceTaskCache[cacheKey]) {\r\n\t\t\tres = resourceTaskCache[cacheKey] = [];\r\n\t\t\tgantt.eachTask(function (task) {\r\n\t\t\t\tif (typeFilter) {\r\n\t\t\t\t\tif (!typeFilter[gantt.getTaskType(task)]) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (task.type == gantt.config.types.project) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (property in task) {\r\n\t\t\t\t\tvar resourceValue;\r\n\t\t\t\t\tif (!helpers.isArray(task[property])) {\r\n\t\t\t\t\t\tresourceValue = [task[property]];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresourceValue = task[property];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\thelpers.forEach(resourceValue, function(value) {\r\n\t\t\t\t\t\tvar resourceValue = (value && value.resource_id) ? value.resource_id : value;\r\n\r\n\t\t\t\t\t\tif (matchingResources[resourceHashFunction(resourceValue)]) {\r\n\t\t\t\t\t\t\tres.push(task);\r\n\t\t\t\t\t\t}else if(!singleResourceCacheBuilt){\r\n\r\n\t\t\t\t\t\t\tvar key = getCacheKey(value, property);\r\n\t\t\t\t\t\t\tif(!resourceTaskCache[key]){\r\n\t\t\t\t\t\t\t\tresourceTaskCache[key] = [];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tresourceTaskCache[key].push(task);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tsingleResourceCacheBuilt = true;\r\n\t\t} else {\r\n\t\t\tres = resourceTaskCache[cacheKey];\r\n\t\t}\r\n\r\n\t\treturn res;\r\n\t}\r\n\r\n\tfunction selectAssignments(resourceId, taskId, result){\r\n\t\tvar property = gantt.config.resource_property;\r\n\t\tvar owners = [];\r\n\t\tif (gantt.getDatastore(\"task\").exists(taskId)) {\r\n\t\t\tvar task = gantt.getTask(taskId);\r\n\t\t\towners = task[property] || [];\r\n\t\t}\r\n\r\n\t\tif (!Array.isArray(owners)) {\r\n\t\t\towners = [owners];\r\n\t\t}\r\n\t\tfor (var i = 0; i < owners.length; i++) {\r\n\t\t\tif (owners[i].resource_id == resourceId) {\r\n\t\t\t\tresult.push({task_id: task.id, resource_id:owners[i].resource_id, value:owners[i].value});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getResourceAssignments(resourceId, taskId){\r\n\t\t// resource assignment as an independent module:\r\n\t\t// {taskId:, resourceId, value}\r\n\t\t// TODO: probably should add a separate datastore for these\r\n\t\tvar assignments = [];\r\n\t\tvar property = gantt.config.resource_property;\r\n\t\tif(taskId !== undefined){\r\n\t\t\tselectAssignments(resourceId, taskId, assignments);\r\n\t\t}else{\r\n\t\t\tvar tasks = gantt.getTaskBy(property, resourceId);\r\n\t\t\ttasks.forEach(function(task){\r\n\t\t\t\tselectAssignments(resourceId, task.id, assignments);\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn assignments;\r\n\t}\r\n\r\n\treturn {\r\n\t\tgetTaskBy: getTaskBy,\r\n\t\tgetResourceAssignments: getResourceAssignments\r\n\t};\r\n}\r\n\r\nfunction createHelper(gantt){\r\n\tconst resourcePlugin = {\r\n\t\trenderEditableLabel: function(start_date, end_date, resource, tasks, assignments){\r\n\t\t\tconst editable = gantt.config.readonly ? \"\" : \"contenteditable\";\r\n\t\t\tif(start_date < resource.end_date && end_date > resource.start_date){\r\n\t\t\t\tfor(let i = 0; i < assignments.length; i++){\r\n\t\t\t\t\tconst a = assignments[i];\r\n\t\t\t\t\t\treturn \"<div \"+editable+\" data-assignment-cell data-assignment-id='\"+a.id+\"'\"+\r\n\t\t\t\t\t\t\" data-row-id='\"+resource.id+\"'\"+\r\n\t\t\t\t\t\t\" data-task='\"+resource.$task_id+\"'\"+\r\n\t\t\t\t\t\t\" data-start-date='\"+gantt.templates.format_date(start_date)+\"'\"+\r\n\t\t\t\t\t\t\" data-end-date='\"+gantt.templates.format_date(end_date)+\"'>\" + a.value + \"</div>\";\r\n\t\t\t\t}\r\n\t\t\t\treturn \"<div \"+editable+\" data-assignment-cell data-empty \"+ \r\n\t\t\t\t\t\t\" data-row-id='\"+resource.id+\"'\"+\r\n\t\t\t\t\t\t\" data-resource-id='\"+resource.$resource_id+\"'\"+\r\n\t\t\t\t\t\t\" data-task='\"+resource.$task_id+\"'\"+\r\n\t\t\t\t\t\t\" data-start-date='\"+gantt.templates.format_date(start_date)+\"'\"+\r\n\t\t\t\t\t\t\"'  data-end-date='\"+gantt.templates.format_date(end_date)+\"'>-</div>\";\r\n\t\t\t}\r\n\t\t\treturn \"\";\r\n\t\t},\r\n\t\trenderSummaryLabel: function(start_date, end_date, resource, tasks, assignments){\r\n\t\t\tlet sum = assignments.reduce(function(total, assignment){ \r\n\t\t\t\treturn total + Number(assignment.value);\r\n\t\t\t}, 0);\r\n\r\n\t\t\tif(sum % 1){\r\n\t\t\t\tsum = Math.round(sum * 10)/10;\r\n\t\t\t}\r\n\r\n\t\t\tif(sum){\r\n\t\t\t\treturn \"<div>\" + sum + \"</div>\";\r\n\t\t\t}\r\n\t\t\treturn \"\";\r\n\t\t},\r\n\t\teditableResourceCellTemplate: function(start_date, end_date, resource, tasks, assignments){\r\n\t\t\tif(resource.$role === \"task\"){\r\n\t\t\t\treturn resourcePlugin.renderEditableLabel(start_date, end_date, resource, tasks, assignments);\r\n\t\t\t}else{\r\n\t\t\t\treturn resourcePlugin.renderSummaryLabel(start_date, end_date, resource, tasks, assignments);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\t\r\n\t\teditableResourceCellClass: function(start_date, end_date, resource, tasks, assignments){\r\n\t\t\tconst css = [];\r\n\t\t\tcss.push(\"resource_marker\");\r\n\r\n\t\t\tif(resource.$role === \"task\"){\r\n\t\t\t\tcss.push(\"task_cell\");\r\n\t\t\t}else{\r\n\t\t\t\tcss.push(\"resource_cell\");\r\n\t\t\t}\r\n\r\n\t\t\tconst sum = assignments.reduce(function(total, assignment){ \r\n\t\t\t\treturn total + Number(assignment.value);\r\n\t\t\t}, 0);\r\n\r\n\t\t\tlet capacity = Number(resource.capacity);\r\n\t\t\tif(isNaN(capacity)){\r\n\t\t\t\tcapacity = 8;\r\n\t\t\t}\r\n\t\t\tif (sum <= capacity) {\r\n\t\t\t\tcss.push(\"workday_ok\");\r\n\t\t\t} else {\r\n\t\t\t\tcss.push(\"workday_over\");\r\n\t\t\t}\r\n\t\t\treturn css.join(\" \");\r\n\t\t},\r\n\t\tgetSummaryResourceAssignments: function getResourceAssignments(resourceId) {\r\n\t\t\tlet assignments;\r\n\t\t\tconst store = gantt.getDatastore(gantt.config.resource_store);\r\n\t\t\tconst resource = store.getItem(resourceId);\r\n\r\n\t\t\tif(resource.$role === \"task\"){\r\n\t\t\t\tassignments = gantt.getResourceAssignments(resource.$resource_id, resource.$task_id);\r\n\t\t\t}else{\r\n\t\t\t\tassignments = gantt.getResourceAssignments(resourceId);\r\n\t\t\t\tif(store.eachItem){\r\n\t\t\t\t\tstore.eachItem(function(childResource){\r\n\t\t\t\t\t\tif(childResource.$role !== \"task\"){\r\n\t\t\t\t\t\t\tassignments = assignments.concat(gantt.getResourceAssignments(childResource.id));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, resourceId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn assignments;\r\n\t\t},\r\n\t\t\r\n\t\tinitEditableDiagram: function(){\r\n\t\t\tgantt.config.resource_render_empty_cells = true;\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t(function(){\r\n\t\t\t\t/// salesforce locker workaround\r\n\t\t\t\t// SF removes 'contenteditable' attribute from cells\r\n\t\t\t\t// restore it on render\r\n\t\t\t\tlet timeoutId = null;\r\n\t\t\t\tfunction makeEditable() {\r\n\t\t\t\t\tif (timeoutId) {\r\n\t\t\t\t\t\tcancelAnimationFrame(timeoutId);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttimeoutId = requestAnimationFrame(function () {\r\n\t\t\t\t\t\tif (gantt.$container){\r\n\t\t\t\t\t\t\tvar cells = Array.prototype.slice.call(gantt.$container.querySelectorAll(\".resourceTimeline_cell [data-assignment-cell]\"));\r\n\t\t\t\t\t\t\tcells.forEach(function (cell) {\r\n\t\t\t\t\t\t\t\tcell.contentEditable = true;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\t\t\t\t\tgantt.getDatastore(gantt.config.resource_assignment_store).attachEvent(\"onStoreUpdated\", makeEditable);\r\n\t\t\t\t\tgantt.getDatastore(gantt.config.resource_store).attachEvent(\"onStoreUpdated\", makeEditable);\r\n\t\t\t\t}, {once: true});\r\n\t\t\t\tgantt.attachEvent(\"onGanttLayoutReady\", function(){\r\n\t\t\t\t\tconst ganttViews = gantt.$layout.getCellsByType(\"viewCell\");\r\n\t\t\t\t\tganttViews.forEach(function(view){\r\n\t\t\t\t\t\tif(view.$config && view.$config.view === \"resourceTimeline\" && view.$content){\r\n\t\t\t\t\t\t\tview.$content.attachEvent(\"onScroll\", makeEditable);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t})();\r\n\t\t\t//GS-2766: need to restore focus after updating assignments\r\n\t\t\tlet currentFocusIndex = null;\r\n\t\t\tfunction setNextFocus(){\r\n\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\tconst focusableElementsAfterRender = dom_helpers.getFocusableNodes(gantt.$container);\r\n\t\t\t\t\tif(currentFocusIndex > -1){\r\n\t\t\t\t\t\tfocusableElementsAfterRender[currentFocusIndex +1]?.focus();\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 300);\r\n\t\t\t};\r\n\r\n\t\t\tfunction handleAssignmentEdit(e, elem){\r\n\t\t\t\tlet target = elem || e.target.closest(\".resourceTimeline_cell [data-assignment-cell]\");\r\n\t\t\t\tif(target){\r\n\t\t\t\t\tlet strValue = (target.innerText || \"\").trim();\r\n\t\t\t\t\tif(strValue == \"-\"){\r\n\t\t\t\t\t\tstrValue = \"0\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet value = Number(strValue);\r\n\t\t\t\t\tlet rowId = target.getAttribute(\"data-row-id\");\r\n\t\t\t\t\tlet assignmentId = target.getAttribute(\"data-assignment-id\");\r\n\t\t\t\t\tlet taskId = target.getAttribute(\"data-task\");\r\n\t\t\t\t\tlet resourceId = target.getAttribute(\"data-resource-id\");\r\n\t\t\t\t\tlet startDate = gantt.templates.parse_date(target.getAttribute(\"data-start-date\"));\r\n\t\t\t\t\tlet endDate = gantt.templates.parse_date(target.getAttribute(\"data-end-date\"));\r\n\r\n\t\t\t\t\tconst assignmentStore = gantt.getDatastore(gantt.config.resource_assignment_store);\r\n\t\t\t\t\tif(isNaN(value)){\r\n\t\t\t\t\t\tgantt.getDatastore(gantt.config.resource_store).refresh(rowId);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tconst task = gantt.getTask(taskId);\r\n\t\t\t\t\t\tif(assignmentId){\r\n\t\t\t\t\t\t\t// GS-2141. Track the changes by the Undo extension\r\n\t\t\t\t\t\t\tif (gantt.plugins().undo){\r\n\t\t\t\t\t\t\t\tgantt.ext.undo.saveState(taskId, \"task\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconst assignment = assignmentStore.getItem(assignmentId);\r\n\t\t\t\t\t\t\tif(!assignment || value === assignment.value){\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(assignment.start_date.valueOf() === startDate.valueOf() && assignment.end_date.valueOf() === endDate.valueOf()){\r\n\t\t\t\t\t\t\t\tassignment.value = value;\r\n\t\t\t\t\t\t\t\tif(!value){\r\n\t\t\t\t\t\t\t\t\tassignmentStore.removeItem(assignment.id);\r\n\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\tassignmentStore.updateItem(assignment.id);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif(assignment.end_date.valueOf() > endDate.valueOf()){\r\n\t\t\t\t\t\t\t\t\tconst nextChunk = gantt.copy(assignment);\r\n\t\t\t\t\t\t\t\t\tnextChunk.id = gantt.uid();\r\n\t\t\t\t\t\t\t\t\tnextChunk.start_date = endDate;\r\n\t\t\t\t\t\t\t\t\tnextChunk.duration = gantt.calculateDuration({\r\n\t\t\t\t\t\t\t\t\t\tstart_date: nextChunk.start_date,\r\n\t\t\t\t\t\t\t\t\t\tend_date: nextChunk.end_date,\r\n\t\t\t\t\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\tnextChunk.delay = gantt.calculateDuration({\r\n\t\t\t\t\t\t\t\t\t\tstart_date: task.start_date,\r\n\t\t\t\t\t\t\t\t\t\tend_date: nextChunk.start_date,\r\n\t\t\t\t\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\tnextChunk.mode = assignment.mode || \"default\";\r\n\t\t\t\t\t\t\t\t\tif(nextChunk.duration !== 0){\r\n\t\t\t\t\t\t\t\t\t\tassignmentStore.addItem(nextChunk);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif(assignment.start_date.valueOf() < startDate.valueOf()){\r\n\t\t\t\t\t\t\t\t\tassignment.end_date = startDate;\r\n\t\t\t\t\t\t\t\t\tassignment.duration = gantt.calculateDuration({\r\n\t\t\t\t\t\t\t\t\t\tstart_date: assignment.start_date,\r\n\t\t\t\t\t\t\t\t\t\tend_date: assignment.end_date,\r\n\t\t\t\t\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\tassignment.mode = \"fixedDuration\";\r\n\r\n\t\t\t\t\t\t\t\t\tif(assignment.duration === 0){\r\n\t\t\t\t\t\t\t\t\t\tassignmentStore.removeItem(assignment.id);\r\n\t\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t\tassignmentStore.updateItem(assignment.id);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\tassignmentStore.removeItem(assignment.id);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif(value){\r\n\t\t\t\t\t\t\t\t\tassignmentStore.addItem({\r\n\t\t\t\t\t\t\t\t\t\ttask_id: assignment.task_id,\r\n\t\t\t\t\t\t\t\t\t\tresource_id: assignment.resource_id,\r\n\t\t\t\t\t\t\t\t\t\tvalue: value,\r\n\t\t\t\t\t\t\t\t\t\tstart_date: startDate,\r\n\t\t\t\t\t\t\t\t\t\tend_date: endDate,\r\n\t\t\t\t\t\t\t\t\t\tduration: gantt.calculateDuration({\r\n\t\t\t\t\t\t\t\t\t\t\tstart_date: startDate,\r\n\t\t\t\t\t\t\t\t\t\t\tend_date: endDate,\r\n\t\t\t\t\t\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\t\t\tdelay: gantt.calculateDuration({\r\n\t\t\t\t\t\t\t\t\t\t\tstart_date: task.start_date,\r\n\t\t\t\t\t\t\t\t\t\t\tend_date: startDate,\r\n\t\t\t\t\t\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\t\t\tmode: \"fixedDuration\"\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tgantt.updateTaskAssignments(task.id);\r\n\t\t\t\t\t\t\tgantt.updateTask(task.id);\r\n\r\n\t\t\t\t\t\t}else if(value){\r\n\t\t\t\t\t\t\tlet assignment = {\r\n\t\t\t\t\t\t\t\ttask_id: taskId,\r\n\t\t\t\t\t\t\t\tresource_id: resourceId,\r\n\t\t\t\t\t\t\t\tvalue: value,\r\n\t\t\t\t\t\t\t\tstart_date: startDate,\r\n\t\t\t\t\t\t\t\tend_date: endDate,\r\n\t\t\t\t\t\t\t\tduration: gantt.calculateDuration({\r\n\t\t\t\t\t\t\t\t\tstart_date: startDate,\r\n\t\t\t\t\t\t\t\t\tend_date: endDate,\r\n\t\t\t\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\tdelay: gantt.calculateDuration({\r\n\t\t\t\t\t\t\t\t\tstart_date: task.start_date,\r\n\t\t\t\t\t\t\t\t\tend_date: startDate,\r\n\t\t\t\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\tmode: \"fixedDuration\"\r\n\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t\tassignmentStore.addItem(assignment);\r\n\t\t\t\t\t\t\tgantt.updateTaskAssignments(task.id);\r\n\t\t\t\t\t\t\tgantt.updateTask(task.id);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\t\t\t\tlet editedElem = null;\r\n\t\t\t\tgantt.event(gantt.$container, \"keypress\", function(e){\r\n\t\t\t\t\tlet target = e.target.closest(\".resourceTimeline_cell [data-assignment-cell]\");\r\n\t\t\t\t\tif(target){\r\n\t\t\t\t\t\tif (e.keyCode === 13 || e.keyCode === 27) {\r\n\t\t\t\t\t\t\ttarget.blur();\r\n\t\t\t\t\t\t\thandleAssignmentEdit(e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\teditedElem = e.target;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tgantt.event(gantt.$container, \"keydown\", function(event){\r\n\t\t\t\t\tif (event.key === \"Tab\") {\r\n\t\t\t\t\t\tconst focusableElements = dom_helpers.getFocusableNodes(gantt.$container);\r\n\t\t\t\t\t\tcurrentFocusIndex = focusableElements.indexOf(document.activeElement);\r\n\t\t\t\t\t\thandleAssignmentEdit(event);\r\n\t\t\t\t\t\tsetNextFocus();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tgantt.event(gantt.$container, \"click\", function(e) {\r\n\t\t\t\t\tif(editedElem){\r\n\t\t\t\t\t\thandleAssignmentEdit(e, editedElem);\r\n\t\t\t\t\t\teditedElem = null;\r\n\t\t\t\t\t\t//handle click on the editable content\r\n\t\t\t\t\t\tif(e.target.hasAttribute(\"data-assignment-id\")){\r\n\t\t\t\t\t\t\tconst focusableElements = gantt.$container.querySelectorAll(\"[contenteditable='true']\");\r\n\t\t\t\t\t\t\tconst target = Array.from(focusableElements).find(elem =>\r\n\t\t\t\t\t\t\t\telem.getAttribute(\"data-start-date\") == e.target.getAttribute(\"data-start-date\") &&\r\n\t\t\t\t\t\t\t\telem.getAttribute(\"data-assignment-id\") == e.target.getAttribute(\"data-assignment-id\")\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t//set focus after editing assignment\r\n\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\tconst focusableElementsAfterUpdate = gantt.$container.querySelectorAll(\"[contenteditable='true']\");\r\n\t\t\t\t\t\t\t\tconst targetAfterUpdate = Array.from(focusableElementsAfterUpdate).find(elem =>\r\n\t\t\t\t\t\t\t\t\telem.getAttribute(\"data-start-date\") == target.getAttribute(\"data-start-date\") &&\r\n\t\t\t\t\t\t\t\t\telem.getAttribute(\"data-row-id\") == target.getAttribute(\"data-row-id\")\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\tif (targetAfterUpdate) {\r\n\t\t\t\t\t\t\t\t\ttargetAfterUpdate.focus();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}, 400);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}, {once: true});\r\n\t\t}\r\n\t};\r\n\treturn resourcePlugin;\r\n}\r\n\r\nexport default function(gantt){\r\n\tvar methods = createResourceMethods(gantt);\r\n\t\r\n\tgantt.ext.resources = createHelper(gantt);\r\n\r\n\tgantt.config.resources = {\r\n\t\tdataprocessor_assignments: false,\r\n\t\tdataprocessor_resources: false,\r\n\t\teditable_resource_diagram: false,\r\n\t\tresource_store: {\r\n\t\t\ttype: \"treeDataStore\",\r\n\t\t\tfetchTasks: false,\r\n\t\t\tinitItem: function(item) {\r\n\t\t\t\titem.parent = item.parent || gantt.config.root_id;\r\n\t\t\t\titem[gantt.config.resource_property] = item.parent;\r\n\t\t\t\titem.open = true;\r\n\t\t\t\treturn item;\r\n\t\t\t}\r\n\t\t},\r\n\t\tlightbox_resources: function selectResourceControlOptions(resources){\r\n\t\t\tconst lightboxOptions = [];\r\n\t\t\tconst store = gantt.getDatastore(gantt.config.resource_store);\r\n\t\t\tresources.forEach(function(res) {\r\n\t\t\t\tif (!store.hasChild(res.id)) {\r\n\t\t\t\t\tconst copy = gantt.copy(res);\r\n\t\t\t\t\tcopy.key = res.id;\r\n\t\t\t\t\tcopy.label = res.text;\r\n\t\t\t\t\tlightboxOptions.push(copy);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn lightboxOptions;\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.attachEvent(\"onBeforeGanttReady\", function(){\r\n\t\tif(gantt.getDatastore(gantt.config.resource_store)){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst resourceStoreConfig = gantt.config.resources ? gantt.config.resources.resource_store : undefined;\r\n\t\tlet fetchTasks = resourceStoreConfig ? resourceStoreConfig.fetchTasks : undefined;\r\n\t\tif(gantt.config.resources && gantt.config.resources.editable_resource_diagram){\r\n\t\t\tfetchTasks = true;\r\n\t\t}\r\n\r\n\t\tlet initItems = function(item) {\r\n\t\t\titem.parent = item.parent || gantt.config.root_id;\r\n\t\t\titem[gantt.config.resource_property] = item.parent;\r\n\t\t\titem.open = true;\r\n\t\t\treturn item;\r\n\t\t};\r\n\r\n\t\tif(resourceStoreConfig && resourceStoreConfig.initItem){\r\n\t\t\tinitItems = resourceStoreConfig.initItem;\r\n\t\t}\r\n\r\n\t\tconst storeType = resourceStoreConfig && resourceStoreConfig.type ? resourceStoreConfig.type : \"treeDatastore\";\r\n\r\n\t\tgantt.$resourcesStore = gantt.createDatastore({\r\n\t\t\tname: gantt.config.resource_store,\r\n\t\t\ttype: storeType,\r\n\t\t\tfetchTasks: fetchTasks !== undefined ? fetchTasks : false,\r\n\t\t\tinitItem: initItems\r\n\t\t});\r\n\r\n\t\tgantt.$data.resourcesStore = gantt.$resourcesStore;\r\n\r\n\t\tgantt.$resourcesStore.attachEvent(\"onParse\", function() {\r\n\t\t\tfunction selectResourceControlOptions(resources){\r\n\t\t\t\tconst lightboxOptions = [];\r\n\t\t\t\tresources.forEach(function(res) {\r\n\t\t\t\t\tconst copy = gantt.copy(res);\r\n\t\t\t\t\tcopy.key = res.id;\r\n\t\t\t\t\tcopy.label = res.text;\r\n\t\t\t\t\tlightboxOptions.push(copy);\r\n\t\t\t\t});\r\n\t\t\t\treturn lightboxOptions;\r\n\t\t\t}\r\n\r\n\t\t\tlet lightboxOptionsFnc = selectResourceControlOptions;\r\n\t\t\tlet options;\r\n\t\t\tif(gantt.config.resources && gantt.config.resources.lightbox_resources){\r\n\t\t\t\tlightboxOptionsFnc = gantt.config.resources.lightbox_resources;\r\n\t\t\t}\r\n\t\t\tif(gantt.config.resources && gantt.config.resources.editable_resource_diagram){\r\n\t\t\t\t// GS-2604: case for the next parsed resources\r\n\t\t\t\t// to filter only resources with assignments\r\n\t\t\t\tconst resources = gantt.$resourcesStore.getItems();\r\n\t\t\t\tconst filteredResources = resources.filter(resource => {\r\n\t\t\t\t\tlet assignments = gantt.getResourceAssignments(resource.id);\r\n\t\t\t\t\tif(!gantt.$resourcesStore.hasChild(resource.id) || (assignments && assignments.length)){\r\n\t\t\t\t\t\tif(resource.$resource_id && resource.$task_id){\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\toptions = lightboxOptionsFnc(filteredResources);\r\n\t\t\t} else {\r\n\t\t\t\toptions = lightboxOptionsFnc(gantt.$resourcesStore.getItems());\r\n\t\t\t}\r\n\t\t\tgantt.updateCollection(\"resourceOptions\", options);\r\n\t\t});\r\n\t});\r\n\r\n\tgantt.getTaskBy = methods.getTaskBy;\r\n\tgantt.getResourceAssignments = methods.getResourceAssignments;\r\n\tgantt.config.resource_property = \"owner_id\";\r\n\tgantt.config.resource_store = \"resource\";\r\n\tgantt.config.resource_render_empty_cells = false;\r\n\r\n\t/**\r\n\t * these are placeholder functions that should be redefined by the user\r\n\t*/\r\n\tgantt.templates.histogram_cell_class = function(start_date, end_date, resource, tasks, assignments) {};\r\n\tgantt.templates.histogram_cell_label = function(start_date, end_date, resource, tasks, assignments) {\r\n\t\treturn tasks.length + \"/3\";\r\n\t};\r\n\tgantt.templates.histogram_cell_allocated = function(start_date, end_date, resource, tasks, assignments) {\r\n\t\treturn tasks.length / 3;\r\n\t};\r\n\tgantt.templates.histogram_cell_capacity = function(start_date, end_date, resource, tasks, assignments) {\r\n\t\treturn 0;\r\n\t};\r\n\r\n\r\n\tconst defaultResourceCellClass = function(start, end, resource, tasks, assignments) {\r\n\t\tvar css = \"\";\r\n\t\tif (tasks.length <= 1) {\r\n\t\t\tcss = \"gantt_resource_marker_ok\";\r\n\t\t} else {\r\n\t\t\tcss = \"gantt_resource_marker_overtime\";\r\n\t\t}\r\n\t\treturn css;\r\n\t};\r\n\r\n\tconst defaultResourceCellTemplate = function(start, end, resource, tasks, assignments) {\r\n\t\treturn tasks.length * 8;\r\n\t};\r\n\r\n\tgantt.templates.resource_cell_value = defaultResourceCellTemplate;\r\n\tgantt.templates.resource_cell_class = defaultResourceCellClass;\r\n\r\n\t//editable_resource_diagram\r\n\tgantt.attachEvent(\"onBeforeGanttReady\", function(){\r\n\t\tif(gantt.config.resources && gantt.config.resources.editable_resource_diagram){\r\n\r\n\t\t\tgantt.config.resource_render_empty_cells = true;\r\n\t\t\tif(gantt.templates.resource_cell_value === defaultResourceCellTemplate){\r\n\t\t\t\tgantt.templates.resource_cell_value = gantt.ext.resources.editableResourceCellTemplate;\r\n\t\t\t}\r\n\t\t\tif(gantt.templates.resource_cell_class === defaultResourceCellClass){\r\n\t\t\t\tgantt.templates.resource_cell_class = gantt.ext.resources.editableResourceCellClass;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tgantt.ext.resources.initEditableDiagram(gantt);\r\n\t\t}\r\n\t});\r\n};\r\n\r\n\r\n","export default function (gantt) {\r\n\tvar resourceAssignmentsProperty = \"$resourceAssignments\";\r\n\tgantt.config.resource_assignment_store = \"resourceAssignments\";\r\n\tgantt.config.process_resource_assignments = true;\r\n\r\n\tvar resourceAssignmentFormats = {\r\n\t\tauto: \"auto\",\r\n\t\tsingleValue: \"singleValue\",\r\n\t\tvalueArray: \"valueArray\",\r\n\t\tresourceValueArray: \"resourceValueArray\",\r\n\t\tassignmentsArray: \"assignmentsArray\"\r\n\t};\r\n\tvar resourceAssignmentFormat = resourceAssignmentFormats.auto;//\"primitiveSingle\";//\"primitive\";//\"object\"|\"assignment\"\r\n\r\n\tvar assignmentModes = {\r\n\t\tfixedDates: \"fixedDates\",\r\n\t\tfixedDuration: \"fixedDuration\",\r\n\t\tdefault: \"default\"\r\n\t};\r\n\r\n\r\n\tfunction initAssignmentFields(item, task){\r\n\t\tif (item.start_date) {\r\n\t\t\titem.start_date = gantt.date.parseDate(item.start_date, \"parse_date\");\r\n\t\t} else {\r\n\t\t\titem.start_date = null;\r\n\t\t}\r\n\r\n\t\tif (item.end_date) {\r\n\t\t\titem.end_date = gantt.date.parseDate(item.end_date, \"parse_date\");\r\n\t\t} else {\r\n\t\t\titem.end_date = null;\r\n\t\t}\r\n\r\n\t\tvar delay = Number(item.delay);\r\n\t\tvar initDelay = false;\r\n\t\tif (!isNaN(delay)) {\r\n\t\t\titem.delay = delay;\r\n\t\t} else {\r\n\t\t\titem.delay = 0;\r\n\t\t\tinitDelay = true;\r\n\t\t}\r\n\r\n\t\tif (!gantt.defined(item.value)) {\r\n\t\t\titem.value = null;\r\n\t\t}\r\n\r\n\t\tif (!item.task_id || !item.resource_id) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\titem.mode = item.mode || assignmentModes.default;\r\n\r\n\t\tif(item.mode === assignmentModes.fixedDuration){\r\n\t\t\tif(isNaN(Number(item.duration))){\r\n\t\t\t\ttask = task || gantt.getTask(item.task_id);\r\n\t\t\t\titem.duration = gantt.calculateDuration({\r\n\t\t\t\t\tstart_date: item.start_date,\r\n\t\t\t\t\tend_date: item.end_date,\r\n\t\t\t\t\tid: task\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif(initDelay){\r\n\t\t\t\ttask = task || gantt.getTask(item.task_id);\r\n\t\t\t\titem.delay = gantt.calculateDuration({\r\n\t\t\t\t\tstart_date: task.start_date,\r\n\t\t\t\t\tend_date: item.start_date,\r\n\t\t\t\t\tid: task\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (item.mode !== assignmentModes.fixedDates && (task || gantt.isTaskExists(item.task_id))) {\r\n\t\t\ttask = task || gantt.getTask(item.task_id);\r\n\t\t\tvar timing = _assignmentTimeFromTask(item, task);\r\n\t\t\titem.start_date = timing.start_date;\r\n\t\t\titem.end_date = timing.end_date;\r\n\t\t\titem.duration = timing.duration;\r\n\t\t}\r\n\t}\r\n\t// gantt init\r\n\tvar resourceAssignmentsStore = gantt.createDatastore({\r\n\t\tname: gantt.config.resource_assignment_store,\r\n\t\tinitItem: function (item) {\r\n\t\t\tif (!item.id) {\r\n\t\t\t\titem.id = gantt.uid();\r\n\t\t\t}\r\n\r\n\t\t\tinitAssignmentFields(item);\r\n\r\n\t\t\treturn item;\r\n\t\t}\r\n\t});\r\n\t\r\n\tgantt.$data.assignmentsStore = resourceAssignmentsStore;\r\n\r\n\tfunction _assignmentTimeFromTask(assignment, task) {\r\n\r\n\t\tif (assignment.mode === assignmentModes.fixedDates) {\r\n\t\t\treturn {\r\n\t\t\t\tstart_date: assignment.start_date,\r\n\t\t\t\tend_date: assignment.end_date,\r\n\t\t\t\tduration: assignment.duration\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tvar start = assignment.delay ? gantt.calculateEndDate({\r\n\t\t\t\tstart_date: task.start_date,\r\n\t\t\t\tduration: assignment.delay,\r\n\t\t\t\ttask: task\r\n\t\t\t}) : new Date(task.start_date);\r\n\r\n\t\t\tvar end;\r\n\t\t\tvar duration;\r\n\t\t\tif (assignment.mode === assignmentModes.fixedDuration) {\r\n\t\t\t\tend = gantt.calculateEndDate({\r\n\t\t\t\t\tstart_date: start,\r\n\t\t\t\t\tduration: assignment.duration,\r\n\t\t\t\t\ttask: task\r\n\t\t\t\t});\r\n\t\t\t\tduration = assignment.duration;\r\n\t\t\t} else {\r\n\t\t\t\tend = new Date(task.end_date);\r\n\t\t\t\tduration = task.duration - assignment.delay;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tstart_date: start,\r\n\t\t\tend_date: end,\r\n\t\t\tduration: duration\r\n\t\t};\r\n\t}\r\n\r\n\t// data loading\r\n\r\n\tfunction _makeAssignmentsFromTask(task) {\r\n\t\tconst property = gantt.config.resource_property;\r\n\t\tlet assignments = task[property];\r\n\t\tconst resourceAssignments = [];\r\n\t\tlet detectFormat = resourceAssignmentFormat === resourceAssignmentFormats.auto;\r\n\r\n\t\tif (gantt.defined(assignments) && assignments) {\r\n\t\t\tif (!Array.isArray(assignments)) {\r\n\t\t\t\tassignments = [assignments];\r\n\t\t\t\tif (detectFormat) {\r\n\t\t\t\t\tresourceAssignmentFormat = resourceAssignmentFormats.singleValue;\r\n\t\t\t\t\tdetectFormat = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst usedIds = {};\r\n\t\t\tassignments.forEach(function (res) {\r\n\t\t\t\tif (!res.resource_id) { // when resource is a string/number\r\n\t\t\t\t\tres = { resource_id: res };\r\n\t\t\t\t\tif (detectFormat) {\r\n\t\t\t\t\t\tresourceAssignmentFormat = resourceAssignmentFormats.valueArray;\r\n\t\t\t\t\t\tdetectFormat = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//\tisSimpleArray = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (detectFormat) {\r\n\t\t\t\t\tif (res.id && res.resource_id) {\r\n\t\t\t\t\t\tresourceAssignmentFormat = resourceAssignmentFormats.assignmentsArray;\r\n\t\t\t\t\t\tdetectFormat = false;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresourceAssignmentFormat = resourceAssignmentFormats.resourceValueArray;\r\n\t\t\t\t\t\tdetectFormat = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet defaultMode = assignmentModes.default;\r\n\t\t\t\tif(!res.mode){\r\n\t\t\t\t\tif((res.start_date && res.end_date) || (res.start_date && res.duration)){\r\n\t\t\t\t\t\tdefaultMode = assignmentModes.fixedDuration;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet id;\r\n\t\t\t\tif(!res.id && res.$id && !usedIds[res.$id]){\r\n\t\t\t\t\tid = res.$id;\r\n\t\t\t\t} else if(res.id && !usedIds[res.id]){\r\n\t\t\t\t\tid = res.id;\r\n\t\t\t\t} else{\r\n\t\t\t\t\tid = gantt.uid();\r\n\t\t\t\t}\r\n\t\t\t\tusedIds[id] = true;\r\n\r\n\t\t\t\tconst assignment = {\r\n\t\t\t\t\tid: id,\r\n\t\t\t\t\tstart_date: res.start_date,\r\n\t\t\t\t\tduration: res.duration,\r\n\t\t\t\t\tend_date: res.end_date,\r\n\t\t\t\t\tdelay: res.delay,\r\n\t\t\t\t\ttask_id: task.id,\r\n\t\t\t\t\tresource_id: res.resource_id,\r\n\t\t\t\t\tvalue: res.value,\r\n\t\t\t\t\tmode: res.mode || defaultMode\r\n\t\t\t\t};\r\n\t\t\t\t// GS-2490: to add custom properties to assignment\r\n\t\t\t\t// need to exclude $id which incfluences on render \r\n\t\t\t\tObject.keys(res).forEach(key => {\r\n\t\t\t\t\tif(key != \"$id\") {\r\n\t\t\t\t\t\tassignment[key] = res[key];\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(!(assignment.start_date && assignment.start_date.getMonth \r\n\t\t\t\t\t&& assignment.end_date && assignment.end_date.getMonth && typeof assignment.duration === \"number\")){\r\n\t\t\t\t\tinitAssignmentFields(assignment, task);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tresourceAssignments.push(assignment);\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn resourceAssignments;\r\n\t}\r\n\r\n\tfunction _updateTaskBack(taskId) {\r\n\t\t// GS-1493. In some cases, the resource assignment store has the tasks that no longer exist\r\n\t\tif (!gantt.isTaskExists(taskId)){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst task = gantt.getTask(taskId);\r\n\t\t//GS-2977: get the updated assignments\r\n\t\tconst assignments = resourceAssignmentsStore.find(a => a.task_id == task.id);\r\n\t\t_assignAssignments(task, assignments);\r\n\t}\r\n\r\n\tfunction _assignAssignments(task, assignments){\r\n\t\tassignments.sort(function(a, b){\r\n\t\t\tif(a.start_date && b.start_date && a.start_date.valueOf() != b.start_date.valueOf()){\r\n\t\t\t\treturn a.start_date - b.start_date;\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (resourceAssignmentFormat == resourceAssignmentFormats.assignmentsArray) {\r\n\t\t\ttask[gantt.config.resource_property] = assignments;\r\n\t\t} else if (resourceAssignmentFormat == resourceAssignmentFormats.resourceValueArray) {\r\n\t\t\ttask[gantt.config.resource_property] = assignments.map(function (a) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t$id: a.id,\r\n\t\t\t\t\tstart_date: a.start_date,\r\n\t\t\t\t\tduration: a.duration,\r\n\t\t\t\t\tend_date: a.end_date,\r\n\t\t\t\t\tdelay: a.delay,\r\n\t\t\t\t\tresource_id: a.resource_id,\r\n\t\t\t\t\tvalue: a.value,\r\n\t\t\t\t\tmode: a.mode\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\ttask[resourceAssignmentsProperty] = assignments;\r\n\t}\r\n\r\n\tfunction _loadAssignmentsFromTask(task) {\r\n\t\tvar assignments = _makeAssignmentsFromTask(task);\r\n\t\tvar taskAssignments = [];\r\n\t\tassignments.forEach(function (a) {\r\n\t\t\ta.id = a.id || gantt.uid();\r\n\t\t\t//var newId = resourceAssignmentsStore.addItem(a);\r\n\t\t\ttaskAssignments.push(a);\r\n\t\t});\r\n\r\n\t\treturn assignments;\r\n\t}\r\n\r\n\tfunction diffAssignments(taskValues, assignmentsStoreValues) {\r\n\t\tvar result = {\r\n\t\t\tinBoth: [],\r\n\t\t\tinTaskNotInStore: [],\r\n\t\t\tinStoreNotInTask: []\r\n\t\t};\r\n\r\n\t\tif (resourceAssignmentFormat == resourceAssignmentFormats.singleValue) {\r\n\t\t\tvar taskOwner = taskValues[0];\r\n\t\t\tvar ownerId = taskOwner ? taskOwner.resource_id : null;\r\n\t\t\tvar foundOwnerAssignment = false;\r\n\t\t\tassignmentsStoreValues.forEach(function (a) {\r\n\t\t\t\tif (a.resource_id != ownerId) {\r\n\t\t\t\t\tresult.inStoreNotInTask.push(a);\r\n\t\t\t\t} else if (a.resource_id == ownerId) {\r\n\t\t\t\t\tresult.inBoth.push({ store: a, task: taskOwner });\r\n\t\t\t\t\tfoundOwnerAssignment = true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (!foundOwnerAssignment && taskOwner) {\r\n\t\t\t\tresult.inTaskNotInStore.push(taskOwner);\r\n\t\t\t}\r\n\r\n\r\n\t\t} else if (resourceAssignmentFormat == resourceAssignmentFormats.valueArray){\r\n\r\n\t\t\tvar taskSearch = {};\r\n\t\t\tvar storeSearch = {};\r\n\t\t\tvar processedIds = {};\r\n\t\t\ttaskValues.forEach(function (a) {\r\n\t\t\t\ttaskSearch[a.resource_id] = a;\r\n\t\t\t});\r\n\t\t\tassignmentsStoreValues.forEach(function (a) {\r\n\t\t\t\tstoreSearch[a.resource_id] = a;\r\n\t\t\t});\r\n\t\t\ttaskValues.concat(assignmentsStoreValues).forEach(function (a) {\r\n\t\t\t\tif (processedIds[a.resource_id]) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tprocessedIds[a.resource_id] = true;\r\n\t\t\t\tvar inTask = taskSearch[a.resource_id];\r\n\t\t\t\tvar inStore = storeSearch[a.resource_id];\r\n\r\n\t\t\t\tif (inTask && inStore) {\r\n\t\t\t\t\tresult.inBoth.push({ store: inStore, task: inTask });\r\n\t\t\t\t} else if (inTask && !inStore) {\r\n\t\t\t\t\tresult.inTaskNotInStore.push(inTask);\r\n\t\t\t\t} else if (!inTask && inStore) {\r\n\t\t\t\t\tresult.inStoreNotInTask.push(inStore);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else if ((resourceAssignmentFormat == resourceAssignmentFormats.assignmentsArray)\r\n\t\t\t|| (resourceAssignmentFormat == resourceAssignmentFormats.resourceValueArray)) {\r\n\t\t\tvar taskSearch = {};\r\n\t\t\tvar storeSearch = {};\r\n\t\t\tvar processedIds = {};\r\n\t\t\ttaskValues.forEach(function (a) {\r\n\t\t\t\ttaskSearch[a.id || a.$id] = a;\r\n\t\t\t});\r\n\t\t\tassignmentsStoreValues.forEach(function (a) {\r\n\t\t\t\tstoreSearch[a.id] = a;\r\n\t\t\t});\r\n\t\t\ttaskValues.concat(assignmentsStoreValues).forEach(function (a) {\r\n\t\t\t\tvar id = a.id || a.$id;\r\n\t\t\t\tif (processedIds[id]) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tprocessedIds[id] = true;\r\n\t\t\t\tvar inTask = taskSearch[id];\r\n\t\t\t\tvar inStore = storeSearch[id];\r\n\r\n\t\t\t\tif (inTask && inStore) {\r\n\t\t\t\t\tresult.inBoth.push({ store: inStore, task: inTask });\r\n\t\t\t\t} else if (inTask && !inStore) {\r\n\t\t\t\t\tresult.inTaskNotInStore.push(inTask);\r\n\t\t\t\t} else if (!inTask && inStore) {\r\n\t\t\t\t\tresult.inStoreNotInTask.push(inStore);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfunction assignmentHasChanged(source, target) {\r\n\t\tvar ignoreFields = {\r\n\t\t\tid: true\r\n\t\t};\r\n\r\n\t\tfor (var i in source) {\r\n\t\t\tif (!ignoreFields[i]) {\r\n\t\t\t\tif (String(source[i]) !== String(target[i])) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tfunction updateAssignment(source, target) {\r\n\t\tvar ignoreFields = {\r\n\t\t\tid: true\r\n\t\t};\r\n\r\n\t\tfor (var i in source) {\r\n\t\t\tif (!ignoreFields[i]) {\r\n\t\t\t\ttarget[i] = source[i];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _syncAssignments(task, storeAssignments){\r\n\t\tvar tasksAssignments = _makeAssignmentsFromTask(task);\r\n\r\n\t\tvar diff = diffAssignments(tasksAssignments, storeAssignments);\r\n\t\tdiff.inStoreNotInTask.forEach(function (a) {\r\n\t\t\tresourceAssignmentsStore.removeItem(a.id);\r\n\t\t});\r\n\t\tdiff.inTaskNotInStore.forEach(function (a) {\r\n\t\t\tresourceAssignmentsStore.addItem(a);\r\n\t\t});\r\n\r\n\t\tdiff.inBoth.forEach(function (a) {\r\n\t\t\tif (assignmentHasChanged(a.task, a.store)) {\r\n\t\t\t\tupdateAssignment(a.task, a.store);\r\n\t\t\t\tresourceAssignmentsStore.updateItem(a.store.id);\r\n\t\t\t} else {\r\n\t\t\t\tif (a.task.start_date && a.task.end_date && a.task.mode !== assignmentModes.fixedDates) {\r\n\t\t\t\t\tvar timing = _assignmentTimeFromTask(a.store, task);\r\n\t\t\t\t\tif (a.store.start_date.valueOf() != timing.start_date.valueOf() || a.store.end_date.valueOf() != timing.end_date.valueOf()) {\r\n\t\t\t\t\t\ta.store.start_date = timing.start_date;\r\n\t\t\t\t\t\ta.store.end_date = timing.end_date;\r\n\t\t\t\t\t\ta.store.duration = timing.duration;\r\n\t\t\t\t\t\tresourceAssignmentsStore.updateItem(a.store.id);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t_updateTaskBack(task.id);\r\n\t}\r\n\r\n\tfunction _syncOnTaskUpdate(task) {\r\n\t\tvar storeAssignments = task[resourceAssignmentsProperty] || resourceAssignmentsStore.find(function (a) {\r\n\t\t\treturn a.task_id == task.id;\r\n\t\t});\r\n\r\n\t\t_syncAssignments(task, storeAssignments);\r\n\t}\r\n\r\n\tfunction _syncOnTaskDelete(ids) {\r\n\t\tvar idsSearch = {};\r\n\t\tids.forEach(function (id) {\r\n\t\t\tidsSearch[id] = true;\r\n\t\t});\r\n\t\tvar taskResources = resourceAssignmentsStore.find(function (a) {\r\n\t\t\treturn idsSearch[a.task_id];\r\n\t\t});\r\n\t\ttaskResources.forEach(function (a) {\r\n\t\t\tresourceAssignmentsStore.removeItem(a.id);\r\n\t\t});\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\r\n\t\tif (gantt.config.process_resource_assignments) {\r\n\t\t\tgantt.attachEvent(\"onParse\", function () {\r\n\t\t\t\tgantt.silent(function () {\r\n\t\t\t\t\tresourceAssignmentsStore.clearAll();\r\n\t\t\t\t\tvar totalAssignments = [];\r\n\t\t\t\t\tgantt.eachTask(function (task) {\r\n\t\t\t\t\t\tif (task.type === gantt.config.types.project) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar assignments = _loadAssignmentsFromTask(task);\r\n\t\t\t\t\t\t_assignAssignments(task, assignments);\r\n\r\n\t\t\t\t\t\tassignments.forEach(function (a) {\r\n\t\t\t\t\t\t\ttotalAssignments.push(a);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\tresourceAssignmentsStore.parse(totalAssignments);\r\n\t\t\t\t});\r\n\r\n\t\t\t});\r\n\r\n\t\t\tvar batchUpdate = false;\r\n\t\t\tvar needUpdate = false;\r\n\t\t\tvar needUpdateFor = {};\r\n\t\t\tvar undoBatchCancel = false;\r\n\t\t\tgantt.attachEvent(\"onBeforeBatchUpdate\", function(){\r\n\t\t\t\tbatchUpdate = true;\r\n\t\t\t});\r\n\t\t\tgantt.attachEvent(\"onAfterBatchUpdate\", function(){\r\n\t\t\t\t\r\n\t\t\t\tif(needUpdate){\r\n\t\t\t\t\tvar assignmentsHash = {};\r\n\t\t\t\t\tfor(var i in needUpdateFor){\r\n\t\t\t\t\t\tassignmentsHash[i] = gantt.getTaskAssignments(needUpdateFor[i].id);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// GS-2546. If we add a task that has the data in the old format,\r\n\t\t\t\t\t// we need to reset the cache as the assignment will be added\r\n\t\t\t\t\t// to the assignment store, but the cache won't have the changes\r\n\t\t\t\t\tif (gantt.config.process_resource_assignments && resourceAssignmentFormat === \"resourceValueArray\"){\r\n\t\t\t\t\t\ttaskAssignmentsCache = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor(var i in needUpdateFor){\r\n\t\t\t\t\t\t_syncAssignments(needUpdateFor[i], assignmentsHash[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tneedUpdate = false;\r\n\t\t\t\tbatchUpdate = false;\r\n\t\t\t\tneedUpdateFor = {};\r\n\t\t\t});\r\n\r\n\t\t\tgantt.attachEvent(\"onTaskCreated\", function (item) {\r\n\t\t\t\tvar assignments = _loadAssignmentsFromTask(item);\r\n\t\t\t\tresourceAssignmentsStore.parse(assignments);\r\n\t\t\t\t_assignAssignments(item, assignments);\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t\tgantt.attachEvent(\"onAfterTaskUpdate\", function (id, item) {\r\n\t\t\t\tif(batchUpdate){\r\n\t\t\t\t\tneedUpdate = true;\r\n\t\t\t\t\tneedUpdateFor[id] = item;\r\n\t\t\t\t}else if (!item.unscheduled){\r\n\t\t\t\t\t_syncOnTaskUpdate(item);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tgantt.attachEvent(\"onAfterTaskAdd\", function (id, item) {\r\n\t\t\t\tif(batchUpdate){\r\n\t\t\t\t\tneedUpdate = true;\r\n\t\t\t\t\tneedUpdateFor[id] = item;\r\n\t\t\t\t}else{\r\n\t\t\t\t\t_syncOnTaskUpdate(item);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t/*\tgantt.attachEvent(\"onRowDragMove\", function (id) {\r\n\t\t\t\t_syncOnTaskUpdate(gantt.getTask(id));\r\n\t\t\t});*/\r\n\t\t\tgantt.attachEvent(\"onRowDragEnd\", function (id) {\r\n\t\t\t\t_syncOnTaskUpdate(gantt.getTask(id));\r\n\t\t\t});\r\n\t\t\tgantt.$data.tasksStore.attachEvent(\"onAfterDeleteConfirmed\", function (id, item) {\r\n\t\t\t\tvar deleteIds = [id];\r\n\t\t\t\tgantt.eachTask(function (task) {\r\n\t\t\t\t\tdeleteIds.push(task.id);\r\n\t\t\t\t}, id);\r\n\t\t\t\t_syncOnTaskDelete(deleteIds);\r\n\t\t\t});\r\n\t\t\tgantt.$data.tasksStore.attachEvent(\"onClearAll\", function () {\r\n\t\t\t\tresourceAssignmentsCache = null;\r\n\t\t\t\tresourceTaskAssignmentsCache = null;\r\n\t\t\t\ttaskAssignmentsCache = null;\r\n\t\t\t\tresourceAssignmentsStore.clearAll();\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t\tgantt.attachEvent(\"onTaskIdChange\", function (id, new_id) {\r\n\t\t\t\tvar taskResources = resourceAssignmentsStore.find(function (a) {\r\n\t\t\t\t\treturn a.task_id == id;\r\n\t\t\t\t});\r\n\t\t\t\ttaskResources.forEach(function (a) {\r\n\t\t\t\t\ta.task_id = new_id;\r\n\t\t\t\t\tresourceAssignmentsStore.updateItem(a.id);\r\n\t\t\t\t});\r\n\t\t\t\t_updateTaskBack(new_id);\r\n\t\t\t\t//any custom logic here\r\n\t\t\t});\r\n\t\t\t// GS-2144. When we Undo something, the cache should be reset\r\n\t\t\t// during the `onStoreUpdated` event to properly update the assignments\r\n\t\t\tgantt.attachEvent(\"onBeforeUndo\", function (action) {\r\n\t\t\t\tundoBatchCancel = true;\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t\tgantt.attachEvent(\"onAfterUndo\", function (action) {\r\n\t\t\t\tundoBatchCancel = true;\r\n\t\t\t});\r\n\r\n\r\n\t\t\tvar resourceAssignmentsCache = null;\r\n\t\t\tvar resourceTaskAssignmentsCache = null;\r\n\t\t\tvar taskAssignmentsCache = null;\r\n\r\n\t\t\tresourceAssignmentsStore.attachEvent(\"onStoreUpdated\", function resetCache(){\r\n\t\t\t\tif(batchUpdate && !undoBatchCancel){\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\tresourceAssignmentsCache = null;\r\n\t\t\t\tresourceTaskAssignmentsCache = null;\r\n\t\t\t\ttaskAssignmentsCache = null;\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\r\n\t\t\tgantt.getResourceAssignments = function (resourceId, taskId) {\r\n\t\t\t\tvar searchTaskId = gantt.defined(taskId) && taskId !== null;\r\n\r\n\t\t\t\tif(resourceAssignmentsCache === null){\r\n\t\t\t\t\tresourceAssignmentsCache = {};\r\n\t\t\t\t\tresourceTaskAssignmentsCache = {};\r\n\r\n\t\t\t\t\tresourceAssignmentsStore.eachItem(function (a) {\r\n\t\t\t\t\t\tif(!resourceAssignmentsCache[a.resource_id]){\r\n\t\t\t\t\t\t\tresourceAssignmentsCache[a.resource_id] = [];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tresourceAssignmentsCache[a.resource_id].push(a);\r\n\r\n\t\t\t\t\t\tvar resourceTaskCacheKey = a.resource_id + \"-\" + a.task_id;\r\n\t\t\t\t\t\tif(!resourceTaskAssignmentsCache[resourceTaskCacheKey]){\r\n\t\t\t\t\t\t\tresourceTaskAssignmentsCache[resourceTaskCacheKey] = [];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tresourceTaskAssignmentsCache[resourceTaskCacheKey].push(a);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tif(searchTaskId){\r\n\t\t\t\t\treturn (resourceTaskAssignmentsCache[resourceId + \"-\" + taskId] || []).slice();\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn (resourceAssignmentsCache[resourceId] || []).slice();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t\r\n\t\t\tgantt.getTaskAssignments = function (taskId) {\r\n\t\t\t\tif(taskAssignmentsCache === null){\r\n\t\t\t\t\tvar result = [];\r\n\t\t\t\t\ttaskAssignmentsCache = {};\r\n\t\t\t\t\tresourceAssignmentsStore.eachItem(function (a) {\r\n\t\t\t\t\t\tif(!taskAssignmentsCache[a.task_id]){\r\n\t\t\t\t\t\t\ttaskAssignmentsCache[a.task_id] = [];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttaskAssignmentsCache[a.task_id].push(a);\r\n\t\t\t\t\t\tif (a.task_id == taskId) {\r\n\t\t\t\t\t\t\tresult.push(a);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn (taskAssignmentsCache[taskId] || []).slice();\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tgantt.getTaskResources = function (taskId) {\r\n\t\t\t\tconst store = gantt.getDatastore(\"resource\");\r\n\t\t\t\tconst assignments = gantt.getTaskAssignments(taskId);\r\n\t\r\n\t\t\t\tconst uniqueResources = {};\r\n\t\t\t\tassignments.forEach(function(a){\r\n\t\t\t\t\tif(!uniqueResources[a.resource_id]){\r\n\t\t\t\t\t\tuniqueResources[a.resource_id] = a.resource_id;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tconst resources = [];\r\n\t\t\t\tfor(const i in uniqueResources){\r\n\t\t\t\t\tconst res = store.getItem(uniqueResources[i]);\r\n\t\t\t\t\tif(res){\r\n\t\t\t\t\t\tresources.push(res);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn resources;\r\n\t\t\t};\r\n\r\n\t\t\tgantt.updateTaskAssignments = _updateTaskBack;\r\n\t\t}\r\n\t}, {once: true});\r\n};","export default function addPlaceholder(gantt){\r\n\tfunction isEnabled(){\r\n\t\treturn gantt.config.placeholder_task;\r\n\t}\r\n\r\n\tfunction callIfEnabled(callback){\r\n\t\treturn function(){\r\n\t\t\tif(!isEnabled()){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn callback.apply(this, arguments);\r\n\t\t};\r\n\t}\r\n\r\n\tfunction silenceDataProcessor(dataProcessor){\r\n\t\tif(dataProcessor && !dataProcessor._silencedPlaceholder){\r\n\t\t\tdataProcessor._silencedPlaceholder = true;\r\n\t\t\tdataProcessor.attachEvent(\"onBeforeUpdate\", callIfEnabled(function(id, state, data){\r\n\t\t\t\tif(data.type == gantt.config.types.placeholder){\r\n\t\t\t\t\tdataProcessor.setUpdated(id, false);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}));\r\n\t\t}\r\n\t}\r\n\r\n\tfunction insertPlaceholder(){\r\n\t\tvar placeholders = gantt.getTaskBy(\"type\", gantt.config.types.placeholder);\r\n\t\tif(!placeholders.length || !gantt.isTaskExists(placeholders[0].id)){\r\n\t\t\tvar placeholder = {\r\n\t\t\t\tunscheduled: true,\r\n\t\t\t\ttype: gantt.config.types.placeholder,\r\n\t\t\t\tduration:0,\r\n\t\t\t\ttext: gantt.locale.labels.new_task\r\n\t\t\t};\r\n\t\t\tif(gantt.callEvent(\"onTaskCreated\", [placeholder]) === false){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tgantt.addTask(placeholder);\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n\r\n\tfunction afterEdit(id){\r\n\t\tvar item = gantt.getTask(id);\r\n\t\tif(item.type == gantt.config.types.placeholder) {\r\n\t\t\tif(item.start_date && item.end_date && item.unscheduled){\r\n\t\t\t\titem.unscheduled = false;\r\n\t\t\t}\r\n\r\n\t\t\tgantt.batchUpdate(function(){\r\n\t\t\t\tvar newTask = gantt.copy(item);\r\n\t\t\t\tgantt.silent(function(){\r\n\t\t\t\t\tgantt.deleteTask(item.id);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tdelete newTask[\"!nativeeditor_status\"];\r\n\t\t\t\tnewTask.type = gantt.config.types.task;\r\n\t\t\t\tnewTask.id = gantt.uid();\r\n\t\t\t\tgantt.addTask(newTask);\r\n\r\n\t\t\t\t//insertPlaceholder();\r\n\t\t\t});\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tgantt.config.types.placeholder = \"placeholder\";\r\n\tgantt.attachEvent(\"onDataProcessorReady\", callIfEnabled(silenceDataProcessor));\r\n\r\n\tvar ready = false;\r\n\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\t\tif(ready){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tready = true;\r\n\t\tgantt.attachEvent(\"onAfterTaskUpdate\", callIfEnabled(afterEdit));\r\n\t\tgantt.attachEvent(\"onAfterTaskAdd\", callIfEnabled(function(id, task){\r\n\t\t\tif(task.type != gantt.config.types.placeholder){\r\n\t\t\t\tvar placeholders = gantt.getTaskBy(\"type\", gantt.config.types.placeholder);\r\n\t\t\t\tplaceholders.forEach(function(p){\r\n\t\t\t\t\tgantt.silent(function(){\r\n\t\t\t\t\t\tif(gantt.isTaskExists(p.id))\r\n\t\t\t\t\t\t\tgantt.deleteTask(p.id);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\tinsertPlaceholder();\r\n\t\t\t}\r\n\t\t}));\r\n\t\tgantt.attachEvent(\"onParse\", callIfEnabled(insertPlaceholder));\r\n\t});\r\n\r\n\tfunction isPlaceholderTask(taskId){\r\n\t\tif(gantt.config.types.placeholder && gantt.isTaskExists(taskId)){\r\n\t\t\tvar task = gantt.getTask(taskId);\r\n\t\t\tif(task.type == gantt.config.types.placeholder){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tfunction isPlaceholderLink(link){\r\n\t\tif(isPlaceholderTask(link.source) || isPlaceholderTask(link.target)){\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tgantt.attachEvent(\"onLinkValidation\", function(link){\r\n\t\tif(isPlaceholderLink(link)){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t});\r\n\tgantt.attachEvent(\"onBeforeLinkAdd\", function(id,link){\r\n\t\tif(isPlaceholderLink(link)){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onBeforeUndoStack\", function(action){\r\n\t\tfor(var i = 0; i < action.commands.length; i++){\r\n\t\t\tvar command = action.commands[i];\r\n\t\t\tif(command.entity === \"task\" && command.value.type === gantt.config.types.placeholder){\r\n\t\t\t\taction.commands.splice(i,1);\r\n\t\t\t\ti--;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t});\r\n\r\n};","export default function(gantt) {\r\n\tfunction isEnabled() {\r\n\t\treturn gantt.config.auto_types && // if enabled\r\n\t\t\t(gantt.getTaskType(gantt.config.types.project) == gantt.config.types.project);// and supported\r\n\t}\r\n\r\n\tfunction callIfEnabled(callback) {\r\n\t\treturn function() {\r\n\t\t\tif (!isEnabled()) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn callback.apply(this, arguments);\r\n\t\t};\r\n\t}\r\n\r\n\tfunction checkTaskType(id, changedTypes) {\r\n\t\tvar task = gantt.getTask(id);\r\n\t\tvar targetType = getTaskTypeToUpdate(task);\r\n\t\tif (targetType !== false && gantt.getTaskType(task) !== targetType) {\r\n\t\t\tchangedTypes.$needsUpdate = true;\r\n\t\t\tchangedTypes[task.id] = {task: task, type: targetType};\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getUpdatedTypes(id, changedTypes) {\r\n\t\tchangedTypes = changedTypes || {};\r\n\t\t\r\n\t\tcheckTaskType(id, changedTypes);\r\n\t\tgantt.eachParent(function(parent) {\r\n\t\t\tcheckTaskType(parent.id, changedTypes);\r\n\t\t}, id);\r\n\r\n\t\treturn changedTypes;\r\n\t}\r\n\r\n\tfunction applyChanges(changedTypes) {\r\n\t\tfor (var i in changedTypes) {\r\n\t\t\tif(changedTypes[i] && changedTypes[i].task){\r\n\t\t\t\tvar task = changedTypes[i].task;\r\n\t\t\t\ttask.type = changedTypes[i].type;\r\n\t\t\t\tgantt.updateTask(task.id);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction updateParentTypes(startId) {\r\n\t\tif (gantt.getState().group_mode) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar changedTypes = getUpdatedTypes(startId);\r\n\t\tif (changedTypes.$needsUpdate) {\r\n\t\t\tgantt.batchUpdate(function() {\r\n\t\t\t\tapplyChanges(changedTypes);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tvar delTaskParent;\r\n\r\n\tfunction updateTaskType(task, targetType) {\r\n\t\tif(!gantt.getState().group_mode){\r\n\t\t\ttask.type = targetType;\r\n\t\t\tgantt.updateTask(task.id);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getTaskTypeToUpdate(task) {\r\n\t\tvar allTypes = gantt.config.types;\r\n\t\tvar hasChildren = gantt.hasChild(task.id);\r\n\t\tvar taskType = gantt.getTaskType(task.type);\r\n\r\n\t\tif (hasChildren && taskType === allTypes.task) {\r\n\t\t\treturn allTypes.project;\r\n\t\t}\r\n\r\n\t\tif (!hasChildren && taskType === allTypes.project) {\r\n\t\t\treturn allTypes.task;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tvar isParsingDone = true;\r\n\r\n\tgantt.attachEvent(\"onParse\", callIfEnabled(function() {\r\n\t\tisParsingDone = false;\r\n\t\tif(gantt.getState().group_mode){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tgantt.batchUpdate(function() {\r\n\t\t\tgantt.eachTask(function(task) {\r\n\t\t\t\tvar targetType = getTaskTypeToUpdate(task);\r\n\t\t\t\tif (targetType !== false) {\r\n\t\t\t\t\tupdateTaskType(task, targetType);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tisParsingDone = true;\r\n\t}));\r\n\r\n\tgantt.attachEvent(\"onAfterTaskAdd\", callIfEnabled(function(id) {\r\n\t\tif (isParsingDone) {\r\n\t\t\tupdateParentTypes(id);\r\n\t\t}\r\n\t}));\r\n\r\n\tgantt.attachEvent(\"onAfterTaskUpdate\", callIfEnabled(function(id) {\r\n\t\tif (isParsingDone) {\r\n\t\t\tupdateParentTypes(id);\r\n\t\t}\r\n\t}));\r\n\r\n\tfunction updateAfterRemoveChild(id){\r\n\t\tif (id != gantt.config.root_id && gantt.isTaskExists(id)) {\r\n\t\t\tupdateParentTypes(id);\r\n\t\t}\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onBeforeTaskDelete\", callIfEnabled(function(id, task) {\r\n\t\tdelTaskParent = gantt.getParent(id);\r\n\t\treturn true;\r\n\t}));\r\n\r\n\tgantt.attachEvent(\"onAfterTaskDelete\", callIfEnabled(function(id, task) {\r\n\t\tupdateAfterRemoveChild(delTaskParent);\r\n\t}));\r\n\r\n\r\n\tvar originalRowDndParent;\r\n\r\n\tgantt.attachEvent(\"onRowDragStart\", callIfEnabled(function(id, target, e) {\r\n\t\toriginalRowDndParent = gantt.getParent(id);\r\n\t\treturn true;\r\n\t}));\r\n\r\n\tgantt.attachEvent(\"onRowDragEnd\", callIfEnabled(function(id, target) {\r\n\t\tupdateAfterRemoveChild(originalRowDndParent);\r\n\t\tupdateParentTypes(id);\r\n\t}));\r\n\r\n\tvar originalMoveTaskParent;\r\n\r\n\tgantt.attachEvent(\"onBeforeTaskMove\", callIfEnabled(function(sid, parent, tindex) {\r\n\t\toriginalMoveTaskParent = gantt.getParent(sid);\r\n\t\treturn true;\r\n\t}));\r\n\r\n\tgantt.attachEvent(\"onAfterTaskMove\", callIfEnabled(function(id, parent, tindex) {\r\n\t\tif (document.querySelector(\".gantt_drag_marker\")) {\r\n\t\t\t// vertical dnd in progress\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tupdateAfterRemoveChild(originalMoveTaskParent);\r\n\t\tupdateParentTypes(id);\r\n\t}));\r\n};","export default class DurationFormatterNumeric implements IDurationFormatter {\r\n\tstatic create = (settings: IDurationFormatterConfig = null): IDurationFormatter => {\r\n\t\treturn new DurationFormatterNumeric();\r\n\t};\r\n\tcanParse = (value: string) : boolean => {\r\n\t\treturn !isNaN(this.parse(value));\r\n\t};\r\n\tformat = (value: number) : string => {\r\n\t\treturn String(value);\r\n\t};\r\n\tparse = (value: string) : number => {\r\n\t\treturn parseInt(value, 10);\r\n\t};\r\n}","export default class LinkFormatterSimple implements ILinkFormatter {\r\n\tstatic create = (settings: ILinkFormatterConfig = null, gantt: any): LinkFormatterSimple => {\r\n\t\treturn new LinkFormatterSimple(gantt);\r\n\t};\r\n\tprotected _linkReg: RegExp;\r\n\tprotected _gantt: any;\r\n\r\n\tconstructor(gantt: any) {\r\n\t\tthis._linkReg = /^[0-9\\.]+/;\r\n\t\tthis._gantt = gantt;\r\n\t}\r\n\r\n\tformat = (link: ILink) : string => {\r\n\t\tconst wbs = this._getWBSCode(link.source);\r\n\t\treturn wbs;\r\n\t};\r\n\r\n\tcanParse = (value: string) : boolean => {\r\n\t\treturn this._linkReg.test(value);\r\n\t};\r\n\tparse = (value: string) : ILink => {\r\n\t\tif(!this.canParse(value)){\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst linkPart = this._linkReg.exec(value)[0].trim();\r\n\r\n\t\tconst source = this._findSource(linkPart) || null;\r\n\r\n\t\treturn {\r\n\t\t\tid: undefined,\r\n\t\t\tsource,\r\n\t\t\ttarget: null,\r\n\t\t\ttype: this._gantt.config.links.finish_to_start,\r\n\t\t\tlag: 0\r\n\t\t};\r\n\t};\r\n\r\n\tprotected _getWBSCode = (source: number | string) => {\r\n\t\tconst pred = this._gantt.getTask(source);\r\n\t\treturn this._gantt.getWBSCode(pred);\r\n\t};\r\n\r\n\tprotected _findSource = (value: string) => {\r\n\t\tconst reqTemplate = new RegExp(\"^[0-9\\.]+\", \"i\");\r\n\t\tif(reqTemplate.exec(value)){\r\n\t\t\tconst wbs = reqTemplate.exec(value)[0];\r\n\t\t\tconst task = this._gantt.getTaskByWBSCode(wbs);\r\n\t\t\tif(task){\r\n\t\t\t\treturn task.id;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n}","\r\nimport DurationFormatter from \"../common/duration_formatter\";\r\nimport LinkFormatter from \"../common/link_formatter\";\r\n\r\nexport default function(gantt){\r\n\tgantt.ext.formatters = {\r\n\t\tdurationFormatter: function(settings){\r\n\t\t\tif(!settings){\r\n\t\t\t\tsettings = {};\r\n\t\t\t}\r\n\t\t\tif(!settings.store){\r\n\t\t\t\tsettings.store = gantt.config.duration_unit;\r\n\t\t\t}\r\n\t\t\tif(!settings.enter){\r\n\t\t\t\tsettings.enter = gantt.config.duration_unit;\r\n\t\t\t}\r\n\t\t\treturn DurationFormatter.create(settings, gantt);\r\n\t\t},\r\n\t\tlinkFormatter: function(settings){\r\n\t\t\treturn LinkFormatter.create(settings, gantt);\r\n\t\t}\r\n\t};\r\n};","export default function(gantt: any){\r\n\r\n\tgantt.ext = gantt.ext || {};\r\n\tgantt.config.show_empty_state = false;\r\n\r\n\tgantt.ext.emptyStateElement = gantt.ext.emptyStateElement || {\r\n\t\tisEnabled() {\r\n\t\t\treturn gantt.config.show_empty_state === true;\r\n\t\t},\r\n\t\tisGanttEmpty(){\r\n\t\t\treturn !gantt.getTaskByTime().length;\r\n\t\t},\r\n\t\trenderContent(container){\r\n\t\t\tconst placeholderTextElement = `<div class='gantt_empty_state_text'>\r\n    <div class='gantt_empty_state_text_link' data-empty-state-create-task>${gantt.locale.labels.empty_state_text_link}</div>\r\n    <div class='gantt_empty_state_text_description'>${gantt.locale.labels.empty_state_text_description}</div>\r\n    </div>`;\r\n\t\t\tconst placeholderImageElement = \"<div class='gantt_empty_state_image'></div>\";\r\n\r\n\t\t\tconst placeholderContainer = `<div class='gantt_empty_state'>${placeholderImageElement}${placeholderTextElement}</div>`;\r\n\t\t\tcontainer.innerHTML = placeholderContainer;\r\n\t\t},\r\n\r\n\t\tclickEvents: [],\r\n\t\tattachAddTaskEvent(){\r\n\t\t\tconst id = gantt.attachEvent(\"onEmptyClick\", function(e){\r\n\t\t\t\tconst domHelpers = gantt.utils.dom;\r\n\t\t\t\tconst gridPlaceholder = domHelpers.closest(e.target, \"[data-empty-state-create-task]\");\r\n\t\t\t\tif (gridPlaceholder){\r\n\t\t\t\t\tgantt.createTask({\r\n\t\t\t\t\t\tid: gantt.uid(),\r\n\t\t\t\t\t\ttext: \"New Task\"\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis.clickEvents.push(id);\r\n\t\t},\r\n\t\tdetachAddTaskEvents(){\r\n\t\t\tthis.clickEvents.forEach(function(event){\r\n\t\t\t\tgantt.detachEvent(event);\r\n\t\t\t});\r\n\t\t\tthis.clickEvents = [];\r\n\t\t},\r\n\r\n\t\tgetContainer(){\r\n\t\t\tif (gantt.$container) {\r\n\t\t\t\tconst domHelpers = gantt.utils.dom;\r\n\t\t\t\tif (gantt.$container.contains(gantt.$grid_data)) {\r\n\t\t\t\t\treturn domHelpers.closest(gantt.$grid_data, \".gantt_layout_content\");\r\n\t\t\t\t}\r\n\t\t\t\tif (gantt.$container.contains(gantt.$task_data)){\r\n\t\t\t\t\treturn domHelpers.closest(gantt.$task_data, \".gantt_layout_content\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t},\r\n\r\n\t\tgetNode(){\r\n\t\t\tconst container = this.getContainer();\r\n\t\t\tif (!container){\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tconst emptyStateElementNode = container.querySelector(\".gantt_empty_state_wrapper\");\r\n\t\t\treturn emptyStateElementNode;\r\n\t\t},\r\n\r\n\t\tshow(){\r\n\t\t\tconst container = this.getContainer();\r\n\t\t\tif (!container && this.isGanttEmpty()){\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tconst wrapper = document.createElement(\"div\");\r\n\t\t\twrapper.className = \"gantt_empty_state_wrapper\";\r\n\t\t\twrapper.style.marginTop = (gantt.config.scale_height - container.offsetHeight) + \"px\";\r\n\t\t\tconst oldNodes = gantt.$container.querySelectorAll(\".gantt_empty_state_wrapper\");\r\n\t\t\t// for IE11\r\n\t\t\tArray.prototype.forEach.call(oldNodes, function(node){\r\n\t\t\t\tnode.parentNode.removeChild(node);\r\n\t\t\t});\r\n\r\n\t\t\tthis.detachAddTaskEvents();\r\n\t\t\tthis.attachAddTaskEvent();\r\n\r\n\t\t\tcontainer.appendChild(wrapper);\r\n\t\t\tthis.renderContent(wrapper);\r\n\t\t},\r\n\t\thide(){\r\n\t\t\tconst emptyStateElementNode = this.getNode();\r\n\t\t\tif (emptyStateElementNode){\r\n\t\t\t\temptyStateElementNode.parentNode.removeChild(emptyStateElementNode);\r\n\t\t\t} else{\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tinit(){ }\r\n\t};\r\n\r\n\tgantt.attachEvent(\"onDataRender\", function() {\r\n\t\tconst emptyStateElement = gantt.ext.emptyStateElement;\r\n\t\tif (emptyStateElement.isEnabled() && emptyStateElement.isGanttEmpty()) {\r\n\t\t\temptyStateElement.show();\r\n\t\t} else {\r\n\t\t\temptyStateElement.hide();\r\n\t\t}\r\n\t});\r\n\r\n\r\n\r\n\r\n}\r\n","export const hasBaselinesBelow = function (gantt, task) {\r\n  const baselines = task.baselines && task.baselines.length;\r\n  const baselinesOnDifferentRow = gantt.config.baselines.render_mode == \"separateRow\" || gantt.config.baselines.render_mode == \"individualRow\";\r\n  if (baselines && baselinesOnDifferentRow) {\r\n    return true;\r\n  }\r\n};\r\n\r\nexport const childrenHaveBaselines = function (gantt, taskId) {\r\n  let hasBaselines = false;\r\n  gantt.eachTask(function (child) {\r\n    if (hasBaselines) {\r\n      return;\r\n    }\r\n    hasBaselines = hasBaselinesBelow(gantt, child);\r\n  }, taskId);\r\n  return hasBaselines;\r\n};\r\n\r\nexport const isSplitChild = function (gantt, id) {\r\n  let splitChild = false;\r\n  gantt.eachParent(function (parent) {\r\n    if (isSplitParent(parent)) {\r\n      splitChild = true;\r\n    }\r\n  }, id);\r\n  return splitChild;\r\n};\r\n\r\nexport const isSplitParent = function (task) {\r\n  return task.render && task.render == \"split\" && !task.$open;\r\n};\r\n\r\nexport const getMaxParentHeight = function (gantt, view, task, heightLimit) {\r\n  let maxHeight = heightLimit || view.$task_data.scrollHeight;\r\n  let shrinkHeight = false;\r\n  let splitChild = false;\r\n\r\n  gantt.eachParent(function (parent) {\r\n    if (isSplitParent(parent)) {\r\n      splitChild = true;\r\n      const parentSizes = view.getItemPosition(parent);\r\n      const parentHeight = parentSizes.rowHeight;\r\n      if (parentHeight < maxHeight) {\r\n        maxHeight = parentHeight;\r\n        shrinkHeight = true;\r\n      }\r\n    }\r\n  }, task.id);\r\n\r\n  return { maxHeight, shrinkHeight, splitChild };\r\n};\r\n\r\nexport const getMilestoneHeight = function (height) {\r\n  return Math.sqrt(2 * height * height);\r\n};\r\n\r\nexport const getInvertedMilestoneHeight = function (height) {\r\n  return Math.round(height / Math.sqrt(2));\r\n};\r\n\r\nexport const getAdjustedPosition = function (gantt, timeline, sizes, heightLimit, task, childBaselines) {\r\n  const baselines = hasBaselinesBelow(gantt, task);\r\n\r\n  const splitParams = getMaxParentHeight(gantt, timeline, task);\r\n  let maxHeight = splitParams.maxHeight;\r\n\r\n  let height = sizes.height;\r\n  let largerHeight = height > heightLimit;\r\n  let noNeedToShrink = sizes.rowHeight >= heightLimit && !splitParams.splitChild && !baselines;\r\n  if (largerHeight || noNeedToShrink) {\r\n    height = heightLimit;\r\n  }\r\n\r\n  if (maxHeight < height) {\r\n    height = maxHeight;\r\n  }\r\n\r\n  let marginTop = Math.floor((sizes.rowHeight - height) / 2);\r\n\r\n  if (splitParams.splitChild) {\r\n    marginTop = Math.floor((maxHeight - height) / 2);\r\n  }\r\n  if (childBaselines || baselines) {\r\n    let heightDiff = Math.min(sizes.height, maxHeight) - height;\r\n\r\n    let additionalMargin = 2;\r\n    let exceedBarHeight = baselines && task.bar_height >= task.row_height;\r\n    let exceedParentHeight = splitParams.splitChild && sizes.height >= maxHeight;\r\n    if (exceedBarHeight || exceedParentHeight){\r\n      additionalMargin = 0;\r\n    }\r\n\r\n    marginTop = Math.floor(heightDiff / 2) + additionalMargin;\r\n    const bottom = height + marginTop;\r\n    if (bottom > sizes.rowHeight || bottom > maxHeight) {\r\n      // marginTop = 0;\r\n    }\r\n  }\r\n\r\n  return { height, marginTop };\r\n};\r\n\r\nexport default {\r\n  hasBaselinesBelow,\r\n  childrenHaveBaselines,\r\n  isSplitChild,\r\n  isSplitParent,\r\n  getMaxParentHeight,\r\n  getMilestoneHeight,\r\n  getInvertedMilestoneHeight,\r\n  getAdjustedPosition\r\n};\r\n","import { hasBaselinesBelow, isSplitParent } from \"../ui/render/baseline_helper\";\r\nimport isHeadless from \"../../utils/is_headless\";\r\n\r\nexport default function (gantt) {\r\n  gantt.config.baselines = {\r\n    datastore: \"baselines\",\r\n    render_mode: false,\r\n    dataprocessor_baselines: false,\r\n    row_height: 16,\r\n    bar_height: 8\r\n  };\r\n\r\n  function initBaselineFields(item, task) {\r\n    // don't add baseline if it doesn't belong to any task\r\n    // or if doesn't have the dates\r\n    if (!item.task_id || (!item.start_date && !item.end_date)) {\r\n      return false;\r\n    }\r\n\r\n    if (item.start_date) {\r\n      item.start_date = gantt.date.parseDate(item.start_date, \"parse_date\");\r\n    } else {\r\n      item.start_date = null;\r\n    }\r\n\r\n    if (item.end_date) {\r\n      item.end_date = gantt.date.parseDate(item.end_date, \"parse_date\");\r\n    } else {\r\n      item.end_date = null;\r\n    }\r\n\r\n    // set min baseline duration\r\n    item.duration = item.duration || 1;\r\n\r\n    // GS-2636. Calculate the 3rd date parameter basing on existing date parameters\r\n    if (item.start_date && !item.end_date){\r\n      item.end_date = gantt.calculateEndDate(item.start_date, item.duration);\r\n    } else if (item.end_date && !item.start_date){\r\n      item.start_date = gantt.calculateEndDate(item.end_date, -item.duration);\r\n    } \r\n  }\r\n  // gantt init\r\n  const baselineStore = gantt.createDatastore({\r\n    name: gantt.config.baselines.datastore,\r\n    initItem: function (item) {\r\n      if (!item.id) {\r\n        item.id = gantt.uid();\r\n      }\r\n\r\n      initBaselineFields(item);\r\n\r\n      return item;\r\n    }\r\n  });\r\n\r\n  gantt.$data.baselineStore = baselineStore;\r\n\r\n  function _syncBaselines(task) {\r\n    let shouldRepaint = false;\r\n    const iteratedBaselines = {};\r\n\r\n    const taskBaselines = task.baselines || [];\r\n    const existingBaselines = gantt.getTaskBaselines(task.id);\r\n\r\n    if (taskBaselines.length != existingBaselines.length) {\r\n      shouldRepaint = true;\r\n    }\r\n\r\n    taskBaselines.forEach(function (baseline) {\r\n      iteratedBaselines[baseline.id] = true;\r\n      const exisingBaseline = baselineStore.getItem(baseline.id);\r\n      if (exisingBaseline) {\r\n        const start = +exisingBaseline.start_date !== +baseline.start_date;\r\n        const end = +exisingBaseline.end_date !== +baseline.end_date;\r\n        if (start || end) {\r\n          baselineStore.updateItem(baseline.id, baseline);\r\n        }\r\n      } else {\r\n        baselineStore.addItem(baseline);\r\n      }\r\n    });\r\n\r\n    existingBaselines.forEach(function (baseline) {\r\n      if (!iteratedBaselines[baseline.id]) {\r\n        baselineStore.removeItem(baseline.id);\r\n      }\r\n    });\r\n\r\n    if (shouldRepaint) {\r\n      if (isSplitParent(task)){\r\n        // here we adjust the parent height, then adjust it with the total child height\r\n        _adjustSplitParentHeight (task);\r\n      } else {\r\n        gantt.adjustTaskHeightForBaselines(task);\r\n      }\r\n      gantt.render();\r\n    }\r\n  }\r\n\r\n  function _deleteOrphanBaselines() {\r\n    baselineStore.eachItem(function (baseline) {\r\n      if (!gantt.isTaskExists(baseline.task_id)) {\r\n        baselineStore.removeItem(baseline.id);\r\n      }\r\n    });\r\n  }\r\n\r\n  function _adjustSplitParentHeight (task){\r\n    let maxParentHeight = 0;\r\n\r\n    gantt.adjustTaskHeightForBaselines(task);\r\n\r\n    gantt.eachTask(function(child){\r\n      let childHeight = child.row_height || gantt.config.row_height;\r\n\r\n      maxParentHeight = maxParentHeight || childHeight;\r\n      if (childHeight > maxParentHeight){\r\n        maxParentHeight = childHeight;\r\n      }\r\n    }, task.id);\r\n\r\n    if (task.row_height < maxParentHeight){\r\n      task.row_height = maxParentHeight;\r\n    }\r\n  }\r\n\r\n  gantt.adjustTaskHeightForBaselines = function (task) {\r\n    let height, baselineSize, betweenBaselines;\r\n    let margins = 2;\r\n    let baselineAmount = task.baselines && task.baselines.length || 0;\r\n    const subrowHeight = gantt.config.baselines.row_height;\r\n    //const baselineBarHeight = task?.baselines.bar_height\r\n\r\n    const timelineView = gantt.getLayoutView(\"timeline\");\r\n    if (!timelineView || !gantt.config.show_chart){\r\n      return;\r\n    }\r\n\r\n    switch (gantt.config.baselines.render_mode) {\r\n      case \"taskRow\":\r\n        task.row_height = task.bar_height + 8;\r\n        break;\r\n\r\n      case \"separateRow\":\r\n        height = timelineView.getBarHeight(task.id);\r\n        if (baselineAmount) {\r\n          task.bar_height = task.bar_height || height;\r\n\r\n          if (task.bar_height > height){\r\n            height = task.bar_height;\r\n          }\r\n\r\n          task.row_height = height + subrowHeight;\r\n        } else if (task.bar_height) {\r\n          task.row_height = task.bar_height + 4;\r\n        }\r\n\r\n        _increaseSplitParentHeight(task);\r\n        break;\r\n\r\n      case \"individualRow\":\r\n        height = timelineView.getBarHeight(task.id);\r\n\r\n        if (baselineAmount) {\r\n          task.bar_height = task.bar_height || height;\r\n\r\n          if (task.bar_height > height){\r\n            height = task.bar_height;\r\n          }\r\n\r\n          baselineSize = subrowHeight * baselineAmount;\r\n       //   betweenBaselines = 3 * (baselineAmount + 1);\r\n\r\n          task.row_height = height + baselineSize + margins;\r\n        } else if (task.bar_height){\r\n          task.row_height = task.bar_height + 4;\r\n        }\r\n\r\n        _increaseSplitParentHeight(task);\r\n        break;\r\n      default:\r\n        task.row_height = task.bar_height + 8;\r\n        break;\r\n    }\r\n  };\r\n\r\n  function _increaseSplitParentHeight(task) {\r\n    gantt.eachParent(function (parent) {\r\n      if (isSplitParent(parent)) {\r\n        const parentHeight = parent.row_height || gantt.getLayoutView(\"timeline\").getBarHeight(parent.id);\r\n        let maxHeight = task.row_height;\r\n\r\n        // iterate only direct children\r\n        const subtasks = gantt.getChildren(parent.id);\r\n        subtasks.forEach(function (subtaskId) {\r\n          const subtask = gantt.getTask(subtaskId);\r\n          if (subtask.id == task.id) {\r\n            return;\r\n          }\r\n          const subtaskHeight = subtask.row_height || gantt.getLayoutView(\"timeline\").getBarHeight(subtask.id);\r\n          maxHeight = maxHeight || subtaskHeight;\r\n          if (subtaskHeight > maxHeight) {\r\n            maxHeight = subtaskHeight;\r\n          }\r\n        });\r\n\r\n        parent.row_height = maxHeight;\r\n        parent.bar_height = parent.bar_height || parentHeight;\r\n      }\r\n    }, task.id);\r\n  }\r\n\r\n  function _addBaselinesToTask(baseline){\r\n    const taskId = baseline.task_id;\r\n    if (gantt.isTaskExists(taskId)) {\r\n      const task = gantt.getTask(taskId);\r\n\r\n      task.baselines = task.baselines || [];\r\n\r\n      let newBaseline = true;\r\n      for (let i = 0; i < task.baselines.length; i++) {\r\n        let existingBaseline = task.baselines[i];\r\n        if (existingBaseline.id == baseline.id){\r\n          newBaseline = false;\r\n          gantt.mixin(existingBaseline, baseline, true);\r\n          break;\r\n        }\r\n      }\r\n      if (newBaseline){\r\n        task.baselines.push(baseline);\r\n      }\r\n\r\n      if(!isHeadless(gantt)){\r\n        if (isSplitParent(task)){\r\n          _adjustSplitParentHeight (task);\r\n        } else {\r\n          gantt.adjustTaskHeightForBaselines(task);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  gantt.attachEvent(\r\n    \"onGanttReady\",\r\n    function () {\r\n\r\n      if(!gantt.config.baselines){\r\n        return;\r\n      }\r\n\r\n      gantt.attachEvent(\"onParse\", function () {\r\n        baselineStore.eachItem(function (baseline) {\r\n          _addBaselinesToTask(baseline);\r\n        });\r\n      });\r\n\r\n      gantt.attachEvent(\"onBeforeTaskUpdate\", function (id, task) {\r\n        _syncBaselines(task);\r\n        return true;\r\n      });\r\n\r\n      gantt.attachEvent(\"onAfterUndo\", function(action){\r\n        const baselinesRenderedBelow = gantt.config.baselines.render_mode == \"separateRow\" || gantt.config.baselines.render_mode == \"individualRow\";\r\n        if (baselinesRenderedBelow && action){\r\n          let repaint = false;\r\n          action.commands.forEach(function(command){\r\n            if (command.entity == \"task\"){\r\n              const taskId = command.value.id;\r\n              if (gantt.isTaskExists(taskId)){\r\n                const task = gantt.getTask(taskId);\r\n                if (task.parent && gantt.isTaskExists(task.parent)){\r\n                  const parent = gantt.getTask(task.parent);\r\n                  if (isSplitParent(parent)){\r\n                    _adjustSplitParentHeight (parent);\r\n                    repaint = true;\r\n                  }\r\n                }\r\n              }    \r\n            }\r\n          });\r\n          if (repaint){\r\n            gantt.render();\r\n          }\r\n        }\r\n      });\r\n\r\n      gantt.attachEvent(\"onAfterTaskDelete\", function (id, task) {\r\n        if (hasBaselinesBelow){\r\n          if (task.parent && gantt.isTaskExists(task.parent)){\r\n            const parent = gantt.getTask(task.parent);\r\n            if (isSplitParent(parent)){\r\n              _adjustSplitParentHeight (parent);\r\n            }\r\n          }\r\n        }\r\n        _deleteOrphanBaselines();\r\n      });\r\n\r\n      gantt.getTaskBaselines = function (taskId) {\r\n        const baselines = [];\r\n        baselineStore.eachItem(function (baseline) {\r\n          if (baseline.task_id == taskId) {\r\n            baselines.push(baseline);\r\n          }\r\n        });\r\n        return baselines;\r\n      };\r\n      gantt.$data.baselineStore.attachEvent(\"onClearAll\", function () {\r\n        gantt.eachTask(function(task){\r\n          if (task.baselines){\r\n            delete task.baselines;\r\n          }\r\n        });\r\n        // The data should not be repainted as otherwise it causes issues when we have resource \r\n        // assignments and group tasks. It should be fixed when we add a repaint stack\r\n        // gantt.refreshData();\r\n        return true;\r\n      });\r\n      // GS-3170: case for adding with datastore\r\n      gantt.$data.baselineStore.attachEvent(\"onBeforeAdd\", function(id, item){\r\n        _addBaselinesToTask(item);\r\n      });\r\n      gantt.$data.tasksStore.attachEvent(\"onClearAll\", function () {\r\n        baselineStore.clearAll();\r\n        return true;\r\n      });\r\n      gantt.attachEvent(\"onTaskIdChange\", function (id, new_id) {\r\n        const baselines = baselineStore.find(function (a) {\r\n          return a.task_id == id;\r\n        });\r\n        baselines.forEach(function (a) {\r\n          a.task_id = new_id;\r\n          baselineStore.updateItem(a.id);\r\n        });\r\n      });\r\n    },\r\n    { once: true }\r\n  );\r\n};\r\n","import { Client } from \"remote-client\";\r\n\r\nexport default class RemoteEvents {\r\n\tprotected _remote: any;\r\n\tprotected _ready: Promise<any>;\r\n\r\n\tconstructor(url: string, token: string) {\r\n\t\tconst remote = new Client({\r\n\t\t\turl,\r\n\t\t\ttoken\r\n\t\t});\r\n\r\n\t\t// temporary patch, as we do not want credentials\r\n\t\tremote.fetch = function (url: string, body?: BodyInit) {\r\n\t\t\tconst req: RequestInit = {\r\n\t\t\t\theaders: this.headers()\r\n\t\t\t};\r\n\t\t\tif (body) {\r\n\t\t\t\treq.method = \"POST\";\r\n\t\t\t\treq.body = body;\r\n\t\t\t}\r\n\r\n\t\t\treturn fetch(url, req).then(res => res.json());\r\n\t\t};\r\n\r\n\t\tthis._ready = remote.load().then(back => (this._remote = back));\r\n\t}\r\n\r\n\tprotected ready() {\r\n\t\treturn this._ready;\r\n\t}\r\n\r\n\tprotected on(name: string | any, handler?: any) {\r\n\t\tthis.ready().then(back => {\r\n\t\t\tif (typeof name === \"string\") back.on(name, handler);\r\n\t\t\telse {\r\n\t\t\t\tfor (const key in name) {\r\n\t\t\t\t\tback.on(key, name[key]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n","function createHandlers(gantt) {\r\n\tlet updateQueue = [];\r\n\tlet updateTimeout = null;\r\n\tconst UPDATE_DELAY = 50;\r\n\r\n\tfunction remoteUpdates(message) {\r\n\t\tif (!message || !message.type || !(message.task?.id || message.link?.id)) {\r\n\t\t\t// eslint-disable-next-line no-console\r\n\t\t\tconsole.error(\"Invalid message format:\", message);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst { type, task, link } = message;\r\n\t\tif ((task && gantt._dp._in_progress[task.id]) || (link && gantt._dp._in_progress[link.id])) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (type === \"add-task\") {\r\n\t\t\tfor (const id in gantt._dp._in_progress) {\r\n\t\t\t\tif (gantt._dp.getState(id) === \"inserted\") {\r\n\t\t\t\t\tgantt._dp.attachEvent(\"onFullSync\", function () {\r\n\t\t\t\t\t\tif (!gantt.isTaskExists(task.id)) {\r\n\t\t\t\t\t\t\tprocessUpdate(message);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, { once: true });\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tupdateQueue.push(message);\r\n\t\tif (updateTimeout) clearTimeout(updateTimeout);\r\n\t\tupdateTimeout = setTimeout(processQueue, UPDATE_DELAY);\r\n\t}\r\n\r\n\tfunction processQueue() {\r\n\t\tif (updateQueue.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (updateQueue.length === 1) {\r\n\t\t\tprocessUpdate(updateQueue[0]);\r\n\t\t} else {\r\n\t\t\tgantt.batchUpdate(function () {\r\n\t\t\t\t\tupdateQueue.forEach(message => {\r\n\t\t\t\t\t\tprocessUpdate(message);\r\n\t\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tupdateQueue = [];\r\n\t}\r\n\r\n\tfunction processUpdate(message) {\r\n\t\tconst { type, task, link } = message;\r\n\t\tswitch (type) {\r\n\t\t\tcase \"add-task\":\r\n\t\t\t\thandleAddTask(task);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"update-task\":\r\n\t\t\t\thandleUpdateTask(task);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"delete-task\":\r\n\t\t\t\thandleDeleteTask(task);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"add-link\":\r\n\t\t\t\thandleAddLink(link);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"update-link\":\r\n\t\t\t\thandleUpdateLink(link);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"delete-link\":\r\n\t\t\t\thandleDeleteLink(link);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction ignore(code){\r\n\t\tif(gantt._dp){\r\n\t\t\tgantt._dp.ignore(code);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcode();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction handleAddTask(taskData) {\r\n\t\tif (gantt.isTaskExists(taskData.id)) {\r\n\t\t\t// eslint-disable-next-line no-console\r\n\t\t\tconsole.warn(`Task with ID ${taskData.id} already exists. Skipping add.`);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttaskData.start_date = gantt.templates.parse_date(taskData.start_date);\r\n\t\tif (taskData.end_date) taskData.end_date = gantt.templates.parse_date(taskData.end_date);\r\n\r\n\t\tignore(() => {\r\n\t\t\tgantt.addTask(taskData);\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tfunction handleUpdateTask(taskData) {\r\n\t\tconst sid = taskData.id;\r\n\r\n\t\tif (!gantt.getTask(sid)) {\r\n\t\t\t// eslint-disable-next-line no-console\r\n\t\t\tconsole.warn(`Task with ID ${sid} does not exist. Skipping update.`);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst initTask = gantt.getDatastore(\"task\").$initItem.bind(gantt.getDatastore(\"task\"));\r\n\r\n\t\tconst existingTask = gantt.getTask(sid);\r\n\r\n\t\tignore(() => {\r\n\r\n\t\t\tconst remoteTask = initTask(taskData);\r\n\t\t\t\r\n\t\t\tfor (let key in remoteTask) {\r\n\t\t\t\texistingTask[key] = remoteTask[key];\r\n\t\t\t}\r\n\t\t\t//Object.assign(existingTask, taskData);\r\n\t\t//\texistingTask.start_date = gantt.templates.parse_date(taskData.start_date);\r\n\t\t\t//if (existingTask.end_date && taskData.end_date) { \r\n\t\t\t//\texistingTask.end_date = gantt.templates.parse_date(taskData.end_date);\r\n\t\t\tif (!remoteTask.end_date) {\r\n\t\t\t\texistingTask.end_date = gantt.calculateEndDate(existingTask);\r\n\t\t\t}\r\n\r\n\t\t\tgantt.updateTask(sid);\r\n\r\n\t\t\tif (sid !== taskData.id) {\r\n\t\t\t\tgantt.changeTaskId(sid, taskData.id);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tfunction handleDeleteTask(taskData) {\r\n\t\tconst sid = taskData.id;\r\n\r\n\t\tif (!gantt.isTaskExists(sid)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tignore(() => {\r\n\t\t\tconst task = gantt.getTask(sid);\r\n\r\n\t\t\tif (task) {\r\n\t\t\t\t// handle unsaved edits in the lightbox\r\n\t\t\t\tif (gantt.getState().lightbox_id == sid) {\r\n\t\t\t\t\t//this._new_event = this._lightbox_id;\r\n\t\t\t\t\ttaskData.id = this._lightbox_id;\r\n\t\t\t\t\tlet currentTask = gantt.getTask(this._lightbox_id);\r\n\t\t\t\t\tcurrentTask = taskData;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// delete the task\r\n\t\t\t\tgantt.deleteTask(sid, true);\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tfunction handleAddLink(linkData) {\r\n\t\tif (gantt.isLinkExists(linkData.id)) {\r\n\t\t\t// eslint-disable-next-line no-console\r\n\t\t\tconsole.warn(`Link with ID ${linkData.id} already exists. Skipping add.`);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tignore(() => {\r\n\t\t\tgantt.addLink(linkData);\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tfunction handleUpdateLink(linkData) {\r\n\t\tconst sid = linkData.id;\r\n\r\n\t\tif (!gantt.isLinkExists(sid)) {\r\n\t\t\t// eslint-disable-next-line no-console\r\n\t\t\tconsole.warn(`Link with ID ${sid} does not exist. Skipping update.`);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst existingLink= gantt.getLink(sid);\r\n\r\n\t\tignore(() => {\r\n\t\t\tObject.assign(existingLink, linkData);\r\n\t\t\tgantt.updateLink(sid);\r\n\r\n\t\t\tif (sid !== linkData.id) {\r\n\t\t\t\tgantt.changeLinkId(sid, linkData.id);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tfunction handleDeleteLink(linkData) {\r\n\t\tconst sid = linkData.id;\r\n\r\n\t\tif (!gantt.getLink(sid)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tignore(() => {\r\n\t\t\tconst task = gantt.getLink(sid);\r\n\r\n\t\t\tif (task) {\r\n\t\t\t\t// handle unsaved edits in the lightbox\r\n\t\t\t\tif (gantt.getState().lightbox_id == sid) {\r\n\t\t\t\t\t//this._new_event = this._lightbox_id;\r\n\t\t\t\t\tlinkData.id = this._lightbox_id;\r\n\t\t\t\t\tlet currentTask = gantt.getLink(this._lightbox_id);\r\n\t\t\t\t\tcurrentTask = linkData;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// delete the link\r\n\t\t\t\tgantt.deleteLink(sid, true);\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t}\r\n\r\n\treturn {\r\n\t\ttasks: remoteUpdates,\r\n\t\tlinks: remoteUpdates\r\n\t};\r\n}\r\n\r\nexport default createHandlers;","import RemoteEvents from \"./remote_events\";\r\nimport createHandlers from \"./handlers\";\r\n\r\nexport default function remoteEvents(gantt) {\r\n\tif (!gantt.ext){\r\n\t\tgantt.ext = {};\r\n\t}\r\n\r\n\tgantt.ext.liveUpdates = {\r\n\t\tRemoteEvents,\r\n\t\tremoteUpdates: createHandlers(gantt)\r\n\t};\r\n}\r\n\r\n","import * as helpers from \"../../utils/helpers\";\r\n\r\nexport default function(gantt) {\r\n\tgantt.load = function(){\r\n\t\tthrow new Error(\"gantt.load() method is not available in the node.js, use gantt.parse() instead\");\r\n\t};\r\n\tgantt.parse = function (data, type) {\r\n\t\tthis.on_load({xmlDoc: {responseText: data}}, type);\r\n\t};\r\n\r\n\tgantt.serialize = function (type) {\r\n\t\ttype = type || \"json\";\r\n\t\treturn this[type].serialize();\r\n\t};\r\n\r\n\t/*\r\n\ttasks and relations\r\n\t{\r\n\tdata:[\r\n\t\t{\r\n\t\t\t\"id\":\"string\",\r\n\t\t\t\"text\":\"...\",\r\n\t\t\t\"start_date\":\"Date or string\",\r\n\t\t\t\"end_date\":\"Date or string\",\r\n\t\t\t\"duration\":\"number\",\r\n\t\t\t\"progress\":\"0..1\",\r\n\t\t\t\"parent_id\":\"string\",\r\n\t\t\t\"order\":\"number\"\r\n\t\t},...],\r\n\tlinks:[\r\n\t\t{\r\n\t\t\tid:\"string\",\r\n\t\t\tsource:\"string\",\r\n\t\t\ttarget:\"string\",\r\n\t\t\ttype:\"string\"\r\n\t\t},...],\r\n\tcollections:{\r\n\t\t\tcollectionName:[\r\n\t\t\t\t{key:, label:, optional:...},...\r\n\t\t\t],...\r\n\t\t}\r\n\t}\r\n\r\n\t* */\r\n\r\n\tgantt.on_load = function (resp, type) {\r\n\t\tif(resp.xmlDoc && resp.xmlDoc.status === 404){ // work if we don't have a file at current url\r\n\t\t\tthis.assert(false, \"Failed to load the data from <a href='\" + resp.xmlDoc.responseURL + \"' target='_blank'>\" \r\n\t\t\t\t+ resp.xmlDoc.responseURL + \"</a>, server returns 404\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(gantt.$destroyed){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.callEvent(\"onBeforeParse\", []);\r\n\t\tif (!type)\r\n\t\t\ttype = \"json\";\r\n\t\tthis.assert(this[type], \"Invalid data type:'\" + type + \"'\");\r\n\r\n\t\tvar raw = resp.xmlDoc.responseText;\r\n\r\n\t\tvar data = this[type].parse(raw, resp);\r\n\t\tthis._process_loading(data);\r\n\t};\r\n\r\n\tfunction attachAssignmentsToTasks(tasks, assignments) {\r\n\t\tconst assignmentsByTasks = {};\r\n\t\tassignments.forEach((a)=>{\r\n\t\t\tif(!assignmentsByTasks[a.task_id]) {\r\n\t\t\t\tassignmentsByTasks[a.task_id] = [];\r\n\t\t\t}\r\n\t\t\tassignmentsByTasks[a.task_id].push(a);\r\n\t\t});\r\n\t\ttasks.forEach((t) => {\r\n\t\t\tt[gantt.config.resource_property] = assignmentsByTasks[t.id] || [];\r\n\t\t});\t\r\n\t}\r\n\t\r\n\tgantt._process_loading = function (data) {\r\n\t\tif(data.collections)\r\n\t\t\tthis._load_collections(data.collections);\r\n\r\n\t\tif(data.resources && this.$data.resourcesStore){\r\n\t\t\tthis.$data.resourcesStore.parse(data.resources);\r\n\t\t}\r\n\t\tif(gantt.config.baselines && data.baselines && this.$data.baselineStore){\r\n\t\t\tthis.$data.baselineStore.parse(data.baselines);\r\n\t\t}\r\n\t\t\r\n\t\tconst tasks = data.data || data.tasks;\r\n\t\tif(data.assignments){\r\n\t\t\tattachAssignmentsToTasks(tasks && tasks.length ? tasks : gantt.getTasksByTime(), data.assignments);\r\n\t\t}\r\n\r\n\t\tif(tasks){\r\n\t\t\tthis.$data.tasksStore.parse(tasks);\r\n\t\t}\r\n\t\tvar links = data.links || ((data.collections && data.collections.links) ? data.collections.links : []);\r\n\t\tthis.$data.linksStore.parse(links);\r\n\r\n\t\t//this._sync_links();\r\n\t\tthis.callEvent(\"onParse\", []);\r\n\t\tthis.render();\r\n\t};\r\n\r\n\tgantt._load_collections = function (collections) {\r\n\t\tvar collections_loaded = false;\r\n\t\tfor (var key in collections) {\r\n\t\t\tif (collections.hasOwnProperty(key)) {\r\n\t\t\t\tcollections_loaded = true;\r\n\t\t\t\tvar collection = collections[key];\r\n\t\t\t\t// GS-1728. Create an empty serverList if it doesn't exist\r\n\t\t\t\tthis.serverList[key] = this.serverList[key] || [];\r\n\t\t\t\tvar arr = this.serverList[key];\r\n\t\t\t\tif (!arr) continue;\r\n\t\t\t\tarr.splice(0, arr.length); //clear old options\r\n\t\t\t\tfor (var j = 0; j < collection.length; j++) {\r\n\t\t\t\t\tvar option = collection[j];\r\n\t\t\t\t\tvar obj = this.copy(option);\r\n\t\t\t\t\tobj.key = obj.value;// resulting option object\r\n\r\n\t\t\t\t\tfor (var option_key in option) {\r\n\t\t\t\t\t\tif (option.hasOwnProperty(option_key)) {\r\n\t\t\t\t\t\t\tif (option_key == \"value\" || option_key == \"label\")\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\tobj[option_key] = option[option_key]; // obj['value'] = option['value']\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tarr.push(obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (collections_loaded)\r\n\t\t\tthis.callEvent(\"onOptionsLoad\", []);\r\n\t};\r\n\r\n\tgantt.attachEvent(\"onBeforeTaskDisplay\", function (id, task) {\r\n\t\treturn !task.$ignore;\r\n\t});\r\n\r\n\tfunction jsonParseError(data){\r\n\t\tgantt.assert(false, \"Can't parse data: incorrect value of gantt.parse or gantt.load method. \"\r\n\t\t\t+ \"Actual argument value: \" + JSON.stringify(data));\r\n\t\tthrow new Error(\"Invalid argument for gantt.parse or gantt.load. An object or a JSON string of format https://docs.dhtmlx.com/gantt/desktop__supported_data_formats.html#json is expected. Actual argument value: \"\r\n\t\t\t+ JSON.stringify(data));\r\n\t}\r\n\r\n\tgantt.json = {\r\n\t\tparse: function (data) {\r\n\t\t\tif(!data){\r\n\t\t\t\tjsonParseError(data);\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof data == \"string\") {\r\n\t\t\t\tif (typeof JSON != undefined){\r\n\t\t\t\t\ttry{\r\n\t\t\t\t\t\tdata = JSON.parse(data);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch(e) {\r\n\t\t\t\t\t\tjsonParseError(data);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tgantt.assert(false, \"JSON is not supported\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (data.dhx_security)\r\n\t\t\t\tgantt.security_key = data.dhx_security;\r\n\t\t\treturn data;\r\n\t\t},\r\n\t\tserializeTask: function (task) {\r\n\t\t\treturn this._copyObject(task);\r\n\t\t},\r\n\t\tserializeLink: function (link) {\r\n\t\t\treturn this._copyLink(link);\r\n\t\t},\r\n\t\t_copyLink: function (obj) {\r\n\t\t\tvar copy = {};\r\n\t\t\tfor (var key in obj)\r\n\t\t\t\tcopy[key] = obj[key];\r\n\t\t\treturn copy;\r\n\t\t},\r\n\t\t_copyObject: function (obj) {\r\n\t\t\tvar copy = {};\r\n\t\t\tfor (var key in obj) {\r\n\t\t\t\tif (key.charAt(0) == \"$\")\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\tcopy[key] = obj[key];\r\n\r\n\t\t\t\tif (helpers.isDate(copy[key])) {\r\n\t\t\t\t\tcopy[key] = gantt.defined(gantt.templates.xml_format) ? gantt.templates.xml_format(copy[key]) : gantt.templates.format_date(copy[key]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn copy;\r\n\t\t},\r\n\t\tserialize: function () {\r\n\t\t\tvar tasks = [];\r\n\t\t\tvar links = [];\r\n\t\t\tlet baselines = [];\r\n\r\n\t\t\tgantt.eachTask(function (obj) {\r\n\t\t\t\tgantt.resetProjectDates(obj);\r\n\t\t\t\ttasks.push(this.serializeTask(obj));\r\n\t\t\t}, gantt.config.root_id, this);\r\n\r\n\t\t\tvar rawLinks = gantt.getLinks();\r\n\t\t\tfor (var i = 0; i < rawLinks.length; i++) {\r\n\t\t\t\tlinks.push(this.serializeLink(rawLinks[i]));\r\n\t\t\t}\r\n\r\n\t\t\tconst baselineStore = gantt.getDatastore(\"baselines\");\r\n\t\t\tbaselineStore.eachItem(function(baseline){\r\n\t\t\t\tconst baselineCopy = gantt.json.serializeTask(baseline);\r\n\t\t\t\tbaselines.push(baselineCopy);\r\n\t\t\t});\r\n\r\n\t\t\treturn {\r\n\t\t\t\tdata: tasks,\r\n\t\t\t\tlinks,\r\n\t\t\t\tbaselines\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n\r\n\t/*\r\n\t<data>\r\n\t\t<task id:\"some\" parent_id=\"0\" progress=\"0.5\">\r\n\t\t\t<text>My task 1</text>\r\n\t\t\t<start_date>16.08.2013</start_date>\r\n\t\t\t<end_date>22.08.2013</end_date>\r\n\t\t</task>\r\n\t\t<coll_options>\r\n\t\t\t<links>\r\n\t\t\t\t<link source='a1' target='b2' type='c3' />\r\n\t\t\t</links>\r\n\t\t</coll_options>\r\n\t</data>\r\n\t*/\r\n\r\n\tfunction xmlParseError(data){\r\n\t\tgantt.assert(false, \"Can't parse data: incorrect value of gantt.parse or gantt.load method. \"\r\n\t\t\t+ \"Actual argument value: \" + JSON.stringify(data));\r\n\t\tthrow new Error(\"Invalid argument for gantt.parse or gantt.load. An XML of format https://docs.dhtmlx.com/gantt/desktop__supported_data_formats.html#xmldhtmlxgantt20 is expected. Actual argument value: \"\r\n\t\t\t+ JSON.stringify(data));\r\n\t}\r\n\r\n\tgantt.xml = {\r\n\t\t_xmlNodeToJSON: function (node, attrs_only) {\r\n\t\t\tvar t = {};\r\n\t\t\tfor (var i = 0; i < node.attributes.length; i++)\r\n\t\t\t\tt[node.attributes[i].name] = node.attributes[i].value;\r\n\r\n\t\t\tif (!attrs_only) {\r\n\t\t\t\tfor (var i = 0; i < node.childNodes.length; i++) {\r\n\t\t\t\t\tvar child = node.childNodes[i];\r\n\t\t\t\t\tif (child.nodeType == 1)\r\n\t\t\t\t\t\tt[child.tagName] = child.firstChild ? child.firstChild.nodeValue : \"\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!t.text) t.text = node.firstChild ? node.firstChild.nodeValue : \"\";\r\n\t\t\t}\r\n\r\n\t\t\treturn t;\r\n\t\t},\r\n\t\t_getCollections: function (loader) {\r\n\t\t\tvar collection = {};\r\n\t\t\tvar opts = gantt.ajax.xpath(\"//coll_options\", loader);\r\n\t\t\tfor (var i = 0; i < opts.length; i++) {\r\n\t\t\t\tvar bind = opts[i].getAttribute(\"for\");\r\n\t\t\t\tvar arr = collection[bind] = [];\r\n\t\t\t\tvar itms = gantt.ajax.xpath(\".//item\", opts[i]);\r\n\t\t\t\tfor (var j = 0; j < itms.length; j++) {\r\n\t\t\t\t\tvar itm = itms[j];\r\n\t\t\t\t\tvar attrs = itm.attributes;\r\n\t\t\t\t\tvar obj = {key: itms[j].getAttribute(\"value\"), label: itms[j].getAttribute(\"label\")};\r\n\t\t\t\t\tfor (var k = 0; k < attrs.length; k++) {\r\n\t\t\t\t\t\tvar attr = attrs[k];\r\n\t\t\t\t\t\tif (attr.nodeName == \"value\" || attr.nodeName == \"label\")\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\tobj[attr.nodeName] = attr.nodeValue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tarr.push(obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn collection;\r\n\t\t},\r\n\t\t_getXML: function (text, loader, toptag) {\r\n\t\t\ttoptag = toptag || \"data\";\r\n\t\t\tif (!loader.getXMLTopNode) {\r\n\t\t\t\tloader = gantt.ajax.parse(loader);\r\n\t\t\t}\r\n\r\n\t\t\tvar xml = gantt.ajax.xmltop(toptag, loader.xmlDoc);\r\n\t\t\tif (!xml || xml.tagName != toptag) {\r\n\t\t\t\txmlParseError(text);\r\n\t\t\t}\r\n\r\n\t\t\tvar skey = xml.getAttribute(\"dhx_security\");\r\n\t\t\tif (skey)\r\n\t\t\t\tgantt.security_key = skey;\r\n\r\n\t\t\treturn xml;\r\n\t\t},\r\n\t\tparse: function (text, loader) {\r\n\t\t\tloader = this._getXML(text, loader);\r\n\t\t\tvar data = {};\r\n\r\n\t\t\tvar evs = data.data = [];\r\n\t\t\tvar xml = gantt.ajax.xpath(\"//task\", loader);\r\n\r\n\t\t\tfor (var i = 0; i < xml.length; i++)\r\n\t\t\t\tevs[i] = this._xmlNodeToJSON(xml[i]);\r\n\r\n\t\t\tdata.collections = this._getCollections(loader);\r\n\t\t\treturn data;\r\n\t\t},\r\n\t\t_copyLink: function (obj) {\r\n\t\t\treturn \"<item id='\" + obj.id + \"' source='\" + obj.source + \"' target='\" + obj.target + \"' type='\" + obj.type + \"' />\";\r\n\t\t},\r\n\t\t_copyObject: function (obj) {\r\n\t\t\treturn \"<task id='\" + obj.id + \"' parent='\" + (obj.parent || \"\") + \"' start_date='\" + obj.start_date + \"' duration='\" + obj.duration + \"' open='\" + (!!obj.open) + \"' progress='\" + obj.progress + \"' end_date='\" + obj.end_date + \"'><![CDATA[\" + obj.text + \"]]></task>\";\r\n\t\t},\r\n\t\tserialize: function () {\r\n\t\t\tvar tasks = [];\r\n\t\t\tvar links = [];\r\n\r\n\t\t\tvar json = gantt.json.serialize();\r\n\t\t\tfor (var i = 0, len = json.data.length; i < len; i++) {\r\n\t\t\t\ttasks.push(this._copyObject(json.data[i]));\r\n\t\t\t}\r\n\t\t\tfor (var i = 0, len = json.links.length; i < len; i++) {\r\n\t\t\t\tlinks.push(this._copyLink(json.links[i]));\r\n\t\t\t}\r\n\t\t\treturn \"<data>\" + tasks.join(\"\") + \"<coll_options for='links'>\" + links.join(\"\") + \"</coll_options></data>\";\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tgantt.oldxml = {\r\n\t\tparse: function (text, loader) {\r\n\t\t\tloader = gantt.xml._getXML(text, loader, \"projects\");\r\n\t\t\tvar data = {collections: {links: []}};\r\n\r\n\t\t\tvar evs = data.data = [];\r\n\t\t\tvar xml = gantt.ajax.xpath(\"//task\", loader);\r\n\r\n\t\t\tfor (var i = 0; i < xml.length; i++) {\r\n\t\t\t\tevs[i] = gantt.xml._xmlNodeToJSON(xml[i]);\r\n\t\t\t\tvar parent = xml[i].parentNode;\r\n\r\n\t\t\t\tif (parent.tagName == \"project\")\r\n\t\t\t\t\tevs[i].parent = \"project-\" + parent.getAttribute(\"id\");\r\n\t\t\t\telse\r\n\t\t\t\t\tevs[i].parent = parent.parentNode.getAttribute(\"id\");\r\n\t\t\t}\r\n\r\n\t\t\txml = gantt.ajax.xpath(\"//project\", loader);\r\n\t\t\tfor (var i = 0; i < xml.length; i++) {\r\n\t\t\t\tvar ev = gantt.xml._xmlNodeToJSON(xml[i], true);\r\n\t\t\t\tev.id = \"project-\" + ev.id;\r\n\t\t\t\tevs.push(ev);\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0; i < evs.length; i++) {\r\n\t\t\t\tvar ev = evs[i];\r\n\t\t\t\tev.start_date = ev.startdate || ev.est;\r\n\t\t\t\tev.end_date = ev.enddate;\r\n\t\t\t\tev.text = ev.name;\r\n\t\t\t\tev.duration = ev.duration / 8;\r\n\t\t\t\tev.open = 1;\r\n\t\t\t\tif (!ev.duration && !ev.end_date) ev.duration = 1;\r\n\t\t\t\tif (ev.predecessortasks)\r\n\t\t\t\t\tdata.collections.links.push({\r\n\t\t\t\t\t\ttarget: ev.id,\r\n\t\t\t\t\t\tsource: ev.predecessortasks,\r\n\t\t\t\t\t\ttype: gantt.config.links.finish_to_start\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\t\t},\r\n\t\tserialize: function () {\r\n\t\t\tgantt.message(\"Serialization to 'old XML' is not implemented\");\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.serverList = function (name, array) {\r\n\t\tif (array) {\r\n\t\t\tthis.serverList[name] = array.slice(0);\r\n\t\t} else if (!this.serverList[name]) {\r\n\t\t\tthis.serverList[name] = [];\r\n\t\t}\r\n\t\treturn this.serverList[name];\r\n\t};\r\n\r\n};","import * as utils from \"../../utils/utils\";\r\nimport * as helpers from \"../../utils/helpers\";\r\n\r\n\r\nfunction IsWorkTimeArgument(date, unit, task, id, calendar){\r\n\tthis.date = date;\r\n\tthis.unit = unit;\r\n\tthis.task = task;\r\n\tthis.id = id;\r\n\tthis.calendar = calendar;\r\n\treturn this;\r\n}\r\n\r\nfunction ClosestWorkTimeArgument(date, dir, unit, task, id, calendar){\r\n\tthis.date = date;\r\n\tthis.dir = dir;\r\n\tthis.unit = unit;\r\n\tthis.task = task;\r\n\tthis.id = id;\r\n\tthis.calendar = calendar;\r\n\treturn this;\r\n}\r\n\r\nfunction CalculateEndDateArgument(start_date, duration, unit, step, task, id, calendar){\r\n\tthis.start_date = start_date;\r\n\tthis.duration = duration;\r\n\tthis.unit = unit;\r\n\tthis.step = step;\r\n\tthis.task = task;\r\n\tthis.id = id;\r\n\tthis.calendar = calendar;\r\n\treturn this;\r\n}\r\n\r\nfunction GetDurationArgument(start, end, task, calendar) {\r\n\tthis.start_date = start;\r\n\tthis.end_date = end;\r\n\tthis.task = task;\r\n\tthis.calendar = calendar;\r\n\tthis.unit = null;\r\n\tthis.step = null;\r\n\treturn this;\r\n}\r\n\r\nvar calendarArgumentsHelper = function(gantt){\r\n\treturn {\r\n\t\tgetWorkHoursArguments: function () {\r\n\t\t\tvar config = arguments[0];\r\n\t\t\tif (helpers.isDate(config)) {\r\n\t\t\t\tconfig = {\r\n\t\t\t\t\tdate: config\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\tconfig = utils.mixin({}, config);\r\n\t\t\t}\r\n\r\n\t\t\tif(!helpers.isValidDate(config.date)){\r\n\t\t\t\tgantt.assert(false, \"Invalid date argument for getWorkHours method\");\r\n\t\t\t\tthrow new Error(\"Invalid date argument for getWorkHours method\");\r\n\t\t\t}\r\n\r\n\t\t\treturn config;\r\n\t\t},\r\n\t\tsetWorkTimeArguments: function () {\r\n\t\t\treturn arguments[0];\r\n\t\t},\r\n\t\tunsetWorkTimeArguments: function () {\r\n\t\t\treturn arguments[0];\r\n\t\t},\r\n\t\tisWorkTimeArguments: function () {\r\n\t\t\tvar config = arguments[0];\r\n\t\t\tif(config instanceof IsWorkTimeArgument){\r\n\t\t\t\treturn config;\r\n\t\t\t}\r\n\r\n\t\t\tvar processedConfig;\r\n\t\t\tif (!config.date) {\r\n\t\t\t\t//IsWorkTimeArgument(date, unit, task, id, calendar)\r\n\t\t\t\tprocessedConfig = new IsWorkTimeArgument(arguments[0], arguments[1], arguments[2], null, arguments[3]);\r\n\t\t\t} else {\r\n\t\t\t\tprocessedConfig = new IsWorkTimeArgument(config.date, config.unit, config.task, null, config.calendar);\r\n\t\t\t}\r\n\r\n\t\t\tprocessedConfig.unit = processedConfig.unit || gantt.config.duration_unit;\r\n\r\n\t\t\tif(!helpers.isValidDate(processedConfig.date)){\r\n\t\t\t\tgantt.assert(false, \"Invalid date argument for isWorkTime method\");\r\n\t\t\t\tthrow new Error(\"Invalid date argument for isWorkTime method\");\r\n\t\t\t}\r\n\r\n\t\t\treturn processedConfig;\r\n\t\t},\r\n\t\tgetClosestWorkTimeArguments: function (arg) {\r\n\t\t\tvar config = arguments[0];\r\n\t\t\tif (config instanceof ClosestWorkTimeArgument)\r\n\t\t\t\treturn config;\r\n\r\n\t\t\tvar processedConfig;\r\n\t\t\tif (helpers.isDate(config)) {\r\n\t\t\t\tprocessedConfig = new ClosestWorkTimeArgument(config);\r\n\r\n\t\t\t} else {\r\n\t\t\t\tprocessedConfig = new ClosestWorkTimeArgument(\r\n\t\t\t\t\tconfig.date,\r\n\t\t\t\t\tconfig.dir,\r\n\t\t\t\t\tconfig.unit,\r\n\t\t\t\t\tconfig.task,\r\n\t\t\t\t\tnull,//config.id,\r\n\t\t\t\t\tconfig.calendar\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tif(config.id){\r\n\t\t\t\tprocessedConfig.task = config;\r\n\t\t\t}\r\n\t\t\tprocessedConfig.dir = config.dir || 'any';\r\n\t\t\tprocessedConfig.unit = config.unit || gantt.config.duration_unit;\r\n\r\n\t\t\tif(!helpers.isValidDate(processedConfig.date)){\r\n\t\t\t\tgantt.assert(false, \"Invalid date argument for getClosestWorkTime method\");\r\n\t\t\t\tthrow new Error(\"Invalid date argument for getClosestWorkTime method\");\r\n\t\t\t}\r\n\t\t\treturn processedConfig;\r\n\t\t},\r\n\r\n\t\t_getStartEndConfig: function (param) {\r\n\t\t\tvar argumentType = GetDurationArgument;\r\n\t\t\tvar config;\r\n\t\t\tif (param instanceof argumentType)\r\n\t\t\t\treturn param;\r\n\r\n\t\t\tif (helpers.isDate(param)) {\r\n\t\t\t\tconfig = new argumentType(arguments[0], arguments[1], arguments[2], arguments[3]);\r\n\t\t\t} else {\r\n\t\t\t\tconfig = new argumentType(param.start_date, param.end_date, param.task);\r\n\t\t\t\tif (param.id !== null && param.id !== undefined) {\r\n\t\t\t\t\tconfig.task = param;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconfig.unit = config.unit || gantt.config.duration_unit;\r\n\t\t\tconfig.step = config.step || gantt.config.duration_step;\r\n\t\t\tconfig.start_date = config.start_date || config.start || config.date;\r\n\r\n\t\t\tif(!helpers.isValidDate(config.start_date)){\r\n\t\t\t\tgantt.assert(false, \"Invalid start_date argument for getDuration method\");\r\n\t\t\t\tthrow new Error(\"Invalid start_date argument for getDuration method\");\r\n\t\t\t}\r\n\r\n\t\t\tif(!helpers.isValidDate(config.end_date)){\r\n\t\t\t\tgantt.assert(false, \"Invalid end_date argument for getDuration method\");\r\n\t\t\t\tthrow new Error(\"Invalid end_date argument for getDuration method\");\r\n\t\t\t}\r\n\r\n\t\t\treturn config;\r\n\t\t},\r\n\r\n\t\tgetDurationArguments: function (start, end, unit, step) {\r\n\t\t\treturn this._getStartEndConfig.apply(this, arguments);\r\n\t\t},\r\n\r\n\t\thasDurationArguments: function (start, end, unit, step) {\r\n\t\t\treturn this._getStartEndConfig.apply(this, arguments);\r\n\t\t},\r\n\r\n\t\tcalculateEndDateArguments: function (start, duration, unit, step) {\r\n\t\t\tvar config = arguments[0];\r\n\t\t\tif (config instanceof CalculateEndDateArgument)\r\n\t\t\t\treturn config;\r\n\r\n\t\t\tvar processedConfig;\r\n\t\t\t//CalculateEndDateArgument(start_date, duration, unit, step, task, id, calendar)\r\n\t\t\tif (helpers.isDate(config)) {\r\n\t\t\t\tprocessedConfig = new CalculateEndDateArgument(\r\n\t\t\t\t\targuments[0],\r\n\t\t\t\t\targuments[1],\r\n\t\t\t\t\targuments[2],\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\targuments[3],\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\targuments[4]\r\n\t\t\t\t);\r\n\r\n\t\t\t} else {\r\n\t\t\t\tprocessedConfig = new CalculateEndDateArgument(\r\n\t\t\t\t\tconfig.start_date,\r\n\t\t\t\t\tconfig.duration,\r\n\t\t\t\t\tconfig.unit,\r\n\t\t\t\t\tconfig.step,\r\n\t\t\t\t\tconfig.task,\r\n\t\t\t\t\tnull,//config.id,\r\n\t\t\t\t\tconfig.calendar\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tif(config.id !== null && config.id !== undefined){\r\n\t\t\t\tprocessedConfig.task = config;\r\n\r\n\t\t\t\t// received a task object as an argument\r\n\t\t\t\t// ignore 'unit' and 'step' properties in this case, since it's likely a part of data model of a task\r\n\t\t\t\tprocessedConfig.unit = null;\r\n\t\t\t\tprocessedConfig.step = null;\r\n\t\t\t}\r\n\r\n\t\t\tprocessedConfig.unit = processedConfig.unit || gantt.config.duration_unit;\r\n\t\t\tprocessedConfig.step = processedConfig.step || gantt.config.duration_step;\r\n\r\n\t\t\tif(!helpers.isValidDate(processedConfig.start_date)){\r\n\t\t\t\tgantt.assert(false, \"Invalid start_date argument for calculateEndDate method\");\r\n\t\t\t\tthrow new Error(\"Invalid start_date argument for calculateEndDate method\");\r\n\t\t\t}\r\n\r\n\t\t\treturn processedConfig;\r\n\t\t}\r\n\t};\r\n};\r\n\r\n\r\nexport default calendarArgumentsHelper;","import * as utils from \"../../../utils/utils\";\r\nfunction WorkTimeCalendarMerger(){\r\n}\r\n\r\nWorkTimeCalendarMerger.prototype = {\r\n\r\n\r\n\t/**\r\n\t * convert hours array items into objects, e.g. [8, 12, 17, 18] -> [{start: 8, end: 12}, {start:17, end:18}]\r\n\t * @param {Array} hoursArray\r\n\t */\r\n\t_getIntervals: function(hoursArray){\r\n\t\tvar result = [];\r\n\t\tfor(var i = 0; i < hoursArray.length; i += 2){\r\n\r\n\t\t\tresult.push({\r\n\t\t\t\tstart: hoursArray[i],\r\n\t\t\t\tend: hoursArray[i+1]\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/**\r\n\t * Convert ranges config into hours array\r\n\t * [{start: 8, end: 12}, {start:17, end:18}] --> [8, 12, 17, 18]\r\n\t * @param {*} intervalsArray\r\n\t */\r\n\t_toHoursArray: function(intervalsArray){\r\n\t\tvar result = [];\r\n\r\n\t\tfunction toFixed(value){\r\n\t\t\tvar str = String(value);\r\n\t\t\tif(str.length < 2){\r\n\t\t\t\tstr = \"0\" + str;\r\n\t\t\t}\r\n\t\t\treturn str;\r\n\t\t}\r\n\t\tfunction formatHHMM(secondsValue){\r\n\t\t\tvar hours = Math.floor(secondsValue / (60*60));\r\n\t\t\tvar minutePart = secondsValue - hours * 60 * 60;\r\n\r\n\t\t\tvar minutes = Math.floor(minutePart / (60));\r\n\t\t\treturn hours + \":\" + toFixed(minutes);\r\n\t\t}\r\n\t\tfor(var i = 0; i < intervalsArray.length; i++){\r\n\t\t\tresult.push(\r\n\t\t\t\tformatHHMM(intervalsArray[i].start) +\r\n\t\t\t\t\"-\" +\r\n\t\t\t\tformatHHMM(intervalsArray[i].end)\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/**\r\n\t * Build intersection of hour intervals. e.g.\r\n\t * first: [{start: 8, end: 12}, {start:13, end:18}]\r\n\t * second: [{start: 10, end: 15}]\r\n\t * result: [{start: 10, end: 12}, {start: 13, end: 15}]\r\n\t * @param {Array} first\r\n\t * @param {Array} second\r\n\t */\r\n\t_intersectHourRanges: function(first, second){\r\n\t\tvar result = [];\r\n\r\n\t\tvar baseArray = first.length > second.length ? first : second;\r\n\t\tvar overridesArray = first === baseArray ? second: first;\r\n\t\tbaseArray = baseArray.slice();\r\n\t\toverridesArray = overridesArray.slice();\r\n\r\n\t\tvar result = [];\r\n\t\tfor(var i = 0; i < baseArray.length; i++){\r\n\t\t\tvar base = baseArray[i];\r\n\r\n\t\t\tfor(var j = 0; j < overridesArray.length; j++){\r\n\t\t\t\tvar current = overridesArray[j];\r\n\t\t\t\tif(current.start < base.end && current.end > base.start){\r\n\t\t\t\t\tresult.push({\r\n\t\t\t\t\t\tstart: Math.max(base.start, current.start),\r\n\t\t\t\t\t\tend: Math.min(base.end, current.end)\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif(base.end > current.end){\r\n\t\t\t\t\t\toverridesArray.splice(j, 1);\r\n\t\t\t\t\t\tj--;\r\n\t\t\t\t\t\ti--;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/**\r\n\t * Reduce the number of ranges in config when possible,\r\n\t * joins ranges that can be merged\r\n\t * parts: [{start: 8, end: 12}, {start:12, end:13}, {start: 15, end: 17}]\r\n\t * result: [{start: 8, end: 13}, {start: 15, end: 17}]\r\n\t * @param {Array} parts\r\n\t */\r\n\t_mergeAdjacentIntervals: function(parts){\r\n\t\tvar result = parts.slice();\r\n\t\tresult.sort(function(a, b){\r\n\t\t\treturn a.start - b.start;\r\n\t\t});\r\n\t\tvar base = result[0];\r\n\t\tfor(var i = 1; i < result.length; i++){\r\n\t\t\tvar current = result[i];\r\n\t\t\tif(current.start <= base.end){\r\n\t\t\t\tif(current.end > base.end){\r\n\t\t\t\t\tbase.end = current.end;\r\n\t\t\t\t}\r\n\t\t\t\tresult.splice(i, 1);\r\n\t\t\t\ti--;\r\n\t\t\t}else{\r\n\t\t\t\tbase = current;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t_mergeHoursConfig: function(firstHours, secondHours){\r\n\t\t//var firstIntervals = this._getIntervals(firstHours);\r\n\t\t//var secondIntervals = this._getIntervals(secondHours);\r\n\r\n\t\treturn this._mergeAdjacentIntervals(\r\n\t\t\tthis._intersectHourRanges(firstHours, secondHours)\r\n\t\t);\r\n\t},\r\n\r\n\tmerge: function(first, second){\r\n\t\tconst firstCalendar = utils.copy(first.getConfig());\r\n\t\tconst secondCalendar = utils.copy(second.getConfig());\r\n\r\n\t\tconst firstConfig = firstCalendar.parsed;\r\n\t\tconst secondConfig = secondCalendar.parsed;\r\n\r\n\t\t// GS-2101. The customWeeks config shouldn't have parsed values as we'll parse them later\r\n\t\tfirstConfig.customWeeks = firstCalendar.customWeeks;\r\n\t\tsecondConfig.customWeeks = secondCalendar.customWeeks;\r\n\r\n\t\tvar mergedSettings = {\r\n\t\t\thours: this._toHoursArray(this._mergeHoursConfig(firstConfig.hours, secondConfig.hours)),\r\n\t\t\tdates: {},\r\n\t\t\tcustomWeeks: {}\r\n\t\t};\r\n\r\n\t\tconst processCalendar = (config1, config2) => {\r\n\t\t\tfor (let i in config1.dates) {\r\n\t\t\t\tconst date1 = config1.dates[i];\r\n\t\r\n\t\t\t\t// dates contain day-of-week rules [0-7] and rules for specific dates (js date timestamps) - set false date rules initially\r\n\t\t\t\tif (+i > 1000) {\r\n\t\t\t\t\tmergedSettings.dates[i] = false;\r\n\t\t\t\t}\r\n\t\t\t\t// Check if the key exists in the fisrt calendar object\r\n\t\t\t\tfor (const key in config2.dates) {\r\n\t\t\t\t\tconst date2 = config2.dates[key];\r\n\t\r\n\t\t\t\t\t// Logical AND for week days\r\n\t\t\t\t\tif (key == i) {\r\n\t\t\t\t\t\tmergedSettings.dates[i] = !!(date1 && date2);\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t// Handle case where dates are arrays\r\n\t\t\t\t\tif (Array.isArray(date1)) {\r\n\t\t\t\t\t\tconst hours2 = Array.isArray(date2) ? date2 : config2.hours;\r\n\t\t\t\t\t\tmergedSettings.dates[i] = this._toHoursArray(this._mergeHoursConfig(date1, hours2));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\r\n\t\t// Check both calendars\r\n\t\tprocessCalendar(firstConfig, secondConfig);\r\n\t\tprocessCalendar(secondConfig, firstConfig);\r\n\r\n\t\t// transfer and overwrite custom week calendars\r\n\t\tif(firstConfig.customWeeks){\r\n\t\t\tfor(var i in firstConfig.customWeeks){\r\n\t\t\t\tmergedSettings.customWeeks[i] = firstConfig.customWeeks[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(secondConfig.customWeeks){\r\n\t\t\tfor(var i in secondConfig.customWeeks){\r\n\t\t\t\t// GS-2101. If both calendars have the same name for a period, we need to rename it\r\n\t\t\t\tif (mergedSettings.customWeeks[i]){\r\n\t\t\t\t\tmergedSettings.customWeeks[i + \"_second\"] = secondConfig.customWeeks[i];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmergedSettings.customWeeks[i] = secondConfig.customWeeks[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn mergedSettings;\r\n\r\n\t}\r\n\r\n};\r\n\r\nexport default WorkTimeCalendarMerger;","\r\n\r\nimport { IWorkUnitCache } from \"./workunit_cache_interface\";\r\n\r\nexport class WorkUnitsMapCache implements IWorkUnitCache {\r\n\tprivate _cache: Map<string, Array<Map<string, boolean>>>;\r\n\tconstructor() {\r\n\t\tthis.clear();\r\n\t}\r\n\r\n\tgetItem(unit: string, timestamp: string, value: Date): number|boolean {\r\n\t\tif (this._cache.has(unit)) {\r\n\t\t\tconst unitCache = this._cache.get(unit);\r\n\r\n\t\t\tconst subCache = unitCache[value.getFullYear()];\r\n\t\t\tif (subCache && subCache.has(timestamp)) {\r\n\t\t\t\treturn subCache.get(timestamp);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn -1;\r\n\t}\r\n\tsetItem(unit: string, timestamp: string, value: boolean, rawValue: Date): void {\r\n\t\tif (!unit || !timestamp) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst cache = this._cache;\r\n\t\tconst year = rawValue.getFullYear();\r\n\r\n\t\tlet unitCache;\r\n\t\tif (!cache.has(unit)) {\r\n\t\t\tunitCache = [];\r\n\t\t\tcache.set(unit, unitCache);\r\n\t\t} else {\r\n\t\t\tunitCache = cache.get(unit);\r\n\t\t}\r\n\r\n\t\tlet yearCache = unitCache[year];\r\n\t\tif(!yearCache){\r\n\t\t\tyearCache = unitCache[year] = new Map<string, boolean>();\r\n\t\t}\r\n\r\n\r\n\t\tyearCache.set(timestamp, value);\r\n\t}\r\n\tclear(): void{\r\n\t\tthis._cache = new Map<string, Array<Map<string, boolean>>>();\r\n\t}\r\n}","import { IWorkUnitCache } from \"./workunit_cache_interface\";\r\n\r\nexport class WorkUnitsObjectCache implements IWorkUnitCache {\r\n\tprivate _cache: any;\r\n\tconstructor() {\r\n\t\tthis.clear();\r\n\t}\r\n\r\n\tgetItem(unit: string, timestamp: string, value: Date): number|boolean {\r\n\t\tconst cache = this._cache;\r\n\t\tif (cache && cache[unit]) {\r\n\t\t\tconst units = cache[unit];\r\n\t\t\tif(units === undefined){\r\n\t\t\t\treturn -1;\r\n\t\t\t}\r\n\t\t\tconst subCache = units[value.getFullYear()];\r\n\t\t\tif (subCache && subCache[timestamp] !== undefined) {\r\n\t\t\t\treturn subCache[timestamp];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn -1;\r\n\t}\r\n\tsetItem(unit: string, timestamp: string, value: boolean, rawValue: Date): void {\r\n\t\tif (!unit || !timestamp) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst cache = this._cache;\r\n\r\n\t\tif (!cache) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!cache[unit]) {\r\n\t\t\tcache[unit] = [];\r\n\t\t}\r\n\t\tconst unitCache = cache[unit];\r\n\r\n\t\tconst year = rawValue.getFullYear();\r\n\t\tlet yearCache = unitCache[year];\r\n\t\tif(!yearCache){\r\n\t\t\tyearCache = unitCache[year] = {};\r\n\t\t}\r\n\t\tyearCache[timestamp] = value;\r\n\t}\r\n\tclear(): void{\r\n\t\tthis._cache = {};\r\n\t}\r\n}","\r\n\r\nexport class LargerUnitsCache {\r\n\tprivate _weekCache: Map<number, number>;\r\n\tprivate _monthCache: Map<number, number>;\r\n\tprivate _calendar: any;\r\n\tconstructor(calendar) {\r\n\t\tthis.clear();\r\n\t\tthis._calendar = calendar;\r\n\t}\r\n\r\n\tgetMinutesPerWeek = (weekStart: Date) => {\r\n\t\tconst key = weekStart.valueOf();\r\n\r\n\t\tif(this._weekCache.has(key)){\r\n\t\t\treturn this._weekCache.get(key);\r\n\t\t}\r\n\r\n\t\tconst calendar = this._calendar;\r\n\t\tconst gantt = this._calendar.$gantt;\r\n\r\n\t\tlet minutesPerWeek = 0;\r\n\t\tlet start = gantt.date.week_start(new Date(weekStart));\r\n\t\tfor(let i = 0; i < 7; i++){\r\n\t\t\tminutesPerWeek += calendar.getHoursPerDay(start) * 60;\r\n\t\t\tstart = gantt.date.add(start, 1, \"day\");\r\n\t\t}\r\n\r\n\t\tthis._weekCache.set(key, minutesPerWeek);\r\n\t\treturn minutesPerWeek;\r\n\t};\r\n\r\n\tgetMinutesPerMonth = (monthStart: Date) => {\r\n\t\tconst key = monthStart.valueOf();\r\n\r\n\t\tif(this._monthCache.has(key)){\r\n\t\t\treturn this._monthCache.get(key);\r\n\t\t}\r\n\r\n\t\tconst calendar = this._calendar;\r\n\t\tconst gantt = this._calendar.$gantt;\r\n\r\n\t\tlet minutesPerMonth = 0;\r\n\t\tlet start = gantt.date.week_start(new Date(monthStart));\r\n\t\tconst nextMonth = gantt.date.add(start, 1, \"month\").valueOf();\r\n\t\twhile(start.valueOf() < nextMonth){\r\n\t\t\tminutesPerMonth += calendar.getHoursPerDay(start) * 60;\r\n\t\t\tstart = gantt.date.add(start, 1, \"day\");\r\n\t\t}\r\n\r\n\t\tthis._monthCache.set(key, minutesPerMonth);\r\n\t\treturn minutesPerMonth;\r\n\t};\r\n\r\n\tclear = (): void => {\r\n\t\tthis._weekCache = new Map<number, number>();\r\n\t\tthis._monthCache = new Map<number, number>();\r\n\t};\r\n}","export class DateDurationCache  {\r\n\tprivate _cache: any;\r\n\tconstructor() {\r\n\t\tthis.clear();\r\n\t}\r\n\r\n\t_getCacheObject(startDate: Date, unit: string, step:number){\r\n\t\tconst cache = this._cache;\r\n\t\tif (!cache[unit]) {\r\n\t\t\tcache[unit] = [];\r\n\t\t}\r\n\t\tlet unitCache = cache[unit];\r\n\t\tif(!unitCache) {\r\n\t\t\tunitCache = cache[unit] = {};\r\n\t\t}\r\n\r\n\t\tlet stepCache = unitCache[step];\r\n\t\tif(!stepCache) {\r\n\t\t\tstepCache = unitCache[step] = {};\r\n\t\t}\r\n\r\n\t\tconst year = startDate.getFullYear();\r\n\t\tlet yearCache = stepCache[year];\r\n\t\tif(!yearCache){\r\n\t\t\tyearCache = stepCache[year] = {durations: {}, endDates: {}};\r\n\t\t}\r\n\r\n\t\treturn yearCache;\r\n\t}\r\n\t_endDateCacheKey(startDate: number, duration: number){\r\n\t\treturn String(startDate) + \"-\" + String(duration);\r\n\t}\r\n\t_durationCacheKey(startDate: number, endDate: number){\r\n\t\treturn String(startDate) + \"-\" + String(endDate);\r\n\t}\r\n\tgetEndDate(startDate: Date, duration: number, unit: string, step: number, compute: () => Date): number|null{\r\n\t\tconst cache = this._getCacheObject(startDate, unit, step);\r\n\r\n\t\tconst startDateTimestamp = startDate.valueOf();\r\n\t\tconst key = this._endDateCacheKey(startDateTimestamp, duration);\r\n\t\tlet endDate;\r\n\t\tif(cache.endDates[key] === undefined){\r\n\t\t\tconst result = compute();\r\n\t\t\tconst resultTimestamp = result.valueOf();\r\n\t\t\tcache.endDates[key] = resultTimestamp;\r\n\t\t\tcache.durations[this._durationCacheKey(startDateTimestamp, resultTimestamp)] = duration;\r\n\t\t\tendDate = result;\r\n\t\t}else{\r\n\t\t\tendDate = new Date(cache.endDates[key]);\r\n\t\t}\r\n\r\n\t\treturn endDate;\r\n\t}\r\n\r\n\tgetDuration(startDate: Date, endDate: Date, unit: string, step: number, compute: () => number): number|null{\r\n\t\tconst cache = this._getCacheObject(startDate, unit, step);\r\n\r\n\t\tconst startDateTimestamp = startDate.valueOf();\r\n\t\tconst endDateTimestamp = endDate.valueOf();\r\n\t\tconst key = this._durationCacheKey(startDateTimestamp, endDateTimestamp);\r\n\t\tlet duration;\r\n\t\tif(cache.durations[key] === undefined){\r\n\t\t\tconst result = compute();\r\n\t\t\tcache.durations[key] = result.valueOf();\r\n\r\n\t\t\t// can't populate end date due to logic of end date calculation, current unit tests capture it\r\n\t\t\t// cache.endDates[this._endDateCacheKey(startDateTimestamp, result)] = endDateTimestamp;\r\n\t\t\tduration = result;\r\n\t\t}else{\r\n\t\t\tduration = cache.durations[key];\r\n\t\t}\r\n\r\n\t\treturn duration;\r\n\t}\r\n\r\n\tclear(): void{\r\n\t\tthis._cache = {};\r\n\t}\r\n}","import {createCacheObject} from \"./work_unit_cache\";\r\nimport {LargerUnitsCache} from \"./work_unit_cache\";\r\nimport * as utils from \"../../../utils/utils\";\r\nimport {DateDurationCache} from \"./work_unit_cache/date_duration_cache\";\r\n\r\nfunction CalendarWorkTimeStrategy(gantt, argumentsHelper) {\r\n\tthis.argumentsHelper = argumentsHelper;\r\n\tthis.$gantt = gantt;\r\n\tthis._workingUnitsCache = createCacheObject();\r\n\tthis._largeUnitsCache = new LargerUnitsCache(this);\r\n\tthis._dateDurationCache = new DateDurationCache();\r\n\tthis._worktime = null;\r\n\tthis._cached_timestamps = {};\r\n\tthis._cached_timestamps_count = 0;\r\n}\r\n\r\nCalendarWorkTimeStrategy.prototype = {\r\n\tunits: [\r\n\t\t\"year\",\r\n\t\t\"month\",\r\n\t\t\"week\",\r\n\t\t\"day\",\r\n\t\t\"hour\",\r\n\t\t\"minute\"\r\n\t],\r\n\t_clearCaches: function(){\r\n\t\tthis._workingUnitsCache.clear();\r\n\t\tthis._largeUnitsCache.clear();\r\n\t\tthis._dateDurationCache.clear();\r\n\t},\r\n\t// cache previously calculated worktime\r\n\t_getUnitOrder: function (unit) {\r\n\t\tfor (var i = 0, len = this.units.length; i < len; i++) {\r\n\t\t\tif (this.units[i] == unit)\r\n\t\t\t\treturn i;\r\n\t\t}\r\n\t},\r\n\t_resetTimestampCache: function(){\r\n\t\tthis._cached_timestamps = {};\r\n\t\tthis._cached_timestamps_count = 0;\r\n\t},\r\n\t_timestamp: function (settings) {\r\n\t\t// minor optimization, store calculated timestamps to reduce computations\r\n\t\t// reset cache when number of keys exceeds large number where key lookup may became more expensive than the recalculation\r\n\t\tif(this._cached_timestamps_count > 1000000){\r\n\t\t\tthis._resetTimestampCache();\r\n\t\t}\r\n\r\n\t\tvar timestamp = null;\r\n\t\tif ((settings.day || settings.day === 0)) {\r\n\t\t\ttimestamp = settings.day;\r\n\t\t} else if (settings.date) {\r\n\t\t\tvar value = String(settings.date.valueOf());\r\n\t\t\tif(this._cached_timestamps[value]){\r\n\t\t\t\ttimestamp = this._cached_timestamps[value];\r\n\t\t\t}else{\r\n\t\t\t\t// store worktime datestamp in utc so it could be recognized in different timezones (e.g. opened locally and sent to the export service in different timezone)\r\n\t\t\t\ttimestamp = Date.UTC(settings.date.getFullYear(), settings.date.getMonth(), settings.date.getDate());\r\n\t\t\t\tthis._cached_timestamps[value] = timestamp;\r\n\t\t\t\tthis._cached_timestamps_count++;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\treturn timestamp;\r\n\t},\r\n\t_checkIfWorkingUnit: function (date, unit) {\r\n\t\t// GS-596: If unit is larger than day or has a custom logic\r\n\t\tif (!this[\"_is_work_\" + unit]) {\r\n\t\t\tconst from = this.$gantt.date[`${unit}_start`](new Date(date));\r\n\t\t\tconst to = this.$gantt.date.add(from, 1, unit);\r\n\t\t\treturn this.hasDuration(from, to);\r\n\t\t}\r\n\t\treturn this[\"_is_work_\" + unit](date);\r\n\t},\r\n\t//checkings for particular time units\r\n\t//methods for month-year-week can be defined, otherwise always return 'true'\r\n\t_is_work_day: function (date) {\r\n\t\tvar val = this._getWorkHours(date);\r\n\r\n\t\tif (Array.isArray(val)) {\r\n\t\t\treturn val.length > 0;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t_is_work_hour: function (date) {\r\n\t\tvar hours = this._getWorkHours(date); // [{start: 8*60*60, end: 12*60*60}, {start: 13*60*60, end: 17*60*60}]\r\n\t\tvar value = date.getHours();\r\n\t\tfor (var i = 0; i < hours.length; i++) {\r\n\t\t\tif(value >= hours[i].startHour && value < hours[i].endHour){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\t_getTimeOfDayStamp: function(date, dayEnd) {\r\n\t\tvar hours = date.getHours();\r\n\t\tif(!date.getHours() && !date.getMinutes() && dayEnd){\r\n\t\t\thours = 24;\r\n\t\t}\r\n\t\treturn hours * 60 * 60 + date.getMinutes() * 60;\r\n\t},\r\n\r\n\t_is_work_minute: function(date){\r\n\t\tvar hours = this._getWorkHours(date); // [{start: 8*60*60, end: 12*60*60}, {start: 13*60*60, end: 17*60*60}]\r\n\t\tvar checkTime = this._getTimeOfDayStamp(date);\r\n\t\tfor (var i = 0; i < hours.length; i++) {\r\n\t\t\tif(checkTime >= hours[i].start && checkTime < hours[i].end){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\t_nextDate: function (start, unit, step) {\r\n\t\treturn this.$gantt.date.add(start, step, unit);\r\n\t},\r\n\t_getWorkUnitsBetweenGeneric: function (from, to, unit, step) {\r\n\t\tvar dateHelper = this.$gantt.date;\r\n\t\tvar start = new Date(from),\r\n\t\t\tend = new Date(to);\r\n\t\tstep = step || 1;\r\n\t\tvar units = 0;\r\n\r\n\r\n\t\tvar next = null;\r\n\t\tvar stepStart,\r\n\t\t\tstepEnd;\r\n\r\n\t\t// calculating decimal durations, i.e. 2016-09-20 00:05:00 - 2016-09-20 01:00:00 ~ 0.95 instead of 1\r\n\t\t// and also  2016-09-20 00:00:00 - 2016-09-20 00:05:00 ~ 0.05 instead of 1\r\n\t\t// durations must be rounded later\r\n\t\tvar checkFirst = false;\r\n\t\tstepStart = dateHelper[unit + \"_start\"](new Date(start));\r\n\t\tif (stepStart.valueOf() != start.valueOf()) {\r\n\t\t\tcheckFirst = true;\r\n\t\t}\r\n\t\tvar checkLast = false;\r\n\t\tstepEnd = dateHelper[unit + \"_start\"](new Date(to));\r\n\t\tif (stepEnd.valueOf() != to.valueOf()) {\r\n\t\t\tcheckLast = true;\r\n\t\t}\r\n\r\n\t\tvar isLastStep = false;\r\n\t\twhile (start.valueOf() < end.valueOf()) {\r\n\t\t\tnext = this._nextDate(start, unit, step);\r\n\t\t\tisLastStep = (next.valueOf() > end.valueOf());\r\n\r\n\t\t\tif (this._isWorkTime(start, unit)) {\r\n\t\t\t\tif (checkFirst || (checkLast && isLastStep)) {\r\n\t\t\t\t\tstepStart = dateHelper[unit + \"_start\"](new Date(start));\r\n\t\t\t\t\tstepEnd = dateHelper.add(stepStart, step, unit);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (checkFirst) {\r\n\t\t\t\t\tcheckFirst = false;\r\n\t\t\t\t\tnext = this._nextDate(stepStart, unit, step);\r\n\t\t\t\t\tunits += ((stepEnd.valueOf() - start.valueOf()) / (stepEnd.valueOf() - stepStart.valueOf()));\r\n\t\t\t\t} else if (checkLast && isLastStep) {\r\n\t\t\t\t\tcheckLast = false;\r\n\t\t\t\t\tunits += ((end.valueOf() - start.valueOf()) / (stepEnd.valueOf() - stepStart.valueOf()));\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tunits++;\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tvar unitOrder = this._getUnitOrder(unit);\r\n\t\t\t\tvar biggerTimeUnit = this.units[unitOrder - 1];\r\n\t\t\t\tif(biggerTimeUnit && !this._isWorkTime(start, biggerTimeUnit)){\r\n\t\t\t\t\tnext = this._getClosestWorkTimeFuture(start, biggerTimeUnit);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tstart = next;\r\n\t\t}\r\n\t\treturn units;\r\n\t},\r\n\r\n\t_getMinutesPerHour: function (date) {\r\n\t\tvar hourStart = this._getTimeOfDayStamp(date);\r\n\t\tvar hourEnd = this._getTimeOfDayStamp(this._nextDate(date, \"hour\", 1));\r\n\t\tif (hourEnd === 0){\r\n\t\t\thourEnd = 24 * 60 * 60;\r\n\t\t}\r\n\t\tvar worktimes = this._getWorkHours(date);\r\n\r\n\t\tfor(var i = 0; i < worktimes.length; i++){\r\n\t\t\tvar interval = worktimes[i];\r\n\t\t\tif(hourStart >= interval.start && hourEnd <= interval.end){\r\n\t\t\t\treturn 60;// hour inside a working interval, all hour is a work hour\r\n\t\t\t}else if(hourStart < interval.end && hourEnd > interval.start){\r\n\t\t\t\t// hour is partially work time\r\n\t\t\t\tvar duration = Math.min(hourEnd, interval.end) - Math.max(hourStart, interval.start);\r\n\t\t\t\treturn duration / 60;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn 0;\r\n\t},\r\n\r\n\t_getMinutesPerDay: function (date) {\r\n\t\tvar hours = this._getWorkHours(date);\r\n\t\tvar res = 0;\r\n\t\thours.forEach(function(interval){\r\n\t\t\tres+= interval.durationMinutes;\r\n\t\t});\r\n\t\treturn res;\r\n\t},\r\n\tgetHoursPerDay: function (date) {\r\n\t\tvar hours = this._getWorkHours(date);\r\n\t\tvar res = 0;\r\n\t\thours.forEach(function(interval){\r\n\t\t\tres+= interval.durationHours;\r\n\t\t});\r\n\t\treturn res;\r\n\t},\r\n\t_getWorkUnitsForRange: function (from, to, unit, step) {\r\n\t\tvar total = 0;\r\n\t\tvar start = new Date(from),\r\n\t\t\tend = new Date(to);\r\n\r\n\t\tvar getUnitsPerDay;\r\n\t\tif (unit == \"minute\") {\r\n\t\t\tgetUnitsPerDay = utils.bind(this._getMinutesPerDay, this);\r\n\t\t} else {\r\n\t\t\tgetUnitsPerDay = utils.bind(this.getHoursPerDay, this);\r\n\t\t}\r\n\r\n\t\twhile (start.valueOf() < end.valueOf()) {\r\n\t\t\tif(end - start > 1000*60*60*24*32 && start.getDate() === 0) {\r\n\t\t\t\tvar units = this._largeUnitsCache.getMinutesPerMonth(start);\r\n\t\t\t\tif(unit == \"hour\"){\r\n\t\t\t\t\tunits = units / 60;\r\n\t\t\t\t}\r\n\t\t\t\ttotal += units;\r\n\t\t\t\tstart = this.$gantt.date.add(start, 1, \"month\");\r\n\t\t\t\tcontinue;\r\n\t\t\t}else if(end - start > 1000*60*60*24*16) {\r\n\t\t\t\tvar weekStart = this.$gantt.date.week_start(new Date(start));\r\n\t\t\t\tif(start.valueOf() === weekStart.valueOf()){\r\n\t\t\t\t\tvar units = this._largeUnitsCache.getMinutesPerWeek(start);\r\n\t\t\t\t\tif(unit == \"hour\"){\r\n\t\t\t\t\t\tunits = units / 60;\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttotal += units;\r\n\t\t\t\t\tstart = this.$gantt.date.add(start, 7, \"day\");\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t//\tif (this._isWorkTime(start, \"day\")) {\r\n\t\t\ttotal += getUnitsPerDay(start);\r\n\t\t//\t}\r\n\t\t\tstart = this._nextDate(start, \"day\", 1);\r\n\t\t}\r\n\r\n\t\treturn total / step;\r\n\t},\r\n\r\n\r\n\t_getMinutesBetweenSingleDay: function(from, to){\r\n\t\tvar range = this._getIntervalTimestamp(from, to);\r\n\t\tvar worktimes = this._getWorkHours(from);\r\n\t\tvar result = 0;\r\n\r\n\t\tfor(var i = 0; i < worktimes.length; i++){\r\n\t\t\tvar interval = worktimes[i];\r\n\t\t\tif(range.end >= interval.start && range.start <= interval.end){\r\n\t\t\t\tvar minuteFrom = Math.max(interval.start, range.start);\r\n\t\t\t\tvar minuteTo = Math.min(interval.end, range.end);\r\n\r\n\t\t\t\tresult += (minuteTo - minuteFrom) / 60;\r\n\t\t\t\trange.start = minuteTo;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn Math.floor(result);\r\n\t},\r\n\r\n\t_getMinutesBetween: function(from, to, unit, step){\r\n\t\tvar start = new Date(from),\r\n\t\t\tend = new Date(to);\r\n\t\tstep = step || 1;\r\n\r\n\t\tvar firstDayStart = new Date(start);\r\n\t\tvar firstDayEnd = this.$gantt.date.add(this.$gantt.date.day_start(new Date(start)), 1, \"day\");\r\n\r\n\t\tif (end.valueOf() <= firstDayEnd.valueOf()) {\r\n\t\t\treturn this._getMinutesBetweenSingleDay(from, to);\r\n\t\t} else {\r\n\r\n\t\t\tvar lastDayStart = this.$gantt.date.day_start(new Date(end));\r\n\t\t\tvar lastDayEnd = end;\r\n\r\n\t\t\tvar startPart = this._getMinutesBetweenSingleDay(firstDayStart, firstDayEnd);\r\n\t\t\tvar endPart = this._getMinutesBetweenSingleDay(lastDayStart, lastDayEnd);\r\n\r\n\t\t\tvar rangePart = this._getWorkUnitsForRange(firstDayEnd, lastDayStart, unit, step);\r\n\t\t\tvar total = startPart + rangePart + endPart;\r\n\r\n\t\t\treturn total;\r\n\t\t}\r\n\t},\r\n\t// optimized method for calculating work units duration of large time spans\r\n\t// implemented for hours and minutes units, bigger time units don't benefit from the optimization so much\r\n\t_getHoursBetween: function (from, to, unit, step) {\r\n\t\tvar start = new Date(from),\r\n\t\t\tend = new Date(to);\r\n\t\tstep = step || 1;\r\n\r\n\t\tvar firstDayStart = new Date(start);\r\n\t\tvar firstDayEnd = this.$gantt.date.add(this.$gantt.date.day_start(new Date(start)), 1, \"day\");\r\n\r\n\t\tif (end.valueOf() <= firstDayEnd.valueOf()) {\r\n\t\t\treturn Math.round(this._getMinutesBetweenSingleDay(from, to) / 60);\r\n\t\t} else {\r\n\r\n\t\t\tvar lastDayStart = this.$gantt.date.day_start(new Date(end));\r\n\t\t\tvar lastDayEnd = end;\r\n\r\n\t\t\tvar startPart = this._getMinutesBetweenSingleDay(firstDayStart, firstDayEnd, unit, step) / 60;\r\n\t\t\tvar endPart = this._getMinutesBetweenSingleDay(lastDayStart, lastDayEnd, unit, step) / 60;\r\n\r\n\t\t\tvar rangePart = this._getWorkUnitsForRange(firstDayEnd, lastDayStart, unit, step);\r\n\t\t\tvar total = startPart + rangePart + endPart;\r\n\r\n\t\t\treturn Math.round(total);\r\n\t\t}\r\n\t},\r\n\r\n\tgetConfig: function () {\r\n\t\treturn this._worktime;\r\n\t},\r\n\t_setConfig: function (settings) {\r\n\t\tthis._worktime = settings;\r\n\t\tthis._parseSettings();\r\n\t\tthis._clearCaches();\r\n\t},\r\n\t_parseSettings: function() {\r\n\t\tvar settings = this.getConfig();\r\n\t\tsettings.parsed = {\r\n\t\t\tdates: {},\r\n\t\t\thours: null,\r\n\t\t\thaveCustomWeeks: false,\r\n\t\t\tcustomWeeks: {},\r\n\t\t\tcustomWeeksRangeStart: null,\r\n\t\t\tcustomWeeksRangeEnd: null,\r\n\t\t\tcustomWeeksBoundaries: []\r\n\t\t};\r\n\r\n\t\tsettings.parsed.hours = this._parseHours(settings.hours);\r\n\t\tfor(var i in settings.dates){\r\n\t\t\tsettings.parsed.dates[i] = this._parseHours(settings.dates[i]);\r\n\t\t}\r\n\r\n\t\tif(settings.customWeeks) {\r\n\t\t\tvar minCustomRangeStart = null;\r\n\t\t\tvar maxCustomRangeEnd = null;\r\n\t\t\tfor(var i in settings.customWeeks){\r\n\t\t\t\tvar customTime = settings.customWeeks[i];\r\n\r\n\t\t\t\tif(customTime.from && customTime.to){\r\n\t\t\t\t\tvar rangeStart = customTime.from;\r\n\t\t\t\t\tvar rangeEnd = customTime.to;\r\n\t\t\t\t\tif(!minCustomRangeStart || minCustomRangeStart > rangeStart.valueOf()){\r\n\t\t\t\t\t\tminCustomRangeStart = rangeStart.valueOf();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!maxCustomRangeEnd || maxCustomRangeEnd < rangeEnd.valueOf()){\r\n\t\t\t\t\t\tmaxCustomRangeEnd = rangeEnd.valueOf();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tsettings.parsed.customWeeksBoundaries.push({\r\n\t\t\t\t\t\tfrom: rangeStart.valueOf(),\r\n\t\t\t\t\t\tfromReadable: new Date(rangeStart),\r\n\t\t\t\t\t\tto: rangeEnd.valueOf(),\r\n\t\t\t\t\t\ttoReadable: new Date(rangeEnd),\r\n\t\t\t\t\t\tname: i\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tsettings.parsed.haveCustomWeeks = true;\r\n\t\t\t\t\tvar currentWeek = settings.parsed.customWeeks[i] = {\r\n\t\t\t\t\t\tfrom: customTime.from,\r\n\t\t\t\t\t\tto: customTime.to,\r\n\t\t\t\t\t\thours: this._parseHours(customTime.hours),\r\n\t\t\t\t\t\tdates: {}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t// GS-1840. If there are no dates, it should work correctly with the weekdays\r\n\t\t\t\t\tif (customTime.days && !customTime.dates) {\r\n\t\t\t\t\t\tcustomTime.dates = customTime.dates || {};\r\n\t\t\t\t\t\tfor (var i = 0; i < customTime.days.length; i++) {\r\n\t\t\t\t\t\t\tcustomTime.dates[i] = customTime.days[i];\r\n\t\t\t\t\t\t\tif (!(customTime.days[i] instanceof Array)) {\r\n\t\t\t\t\t\t\t\tcustomTime.dates[i] = !!customTime.days[i];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tdelete customTime.days;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor(var d in customTime.dates){\r\n\t\t\t\t\t\tcurrentWeek.dates[d] = this._parseHours(customTime.dates[d]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tsettings.parsed.customWeeksRangeStart = minCustomRangeStart;\r\n\t\t\tsettings.parsed.customWeeksRangeEnd = maxCustomRangeEnd;\r\n\r\n\t\t}\r\n\t},\r\n\r\n\t_tryChangeCalendarSettings: function (payload) {\r\n\t\tvar backup = JSON.stringify(this.getConfig());\r\n\t\tpayload();\r\n\t\tif (!this.hasWorkTime()) {\r\n\t\t//\tthis.$gantt.assert(false, \"Invalid calendar settings, no worktime available\");\r\n\t\t\tthis._setConfig(JSON.parse(backup));\r\n\t\t\tthis._clearCaches();\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\r\n\t},\r\n\r\n\t_arraysEqual: function(a, b){\r\n\t\tif (a === b) return true;\r\n\t\tif (!a || !b) return false;\r\n\t\tif (a.length != b.length) return false;\r\n\r\n\t\tfor (var i = 0; i < a.length; ++i) {\r\n\t\t\tif (a[i] !== b[i]) return false;\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\r\n\t_compareSettings: function (mySettings, thatSettings) {\r\n\t\tif (!this._arraysEqual(mySettings.hours, thatSettings.hours)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar myDays = Object.keys(mySettings.dates);\r\n\t\tvar otherDates = Object.keys(thatSettings.dates);\r\n\t\tmyDays.sort();\r\n\t\totherDates.sort();\r\n\r\n\t\tif (!this._arraysEqual(myDays, otherDates)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tfor(var i = 0; i < myDays.length; i++){\r\n\t\t\tvar timestamp = myDays[i];\r\n\t\t\tvar myHours = mySettings.dates[timestamp];\r\n\t\t\tvar otherHours = mySettings.dates[timestamp];\r\n\r\n\t\t\t// day settings not equal\r\n\t\t\tif(myHours !== otherHours &&\r\n\t\t\t\t// but still can be two arrays with the equivalent hour settings\r\n\t\t\t\t!(Array.isArray(myHours) && Array.isArray(otherHours) && this._arraysEqual(myHours, otherHours))\r\n\t\t\t\t){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\tequals: function (calendar) {\r\n\t\tif(!(calendar instanceof CalendarWorkTimeStrategy)){\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar mySettings = this.getConfig();\r\n\t\tvar thatSettings = calendar.getConfig();\r\n\r\n\t\tif(!this._compareSettings(mySettings, thatSettings)){\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif(mySettings.parsed.haveCustomWeeks && thatSettings.parsed.haveCustomWeeks){\r\n\t\t\tif(mySettings.parsed.customWeeksBoundaries.length != thatSettings.parsed.customWeeksBoundaries.length){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tfor(var i in mySettings.parsed.customWeeks){\r\n\t\t\t\tvar myWeek = mySettings.parsed.customWeeks[i];\r\n\t\t\t\tvar thatWeek = thatSettings.parsed.customWeeks[i];\r\n\t\t\t\tif(!thatWeek){\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!this._compareSettings(myWeek, thatWeek)){\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}else if(mySettings.parse.haveCustomWeeks !== thatSettings.parsed.haveCustomWeeks){\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\tgetWorkHours: function () {\r\n\t\tvar config = this.argumentsHelper.getWorkHoursArguments.apply(this.argumentsHelper, arguments);\r\n\t\treturn this._getWorkHours(config.date, false);\r\n\t},\r\n\t_getWorkHours: function (date, parsed) {\r\n\t\tvar calendar = this.getConfig();\r\n\t\tif(parsed !== false){\r\n\t\t\tcalendar = calendar.parsed;\r\n\t\t}\r\n\r\n\t\tif(!date){\r\n\t\t\treturn calendar.hours;\r\n\t\t}\r\n\r\n\t\tconst dayStartDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());\r\n\r\n\t\tvar dateValue = this._timestamp({date: dayStartDate});\r\n\r\n\t\tif(calendar.haveCustomWeeks){\r\n\t\t\tif(calendar.customWeeksRangeStart <= dateValue && calendar.customWeeksRangeEnd > dateValue){\r\n\t\t\t\tfor(var i = 0; i < calendar.customWeeksBoundaries.length; i++){\r\n\t\t\t\t\tif(calendar.customWeeksBoundaries[i].from <= dateValue && calendar.customWeeksBoundaries[i].to > dateValue){\r\n\t\t\t\t\t\tcalendar = calendar.customWeeks[calendar.customWeeksBoundaries[i].name];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar hours = true;\r\n\r\n\t\tif (calendar.dates[dateValue] !== undefined) {\r\n\t\t\thours = calendar.dates[dateValue];//custom day\r\n\t\t} else if (calendar.dates[date.getDay()] !== undefined) {\r\n\t\t\thours = calendar.dates[date.getDay()];//week day\r\n\t\t}\r\n\t\tif (hours === true) {\r\n\t\t\treturn calendar.hours;\r\n\t\t} else if (hours) {\r\n\t\t\treturn hours;\r\n\t\t}\r\n\t\treturn [];\r\n\t},\r\n\r\n\t_getIntervalTimestamp: function(from, to){\r\n\t\tvar res = {\r\n\t\t\tstart: 0,\r\n\t\t\tend: 0\r\n\t\t};\r\n\r\n\t\tres.start = from.getHours() * 60 * 60 + from.getMinutes() * 60 + from.getSeconds();\r\n\t\tvar endHours = to.getHours();\r\n\t\tif(!endHours && !to.getMinutes() && !to.getSeconds() && from.valueOf() < to.valueOf()){\r\n\t\t\tendHours = 24;\r\n\t\t}\r\n\t\tres.end = endHours * 60 * 60 + to.getMinutes() * 60 + to.getSeconds();\r\n\t\treturn res;\r\n\t},\r\n\r\n\t_parseHours: function(hours) {\r\n\t\tif(Array.isArray(hours)){\r\n\r\n\t\t\tvar timestampRanges = [];// worktime as seconds range\r\n\t\t\thours.forEach(function(hour){\r\n\t\t\t\tif(typeof hour === \"number\"){\r\n\t\t\t\t\ttimestampRanges.push(hour*60*60);\r\n\t\t\t\t}else if(typeof hour === \"string\") {\r\n\t\t\t\t\t// \"12-13\", or \"12:00-13:00\", or \"12:00:00-13:00:00\"\r\n\t\t\t\t\thour.split(\"-\").map(function(time){\r\n\t\t\t\t\t\treturn time.trim();\r\n\t\t\t\t\t}).forEach(function(part){\r\n\t\t\t\t\t\tvar parsed = part.split(\":\").map(function(time){\r\n\t\t\t\t\t\t\treturn time.trim();\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tvar value = parseInt(parsed[0]*60*60);\r\n\t\t\t\t\t\tif(parsed[1]){\r\n\t\t\t\t\t\t\tvalue += parseInt(parsed[1]*60);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(parsed[2]){\r\n\t\t\t\t\t\t\tvalue += parseInt(parsed[2]);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ttimestampRanges.push(value);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tvar timerangeConfig = [];\r\n\t\t\tfor (var i = 0; i < timestampRanges.length; i += 2) {\r\n\t\t\t\tvar start = timestampRanges[i];\r\n\t\t\t\tvar end = timestampRanges[i + 1];\r\n\t\t\t\tvar duration = end - start;\r\n\r\n\t\t\t\ttimerangeConfig.push({\r\n\t\t\t\t\tstart: start,\r\n\t\t\t\t\tend: end,\r\n\t\t\t\t\tstartHour: Math.floor(start / (60*60)),\r\n\t\t\t\t\tstartMinute: Math.floor(start / (60)),\r\n\t\t\t\t\tendHour: Math.ceil(end / (60*60)),\r\n\t\t\t\t\tendMinute: Math.ceil(end / (60)),\r\n\t\t\t\t\tdurationSeconds: duration,\r\n\t\t\t\t\tdurationMinutes: duration/60,\r\n\t\t\t\t\tdurationHours: duration/(60 * 60)\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn timerangeConfig;\r\n\t\t} else {\r\n\t\t\treturn hours;\r\n\t\t}\r\n\t},\r\n\r\n\tsetWorkTime: function (settings) {\r\n\t\treturn this._tryChangeCalendarSettings(utils.bind(function () {\r\n\t\t\tvar hours = settings.hours !== undefined ? settings.hours : true;\r\n\t\t\tvar timestamp = this._timestamp(settings);\r\n\t\t\tvar calendarConfig = this.getConfig();\r\n\t\t\tif (timestamp !== null) {\r\n\t\t\t\tcalendarConfig.dates[timestamp] = hours;\r\n\t\t\t} else if(!settings.customWeeks) {\r\n\t\t\t\tcalendarConfig.hours = hours;\r\n\t\t\t}\r\n\r\n\t\t\tif(settings.customWeeks){\r\n\t\t\t\tif(!calendarConfig.customWeeks){\r\n\t\t\t\t\tcalendarConfig.customWeeks = {};\r\n\t\t\t\t}\r\n\t\t\t\t// GS-1867. allow setWorkTime to exclude dates in the customWeeks range\r\n\t\t\t\tif (typeof settings.customWeeks == \"string\"){\r\n\t\t\t\t\tif (timestamp !== null) {\r\n\t\t\t\t\t\tcalendarConfig.customWeeks[settings.customWeeks].dates[timestamp] = hours;\r\n\t\t\t\t\t} else if(!settings.customWeeks) {\r\n\t\t\t\t\t\tcalendarConfig.customWeeks[settings.customWeeks].hours = hours;\r\n\t\t\t\t\t}\t\t\r\n\t\t\t\t} else if (typeof settings.customWeeks === \"object\"\r\n\t\t\t\t&& settings.customWeeks.constructor === Object){\r\n\t\t\t\t\tfor(var i in settings.customWeeks){\r\n\t\t\t\t\t\tcalendarConfig.customWeeks[i] = settings.customWeeks[i];\r\n\t\t\t\t\t}\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._parseSettings();\r\n\t\t\tthis._clearCaches();\r\n\t\t}, this));\r\n\t},\r\n\r\n\tunsetWorkTime: function (settings) {\r\n\t\treturn this._tryChangeCalendarSettings(utils.bind(function () {\r\n\t\t\tif (!settings) {\r\n\t\t\t\tthis.reset_calendar();\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar timestamp = this._timestamp(settings);\r\n\r\n\t\t\t\tif (timestamp !== null) {\r\n\t\t\t\t\tdelete this.getConfig().dates[timestamp];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// Load updated settings and clear work units cache\r\n\t\t\tthis._parseSettings();\r\n\t\t\tthis._clearCaches();\r\n\t\t}, this));\r\n\t},\r\n\r\n\t_isWorkTime: function (date, unit) {\r\n\t\t// Check if this item has in the cache\r\n\r\n\t\tvar useCache = true;//unit === \"day\"; // use cache only for days. In case of hours/minutes cache size grows too large and the overhead exceeds the gains\r\n\t\tvar isWorkUnit = -1;\r\n\t\tvar dateKey = null;\r\n\r\n\t\tif(useCache){\r\n\t\t\t// use string keys\r\n\t\t\tdateKey = String(date.valueOf());\r\n\t\t\tisWorkUnit = this._workingUnitsCache.getItem(unit, dateKey, date);\r\n\t\t}\r\n\r\n\t\tif (isWorkUnit == -1) {\r\n\t\t\t// calculate if not cached\r\n\t\t\tisWorkUnit = this._checkIfWorkingUnit(date, unit);\r\n\t\t\tif(useCache){\r\n\t\t\t\tthis._workingUnitsCache.setItem(unit, dateKey, isWorkUnit, date);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn isWorkUnit;\r\n\t},\r\n\r\n\tisWorkTime: function () {\r\n\t\tvar config =  this.argumentsHelper.isWorkTimeArguments.apply( this.argumentsHelper, arguments);\r\n\t\treturn this._isWorkTime(config.date, config.unit);\r\n\t},\r\n\r\n\tcalculateDuration: function () {\r\n\t\tvar config =  this.argumentsHelper.getDurationArguments.apply( this.argumentsHelper, arguments);\r\n\r\n\t\tif (!config.unit) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t//return this._calculateDuration(config.start_date, config.end_date, config.unit, config.step);\r\n\r\n\t\tvar self = this;\r\n\t\treturn this._dateDurationCache.getDuration(config.start_date, config.end_date, config.unit, config.step, function(){ \r\n\t\t\treturn self._calculateDuration(config.start_date, config.end_date, config.unit, config.step);\r\n\t\t});\r\n\t},\r\n\r\n\t_calculateDuration: function (from, to, unit, step) {\r\n\t\tvar res = 0;\r\n\r\n\t\tvar sign = 1;\r\n\t\tif(from.valueOf() > to.valueOf()){\r\n\t\t\tvar tmp = to;\r\n\t\t\tto = from;\r\n\t\t\tfrom = tmp;\r\n\t\t\tsign = -1;\r\n\t\t}\r\n\r\n\t\tif (unit == \"hour\" && step == 1) {\r\n\t\t\tres = this._getHoursBetween(from, to, unit, step);\r\n\t\t} else if(unit == \"minute\" && step == 1){\r\n\t\t\t// quick calculation for minutes with 1 minute step\r\n\t\t\tres = this._getMinutesBetween(from, to, unit, step);\r\n\t\t} else {\r\n\t\t\tres = this._getWorkUnitsBetweenGeneric(from, to, unit, step);\r\n\t\t}\r\n\r\n\t\t// getWorkUnits.. returns decimal durations\r\n\t\treturn sign * Math.round(res);\r\n\t},\r\n\thasDuration: function () {\r\n\t\tvar config =  this.argumentsHelper.getDurationArguments.apply( this.argumentsHelper, arguments);\r\n\r\n\t\tvar from = config.start_date,\r\n\t\t\tto = config.end_date,\r\n\t\t\tunit = config.unit,\r\n\t\t\tstep = config.step;\r\n\r\n\t\tif (!unit) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar start = new Date(from),\r\n\t\t\tend = new Date(to);\r\n\t\tstep = step || 1;\r\n\r\n\t\twhile (start.valueOf() < end.valueOf()) {\r\n\t\t\tif (this._isWorkTime(start, unit))\r\n\t\t\t\treturn true;\r\n\t\t\tstart = this._nextDate(start, unit, step);\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\tcalculateEndDate: function () {\r\n\t\tvar config =  this.argumentsHelper.calculateEndDateArguments.apply( this.argumentsHelper, arguments);\r\n\r\n\t\tvar from = config.start_date,\r\n\t\t\tduration = config.duration,\r\n\t\t\tunit = config.unit,\r\n\t\t\tstep = config.step;\r\n\r\n\t\tif (!unit)\r\n\t\t\treturn false;\r\n\r\n\t\tvar mult = (config.duration >= 0) ? 1 : -1;\r\n\t\tduration = Math.abs(duration * 1);\r\n\t//\tvar endDate = this._calculateEndDate(from, duration, unit, step * mult);\r\n\t//\treturn endDate;\r\n\t\tvar self = this;\r\n\t\treturn this._dateDurationCache.getEndDate(from, duration, unit, step * mult, function(){ \r\n\t\t\treturn self._calculateEndDate(from, duration, unit, step * mult);\r\n\t\t} );\r\n\t},\r\n\r\n\t_calculateEndDate: function (from, duration, unit, step) {\r\n\t\tif (!unit)\r\n\t\t\treturn false;\r\n\r\n\t\tif (step == 1 && unit == \"minute\") {\r\n\t\t\treturn this._calculateMinuteEndDate(from, duration, step);\r\n\t\t} else if(step == -1 && unit == \"minute\") {\r\n\t\t\treturn this._subtractMinuteDate(from, duration, step);\r\n\t\t} else if (step == 1 && unit == \"hour\") {\r\n\t\t\treturn this._calculateHourEndDate(from, duration, step);\r\n\t\t} else {\r\n\t\t\tvar interval = this._addInterval(from, duration, unit, step, null);\r\n\t\t\treturn interval.end;\r\n\t\t}\r\n\t},\r\n\r\n\t_addInterval: function (start, duration, unit, step, stopAction) {\r\n\t\tvar added = 0;\r\n\t\tvar current = start;\r\n\t\tvar dstShift = false;\r\n\r\n\t\twhile (added < duration && !(stopAction && stopAction(current))) {\r\n\t\t\tvar next = this._nextDate(current, unit, step);\r\n\r\n\t\t\t// GS-1501. Correct hours after DST change\r\n\t\t\tif (unit == \"day\"){\r\n\t\t\t\tdstShift = dstShift || !current.getHours() && next.getHours();\r\n\r\n\t\t\t\tif (dstShift){\r\n\t\t\t\t\tnext.setHours(0);\r\n\t\t\t\t\tif (next.getHours()){\r\n\t\t\t\t\t// the day when the timezone is changed, try to correct hours next time\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdstShift = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar dateValue = new Date(next.valueOf() + 1);\r\n\t\t\tif (step > 0) {\r\n\t\t\t\tdateValue = new Date(next.valueOf() - 1);\r\n\t\t\t}\r\n\t\t\tvar workTimeCheck = this._isWorkTime(dateValue, unit);\r\n\r\n\t\t\tif (workTimeCheck && !dstShift) {\r\n\t\t\t\tadded++;\r\n\t\t\t}\r\n\t\t\tcurrent = next;\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tend: current,\r\n\t\t\tstart: start,\r\n\t\t\tadded: added\r\n\t\t};\r\n\t},\r\n\r\n\t_addHoursUntilDayEnd: function(from, duration) {\r\n\t\tvar dayEnd = this.$gantt.date.add(this.$gantt.date.day_start(new Date(from)), 1, \"day\");\r\n\t\tvar added = 0;\r\n\t\tvar left = duration;\r\n\r\n\t\tvar range = this._getIntervalTimestamp(from, dayEnd);\r\n\t\tvar worktimes = this._getWorkHours(from);\r\n\t\tfor(var i = 0; i < worktimes.length && added < duration; i++){\r\n\t\t\tvar interval = worktimes[i];\r\n\t\t\tif(range.end >= interval.start && range.start <= interval.end){\r\n\t\t\t\tvar minuteFrom = Math.max(interval.start, range.start);\r\n\t\t\t\tvar minuteTo = Math.min(interval.end, range.end);\r\n\t\t\t\tvar rangeHours = (minuteTo - minuteFrom) / (60 * 60);\r\n\t\t\t\tif(rangeHours > left){\r\n\t\t\t\t\trangeHours = left;\r\n\t\t\t\t\tminuteTo = minuteFrom + (left * 60 * 60);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar addHours = Math.round((minuteTo - minuteFrom) / (60 * 60));\r\n\t\t\t\tadded += addHours;\r\n\t\t\t\tleft -= addHours;\r\n\t\t\t\trange.start = minuteTo;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar intervalEnd = dayEnd;\r\n\t\tif(added === duration){\r\n\t\t\tintervalEnd = new Date(from.getFullYear(), from.getMonth(), from.getDate(), 0, 0, range.start);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tadded: added,\r\n\t\t\tend: intervalEnd\r\n\t\t};\r\n\t},\r\n\r\n\t_calculateHourEndDate: function (from, duration,  step) {\r\n\t\tvar start = new Date(from),\r\n\t\tadded = 0;\r\n\t\tstep = step || 1;\r\n\t\tduration = Math.abs(duration * 1);\r\n\r\n\t\tvar interval = this._addHoursUntilDayEnd(start, duration);\r\n\t\tadded = interval.added;\r\n\t\tstart = interval.end;\r\n\r\n\t\tvar durationLeft = duration - added;\r\n\r\n\t\tif (durationLeft) {\r\n\t\t\tvar current = start;\r\n\t\t\twhile (added < duration) {\r\n\t\t\t\tvar next = this._nextDate(current, \"day\", step);\r\n\t\t\t\t// reset to day start in case DST switch happens in the process\r\n\t\t\t\tnext.setHours(0);\r\n\t\t\t\tnext.setMinutes(0);\r\n\t\t\t\tnext.setSeconds(0);\r\n\r\n\t\t\t\tvar hoursPerDay = 0;\r\n\t\t\t\tif(step > 0){\r\n\t\t\t\t\thoursPerDay = this.getHoursPerDay(new Date(next.valueOf() - 1));\r\n\t\t\t\t}else{\r\n\t\t\t\t\thoursPerDay = this.getHoursPerDay(new Date(next.valueOf() + 1));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (added + hoursPerDay >= duration) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tadded += hoursPerDay;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcurrent = next;\r\n\t\t\t}\r\n\t\t\tstart = current;\r\n\t\t}\r\n\r\n\t\tif (added < duration) {\r\n\t\t\tvar durationLeft = duration - added;\r\n\t\t\tinterval = this._addHoursUntilDayEnd(start, durationLeft);\r\n\t\t\tstart = interval.end;\r\n\t\t}\r\n\r\n\t\treturn start;\r\n\t},\r\n\r\n\t_addMinutesUntilHourEnd: function(from, duration){\r\n\t\tif(from.getMinutes() === 0) {\r\n\t\t\t// already at hour end\r\n\t\t\treturn {\r\n\t\t\t\tadded: 0,\r\n\t\t\t\tend: new Date(from)\r\n\t\t\t};\r\n\t\t}\r\n\t\tvar hourEnd = this.$gantt.date.add(this.$gantt.date.hour_start(new Date(from)), 1, \"hour\");\r\n\t\tvar added = 0;\r\n\t\tvar left = duration;\r\n\r\n\t\tvar range = this._getIntervalTimestamp(from, hourEnd);\r\n\t\tvar worktimes = this._getWorkHours(from);\r\n\t\tfor(var i = 0; i < worktimes.length && added < duration; i++){\r\n\t\t\tvar interval = worktimes[i];\r\n\t\t\tif(range.end >= interval.start && range.start <= interval.end){\r\n\t\t\t\tvar minuteFrom = Math.max(interval.start, range.start);\r\n\t\t\t\tvar minuteTo = Math.min(interval.end, range.end);\r\n\t\t\t\tvar rangeMinutes = (minuteTo - minuteFrom) / 60;\r\n\t\t\t\tif(rangeMinutes > left){\r\n\t\t\t\t\trangeMinutes = left;\r\n\t\t\t\t\tminuteTo = minuteFrom + (left * 60);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// TODO: verify testcase https://dhtmlxsupport.teamwork.com/desk/tickets/9625700/messages\r\n\t\t\t\t/*if (rangeMinutes === 0) {\r\n\t\t\t\t\trangeMinutes = left;\r\n\t\t\t\t\tminuteTo = minuteFrom + (left * 60);\r\n\t\t\t\t}*/\r\n\r\n\t\t\t\tvar addMinutes = Math.round((minuteTo - minuteFrom) / 60);\r\n\t\t\t\tleft -= addMinutes;\r\n\t\t\t\tadded += addMinutes;\r\n\t\t\t\trange.start = minuteTo;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar intervalEnd = hourEnd;\r\n\t\tif(added === duration){\r\n\t\t\tintervalEnd = new Date(from.getFullYear(), from.getMonth(), from.getDate(), 0, 0, range.start);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tadded: added,\r\n\t\t\tend: intervalEnd\r\n\t\t};\r\n\t},\r\n\r\n\t_subtractMinutesUntilHourStart: function(from, duration){\r\n\t\tvar hourStart = this.$gantt.date.hour_start(new Date(from));\r\n\t\tvar added = 0;\r\n\t\tvar left = duration;\r\n\r\n\t\tvar hourStartTimestamp = hourStart.getHours() * 60 * 60 + hourStart.getMinutes() * 60 + hourStart.getSeconds();\r\n\t\tvar initialDateTimestamp = from.getHours() * 60 * 60 + from.getMinutes() * 60 + from.getSeconds();\r\n\r\n\t\tvar worktimes = this._getWorkHours(from);\r\n\t\tfor(var i = worktimes.length - 1; i >= 0 && added < duration; i--){\r\n\t\t\tvar interval = worktimes[i];\r\n\t\t\tif(initialDateTimestamp > interval.start && hourStartTimestamp <= interval.end){\r\n\t\t\t\tvar minuteFrom = Math.min(initialDateTimestamp, interval.end);\r\n\t\t\t\tvar minuteTo = Math.max(hourStartTimestamp, interval.start);\r\n\r\n\t\t\t//\tvar minuteFrom = Math.max(interval.start, currentHour.start);\r\n\t\t\t//\tvar minuteTo = Math.min(interval.end, currentHour.end);\r\n\t\t\t\tvar rangeMinutes = (minuteFrom - minuteTo) / 60;\r\n\t\t\t\tif(rangeMinutes > left){\r\n\t\t\t\t\trangeMinutes = left;\r\n\t\t\t\t\tminuteTo = minuteFrom - (left * 60);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// TODO: verify testcase https://dhtmlxsupport.teamwork.com/desk/tickets/9625700/messages\r\n\t\t\t\t/*if (rangeMinutes === 0) {\r\n\t\t\t\t\trangeMinutes = left;\r\n\t\t\t\t\tminuteTo = minuteFrom - (left * 60);\r\n\t\t\t\t}*/\r\n\r\n\t\t\t\tvar addMinutes = Math.abs(Math.round((minuteFrom - minuteTo) / 60));\r\n\t\t\t\tleft -= addMinutes;\r\n\t\t\t\tadded += addMinutes;\r\n\t\t\t\tinitialDateTimestamp = minuteTo;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar intervalEnd = hourStart;\r\n\t\tif(added === duration){\r\n\t\t\tintervalEnd = new Date(from.getFullYear(), from.getMonth(), from.getDate(), 0, 0, initialDateTimestamp);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tadded: added,\r\n\t\t\tend: intervalEnd\r\n\t\t};\r\n\t},\r\n\r\n\t_subtractMinuteDate: function (from, duration, step) {\r\n\t\t// var start = new Date(from),\r\n\t\t// GS-2683. We should start calculating minutes from the working time\r\n\t\tvar start = this.getClosestWorkTime({ date: from, dir: \"past\", unit: \"minute\" }),\r\n\t\t\tadded = 0;\r\n\t\tstep = step || -1;\r\n\t\tduration = Math.abs(duration * 1);\r\n\t\tduration = Math.round(duration);\r\n\r\n\t\tconst minutePrecision = this._isMinutePrecision(start);\r\n\r\n\t\tlet addedInterval = this._subtractMinutesUntilHourStart(start, duration);\r\n\t\tadded += addedInterval.added;\r\n\r\n\t\tstart = addedInterval.end;\r\n\r\n\t\tvar calculatedDay = 0;\r\n\t\tvar daySchedule = [];\r\n\t\tvar minutesInDay = 0;\r\n\r\n\t\twhile (added < duration) {\r\n\t\t\tvar dayStart = this.$gantt.date.day_start(new Date(start));\r\n\r\n\t\t\tvar iterateFromDayEnd = false;\r\n\t\t\tif(start.valueOf() === dayStart.valueOf()){\r\n\t\t\t\tdayStart = this.$gantt.date.add(dayStart, -1, \"day\");\r\n\t\t\t\titerateFromDayEnd = true;\r\n\t\t\t}\r\n\t\t\t//var dayStartTimestamp = this.$gantt.date.day_start(new Date(start)).valueOf();\r\n\t\t\tvar dayEnd = new Date(dayStart.getFullYear(), dayStart.getMonth(), dayStart.getDate(), 23, 59,59,999).valueOf();\r\n\r\n\t\t\tif(dayEnd !== calculatedDay){\r\n\t\t\t\tdaySchedule = this._getWorkHours(dayStart);\r\n\t\t\t\tminutesInDay = this._getMinutesPerDay(dayStart);\r\n\t\t\t\tcalculatedDay = dayEnd;\r\n\t\t\t}\r\n\r\n\t\t\tvar left = duration - added;\r\n\t\t\tvar timestamp = this._getTimeOfDayStamp(start, iterateFromDayEnd);\r\n\r\n\t\t\tif(!daySchedule.length || !minutesInDay){\r\n\t\t\t\tstart = this.$gantt.date.add(start, -1, \"day\");\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif(daySchedule[daySchedule.length - 1].end <= timestamp){\r\n\t\t\t\tif(left > minutesInDay){\r\n\t\t\t\t\tadded += minutesInDay;\r\n\t\t\t\t\tstart = this.$gantt.date.add(start, -1, \"day\");\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar isWorkHour = false;\r\n\t\t\tvar workInterval = null;\r\n\t\t\tvar prevInterval = null;\r\n\t\t\tfor(var i = daySchedule.length - 1; i >= 0; i--){\r\n\t\t\t\tif(daySchedule[i].start < timestamp - 1 && daySchedule[i].end >= timestamp - 1){\r\n\t\t\t\t\tisWorkHour = true;\r\n\t\t\t\t\tworkInterval = daySchedule[i];\r\n\t\t\t\t\tprevInterval = daySchedule[i-1];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(isWorkHour){\r\n\r\n\t\t\t\t// we're at the end of worktime interval and subtracting more than the duration of the interval\r\n\t\t\t\t// -> subtract the duration of the interval and move to the start of the interval (we're moving from end)\r\n\t\t\t\tif(timestamp === workInterval.end && left >= workInterval.durationMinutes){\r\n\t\t\t\t\tadded += workInterval.durationMinutes;\r\n\t\t\t\t\tstart = this.$gantt.date.add(start, -workInterval.durationMinutes, \"minute\");\r\n\t\t\t\t} // worktime is set in whole hours (no intervals like 9:15-10:00)\r\n\t\t\t\t// the amount we need to subtract lies inside the interval\r\n\t\t\t\telse if(!minutePrecision && left <= (timestamp/60 - workInterval.startMinute)){\r\n\t\t\t\t\tadded += left;\r\n\t\t\t\t\tstart = this.$gantt.date.add(start, -left, \"minute\");\r\n\t\t\t\t}else if (minutePrecision){\r\n\t\t\t\t\t// GS-2129. If the working time is set in minutes, we accumulate the working time in minutes from right to left\r\n\t\t\t\t\t\r\n\t\t\t\t\t// duration we need to subtract lies completely inside the work interval\r\n\t\t\t\t\tif(left <= (timestamp/60 - workInterval.startMinute)){\r\n\t\t\t\t\t\tadded += left;\r\n\t\t\t\t\t\tstart = this.$gantt.date.add(start, -left, \"minute\");\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\t\t// we need to go trough multiple work intervals to subtract needed time\r\n\t\t\t\t\t\tadded += (timestamp/60 - workInterval.startMinute);\r\n\t\t\t\t\t\tif(prevInterval){\r\n\t\t\t\t\t\t\tstart = new Date(start.getFullYear(), start.getMonth(), start.getDate(), 0, 0, prevInterval.end);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tstart = this.$gantt.date.day_start(start);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\r\n\t\t\t\t}else{\r\n\t\t\t\t\tvar minutesInHour = this._getMinutesPerHour(start);\r\n\t\t\t\t\tif(minutesInHour <= left){\r\n\t\t\t\t\t\tadded += minutesInHour;\r\n\t\t\t\t\t\tstart = this._nextDate(start, \"hour\", step);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\taddedInterval = this._subtractMinutesUntilHourStart(start, left);\r\n\t\t\t\t\t\tadded += addedInterval.added;\r\n\t\t\t\t\t\tstart = addedInterval.end;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tif(start.getHours() === 0 && start.getMinutes() === 0 && start.getSeconds() === 0){\r\n\t\t\t\t\tvar prev = this._getClosestWorkTimePast(start, \"hour\");\r\n\t\t\t\t\tif(prev.valueOf() === start.valueOf()){\r\n\t\t\t\t\t\tvar prev = this.$gantt.date.add(start, -1, \"day\");\r\n\t\t\t\t\t\tvar times = this._getWorkHours(prev);\r\n\t\t\t\t\t\tif(times.length){\r\n\t\t\t\t\t\t\tvar lastInterval = times[times.length - 1];\r\n\t\t\t\t\t\t\tprev.setSeconds(lastInterval.durationSeconds);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tstart = prev;\r\n\r\n\t\t\t\t} else{\r\n\t\t\t\t\tstart = this._getClosestWorkTimePast(new Date(start - 1), \"hour\");\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (added < duration) {\r\n\t\t\tvar durationLeft = duration - added;\r\n\t\t\taddedInterval = this._subtractMinutesUntilHourStart(start, durationLeft);\r\n\t\t\tadded += addedInterval.added;\r\n\t\t\tstart = addedInterval.end;\r\n\t\t}\r\n\r\n\t\treturn start;\r\n\t},\r\n\t_calculateMinuteEndDate: function (from, duration, step) {\r\n\t\tvar start = new Date(from),\r\n\t\t\tadded = 0;\r\n\t\tstep = step || 1;\r\n\t\tduration = Math.abs(duration * 1);\r\n\t\tduration = Math.round(duration);\r\n\r\n\t\tvar addedInterval = this._addMinutesUntilHourEnd(start, duration);\r\n\t\tadded += addedInterval.added;\r\n\r\n\t\tstart = addedInterval.end;\r\n\r\n\t\tvar calculatedDay = 0;\r\n\t\tvar daySchedule = [];\r\n\t\tvar minutesInDay = 0;\r\n\r\n\t\tvar minutePrecision = this._isMinutePrecision(start);\r\n\r\n\t\twhile (added < duration) {\r\n\t\t\tvar dayStart = this.$gantt.date.day_start(new Date(start)).valueOf();\r\n\t\t\tif(dayStart !== calculatedDay){\r\n\t\t\t\tdaySchedule = this._getWorkHours(start);\r\n\t\t\t\tminutesInDay = this._getMinutesPerDay(start);\r\n\t\t\t\tcalculatedDay = dayStart;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar left = duration - added;\r\n\t\t\tvar timestamp = this._getTimeOfDayStamp(start);\r\n\r\n\t\t\tif(!daySchedule.length || !minutesInDay){\r\n\t\t\t\tstart = this.$gantt.date.add(this.$gantt.date.day_start(start), 1, \"day\");\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif(daySchedule[0].start >= timestamp){\r\n\t\t\t\tif(left >= minutesInDay){\r\n\t\t\t\t\tadded += minutesInDay;\r\n\t\t\t\t\tif (left == minutesInDay) {\r\n\t\t\t\t\t\tstart = new Date(start.getFullYear(), start.getMonth(), start.getDate(), 0, 0, daySchedule[daySchedule.length - 1].end);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tstart = this.$gantt.date.add(start, 1, \"day\");\r\n\t\t\t\t\t\tstart = this.$gantt.date.day_start(start);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar isWorkHour = false;\r\n\t\t\tvar workInterval = null;\r\n\t\t\tfor(var i = 0; i < daySchedule.length; i++){\r\n\t\t\t\tif(daySchedule[i].start <= timestamp && daySchedule[i].end > timestamp){\r\n\t\t\t\t\tisWorkHour = true;\r\n\t\t\t\t\tworkInterval = daySchedule[i];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(isWorkHour){\r\n\r\n\t\t\t\tif(timestamp === workInterval.start && left >= workInterval.durationMinutes){\r\n\t\t\t\t\tadded += workInterval.durationMinutes;\r\n\t\t\t\t\tstart = this.$gantt.date.add(start, workInterval.durationMinutes, \"minute\");\r\n\t\t\t\t}else if(left <= (workInterval.endMinute - timestamp/60)){\r\n\t\t\t\t\tadded += left;\r\n\t\t\t\t\tstart = this.$gantt.date.add(start, left, \"minute\");\r\n\t\t\t\t}else{\r\n\t\t\t\t\tvar minutesInHour = this._getMinutesPerHour(start);\r\n\t\t\t\t\tif(minutesInHour <= left){\r\n\t\t\t\t\t\tadded += minutesInHour;\r\n\t\t\t\t\t\t// when the working time settings are set in minutes move to the next minutes\r\n\t\t\t\t\t\tif (minutePrecision) {\r\n\t\t\t\t\t\t\tstart = this.$gantt.date.add(start, minutesInHour, \"minute\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tstart = this._nextDate(start, \"hour\", step);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\taddedInterval = this._addMinutesUntilHourEnd(start, left);\r\n\t\t\t\t\t\tadded += addedInterval.added;\r\n\t\t\t\t\t\tstart = addedInterval.end;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tstart = this._getClosestWorkTimeFuture(start, \"hour\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (added < duration) {\r\n\t\t\tvar durationLeft = duration - added;\r\n\t\t\taddedInterval = this._addMinutesUntilHourEnd(start, durationLeft);\r\n\t\t\tadded += addedInterval.added;\r\n\t\t\tstart = addedInterval.end;\r\n\t\t}\r\n\r\n\t\treturn start;\r\n\t},\r\n\r\n\tgetClosestWorkTime: function () {\r\n\t\tvar settings =  this.argumentsHelper.getClosestWorkTimeArguments.apply( this.argumentsHelper, arguments);\r\n\t\treturn this._getClosestWorkTime(settings.date, settings.unit, settings.dir);\r\n\t},\r\n\r\n\t_getClosestWorkTime: function (inputDate, unit, direction) {\r\n\t\tvar result = new Date(inputDate);\r\n\r\n\t\tif (this._isWorkTime(result, unit)) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tresult = this.$gantt.date[unit + '_start'](result);\r\n\r\n\t\tif (direction == 'any' || !direction) {\r\n\t\t\tvar closestFuture = this._getClosestWorkTimeFuture(result, unit);\r\n\t\t\tvar closestPast = this._getClosestWorkTimePast(result, unit);\r\n\t\t\tif (Math.abs(closestFuture - inputDate) <= Math.abs(inputDate - closestPast)) {\r\n\t\t\t\tresult = closestFuture;\r\n\t\t\t} else {\r\n\t\t\t\tresult = closestPast;\r\n\t\t\t}\r\n\t\t} else if (direction == \"past\") {\r\n\t\t\tresult = this._getClosestWorkTimePast(result, unit);\r\n\t\t} else {\r\n\t\t\tresult = this._getClosestWorkTimeFuture(result, unit);\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t_getClosestWorkTimeFuture: function (date, unit) {\r\n\t\treturn this._getClosestWorkTimeGeneric(date, unit, 1);\r\n\t},\r\n\r\n\t_getClosestWorkTimePast: function (date, unit) {\r\n\t\tvar result = this._getClosestWorkTimeGeneric(date, unit, -1);\r\n\t\t// should return the end of the closest work interval\r\n\t\treturn this.$gantt.date.add(result, 1, unit);\r\n\t},\r\n\r\n\t_findClosestTimeInDay: function(date, direction, worktimes) {\r\n\t\tvar start = new Date(date);\r\n\t\tvar resultDate = null;\r\n\t\tvar fromDayEnd = false;\r\n\t\tif(!this._getWorkHours(start).length){\r\n\t\t\tstart = this._getClosestWorkTime(start, \"day\", direction < 0 ? \"past\" : \"future\");\r\n\t\t\tif(direction < 0){\r\n\t\t\t\tstart = new Date(start.valueOf() - 1);\r\n\t\t\t\tfromDayEnd = true;\r\n\t\t\t}\r\n\t\t\tworktimes = this._getWorkHours(start);\r\n\t\t}\r\n\r\n\t\tvar value = this._getTimeOfDayStamp(start);\r\n\t\tif(fromDayEnd){\r\n\t\t\tvalue = this._getTimeOfDayStamp(new Date(start.valueOf() + 1), fromDayEnd);\r\n\t\t}\r\n\t\tif(direction > 0){\r\n\t\t\tfor(var i = 0; i < worktimes.length; i++){\r\n\t\t\t\tif(worktimes[i].start >= value){\r\n\t\t\t\t\tresultDate = new Date(start.getFullYear(), start.getMonth(), start.getDate(), 0, 0, worktimes[i].start);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tfor(var i = worktimes.length - 1; i >= 0; i--){\r\n\t\t\t\tif(worktimes[i].end <= value){\r\n\t\t\t\t\tresultDate = new Date(start.getFullYear(), start.getMonth(), start.getDate(), 0, 0, worktimes[i].end);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}else if(worktimes[i].end > value && worktimes[i].start <= value) {\r\n\t\t\t\t\tresultDate = new Date(start.getFullYear(), start.getMonth(), start.getDate(), 0, 0, value);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn resultDate;\r\n\t},\r\n\t_getClosestWorkMinute: function(date, unit, direction) {\r\n\t\tvar start = new Date(date);\r\n\t\tvar worktimes = this._getWorkHours(start);\r\n\t\tvar resultDate = this._findClosestTimeInDay(start, direction, worktimes);\r\n\t\tif(!resultDate){\r\n\t\t\tif(direction > 0){\r\n\t\t\t\tstart = this.calculateEndDate(start, direction, unit);\r\n\t\t\t\tstart = this.$gantt.date.day_start(start);\r\n\t\t\t}else{\r\n\t\t\t\tstart = this.calculateEndDate(start, direction, \"day\");\r\n\t\t\t\tstart = this.$gantt.date.day_start(start);\r\n\t\t\t\tstart = this.$gantt.date.add(start, 1, \"day\");\r\n\t\t\t\tstart = new Date(start.valueOf() - 1);\r\n\t\t\t}\r\n\t\t\tworktimes = this._getWorkHours(start);\r\n\t\t\tresultDate = this._findClosestTimeInDay(start, direction, worktimes);\r\n\t\t}\r\n\t\tif(direction < 0){\r\n\t\t\t// getClosestWorkTimePast adds one time unit to the result date after this\r\n\t\t\tresultDate = this.$gantt.date.add(resultDate, -1, unit);\r\n\t\t}\r\n\t\treturn resultDate;\r\n\t},\r\n\r\n\t_getClosestWorkTimeGeneric: function (date, unit, increment) {\r\n\t\tif(unit === \"hour\" || unit === \"minute\"){\r\n\t\t\treturn this._getClosestWorkMinute(date, unit, increment);\r\n\t\t}\r\n\r\n\t\tvar unitOrder = this._getUnitOrder(unit),\r\n\t\t\tbiggerTimeUnit = this.units[unitOrder - 1];\r\n\r\n\t\tvar result = date;\r\n\r\n\t\t// be extra sure we won't fall into infinite loop, 3k seems big enough\r\n\t\tvar maximumLoop = 3000,\r\n\t\t\tcount = 0;\r\n\r\n\t\twhile (!this._isWorkTime(result, unit)) {\r\n\t\t\tif (biggerTimeUnit && !this._isWorkTime(result, biggerTimeUnit)) {\r\n\t\t\t\t// if we look for closest work hour and detect a week-end - first find the closest work day,\r\n\t\t\t\t// and continue iterations after that\r\n\t\t\t\tif (increment > 0) {\r\n\t\t\t\t\tresult = this._getClosestWorkTimeFuture(result, biggerTimeUnit);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult = this._getClosestWorkTimePast(result, biggerTimeUnit);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this._isWorkTime(result, unit)) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tcount++;\r\n\t\t\tif (count > maximumLoop) {\r\n\t\t\t\tthis.$gantt.assert(false, \"Invalid working time check\");\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tvar tzOffset = result.getTimezoneOffset();\r\n\t\t\tresult = this.$gantt.date.add(result, increment, unit);\r\n\r\n\t\t\tresult = this.$gantt._correct_dst_change(result, tzOffset, increment, unit);\r\n\t\t\tif (this.$gantt.date[unit + '_start']) {\r\n\t\t\t\tresult = this.$gantt.date[unit + '_start'](result);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/**\r\n\t * Check whether this calendar has working time. Calendar has working time only if there are regular working days of week\r\n\t *\r\n\t */\r\n\thasWorkTime: function () {\r\n\t\tvar worktime = this.getConfig();\r\n\t\tvar dates = worktime.dates;\r\n\r\n\t\tvar daysOfWeek = [0, 1, 2, 3, 4, 5, 6];\r\n\t\tvar exceptions = [];\r\n\t\tfor(var i in worktime.dates){\r\n\t\t\tif(Number(i) > 6){\r\n\t\t\t\texceptions.push(Number(i));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar hasRegularHours = this._checkWorkHours(worktime.hours);\r\n\r\n\t\tvar result = false;\r\n\t\tdaysOfWeek.forEach((function(day){\r\n\t\t\tif(result){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar dayConfig = dates[day];\r\n\t\t\tif(dayConfig === true){\r\n\t\t\t\t// workday uses global hours\r\n\t\t\t\tresult = hasRegularHours;\r\n\t\t\t}else if(Array.isArray(dayConfig)){\r\n\t\t\t\t// workday uses custom hours\r\n\t\t\t\tresult = this._checkWorkHours(dayConfig);\r\n\t\t\t}\r\n\t\t}).bind(this));\r\n\r\n\t\treturn result;\r\n\r\n\t},\r\n\r\n\t_checkWorkHours: function(hoursArray) {\r\n\t\tif (hoursArray.length === 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar result = false;\r\n\t\tfor (var i = 0; i < hoursArray.length; i += 2) {\r\n\t\t\tif (hoursArray[i] !== hoursArray[i + 1]) {\r\n\t\t\t\tresult = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t_isMinutePrecision: function (date) {\r\n\t\tlet minutePrecision = false;\r\n\t\tthis._getWorkHours(date).forEach(function(interval){\r\n\t\t\tif (interval.startMinute % 60 || interval.endMinute % 60){\r\n\t\t\t\tminutePrecision = true;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn minutePrecision;\r\n\t}\r\n};\r\n\r\nexport default CalendarWorkTimeStrategy;","import { IWorkUnitCache } from \"./workunit_cache_interface\";\r\nimport { WorkUnitsMapCache } from \"./workunit_map_cache\";\r\nimport { WorkUnitsObjectCache } from \"./workunit_object_cache\";\r\nexport { LargerUnitsCache } from \"./larger_units_helper\";\r\n\r\nexport function createCacheObject(): IWorkUnitCache {\r\n\r\n\t// worktime hash is on the hot path,\r\n\t// Map seems to work faster than plain array, use it whenever possible\r\n\tif (typeof Map !== \"undefined\") {\r\n\t\treturn new WorkUnitsMapCache();\r\n\t} else {\r\n\t\treturn new WorkUnitsObjectCache();\r\n\t}\r\n}\r\n","export default {\r\n\tisLegacyResourceCalendarFormat: function(resourceCalendarsProperty){\r\n\t\t// modern format:\r\n\t\t//gantt.config.resource_calendars = {\r\n\t\t//\tresourceId: calendarId,\r\n\t\t//\tresourceId: calendarId,\r\n\t\t//\tresourceId: calendarId\r\n\t\t//\t};\r\n\t\t\r\n\t\t// legacy format:\r\n\t\t// gantt.config.resource_calendars = {\r\n\t\t//\t\"resourceProperty\": {\r\n\t\t//\t\tresourceId: calendarId,\r\n\t\t//\t\tresourceId: calendarId,\r\n\t\t//\t\tresourceId: calendarId\r\n\t\t//\t\t}\r\n\t\t//\t};\r\n\r\n\t\tif(!resourceCalendarsProperty){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tfor(var i in resourceCalendarsProperty){\r\n\t\t\tif(resourceCalendarsProperty[i] && typeof resourceCalendarsProperty[i] === \"object\"){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t},\r\n\tgetResourceProperty: function(config){\r\n\t\tvar resourceCalendarsConfig = config.resource_calendars;\r\n\t\tvar propertyName = config.resource_property;\r\n\t\tif(this.isLegacyResourceCalendarFormat(resourceCalendarsConfig)){\r\n\t\t\tfor(var i in config){\r\n\t\t\t\tpropertyName = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn propertyName;\r\n\t},\r\n\tgetCalendarIdFromLegacyConfig: function(task, config){\r\n\t\tif (config) {\r\n\t\t\tfor (var field in config) {\r\n\t\t\t\tvar resource = config[field];\r\n\t\t\t\tif (task[field]) {\r\n\t\t\t\t\tvar calendarId = resource[task[field]];\r\n\t\t\t\t\tif (calendarId) {\r\n\t\t\t\t\t\treturn calendarId;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n};","import * as utils from \"../../utils/utils\";\r\nimport createArgumentsHelper from \"./calendar_arguments_helper\";\r\nimport CalendarMergeHelper from \"./strategy/work_calendar_merger\";\r\nimport CalendarWorkTimeStrategy from \"./strategy/calendar_strategy\";\r\nimport legacyResourceCalendarConfig from \"./legacy_resource_config\";\r\nimport dynamicResourceCalendarsFactory from \"./dynamic_resource_calendars\";\r\n\r\nconst dynamicResourceCalendars = dynamicResourceCalendarsFactory();\r\n\r\nfunction CalendarManager (gantt){\r\n\tthis.$gantt = gantt;\r\n\tthis._calendars = {};\r\n\tthis._legacyConfig = undefined;\r\n\tthis.$gantt.attachEvent(\"onGanttReady\", function(){\r\n\t\tif(this.$gantt.config.resource_calendars){\r\n\t\t\tthis._isLegacyConfig = legacyResourceCalendarConfig.isLegacyResourceCalendarFormat(this.$gantt.config.resource_calendars);\r\n\t\t}\r\n\t}.bind(this));\r\n\r\n\tthis.$gantt.attachEvent(\"onBeforeGanttReady\", function(){\r\n\t\tthis.createDefaultCalendars();\r\n\t}.bind(this));\r\n\tthis.$gantt.attachEvent(\"onBeforeGanttRender\", function(){\r\n\t\tthis.createDefaultCalendars();\r\n\t}.bind(this));\r\n}\r\n\r\nCalendarManager.prototype = {\r\n\t_calendars: {},\r\n\t_convertWorkTimeSettings: function (settings) {\r\n\t\tconst days = settings.days;\r\n\t\t//GS-2864: opportunity to specify specific dates\r\n\t\tif(typeof days === \"object\" && !Array.isArray(days) && days !== null){\r\n\t\t\tconst datesConfig = {};\r\n\t\t\tif(days?.weekdays){\r\n\t\t\t\tfor(let i = 0; i < 7; i++) {\r\n\t\t\t\t\tdatesConfig[i] = days.weekdays[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (days?.dates) {\r\n\t\t\t\tObject.entries(days.dates).forEach(([date, setting]) => {\r\n\t\t\t\t\tdatesConfig[(new Date(date)).valueOf()] = setting;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tObject.entries(datesConfig).forEach(([key, setting]) => {\r\n\t\t\t\tif (!(setting instanceof Array)) {\r\n\t\t\t\t\tdatesConfig[key] = !!setting;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tsettings = {\r\n\t\t\t\t...settings,\r\n\t\t\t\tdates: datesConfig\r\n\t\t\t};\r\n\r\n\t\t} else if (days && !settings.dates) {\r\n\t\t\tsettings.dates = settings.dates || {};\r\n\t\t\tfor (let i = 0; i < days.length; i++) {\r\n\t\t\t\tsettings.dates[i] = days[i];\r\n\t\t\t\tif (!(days[i] instanceof Array)) {\r\n\t\t\t\t\tsettings.dates[i] = !!days[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tdelete settings.days;\r\n\t\treturn settings;\r\n\t},\r\n\tmergeCalendars: function(){\r\n\t\tvar calendars = [];\r\n\t\tvar args = arguments;\r\n\t\tif(Array.isArray(args[0])){\r\n\t\t\tcalendars = args[0].slice();\r\n\t\t}else{\r\n\t\t\tfor(var i = 0; i < arguments.length; i++){\r\n\t\t\t\tcalendars.push(arguments[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar mergeHelper = new CalendarMergeHelper();\r\n\r\n\t\tvar result;\r\n\t\tcalendars.forEach(function(calendar){\r\n\t\t\tif(!result){\r\n\t\t\t\tresult = calendar;\r\n\t\t\t} else{\r\n\t\t\t\tresult = this._createCalendarFromConfig(mergeHelper.merge(result, calendar));\r\n\t\t\t}\r\n\r\n\t\t}.bind(this));\r\n\t\treturn this.createCalendar(result);\r\n\t},\r\n\r\n\t_createCalendarFromConfig: function(config){\r\n\t\tvar apiCore = new CalendarWorkTimeStrategy(this.$gantt, createArgumentsHelper(this.$gantt));\r\n\t\tapiCore.id = String(utils.uid());\r\n\r\n\t\tvar preparedConfig = this._convertWorkTimeSettings(config);\r\n\t\tif(preparedConfig.customWeeks){\r\n\t\t\tfor(var i in preparedConfig.customWeeks){\r\n\t\t\t\tpreparedConfig.customWeeks[i] = this._convertWorkTimeSettings(preparedConfig.customWeeks[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tapiCore._setConfig(preparedConfig);\r\n\r\n\t\treturn apiCore;\r\n\t},\r\n\r\n\tcreateCalendar: function (parentCalendar) {\r\n\t\tvar settings;\r\n\r\n\t\tif (!parentCalendar) {\r\n\t\t\tparentCalendar = {};\r\n\t\t}\r\n\r\n\t\tif (parentCalendar.getConfig){\r\n\t\t\tsettings = utils.copy(parentCalendar.getConfig());\r\n\t\t} else if (parentCalendar.worktime) {\r\n\t\t\tsettings = utils.copy(parentCalendar.worktime);\r\n\t\t} else {\r\n\t\t\tsettings = utils.copy(parentCalendar);\r\n\t\t}\r\n\r\n\t\tvar defaults = utils.copy(this.defaults.fulltime.worktime);\r\n\t\tutils.mixin(settings, defaults);\r\n\r\n\t\treturn this._createCalendarFromConfig(settings);\r\n\t},\r\n\r\n\tgetCalendar: function (id) {\r\n\t\tid = id || \"global\";\r\n\t\tvar calendar = this._calendars[id];\r\n\t\tif(!calendar){\r\n\t\t\tthis.createDefaultCalendars();\r\n\t\t\tcalendar = this._calendars[id];\r\n\t\t}\r\n\r\n\t\treturn calendar;\r\n\t},\r\n\r\n\tgetCalendars: function () {\r\n\t\tvar res = [];\r\n\t\tfor (var i in this._calendars) {\r\n\t\t\tres.push(this.getCalendar(i));\r\n\t\t}\r\n\t\treturn res;\r\n\t},\r\n\r\n\t_getOwnCalendar: function(task){\r\n\t\tvar config = this.$gantt.config;\r\n\t\tif (task[config.calendar_property]) {\r\n\t\t\treturn this.getCalendar(task[config.calendar_property]);\r\n\t\t}\r\n\r\n\t\tif (config.resource_calendars) {\r\n\t\t\tvar calendar;\r\n\t\t\tvar calendarId;\r\n\t\t\tvar resourceProperty;\r\n\t\t\tif(this._legacyConfig === false){\r\n\t\t\t\tresourceProperty = config.resource_property;\r\n\t\t\t}else{\r\n\t\t\t\tresourceProperty = legacyResourceCalendarConfig.getResourceProperty(config);\r\n\t\t\t}\r\n\t\t\t// GS-2821. If no resource is assigned to a task,\r\n\t\t\t// there is no need to check the resource calendar\r\n\t\t\tif(Array.isArray(task[resourceProperty]) && task[resourceProperty].length){\r\n\t\t\t\t// if multiple resources are attached to the task - merge their calendars\r\n\t\t\t\tif(config.dynamic_resource_calendars){\r\n\t\t\t\t\tcalendarId = dynamicResourceCalendars.getCalendarIdFromMultipleResources(task[resourceProperty], this);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcalendar = this.getResourceCalendar(task[resourceProperty]);\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tif(this._legacyConfig === undefined){\r\n\t\t\t\t\tthis._legacyConfig = legacyResourceCalendarConfig.isLegacyResourceCalendarFormat(config.resource_calendars);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(this._legacyConfig){\r\n\t\t\t\t\tvar calendarId = legacyResourceCalendarConfig.getCalendarIdFromLegacyConfig(task, config.resource_calendars);\r\n\t\t\t\t}else if(resourceProperty && task[resourceProperty] && config.resource_calendars[task[resourceProperty]]){\r\n\t\t\t\t\tvar calendar = this.getResourceCalendar(task[resourceProperty]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(calendarId){\r\n\t\t\t\tcalendar = this.getCalendar(calendarId);\r\n\t\t\t}\r\n\r\n\t\t\tif(calendar){\r\n\t\t\t\treturn calendar;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\t/**\r\n\t * Returns calendar assigned to the specified resource.\r\n\t * Returns the global calendar if no custom calendar is associated with the resource.\r\n\t * @param {(string|number|Object)} resource - resource object or resource id\r\n\t * @returns {object} Calendar object\r\n\t */\r\n\tgetResourceCalendar: function(resource) {\r\n\t\tif (resource === null || resource === undefined) {\r\n\t\t\treturn this.getCalendar();\r\n\t\t}\r\n\r\n\t\tvar resourceId = null;\r\n\t\t// if task id is provided\r\n\t\tif((typeof resource === \"number\" || typeof resource === \"string\")){\r\n\t\t\tresourceId = resource;\r\n\t\t}else{\r\n\t\t\tresourceId = resource.id || resource.key;\r\n\t\t}\r\n\r\n\t\tvar config = this.$gantt.config;\r\n\t\tvar calendarsConfig = config.resource_calendars;\r\n\t\tvar calendarId = null;\r\n\r\n\t\t// GS-1714: if resource is specified through array\r\n\t\tif (Array.isArray(resource)){\r\n\t\t\tif (resource.length === 1){\r\n\t\t\t\tif (typeof resource[0] === 'object'){\r\n\t\t\t\t\tresourceId = resource[0].resource_id; // if resource: [\"resource_id: \"6\", value: \"4\", ...\"]\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresourceId = resource[0]; // if resource: [1]\r\n\t\t\t\t}\r\n\t\t\t} \r\n\t\t}\r\n\t\t\r\n\t\tif (calendarsConfig) {\r\n\t\t\tif(this._legacyConfig === undefined){\r\n\t\t\t\tthis._legacyConfig = legacyResourceCalendarConfig.isLegacyResourceCalendarFormat(config.resource_calendars);\r\n\t\t\t}\r\n\r\n\t\t\tif(this._legacyConfig){\r\n\t\t\t\tfor(var field in calendarsConfig){\r\n\t\t\t\t\tif(calendarsConfig[field][resourceId]){\r\n\t\t\t\t\t\tcalendarId = calendarsConfig[field][resourceId];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tvar calendarId = calendarsConfig[resourceId];\r\n\t\t\t}\r\n\r\n\t\t\tif(calendarId){\r\n\t\t\t\treturn this.getCalendar(calendarId);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\treturn this.getCalendar();\r\n\t},\r\n\r\n\t/**\r\n\t * Returns the calendar assigned to a task.\r\n\t * - Returns a calendar assigned via task[gantt.config.calendar_property] if specified.\r\n\t * - Returns a calendar assigned to the task resource if specified.\r\n\t * - Returns the global calendar otherwise.\r\n\t * @param {(string|number|Object)} task - task object or task id\r\n\t * @returns {object} Calendar object\r\n\t */\r\n\tgetTaskCalendar: function (task) {\r\n\t\tvar gantt = this.$gantt;\r\n\t\tvar taskObject;\r\n\t\tif (task === null || task === undefined) {\r\n\t\t\treturn this.getCalendar();\r\n\t\t}\r\n\r\n\t\t// if task id is provided\r\n\t\tif((typeof task === \"number\" || typeof task === \"string\") && gantt.isTaskExists(task)){\r\n\t\t\ttaskObject = gantt.getTask(task);\r\n\t\t}else{\r\n\t\t\ttaskObject = task;\r\n\t\t}\r\n\r\n\t\tif(!taskObject){\r\n\t\t\treturn this.getCalendar();\r\n\t\t}\r\n\r\n\t\tvar calendar = this._getOwnCalendar(taskObject);\r\n\t\tvar groupMode = !!gantt.getState().group_mode;\r\n\r\n\t\tif (!calendar && gantt.config.inherit_calendar && gantt.isTaskExists(taskObject.parent)){\r\n\t\t\t// GS-1579  group mode overrides tree hierarchy, iterate using `.parent` property, instead of using eachParent iterator\r\n\t\t\tvar currentTask = taskObject;\r\n\t\t\twhile(gantt.isTaskExists(currentTask.parent)){\r\n\t\t\t\tcurrentTask = gantt.getTask(currentTask.parent);\r\n\t\t\t\tif(gantt.isSummaryTask(currentTask)){\r\n\t\t\t\t\tcalendar = this._getOwnCalendar(currentTask);\r\n\t\t\t\t\tif(calendar){\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(groupMode && !calendar){\r\n\t\t\t\t// if group mode and inherit_calendars is enabled - preserve previously applied parent calendar\r\n\t\t\t\t// we may need it when groupBy parses grouped data, old parent may be not loaded yet\r\n\t\t\t\tif(task.$effective_calendar){\r\n\t\t\t\t\tcalendar = this.getCalendar(task.$effective_calendar);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn calendar || this.getCalendar();\r\n\t},\r\n\r\n\taddCalendar: function(calendar) { // puts new calendar to Global Storage - gantt.calendarManager._calendars {}\r\n\t\tif (!(this.isCalendar(calendar))) {\r\n\t\t\tvar id = calendar.id;\r\n\t\t\tcalendar = this.createCalendar(calendar);\r\n\t\t\tcalendar.id = id;\r\n\t\t}\r\n\r\n\t\t// validate/check if empty calendar\r\n\t\tif (!calendar._tryChangeCalendarSettings(function () {\r\n\t\t\t})) {\r\n\r\n\t\t\tthis.$gantt.callEvent(\"onCalendarError\", [{message: \"Invalid calendar settings, no worktime available\"}, calendar]);\r\n\t\t\treturn null;\r\n\t\t} else {\r\n\t\t\tvar config = this.$gantt.config;\r\n\r\n\t\t\tcalendar.id = calendar.id || utils.uid();\r\n\t\t\tthis._calendars[calendar.id] = calendar;\r\n\t\t\tif (!config.worktimes)\r\n\t\t\t\tconfig.worktimes = {};\r\n\t\t\tconfig.worktimes[calendar.id] = calendar.getConfig();\r\n\t\t\treturn calendar.id;\r\n\t\t}\r\n\t},\r\n\r\n\tdeleteCalendar: function (calendar) {\r\n\t\tvar config = this.$gantt.config;\r\n\t\tif (!calendar) return false;\r\n\t\tif (this._calendars[calendar]) {\r\n\t\t\tdelete this._calendars[calendar];\r\n\t\t\tif (config.worktimes && config.worktimes[calendar])\r\n\t\t\t\tdelete config.worktimes[calendar];\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t},\r\n\r\n\trestoreConfigCalendars: function (configs) {\r\n\t\tfor (var i in configs) {\r\n\t\t\tif (this._calendars[i])\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tvar settings = configs[i];\r\n\t\t\tvar calendar = this.createCalendar(settings);\r\n\t\t\tcalendar.id = i;\r\n\t\t\tthis.addCalendar(calendar);\r\n\t\t}\r\n\t},\r\n\r\n\tdefaults: {\r\n\t\tglobal: {\r\n\t\t\tid: \"global\",\r\n\t\t\tworktime: {\r\n\t\t\t\thours: [8, 12, 13, 17],\r\n\t\t\t\tdays: [0, 1, 1, 1, 1, 1, 0]\r\n\t\t\t}\r\n\t\t},\r\n\t\tfulltime: {\r\n\t\t\tid: \"fulltime\",\r\n\t\t\tworktime: {\r\n\t\t\t\thours: [0, 24],\r\n\t\t\t\tdays: [1, 1, 1, 1, 1, 1, 1]\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tcreateDefaultCalendars: function () {\r\n\t\tvar config = this.$gantt.config;\r\n\t\tthis.restoreConfigCalendars(this.defaults);\r\n\t\tthis.restoreConfigCalendars(config.worktimes);\r\n\t},\r\n\r\n\tisCalendar: function(possibleCalendar) {\r\n\t\t// because we don't have any way to check without dependency to CalendarWorkTimeStrategy\r\n\t\tvar props = [\r\n\t\t\tpossibleCalendar.isWorkTime,\r\n\t\t\tpossibleCalendar.setWorkTime,\r\n\t\t\tpossibleCalendar.getWorkHours,\r\n\t\t\tpossibleCalendar.unsetWorkTime,\r\n\t\t\tpossibleCalendar.getClosestWorkTime,\r\n\t\t\tpossibleCalendar.calculateDuration,\r\n\t\t\tpossibleCalendar.hasDuration,\r\n\t\t\tpossibleCalendar.calculateEndDate\r\n\t\t];\r\n\t\treturn props.every(function(entry) {\r\n\t\t\treturn entry instanceof Function;\r\n\t\t});\r\n\t}\r\n};\r\n\r\nexport default CalendarManager;","export default function() {\r\n\tfunction getResourcesCalendarKey(resourceAssignments){\r\n\t\treturn resourceAssignments.map(function(res){\r\n\t\t\tif(res && res.resource_id){\r\n\t\t\t\treturn res.resource_id;\r\n\t\t\t} else {\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t}).sort().join(\"-\");\r\n\t}\r\n\r\n\tvar dynamicCalendars = {};\r\n\r\n\tfunction mergeResourceCalendars(resourceAssignments, manager){\r\n\t\treturn manager.mergeCalendars(resourceAssignments.map(function(assignment){\r\n\t\t\tvar resourceId = (assignment && assignment.resource_id) ? assignment.resource_id : assignment;\r\n\t\t\treturn manager.getResourceCalendar(resourceId);\r\n\t\t}));\r\n\t}\r\n\tfunction getCalendarIdFromMultipleResources(resourceAssignments, manager){\r\n\t\tvar key = getResourcesCalendarKey(resourceAssignments);\r\n\t\tif(!resourceAssignments.length){\r\n\t\t\treturn null;\r\n\t\t}else if(resourceAssignments.length === 1){\r\n\t\t\treturn manager.getResourceCalendar(key).id;\r\n\t\t}else if (dynamicCalendars[key]){\r\n\t\t\treturn dynamicCalendars[key].id;\r\n\t\t} else {\r\n\t\t\tvar tempCalendar = mergeResourceCalendars(resourceAssignments, manager);\r\n\r\n\t\t\tdynamicCalendars[key] = tempCalendar;\r\n\t\t\treturn manager.addCalendar(tempCalendar);\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\tgetCalendarIdFromMultipleResources: getCalendarIdFromMultipleResources\r\n\t};\r\n};","function CalendarDisabledTimeStrategy(gantt, argumentsHelper){\r\n\tthis.argumentsHelper = argumentsHelper;\r\n\tthis.$gantt = gantt;\r\n}\r\n\r\nCalendarDisabledTimeStrategy.prototype = {\r\n\tgetWorkHours: function () {\r\n\t\treturn [0, 24];\r\n\t},\r\n\tsetWorkTime: function () {\r\n\t\treturn true;\r\n\t},\r\n\tunsetWorkTime: function () {\r\n\t\treturn true;\r\n\t},\r\n\tisWorkTime: function () {\r\n\t\treturn true;\r\n\t},\r\n\tgetClosestWorkTime: function (config) {\r\n\t\tvar config = this.argumentsHelper.getClosestWorkTimeArguments.apply(this.argumentsHelper, arguments);\r\n\t\treturn config.date;\r\n\t},\r\n\r\n\tcalculateDuration: function () {\r\n\t\tvar config = this.argumentsHelper.getDurationArguments.apply(this.argumentsHelper, arguments);\r\n\t\tvar from = config.start_date,\r\n\t\t\tto = config.end_date,\r\n\t\t\tunit = config.unit,\r\n\t\t\tstep = config.step;\r\n\r\n\t\treturn this._calculateDuration(from, to, unit, step);\r\n\t},\r\n\t_calculateDuration: function (start, end, unit, step) {\r\n\t\tvar dateHelper = this.$gantt.date;\r\n\t\tvar fixedUnits = {\r\n\t\t\t\"week\": 1000 * 60 * 60 * 24 * 7,\r\n\t\t\t\"day\": 1000 * 60 * 60 * 24,\r\n\t\t\t\"hour\": 1000 * 60 * 60,\r\n\t\t\t\"minute\": 1000 * 60\r\n\t\t};\r\n\r\n\t\tvar res = 0;\r\n\t\tif (fixedUnits[unit]) {\r\n\t\t\tres = Math.round((end - start) / (step * fixedUnits[unit]));\r\n\t\t} else {\r\n\t\t\tvar from = new Date(start),\r\n\t\t\t\tto = new Date(end);\r\n\t\t\twhile (from.valueOf() < to.valueOf()) {\r\n\t\t\t\tres += 1;\r\n\t\t\t\tfrom = dateHelper.add(from, step, unit);\r\n\t\t\t}\r\n\r\n\t\t\tif (from.valueOf() != end.valueOf()) {\r\n\t\t\t\tres += (to - from) / (dateHelper.add(from, step, unit) - from);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn Math.round(res);\r\n\t},\r\n\r\n\thasDuration: function () {\r\n\t\tvar config = this.argumentsHelper.getDurationArguments.apply(this.argumentsHelper, arguments);\r\n\t\tvar from = config.start_date,\r\n\t\t\tto = config.end_date,\r\n\t\t\tunit = config.unit;\r\n\r\n\t\tif (!unit) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tfrom = new Date(from);\r\n\t\tto = new Date(to);\r\n\r\n\t\treturn (from.valueOf() < to.valueOf());\r\n\t},\r\n\r\n\thasWorkTime: function() {\r\n\t\treturn true;\r\n\t},\r\n\r\n\tequals: function(calendar) {\r\n\t\tif(!(calendar instanceof CalendarDisabledTimeStrategy)){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\tcalculateEndDate: function () {\r\n\t\tvar config = this.argumentsHelper.calculateEndDateArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tvar start = config.start_date,\r\n\t\t\tduration = config.duration,\r\n\t\t\tunit = config.unit,\r\n\t\t\tstep = config.step;\r\n\r\n\t\treturn this.$gantt.date.add(start, step * duration, unit);\r\n\t}\r\n};\r\n\r\nexport default CalendarDisabledTimeStrategy;","import createArgumentsHelper from \"./calendar_arguments_helper\";\r\nimport NoWorkTimeCalendar from \"./strategy/no_work_time\";\r\n\r\nfunction TimeCalculator(calendarManager){\r\n\r\n\tthis.$gantt = calendarManager.$gantt;\r\n\tthis.argumentsHelper = createArgumentsHelper(this.$gantt);\r\n\tthis.calendarManager = calendarManager;\r\n\tthis.$disabledCalendar = new NoWorkTimeCalendar(this.$gantt, this.argumentsHelper);\r\n}\r\n\r\nTimeCalculator.prototype = {\r\n\t_getCalendar: function (config) {\r\n\t\tvar calendar;\r\n\t\tif (!this.$gantt.config.work_time) {\r\n\t\t\tcalendar = this.$disabledCalendar;\r\n\t\t} else {\r\n\t\t\tvar manager = this.calendarManager;\r\n\t\t\tif (config.task) {\r\n\t\t\t\tcalendar = manager.getTaskCalendar(config.task);\r\n\t\t\t} else if (config.id) {\r\n\t\t\t\tcalendar = manager.getTaskCalendar(config);\r\n\t\t\t} else if (config.calendar) {\r\n\t\t\t\tcalendar = config.calendar;\r\n\t\t\t}\r\n\t\t\tif (!calendar) {\r\n\t\t\t\tcalendar = manager.getTaskCalendar();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn calendar;\r\n\t},\r\n\r\n\tgetWorkHours: function (config) {\r\n\t\tconfig = this.argumentsHelper.getWorkHoursArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tvar calendar = this._getCalendar(config);\r\n\r\n\t\treturn calendar.getWorkHours(config.date);\r\n\t},\r\n\r\n\tsetWorkTime: function (config, calendar) {\r\n\t\tconfig = this.argumentsHelper.setWorkTimeArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tif (!calendar)\r\n\t\t\tcalendar = this.calendarManager.getCalendar(); // Global\r\n\t\treturn calendar.setWorkTime(config);\r\n\t},\r\n\r\n\tunsetWorkTime: function (config, calendar) {\r\n\t\tconfig = this.argumentsHelper.unsetWorkTimeArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tif (!calendar)\r\n\t\t\tcalendar = this.calendarManager.getCalendar(); // Global\r\n\t\treturn calendar.unsetWorkTime(config);\r\n\t},\r\n\tisWorkTime: function (date, unit, task, calendar) {\r\n\t\tvar config = this.argumentsHelper.isWorkTimeArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tcalendar = this._getCalendar(config);\r\n\t\treturn calendar.isWorkTime(config);\r\n\t},\r\n\tgetClosestWorkTime: function (config) {\r\n\t\tconfig = this.argumentsHelper.getClosestWorkTimeArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tvar calendar = this._getCalendar(config);\r\n\r\n\t\treturn calendar.getClosestWorkTime(config);\r\n\t},\r\n\r\n\tcalculateDuration: function () { // start_date_date, end_date, task\r\n\t\tvar config = this.argumentsHelper.getDurationArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\r\n\t\tvar calendar = this._getCalendar(config);\r\n\t\treturn calendar.calculateDuration(config);\r\n\t},\r\n\thasDuration: function () {\r\n\t\tvar config = this.argumentsHelper.hasDurationArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tvar calendar = this._getCalendar(config);\r\n\r\n\t\treturn calendar.hasDuration(config);\r\n\t},\r\n\tcalculateEndDate: function (config) { // start_date, duration, unit, task\r\n\t\tvar config = this.argumentsHelper.calculateEndDateArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tvar calendar = this._getCalendar(config);\r\n\t\treturn calendar.calculateEndDate(config);\r\n\t}\r\n};\r\n\r\nexport default TimeCalculator;\r\n\r\n","// TODO: rework public api for date methods\r\nimport * as utils from \"../../utils/utils\";\r\n\r\nvar createWorkTimeFacade = function(calendarManager, timeCalculator){\r\n\treturn {\r\n\t\tgetWorkHours: function (date) {\r\n\t\t\treturn timeCalculator.getWorkHours(date);\r\n\t\t},\r\n\r\n\t\tsetWorkTime: function (config) {\r\n\t\t\treturn timeCalculator.setWorkTime(config);\r\n\t\t},\r\n\r\n\t\tunsetWorkTime: function (config) {\r\n\t\t\ttimeCalculator.unsetWorkTime(config);\r\n\t\t},\r\n\r\n\t\tisWorkTime: function (date, unit, task) {\r\n\t\t\treturn timeCalculator.isWorkTime(date, unit, task);\r\n\t\t},\r\n\r\n\t\tgetClosestWorkTime: function (config) {\r\n\t\t\treturn timeCalculator.getClosestWorkTime(config);\r\n\t\t},\r\n\r\n\t\tcalculateDuration: function (start_date, end_date, task) {\r\n\t\t\treturn timeCalculator.calculateDuration(start_date, end_date, task);\r\n\t\t},\r\n\t\t_hasDuration: function (start_date, end_date, task) {\r\n\t\t\treturn timeCalculator.hasDuration(start_date, end_date, task);\r\n\t\t},\r\n\r\n\t\tcalculateEndDate: function (start, duration, unit, task) {\r\n\t\t\treturn timeCalculator.calculateEndDate(start, duration, unit, task);\r\n\t\t},\r\n\r\n\t\tmergeCalendars: utils.bind(calendarManager.mergeCalendars, calendarManager),\r\n\t\tcreateCalendar: utils.bind(calendarManager.createCalendar, calendarManager),\r\n\t\taddCalendar: utils.bind(calendarManager.addCalendar, calendarManager),\r\n\t\tgetCalendar: utils.bind(calendarManager.getCalendar, calendarManager),\r\n\t\tgetCalendars: utils.bind(calendarManager.getCalendars, calendarManager),\r\n\t\tgetResourceCalendar: utils.bind(calendarManager.getResourceCalendar, calendarManager),\r\n\t\tgetTaskCalendar: utils.bind(calendarManager.getTaskCalendar, calendarManager),\r\n\t\tdeleteCalendar: utils.bind(calendarManager.deleteCalendar, calendarManager)\r\n\t};\r\n};\r\n\r\n\r\nexport default { create: createWorkTimeFacade };","import * as helpers from \"../utils/helpers\";\r\n\r\nexport default function(gantt) {\r\n\r\n\tgantt.isUnscheduledTask = function (task) {\r\n\t\tgantt.assert(task && task instanceof Object, \"Invalid argument <b>task</b>=\"+task+\" of gantt.isUnscheduledTask. Task object was expected\");\r\n\t\treturn (!!task.unscheduled || !task.start_date);\r\n\t};\r\n\r\n\tgantt._isAllowedUnscheduledTask = function (task) {\r\n\t\treturn !!(task.unscheduled && gantt.config.show_unscheduled);\r\n\t};\r\n\r\n\tgantt._isTaskInTimelineLimits = function(task) {\r\n\t\tvar taskStart = task.start_date ? task.start_date.valueOf() : null;\r\n\t\tvar taskEnd = task.end_date ? task.end_date.valueOf() : null;\r\n\t\treturn !!(taskStart && taskEnd && taskStart <= this._max_date.valueOf() && taskEnd >= this._min_date.valueOf());\r\n\t};\r\n\tgantt.isTaskVisible = function (id) {\r\n\t\tif (!this.isTaskExists(id)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar task = this.getTask(id);\r\n\t\tif (!(this._isAllowedUnscheduledTask(task) || this._isTaskInTimelineLimits(task))) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn !!(this.getGlobalTaskIndex(id) >= 0);\r\n\t};\r\n\r\n\tgantt._getProjectEnd = function() {\r\n\t\tif(gantt.config.project_end){\r\n\t\t\treturn gantt.config.project_end;\r\n\t\t}else{\r\n\t\t\tvar tasks = gantt.getTaskByTime();\r\n\t\t\ttasks = tasks.sort(function (a, b) {\r\n\t\t\t\treturn +a.end_date > +b.end_date ? 1 : -1;\r\n\t\t\t});\r\n\t\t\treturn tasks.length ? tasks[tasks.length - 1].end_date : null;\r\n\t\t}\r\n\t};\r\n\tgantt._getProjectStart = function() {\r\n\t\tif (gantt.config.project_start) {\r\n\t\t\treturn gantt.config.project_start;\r\n\t\t}\r\n\r\n\t\t// use timeline start if project start is not specified\r\n\t\tif (gantt.config.start_date) {\r\n\t\t\treturn gantt.config.start_date;\r\n\t\t}\r\n\t\tif (gantt.getState().min_date) {\r\n\t\t\treturn gantt.getState().min_date;\r\n\t\t}\r\n\r\n\t\t// earliest task start if neither project start nor timeline are specified\r\n\t\tvar tasks = gantt.getTaskByTime();\r\n\t\ttasks = tasks.sort(function (a, b) {\r\n\t\t\treturn +a.start_date > +b.start_date ? 1 : -1;\r\n\t\t});\r\n\t\treturn tasks.length ? tasks[0].start_date : null;\r\n\t};\r\n\r\n\tvar getDefaultTaskDate = function (item, parent_id) {\r\n\t\tvar parentExists = parent_id && parent_id != gantt.config.root_id && gantt.isTaskExists(parent_id);\r\n\t\tvar parent = parentExists ? gantt.getTask(parent_id) : false,\r\n\t\t\tstartDate = null;\r\n\t\tif (parent) {\r\n\t\t\tif(gantt._getAutoSchedulingConfig().schedule_from_end){\r\n\t\t\t\tstartDate = gantt.calculateEndDate({\r\n\t\t\t\t\tstart_date: parent.end_date,\r\n\t\t\t\t\tduration: - gantt.config.duration_step,\r\n\t\t\t\t\ttask:item\r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\tif(!parent.start_date){\r\n\t\t\t\t\treturn getDefaultTaskDate(parent, gantt.getParent(parent));\r\n\t\t\t\t}\r\n\t\t\t\tstartDate = parent.start_date;\r\n\t\t\t}\r\n\r\n\t\t} else if(gantt._getAutoSchedulingConfig().schedule_from_end) {\r\n\t\t\tstartDate = gantt.calculateEndDate({\r\n\t\t\t\tstart_date: gantt._getProjectEnd(),\r\n\t\t\t\tduration: - gantt.config.duration_step,\r\n\t\t\t\ttask:item\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tconst first = gantt.getTaskByIndex(0);\r\n\t\t\tconst minDate = gantt.config.start_date || gantt.getState().min_date;\r\n\r\n\t\t\tif (first){\r\n\t\t\t\tif (first.start_date){\r\n\t\t\t\t\tstartDate = first.start_date;\r\n\t\t\t\t}\r\n\t\t\t\telse if (first.end_date){\r\n\t\t\t\t\tstartDate = gantt.calculateEndDate({\r\n\t\t\t\t\t\tstart_date: first.end_date,\r\n\t\t\t\t\t\tduration: -gantt.config.duration_step,\r\n\t\t\t\t\t\ttask:item\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tstartDate = minDate;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tstartDate = minDate;\r\n\t\t\t}\r\n\t\t}\r\n\t\tgantt.assert(startDate, \"Invalid dates\");\r\n\t\treturn new Date(startDate);\r\n\t};\r\n\r\n\tgantt._set_default_task_timing = function (task) {\r\n\t\ttask.start_date = task.start_date || getDefaultTaskDate(task, gantt.getParent(task));\r\n\t\ttask.duration = task.duration || gantt.config.duration_step;\r\n\t\ttask.end_date = task.end_date || gantt.calculateEndDate(task);\r\n\t};\r\n\r\n\tgantt.createTask = function (item, parent, index) {\r\n\t\titem = item || {};\r\n\r\n\t\tif (!gantt.defined(item.id))\r\n\t\t\titem.id = gantt.uid();\r\n\r\n\t\tif (!item.start_date) {\r\n\t\t\titem.start_date = getDefaultTaskDate(item, parent);\r\n\t\t}\r\n\t\tif (item.text === undefined) {\r\n\t\t\titem.text = gantt.locale.labels.new_task;\r\n\t\t}\r\n\t\tif (item.duration === undefined) {\r\n\t\t\titem.duration = 1;\r\n\t\t}\r\n\r\n\t\tif (this.isTaskExists(parent)) {\r\n\t\t\tthis.setParent(item, parent, true);\r\n\t\t\tvar parentObj = this.getTask(parent);\r\n\t\t\tparentObj.$open = true;\r\n\t\t\t// GS-1583. Save the $open state to the Undo Stack\r\n\t\t\tif (!this.config.details_on_create){\r\n\t\t\t\tthis.callEvent(\"onAfterParentExpand\", [parent, parentObj]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!this.callEvent(\"onTaskCreated\", [item])) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (this.config.details_on_create) {\r\n\t\t\t//GS-761: assert unique ID\r\n\t\t\tif (gantt.isTaskExists(item.id)){\r\n\t\t\t\tvar task = gantt.getTask(item.id);\r\n\t\t\t\tif (task.$index != item.$index) {\r\n\t\t\t\t\t// Someone may try to mistakenly add a task with the same ID, and most likely\r\n\t\t\t\t\t// use the string format for the dates. Gantt shouldn't break in this scenario\r\n\t\t\t\t\tif (item.start_date && typeof item.start_date === \"string\"){\r\n\t\t\t\t\t\titem.start_date = this.date.parseDate(item.start_date, \"parse_date\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (item.end_date && typeof item.end_date === \"string\"){\r\n\t\t\t\t\t\titem.end_date = this.date.parseDate(item.end_date, \"parse_date\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.$data.tasksStore.updateItem(item.id, item);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\titem.$new = true;\r\n\t\t\t\tthis.silent(function(){\r\n\t\t\t\t\tgantt.$data.tasksStore.addItem(item, index);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tthis.selectTask(item.id);\r\n\t\t\tthis.refreshData();\r\n\t\t\tthis.showLightbox(item.id);\r\n\t\t} else {\r\n\t\t\tif (this.addTask(item, parent, index)) {\r\n\t\t\t\tthis.showTask(item.id);\r\n\t\t\t\tthis.selectTask(item.id);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn item.id;\r\n\t};\r\n\r\n\tgantt._update_flags = function (oldid, newid) {\r\n\t\t//  TODO: need a proper way to update all possible flags\r\n\t\tvar store = gantt.$data.tasksStore;\r\n\t\tif (oldid === undefined) {\r\n\t\t\tthis._lightbox_id = null;\r\n\r\n\t\t\tstore.silent(function(){\r\n\t\t\t\tstore.unselect();\r\n\t\t\t});\r\n\t\t\t// GS-1522. If we have multiselect, unselect all previously selected tasks\r\n\t\t\tif (this.getSelectedTasks) {\r\n\t\t\t\tthis._multiselect.reset();\r\n\t\t\t}\r\n\r\n\t\t\tif (this._tasks_dnd && this._tasks_dnd.drag) {\r\n\t\t\t\tthis._tasks_dnd.drag.id = null;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (this._lightbox_id == oldid)\r\n\t\t\t\tthis._lightbox_id = newid;\r\n\r\n\t\t\t// TODO: probably can be removed\r\n\t\t\tif (store.getSelectedId() == oldid) {\r\n\t\t\t\tstore.silent(function(){\r\n\t\t\t\t\tstore.unselect(oldid);\r\n\t\t\t\t\tstore.select(newid);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif (this._tasks_dnd && this._tasks_dnd.drag && this._tasks_dnd.drag.id == oldid) {\r\n\t\t\t\tthis._tasks_dnd.drag.id = newid;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tvar getTaskTimingMode = function (task, force) {\r\n\t\tvar task_type = gantt.getTaskType(task.type);\r\n\r\n\t\tvar state = {\r\n\t\t\ttype: task_type,\r\n\t\t\t$no_start: false,\r\n\t\t\t$no_end: false,\r\n\t\t\tscheduled_summary: false\r\n\t\t};\r\n\r\n\t\tif(task_type === gantt.config.types.project && task.auto_scheduling === false){\r\n\t\t\tstate.scheduled_summary = true;\r\n\t\t}\r\n\r\n\t\tif (!force && task_type == task.$rendered_type) {\r\n\t\t\tstate.$no_start = task.$no_start;\r\n\t\t\tstate.$no_end = task.$no_end;\r\n\t\t\treturn state;\r\n\t\t}\r\n\r\n\t\tif (task_type == gantt.config.types.project) {\r\n\t\t\t//project duration is always defined by children duration\r\n\t\t\tstate.$no_end = state.$no_start = true;\r\n\t\t} else if (task_type != gantt.config.types.milestone) {\r\n\t\t\t//tasks can have fixed duration, children duration(as projects), or one date fixed, and other defined by nested items\r\n\t\t\tstate.$no_end = !(task.end_date || task.duration);\r\n\t\t\tstate.$no_start = !task.start_date;\r\n\r\n\t\t\tif (gantt._isAllowedUnscheduledTask(task)) {\r\n\t\t\t\tstate.$no_end = state.$no_start = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn state;\r\n\t};\r\n\r\n\tgantt._init_task_timing = function (task) {\r\n\t\tvar task_mode = getTaskTimingMode(task, true);\r\n\r\n\t\tvar dirty = task.$rendered_type != task_mode.type;\r\n\r\n\t\tvar task_type = task_mode.type;\r\n\r\n\t\tif (dirty) {\r\n\t\t\ttask.$no_start = task_mode.$no_start;\r\n\t\t\ttask.$no_end = task_mode.$no_end;\r\n\t\t\ttask.$rendered_type = task_mode.type;\r\n\t\t}\r\n\r\n\t\tif (dirty && task_type != this.config.types.milestone) {\r\n\t\t\tif (task_type == this.config.types.project) {\r\n\t\t\t\t//project duration is always defined by children duration\r\n\t\t\t\tthis._set_default_task_timing(task);\r\n\t\t\t\ttask.$calculate_duration = false;// do not recalculate duration below\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (task_type == this.config.types.milestone) {\r\n\t\t\ttask.end_date = task.start_date;\r\n\t\t}\r\n\t\tif (task.start_date && task.end_date && task.$calculate_duration !== false) {\r\n\t\t\ttask.duration = this.calculateDuration(task);\r\n\t\t}\r\n\r\n\t\tif(!task.$calculate_duration){\r\n\t\t\ttask.$calculate_duration = true;\r\n\t\t}\r\n\r\n\t\tif (!task.end_date) {\r\n\t\t\ttask.end_date = task.start_date;\r\n\t\t}\r\n\r\n\t\ttask.duration = task.duration || 0;\r\n\t\t// GS-1145. We should let tasks to have 0 duration if user wants it\r\n\t\tif (this.config.min_duration === 0 && task.duration === 0){\r\n\t\t\ttask.$no_end = false;\r\n\t\t\t//GS-2813: special case for project that has 0 duration with milestone child\r\n\t\t\tif(task.type === gantt.config.types.project && gantt.hasChild(task.id)){\r\n\t\t\t\ttask.$no_end = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// work calendar of task has changed\r\n\t\tvar effectiveCalendar = this.getTaskCalendar(task);\r\n\t\tif(task.$effective_calendar && task.$effective_calendar !== effectiveCalendar.id){\r\n\t\t\tupdateTaskTiming(task);\r\n\t\t\tif(this.config.inherit_calendar && this.isSummaryTask(task)){\r\n\t\t\t\tthis.eachTask(function(child){\r\n\t\t\t\t\tupdateTaskTiming(child);\r\n\t\t\t\t}, task.id);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttask.$effective_calendar = effectiveCalendar.id;\r\n\t};\r\n\r\n\tfunction updateTaskTiming(task) {\r\n\t\ttask.$effective_calendar = gantt.getTaskCalendar(task).id;\r\n\t\ttask.start_date = gantt.getClosestWorkTime({\r\n\t\t\tdir: \"future\",\r\n\t\t\tdate: task.start_date,\r\n\t\t\tunit: gantt.config.duration_unit,\r\n\t\t\ttask: task\r\n\t\t});\r\n\t\ttask.end_date = gantt.calculateEndDate(task);\r\n\t}\r\n\r\n\tgantt.isSummaryTask = function (task) {\r\n\t\tgantt.assert(task && task instanceof Object, \"Invalid argument <b>task</b>=\"+task+\" of gantt.isSummaryTask. Task object was expected\");\r\n\r\n\t\tvar mode = getTaskTimingMode(task);\r\n\r\n\t\treturn !!(mode.$no_end || mode.$no_start);\r\n\t};\r\n\r\n// downward calculation of project duration\r\n\tgantt.resetProjectDates = function (task) {\r\n\t\tvar taskMode = getTaskTimingMode(task);\r\n\t\tif (taskMode.$no_end || taskMode.$no_start) {\r\n\t\t\tvar info = getSubtaskInfo(task.id);\r\n\t\t\tassignProjectDates.call(this, task, taskMode, info.start_date, info.end_date);\r\n\t\t\ttask.$rollup = info.rollup;\r\n\t\t\ttask.$inlineSplit = info.splitItems;\r\n\t\t}\r\n\t};\r\n\r\n\tfunction assignProjectDates(task, taskTiming, from, to) {\r\n\r\n\t\tconst summaryDateFields = {\r\n\t\t\tstart: \"start_date\",\r\n\t\t\tend: \"end_date\"\r\n\t\t};\r\n\t\tconst manuallyScheduledSummaryDateFields = {\r\n\t\t\tstart: \"$auto_start_date\",\r\n\t\t\tend: \"$auto_end_date\"\r\n\t\t};\r\n\r\n\t\tlet dateFields;\r\n\t\tif(task.type === gantt.config.types.project && task.auto_scheduling === false){\r\n\t\t\tdateFields = manuallyScheduledSummaryDateFields;\r\n\t\t}else{\r\n\t\t\tdateFields = summaryDateFields;\r\n\t\t}\r\n\r\n\t\tif (taskTiming.$no_start) {\r\n\t\t\tif (from) {\r\n\t\t\t\ttask[dateFields.start] = new Date(from);\r\n\t\t\t} else {\r\n\t\t\t\ttask[dateFields.start] = getDefaultTaskDate(task, this.getParent(task));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (taskTiming.$no_end) {\r\n\t\t\tif (to) {\r\n\t\t\t\ttask[dateFields.end] = new Date(to);\r\n\t\t\t} else {\r\n\t\t\t\ttask[dateFields.end] = this.calculateEndDate({\r\n\t\t\t\t\tstart_date: task[dateFields.start],\r\n\t\t\t\t\tduration: this.config.duration_step,\r\n\t\t\t\t\ttask: task\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (taskTiming.$no_start || taskTiming.$no_end) {\r\n\t\t\tthis._init_task_timing(task);\r\n\t\t}\r\n\t}\r\n\r\n\tgantt.getSubtaskDuration = function (taskId) {\r\n\t\tvar res = 0,\r\n\t\t\troot = taskId !== undefined ? taskId : gantt.config.root_id;\r\n\r\n\t\tthis.eachTask(function (child) {\r\n\t\t\tif (this.getTaskType(child.type) == gantt.config.types.project || this.isUnscheduledTask(child))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tres += child.duration;\r\n\t\t}, root);\r\n\r\n\t\treturn res;\r\n\t};\r\n\r\n\tfunction getSubtaskInfo (taskId){\r\n\t\tlet min = null;\r\n\t\tlet max = null;\r\n\t\tlet root = taskId !== undefined ? taskId : gantt.config.root_id;\r\n\t\tconst rollup = [];\r\n\t\tconst inlineSplit = [];\r\n\r\n\t\tlet rootTask = null;\r\n\t\tif(gantt.isTaskExists(root)){\r\n\t\t\trootTask = gantt.getTask(root);\r\n\t\t}\r\n\r\n\t\tgantt.eachTask(function (child) {\r\n\t\t\tconst isScheduledSummary = (gantt.getTaskType(child.type) == gantt.config.types.project && (child.auto_scheduling === false));\r\n\t\t\tif ((gantt.getTaskType(child.type) == gantt.config.types.project && !isScheduledSummary) || gantt.isUnscheduledTask(child))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif(child.rollup){\r\n\t\t\t\trollup.push(child.id);\r\n\t\t\t}\r\n\r\n\t\t\tif ((child.start_date && (!child.$no_start || isScheduledSummary)) && (!min || min > child.start_date.valueOf()))\r\n\t\t\t\tmin = child.start_date.valueOf();\r\n\t\t\tif ((child.end_date && (!child.$no_end || isScheduledSummary)) && (!max || max < child.end_date.valueOf()))\r\n\t\t\t\tmax = child.end_date.valueOf();\r\n\r\n\r\n\t\t\tif(rootTask && rootTask.render == \"split\"){\r\n\t\t\t\tif(child.split_placement === \"inline\"){\r\n\t\t\t\t\tinlineSplit.push(child);\r\n\t\t\t\t}else if(child.split_placement !== \"subrow\" && (!rootTask.$open || !gantt.config.open_split_tasks)){\r\n\t\t\t\t\tinlineSplit.push(child);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, root);\r\n\r\n\t\treturn {\r\n\t\t\tstart_date: min ? new Date(min) : null,\r\n\t\t\tend_date: max ? new Date(max) : null,\r\n\t\t\trollup: rollup,\r\n\t\t\tsplitItems: inlineSplit\r\n\t\t};\r\n\t}\r\n\r\n\tgantt.getSubtaskDates = function (task_id) {\r\n\t\tvar info = getSubtaskInfo(task_id);\r\n\t\treturn {\r\n\t\t\tstart_date: info.start_date,\r\n\t\t\tend_date: info.end_date\r\n\t\t};\r\n\t};\r\n\r\n\r\n// upward calculation of project duration\r\n\tgantt._update_parents = function (taskId, silent, updateAll) {\r\n\t\tif (!taskId) return;\r\n\r\n\t\tvar task = this.getTask(taskId);\r\n\t\tif(task.rollup){\r\n\t\t\tupdateAll = true;\r\n\t\t}\r\n\t\tvar pid = this.getParent(task);\r\n\r\n\t\tvar taskTiming = getTaskTimingMode(task);\r\n\r\n\t\tvar has_changed = true;\r\n\t\t// GS-761 the dates check is necessary for adding empty tasks: gantt.addTask({id:\"2\"})\r\n\t\tif (updateAll || (task.start_date && task.end_date && (taskTiming.$no_start || taskTiming.$no_end))) {\r\n\r\n\t\t\tconst startDateField = task.$auto_start_date ? \"$auto_start_date\" : \"start_date\";\r\n\t\t\tconst endDateField = task.$auto_end_date ? \"$auto_end_date\" : \"end_date\";\r\n\r\n\t\t\tvar oldStart = task[startDateField].valueOf(),\r\n\t\t\t\toldEnd = task[endDateField].valueOf();\r\n\r\n\t\t\tgantt.resetProjectDates(task);\r\n\r\n\t\t\t// not refresh parent projects if dates hasn't changed\r\n\t\t\tif (!updateAll && oldStart == task[startDateField].valueOf() && oldEnd == task[endDateField].valueOf()) {\r\n\t\t\t\thas_changed = false;\r\n\t\t\t}\r\n\r\n\t\t\tif (has_changed && !silent) {\r\n\t\t\t\tthis.refreshTask(task.id, true);\r\n\t\t\t}\r\n\r\n\t\t\tif(taskTiming.scheduled_summary){\r\n\t\t\t\thas_changed = true;//recalculate upwards from scheduled summaries\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tif (has_changed && pid && this.isTaskExists(pid)) {\r\n\t\t\tthis._update_parents(pid, silent, updateAll);\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.roundDate = function (config) {\r\n\t\tvar scale = gantt.getScale();\r\n\r\n\t\tif (helpers.isDate(config)) {\r\n\t\t\tconfig = {\r\n\t\t\t\tdate: config,\r\n\t\t\t\tunit: scale ? scale.unit : gantt.config.duration_unit,\r\n\t\t\t\tstep: scale ?  scale.step : gantt.config.duration_step\r\n\t\t\t};\r\n\t\t}\r\n\t\tvar date = config.date,\r\n\t\t\tsteps = config.step,\r\n\t\t\tunit = config.unit;\r\n\r\n\t\tif(!scale){\r\n\t\t\treturn date;\r\n\t\t}\r\n\r\n\t\tvar upper, lower, colIndex;\r\n\t\tif (unit == scale.unit && steps == scale.step &&\r\n\t\t\t+date >= +scale.min_date && +date <= +scale.max_date) {\r\n\t\t\t//find date in time scale config\r\n\t\t\tcolIndex = Math.floor(gantt.columnIndexByDate(date));\r\n\r\n\t\t\tif (!scale.trace_x[colIndex]) {\r\n\t\t\t\tcolIndex -= 1;// end of time scale\r\n\t\t\t\tif(scale.rtl){\r\n\t\t\t\t\tcolIndex = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlower = new Date(scale.trace_x[colIndex]);\r\n\t\t\tupper = gantt.date.add(lower, steps, unit);\r\n\t\t} else {\r\n\t\t\tcolIndex = Math.floor(gantt.columnIndexByDate(date));\r\n\r\n\t\t\tupper = gantt.date[unit + \"_start\"](new Date(scale.min_date));\r\n\t\t\tif (scale.trace_x[colIndex]) {\r\n\t\t\t\tupper = gantt.date[unit + \"_start\"](scale.trace_x[colIndex]);// end of time scale\r\n\t\t\t}\r\n\r\n\t\t\twhile (+upper < +date) {\r\n\t\t\t\tupper = gantt.date[unit + \"_start\"](gantt.date.add(upper, steps, unit));\r\n\r\n\t\t\t\tvar tzOffset = upper.getTimezoneOffset();\r\n\r\n\t\t\t\tupper = gantt._correct_dst_change(upper, tzOffset, upper, unit);\r\n\t\t\t\tif (gantt.date[unit + '_start'])\r\n\t\t\t\t\tupper = gantt.date[unit + '_start'](upper);\r\n\t\t\t}\r\n\r\n\t\t\tlower = gantt.date.add(upper, -1 * steps, unit);\r\n\r\n\t\t}\r\n\t\tif (config.dir && config.dir == 'future')\r\n\t\t\treturn upper;\r\n\t\tif (config.dir && config.dir == 'past')\r\n\t\t\treturn lower;\r\n\r\n\t\tif (Math.abs(date - lower) < Math.abs(upper - date)) {\r\n\t\t\treturn lower;\r\n\t\t} else {\r\n\t\t\treturn upper;\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tgantt.correctTaskWorkTime = function (task) {\r\n\t\tif (gantt.config.work_time && gantt.config.correct_work_time) {\r\n\t\t\tif (!this.isWorkTime(task.start_date, undefined, task)) {\r\n\t\t\t\ttask.start_date = this.getClosestWorkTime({date: task.start_date, dir: 'future', task: task});\r\n\t\t\t\ttask.end_date = this.calculateEndDate(task);\r\n\t\t\t} else if (!this.isWorkTime(new Date(+task.end_date - 1), undefined, task)) {\r\n\t\t\t\ttask.end_date = this.calculateEndDate(task);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.attachEvent(\"onBeforeTaskUpdate\", function (id, task) {\r\n\t\tgantt._init_task_timing(task);\r\n\t\treturn true;\r\n\t});\r\n\tgantt.attachEvent(\"onBeforeTaskAdd\", function (id, task) {\r\n\t\tgantt._init_task_timing(task);\r\n\t\treturn true;\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onAfterTaskMove\", function (id, parent, tindex) {\r\n\t\tgantt._init_task_timing(gantt.getTask(id));\r\n\t\treturn true;\r\n\t});\r\n\r\n};","function addResizeListener(gantt){\r\n\tvar containerStyles = window.getComputedStyle(gantt.$root);\r\n\tif(containerStyles.getPropertyValue(\"position\") == \"static\"){\r\n\t\tgantt.$root.style.position = \"relative\";\r\n\t}\r\n\r\n\tvar resizeWatcher = document.createElement('iframe');\r\n\tresizeWatcher.className = \"gantt_container_resize_watcher\";\r\n\tresizeWatcher.tabIndex = -1;\r\n\tif(gantt.config.wai_aria_attributes){\r\n\t\tresizeWatcher.setAttribute(\"role\", \"none\");\r\n\t\tresizeWatcher.setAttribute(\"aria-hidden\", true);\r\n\t}\r\n\r\n\tif (gantt.env.isSalesforce){\r\n\t\tgantt.config.container_resize_method = \"timeout\";\r\n\t}\r\n\r\n\t// in some environments (namely, in SalesForce) iframe.contentWindow is not available\r\n\tgantt.$root.appendChild(resizeWatcher);\r\n\tif (resizeWatcher.contentWindow) {\r\n\t\tlistenWindowResize(gantt, resizeWatcher.contentWindow);\r\n\t} else {\r\n\t\t// if so - ditch the iframe and fallback to listening the main window resize\r\n\t\tgantt.$root.removeChild(resizeWatcher);\r\n\t\tlistenWindowResize(gantt, window);\r\n\t}\r\n}\r\n\r\nfunction listenWindowResize(gantt, window){\r\n\tvar resizeTimeout = gantt.config.container_resize_timeout || 20;\r\n\tvar resizeDelay;\r\n\tlet previousSize = getContainerSize(gantt);\r\n\r\n\tif (gantt.config.container_resize_method == \"timeout\"){\r\n\t\tlowlevelResizeWatcher();\r\n\t}\r\n\telse {\r\n\t\ttry {\r\n\t\t\tgantt.event(window, \"resize\", function () {\r\n\t\t\t\tif (gantt.$scrollbarRepaint) {\r\n\t\t\t\t\tgantt.$scrollbarRepaint = null;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// GS-2140. Don't repaint Gantt if it has the same sizes\r\n\t\t\t\t\tlet currentSize = getContainerSize(gantt);\r\n\t\t\t\t\tif (previousSize.x == currentSize.x && previousSize.y == currentSize.y){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpreviousSize = currentSize;\r\n\t\t\t\t\trepaintGantt();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tcatch (e) {\r\n\t\t\tlowlevelResizeWatcher();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction repaintGantt(){\r\n\t\tclearTimeout(resizeDelay);\r\n\t\tresizeDelay = setTimeout(function(){\r\n\t\t\tif(!gantt.$destroyed){\r\n\t\t\t\tgantt.render();\r\n\t\t\t}\r\n\t\t}, resizeTimeout);\r\n\t}\r\n\r\n\tvar previousHeight = gantt.$root.offsetHeight;\r\n\tvar previousWidth = gantt.$root.offsetWidth;\t\r\n\r\n\tfunction lowlevelResizeWatcher(){\r\n\t\tif (gantt.$root.offsetHeight != previousHeight ||\r\n\t\t\t\tgantt.$root.offsetWidth != previousWidth){\r\n\t\t\t\trepaintGantt();\r\n\t\t}\r\n\r\n\t\tpreviousHeight = gantt.$root.offsetHeight;\r\n\t\tpreviousWidth = gantt.$root.offsetWidth;\r\n\r\n\t\tsetTimeout(lowlevelResizeWatcher, resizeTimeout);\r\n\t}\r\n}\r\n\r\nfunction getContainerSize(gantt){\r\n\treturn {\r\n\t\tx: gantt.$root.offsetWidth,\r\n\t\ty: gantt.$root.offsetHeight\r\n\t};\r\n}\r\n\r\nexport default addResizeListener;","import * as domHelpers from \"./ui/utils/dom_helpers\";\r\nimport * as helpers from \"../utils/helpers\";\r\nimport isHeadless from \"../utils/is_headless\";\r\nimport addResizeListener from \"./ui/resize_listener\";\r\nimport calculateScaleRange from \"./gantt_data_range\";\r\nimport assert from \"./common/assert\";\r\n\r\nexport default function(gantt){\r\n\t\r\n\r\n\tgantt.assert = assert(gantt);\r\n\r\n\tfunction isHTMLElement(node){\r\n\t\ttry {\r\n\t\t\tnode.cloneNode(false);\r\n\t\t}\r\n\t\tcatch (e){\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\tvar invalidContainerMessage = \"Invalid value of the first argument of `gantt.init`. Supported values: HTMLElement, String (element id).\" +\r\n\t\"This error means that either invalid object is passed into `gantt.init` or that the element with the specified ID doesn't exist on the page when `gantt.init` is called.\";\r\n\r\n\tfunction validateNode(node){\r\n\t\tif (!node || (typeof node == 'string' && document.getElementById(node))) return true;\r\n\t\tif (isHTMLElement(node)) return true;\r\n\r\n\t\tgantt.assert(false, invalidContainerMessage);\r\n\t\tthrow new Error(invalidContainerMessage);\r\n\t}\r\n\r\n//initial initialization\r\n\tgantt.init = function(node, from, to){\r\n\t\tif (gantt.env.isNode) { \r\n\t\t\tnode = null; // for the nodejs version\r\n\t\t} else {\r\n\t\t\tvalidateNode(node); // for the web version\r\n\t\t}\r\n\r\n\t\tif(from && to){\r\n\t\t\tthis.config.start_date = this._min_date = new Date(from);\r\n\t\t\tthis.config.end_date = this._max_date = new Date(to);\r\n\t\t}\r\n\t\tthis.date.init();\r\n\r\n\t\t//can be called only once\r\n\t\tthis.init = function(node){\r\n\t\t\tif (gantt.env.isNode) { \r\n\t\t\t\tnode = null; // for the nodejs version\r\n\t\t\t} else {\r\n\t\t\t\tvalidateNode(node); // for the web version\r\n\t\t\t}\r\n\r\n\t\t\tif (this.$container && this.$container.parentNode){\r\n\t\t\t\tthis.$container.parentNode.removeChild(this.$container);\r\n\t\t\t\tthis.$container = null;\r\n\t\t\t}\r\n\r\n\t\t\tif(this.$layout){\r\n\t\t\t\tthis.$layout.clear();\r\n\t\t\t}\r\n\t\t\tthis._reinit(node);\r\n\t\t};\r\n\t\tthis._reinit(node);\r\n\t};\r\n\r\n\tgantt._quickRefresh = function(code){\r\n\t\tvar stores = this._getDatastores.call(this);\r\n\t\tfor(var i = 0; i < stores.length; i++){\r\n\t\t\tstores[i]._quick_refresh = true;\r\n\t\t}\r\n\r\n\t\tcode();\r\n\r\n\t\tfor(var i = 0; i < stores.length; i++){\r\n\t\t\tstores[i]._quick_refresh = false;\r\n\t\t}\r\n\t};\r\n\r\n\tvar dropLayout = (function dropLayout(){\r\n\t\tif(this._clearTaskLayers){\r\n\t\t\tthis._clearTaskLayers();\r\n\t\t}\r\n\r\n\t\tif(this._clearLinkLayers){\r\n\t\t\tthis._clearLinkLayers();\r\n\t\t}\r\n\r\n\t\tif(this.$layout){\r\n\t\t\tthis.$layout.destructor();\r\n\t\t\tthis.$layout = null;\r\n\t\t\tthis.$ui.reset();\r\n\t\t}\r\n\t}).bind(gantt);\r\n\r\n\tvar rebuildLayout = (function rebuildLayout(){\r\n\t\tif(isHeadless(gantt)){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.$root.innerHTML = \"\";\r\n\r\n\t\tthis.$root.gantt = this;\r\n\t\tcalculateScaleRange(this);\r\n\t\tthis.config.layout.id = \"main\";\r\n\t\tthis.$layout = this.$ui.createView(\"layout\", this.$root, this.config.layout);\r\n\r\n\t\tthis.$layout.attachEvent(\"onBeforeResize\", function(){\r\n\t\t\tvar storeNames = gantt.$services.getService(\"datastores\");\r\n\t\t\tfor(var i = 0; i < storeNames.length; i++){\r\n\t\t\t\tgantt.getDatastore(storeNames[i]).filter();\r\n\t\t\t\tif (gantt.$data.tasksStore._skipTaskRecalculation){\r\n\t\t\t\t\t// do not repaint items, they will be repainted later in the onStoreUpdate event\r\n\t\t\t\t\tif (gantt.$data.tasksStore._skipTaskRecalculation != \"lightbox\"){\r\n\t\t\t\t\t\tgantt.$data.tasksStore._skipTaskRecalculation = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t} else {\r\n\t\t\t\t\tgantt.getDatastore(storeNames[i]).callEvent(\"onBeforeRefreshAll\", []);\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.$layout.attachEvent(\"onResize\", function(){\r\n\t\t\tgantt._quickRefresh(function(){\r\n\t\t\t\tgantt.refreshData();\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tthis.callEvent(\"onGanttLayoutReady\", []);\r\n\t\tthis.$layout.render();\r\n\r\n\t\tthis.$container = this.$layout.$container.firstChild;\r\n\r\n\t\taddResizeListener(this);\r\n\t}).bind(gantt);\r\n\r\n\tgantt.resetLayout = function(){\r\n\t\tdropLayout();\r\n\t\trebuildLayout();\r\n\t\tthis.render();\r\n\t};\r\n\r\n\tgantt._reinit = function(node){\r\n\t\tthis.callEvent(\"onBeforeGanttReady\", []);\r\n\t\tthis._update_flags();\r\n\r\n\t\tvar config = this.$services.getService(\"templateLoader\");\r\n\t\tconfig.initTemplates(this);\r\n\r\n\t\tdropLayout();\r\n\r\n\t\tthis.$root = null;\r\n\t\tif(node){\r\n\t\t\tthis.$root = domHelpers.toNode(node);\r\n\t\t\trebuildLayout();\r\n\t\t\tthis.$mouseEvents.reset(this.$root);\r\n\t\t\taddMinimalSizes(gantt);\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onTemplatesReady\",[]);\r\n\r\n\t\tthis.callEvent(\"onGanttReady\", []);\r\n\r\n\t\tthis.render();\r\n\t};\r\n\r\n\tfunction addMinimalSizes(gantt) {\r\n\t\tif (gantt.$container && !gantt.config.autosize) {\r\n\t\t\tif (gantt.$root.offsetHeight < 50) {\r\n\t\t\t\t// eslint-disable-next-line no-console\r\n\t\t\t\tconsole.warn(`The Gantt container has a small height, so you cannot see its content. If it is not intended, you need to set the 'height' style rule to the container:\r\nhttps://docs.dhtmlx.com/gantt/faq.html#theganttchartisntrenderedcorrectly`);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgantt.$click={\r\n\t\tbuttons:{\r\n\t\t\t\"edit\": function(id) {\r\n\t\t\t\tif (gantt.isReadonly(gantt.getTask(id))) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tgantt.showLightbox(id);\r\n\t\t\t},\r\n\t\t\t\"delete\": function(id) {\r\n\t\t\t\tvar task = gantt.getTask(id);\r\n\t\t\t\tif (gantt.isReadonly(task)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar question = gantt.locale.labels.confirm_deleting;\r\n\t\t\t\tvar title = gantt.locale.labels.confirm_deleting_title;\r\n\r\n\t\t\t\tgantt._delete_task_confirm({\r\n\t\t\t\t\ttask: task,\r\n\t\t\t\t\tmessage: question,\r\n\t\t\t\t\ttitle: title,\r\n\t\t\t\t\tcallback: function(){\r\n\t\t\t\t\t\tif(!gantt.isTaskExists(id)){\r\n\t\t\t\t\t\t\tgantt.hideLightbox();\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif(task.$new){\r\n\t\t\t\t\t\t\t// GS-2170. Do not recalculate the indexes and dates of other tasks\r\n\t\t\t\t\t\t\t// as they will be recalculated in the `refreshData`\r\n\t\t\t\t\t\t\tgantt.$data.tasksStore._skipTaskRecalculation = \"lightbox\";\r\n\t\t\t\t\t\t\tgantt.silent(function(){\r\n\t\t\t\t\t\t\t\tgantt.deleteTask(id, true);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tgantt.$data.tasksStore._skipTaskRecalculation = false;\r\n\t\t\t\t\t\t\tgantt.refreshData();\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tgantt.$data.tasksStore._skipTaskRecalculation = true;\r\n\t\t\t\t\t\t\tgantt.deleteTask(id);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tgantt.hideLightbox();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n//renders self\r\n\tgantt.render = function(){\r\n\t\tthis.callEvent(\"onBeforeGanttRender\", []);\r\n\r\n\t\tvar visibleDate;\r\n\t\tif(!isHeadless(gantt)){\r\n\t\t\tif (!this.config.sort && this._sort) {\r\n\t\t\t\tthis._sort = undefined;\r\n\t\t\t}\r\n\r\n\t\t\tif(this.$root){\r\n\t\t\t\tif(this.config.rtl){\r\n\t\t\t\t\tthis.$root.classList.add(\"gantt_rtl\");\r\n\t\t\t\t\tthis.$root.firstChild.classList.add(\"gantt_rtl\"); // GS-1499\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.$root.classList.remove(\"gantt_rtl\");\r\n\t\t\t\t\tthis.$root.firstChild.classList.remove(\"gantt_rtl\"); // GS-1499\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar pos = this.getScrollState();\r\n\t\t\tvar posX = pos ? pos.x : 0;\r\n\t\t\tif(this._getHorizontalScrollbar()){\r\n\t\t\t\tvar scrollbar = this._getHorizontalScrollbar();\r\n\t\t\t\tposX = scrollbar.$config.codeScrollLeft || posX || 0;\r\n\t\t\t}\r\n\r\n\r\n\t\t\tvisibleDate = null;\r\n\t\t\tif(posX){\r\n\t\t\t\tvisibleDate = gantt.dateFromPos(posX + this.config.task_scroll_offset);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcalculateScaleRange(this);\r\n\r\n\t\tif(!isHeadless(gantt)){\r\n\t\t\tthis.$layout.$config.autosize = this.config.autosize;\r\n\t\t\tvar preserveScroll = this.config.preserve_scroll;\r\n\t\t\tthis.config.preserve_scroll = false; // prevent scrolling from layout resize, scroll will be called here later on\r\n\t\t\tthis.$layout.resize();\r\n\t\t\tthis.config.preserve_scroll = preserveScroll;\r\n\r\n\t\t\tif(this.config.preserve_scroll && pos){\r\n\t\t\t\t// GS-1640: We need pos.y, otherwise part of the timeline won't be rendered if the scrollbar disappeared\r\n\t\t\t\t// GS-2945: don't need to scroll if the zoom ext was initialized cause it will be scrolled in zoom\r\n\t\t\t\tconst zoom = gantt.ext.zoom._initialized;  \r\n\t\t\t\tif ((posX || pos.y) && !zoom) {\r\n\t\t\t\t\tvar new_pos = gantt.getScrollState();\r\n\t\t\t\t\tvar new_date = gantt.dateFromPos(new_pos.x);\r\n\t\t\t\t\tif(!(+visibleDate == +new_date && new_pos.y == pos.y)){\r\n\t\t\t\t\t\tvar posX = null;\r\n\t\t\t\t\t\tvar posY = null;\r\n\t\t\t\t\t\tif(visibleDate){\r\n\t\t\t\t\t\t\tvar posX = Math.max(gantt.posFromDate(visibleDate) - gantt.config.task_scroll_offset, 0);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(pos.y){\r\n\t\t\t\t\t\t\tposY = pos.y;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tgantt.scrollTo(posX, posY);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// GS-1640: We need to reset the scroll position for the grid if the scrollbar disappeared and\r\n\t\t\t\t// the grid and timeline have different scrollbars\r\n\t\t\t\t// GS-2718: if we have resources and two verticall scrollbars for tasks timeline and resource timeline\r\n\t\t\t\t// we don't get the scroll state of the resource timeline\r\n\t\t\t\tconst scrollbarsInfo = this.$layout.getScrollbarsInfo();\r\n\t\t\t\tscrollbarsInfo.forEach((scroll_info) => {\r\n\t\t\t\t\tconst scroll = gantt.$ui.getView(scroll_info.id);\r\n\t\t\t\t\tconst scrollbarNodeVisible = gantt.utils.dom.isChildOf(scroll.$view, gantt.$container);\r\n\t\t\t\t\tscroll_info.boundViews.forEach((viewName) => {\r\n\t\t\t\t\t\tconst view = gantt.$ui.getView(viewName);\r\n\t\t\t\t\t\tif(scroll_info.y && scroll_info.y != pos.y){\r\n\t\t\t\t\t\t\tif(view && !scrollbarNodeVisible){\r\n\t\t\t\t\t\t\t\tview.scrollTo(undefined, 0);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//GS-2586: take into account the horizontal scroll of the resource timeline\r\n\t\t\t\t\t\tif(scroll_info.x_pos && scroll_info.x_pos != pos.x){\r\n\t\t\t\t\t\t\tif(view && scrollbarNodeVisible){\r\n\t\t\t\t\t\t\t\tview.scrollTo(scroll_info.x_pos, undefined);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t}else{\r\n\t\t\tgantt.refreshData();\r\n\t\t}\r\n\t\tthis.callEvent(\"onGanttRender\", []);\r\n\t};\r\n\r\n\t//TODO: add layout.resize method that wouldn't trigger data repaint\r\n\tgantt.setSizes = gantt.render;\r\n\r\n\r\n\tgantt.getTaskRowNode = function(id) {\r\n\t\tvar els = this.$grid_data.childNodes;\r\n\t\tvar attribute = this.config.task_attribute;\r\n\t\tfor (var i = 0; i < els.length; i++) {\r\n\t\t\tif (els[i].getAttribute) {\r\n\t\t\t\tvar value = els[i].getAttribute(attribute);\r\n\t\t\t\tif (value == id) return els[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n\r\n\tgantt.changeLightboxType = function(type){\r\n\t\tif(this.getLightboxType() == type)\r\n\t\t\treturn true;\r\n\t\tgantt._silent_redraw_lightbox(type);\r\n\t};\r\n\r\n\tgantt._get_link_type = function (from_start, to_start) {\r\n\t\tvar type = null;\r\n\t\tif (from_start && to_start) {\r\n\t\t\ttype = gantt.config.links.start_to_start;\r\n\t\t} else if (!from_start && to_start) {\r\n\t\t\ttype = gantt.config.links.finish_to_start;\r\n\t\t} else if (!from_start && !to_start) {\r\n\t\t\ttype = gantt.config.links.finish_to_finish;\r\n\t\t} else if (from_start && !to_start) {\r\n\t\t\ttype = gantt.config.links.start_to_finish;\r\n\t\t}\r\n\t\treturn type;\r\n\t};\r\n\r\n\tgantt.isLinkAllowed = function (from, to, from_start, to_start) {\r\n\t\tvar link = null;\r\n\t\tif (typeof(from) == \"object\") {\r\n\t\t\tlink = from;\r\n\t\t} else {\r\n\t\t\tlink = {source: from, target: to, type: this._get_link_type(from_start, to_start)};\r\n\t\t}\r\n\r\n\t\tif (!link) return false;\r\n\t\tif (!(link.source && link.target && link.type)) return false;\r\n\t\tif (link.source == link.target) return false;\r\n\r\n\t\tvar res = true;\r\n\t\t//any custom rules\r\n\t\tif (this.checkEvent(\"onLinkValidation\"))\r\n\t\t\tres = this.callEvent(\"onLinkValidation\", [link]);\r\n\r\n\t\treturn res;\r\n\t};\r\n\r\n\r\n\tgantt._correct_dst_change = function(date, prevOffset, step, unit){\r\n\t\tvar time_unit = helpers.getSecondsInUnit(unit) * step;\r\n\t\tif(time_unit > 60*60 && time_unit < 60*60*24){\r\n\t\t\t//correct dst change only if current unit is more than one hour and less than day (days have own checking), e.g. 12h\r\n\t\t\tvar offsetChanged = date.getTimezoneOffset() - prevOffset;\r\n\t\t\tif(offsetChanged){\r\n\t\t\t\tdate = gantt.date.add(date, offsetChanged, \"minute\");\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn date;\r\n\t};\r\n\r\n\tgantt.isSplitTask = function(task){\r\n\t\tgantt.assert(task && task instanceof Object, \"Invalid argument <b>task</b>=\"+task+\" of gantt.isSplitTask. Task object was expected\");\r\n\t\treturn this.$data.tasksStore._isSplitItem(task);\r\n\t};\r\n\r\n\tgantt._is_icon_open_click = function(e) {\r\n\t\tif (!e)\r\n\t\t\treturn false;\r\n\t\tvar target = e.target || e.srcElement;\r\n\t\tif (!(target && target.className))\r\n\t\t\treturn false;\r\n\t\tvar className = domHelpers.getClassName(target);\r\n\t\tif (className.indexOf(\"gantt_tree_icon\") !== -1 && (className.indexOf(\"gantt_close\") !== -1 || className.indexOf(\"gantt_open\") !== -1))\r\n\t\t\treturn true;\r\n\t\treturn false;\r\n\t};\r\n\r\n};","/*\r\n \tasserts will be removed in final code, so you can place them anythere\r\n\twithout caring about performance impacts\r\n*/\r\n\r\nexport default function(gantt){\r\n\treturn function assert(check, message){\r\n\t\tif (!check){\r\n\t\t\tif(gantt.config.show_errors && gantt.callEvent(\"onError\",[message]) !== false) {\r\n\t\t\t\tif (gantt.message) {\r\n\t\t\t\t\tgantt.message({type: \"error\", text: message, expire: -1});\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// eslint-disable-next-line\r\n\t\t\t\t\tconsole.log(message);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// eslint-disable-next-line no-debugger\r\n\t\t\t\tdebugger;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n};","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\" \", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \" \", \" \", \" \"],\r\n\t\tmonth_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \" \",\r\n\t\ticon_save: \"\",\r\n\t\ticon_cancel: \"\",\r\n\t\ticon_details: \"\",\r\n\t\ticon_edit: \"\",\r\n\t\ticon_delete: \"\",\r\n\t\tconfirm_closing: \"  ,   \", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"       \",\r\n\t\tsection_description: \"\",\r\n\t\tsection_time: \" \",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"\", \"\", \"\", \"\", \"Ma\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tmonth_short: [\"\", \"\", \"\", \"\", \"Ma\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \" \",\r\n\t\ticon_save: \"\",\r\n\t\ticon_cancel: \"\",\r\n\t\ticon_details: \"\",\r\n\t\ticon_edit: \"\",\r\n\t\ticon_delete: \"\",\r\n\t\tconfirm_closing: \"\", //    , ?\r\n\t\tconfirm_deleting: \"   , ?\",\r\n\t\tsection_description: \"\",\r\n\t\tsection_time: \" \",\r\n\t\tsection_type: \"\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"\",\r\n\t\tcolumn_text: \"\",\r\n\t\tcolumn_start_date: \"\",\r\n\t\tcolumn_duration: \"\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"\",\r\n\t\tconfirm_link_deleting: \" \",\r\n\t\tlink_start: \"()\",\r\n\t\tlink_end: \"()\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"ii\",\r\n\t\thours: \"i\",\r\n\t\tdays: \"\",\r\n\t\tweeks: \"\",\r\n\t\tmonths: \"\",\r\n\t\tyears: \"\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n @Traducido por Vicente Adria Bohigues - vicenteadria@hotmail.com\r\n */\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Gener\", \"Febrer\", \"Mar\", \"Abril\", \"Maig\", \"Juny\", \"Juliol\", \"Agost\", \"Setembre\", \"Octubre\", \"Novembre\", \"Desembre\"],\r\n\t\tmonth_short: [\"Gen\", \"Feb\", \"Mar\", \"Abr\", \"Mai\", \"Jun\", \"Jul\", \"Ago\", \"Set\", \"Oct\", \"Nov\", \"Des\"],\r\n\t\tday_full: [\"Diumenge\", \"Dilluns\", \"Dimarts\", \"Dimecres\", \"Dijous\", \"Divendres\", \"Dissabte\"],\r\n\t\tday_short: [\"Dg\", \"Dl\", \"Dm\", \"Dc\", \"Dj\", \"Dv\", \"Ds\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nova tasca\",\r\n\t\ticon_save: \"Guardar\",\r\n\t\ticon_cancel: \"Cancellar\",\r\n\t\ticon_details: \"Detalls\",\r\n\t\ticon_edit: \"Editar\",\r\n\t\ticon_delete: \"Esborrar\",\r\n\t\tconfirm_closing: \"\", // \"Els seus canvis es perdrn, continuar ?\"\r\n\t\tconfirm_deleting: \"L'esdeveniment s'esborrar definitivament, continuar ?\",\r\n\t\tsection_description: \"Descripci\",\r\n\t\tsection_time: \"Periode de temps\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Cancellar\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\nTranslation by FreezeSoul\r\n\r\nUpdate 26/10/2015:\r\nTranslation of new labels by zwh8800\r\n https://github.com/DHTMLX/gantt/pull/7\r\n\r\n*/\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tmonth_short: [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\"],\r\n\t\tday_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"\",\r\n\t\ticon_save: \"\",\r\n\t\ticon_cancel: \"\",\r\n\t\ticon_details: \"\",\r\n\t\ticon_edit: \"\",\r\n\t\ticon_delete: \"\",\r\n\t\tconfirm_closing: \"!\", // Your changes will be lost, are your sure?\r\n\t\tconfirm_deleting: \"?\",\r\n\t\tsection_description: \"\",\r\n\t\tsection_time: \"\",\r\n\t\tsection_type: \"\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"\",\r\n\t\tcolumn_text: \"\",\r\n\t\tcolumn_start_date: \"\",\r\n\t\tcolumn_duration: \"\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\r\n\t\tlink: \"\",\r\n\t\tconfirm_link_deleting: \"\",\r\n\t\tlink_start: \" ()\",\r\n\t\tlink_end: \" ()\",\r\n\r\n\t\ttype_task: \"\",\r\n\t\ttype_project: \"\",\r\n\t\ttype_milestone: \"\",\r\n\r\n\t\tminutes: \"\",\r\n\t\thours: \"\",\r\n\t\tdays: \"\",\r\n\t\tweeks: \"\",\r\n\t\tmonths: \"\",\r\n\t\tyears: \"\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Leden\", \"nor\", \"Bezen\", \"Duben\", \"Kvten\", \"erven\", \"ervenec\", \"Srpen\", \"Z\", \"jen\", \"Listopad\", \"Prosinec\"],\r\n\t\tmonth_short: [\"Led\", \"n\", \"Be\", \"Dub\", \"Kv\", \"er\", \"ec\", \"Srp\", \"Z\", \"j\", \"List\", \"Pro\"],\r\n\t\tday_full: [\"Nedle\", \"Pondl\", \"ter\", \"Steda\", \"tvrtek\", \"Ptek\", \"Sobota\"],\r\n\t\tday_short: [\"Ne\", \"Po\", \"t\", \"St\", \"t\", \"P\", \"So\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nov prce\",\r\n\t\ticon_save: \"Uloit\",\r\n\t\ticon_cancel: \"Zpt\",\r\n\t\ticon_details: \"Detail\",\r\n\t\ticon_edit: \"Edituj\",\r\n\t\ticon_delete: \"Smazat\",\r\n\t\tconfirm_closing: \"\", // Vae zmny budou ztraceny, opravdu ?\r\n\t\tconfirm_deleting: \"Udlost bude trvale smazna, opravdu?\",\r\n\t\tsection_description: \"Poznmky\",\r\n\t\tsection_time: \"Doba platnosti\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Zpt\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Januar\", \"Februar\", \"Marts\", \"April\", \"Maj\", \"Juni\", \"Juli\", \"August\", \"September\", \"Oktober\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Maj\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Sndag\", \"Mandag\", \"Tirsdag\", \"Onsdag\", \"Torsdag\", \"Fredag\", \"Lrdag\"],\r\n\t\tday_short: [\"Sn\", \"Man\", \"Tir\", \"Ons\", \"Tor\", \"Fre\", \"Lr\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Ny opgave\",\r\n\t\ticon_save: \"Gem\",\r\n\t\ticon_cancel: \"Fortryd\",\r\n\t\ticon_details: \"Detaljer\",\r\n\t\ticon_edit: \"Tilret\",\r\n\t\ticon_delete: \"Slet\",\r\n\t\tconfirm_closing: \"Dine rettelser vil g tabt.. Er dy sikker?\", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"Bigivenheden vil blive slettet permanent. Er du sikker?\",\r\n\t\tsection_description: \"Beskrivelse\",\r\n\t\tsection_time: \"Tidsperiode\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Fortryd\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\" Januar\", \" Februar\", \" Mrz \", \" April\", \" Mai\", \" Juni\", \" Juli\", \" August\", \" September \", \" Oktober\", \" November \", \" Dezember\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mr\", \"Apr\", \"Mai\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dez\"],\r\n\t\tday_full: [\"Sonntag\", \"Montag\", \"Dienstag\", \" Mittwoch\", \" Donnerstag\", \"Freitag\", \"Samstag\"],\r\n\t\tday_short: [\"So\", \"Mo\", \"Di\", \"Mi\", \"Do\", \"Fr\", \"Sa\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Neue Aufgabe\",\r\n\t\ticon_save: \"Speichern\",\r\n\t\ticon_cancel: \"Abbrechen\",\r\n\t\ticon_details: \"Details\",\r\n\t\ticon_edit: \"ndern\",\r\n\t\ticon_delete: \"Lschen\",\r\n\t\tconfirm_closing: \"\", // \"Ihre Vernderungen werden verloren sein, wollen Sie ergnzen? \"\r\n\t\tconfirm_deleting: \"Der Eintrag wird gelscht\",\r\n\t\tsection_description: \"Beschreibung\",\r\n\t\tsection_time: \"Zeitspanne\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"PSP\",\r\n\t\tcolumn_text: \"Task-Namen\",\r\n\t\tcolumn_start_date: \"Startzeit\",\r\n\t\tcolumn_duration: \"Dauer\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"werden gelscht\",\r\n\t\tlink_start: \"(starten)\",\r\n\t\tlink_end: \"(ende)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minuten\",\r\n\t\thours: \"Stunden\",\r\n\t\tdays: \"Tage\",\r\n\t\tweeks: \"Wochen\",\r\n\t\tmonths: \"Monate\",\r\n\t\tyears: \"Jahre\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Abbrechen\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Regel\",\r\n\t\tconstraint_type: \"Regel\",\r\n\t\tconstraint_date: \"Regel - Datum\",\r\n\t\tasap: \"So bald wie mglich\",\r\n\t\talap: \"So spt wie mglich\",\r\n\t\tsnet: \"Beginn nicht vor\",\r\n\t\tsnlt: \"Beginn nicht spter als\",\r\n\t\tfnet: \"Fertigstellung nicht vor\",\r\n\t\tfnlt: \"Fertigstellung nicht spter als\",\r\n\t\tmso: \"Muss beginnen am\",\r\n\t\tmfo: \"Muss fertig sein am\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tmonth_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \" \",\r\n\t\ticon_save: \"\",\r\n\t\ticon_cancel: \"\",\r\n\t\ticon_details: \"\",\r\n\t\ticon_edit: \"\",\r\n\t\ticon_delete: \"\",\r\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"    .   ;\",\r\n\t\tsection_description: \"\",\r\n\t\tsection_time: \" \",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"],\r\n\t\tday_short: [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"New task\",\r\n\t\ticon_save: \"Save\",\r\n\t\ticon_cancel: \"Cancel\",\r\n\t\ticon_details: \"Details\",\r\n\t\ticon_edit: \"Edit\",\r\n\t\ticon_delete: \"Delete\",\r\n\t\tconfirm_closing: \"\",// Your changes will be lost, are you sure?\r\n\t\tconfirm_deleting: \"Task will be deleted permanently, are you sure?\",\r\n\t\tsection_description: \"Description\",\r\n\t\tsection_time: \"Time period\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\r\n\t\t/* grid columns */\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Cancel\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\t\t\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;","/*\r\n @Autor Manuel Fernandez Panzuela - www.mfernandez.es\r\n\r\n Update 30/10/2015:\r\n Translation of new labels by Jorge Macias\r\n https://disqus.com/by/disqus_bTuZk1voC7/\r\n */\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Enero\", \"Febrero\", \"Marzo\", \"Abril\", \"Mayo\", \"Junio\", \"Julio\", \"Agosto\", \"Septiembre\", \"Octubre\", \"Noviembre\", \"Diciembre\"],\r\n\t\tmonth_short: [\"Ene\", \"Feb\", \"Mar\", \"Abr\", \"May\", \"Jun\", \"Jul\", \"Ago\", \"Sep\", \"Oct\", \"Nov\", \"Dic\"],\r\n\t\tday_full: [\"Domingo\", \"Lunes\", \"Martes\", \"Mircoles\", \"Jueves\", \"Viernes\", \"Sbado\"],\r\n\t\tday_short: [\"Dom\", \"Lun\", \"Mar\", \"Mi\", \"Jue\", \"Vie\", \"Sb\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nueva tarea\",\r\n\t\ticon_save: \"Guardar\",\r\n\t\ticon_cancel: \"Cancelar\",\r\n\t\ticon_details: \"Detalles\",\r\n\t\ticon_edit: \"Editar\",\r\n\t\ticon_delete: \"Eliminar\",\r\n\t\tconfirm_closing: \"\", // \"Sus cambios se perdern, continuar ?\"\r\n\t\tconfirm_deleting: \"El evento se borrar definitivamente, continuar?\",\r\n\t\tsection_description: \"Descripcin\",\r\n\t\tsection_time: \"Perodo\",\r\n\t\tsection_type: \"Tipo\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"EDT\",\r\n\t\tcolumn_text: \"Tarea\",\r\n\t\tcolumn_start_date: \"Inicio\",\r\n\t\tcolumn_duration: \"Duracin\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Enlace\",\r\n\t\tconfirm_link_deleting: \"ser borrada\",\r\n\t\tlink_start: \" (inicio)\",\r\n\t\tlink_end: \" (fin)\",\r\n\r\n\t\ttype_task: \"Tarea\",\r\n\t\ttype_project: \"Proyecto\",\r\n\t\ttype_milestone: \"Hito\",\r\n\r\n\r\n\t\tminutes: \"Minutos\",\r\n\t\thours: \"Horas\",\r\n\t\tdays: \"Das\",\r\n\t\tweeks: \"Semanas\",\r\n\t\tmonths: \"Meses\",\r\n\t\tyears: \"Aos\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Cancelar\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n dhtmlxGantt Persian (Farsi, fa_IR) locale by Mohammad Shokri http://slashsbin.com/\r\n */\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\"\r\n\t\t],\r\n\t\tmonth_short: [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\"],\r\n\t\tday_full: [\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\"\r\n\t\t],\r\n\t\tday_short: [\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\"\r\n\t\t]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \" \",\r\n\t\ticon_save: \"\",\r\n\t\ticon_cancel: \"\",\r\n\t\ticon_details: \"\",\r\n\t\ticon_edit: \"\",\r\n\t\ticon_delete: \"\",\r\n\t\tconfirm_closing: \"       \",\r\n\t\tconfirm_deleting: \"         \",\r\n\t\tsection_description: \"\",\r\n\t\tsection_time: \" \",\r\n\t\tsection_type: \"\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"\",\r\n\t\tcolumn_start_date: \" \",\r\n\t\tcolumn_duration: \"\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"\",\r\n\t\tconfirm_link_deleting: \"  \",\r\n\t\tlink_start: \" ()\",\r\n\t\tlink_end: \" ()\",\r\n\r\n\t\ttype_task: \"\",\r\n\t\ttype_project: \"\",\r\n\t\ttype_milestone: \"\",\r\n\r\n\t\tminutes: \"\",\r\n\t\thours: \"\",\r\n\t\tdays: \"\",\r\n\t\tweeks: \"\",\r\n\t\tmonths: \"\",\r\n\t\tyears: \"\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"\",\r\n\t\tmessage_cancel: \"\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Tammikuu\", \"Helmikuu\", \"Maaliskuu\", \"Huhtikuu\", \"Toukokuu\", \"Kes&auml;kuu\", \"Hein&auml;kuu\", \"Elokuu\", \"Syyskuu\", \"Lokakuu\", \"Marraskuu\", \"Joulukuu\"],\r\n\t\tmonth_short: [\"Tam\", \"Hel\", \"Maa\", \"Huh\", \"Tou\", \"Kes\", \"Hei\", \"Elo\", \"Syy\", \"Lok\", \"Mar\", \"Jou\"],\r\n\t\tday_full: [\"Sunnuntai\", \"Maanantai\", \"Tiistai\", \"Keskiviikko\", \"Torstai\", \"Perjantai\", \"Lauantai\"],\r\n\t\tday_short: [\"Su\", \"Ma\", \"Ti\", \"Ke\", \"To\", \"Pe\", \"La\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Uusi tehtv\",\r\n\t\ticon_save: \"Tallenna\",\r\n\t\ticon_cancel: \"Peru\",\r\n\t\ticon_details: \"Tiedot\",\r\n\t\ticon_edit: \"Muokkaa\",\r\n\t\ticon_delete: \"Poista\",\r\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"Haluatko varmasti poistaa tapahtuman?\",\r\n\t\tsection_description: \"Kuvaus\",\r\n\t\tsection_time: \"Aikajakso\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Peru\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Janvier\", \"Fvrier\", \"Mars\", \"Avril\", \"Mai\", \"Juin\", \"Juillet\", \"Aot\", \"Septembre\", \"Octobre\", \"Novembre\", \"Dcembre\"],\r\n\t\tmonth_short: [\"Jan\", \"Fv\", \"Mar\", \"Avr\", \"Mai\", \"Juin\", \"Juil\", \"Ao\", \"Sep\", \"Oct\", \"Nov\", \"Dc\"],\r\n\t\tday_full: [\"Dimanche\", \"Lundi\", \"Mardi\", \"Mercredi\", \"Jeudi\", \"Vendredi\", \"Samedi\"],\r\n\t\tday_short: [\"Dim\", \"Lun\", \"Mar\", \"Mer\", \"Jeu\", \"Ven\", \"Sam\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nouvelle tche\",\r\n\t\ticon_save: \"Enregistrer\",\r\n\t\ticon_cancel: \"Annuler\",\r\n\t\ticon_details: \"Dtails\",\r\n\t\ticon_edit: \"Modifier\",\r\n\t\ticon_delete: \"Effacer\",\r\n\t\tconfirm_closing: \"\",// Vos modifications seront perdus, tes-vous sr ?\r\n\t\tconfirm_deleting: \"L'vnement sera effac sans appel, tes-vous sr ?\",\r\n\r\n\t\tsection_description: \"Description\",\r\n\t\tsection_time: \"Priode\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"OTP\",\r\n\t\tcolumn_text: \"Nom de la tche\",\r\n\t\tcolumn_start_date: \"Date initiale\",\r\n\t\tcolumn_duration: \"Dure\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Le lien\",\r\n\t\tconfirm_link_deleting: \"sera supprim\",\r\n\t\tlink_start: \"(dbut)\",\r\n\t\tlink_end: \"(fin)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Heures\",\r\n\t\tdays: \"Jours\",\r\n\t\tweeks: \"Semaines\",\r\n\t\tmonths: \"Mois\",\r\n\t\tyears: \"Annes\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Annuler\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tmonth_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \" \",\r\n\t\ticon_save: \"\",\r\n\t\ticon_cancel: \"\",\r\n\t\ticon_details: \"\",\r\n\t\ticon_edit: \"\",\r\n\t\ticon_delete: \"\",\r\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"  .?\",\r\n\t\tsection_description: \"\",\r\n\t\tsection_time: \"\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n  Translation by Davor\r\n http://docs.dhtmlx.com/gantt/desktop__localization.html#comment-2569116291\r\n */\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Sijeanj\", \"Veljaa\", \"Oujak\", \"Travanj\", \"Svibanj\", \"Lipanj\", \"Srpanj\", \"Kolovoz\", \"Rujan\", \"Listopad\", \"Studeni\", \"Prosinac\"],\r\n\t\tmonth_short: [\"Sij\", \"Velj\", \"Ou\", \"Tra\", \"Svi\", \"Lip\", \"Srp\", \"Kol\", \"Ruj\", \"Lis\", \"Stu\", \"Pro\"],\r\n\t\tday_full: [\"Nedjelja\", \"Ponedjeljak\", \"Utorak\", \"Srijeda\", \"etvrtak\", \"Petak\", \"Subota\"],\r\n\t\tday_short: [\"Ned\", \"Pon\", \"Uto\", \"Sri\", \"et\", \"Pet\", \"Sub\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Novi Zadatak\",\r\n\t\ticon_save: \"Spremi\",\r\n\t\ticon_cancel: \"Odustani\",\r\n\t\ticon_details: \"Detalji\",\r\n\t\ticon_edit: \"Izmjeni\",\r\n\t\ticon_delete: \"Obrii\",\r\n\t\tconfirm_closing: \"\",\r\n\t\tconfirm_deleting: \"Zadatak e biti trajno izbrisan, jeste li sigurni?\",\r\n\t\tsection_description: \"Opis\",\r\n\t\tsection_time: \"Vremenski Period\",\r\n\t\tsection_type: \"Tip\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\r\n\t\t/* grid columns */\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Naziv Zadatka\",\r\n\t\tcolumn_start_date: \"Poetno Vrijeme\",\r\n\t\tcolumn_duration: \"Trajanje\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Poveznica\",\r\n\t\tconfirm_link_deleting: \"e biti izbrisan\",\r\n\t\tlink_start: \" (poetak)\",\r\n\t\tlink_end: \" (kraj)\",\r\n\r\n\t\ttype_task: \"Zadatak\",\r\n\t\ttype_project: \"Projekt\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\t\tminutes: \"Minute\",\r\n\t\thours: \"Sati\",\r\n\t\tdays: \"Dani\",\r\n\t\tweeks: \"Tjedni\",\r\n\t\tmonths: \"Mjeseci\",\r\n\t\tyears: \"Godine\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Odustani\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Janur\", \"Februr\", \"Mrcius\", \"prilis\", \"Mjus\", \"Jnius\", \"Jlius\", \"Augusztus\", \"Szeptember\", \"Oktber\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mr\", \"pr\", \"Mj\", \"Jn\", \"Jl\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Vasrnap\", \"Htf\", \"Kedd\", \"Szerda\", \"Cstrtk\", \"Pntek\", \"szombat\"],\r\n\t\tday_short: [\"Va\", \"H\", \"Ke\", \"Sze\", \"Cs\", \"P\", \"Szo\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"j feladat\",\r\n\t\ticon_save: \"Ments\",\r\n\t\ticon_cancel: \"Mgse\",\r\n\t\ticon_details: \"Rszletek\",\r\n\t\ticon_edit: \"Szerkeszts\",\r\n\t\ticon_delete: \"Trls\",\r\n\t\tconfirm_closing: \"\", // A vltozsok elvesznek, biztosan folytatja? \"\r\n\t\tconfirm_deleting: \"Az esemny trlve lesz, biztosan folytatja?\",\r\n\t\tsection_description: \"Lers\",\r\n\t\tsection_time: \"Idszak\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Mgse\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Januari\", \"Februari\", \"Maret\", \"April\", \"Mei\", \"Juni\", \"Juli\", \"Agustus\", \"September\", \"Oktober\", \"November\", \"Desember\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Mei\", \"Jun\", \"Jul\", \"Ags\", \"Sep\", \"Okt\", \"Nov\", \"Des\"],\r\n\t\tday_full: [\"Minggu\", \"Senin\", \"Selasa\", \"Rabu\", \"Kamis\", \"Jumat\", \"Sabtu\"],\r\n\t\tday_short: [\"Ming\", \"Sen\", \"Sel\", \"Rab\", \"Kam\", \"Jum\", \"Sab\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Tugas baru\",\r\n\t\ticon_save: \"Simpan\",\r\n\t\ticon_cancel: \"Batal\",\r\n\t\ticon_details: \"Detail\",\r\n\t\ticon_edit: \"Edit\",\r\n\t\ticon_delete: \"Hapus\",\r\n\t\tconfirm_closing: \"\", /* Perubahan tidak akan disimpan ? */\r\n\t\tconfirm_deleting: \"Acara akan dihapus\",\r\n\t\tsection_description: \"Keterangan\",\r\n\t\tsection_time: \"Periode\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Batal\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n Update 29/12/2015:\r\n New labels translation by ARCANGELI CLAUDIO\r\n\r\n */\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Gennaio\", \"Febbraio\", \"Marzo\", \"Aprile\", \"Maggio\", \"Giugno\", \"Luglio\", \"Agosto\", \"Settembre\", \"Ottobre\", \"Novembre\", \"Dicembre\"],\r\n\t\tmonth_short: [\"Gen\", \"Feb\", \"Mar\", \"Apr\", \"Mag\", \"Giu\", \"Lug\", \"Ago\", \"Set\", \"Ott\", \"Nov\", \"Dic\"],\r\n\t\tday_full: [\"Domenica\", \"Luned\", \"Marted\", \"Mercoled\", \"Gioved\", \"Venerd\", \"Sabato\"],\r\n\t\tday_short: [\"Dom\", \"Lun\", \"Mar\", \"Mer\", \"Gio\", \"Ven\", \"Sab\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nuovo compito\",\r\n\t\ticon_save: \"Salva\",\r\n\t\ticon_cancel: \"Chiudi\",\r\n\t\ticon_details: \"Dettagli\",\r\n\t\ticon_edit: \"Modifica\",\r\n\t\ticon_delete: \"Elimina\",\r\n\t\tconfirm_closing: \"\",// \"Sei sicuro di confermare la chiusura?\",\r\n\t\tconfirm_deleting: \"Sei sicuro di confermare l'eliminazione?\",\r\n\t\tsection_description: \"Descrizione\",\r\n\t\tsection_time: \"Periodo di tempo\",\r\n\t\tsection_type: \"Tipo\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Nome Attivit\",\r\n\t\tcolumn_start_date: \"Inizio\",\r\n\t\tcolumn_duration: \"Durata\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"sar eliminato\",\r\n\t\tlink_start: \" (inizio)\",\r\n\t\tlink_end: \" (fine)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minuti\",\r\n\t\thours: \"Ore\",\r\n\t\tdays: \"Giorni\",\r\n\t\tweeks: \"Settimane\",\r\n\t\tmonths: \"Mesi\",\r\n\t\tyears: \"Anni\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Chiudi\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n Translation by Genexus Japan Inc.\r\n */\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\"],\r\n\t\tmonth_short: [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\"],\r\n\t\tday_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"\",\r\n\t\ticon_save: \"\",\r\n\t\ticon_cancel: \"\",\r\n\t\ticon_details: \"\",\r\n\t\ticon_edit: \"\",\r\n\t\ticon_delete: \"\",\r\n\t\tconfirm_closing: \"\", // \r\n\t\tconfirm_deleting: \"\",\r\n\t\tsection_description: \"\",\r\n\t\tsection_time: \"\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n\tTranslated by cjkim@dbvalley.com\r\n*/\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\"],\r\n\t\tmonth_short: [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\"],\r\n\t\tday_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \" \",\r\n\t\ticon_save: \"\",\r\n\t\ticon_cancel: \"\",\r\n\t\ticon_details: \" \",\r\n\t\ticon_edit: \"\",\r\n\t\ticon_delete: \"\",\r\n\t\tconfirm_closing: \"\",\r\n\t\tconfirm_deleting: \" ?\",\r\n\t\tsection_description: \"\",\r\n\t\tsection_time: \"\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"\",\r\n\t\tcolumn_start_date: \"\",\r\n\t\tcolumn_duration: \"\",\r\n\t\tcolumn_add: \"\",\r\n\t\tlink: \"\",\r\n\t\tconfirm_link_deleting: \" ?\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\t\ttype_task: \"\",\r\n\t\ttype_project: \"\",\r\n\t\ttype_milestone: \"\",\r\n\t\tminutes: \"\",\r\n\t\thours: \"\",\r\n\t\tdays: \"\",\r\n\t\tweeks: \"\",\r\n\t\tmonths: \"\",\r\n\t\tyears: \"\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","export default class LocaleManager{\r\n\tprivate _locales:{[key:string]: IGanttLocale };\r\n\r\n\tconstructor(config: {[key:string]: IGanttLocale }){\r\n\t\tthis._locales = {};\r\n\t\tfor(const i in config){\r\n\t\t\tthis._locales[i] = config[i];\r\n\t\t}\r\n\t}\r\n\r\n\taddLocale = (name: string, locale: IGanttLocale) => {\r\n\t\tthis._locales[name] = locale;\r\n\t};\r\n\r\n\tgetLocale = (name: string): IGanttLocale => {\r\n\t\treturn this._locales[name];\r\n\t};\r\n}","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Januar\", \"Februar\", \"Mars\", \"April\", \"Mai\", \"Juni\", \"Juli\", \"August\", \"September\", \"Oktober\", \"November\", \"Desember\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Mai\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Des\"],\r\n\t\tday_full: [\"Sndag\", \"Mandag\", \"Tirsdag\", \"Onsdag\", \"Torsdag\", \"Fredag\", \"Lrdag\"],\r\n\t\tday_short: [\"Sn\", \"Mon\", \"Tir\", \"Ons\", \"Tor\", \"Fre\", \"Lr\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Ny oppgave\",\r\n\t\ticon_save: \"Lagre\",\r\n\t\ticon_cancel: \"Avbryt\",\r\n\t\ticon_details: \"Detaljer\",\r\n\t\ticon_edit: \"Rediger\",\r\n\t\ticon_delete: \"Slett\",\r\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"Hendelsen vil bli slettet permanent. Er du sikker?\",\r\n\t\tsection_description: \"Beskrivelse\",\r\n\t\tsection_time: \"Tidsperiode\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Avbryt\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Januari\", \"Februari\", \"Maart\", \"April\", \"Mei\", \"Juni\", \"Juli\", \"Augustus\", \"September\", \"Oktober\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"mrt\", \"Apr\", \"Mei\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Zondag\", \"Maandag\", \"Dinsdag\", \"Woensdag\", \"Donderdag\", \"Vrijdag\", \"Zaterdag\"],\r\n\t\tday_short: [\"Zo\", \"Ma\", \"Di\", \"Wo\", \"Do\", \"Vr\", \"Za\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nieuwe taak\",\r\n\t\ticon_save: \"Opslaan\",\r\n\t\ticon_cancel: \"Annuleren\",\r\n\t\ticon_details: \"Details\",\r\n\t\ticon_edit: \"Bewerken\",\r\n\t\ticon_delete: \"Verwijderen\",\r\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"Item zal permanent worden verwijderd, doorgaan?\",\r\n\t\tsection_description: \"Beschrijving\",\r\n\t\tsection_time: \"Tijd periode\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Taak omschrijving\",\r\n\t\tcolumn_start_date: \"Startdatum\",\r\n\t\tcolumn_duration: \"Duur\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Koppeling\",\r\n\t\tconfirm_link_deleting: \"zal worden verwijderd\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (eind)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"minuten\",\r\n\t\thours: \"uren\",\r\n\t\tdays: \"dagen\",\r\n\t\tweeks: \"weken\",\r\n\t\tmonths: \"maanden\",\r\n\t\tyears: \"jaren\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Annuleren\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Januar\", \"Februar\", \"Mars\", \"April\", \"Mai\", \"Juni\", \"Juli\", \"August\", \"September\", \"Oktober\", \"November\", \"Desember\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Mai\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Des\"],\r\n\t\tday_full: [\"Sndag\", \"Mandag\", \"Tirsdag\", \"Onsdag\", \"Torsdag\", \"Fredag\", \"Lrdag\"],\r\n\t\tday_short: [\"Sn\", \"Man\", \"Tir\", \"Ons\", \"Tor\", \"Fre\", \"Lr\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Ny oppgave\",\r\n\t\ticon_save: \"Lagre\",\r\n\t\ticon_cancel: \"Avbryt\",\r\n\t\ticon_details: \"Detaljer\",\r\n\t\ticon_edit: \"Endre\",\r\n\t\ticon_delete: \"Slett\",\r\n\t\tconfirm_closing: \"Endringer blir ikke lagret, er du sikker?\", // Endringer blir ikke lagret, er du sikker?\r\n\t\tconfirm_deleting: \"Oppfringen vil bli slettet, er du sikker?\",\r\n\t\tsection_description: \"Beskrivelse\",\r\n\t\tsection_time: \"Tidsperiode\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Avbryt\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Stycze\", \"Luty\", \"Marzec\", \"Kwiecie\", \"Maj\", \"Czerwiec\", \"Lipiec\", \"Sierpie\", \"Wrzesie\", \"Padziernik\", \"Listopad\", \"Grudzie\"],\r\n\t\tmonth_short: [\"Sty\", \"Lut\", \"Mar\", \"Kwi\", \"Maj\", \"Cze\", \"Lip\", \"Sie\", \"Wrz\", \"Pa\", \"Lis\", \"Gru\"],\r\n\t\tday_full: [\"Niedziela\", \"Poniedziaek\", \"Wtorek\", \"roda\", \"Czwartek\", \"Pitek\", \"Sobota\"],\r\n\t\tday_short: [\"Nie\", \"Pon\", \"Wto\", \"ro\", \"Czw\", \"Pi\", \"Sob\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nowe zadanie\",\r\n\t\ticon_save: \"Zapisz\",\r\n\t\ticon_cancel: \"Anuluj\",\r\n\t\ticon_details: \"Szczegy\",\r\n\t\ticon_edit: \"Edytuj\",\r\n\t\ticon_delete: \"Usu\",\r\n\t\tconfirm_closing: \"\", // Zmiany zostan usunite, jeste pewien?\r\n\t\tconfirm_deleting: \"Zdarzenie zostanie usunite na zawsze, kontynuowa?\",\r\n\t\tsection_description: \"Opis\",\r\n\t\tsection_time: \"Okres czasu\",\r\n\t\tsection_type: \"Typ\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Nazwa zadania\",\r\n\t\tcolumn_start_date: \"Pocztek\",\r\n\t\tcolumn_duration: \"Czas trwania\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"zostanie usunity\",\r\n\t\tlink_start: \" (pocztek)\",\r\n\t\tlink_end: \" (koniec)\",\r\n\r\n\t\ttype_task: \"Zadanie\",\r\n\t\ttype_project: \"Projekt\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minuty\",\r\n\t\thours: \"Godziny\",\r\n\t\tdays: \"Dni\",\r\n\t\tweeks: \"Tydzie\",\r\n\t\tmonths: \"Miesice\",\r\n\t\tyears: \"Lata\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Anuluj\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n\r\n TRANSLATION BY MATTHEUS PIROVANI RORIZ GONALVES\r\n\r\n mattheusroriz@hotmail.com / mattheus.pirovani@gmail.com /\r\n\r\n www.atrixian.com.br\r\n\r\n\r\n Updated by Jorge Albernaz Martins\r\n\r\n jorgefox@hotmail.com\r\n\r\n www.redfox.inf.br\r\n\r\n JorgeFox\r\n\r\n*/\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Janeiro\", \"Fevereiro\", \"Maro\", \"Abril\", \"Maio\", \"Junho\", \"Julho\", \"Agosto\", \"Setembro\", \"Outubro\", \"Novembro\", \"Dezembro\"],\r\n\t\tmonth_short: [\"Jan\", \"Fev\", \"Mar\", \"Abr\", \"Mai\", \"Jun\", \"Jul\", \"Ago\", \"Set\", \"Out\", \"Nov\", \"Dez\"],\r\n\t\tday_full: [\"Domingo\", \"Segunda\", \"Tera\", \"Quarta\", \"Quinta\", \"Sexta\", \"Sbado\"],\r\n\t\tday_short: [\"Dom\", \"Seg\", \"Ter\", \"Qua\", \"Qui\", \"Sex\", \"Sab\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nova tarefa\",\r\n\t\ticon_save: \"Salvar\",\r\n\t\ticon_cancel: \"Cancelar\",\r\n\t\ticon_details: \"Detalhes\",\r\n\t\ticon_edit: \"Editar\",\r\n\t\ticon_delete: \"Excluir\",\r\n\t\tconfirm_closing: \"\",// Suas alteraes sero perdidas, confirme?\r\n\t\tconfirm_deleting: \"As tarefas sero excluidas permanentemente, confirme?\",\r\n\t\tsection_description: \"Descrio\",\r\n\t\tsection_time: \"Perodo\",\r\n\t\tsection_type: \"Tipo\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"EAP\",\r\n\t\tcolumn_text: \"Nome tarefa\",\r\n\t\tcolumn_start_date: \"Data incio\",\r\n\t\tcolumn_duration: \"Durao\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"Ser excludo!\",\r\n\t\tlink_start: \" (incio)\",\r\n\t\tlink_end: \" (fim)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Projeto\",\r\n\t\ttype_milestone: \"Marco\",\r\n\r\n\r\n\t\tminutes: \"Minutos\",\r\n\t\thours: \"Horas\",\r\n\t\tdays: \"Dias\",\r\n\t\tweeks: \"Semanas\",\r\n\t\tmonths: \"Meses\",\r\n\t\tyears: \"Anos\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Cancelar\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Restrio\",\r\n\t\tconstraint_type: \"Tipo Restrio\",\r\n\t\tconstraint_date: \"Data restrio\",\r\n\t\tasap: \"Mais breve possvel\",\r\n\t\talap: \"Mais tarde possvel\",\r\n\t\tsnet: \"No comear antes de\",\r\n\t\tsnlt: \"No comear depois de\",\r\n\t\tfnet: \"No terminar antes de\",\r\n\t\tfnlt: \"No terminar depois de\",\r\n\t\tmso: \"Precisa comear em\",\r\n\t\tmfo: \"Precisa terminar em\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n\tTraducere de Ovidiu Lixandru: http://www.madball.ro\r\n */\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Ianuarie\", \"Februarie\", \"Martie\", \"Aprilie\", \"Mai\", \"Iunie\", \"Iulie\", \"August\", \"Septembrie\", \"Octombrie\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Ian\", \"Feb\", \"Mar\", \"Apr\", \"Mai\", \"Iun\", \"Iul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Duminica\", \"Luni\", \"Marti\", \"Miercuri\", \"Joi\", \"Vineri\", \"Sambata\"],\r\n\t\tday_short: [\"Du\", \"Lu\", \"Ma\", \"Mi\", \"Jo\", \"Vi\", \"Sa\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Sarcina noua\",\r\n\t\ticon_save: \"Salveaza\",\r\n\t\ticon_cancel: \"Anuleaza\",\r\n\t\ticon_details: \"Detalii\",\r\n\t\ticon_edit: \"Editeaza\",\r\n\t\ticon_delete: \"Sterge\",\r\n\t\tconfirm_closing: \"Schimbarile nu vor fi salvate, esti sigur?\",// Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"Evenimentul va fi sters permanent, esti sigur?\",\r\n\t\tsection_description: \"Descriere\",\r\n\t\tsection_time: \"Interval\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Anuleaza\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"\", \"\", \"\", \"\", \"Ma\", \"\", \"\", \"\", \"\", \"O\", \"\", \"\"],\r\n\t\tmonth_short: [\"\", \"\", \"Ma\", \"A\", \"Ma\", \"\", \"\", \"A\", \"\", \"\", \"\", \"\"],\r\n\t\tday_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \" \",\r\n\t\ticon_save: \"\",\r\n\t\ticon_cancel: \"\",\r\n\t\ticon_details: \"\",\r\n\t\ticon_edit: \"\",\r\n\t\ticon_delete: \"\",\r\n\t\tconfirm_closing: \"\", //    , ?\r\n\t\tconfirm_deleting: \"   , ?\",\r\n\t\tsection_description: \"\",\r\n\t\tsection_time: \" \",\r\n\t\tsection_type: \"\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"\",\r\n\t\tcolumn_text: \"\",\r\n\t\tcolumn_start_date: \"\",\r\n\t\tcolumn_duration: \"\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"\",\r\n\t\tconfirm_link_deleting: \" \",\r\n\t\tlink_start: \" ()\",\r\n\t\tlink_end: \" ()\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"\",\r\n\t\thours: \"\",\r\n\t\tdays: \"\",\r\n\t\tweeks: \"\",\r\n\t\tmonths: \"\",\r\n\t\tyears: \"\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Januar\", \"Februar\", \"Marec\", \"April\", \"Maj\", \"Junij\", \"Julij\", \"Avgust\", \"September\", \"Oktober\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Maj\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Nedelja\", \"Ponedeljek\", \"Torek\", \"Sreda\", \"etrtek\", \"Petek\", \"Sobota\"],\r\n\t\tday_short: [\"Ned\", \"Pon\", \"Tor\", \"Sre\", \"et\", \"Pet\", \"Sob\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nova naloga\",\r\n\t\ticon_save: \"Shrani\",\r\n\t\ticon_cancel: \"Preklii\",\r\n\t\ticon_details: \"Podrobnosti\",\r\n\t\ticon_edit: \"Uredi\",\r\n\t\ticon_delete: \"Izbrii\",\r\n\t\tconfirm_closing: \"\", // Spremembe ne bodo shranjene. elite nadaljevati ?\r\n\t\tconfirm_deleting: \"Dogodek bo izbrisan. elite nadaljevati?\",\r\n\t\tsection_description: \"Opis\",\r\n\t\tsection_time: \"asovni okvir\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Preklii\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Janur\", \"Februr\", \"Marec\", \"Aprl\", \"Mj\", \"Jn\", \"Jl\", \"August\", \"September\", \"Oktber\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Mj\", \"Jn\", \"Jl\", \"Aug\", \"Sept\", \"Okt\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Nedea\", \"Pondelok\", \"Utorok\", \"Streda\", \"tvrtok\", \"Piatok\", \"Sobota\"],\r\n\t\tday_short: [\"Ne\", \"Po\", \"Ut\", \"St\", \"t\", \"Pi\", \"So\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nov loha\",\r\n\t\ticon_save: \"Uloi\",\r\n\t\ticon_cancel: \"Sp\",\r\n\t\ticon_details: \"Detail\",\r\n\t\ticon_edit: \"Edituj\",\r\n\t\ticon_delete: \"Zmaza\",\r\n\t\tconfirm_closing: \"Vae zmeny nebud uloen. Skutone?\", // Vae zmny budou ztraceny, opravdu ?\r\n\t\tconfirm_deleting: \"Udalos bude natrvalo vymazan. Skutone?\",\r\n\t\tsection_description: \"Poznmky\",\r\n\t\tsection_time: \"Doba platnosti\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Sp\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n\tTranslation by Peter Eriksson\r\n */\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Januari\", \"Februari\", \"Mars\", \"April\", \"Maj\", \"Juni\", \"Juli\", \"Augusti\", \"September\", \"Oktober\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Maj\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Sndag\", \"Mndag\", \"Tisdag\", \"Onsdag\", \"Torsdag\", \"Fredag\", \"Lrdag\"],\r\n\t\tday_short: [\"Sn\", \"Mn\", \"Tis\", \"Ons\", \"Tor\", \"Fre\", \"Lr\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Ny uppgift\",\r\n\t\ticon_save: \"Spara\",\r\n\t\ticon_cancel: \"Avbryt\",\r\n\t\ticon_details: \"Detajer\",\r\n\t\ticon_edit: \"ndra\",\r\n\t\ticon_delete: \"Ta bort\",\r\n\t\tconfirm_closing: \"\",\r\n\t\tconfirm_deleting: \"r du sker p att du vill ta bort hndelsen permanent?\",\r\n\t\tsection_description: \"Beskrivning\",\r\n\t\tsection_time: \"Tid\",\r\n\t\tsection_type: \"Typ\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Uppgiftsnamn\",\r\n\t\tcolumn_start_date: \"Starttid\",\r\n\t\tcolumn_duration: \"Varaktighet\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\r\n\t\tlink: \"Lnk\",\r\n\t\tconfirm_link_deleting: \"kommer tas bort\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (slut)\",\r\n\t\ttype_task: \"Uppgift\",\r\n\t\ttype_project: \"Projekt\",\r\n\t\ttype_milestone: \"Milstolpe\",\r\n\r\n\t\tminutes: \"Minuter\",\r\n\t\thours: \"Timmar\",\r\n\t\tdays: \"Dagar\",\r\n\t\tweeks: \"Veckor\",\r\n\t\tmonths: \"Mnader\",\r\n\t\tyears: \"r\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Avbryt\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n * updated by @levkar at https://github.com/DHTMLX/gantt/pull/10\r\n */\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Ocak\", \"ubat\", \"Mart\", \"Nisan\", \"Mays\", \"Haziran\", \"Temmuz\", \"Austos\", \"Eyll\", \"Ekim\", \"Kasm\", \"Aralk\"],\r\n\t\tmonth_short: [\"Oca\", \"ub\", \"Mar\", \"Nis\", \"May\", \"Haz\", \"Tem\", \"Au\", \"Eyl\", \"Eki\", \"Kas\", \"Ara\"],\r\n\t\tday_full: [\"Pazar\", \"Pazartesi\", \"Sal\", \"aramba\", \"Perembe\", \"Cuma\", \"Cumartesi\"],\r\n\t\tday_short: [\"Paz\", \"Pzt\", \"Sal\", \"ar\", \"Per\", \"Cum\", \"Cmt\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Yeni grev\",\r\n\t\ticon_save: \"Kaydet\",\r\n\t\ticon_cancel: \"ptal\",\r\n\t\ticon_details: \"Detaylar\",\r\n\t\ticon_edit: \"Dzenle\",\r\n\t\ticon_delete: \"Sil\",\r\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"Grev silinecek, emin misiniz?\",\r\n\t\tsection_description: \"Aklama\",\r\n\t\tsection_time: \"Zaman Aral\",\r\n\t\tsection_type: \"Tip\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Grev Ad\",\r\n\t\tcolumn_start_date: \"Balang\",\r\n\t\tcolumn_duration: \"Sre\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Balant\",\r\n\t\tconfirm_link_deleting: \"silinecek\",\r\n\t\tlink_start: \" (balang)\",\r\n\t\tlink_end: \" (biti)\",\r\n\r\n\t\ttype_task: \"Grev\",\r\n\t\ttype_project: \"Proje\",\r\n\t\ttype_milestone: \"Kilometreta\",\r\n\r\n\r\n\t\tminutes: \"Dakika\",\r\n\t\thours: \"Saat\",\r\n\t\tdays: \"Gn\",\r\n\t\tweeks: \"Hafta\",\r\n\t\tmonths: \"Ay\",\r\n\t\tyears: \"Yl\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"ptal\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tmonth_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_full: [\"\", \"\", \"\", \"\", \"\", \"'\", \"\"],\r\n\t\tday_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \" \",\r\n\t\ticon_save: \"\",\r\n\t\ticon_cancel: \"\",\r\n\t\ticon_details: \"\",\r\n\t\ticon_edit: \"\",\r\n\t\ticon_delete: \"\",\r\n\t\tconfirm_closing: \"\", //   .   ?\r\n\t\tconfirm_deleting: \"  .  ?\",\r\n\t\tsection_description: \"\",\r\n\t\tsection_time: \" \",\r\n\t\tsection_type: \"\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","import * as utils from \"../utils/utils\";\r\nimport constants from \"../constants\";\r\nimport ExtensionManager from \"../ext/extension_manager\";\r\n\r\nimport services from \"../core/common/services\";\r\nimport config from \"../core/common/config\";\r\nimport ajax from \"../core/common/ajax\";\r\nimport date from \"../core/common/date\";\r\nimport {remoteEvents} from \"../core/remote/remote_events\";\r\n\r\nimport DnD from \"../core/common/dnd\";\r\nimport templates from \"../core/common/templates\";\r\nimport eventable from \"../utils/eventable\";\r\n\r\nimport StateService from \"../core/common/state\";\r\n\r\nimport Promise from \"../utils/promise\";\r\nimport env from \"../utils/env\";\r\nimport datastoreHooks from \"../core/datastore/datastore_hooks\";\r\nimport DataProcessor from \"../core/dataprocessor\";\r\n\r\nimport plugins from \"../core/plugins\";\r\n\r\nimport grid_column_api from \"../core/grid_column_api\";\r\nimport tasks from \"../core/tasks\";\r\nimport parsing from \"../core/loading/parsing\";\r\nimport work_time from \"../core/worktime/work_time\";\r\nimport data from \"../core/data\";\r\n\r\nimport void_script_second from \"../publish_helpers/void_script_second\";\r\n\r\nimport data_task_types from \"../core/data_task_types\";\r\nimport cached_functions from \"../core/cached_functions\";\r\n\r\nimport gantt_core from \"../core/gantt_core\";\r\nimport destructor from \"../core/destructor\";\r\nimport void_script_third from \"../publish_helpers/void_script_third\";\r\n\r\nimport i18nFactory from \"../locale\";\r\n\r\nfunction DHXGantt(){\r\n\tthis.constants = constants;\r\n\tthis.version = VERSION;\r\n\tthis.license = LICENSE;\r\n\tthis.templates = {};\r\n\tthis.ext = {};\r\n\tthis.keys = {\r\n\t\tedit_save: this.constants.KEY_CODES.ENTER,\r\n\t\tedit_cancel: this.constants.KEY_CODES.ESC\r\n\t};\r\n}\r\n\r\nexport default function(supportedExtensions) {\r\n\t// use a named constructor to make gantt instance discoverable in heap snapshots\r\n\tvar gantt = new DHXGantt();\r\n\r\n\tvar extensionManager = new ExtensionManager(supportedExtensions);\r\n\tvar activePlugins = {};\r\n\tgantt.plugins = function(config){\r\n\t\tfor(var i in config){\r\n\t\t\tif(config[i] && !activePlugins[i]){\r\n\t\t\t\tvar plugin = extensionManager.getExtension(i);\r\n\t\t\t\tif(plugin){\r\n\t\t\t\t\tplugin(gantt);\r\n\t\t\t\t\tactivePlugins[i] = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn activePlugins;\r\n\t};\r\n\r\n\tgantt.$services = services();\r\n\tgantt.config = config();\r\n\tgantt.ajax =  ajax(gantt);\r\n\tgantt.date = date(gantt);\r\n\tgantt.RemoteEvents = remoteEvents;\r\n\r\n\tvar dnd = DnD(gantt);\r\n\tgantt.$services.setService(\"dnd\", function(){return dnd;});\r\n\r\n\tvar templatesLoader = templates(gantt);\r\n\tgantt.$services.setService(\"templateLoader\", function () {\r\n\t\treturn templatesLoader;\r\n\t});\r\n\r\n\teventable(gantt);\r\n\r\n\t\r\n\tvar stateService = new StateService();\r\n\r\n\tstateService.registerProvider(\"global\", function () {\r\n\t\tvar res = {\r\n\t\t\tmin_date: gantt._min_date,\r\n\t\t\tmax_date: gantt._max_date,\r\n\t\t\tselected_task: null\r\n\t\t};\r\n\r\n\t\t// do not throw error if getState called from non-initialized gantt\r\n\t\tif(gantt.$data && gantt.$data.tasksStore){\r\n\t\t\tres.selected_task = gantt.$data.tasksStore.getSelectedId();\r\n\t\t}\r\n\t\treturn res;\r\n\t});\r\n\tgantt.getState = stateService.getState;\r\n\tgantt.$services.setService(\"state\", function () {\r\n\t\treturn stateService;\r\n\t});\r\n\r\n\tutils.mixin(gantt, utils);\r\n\r\n\tgantt.Promise = Promise;\r\n\tgantt.env = env;\r\n\r\n\tdatastoreHooks(gantt);\r\n\r\n\tgantt.dataProcessor = DataProcessor.DEPRECATED_api;\r\n\tgantt.createDataProcessor = DataProcessor.createDataProcessor;\r\n\r\n\tplugins(gantt);\r\n\r\n\tgrid_column_api(gantt);\r\n\ttasks(gantt);\r\n\tparsing(gantt);\r\n\twork_time(gantt);\r\n\tdata(gantt);\r\n\r\n\tvoid_script_second(gantt);\r\n\r\n\tdata_task_types(gantt);\r\n\tcached_functions(gantt);\r\n\r\n\tgantt_core(gantt);\r\n\tdestructor(gantt);\r\n\tvoid_script_third(gantt);\r\n\r\n\tvar i18n = i18nFactory();\r\n\tgantt.i18n = {\r\n\t\taddLocale: i18n.addLocale,\r\n\t\tsetLocale: function(locale){\r\n\t\t\tif(typeof locale === \"string\"){\r\n\t\t\t\tvar localeObject = i18n.getLocale(locale);\r\n\t\t\t\tif(!localeObject){\r\n\t\t\t\t\tlocaleObject = i18n.getLocale(\"en\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgantt.locale = localeObject;\r\n\t\t\t}else if(locale){\r\n\t\t\t\tif(!gantt.locale){\r\n\t\t\t\t\tgantt.locale = locale;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tfor(var i in locale){\r\n\t\t\t\t\t\tif(locale[i] && typeof locale[i] === \"object\"){\r\n\t\t\t\t\t\t\tif(!gantt.locale[i]){\r\n\t\t\t\t\t\t\t\tgantt.locale[i] = {};\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tgantt.mixin(gantt.locale[i], locale[i], true);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tgantt.locale[i] = locale[i];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst labels = gantt.locale.labels;\r\n\t\t\tlabels.gantt_save_btn = labels.gantt_save_btn || labels.icon_save;\r\n\t\t\tlabels.gantt_cancel_btn = labels.gantt_cancel_btn || labels.icon_cancel;\r\n\t\t\tlabels.gantt_delete_btn = labels.gantt_delete_btn || labels.icon_delete;\r\n\t\t},\r\n\t\tgetLocale: i18n.getLocale\r\n\t};\r\n\tgantt.i18n.setLocale(\"en\");\r\n\treturn gantt;\r\n};","export default function(){\r\n\tvar services = {};\r\n\tfunction register (name, getter){\r\n\t\tservices[name] = getter;\r\n\t}\r\n\r\n\tfunction getService(name){\r\n\t\tif(!services[name]){\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn services[name]();\r\n\t}\r\n\r\n\tfunction dropService(name) {\r\n\t\tif (services[name]) {\r\n\t\t\tdelete services[name];\r\n\t\t}\r\n\t}\r\n\r\n\tvar servicesEnum = {};\r\n\r\n\treturn {\r\n\t\tservices: servicesEnum,\r\n\t\tsetService: register,\r\n\t\tgetService: getService,\r\n\t\tdropService: dropService,\r\n\t\tdestructor: function(){\r\n\t\t\tfor(var i in services){\r\n\t\t\t\tif(services[i]){\r\n\t\t\t\t\tvar service = services[i];\r\n\t\t\t\t\tif(service && service.destructor){\r\n\t\t\t\t\t\tservice.destructor();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tservices = null;\r\n\t\t}\r\n\t};\r\n};\r\n","type DurationUnits = \"minute\" | \"hour\" | \"day\" | \"week\" | \"month\" | \"year\";\r\ntype Align = \"left\" | \"center\" | \"right\";\r\ntype SectionType = \"textarea\"\r\n\t\t\t\t\t| \"time\"\r\n\t\t\t\t\t| \"duration\"\r\n\t\t\t\t\t| \"select\"\r\n\t\t\t\t\t| \"typeselect\"\r\n\t\t\t\t\t| \"parent\"\r\n\t\t\t\t\t| \"template\"\r\n\t\t\t\t\t| \"checkbox\"\r\n\t\t\t\t\t| \"radio\"\r\n\t\t\t\t\t| \"resources\"\r\n\t\t\t\t\t| \"constraint\";\r\n\r\ntype LightboxSection = Array<ILightboxSection\r\n\t| ILightboxTimeAndDurationSection\r\n\t| ILightboxInputControl\r\n\t| ILightboxSelectControl\r\n\t| ILightboxParentControl\r\n\t| ILightboxTypeselectControl>;\r\n\r\ntype LayoutView = \"grid\"\r\n\t| \"timeline\"\r\n\t| \"resizer\"\r\n\t| \"scrollbar\"\r\n\t| \"resourceGrid\"\r\n\t| \"resourceTimeline\";\r\n\r\ninterface IColumnItem {\r\n\tname: string;\r\n\tlabel?: string;\r\n\ttree?: boolean;\r\n\talign?: Align;\r\n\thide?: boolean;\r\n\tmax_width?: number;\r\n\tmin_width?: number;\r\n\tresize?: boolean;\r\n\ttemplate?: (obj: any) => string;\r\n\twidth?: number | \"*\";\r\n}\r\n\r\nexport type TModifierKeys = \"metaKey\" | \"ctrlKey\" | \"altKey\" | \"shiftKey\" | false | undefined;\r\n\r\nexport interface IScale {\r\n\tcss?: () => string;\r\n\tdate?: string;\r\n\tstep: number;\r\n\ttemplate?: (date: Date) => string;\r\n\tunit: DurationUnits;\r\n}\r\n\r\ninterface ILightboxSection {\r\n\tname: string;\r\n\tmap_to: string;\r\n\ttype: SectionType;\r\n\theight?: number;\r\n\tfocus?: boolean;\r\n}\r\n\r\ninterface ILightboxTimeAndDurationSection extends ILightboxSection {\r\n\treadonly: boolean;\r\n\tyear_range: number[] | number;\r\n\tsingle_date: boolean;\r\n\ttime_format: string;\r\n}\r\n\r\ninterface ILightboxInputControl extends ILightboxSection {\r\n\tdefault_value?: any;\r\n\toptions?: Array<{key: string, label: string}>;\r\n}\r\n\r\ninterface ILightboxSelectControl extends ILightboxInputControl {\r\n\tonchange: () => boolean | undefined;\r\n}\r\n\r\ninterface ILightboxParentControl extends ILightboxSection {\r\n\tallow_root: boolean;\r\n\troot_label: string;\r\n\tsort?: (a: any, b: any) => -1 | 0 | 1;\r\n\tfilter?: (task: string | number | object) => boolean;\r\n\ttemplate?: (start: Date, end: Date, ev: object) => string;\r\n}\r\n\r\ninterface ILightboxTypeselectControl extends ILightboxSection {\r\n\tfilter?: (typeName: string) => boolean;\r\n}\r\n\r\n\r\ninterface ILayoutScrollbar {\r\n\tview: \"scrollbar\";\r\n\tscroll?: \"x\" | \"y\";\r\n\tid: string;\r\n\theight?: number;\r\n\twidth?: number;\r\n}\r\n\r\ninterface ILayoutView {\r\n\tview: LayoutView;\r\n\tid?: string;\r\n\tscrollX?: string;\r\n\tscrollY?: string;\r\n\tconfig?: object;\r\n}\r\n\r\ninterface ILayoutGrid extends ILayoutView {\r\n\tview: \"grid\";\r\n\tbind?: string;\r\n}\r\n\r\ninterface ILayoutTimeline extends ILayoutView {\r\n\tview: \"timeline\";\r\n\tbindLinks?: string;\r\n\tlayers?: any[];\r\n}\r\n\r\ninterface ILayoutResizer {\r\n\tview?: undefined;\r\n\tresizer: boolean;\r\n\twidth: number;\r\n}\r\n\r\ninterface ILayoutResourceGrid extends ILayoutView {\r\n\tview: \"resourceGrid\";\r\n\twidth: number;\r\n\tgroup: \"string\";\r\n}\r\n\r\ninterface ILayoutResourceTimeline extends ILayoutView {\r\n\tview: \"resourceTimeline\";\r\n\twidth: number;\r\n\tgroup: \"string\";\r\n}\r\n\r\ninterface ILayoutHtml {\r\n\thtml: string;\r\n\tcss: string;\r\n\twidth: number;\r\n}\r\n\r\ntype LayoutRow = ILayoutGrid\r\n\t| ILayoutTimeline\r\n\t| ILayoutResizer\r\n\t| ILayoutResourceGrid\r\n\t| ILayoutResourceTimeline\r\n\t| ILayoutHtml\r\n\t| ILayoutScrollbar\r\n\t| { cols: LayoutCol[] };\r\n\r\ntype LayoutCol = ILayoutGrid\r\n\t| ILayoutTimeline\r\n\t| ILayoutResizer\r\n\t| ILayoutResourceGrid\r\n\t| ILayoutResourceTimeline\r\n\t| ILayoutHtml\r\n\t| ILayoutScrollbar\r\n\t| { rows: LayoutRow[] };\r\n\r\ninterface ILayout {\r\n\tcss: string;\r\n\trows?: LayoutRow[];\r\n\tcols?: LayoutCol[];\r\n}\r\n\r\ntype TCsp = boolean | \"auto\";\r\n\r\ninterface IResourceConfig {\r\n\tdataprocessor_assignments?: boolean;\r\n\tdataprocessor_resources?: boolean;\r\n\teditable_resource_diagram?: boolean;\r\n\tresource_store?: {\r\n\t\ttype?: \"treeDataStore\"|\"dataStore\"|string;\r\n\t\tfetchTasks?: boolean;\r\n\t\tinitItem?: (item: any) => any;\r\n\t};\r\n\tlightbox_resources?: (resources: any[]) => any[];\r\n\r\n}\r\n\r\ninterface IGanttConfig {\r\n\tlayout: ILayout;\r\n\tlinks: {\r\n\t\tfinish_to_start: \"0\";\r\n\t\tstart_to_start: \"1\";\r\n\t\tfinish_to_finish: \"2\";\r\n\t\tstart_to_finish: \"3\";\r\n\t};\r\n\ttypes: {\r\n\t\ttask: string;\r\n\t\tproject: string;\r\n\t\tmilestone: string;\r\n\t};\r\n\tauto_types: boolean;\r\n\tduration_unit: DurationUnits;\r\n\twork_time: boolean;\r\n\tcorrect_work_time: boolean;\r\n\tdeadlines: boolean;\r\n\tskip_off_time: boolean;\r\n\tcascade_delete: boolean;\r\n\tautosize: boolean | string;\r\n\tautoscroll: boolean;\r\n\tshow_links: boolean;\r\n\tshow_task_cells: boolean;\r\n\tautosize_min_width: number;\r\n\tautoscroll_speed: number;\r\n\tdeepcopy_on_parse: boolean;\r\n\tstatic_background: boolean;\r\n\tstatic_background_cells: boolean;\r\n\tbranch_loading: boolean;\r\n\tbranch_loading_property: string;\r\n\tshow_loading: boolean;\r\n\tshow_chart: boolean;\r\n\tshow_grid: boolean;\r\n\tmin_duration: number;\r\n\tdate_format: string; // use instead xml_date\r\n\txml_date?: string; // deprecated\r\n\tstart_on_monday: boolean;\r\n\tserver_utc: boolean;\r\n\tshow_progress: boolean;\r\n\tfit_tasks: boolean;\r\n\tselect_task: boolean;\r\n\tscroll_on_click: boolean;\r\n\tsmart_rendering: boolean;\r\n\tpreserve_scroll: boolean;\r\n\treadonly: boolean;\r\n\tcontainer_resize_timeout: number;\r\n\r\n\t/*grid */\r\n\tdate_grid: string;\r\n\r\n\tdrag_links: boolean;\r\n\tdrag_progress: boolean;\r\n\tdrag_resize: boolean;\r\n\tdrag_project: boolean;\r\n\tdrag_move: boolean;\r\n\tdrag_mode: {\r\n\t\tresize: \"resize\",\r\n\t\tprogress: \"progress\",\r\n\t\tmove: \"move\",\r\n\t\tignore: \"ignore\"\r\n\t};\r\n\tround_dnd_dates: boolean;\r\n\tlink_wrapper_width: number;\r\n\troot_id: string | number;\r\n\r\n\tlink_arrow_size:number;\r\n\r\n\tautofit: boolean;\r\n\tcolumns: IColumnItem[];\r\n\r\n\t/* scale*/\r\n\tscales: IScale[];\r\n\r\n\tscale_offset_minimal: boolean;\r\n\r\n\tinherit_scale_class: boolean;\r\n\r\n\r\n\ttime_step: number;\r\n\tduration_step: number;\r\n\r\n\r\n\ttask_date: string;\r\n\ttime_picker: string;\r\n\ttask_attribute: string;\r\n\tlink_attribute: string;\r\n\tlayer_attribute: string;\r\n\tbuttons_left: string[];\r\n\t_migrate_buttons: {\r\n\t\tdhx_save_btn: \"gantt_save_btn\",\r\n\t\tdhx_cancel_btn: \"gantt_cancel_btn\",\r\n\t\tdhx_delete_btn: \"gantt_delete_btn\"\r\n\t};\r\n\r\n\tbuttons_right: string[];\r\n\r\n\r\n\tlightbox: {\r\n\t\tsections?: LightboxSection,\r\n\t\tproject_sections?: LightboxSection,\r\n\t\tmilestone_sections?: LightboxSection\r\n\t};\r\n\tdrag_lightbox: boolean;\r\n\tsort: boolean;\r\n\tdetails_on_create: boolean;\r\n\tdetails_on_dblclick: boolean;\r\n\tinitial_scroll: boolean;\r\n\ttask_scroll_offset: number;\r\n\r\n\torder_branch: boolean;\r\n\torder_branch_free: boolean;\r\n\r\n\t// task_height is deprecated, use 'bar_height` instead\r\n\ttask_height: number | \"full\" | undefined;\r\n\tbar_height: number | \"full\";\r\n\tmin_column_width: number;\r\n\tbar_height_padding: number,\r\n\trow_height: number,\r\n\r\n\t// min width for grid column (when resizing)\r\n\tmin_grid_column_width: number;\r\n\t// name of the attribute with column index for resize element\r\n\tgrid_resizer_column_attribute: string;\r\n\t// name of the attribute with column index for resize element\r\n\t// grid_resizer_attribute: string; // usage of this parameter is not found\r\n\r\n\t// grid width can be increased after the column has been resized\r\n\tkeep_grid_width: boolean;\r\n\r\n\t// grid width can be adjusted\r\n\tgrid_resize: boolean;\r\n\tgrid_elastic_columns: boolean;\r\n\tshow_tasks_outside_timescale: boolean;\r\n\tshow_unscheduled: boolean;\r\n\treadonly_property: string;\r\n\teditable_property: string;\r\n\tcalendar_property: string;\r\n\tresource_calendars: object;\r\n\tdynamic_resource_calendars: boolean;\r\n\tinherit_calendar: boolean;\r\n\ttype_renderers: object;\r\n\r\n\tresize_rows: boolean;\r\n\t// name of the attribute with row index for resize element\r\n\ttask_grid_row_resizer_attribute: string;\r\n\t// min height for row (when resizing)\r\n\tmin_task_grid_row_height: number;\r\n\r\n\topen_tree_initially: boolean;\r\n\toptimize_render: boolean;\r\n\tprevent_default_scroll: boolean;\r\n\tshow_errors: boolean;\r\n\twai_aria_attributes: boolean;\r\n\tsmart_scales: boolean;\r\n\trtl: boolean;\r\n\tplaceholder_task: boolean | object;\r\n\thorizontal_scroll_key: TModifierKeys;\r\n\tdrag_timeline: {\r\n\t\tuseKey: TModifierKeys;\r\n\t\tignore: string;\r\n\t\trender?: boolean;\r\n\t};\r\n\tdrag_multiple: boolean;\r\n\tcsp: TCsp;\r\n\r\n\tresources?: IResourceConfig;\r\n\r\n\tauto_scheduling: object;\r\n}\r\n\r\nexport default () => {\r\n\tconst result: IGanttConfig = {\r\n\t\tlayout: {\r\n\t\t\tcss: \"gantt_container\",\r\n\t\t\trows: [\r\n\t\t\t\t{\r\n\t\t\t\t\tcols: [\r\n\t\t\t\t\t\t{view: \"grid\", scrollX: \"scrollHor\", scrollY: \"scrollVer\"},\r\n\t\t\t\t\t\t{resizer: true, width: 1},\r\n\t\t\t\t\t\t{view: \"timeline\", scrollX: \"scrollHor\", scrollY: \"scrollVer\"},\r\n\t\t\t\t\t\t{view: \"scrollbar\", id: \"scrollVer\"}\r\n\t\t\t\t\t]\r\n\t\t\t\t},\r\n\t\t\t\t{view: \"scrollbar\", id: \"scrollHor\", height: 20}\r\n\t\t\t]\r\n\t\t},\r\n\t\tlinks: {\r\n\t\t\tfinish_to_start: \"0\",\r\n\t\t\tstart_to_start: \"1\",\r\n\t\t\tfinish_to_finish: \"2\",\r\n\t\t\tstart_to_finish: \"3\"\r\n\t\t},\r\n\t\ttypes: {\r\n\t\t\ttask: \"task\",\r\n\t\t\tproject: \"project\",\r\n\t\t\tmilestone: \"milestone\"\r\n\t\t},\r\n\t\tauto_types: false,\r\n\t\tduration_unit: \"day\",\r\n\t\twork_time: false,\r\n\t\tcorrect_work_time: false,\r\n\t\tskip_off_time: false,\r\n\r\n\t\tcascade_delete: true,\r\n\r\n\t\tautosize: false,\r\n\t\tautosize_min_width: 0,\r\n\t\tautoscroll: true,\r\n\t\tautoscroll_speed: 30,\r\n\t\tdeepcopy_on_parse: false,\r\n\t\tshow_links: true,\r\n\t\tshow_task_cells: true,\r\n\t\t// replace backgroung of the task area with a canvas img\r\n\t\tstatic_background: false,\r\n\t\tstatic_background_cells: true,\r\n\t\tbranch_loading: false,\r\n\t\tbranch_loading_property: \"$has_child\",\r\n\t\tshow_loading: false,\r\n\t\tshow_chart: true,\r\n\t\tshow_grid: true,\r\n\t\tmin_duration: 60 * 60 * 1000,\r\n\t\tdate_format: \"%d-%m-%Y %H:%i\", // use instead xml_date\r\n\t\txml_date: undefined, // \"%d-%m-%Y %H:%i\", // deprecated\r\n\t\tstart_on_monday: true,\r\n\t\tserver_utc: false,\r\n\t\tshow_progress: true,\r\n\t\tfit_tasks: false,\r\n\t\tselect_task: true,\r\n\t\tscroll_on_click: true,\r\n\t\tsmart_rendering: true,\r\n\t\tpreserve_scroll: true,\r\n\t\treadonly: false,\r\n\t\tcontainer_resize_timeout: 20,\r\n\t\tdeadlines: true,\r\n\r\n\t\t/*grid */\r\n\t\tdate_grid: \"%Y-%m-%d\",\r\n\r\n\t\tdrag_links: true,\r\n\t\tdrag_progress: true,\r\n\t\tdrag_resize: true,\r\n\t\tdrag_project: false,\r\n\t\tdrag_move: true,\r\n\t\tdrag_mode: {\r\n\t\t\tresize: \"resize\",\r\n\t\t\tprogress: \"progress\",\r\n\t\t\tmove: \"move\",\r\n\t\t\tignore: \"ignore\"\r\n\t\t},\r\n\t\tround_dnd_dates: true,\r\n\t\tlink_wrapper_width: 20,\r\n\t\tlink_arrow_size:12,\r\n\t\troot_id: 0,\r\n\r\n\t\tautofit: false, // grid column automatic fit grid_width config\r\n\t\tcolumns: [\r\n\t\t\t{name: \"text\", tree: true, width: \"*\", resize: true},\r\n\t\t\t{name: \"start_date\", align: \"center\", resize: true},\r\n\t\t\t{name: \"duration\", align: \"center\"},\r\n\t\t\t{name: \"add\", width: 44}\r\n\t\t],\r\n\r\n\t\t/*scale*/\r\n\r\n\t\tscale_offset_minimal: true,\r\n\t\tinherit_scale_class: false,\r\n\r\n\t\tscales: [\r\n\t\t\t{\r\n\t\t\t\tunit: \"day\",\r\n\t\t\t\tstep: 1,\r\n\t\t\t\tdate: \"%d %M\"\r\n\t\t\t}\r\n\t\t],\r\n\r\n\t\ttime_step: 60,\r\n\t\tduration_step: 1,\r\n\t\ttask_date: \"%d %F %Y\",\r\n\t\ttime_picker: \"%H:%i\",\r\n\t\ttask_attribute: \"data-task-id\",\r\n\t\tlink_attribute: \"data-link-id\",\r\n\t\tlayer_attribute: \"data-layer\",\r\n\t\tbuttons_left: [\r\n\t\t\t\"gantt_save_btn\",\r\n\t\t\t\"gantt_cancel_btn\"\r\n\t\t],\r\n\t\t_migrate_buttons: {\r\n\t\t\tdhx_save_btn: \"gantt_save_btn\",\r\n\t\t\tdhx_cancel_btn: \"gantt_cancel_btn\",\r\n\t\t\tdhx_delete_btn: \"gantt_delete_btn\"\r\n\t\t},\r\n\t\tbuttons_right: [\r\n\t\t\t\"gantt_delete_btn\"\r\n\t\t],\r\n\t\tlightbox: {\r\n\t\t\tsections: [\r\n\t\t\t\t{name: \"description\", height: 70, map_to: \"text\", type: \"textarea\", focus: true},\r\n\t\t\t\t{name: \"time\", type: \"duration\", map_to: \"auto\"}\r\n\t\t\t],\r\n\t\t\tproject_sections: [\r\n\t\t\t\t{name: \"description\", height: 70, map_to: \"text\", type: \"textarea\", focus: true},\r\n\t\t\t\t{name: \"type\", type: \"typeselect\", map_to: \"type\"},\r\n\t\t\t\t{name: \"time\", type: \"duration\", readonly: true, map_to: \"auto\"}\r\n\t\t\t],\r\n\t\t\tmilestone_sections: [\r\n\t\t\t\t{name: \"description\", height: 70, map_to: \"text\", type: \"textarea\", focus: true},\r\n\t\t\t\t{name: \"type\", type: \"typeselect\", map_to: \"type\"},\r\n\t\t\t\t{name: \"time\", type: \"duration\", single_date: true, map_to: \"auto\"}\r\n\t\t\t]\r\n\t\t},\r\n\t\tdrag_lightbox: true,\r\n\t\tsort: false,\r\n\t\tdetails_on_create: true,\r\n\t\tdetails_on_dblclick: true,\r\n\t\tinitial_scroll: true,\r\n\t\ttask_scroll_offset: 100,\r\n\r\n\t\torder_branch: false,\r\n\t\torder_branch_free: false,\r\n\r\n\t\t// task height is deprecated, use 'bar_height' instead\r\n\t\ttask_height: undefined,// number px of 'full' for row height\r\n\t\tbar_height: \"full\",\r\n\t\tbar_height_padding:9,\r\n\t\tmin_column_width: 70,\r\n\r\n\t\t// min width for grid column (when resizing)\r\n\t\tmin_grid_column_width: 70,\r\n\t\t// name of the attribute with column index for resize element\r\n\t\tgrid_resizer_column_attribute: \"data-column-index\",\r\n\t\t// name of the attribute with column index for resize element\r\n\t\t// grid_resizer_attribute: \"grid_resizer\", // - usage of this parameter is not found in code\r\n\r\n\t\t// grid width can be increased after the column has been resized\r\n\t\tkeep_grid_width: false,\r\n\r\n\t\t// grid width can be adjusted\r\n\t\tgrid_resize: false,\r\n\t\tgrid_elastic_columns: false,\r\n\t\tshow_tasks_outside_timescale: false,\r\n\t\tshow_unscheduled: true,\r\n\r\n\t\tresize_rows: false,\r\n\t\t// name of the attribute with row index for resize element\r\n\t\ttask_grid_row_resizer_attribute: \"data-row-index\",\r\n\t\t// min height for row (when resizing)\r\n\t\tmin_task_grid_row_height: 30,\r\n\t\trow_height: 36,\r\n\r\n\t\t//\r\n\t\treadonly_property: \"readonly\",\r\n\t\teditable_property: \"editable\",\r\n\t\tcalendar_property: \"calendar_id\",\r\n\t\tresource_calendars: {},\r\n\t\tdynamic_resource_calendars: false,\r\n\t\tinherit_calendar: false,\r\n\t\ttype_renderers: {},\r\n\r\n\t\topen_tree_initially: false,\r\n\t\toptimize_render: true,\r\n\t\tprevent_default_scroll: false,\r\n\t\tshow_errors: true,\r\n\t\twai_aria_attributes: true,\r\n\t\tsmart_scales: true,\r\n\t\trtl:false,\r\n\t\tplaceholder_task: false,\r\n\t\thorizontal_scroll_key: \"shiftKey\",\r\n\t\tdrag_timeline: {\r\n\t\t\tuseKey: undefined,\r\n\t\t\tignore: \".gantt_task_line, .gantt_task_link\",\r\n\t\t\trender: false\r\n\t\t},\r\n\t\tdrag_multiple: true,\r\n\t\tcsp: \"auto\",\r\n\t\tauto_scheduling: {}\r\n\t};\r\n\treturn result;\r\n};\r\n","import eventable from \"../../utils/eventable\";\r\nimport * as utils from \"../../utils/utils\";\r\nimport timeout from \"../../utils/timeout\";\r\nimport global from \"../../utils/global\";\r\nimport * as domHelpers from \"../ui/utils/dom_helpers\";\r\n\r\nexport default function(gantt){\r\n\r\n\tfunction copyDomEvent(e){\r\n\t\treturn {\r\n\t\t\ttarget: e.target || e.srcElement,\r\n\t\t\tpageX: e.pageX,\r\n\t\t\tpageY: e.pageY,\r\n\t\t\tclientX: e.clientX,\r\n\t\t\tclientY: e.clientY,\r\n\t\t\tmetaKey: e.metaKey,\r\n\t\t\tshiftKey: e.shiftKey,\r\n\t\t\tctrlKey: e.ctrlKey,\r\n\t\t\taltKey: e.altKey\r\n\t\t};\r\n\t}\r\n\r\n\tfunction DnD(obj, config) {\r\n\t\tthis._obj = obj;\r\n\t\tthis._settings = config || {};\r\n\t\teventable(this);\r\n\r\n\t\tvar inputMethods = this.getInputMethods();\r\n\r\n\t\tthis._drag_start_timer = null;\r\n\t\tgantt.attachEvent(\"onGanttScroll\", utils.bind(function (left, top) {\r\n\t\t\tthis.clearDragTimer();\r\n\t\t}, this));\r\n\r\n\t\tvar lastDown = 0;\r\n\t\tvar eventParams = {passive: false};\r\n\t\tfor(var i = 0; i < inputMethods.length; i++){\r\n\t\t\t(utils.bind(function(input){\r\n\r\n\t\t\t\tgantt.event(obj, input.down, utils.bind(function (e) {\r\n\t\t\t\t\tif(!input.accessor(e)){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (typeof e.button !== 'undefined' && e.button !== 0) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(config.preventDefault && config.selector && domHelpers.closest(e.target, config.selector)){\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (gantt.config.touch && e.timeStamp && e.timeStamp - lastDown < 300) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis._settings.original_target = copyDomEvent(e);\r\n\r\n\t\t\t\t\tthis._settings.original_element_sizes = {\r\n\t\t\t\t\t\t...domHelpers.getRelativeEventPosition(e, domHelpers.getClosestSizedElement(obj)), \r\n\t\t\t\t\t\twidth: e.target.offsetWidth,\r\n\t\t\t\t\t\theight: e.target.offsetHeight\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tif (gantt.config.touch) {\r\n\t\t\t\t\t\tlet actualTarget = e.target; // for ShadowDOM (GS-2409)\r\n\t\t\t\t\t\tthis.clearDragTimer();\r\n\t\t\t\t\t\tthis._drag_start_timer = setTimeout(utils.bind(function () {\r\n\t\t\t\t\t\t\tif(gantt.getState().lightbox){\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis.dragStart(obj, e, input, actualTarget);\r\n\t\t\t\t\t\t}, this), gantt.config.touch_drag);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis.dragStart(obj, e, input);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, this), eventParams);\r\n\t\t\t\tvar eventElement = document.body;\r\n\t\t\t\tgantt.event(eventElement, input.up, utils.bind(function (e) {\r\n\t\t\t\t\tif(!input.accessor(e)){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.clearDragTimer();\r\n\t\t\t\t}, this), eventParams);\r\n\r\n\t\t\t}, this))(inputMethods[i]);\r\n\t\t}\r\n\t}\r\n\r\n\tDnD.prototype = {\r\n\t\ttraceDragEvents: function (domElement, inputMethod) {\r\n\t\t\tvar mousemove = utils.bind(function (e) {\r\n\t\t\t\treturn this.dragMove(domElement, e, inputMethod.accessor);\r\n\t\t\t}, this);\r\n\t\t\tutils.bind(function (e) {\r\n\t\t\t\treturn this.dragScroll(domElement, e);\r\n\t\t\t}, this);\r\n\r\n\t\t\tvar limited_mousemove = utils.bind(function (e) {\r\n\t\t\t\tif (this.config.started && utils.defined(this.config.updates_per_second)) {\r\n\t\t\t\t\tif (!timeout(this, this.config.updates_per_second))\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar dndActive = mousemove(e);\r\n\r\n\t\t\t\tif (dndActive) {\r\n\t\t\t\t\ttry{\r\n\t\t\t\t\t\tif (e && e.preventDefault && e.cancelable){//e.cancelable condition - because navigator.vibrate is blocked by Chrome\r\n\t\t\t\t\t\t\te.preventDefault();//Cancel default action on DND\r\n\t\t\t\t\t\t} //Cancel default action on DND\r\n\t\t\t\t\t}catch (e){\r\n\t\t\t\t\t\t// just suppress the exception, nothing needed to be done here\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//e.cancelBubble = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn dndActive;\r\n\t\t\t}, this);\r\n\t\t\tvar eventElement = domHelpers.getRootNode(gantt.$root);\r\n\t\t\tvar mousemoveContainer = this.config.mousemoveContainer || domHelpers.getRootNode(gantt.$root);\r\n\r\n\t\t\tvar eventParams = {passive: false};\r\n\t\t\tvar mouseup = utils.bind(function (e) {\r\n\t\t\t\tgantt.eventRemove(mousemoveContainer, inputMethod.move, limited_mousemove);\r\n\t\t\t\tgantt.eventRemove(eventElement, inputMethod.up, mouseup, eventParams);\r\n\t\t\t\treturn this.dragEnd(domElement);\r\n\t\t\t}, this);\r\n\r\n\t\t\tgantt.event(mousemoveContainer, inputMethod.move, limited_mousemove, eventParams);\r\n\t\t\tgantt.event(eventElement, inputMethod.up, mouseup, eventParams);\r\n\t\t},\r\n\t\tcheckPositionChange: function (pos) {\r\n\t\t\tvar diff_x = pos.x - this.config.pos.x;\r\n\t\t\tvar diff_y = pos.y - this.config.pos.y;\r\n\t\t\tvar distance = Math.sqrt(Math.pow(Math.abs(diff_x), 2) + Math.pow(Math.abs(diff_y), 2));\r\n\r\n\t\t\tif (distance > this.config.sensitivity) {\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t},\r\n\t\tinitDnDMarker: function () {\r\n\t\t\t// create dnd placeholder and put it in dom\r\n\t\t\tvar marker = this.config.marker = document.createElement(\"div\");\r\n\t\t\tmarker.className = \"gantt_drag_marker\";\r\n\t\t\t// GS-1333: don't show any message when we resize grid columns\r\n\t\t\tmarker.innerHTML = \"\";\r\n\t\t\tdocument.body.appendChild(marker);\r\n\t\t},\r\n\t\tbackupEventTarget: function (domEvent, getEvent, actualTarget) {\r\n\t\t\tif (!gantt.config.touch) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// keep original event target in DOM in order to keep dnd on touchmove event\r\n\t\t\tvar e = getEvent(domEvent);\r\n\r\n\t\t\t// GS-2409. We need the target element when Gantt is inside ShadowDOM\r\n\t\t\tlet el = e.target || e.srcElement;\r\n\t\t\tif (el.shadowRoot && actualTarget) {\r\n\t\t\t\tel = actualTarget;\r\n\t\t\t}\r\n\r\n\t\t\tvar copy = el.cloneNode(true);\r\n\t\t\t//this.config.target.target = copy;\r\n\t\t\tthis.config.original_target = copyDomEvent(e);\r\n\t\t\tthis.config.original_target.target = copy;\r\n\t\t\tthis.config.backup_element = el;\r\n\t\t\tel.parentNode.appendChild(copy);\r\n\r\n\t\t\tel.style.display = \"none\";\r\n\t\t\tconst mousemoveContainer = this.config.mousemoveContainer || gantt.$root || document.body;\r\n\t\t\tmousemoveContainer.appendChild(el);\r\n\t\t},\r\n\t\tgetInputMethods: function () {\r\n\t\t\t// bind actions to browser events\r\n\t\t\tvar inputMethods = [];\r\n\r\n\t\t\tinputMethods.push({\r\n\t\t\t\t\"move\": \"mousemove\",\r\n\t\t\t\t\"down\": \"mousedown\",\r\n\t\t\t\t\"up\": \"mouseup\",\r\n\t\t\t\t\"accessor\": function (e) {\r\n\t\t\t\t\treturn e;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (gantt.config.touch) {\r\n\t\t\t\tconst touchEventsSupported = !gantt.env.isIE || !!global.maxTouchPoints;\r\n\r\n\t\t\t\tif(touchEventsSupported){\r\n\t\t\t\t\tinputMethods.push({\r\n\t\t\t\t\t\t\"move\": \"touchmove\",\r\n\t\t\t\t\t\t\"down\": \"touchstart\",\r\n\t\t\t\t\t\t\"up\": \"touchend\",\r\n\t\t\t\t\t\t\"accessor\": function (ev) {\r\n\t\t\t\t\t\t\tif (ev.touches && ev.touches.length > 1) return null;\r\n\t\t\t\t\t\t\tif (ev.touches[0])\r\n\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\ttarget: document.elementFromPoint(ev.touches[0].clientX, ev.touches[0].clientY),\r\n\t\t\t\t\t\t\t\t\tpageX: ev.touches[0].pageX,\r\n\t\t\t\t\t\t\t\t\tpageY: ev.touches[0].pageY,\r\n\t\t\t\t\t\t\t\t\tclientX: ev.touches[0].clientX,\r\n\t\t\t\t\t\t\t\t\tclientY: ev.touches[0].clientY\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\treturn ev;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}else if(global.PointerEvent){\r\n\t\t\t\t\tinputMethods.push({\r\n\t\t\t\t\t\t\"move\": \"pointermove\",\r\n\t\t\t\t\t\t\"down\": \"pointerdown\",\r\n\t\t\t\t\t\t\"up\": \"pointerup\",\r\n\t\t\t\t\t\t\"accessor\": function (ev) {\r\n\t\t\t\t\t\t\tif (ev.pointerType == \"mouse\") return null;\r\n\t\t\t\t\t\t\treturn ev;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn inputMethods;\r\n\t\t},\r\n\t\tclearDragTimer: function () {\r\n\t\t\tif (this._drag_start_timer) {\r\n\t\t\t\tclearTimeout(this._drag_start_timer);\r\n\t\t\t\tthis._drag_start_timer = null;\r\n\t\t\t}\r\n\t\t},\r\n\t\tdragStart: function (obj, e, inputMethod, actualTarget) {\r\n\t\t\tif (this.config && this.config.started) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.config = {\r\n\t\t\t\tobj: obj,\r\n\t\t\t\tmarker: null,\r\n\t\t\t\tstarted: false,\r\n\t\t\t\tpos: this.getPosition(e),\r\n\t\t\t\tsensitivity: 4\r\n\t\t\t};\r\n\t\t\tif (this._settings)\r\n\t\t\t\tutils.mixin(this.config, this._settings, true);\r\n\r\n\r\n\t\t\tthis.traceDragEvents(obj, inputMethod);\r\n\r\n\t\t\tgantt._prevent_touch_scroll = true;\r\n\t\t\t// GS-2664. Prevent grid scroll only if we can reorder rows\r\n\t\t\tif (e.target.closest(\".gantt_row\") && !gantt.config.order_branch){\r\n\t\t\t\tgantt._prevent_touch_scroll = false;\r\n\t\t\t}\r\n\t\t\tdocument.body.classList.add(\"gantt_noselect\");\r\n\r\n\t\t\tif (gantt.config.touch) {\r\n\t\t\t\tthis.dragMove(obj, e, inputMethod.accessor, actualTarget);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tdragMove: function (obj, e, getEvent, actualTarget) {\r\n\t\t\tvar source = getEvent(e);\r\n\t\t\tif (!source) return false;\r\n\r\n\t\t\tif (!this.config.marker && !this.config.started) {\r\n\t\t\t\tvar pos = this.getPosition(source);\r\n\r\n\t\t\t\tif (gantt.config.touch || this.checkPositionChange(pos)) {\r\n\t\t\t\t\t// real drag starts here,\r\n\t\t\t\t\t// when user moves mouse at first time after onmousedown\r\n\t\t\t\t\tthis.config.started = true;\r\n\t\t\t\t\tthis.config.ignore = false;\r\n\t\t\t\t\tgantt._touch_drag = true;\r\n\t\t\t\t\tif (this.callEvent(\"onBeforeDragStart\", [obj, this.config.original_target]) === false) {\r\n\t\t\t\t\t\tthis.config.ignore = true;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.backupEventTarget(e, getEvent, actualTarget);\r\n\t\t\t\t\tthis.initDnDMarker();\r\n\t\t\t\t\tgantt._touch_feedback();\r\n\t\t\t\t\tthis.callEvent(\"onAfterDragStart\", [obj, this.config.original_target]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.config.ignore = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!this.config.ignore) {\r\n\t\t\t\t// GS-1279 Gantt crashes on Mobile Firefox after starting to create a link and moving finger outisde the page.\r\n\t\t\t\tif (e.targetTouches && !source.target) return;\r\n\t\t\t\tconst rootNode = gantt.$root.getRootNode();\r\n\t\t\t\tconst insideShadowDOM = rootNode instanceof ShadowRoot;\r\n\t\t\t\tif (insideShadowDOM){\r\n\t\t\t\t\t// second condition is necessary for tests and running Gantt from HTML page\r\n\t\t\t\t\tif (actualTarget && Object.getOwnPropertyDescriptor(source, \"target\")){\r\n\t\t\t\t\t\tsource.target = actualTarget;\r\n\t\t\t\t\t} else if (rootNode.elementFromPoint && e.targetTouches){\r\n\t\t\t\t\t\tconst touch = e.targetTouches[0];\r\n\t\t\t\t\t\tsource.target = rootNode.elementFromPoint(touch.clientX, touch.clientY);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tsource.pos = this.getPosition(source);\r\n\t\t\t\tthis.config.marker.style.left = source.pos.x + \"px\";\r\n\t\t\t\tthis.config.marker.style.top = source.pos.y + \"px\";\r\n\t\t\t\tthis.callEvent(\"onDragMove\", [obj, source, actualTarget]);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\tdragEnd: function (obj) {\r\n\t\t\tvar target = this.config.backup_element;\r\n\t\t\tif (target && target.parentNode) {\r\n\t\t\t\ttarget.parentNode.removeChild(target);\r\n\t\t\t}\r\n\t\t\tgantt._prevent_touch_scroll = false;\r\n\t\t\tif (this.config.marker) {\r\n\t\t\t\tthis.config.marker.parentNode.removeChild(this.config.marker);\r\n\t\t\t\tthis.config.marker = null;\r\n\r\n\t\t\t\tthis.callEvent(\"onDragEnd\", []);\r\n\t\t\t}\r\n\t\t\tthis.config.started = false;\r\n\t\t\tgantt._touch_drag = false;\r\n\t\t\tdocument.body.classList.remove(\"gantt_noselect\");\r\n\t\t},\r\n\r\n\t\tgetPosition: function (e) {\r\n\t\t\tvar x = 0, y = 0;\r\n\t\t\tif (e.pageX || e.pageY) {\r\n\t\t\t\tx = e.pageX;\r\n\t\t\t\ty = e.pageY;\r\n\t\t\t} else if (e.clientX || e.clientY) {\r\n\t\t\t\tx = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;\r\n\t\t\t\ty = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;\r\n\t\t\t}\r\n\t\t\treturn {x: x, y: y};\r\n\t\t}\r\n\t};\r\n\r\n\treturn DnD;\r\n};\r\n","export default function(gantt) {\r\n\r\n\tvar regTemplates = {};\r\n\r\n\tfunction initTemplate(name, initial, template_name) {\r\n\t\ttemplate_name = template_name || name;\r\n\t\tvar config = gantt.config,\r\n\t\t\ttemplates = gantt.templates;\r\n\r\n\t\tif (gantt.config[name] && regTemplates[template_name] != config[name]) {\r\n\t\t\tif (!(initial && templates[template_name])) {\r\n\t\t\t\ttemplates[template_name] = gantt.date.date_to_str(config[name]);\r\n\t\t\t\tregTemplates[template_name] = config[name];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction initTemplates() {\r\n\t\tvar date = gantt.date;\r\n\r\n\t\t//build configuration based templates\r\n\t\tvar d = date.date_to_str;\r\n\t\tvar c = gantt.config;\r\n\t\tvar format_date = d(c.xml_date || c.date_format, c.server_utc);\r\n\t\tvar parse_date = date.str_to_date(c.xml_date || c.date_format, c.server_utc);\r\n\r\n\t\tinitTemplate(\"date_scale\", true, undefined, gantt.config, gantt.templates);\r\n\t\tinitTemplate(\"date_grid\", true, \"grid_date_format\", gantt.config, gantt.templates);\r\n\t\tinitTemplate(\"task_date\", true, undefined, gantt.config, gantt.templates);\r\n\r\n\t\tgantt.mixin(gantt.templates, {\r\n\t\t\txml_format: undefined, // deprecated\r\n\t\t\tformat_date: format_date,\r\n\r\n\t\t\txml_date: undefined, // deprecated\r\n\t\t\tparse_date: parse_date,\r\n\r\n\t\t\tprogress_text: function (start, end, task) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\tgrid_header_class: function (column, config) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\r\n\t\t\ttask_text: function (start, end, task) {\r\n\t\t\t\treturn task.text;\r\n\t\t\t},\r\n\t\t\ttask_class: function (start, end, task) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\ttask_end_date: function (date) {\r\n\t\t\t\treturn gantt.templates.task_date(date);\r\n\t\t\t},\r\n\t\t\tgrid_row_class: function (start, end, task) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\ttask_row_class: function (start, end, task) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\ttimeline_cell_class: function (item, date) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\ttimeline_cell_content: function (item, date) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\tscale_cell_class: function (date) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\tscale_row_class: function (date) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\r\n\t\t\tgrid_indent: function (item) {\r\n\t\t\t\treturn \"<div class='gantt_tree_indent'></div>\";\r\n\t\t\t},\r\n\t\t\tgrid_folder: function (item) {\r\n\t\t\t\treturn \"<div class='gantt_tree_icon gantt_folder_\" + (item.$open ? \"open\" : \"closed\") + \"'></div>\";\r\n\t\t\t},\r\n\t\t\tgrid_file: function (item) {\r\n\t\t\t\treturn \"<div class='gantt_tree_icon gantt_file'></div>\";\r\n\t\t\t},\r\n\t\t\tgrid_open: function (item) {\r\n\t\t\t\treturn \"<div class='gantt_tree_icon gantt_\" + (item.$open ? \"close\" : \"open\") + \"'></div>\";\r\n\t\t\t},\r\n\t\t\tgrid_blank: function (item) {\r\n\t\t\t\treturn \"<div class='gantt_tree_icon gantt_blank'></div>\";\r\n\t\t\t},\r\n\t\t\tdate_grid: function (date, item, column) {\r\n\t\t\t\tif (item && gantt.isUnscheduledTask(item) && gantt.config.show_unscheduled) {\r\n\t\t\t\t\treturn gantt.templates.task_unscheduled_time(item);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn gantt.templates.grid_date_format(date, column);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\ttask_time: function (start, end, ev) {\r\n\t\t\t\tif (gantt.isUnscheduledTask(ev) && gantt.config.show_unscheduled) {\r\n\t\t\t\t\treturn gantt.templates.task_unscheduled_time(ev);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn gantt.templates.task_date(start) + \" - \" + gantt.templates.task_end_date(end);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\ttask_unscheduled_time: function (task) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\r\n\t\t\ttime_picker: d(c.time_picker),\r\n\t\t\tlink_class: function (link) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\tlink_description: function (link) {\r\n\t\t\t\tvar from = gantt.getTask(link.source),\r\n\t\t\t\t\tto = gantt.getTask(link.target);\r\n\r\n\t\t\t\treturn \"<b>\" + from.text + \"</b> &ndash;  <b>\" + to.text + \"</b>\";\r\n\t\t\t},\r\n\r\n\t\t\tdrag_link: function (from, from_start, to, to_start) {\r\n\t\t\t\tfrom = gantt.getTask(from);\r\n\t\t\t\tvar labels = gantt.locale.labels;\r\n\r\n\t\t\t\tvar text = \"<b>\" + from.text + \"</b> \" + (from_start ? labels.link_start : labels.link_end) + \"<br/>\";\r\n\t\t\t\tif (to) {\r\n\t\t\t\t\tto = gantt.getTask(to);\r\n\t\t\t\t\ttext += \"<b> \" + to.text + \"</b> \" + (to_start ? labels.link_start : labels.link_end) + \"<br/>\";\r\n\t\t\t\t}\r\n\t\t\t\treturn text;\r\n\t\t\t},\r\n\t\t\tdrag_link_class: function (from, from_start, to, to_start) {\r\n\t\t\t\tvar add = \"\";\r\n\r\n\t\t\t\tif (from && to) {\r\n\t\t\t\t\tvar allowed = gantt.isLinkAllowed(from, to, from_start, to_start);\r\n\t\t\t\t\tadd = \" \" + (allowed ? \"gantt_link_allow\" : \"gantt_link_deny\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn \"gantt_link_tooltip\" + add;\r\n\t\t\t},\r\n\r\n\t\t\t/* used for aria-labels of bar elements and for tooltip.js */\r\n\t\t\ttooltip_date_format: date.date_to_str(\"%Y-%m-%d\"),\r\n\t\t\ttooltip_text: function (start, end, event) {\r\n\t\t\t\treturn `<div>Task: ${event.text}</div>\r\n\t\t\t\t<div>Start date: ${gantt.templates.tooltip_date_format(start)}</div>\r\n\t\t\t\t<div>End date: ${gantt.templates.tooltip_date_format(end)}</div>`;\r\n\t\t\t},\r\n\t\t\tbaseline_text: function (task, baseline, index) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\treturn {\r\n\t\tinitTemplates: initTemplates,\r\n\t\tinitTemplate: initTemplate\r\n\t};\r\n\r\n};","import * as utils from \"../../utils/utils\";\r\nimport facadeFactory from \"./../facades/datastore\";\r\nimport calculateScaleRange from \"../gantt_data_range\";\r\nimport isPlaceholderTask from \"../../utils/placeholder_task\";\r\n\r\nimport treeHelper from \"../../utils/task_tree_helpers\";\r\n\r\nfunction initDataStores(gantt){\r\n\r\n\tvar facade = facadeFactory.create();\r\n\tutils.mixin(gantt, facade);\r\n\tvar tasksStore = gantt.createDatastore({\r\n\t\tname: \"task\",\r\n\t\ttype: \"treeDatastore\",\r\n\t\trootId: function() { return gantt.config.root_id; },\r\n\t\tinitItem: utils.bind(_init_task, gantt),\r\n\t\tgetConfig: function() { return gantt.config; }\r\n\t});\r\n\r\n\tvar linksStore = gantt.createDatastore({\r\n\t\tname: \"link\",\r\n\t\tinitItem: utils.bind(_init_link, gantt)\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onDestroy\", function(){\r\n\t\ttasksStore.destructor();\r\n\t\tlinksStore.destructor();\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onLinkValidation\", function(link){\r\n\t\tif(gantt.isLinkExists(link.id) || link.id === \"predecessor_generated\"){\r\n\t\t\t// link was already added into gantt\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar source = gantt.getTask(link.source);\r\n\t\tvar taskLinks = source.$source;\r\n\t\tfor (var i = 0; i < taskLinks.length; i++) {\r\n\t\t\tvar existingLink = gantt.getLink(taskLinks[i]);\r\n\r\n\t\t\tvar sourceMatch = link.source == existingLink.source;\r\n\t\t\tvar targetMatch = link.target == existingLink.target;\r\n\t\t\tvar typeMatch = link.type == existingLink.type;\r\n\r\n\t\t\t// prevent creating duplicated links from the UI\r\n\t\t\tif (sourceMatch && targetMatch && typeMatch) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t});\r\n\r\n\ttasksStore.attachEvent(\"onBeforeRefreshAll\", function(){\r\n\r\n\t\t// GS-2170 do not recalculate indexes and dates as the event will be called later in the onStoreUpdate event\r\n\t\tif (tasksStore._skipTaskRecalculation){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar order = tasksStore.getVisibleItems();\r\n\r\n\t\tfor(var i=0; i < order.length; i++){\r\n\t\t\tvar item = order[i];\r\n\t\t\titem.$index = i;\r\n\t\t\titem.$local_index = gantt.getTaskIndex(item.id);\r\n\t\t\tgantt.resetProjectDates(item);\r\n\t\t}\r\n\r\n\t});\r\n\r\n\ttasksStore.attachEvent(\"onFilterItem\", function(id, task) {\r\n\t\tif (gantt.config.show_tasks_outside_timescale) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar min = null, max = null;\r\n\t\tif (gantt.config.start_date && gantt.config.end_date) {\r\n\t\t\tif (gantt._isAllowedUnscheduledTask(task)) return true;\r\n\t\t\tmin = gantt.config.start_date.valueOf();\r\n\t\t\tmax = gantt.config.end_date.valueOf();\r\n\r\n\t\t\tif (+task.start_date > max || +task.end_date < +min)\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t});\r\n\r\n\ttasksStore.attachEvent(\"onIdChange\", function(oldId, newId){\r\n\t\tgantt._update_flags(oldId, newId);\r\n\r\n\t\tvar changedTask = gantt.getTask(newId);\r\n\t\tif(!tasksStore.isSilent()){\r\n\t\t\tif(changedTask.$split_subtask || changedTask.rollup){\r\n\t\t\t\tgantt.eachParent(function(parent){\r\n\t\t\t\t\tgantt.refreshTask(parent.id);\r\n\t\t\t\t}, newId);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\ttasksStore.attachEvent(\"onAfterUpdate\", function(id){\r\n\t\tgantt._update_parents(id);\r\n\t\tif(gantt.getState(\"batchUpdate\").batch_update){\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tvar task = tasksStore.getItem(id);\r\n\t\tif (!task.$source) task.$source = [];\r\n\t\tfor (var i = 0; i < task.$source.length; i++) {\r\n\t\t\tlinksStore.refresh(task.$source[i]);\r\n\t\t}\r\n\t\tif (!task.$target) task.$target = [];\r\n\t\tfor (var i = 0; i < task.$target.length; i++) {\r\n\t\t\tlinksStore.refresh(task.$target[i]);\r\n\t\t}\r\n\t});\r\n\r\n\ttasksStore.attachEvent(\"onBeforeItemMove\", function(sid, parent, tindex){\r\n\t\t// GS-125. Don't allow users to move the placeholder task\r\n\t\tif (isPlaceholderTask(sid, gantt, tasksStore)){\r\n\t\t\t//eslint-disable-next-line\r\n\t\t\tconsole.log(\"The placeholder task cannot be moved to another position.\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t});\r\n\r\n\ttasksStore.attachEvent(\"onAfterItemMove\", function(sid, parent, tindex){\r\n\t\tvar source = gantt.getTask(sid);\r\n\r\n\t\tif(this.getNextSibling(sid) !== null){\r\n\t\t\tsource.$drop_target = this.getNextSibling(sid);\r\n\t\t} else if(this.getPrevSibling(sid) !== null){\r\n\t\t\tsource.$drop_target = \"next:\" + this.getPrevSibling(sid);\r\n\t\t}else{\r\n\t\t\tsource.$drop_target = \"next:null\";\r\n\t\t}\r\n\r\n\t});\r\n\r\n\ttasksStore.attachEvent(\"onStoreUpdated\", function(id, item, action){\r\n\t\tif(action == \"delete\"){\r\n\t\t\tgantt._update_flags(id, null);\r\n\t\t}\r\n\r\n\t\tvar state = gantt.$services.getService(\"state\");\r\n\t\tif(state.getState(\"batchUpdate\").batch_update){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(gantt.config.fit_tasks && action !== \"paint\"){\r\n\t\t\tvar oldState = gantt.getState();\r\n\t\t\tcalculateScaleRange(gantt);\r\n\t\t\tvar newState = gantt.getState();\r\n\r\n\t\t\t//this._init_tasks_range();\r\n\t\t\tif (+oldState.min_date != +newState.min_date || +oldState.max_date != +newState.max_date) {\r\n\t\t\t\tgantt.render();\r\n\r\n\t\t\t\tgantt.callEvent(\"onScaleAdjusted\", []);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif(action == \"add\" || action == \"move\" || action == \"delete\"){\r\n\t\t\tif(gantt.$layout){\r\n\t\t\t\t// GS-2170. Do not recalculate the indexes and dates of other tasks in the\r\n\t\t\t\t// onBeforeResize layout event, but do it later. If lightbox is opened, it will\r\n\t\t\t\t// trigger the refreshData, so the indexes and dates will be recalculated there\r\n\t\t\t\tif (this.$config.name == \"task\" && (action == \"add\" || action == \"delete\")){\r\n\t\t\t\t\tif (this._skipTaskRecalculation != \"lightbox\"){\r\n\t\t\t\t\t\tthis._skipTaskRecalculation = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tgantt.$layout.resize();\r\n\t\t\t}\r\n\r\n\t\t}else if(!id){\r\n\t\t\tlinksStore.refresh();\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tlinksStore.attachEvent(\"onAfterAdd\", function(id, link){\r\n\t\tlinksStore.sync_link(link);\r\n\t});\r\n\tlinksStore.attachEvent(\"onAfterUpdate\", function(id, link){\r\n\t\tsync_links();\r\n\t});\r\n\tlinksStore.attachEvent(\"onAfterDelete\", function(id, link){\r\n\t\tsync_link_delete(link);\r\n\t});\r\n\tlinksStore.attachEvent(\"onAfterSilentDelete\", function(id, link){\r\n\t\tsync_link_delete(link);\r\n\t});\r\n\tlinksStore.attachEvent(\"onBeforeIdChange\", function(oldId, newId){\r\n\t\tsync_link_delete(gantt.mixin({id:oldId}, gantt.$data.linksStore.getItem(newId)));\r\n\t\tlinksStore.sync_link(gantt.$data.linksStore.getItem(newId));\r\n\t});\r\n\r\n\tfunction checkLinkedTaskVisibility(taskId){\r\n\t\tvar isVisible = gantt.isTaskVisible(taskId);\r\n\t\tif(!isVisible && gantt.isTaskExists(taskId)){\r\n\t\t\tvar parent = gantt.getParent(taskId);\r\n\t\t\tif(gantt.isTaskExists(parent) && gantt.isTaskVisible(parent)){\r\n\t\t\t\tparent = gantt.getTask(parent);\r\n\t\t\t\tif(gantt.isSplitTask(parent)){\r\n\t\t\t\t\tisVisible = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn isVisible;\r\n\t}\r\n\r\n\tlinksStore.attachEvent(\"onFilterItem\", function(id, link){\r\n\t\tif (!gantt.config.show_links) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar sourceVisible = checkLinkedTaskVisibility(link.source);\r\n\t\tvar targetVisible = checkLinkedTaskVisibility(link.target);\r\n\r\n\t\tif (!(sourceVisible && targetVisible) ||\r\n\t\t\tgantt._isAllowedUnscheduledTask(gantt.getTask(link.source)) || gantt._isAllowedUnscheduledTask(gantt.getTask(link.target)))\r\n\t\t\treturn false;\r\n\r\n\t\treturn gantt.callEvent(\"onBeforeLinkDisplay\", [id, link]);\r\n\t});\r\n\r\n\r\n\t(function(){\r\n\t\t// delete all connected links after task is deleted\r\n\t\tvar deletedLinks = {};\r\n\r\n\t\tgantt.attachEvent(\"onBeforeTaskDelete\", function(id, item){\r\n\t\t\tdeletedLinks[id] = treeHelper.getSubtreeLinks(gantt, id);\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onAfterTaskDelete\", function(id, item) {\r\n\t\t\tif(deletedLinks[id]){\r\n\t\t\t\tgantt.$data.linksStore.silent(function(){\r\n\t\t\t\t\tfor(var i in deletedLinks[id]){\r\n\t\t\t\t\t\tif (gantt.isLinkExists(i)){\r\n\t\t\t\t\t\t\tgantt.$data.linksStore.removeItem(i);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsync_link_delete(deletedLinks[id][i]);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdeletedLinks[id] = null;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t})();\r\n\r\n\tgantt.attachEvent(\"onAfterLinkDelete\", function(id, link) {\r\n\t\t// GS-1786. Repaint tasks only if they are loaded\r\n\t\tif(gantt.isTaskExists(link.source)){\r\n\t\t\tgantt.refreshTask(link.source);\r\n\t\t}\r\n\t\tif(gantt.isTaskExists(link.target)){\r\n\t\t\tgantt.refreshTask(link.target);\r\n\t\t}\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onParse\", sync_links);\r\n\r\n\tmapEvents({\r\n\t\tsource: linksStore,\r\n\t\ttarget: gantt,\r\n\t\tevents:{\r\n\t\t\t\"onItemLoading\":\"onLinkLoading\",\r\n\t\t\t\"onBeforeAdd\":\"onBeforeLinkAdd\",\r\n\t\t\t\"onAfterAdd\":\"onAfterLinkAdd\",\r\n\t\t\t\"onBeforeUpdate\":\"onBeforeLinkUpdate\",\r\n\t\t\t\"onAfterUpdate\":\"onAfterLinkUpdate\",\r\n\t\t\t\"onBeforeDelete\":\"onBeforeLinkDelete\",\r\n\t\t\t\"onAfterDelete\":\"onAfterLinkDelete\",\r\n\t\t\t\"onIdChange\":\"onLinkIdChange\"\r\n\t\t}\r\n\t});\r\n\r\n\tmapEvents({\r\n\t\tsource: tasksStore,\r\n\t\ttarget: gantt,\r\n\t\tevents:{\r\n\t\t\t\"onItemLoading\":\"onTaskLoading\",\r\n\t\t\t\"onBeforeAdd\":\"onBeforeTaskAdd\",\r\n\t\t\t\"onAfterAdd\":\"onAfterTaskAdd\",\r\n\t\t\t\"onBeforeUpdate\":\"onBeforeTaskUpdate\",\r\n\t\t\t\"onAfterUpdate\":\"onAfterTaskUpdate\",\r\n\t\t\t\"onBeforeDelete\":\"onBeforeTaskDelete\",\r\n\t\t\t\"onAfterDelete\":\"onAfterTaskDelete\",\r\n\t\t\t\"onIdChange\":\"onTaskIdChange\",\r\n\t\t\t\"onBeforeItemMove\":\"onBeforeTaskMove\",\r\n\t\t\t\"onAfterItemMove\":\"onAfterTaskMove\",\r\n\t\t\t\"onFilterItem\":\"onBeforeTaskDisplay\",\r\n\t\t\t\"onItemOpen\":\"onTaskOpened\",\r\n\t\t\t\"onItemClose\":\"onTaskClosed\",\r\n\t\t\t\"onBeforeSelect\":\"onBeforeTaskSelected\",\r\n\t\t\t\"onAfterSelect\":\"onTaskSelected\",\r\n\t\t\t\"onAfterUnselect\":\"onTaskUnselected\"\r\n\t\t}\r\n\t});\r\n\r\n\tgantt.$data = {\r\n\t\ttasksStore: tasksStore,\r\n\t\tlinksStore: linksStore\r\n\t};\r\n\r\n\tlinksStore.sync_link = function(link) {\r\n\t\tif(gantt.isTaskExists(link.source)){\r\n\t\t\tvar sourceTask = gantt.getTask(link.source);\r\n\t\t\tsourceTask.$source = sourceTask.$source || [];\r\n\t\t\tif (noDuplicateIds(link.id, sourceTask.$source)){\r\n\t\t\t\tsourceTask.$source.push(link.id);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(gantt.isTaskExists(link.target)){\r\n\t\t\tvar targetTask = gantt.getTask(link.target);\r\n\t\t\ttargetTask.$target = targetTask.$target || [];\r\n\t\t\tif (noDuplicateIds(link.id, targetTask.$target)){\r\n\t\t\t\ttargetTask.$target.push(link.id);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t// GS-2085. Don't add duplicate link IDs\r\n\tfunction noDuplicateIds(id, array){\r\n\t\treturn array.indexOf(String(id)) === -1 && array.indexOf(Number(id)) === -1;\r\n\t}\r\n\r\n\tfunction sync_link_delete(link){\r\n\t\tif(gantt.isTaskExists(link.source)){\r\n\t\t\tvar sourceTask = gantt.getTask(link.source);\r\n\t\t\tfor(var i = 0; i < sourceTask.$source.length; i++){\r\n\t\t\t\tif(sourceTask.$source[i] == link.id){\r\n\t\t\t\t\tsourceTask.$source.splice(i, 1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(gantt.isTaskExists(link.target)){\r\n\t\t\tvar targetTask = gantt.getTask(link.target);\r\n\t\t\tfor(var i = 0; i < targetTask.$target.length; i++){\r\n\t\t\t\tif(targetTask.$target[i] == link.id){\r\n\t\t\t\t\ttargetTask.$target.splice(i, 1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction sync_links() {\r\n\t\tvar task = null;\r\n\t\tvar tasks = gantt.$data.tasksStore.getItems();\r\n\r\n\t\tfor(var i = 0, len = tasks.length; i < len; i++){\r\n\t\t\ttask = tasks[i];\r\n\t\t\ttask.$source = [];\r\n\t\t\ttask.$target = [];\r\n\t\t}\r\n\r\n\t\tvar links = gantt.$data.linksStore.getItems();\r\n\t\tfor (var i = 0, len = links.length; i < len; i++) {\r\n\r\n\t\t\tvar link = links[i];\r\n\t\t\tlinksStore.sync_link(link);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction mapEvents(conf){\r\n\t\tvar mapFrom = conf.source;\r\n\t\tvar mapTo = conf.target;\r\n\t\tfor(var i in conf.events){\r\n\t\t\t(function(sourceEvent, targetEvent){\r\n\t\t\t\tmapFrom.attachEvent(sourceEvent, function(){\r\n\t\t\t\t\treturn mapTo.callEvent(targetEvent, Array.prototype.slice.call(arguments));\r\n\t\t\t\t}, targetEvent);\r\n\t\t\t})(i, conf.events[i]);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _init_task(task) {\r\n\t\tif (!this.defined(task.id))\r\n\t\t\ttask.id = this.uid();\r\n\r\n\t\tif (task.start_date)\r\n\t\t\ttask.start_date = gantt.date.parseDate(task.start_date, \"parse_date\");\r\n\t\tif (task.end_date)\r\n\t\t\ttask.end_date = gantt.date.parseDate(task.end_date, \"parse_date\");\r\n\r\n\r\n\t\tvar duration = null;\r\n\t\tif (task.duration || task.duration === 0) {\r\n\t\t\ttask.duration = duration = task.duration * 1;\r\n\t\t}\r\n\r\n\t\tif (duration) {\r\n\t\t\tif (task.start_date && !task.end_date) {\r\n\t\t\t\ttask.end_date = this.calculateEndDate(task);\r\n\t\t\t} else if (!task.start_date && task.end_date) {\r\n\t\t\t\ttask.start_date = this.calculateEndDate({\r\n\t\t\t\t\tstart_date: task.end_date,\r\n\t\t\t\t\tduration: -task.duration,\r\n\t\t\t\t\ttask: task\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t//task.$calculate_duration = false;\r\n\t\t}\r\n\r\n\t\tif (gantt.config.deadlines !== false && task.deadline){\r\n\t\t\ttask.deadline = gantt.date.parseDate(task.deadline, \"parse_date\");\r\n\t\t}\r\n\r\n\t\ttask.progress = Number(task.progress) || 0;\r\n\r\n\t\tif (this._isAllowedUnscheduledTask(task)) {\r\n\t\t\tthis._set_default_task_timing(task);\r\n\t\t}\r\n\t\tthis._init_task_timing(task);\r\n\t\tif (task.start_date && task.end_date)\r\n\t\t\tthis.correctTaskWorkTime(task);\r\n\r\n\t\ttask.$source = [];\r\n\t\ttask.$target = [];\r\n\r\n\t\tvar originalTask = this.$data.tasksStore.getItem(task.id);\r\n\t\tif (originalTask && !utils.defined(task.open)) {\r\n\t\t\t// if a task with the same id is already in the gantt and the new object doesn't specify the `open` state -\r\n\t\t\t// restore the `open` state we already have in the chart\r\n\t\t\ttask.$open = originalTask.$open;\r\n\t\t}\r\n\r\n\t\tif (task.parent === undefined) {\r\n\t\t\ttask.parent = this.config.root_id;\r\n\t\t}\r\n\t\tif(task.open){\r\n\t\t\ttask.$open = true;\r\n\t\t}\r\n\t\treturn task;\r\n\t}\r\n\r\n\tfunction _init_link(link) {\r\n\t\tif (!this.defined(link.id))\r\n\t\t\tlink.id = this.uid();\r\n\t\treturn link;\r\n\t}\r\n}\r\n\r\n\r\nexport default initDataStores;\r\n","import batch_update from \"./batch_update\";\r\nimport wbs from \"./wbs\";\r\nimport resources from \"./resources\";\r\nimport resource_assignments from \"./resource_assignments\";\r\nimport new_task_placeholder from \"./new_task_placeholder\";\r\nimport auto_task_types from \"./auto_task_types\";\r\nimport formatters from \"./formatters\";\r\nimport empty_state_screen from \"./empty_state_screen\";\r\nimport baselines from \"./baselines\";\r\nimport remote_events from \"./remote_events/index\";\r\nimport auto_scheduling_config from \"./auto_scheduling_config\";\r\n\r\nexport default function(gantt){\r\n\tif(!gantt.ext){\r\n\t\tgantt.ext = {};\r\n\t}\r\n\r\n\tvar modules = [\r\n\t\tbatch_update,\r\n\t\twbs,\r\n\t\tresources,\r\n\t\tresource_assignments,\r\n\t\tnew_task_placeholder,\r\n\t\tauto_task_types,\r\n\t\tformatters,\r\n\t\tempty_state_screen,\r\n\t\tbaselines,\r\n\t\tremote_events\r\n\t];\r\n\r\n\tfor(var i = 0; i < modules.length; i++){\r\n\t\tif(modules[i])\r\n\t\t\tmodules[i](gantt);\r\n\t}\r\n\r\n\tconst { getAutoSchedulingConfig} = auto_scheduling_config(gantt);\r\n\tgantt._getAutoSchedulingConfig = getAutoSchedulingConfig;\r\n};","export default function(gantt){\r\n\tfunction getDefaultAutoSchedulingConfig(){\r\n\t\treturn {\r\n\t\t\tenabled: false,\r\n\t\t\tapply_constraints: false,\r\n\t\t\tgap_behavior: \"preserve\",\r\n\t\t\tdescendant_links: false,\r\n\t\t\tschedule_on_parse: true,\r\n\t\t\tmove_projects: true,\r\n\t\t\tuse_progress: false,\r\n\r\n\t\t\tschedule_from_end: false,\r\n\t\t\tproject_constraint: false,\r\n\t\t\tshow_constraints: false\r\n\t\t};\r\n\t}\r\n\r\n\tfunction getAutoSchedulingConfig() {\r\n\t\tconst config = gantt.config;\r\n\r\n\t\t// if already using new-style object  return as is\r\n\t\tif (typeof config.auto_scheduling === \"object\") {\r\n\r\n\t\t\tconst schedulingConfig = {...getDefaultAutoSchedulingConfig(), ...config.auto_scheduling};\r\n\r\n\t\t\t// backward compatibility for {mode, strict, move_asap_tasks} properties\r\n\t\t\tif(schedulingConfig.mode){\r\n\t\t\t\tschedulingConfig.apply_constraints = schedulingConfig.mode === \"constraints\";\r\n\t\t\t\tdelete schedulingConfig.mode;\r\n\t\t\t}\r\n\r\n\t\t\tif(schedulingConfig.strict !== undefined){\r\n\t\t\t\tschedulingConfig.gap_behavior = schedulingConfig.strict ? \"compress\" : \"preserve\";\r\n\t\t\t\tdelete schedulingConfig.strict;\r\n\t\t\t}\r\n\r\n\t\t\tif(schedulingConfig.move_asap_tasks !== undefined){\r\n\t\t\t\tschedulingConfig.gap_behavior = schedulingConfig.move_asap_tasks ? \"compress\" : \"preserve\";\r\n\t\t\t\tdelete schedulingConfig.move_asap_tasks;\r\n\t\t\t}\r\n\t\t\treturn schedulingConfig;\r\n\t\t}\r\n\r\n\t\t// backward compatibility: build config from old flags\r\n\t\tconst enabled = !!config.auto_scheduling;\r\n\r\n\t\treturn {\r\n\t\t\t...getDefaultAutoSchedulingConfig(),\r\n\t\t\t...{\r\n\t\t\t\tenabled,\r\n\t\t\t\tapply_constraints: config.auto_scheduling_compatibility ?? false,\r\n\t\t\t\tgap_behavior: config.auto_scheduling_strict !== true ? \"preserve\" : \"compress\",\r\n\t\t\t\tdescendant_links: config.auto_scheduling_descendant_links ?? false,\r\n\t\t\t\tschedule_on_parse: config.auto_scheduling_initial ?? true,\r\n\t\t\t\tmove_projects: config.auto_scheduling_move_projects ?? true,\r\n\t\t\t\tuse_progress: config.auto_scheduling_use_progress ?? false,\r\n\r\n\t\t\t\tschedule_from_end: config.schedule_from_end ?? false,\r\n\t\t\t\tproject_constraint: config.auto_scheduling_project_constraint ?? false,\r\n\t\t\t\tshow_constraints: false\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\treturn {\r\n\t\tgetDefaultAutoSchedulingConfig,\r\n\t\tgetAutoSchedulingConfig\r\n\t};\r\n};","export default function(gantt) {\r\n\tgantt.getGridColumn = function(name) {\r\n\t\tvar columns = gantt.config.columns;\r\n\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tif (columns[i].name == name)\r\n\t\t\t\treturn columns[i];\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t};\r\n\r\n\tgantt.getGridColumns = function() {\r\n\t\treturn gantt.config.columns.slice();\r\n\t};\r\n};","export default function(gantt) {\r\n\tgantt.isReadonly = function (item) {\r\n\r\n\t\tif((typeof item == \"number\" || typeof item == \"string\") && gantt.isTaskExists(item)){\r\n\t\t\titem = gantt.getTask(item);\r\n\t\t}\r\n\t\tif (item && item[this.config.editable_property]) {\r\n\t\t\treturn false;\r\n\t\t} else {\r\n\t\t\treturn (item && item[this.config.readonly_property]) || this.config.readonly;\r\n\t\t}\r\n\t};\r\n};","import CalendarManager from \"./calendar_manager\";\r\nimport TimeCalculator from \"./time_calculator\";\r\nimport worktimeFacadeFactory from \"../facades/worktime_calendars\";\r\nimport * as utils from \"../../utils/utils\";\r\n\r\nexport default function (gantt) {\r\n\tvar manager = new CalendarManager(gantt),\r\n\ttimeCalculator = new TimeCalculator(manager);\r\n\tvar facade = worktimeFacadeFactory.create(manager, timeCalculator);\r\n\tutils.mixin(gantt, facade);\r\n};\r\n","export default function(gantt) {\r\n\r\n\tgantt.getTaskType = function (type) {\r\n\t\treturn \"task\";\r\n\t};\r\n};","/*\r\n reuse results of functions that can be recalculated during rendering\r\n greatly increases the rendering speed when critical path enabled\r\n Sample - 94_dev/critical_path.html\r\n\r\n */\r\nexport default function(gantt){\r\n\r\ngantt._cached_functions = {\r\n\tcache: {},\r\n\tmode: false,\r\n\tcritical_path_mode: false,\r\n\twrap_methods : function(methods, object){\r\n\t\tif(object._prefetch_originals){\r\n\t\t\tfor(var i in object._prefetch_originals){\r\n\t\t\t\tobject[i] = object._prefetch_originals[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\tobject._prefetch_originals = {};\r\n\t\tfor(var i = 0; i < methods.length; i++)\r\n\t\t\tthis.prefetch(methods[i], object);\r\n\r\n\t},\r\n\tprefetch : function(methodname, host){\r\n\t\tvar original = host[methodname];\r\n\t\tif(original){\r\n\t\t\tvar optimizer = this;\r\n\r\n\t\t\thost._prefetch_originals[methodname] = original;\r\n\t\t\thost[methodname] = function get_prefetched_value(){\r\n\r\n\t\t\t\tvar argumentsArray = new Array(arguments.length);\r\n\t\t\t\tfor (var i = 0, l = arguments.length; i < l; i++) {\r\n\t\t\t\t\targumentsArray[i] = arguments[i];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(optimizer.active){\r\n\t\t\t\t\tvar args = optimizer.get_arguments_hash(Array.prototype.slice.call(argumentsArray));\r\n\t\t\t\t\tif(!optimizer.cache[methodname]){\r\n\t\t\t\t\t\toptimizer.cache[methodname] = {};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar cached_values = optimizer.cache[methodname];\r\n\r\n\t\t\t\t\tif(optimizer.has_cached_value(cached_values, args)){\r\n\t\t\t\t\t\treturn optimizer.get_cached_value(cached_values, args);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tvar value = original.apply(this, argumentsArray);\r\n\t\t\t\t\t\toptimizer.cache_value(cached_values, args, value);\r\n\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn original.apply(this, argumentsArray);\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn original;\r\n\t},\r\n\tcache_value: function(cache, arguments_hash, value){\r\n\t\tif(this.is_date(value))\r\n\t\t\tvalue = new Date(value);\r\n\t\tcache[arguments_hash] = value;\r\n\t},\r\n\thas_cached_value: function(cache, arguments_hash){\r\n\t\treturn cache.hasOwnProperty(arguments_hash);\r\n\t},\r\n\tget_cached_value: function(cache, arguments_hash){\r\n\t\tvar data = cache[arguments_hash];\r\n\r\n\t\t//for cached dates - return copy\r\n\t\tif(this.is_date(data)){\r\n\t\t\tdata = new Date(data);\r\n\t\t}\r\n\t\treturn data;\r\n\t},\r\n\tis_date: function(value){\r\n\t\treturn (value && value.getUTCDate);\r\n\t},\r\n\tget_arguments_hash:function(args){\r\n\t\tvar values = [];\r\n\t\tfor(var i = 0; i < args.length; i++){\r\n\t\t\tvalues.push(this.stringify_argument(args[i]));\r\n\t\t}\r\n\t\treturn \"(\" + values.join(\";\") + \")\";\r\n\t},\r\n\tstringify_argument: function(value){\r\n\t\t//expecting task or link, or any other data entries, dates and primitive values\r\n\t\tvar ret = \"\";\r\n\t\tif(value.id){\r\n\t\t\tret = value.id;\r\n\t\t}else if(this.is_date(value)){\r\n\t\t\tret = value.valueOf();\r\n\t\t}else{\r\n\t\t\tret = value;\r\n\t\t}\r\n\t\treturn ret + \"\";\r\n\t},\r\n\tactivate: function(){\r\n\t\tthis.clear();\r\n\t\tthis.active = true;\r\n\t},\r\n\tdeactivate: function(){\r\n\t\tthis.clear();\r\n\t\tthis.active = false;\r\n\t},\r\n\tclear: function(){\r\n\t\tthis.cache = {};\r\n\t},\r\n\r\n\tsetup: function(gantt){\r\n\t\tvar override_gantt = [];\r\n\r\n\t\tvar gantt_methods  = [\r\n\t\t\t'_isProjectEnd',\r\n\t\t\t'_getProjectEnd',\r\n\t\t\t'_getSlack'\r\n\t\t];\r\n\r\n\r\n\r\n\t\tif(this.mode == 'auto'){\r\n\t\t\tif(gantt.config.highlight_critical_path){\r\n\t\t\t\toverride_gantt = gantt_methods;\r\n\t\t\t}\r\n\t\t}else if(this.mode === true){\r\n\t\t\toverride_gantt = gantt_methods;\r\n\t\t}\r\n\r\n\t\tthis.wrap_methods(override_gantt, gantt);\r\n\r\n\t},\r\n\tupdate_if_changed: function(gantt){\r\n\t\tvar changed = (this.critical_path_mode != gantt.config.highlight_critical_path ||\r\n\t\t\t\t\t\tthis.mode !== gantt.config.optimize_render);\r\n\t\tif(changed){\r\n\t\t\tthis.critical_path_mode = gantt.config.highlight_critical_path;\r\n\t\t\tthis.mode = gantt.config.optimize_render;\r\n\t\t\tthis.setup(gantt);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nfunction activate(){\r\n\tgantt._cached_functions.update_if_changed(gantt);\r\n\tif(!gantt._cached_functions.active){\r\n\t\tgantt._cached_functions.activate();\r\n\t}\r\n\treturn true;\r\n}\r\ngantt.attachEvent(\"onBeforeGanttRender\", activate);\r\ngantt.attachEvent(\"onBeforeDataRender\", activate);\r\ngantt.attachEvent(\"onBeforeSmartRender\",  function(){\r\n\tactivate();\r\n});\r\ngantt.attachEvent(\"onBeforeParse\", activate);\r\ngantt.attachEvent(\"onDataRender\", function(){\r\n\tgantt._cached_functions.deactivate();\r\n});\r\nvar deactivTimeout = null;\r\ngantt.attachEvent(\"onSmartRender\", function(){\r\n\tif(deactivTimeout)\r\n\t\tclearTimeout(deactivTimeout);\r\n\tdeactivTimeout = setTimeout(function(){\r\n\t\tgantt._cached_functions.deactivate();\r\n\t}, 1000);\r\n});\r\n\r\ngantt.attachEvent(\"onBeforeGanttReady\", function(){\r\n\tgantt._cached_functions.update_if_changed(gantt);\r\n\treturn true;\r\n});\r\n\r\n};","function extend(gantt){\r\n\r\n\tgantt.destructor = function(){\r\n\t\tthis.clearAll();\r\n\t\tthis.callEvent(\"onDestroy\", []);\r\n\r\n\t\tthis._getDatastores().forEach(function(store){\r\n\t\t\tstore.destructor();\r\n\t\t});\r\n\r\n\t\tif(this.$root){\r\n\t\t\tdelete this.$root.gantt;\r\n\t\t}\r\n\r\n\t\tif(this._eventRemoveAll){\r\n\t\t\tthis._eventRemoveAll();\r\n\t\t}\r\n\r\n\t\tif(this.$layout){\r\n\t\t\tthis.$layout.destructor();\r\n\t\t}\r\n\r\n\t\tif(this.resetLightbox){\r\n\t\t\tthis.resetLightbox();\r\n\t\t}\r\n\r\n\t\t// GS-99. Call this here to detach the events\r\n\t\tif (this.ext.inlineEditors && this.ext.inlineEditors.destructor) {\r\n\t\t\tthis.ext.inlineEditors.destructor();\r\n\t\t}\r\n\r\n\t\tif(this._dp && this._dp.destructor){\r\n\t\t\tthis._dp.destructor();\r\n\t\t}\r\n\t\tthis.$services.destructor();\r\n\r\n\t\t// detachAllEvents should be called last, because in components may be attached events\r\n\t\tthis.detachAllEvents();\r\n\r\n\t\tfor(var i in this){\r\n\t\t\tif(i.indexOf(\"$\") === 0){\r\n\t\t\t\tdelete this[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.$destroyed = true;\r\n\t};\r\n}\r\n\r\nexport default extend;\r\n","import ar from \"./locale_ar\";\r\nimport be from \"./locale_be\";\r\nimport ca from \"./locale_ca\";\r\nimport cn from \"./locale_cn\";\r\nimport cs from \"./locale_cs\";\r\nimport da from \"./locale_da\";\r\nimport de from \"./locale_de\";\r\nimport el from \"./locale_el\";\r\nimport en from \"./locale_en\";\r\nimport es from \"./locale_es\";\r\nimport fa from \"./locale_fa\";\r\nimport fi from \"./locale_fi\";\r\nimport fr from \"./locale_fr\";\r\nimport he from \"./locale_he\";\r\nimport hr from \"./locale_hr\";\r\nimport hu from \"./locale_hu\";\r\nimport id from \"./locale_id\";\r\nimport it from \"./locale_it\";\r\nimport jp from \"./locale_jp\";\r\nimport kr from \"./locale_kr\";\r\n\r\nimport LocaleManager from \"./locale_manager\";\r\n\r\nimport nb from \"./locale_nb\";\r\nimport nl from \"./locale_nl\";\r\nimport no from \"./locale_no\";\r\nimport pl from \"./locale_pl\";\r\nimport pt from \"./locale_pt\";\r\nimport ro from \"./locale_ro\";\r\nimport ru from \"./locale_ru\";\r\nimport si from \"./locale_si\";\r\nimport sk from \"./locale_sk\";\r\nimport sv from \"./locale_sv\";\r\nimport tr from \"./locale_tr\";\r\nimport ua from \"./locale_ua\";\r\n\r\nexport default function(){\r\n\treturn new LocaleManager({\r\n\t\ten,\r\n\t\tar,\r\n\t\tbe,\r\n\t\tca,\r\n\t\tcn,\r\n\t\tcs,\r\n\t\tda,\r\n\t\tde,\r\n\t\tel,\r\n\t\tes,\r\n\t\tfa,\r\n\t\tfi,\r\n\t\tfr,\r\n\t\the,\r\n\t\thr,\r\n\t\thu,\r\n\t\tid,\r\n\t\tit,\r\n\t\tjp,\r\n\t\tkr,\r\n\t\tnb,\r\n\t\tnl,\r\n\t\tno,\r\n\t\tpl,\r\n\t\tpt,\r\n\t\tro,\r\n\t\tru,\r\n\t\tsi,\r\n\t\tsk,\r\n\t\tsv,\r\n\t\ttr,\r\n\t\tua\r\n\t});\r\n}","import * as utils from \"../../utils/utils\";\r\nimport * as domHelpers from \"./utils/dom_helpers\";\r\n\r\nexport default function(gantt) {\r\n\r\n\tvar boxAttribute = \"data-dhxbox\";\r\n\r\n\tvar _dhx_msg_cfg = null;\r\n\r\n\tfunction callback(config, result) {\r\n\t\tvar usercall = config.callback;\r\n\t\tmodalBox.hide(config.box);\r\n\r\n\t\t_dhx_msg_cfg = config.box = null;\r\n\t\tif (usercall)\r\n\t\t\tusercall(result);\r\n\t}\r\n\r\n\tfunction modal_key(event) {\r\n\t\tif (_dhx_msg_cfg) {\r\n\r\n\t\t\tvar code = event.which || event.keyCode;\r\n\t\t\tvar preventDefault = false;\r\n\r\n\t\t\tif (messageBox.keyboard) {\r\n\t\t\t\tif (code == 13 || code == 32) {\r\n\t\t\t\t\t// default behavior is to confirm/submit popup on space/enter\r\n\t\t\t\t\t// if browser focus is set on button element - do button click instead of default behavior\r\n\t\t\t\t\tvar target = event.target || event.srcElement;\r\n\t\t\t\t\tif (domHelpers.getClassName(target).indexOf(\"gantt_popup_button\") > -1 && target.click) {\r\n\t\t\t\t\t\ttarget.click();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcallback(_dhx_msg_cfg, true);\r\n\t\t\t\t\t\tpreventDefault = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (code == 27) {\r\n\t\t\t\t\tcallback(_dhx_msg_cfg, false);\r\n\t\t\t\t\tpreventDefault = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (preventDefault) {\r\n\t\t\t\tif (event.preventDefault){\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t\treturn !(event.cancelBubble = true);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\tvar eventElement = domHelpers.getRootNode(gantt.$root) || document;\r\n\tgantt.event(eventElement, \"keydown\", modal_key, true);\r\n\r\n\tfunction modality(mode) {\r\n\t\tif (!modality.cover) {\r\n\t\t\tmodality.cover = document.createElement(\"div\");\r\n\t\t\t//necessary for IE only\r\n\t\t\tmodality.cover.onkeydown = modal_key;\r\n\t\t\tmodality.cover.className = \"dhx_modal_cover\";\r\n\t\t\tdocument.body.appendChild(modality.cover);\r\n\t\t}\r\n\r\n\t\tmodality.cover.style.display = mode ? \"inline-block\" : \"none\";\r\n\t}\r\n\r\n\tfunction button(text, className, result) {\r\n\t\tvar buttonAriaAttrs = gantt._waiAria.messageButtonAttrString(text);\r\n\t\tvar name = className.toLowerCase().replace(/ /g, \"_\");\r\n\t\tvar button_css = \"gantt_\" + name + \"_button\";\r\n\t\treturn \"<div \" + buttonAriaAttrs + \" class='gantt_popup_button \" + button_css + \"' data-result='\" + result + \"' result='\" + result + \"' ><div>\" + text + \"</div></div>\";\r\n\t}\r\n\r\n\tfunction info(text) {\r\n\t\tif (!messageBox.area) {\r\n\t\t\tmessageBox.area = document.createElement(\"div\");\r\n\t\t\tmessageBox.area.className = \"gantt_message_area\";\r\n\t\t\tmessageBox.area.style[messageBox.position] = \"5px\";\r\n\t\t}\r\n\t\tif (!domHelpers.isChildOf(messageBox.area, document.body)){\r\n\t\t\tdocument.body.appendChild(messageBox.area);\r\n\t\t}\r\n\r\n\t\tmessageBox.hide(text.id);\r\n\t\tvar message = document.createElement(\"div\");\r\n\t\tmessage.innerHTML = \"<div>\" + text.text + \"</div>\";\r\n\t\tmessage.className = \"gantt-info gantt-\" + text.type;\r\n\t\tmessage.onclick = function () {\r\n\t\t\tmessageBox.hide(text.id);\r\n\t\t\ttext = null;\r\n\t\t};\r\n\r\n\t\tgantt._waiAria.messageInfoAttr(message);\r\n\r\n\t\tif (messageBox.position == \"bottom\" && messageBox.area.firstChild)\r\n\t\t\tmessageBox.area.insertBefore(message, messageBox.area.firstChild);\r\n\t\telse\r\n\t\t\tmessageBox.area.appendChild(message);\r\n\r\n\t\tif (text.expire > 0)\r\n\t\t\tmessageBox.timers[text.id] = window.setTimeout(function () {\r\n\t\t\t\t// GS-1213: We need that when Gantt is destroyed\r\n\t\t\t\tif (messageBox) messageBox.hide(text.id);\r\n\t\t\t}, text.expire);\r\n\r\n\t\tmessageBox.pull[text.id] = message;\r\n\t\tmessage = null;\r\n\r\n\t\treturn text.id;\r\n\t}\r\n\r\n\tfunction getFirstDefined() {\r\n\t\tvar values = [].slice.apply(arguments, [0]);\r\n\r\n\t\tfor (var i = 0; i < values.length; i++) {\r\n\t\t\tif (values[i]) {\r\n\t\t\t\treturn values[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction _boxStructure(config, ok, cancel) {\r\n\t\tvar box = document.createElement(\"div\");\r\n\r\n\t\tvar contentId = utils.uid();\r\n\t\tgantt._waiAria.messageModalAttr(box, contentId);\r\n\r\n\r\n\t\tbox.className = \" gantt_modal_box gantt-\" + config.type;\r\n\t\tbox.setAttribute(boxAttribute, 1);\r\n\r\n\t\tvar inner = '';\r\n\r\n\t\tif (config.width)\r\n\t\t\tbox.style.width = config.width;\r\n\t\tif (config.height)\r\n\t\t\tbox.style.height = config.height;\r\n\t\tif (config.title)\r\n\t\t\tinner += '<div class=\"gantt_popup_title\">' + config.title + '</div>';\r\n\t\tinner += '<div class=\"gantt_popup_text\" id=\"' + contentId + '\"><span>' + (config.content ? '' : config.text) + '</span></div><div  class=\"gantt_popup_controls\">';\r\n\t\tif (ok)\r\n\t\t\tinner += button(getFirstDefined(config.ok, gantt.locale.labels.message_ok, \"OK\"), \"ok\", true);\r\n\t\tif (cancel)\r\n\t\t\tinner += button(getFirstDefined(config.cancel, gantt.locale.labels.message_cancel, \"Cancel\"), \"cancel\", false);\r\n\r\n\t\tif (config.buttons) {\r\n\t\t\tfor (var i = 0; i < config.buttons.length; i++) {\r\n\t\t\t\tvar btn = config.buttons[i];\r\n\t\t\t\tif (typeof btn == \"object\") {\r\n\t\t\t\t\t// Support { label:\"Save\", css:\"main_button\", value:\"save\" }\r\n\t\t\t\t\tvar label = btn.label;\r\n\t\t\t\t\tvar css = btn.css || (\"gantt_\" + btn.label.toLowerCase() + \"_button\");\r\n\t\t\t\t\tvar value = btn.value || i;\r\n\t\t\t\t\tinner += button(label, css, value);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tinner += button(btn, btn, i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tinner += '</div>';\r\n\t\tbox.innerHTML = inner;\r\n\r\n\t\tif (config.content) {\r\n\t\t\tvar node = config.content;\r\n\t\t\tif (typeof node == \"string\")\r\n\t\t\t\tnode = document.getElementById(node);\r\n\t\t\tif (node.style.display == 'none')\r\n\t\t\t\tnode.style.display = \"\";\r\n\t\t\tbox.childNodes[config.title ? 1 : 0].appendChild(node);\r\n\t\t}\r\n\r\n\t\tbox.onclick = function (event) {\r\n\t\t\tvar source = event.target || event.srcElement;\r\n\t\t\tif (!source.className) source = source.parentNode;\r\n\t\t\tif (domHelpers.closest(source, \".gantt_popup_button\")) {\r\n\t\t\t\tvar result = source.getAttribute(\"data-result\");\r\n\t\t\t\tresult = (result == \"true\") || (result == \"false\" ? false : result);\r\n\t\t\t\tcallback(config, result);\r\n\t\t\t}\r\n\t\t};\r\n\t\tconfig.box = box;\r\n\t\tif (ok || cancel)\r\n\t\t\t_dhx_msg_cfg = config;\r\n\r\n\t\treturn box;\r\n\t}\r\n\r\n\tfunction _createBox(config, ok, cancel) {\r\n\t\tvar box = config.tagName ? config : _boxStructure(config, ok, cancel);\r\n\r\n\t\tif (!config.hidden)\r\n\t\t\tmodality(true);\r\n\t\tdocument.body.appendChild(box);\r\n\t\tvar x = Math.abs(Math.floor(((window.innerWidth || document.documentElement.offsetWidth) - box.offsetWidth) / 2));\r\n\t\tvar y = Math.abs(Math.floor(((window.innerHeight || document.documentElement.offsetHeight) - box.offsetHeight) / 2));\r\n\t\tif (config.position == \"top\")\r\n\t\t\tbox.style.top = \"-3px\";\r\n\t\telse\r\n\t\t\tbox.style.top = y + 'px';\r\n\t\tbox.style.left = x + 'px';\r\n\t\t//necessary for IE only\r\n\t\tbox.onkeydown = modal_key;\r\n\r\n\t\tmodalBox.focus(box);\r\n\r\n\t\tif (config.hidden)\r\n\t\t\tmodalBox.hide(box);\r\n\r\n\t\tgantt.callEvent(\"onMessagePopup\", [box]);\r\n\t\treturn box;\r\n\t}\r\n\r\n\tfunction alertPopup(config) {\r\n\t\treturn _createBox(config, true, false);\r\n\t}\r\n\r\n\tfunction confirmPopup(config) {\r\n\t\treturn _createBox(config, true, true);\r\n\t}\r\n\r\n\tfunction boxPopup(config) {\r\n\t\treturn _createBox(config);\r\n\t}\r\n\r\n\tfunction box_params(text, type, callback) {\r\n\t\tif (typeof text != \"object\") {\r\n\t\t\tif (typeof type == \"function\") {\r\n\t\t\t\tcallback = type;\r\n\t\t\t\ttype = \"\";\r\n\t\t\t}\r\n\t\t\ttext = {text: text, type: type, callback: callback};\r\n\t\t}\r\n\t\treturn text;\r\n\t}\r\n\r\n\tfunction params(text, type, expire, id) {\r\n\t\tif (typeof text != \"object\")\r\n\t\t\ttext = {text: text, type: type, expire: expire, id: id};\r\n\t\ttext.id = text.id || utils.uid();\r\n\t\ttext.expire = text.expire || messageBox.expire;\r\n\t\treturn text;\r\n\t}\r\n\r\n\tvar alertBox = function () {\r\n\t\tvar text = box_params.apply(this, arguments);\r\n\t\ttext.type = text.type || \"confirm\";\r\n\t\treturn alertPopup(text);\r\n\t};\r\n\tvar confirmBox = function () {\r\n\t\tvar text = box_params.apply(this, arguments);\r\n\t\ttext.type = text.type || \"alert\";\r\n\t\treturn confirmPopup(text);\r\n\t};\r\n\tvar modalBox = function () {\r\n\t\tvar text = box_params.apply(this, arguments);\r\n\t\ttext.type = text.type || \"alert\";\r\n\t\treturn boxPopup(text);\r\n\t};\r\n\tmodalBox.hide = function (node) {\r\n\t\twhile (node && node.getAttribute && !node.getAttribute(boxAttribute))\r\n\t\t\tnode = node.parentNode;\r\n\t\tif (node) {\r\n\t\t\tnode.parentNode.removeChild(node);\r\n\t\t\tmodality(false);\r\n\r\n\t\t\tgantt.callEvent(\"onAfterMessagePopup\", [node]);\r\n\t\t}\r\n\t};\r\n\r\n\tmodalBox.focus = function (node) {\r\n\t\tsetTimeout(function () {\r\n\t\t\tvar focusable = domHelpers.getFocusableNodes(node);\r\n\t\t\tif (focusable.length) {\r\n\t\t\t\tif (focusable[0].focus) focusable[0].focus();\r\n\t\t\t}\r\n\t\t}, 1);\r\n\t};\r\n\r\n\tvar messageBox = function (text, type, expire, id) {\r\n\t\ttext = params.apply(this, arguments);\r\n\t\ttext.type = text.type || \"info\";\r\n\r\n\t\tvar subtype = text.type.split(\"-\")[0];\r\n\t\tswitch (subtype) {\r\n\t\t\tcase \"alert\":\r\n\t\t\t\treturn alertPopup(text);\r\n\t\t\tcase \"confirm\":\r\n\t\t\t\treturn confirmPopup(text);\r\n\t\t\tcase \"modalbox\":\r\n\t\t\t\treturn boxPopup(text);\r\n\t\t\tdefault:\r\n\t\t\t\treturn info(text);\r\n\t\t}\r\n\t};\r\n\r\n\tmessageBox.seed = (new Date()).valueOf();\r\n\tmessageBox.uid = utils.uid;\r\n\tmessageBox.expire = 4000;\r\n\tmessageBox.keyboard = true;\r\n\tmessageBox.position = \"top\";\r\n\tmessageBox.pull = {};\r\n\tmessageBox.timers = {};\r\n\r\n\tmessageBox.hideAll = function () {\r\n\t\tfor (var key in messageBox.pull)\r\n\t\t\tmessageBox.hide(key);\r\n\t};\r\n\tmessageBox.hide = function (id) {\r\n\t\tvar obj = messageBox.pull[id];\r\n\t\tif (obj && obj.parentNode) {\r\n\t\t\twindow.setTimeout(function () {\r\n\t\t\t\tobj.parentNode.removeChild(obj);\r\n\t\t\t\tobj = null;\r\n\t\t\t}, 2000);\r\n\t\t\tobj.className += \" hidden\";\r\n\r\n\t\t\tif (messageBox.timers[id])\r\n\t\t\t\twindow.clearTimeout(messageBox.timers[id]);\r\n\t\t\tdelete messageBox.pull[id];\r\n\t\t}\r\n\t};\r\n\r\n\tvar popups = [];\r\n\tgantt.attachEvent(\"onMessagePopup\", function(box){\r\n\t\tpopups.push(box);\r\n\t});\r\n\tgantt.attachEvent(\"onAfterMessagePopup\", function(box){\r\n\t\tfor(var i = 0; i < popups.length; i++){\r\n\t\t\tif(popups[i] === box){\r\n\t\t\t\tpopups.splice(i, 1);\r\n\t\t\t\ti--;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onDestroy\", function(){\r\n\t\tif(modality.cover && modality.cover.parentNode){\r\n\t\t\tmodality.cover.parentNode.removeChild(modality.cover);\r\n\t\t}\r\n\r\n\t\tfor(var i = 0; i < popups.length; i++){\r\n\t\t\tif(popups[i].parentNode){\r\n\t\t\t\tpopups[i].parentNode.removeChild(popups[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tpopups = null;\r\n\r\n\t\tif(messageBox.area && messageBox.area.parentNode){\r\n\t\t\tmessageBox.area.parentNode.removeChild(messageBox.area);\r\n\t\t}\r\n\t\tmessageBox = null;\r\n\t});\r\n\r\n\treturn {\r\n\t\talert: alertBox,\r\n\t\tconfirm: confirmBox,\r\n\t\tmessage: messageBox,\r\n\t\tmodalbox: modalBox\r\n\t};\r\n};","import * as utils from \"../../utils/utils\";\r\n\r\nfunction extendSettings (store, parentSettings){\r\n\tvar own = this.$config[store];\r\n\r\n\tif(own){\r\n\t\tif(!own.$extendedConfig){\r\n\t\t\town.$extendedConfig = true;\r\n\t\t\tObject.setPrototypeOf(own, parentSettings);\r\n\t\t}\r\n\t\treturn own;\r\n\t}else{\r\n\t\treturn parentSettings;\r\n\t}\r\n}\r\n\r\nvar configurable = function(parentView){\r\n\tvar parentConfig,\r\n\t\tparentTemplates;\r\n\r\n\treturn {\r\n\t\t$getConfig: function(){\r\n\t\t\tif(!parentConfig){\r\n\t\t\t\tparentConfig = parentView ? parentView.$getConfig() : this.$gantt.config;\r\n\t\t\t}\r\n\t\t\tif(!this.$config.config){\r\n\t\t\t\treturn parentConfig;\r\n\t\t\t}else{\r\n\t\t\t\treturn extendSettings.call(this, \"config\", parentConfig);\r\n\t\t\t}\r\n\t\t},\r\n\t\t$getTemplates: function(){\r\n\t\t\tif(!parentTemplates){\r\n\t\t\t\tparentTemplates = parentView ? parentView.$getTemplates() : this.$gantt.templates;\r\n\t\t\t}\r\n\t\t\tif(!this.$config.templates){\r\n\t\t\t\treturn parentTemplates;\r\n\t\t\t}else{\r\n\t\t\t\treturn extendSettings.call(this, \"templates\", parentTemplates);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n};\r\n\r\nexport default function(obj, parent){\r\n\tutils.mixin(obj, configurable(parent));\r\n};","import * as utils from \"../../utils/utils\";\r\nimport configurable from \"./configurable\";\r\n\r\nvar uiFactory = function createFactory(gantt){\r\n\tvar views = {};\r\n\r\n\tfunction ui(cell, parentView) {\r\n\t\tvar content;\r\n\t\tvar view = \"cell\";\r\n\t\tif (cell.view){\r\n\t\t\tview = \"viewcell\";\r\n\t\t}else if (cell.resizer) {\r\n\t\t\tview = \"resizer\";\r\n\t\t}\r\n\t\telse if (cell.rows || cell.cols) {\r\n\t\t\tview = \"layout\";\r\n\t\t}\r\n\t\telse if (cell.views) {\r\n\t\t\tview = \"multiview\";\r\n\t\t}\r\n\r\n\t\tcontent = createView.call(this, view, null, cell, parentView);\r\n\t\treturn content;\r\n\t}\r\n\t\r\n\tvar createdViews = {};\r\n\r\n\tfunction createView(name, parent, config, parentView) {\r\n\t\tvar creator = views[name];\r\n\r\n\t\tif(!creator || !creator.create)\r\n\t\t\treturn false;\r\n\r\n\t\tif(name == \"resizer\" && !config.mode){\r\n\t\t\tif(parentView.$config.cols){\r\n\t\t\t\tconfig.mode = \"x\";\r\n\t\t\t}else{\r\n\t\t\t\tconfig.mode = \"y\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(name == \"viewcell\" && config.view == \"scrollbar\" && !config.scroll){\r\n\t\t\tif(parentView.$config.cols){\r\n\t\t\t\tconfig.scroll = \"y\";\r\n\t\t\t}else{\r\n\t\t\t\tconfig.scroll = \"x\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar config = utils.copy(config);\r\n\r\n\t\tif(!config.id && !createdViews[config.view]){\r\n\t\t\tconfig.id = config.view;\r\n\t\t}\r\n\r\n\t\tif(config.id && !config.css){\r\n\t\t\tconfig.css = config.id+\"_cell\";\r\n\t\t}\r\n\r\n\t\tvar view = new creator.create(parent, config, this, gantt);\r\n\r\n\t\tif(creator.configure){\r\n\t\t\tcreator.configure(view);\r\n\t\t}\r\n\r\n\t\tconfigurable(view, parentView);\r\n\t\tif(!view.$id){\r\n\t\t\tview.$id = config.id || gantt.uid();\r\n\t\t}\r\n\r\n\t\tif(!view.$parent && typeof parent == \"object\"){\r\n\t\t\tview.$parent = parent;\r\n\t\t}\r\n\t\tif(!view.$config){\r\n\t\t\tview.$config = config;\r\n\t\t}\r\n\r\n\t\tif(createdViews[view.$id]){\r\n\t\t\tview.$id = gantt.uid();\r\n\t\t}\r\n\r\n\t\tcreatedViews[view.$id] = view;\r\n\r\n\t\treturn view;\r\n\t}\r\n\r\n\tfunction reset(){\r\n\t\tcreatedViews = {};\r\n\t}\r\n\r\n\tfunction register(name, viewConstructor, configure){\r\n\t\tviews[name] = {create: viewConstructor, configure: configure};\r\n\t}\r\n\r\n\tfunction getView(id){\r\n\t\treturn createdViews[id];\r\n\t}\r\n\r\n\tvar factory = {\r\n\t\tinitUI:ui,\r\n\t\treset: reset,\r\n\t\tregisterView: register,\r\n\t\tcreateView: createView,\r\n\t\tgetView: getView\r\n\t};\r\n\r\n\treturn factory;\r\n};\r\n\r\nexport default {\r\n\tcreateFactory: uiFactory\r\n};\r\n\r\n","import * as domHelpers from \"./utils/dom_helpers\";\r\n\r\nvar createMouseHandler = (function(domHelpers) {\r\n\treturn function (gantt) {\r\n\t\tvar eventHandlers = {\r\n\t\t\t\"click\": {},\r\n\t\t\t\"doubleclick\": {},\r\n\t\t\t\"contextMenu\": {}\r\n\t\t};\r\n\r\n\t\tfunction addEventTarget(event, className, handler, root) {\r\n\t\t\tif(!eventHandlers[event][className]){\r\n\t\t\t\teventHandlers[event][className] = [];\r\n\t\t\t}\r\n\r\n\t\t\teventHandlers[event][className].push({\r\n\t\t\t\thandler: handler,\r\n\t\t\t\troot: root\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction callHandler(eventName, className, root, args) {\r\n\t\t\tvar handlers = eventHandlers[eventName][className];\r\n\t\t\tif(handlers){\r\n\t\t\t\tfor(var i = 0; i < handlers.length; i++){\r\n\t\t\t\t\tif(!(root || handlers[i].root) || handlers[i].root === root){\r\n\t\t\t\t\t\thandlers[i].handler.apply(this, args);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction onClick(e) {\r\n\t\t\te = e || window.event;\r\n\t\t\tvar id = gantt.locate(e);\r\n\r\n\t\t\tvar handlers = findEventHandlers(e, eventHandlers.click);\r\n\t\t\tvar res = true;\r\n\t\t\tif (id !== null) {\r\n\t\t\t\tres = !gantt.checkEvent(\"onTaskClick\") || gantt.callEvent(\"onTaskClick\", [id, e]);\r\n\t\t\t} else {\r\n\t\t\t\tgantt.callEvent(\"onEmptyClick\", [e]);\r\n\t\t\t}\r\n\r\n\t\t\tif (res) {\r\n\t\t\t\tvar default_action = callEventHandlers(handlers, e, id);\r\n\t\t\t\tif (!default_action)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t// GS-1025: if we don't do that, the dropdown or date select will be closed for unselected tasks\r\n\t\t\t\t// GS-1078: or for the built-in select inline editor\r\n\t\t\t\tswitch(e.target.nodeName) {\r\n\t\t\t\t\tcase \"SELECT\":\r\n\t\t\t\t\tcase 'INPUT':\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//allow task selection when the multiselect plugin is not enabled\r\n\t\t\t\tif (id && gantt.getTask(id) && !gantt._multiselect && gantt.config.select_task) {\r\n\t\t\t\t\tgantt.selectTask(id);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction onContextMenu(e) {\r\n\t\t\te = e || window.event;\r\n\t\t\tvar src = e.target || e.srcElement,\r\n\t\t\t\ttaskId = gantt.locate(src),\r\n\t\t\t\tlinkId = gantt.locate(src, gantt.config.link_attribute);\r\n\r\n\t\t\tvar res = !gantt.checkEvent(\"onContextMenu\") || gantt.callEvent(\"onContextMenu\", [taskId, linkId, e]);\r\n\t\t\tif (!res) {\r\n\t\t\t\tif (e.preventDefault)\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\telse\r\n\t\t\t\t\te.returnValue = false;\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t}\r\n\r\n\t\tfunction findEventHandlers(e, hash){\r\n\t\t\tvar trg = e.target || e.srcElement;\r\n\t\t\tvar handlers = [];\r\n\t\t\twhile (trg) {\r\n\t\t\t\tvar css = domHelpers.getClassName(trg);\r\n\t\t\t\tif (css) {\r\n\t\t\t\t\tcss = css.split(\" \");\r\n\t\t\t\t\tfor (var i = 0; i < css.length; i++) {\r\n\t\t\t\t\t\tif (!css[i]) continue;\r\n\t\t\t\t\t\tif (hash[css[i]]) {\r\n\t\t\t\t\t\t\tvar delegateHandlers = hash[css[i]];\r\n\r\n\t\t\t\t\t\t\tfor(var h = 0; h < delegateHandlers.length; h++){\r\n\t\t\t\t\t\t\t\tif(delegateHandlers[h].root){\r\n\t\t\t\t\t\t\t\t\tif(!domHelpers.isChildOf(trg, delegateHandlers[h].root)){\r\n\t\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\thandlers.push(delegateHandlers[h].handler);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\ttrg = trg.parentNode;\r\n\t\t\t}\r\n\t\t\treturn handlers;\r\n\t\t}\r\n\r\n\t\tfunction callEventHandlers(handlers, e, id){\r\n\t\t\tvar res = true;\r\n\r\n\t\t\tfor(var i = 0; i < handlers.length; i++){\r\n\t\t\t\tvar handlerResult =  handlers[i].call(gantt, e, id, e.target || e.srcElement);\r\n\t\t\t\tres = res && !(typeof handlerResult != \"undefined\" && handlerResult !== true);\r\n\t\t\t}\r\n\r\n\t\t\treturn res;\r\n\t\t}\r\n\r\n\r\n\t\tfunction onDoubleClick(e) {\r\n\t\t\te = e || window.event;\r\n\t\t\tvar id = gantt.locate(e);\r\n\r\n\t\t\tvar handlers = findEventHandlers(e, eventHandlers.doubleclick);\r\n\t\t\t// when doubleclick fired not on task, id === null\r\n\t\t\tvar res = !gantt.checkEvent(\"onTaskDblClick\") || id === null || gantt.callEvent(\"onTaskDblClick\", [id, e]);\r\n\t\t\tif (res) {\r\n\t\t\t\tvar default_action = callEventHandlers(handlers, e, id);\r\n\t\t\t\tif (!default_action)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tif (id !== null && gantt.getTask(id)) {\r\n\t\t\t\t\tif (res && gantt.config.details_on_dblclick && !gantt.isReadonly(id)) {\r\n\t\t\t\t\t\tgantt.showLightbox(id);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction onMouseMove(e) {\r\n\t\t\tif (gantt.checkEvent(\"onMouseMove\")) {\r\n\t\t\t\tvar id = gantt.locate(e);\r\n\t\t\t\tgantt._last_move_event = e;\r\n\t\t\t\tgantt.callEvent(\"onMouseMove\", [id, e]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction detach(eventName, className, handler, root) {\r\n\t\t\tif (eventHandlers[eventName] && eventHandlers[eventName][className]) {\r\n\t\t\t\tvar handlers = eventHandlers[eventName];\r\n\t\t\t\tvar elementHandlers = handlers[className];\r\n\t\t\t\tfor(var i = 0; i < elementHandlers.length; i++){\r\n\t\t\t\t\tif(elementHandlers[i].root == root){\r\n\t\t\t\t\t\telementHandlers.splice(i, 1);\r\n\t\t\t\t\t\ti--;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(!elementHandlers.length){\r\n\t\t\t\t\tdelete handlers[className];\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar domEvents = gantt._createDomEventScope();\r\n\r\n\t\tfunction reset(node){\r\n\r\n\t\t\tdomEvents.detachAll();\r\n\r\n\t\t\tif(node){\r\n\t\t\t\tdomEvents.attach(node, \"click\", onClick);\r\n\t\t\t\tdomEvents.attach(node, \"dblclick\", onDoubleClick);\r\n\t\t\t\tdomEvents.attach(node, \"mousemove\", onMouseMove);\r\n\t\t\t\tdomEvents.attach(node, \"contextmenu\", onContextMenu);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\r\n\t\treturn {\r\n\t\t\treset: reset,\r\n\t\t\tglobal: function(event, classname, handler){\r\n\t\t\t\taddEventTarget(event, classname, handler, null);\r\n\t\t\t},\r\n\t\t\tdelegate: addEventTarget,\r\n\t\t\tdetach: detach,\r\n\t\t\tcallHandler: callHandler,\r\n\t\t\tonDoubleClick: onDoubleClick,\r\n\t\t\tonMouseMove: onMouseMove,\r\n\t\t\tonContextMenu: onContextMenu,\r\n\t\t\tonClick: onClick,\r\n\t\t\tdestructor: function(){\r\n\t\t\t\treset();\r\n\t\t\t\teventHandlers = null;\r\n\t\t\t\tdomEvents = null;\r\n\t\t\t}\r\n\r\n\t\t};\r\n\t};\r\n\r\n})(domHelpers);\r\n\r\n\r\nexport default {\r\n\tinit:createMouseHandler\r\n};","export default function(viewport, box, gantt){\r\n\tif(!box){\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif(box.left > viewport.x_end || box.left + box.width < viewport.x){\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif(box.top > viewport.y_end || box.top + box.height < viewport.y){\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\treturn true;\r\n};","export default function(gantt){\r\n\treturn gantt.config.smart_rendering && gantt._smart_render;\r\n};","export default function(item, view, config){\r\n\treturn {\r\n\t\ttop: view.getItemTop(item.id),\r\n\t\theight: view.getItemHeight(item.id),\r\n\t\tleft: 0,\r\n\t\tright: Infinity\r\n\t};\r\n};","export default function getVisibleTasksRange(gantt, view, config, datastore, viewport){\r\n\tvar buffer = 1;\r\n\tvar start = view.getItemIndexByTopPosition(viewport.y) || 0;\r\n\tvar end = view.getItemIndexByTopPosition(viewport.y_end) || datastore.count();\r\n\tvar indexStart = Math.max(0, start - buffer);\r\n\tvar indexEnd =  Math.min(datastore.count(), end + buffer);\r\n\t// GS-2481 and GS-1715, need to take into account selected task when using keyboard shortcuts and when the inline editor is opened \r\n\tconst extraTasksIds= [];\r\n\tif (gantt.config.keyboard_navigation && gantt.getSelectedId()) {\r\n\t\tlet task = gantt.getTask(gantt.getSelectedId());\r\n\t\t// GS-2661 and GS-2835: The selected task shouldn't be a split child \r\n\t\t// and its parent shouldn't be collapsed\r\n\t\tif(task.$expanded_branch && !task.$split_subtask) {\r\n\t\t\textraTasksIds.push(gantt.getSelectedId());\r\n\t\t}\r\n\t}\r\n\tif (gantt.$ui.getView(\"grid\") && gantt.ext.inlineEditors && gantt.ext.inlineEditors.getState().id) {\r\n\t\tlet inlineEditorId = gantt.ext.inlineEditors.getState().id;\r\n\t\tif (datastore.exists(inlineEditorId)){\r\n\t\t\textraTasksIds.push(inlineEditorId);\r\n\t\t}\r\n\t}\r\n\treturn {\r\n\t\tstart: indexStart,\r\n\t\tend: indexEnd,\r\n\t\tids: extraTasksIds \r\n\t};\r\n};","import genericViewPortChecker from \"./viewport/is_in_viewport\";\r\nimport isLegacyRender from \"./is_legacy_smart_render\";\r\nimport basicGetRectangle from \"./viewport/get_grid_row_rectangle\";\r\nimport basicGetRange from \"./viewport/get_visible_bars_range\";\r\nvar rendererFactory = function(gantt){\r\n\r\n\t//hash of dom elements is needed to redraw single bar/link\r\n\tvar task_area_pulls = {},\r\n\t\ttask_area_renderers = {};\r\n\r\n\tfunction getView(layer){\r\n\t\tvar view = null;\r\n\t\tif (typeof layer.view === \"string\") {\r\n\t\t\tview = gantt.$ui.getView(layer.view);\r\n\t\t} else if (layer.view) {\r\n\t\t\tview = layer.view;\r\n\t\t}\r\n\t\treturn view;\r\n\t}\r\n\r\n\tfunction getRenderer(id, layer, node) {\r\n\t\t\r\n\t\tif (task_area_renderers[id])\r\n\t\t\treturn task_area_renderers[id];\r\n\r\n\t\tif (!layer.renderer)\r\n\t\t\tgantt.assert(false, \"Invalid renderer call\");\r\n\r\n\t\tvar renderMethod = null;\r\n\t\tvar updateMethod = null;\r\n\t\tvar getRectangle = null;\r\n\t\tvar renderCallbackMethod = null;\r\n\t\tvar specializedViewPortChecker = null;\r\n\r\n\t\tif(typeof layer.renderer === \"function\"){\r\n\t\t\trenderMethod = layer.renderer;\r\n\t\t\tgetRectangle = basicGetRectangle;\r\n\t\t}else{\r\n\t\t\trenderMethod = layer.renderer.render;\r\n\t\t\tupdateMethod = layer.renderer.update;\r\n\t\t\trenderCallbackMethod = layer.renderer.onrender;\r\n\t\t\t\r\n\t\t\tif(layer.renderer.isInViewPort){\r\n\t\t\t\tspecializedViewPortChecker = layer.renderer.isInViewPort;\r\n\t\t\t}else{\r\n\t\t\t\tgetRectangle = layer.renderer.getRectangle;\r\n\t\t\t}\r\n\r\n\t\t\tif (!getRectangle && getRectangle !== null) {\r\n\t\t\t\tgetRectangle = basicGetRectangle;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar filter = layer.filter;\r\n\r\n\t\tif (node)\r\n\t\t\tnode.setAttribute(gantt.config.layer_attribute, true);\r\n\r\n\t\ttask_area_renderers[id] = {\r\n\t\t\trender_item: function (item, container, viewPort, layerView, viewConfig) {\r\n\t\t\t\tcontainer = container || node;\r\n\t\t\t\tif (filter) {\r\n\t\t\t\t\tif (!filter(item)) {\r\n\t\t\t\t\t\tthis.remove_item(item.id);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar view = layerView || getView(layer);\r\n\t\t\t\tvar config = viewConfig || (view ? view.$getConfig() : null);\r\n\t\t\t\tvar rendererViewPort = viewPort;\r\n\t\t\t\tif(!rendererViewPort && config && config.smart_rendering){\r\n\t\t\t\t\trendererViewPort = view.getViewPort();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar dom = null;\r\n\t\t\t\tif(!isLegacyRender(gantt) && (getRectangle || specializedViewPortChecker) && rendererViewPort){\r\n\t\t\t\t\tvar isVisible = false;\r\n\t\t\t\t\tif(specializedViewPortChecker){\r\n\t\t\t\t\t\tisVisible = specializedViewPortChecker(item, rendererViewPort, view, config, gantt);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tisVisible = genericViewPortChecker(rendererViewPort, getRectangle(item, view, config, gantt), gantt);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(isVisible){\r\n\t\t\t\t\t\tdom = renderMethod.call(gantt, item, view, config, rendererViewPort);\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdom = renderMethod.call(gantt, item, view, config, rendererViewPort);\r\n\t\t\t\t}\r\n\t\t\t\tthis.append(item, dom, container);\r\n\r\n\t\t\t\tvar useBuffer = container.nodeType == 11;//DocumentFragment\r\n\t\t\t\tif(renderCallbackMethod && !useBuffer && dom) {\r\n\t\t\t\t\trenderCallbackMethod.call(gantt, item, dom, view);\r\n\t\t\t\t} \r\n\t\t\t},\r\n\r\n\t\t\tclear: function (container) {\r\n\t\t\t\t// GS-3018: clear task_bg_render layer data\r\n\t\t\t\tif(layer.renderer && layer.renderer.clear){\r\n\t\t\t\t\tlayer.renderer.clear();\r\n\t\t\t\t}\r\n\t\t\t\tthis.rendered = task_area_pulls[id] = {};\r\n\t\t\t\tif(!layer.append)\r\n\t\t\t\t\tthis.clear_container(container);\r\n\t\t\t},\r\n\t\t\tclear_container: function (container) {\r\n\t\t\t\tcontainer = container || node;\r\n\t\t\t\tif (container){\r\n\t\t\t\t\tcontainer.innerHTML = \"\";\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tget_visible_range: function(datastore){\r\n\t\t\t\tvar view = getView(layer);\r\n\t\t\t\tvar viewport;\r\n\t\t\t\tvar viewConfig = view ? view.$getConfig() : null;\r\n\t\t\t\tif(viewConfig && viewConfig.smart_rendering){\r\n\t\t\t\t\tviewport = view.getViewPort();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar range;\r\n\t\t\t\tif(view && viewport){\r\n\t\t\t\t\tif(typeof layer.renderer === \"function\"){\r\n\t\t\t\t\t\trange = basicGetRange(gantt, view, viewConfig, datastore, viewport);\r\n\t\t\t\t\t}else if(layer.renderer && layer.renderer.getVisibleRange){\r\n\t\t\t\t\t\trange = layer.renderer.getVisibleRange(gantt, view, viewConfig, datastore, viewport);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(!range){\r\n\t\t\t\t\trange = {\r\n\t\t\t\t\t\tstart: 0,\r\n\t\t\t\t\t\tend: datastore.count()\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn range;\r\n\t\t\t},\r\n\t\t\tprepare_data: function(items){\r\n\t\t\t\tif(layer.renderer && layer.renderer.prepareData){\r\n\t\t\t\t\treturn layer.renderer.prepareData(items, gantt, layer);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\trender_items: function (items, container) {\r\n\t\t\t\tcontainer = container || node;\r\n\r\n\t\t\t\tvar buffer = document.createDocumentFragment();\r\n\t\t\t\tthis.clear(container);\r\n\r\n\t\t\t\tvar viewPort = null;\r\n\t\t\t\tvar view = getView(layer);\r\n\t\t\t\tvar viewConfig = view ? view.$getConfig() : null;\r\n\t\t\t\tif(viewConfig && viewConfig.smart_rendering){\r\n\t\t\t\t\tviewPort = view.getViewPort();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (var i = 0, vis = items.length; i < vis; i++) {\r\n\t\t\t\t\tthis.render_item(items[i], buffer, viewPort, view, viewConfig);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontainer.appendChild(buffer, container);\r\n\r\n\t\t\t\tvar itemsSearch = {};\r\n\t\t\t\titems.forEach(function(item){\r\n\t\t\t\t\titemsSearch[item.id] = item;\r\n\t\t\t\t});\r\n\t\t\t\tvar renderedItems = {};\r\n\t\t\t\tif (renderCallbackMethod) {\r\n\t\t\t\t\tvar newElements = {};\r\n\t\t\t\t\tfor(var i in this.rendered) {\r\n\t\t\t\t\t\tif(!renderedItems[i]){\r\n\t\t\t\t\t\t\tnewElements[i] = this.rendered[i];\r\n\t\t\t\t\t\t\trenderCallbackMethod.call(gantt, itemsSearch[i], this.rendered[i], view);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tupdate_items: function (items, container) {\r\n\t\t\t\tvar view = getView(layer);\r\n\t\t\t\tvar viewConfig = view ? view.$getConfig() : null;\r\n\t\t\t\tif(!view || !view.$getConfig().smart_rendering || isLegacyRender(gantt)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!this.rendered){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!(getRectangle || specializedViewPortChecker)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontainer = container || node;\r\n\r\n\t\t\t\tvar buffer = document.createDocumentFragment();\r\n\r\n\t\t\t\tvar viewPort = null;\r\n\t\t\t\tif(view){\r\n\t\t\t\t\tviewPort = view.getViewPort();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar itemsSearch = {};\r\n\t\t\t\titems.forEach(function(item){\r\n\t\t\t\t\titemsSearch[item.id] = item;\r\n\t\t\t\t});\r\n\t\t\t\tvar renderedItems = {};\r\n\r\n\t\t\t\tvar nodesToRemove = {};\r\n\t\t\t\tfor(var i in this.rendered){\r\n\t\t\t\t\tnodesToRemove[i] = true;\r\n\t\t\t\t\trenderedItems[i] = true;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvar renderCalledFor = {};\r\n\t\t\t\tfor (var i = 0, vis = items.length; i < vis; i++) {\r\n\t\t\t\t\tvar item = items[i];\r\n\t\t\t\t\tvar itemNode = this.rendered[item.id];\r\n\t\t\t\t\tnodesToRemove[item.id] = false;\r\n\t\t\t\t\tif (itemNode && itemNode.parentNode) {\r\n\t\t\t\t\t\tvar isVisible = false;\r\n\t\t\t\t\t\tif(specializedViewPortChecker){\r\n\t\t\t\t\t\t\tisVisible = specializedViewPortChecker(item, viewPort, view, viewConfig, gantt);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tisVisible = genericViewPortChecker(viewPort, getRectangle(item, view, viewConfig, gantt), gantt);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (!isVisible) {\r\n\t\t\t\t\t\t\tnodesToRemove[item.id] = true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif(updateMethod){\r\n\t\t\t\t\t\t\t\tupdateMethod.call(gantt, item, itemNode, view, viewConfig, viewPort);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis.restore(item, buffer);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trenderCalledFor[items[i].id] = true;\r\n\t\t\t\t\t\tthis.render_item(items[i], buffer, viewPort, view, viewConfig);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor(var i in nodesToRemove){\r\n\t\t\t\t\tif(nodesToRemove[i]){\r\n\t\t\t\t\t\tthis.hide(i);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(buffer.childNodes.length){\r\n\t\t\t\t\tcontainer.appendChild(buffer, container);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (renderCallbackMethod) {\r\n\t\t\t\t\tvar newElements = {};\r\n\t\t\t\t\tfor(var i in this.rendered) {\r\n\t\t\t\t\t\tif(!renderedItems[i] || renderCalledFor[i]){\r\n\t\t\t\t\t\t\tnewElements[i] = this.rendered[i];\r\n\t\t\t\t\t\t\trenderCallbackMethod.call(gantt, itemsSearch[i], this.rendered[i], view);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tappend: function (item, node, container) {\r\n\t\t\t\tif(!this.rendered){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!node) {\r\n\t\t\t\t\tif (this.rendered[item.id]) {\r\n\t\t\t\t\t\tthis.remove_item(item.id);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.rendered[item.id] && this.rendered[item.id].parentNode) {\r\n\t\t\t\t\tthis.replace_item(item.id, node);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcontainer.appendChild(node);\r\n\t\t\t\t}\r\n\t\t\t\tthis.rendered[item.id] = node;\r\n\t\t\t},\r\n\t\t\treplace_item: function (item_id, newNode) {\r\n\t\t\t\tvar item = this.rendered[item_id];\r\n\t\t\t\tif (item && item.parentNode) {\r\n\t\t\t\t\titem.parentNode.replaceChild(newNode, item);\r\n\r\n\t\t\t\t}\r\n\t\t\t\tthis.rendered[item_id] = newNode;\r\n\t\t\t},\r\n\t\t\tremove_item: function (item_id) {\r\n\t\t\t\tthis.hide(item_id);\r\n\t\t\t\tdelete this.rendered[item_id];\r\n\t\t\t},\r\n\t\t\thide: function (item_id) {\r\n\t\t\t\tvar item = this.rendered[item_id];\r\n\t\t\t\tif (item && item.parentNode) {\r\n\t\t\t\t\titem.parentNode.removeChild(item);\r\n\t\t\t\t}\r\n\t\t\t\tdelete this.rendered[item_id];\r\n\t\t\t},\r\n\t\t\trestore: function (item, container) {\r\n\t\t\t\tvar dom = this.rendered[item.id];\r\n\t\t\t\tif (dom) {\r\n\t\t\t\t\tif (!dom.parentNode) {\r\n\t\t\t\t\t\tthis.append(item, dom, container || node);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.render_item(item, container || node);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tchange_id: function (oldid, newid) {\r\n\t\t\t\tthis.rendered[newid] = this.rendered[oldid];\r\n\t\t\t\tdelete this.rendered[oldid];\r\n\t\t\t},\r\n\t\t\trendered: task_area_pulls[id],\r\n\t\t\tnode: node,\r\n\t\t\tdestructor: function () {\r\n\t\t\t\tthis.clear();\r\n\t\t\t\tdelete task_area_renderers[id];\r\n\t\t\t\tdelete task_area_pulls[id];\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\treturn task_area_renderers[id];\r\n\t}\r\n\r\n\r\n\tfunction clearRenderers() {\r\n\t\tfor (var i in task_area_renderers) {\r\n\t\t\tgetRenderer(i).destructor();\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\tgetRenderer: getRenderer,\r\n\t\tclearRenderers: clearRenderers\r\n\t};\r\n\r\n};\r\n\r\nexport default rendererFactory;","import renderFactoryProvider from \"./render_factory\";\r\nimport * as utils from \"../../../utils/utils\";\r\nimport * as domHelpers from \"../utils/dom_helpers\";\r\nimport isLegacyRender from \"./is_legacy_smart_render\";\r\n\r\nvar layerFactory = function(gantt){\r\n\r\n\tvar renderFactory = renderFactoryProvider(gantt);\r\n\treturn {\r\n\tcreateGroup: function (getContainer, relativeRoot, defaultFilters, initLayer) {\r\n\r\n\t\tvar renderGroup = {\r\n\t\t\ttempCollection: [],\r\n\t\t\trenderers: {},\r\n\t\t\tcontainer: getContainer,\r\n\t\t\tfilters: [],\r\n\t\t\tgetLayers: function () {\r\n\t\t\t\tthis._add();// add pending layers\r\n\r\n\t\t\t\tvar res = [];\r\n\t\t\t\tfor (var i in this.renderers) {\r\n\t\t\t\t\tres.push(this.renderers[i]);\r\n\t\t\t\t}\r\n\t\t\t\treturn res;\r\n\t\t\t},\r\n\t\t\tgetLayer: function (id) {\r\n\t\t\t\treturn this.renderers[id];\r\n\t\t\t},\r\n\t\t\t_add: function (layer) {\r\n\t\t\t\tif (layer) {\r\n\t\t\t\t\tlayer.id = layer.id || utils.uid();\r\n\t\t\t\t\tthis.tempCollection.push(layer);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst container = this.container();\r\n\t\t\t\tconst pending = this.tempCollection;\r\n\t\t\t\tfor (let i = 0; i < pending.length; i++) {\r\n\t\t\t\t\tlayer = pending[i];\r\n\t\t\t\t\t// GS-2803: in case of Salesforce domHelpers.isChildOf check with document.body doesn't work\r\n\t\t\t\t\t// instead we check it with isConnected property\r\n\t\t\t\t\tif (!this.container() && !(layer && layer.container && layer.container.isConnected)) continue;\r\n\r\n\t\t\t\t\tlet node = layer.container,\r\n\t\t\t\t\t\tid = layer.id,\r\n\t\t\t\t\t\ttopmost = layer.topmost;\r\n\t\t\t\t\tif (!node.parentNode) {\r\n\t\t\t\t\t\t//insert on top or below the tasks\r\n\t\t\t\t\t\tif (topmost) {\r\n\t\t\t\t\t\t\tcontainer.appendChild(node);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tlet rel = relativeRoot ? relativeRoot() : container.firstChild;\r\n\t\t\t\t\t\t\t// GS-1274: if we don't add the second check, Gantt stops working if\r\n\t\t\t\t\t\t\t// we add the task layer without the timeline and switch to a layout with the timeline\r\n\t\t\t\t\t\t\tif (rel && rel.parentNode == container)\r\n\t\t\t\t\t\t\t\tcontainer.insertBefore(node, rel);\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tcontainer.appendChild(node);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.renderers[id] = renderFactory.getRenderer(\r\n\t\t\t\t\t\tid,\r\n\t\t\t\t\t\tlayer,\r\n\t\t\t\t\t\tnode\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tif (initLayer) {\r\n\t\t\t\t\t\tinitLayer(layer, gantt);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.tempCollection.splice(i, 1);\r\n\t\t\t\t\ti--;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\taddLayer: function (config) {\r\n\t\t\t\tif(config){\r\n\t\t\t\t\tif(typeof config == \"function\"){\r\n\t\t\t\t\t\tconfig = {renderer: config};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(config.filter === undefined){\r\n\t\t\t\t\t\tconfig.filter = mergeFilters(defaultFilters || []);\r\n\t\t\t\t\t}else if(config.filter instanceof Array){\r\n\t\t\t\t\t\tconfig.filter.push(defaultFilters);\r\n\t\t\t\t\t\tconfig.filter = mergeFilters(config.filter);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(!config.container){\r\n\t\t\t\t\t\tconfig.container = document.createElement(\"div\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tconfig.requestUpdate = function(){\r\n\t\t\t\t\t\tif(gantt.config.smart_rendering && !isLegacyRender(gantt)){\r\n\t\t\t\t\t\t\tif(self.renderers[config.id]){\r\n\t\t\t\t\t\t\t\tself.onUpdateRequest(self.renderers[config.id]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._add(config);\r\n\t\t\t\treturn (config ? config.id : undefined);\r\n\t\t\t},\r\n\t\t\tonUpdateRequest: function(layer){\r\n\r\n\t\t\t},\r\n\r\n\t\t\teachLayer: function(code){\r\n\t\t\t\tfor (var i in this.renderers) {\r\n\t\t\t\t\tcode(this.renderers[i]);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tremoveLayer: function (id) {\r\n\t\t\t\tif(!this.renderers[id])\r\n\t\t\t\t\treturn;\r\n\t\t\t\tthis.renderers[id].destructor();\r\n\t\t\t\tdelete this.renderers[id];\r\n\t\t\t},\r\n\t\t\tclear: function () {\r\n\t\t\t\tfor (var i in this.renderers) {\r\n\t\t\t\t\tthis.renderers[i].destructor();\r\n\t\t\t\t}\r\n\t\t\t\tthis.renderers = {};\r\n\t\t\t}//,\r\n\t\t\t//prepareConfig: prepareConfig\r\n\t\t};\r\n\r\n\t\tgantt.attachEvent(\"onDestroy\", function(){\r\n\t\t\trenderGroup.clear();\r\n\t\t\trenderGroup = null;\r\n\t\t});\r\n\r\n\t\treturn renderGroup;\r\n\t}\r\n};};\r\n\r\n\r\nfunction mergeFilters(filter_methods){\r\n\tif(!(filter_methods instanceof Array)){\r\n\t\tfilter_methods = Array.prototype.slice.call(arguments, 0);\r\n\t}\r\n\r\n\treturn function(obj){\r\n\t\tvar res = true;\r\n\t\tfor(var i = 0, len = filter_methods.length; i < len; i++){\r\n\t\t\tvar filter_method = filter_methods[i];\r\n\t\t\tif(filter_method){\r\n\t\t\t\tres = res && (filter_method(obj.id, obj) !== false);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn res;\r\n\t};\r\n}\r\n\r\n\r\nexport default layerFactory;\r\n","export default function(item, view, config){\r\n\tif(!item.start_date || !item.end_date){\r\n\t\treturn null;\r\n\t}\r\n\tvar padding = 200;\r\n\tvar startCoord = view.posFromDate(item.start_date, view._getPositioningContext ? view._getPositioningContext(item) : null);\r\n\tvar endCoord = view.posFromDate(item.end_date, view._getPositioningContext ? view._getPositioningContext(item) : null);\r\n\tvar left = Math.min(startCoord, endCoord) - padding;\r\n\tvar right = Math.max(startCoord, endCoord) + padding;\r\n\treturn {\r\n\t\ttop: view.getItemTop(item.id),\r\n\t\theight: view.getItemHeight(item.id),\r\n\t\tleft: left,\r\n\t\twidth: right - left\r\n\t};\r\n};","import getLinkRectangle from \"../get_link_rectangle\";\r\n\r\nexport default function(){\r\n\tvar coordinates = [];\r\n\tvar calculated = false;\r\n\r\n\tfunction clearCache(){\r\n\t\tcoordinates = [];\r\n\t\tcalculated = false;\r\n\t}\r\n\r\n\tfunction buildCache(datastore, view, gantt){\r\n\t\tvar config = view.$getConfig();\r\n\t\tvar visibleItems = datastore.getVisibleItems();\r\n\t\t//datastore.eachItem(function(link){\r\n\t\tvisibleItems.forEach(function(link){\r\n\t\t\tvar rec = getLinkRectangle(link, view, config, gantt);\r\n\t\t\tif(!rec){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tcoordinates.push({id: link.id, rec: rec});\r\n\t\t});\r\n\r\n\t\tcoordinates.sort(function(a, b){\r\n\t\t\tif(a.rec.right < b.rec.right){\r\n\t\t\t\treturn -1;\r\n\t\t\t}else {\r\n\t\t\t\treturn 1;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tcalculated = true;\r\n\t}\r\n\r\n\tvar initialized = false;\r\n\tfunction init(datastore){\r\n\t\tif(initialized){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tinitialized = true;\r\n\t\tdatastore.attachEvent(\"onPreFilter\", clearCache);\r\n\t\tdatastore.attachEvent(\"onStoreUpdated\", clearCache);\r\n\t\tdatastore.attachEvent(\"onClearAll\", clearCache);\r\n\t\tdatastore.attachEvent(\"onBeforeStoreUpdate\", clearCache);\r\n\t}\r\n\r\n\treturn function getVisibleLinksRange(gantt, view, config, datastore, viewport){\r\n\t\tinit(datastore);\r\n\t\tif(!calculated){\r\n\t\t\tbuildCache(datastore, view, gantt);\r\n\t\t}\r\n\r\n\t\tvar visibleBoxes = [];\r\n\t\tfor(var i = 0; i < coordinates.length; i++){\r\n\t\t\tvar item = coordinates[i];\r\n\t\t\tvar box = item.rec;\r\n\t\t\tif(box.right < viewport.x){\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(box.left < viewport.x_end && box.right > viewport.x && box.top < viewport.y_end && box.bottom > viewport.y){\r\n\t\t\t\tvisibleBoxes.push(item.id);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn {\r\n\t\t\tids: visibleBoxes\r\n\t\t};\r\n\t};\r\n};","\r\n\r\nimport barRectangle from \"./get_bar_rectangle\";\r\n\r\nexport default function getLinkBox(item, view, config, gantt){\r\n\tif(!gantt.isTaskExists(item.source)){\r\n\t\treturn null;\r\n\t}\r\n\r\n\tif(!gantt.isTaskExists(item.target)){\r\n\t\treturn null;\r\n\t}\r\n\tvar sourceBox = barRectangle(gantt.getTask(item.source), view, gantt);\r\n\tvar targetBox = barRectangle(gantt.getTask(item.target), view, gantt);\r\n\r\n\tif(!sourceBox || !targetBox){\r\n\t\treturn null;\r\n\t}\r\n\r\n\tvar padding = 100;\r\n\tvar left = Math.min(sourceBox.left, targetBox.left) - padding;\r\n\tvar right = Math.max(sourceBox.left + sourceBox.width, targetBox.left + targetBox.width) + padding;\r\n\tvar top = Math.min(sourceBox.top, targetBox.top) - padding;\r\n\tvar bottom = Math.max(sourceBox.top + sourceBox.height, targetBox.top + targetBox.height) + padding;\r\n\r\n\treturn {\r\n\t\ttop: top,\r\n\t\theight: bottom - top,\r\n\t\tbottom,\r\n\t\tleft: left,\r\n\t\twidth: right - left,\r\n\t\tright\r\n\t};\r\n};\r\n","\r\n// optimized checker for links smart rendering\r\n\r\n// first check the vertical position since it's easier to calculate\r\n\r\nexport default function isLinkInViewPort(item, viewport, view, config, gantt){\r\n\tvar source = view.$gantt.getTask(item.source);\r\n\tvar target = view.$gantt.getTask(item.target);\r\n\t// check vertical visibility first since it's a lighter check\r\n\tvar sourceTop = view.getItemTop(source.id);\r\n\tvar sourceHeight = view.getItemHeight(source.id);\r\n\r\n\tvar targetTop = view.getItemTop(target.id);\r\n\tvar targetHeight = view.getItemHeight(target.id);\r\n\r\n\tif(viewport.y > sourceTop + sourceHeight &&\r\n\t\tviewport.y > targetTop + targetHeight){\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif(viewport.y_end < targetTop &&\r\n\t\tviewport.y_end < sourceTop){\r\n\t\treturn false;\r\n\t}\r\n\r\n\tvar padding = 100;\r\n\tvar sourceLeft = view.posFromDate(source.start_date, view._getPositioningContext ? view._getPositioningContext(item) : null);\r\n\tvar sourceRight = view.posFromDate(source.end_date, view._getPositioningContext ? view._getPositioningContext(item) : null);\r\n\tvar targetLeft = view.posFromDate(target.start_date, view._getPositioningContext ? view._getPositioningContext(item) : null);\r\n\tvar targetRight = view.posFromDate(target.end_date, view._getPositioningContext ? view._getPositioningContext(item) : null);\r\n\r\n\tif(sourceLeft > sourceRight){\r\n\t\t// rtl\r\n\t\tvar tmp = sourceRight;\r\n\t\tsourceRight = sourceLeft;\r\n\t\tsourceLeft = tmp;\r\n\t}\r\n\tif(targetLeft > targetRight){\r\n\t\t// rtl\r\n\t\tvar tmp = targetRight;\r\n\t\ttargetRight = targetLeft;\r\n\t\ttargetLeft = tmp;\r\n\t}\r\n\tsourceLeft += -padding; // add buffer for custom elements\r\n\tsourceRight += padding;\r\n\ttargetLeft += -padding; // add buffer for custom elements\r\n\ttargetRight += padding;\r\n\r\n\tif(viewport.x > sourceRight &&\r\n\t\tviewport.x > targetRight){\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif(viewport.x_end < sourceLeft &&\r\n\t\tviewport.x_end < targetLeft){\r\n\t\treturn false;\r\n\t}\r\n\treturn true;\r\n};\r\n","import createLayerFactory from \"./render/layer_engine\";\r\n\r\nimport getVisibleTaskRange from \"./render/viewport/get_visible_bars_range\";\r\nimport getVisibleLinksRangeFactory from \"./render/viewport/factory/get_visible_link_range\";\r\n\r\nimport isLinkInViewport from \"./render/viewport/is_link_in_viewport\";\r\n\r\nfunction initLayer(layer, gantt){\r\n\tif(!layer.view){\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar view = layer.view;\r\n\tif(typeof view === \"string\"){\r\n\t\tview = gantt.$ui.getView(view);\r\n\t}\r\n\r\n\tif(view && view.attachEvent){\r\n\t\tview.attachEvent(\"onScroll\", function(){\r\n\t\t\tvar state = gantt.$services.getService(\"state\");\r\n\t\t\t// don't repaint if we're inside batchUpdate, a complete repaint will be called afterwards\r\n\t\t\tif(!state.getState(\"batchUpdate\").batch_update && !view.$config.$skipSmartRenderOnScroll){\r\n\t\t\t\tif(layer.requestUpdate){\r\n\t\t\t\t\tlayer.requestUpdate();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nvar createLayerEngine = function(gantt){\r\n\tvar factory = createLayerFactory(gantt);\r\n\treturn {\r\n\t\tgetDataRender: function(name){\r\n\t\t\treturn gantt.$services.getService(\"layer:\" + name) || null;\r\n\t\t},\r\n\t\tcreateDataRender: function(config){\r\n\t\t\tvar name = config.name,\r\n\t\t\t\tdefaultContainer = config.defaultContainer,\r\n\t\t\t\tpreviusSiblingContainer = config.defaultContainerSibling;\r\n\r\n\t\t\tvar layers = factory.createGroup(\r\n\t\t\t\tdefaultContainer,\r\n\t\t\t\tpreviusSiblingContainer,\r\n\t\t\t\tfunction(itemId, item){\r\n\t\t\t\t\tif(layers.filters){\r\n\t\t\t\t\t\tfor(var i = 0; i < layers.filters.length; i++){\r\n\t\t\t\t\t\t\tif(layers.filters[i](itemId, item) === false){\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tinitLayer\r\n\t\t\t);\r\n\r\n\t\t\tgantt.$services.setService(\"layer:\" + name, function(){\r\n\t\t\t\treturn layers;\r\n\t\t\t});\r\n\r\n\t\t\tgantt.attachEvent(\"onGanttReady\", function () {\r\n\t\t\t\tlayers.addLayer();// init layers on start\r\n\t\t\t});\r\n\r\n\t\t\treturn layers;\r\n\t\t},\r\n\t\tinit: function(){\r\n\t\t\tvar taskLayers = this.createDataRender({\r\n\t\t\t\tname: \"task\",\r\n\t\t\t\tdefaultContainer: function(){\r\n\t\t\t\t\tif(gantt.$task_data){\r\n\t\t\t\t\t\treturn gantt.$task_data;\r\n\t\t\t\t\t}else if(gantt.$ui.getView(\"timeline\")){\r\n\t\t\t\t\t\treturn gantt.$ui.getView(\"timeline\").$task_data;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tdefaultContainerSibling: function(){\r\n\t\t\t\t\tif(gantt.$task_links){\r\n\t\t\t\t\t\treturn gantt.$task_links;\r\n\t\t\t\t\t}else if(gantt.$ui.getView(\"timeline\")){\r\n\t\t\t\t\t\treturn gantt.$ui.getView(\"timeline\").$task_links;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tfilter: function(item){\r\n\r\n\t\t\t\t}\r\n\t\t\t}, gantt);\r\n\r\n\t\t\tvar linkLayers = this.createDataRender({\r\n\t\t\t\tname: \"link\",\r\n\t\t\t\tdefaultContainer: function(){\r\n\t\t\t\t\tif(gantt.$task_data){\r\n\t\t\t\t\t\treturn gantt.$task_data;\r\n\t\t\t\t\t}else if(gantt.$ui.getView(\"timeline\")){\r\n\t\t\t\t\t\treturn gantt.$ui.getView(\"timeline\").$task_data;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, gantt);\r\n\r\n\t\t\treturn {\r\n\t\t\t\taddTaskLayer: function(config){\r\n\t\t\t\t\tconst rangeFunction = getVisibleTaskRange;\r\n\t\t\t\t\tif(typeof config === \"function\"){\r\n\t\t\t\t\t\tconfig = {\r\n\t\t\t\t\t\t\trenderer: {\r\n\t\t\t\t\t\t\t\trender: config,\r\n\t\t\t\t\t\t\t\tgetVisibleRange: rangeFunction\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tif(config.renderer && !config.renderer.getVisibleRange){\r\n\t\t\t\t\t\t\tconfig.renderer.getVisibleRange = rangeFunction;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconfig.view = \"timeline\";\r\n\r\n\t\t\t\t\treturn taskLayers.addLayer(config);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t_getTaskLayers: function(){\r\n\t\t\t\t\treturn taskLayers.getLayers();\r\n\t\t\t\t},\r\n\t\t\t\tremoveTaskLayer: function(id){\r\n\t\t\t\t\ttaskLayers.removeLayer(id);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t_clearTaskLayers: function(){\r\n\t\t\t\t\ttaskLayers.clear();\r\n\t\t\t\t},\r\n\t\t\t\taddLinkLayer: function(config){\r\n\t\t\t\t\tconst rangeFunction = getVisibleLinksRangeFactory();\r\n\t\t\t\t\tif(typeof config === \"function\"){\r\n\t\t\t\t\t\tconfig = {\r\n\t\t\t\t\t\t\trenderer: {\r\n\t\t\t\t\t\t\t\trender: config,\r\n\t\t\t\t\t\t\t\tgetVisibleRange: rangeFunction\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tif(config.renderer && !config.renderer.getVisibleRange){\r\n\t\t\t\t\t\t\tconfig.renderer.getVisibleRange = rangeFunction;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconfig.view = \"timeline\";\r\n\t\t\t\t\tif(config && config.renderer){\r\n\t\t\t\t\t\tif(!config.renderer.getRectangle && !config.renderer.isInViewPort){\r\n\t\t\t\t\t\t\tconfig.renderer.isInViewPort = isLinkInViewport;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn linkLayers.addLayer(config);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t_getLinkLayers: function(){\r\n\t\t\t\t\treturn linkLayers.getLayers();\r\n\t\t\t\t},\r\n\t\t\t\tremoveLinkLayer: function(id){\r\n\t\t\t\t\tlinkLayers.removeLayer(id);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t_clearLinkLayers: function(){\r\n\t\t\t\t\tlinkLayers.clear();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n};\r\n\r\nexport default createLayerEngine;","import * as utils from \"../../../utils/utils\";\r\nimport eventable from \"../../../utils/eventable\";\r\nimport * as domHelpers from \"../utils/dom_helpers\";\r\n\r\nvar Cell = (function () {\r\n\t\"use strict\";\r\n\r\n\tfunction Cell(parent, config, factory, gantt) {\r\n\t\tif (parent) {\r\n\t\t\tthis.$container = domHelpers.toNode(parent);\r\n\t\t\tthis.$parent = parent;\r\n\t\t}\r\n\t\t// save config\r\n\t\tthis.$config = utils.mixin(config, {\r\n\t\t\theaderHeight: 33\r\n\t\t});\r\n\t\tthis.$gantt = gantt;\r\n\t\tthis.$domEvents = gantt._createDomEventScope();\r\n\t\t// set id\r\n\t\tthis.$id = config.id || \"c\" + utils.uid();\r\n\r\n\t\tthis.$name = \"cell\";\r\n\t\tthis.$factory = factory;\r\n\t\tthis.$externalComponent = null;\r\n\r\n\t\teventable(this);\r\n\r\n\t}\r\n\r\n\tCell.prototype.destructor = function () {\r\n\t\tthis.$parent = this.$container = this.$view = null;\r\n\t\tvar mouse = this.$gantt.$services.getService(\"mouseEvents\");\r\n\t\tmouse.detach(\"click\", \"gantt_header_arrow\", this._headerClickHandler);\r\n\t\tthis.$domEvents.detachAll();\r\n\t\tthis.callEvent(\"onDestroy\", []);\r\n\t\tthis.detachAllEvents();\r\n\t};\r\n\tCell.prototype.cell = function (id) {\r\n\t\treturn null;\r\n\t};\r\n\r\n\tCell.prototype.scrollTo = function(left, top){\r\n\r\n\t\t//GS-333 Add a way to scroll the HTML views:\r\n\t\tvar cell = this.$view;\r\n\t\tif (this.$config.html) cell = this.$view.firstChild;\r\n\r\n\t\tif (left*1 == left){\r\n\t\t\tcell.scrollLeft = left;\r\n\t\t}\r\n\t\tif(top*1 == top){\r\n\t\t\tcell.scrollTop = top;\r\n\t\t}\r\n\t};\r\n\r\n\tCell.prototype.clear = function(){\r\n\t\tthis.getNode().innerHTML = \"\";\r\n\t\tthis.getNode().className = \"gantt_layout_content\";\r\n\t\tthis.getNode().style.padding = \"0\";\r\n\t};\r\n\r\n\tCell.prototype.resize = function (final) {\r\n\t\tif (this.$parent) {\r\n\t\t\treturn this.$parent.resize(final);\r\n\t\t}\r\n\r\n\t\tif(final === false){\r\n\t\t\tthis.$preResize = true;\r\n\t\t}\r\n\r\n\t\tvar topCont = this.$container;\r\n\t\tvar x = topCont.offsetWidth;\r\n\t\tvar y = topCont.offsetHeight;\r\n\t\tvar topSize = this.getSize();\r\n\t\tif (topCont === document.body) {\r\n\t\t\tx = document.body.offsetWidth;\r\n\t\t\ty = document.body.offsetHeight;\r\n\t\t}\r\n\t\tif (x < topSize.minWidth) {\r\n\t\t\tx = topSize.minWidth;\r\n\t\t}\r\n\t\tif (x > topSize.maxWidth) {\r\n\t\t\tx = topSize.maxWidth;\r\n\t\t}\r\n\t\tif (y < topSize.minHeight) {\r\n\t\t\ty = topSize.minHeight;\r\n\t\t}\r\n\t\tif (y > topSize.maxHeight) {\r\n\t\t\ty = topSize.maxHeight;\r\n\t\t}\r\n\t\tthis.setSize(x, y);\r\n\r\n\t\tif(!this.$preResize){\r\n\t\t//\tself.callEvent(\"onResize\", [x, y]);\r\n\t\t}\r\n\t\tthis.$preResize = false;\r\n\t};\r\n\r\n\tCell.prototype.hide = function () {\r\n\t\tthis._hide(true);\r\n\t\tthis.resize();\r\n\t};\r\n\tCell.prototype.show = function (force) {\r\n\t\tthis._hide(false);\r\n\t\tif (force && this.$parent) {\r\n\t\t\tthis.$parent.show();\r\n\t\t}\r\n\t\tthis.resize();\r\n\t};\r\n\tCell.prototype._hide = function (mode) {\r\n\t\tif (mode === true && this.$view.parentNode) {\r\n\t\t\tthis.$view.parentNode.removeChild(this.$view);\r\n\t\t}\r\n\t\telse if (mode === false && !this.$view.parentNode) {\r\n\t\t\tvar index = this.$parent.cellIndex(this.$id);\r\n\t\t\tthis.$parent.moveView(this, index);\r\n\t\t}\r\n\t\tthis.$config.hidden = mode;\r\n\t};\r\n\tCell.prototype.$toHTML = function (content, css) {\r\n\t\tif (content === void 0) { content = \"\"; }\r\n\t\tcss = [(css || \"\"), (this.$config.css || \"\")].join(\" \");\r\n\t\tvar obj = this.$config;\r\n\t\tvar header = \"\";\r\n\t\tif (obj.raw) {\r\n\t\t\tcontent = typeof obj.raw === \"string\" ? obj.raw : \"\";\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (!content) {\r\n\t\t\t\tlet renderedElement = null;\r\n\t\t\t\tif(typeof obj.html === \"function\"){\r\n\t\t\t\t\trenderedElement = obj.html();\r\n\t\t\t\t}else{\r\n\t\t\t\t\trenderedElement = obj.html;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(this.$gantt.config.external_render && this.$gantt.config.external_render.isElement(renderedElement)){\r\n\t\t\t\t\tthis.$externalComponent = renderedElement;\r\n\t\t\t\t\trenderedElement = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontent = \"<div class='gantt_layout_content' \"+(css ? \" class='\"+css+\"' \" : \"\")+\" >\" + (renderedElement || \"\") + \"</div>\";\r\n\t\t\t}\r\n\t\t\tif (obj.header) {\r\n\t\t\t\tvar collapseIcon = obj.canCollapse ? \"<div class='gantt_layout_header_arrow'></div>\" : \"\";\r\n\t\t\t\theader = \"<div class='gantt_layout_header'>\" + collapseIcon + \"<div class='gantt_layout_header_content'>\" + obj.header + \"</div></div>\";\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn \"<div class='gantt_layout_cell \" + css + \"' data-cell-id='\" + this.$id + \"'>\" + header + content + \"</div>\";\r\n\t};\r\n\tCell.prototype.$fill = function (node, parent) {\r\n\t\tthis.$view = node;\r\n\t\tthis.$parent = parent;\r\n\t\tthis.init();\r\n\t};\r\n\tCell.prototype.getNode = function () {\r\n\t\treturn (this.$view.querySelector(\"gantt_layout_cell\") || this.$view);\r\n\t};\r\n\tCell.prototype.init = function () {\r\n\t\t// [NOT-GOOD] code is executed for each component, while it still has only one handler, it is no good\r\n\r\n\t\tvar self = this;\r\n\r\n\t\tthis._headerClickHandler = function(e){\r\n\t\t\tvar cellId = domHelpers.locateAttribute(e, \"data-cell-id\");\r\n\t\t\tif(cellId == self.$id){\r\n\t\t\t\tself.toggle();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar mouse = this.$gantt.$services.getService(\"mouseEvents\");\r\n\t\tmouse.delegate(\"click\", \"gantt_header_arrow\", this._headerClickHandler);\r\n\r\n\t\tthis.callEvent(\"onReady\", []);\r\n\t};\r\n\tCell.prototype.toggle = function () {\r\n\t\tthis.$config.collapsed = !this.$config.collapsed;\r\n\t\tthis.resize();\r\n\t};\r\n\tCell.prototype.getSize = function () {\r\n\t\tvar size = {\r\n\t\t\theight: this.$config.height || 0,\r\n\t\t\twidth: this.$config.width || 0,\r\n\t\t\tgravity: this.$config.gravity || 1,\r\n\t\t\tminHeight: this.$config.minHeight || 0,\r\n\t\t\tminWidth: this.$config.minWidth || 0,\r\n\t\t\tmaxHeight: this.$config.maxHeight || 100000000000,\r\n\t\t\tmaxWidth: this.$config.maxWidth || 100000000000\r\n\t\t};\r\n\t\tif (this.$config.collapsed) {\r\n\t\t\tvar mode = this.$config.mode === \"x\";\r\n\t\t\tsize[mode ? \"width\" : \"height\"] = size[mode ? \"maxWidth\" : \"maxHeight\"] = this.$config.headerHeight;\r\n\t\t}\r\n\t\treturn size;\r\n\t};\r\n\r\n\tCell.prototype.getContentSize = function(){\r\n\r\n\t\tvar width = this.$lastSize.contentX;\r\n\t\tif(width !== width*1){\r\n\t\t\twidth = this.$lastSize.width;\r\n\t\t}\r\n\r\n\t\tvar height = this.$lastSize.contentY;\r\n\t\tif(height !== height*1){\r\n\t\t\theight = this.$lastSize.height;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\twidth: width,\r\n\t\t\theight: height\r\n\t\t};\r\n\t};\r\n\r\n\tCell.prototype._getBorderSizes = function(){\r\n\t\tvar borders = {\r\n\t\t\ttop: 0,\r\n\t\t\tright: 0,\r\n\t\t\tbottom: 0,\r\n\t\t\tleft: 0,\r\n\t\t\thorizontal: 0,\r\n\t\t\tvertical: 0\r\n\t\t};\r\n\t\tif(this._currentBorders){\r\n\t\t\tif(this._currentBorders[this._borders.left]){\r\n\t\t\t\tborders.left = 1;\r\n\t\t\t\tborders.horizontal++;\r\n\t\t\t}\r\n\r\n\t\t\tif(this._currentBorders[this._borders.right]){\r\n\t\t\t\tborders.right = 1;\r\n\t\t\t\tborders.horizontal++;\r\n\t\t\t}\r\n\r\n\t\t\tif(this._currentBorders[this._borders.top]){\r\n\t\t\t\tborders.top = 1;\r\n\t\t\t\tborders.vertical++;\r\n\t\t\t}\r\n\r\n\t\t\tif(this._currentBorders[this._borders.bottom]){\r\n\t\t\t\tborders.bottom = 1;\r\n\t\t\t\tborders.vertical++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn borders;\r\n\r\n\t};\r\n\r\n\tCell.prototype.setSize = function (x, y) {\r\n\t\tthis.$view.style.width = x + \"px\";\r\n\t\tthis.$view.style.height = y + \"px\";\r\n\r\n\t\tvar borders = this._getBorderSizes();\r\n\t\tvar contentY = y - borders.vertical;\r\n\t\tvar contentX = x - borders.horizontal;\r\n\r\n\t\tthis.$lastSize = { x: x, y: y, contentX: contentX, contentY: contentY };\r\n\t\tif (this.$config.header) {\r\n\t\t\tthis._sizeHeader();\r\n\t\t}else{\r\n\t\t\tthis._sizeContent();\r\n\t\t}\r\n\t};\r\n\r\n\tCell.prototype._borders = {\r\n\t\t\"left\":\"gantt_layout_cell_border_left\",\r\n\t\t\"right\":\"gantt_layout_cell_border_right\",\r\n\t\t\"top\":\"gantt_layout_cell_border_top\",\r\n\t\t\"bottom\":\"gantt_layout_cell_border_bottom\"\r\n\t};\r\n\r\n\tCell.prototype._setBorders = function(css, view){\r\n\t\tif(!view) {\r\n\t\t\tview = this;\r\n\t\t}\r\n\t\tvar node = view.$view;\r\n\r\n\t\tfor( var i in this._borders){\r\n\t\t\tdomHelpers.removeClassName(node, this._borders[i]);\r\n\t\t}\r\n\r\n\t\tif(typeof css == \"string\"){\r\n\t\t\tcss = [css];\r\n\t\t}\r\n\r\n\t\tvar cssHash = {};\r\n\r\n\t\tfor(var i = 0; i < css.length; i++){\r\n\t\t\tdomHelpers.addClassName(node, css[i]);\r\n\t\t\tcssHash[css[i]] = true;\r\n\t\t}\r\n\r\n\t\tview._currentBorders = cssHash;\r\n\t};\r\n\r\n\r\n\tCell.prototype._sizeContent = function(){\r\n\t\tvar content = this.$view.childNodes[0];\r\n\t\tif(content && content.className == \"gantt_layout_content\"){\r\n\t\t\tcontent.style.height = this.$lastSize.contentY + \"px\";\r\n\t\t}\r\n\t};\r\n\r\n\tCell.prototype._sizeHeader = function () {\r\n\t\tvar size = this.$lastSize;\r\n\t\tsize.contentY -= this.$config.headerHeight;\r\n\t\tvar header = this.$view.childNodes[0];\r\n\t\tvar content = this.$view.childNodes[1];\r\n\t\tvar xLayout = this.$config.mode === \"x\";\r\n\t\tif (this.$config.collapsed) {\r\n\t\t\tcontent.style.display = \"none\";\r\n\t\t\tif (xLayout) {\r\n\t\t\t\theader.className = \"gantt_layout_header collapsed_x\";\r\n\t\t\t\theader.style.width = size.y + \"px\";\r\n\t\t\t\tvar d = Math.floor(size.y / 2 - size.x / 2);\r\n\t\t\t\theader.style.transform = \"rotate(90deg) translate(\" + d + \"px, \" + d + \"px)\";\r\n\t\t\t\tcontent.style.display = \"none\";\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\theader.className = \"gantt_layout_header collapsed_y\";\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (xLayout) {\r\n\t\t\t\theader.className = \"gantt_layout_header\";\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\theader.className = \"gantt_layout_header vertical\";\r\n\t\t\t}\r\n\t\t\theader.style.width = 'auto';\r\n\t\t\theader.style.transform = '';\r\n\t\t\tcontent.style.display = \"\";\r\n\t\t\tcontent.style.height = size.contentY + \"px\";\r\n\t\t}\r\n\t\theader.style.height = this.$config.headerHeight + \"px\";\r\n\t};\r\n\treturn Cell;\r\n}());\r\n\r\nexport default Cell;\r\n","export default function (d, b) {\r\n\tfor (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n\tfunction __() { this.constructor = d; }\r\n\td.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n};","import __extends from \"../../../utils/extends\";\r\nimport * as domHelpers from \"../utils/dom_helpers\";\r\nimport Cell from \"./cell\";\r\n\r\nvar Layout = (function (_super) {\r\n\t\"use strict\";\r\n\r\n\t__extends(Layout, _super);\r\n\tfunction Layout(parent, config, factory) {\r\n\t\tvar _this = _super.apply(this, arguments) || this;\r\n\r\n\t\tif(parent)\r\n\t\t\t_this.$root = true;\r\n\r\n\t\t_this._parseConfig(config);\r\n\t\t_this.$name = \"layout\";\r\n\t\treturn _this;\r\n\t}\r\n\r\n\tLayout.prototype.destructor = function () {\r\n\t\tif (this.$container && this.$view) {\r\n\t\t\tdomHelpers.removeNode(this.$view);\r\n\t\t}\r\n\r\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\t\t\tvar child = this.$cells[i];\r\n\t\t\tchild.destructor();\r\n\t\t}\r\n\t\tthis.$cells = [];\r\n\r\n\t\t_super.prototype.destructor.call(this);\r\n\t};\r\n\r\n\tLayout.prototype._resizeScrollbars = function(autosize, scrollbars){\r\n\t\tvar scrollChanged = false;\r\n\t\tvar visibleScrollbars = [],\r\n\t\t\thiddenScrollbars = [];\r\n\r\n\t\tconst scrollbarsToHide = [];\r\n\r\n\t\tfunction showScrollbar(scrollbar){\r\n\t\t\tscrollbar.$parent.show();\r\n\t\t\tscrollChanged = true;\r\n\t\t\tvisibleScrollbars.push(scrollbar);\r\n\t\t}\r\n\t\tfunction hideScrollbar(scrollbar){\r\n\t\t\tscrollbar.$parent.hide();\r\n\t\t\tscrollChanged = true;\r\n\t\t\thiddenScrollbars.push(scrollbar);\r\n\t\t}\r\n\r\n\t\tvar scrollbar;\r\n\t\tfor(var i = 0; i < scrollbars.length; i++){\r\n\t\t\tscrollbar = scrollbars[i];\r\n\r\n\t\t\tif(autosize[scrollbar.$config.scroll]) {\r\n\t\t\t\thideScrollbar(scrollbar);\r\n\t\t\t}else if(scrollbar.shouldHide()){\r\n\t\t\t\t//hideScrollbar(scrollbar);\r\n\t\t\t\tscrollbarsToHide.push(scrollbar);\r\n\t\t\t}else if(scrollbar.shouldShow()){\r\n\t\t\t\tshowScrollbar(scrollbar);\r\n\t\t\t}else{\r\n\t\t\t\tif(scrollbar.isVisible()){\r\n\t\t\t\t\tvisibleScrollbars.push(scrollbar);\r\n\t\t\t\t}else{\r\n\t\t\t\t\thiddenScrollbars.push(scrollbar);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar visibleGroups = {};\r\n\t\tfor(var i = 0; i < visibleScrollbars.length; i++){\r\n\t\t\tif(visibleScrollbars[i].$config.group){\r\n\t\t\t\tvisibleGroups[visibleScrollbars[i].$config.group] = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// GS-2220\r\n\t\tscrollbarsToHide.forEach(function(scrollbar){\r\n\t\t\tif(!(scrollbar.$config.group && visibleGroups[scrollbar.$config.group])){\r\n\t\t\t\thideScrollbar(scrollbar);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfor(var i = 0; i < hiddenScrollbars.length; i++){\r\n\t\t\tscrollbar = hiddenScrollbars[i];\r\n\r\n\t\t\tif(scrollbar.$config.group && visibleGroups[scrollbar.$config.group]){\r\n\t\t\t\tshowScrollbar(scrollbar);\r\n\t\t\t\t// GS-707 If the scrollbar was hidden then showed, the container resize shouldn't happen because of that\r\n\t\t\t\tfor(var j = 0; j < visibleScrollbars.length; j++){\r\n\t\t\t\t\tif(visibleScrollbars[j] == scrollbar){\r\n\t\t\t\t\t\tthis.$gantt.$scrollbarRepaint = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn scrollChanged;\r\n\t};\r\n\r\n\tLayout.prototype.getScrollbarsInfo = function(){\r\n\t\tconst scrollbars = this.getCellsByType(\"scroller\");\r\n\t\tconst scrollbarsInfo = [];\r\n\t\tscrollbars.forEach(scrollbar => {\r\n\t\t\tlet obj = {};\r\n\t\t\tconst {visible, direction, size, scrollSize, position} = scrollbar.getScrollState();\r\n\t\t\tlet linkedViews = scrollbar._getLinkedViews();\r\n\t\t\tlet boundViews = linkedViews.map(view => view.$config.id);\r\n\r\n\t\t\tobj.id = scrollbar.$id;\r\n\t\t\tobj.visible = visible;\r\n\t\t\tobj.boundViews = boundViews;\r\n\t\t\tif(direction === \"x\"){\r\n\t\t\t\tobj.x = size;\r\n\t\t\t\tobj.x_inner = scrollSize;\r\n\t\t\t\tobj.x_pos = position || 0;\r\n\t\t\t} else {\r\n\t\t\t\tobj.y = size;\r\n\t\t\t\tobj.y_inner = scrollSize;\r\n\t\t\t\tobj.y_pos = position || 0;\r\n\t\t\t}\r\n\t\t\tscrollbarsInfo.push(obj);\r\n\t\t});\r\n\t\treturn scrollbarsInfo;\r\n\t};\r\n\r\n\tLayout.prototype._syncCellSizes = function(groupName, newSize){\r\n\t\tif(!groupName)\r\n\t\t\treturn;\r\n\r\n\t\tvar groups = {};\r\n\r\n\t\tthis._eachChild(function(cell){\r\n\t\t\tif(cell.$config.group && cell.$name != \"scrollbar\" && cell.$name != \"resizer\"){\r\n\t\t\t\tif(!groups[cell.$config.group]){\r\n\t\t\t\t\tgroups[cell.$config.group] = [];\r\n\t\t\t\t}\r\n\t\t\t\tgroups[cell.$config.group].push(cell);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif(groups[groupName]){\r\n\t\t\tthis._syncGroupSize(groups[groupName], newSize);\r\n\t\t}\r\n\t\treturn groups[groupName];\r\n\t};\r\n\r\n\tLayout.prototype._syncGroupSize = function(cells, newSize){\r\n\t\tif(!cells.length) return;\r\n\r\n\t\tvar property = cells[0].$parent._xLayout ? \"width\" : \"height\";\r\n\t\tvar direction = cells[0].$parent.getNextSibling(cells[0].$id) ? 1 : -1;\r\n\r\n\t\tvar newSizeValue = newSize.value;\r\n\t\tvar isGravity = newSize.isGravity;\r\n\t\tfor(var i = 0; i < cells.length; i++){\r\n\t\t\tvar ownSize = cells[i].getSize();\r\n\r\n\t\t\tvar resizeSibling = direction > 0 ? cells[i].$parent.getNextSibling(cells[i].$id) : cells[i].$parent.getPrevSibling(cells[i].$id);\r\n\t\t\tif(resizeSibling.$name == \"resizer\"){\r\n\t\t\t\tresizeSibling = direction > 0 ? resizeSibling.$parent.getNextSibling(resizeSibling.$id) : resizeSibling.$parent.getPrevSibling(resizeSibling.$id);\r\n\t\t\t}\r\n\t\t\tvar siblingSize = resizeSibling.getSize();\r\n\r\n\t\t\tif(!isGravity) {\r\n\t\t\t\tif(resizeSibling[property]){\r\n\t\t\t\t\tvar totalGravity = ownSize.gravity + siblingSize.gravity;\r\n\t\t\t\t\tvar totalSize = ownSize[property] + siblingSize[property];\r\n\t\t\t\t\tvar k = totalGravity / totalSize;\r\n\t\t\t\t\tcells[i].$config.gravity = k * newSizeValue;\r\n\r\n\t\t\t\t\tresizeSibling.$config[property] = totalSize - newSizeValue;\r\n\t\t\t\t\tresizeSibling.$config.gravity = totalGravity - k * newSizeValue;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tcells[i].$config[property] = newSizeValue;\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tcells[i].$config.gravity = newSizeValue;\r\n\t\t\t}\r\n\r\n\t\t\tvar mainGrid = this.$gantt.$ui.getView(\"grid\");\r\n\t\t\tif(mainGrid && cells[i].$content === mainGrid && !mainGrid.$config.scrollable && !isGravity){\r\n\t\t\t\tthis.$gantt.config.grid_width = newSizeValue;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tLayout.prototype.resize = function(startStage){\r\n\t\tvar mainCall = false;\r\n\t\tif(this.$root && !this._resizeInProgress){\r\n\t\t\tthis.callEvent(\"onBeforeResize\", []);\r\n\t\t\tmainCall = true;\r\n\t\t\tthis._resizeInProgress = true;\r\n\t\t}\r\n\r\n\t\t_super.prototype.resize.call(this, true);\r\n\t\t_super.prototype.resize.call(this, false);\r\n\r\n\t\tif(mainCall){\r\n\r\n\t\t\tvar contentViews = [];\r\n\t\t\tcontentViews = contentViews.concat(this.getCellsByType(\"viewCell\"));\r\n\t\t\tcontentViews = contentViews.concat(this.getCellsByType(\"viewLayout\"));\r\n\t\t\tcontentViews = contentViews.concat(this.getCellsByType(\"hostCell\"));\r\n\r\n\t\t\tvar scrollbars = this.getCellsByType(\"scroller\");\r\n\r\n\t\t\tfor(var i = 0; i < contentViews.length; i++){\r\n\t\t\t\tif(!contentViews[i].$config.hidden)\r\n\t\t\t\t\tcontentViews[i].setContentSize();\r\n\t\t\t}\r\n\r\n\t\t\tvar autosize = this._getAutosizeMode(this.$config.autosize);\r\n\r\n\t/* // possible to rollback set content size when autisize is disabled, not sure if need to\r\n\t\t\tcontentViews.forEach(function(view){\r\n\t\t\t\tconst parent = view.$parent;\r\n\t\t\t\tif(!autosize.x){\r\n\t\t\t\t\tif(parent.$config.$originalWidthStored){\r\n\t\t\t\t\t\tparent.$config.$originalWidthStored = false;\r\n\t\t\t\t\t\tparent.$config.width = parent.$config.$originalWidth;\r\n\t\t\t\t\t\tparent.$config.$originalWidth = undefined;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!autosize.y){\r\n\t\t\t\t\tif(parent.$config.$originalHeightStored){\r\n\t\t\t\t\t\tparent.$config.$originalHeightStored = false;\r\n\t\t\t\t\t\tparent.$config.height = parent.$config.$originalHeight;\r\n\t\t\t\t\t\tparent.$config.$originalHeight = undefined;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});*/\r\n\t\t\t\r\n\t\t\tvar scrollChanged = this._resizeScrollbars(autosize, scrollbars);\r\n\r\n\t\t\tif(this.$config.autosize){\r\n\t\t\t\tthis.autosize(this.$config.autosize);\r\n\t\t\t\tcontentViews.forEach(function(view){\r\n\t\t\t\t\tconst parent = view.$parent;\r\n\t\t\t\t\tconst sizes = parent.getContentSize(autosize);\r\n\t\t\t\t\tif(autosize.x){\r\n\t\t\t\t\t\tif(!parent.$config.$originalWidthStored){\r\n\t\t\t\t\t\t\tparent.$config.$originalWidthStored = true;\r\n\t\t\t\t\t\t\tparent.$config.$originalWidth = parent.$config.width;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tparent.$config.width = sizes.width;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(autosize.y){\r\n\t\t\t\t\t\tif(!parent.$config.$originalHeightStored){\r\n\t\t\t\t\t\t\tparent.$config.$originalHeightStored = true;\r\n\t\t\t\t\t\t\tparent.$config.$originalHeight = parent.$config.height;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tparent.$config.height = sizes.height;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tscrollChanged = true;\r\n\t\t\t}\r\n\r\n\t\t\tif(scrollChanged){\r\n\t\t\t\tthis.resize();\r\n\t\t\t\tfor(var i = 0; i < contentViews.length; i++){\r\n\t\t\t\t\tif(!contentViews[i].$config.hidden)\r\n\t\t\t\t\t\tcontentViews[i].setContentSize();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.callEvent(\"onResize\", []);\r\n\t\t}\r\n\t\tif(mainCall){\r\n\t\t\tthis._resizeInProgress = false;\r\n\t\t}\r\n\t};\r\n\r\n\tLayout.prototype._eachChild = function(code, cell){\r\n\t\tcell = cell || this;\r\n\t\tcode(cell);\r\n\t\tif(cell.$cells){\r\n\t\t\tfor(var i = 0; i < cell.$cells.length; i++){\r\n\t\t\t\tthis._eachChild(code, cell.$cells[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tLayout.prototype.isChild = function(view){\r\n\t\tvar res = false;\r\n\t\tthis._eachChild(function(child){\r\n\t\t\tif(child === view || child.$content === view){\r\n\t\t\t\tres = true;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn res;\r\n\t};\r\n\r\n\tLayout.prototype.getCellsByType = function(type){\r\n\t\tvar res = [];\r\n\t\tif(type === this.$name){\r\n\t\t\tres.push(this);\r\n\t\t}\r\n\r\n\t\tif(this.$content && this.$content.$name == type){\r\n\t\t\tres.push(this.$content);\r\n\t\t}\r\n\r\n\t\tif(this.$cells){\r\n\t\t\tfor(var i = 0; i < this.$cells.length; i++){\r\n\t\t\t\tvar children = Layout.prototype.getCellsByType.call(this.$cells[i], type);\r\n\t\t\t\tif(children.length){\r\n\t\t\t\t\tres.push.apply(res, children);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn res;\r\n\t};\r\n\r\n\tLayout.prototype.getNextSibling = function(cellId){\r\n\t\tvar index = this.cellIndex(cellId);\r\n\t\tif(index >= 0 && this.$cells[index + 1]){\r\n\t\t\treturn this.$cells[index + 1];\r\n\t\t}else{\r\n\t\t\treturn null;\r\n\t\t}\r\n\t};\r\n\r\n\tLayout.prototype.getPrevSibling = function(cellId){\r\n\t\tvar index = this.cellIndex(cellId);\r\n\t\tif(index >= 0 && this.$cells[index - 1]){\r\n\t\t\treturn this.$cells[index - 1];\r\n\t\t}else{\r\n\t\t\treturn null;\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tLayout.prototype.cell = function (id) {\r\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\t\t\tvar child = this.$cells[i];\r\n\t\t\tif (child.$id === id) {\r\n\t\t\t\treturn child;\r\n\t\t\t}\r\n\t\t\tvar sub = child.cell(id);\r\n\t\t\tif (sub) {\r\n\t\t\t\treturn sub;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tLayout.prototype.cellIndex = function (id) {\r\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\t\t\tif (this.$cells[i].$id === id) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t};\r\n\tLayout.prototype.moveView = function (view, ind) {\r\n\t\tif (this.$cells[ind] !== view) {\r\n\t\t\treturn window.alert(\"Not implemented\");\r\n\t\t}\r\n\t\telse {\r\n\t\t\tind += this.$config.header ? 1 : 0;\r\n\t\t\tvar node = this.$view;\r\n\t\t\tif (ind >= node.childNodes.length) {\r\n\t\t\t\tnode.appendChild(view.$view);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tnode.insertBefore(view.$view, node.childNodes[ind]);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tLayout.prototype._parseConfig = function (config) {\r\n\t\tthis.$cells = [];\r\n\t\tthis._xLayout = !config.rows;\r\n\t\tvar cells = config.rows || config.cols || config.views;\r\n\t\tfor (var i = 0; i < cells.length; i++) {\r\n\t\t\tvar cell = cells[i];\r\n\t\t\tcell.mode = this._xLayout ? \"x\" : \"y\";\r\n\t\t\tvar $content = this.$factory.initUI(cell, this);\r\n\t\t\tif(!$content){\r\n\t\t\t\tcells.splice(i, 1);\r\n\t\t\t\ti--;\r\n\t\t\t}else{\r\n\t\t\t\t$content.$parent = this;\r\n\t\t\t\tthis.$cells.push($content);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tLayout.prototype.getCells = function () {\r\n\t\treturn this.$cells;\r\n\t};\r\n\tLayout.prototype.render = function () {\r\n\t\tvar view = domHelpers.insertNode(this.$container, this.$toHTML());\r\n\r\n\t\tthis.$fill(view, null);\r\n\r\n\t\tconst gantt = this.$gantt;\r\n\t\tthis._eachChild((cell) => {\r\n\t\t\tif(cell.$externalComponent){\r\n\t\t\t\tgantt.config.external_render.renderElement(\r\n\t\t\t\t\tcell.$externalComponent, \r\n\t\t\t\t\tcell.$view.querySelector(\".gantt_layout_content\")\r\n\t\t\t\t);\r\n\t\t\t\tcell.$externalComponent = null;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.callEvent(\"onReady\", []);\r\n\t\tthis.resize();\r\n\r\n\t\t// do simple repaint after the first call\r\n\t\tthis.render = this.resize;\r\n\t};\r\n\tLayout.prototype.$fill = function (node, parent) {\r\n\t\tthis.$view = node;\r\n\t\tthis.$parent = parent;\r\n\t\tvar cells = domHelpers.getChildNodes(node, \"gantt_layout_cell\");\r\n\t\tfor (var i = cells.length - 1; i >= 0; i--) {\r\n\t\t\tvar sub = this.$cells[i];\r\n\t\t\tsub.$fill(cells[i], this);\r\n\t\t\t// initially hidden cell\r\n\t\t\tif (sub.$config.hidden) {\r\n\t\t\t\tsub.$view.parentNode.removeChild(sub.$view);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tLayout.prototype.$toHTML = function () {\r\n\t\tvar mode = this._xLayout ? \"x\" : \"y\";\r\n\t\tvar html = [];\r\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\t\t\thtml.push(this.$cells[i].$toHTML());\r\n\t\t}\r\n\t\treturn _super.prototype.$toHTML.call(this, html.join(\"\"), (this.$root ? \"gantt_layout_root \" : \"\") + \"gantt_layout gantt_layout_\" + mode);\r\n\t};\r\n\r\n\tLayout.prototype.getContentSize = function(mode){\r\n\t\tvar contentWidth = 0,\r\n\t\t\tcontentHeight = 0;\r\n\r\n\t\tvar cellSize, cell, borders;\r\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\t\t\tcell = this.$cells[i];\r\n\t\t\tif(cell.$config.hidden)\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tcellSize = cell.getContentSize(mode);\r\n\r\n\t\t\tif(cell.$config.view === \"scrollbar\" && mode[cell.$config.scroll]){\r\n\t\t\t\tcellSize.height = 0;\r\n\t\t\t\tcellSize.width = 0;\r\n\t\t\t}\r\n\r\n\t\t\tif(cell.$config.resizer){\r\n\t\t\t\tif(this._xLayout){\r\n\t\t\t\t\tcellSize.height = 0;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tcellSize.width = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tborders = cell._getBorderSizes();\r\n\r\n\t\t\tif(this._xLayout){\r\n\t\t\t\tcontentWidth += (cellSize.width + borders.horizontal);\r\n\t\t\t\tcontentHeight = Math.max(contentHeight, (cellSize.height + borders.vertical));\r\n\t\t\t}else{\r\n\t\t\t\tcontentWidth = Math.max(contentWidth, cellSize.width + borders.horizontal);\r\n\t\t\t\tcontentHeight += cellSize.height + borders.vertical;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tborders = this._getBorderSizes();\r\n\t\tcontentWidth += borders.horizontal;\r\n\t\tcontentHeight += borders.vertical;\r\n\r\n\t\t// GS-149 & GS-150: By default this code only increases the container sizes, because of that, the cell sizes\r\n\t\t// are also increased. Keep this code here in the case if something goes wrong\r\n\t\t/*\r\n\t\tif(this.$root){\r\n\t\t\tcontentWidth += 1;\r\n\t\t\tcontentHeight += 1;\r\n\t\t}\r\n\t\t*/\r\n\t\treturn {\r\n\t\t\twidth: contentWidth,\r\n\t\t\theight: contentHeight\r\n\t\t};\r\n\t};\r\n\r\n\tLayout.prototype._cleanElSize = function(value){\r\n\t\treturn ((value || \"\").toString().replace(\"px\", \"\") * 1 || 0);\r\n\t};\r\n\tLayout.prototype._getBoxStyles = function(div){\r\n\t\tvar computed = null;\r\n\t\tif(window.getComputedStyle){\r\n\t\t\tcomputed = window.getComputedStyle(div, null);\r\n\t\t}else{\r\n\t\t\t//IE with elem.currentStyle does not calculate sizes from %, so will use the default approach\r\n\t\t\tcomputed = {\r\n\t\t\t\t\"width\":div.clientWidth,\r\n\t\t\t\t\"height\":div.clientHeight\r\n\t\t\t};\r\n\t\t}\r\n\t\tvar properties = [\r\n\t\t\t\"width\",\r\n\t\t\t\"height\",\r\n\r\n\t\t\t\"paddingTop\",\r\n\t\t\t\"paddingBottom\",\r\n\t\t\t\"paddingLeft\",\r\n\t\t\t\"paddingRight\",\r\n\r\n\t\t\t\"borderLeftWidth\",\r\n\t\t\t\"borderRightWidth\",\r\n\t\t\t\"borderTopWidth\",\r\n\t\t\t\"borderBottomWidth\"\r\n\t\t];\r\n\t\tvar styles = {\r\n\t\t\tboxSizing:(computed.boxSizing == \"border-box\")\r\n\t\t};\r\n\r\n\t\tif(computed.MozBoxSizing){\r\n\t\t\tstyles.boxSizing = (computed.MozBoxSizing == \"border-box\");\r\n\t\t}\r\n\t\tfor(var i =0; i < properties.length; i++){\r\n\t\t\tstyles[properties[i]] = computed[properties[i]] ? this._cleanElSize(computed[properties[i]]) : 0;\r\n\t\t}\r\n\r\n\r\n\t\tvar box = {\r\n\t\t\thorPaddings : (styles.paddingLeft + styles.paddingRight + styles.borderLeftWidth + styles.borderRightWidth),\r\n\t\t\tvertPaddings : (styles.paddingTop + styles.paddingBottom + styles.borderTopWidth + styles.borderBottomWidth),\r\n\t\t\tborderBox: styles.boxSizing,\r\n\t\t\tinnerWidth : styles.width,\r\n\t\t\tinnerHeight : styles.height,\r\n\t\t\touterWidth : styles.width,\r\n\t\t\touterHeight : styles.height\r\n\t\t};\r\n\r\n\r\n\t\tif(box.borderBox){\r\n\t\t\tbox.innerWidth -= box.horPaddings;\r\n\t\t\tbox.innerHeight -= box.vertPaddings;\r\n\t\t}else{\r\n\t\t\tbox.outerWidth += box.horPaddings;\r\n\t\t\tbox.outerHeight += box.vertPaddings;\r\n\t\t}\r\n\r\n\t\treturn box;\r\n\t};\r\n\r\n\tLayout.prototype._getAutosizeMode = function(config){\r\n\t\tvar res = {x:false, y:false};\r\n\t\tif(config === \"xy\"){\r\n\t\t\tres.x = res.y = true;\r\n\t\t}else if(config === \"y\" || config === true){\r\n\t\t\tres.y = true;\r\n\t\t}else if(config === \"x\"){\r\n\t\t\tres.x = true;\r\n\t\t}\r\n\t\treturn res;\r\n\t};\r\n\r\n\tLayout.prototype.autosize = function(mode) {\r\n\t\tvar res = this._getAutosizeMode(mode);\r\n\t\tvar boxSizes = this._getBoxStyles(this.$container);\r\n\t\tvar contentSizes = this.getContentSize(mode);\r\n\r\n\t\tvar node = this.$container;\r\n\t\tif(res.x){\r\n\t\t\tif(boxSizes.borderBox){\r\n\t\t\t\tcontentSizes.width += boxSizes.horPaddings;\r\n\t\t\t}\r\n\t\t\tnode.style.width = contentSizes.width + \"px\";\r\n\t\t}\r\n\t\tif(res.y){\r\n\t\t\tif(boxSizes.borderBox){\r\n\t\t\t\tcontentSizes.height += boxSizes.vertPaddings;\r\n\t\t\t}\r\n\t\t\tnode.style.height = contentSizes.height + \"px\";\r\n\t\t}\r\n\t};\r\n\r\n\tLayout.prototype.getSize = function () {\r\n\t\tthis._sizes = [];\r\n\t\tvar width = 0;\r\n\t\tvar minWidth = 0;\r\n\t\tvar maxWidth = 100000000000;\r\n\t\tvar height = 0;\r\n\t\tvar maxHeight = 100000000000;\r\n\t\tvar minHeight = 0;\r\n\r\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\r\n\t\t\tvar size = this._sizes[i] = this.$cells[i].getSize();\r\n\t\t\tif (this.$cells[i].$config.hidden) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (this._xLayout) {\r\n\t\t\t\tif (!size.width && size.minWidth) {\r\n\t\t\t\t\twidth += size.minWidth;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\twidth += size.width;\r\n\t\t\t\t}\r\n\t\t\t\tmaxWidth += size.maxWidth;\r\n\t\t\t\tminWidth += size.minWidth;\r\n\t\t\t\theight = Math.max(height, size.height);\r\n\t\t\t\tmaxHeight = Math.min(maxHeight, size.maxHeight); // min of maxHeight\r\n\t\t\t\tminHeight = Math.max(minHeight, size.minHeight); // max of minHeight\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (!size.height && size.minHeight) {\r\n\t\t\t\t\theight += size.minHeight;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\theight += size.height;\r\n\t\t\t\t}\r\n\t\t\t\tmaxHeight += size.maxHeight;\r\n\t\t\t\tminHeight += size.minHeight;\r\n\t\t\t\twidth = Math.max(width, size.width);\r\n\t\t\t\tmaxWidth = Math.min(maxWidth, size.maxWidth); // min of maxWidth\r\n\t\t\t\tminWidth = Math.max(minWidth, size.minWidth); // max of minWidth\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar self = _super.prototype.getSize.call(this);\r\n\t\t// maxWidth\r\n\t\tif (self.maxWidth >= 100000) {\r\n\t\t\tself.maxWidth = maxWidth;\r\n\t\t}\r\n\t\t// maxHeight\r\n\t\tif (self.maxHeight >= 100000) {\r\n\t\t\tself.maxHeight = maxHeight;\r\n\t\t}\r\n\t\t// minWidth\r\n\t\tself.minWidth = self.minWidth !== self.minWidth ? 0 : self.minWidth;// || self.width || Math.max(minWidth, width);\r\n\t\t// minHeight\r\n\t\tself.minHeight = self.minHeight !== self.minHeight ? 0 : self.minHeight;//self.minHeight || self.height || Math.max(minHeight, height);\r\n\t\t// sizes with paddings and margins\r\n\t\tif (this._xLayout) {\r\n\t\t\tself.minWidth += this.$config.margin * (this.$cells.length) || 0;\r\n\t\t\tself.minWidth += this.$config.padding * 2 || 0;\r\n\t\t\tself.minHeight += (this.$config.padding * 2) || 0;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tself.minHeight += this.$config.margin * (this.$cells.length) || 0;\r\n\t\t\tself.minHeight += (this.$config.padding * 2) || 0;\r\n\t\t}\r\n\t\t\r\n\t\treturn self;\r\n\t};\r\n\t// calc total gravity and free space\r\n\tLayout.prototype._calcFreeSpace = function (s, cell, xLayout) {\r\n\t\tvar min = xLayout ? cell.minWidth : cell.minHeight;\r\n\t\tvar max = xLayout ? cell.maxWidth : cell.maxWidth;\r\n\t\tvar side = s;\r\n\t\tif (!side) {\r\n\t\t\tside = Math.floor(this._free / this._gravity * cell.gravity);\r\n\t\t\tif (side > max) {\r\n\t\t\t\tside = max;\r\n\t\t\t\tthis._free -= side;\r\n\t\t\t\tthis._gravity -= cell.gravity;\r\n\t\t\t}\r\n\t\t\tif (side < min) {\r\n\t\t\t\tside = min;\r\n\t\t\t\tthis._free -= side;\r\n\t\t\t\tthis._gravity -= cell.gravity;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (side > max) {\r\n\t\t\t\tside = max;\r\n\t\t\t}\r\n\t\t\tif (side < min) {\r\n\t\t\t\tside = min;\r\n\t\t\t}\r\n\t\t\tthis._free -= side;\r\n\t\t}\r\n\t\treturn side;\r\n\t};\r\n\tLayout.prototype._calcSize = function (s, size, xLayout) {\r\n\t\tvar side = s;\r\n\t\tvar min = xLayout ? size.minWidth : size.minHeight;\r\n\t\tvar max = xLayout ? size.maxWidth : size.maxHeight;\r\n\t\tif (!side) {\r\n\t\t\tside = Math.floor(this._free / this._gravity * size.gravity);\r\n\t\t}\r\n\t\tif (side > max) {\r\n\t\t\tside = max;\r\n\t\t}\r\n\t\tif (side < min) {\r\n\t\t\tside = min;\r\n\t\t}\r\n\t\treturn side;\r\n\t};\r\n\r\n\tLayout.prototype._configureBorders = function(){\r\n\t\tif(this.$root){\r\n\t\t\tthis._setBorders([\r\n\t\t\t\tthis._borders.left,\r\n\t\t\t\tthis._borders.top,\r\n\t\t\t\tthis._borders.right,\r\n\t\t\t\tthis._borders.bottom\r\n\t\t\t],\r\n\t\t\tthis);\r\n\t\t}\r\n\r\n\t\tvar borderClass = this._xLayout ? this._borders.right : this._borders.bottom;\r\n\r\n\t\tvar cells = this.$cells;\r\n\r\n\t\tvar lastVisibleIndex = cells.length - 1;\r\n\t\tfor(var i = lastVisibleIndex; i >= 0; i--){\r\n\t\t\tif (!cells[i].$config.hidden) {\r\n\t\t\t\tlastVisibleIndex = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (var i = 0; i < cells.length; i++) {\r\n\t\t\tif (cells[i].$config.hidden) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tvar lastCell = i >= lastVisibleIndex;\r\n\t\t\tvar borderColorClass = \"\";\r\n\t\t\tif(!lastCell && cells[i + 1]){\r\n\t\t\t\tif(cells[i + 1].$config.view == \"scrollbar\"){\r\n\t\t\t\t\tif(this._xLayout){\r\n\t\t\t\t\t\tlastCell = true;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tborderColorClass = \"gantt_layout_cell_border_transparent\";\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n\t\t\tthis._setBorders(lastCell ? [] : [borderClass, borderColorClass], cells[i]);\r\n\t\t}\r\n\t};\r\n\r\n\tLayout.prototype._updateCellVisibility = function(){\r\n\t\tvar oldVisibleCells = this._visibleCells || {};\r\n\t\tvar firstCall = !this._visibleCells;\r\n\t\tvar visibleCells = {};\r\n\t\tvar cell = null;\r\n\t\tvar parentVisibility = [];\r\n\t\tfor (var i = 0; i < this._sizes.length; i++) {\r\n\t\t\tcell = this.$cells[i];\r\n\t\t\tif (cell.$config.hide_empty){\r\n\t\t\t\tparentVisibility.push(cell);\r\n\t\t\t}\r\n\r\n\t\t\tif (!firstCall && cell.$config.hidden && oldVisibleCells[cell.$id]) {\r\n\t\t\t\tcell._hide(true);\r\n\t\t\t}else if(!cell.$config.hidden && !oldVisibleCells[cell.$id]){\r\n\t\t\t\tcell._hide(false);\r\n\t\t\t}\r\n\r\n\t\t\tif(!cell.$config.hidden){\r\n\t\t\t\tvisibleCells[cell.$id] = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._visibleCells = visibleCells;\r\n\r\n\t\t// GS-27. A way to hide the whole cell if all its children are hidden\r\n\t\tfor (var i = 0; i < parentVisibility.length; i++) {\r\n\t\t\tvar cell = parentVisibility[i];\r\n\t\t\tvar children = cell.$cells;\r\n\t\t\tvar hideCell = true;\r\n\t\t\tchildren.forEach(function(child){\r\n\t\t\t\tif (!child.$config.hidden && !child.$config.resizer){\r\n\t\t\t\t\thideCell = false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tcell.$config.hidden = hideCell;\r\n\t\t}\r\n\t};\r\n\r\n\tLayout.prototype.setSize = function (x, y) {\r\n\t\tthis._configureBorders();\r\n\t\t_super.prototype.setSize.call(this, x, y);\r\n\t\ty = this.$lastSize.contentY;\r\n\t\tx = this.$lastSize.contentX;\r\n\r\n\t\tvar padding = (this.$config.padding || 0);\r\n\t\tthis.$view.style.padding = padding + \"px\";\r\n\t\tthis._gravity = 0;\r\n\t\tthis._free = this._xLayout ? x : y;\r\n\t\tthis._free -= padding * 2;\r\n\t\t// calc all gravity\r\n\r\n\t\tvar cell,\r\n\t\t\tsize;\r\n\r\n\t\tthis._updateCellVisibility();\r\n\r\n\t\tfor (var i = 0; i < this._sizes.length; i++) {\r\n\t\t\tcell = this.$cells[i];\r\n\r\n\t\t\tif (cell.$config.hidden) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tvar margin = (this.$config.margin || 0);\r\n\t\t\tif(cell.$name == \"resizer\" && !margin){\r\n\t\t\t\tmargin = -1;\r\n\t\t\t}\r\n\r\n\t\t\t// set margins to child cell\r\n\t\t\tvar cellView = cell.$view;\r\n\r\n\t\t\tvar marginSide = this._xLayout ? \"marginRight\" : \"marginBottom\";\r\n\t\t\tif (i !== this.$cells.length - 1) {\r\n\t\t\t\tcellView.style[marginSide] = margin + \"px\";\r\n\t\t\t\tthis._free -= margin; // calc free space without margin\r\n\t\t\t}\r\n\t\t\tsize = this._sizes[i];\r\n\t\t\tif (this._xLayout) {\r\n\t\t\t\tif (!size.width) {\r\n\t\t\t\t\tthis._gravity += size.gravity;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (!size.height) {\r\n\t\t\t\t\tthis._gravity += size.gravity;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (var i = 0; i < this._sizes.length; i++) {\r\n\t\t\tcell = this.$cells[i];\r\n\r\n\t\t\tif (cell.$config.hidden) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tsize = this._sizes[i];\r\n\t\t\tvar width = size.width;\r\n\t\t\tvar height = size.height;\r\n\t\t\tif (this._xLayout) {\r\n\t\t\t\tthis._calcFreeSpace(width, size, true);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._calcFreeSpace(height, size, false);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\t\t\tcell = this.$cells[i];\r\n\r\n\t\t\tif (cell.$config.hidden) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tsize = this._sizes[i];\r\n\t\t\tvar dx = void 0;\r\n\t\t\tvar dy = void 0;\r\n\t\t\tif (this._xLayout) {\r\n\t\t\t\tdx = this._calcSize(size.width, size, true);\r\n\t\t\t\tdy = y - padding * 2; // layout height without paddings\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tdx = x - padding * 2; // layout width without paddings\r\n\t\t\t\tdy = this._calcSize(size.height, size, false);\r\n\t\t\t}\r\n\r\n\t\t\tcell.setSize(dx, dy);\r\n\t\t}\r\n\r\n\t};\r\n\r\n\treturn Layout;\r\n}(Cell));\r\n\r\nexport default Layout;","import __extends from \"../../../utils/extends\";\r\nimport Layout from \"./layout\";\r\nimport Cell from \"./cell\";\r\n\r\nvar ViewLayout = (function (_super) {\r\n\t\"use strict\";\r\n\r\n\t__extends(ViewLayout, _super);\r\n\tfunction ViewLayout(parent, config, factory) {\r\n\t\tvar _this = _super.apply(this, arguments) || this;\r\n\t\tfor (var i = 0; i < _this.$cells.length; i++) {\r\n\t\t\t_this.$cells[i].$config.hidden = (i !== 0);\r\n\t\t}\r\n\t\t_this.$cell = _this.$cells[0];\r\n\t\t_this.$name = \"viewLayout\";\r\n\r\n\t\treturn _this;\r\n\t}\r\n\tViewLayout.prototype.cell = function (id) {\r\n\t\tvar cell = _super.prototype.cell.call(this, id);\r\n\t\tif (!cell.$view) {\r\n\t\t\tthis.$fill(null, this);\r\n\t\t}\r\n\t\treturn cell;\r\n\t};\r\n\tViewLayout.prototype.moveView = function (view) {\r\n\t\tvar body = this.$view;\r\n\t\tif (this.$cell) {\r\n\t\t\tthis.$cell.$config.hidden = true;\r\n\t\t\tbody.removeChild(this.$cell.$view);\r\n\t\t}\r\n\t\tthis.$cell = view;\r\n\t\tbody.appendChild(view.$view);\r\n\t};\r\n\tViewLayout.prototype.setSize = function (x, y) {\r\n\t\tCell.prototype.setSize.call(this, x, y);\r\n\t};\r\n\r\n\tViewLayout.prototype.setContentSize = function(){\r\n\t\tvar size = this.$lastSize;\r\n\t\tthis.$cell.setSize(size.contentX, size.contentY);\r\n\t};\r\n\r\n\tViewLayout.prototype.getSize = function () {\r\n\t\tvar sizes = _super.prototype.getSize.call(this);\r\n\t\tif (this.$cell) {\r\n\t\t\tvar cellSize = this.$cell.getSize();\r\n\t\t\tif (this.$config.byMaxSize) {\r\n\t\t\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\t\t\t\t\tvar otherCell = this.$cells[i].getSize();\r\n\t\t\t\t\tfor (var cell in cellSize) {\r\n\t\t\t\t\t\tcellSize[cell] = Math.max(cellSize[cell], otherCell[cell]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (var size in sizes) {\r\n\t\t\t\tsizes[size] = sizes[size] || cellSize[size];\r\n\t\t\t}\r\n\t\t\tsizes.gravity = Math.max(sizes.gravity, cellSize.gravity);\r\n\t\t}\r\n\t\treturn sizes;\r\n\t};\r\n\treturn ViewLayout;\r\n}(Layout));\r\n\r\nexport default ViewLayout;","import __extends from \"../../../utils/extends\";\r\nimport * as utils from \"../../../utils/utils\";\r\nimport Cell from \"./cell\";\r\n\r\nvar ViewCell = (function (_super) {\r\n\t\"use strict\";\r\n\r\n\t__extends(ViewCell, _super);\r\n\tfunction ViewCell(parent, config, factory) {\r\n\r\n\t\tvar _this = _super.apply(this, arguments) || this;\r\n\r\n\t\tif(config.view){\r\n\t\t\tif(config.id){\r\n\t\t\t\t// pass id to the nested view\r\n\t\t\t\tthis.$id = utils.uid();\r\n\t\t\t}\r\n\t\t\tvar childConfig = utils.copy(config);\r\n\t\t\tdelete childConfig.config;\r\n\t\t\tdelete childConfig.templates;\r\n\r\n\t\t\tthis.$content = this.$factory.createView(config.view, this, childConfig, this);\r\n\t\t\tif(!this.$content)\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t_this.$name = \"viewCell\";\r\n\t\treturn _this;\r\n\t}\r\n\r\n\tViewCell.prototype.destructor = function(){\r\n\t\tthis.clear();\r\n\t\t_super.prototype.destructor.call(this);\r\n\t};\r\n\r\n\tViewCell.prototype.clear = function(){\r\n\r\n\t\tthis.$initialized = false;\r\n\r\n\t\t// call destructor\r\n\t\tif (this.$content){\r\n\t\t\tvar method = this.$content.unload || this.$content.destructor;\r\n\t\t\tif (method){\r\n\t\t\t\tmethod.call(this.$content);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t_super.prototype.clear.call(this);\r\n\r\n\t};\r\n\r\n\tViewCell.prototype.scrollTo = function(left, top){\r\n\r\n\t\tif(this.$content && this.$content.scrollTo){\r\n\t\t\tthis.$content.scrollTo(left, top);\r\n\t\t}else{\r\n\t\t\t_super.prototype.scrollTo.call(this, left, top);\r\n\t\t}\r\n\t};\r\n\r\n\tViewCell.prototype._setContentSize = function(x, y){\r\n\t\tvar borders = this._getBorderSizes();\r\n\t\tif(typeof x === \"number\"){\r\n\t\t\tvar outerX = x + borders.horizontal;\r\n\t\t\tthis.$config.width = outerX;\r\n\t\t}\r\n\t\tif(typeof y === \"number\"){\r\n\t\t\tvar outerY = y + borders.vertical;\r\n\t\t\tthis.$config.height = outerY;\r\n\t\t}\r\n\t};\r\n\r\n\tViewCell.prototype.setSize = function(x, y){\r\n\t\t_super.prototype.setSize.call(this, x, y);\r\n\r\n\t\tif(!this.$preResize && this.$content) {\r\n\t\t\tif (!this.$initialized) {\r\n\t\t\t\tthis.$initialized = true;\r\n\t\t\t\tvar header = this.$view.childNodes[0];\r\n\t\t\t\tvar content = this.$view.childNodes[1];\r\n\t\t\t\tif(!content) content = header;\r\n\r\n\t\t\t\t/*if(this.$content.$config){\r\n\t\t\t\t\tthis.$content.$config.width = this.$lastSize.contentX;\r\n\t\t\t\t\tthis.$content.$config.height = this.$lastSize.contentY;\r\n\t\t\t\t}*/\r\n\t\t\t\tthis.$content.init(content);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tViewCell.prototype.setContentSize = function(){\r\n\t\tif(!this.$preResize && this.$content) {\r\n\t\t\tif (this.$initialized) {\r\n\t\t\t\tthis.$content.setSize(this.$lastSize.contentX, this.$lastSize.contentY);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tViewCell.prototype.getContentSize = function(){\r\n\t\tvar size = _super.prototype.getContentSize.call(this);\r\n\r\n\t\tif(this.$content && this.$initialized){\r\n\t\t\tvar childSize = this.$content.getSize();\r\n\t\t\tsize.width = childSize.contentX === undefined ? childSize.width : childSize.contentX;\r\n\t\t\tsize.height = childSize.contentY === undefined ? childSize.height : childSize.contentY;\r\n\t\t}\r\n\r\n\t\tvar borders = this._getBorderSizes();\r\n\t\tsize.width += borders.horizontal;\r\n\t\tsize.height += borders.vertical;\r\n\r\n\t\treturn size;\r\n\t};\r\n\r\n\treturn ViewCell;\r\n}(Cell));\r\n\r\nexport default ViewCell;","import __extends from \"../../../utils/extends\";\r\nimport * as domHelpers from \"../utils/dom_helpers\";\r\nimport * as utils from \"../../../utils/utils\";\r\nimport env from \"../../../utils/env\";\r\nimport Cell from \"./cell\";\r\n\r\nvar ScrollbarCell = (function (_super) {\r\n\t\"use strict\";\r\n\r\n\tvar SCROLL_MODIFIER_KEYS = [\"altKey\", \"shiftKey\", \"metaKey\"]; // it's no way to disable ctrl+wheel\r\n\t__extends(ScrollbarCell, _super);\r\n\tfunction ScrollbarCell(parent, config, factory, gantt) {\r\n\r\n\t\tvar _this = _super.apply(this, arguments) || this;\r\n\t\tthis.$config = utils.mixin(config, {scroll: \"x\"});\r\n\t\t_this._scrollHorizontalHandler = utils.bind(_this._scrollHorizontalHandler, _this);\r\n\t\t_this._scrollVerticalHandler = utils.bind(_this._scrollVerticalHandler, _this);\r\n\t\t_this._outerScrollVerticalHandler = utils.bind(_this._outerScrollVerticalHandler, _this);\r\n\t\t_this._outerScrollHorizontalHandler = utils.bind(_this._outerScrollHorizontalHandler, _this);\r\n\t\t_this._mouseWheelHandler = utils.bind(_this._mouseWheelHandler, _this);\r\n\r\n\t\tthis.$config.hidden = true;\r\n\t\tvar size = gantt.config.scroll_size;\r\n\r\n\t\tif(gantt.env.isIE){\r\n\t\t\t// full element height/width must be bigger than just a browser scrollbar,\r\n\t\t\t// otherwise the scrollbar element won't be scrolled on click\r\n\t\t\tsize += 1;\r\n\t\t}\r\n\r\n\t\tif(this._isHorizontal()){\r\n\t\t\t_this.$config.height = size;\r\n\t\t\t_this.$parent.$config.height = size;\r\n\t\t}else{\r\n\t\t\t_this.$config.width = size;\r\n\t\t\t_this.$parent.$config.width = size;\r\n\t\t}\r\n\r\n\t\tthis.$config.scrollPosition = 0;\r\n\r\n\t\t_this.$name = \"scroller\";\r\n\t\treturn _this;\r\n\t}\r\n\r\n\tScrollbarCell.prototype.init = function(container){\r\n\t\tcontainer.innerHTML = this.$toHTML();\r\n\t\tthis.$view = container.firstChild;\r\n\r\n\t\tif(!this.$view){\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t\tif(this._isVertical()){\r\n\t\t\tthis._initVertical();\r\n\t\t}else{\r\n\t\t\tthis._initHorizontal();\r\n\t\t}\r\n\t\tthis._initMouseWheel();\r\n\t\tthis._initLinkedViews();\r\n\t};\r\n\r\n\tScrollbarCell.prototype.$toHTML = function () {\r\n\t\tvar className = this._isHorizontal() ? \"gantt_hor_scroll\" : \"gantt_ver_scroll\";\r\n\t\treturn \"<div class='gantt_layout_cell \"+className+\"'><div style='\"+(this._isHorizontal() ? \"width:2000px\" : \"height:2000px\")+\"'></div></div>\";\r\n\t};\r\n\r\n\tScrollbarCell.prototype._getRootParent = function(){\r\n\t\tvar parent = this.$parent;\r\n\t\twhile(parent && parent.$parent){\r\n\t\t\tparent = parent.$parent;\r\n\t\t}\r\n\t\tif(parent){\r\n\t\t\treturn parent;\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tfunction eachCell(root, res){\r\n\t\tres.push(root);\r\n\t\tif(root.$cells){\r\n\t\t\tfor(var i = 0; i < root.$cells.length; i++){\r\n\t\t\t\teachCell(root.$cells[i], res);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tScrollbarCell.prototype._eachView = function(){\r\n\t\tvar res = [];\r\n\t\teachCell(this._getRootParent(), res);\r\n\t\treturn res;\r\n\t};\r\n\r\n\tScrollbarCell.prototype._getLinkedViews = function(){\r\n\t\tvar views = this._eachView();\r\n\t\tvar res = [];\r\n\t\tfor(var i = 0; i < views.length; i++){\r\n\t\t\tif(views[i].$config && ((this._isVertical() && views[i].$config.scrollY == this.$id) || (this._isHorizontal() && views[i].$config.scrollX == this.$id)) ){\r\n\t\t\t\tres.push(views[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn res;\r\n\t};\r\n\r\n\r\n\tScrollbarCell.prototype._initHorizontal = function(){\r\n\t\tthis.$scroll_hor = this.$view;\r\n\t\tthis.$domEvents.attach(this.$view, \"scroll\", this._scrollHorizontalHandler);\r\n\r\n\t};\r\n\r\n\tScrollbarCell.prototype._initLinkedViews = function(){\r\n\t\tvar views = this._getLinkedViews();\r\n\t\tvar css = this._isVertical() ?\"gantt_layout_outer_scroll gantt_layout_outer_scroll_vertical\" : \"gantt_layout_outer_scroll gantt_layout_outer_scroll_horizontal\";\r\n\t\tfor(var i = 0; i < views.length; i++){\r\n\t\t\t//views[i].$config.css = [views[i].$config.css || \"\", css].join(\" \");\r\n\t\t\tdomHelpers.addClassName(views[i].$view || views[i].getNode(), css);\r\n\t\t}\r\n\t};\r\n\r\n\tScrollbarCell.prototype._initVertical = function(){\r\n\t\tthis.$scroll_ver = this.$view;\r\n\t\tthis.$domEvents.attach(this.$view, \"scroll\", this._scrollVerticalHandler);\r\n\t};\r\n\r\n\tScrollbarCell.prototype._updateLinkedViews = function(){\r\n\t};\r\n\r\n\tScrollbarCell.prototype._initMouseWheel = function(){\r\n\t\tvar ff = env.isFF;\r\n\t\tif (ff)\r\n\t\t\tthis.$domEvents.attach(this._getRootParent().$view, \"wheel\", this._mouseWheelHandler, {passive: false});\r\n\t\telse\r\n\t\t\tthis.$domEvents.attach(this._getRootParent().$view, \"mousewheel\", this._mouseWheelHandler, {passive: false});\r\n\t};\r\n\r\n\r\n\r\n\r\n\tScrollbarCell.prototype.scrollHorizontally = function(left){\r\n\t\tif(this._scrolling) return;\r\n\t\tthis._scrolling = true;\r\n\r\n\t\tthis.$scroll_hor.scrollLeft = left;\r\n\t\tthis.$config.codeScrollLeft = left;\r\n\t\tleft = this.$scroll_hor.scrollLeft;\r\n\r\n\t\tvar views = this._getLinkedViews();\r\n\t\tfor(var i = 0; i < views.length; i++){\r\n\t\t\tif(views[i].scrollTo){\r\n\t\t\t\tviews[i].scrollTo(left, undefined);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar oldSize = this.$config.scrollPosition;\r\n\t\tthis.$config.scrollPosition = left;\r\n\t\tthis.callEvent(\"onScroll\", [oldSize, left, this.$config.scroll]);\r\n\t\tthis._scrolling = false;\r\n\t};\r\n\tScrollbarCell.prototype.scrollVertically = function(top){\r\n\t\tif(this._scrolling) return;\r\n\t\tthis._scrolling = true;\r\n\r\n\t\tthis.$scroll_ver.scrollTop = top;\r\n\t\ttop = this.$scroll_ver.scrollTop;\r\n\r\n\t\tvar views = this._getLinkedViews();\r\n\r\n\t\tfor(var i = 0; i < views.length; i++){\r\n\t\t\tif(views[i].scrollTo){\r\n\t\t\t\tviews[i].scrollTo(undefined, top);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar oldSize = this.$config.scrollPosition;\r\n\t\tthis.$config.scrollPosition = top;\r\n\t\tthis.callEvent(\"onScroll\", [oldSize, top, this.$config.scroll]);\r\n\t\tthis._scrolling = false;\r\n\t};\r\n\r\n\tScrollbarCell.prototype._isVertical = function(){\r\n\t\treturn this.$config.scroll == \"y\";\r\n\t};\r\n\tScrollbarCell.prototype._isHorizontal = function(){\r\n\t\treturn this.$config.scroll == \"x\";\r\n\t};\r\n\tScrollbarCell.prototype._scrollHorizontalHandler = function (e) {\r\n\t\tif(this._isVertical() || this._scrolling){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//in safari we can catch previous onscroll after setting new value from mouse-wheel event\r\n\t\t//set delay to prevent value drifiting\r\n\t\tif ((new Date()) - ( this._wheel_time || 0 ) < 100) return true;\r\n\t\t//if (this.$gantt._touch_scroll_active) return;\r\n\t\tvar left = this.$scroll_hor.scrollLeft;\r\n\r\n\t\tthis.scrollHorizontally(left);\r\n\r\n\t\tthis._oldLeft = this.$scroll_hor.scrollLeft;\r\n\t};\r\n\tScrollbarCell.prototype._outerScrollHorizontalHandler = function(e){\r\n\t\tif(this._isVertical()){\r\n\t\t\treturn;\r\n\t\t}\r\n\t};\r\n\r\n\tScrollbarCell.prototype.show = function(){\r\n\t\tthis.$parent.show();\r\n\t};\r\n\tScrollbarCell.prototype.hide = function(){\r\n\t\tthis.$parent.hide();\r\n\t};\r\n\r\n\tScrollbarCell.prototype._getScrollSize = function(){\r\n\t\tvar scrollSize = 0;\r\n\t\tvar outerSize = 0;\r\n\t\tvar isHorizontal = this._isHorizontal();\r\n\r\n\t\tvar linked = this._getLinkedViews();\r\n\t\tvar view;\r\n\t\tvar scrollProperty = isHorizontal ? \"scrollWidth\" : \"scrollHeight\",\r\n\t\t\tinnerSizeProperty = isHorizontal ? \"contentX\" : \"contentY\";\r\n\t\tvar outerProperty = isHorizontal ? \"x\" : \"y\";\r\n\t\tvar offset = this._getScrollOffset();\r\n\r\n\t\tfor(var i = 0; i < linked.length; i++){\r\n\t\t\tview = linked[i];\r\n\t\t\tif(!(view && view.$content && view.$content.getSize && !view.$config.hidden)) continue;\r\n\r\n\t\t\tvar sizes = view.$content.getSize();\r\n\t\t\tvar cellScrollSize;\r\n\t\t\tif(sizes.hasOwnProperty(scrollProperty)){\r\n\t\t\t\tcellScrollSize = sizes[scrollProperty];\r\n\t\t\t}else{\r\n\t\t\t\tcellScrollSize = sizes[innerSizeProperty];\r\n\t\t\t}\r\n\r\n\t\t\tif(offset){\r\n\t\t\t\t// precalculated vertical/horizontal offsets of scrollbar to emulate 4.x look\r\n\t\t\t\tif(sizes[innerSizeProperty] > sizes[outerProperty] && sizes[innerSizeProperty] > scrollSize && (cellScrollSize > (sizes[outerProperty] - offset + 2))){\r\n\t\t\t\t\tscrollSize = cellScrollSize + (isHorizontal ? 0 : 2);\r\n\t\t\t\t\touterSize = sizes[outerProperty];\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tvar nonScrollableSize = Math.max(sizes[innerSizeProperty] - cellScrollSize, 0);\r\n\t\t\t\tvar scrollableViewPortSize = Math.max(sizes[outerProperty] - nonScrollableSize, 0);\r\n\t\t\t\tcellScrollSize = cellScrollSize + nonScrollableSize;\r\n\r\n\t\t\t\tif(cellScrollSize > scrollableViewPortSize && (cellScrollSize > scrollSize) ){\r\n\t\t\t\t\t//|| (cellScrollSize === scrollSize && sizes[outerProperty] < outerSize) // same scroll width but smaller scrollable view port\r\n\r\n\t\t\t\t\tscrollSize = cellScrollSize;\r\n\t\t\t\t\touterSize = sizes[outerProperty];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\touterScroll: outerSize,\r\n\t\t\tinnerScroll: scrollSize\r\n\t\t};\r\n\t};\r\n\r\n\tScrollbarCell.prototype.scroll = function(position){\r\n\t\tif(this._isHorizontal()){\r\n\t\t\tthis.scrollHorizontally(position);\r\n\t\t}else{\r\n\t\t\tthis.scrollVertically(position);\r\n\t\t}\r\n\t};\r\n\r\n\tScrollbarCell.prototype.getScrollState = function(){\r\n\t\treturn {\r\n\t\t\tvisible: this.isVisible(),\r\n\t\t\tdirection: this.$config.scroll,\r\n\t\t\tsize: this.$config.outerSize,\r\n\t\t\tscrollSize: this.$config.scrollSize || 0,\r\n\t\t\tposition: this.$config.scrollPosition || 0\r\n\t\t};\r\n\t};\r\n\r\n\tScrollbarCell.prototype.setSize = function(width, height){\r\n\t\t_super.prototype.setSize.apply(this, arguments);\r\n\r\n\t\tvar scrollSizes = this._getScrollSize();\r\n\r\n\t\tvar ownSize = (this._isVertical() ? height : width) - this._getScrollOffset() + (this._isHorizontal() ? 1 : 0);\r\n\r\n\t\tif(scrollSizes.innerScroll && ownSize > scrollSizes.outerScroll){\r\n\t\t\tscrollSizes.innerScroll += (ownSize - scrollSizes.outerScroll);\r\n\t\t}\r\n\t\tthis.$config.scrollSize = scrollSizes.innerScroll;\r\n\r\n\t\tthis.$config.width = width;\r\n\t\tthis.$config.height = height;\r\n\t\tthis._setScrollSize(scrollSizes.innerScroll);\r\n\t};\r\n\r\n\tScrollbarCell.prototype.isVisible = function(){\r\n\t\treturn !!(this.$parent && this.$parent.$view.parentNode);\r\n\t};\r\n\r\n\tScrollbarCell.prototype.shouldShow = function(){\r\n\t\tvar scrollSizes = this._getScrollSize();\r\n\t\tif(!scrollSizes.innerScroll && (this.$parent && this.$parent.$view.parentNode)){\r\n\t\t\treturn false;\r\n\t\t}else if(scrollSizes.innerScroll && !(this.$parent && this.$parent.$view.parentNode)){\r\n\t\t\treturn true;\r\n\t\t}else{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t};\r\n\r\n\tScrollbarCell.prototype.shouldHide = function(){\r\n\t\tvar scrollSizes = this._getScrollSize();\r\n\t\tif(!scrollSizes.innerScroll && (this.$parent && this.$parent.$view.parentNode)){\r\n\t\t\treturn true;\r\n\t\t}else{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tScrollbarCell.prototype.toggleVisibility = function(){\r\n\t\tif(this.shouldHide()){\r\n\t\t\tthis.hide();\r\n\t\t}else if(this.shouldShow()){\r\n\t\t\tthis.show();\r\n\t\t}\r\n\t};\r\n\r\n\tScrollbarCell.prototype._getScaleOffset = function(view){\r\n\t\tvar offset = 0;\r\n\t\tif(view && (view.$config.view == \"timeline\" || view.$config.view == \"grid\")){\r\n\t\t\toffset = view.$content.$getConfig().scale_height;\r\n\t\t}\r\n\t\treturn offset;\r\n\t};\r\n\r\n\tScrollbarCell.prototype._getScrollOffset = function(){\r\n\t\tvar offset = 0;\r\n\t\tif(this._isVertical()){\r\n\t\t\tvar parentLayout = this.$parent.$parent;\r\n\t\t\toffset = Math.max(\r\n\t\t\t\tthis._getScaleOffset(parentLayout.getPrevSibling(this.$parent.$id)),\r\n\t\t\t\tthis._getScaleOffset(parentLayout.getNextSibling(this.$parent.$id))\r\n\t\t\t\t);\r\n\t\t}else{\r\n\t\t\tvar linked = this._getLinkedViews();\r\n\r\n\t\t\tfor (var i = 0; i < linked.length; i++) {\r\n\t\t\t\tvar view = linked[i],\r\n\t\t\t\t\tvparent = view.$parent;\r\n\t\t\t\tvar cells = vparent.$cells;\r\n\r\n\t\t\t\tvar last = cells[cells.length - 1];\r\n\r\n\t\t\t\tif (last && last.$config.view == \"scrollbar\" && last.$config.hidden === false) {\r\n\t\t\t\t\toffset = last.$config.width;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn offset || 0;\r\n\t};\r\n\r\n\tScrollbarCell.prototype._setScrollSize = function(size){\r\n\t\tvar property = this._isHorizontal() ? \"width\" : \"height\";\r\n\t\tvar scrollbar = this._isHorizontal() ? this.$scroll_hor : this.$scroll_ver;\r\n\r\n\t\tvar offset = this._getScrollOffset();\r\n\r\n\t\tvar node = scrollbar.firstChild;\r\n\r\n\t\tif(offset){\r\n\t\t\tif(this._isVertical()){\r\n\r\n\t\t\t\tthis.$config.outerSize = (this.$config.height - offset + 3);\r\n\t\t\t\tscrollbar.style.height = this.$config.outerSize + \"px\";\r\n\t\t\t\tscrollbar.style.top = (offset-1) + \"px\";\r\n\t\t\t\tdomHelpers.addClassName(scrollbar, this.$parent._borders.top);\r\n\t\t\t\tdomHelpers.addClassName(scrollbar.parentNode, \"gantt_task_vscroll\");\r\n\t\t\t}else{\r\n\t\t\t\tthis.$config.outerSize = (this.$config.width - offset + 1);\r\n\t\t\t\tscrollbar.style.width = this.$config.outerSize + \"px\";\r\n\t\t\t\t//domHelpers.addClassName(scrollbar, this.$parent._borders.right);\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tscrollbar.style.top = \"auto\";\r\n\t\t\tdomHelpers.removeClassName(scrollbar, this.$parent._borders.top);\r\n\t\t\tdomHelpers.removeClassName(scrollbar.parentNode, \"gantt_task_vscroll\");\r\n\t\t\tthis.$config.outerSize = this.$config.height;\r\n\t\t}\r\n\r\n\t\tnode.style[property] = size + \"px\";\r\n\t};\r\n\r\n\tScrollbarCell.prototype._scrollVerticalHandler = function (e) {\r\n\t\tif(this._scrollHorizontalHandler() || this._scrolling){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//if (this.$gantt._touch_scroll_active) return;\r\n\t\tvar top = this.$scroll_ver.scrollTop;\r\n\t\tvar prev = this._oldTop;\r\n\t\tif(top == prev) return;\r\n\r\n\t\tthis.scrollVertically(top);\r\n\r\n\t\tthis._oldTop = this.$scroll_ver.scrollTop;\r\n\r\n\t};\r\n\tScrollbarCell.prototype._outerScrollVerticalHandler = function(e){\r\n\t\tif(this._scrollHorizontalHandler()){\r\n\t\t\treturn;\r\n\t\t}\r\n\t};\r\n\r\n\tScrollbarCell.prototype._checkWheelTarget = function(targetNode){\r\n\t\tvar connectedViews = this._getLinkedViews().concat(this);\r\n\r\n\t\tfor(var i = 0; i < connectedViews.length; i++){\r\n\t\t\tvar node = connectedViews[i].$view;\r\n\t\t\tif(domHelpers.isChildOf(targetNode, node)){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t};\r\n\r\n\tScrollbarCell.prototype._mouseWheelHandler = function(e){\r\n\t\tvar target = e.target || e.srcElement;\r\n\r\n\t\tif(!this._checkWheelTarget(target))\r\n\t\t\treturn;\r\n\r\n\t\tthis._wheel_time = new Date();\r\n\r\n\t\tvar res = {};\r\n\r\n\t\tvar wheelSpeed = {x: 1, y: 1};\r\n\t\tvar wheelSpeedConfig = this.$gantt.config.wheel_scroll_sensitivity;\r\n\r\n\t\tif (typeof wheelSpeedConfig == \"number\" && !!wheelSpeedConfig) {\r\n\t\t\twheelSpeed = {x: wheelSpeedConfig, y: wheelSpeedConfig};\r\n\t\t}\r\n\t\telse if (({}).toString.apply(wheelSpeedConfig) == \"[object Object]\") {\r\n\t\t\twheelSpeed = {x: wheelSpeedConfig.x, y: wheelSpeedConfig.y};\r\n\t\t}\r\n\r\n\t\tvar ff = env.isFF;\r\n\t\tvar deltaX = ff ? (e.deltaX) : e.wheelDeltaX;\r\n\t\tvar deltaY = ff ? (e.deltaY) : e.wheelDelta;\r\n\r\n\t\tvar multiplier = -20;\r\n\t\tif (ff) {\r\n\t\t\t// GS-1500. Firefox had many changes during the versions\r\n\t\t\tconst version = parseInt(navigator.userAgent.split(\"Firefox/\")[1]);\r\n\t\t\tif (version <= 87){\r\n\t\t\t\tif (e.deltaMode !== 0) {\r\n\t\t\t\t\tmultiplier = -40;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmultiplier = -10;\r\n\t\t\t\t}\r\n\t\t\t} else if (version <= 90){\r\n\t\t\t\tmultiplier = -3;\r\n\t\t\t} else if (version <= 96){\r\n\t\t\t\tmultiplier = -1.5;\r\n\t\t\t} else {\r\n\t\t\t\tmultiplier = -1;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar wx = ff ? (deltaX * multiplier * wheelSpeed.x) : deltaX * 2 * wheelSpeed.x;\r\n\t\tvar wy = ff ? (deltaY * multiplier * wheelSpeed.y) : deltaY * wheelSpeed.y;\r\n\r\n\t\tvar horizontalScrollModifier = this.$gantt.config.horizontal_scroll_key;\r\n\r\n\t\tif (horizontalScrollModifier !== false) {\r\n\t\t\tif (SCROLL_MODIFIER_KEYS.indexOf(horizontalScrollModifier) >= 0) {\r\n\t\t\t\tif(e[horizontalScrollModifier] && !(e.deltaX || e.wheelDeltaX)){\r\n\t\t\t\t\t// shift+mousewheel for horizontal scroll\r\n\t\t\t\t\twx = wy*2;\r\n\t\t\t\t\twy = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tif (wx && Math.abs(wx) > Math.abs(wy)){\r\n\t\t\tif(this._isVertical()){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(res.x) return true;//no horisontal scroll, must not block scrolling\r\n\t\t\tif(!this.$scroll_hor || !this.$scroll_hor.offsetWidth) return true;\r\n\r\n\t\t\tvar dir  = wx/-40;\r\n\t\t\tvar oldLeft = this._oldLeft;\r\n\t\t\tvar left = oldLeft+dir*30;\r\n\t\t\tthis.scrollHorizontally(left);\r\n\t\t\tthis.$scroll_hor.scrollLeft = left;\r\n\t\t\t// not block scroll if position hasn't changed\r\n\t\t\tif(oldLeft == this.$scroll_hor.scrollLeft){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tthis._oldLeft = this.$scroll_hor.scrollLeft;\r\n\t\t} else {\r\n\t\t\tif(this._isHorizontal()){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(res.y) return true;//no vertical scroll, must not block scrolling\r\n\t\t\tif(!this.$scroll_ver || !this.$scroll_ver.offsetHeight) return true;\r\n\r\n\t\t\tvar dir  = wy/-40;\r\n\t\t\tif (typeof wy == \"undefined\")\r\n\t\t\t\tdir = e.detail;\r\n\r\n\t\t\tvar oldTop = this._oldTop;\r\n\t\t\tvar top = this.$scroll_ver.scrollTop+dir*30;\r\n\r\n\t\t\t//if(!this.$gantt.config.prevent_default_scroll &&\r\n\t\t\t//\t(this.$gantt._cached_scroll_pos && ((this.$gantt._cached_scroll_pos.y == top) || (this.$gantt._cached_scroll_pos.y <= 0 && top <= 0)))) return true;\r\n\r\n\r\n\t\t\tthis.scrollVertically(top);\r\n\t\t\tthis.$scroll_ver.scrollTop = top;\r\n\r\n\t\t\t// not block scroll if position hasn't changed\r\n\t\t\tif(oldTop == this.$scroll_ver.scrollTop){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tthis._oldTop = this.$scroll_ver.scrollTop;\r\n\t\t}\r\n\r\n\t\tif (e.preventDefault)\r\n\t\t\te.preventDefault();\r\n\t\te.cancelBubble=true;\r\n\t\treturn false;\r\n\t};\r\n\r\n\treturn ScrollbarCell;\r\n})(Cell);\r\n\r\nexport default ScrollbarCell;","import quickPositionHelperFactory from \"./row_position_fixed_height\";\r\n\r\nfunction createMixin(view){\r\n\tvar getItemTopCache = {};\r\n\tvar getRowTopCache = {};\r\n\tvar getItemHeightCache = null;\r\n\tvar totalHeightCache = -1;\r\n\tvar getItemHeightCacheState = null;\r\n\r\n\tvar quickPosition = quickPositionHelperFactory(view);\r\n\r\n\treturn {\r\n\t\t_resetTopPositionHeight: function(){\r\n\t\t\tgetItemTopCache = {};\r\n\t\t\tgetRowTopCache = {};\r\n\t\t\tquickPosition.resetCache();\r\n\t\t},\r\n\t\t_resetHeight: function(){\r\n\t\t\tvar store = this.$config.rowStore;\r\n\t\t\tvar newState = this.getCacheStateTotalHeight(store);\r\n\t\t\tif(!getItemHeightCacheState){\r\n\t\t\t\tgetItemHeightCacheState = newState;\r\n\t\t\t}else if(this.shouldClearHeightCache(getItemHeightCacheState, newState)){\r\n\t\t\t\tgetItemHeightCacheState = newState;\r\n\t\t\t\tgetItemHeightCache = null;\r\n\t\t\t}\r\n\r\n\t\t\ttotalHeightCache = -1;\r\n\t\t\tquickPosition.resetCache();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get top coordinate by row index (order)\r\n\t\t * @param {number} index\r\n\t\t */\r\n\t\tgetRowTop: function(index){\r\n\t\t\tif(quickPosition.canUseSimpleCalculation()){\r\n\t\t\t\treturn quickPosition.getRowTop(index);\r\n\t\t\t}\r\n\r\n\t\t\tvar store = this.$config.rowStore;\r\n\t\t\tif(!store){\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t\tif(getRowTopCache[index] !== undefined){\r\n\t\t\t\treturn getRowTopCache[index];\r\n\t\t\t}else {\r\n\t\t\t\tvar all = store.getIndexRange();\r\n\t\t\t\tvar top = 0;\r\n\t\t\t\tvar result = 0;\r\n\t\t\t\tfor(var i = 0; i < all.length; i++){\r\n\t\t\t\t\tgetRowTopCache[i] = top;\r\n\t\t\t\t\ttop += this.getItemHeight(all[i].id);\r\n\t\t\t\t\tif(i < index){\r\n\t\t\t\t\t\tresult = top;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get top coordinate by item id\r\n\t\t * @param {*} task_id\r\n\t\t */\r\n\t\tgetItemTop: function (taskId) {\r\n\t\t\tif(this.$config.rowStore){\r\n\t\t\t\tif(getItemTopCache[taskId] !== undefined){\r\n\t\t\t\t\treturn getItemTopCache[taskId];\r\n\t\t\t\t}\r\n\t\t\t\tvar store = this.$config.rowStore;\r\n\t\t\t\tif(!store) return 0;\r\n\r\n\t\t\t\tvar itemIndex = store.getIndexById(taskId);\r\n\r\n\t\t\t\tif (itemIndex === -1 && store.getParent && store.exists(taskId)) {\r\n\t\t\t\t\tvar parentId = store.getParent(taskId);\r\n\t\t\t\t\tif (store.exists(parentId)) {\r\n\t\t\t\t\t\t// if task is not found in list - maybe it's parent is a split task and we should use parents index instead\r\n\t\t\t\t\t\tvar parent = store.getItem(parentId);\r\n\t\t\t\t\t\tif (this.$gantt.isSplitTask(parent)) {\r\n\t\t\t\t\t\t\treturn this.getItemTop(parentId);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tgetItemTopCache[taskId] = this.getRowTop(itemIndex);\r\n\t\t\t\treturn getItemTopCache[taskId];\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get height of the item by item id\r\n\t\t * @param {*} itemId\r\n\t\t */\r\n\t\tgetItemHeight: function (itemId) {\r\n\t\t\tif(quickPosition.canUseSimpleCalculation()){\r\n\t\t\t\treturn quickPosition.getItemHeight(itemId);\r\n\t\t\t}\r\n\r\n\t\t\tif(!getItemHeightCache && this.$config.rowStore){\r\n\t\t\t\tthis._fillHeightCache(this.$config.rowStore);\r\n\t\t\t}\r\n\r\n\t\t\tif(getItemHeightCache[itemId] !== undefined){\r\n\t\t\t\treturn getItemHeightCache[itemId];\r\n\t\t\t}\r\n\r\n\t\t\tvar defaultHeight = this.$getConfig().row_height;\r\n\r\n\t\t\tif(this.$config.rowStore){\r\n\t\t\t\tvar store = this.$config.rowStore;\r\n\t\t\t\tif(!store) return defaultHeight;\r\n\r\n\t\t\t\tvar item = store.getItem(itemId);\r\n\r\n\t\t\t\treturn getItemHeightCache[itemId] = item && item.row_height || defaultHeight;\r\n\t\t\t}else{\r\n\t\t\t\treturn defaultHeight;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_fillHeightCache: function(store){\r\n\t\t\tif(!store){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tgetItemHeightCache = {};\r\n\t\t\tvar defaultHeight = this.$getConfig().row_height;\r\n\t\t\tstore.eachItem(function(item){\r\n\t\t\t\treturn getItemHeightCache[item.id] = item && item.row_height || defaultHeight;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetCacheStateTotalHeight: function(store){\r\n\r\n\t\t\tvar globalHeight = this.$getConfig().row_height;\r\n\t\t\tvar itemHeightCache = {};\r\n\t\t\tvar items = [];\r\n\t\t\tvar sumHeight = 0;\r\n\t\t\tif(store){\r\n\t\t\t\tstore.eachItem(function(item){\r\n\t\t\t\t\titems.push(item);\r\n\t\t\t\t\titemHeightCache[item.id] = item.row_height;\r\n\t\t\t\t\tsumHeight += item.row_height || globalHeight;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\r\n\t\t\treturn {\r\n\t\t\t\tglobalHeight: globalHeight,\r\n\t\t\t\titems: items,\r\n\t\t\t\tcount: items.length,\r\n\t\t\t\tsumHeight: sumHeight\r\n\t\t\t};\r\n\t\t},\r\n\t\tshouldClearHeightCache: function(oldState, newState){\r\n\r\n\t\t\tif(oldState.count != newState.count){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif(oldState.globalHeight != newState.globalHeight){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tif(oldState.sumHeight != newState.sumHeight){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tfor(var i in oldState.items){\r\n\t\t\t\tvar newValue = newState.items[i];\r\n\t\t\t\tif(newValue !== undefined && newValue != oldState.items[i]){\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\t/**\r\n\t\t * Get total height of items\r\n\t\t */\r\n\t\tgetTotalHeight: function () {\r\n\t\t\tif(quickPosition.canUseSimpleCalculation()){\r\n\t\t\t\treturn quickPosition.getTotalHeight();\r\n\t\t\t}\r\n\r\n\t\t\tif(totalHeightCache != -1){\r\n\t\t\t\treturn totalHeightCache;\r\n\t\t\t}\r\n\r\n\t\t\tif(this.$config.rowStore){\r\n\t\t\t\tvar store = this.$config.rowStore;\r\n\t\t\t\tthis._fillHeightCache(store);\r\n\t\t\t\tvar getHeight = this.getItemHeight.bind(this);\r\n\t\t\t\tvar visibleItems = store.getVisibleItems();\r\n\t\t\t\tvar totalHeight = 0;\r\n\r\n\t\t\t\tvisibleItems.forEach(function(item){\r\n\t\t\t\t\ttotalHeight += getHeight(item.id);\r\n\t\t\t\t});\r\n\r\n\t\t\t\ttotalHeightCache = totalHeight;\r\n\t\t\t\treturn totalHeight;\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get item by top position\r\n\t\t * @param {*} top\r\n\t\t */\r\n\t\tgetItemIndexByTopPosition: function (top) {\r\n\t\t\tif(this.$config.rowStore){\r\n\t\t\t\tif(quickPosition.canUseSimpleCalculation()){\r\n\t\t\t\t\treturn quickPosition.getItemIndexByTopPosition(top);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar store = this.$config.rowStore;\r\n\t\t\t\tfor(var i = 0; i < store.countVisible(); i++){\r\n\t\t\t\t\tvar current = this.getRowTop(i);\r\n\t\t\t\t\tvar next = this.getRowTop(i+1);\r\n\t\t\t\t\tif(!next){\r\n\t\t\t\t\t\tvar taskId = store.getIdByIndex(i);\r\n\t\t\t\t\t\tnext = current + this.getItemHeight(taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(top >= current && top < next){\r\n\t\t\t\t\t\treturn i;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// GS-1723: If we iterated all tasks and didn't find the position, the target is below all other tasks\r\n\t\t\t\treturn store.countVisible() + 2;\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default createMixin;","function createHelper(view){\r\n\tvar cachedRowHeight = -1;\r\n\tvar canUseSimpleCalc = -1;\r\n\treturn {\r\n\t\tresetCache: function(){\r\n\t\t\tcachedRowHeight = -1;\r\n\t\t\tcanUseSimpleCalc = -1;\r\n\t\t},\r\n\t\t_getRowHeight: function(){\r\n\t\t\tif(cachedRowHeight === -1){\r\n\t\t\t\tcachedRowHeight = view.$getConfig().row_height;\r\n\t\t\t}\r\n\t\t\treturn cachedRowHeight;\r\n\t\t},\r\n\t\t_refreshState: function(){\r\n\t\t\tthis.resetCache();\r\n\t\t\tcanUseSimpleCalc = true;\r\n\t\t\tvar store = view.$config.rowStore;\r\n\t\t\tif(!store){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar globalRowHeight = this._getRowHeight();\r\n\t\t\tfor (var i=0; i<store.fullOrder.length; i++) {\r\n\t\t\t\tvar item = store.getItem(store.fullOrder[i]);\r\n\t\t\t\t// GS-1491: ignore the task when it is filtered:\r\n\t\t\t\tif (!item) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif(item.row_height && item.row_height !== globalRowHeight){\r\n\t\t\t\t\tcanUseSimpleCalc = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n\t\t},\r\n\t\tcanUseSimpleCalculation: function(){\r\n\t\t\tif(canUseSimpleCalc === -1){\r\n\t\t\t\tthis._refreshState();\r\n\t\t\t}\r\n\t\t\treturn canUseSimpleCalc;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get top coordinate by row index (order)\r\n\t\t * @param {number} index\r\n\t\t */\r\n\t\tgetRowTop: function(index){\r\n\t\t\tvar store = view.$config.rowStore;\r\n\t\t\tif(!store){\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t\treturn index * this._getRowHeight();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get height of the item by item id\r\n\t\t * @param {*} itemId\r\n\t\t */\r\n\t\tgetItemHeight: function (itemId) {\r\n\t\t\treturn this._getRowHeight();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get total height of items\r\n\t\t */\r\n\t\tgetTotalHeight: function () {\r\n\t\t\tif(view.$config.rowStore){\r\n\t\t\t\tvar store = view.$config.rowStore;\r\n\t\t\t\treturn store.countVisible() * this._getRowHeight();\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get item by top position\r\n\t\t * @param {*} top\r\n\t\t */\r\n\t\tgetItemIndexByTopPosition: function (top) {\r\n\t\t\tif(view.$config.rowStore){\r\n\t\t\t\treturn Math.floor(top / this._getRowHeight());\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default createHelper;","var createStaticBgHelper = function(){\r\n\treturn {\r\n\t\trender: function () { },\r\n\t\tdestroy: function () { }\r\n\t};\r\n};\r\n\r\nexport default {\r\n\tcreate: function(){\r\n\t\treturn createStaticBgHelper();\r\n\t}\r\n};\r\n\r\n","import ScaleHelper from \"./scales_ignore\";\r\nimport eventable from \"../../../utils/eventable\";\r\nimport * as utils from \"../../../utils/utils\";\r\nimport * as helpers from \"../../../utils/helpers\";\r\nimport topPositionMixin from \"../row_position_mixin\";\r\nimport canvasRender from \"./tasks_canvas_render\";\r\nimport createLayerConfig from \"./timeline_layers\";\r\n\r\nvar Timeline = function(parent, config, factory, gantt){\r\n\tthis.$config = utils.mixin({}, config || {});\r\n\tthis.$scaleHelper = new ScaleHelper(gantt);\r\n\tthis.$gantt = gantt;\r\n\tthis._posFromDateCache = {};\r\n\tthis._posFromWorkTimeCache = {};\r\n\tthis._timelineDragScroll = null;\r\n\tutils.mixin(this, topPositionMixin(this));\r\n\teventable(this);\r\n};\r\n\r\nTimeline.prototype = {\r\n\tinit: function(container) {\r\n\t\tcontainer.innerHTML += \"<div class='gantt_task' style='width:inherit;height:inherit;'></div>\";\r\n\t\tthis.$task = container.childNodes[0];\r\n\r\n\t\tthis.$task.innerHTML = \"<div class='gantt_task_scale'></div><div class='gantt_data_area'></div>\";\r\n\t\tthis.$task_scale = this.$task.childNodes[0];\r\n\r\n\t\tthis.$task_data = this.$task.childNodes[1];\r\n\t\tconst taskBg = \"<div class='gantt_task_bg'></div>\";\r\n\t\tconst links = \"<div class='gantt_links_area'></div>\";\r\n\t\tconst taskBars = \"<div class='gantt_bars_area'></div>\";\r\n\r\n\t\tconst taskConstraints = \"<div class='gantt_task_constraints'></div>\";\r\n\t\tconst taskDeadlines = \"<div class='gantt_task_deadlines'></div>\";\r\n\t\tconst taskBaselines = \"<div class='gantt_task_baselines'></div>\";\r\n\r\n\t\tthis.$task_data.innerHTML = taskBg + taskBaselines + links + taskBars + taskConstraints + taskDeadlines;\r\n\r\n\t\tthis.$task_bg = this.$task_data.childNodes[0];\r\n\t\tthis.$task_baselines = this.$task_data.childNodes[1];\r\n\t\tthis.$task_links = this.$task_data.childNodes[2];\r\n\t\tthis.$task_bars = this.$task_data.childNodes[3];\r\n\t\tthis.$task_constraints = this.$task_data.childNodes[4];\r\n\t\tthis.$task_deadlines = this.$task_data.childNodes[5];\r\n\r\n\t\tthis._tasks = {\r\n\t\t\tcol_width: 0,\r\n\t\t\twidth: [], // width of each column\r\n\t\t\tfull_width: 0, // width of all columns\r\n\t\t\ttrace_x: [],\r\n\t\t\trendered: {}\r\n\t\t};\r\n\r\n\t\tvar config = this.$getConfig();\r\n\t\tvar attr = config[this.$config.bind + \"_attribute\"];\r\n\t\tvar linksAttr = config[this.$config.bindLinks + \"_attribute\"];\r\n\t\tif(!attr && this.$config.bind){\r\n\t\t\tattr = \"data-\" + this.$config.bind + \"-id\";\r\n\t\t}\r\n\t\tif(!linksAttr && this.$config.bindLinks){\r\n\t\t\tlinksAttr = \"data-\" + this.$config.bindLinks + \"-id\";\r\n\t\t}\r\n\t\tthis.$config.item_attribute = attr || null;\r\n\t\tthis.$config.link_attribute = linksAttr || null;\r\n\r\n\t\tvar layers = this._createLayerConfig();\r\n\t\tif(!this.$config.layers){\r\n\t\t\tthis.$config.layers = layers.tasks;\r\n\t\t}\r\n\t\tif(!this.$config.linkLayers){\r\n\t\t\tthis.$config.linkLayers = layers.links;\r\n\t\t}\r\n\r\n\t\tthis._attachLayers(this.$gantt);\r\n\r\n\t\tthis.callEvent(\"onReady\", []);\r\n\t\t//this.refresh();\r\n\t\tif (this.$gantt.ext.dragTimeline) {\r\n\t\t\tthis._timelineDragScroll = this.$gantt.ext.dragTimeline.create();\r\n\t\t\tthis._timelineDragScroll.attach(this);\r\n\t\t}\r\n\t},\r\n\r\n\tsetSize: function(width, height){\r\n\t\tvar config = this.$getConfig();\r\n\r\n\t\tif(width*1 === width){\r\n\t\t\tthis.$config.width = width;\r\n\t\t}\r\n\t\tif(height*1 === height){\r\n\r\n\t\t\tthis.$config.height = height;\r\n\t\t\tvar dataHeight = Math.max(this.$config.height - config.scale_height);\r\n\t\t\tthis.$task_data.style.height = dataHeight + 'px';\r\n\t\t}\r\n\r\n\t\tthis.refresh();\r\n\t\tthis.$task_bg.style.backgroundImage = \"\";\r\n\r\n\t\tif(config.smart_rendering && this.$config.rowStore){\r\n\t\t\tthis.$task_bg.style.height = this.getTotalHeight() +\"px\";\r\n\t\t}else{\r\n\t\t\tthis.$task_bg.style.height = \"\";\r\n\t\t}\r\n\r\n\t\tvar scale = this._tasks;\r\n\t\t//timeline area layers\r\n\t\tvar data_els = this.$task_data.childNodes;\r\n\t\tfor(var i= 0, len = data_els.length; i < len; i++){\r\n\t\t\tvar el = data_els[i];\r\n\t\t\tif(el.hasAttribute(\"data-layer\") && el.style)\r\n\t\t\t\tel.style.width = scale.full_width + \"px\";\r\n\t\t}\r\n\t},\r\n\r\n\tisVisible: function(){\r\n\t\tif(this.$parent && this.$parent.$config){\r\n\t\t\treturn !this.$parent.$config.hidden;\r\n\t\t}else{\r\n\t\t\treturn this.$task.offsetWidth;\r\n\t\t}\r\n\t},\r\n\r\n\tgetSize: function(){\r\n\t\tvar config = this.$getConfig();\r\n\t\tvar store = this.$config.rowStore;\r\n\r\n\t\tvar contentHeight = store ? this.getTotalHeight() : 0,\r\n\t\t\tcontentWidth = this.isVisible() ? this._tasks.full_width : 0;\r\n\r\n\t\treturn {\r\n\t\t\tx: this.isVisible() ? this.$config.width : 0,\r\n\t\t\ty: this.isVisible() ? this.$config.height : 0,\r\n\t\t\tcontentX: this.isVisible() ? contentWidth : 0,\r\n\t\t\tcontentY: this.isVisible() ? (config.scale_height + contentHeight) : 0,\r\n\t\t\tscrollHeight: this.isVisible() ? contentHeight : 0,\r\n\t\t\tscrollWidth: this.isVisible() ? contentWidth : 0\r\n\t\t};\r\n\t},\r\n\r\n\tscrollTo: function(left, top){\r\n\t\tif(!this.isVisible())\r\n\t\t\treturn;\r\n\r\n\t\tvar scrolled = false;\r\n\r\n\t\tthis.$config.scrollTop = this.$config.scrollTop || 0;\r\n\t\tthis.$config.scrollLeft = this.$config.scrollLeft || 0;\r\n\t\tif(top*1 === top){\r\n\t\t\tthis.$config.scrollTop = top;\r\n\t\t\tthis.$task_data.scrollTop = this.$config.scrollTop;\r\n\t\t\tscrolled = true;\r\n\t\t}\r\n\t\tif (left*1 === left){\r\n\t\t\tthis.$task.scrollLeft = left;\r\n\t\t\tthis.$config.scrollLeft = this.$task.scrollLeft;\r\n\t\t\tthis._refreshScales();\r\n\t\t\tscrolled = true;\r\n\t\t}\r\n\r\n\t\tif(scrolled){\r\n\t\t\tthis.callEvent(\"onScroll\", [this.$config.scrollLeft, this.$config.scrollTop]);\r\n\t\t}\r\n\t},\r\n\r\n\t_refreshScales: function _refreshScales() {\r\n\t\tif(!this.isVisible())\r\n\t\t\treturn;\r\n\r\n\t\tvar config = this.$getConfig();\r\n\t\tif (!config.smart_scales) return;\r\n\r\n\t\tvar viewPort = this.getViewPort();\r\n\r\n\t\tvar scales = this._scales;\r\n\t\tthis.$task_scale.innerHTML = this._getScaleChunkHtml(scales, viewPort.x, viewPort.x_end);\r\n\t},\r\n\r\n\tgetViewPort: function(){\r\n\t\tvar scrollLeft = this.$config.scrollLeft || 0;\r\n\t\tvar scrollTop = this.$config.scrollTop || 0;\r\n\t\tvar height = this.$config.height || 0;\r\n\t\tvar width = this.$config.width || 0;\r\n\t\treturn {\r\n\t\t\ty: scrollTop,\r\n\t\t\ty_end: scrollTop + height,\r\n\t\t\tx: scrollLeft,\r\n\t\t\tx_end: scrollLeft + width,\r\n\t\t\theight: height,\r\n\t\t\twidth: width\r\n\t\t};\r\n\t},\r\n\r\n\t_createLayerConfig: createLayerConfig,\r\n\r\n\t_attachLayers: function(gantt){\r\n\t\tthis._taskLayers = [];\r\n\t\tthis._linkLayers = [];\r\n\r\n\t\tvar self = this;\r\n\r\n\t\tvar layers = this.$gantt.$services.getService(\"layers\");\r\n\r\n\t\tif(this.$config.bind){\r\n\r\n\t\t\tthis._bindStore();\r\n\t\t\tvar taskRenderer = layers.getDataRender(this.$config.bind);\r\n\r\n\t\t\tif(!taskRenderer){\r\n\t\t\t\ttaskRenderer = layers.createDataRender({\r\n\t\t\t\t\tname: this.$config.bind,\r\n\t\t\t\t\tdefaultContainer: function(){ return self.$task_data;}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\ttaskRenderer.container = function(){ return self.$task_data;};\r\n\r\n\t\t\tvar taskLayers = this.$config.layers;\r\n\t\t\tfor(var i = 0; taskLayers && i < taskLayers.length; i++){\r\n\t\t\t\tvar layer = taskLayers[i];\r\n\r\n\t\t\t\tif(typeof layer == \"string\"){\r\n\t\t\t\t\tlayer = this.$gantt.$ui.layers[layer]();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(typeof layer == \"function\" || (layer && layer.render && layer.update)){\r\n\t\t\t\t\tlayer = {renderer: layer};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlayer.view = this;\r\n\r\n\t\t\t\tvar bar_layer = taskRenderer.addLayer(layer);\r\n\t\t\t\tthis._taskLayers.push(bar_layer);\r\n\t\t\t\tif(layer.expose){\r\n\t\t\t\t\tthis._taskRenderer = taskRenderer.getLayer(bar_layer);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._initStaticBackgroundRender();\r\n\t\t}\r\n\r\n\t\tif(this.$config.bindLinks){\r\n\t\t\tself.$config.linkStore = self.$gantt.getDatastore(self.$config.bindLinks);\r\n\r\n\t\t\tvar linkRenderer = layers.getDataRender(this.$config.bindLinks);\r\n\r\n\t\t\tif(!linkRenderer){\r\n\t\t\t\tlinkRenderer = layers.createDataRender({\r\n\t\t\t\t\tname: this.$config.bindLinks,\r\n\t\t\t\t\tdefaultContainer: function(){ return self.$task_data;}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tvar linkLayers = this.$config.linkLayers;\r\n\t\t\tfor(var i = 0; linkLayers && i < linkLayers.length; i++){\r\n\r\n\t\t\t\tif(typeof layer == \"string\"){\r\n\t\t\t\t\tlayer = this.$gantt.$ui.layers[layer]();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar layer = linkLayers[i];\r\n\t\t\t\tlayer.view = this;\r\n\t\t\t//\tlayer.getViewPort = getViewPort;\r\n\t\t\t//\tsubscribeSmartRender(layer);\r\n\t\t\t\tvar linkLayer = linkRenderer.addLayer(layer);\r\n\t\t\t\tthis._taskLayers.push(linkLayer);\r\n\t\t\t\tif(linkLayers[i].expose){\r\n\t\t\t\t\tthis._linkRenderer = linkRenderer.getLayer(linkLayer);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_initStaticBackgroundRender: function(){\r\n\t\tvar self = this;\r\n\t\tvar staticRender = canvasRender.create();\r\n\t\tvar store = self.$config.rowStore;\r\n\t\tif(!store) return;\r\n\r\n\t\tthis._staticBgHandler = store.attachEvent(\"onStoreUpdated\", function(id, item, mode){\r\n\t\t\tif(id !== null) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(!self.isVisible())\r\n\t\t\t\treturn;\r\n\t\t\tvar config = self.$getConfig();\r\n\t\t\tif(config.static_background || config.timeline_placeholder) {\r\n\t\t\t\tvar store = self.$gantt.getDatastore(self.$config.bind);\r\n\t\t\t\tvar staticBgContainer = self.$task_bg_static;\r\n\t\t\t\tif(!staticBgContainer){\r\n\t\t\t\t\tstaticBgContainer = document.createElement(\"div\");\r\n\t\t\t\t\tstaticBgContainer.className = \"gantt_task_bg\";\r\n\t\t\t\t\tself.$task_bg_static = staticBgContainer;\r\n\t\t\t\t\tif(self.$task_bg.nextSibling){\r\n\t\t\t\t\t\tself.$task_data.insertBefore(staticBgContainer, self.$task_bg.nextSibling);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tself.$task_data.appendChild(staticBgContainer);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (store) {\r\n\t\t\t\t\tvar staticBackgroundHeight = self.getTotalHeight();\r\n\t\t\t\t\tif (config.timeline_placeholder){\r\n\t\t\t\t\t\tstaticBackgroundHeight = config.timeline_placeholder.height || self.$task_data.offsetHeight || 99999;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tstaticRender.render(staticBgContainer, config, self.getScale(), staticBackgroundHeight, self.getItemHeight(item ? item.id : null));\r\n\t\t\t\t}\r\n\t\t\t}else if(config.static_background){\r\n\t\t\t\tif(self.$task_bg_static && self.$task_bg_static.parentNode){\r\n\t\t\t\t\tself.$task_bg_static.parentNode.removeChild(self.$task_bg_static);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.attachEvent(\"onDestroy\", function () {\r\n\t\t\tstaticRender.destroy();\r\n\t\t});\r\n\t\tthis._initStaticBackgroundRender = function(){};//init once\r\n\t},\r\n\r\n\t_clearLayers: function(gantt){\r\n\t\tvar layers = this.$gantt.$services.getService(\"layers\");\r\n\t\tvar taskRenderer = layers.getDataRender(this.$config.bind);\r\n\t\tvar linkRenderer = layers.getDataRender(this.$config.bindLinks);\r\n\r\n\t\tif (this._taskLayers) {\r\n\t\t\tfor(var i = 0; i < this._taskLayers.length; i++){\r\n\t\t\t\ttaskRenderer.removeLayer(this._taskLayers[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._linkLayers) {\r\n\t\t\tfor(var i = 0; i < this._linkLayers.length; i++){\r\n\t\t\t\tlinkRenderer.removeLayer(this._linkLayers[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._linkLayers = [];\r\n\t\tthis._taskLayers = [];\r\n\t},\r\n\r\n\t_render_tasks_scales: function _render_tasks_scales() {\r\n\t\tvar config = this.$getConfig();\r\n\r\n\t\tvar scales_html = \"\",\r\n\t\t\touter_width = 0,\r\n\t\t\tscale_height = 0;\r\n\r\n\t\tvar state = this.$gantt.getState();\r\n\r\n\t\tif (this.isVisible()) {\r\n\t\t\tvar helpers = this.$scaleHelper;\r\n\t\t\tvar scales = this._getScales();\r\n\t\t\tscale_height = config.scale_height;\r\n\r\n\t\t\tvar availWidth = this.$config.width;\r\n\t\t\tif(config.autosize == \"x\" || config.autosize == \"xy\"){\r\n\t\t\t\tavailWidth = Math.max(config.autosize_min_width, 0);\r\n\t\t\t}\r\n\r\n\t\t\tvar cfgs = helpers.prepareConfigs(scales, config.min_column_width, availWidth, scale_height - 1, state.min_date, state.max_date, config.rtl);\r\n\t\t\tvar cfg = this._tasks = cfgs[cfgs.length - 1];\r\n\t\t\tthis._scales = cfgs;\r\n\t\t\tthis._posFromDateCache = {};\r\n\t\t\tthis._posFromWorkTimeCache = {};\r\n\r\n\t\t\tif(this._tasks.projection && this._tasks.projection?.source === \"fixedHours\"){\r\n\t\t\t\tconst calendarId = \"timescale-projection-calendar\";\r\n\t\t\t\tif(this.$gantt.getCalendar(calendarId)){\r\n\t\t\t\t\tthis.$gantt.deleteCalendar(calendarId);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet {hours} = this._tasks.projection;\r\n\t\t\t\tthis.$gantt.addCalendar({\r\n\t\t\t\t\tid:calendarId, \r\n\t\t\t\t\tworktime: {\r\n\t\t\t\t\t\thours: hours || this.$gantt.getCalendar(\"global\")._worktime.hours.slice(),\r\n\t\t\t\t\t\tdays: [ 1, 1, 1, 1, 1, 1 ,1]\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tscales_html = this._getScaleChunkHtml(cfgs, 0, this.$config.width);\r\n\r\n\t\t\touter_width = cfg.full_width + \"px\";//cfg.full_width + (this._scroll_sizes().y ? scrollSizes.scroll_size : 0) + \"px\";\r\n\t\t\tscale_height += \"px\";\r\n\t\t}\r\n\r\n\t\tthis.$task_scale.style.height = scale_height;\r\n\r\n\t\tthis.$task_data.style.width =\r\n\t\t\tthis.$task_scale.style.width = outer_width;\r\n\r\n\t\tthis.$task_scale.innerHTML = scales_html;\r\n\r\n\t},\r\n\r\n\t_getScaleChunkHtml: function _get_scale_chunk_html (scales, fromPos, toPos) {\r\n\t\tvar templates = this.$gantt.templates;\r\n\t\tvar html = [];\r\n\r\n\t\tvar css = templates.scale_row_class;\r\n\t\tfor (var i = 0; i < scales.length; i++) {\r\n\t\t\tvar cssClass = \"gantt_scale_line\";\r\n\t\t\tvar tplClass = css(scales[i]);\r\n\t\t\tif (tplClass) {\r\n\t\t\t\tcssClass += \" \" + tplClass;\r\n\t\t\t}\r\n\r\n\t\t\thtml.push(\"<div class=\\\"\" + cssClass + \"\\\" style=\\\"height:\" + (scales[i].height) +\r\n\t\t\t\t\"px;position:relative;line-height:\" + (scales[i].height) + \"px\\\">\" + this._prepareScaleHtml(scales[i], fromPos, toPos, i) + \"</div>\");\r\n\t\t}\r\n\r\n\t\treturn html.join(\"\");\r\n\t},\r\n\t_prepareScaleHtml: function _prepare_scale_html(config, fromPos, toPos, index) {\r\n\t\tvar globalConfig = this.$getConfig();\r\n\t\tvar globalTemplates = this.$gantt.templates;\r\n\r\n\t\tvar cells = [];\r\n\t\tvar date = null, css = null;\r\n\r\n\t\tvar content = config.format || config.template || config.date;\r\n\r\n\t\tif(typeof content === \"string\"){\r\n\t\t\tcontent = this.$gantt.date.date_to_str(content);\r\n\t\t}\r\n\r\n\t\tvar startIndex = 0,\r\n\t\t\tendIndex = config.count;\r\n\r\n\t\tif (globalConfig.smart_scales && (!isNaN(fromPos) && !isNaN(toPos))) {\r\n\t\t\tstartIndex = helpers.findBinary(config.left, fromPos);\r\n\t\t\tendIndex = helpers.findBinary(config.left, toPos) + 1;\r\n\t\t}\r\n\r\n\t\tcss = config.css || function () {\r\n\t\t\t};\r\n\t\tif (!config.css && globalConfig.inherit_scale_class) {\r\n\t\t\tcss = globalTemplates.scale_cell_class;\r\n\t\t}\r\n\r\n\t\tfor (var i = startIndex; i < endIndex; i++) {\r\n\t\t\tif (!config.trace_x[i]) break;\r\n\r\n\t\t\tdate = new Date(config.trace_x[i]);\r\n\t\t\tvar value = content.call(this, date),\r\n\t\t\t\twidth = config.width[i],\r\n\t\t\t\theight = config.height,\r\n\t\t\t\tleft = config.left[i],\r\n\t\t\t\tstyle = \"\",\r\n\t\t\t\ttemplate = \"\",\r\n\t\t\t\tcssclass = \"\";\r\n\r\n\t\t\tif (width) {\r\n\t\t\t\tvar position = globalConfig.smart_scales ? (\"position:absolute;left:\" + left + \"px\") : \"\";\r\n\r\n\t\t\t\tstyle = \"width:\" + (width) + \"px;\" + position;\r\n\t\t\t\t// GS-1188: Display the scale value in the viewport for long cells\r\n\t\t\t\tconst viewPort = this.getViewPort();\r\n\t\t\t\tconst floatConfig = (globalConfig.scales[index] || {}).sticky; // for old scale settings\r\n\r\n\t\t\t\tlet labelPosition = '';\r\n\t\t\t\tconst approxLabelWidth = 70;\r\n\t\t\t\t// if sticky config is not specified - sticky labels are enabled for long cells only\r\n\t\t\t\tif ((floatConfig !== false && width > approxLabelWidth) || floatConfig === true) {\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (left < viewPort.x && left + width/2 - approxLabelWidth/2 < viewPort.x){\r\n\t\t\t\t\t\tlabelPosition = ` style='position:absolute;left: ${viewPort.x  - left + 10}px;' `;\r\n\t\t\t\t\t} else if(left + width/2 + approxLabelWidth/2 > viewPort.x_end && width > approxLabelWidth){\r\n\t\t\t\t\t\tlet labelPos = viewPort.x_end - left - 10;\r\n\t\t\t\t\t\tlet translateValue = \"-100%\";\r\n\t\t\t\t\t\tif(labelPos < approxLabelWidth) {\r\n\t\t\t\t\t\t\tlabelPos = approxLabelWidth;\r\n\t\t\t\t\t\t\ttranslateValue = `-${labelPos}px`;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlabelPosition = ` style='position:absolute;left: ${labelPos}px;transform: translate(${translateValue},0);' `;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcssclass = \"gantt_scale_cell\" + (i == config.count - 1 ? \" gantt_last_cell\" : \"\");\r\n\r\n\t\t\t\ttemplate = css.call(this, date);\r\n\t\t\t\tif (template) cssclass += \" \" + template;\r\n\r\n\t\t\t\tvar ariaAttr = this.$gantt._waiAria.getTimelineCellAttr(value);\r\n\t\t\t\tvar cell = `<div class='${cssclass}' ${ariaAttr} style='${style}'><span ${labelPosition}>${value}</span></div>`;\r\n\t\t\t\tcells.push(cell);\r\n\t\t\t} else {\r\n\t\t\t\t//do not render ignored cells\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\treturn cells.join(\"\");\r\n\t},\r\n\t_getPositioningContext: function(task) {\r\n\t\tif(this._tasks.unit === this.$gantt.config.duration_unit){\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tif(this._tasks.unit !== \"day\" && this._tasks.unit !== \"week\"){\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tif(!this._tasks.projection){\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst {source} = this._tasks.projection || {};\r\n\t\tif(source === \"taskCalendar\"){\r\n\r\n\t\t\tif(!task){\r\n\t\t\t\treturn {\r\n\t\t\t\t\tcalendar: this.$gantt.getCalendar(\"global\")\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\tcalendar: this.$gantt.getTaskCalendar(task)\r\n\t\t\t};\r\n\t\t}\r\n\t\tif(source === \"fixedHours\"){\r\n\t\t\treturn {\r\n\t\t\t\tcalendar: this.$gantt.getCalendar(\"timescale-projection-calendar\")\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t},\r\n\r\n\tdateFromPos: function dateFromPos(x, context) {\r\n\t\tvar scale = this._tasks;\r\n\t\tif (x < 0 || x > scale.full_width || !scale.full_width) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar ind = helpers.findBinary(this._tasks.left, x);\r\n\t\tvar summ = this._tasks.left[ind];\r\n\r\n\t\tvar col_width = scale.width[ind] || scale.col_width;\r\n\t\tvar part = 0;\r\n\t\tif (col_width) {\r\n\t\t\tpart = (x - summ) / col_width;\r\n\t\t\tif(scale.rtl){\r\n\t\t\t\tpart = 1 - part;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tconst calendar = (context ? context.calendar : null) || null;\r\n\r\n\t\tvar unit = 0;\r\n\t\tif (part) {\r\n\t\t\tunit = this._getColumnDuration(scale, scale.trace_x[ind]);\r\n\t\t}\r\n\r\n\t\tconst cellStartDate = scale.trace_x[ind];\r\n\r\n\t\tconst absolutePositionDate = new Date(scale.trace_x[ind].valueOf() + Math.round(part * unit));\r\n\r\n\t\tif(!calendar){\r\n\r\n\t\t\treturn absolutePositionDate;\r\n\t\t}\r\n\r\n\t\tconst {start: trimStartSec, end: cellEnd, duration: cellDuration, intervals} = this._getWorkTrimForCell(cellStartDate, calendar);\r\n\r\n\t\tif(cellDuration <= 0){\r\n\t\t\treturn absolutePositionDate;\r\n\t\t}\r\n\r\n\t\tconst secondsInsideTrim = Math.round(part * cellDuration);\r\n\t\tconst mappedTimestampMs = cellStartDate.valueOf() + (trimStartSec + secondsInsideTrim) * 1000;\r\n\r\n\t\treturn new Date(mappedTimestampMs);\r\n\t},\r\n\r\n\tposFromDate: function posFromDate(date, context) {\r\n\t\tif (!this.isVisible())\r\n\t\t\treturn 0;\r\n\r\n\t\tif(!date){\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tif(context && context.calendar){\r\n\t\t\treturn this.posFromWorkTime(date, context);\r\n\t\t}\r\n\r\n\t\tvar dateValue = String(date.valueOf());\r\n\r\n\t\tif(this._posFromDateCache[dateValue] !== undefined){\r\n\t\t\treturn this._posFromDateCache[dateValue];\r\n\t\t}\r\n\t\tvar ind = this.columnIndexByDate(date);\r\n\t\tthis.$gantt.assert(ind >= 0, \"Invalid day index\");\r\n\r\n\t\tvar wholeCells = Math.floor(ind);\r\n\t\tvar partCell = ind % 1;\r\n\r\n\t\tvar pos = this._tasks.left[Math.min(wholeCells, this._tasks.width.length - 1)];\r\n\t\tif (wholeCells == this._tasks.width.length)\r\n\t\t\tpos += this._tasks.width[this._tasks.width.length - 1];\r\n\t\t//for(var i=1; i <= wholeCells; i++)\r\n\t\t//\tpos += gantt._tasks.width[i-1];\r\n\r\n\t\tif (partCell) {\r\n\t\t\tif (wholeCells < this._tasks.width.length) {\r\n\t\t\t\tpos += this._tasks.width[wholeCells] * (partCell % 1);\r\n\t\t\t} else {\r\n\t\t\t\tpos += 1;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar roundPos = Math.round(pos);\r\n\t\tthis._posFromDateCache[dateValue] = roundPos;\r\n\t\treturn Math.round(roundPos);\r\n\t},\r\n\r\n\t_getWorkTrimForCell: function (cellStartDate, calendar) {\r\n\t\tconst cellDurationMs = this._getColumnDuration(this._tasks, cellStartDate);\r\n\t\tconst cellEndDate = new Date(cellStartDate.valueOf() + cellDurationMs);\r\n\r\n\t\tlet earliestWorkSecondInCell = null;\r\n\t\tlet latestWorkSecondInCell = null;\r\n\t\tconst intervalsSinceCellStart = [];\r\n\r\n\t\tfor (let dayDate = new Date(cellStartDate), dayIndex = 0;\r\n\t\t\tdayDate < cellEndDate;\r\n\t\t\tdayDate = this.$gantt.date.add(dayDate, 1, \"day\"), dayIndex++) {\r\n\r\n\t\t\tconst dayIntervals = calendar._getWorkHours(dayDate) || [];\r\n\r\n\t\t\tconst dayStartOffsetSeconds = Math.round((dayDate - cellStartDate) / 1000);\r\n\r\n\t\t\tfor (let i = 0; i < dayIntervals.length; i++) {\r\n\t\t\t\tconst absoluteStartSeconds = dayStartOffsetSeconds + dayIntervals[i].start;\r\n\t\t\t\tconst absoluteEndSeconds   = dayStartOffsetSeconds + dayIntervals[i].end;\r\n\r\n\t\t\t\tintervalsSinceCellStart.push({\r\n\t\t\t\t\tstart: absoluteStartSeconds,\r\n\t\t\t\t\tend: absoluteEndSeconds\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (earliestWorkSecondInCell === null || absoluteStartSeconds < earliestWorkSecondInCell) {\r\n\t\t\t\t\tearliestWorkSecondInCell = absoluteStartSeconds;\r\n\t\t\t\t}\r\n\t\t\t\tif (latestWorkSecondInCell === null || absoluteEndSeconds > latestWorkSecondInCell) {\r\n\t\t\t\t\tlatestWorkSecondInCell = absoluteEndSeconds;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\tearliestWorkSecondInCell === null ||\r\n\t\t\tlatestWorkSecondInCell === null ||\r\n\t\t\tlatestWorkSecondInCell <= earliestWorkSecondInCell\r\n\t\t) {\r\n\t\t\treturn { start: 0, end: 0, duration: 0, intervals: [] };\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tstart: earliestWorkSecondInCell,\r\n\t\t\tend: latestWorkSecondInCell,\r\n\t\t\tduration: latestWorkSecondInCell - earliestWorkSecondInCell,\r\n\t\t\tintervals: intervalsSinceCellStart\r\n\t\t};\r\n\t},\r\n\r\n\tposFromWorkTime: function (date, {calendar}) {\r\n\t\tif (!this.isVisible())\r\n\t\t\treturn 0;\r\n\t\tif (!date) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tif(!calendar){\r\n\t\t\treturn this.posFromDate(date);\r\n\t\t}\r\n\r\n\t\tconst cacheKey = (calendar ? calendar.id : \"\") + String(date.valueOf());\r\n\t\tif (this._posFromWorkTimeCache[cacheKey] !== undefined) {\r\n\t\t\treturn this._posFromWorkTimeCache[cacheKey];\r\n\t\t}\r\n\r\n\t\tconst index = this.columnIndexByDate(date);\r\n\t\tthis.$gantt.assert(index >= 0, \"Invalid day index\");\r\n\r\n\t\tconst dayIndex = Math.floor(index);\t\r\n\t\tconst wholeCells = dayIndex;\r\n\r\n\t\tconst {start: workintervalStart, end: workintervalEnd, duration: cellDuration} = this._getWorkTrimForCell(date, calendar);\r\n\r\n\t\tif(cellDuration === 0){\r\n\t\t\tconst result = this.posFromDate(date);\r\n\t\t//\tthis._posFromWorkTimeCache[cacheKey] = result;\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tconst cellStart = this._tasks.trace_x[dayIndex];\r\n\t\tconst dateOffset = (date - cellStart) / 1000; // in seconds\r\n\r\n\t\tlet fraction = 0;\r\n\t\tif(dateOffset <= workintervalStart){\r\n\t\t\tfraction = 0;\r\n\t\t} else if(dateOffset >= workintervalEnd){\r\n\t\t\tfraction = 1;\r\n\t\t} else {\r\n\t\t\tfraction = (dateOffset - workintervalStart) / cellDuration;\r\n\t\t}\r\n\r\n\t\tif(this._tasks.rtl){\r\n\t\t\tfraction = 1 - fraction;\r\n\t\t}\r\n\r\n\t\tconst posLeft = this._tasks.left[Math.min(wholeCells, this._tasks.width.length - 1)];\r\n\r\n\t\tconst cellWidth = (wholeCells < this._tasks.width.length)\r\n\t\t\t? this._tasks.width[wholeCells]\r\n\t\t\t: this._tasks.width[this._tasks.width.length - 1];\r\n\t\r\n\t\tconst pos = Math.round(posLeft + cellWidth * fraction);\r\n\t//\tthis._posFromWorkTimeCache[cacheKey] = pos;\r\n\r\n\t\treturn pos;\r\n\t},\r\n\r\n\r\n\t_getNextVisibleColumn: function (startIndex, columns, ignores) {\r\n\t\t// iterate columns to the right\r\n\t\tvar date = +columns[startIndex];\r\n\t\tvar visibleDateIndex = startIndex;\r\n\t\twhile (ignores[date]) {\r\n\t\t\tvisibleDateIndex++;\r\n\t\t\tdate = +columns[visibleDateIndex];\r\n\t\t}\r\n\r\n\t\treturn visibleDateIndex;\r\n\t},\r\n\t_getPrevVisibleColumn: function (startIndex, columns, ignores) {\r\n\t\t// iterate columns to the left\r\n\t\tvar date = +columns[startIndex];\r\n\t\tvar visibleDateIndex = startIndex;\r\n\t\twhile (ignores[date]) {\r\n\t\t\tvisibleDateIndex--;\r\n\t\t\tdate = +columns[visibleDateIndex];\r\n\t\t}\r\n\t\treturn visibleDateIndex;\r\n\t},\r\n\t_getClosestVisibleColumn: function (startIndex, columns, ignores) {\r\n\t\tvar visibleDateIndex = this._getNextVisibleColumn(startIndex, columns, ignores);\r\n\t\tif (!columns[visibleDateIndex]) {\r\n\t\t\tvisibleDateIndex =  this._getPrevVisibleColumn(startIndex, columns, ignores);\r\n\t\t}\r\n\t\treturn visibleDateIndex;\r\n\t},\r\n\tcolumnIndexByDate: function columnIndexByDate(date) {\r\n\t\tvar pos = new Date(date).valueOf();\r\n\t\tvar days = this._tasks.trace_x_ascending,\r\n\t\t\tignores = this._tasks.ignore_x;\r\n\r\n\t\tvar state = this.$gantt.getState();\r\n\r\n\t\tif (pos <= state.min_date) {\r\n\t\t\tif(this._tasks.rtl){\r\n\t\t\t\treturn days.length;\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (pos >= state.max_date) {\r\n\t\t\tif(this._tasks.rtl){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn days.length;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar dateIndex = helpers.findBinary(days, pos);\r\n\r\n\t\tvar visibleIndex = this._getClosestVisibleColumn(dateIndex, days, ignores);\r\n\t\tvar visibleDate = days[visibleIndex];\r\n\t\tvar transition = this._tasks.trace_index_transition;\r\n\r\n\t\tif(!visibleDate){\r\n\t\t\tif(transition){\r\n\t\t\t\treturn transition[0];\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar part = ((date - days[visibleIndex]) / this._getColumnDuration(this._tasks, days[visibleIndex]));\r\n\t\tif(transition){\r\n\t\t\treturn transition[visibleIndex] + (1 - part);\r\n\t\t}else{\r\n\t\t\treturn visibleIndex + part;\r\n\t\t}\r\n\t},\r\n\tgetItemPosition:function (task, start_date, end_date) {\r\n\t\tvar xLeft, xRight, width;\r\n\r\n\t\tlet displayStart = start_date || task.start_date || task.$auto_start_date;\r\n\t\tlet displayEnd = end_date || task.end_date || task.$auto_end_date;\r\n\r\n\t\tconst context = this._getPositioningContext(task);\r\n\t\tif(context && context.calendar) {\r\n\r\n\t\t\tif(this._tasks.rtl){\r\n\t\t\t\txRight = this.posFromWorkTime(displayStart, context);\r\n\t\t\t\txLeft = this.posFromWorkTime(displayEnd, context);\r\n\t\t\t}else{\r\n\t\t\t\txLeft = this.posFromWorkTime(displayStart, context);\r\n\t\t\t\txRight = this.posFromWorkTime(displayEnd, context);\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tif(this._tasks.rtl){\r\n\t\t\t\txRight = this.posFromDate(displayStart);\r\n\t\t\t\txLeft = this.posFromDate(displayEnd);\r\n\t\t\t}else{\r\n\t\t\t\txLeft = this.posFromDate(displayStart);\r\n\t\t\t\txRight = this.posFromDate(displayEnd);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\twidth =  Math.max((xRight - xLeft), 0);\r\n\r\n\t\tvar y = this.getItemTop(task.id);\r\n\r\n\t\tvar height = this.getBarHeight(task.id);\r\n\t\tvar rowHeight = this.getItemHeight(task.id);\r\n\t\treturn {\r\n\t\t\tleft: xLeft,\r\n\t\t\ttop: y,\r\n\t\t\theight: height,\r\n\t\t\twidth: width,\r\n\t\t\trowHeight: rowHeight\r\n\t\t};\r\n\t},\r\n\r\n\tgetBarHeight: function(taskId, isMilestoneRender){\r\n\t\tvar config = this.$getConfig();\r\n\r\n\t\tvar task = this.$config.rowStore.getItem(taskId);\r\n\t\t// height of the bar item\r\n\t\tvar height = task.task_height || task.bar_height || config.bar_height || config.task_height;\r\n\t\tvar rowHeight = this.getItemHeight(taskId);\r\n\r\n\t\tif (height == \"full\") {\r\n\t\t\tvar offset = config.bar_height_padding || 3;\r\n\t\t\theight = rowHeight - offset;\r\n\t\t}\r\n\t\t//item height cannot be bigger than row height\r\n\t\theight = Math.min(height, rowHeight);\r\n\t\tif (isMilestoneRender) { // to get correct height for addapting Milestone to the row\r\n\t\t\theight = Math.round(height / Math.sqrt(2));\r\n\t\t}\r\n\t\treturn Math.max(height, 0);\r\n\t},\r\n\r\n\tgetScale: function(){\r\n\t\treturn this._tasks;\r\n\t},\r\n\r\n\t_getScales: function _get_scales() {\r\n\t\tvar config = this.$getConfig();\r\n\t\tvar helpers = this.$scaleHelper;\r\n\t\tvar scales = [helpers.primaryScale(config)].concat(helpers.getAdditionalScales(config));\r\n\r\n\t\thelpers.sortScales(scales);\r\n\t\treturn scales;\r\n\t},\r\n\r\n\t_getColumnDuration: function _get_coll_duration(scale, date) {\r\n\t\treturn this.$gantt.date.add(date, scale.step, scale.unit) - date;\r\n\t},\r\n\t_bindStore: function () {\r\n\t\tif (this.$config.bind){\r\n\t\t\tvar rowStore = this.$gantt.getDatastore(this.$config.bind);\r\n\t\t\tthis.$config.rowStore = rowStore;\r\n\t\t\tif(rowStore && !rowStore._timelineCacheAttached){\r\n\t\t\t\tvar self = this;\r\n\t\t\t\trowStore._timelineCacheAttached = rowStore.attachEvent(\"onBeforeFilter\", function(){\r\n\t\t\t\t\tself._resetTopPositionHeight();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t_unbindStore: function(){\r\n\t\tif (this.$config.bind){\r\n\t\t\tvar rowStore = this.$gantt.getDatastore(this.$config.bind);\r\n\t\t\tif(rowStore && rowStore._timelineCacheAttached){\r\n\t\t\t\trowStore.detachEvent(rowStore._timelineCacheAttached);\r\n\t\t\t\trowStore._timelineCacheAttached = false;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\trefresh: function(){\r\n\t\tthis._bindStore();\r\n\r\n\t\tif(this.$config.bindLinks) {\r\n\t\t\tthis.$config.linkStore = this.$gantt.getDatastore(this.$config.bindLinks);\r\n\t\t}\r\n\r\n\t\tthis._resetTopPositionHeight();\r\n\t\tthis._resetHeight();\r\n\t\tthis._initStaticBackgroundRender();\r\n\t\tthis._render_tasks_scales();\r\n\t},\r\n\r\n\tdestructor: function(){\r\n\t\tvar gantt = this.$gantt;\r\n\t\tthis._clearLayers(gantt);\r\n\t\tthis._unbindStore();\r\n\t\tthis.$task = null;\r\n\t\tthis.$task_scale = null;\r\n\t\tthis.$task_data = null;\r\n\t\tthis.$task_bg = null;\r\n\t\tthis.$task_links = null;\r\n\t\tthis.$task_bars = null;\r\n\r\n\t\tthis.$gantt = null;\r\n\r\n\t\tif(this.$config.rowStore){\r\n\t\t\tthis.$config.rowStore.detachEvent(this._staticBgHandler);\r\n\t\t\tthis.$config.rowStore = null;\r\n\t\t}\r\n\t\tif(this.$config.linkStore){\r\n\t\t\tthis.$config.linkStore = null;\r\n\t\t}\r\n\r\n\t\tif(this._timelineDragScroll) {\r\n\t\t\tthis._timelineDragScroll.destructor();\r\n\t\t\tthis._timelineDragScroll = null;\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onDestroy\", []);\r\n\t\tthis.detachAllEvents();\r\n\r\n\t}\r\n};\r\n\r\nexport default Timeline;","\r\nexport default function(){\r\n\tvar self = this;\r\n\tvar taskFilter = function(){\r\n\t\treturn self.isVisible();\r\n\t};\r\n\r\n\tvar barVisible = function(id, task){\r\n\t\treturn !task.hide_bar;\r\n\t};\r\n\r\n\tconst gantt = this.$gantt;\r\n\r\n\tvar taskLayers = [\r\n\t\t{\r\n\t\t\texpose: true,\r\n\t\t\trenderer: this.$gantt.$ui.layers.taskBar(),\r\n\t\t\tcontainer: this.$task_bars,\r\n\t\t\tfilter: [taskFilter, barVisible]\r\n\t\t}\r\n\t];\r\n\r\n\ttaskLayers.push({\r\n\t\trenderer: this.$gantt.$ui.layers.taskBg(),\r\n\t\tcontainer: this.$task_bg,\r\n\t\tfilter: [\r\n\t\t\t//function(){\r\n\t\t\t//\treturn !self.$getConfig().static_background;\r\n\t\t\t//},\r\n\t\t\ttaskFilter\r\n\t\t]\r\n\t});\r\n\r\n\tvar linkLayers = [\r\n\t\t{\r\n\t\t\texpose: true,\r\n\t\t\trenderer: this.$gantt.$ui.layers.link(),\r\n\t\t\tcontainer: this.$task_links,\r\n\t\t\tfilter: [taskFilter]\r\n\t\t}\r\n\t];\r\n\r\n\treturn {\r\n\t\ttasks: taskLayers,\r\n\t\tlinks: linkLayers\r\n\t};\r\n\r\n};","const SENSITIVITY = 20;\r\nconst TIMEOUT = 50;\r\nconst SCROLLSTEP = 10;\r\n\r\nexport default class ScrollableGrid {\r\n\tpublic getCurrentX;\r\n\tprivate $gantt;\r\n\tprivate $grid;\r\n\tprivate _dnd;\r\n\tprivate _scrollView;\r\n\tprivate _scrollOrder: 0 | 1 | -1 = 0;\r\n\r\n\tconstructor(params) {\r\n\t\tconst {gantt, grid, dnd, getCurrentX} = params;\r\n\t\tthis.$gantt = gantt;\r\n\t\tthis.$grid = grid;\r\n\t\tthis._dnd = dnd;\r\n\t\tthis.getCurrentX = getCurrentX;\r\n\t\tthis._scrollView = this.$gantt.$ui.getView(this.$grid.$config.scrollX);\r\n\t\tthis.attachEvents();\r\n\t}\r\n\tattachEvents() {\r\n\t\tif (this.isScrollable()) {\r\n\t\t\tthis._dnd.attachEvent(\"onDragMove\", (obj, e) => {\r\n\t\t\t\tconst gridBoundingRect = this.$grid.$grid.getBoundingClientRect();\r\n\t\t\t\tconst maxLeft = gridBoundingRect.right;\r\n\t\t\t\tconst minLeft = gridBoundingRect.left;\r\n\t\t\t\tconst currentX = this.getCurrentX(e.clientX);\r\n\r\n\t\t\t\tif (currentX >= maxLeft - SENSITIVITY) {\r\n\t\t\t\t\tthis.autoscrollRight();\r\n\t\t\t\t\tthis.autoscrollStart();\r\n\t\t\t\t}\r\n\t\t\t\tif (currentX <= minLeft + SENSITIVITY) {\r\n\t\t\t\t\tthis.autoscrollLeft();\r\n\t\t\t\t\tthis.autoscrollStart();\r\n\t\t\t\t}\r\n\t\t\t\tif (currentX < maxLeft - SENSITIVITY && currentX > minLeft + SENSITIVITY) {\r\n\t\t\t\t\tthis.autoscrollStop();\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t\tthis._dnd.attachEvent(\"onDragEnd\", () => {\r\n\t\t\t\tthis.autoscrollStop();\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\tautoscrollStart() {\r\n\t\tif (this._scrollOrder === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst scrollStep = SCROLLSTEP * this._scrollOrder;\r\n\t\tconst scrollState = this._scrollView.getScrollState();\r\n\t\tthis._scrollView.scrollTo(scrollState.position + scrollStep);\r\n\t\tsetTimeout(() => { this.autoscrollStart(); }, TIMEOUT);\r\n\t}\r\n\tautoscrollRight() {\r\n\t\tthis._scrollOrder = 1;\r\n\t}\r\n\tautoscrollLeft() {\r\n\t\tthis._scrollOrder = -1;\r\n\t}\r\n\tautoscrollStop() {\r\n\t\tthis._scrollOrder = 0;\r\n\t}\r\n\tgetCorrection() {\r\n\t\tif (!this.isScrollable()) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\treturn this._scrollView.getScrollState().position;\r\n\t}\r\n\tisScrollable() {\r\n\t\treturn !!this.$grid.$config.scrollable;\r\n\t}\r\n}","import * as domHelpers from \"../../utils/dom_helpers\";\r\nimport ScrollableGrid from \"./scrollable_grid\";\r\n\r\nconst COLUMN_ID_ATTR_NAME = \"data-column-id\";\r\n\r\nexport class ColumnsGridDnd {\r\n\tprivate $gantt;\r\n\tprivate $grid;\r\n\tprivate _dragX;\r\n\tprivate _dnd;\r\n\tprivate _originAutoscroll;\r\n\tprivate _scrollableGrid: ScrollableGrid;\r\n\tprivate _draggedCell;\r\n\tprivate _targetMarker = null;\r\n\tprivate _gridConfig;\r\n\tconstructor(gantt, grid) {\r\n\t\tthis.$gantt = gantt;\r\n\t\tthis.$grid = grid;\r\n\t}\r\n\tinit() {\r\n\t\tconst DND = this.$gantt.$services.getService(\"dnd\");\r\n\t\tthis._dnd = new DND(this.$grid.$grid_scale, { updates_per_second: 60 });\r\n\t\tthis._scrollableGrid = new ScrollableGrid({\r\n\t\t\tgantt: this.$gantt,\r\n\t\t\tgrid: this.$grid,\r\n\t\t\tdnd: this._dnd,\r\n\t\t\tgetCurrentX: this.calculateCurrentPosition\r\n\t\t});\r\n\t\tthis.attachEvents();\r\n\t}\r\n\tattachEvents() {\r\n\t\tthis._dnd.attachEvent(\"onBeforeDragStart\", (obj, e) => {\r\n\t\t\tthis._draggedCell = this.$gantt.utils.dom.closest(e.target, \".gantt_grid_head_cell\");\r\n\t\t\tif(!this._draggedCell){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst columns = this.$grid.$getConfig().columns;\r\n\t\t\tconst columnName = this._draggedCell.getAttribute(COLUMN_ID_ATTR_NAME);\r\n\t\t\tlet draggedColumn;\r\n\t\t\tlet draggedIndex;\r\n\t\t\tcolumns.map(function(column, index){\r\n\t\t\t\tif(column.name === columnName){\r\n\t\t\t\t\tdraggedColumn = column;\r\n\t\t\t\t\tdraggedIndex = index;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (this.$grid.callEvent(\"onBeforeColumnDragStart\", [{ draggedColumn, draggedIndex}]) === false) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (!this._draggedCell || !draggedColumn) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tthis._gridConfig = this.$grid.$getConfig();\r\n\t\t\tthis._originAutoscroll = this.$gantt.config.autoscroll;\r\n\t\t\tthis.$gantt.config.autoscroll = false;\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tthis._dnd.attachEvent(\"onAfterDragStart\", (obj, e) => {\r\n\t\t\tif (!this._draggedCell) {\r\n\t\t\t\treturn; // GS-1333: don't try to reorder a column when we resize it\r\n\t\t\t}\r\n\t\t\tthis._dnd.config.column = this._draggedCell.getAttribute(COLUMN_ID_ATTR_NAME);\r\n\t\t\tthis._dnd.config.marker.innerHTML = this._draggedCell.outerHTML;\r\n\t\t\tthis._dnd.config.marker.classList.add(\"gantt_column_drag_marker\");\r\n\t\t\tthis._dnd.config.marker.style.height = this._gridConfig.scale_height + \"px\";\r\n\t\t\tthis._dnd.config.marker.style.lineHeight = this._gridConfig.scale_height + \"px\";\r\n\t\t\tthis._draggedCell.classList.add(\"gantt_grid_head_cell_dragged\");\r\n\t\t});\r\n\r\n\t\tthis._dnd.attachEvent(\"onDragMove\", (obj, e) => {\r\n\t\t\tif(!this._draggedCell){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis._dragX = e.clientX;\r\n\t\t\tconst x = this.calculateCurrentPosition(e.clientX);\r\n\t\t\tconst columnIndexes = this.findColumnsIndexes();\r\n\t\t\tthis.setMarkerPosition(x);\r\n\t\t\tthis.drawTargetMarker(columnIndexes);\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tthis._dnd.attachEvent(\"onDragEnd\", () => {\r\n\t\t\tif (!this._draggedCell) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst columnIndexes = this.findColumnsIndexes();\r\n\t\t\tconst targetIndex = columnIndexes.targetIndex;\r\n\t\t\tconst draggedIndex = columnIndexes.draggedIndex;\r\n\t\t\tconst columns = this.$grid.$getConfig().columns;\r\n\r\n\t\t\tconst draggedColumn = columns[draggedIndex];\r\n\t\t\tconst targetColumn = columns[targetIndex];\r\n\t\t\tif (this.$grid.callEvent(\"onColumnDragMove\", [{ draggedColumn, targetColumn, draggedIndex, targetIndex }]) === false) {\r\n\t\t\t\tthis.cleanTargetMarker();\r\n\t\t\t\tthis.$gantt.render();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.$gantt.config.autoscroll = this._originAutoscroll;\r\n\t\t\tthis._draggedCell.classList.remove(\"gantt_grid_head_cell_dragged\");\r\n\t\t\tthis.cleanTargetMarker();\r\n\t\t\tthis.reorderColumns();\r\n\t\t});\r\n\r\n\t}\r\n\treorderColumns() {\r\n\t\tconst { targetIndex, draggedIndex } = this.findColumnsIndexes();\r\n\r\n\t\tconst columns = this.$grid.$getConfig().columns;\r\n\t\tconst draggedColumn = columns[draggedIndex];\r\n\t\tconst targetColumn = columns[targetIndex];\r\n\r\n\t\tif (this.$grid.callEvent(\"onBeforeColumnReorder\", [{ draggedColumn, targetColumn, draggedIndex, targetIndex }]) === false) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (targetIndex === draggedIndex) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcolumns.splice(draggedIndex, 1);\r\n\t\tcolumns.splice(targetIndex, 0, draggedColumn);\r\n\t\tthis.$gantt.render();\r\n\t\tthis.$grid.callEvent(\"onAfterColumnReorder\", [{ draggedColumn, targetColumn, draggedIndex, targetIndex }]);\r\n\t}\r\n\tfindColumnsIndexes() {\r\n\t\tconst draggedId = this._dnd.config.column;\r\n\t\tconst columns = this.$grid.$getConfig().columns;\r\n\t\tlet targetIndex: number;\r\n\t\tlet draggedIndex: number;\r\n\t\tlet xBefore: number;\r\n\t\tlet xAfter: number;\r\n\t\tconst currentColumn = { startX: 0, endX: 0 };\r\n\r\n\t\tlet start = 0;\r\n\t\tlet end = columns.length - 1;\r\n\t\tlet compare = (a, b) => a <= b;\r\n\t\tlet next = (index) => ++index;\r\n\t\tif (this.$gantt.config.rtl) {\r\n\t\t\tstart = columns.length - 1;\r\n\t\t\tend = 0;\r\n\t\t\tcompare = (a, b) => a >= b;\r\n\t\t\tnext = (index) => --index;\r\n\t\t}\r\n\r\n\t\tlet columnRelativePos: number;\r\n\r\n\t\tconst relativeX = this._dragX - this.$grid.$grid.getBoundingClientRect().left + this._scrollableGrid.getCorrection();\r\n\t\tfor (let i = start; compare(i, end); i = next(i)) {\r\n\t\t\tif (targetIndex !== undefined && draggedIndex !== undefined) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif(!columns[i].hide) {\r\n\t\t\t\tcurrentColumn.startX = currentColumn.endX;\r\n\t\t\t\tcurrentColumn.endX += columns[i].width;\r\n\r\n\t\t\t\t// if drop on a column or drop after the last column\r\n\t\t\t\tif (relativeX >= currentColumn.startX && (relativeX <= currentColumn.endX || !compare(next(i), end))) {\r\n\t\t\t\t\ttargetIndex = i;\r\n\t\t\t\t\txBefore = currentColumn.startX;\r\n\t\t\t\t\txAfter = currentColumn.endX;\r\n\t\t\t\t\tcolumnRelativePos = (relativeX - currentColumn.startX) / (currentColumn.endX - currentColumn.startX);\r\n\t\t\t\t}\r\n\t\t\t\tif (draggedId === columns[i].name) {\r\n\t\t\t\t\tdraggedIndex = i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\ttargetIndex,\r\n\t\t\tdraggedIndex,\r\n\t\t\txBefore,\r\n\t\t\txAfter,\r\n\t\t\tcolumnRelativePos\r\n\t\t};\r\n\t}\r\n\tsetMarkerPosition(x: number, y: number = 10) {\r\n\t\tconst { marker } = this._dnd.config;\r\n\t\tconst gridOffset = this._dnd._obj.getBoundingClientRect();\r\n\t\tmarker.style.top = `${gridOffset.y + y}px`;\r\n\t\tmarker.style.left = `${x}px`;\r\n\t}\r\n\tcalculateCurrentPosition = (eventX: number) => {\r\n\t\tconst gridBoundingRect = this.$grid.$grid.getBoundingClientRect();\r\n\t\tconst maxLeft = gridBoundingRect.right;\r\n\t\tconst minLeft = gridBoundingRect.left;\r\n\t\tlet x = eventX;\r\n\t\tif (x > maxLeft) {\r\n\t\t\tx = maxLeft;\r\n\t\t}\r\n\t\tif (x < minLeft) {\r\n\t\t\tx = minLeft;\r\n\t\t}\r\n\t\treturn x;\r\n\t};\r\n\tdrawTargetMarker({ targetIndex, draggedIndex, xBefore, xAfter, columnRelativePos }) {\r\n\t\tif (!this._targetMarker) {\r\n\t\t\tthis._targetMarker = document.createElement(\"div\");\r\n\t\t\tdomHelpers.addClassName(this._targetMarker, \"gantt_grid_target_marker\");\r\n\t\t\tthis._targetMarker.style.display = \"none\";\r\n\t\t\tthis._targetMarker.style.height = `${this._gridConfig.scale_height}px`;\r\n\t\t}\r\n\r\n\t\t// marker can be detached after gantt.render\r\n\t\tif(!this._targetMarker.parentNode){\r\n\t\t\tthis.$grid.$grid_scale.appendChild(this._targetMarker);\r\n\t\t}\r\n\r\n\t\tlet nextPosition: number;\r\n\t\tif (targetIndex > draggedIndex) {\r\n\t\t\tnextPosition = xAfter;\r\n\t\t} else if (targetIndex < draggedIndex) {\r\n\t\t\tnextPosition = xBefore;\r\n\t\t} else {\r\n\t\t\tif(columnRelativePos > 0.5){\r\n\t\t\t\tnextPosition = xAfter;\r\n\t\t\t}else{\r\n\t\t\t\tnextPosition = xBefore;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._targetMarker.style.left = `${nextPosition}px`;\r\n\t\tthis._targetMarker.style.display = \"block\";\r\n\t}\r\n\tcleanTargetMarker() {\r\n\t\tif (this._targetMarker && this._targetMarker.parentNode) {\r\n\t\t\tthis.$grid.$grid_scale.removeChild(this._targetMarker);\r\n\t\t}\r\n\t\tthis._targetMarker = null;\r\n\t}\r\n}","function create(gantt){\r\n\tvar events = [];\r\n\r\n\treturn {\r\n\t\tdelegate:function(event, className, handler, root) {\r\n\t\t\tevents.push([event, className, handler, root]);\r\n\r\n\t\t\tvar helper = gantt.$services.getService(\"mouseEvents\");\r\n\t\t\thelper.delegate(event, className, handler, root);\r\n\t\t},\r\n\t\tdestructor: function(){\r\n\t\t\tvar mouseEvents = gantt.$services.getService(\"mouseEvents\");\r\n\t\t\tfor(var i = 0; i < events.length; i++){\r\n\t\t\t\tvar h = events[i];\r\n\t\t\t\tmouseEvents.detach(h[0], h[1], h[2], h[3]);\r\n\t\t\t}\r\n\t\t\tevents = [];\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default create;","import * as domHelpers from \"../utils/dom_helpers\";\r\nimport * as utils from \"../../../utils/utils\";\r\nimport eventable from \"../../../utils/eventable\";\r\nimport gridResize from \"./grid_resize\";\r\nimport topPositionMixin from \"../row_position_mixin\";\r\nimport rowResize from \"./task_grid_row_resize\";\r\n\r\nimport ColumnDnd from \"../plugins/column_grid_dnd\";\r\n\r\nimport mouseEventContainer from \"../mouse_event_container\";\r\n\r\nvar Grid = function (parent, config, factory, gantt) {\r\n\tthis.$config = utils.mixin({}, config || {});\r\n\tthis.$gantt = gantt;\r\n\tthis.$parent = parent;\r\n\teventable(this);\r\n\tthis.$state = {};\r\n\tutils.mixin(this, topPositionMixin(this));\r\n};\r\n\r\n\r\nGrid.prototype = {\r\n\tinit: function(container) {\r\n\t\tvar gantt = this.$gantt;\r\n\t\tvar gridAriaAttr = gantt._waiAria.gridAttrString();\r\n\t\tvar gridDataAriaAttr = gantt._waiAria.gridDataAttrString();\r\n\t\tvar _ganttConfig = this.$getConfig();\r\n\t\tvar reorderColumns = _ganttConfig.reorder_grid_columns || false;\r\n\t\tif (this.$config.reorder_grid_columns !== undefined) {\r\n\t\t\treorderColumns = this.$config.reorder_grid_columns;\r\n\t\t}\r\n\r\n\r\n\t\tcontainer.innerHTML = \"<div class='gantt_grid' style='height:inherit;width:inherit;' \" + gridAriaAttr + \"></div>\";\r\n\t\tthis.$grid = container.childNodes[0];\r\n\r\n\t\tthis.$grid.innerHTML = \"<div class='gantt_grid_scale' \" +\r\n\t\t\tgantt._waiAria.gridScaleRowAttrString() + \"></div><div class='gantt_grid_data' \" + gridDataAriaAttr + \"></div>\";\r\n\r\n\t\tthis.$grid_scale = this.$grid.childNodes[0];\r\n\t\tthis.$grid_data = this.$grid.childNodes[1];\r\n\r\n\t\tvar attr = _ganttConfig[this.$config.bind + \"_attribute\"];\r\n\t\tif (!attr && this.$config.bind) {\r\n\t\t\tattr = \"data-\" + this.$config.bind + \"-id\";\r\n\t\t}\r\n\t\tthis.$config.item_attribute = attr || null;\r\n\r\n\t\tif (!this.$config.layers) {\r\n\t\t\tvar layers = this._createLayerConfig();\r\n\t\t\tthis.$config.layers = layers;\r\n\t\t}\r\n\r\n\t\tvar resizer = gridResize(gantt, this);\r\n\t\tresizer.init();\r\n\t\tthis._renderHeaderResizers = resizer.doOnRender;\r\n\t\tthis._mouseDelegates = mouseEventContainer(gantt);\r\n\r\n\t\tvar resizerrow = rowResize(gantt, this);\r\n\t\tresizerrow.init();\r\n\r\n\t\tthis._addLayers(this.$gantt);\r\n\t\tthis._initEvents();\r\n\r\n\t\tif (reorderColumns) {\r\n\t\t\tthis._columnDND = new ColumnDnd(gantt, this);\r\n\t\t\tthis._columnDND.init();\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onReady\", []);\r\n\t\t//this.refresh();\r\n\t},\r\n\r\n\t_validateColumnWidth: function (column, property) {\r\n\t\t// user can set {name:\"text\", width:\"200\",...} for some reason,\r\n\t\t// check and convert it to number when possible\r\n\t\tvar value = column[property];\r\n\t\tif (value && value != \"*\") {\r\n\t\t\tvar gantt = this.$gantt;\r\n\t\t\tvar numericWidth = value * 1;\r\n\t\t\tif (isNaN(numericWidth)) {\r\n\t\t\t\tgantt.assert(false, \"Wrong \" + property + \" value of column \" + column.name);\r\n\t\t\t} else {\r\n\t\t\t\tcolumn[property] = numericWidth;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tsetSize: function (width, height) {\r\n\t\tthis.$config.width = this.$state.width = width;\r\n\t\tthis.$config.height = this.$state.height = height;\r\n\r\n\t\t// TODO: maybe inherit and override in a subclass instead of extending here\r\n\r\n\t\tvar columns = this.getGridColumns(),\r\n\t\t\tinnerWidth = 0;\r\n\r\n\t\tvar config = this.$getConfig();\r\n\t\tvar elasticColumns = config.grid_elastic_columns;\r\n\r\n\t\tfor (var i = 0, l = columns.length; i < l; i++) {\r\n\t\t\tthis._validateColumnWidth(columns[i], \"min_width\");\r\n\t\t\tthis._validateColumnWidth(columns[i], \"max_width\");\r\n\t\t\tthis._validateColumnWidth(columns[i], \"width\");\r\n\r\n\t\t\tinnerWidth += columns[i].width * 1;\r\n\t\t}\r\n\r\n\t\tvar outerWidth;\r\n\t\tif (isNaN(innerWidth) || !this.$config.scrollable) {\r\n\t\t\touterWidth = this._setColumnsWidth(width + 1);\r\n\t\t\tinnerWidth = outerWidth;\r\n\t\t}\r\n\r\n\t\tif(this.$config.scrollable && elasticColumns && !isNaN(innerWidth)){\r\n\t\t\t// GS-1352: Allow resizing the grid columns, then the grid width is increased\r\n\t\t\t// or keep the grid width, but don't allow column resize to affect the grid width\r\n\t\t\tlet columnProperty = \"width\";\r\n\t\t\tif (elasticColumns == \"min_width\"){\r\n\t\t\t\tcolumnProperty = \"min_width\";\r\n\t\t\t}\r\n\t\t\tlet newColumnWidth = 0;\r\n\t\t\tcolumns.forEach(function(col){\r\n\t\t\t\tnewColumnWidth += col[columnProperty] || config.min_grid_column_width;\r\n\t\t\t});\r\n\t\t\t//newColumnWidth--; // the total column width shouldn't match the outerWidth // GS-2190 reducing width seems to be not needed\r\n\t\t\tvar columnsWidth = Math.max(newColumnWidth, width);\r\n\t\t\tinnerWidth = this._setColumnsWidth(columnsWidth);\r\n\t\t\touterWidth = width;\r\n\t\t}\r\n\r\n\t\tif (this.$config.scrollable) {\r\n\t\t\tthis.$grid_scale.style.width = innerWidth + \"px\";\r\n\t\t\tthis.$grid_data.style.width = innerWidth + \"px\";\r\n\t\t} else {\r\n\t\t\tthis.$grid_scale.style.width = \"inherit\";\r\n\t\t\tthis.$grid_data.style.width = \"inherit\";\r\n\t\t}\r\n\t\tthis.$config.width -= 1;\r\n\r\n\t\tvar config = this.$getConfig();\r\n\t\tif (outerWidth !== width) {\r\n\t\t\tif(outerWidth !== undefined){\r\n\t\t\t\tconfig.grid_width = outerWidth;\r\n\t\t\t\tthis.$config.width = outerWidth - 1;\r\n\t\t\t}else{\r\n\t\t\t\tif(!isNaN(innerWidth)){\r\n\t\t\t\t\tthis._setColumnsWidth(innerWidth);\r\n\t\t\t\t\tconfig.grid_width = innerWidth;\r\n\t\t\t\t\tthis.$config.width = innerWidth - 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar dataHeight = Math.max(this.$state.height - config.scale_height, 0);\r\n\t\tthis.$grid_data.style.height = dataHeight + \"px\";\r\n\t\tthis.refresh();\r\n\t},\r\n\tgetSize: function () {\r\n\r\n\t\tvar config = this.$getConfig();\r\n\r\n\t\tvar store = this.$config.rowStore;\r\n\r\n\t\tvar contentHeight = store ? this.getTotalHeight() : 0,\r\n\t\t\tcontentWidth = this._getGridWidth();\r\n\r\n\t\tvar size = {\r\n\t\t\tx: this.$state.width,\r\n\t\t\ty: this.$state.height,\r\n\t\t\tcontentX: this.isVisible() ? contentWidth : 0,\r\n\t\t\tcontentY: this.isVisible() ? (config.scale_height + contentHeight) : 0,\r\n\t\t\tscrollHeight: this.isVisible() ? contentHeight : 0,\r\n\t\t\tscrollWidth: this.isVisible() ? contentWidth : 0\r\n\t\t};\r\n\r\n\t\treturn size;\r\n\t},\r\n\r\n\t_bindStore: function () {\r\n\t\tif (this.$config.bind){\r\n\t\t\tvar rowStore = this.$gantt.getDatastore(this.$config.bind);\r\n\t\t\tthis.$config.rowStore = rowStore;\r\n\t\t\tif(rowStore && !rowStore._gridCacheAttached){\r\n\t\t\t\tvar self = this;\r\n\t\t\t\trowStore._gridCacheAttached = rowStore.attachEvent(\"onBeforeFilter\", function(){\r\n\t\t\t\t\tself._resetTopPositionHeight();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t_unbindStore: function(){\r\n\t\tif (this.$config.bind){\r\n\t\t\tvar rowStore = this.$gantt.getDatastore(this.$config.bind);\r\n\t\t\tif(rowStore && rowStore._gridCacheAttached){\r\n\t\t\t\trowStore.detachEvent(rowStore._gridCacheAttached);\r\n\t\t\t\trowStore._gridCacheAttached = false;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\trefresh: function () {\r\n\t\tthis._bindStore();\r\n\r\n\t\tthis._resetTopPositionHeight();\r\n\t\tthis._resetHeight();\r\n\t\tthis._initSmartRenderingPlaceholder();\r\n\r\n\t\tthis._calculateGridWidth();\r\n\t\tthis._renderGridHeader();\r\n\t},\r\n\r\n\tgetViewPort: function(){\r\n\t\tvar scrollLeft = this.$config.scrollLeft || 0;\r\n\t\tvar scrollTop = this.$config.scrollTop || 0;\r\n\t\tvar height = this.$config.height || 0;\r\n\t\tvar width = this.$config.width || 0;\r\n\t\treturn {\r\n\t\t\ty: scrollTop,\r\n\t\t\ty_end: scrollTop + height,\r\n\t\t\tx: scrollLeft,\r\n\t\t\tx_end: scrollLeft + width,\r\n\t\t\theight: height,\r\n\t\t\twidth: width\r\n\t\t};\r\n\t},\r\n\r\n\tscrollTo: function (left, top) {\r\n\t\tif (!this.isVisible())\r\n\t\t\treturn;\r\n\r\n\t\tvar scrolled = false;\r\n\r\n\t\tthis.$config.scrollTop = this.$config.scrollTop || 0;\r\n\t\tthis.$config.scrollLeft = this.$config.scrollLeft || 0;\r\n\r\n\t\tif (left * 1 == left) {\r\n\t\t\tthis.$config.scrollLeft = this.$state.scrollLeft = this.$grid.scrollLeft = left;\r\n\t\t\tscrolled = true;\r\n\t\t}\r\n\r\n\t\t// var config = this.$getConfig();\r\n\t\tif (top * 1 == top) {\r\n\t\t\tthis.$config.scrollTop = this.$state.scrollTop = this.$grid_data.scrollTop = top;\r\n\t\t\tscrolled = true;\r\n\t\t}\r\n\r\n\t\tif(scrolled){\r\n\t\t\tthis.callEvent(\"onScroll\", [this.$config.scrollLeft, this.$config.scrollTop]);\r\n\t\t}\r\n\t},\r\n\r\n\tgetColumnIndex: function (name, excludeHidden) {\r\n\t\tvar columns = this.$getConfig().columns;\r\n\t\tvar hiddenIndexShift = 0;\r\n\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\t// GS-1257. If the cell is hidden, the target column index should be correct\r\n\t\t\tif (excludeHidden && columns[i].hide){\r\n\t\t\t\thiddenIndexShift++;\r\n\t\t\t}\r\n\t\t\tif (columns[i].name == name) {\r\n\t\t\t\treturn i - hiddenIndexShift;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\tgetColumn: function (name) {\r\n\t\tvar index = this.getColumnIndex(name);\r\n\t\tif (index === null) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn this.$getConfig().columns[index];\r\n\t},\r\n\r\n\tgetGridColumns: function () {\r\n\t\tvar config = this.$getConfig();\r\n\t\treturn config.columns.slice();\r\n\t},\r\n\tisVisible: function () {\r\n\t\tif (this.$parent && this.$parent.$config) {\r\n\t\t\treturn !this.$parent.$config.hidden;\r\n\t\t} else {\r\n\t\t\treturn this.$grid.offsetWidth;\r\n\t\t}\r\n\t},\r\n\r\n\t// getItemHeight: function () {\r\n\t// \tvar config = this.$getConfig();\r\n\t// \treturn config.row_height;\r\n\t// },\r\n\r\n\t_createLayerConfig: function () {\r\n\t\tvar gantt = this.$gantt;\r\n\t\tvar self = this;\r\n\t\tvar layers = [\r\n\t\t\t{\r\n\t\t\t\trenderer: gantt.$ui.layers.gridLine(),\r\n\t\t\t\tcontainer: this.$grid_data,\r\n\t\t\t\tfilter: [function () {\r\n\t\t\t\t\treturn self.isVisible();\r\n\t\t\t\t}]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\trenderer: gantt.$ui.layers.gridTaskRowResizer(),\r\n\t\t\t\tcontainer: this.$grid_data,\r\n\t\t\t\tappend: true,\r\n\t\t\t\tfilter: [function () {\r\n\t\t\t\t\treturn gantt.config.resize_rows;\r\n\t\t\t\t}]\r\n\t\t\t}\r\n\t\t];\r\n\t\treturn layers;\r\n\t},\r\n\r\n\t_addLayers: function (gantt) {\r\n\t\tif (!this.$config.bind)\r\n\t\t\treturn;\r\n\r\n\t\tthis._taskLayers = [];\r\n\r\n\t\tvar self = this;\r\n\r\n\t\tvar layers = this.$gantt.$services.getService(\"layers\");\r\n\t\tvar taskRenderer = layers.getDataRender(this.$config.bind);\r\n\r\n\t\tif (!taskRenderer) {\r\n\t\t\ttaskRenderer = layers.createDataRender({\r\n\t\t\t\tname: this.$config.bind,\r\n\t\t\t\tdefaultContainer: function () { return self.$grid_data; }\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tvar taskLayers = this.$config.layers;\r\n\t\tfor (var i = 0; taskLayers && i < taskLayers.length; i++) {\r\n\t\t\tvar layer = taskLayers[i];\r\n\t\t\tlayer.view = this;\r\n\r\n\t\t\tvar bar_layer = taskRenderer.addLayer(layer);\r\n\t\t\tthis._taskLayers.push(bar_layer);\r\n\t\t}\r\n\r\n\t\tthis._bindStore();\r\n\r\n\t\tthis._initSmartRenderingPlaceholder();\r\n\t},\r\n\r\n\t_refreshPlaceholderOnStoreUpdate: function (id) {\r\n\t\tvar config = this.$getConfig(),\r\n\t\t\tstore = this.$config.rowStore;\r\n\r\n\t\tif (!store || id !== null || !this.isVisible() || !config.smart_rendering) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar contentHeight;\r\n\t\tif (this.$config.scrollY) {\r\n\t\t\tvar scroll = this.$gantt.$ui.getView(this.$config.scrollY);\r\n\t\t\tif (scroll)\r\n\t\t\t\tcontentHeight = scroll.getScrollState().scrollSize;\r\n\t\t}\r\n\r\n\t\tif (!contentHeight) {\r\n\t\t\tcontentHeight = store ? this.getTotalHeight() : 0;\r\n\t\t}\r\n\r\n\t\tif (contentHeight) {\r\n\t\t\tif (this.$rowsPlaceholder && this.$rowsPlaceholder.parentNode) {\r\n\t\t\t\tthis.$rowsPlaceholder.parentNode.removeChild(this.$rowsPlaceholder);\r\n\t\t\t}\r\n\r\n\t\t\tvar placeholder = this.$rowsPlaceholder = document.createElement(\"div\");\r\n\t\t\tplaceholder.style.visibility = \"hidden\";\r\n\t\t\tplaceholder.style.height = contentHeight + \"px\";\r\n\t\t\tplaceholder.style.width = \"1px\";\r\n\t\t\tthis.$grid_data.appendChild(placeholder);\r\n\t\t}\r\n\t},\r\n\r\n\t_initSmartRenderingPlaceholder: function () {\r\n\t\tvar store = this.$config.rowStore;\r\n\t\tif (!store) {\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tthis._initSmartRenderingPlaceholder = function () { };\r\n\t\t}\r\n\t\tthis._staticBgHandler = store.attachEvent(\"onStoreUpdated\", utils.bind(this._refreshPlaceholderOnStoreUpdate, this));\r\n\t},\r\n\r\n\t_initEvents: function () {\r\n\t\tvar gantt = this.$gantt;\r\n\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_close\", gantt.bind(function (e, id, trg) {\r\n\t\t\tvar store = this.$config.rowStore;\r\n\t\t\tif (!store) return true;\r\n\r\n\t\t\tvar target = domHelpers.locateAttribute(e, this.$config.item_attribute);\r\n\t\t\tif (target) {\r\n\t\t\t\tstore.close(target.getAttribute(this.$config.item_attribute));\r\n\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}, this), this.$grid);\r\n\r\n\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_open\", gantt.bind(function (e, id, trg) {\r\n\t\t\tvar store = this.$config.rowStore;\r\n\t\t\tif (!store) return true;\r\n\r\n\t\t\tvar target = domHelpers.locateAttribute(e, this.$config.item_attribute);\r\n\t\t\tif (target) {\r\n\t\t\t\tstore.open(target.getAttribute(this.$config.item_attribute));\r\n\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}, this), this.$grid);\r\n\t},\r\n\r\n\t_clearLayers: function (gantt) {\r\n\t\tvar layers = this.$gantt.$services.getService(\"layers\");\r\n\t\tvar taskRenderer = layers.getDataRender(this.$config.bind);\r\n\r\n\t\tif (this._taskLayers) {\r\n\t\t\tfor (var i = 0; i < this._taskLayers.length; i++) {\r\n\t\t\t\ttaskRenderer.removeLayer(this._taskLayers[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._taskLayers = [];\r\n\t},\r\n\r\n\t_getColumnWidth: function (column, config, width) {\r\n\t\tvar min_width = column.min_width || config.min_grid_column_width;\r\n\t\tvar new_width = Math.max(width, min_width || 10);\r\n\t\tif (column.max_width)\r\n\t\t\tnew_width = Math.min(new_width, column.max_width);\r\n\t\treturn new_width;\r\n\t},\r\n\t// set min width only if width < than config.min_grid_column_width\r\n\t_checkGridColumnMinWidthLimits: function (columns, config) {\r\n\t\tfor (var i = 0, l = columns.length; i < l; i++) {\r\n\t\t\tvar width = columns[i].width * 1;\r\n\t\t\tif (!columns[i].min_width && width < config.min_grid_column_width){\r\n\t\t\t\tcolumns[i].min_width = width;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t// return min and max possible grid width according to restricts\r\n\t_getGridWidthLimits: function () {\r\n\t\tvar config = this.$getConfig(),\r\n\t\t\tcolumns = this.getGridColumns(),\r\n\t\t\tmin_limit = 0,\r\n\t\t\tmax_limit = 0;\r\n\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tmin_limit += columns[i].min_width ? columns[i].min_width : config.min_grid_column_width;\r\n\t\t\tif (max_limit !== undefined) {\r\n\t\t\t\tmax_limit = columns[i].max_width ? (max_limit + columns[i].max_width) : undefined;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._checkGridColumnMinWidthLimits(columns, config); // FIX ME: should it be before calculating limits?\r\n\t\treturn [min_limit, max_limit];\r\n\t},\r\n\t// resize columns to get total newWidth, starting from columns[start_index]\r\n\t_setColumnsWidth: function (newWidth, start_index) {\r\n\t\tvar config = this.$getConfig();\r\n\t\tvar columns = this.getGridColumns(),\r\n\t\t\tcolumns_width = 0,\r\n\t\t\tfinal_width = newWidth;\r\n\r\n\t\tstart_index = !window.isNaN(start_index) ? start_index : -1;\r\n\r\n\t\tfor (var i = 0, l = columns.length; i < l; i++) {\r\n\t\t\tcolumns_width += columns[i].width * 1;\r\n\t\t}\r\n\r\n\t\tif (window.isNaN(columns_width)) {\r\n\t\t\tthis._calculateGridWidth();\r\n\t\t\tcolumns_width = 0;\r\n\t\t\tfor (var i = 0, l = columns.length; i < l; i++) {\r\n\t\t\t\tcolumns_width += columns[i].width * 1;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar extra_width = final_width - columns_width;\r\n\r\n\t\tvar start_width = 0;\r\n\t\tfor (var i = 0; i < start_index + 1; i++) {\r\n\t\t\tstart_width += columns[i].width;\r\n\t\t}\r\n\r\n\t\tcolumns_width -= start_width;\r\n\r\n\t\tfor (var i = start_index + 1; i < columns.length; i++) {\r\n\r\n\t\t\tvar col = columns[i];\r\n\t\t\tvar share = Math.round(extra_width * (col.width / columns_width));\r\n\r\n\t\t\t// columns have 2 additional restrict fields - min_width & max_width that are set by user\r\n\t\t\tif (extra_width < 0) {\r\n\t\t\t\tif (col.min_width && col.width + share < col.min_width)\r\n\t\t\t\t\tshare = col.min_width - col.width;\r\n\t\t\t\telse if (!col.min_width && config.min_grid_column_width && col.width + share < config.min_grid_column_width)\r\n\t\t\t\t\tshare = config.min_grid_column_width - col.width;\r\n\t\t\t} else if (col.max_width && col.width + share > col.max_width)\r\n\t\t\t\tshare = col.max_width - col.width;\r\n\r\n\t\t\tcolumns_width -= col.width;\r\n\t\t\tcol.width += share;\r\n\t\t\textra_width -= share;\r\n\r\n\t\t}\r\n\r\n\t\tvar iterator = extra_width > 0 ? 1 : -1;\r\n\t\twhile ((extra_width > 0 && iterator === 1) || (extra_width < 0 && iterator === -1)) {\r\n\t\t\tvar curExtra = extra_width;\r\n\t\t\tfor (i = start_index + 1; i < columns.length; i++) {\r\n\t\t\t\tvar new_width = columns[i].width + iterator;\r\n\r\n\t\t\t\tif (new_width == this._getColumnWidth(columns[i], config, new_width)) {\r\n\t\t\t\t\textra_width -= iterator;\r\n\t\t\t\t\tcolumns[i].width = new_width;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!extra_width)\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif (curExtra == extra_width)\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t// if impossible to resize the right-side columns, resize the start column\r\n\t\tif (extra_width && start_index > -1) {\r\n\t\t\tvar new_width = columns[start_index].width + extra_width;\r\n\t\t\tif (new_width == this._getColumnWidth(columns[start_index], config, new_width))\r\n\t\t\t\tcolumns[start_index].width = new_width;\r\n\t\t}\r\n\r\n\t\t//if (this.callEvent(\"onGridResizeEnd\", [config.grid_width, final_width]) === false)\r\n\t\t//\treturn;\r\n\r\n\t\treturn this._getColsTotalWidth();\r\n\t},\r\n\r\n\t_getColsTotalWidth: function () {\r\n\t\tvar columns = this.getGridColumns();\r\n\t\tvar cols_width = 0;\r\n\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tvar v = parseFloat(columns[i].width);\r\n\t\t\tif (window.isNaN(v)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tcols_width += v;\r\n\t\t}\r\n\t\treturn cols_width;\r\n\t},\r\n\t_calculateGridWidth: function () {\r\n\t\tvar config = this.$getConfig();\r\n\t\tvar columns = this.getGridColumns();\r\n\t\tvar cols_width = 0;\r\n\t\tvar unknown = [];\r\n\t\tvar width = [];\r\n\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tvar v = parseFloat(columns[i].width);\r\n\t\t\tif (window.isNaN(v)) {\r\n\t\t\t\tv = config.min_grid_column_width || 10;\r\n\t\t\t\tunknown.push(i);\r\n\t\t\t}\r\n\t\t\twidth[i] = v;\r\n\t\t\tcols_width += v;\r\n\t\t}\r\n\t\tvar gridWidth = this._getGridWidth() + 1;\r\n\t\tif (config.autofit || unknown.length) {\r\n\t\t\tvar diff = gridWidth - cols_width;\r\n\t\t\t// TODO: logic may be improved for proportional changing of width\r\n\r\n\t\t\t// autofit adjusts columns widths to the outer grid width\r\n\t\t\t// it doesn't makes sense if grid has inner scroll with elastic columns\r\n\t\t\tif (config.autofit && !config.grid_elastic_columns) {\r\n\t\t\t\t// delta must be added for all columns\r\n\t\t\t\tfor (var i = 0; i < width.length; i++) {\r\n\t\t\t\t\tvar delta = Math.round(diff / (width.length - i));\r\n\t\t\t\t\twidth[i] += delta;\r\n\t\t\t\t\tvar new_width = this._getColumnWidth(columns[i], config, width[i]);\r\n\r\n\t\t\t\t\tif (new_width != width[i]) {\r\n\t\t\t\t\t\tdelta = new_width - width[i];\r\n\t\t\t\t\t\twidth[i] = new_width;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdiff -= delta;\r\n\t\t\t\t}\r\n\t\t\t} else if (unknown.length) {\r\n\t\t\t\t// there are several columns with undefined width\r\n\t\t\t\tfor (var i = 0; i < unknown.length; i++) {\r\n\t\t\t\t\tvar delta = Math.round(diff / (unknown.length - i)); // no float values, just integer\r\n\t\t\t\t\tvar index = unknown[i];\r\n\t\t\t\t\twidth[index] += delta;\r\n\t\t\t\t\tvar new_width = this._getColumnWidth(columns[index], config, width[index]);\r\n\t\t\t\t\tif (new_width != width[index]) {\r\n\t\t\t\t\t\tdelta = new_width - width[index];\r\n\t\t\t\t\t\twidth[index] = new_width;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdiff -= delta;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0; i < width.length; i++) {\r\n\t\t\t\tcolumns[i].width = width[i];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar changed = (gridWidth != cols_width);\r\n\t\t\tthis.$config.width = cols_width - 1;\r\n\t\t\tconfig.grid_width = cols_width;\r\n\t\t\tif (changed) {\r\n\t\t\t\tthis.$parent._setContentSize(this.$config.width, null);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t_renderGridHeader: function () {\r\n\t\tvar gantt = this.$gantt;\r\n\t\tvar config = this.$getConfig();\r\n\t\tvar locale = this.$gantt.locale;\r\n\t\tvar templates = this.$gantt.templates;\r\n\r\n\t\tvar columns = this.getGridColumns();\r\n\t\tif (config.rtl) {\r\n\t\t\tcolumns = columns.reverse();\r\n\t\t}\r\n\t\tvar cells = [];\r\n\t\tvar width = 0,\r\n\t\t\tlabels = locale.labels;\r\n\r\n\t\tvar lineHeigth = config.scale_height - 1;\r\n\r\n\t\tconst renderableComponents = {};\r\n\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tvar last = i == columns.length - 1;\r\n\t\t\tvar col = columns[i];\r\n\r\n\t\t\t// ensure columns have non-empty names\r\n\t\t\tif (!col.name) {\r\n\t\t\t\tcol.name = gantt.uid() + \"\";\r\n\t\t\t}\r\n\r\n\t\t\tvar colWidth = col.width * 1;\r\n\r\n\t\t\tvar gridWidth = this._getGridWidth();\r\n\t\t\tif (last && gridWidth > width + colWidth)\r\n\t\t\t\tcol.width = colWidth = gridWidth - width;\r\n\t\t\twidth += colWidth;\r\n\t\t\tvar sort = (gantt._sort && col.name == gantt._sort.name) ? (`<div data-column-id=\"${col.name}\" class=\"gantt_sort gantt_${gantt._sort.direction}\"></div>`) : \"\";\r\n\t\t\tvar cssClass = [\"gantt_grid_head_cell\",\r\n\t\t\t\t(\"gantt_grid_head_\" + col.name),\r\n\t\t\t\t(last ? \"gantt_last_cell\" : \"\"),\r\n\t\t\t\ttemplates.grid_header_class(col.name, col)].join(\" \");\r\n\r\n\t\t\tvar style = \"width:\" + (colWidth - (last ? 1 : 0)) + \"px;\";\r\n\t\t\tvar label = (col.label || labels[\"column_\" + col.name] || labels[col.name]);\r\n\t\t\tif(typeof label === \"function\"){\r\n\t\t\t\tlabel = label.call(gantt, col.name, col);\r\n\t\t\t}\r\n\t\t\tlabel = label || \"\";\r\n\t\t\tlet componentLabel = false;\r\n\t\t\tif(gantt.config.external_render && gantt.config.external_render.isElement(label)){\r\n\t\t\t\tcomponentLabel = true;\r\n\t\t\t\trenderableComponents[col.name] = label;\r\n\t\t\t}\r\n\r\n\t\t\tvar ariaAttrs = gantt._waiAria.gridScaleCellAttrString(col, label);\r\n\r\n\t\t\tvar cell = \"<div class='\" + cssClass + \"' style='\" + style + \"' \" + ariaAttrs + \r\n\t\t\t\t\" data-column-id='\" + col.name + \"' column_id='\" + col.name + \"'\" +\r\n\t\t\t\t\" data-column-name='\" + col.name + \"' data-column-index='\" + i + \"'\" +\r\n\t\t\t\t\">\" + (!componentLabel ? label : \"<div data-component-container></div>\") + sort + \"</div>\";\r\n\t\t\tcells.push(cell);\r\n\t\t}\r\n\t\tthis.$grid_scale.style.height = (config.scale_height) + \"px\";\r\n\t\tthis.$grid_scale.style.lineHeight = lineHeigth + \"px\";\r\n\t\t//this.$grid_scale.style.width = \"inherit\";\r\n\t\tthis.$grid_scale.innerHTML = cells.join(\"\");\r\n\t\tfor(let i in renderableComponents){\r\n\t\t\tgantt.config.external_render.renderElement(renderableComponents[i], this.$grid_scale.querySelector(\"[data-column-id='\" + i + \"'] [data-component-container]\"));\r\n\t\t}\r\n\r\n\t\tif (this._renderHeaderResizers) {\r\n\t\t\tthis._renderHeaderResizers();\r\n\t\t}\r\n\t},\r\n\r\n\t_getGridWidth: function () {\r\n\t\t// TODO: refactor/remove/comment some of _getGridWidth/this.$config.width/this.$state.width, it's not clear what they do\r\n\t\treturn this.$config.width;\r\n\t},\r\n\r\n\tdestructor: function () {\r\n\t\tthis._clearLayers(this.$gantt);\r\n\t\tif (this._mouseDelegates) {\r\n\t\t\tthis._mouseDelegates.destructor();\r\n\t\t\tthis._mouseDelegates = null;\r\n\t\t}\r\n\t\tthis._unbindStore();\r\n\t\tthis.$grid = null;\r\n\t\tthis.$grid_scale = null;\r\n\t\tthis.$grid_data = null;\r\n\t\tthis.$gantt = null;\r\n\t\tif (this.$config.rowStore) {\r\n\t\t\tthis.$config.rowStore.detachEvent(this._staticBgHandler);\r\n\t\t\tthis.$config.rowStore = null;\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onDestroy\", []);\r\n\t\tthis.detachAllEvents();\r\n\t}\r\n};\r\n\r\nexport default Grid;\r\n","import * as helpers from \"../../utils/helpers\";\r\n\r\nfunction clearTaskStoreHandler(self) {\r\n\tif (self._delayRender) {\r\n\t\tself._delayRender.$cancelTimeout();\r\n\t}\r\n\r\n\tif (!self.$gantt) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar tasks = self.$gantt.$data.tasksStore;\r\n\tvar ownStore = self.$config.rowStore;\r\n\r\n\tif (!ownStore){\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar handlerIdProperty = \"_attached_\" + ownStore.$config.name;\r\n\tif (self[handlerIdProperty]) {\r\n\t\ttasks.detachEvent(self[handlerIdProperty]);\r\n\t\tself[handlerIdProperty] = null;\r\n\t}\r\n\r\n\tif (ownStore.$attachedResourceViewHandler) {\r\n\t\townStore.detachEvent(ownStore.$attachedResourceViewHandler);\r\n\t\townStore.$attachedResourceViewHandler = null;\r\n\r\n\t\ttasks.detachEvent(ownStore.$attachedTaskStoreHandler);\r\n\t\townStore.$attachedTaskStoreHandler = null;\r\n\t}\r\n}\r\n\r\nfunction createMixin(_super){\r\n\r\n\tvar initGrid = _super.prototype.init,\r\n\t\tdestroyGrid = _super.prototype.destructor;\r\n\r\n\treturn {\r\n\t\tinit: function() {\r\n\t\t\tinitGrid.apply(this, arguments);\r\n\t\t\tthis._linkToTaskStore();\r\n\t\t},\r\n\r\n\t\tdestructor: function() {\r\n\t\t\tclearTaskStoreHandler(this);\r\n\t\t\tdestroyGrid.apply(this, arguments);\r\n\t\t},\r\n\r\n\t\tpreviousDragId: null,\r\n\t\trelevantResources: null,\r\n\r\n\t\t_linkToTaskStore: function () {\r\n\t\t\tif (this.$config.rowStore && this.$gantt.$data.tasksStore) {\r\n\t\t\t\tvar tasks = this.$gantt.$data.tasksStore;\r\n\t\t\t\tvar ownStore = this.$config.rowStore;\r\n\t\t\t\tclearTaskStoreHandler(this);\r\n\r\n\t\t\t\tvar self = this;\r\n\t\t\t\tvar delayRender = helpers.delay(function() {\r\n\t\t\t\t\tif (self.$gantt.getState().lightbox) {\r\n\t\t\t\t\t\tdelayRender();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst linkedStore = self.$config.rowStore;\r\n\r\n\t\t\t\t\t\t// Repaint only relevant resources for task drag\r\n\t\t\t\t\t\tconst repaintStack = self._getRelevantResources();\r\n\t\t\t\t\t\t// GS-2822: extra check for resource store\r\n\t\t\t\t\t\tif (repaintStack && linkedStore.$config.name === self.$gantt.config.resource_store){\r\n\t\t\t\t\t\t\tif (repaintStack == \"nothing_to_repaint\"){\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlinkedStore._quick_refresh = true;\r\n\t\t\t\t\t\t\tself.relevantResources.forEach(function(id){\r\n\t\t\t\t\t\t\t\tlinkedStore.refresh(id);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tlinkedStore._quick_refresh = false;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// because rowstore could be changed during timeout\r\n\t\t\t\t\t\t\tlinkedStore.refresh();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 300);\r\n\t\t\t\tthis._delayRender = delayRender;\r\n\t\t\t\tvar handlerIdProperty = \"_attached_\" + ownStore.$config.name;\r\n\r\n\t\t\t\tif (!self[handlerIdProperty]) {\r\n\t\t\t\t\tself[handlerIdProperty] = tasks.attachEvent(\"onStoreUpdated\", function(){\r\n\t\t\t\t\t\tif(!delayRender.$pending && !this._skipResourceRepaint){\r\n\t\t\t\t\t\t\t// don't repaint if we update progress\r\n\t\t\t\t\t\t\tconst state = self.$gantt.getState();\r\n\t\t\t\t\t\t\tif (state.drag_mode == \"progress\"){\r\n\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t} else if (state.drag_mode && state.drag_id){\r\n\t\t\t\t\t\t\t\t// we need it here because if you started dragging a task and quickly stopped the drag_id is removed \r\n\t\t\t\t\t\t\t\t// from the state before we record it, so we cannot repaint only the relevant resources\r\n\t\t\t\t\t\t\t\tself.previousDragId = state.drag_id;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tdelayRender();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.$gantt.attachEvent(\"onDestroy\", function() {\r\n\t\t\t\t\t// detach events to don't call delayed tasks\r\n\t\t\t\t\tclearTaskStoreHandler(self);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (!ownStore.$attachedResourceViewHandler) {\r\n\t\t\t\t\townStore.$attachedResourceViewHandler = ownStore.attachEvent(\"onBeforeFilter\", function() {\r\n\t\t\t\t\t\tif (self.$gantt.getState().lightbox) {\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (delayRender.$pending) {\r\n\t\t\t\t\t\t\tdelayRender.$cancelTimeout();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tself._updateNestedTasks();\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\townStore.$attachedTaskStoreHandler = tasks.attachEvent(\"onAfterDelete\", function(){\r\n\t\t\t\t\t\townStore._mark_recompute = true;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_getRelevantResources: function (){\r\n\t\t\t// GS-2199. process_resource_assignments is disabled,\r\n\t\t\t// so we cannot get only the relevant assignment resources\r\n\t\t\tif (!this.$gantt.getTaskAssignments){\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tconst state = this.$gantt.getState();\r\n\t\t\tconst linkedStore = this.$config.rowStore;\r\n\r\n\t\t\tlet resourceIds = [];\r\n\t\t\tif (state.drag_mode && state.drag_id && linkedStore.$config.name === this.$gantt.config.resource_store){\r\n\t\t\t\tif (this.previousDragId == state.drag_id){ // we continue dragging the task\r\n\t\t\t\t\tif (this.relevantResources) {\r\n\t\t\t\t\t\treturn this.relevantResources;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresourceIds = this._getIdsFromAssignments(this.previousDragId);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse { // we started the task drag\r\n\t\t\t\t\tthis.previousDragId = state.drag_id;\r\n\t\t\t\t\tresourceIds = this._getIdsFromAssignments(this.previousDragId);\r\n\t\t\t\t}\r\n\t\t\t} else if (this.previousDragId){ // finished task drag, but the resources are still the same\r\n\t\t\t\tresourceIds = this._getIdsFromAssignments(this.previousDragId);\r\n\t\t\t\tthis.previousDragId = null;\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tif (!resourceIds.length){\r\n\t\t\t\treturn this.relevantResources = \"nothing_to_repaint\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tresourceIds.forEach(function(resourceId){\r\n\t\t\t\t//GS-2598: linkedstore could be a temp assignment store\r\n\t\t\t\tif(linkedStore.eachParent){\r\n\t\t\t\t\tlinkedStore.eachParent(function(parent){\r\n\t\t\t\t\t\tresourceIds.push(parent.id);\r\n\t\t\t\t\t}, resourceId);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn this.relevantResources = [...new Set(resourceIds)];\r\n\t\t},\r\n\r\n\t\t_getIdsFromAssignments: function(id){\r\n\t\t\tconst gantt = this.$gantt;\r\n\t\t\tconst resourceIds = [];\r\n\r\n\t\t\tconst task = gantt.getTask(id);\r\n\t\t\tlet assignments = gantt.getTaskAssignments(id);\r\n\t\t\tassignments.forEach(function(assignment){\r\n\t\t\t\tresourceIds.push(assignment.resource_id);\r\n\t\t\t});\r\n\r\n\t\t\t// get child assignments when dragging project task\r\n\t\t\tif (gantt.isSummaryTask(task) && gantt.config.drag_project) {\r\n\t\t\t\tgantt.eachTask(function(child){\r\n\t\t\t\t\tconst childAssignments = gantt.getTaskAssignments(child.id);\r\n\t\t\t\t\tchildAssignments.forEach(function(assignment){\r\n\t\t\t\t\t\tresourceIds.push(assignment.resource_id);\r\n\t\t\t\t\t});\r\n\t\t\t\t}, id);\r\n\t\t\t}\r\n\r\n\t\t\t// get assignments of other selected tasks\r\n\t\t\tif (gantt.config.drag_multiple && gantt.getSelectedTasks){\r\n\t\t\t\tconst selectedIds = gantt.getSelectedTasks();\r\n\t\t\t\tselectedIds.forEach(function(selectedId){\r\n\t\t\t\t\tconst selectedAssignments = gantt.getTaskAssignments(selectedId);\r\n\t\t\t\t\tselectedAssignments.forEach(function(assignment){\r\n\t\t\t\t\t\tresourceIds.push(assignment.resource_id);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn resourceIds;\r\n\t\t},\r\n\r\n\t\t_updateNestedTasks: function(){\r\n\t\t\tvar gantt = this.$gantt;\r\n\t\t\tvar resourceStore = gantt.getDatastore(gantt.config.resource_store);\r\n\t\t\tif (!resourceStore.$config.fetchTasks) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tresourceStore.silent(function(){\r\n\t\t\t\tvar toAddArray = [];\r\n\t\t\t\tvar toAdd = {};\r\n\t\t\t\tvar toDelete = {};\r\n\r\n\t\t\t\tresourceStore.eachItem(function(resource){\r\n\t\t\t\t\tif (resource.$role == \"task\") {\r\n\t\t\t\t\t\ttoDelete[resource.id] = true;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar assignments = gantt.getResourceAssignments(resource.id);\r\n\t\t\t\t\tvar addedTasks = {};\r\n\r\n\t\t\t\t\t// GS-1505. We need to sort assignments before updating tasks. \r\n\t\t\t\t\t// Iterating them without that will affect the order of featched tasks in the resource store\r\n\t\t\t\t\tassignments.sort(function (a, b) {\r\n\t\t\t\t\t\tconst resourceData = resourceStore.pull;\r\n\t\t\t\t\t\tconst resource1 = resourceData[`${a.task_id}_${a.resource_id}`];\r\n\t\t\t\t\t\tconst resource2 = resourceData[`${b.task_id}_${b.resource_id}`];\r\n\t\t\t\t\t\tif (resource1 && resource2) {\r\n\t\t\t\t\t\t\treturn resource1.$local_index - resource2.$local_index;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tassignments.forEach(function(a) {\r\n\t\t\t\t\t\tif(addedTasks[a.task_id] || !gantt.isTaskExists(a.task_id)){\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\taddedTasks[a.task_id] = true;\r\n\r\n\t\t\t\t\t\tvar task = gantt.getTask(a.task_id);\r\n\t\t\t\t\t\tvar copy;\r\n\t\t\t\t\t\t//GS-2711: deep copy from task\r\n\t\t\t\t\t\tif(resourceStore.$config.copyOnParse){\r\n\t\t\t\t\t\t\tcopy = gantt.copy(task);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcopy = Object.create(task);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tcopy.id = task.id + '_' + resource.id;\r\n\r\n\t\t\t\t\t\tcopy.$task_id = task.id;\r\n\t\t\t\t\t\tcopy.$resource_id = resource.id;\r\n\t\t\t\t\t\tcopy[resourceStore.$parentProperty] = resource.id;\r\n\t\t\t\t\t\tcopy.$role = \"task\";\r\n\t\t\t\t\t\ttoAddArray.push(copy);\r\n\t\t\t\t\t\ttoAdd[copy.id] = true;\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\tfor (var id in toDelete) {\r\n\t\t\t\t\tif (!toAdd[id]) {\r\n\t\t\t\t\t\tresourceStore.removeItem(id);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(toAddArray.length){\r\n\t\t\t\t\tresourceStore.parse(toAddArray);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default createMixin;","function createResizer(gantt, grid){\r\n\treturn {\r\n\t\tinit: function(){},\r\n\t\tdoOnRender: function(){}\r\n\t};\r\n}\r\n\r\nexport default createResizer;","import * as domHelpers from \"../utils/dom_helpers\";\r\n\r\nfunction createRowResizer(gantt, grid){\r\n\r\n\tvar _task_grid_row_resize = {\r\n\t\trow_before_start: gantt.bind(function (dnd, obj, e) {\r\n\t\t\tvar config = grid.$getConfig();\r\n\t\t\tvar store = grid.$config.rowStore;\r\n\r\n\t\t\tvar el = domHelpers.locateAttribute(e, config.task_grid_row_resizer_attribute);\r\n\t\t\tif (!el) return false;\r\n\r\n\t\t\tvar row_id = this.locate(e, config.task_grid_row_resizer_attribute),\r\n\t\t\t\trow = store.getItem(row_id);\r\n\r\n\t\t\tif (grid.callEvent(\"onBeforeRowResize\", [row]) === false)\r\n\t\t\t\treturn false;\r\n\t\t}, gantt),\r\n\r\n\t\trow_after_start: gantt.bind(function (dnd, obj, e) {\r\n\t\t\tvar config = grid.$getConfig();\r\n\r\n\t\t\tvar row_id = this.locate(e, config.task_grid_row_resizer_attribute);\r\n\t\t\tdnd.config.marker.innerHTML = \"\";\r\n\r\n\t\t\tdnd.config.marker.className += \" gantt_row_grid_resize_area\";\r\n\t\t\tdnd.config.marker.style.width = grid.$grid.offsetWidth + \"px\";\r\n\t\t\tdnd.config.drag_id = row_id;\r\n\r\n\t\t}, gantt),\r\n\r\n\t\trow_drag_move: gantt.bind(function (dnd, obj, e) {\r\n\t\t\tvar store = grid.$config.rowStore;\r\n\t\t\tvar config = grid.$getConfig();\r\n\t\t\tvar dd = dnd.config;\r\n\t\t\tvar id = dd.drag_id,\r\n\t\t\t\titemHeight = grid.getItemHeight(id),\r\n\t\t\t\titemTop = grid.getItemTop(id) - obj.scrollTop;\r\n\t\t\tvar pos = domHelpers.getNodePosition(grid.$grid_data),\r\n\t\t\t\tpointerPosition = parseInt(dd.marker.style.top, 10),\r\n\t\t\t\tmarkerStartPosition = itemTop + pos.y,\r\n\t\t\t\tmarker_height = 0,\r\n\t\t\t\tminPointerPosition = config.min_task_grid_row_height;\r\n\r\n\t\t\tmarker_height = pointerPosition - markerStartPosition;\r\n\t\t\tif(marker_height < minPointerPosition){\r\n\t\t\t\tmarker_height = minPointerPosition;\r\n\t\t\t}\r\n\r\n\t\t\tdd.marker.style.left = pos.x + \"px\";\r\n\t\t\tdd.marker.style.top = markerStartPosition - 1 + \"px\";\r\n\t\t\tdd.marker.style.height = Math.abs(marker_height) + 1 + \"px\";\r\n\r\n\t\t\tdd.marker_height = marker_height;\r\n\t\t\t\r\n\t\t\tgrid.callEvent(\"onRowResize\", [id, store.getItem(id), marker_height + itemHeight]);\r\n\t\t\treturn true;\r\n\t\t}, gantt),\r\n\r\n\t\trow_drag_end: gantt.bind(function (dnd, obj, e) {\r\n\t\t\tvar store = grid.$config.rowStore;\r\n\t\t\tvar dd = dnd.config;\r\n\t\t\tvar id = dd.drag_id,\r\n\t\t\t\titem = store.getItem(id),\r\n\t\t\t\toldItemHeight = grid.getItemHeight(id);\r\n\r\n\t\t\tvar finalHeight = dd.marker_height;\r\n\r\n\t\t\tif (grid.callEvent(\"onBeforeRowResizeEnd\", [id, item, finalHeight]) === false)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (item.row_height == finalHeight)\r\n\t\t\t\treturn;\r\n\r\n\t\t\titem.row_height = finalHeight;\r\n\t\t\t// GS-2275: case for resizing resource grid row and others\r\n\t\t\tstore.updateItem(id);\r\n\t\t\tgrid.callEvent(\"onAfterRowResize\", [id, item, oldItemHeight, finalHeight]);\r\n\r\n\t\t\tthis.render();\r\n\t\t}, gantt)\r\n\t};\r\n\r\n\t// calls the initialization of the D'n'D events for resize elements\r\n\tvar _init_resize = function () {\r\n\r\n\t\tvar DnD = gantt.$services.getService(\"dnd\");\r\n\r\n\t\tvar config = grid.$getConfig();\r\n\r\n\t\tvar dnd = new DnD(grid.$grid_data, {updates_per_second: 60});\r\n\t\tif (gantt.defined(config.dnd_sensitivity))\r\n\t\t\tdnd.config.sensitivity = config.dnd_sensitivity;\r\n\r\n\t\tdnd.attachEvent(\"onBeforeDragStart\", function (obj, e) {\r\n\t\t\treturn _task_grid_row_resize.row_before_start(dnd, obj, e);\r\n\t\t});\r\n\t\tdnd.attachEvent(\"onAfterDragStart\", function (obj, e) {\r\n\t\t\treturn _task_grid_row_resize.row_after_start(dnd, obj, e);\r\n\t\t});\r\n\t\tdnd.attachEvent(\"onDragMove\", function (obj, e) {\r\n\t\t\treturn _task_grid_row_resize.row_drag_move(dnd, obj, e);\r\n\t\t});\r\n\t\tdnd.attachEvent(\"onDragEnd\", function (obj, e) {\r\n\t\t\treturn _task_grid_row_resize.row_drag_end(dnd, obj, e);\r\n\t\t});\r\n\r\n\t};\r\n\r\n\treturn {\r\n\t\tinit: _init_resize\r\n\t};\r\n}\r\n\r\nexport default createRowResizer;","import domEventScope from \"../../ui/utils/dom_event_scope\";\r\nimport * as utils from \"../../../utils/utils\";\r\nimport resourceStoreMixin from \"../resource_store_mixin\";\r\nimport Grid from \"./grid\";\r\nimport __extends from \"../../../utils/extends\";\r\n\r\nconst GridRL = (function (_super) {\r\n\r\n\tfunction GridRL(parent, config, factory, gantt) {\r\n\t\treturn _super.apply(this, arguments) || this;\r\n\t}\r\n\r\n\t__extends(GridRL, _super);\r\n\r\n\tutils.mixin(GridRL.prototype, {\r\n\t\tinit: function(container) {\r\n\t\t\tconst gantt = this.$gantt;\r\n\t\t\tconst gridAriaAttr = gantt._waiAria.gridAttrString();\r\n\t\t\tconst gridDataAriaAttr = gantt._waiAria.gridDataAttrString();\r\n\t\t\tconst _ganttConfig = this.$getConfig();\r\n\t\t\t_ganttConfig.row_height = this._getResourceConfig().row_height ? this._getResourceConfig().row_height : gantt.resource_table.row_height ;\r\n\t\t\tlet reorderColumns = _ganttConfig.reorder_grid_columns || false;\r\n\t\t\tif (this.$config.reorder_grid_columns !== undefined) {\r\n\t\t\t\treorderColumns = this.$config.reorder_grid_columns;\r\n\t\t\t}\r\n\r\n\t\t\tif(this.$config.bind === undefined){\r\n\t\t\t\tthis.$config.bind = \"temp_resource_assignment_store\";\r\n\t\t\t\tthis.$config.name = \"resource_grid_lightbox\";\r\n\t\t\t\tthis.$config.$id = \"GridRL\";\r\n\t\t\t}\r\n\r\n\t\t\tcontainer.innerHTML = \"<div class='gantt_grid' style='width:100%;' \" + gridAriaAttr + \"></div>\";\r\n\t\t\tthis.$grid = container.childNodes[0];\r\n\r\n\t\t\tthis.$grid.innerHTML = \"<div class='gantt_grid_scale' \" +\r\n\t\t\t\tgantt._waiAria.gridScaleRowAttrString() + \"></div><div class='gantt_grid_data' \" + gridDataAriaAttr + \"></div>\";\r\n\r\n\t\t\tthis.$grid_scale = this.$grid.childNodes[0];\r\n\t\t\tthis.$grid_data = this.$grid.childNodes[1];\r\n\r\n\t\t\tlet attr = _ganttConfig[this.$config.bind + \"_attribute\"];\r\n\t\t\tif (!attr && this.$config.bind) {\r\n\t\t\t\tattr = \"data-\" + this.$config.bind + \"-id\";\r\n\t\t\t}\r\n\t\t\tthis.$config.item_attribute = attr || null;\r\n\r\n\t\t\tif (!this.$config.layers) {\r\n\t\t\t\tconst layers = this._createLayerConfig();\r\n\t\t\t\tthis.$config.layers = layers;\r\n\t\t\t}\r\n\r\n\t\t\tconst domEvents = domEventScope();\r\n\t\t\tthis.event = domEvents.attach;\r\n\t\t\tthis.eventRemove = domEvents.detach;\r\n\t\t\tthis._eventRemoveAll = domEvents.detachAll;\r\n\t\t\tthis._createDomEventScope = domEvents.extend;\r\n\r\n\t\t\tthis._addLayers(this.$gantt);\r\n\r\n\t\t\tthis._initEvents();\r\n\r\n\t\t\tthis.callEvent(\"onReady\", []);\r\n\r\n\t\t},\r\n\t\tgetColumn: function (name) {\r\n\t\t\tconst index = this.getColumnIndex(name);\r\n\t\t\tif (index === null) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tconst columns = this._getResourceColumns();\r\n\t\t\treturn columns[index] || null;\r\n\t\t},\r\n\t\tgetColumnIndex: function (name, excludeHidden) {\r\n\t\t\tconst columns = this._getResourceColumns();\r\n\t\t\tlet hiddenIndexShift = 0;\r\n\r\n\t\t\tfor (let i = 0; i < columns.length; i++) {\r\n\t\t\t\t// GS-1257. If the cell is hidden, the target column index should be correct\r\n\t\t\t\tif (excludeHidden && columns[i].hide){\r\n\t\t\t\t\thiddenIndexShift++;\r\n\t\t\t\t}\r\n\t\t\t\tif (columns[i].name == name) {\r\n\t\t\t\t\treturn i - hiddenIndexShift;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\tgetGridColumns: function(){\r\n\t\t\tconst columns = this._getResourceColumns();\r\n\t\t\tconst visibleColumns = [];\r\n\t\r\n\t\t\tfor (let i = 0; i < columns.length; i++) {\r\n\t\t\t\tif (!columns[i].hide)\r\n\t\t\t\t\tvisibleColumns.push(columns[i]);\r\n\t\t\t}\r\n\t\r\n\t\t\treturn visibleColumns;\r\n\t\t},\r\n\t\t_createLayerConfig: function () {\r\n\t\t\tconst gantt = this.$gantt;\r\n\t\t\tconst self = this;\r\n\t\t\tconst layers = [\r\n\t\t\t\t{\r\n\t\t\t\t\trenderer: gantt.$ui.layers.gridLine(),\r\n\t\t\t\t\tcontainer: this.$grid_data,\r\n\t\t\t\t\tfilter: [function () {\r\n\t\t\t\t\t\treturn self.isVisible();\r\n\t\t\t\t\t}]\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\trenderer: gantt.$ui.layers.gridTaskRowResizer(),\r\n\t\t\t\t\tcontainer: this.$grid_data,\r\n\t\t\t\t\tappend: true,\r\n\t\t\t\t\tfilter: [function () {\r\n\t\t\t\t\t\treturn gantt.config.resize_rows;\r\n\t\t\t\t\t}]\r\n\t\t\t\t}\r\n\t\t\t];\r\n\t\t\treturn layers;\r\n\t\t},\r\n\t\t_renderGridHeader: function () {\r\n\t\t\tconst gantt = this.$gantt;\r\n\t\t\tconst config = this._getResourceConfig();\r\n\t\t\tconst locale = this.$gantt.locale;\r\n\t\t\tconst templates = this.$getTemplates();\r\n\t\r\n\t\t\tlet columns = this._getResourceColumns();\r\n\t\t\tif (config.rtl) {\r\n\t\t\t\tcolumns = columns.reverse();\r\n\t\t\t}\r\n\t\t\tif(!config.scale_height){\r\n\t\t\t\tconfig.scale_height = gantt.resource_table.scale_height;\r\n\t\t\t}\r\n\t\t\tlet cells = [];\r\n\t\t\tlet width = 0,\r\n\t\t\t\tlabels = locale.labels;\r\n\t\r\n\t\t\t\tlet lineHeigth = config.scale_height - 1;\r\n\t\r\n\t\t\tfor (let i = 0; i < columns.length; i++) {\r\n\t\t\t\tlet last = i == columns.length - 1;\r\n\t\t\t\tlet col = columns[i];\r\n\t\r\n\t\t\t\t// ensure columns have non-empty names\r\n\t\t\t\tif (!col.name) {\r\n\t\t\t\t\tcol.name = gantt.uid() + \"\";\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tlet colWidth = col.width * 1;\r\n\t\r\n\t\t\t\tlet gridWidth = this._getGridWidth();\r\n\t\t\t\tif (last && gridWidth > width + colWidth)\r\n\t\t\t\t\tcol.width = colWidth = gridWidth - width;\r\n\t\t\t\twidth += colWidth;\r\n\t\t\t\tlet sort = (gantt._sort && col.name == gantt._sort.name) ? (`<div data-column-id=\"${col.name}\" class=\"gantt_sort gantt_${gantt._sort.direction}\"></div>`) : \"\";\r\n\t\t\t\tlet cssClass = [\"gantt_grid_head_cell\",\r\n\t\t\t\t\t(\"gantt_grid_head_\" + col.name),\r\n\t\t\t\t\t(last ? \"gantt_last_cell\" : \"\"),\r\n\t\t\t\t\ttemplates.grid_header_class ? templates.grid_header_class(col.name, col) : \"\"].join(\" \");\r\n\t\r\n\t\t\t\tlet style = \"width:\" + (colWidth - (last ? 1 : 0)) + \"px;\";\r\n\t\t\t\tlet label = (col.label || labels[\"column_\" + col.name] || labels[col.name]);\r\n\t\t\t\tlabel = label || \"\";\r\n\t\r\n\t\t\t\tconst ariaAttrs = gantt._waiAria.gridScaleCellAttrString(col, label);\r\n\t\r\n\t\t\t\tconst cell = \"<div class='\" + cssClass + \"' style='\" + style + \"' \" + ariaAttrs + \r\n\t\t\t\t\t\" data-column-id='\" + col.name + \"' column_id='\" + col.name + \"'\" +\r\n\t\t\t\t\t\" data-column-name='\" + col.name + \"' data-column-index='\" + i + \"'\" +\r\n\t\t\t\t\t\">\" + label + sort + \"</div>\";\r\n\t\t\t\tcells.push(cell);\r\n\t\t\t}\r\n\t\t\tthis.$grid_scale.style.height = (config.scale_height) + \"px\";\r\n\t\t\tthis.$grid_scale.style.lineHeight = lineHeigth + \"px\";\r\n\t\t\tthis.$grid_scale.style.width = \"inherit\";\r\n\t\t\tthis.$grid_scale.innerHTML = cells.join(\"\");\r\n\t\t},\r\n\t\tisVisible: function () {\r\n\t\t\tif (this.$parent) {\r\n\t\t\t\treturn !this.$parent.hidden;\r\n\t\t\t} else {\r\n\t\t\t\treturn this.$grid.offsetWidth;\r\n\t\t\t}\r\n\t\t},\r\n\t\t_initEvents: function(){\r\n\t\t},\r\n\t\t_getResourceSection: function(){\r\n\t\t\treturn gantt.getLightboxSection(this.$config.sectionName).section;\r\n\t\t},\r\n\t\t$getTemplates: function() {\r\n\t\t\treturn this._getResourceSection().templates || {};\r\n\t\t},\r\n\t\t_getResourceConfig: function(){\r\n\t\t\treturn this._getResourceSection().config || gantt.resource_table;\r\n\t\t},\r\n\t\t_getResourceColumns: function() {\r\n\t\t\treturn this._getResourceSection().config?.columns || gantt.resource_table.columns;\r\n\t\t},\r\n\t\tdestructor: function () {\r\n\t\t\tif (this._mouseDelegates) {\r\n\t\t\t\tthis._mouseDelegates.destructor();\r\n\t\t\t\tthis._mouseDelegates = null;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._unbindStore();\r\n\t\t\tthis.$grid = null;\r\n\t\t\tthis.$grid_scale = null;\r\n\t\t\tthis.$grid_data = null;\r\n\t\t\tthis._eventRemoveAll();\r\n\t\t\tgantt.ext.inlineEditorsLightbox.destructor();\r\n\t\t\tthis.callEvent(\"onDestroy\", []);\r\n\t\t\tthis.detachAllEvents();\r\n\t\t}\r\n\t\t\r\n\t}, true);\r\n\r\n\tutils.mixin(GridRL.prototype, resourceStoreMixin(GridRL), true);\r\n\r\n\treturn GridRL;\r\n})(Grid);\r\n\r\nexport default GridRL;","export default {\r\n\tinit: function (controller, grid) {\r\n\t\tvar gantt = grid.$gantt;\r\n\r\n\t\tgantt.attachEvent(\"onTaskClick\", function (id, e) {\r\n\t\t\tif (gantt._is_icon_open_click(e))\r\n\t\t\t\treturn true;\r\n\t\t\tvar state = controller.getState();\r\n\t\t\tvar cell = controller.locateCell(e.target);\r\n\r\n\t\t\tif (cell && controller.getEditorConfig(cell.columnName)) {\r\n\t\t\t\tif (controller.isVisible() && state.id == cell.id && state.columnName == cell.columnName) {\r\n\t\t\t\t\t// do nothing if editor is already active in this cell\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcontroller.startEdit(cell.id, cell.columnName);\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\t\t//GS-2598: new resource control click handler\r\n\t\tif(grid.$config.id === \"GridRL\"){\r\n\t\t\tgantt.event(gantt.getLightbox(), \"click\", function (e) {\r\n\t\t\t\tconst domHelpers = gantt.utils.dom;\r\n\t\t\t\tconst state = controller.getState();\r\n\t\t\t\tconst cell = controller.locateCell(e.target);\r\n\t\t\t\t// click on the resource table\r\n\t\t\t\tif (cell && controller.getEditorConfig(cell.columnName)) {\r\n\t\t\t\t\t// validation for unassigned case\r\n\t\t\t\t\tif(cell.columnName == 'duration' || cell.columnName == 'end'){\r\n\t\t\t\t\t\tconst tempAssignmentStore = gantt.getDatastore(\"temp_resource_assignment_store\");\r\n\t\t\t\t\t\tconst assignment = tempAssignmentStore.getItem(cell.id);\r\n\t\t\t\t\t\tif(assignment){\r\n\t\t\t\t\t\t\tif(!assignment.start_date){\r\n\t\t\t\t\t\t\t\tgantt.message({\r\n\t\t\t\t\t\t\t\t\ttype:\"warning\",\r\n\t\t\t\t\t\t\t\t\ttext:\"Specify assignment start date\"\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tcontroller.hide();\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (controller.isVisible() && state.id == cell.id && state.columnName == cell.columnName) {\r\n\t\t\t\t\t// do nothing if editor is already active in this cell\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcontroller.startEdit(cell.id, cell.columnName);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(controller.isChanged()){\r\n\t\t\t\t\t\tcontroller.save();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\t// do nothing if add resource button clicked\r\n\t\t\t\tif(domHelpers.closest(e.target, `.gantt_custom_button.gantt_add_resources`)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// handle assignment deleting\r\n\t\t\t\tif(domHelpers.closest(e.target, `[data-assignment-delete]`)){\r\n\t\t\t\t\tconst assignmentId = e.target.getAttribute(\"data-assignment-delete\");\r\n\t\t\t\t\tgantt.confirm({\r\n\t\t\t\t\t\ttext: \"Resource assignment will be deleted permanently, are you sure?\",\r\n\t\t\t\t\t\tcancel:\"No\",\r\n\t\t\t\t\t\tok:\"Delete\", \r\n\t\t\t\t\t\tcallback: function(result){\r\n\t\t\t\t\t\t\tif(result){\r\n\t\t\t\t\t\t\t\tconst tempAssignmentStore = gantt.getDatastore(\"temp_resource_assignment_store\");\r\n\t\t\t\t\t\t\t\ttempAssignmentStore.removeItem(assignmentId);\r\n\t\t\t\t\t\t\t\t// handle deleting last grid row, \r\n\t\t\t\t\t\t\t\tif (tempAssignmentStore.getItems().length == 0){\r\n\t\t\t\t\t\t\t\t\tconst resourceSection = gantt.getLightboxSection(grid.$config.sectionName);\r\n\t\t\t\t\t\t\t\t\tconst block = gantt.form_blocks[\"resource_selector\"];\r\n\t\t\t\t\t\t\t\t\tconst node = gantt._lightbox_root.querySelector(\"#\" + resourceSection.section.id).nextSibling;\r\n\t\t\t\t\t\t\t\t\tblock.set_value.call(gantt, node, [], {}, resourceSection.section, true);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tgantt.refreshData();\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t//click outside the resource table\r\n\t\t\t\tif(controller.isVisible()) {\r\n\t\t\t\t\tcontroller.save();\r\n\t\t\t\t\tcontroller.hide();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcontroller.hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t// before saving lightbox need to save controller value if its modified\r\n\t\t\t// covering date type inputs\r\n\t\t\tgantt.lightbox_events.gantt_save_btn = function () {\r\n\t\t\t\tcontroller.save();\r\n\t\t\t\tgantt._save_lightbox();\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\tgantt.attachEvent(\"onEmptyClick\", function () {\r\n\t\t\tif (controller.isVisible() && controller.isChanged()) {\r\n\t\t\t\tcontroller.save();\r\n\t\t\t} else {\r\n\t\t\t\tcontroller.hide();\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onTaskDblClick\", function (id, e) {\r\n\t\t\tvar state = controller.getState();\r\n\t\t\tvar cell = controller.locateCell(e.target);\r\n\t\t\tif (cell && controller.isVisible() && cell.columnName == state.columnName) {\r\n\t\t\t\t//GS-933 probably, we don't need to hide the inline editor because the lightbox cannot be opened if you double-click on an inline editor\r\n\t\t\t\t//remove this code later if people don't complain\r\n\t\t\t\t//controller.hide();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\t},\r\n\r\n\tonShow: function (controller, placeholder, grid) {\r\n\t\tvar gantt = grid.$gantt;\r\n\t\t\r\n\r\n\t\tif(gantt.ext && gantt.ext.keyboardNavigation){\r\n\t\t\tvar keyNav = gantt.ext.keyboardNavigation;\r\n\t\t\tkeyNav.attachEvent(\"onKeyDown\", function(command, e){\r\n\t\t\t\tvar keyboard = gantt.constants.KEY_CODES;\r\n\t\t\t\tvar keyCode = e.keyCode;\r\n\t\t\t\tvar preventKeyNav = false;\r\n\r\n\t\t\t\tswitch (keyCode){\r\n\t\t\t\t\tcase keyboard.SPACE:\r\n\t\t\t\t\t\tif(controller.isVisible()){\r\n\t\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (preventKeyNav){\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t} else{\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tplaceholder.onkeydown = function (e) {\r\n\t\t\te = e || window.event;\r\n\r\n\t\t\tvar keyboard = gantt.constants.KEY_CODES;\r\n\t\t\tif (e.defaultPrevented || (e.shiftKey && e.keyCode != keyboard.TAB)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar shouldPrevent = true;\r\n\t\t\tswitch (e.keyCode) {\r\n\t\t\t\tcase gantt.keys.edit_save:\r\n\t\t\t\t\tcontroller.save();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase gantt.keys.edit_cancel:\r\n\t\t\t\t\tcontroller.hide();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.UP:\r\n\t\t\t\tcase keyboard.DOWN:\r\n\t\t\t\t\tif (controller.isVisible()) {\r\n\t\t\t\t\t\tcontroller.hide();\r\n\t\t\t\t\t\tshouldPrevent = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.TAB:\r\n\t\t\t\t\tif (e.shiftKey) {\r\n\t\t\t\t\t\tcontroller.editPrevCell(true);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcontroller.editNextCell(true);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tshouldPrevent = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (shouldPrevent) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t}\r\n\t\t};\r\n\t\t// GS-2598: update inline editor in the lightbox\r\n\t\tif(grid.$config.id === \"GridRL\"){\r\n\t\t\tplaceholder.onkeyup = function (e) {\r\n\t\t\t\te = e || window.event;\r\n\r\n\t\t\t\tvar keyboard = gantt.constants.KEY_CODES;\r\n\t\t\t\tif (e.defaultPrevented || (e.shiftKey && e.keyCode != keyboard.TAB)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif(gantt._lightbox_id && controller.isChanged()){\r\n\t\t\t\t\tcontroller.save();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tlet timeout;\r\n\t\t\tplaceholder.onwheel = function (e) {\r\n\t\t\t\te = e || window.event;\r\n\t\t\t\tif(gantt._lightbox_id && controller.isChanged()){\r\n\t\t\t\t\tclearTimeout(timeout);\r\n\t\t\t\t\ttimeout=setTimeout(function(){\r\n\t\t\t\t\t\tcontroller.save();\r\n\t\t\t\t\t},100);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t},\r\n\tonHide: function () {\r\n\r\n\t},\r\n\r\n\tdestroy: function () {\r\n\r\n\t}\r\n};\r\n\r\n","export default {\r\n\tinit: function(controller, grid){\r\n\t\tvar self = controller;\r\n\t\tvar gantt = grid.$gantt;\r\n\r\n\t\tvar onBlurDelay = null;\r\n\t\tvar keyNav = gantt.ext.keyboardNavigation;\r\n\t\tkeyNav.attachEvent(\"onBeforeFocus\", function (node) {\r\n\t\t\tvar activeCell = controller.locateCell(node);\r\n\t\t\tclearTimeout(onBlurDelay);\r\n\t\t\tif (activeCell) {\r\n\t\t\t\tvar columnName = activeCell.columnName;\r\n\t\t\t\tvar id = activeCell.id;\r\n\r\n\t\t\t\tvar editorState = self.getState();\r\n\t\t\t\tif(self.isVisible()){\r\n\t\t\t\t\tif(editorState.id == id && editorState.columnName === columnName) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tkeyNav.attachEvent(\"onFocus\", function (node) {\r\n\t\t\tvar activeCell = controller.locateCell(node);\r\n\t\t\tvar state = controller.getState();\r\n\t\t\tclearTimeout(onBlurDelay);\r\n\t\t\tif (activeCell && !(activeCell.id == state.id && activeCell.columnName == state.columnName)) {\r\n\t\t\t\tif(self.isVisible()){\r\n\t\t\t\t\tself.save();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tcontroller.attachEvent(\"onHide\", function(){\r\n\t\t\tclearTimeout(onBlurDelay);\r\n\t\t});\r\n\r\n\t\tkeyNav.attachEvent(\"onBlur\", function () {\r\n\t\t\tonBlurDelay = setTimeout(function(){\r\n\t\t\t\tself.save();\r\n\t\t\t});\r\n\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onTaskDblClick\", function(id,e){\r\n\t\t\t// block lightbox on double click inside editor\r\n\t\t\tvar state = controller.getState();\r\n\t\t\tvar cell = controller.locateCell(e.target);\r\n\t\t\tif(cell && controller.isVisible() && cell.columnName == state.columnName){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onTaskClick\", function (id, e) {\r\n\t\t\tif(gantt._is_icon_open_click(e))\r\n\t\t\t\treturn true;\r\n\r\n\t\t\tvar state = controller.getState();\r\n\t\t\tvar cell = controller.locateCell(e.target);\r\n\r\n\t\t\tif (cell && controller.getEditorConfig(cell.columnName)) {\r\n\t\t\t\tif(controller.isVisible() && state.id == cell.id && state.columnName == cell.columnName){\r\n\t\t\t\t\t// do nothing if editor is already active in this cell\r\n\t\t\t\t}else{\r\n\t\t\t\t\tcontroller.startEdit(cell.id, cell.columnName);\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onEmptyClick\", function () {\r\n\t\t\tself.save();\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tkeyNav.attachEvent(\"onKeyDown\", function(command, e){\r\n\t\t\tvar activeCell = controller.locateCell(e.target);\r\n\t\t\tvar hasEditor = activeCell ? controller.getEditorConfig(activeCell.columnName) : false;\r\n\r\n\t\t\tvar state = controller.getState();\r\n\t\t\tvar keyboard = gantt.constants.KEY_CODES;\r\n\t\t\tvar keyCode = e.keyCode;\r\n\t\t\tvar preventKeyNav = false;\r\n\r\n\t\t\tswitch (keyCode){\r\n\t\t\t\tcase keyboard.ENTER:\r\n\t\t\t\t\tif(controller.isVisible()){\r\n\t\t\t\t\t\tcontroller.save();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}else if(hasEditor && !(e.ctrlKey || e.metaKey || e.shiftKey)){\r\n\t\t\t\t\t\tself.startEdit(activeCell.id, activeCell.columnName);\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.ESC:\r\n\t\t\t\t\tif(controller.isVisible()){\r\n\t\t\t\t\t\tcontroller.hide();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.UP:\r\n\t\t\t\tcase keyboard.DOWN:\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.LEFT:\r\n\t\t\t\tcase keyboard.RIGHT:\r\n\t\t\t\t\tif((hasEditor && controller.isVisible()) || state.editorType === \"date\"){\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.SPACE:\r\n\t\t\t\t\tif(controller.isVisible()){\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(hasEditor && !controller.isVisible()){\r\n\t\t\t\t\t\tself.startEdit(activeCell.id, activeCell.columnName);\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.DELETE:\r\n\t\t\t\t\tif(hasEditor && !controller.isVisible()){\r\n\t\t\t\t\t\tself.startEdit(activeCell.id, activeCell.columnName);\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t} else if(hasEditor && controller.isVisible()){\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.TAB:\r\n\t\t\t\t\tif(controller.isVisible()){\r\n\r\n\t\t\t\t\t\tif(e.shiftKey){\r\n\t\t\t\t\t\t\tcontroller.editPrevCell(true);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tcontroller.editNextCell(true);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar newState = controller.getState();\r\n\t\t\t\t\t\tif(newState.id){\r\n\t\t\t\t\t\t\tkeyNav.focus({type:\"taskCell\", id: newState.id, column:newState.columnName});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tif(controller.isVisible())\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\telse{\r\n\r\n\t\t\t\t\t\t// start editing on character key\r\n\t\t\t\t\t\tif((keyCode >= 48 && keyCode <= 57) || // [0-9]\r\n\t\t\t\t\t\t\t(keyCode > 95 && keyCode < 112) || // numpad\r\n\t\t\t\t\t\t\t(keyCode >= 64 && keyCode <= 91) || // [a-z]\r\n\t\t\t\t\t\t\t(keyCode > 185 && keyCode < 193) || //;=-,etc\r\n\t\t\t\t\t\t\t(keyCode > 218  && keyCode < 223)\r\n\t\t\t\t\t\t){\r\n\t\t\t\t\t\t\tvar modifiers = command.modifiers;\r\n\r\n\t\t\t\t\t\t\tvar anyModifier = modifiers.alt || modifiers.ctrl || modifiers.meta || modifiers.shift;\r\n\t\t\t\t\t\t\tif(modifiers.alt || e.key === \"Meta\"){\r\n\t\t\t\t\t\t\t\t// don't start editing on alt+key or Meta/Cmd key\r\n\t\t\t\t\t\t\t}else if (anyModifier && keyNav.getCommandHandler(command, \"taskCell\")){\r\n\t\t\t\t\t\t\t\t// don't start editing if command already have a keyboard shortcut\r\n\t\t\t\t\t\t\t}else if(hasEditor && !controller.isVisible()){\r\n\t\t\t\t\t\t\t\tself.startEdit(activeCell.id, activeCell.columnName);\r\n\t\t\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (preventKeyNav){\r\n\t\t\t\treturn false;\r\n\t\t\t} else{\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t});\r\n\t},\r\n\tonShow: function(controller, placeholder, grid){},\r\n\tonHide: function(controller, placeholder, grid){\r\n\t\tconst gantt = grid.$gantt;\r\n\t\tif (gantt){\r\n\t\t\tgantt.focus();\r\n\t\t}\r\n\r\n\t},\r\n\tdestroy: function(){}\r\n};\r\n\r\n","export default function (gantt) {\r\n\r\n\tvar BaseEditor = function () {\r\n\t};\r\n\r\n\tBaseEditor.prototype = {\r\n\t\tshow: function (id, column, config, placeholder) {\r\n\t\t},\r\n\t\thide: function () {\r\n\t\t},\r\n\t\tset_value: function (value, id, column, node) {\r\n\t\t\tthis.get_input(node).value = value;\r\n\t\t},\r\n\t\tget_value: function (id, column, node) {\r\n\t\t\treturn this.get_input(node).value || \"\";\r\n\t\t},\r\n\t\tis_changed: function (value, id, column, node) {\r\n\t\t\tvar currentValue = this.get_value(id, column, node);\r\n\t\t\tif (currentValue && value && currentValue.valueOf && value.valueOf) {\r\n\t\t\t\treturn currentValue.valueOf() != value.valueOf();\r\n\t\t\t} else {\r\n\t\t\t\treturn currentValue != value;\r\n\t\t\t}\r\n\t\t},\r\n\t\tis_valid: function (value, id, column, node) {\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\t\tsave: function (id, column, node) {\r\n\r\n\t\t},\r\n\t\tget_input: function (node) {\r\n\t\t\treturn node.querySelector(\"input\");\r\n\t\t},\r\n\t\tfocus: function (node) {\r\n\t\t\tvar input = this.get_input(node);\r\n\t\t\tif (!input) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (input.focus) {\r\n\t\t\t\tinput.focus();\r\n\t\t\t}\r\n\r\n\t\t\tif (input.select) {\r\n\t\t\t\tinput.select();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\treturn BaseEditor;\r\n};","import BaseFactory from \"./base\";\r\nimport * as utils from \"../../../../../utils/utils\";\r\nimport __extends from \"../../../../../utils/extends\";\r\n\r\n\r\nexport default function(gantt) {\r\n\r\n\tvar BaseEditor = BaseFactory(gantt);\r\n\r\n\tfunction TextEditor() {\r\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(TextEditor, BaseEditor);\r\n\r\n\tutils.mixin(TextEditor.prototype, {\r\n\t\tshow: function (id, column, config, placeholder) {\r\n\t\t\tvar html = `<div role='cell'><input type='text' name='${column.name}' title='${column.name}'></div>`;\r\n\t\t\tplaceholder.innerHTML = html;\r\n\t\t}\r\n\t}, true);\r\n\r\n\treturn TextEditor;\r\n};","import BaseFactory from \"./base\";\r\nimport * as utils from \"../../../../../utils/utils\";\r\nimport __extends from \"../../../../../utils/extends\";\r\n\r\n\r\nexport default function(gantt) {\r\n\r\n\tvar BaseEditor = BaseFactory(gantt);\r\n\r\n\tfunction NumberEditor() {\r\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(NumberEditor, BaseEditor);\r\n\r\n\tutils.mixin(NumberEditor.prototype, {\r\n\t\tshow: function (id, column, config, placeholder) {\r\n\t\t\tvar min = config.min || 0,\r\n\t\t\t\tmax = config.max || 100;\r\n\r\n\t\t\tvar html = `<div role='cell'><input type='number' min='${min}' max='${max}' name='${column.name}' title='${column.name}'></div>`;\r\n\t\t\tplaceholder.innerHTML = html;\r\n\r\n\t\t\t// GS-1914. Do not allow entering alues beyond min and max via keyboard\r\n\t\t\tplaceholder.oninput = function (e) {\r\n\t\t\t\tif (+e.target.value < min) {\r\n\t\t\t\t\te.target.value = min;\r\n\t\t\t\t}\r\n\t\t\t\tif (+e.target.value > max) {\r\n\t\t\t\t\te.target.value = max;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\tget_value: function (id, column, node) {\r\n\t\t\treturn this.get_input(node).value || \"\";\r\n\t\t},\r\n\t\tis_valid: function (value, id, column, node) {\r\n\t\t\treturn !isNaN(parseInt(value, 10));\r\n\t\t}\r\n\t}, true);\r\n\r\n\treturn NumberEditor;\r\n};","import BaseFactory from \"./base\";\r\nimport * as utils from \"../../../../../utils/utils\";\r\nimport __extends from \"../../../../../utils/extends\";\r\n\r\n\r\nexport default function(gantt) {\r\n\r\n\tvar BaseEditor = BaseFactory(gantt);\r\n\r\n\tfunction SelectEditor() {\r\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(SelectEditor, BaseEditor);\r\n\r\n\tutils.mixin(SelectEditor.prototype, {\r\n\t\tshow: function (id, column, config, placeholder) {\r\n\t\t\tvar html = `<div role='cell'><select name='${column.name}' title='${column.name}'>`;\r\n\t\t\tvar optionsHtml = [],\r\n\t\t\t\toptions = config.options || [];\r\n\r\n\t\t\tfor (var i = 0; i < options.length; i++) {\r\n\t\t\t\toptionsHtml.push(\"<option value='\" + config.options[i].key + \"'>\" + options[i].label + \"</option>\");\r\n\t\t\t}\r\n\r\n\t\t\thtml += optionsHtml.join(\"\") + \"</select></div>\";\r\n\t\t\tplaceholder.innerHTML = html;\r\n\t\t},\r\n\t\tget_input: function (node) {\r\n\t\t\treturn node.querySelector(\"select\");\r\n\t\t}\r\n\t}, true);\r\n\r\n\treturn SelectEditor;\r\n};","import * as utils from \"../../../../../utils/utils\";\r\nimport __extends from \"../../../../../utils/extends\";\r\nimport BaseFactory from \"./base\";\r\n\r\nexport default function (gantt) {\r\n\tvar BaseEditor = BaseFactory(gantt);\r\n\t\r\n\t\r\n\r\n\tvar html5DateFormat = \"%Y-%m-%d\";\r\n\r\n\tvar dateToStr = null;\r\n\tvar strToDate = null;\r\n\r\n\tfunction init() {\r\n\t\tif (!dateToStr) {\r\n\t\t\tdateToStr = gantt.date.date_to_str(html5DateFormat);\r\n\t\t}\r\n\t\tif (!strToDate) {\r\n\t\t\tstrToDate = gantt.date.str_to_date(html5DateFormat);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction DateEditor() {\r\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\r\n\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(DateEditor, BaseEditor);\r\n\r\n\tutils.mixin(DateEditor.prototype, {\r\n\t\tshow: function (id, column, config, placeholder) {\r\n\t\t\tinit();\r\n\t\t\tvar minValue = null;\r\n\t\t\tvar maxValue = null;\r\n\r\n\t\t\tif(typeof config.min === \"function\"){\r\n\t\t\t\tminValue = config.min(id, column);\r\n\t\t\t}else{\r\n\t\t\t\tminValue = config.min;\r\n\t\t\t}\r\n\r\n\t\t\tif(typeof config.max === \"function\"){\r\n\t\t\t\tmaxValue = config.max(id, column);\r\n\t\t\t}else{\r\n\t\t\t\tmaxValue = config.max;\r\n\t\t\t}\r\n\r\n\t\t\tvar minAttr = minValue ? \" min='\" + dateToStr(minValue)+\"' \"  : \"\";\r\n\t\t\tvar maxAttr = maxValue ? \" max='\" + dateToStr(maxValue)+\"' \"  : \"\";\r\n\t\t\tvar html = `<div style='width:140px' role='cell'><input type='date' ${minAttr} ${maxAttr} name='${column.name}' title='${column.name}'></div>`;\r\n\t\t\tplaceholder.innerHTML = html;\r\n\r\n\t\t\t// GS-1914. Do not allow entering alues beyond min and max via keyboard\r\n\t\t\tplaceholder.oninput = function (e) {\r\n\t\t\t\tif (e.target.value && (minValue || maxValue)){\r\n\t\t\t\t\tif (+gantt.date.str_to_date(\"%Y-%m-%d\")(e.target.value) < +minValue) {\r\n\t\t\t\t\t\te.target.value = gantt.date.date_to_str(\"%Y-%m-%d\")(minValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (+gantt.date.str_to_date(\"%Y-%m-%d\")(e.target.value) > +maxValue) {\r\n\t\t\t\t\t\te.target.value = gantt.date.date_to_str(\"%Y-%m-%d\")(maxValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\tset_value: function (value, id, column, node) {\r\n\t\t\tif (value && value.getFullYear) {\r\n\t\t\t\tthis.get_input(node).value = dateToStr(value);\r\n\t\t\t} else {\r\n\t\t\t\tthis.get_input(node).value = value;\r\n\t\t\t}\r\n\t\t},\r\n\t\tis_valid: function (value, id, column, node) {\r\n\t\t\tif (!value || isNaN(value.getTime()))\r\n\t\t\t\treturn false;\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tget_value: function (id, column, node) {\r\n\t\t\tvar parsed;\r\n\t\t\ttry {\r\n\t\t\t\tparsed = strToDate(this.get_input(node).value || \"\");\r\n\t\t\t} catch (e) {\r\n\t\t\t\tparsed = null;// return null will cancel changes\r\n\t\t\t}\r\n\r\n\t\t\treturn parsed;\r\n\t\t}\r\n\t}, true);\r\n\r\n\treturn DateEditor;\r\n};\r\n","import BaseFactory from \"./base\";\r\nimport * as utils from \"../../../../../utils/utils\";\r\nimport __extends from \"../../../../../utils/extends\";\r\n\r\n\r\nexport default function(gantt) {\r\n\r\n\tvar BaseEditor = BaseFactory(gantt);\r\n\r\n\tfunction PredecessorEditor() {\r\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(PredecessorEditor, BaseEditor);\r\n\r\n\tfunction getFormatter(config) {\r\n\t\treturn config.formatter || gantt.ext.formatters.linkFormatter();\r\n\t}\r\n\r\n\tfunction parseInputString(value, config) {\r\n\t\tvar predecessors = (value || \"\").split(config.delimiter || \",\");\r\n\t\tfor (var i = 0; i < predecessors.length; i++) {\r\n\t\t\tvar val = predecessors[i].trim();\r\n\t\t\tif (val) {\r\n\t\t\t\tpredecessors[i] = val;\r\n\t\t\t} else {\r\n\t\t\t\tpredecessors.splice(i, 1);\r\n\t\t\t\ti--;\r\n\t\t\t}\r\n\t\t}\r\n\t\tpredecessors.sort();\r\n\t\treturn predecessors;\r\n\t}\r\n\r\n\tfunction formatPredecessors(task, config, gantt) {\r\n\t\tvar links = task.$target;\r\n\t\tvar labels = [];\r\n\t\tfor (var i = 0; i < links.length; i++) {\r\n\t\t\tvar link = gantt.getLink(links[i]);\r\n\t\t\tlabels.push(getFormatter(config).format(link));\r\n\t\t}\r\n\t\treturn labels.join((config.delimiter || \",\") + \" \");\r\n\t}\r\n\r\n\tfunction getSelectedLinks(taskId, predecessorCodes, config) {\r\n\t\tvar links = [];\r\n\t\t// select only unique codes GS-1439\r\n\t\t[...new Set(predecessorCodes)].forEach(function (code) {\r\n\t\t\tvar link = getFormatter(config).parse(code);\r\n\t\t\tif(link){\r\n\t\t\t\tlink.target = taskId;\r\n\t\t\t\t// GS-1290 A way to preserve the link. Otherwise validation will return false\r\n\t\t\t\t// because the existing link ID is not passed there\r\n\t\t\t\tlink.id = \"predecessor_generated\";\r\n\t\t\t\tif (gantt.isLinkAllowed(link)) {\r\n\t\t\t\t\tlink.id = undefined;\r\n\t\t\t\t\tlinks.push(link);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn links;\r\n\t}\r\n\r\n\tfunction formatLinkKey(link){\r\n\t\treturn link.source + \"_\" + link.target + \"_\" + link.type + \"_\" + (link.lag||0);\r\n\t}\r\n\r\n\tfunction getLinksDiff(task, predecessorCodes, config) {\r\n\t\tvar selectedLinks = getSelectedLinks(task.id, predecessorCodes, config);\r\n\t\tvar existingLinksSearch = {};\r\n\t\ttask.$target.forEach(function (linkId) {\r\n\t\t\tvar link = gantt.getLink(linkId);\r\n\t\t\texistingLinksSearch[formatLinkKey(link)] = link.id;\r\n\t\t});\r\n\r\n\t\tvar linksToAdd = [];\r\n\t\tselectedLinks.forEach(function (link) {\r\n\t\t\tvar linkKey = formatLinkKey(link);\r\n\t\t\tif (!existingLinksSearch[linkKey]) {\r\n\t\t\t\tlinksToAdd.push(link);\r\n\t\t\t} else {\r\n\t\t\t\tdelete existingLinksSearch[linkKey];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar linksToDelete = [];\r\n\t\tfor (var i in existingLinksSearch) {\r\n\t\t\tlinksToDelete.push(existingLinksSearch[i]);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tadd: linksToAdd,\r\n\t\t\tremove: linksToDelete\r\n\t\t};\r\n\t}\r\n\r\n\tutils.mixin(PredecessorEditor.prototype, {\r\n\t\tshow: function (id, column, config, placeholder) {\r\n\t\t\tvar html = `<div role='cell'><input type='text' name='${column.name}' title='${column.name}'></div>`;\r\n\t\t\tplaceholder.innerHTML = html;\r\n\t\t},\r\n\t\thide: function () {\r\n\t\t},\r\n\t\tset_value: function (value, id, column, node) {\r\n\t\t\tthis.get_input(node).value = formatPredecessors(value, column.editor, gantt);\r\n\t\t},\r\n\t\tget_value: function (id, column, node) {\r\n\t\t\treturn parseInputString((this.get_input(node).value || \"\"), column.editor);\r\n\t\t},\r\n\t\tsave: function (id, column, node) {\r\n\t\t\tvar task = gantt.getTask(id);\r\n\r\n\t\t\tvar linksDiff = getLinksDiff(task, this.get_value(id, column, node), column.editor);\r\n\r\n\t\t\tif (linksDiff.add.length || linksDiff.remove.length) {\r\n\t\t\t\tgantt.batchUpdate(function () {\r\n\t\t\t\t\tlinksDiff.add.forEach(function (link) {\r\n\t\t\t\t\t\tgantt.addLink(link);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tlinksDiff.remove.forEach(function (linkId) {\r\n\t\t\t\t\t\tgantt.deleteLink(linkId);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (gantt.autoSchedule)\r\n\t\t\t\t\t\tgantt.autoSchedule();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\tis_changed: function (value, id, column, node) {\r\n\t\t\tvar inputPredecessors = this.get_value(id, column, node);\r\n\t\t\tvar taskPredecessors = parseInputString(formatPredecessors(value, column.editor, gantt), column.editor);\r\n\r\n\t\t\treturn inputPredecessors.join() !== taskPredecessors.join();\r\n\t\t}\r\n\t}, true);\r\n\r\n\treturn PredecessorEditor;\r\n};","import BaseFactory from \"./base\";\r\nimport * as utils from \"../../../../../utils/utils\";\r\nimport __extends from \"../../../../../utils/extends\";\r\n\r\n\r\nexport default function(gantt) {\r\n\r\n\tvar BaseEditor = BaseFactory(gantt);\r\n\r\n\tfunction TextEditor() {\r\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(TextEditor, BaseEditor);\r\n\r\n\tfunction getFormatter(config) {\r\n\t\treturn config.formatter || gantt.ext.formatters.durationFormatter();\r\n\t}\r\n\tutils.mixin(TextEditor.prototype, {\r\n\t\tshow: function (id, column, config, placeholder) {\r\n\t\t\tvar html = `<div role='cell'><input type='text' name='${column.name}' title='${column.name}'></div>`;\r\n\t\t\tplaceholder.innerHTML = html;\r\n\t\t},\r\n\t\tset_value: function (value, id, column, node) {\r\n\t\t\tthis.get_input(node).value = getFormatter(column.editor).format(value);\r\n\t\t},\r\n\t\tget_value: function (id, column, node) {\r\n\t\t\treturn getFormatter(column.editor).parse(this.get_input(node).value || \"\");\r\n\t\t}\r\n\t}, true);\r\n\r\n\treturn TextEditor;\r\n};","export default function (gantt) {\r\n\treturn function processTaskDateProperties(item, mapTo, mode) {\r\n\t\tif (mode == \"keepDates\") {\r\n\t\t\tkeepDatesOnEdit(item, mapTo);\r\n\t\t} else if (mode == \"keepDuration\") {\r\n\t\t\tkeepDurationOnEdit(item, mapTo);\r\n\t\t} else {\r\n\t\t\tdefaultActionOnEdit(item, mapTo);\r\n\t\t}\r\n\t};\r\n\r\n\t// resize task\r\n\t// resize task when start/end/duration changes\r\n\tfunction keepDatesOnEdit(item, mapTo) {\r\n\t\tif (mapTo == \"duration\") {\r\n\t\t\titem.end_date = gantt.calculateEndDate(item);\r\n\t\t} else if (mapTo == \"end_date\" || mapTo == \"start_date\") {\r\n\t\t\titem.duration = gantt.calculateDuration(item);\r\n\t\t}\r\n\t}\r\n\r\n\t// move task(before 6.2)\r\n\t// move task when start/end dates changes\r\n\t// resize task when duration changes\r\n\tfunction keepDurationOnEdit(item, mapTo) {\r\n\t\tif (mapTo == \"end_date\") {\r\n\t\t\titem.start_date = decreaseStartDate(item);\r\n\t\t} else if (mapTo == \"start_date\" || mapTo == \"duration\") {\r\n\t\t\titem.end_date = gantt.calculateEndDate(item);\r\n\t\t}\r\n\t}\r\n\r\n\t// default behavior\r\n\t// move task when start date changes\r\n\t// resize task when end date/duration changes\r\n\tfunction defaultActionOnEdit(item, mapTo) {\r\n\t\tif (gantt._getAutoSchedulingConfig().schedule_from_end){\r\n\t\t\tif (mapTo == \"end_date\" || mapTo == \"duration\") {\r\n\t\t\t\titem.start_date = decreaseStartDate(item);\r\n\t\t\t} else if (mapTo == \"start_date\") {\r\n\t\t\t\titem.duration = gantt.calculateDuration(item);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (mapTo == \"start_date\" || mapTo == \"duration\") {\r\n\t\t\t\titem.end_date = gantt.calculateEndDate(item);\r\n\t\t\t} else if (mapTo == \"end_date\") {\r\n\t\t\t\titem.duration = gantt.calculateDuration(item);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction decreaseStartDate(item){\r\n\t\treturn gantt.calculateEndDate({\r\n\t\t\tstart_date: item.end_date,\r\n\t\t\tduration: -item.duration,\r\n\t\t\ttask: item\r\n\t\t});\r\n\t}\r\n};","import getKeyboardMapping from \"./keyboard_mappings\";\r\nimport textEditorFactory from \"./editors/text\";\r\nimport numberEditorFactory from \"./editors/number\";\r\nimport selectEditorFactory from \"./editors/select\";\r\nimport dateEditorFactory from \"./editors/date\";\r\nimport predecessorEditorFactory from \"./editors/predecessor\";\r\nimport durationEditorFactory from \"./editors/duration\";\r\nimport * as utils from \"../../../../utils/utils\";\r\nimport * as domHelpers from \"../../utils/dom_helpers\";\r\nimport eventable from \"../../../../utils/eventable\";\r\nimport linkedPropertiesProcessor from \"./linked_properties\";\r\n\r\nfunction initConfigs(gantt){\r\n\tgantt.config.editor_types = {\r\n\t\ttext: new (textEditorFactory(gantt))(),\r\n\t\tnumber: new (numberEditorFactory(gantt))(),\r\n\t\tselect: new (selectEditorFactory(gantt))(),\r\n\t\tdate: new (dateEditorFactory(gantt))(),\r\n\t\tpredecessor: new (predecessorEditorFactory(gantt))(),\r\n\t\tduration: new (durationEditorFactory(gantt))()\r\n\t};\r\n}\r\n\r\nfunction create(gantt){\r\n\tvar keyboardMapping = getKeyboardMapping(gantt);\r\n\r\n\tvar eventBus = {};\r\n\teventable(eventBus);\r\n\r\n\tfunction createGridEditors(grid) {\r\n\r\n\t\tfunction _getGridCellFromNode(node){\r\n\t\t\tif(!domHelpers.isChildOf(node, grid.$grid)){\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tvar row = domHelpers.locateAttribute(node, grid.$config.item_attribute);\r\n\t\t\tvar cell = domHelpers.locateAttribute(node, \"data-column-name\");\r\n\t\t\tif(row && cell){\r\n\t\t\t\tvar columnName = cell.getAttribute(\"data-column-name\");\r\n\t\t\t\tvar id = row.getAttribute(grid.$config.item_attribute);\r\n\t\t\t\treturn {\r\n\t\t\t\t\tid: id,\r\n\t\t\t\t\tcolumnName: columnName\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\tfunction _getEditorPosition(itemId, columnName) {\r\n\t\t\tvar config = grid.$getConfig();\r\n\t\t\tvar top = grid.getItemTop(itemId);\r\n\t\t\tvar height = grid.getItemHeight(itemId);\r\n\t\t\tvar cols = grid.getGridColumns();\r\n\t\t\tvar left = 0,\r\n\t\t\t\tright = 0,\r\n\t\t\t\twidth = 0;\r\n\r\n\t\t\tfor (var i = 0; i < cols.length; i++) {\r\n\t\t\t\tif (cols[i].name == columnName) {\r\n\t\t\t\t\twidth = cols[i].width;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (config.rtl) {\r\n\t\t\t\t\tright += cols[i].width;\r\n\t\t\t\t}\telse {\r\n\t\t\t\t\tleft += cols[i].width;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\tif (config.rtl) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttop: top,\r\n\t\t\t\t\tright: right,\r\n\t\t\t\t\theight: height,\r\n\t\t\t\t\twidth: width\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttop: top,\r\n\t\t\t\t\tleft: left,\r\n\t\t\t\t\theight: height,\r\n\t\t\t\t\twidth: width\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction findVisibleIndex(grid, columnName) {\r\n\t\t\tvar columns = grid.getGridColumns();\r\n\t\t\tfor (var i = 0; i < columns.length; i++){\r\n\t\t\t\tif(columns[i].name == columnName){\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tfunction _createPlaceholder(itemId, columnName) {\r\n\t\t\tvar config = grid.$getConfig();\r\n\t\t\tvar pos = _getEditorPosition(itemId, columnName);\r\n\t\t\tvar el = document.createElement(\"div\");\r\n\t\t\tel.className = \"gantt_grid_editor_placeholder\";\r\n\t\t\tel.setAttribute(grid.$config.item_attribute, itemId);\r\n\t\t\tel.setAttribute(grid.$config.bind + \"_id\", itemId);// for backward compatibility\r\n\r\n\t\t\tel.setAttribute(\"data-column-name\", columnName);\r\n\r\n\t\t\tvar visibleIndex = findVisibleIndex(grid, columnName);\r\n\t\t\tel.setAttribute(\"data-column-index\", visibleIndex);\r\n\r\n\t\t\tgantt._waiAria.inlineEditorAttr(el);\r\n\r\n\t\t\tif (config.rtl) {\r\n\t\t\t\tel.style.cssText = [\r\n\t\t\t\t\t\"top:\" + pos.top + \"px\",\r\n\t\t\t\t\t\"right:\" + pos.right + \"px\",\r\n\t\t\t\t\t\"width:\" + pos.width + \"px\",\r\n\t\t\t\t\t\"height:\" + pos.height + \"px\"\r\n\t\t\t\t].join(\";\");\r\n\t\t\t} else {\r\n\t\t\t\tel.style.cssText = [\r\n\t\t\t\t\t\"top:\" + pos.top + \"px\",\r\n\t\t\t\t\t\"left:\" + pos.left + \"px\",\r\n\t\t\t\t\t\"width:\" + pos.width + \"px\",\r\n\t\t\t\t\t\"height:\" + pos.height + \"px\"\r\n\t\t\t\t].join(\";\");\r\n\t\t\t}\r\n\r\n\t\t\treturn el;\r\n\t\t}\r\n\r\n\t\tvar updateTaskDateProperties = linkedPropertiesProcessor(gantt);\r\n\r\n\t\tvar handlers = [];\r\n\t\tvar ganttHandlers = [];\r\n\t\tvar store = null;\r\n\t\tvar controller = {\r\n\t\t\t_itemId: null,\r\n\t\t\t_columnName: null,\r\n\t\t\t_editor: null,\r\n\t\t\t_editorType: null,\r\n\t\t\t_placeholder: null,\r\n\r\n\t\t\tlocateCell: _getGridCellFromNode,\r\n\t\t\tgetEditorConfig: function (columnName) {\r\n\t\t\t\tvar column = grid.getColumn(columnName);\r\n\t\t\t\tif(column){\r\n\t\t\t\t\treturn column.editor;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tinit: function () {\r\n\t\t\t\tvar mapping = keyboardMapping.getMapping();\r\n\t\t\t\tif(mapping.init){\r\n\t\t\t\t\tmapping.init(this, grid);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstore = grid.$gantt.getDatastore(grid.$config.bind);\r\n\t\t\t\tif (!store && gantt.$data.tempAssignmentsStore){\r\n\t\t\t\t\tstore = gantt.$data.tempAssignmentsStore;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar self = this;\r\n\r\n\t\t\t\thandlers.push(store.attachEvent(\"onIdChange\", function(oldId, newId){\r\n\t\t\t\t\tif(self._itemId == oldId){\r\n\t\t\t\t\t\tself._itemId = newId;\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\t\t\t\thandlers.push(store.attachEvent(\"onStoreUpdated\", function(){\r\n\t\t\t\t\tif(grid.$gantt.getState(\"batchUpdate\").batch_update){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(self.isVisible() && !store.isVisible(self._itemId)){\r\n\t\t\t\t\t\tself.hide();\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\r\n\t\t\t\tganttHandlers.push(gantt.attachEvent(\"onDataRender\", function(){\r\n\t\t\t\t\tif(self._editor && self._placeholder && !domHelpers.isChildOf(self._placeholder, gantt.$root)){\r\n\t\t\t\t\t\tgrid.$grid_data.appendChild(self._placeholder);\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\r\n\t\t\t\tthis.init = function(){};\r\n\t\t\t},\r\n\r\n\t\t\tgetState: function(){\r\n\t\t\t\treturn {\r\n\t\t\t\t\teditor: this._editor,\r\n\t\t\t\t\teditorType: this._editorType,\r\n\t\t\t\t\tplaceholder: this._placeholder,\r\n\t\t\t\t\tid: this._itemId,\r\n\t\t\t\t\tcolumnName: this._columnName\r\n\t\t\t\t};\r\n\t\t\t},\r\n\r\n\t\t\tstartEdit: function(itemId, columnName) {\r\n\t\t\t\tif (this.isVisible()) {\r\n\t\t\t\t\tthis.save();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!store.exists(itemId)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar editorState = {id: itemId, columnName: columnName};\r\n\t\t\t\tif (gantt.isReadonly(store.getItem(itemId))) {\r\n\t\t\t\t\tthis.callEvent(\"onEditPrevent\", [editorState]);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.callEvent(\"onBeforeEditStart\", [editorState]) === false) {\r\n\t\t\t\t\tthis.callEvent(\"onEditPrevent\", [editorState]);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst asyncShow = this.show(editorState.id, editorState.columnName);\r\n\t\t\t\tif(asyncShow && asyncShow.then){\r\n\t\t\t\t\tasyncShow.then(function(){\r\n\t\t\t\t\t\tthis.setValue();\r\n\r\n\t\t\t\t\t\tthis.callEvent(\"onEditStart\", [editorState]);\r\n\t\t\t\t\t}.bind(this));\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.setValue();\r\n\t\t\t\t\tthis.callEvent(\"onEditStart\", [editorState]);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tisVisible: function(){\r\n\t\t\t\tif(gantt._lightbox_id){\r\n\t\t\t\t\treturn !!(this._editor && domHelpers.isChildOf(this._placeholder, gantt._lightbox));\r\n\t\t\t\t}\r\n\t\t\t\treturn !!(this._editor && domHelpers.isChildOf(this._placeholder, gantt.$root));\r\n\t\t\t},\r\n\t\t\tshow: function (itemId, columnName) {\r\n\t\t\t\tif (this.isVisible()) {\r\n\t\t\t\t\tthis.save();\r\n\t\t\t\t}\r\n\t\t\t\tvar editorState = {id: itemId, columnName: columnName};\r\n\r\n\t\t\t\tvar column = grid.getColumn(editorState.columnName);\r\n\t\t\t\tvar editorConfig = this.getEditorConfig(column.name);\r\n\t\t\t\tif(!editorConfig)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tvar editor = grid.$getConfig().editor_types[editorConfig.type];\r\n\r\n\t\t\t\tvar placeholder = _createPlaceholder(editorState.id, editorState.columnName);\r\n\t\t\t\tgrid.$grid_data.appendChild(placeholder);\r\n\r\n\t\t\t\tconst onAfterShow = (function(){\r\n\t\t\t\t\tthis._editor = editor;\r\n\t\t\t\t\tthis._placeholder = placeholder;\r\n\t\t\t\t\tthis._itemId = editorState.id;\r\n\t\t\t\t\tthis._columnName = editorState.columnName;\r\n\t\t\t\t\tthis._editorType = editorConfig.type;\r\n\r\n\t\t\t\t\tvar mapping = keyboardMapping.getMapping();\r\n\t\t\t\t\tif(mapping.onShow){\r\n\t\t\t\t\t\tmapping.onShow(this, placeholder, grid);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tplaceholder._onReMount = (function(){\r\n\t\t\t\t\t\tthis.setValue();\r\n\t\t\t\t\t}).bind(this);\r\n\t\t\t\t}).bind(this);\r\n\r\n\t\t\t\tconst editorResult = editor.show(editorState.id, column, editorConfig, placeholder);\r\n\t\t\t\tif(editorResult && editorResult.then){\r\n\t\t\t\t\treturn editorResult.then(() => {\r\n\t\t\t\t\t\tonAfterShow();\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\tonAfterShow();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tsetValue: function () {\r\n\t\t\t\tvar state = this.getState();\r\n\t\t\t\tvar itemId = state.id,\r\n\t\t\t\t\tcolumnName = state.columnName;\r\n\r\n\t\t\t\tvar column = grid.getColumn(columnName);\r\n\t\t\t\tvar item = store.getItem(itemId);\r\n\t\t\t\tvar editorConfig = this.getEditorConfig(columnName);\r\n\t\t\t\tvar value;\r\n\t\t\t\tif(!editorConfig)\r\n\t\t\t\t\treturn;\r\n\t\t\t\t// GS-2598: case for the editors in the lightbox\r\n\t\t\t\tif (gantt._lightbox_id) {\r\n\t\t\t\t\tlet assignment = store.getItem(this._itemId);\r\n\r\n\t\t\t\t\tif (editorConfig.map_to === \"text\") {\r\n\t\t\t\t\t\tlet resource = gantt.getDatastore(gantt.config.resource_store).getItem(assignment.resource_id);\r\n\t\t\t\t\t\tvalue = resource.text;\r\n\t\t\t\t\t} else if (editorConfig.map_to === \"start_date\") {\r\n\t\t\t\t\t\tvalue = (item.start_date === \"\" || item.start_date === null)\r\n\t\t\t\t\t\t\t? gantt.getTask(gantt._lightbox_id).start_date\r\n\t\t\t\t\t\t\t: item.start_date;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvalue = item[editorConfig.map_to];\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue = item[editorConfig.map_to];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (editorConfig.map_to === \"auto\") {\r\n\t\t\t\t\tvalue = store.getItem(itemId);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._editor.set_value(value, itemId, column, this._placeholder);\r\n\t\t\t\tthis.focus();\r\n\t\t\t},\r\n\r\n\t\t\tfocus: function(){\r\n\t\t\t\tthis._editor.focus(this._placeholder);\r\n\t\t\t},\r\n\r\n\t\t\tgetValue: function () {\r\n\t\t\t\tvar column = grid.getColumn(this._columnName);\r\n\t\t\t\treturn this._editor.get_value(this._itemId, column, this._placeholder);\r\n\t\t\t},\r\n\r\n\t\t\t_getItemValue: function() {\r\n\t\t\t\tvar editorConfig = this.getEditorConfig(this._columnName);\r\n\r\n\t\t\t\tif(!editorConfig)\r\n\t\t\t\t\treturn;\r\n\t\t\t\tvar value;\r\n\t\t\t\t// GS-2598: case for the editors in the lightbox\r\n\t\t\t\tif(gantt._lightbox_id){\r\n\t\t\t\t\tlet assignment = store.getItem(this._itemId);\r\n\t\t\t\t\tif (editorConfig.type === \"select\" && editorConfig.map_to !== \"mode\") {\r\n\t\t\t\t\t\tlet resource = gantt.getDatastore(gantt.config.resource_store).getItem(assignment.resource_id);\r\n\t\t\t\t\t\tvalue = resource.id;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvalue = assignment[editorConfig.map_to];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar item = gantt.getTask(this._itemId);\r\n\t\t\t\t\tvalue = item[editorConfig.map_to];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(editorConfig.map_to == \"auto\"){\r\n\t\t\t\t\tvalue = store.getItem(this._itemId);\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t},\r\n\r\n\t\t\tisChanged: function(){\r\n\r\n\t\t\t\tvar column = grid.getColumn(this._columnName);\r\n\r\n\t\t\t\tvar value = this._getItemValue();\r\n\r\n\t\t\t\treturn this._editor.is_changed(value, this._itemId, column, this._placeholder);\r\n\t\t\t},\r\n\r\n\t\t\thide: function () {\r\n\t\t\t\tif(!this._itemId)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tvar itemId = this._itemId,\r\n\t\t\t\t\tcolumnName = this._columnName;\r\n\r\n\t\t\t\tvar mapping = keyboardMapping.getMapping();\r\n\t\t\t\tif(mapping.onHide){\r\n\t\t\t\t\tmapping.onHide(this, this._placeholder, grid);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._itemId = null;\r\n\t\t\t\tthis._columnName = null;\r\n\t\t\t\tthis._editorType = null;\r\n\t\t\t\tif (!this._placeholder) return;\r\n\r\n\t\t\t\tif (this._editor && this._editor.hide) {\r\n\t\t\t\t\tthis._editor.hide(this._placeholder);\r\n\t\t\t\t}\r\n\t\t\t\tthis._editor = null;\r\n\t\t\t\tif (this._placeholder.parentNode) {\r\n\t\t\t\t\tthis._placeholder.parentNode.removeChild(this._placeholder);\r\n\t\t\t\t}\r\n\t\t\t\tthis._placeholder = null;\r\n\r\n\t\t\t\tthis.callEvent(\"onEditEnd\", [{id: itemId, columnName: columnName}]);\r\n\t\t\t},\r\n\t\t\tsave: function () {\r\n\t\t\t\tif(!(this.isVisible() && store.exists(this._itemId) && this.isChanged())) {\r\n\t\t\t\t\tthis.hide();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar itemId = this._itemId,\r\n\t\t\t\t\tcolumnName = this._columnName;\r\n\r\n\t\t\t\tif(!store.exists(itemId)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar item = store.getItem(itemId);\r\n\t\t\t\tvar editorConfig = this.getEditorConfig(columnName);\r\n\t\t\t\tvar editorState = {\r\n\t\t\t\t\tid: itemId,\r\n\t\t\t\t\tcolumnName: columnName,\r\n\t\t\t\t\tnewValue: this.getValue(),\r\n\t\t\t\t\toldValue: this._getItemValue()\r\n\t\t\t\t};\r\n\t\t\t\tif (this.callEvent(\"onBeforeSave\", [editorState]) !== false) {\r\n\t\t\t\t\tif (!this._editor.is_valid || this._editor.is_valid(editorState.newValue, editorState.id, grid.getColumn(columnName), this._placeholder)) {\r\n\t\t\t\t\t\t// GS-2598: set the initial value to the editor\r\n\t\t\t\t\t\tif(gantt._lightbox_id){\r\n\t\t\t\t\t\t\tif (editorState.newValue == \"\"){\r\n\t\t\t\t\t\t\t\teditorState.newValue = editorState.oldValue;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar mapTo = editorConfig.map_to;\r\n\t\t\t\t\t\tvar value = editorState.newValue;\r\n\t\t\t\t\t\tif (mapTo != \"auto\") {\r\n\t\t\t\t\t\t\titem[mapTo] = value;\r\n\t\t\t\t\t\t\tupdateTaskDateProperties(item, mapTo, gantt.config.inline_editors_date_processing);\r\n\r\n\t\t\t\t\t\t\tstore.updateItem(itemId);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._editor.save(itemId, grid.getColumn(columnName), this._placeholder);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.callEvent(\"onSave\", [editorState]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// GS-2598: don't close editor when we working in the lightbox\r\n\t\t\t\tif(!gantt._lightbox_id){\r\n\t\t\t\t\tthis.hide();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t_findEditableCell: function findEditableCell(start, direction){\r\n\t\t\t\tvar nextIndex = start;\r\n\t\t\t\tvar columns = grid.getGridColumns();\r\n\t\t\t\tvar nextColumn = columns[nextIndex];\r\n\r\n\t\t\t\tvar columnName = nextColumn ? nextColumn.name : null;\r\n\t\t\t\tif(columnName){\r\n\t\t\t\t\twhile(columnName && !this.getEditorConfig(columnName)){\r\n\t\t\t\t\t\tcolumnName = this._findEditableCell(start + direction, direction);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn columnName;\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t},\r\n\r\n\t\t\tgetNextCell: function moveCell(dir){\r\n\t\t\t\t// GS-1257. true means to exclude hidden columns\r\n\t\t\t\treturn this._findEditableCell(grid.getColumnIndex(this._columnName, true) + dir, dir);\r\n\t\t\t},\r\n\r\n\t\t\tgetFirstCell: function getFirstCell(){\r\n\t\t\t\treturn this._findEditableCell(0, 1);\r\n\t\t\t},\r\n\r\n\t\t\tgetLastCell: function getLastCell(){\r\n\t\t\t\treturn this._findEditableCell(grid.getGridColumns().length - 1, -1);\r\n\t\t\t},\r\n\r\n\t\t\teditNextCell: function nextCell(canChangeRow){\r\n\t\t\t\tvar cell = this.getNextCell(1);\r\n\t\t\t\tif(cell){\r\n\t\t\t\t\tvar nextColumn = this.getNextCell(1);\r\n\t\t\t\t\tif(nextColumn && this.getEditorConfig(nextColumn)){\r\n\t\t\t\t\t\tthis.startEdit(this._itemId, nextColumn);\r\n\t\t\t\t\t}\r\n\t\t\t\t}else if(canChangeRow && this.moveRow(1)){\r\n\t\t\t\t\tvar task = this.moveRow(1);\r\n\t\t\t\t\tcell = this.getFirstCell();\r\n\t\t\t\t\tif(cell && this.getEditorConfig(cell)){\r\n\t\t\t\t\t\tthis.startEdit(task, cell);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\teditPrevCell: function prevCell(canChangeRow){\r\n\t\t\t\tvar cell = this.getNextCell(-1);\r\n\t\t\t\tif(cell){\r\n\t\t\t\t\tvar nextColumn = this.getNextCell(-1);\r\n\t\t\t\t\tif(nextColumn && this.getEditorConfig(nextColumn)){\r\n\t\t\t\t\t\tthis.startEdit(this._itemId, nextColumn);\r\n\t\t\t\t\t}\r\n\t\t\t\t}else if(canChangeRow && this.moveRow(-1)){\r\n\t\t\t\t\tvar task = this.moveRow(-1);\r\n\t\t\t\t\tcell = this.getLastCell();\r\n\t\t\t\t\tif(cell && this.getEditorConfig(cell)){\r\n\t\t\t\t\t\tthis.startEdit(task, cell);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tmoveRow: function moveRow(dir) {\r\n\t\t\t\tvar moveTask = dir > 0 ? gantt.getNext : gantt.getPrev;\r\n\t\t\t\tmoveTask = gantt.bind(moveTask, gantt);\r\n\r\n\t\t\t\tvar nextItem = moveTask(this._itemId);\r\n\t\t\t\t// skip readonly rows\r\n\t\t\t\twhile (gantt.isTaskExists(nextItem) && gantt.isReadonly(gantt.getTask(nextItem))) {\r\n\t\t\t\t\tnextItem = moveTask(nextItem);\r\n\t\t\t\t}\r\n\t\t\t\treturn nextItem;\r\n\t\t\t},\r\n\r\n\t\t\teditNextRow: function nextRow(skipReadonly){\r\n\t\t\t\tvar id = this.getState().id;\r\n\t\t\t\tif (!gantt.isTaskExists(id)) return;\r\n\r\n\t\t\t\tvar next = null;\r\n\t\t\t\tif (skipReadonly){\r\n\t\t\t\t\tnext = this.moveRow(1);\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tnext = gantt.getNext(id);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (gantt.isTaskExists(next)){\r\n\t\t\t\t\tthis.startEdit(next, this._columnName);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\teditPrevRow: function prevRow(skipReadonly){\r\n\t\t\t\tvar id = this.getState().id;\r\n\t\t\t\tif (!gantt.isTaskExists(id)) return;\r\n\r\n\t\t\t\tvar prev = null;\r\n\t\t\t\tif (skipReadonly){\r\n\t\t\t\t\tprev = this.moveRow(-1);\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tprev = gantt.getPrev(id);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (gantt.isTaskExists(prev)){\r\n\t\t\t\t\tthis.startEdit(prev, this._columnName);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdetachStore: function(){\r\n\t\t\t\thandlers.forEach(function(handlerId){\r\n\t\t\t\t\tstore.detachEvent(handlerId);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tganttHandlers.forEach(function(handlerId){\r\n\t\t\t\t\tgantt.detachEvent(handlerId);\r\n\t\t\t\t});\r\n\t\t\t\thandlers = [];\r\n\t\t\t\tganttHandlers = [];\r\n\r\n\t\t\t\tstore = null;\r\n\t\t\t\tthis.hide();\r\n\t\t\t},\r\n\t\t\tdestructor: function(){\r\n\t\t\t\tthis.detachStore();\r\n\t\t\t\tthis.detachAllEvents();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tutils.mixin(controller, keyboardMapping);\r\n\t\tutils.mixin(controller, eventBus);\r\n\r\n\t\treturn controller;\r\n\t}\r\n\r\n\r\n\tvar inlineEditController = {\r\n\t\tinit: initConfigs,\r\n\t\tcreateEditors: createGridEditors\r\n\t};\r\n\r\n\tutils.mixin(inlineEditController, keyboardMapping);\r\n\tutils.mixin(inlineEditController, eventBus);\r\n\r\n\treturn inlineEditController;\r\n}\r\n\r\n\r\n\r\n\r\nexport default create;","import defaultMapping from \"./keyboard_mappings/default\";\r\nimport keyNavMappings from \"./keyboard_mappings/keyboard_navigation\";\r\n\r\nexport default function(gantt){\r\n\r\n\tvar mapping = null;\r\n\r\n\treturn {\r\n\t\tsetMapping: function(map){\r\n\t\t\tmapping = map;\r\n\t\t},\r\n\t\tgetMapping: function(){\r\n\r\n\t\t\tif(mapping){\r\n\t\t\t\treturn mapping;\r\n\t\t\t}else if(gantt.config.keyboard_navigation_cells && gantt.ext.keyboardNavigation){\r\n\t\t\t\treturn keyNavMappings;\r\n\t\t\t}else{\r\n\t\t\t\treturn defaultMapping;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n};\r\n","// optimized checker for task bars smart rendering\r\n\r\n// first check the vertical position since it's easier to calculate\r\nexport default function isBarInViewport(item, viewport, view, config, gantt){\r\n\tif(!item.start_date || !item.end_date){\r\n\t\treturn null;\r\n\t}\r\n\r\n\tvar top = view.getItemTop(item.id);\r\n\tvar height = view.getItemHeight(item.id);\r\n\r\n\tif(top > viewport.y_end || top + height < viewport.y){\r\n\t\treturn false;\r\n\t}\r\n\r\n\tvar padding = 200;\r\n\tvar startCoord = view.posFromDate(item.start_date, view._getPositioningContext ? view._getPositioningContext(item) : null);\r\n\tvar endCoord = view.posFromDate(item.end_date, view._getPositioningContext ? view._getPositioningContext(item) : null);\r\n\tvar left = Math.min(startCoord, endCoord) - padding;\r\n\tvar right = Math.max(startCoord, endCoord) + padding;\r\n\r\n\tif(left > viewport.x_end || right < viewport.x){\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn true;\r\n};","function createTaskRenderer(gantt) {\r\n\r\n\tfunction _render_task_element(task, view, config) {\r\n\t\tvar config = view.$getConfig();\r\n\t\tvar painters = config.type_renderers;\r\n\t\tvar renderer = painters[gantt.getTaskType(task.type)],\r\n\t\t\tdefaultRenderer = _task_default_render;\r\n\r\n\t\tif (!renderer) {\r\n\t\t\treturn defaultRenderer.call(gantt, task, view, config);\r\n\t\t}else{\r\n\t\t\treturn renderer.call(gantt, task, function(task){ return defaultRenderer.call(gantt, task, view, config);}, view);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _task_default_render(task, view, config) {\r\n\t\tif (gantt._isAllowedUnscheduledTask(task))\r\n\t\t\treturn;\r\n\r\n\t\tif (!gantt._isTaskInTimelineLimits(task)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar pos = view.getItemPosition(task);\r\n\r\n\t\tvar cfg = config,\r\n\t\t\ttemplates = view.$getTemplates();\r\n\r\n\t\tvar taskType = gantt.getTaskType(task.type);\r\n\t\tvar height = view.getBarHeight(task.id, taskType == cfg.types.milestone);\r\n\r\n\t\tvar controlsMargin = 0;\r\n\t\tif (taskType == cfg.types.milestone) {\r\n\t\t\tcontrolsMargin = (height - pos.height)/2;\r\n\t\t}\r\n\r\n\t\tvar padd = Math.floor((view.getItemHeight(task.id) - height) / 2);\r\n\t\tconst hasBaselines = gantt.config.baselines && task.baselines && task.baselines.length;\r\n\t\tconst baselinesOnDifferentRow = gantt.config.baselines && (gantt.config.baselines.render_mode == \"separateRow\" || gantt.config.baselines.render_mode == \"individualRow\");\r\n\t\tif (hasBaselines && baselinesOnDifferentRow){\r\n\t\t\tif (task.bar_height !== \"full\" && task.bar_height < task.row_height){\r\n\t\t\t\tif (taskType === cfg.types.milestone){\r\n\t\t\t\t\tlet milestoneHeight = view.getBarHeight(task.id, true);\r\n\t\t\t\t\tlet milestoneWidth = Math.sqrt(2 * milestoneHeight * milestoneHeight);\r\n\t\t\t\t\tpadd = Math.floor((milestoneWidth - height) / 2) + 2;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpadd = 2;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t//\tif(task.type == cfg.types.milestone){\r\n\t//\t\tpadd -= 1;\r\n\t//\t}\r\n\t//\tif (taskType == cfg.types.milestone && cfg.link_line_width > 1) {\r\n\t//\t\t//little adjust milestone position, so horisontal corners would match link arrow when thickness of link line is more than 1px\r\n\t//\t\tpadd += 1;\r\n\t//\t}\r\n\r\n\t\tif (taskType == cfg.types.milestone) {\r\n\t\t\tpos.left -= Math.round(height / 2);\r\n\t\t\tpos.width = height;\r\n\t\t}\r\n\r\n\t\tvar div = document.createElement(\"div\");\r\n\r\n\t\tvar width = Math.round(pos.width);\r\n\r\n\t\tif(view.$config.item_attribute) {\r\n\t\t\tdiv.setAttribute(view.$config.item_attribute, task.id);\r\n\t\t\tdiv.setAttribute(view.$config.bind + \"_id\", task.id); // 'task_id'/'resource_id' for backward compatibility\r\n\t\t}\r\n\r\n\t\tif (cfg.show_progress && taskType != cfg.types.milestone) {\r\n\t\t\t_render_task_progress(task, div, width, cfg, templates);\r\n\t\t}\r\n\r\n\t\t//use separate div to display content above progress bar\r\n\t\tvar content = _render_task_content(task, width, templates);\r\n\r\n\t\tdiv.appendChild(content);\r\n\r\n\t\tvar css = _combine_item_class(\"gantt_task_line\",\r\n\t\t\ttemplates.task_class(task.start_date, task.end_date, task),\r\n\t\t\ttask.id,\r\n\t\t\tview);\r\n\t\tif (task.color || task.progressColor || task.textColor) {\r\n\t\t\tcss += \" gantt_task_inline_color\";\r\n\t\t}\r\n\t\tif (pos.width < 20){\r\n\t\t\tcss += \" gantt_thin_task\";\r\n\t\t}\r\n\t\tdiv.className = css;\r\n\r\n\t\tvar styles = [\r\n\t\t\t\"left:\" + pos.left + \"px\",\r\n\t\t\t\"top:\" + (padd + pos.top) + 'px',\r\n\t\t\t\"height:\" + (height) + 'px',\r\n\t\t\t\"line-height:\" + (Math.max(height < 30 ? height - 2 : height, 0)) + 'px',\r\n\t\t\t\"width:\" + width + 'px'\r\n\t\t];\r\n\r\n\t\tdiv.style.cssText = styles.join(\";\");\r\n\t\tif (task.color) {\r\n\t\t\tdiv.style.setProperty(\"--dhx-gantt-task-background\", task.color);\r\n\t\t}\r\n\t\tif (task.textColor) {\r\n\t\t\tdiv.style.setProperty(\"--dhx-gantt-task-color\", task.textColor);\r\n\t\t}\r\n\r\n\t\tif (task.progressColor) {\r\n\t\t\tdiv.style.setProperty(\"--dhx-gantt-task-progress-color\", task.progressColor);\r\n\t\t}\r\n\r\n\t\t\r\n\t\tvar side = _render_leftside_content(task, cfg, templates, controlsMargin);\r\n\t\tif (side) div.appendChild(side);\r\n\r\n\t\tside = _render_rightside_content(task, cfg, templates, controlsMargin);\r\n\t\tif (side) div.appendChild(side);\r\n\r\n\t\tgantt._waiAria.setTaskBarAttr(task, div);\r\n\r\n\t\tvar state = gantt.getState();\r\n\t\tconst taskEditable = !gantt.isReadonly(task);\r\n\t\tconst timelineDrag = gantt.ext.dragTimeline && gantt.ext.dragTimeline._isDragInProgress();\r\n\r\n\t\tif (taskEditable || timelineDrag) {\r\n\t\t\tif (cfg.drag_resize && !gantt.isSummaryTask(task) && taskType != cfg.types.milestone) {\r\n\t\t\t\t_render_pair(div, \"gantt_task_drag\", task, function (css) {\r\n\t\t\t\t\tvar el = document.createElement(\"div\");\r\n\t\t\t\t\tel.className = css;\r\n\t\t\t\t\treturn el;\r\n\t\t\t\t}, cfg);\r\n\t\t\t}\r\n\t\t\tif (cfg.drag_links && cfg.show_links) {\r\n\t\t\t\t_render_pair(div, \"gantt_link_control\", task, function (css) {\r\n\t\t\t\t\tvar outer = document.createElement(\"div\");\r\n\t\t\t\t\touter.className = css;\r\n\t\t\t\t\touter.style.cssText = [\r\n\t\t\t\t\t\t\"height:\" + height + 'px',\r\n\t\t\t\t\t\t\"line-height:\" + height + 'px'\r\n\t\t\t\t\t].join(\";\");\r\n\t\t\t\t\tvar inner = document.createElement(\"div\");\r\n\t\t\t\t\tinner.className = \"gantt_link_point\";\r\n\r\n\t\t\t\t\tvar showLinkPoints = false;\r\n\t\t\t\t\tif(state.link_source_id && cfg.touch){\r\n\t\t\t\t\t\tshowLinkPoints = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tinner.style.display = showLinkPoints ? \"block\" : \"\";\r\n\t\t\t\t\touter.appendChild(inner);\r\n\t\t\t\t\treturn outer;\r\n\t\t\t\t}, cfg, controlsMargin);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn div;\r\n\t}\r\n\r\n\tfunction _render_side_content(task, template, cssClass, marginStyle) {\r\n\t\tif (!template) return null;\r\n\r\n\t\tvar text = template(task.start_date, task.end_date, task);\r\n\t\tif (!text) return null;\r\n\t\tvar content = document.createElement(\"div\");\r\n\t\tcontent.className = \"gantt_side_content \" + cssClass;\r\n\t\tcontent.innerHTML = text;\r\n\t\tif(marginStyle){\r\n\t\t\tcontent.style[marginStyle.type] = Math.abs(marginStyle.value) + \"px\";\r\n\t\t}\r\n\t\treturn content;\r\n\t}\r\n\r\n\tfunction _render_leftside_content(task, cfg, templates, margin) {\r\n\t\tvar css = \"gantt_left \" + _get_link_crossing_css(!cfg.rtl ? true : false, task, cfg);\r\n\t\tvar marginStyle = null;\r\n\t\tif(margin){\r\n\t\t\tmarginStyle = { type: \"marginRight\", value: margin };\r\n\t\t}\r\n\t\treturn _render_side_content(task, templates.leftside_text, css, marginStyle);\r\n\t}\r\n\r\n\tfunction _render_rightside_content(task, cfg, templates, margin) {\r\n\t\tvar css = \"gantt_right \" + _get_link_crossing_css(!cfg.rtl ? false : true, task, cfg);\r\n\t\tvar marginStyle = null;\r\n\t\tif(margin){\r\n\t\t\tmarginStyle = { type: \"marginLeft\", value: margin };\r\n\t\t}\r\n\t\treturn _render_side_content(task, templates.rightside_text, css, marginStyle);\r\n\t}\r\n\r\n\tfunction _get_link_crossing_css(left, task) {\r\n\t\tvar cond = _get_conditions(left);\r\n\r\n\t\tfor (var i in cond) {\r\n\t\t\tvar links = task[i];\r\n\t\t\tfor (var ln = 0; ln < links.length; ln++) {\r\n\t\t\t\tvar link = gantt.getLink(links[ln]);\r\n\r\n\t\t\t\tfor (var tp = 0; tp < cond[i].length; tp++) {\r\n\t\t\t\t\tif (link.type == cond[i][tp]) {\r\n\t\t\t\t\t\treturn \"gantt_link_crossing\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\r\n\tfunction _render_task_content(task, width, templates) {\r\n\t\tvar content = document.createElement(\"div\");\r\n\t\tif (gantt.getTaskType(task.type) != gantt.config.types.milestone){\r\n\t\t\tcontent.innerHTML = templates.task_text(task.start_date, task.end_date, task);\r\n\t\t} else if(gantt.getTaskType(task.type) == gantt.config.types.milestone && width) {\r\n\t\t\tcontent.style.height = content.style.width = width + \"px\";\r\n\t\t}\r\n\t\tcontent.className = \"gantt_task_content\";\r\n\t\t//content.style.width = width + 'px';\r\n\t\treturn content;\r\n\t}\r\n\r\n\tfunction _render_task_progress(task, element, maxWidth, cfg, templates) {\r\n\t\tvar done = task.progress * 1 || 0;\r\n\t\t//GS-2776: borders were removed in v9.0\r\n\t\tmaxWidth = Math.max(maxWidth, 0);\r\n\t\tvar pr = document.createElement(\"div\");\r\n\t\tvar width = Math.round(maxWidth * done);\r\n\r\n\t\twidth = Math.min(maxWidth, width);\r\n\r\n\t\tpr.style.width = width + 'px';\r\n\t\tpr.className = \"gantt_task_progress\";\r\n\t\tpr.innerHTML = templates.progress_text(task.start_date, task.end_date, task);\r\n\r\n\t\tif(cfg.rtl){\r\n\t\t\tpr.style.position = \"absolute\";\r\n\t\t\tpr.style.right = \"0px\";\r\n\t\t}\r\n\r\n\t\tvar wrapper = document.createElement(\"div\");\r\n\t\twrapper.className = \"gantt_task_progress_wrapper\";\r\n\t\twrapper.appendChild(pr);\r\n\t\telement.appendChild(wrapper);\r\n\r\n\t\tconst taskEditable = !gantt.isReadonly(task);\r\n\t\tconst timelineDrag = gantt.ext.dragTimeline && gantt.ext.dragTimeline._isDragInProgress();\r\n\r\n\t\tif (gantt.config.drag_progress && (taskEditable || timelineDrag)) {\r\n\t\t\tvar drag = document.createElement(\"div\");\r\n\r\n\t\t\tvar markerPos = width;\r\n\t\t\tif(cfg.rtl){\r\n\t\t\t\tmarkerPos = maxWidth - width;\r\n\t\t\t}\r\n\r\n\t\t\tdrag.style.left = markerPos + 'px';\r\n\t\t\tdrag.className = \"gantt_task_progress_drag\";\r\n\t\t\tdrag.innerHTML = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"9\" viewBox=\"0 0 12 9\" fill=\"none\">\r\n<path d=\"M5.58397 1.52543C5.78189 1.22856 6.21811 1.22856 6.41602 1.52543L10.5475 7.72265C10.769 8.05493 10.5308 8.5 10.1315 8.5L1.86852 8.5C1.46917 8.5 1.23097 8.05493 1.45249 7.72265L5.58397 1.52543Z\" fill=\"var(--dhx-gantt-progress-handle-background)\" stroke=\"var(--dhx-gantt-progress-handle-border)\"/>\r\n</svg>`;\r\n\t\t\tpr.appendChild(drag);\r\n\t\t\telement.appendChild(drag);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _get_conditions(leftside) {\r\n\t\tif (leftside) {\r\n\t\t\treturn {\r\n\t\t\t\t$source: [\r\n\t\t\t\t\tgantt.config.links.start_to_start\r\n\t\t\t\t],\r\n\t\t\t\t$target: [\r\n\t\t\t\t\tgantt.config.links.start_to_start,\r\n\t\t\t\t\tgantt.config.links.finish_to_start\r\n\t\t\t\t]\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\treturn {\r\n\t\t\t\t$source: [\r\n\t\t\t\t\tgantt.config.links.finish_to_start,\r\n\t\t\t\t\tgantt.config.links.finish_to_finish\r\n\t\t\t\t],\r\n\t\t\t\t$target: [\r\n\t\t\t\t\tgantt.config.links.finish_to_finish\r\n\t\t\t\t]\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _combine_item_class(basic, template, itemId, view) {\r\n\t\tvar cfg = view.$getConfig();\r\n\t\tvar css = [basic];\r\n\t\tif (template)\r\n\t\t\tcss.push(template);\r\n\r\n\t\tvar state = gantt.getState();\r\n\r\n\t\tvar task = gantt.getTask(itemId);\r\n\r\n\t\tif (gantt.getTaskType(task.type) == cfg.types.milestone) {\r\n\t\t\tcss.push(\"gantt_milestone\");\r\n\t\t}else if (gantt.getTaskType(task.type) == cfg.types.project) {\r\n\t\t\tcss.push(\"gantt_project\");\r\n\t\t}\r\n\r\n\t\tcss.push(\"gantt_bar_\" + gantt.getTaskType(task.type));\r\n\r\n\r\n\t\tif (gantt.isSummaryTask(task))\r\n\t\t\tcss.push(\"gantt_dependent_task\");\r\n\r\n\t\tif (gantt.isSplitTask(task) && ((task.$inlineSplit && task.$inlineSplit.length) || ((cfg.open_split_tasks && !task.$open && (task.$inlineSplit && task.$inlineSplit.length)) || !cfg.open_split_tasks))) {\r\n\t\t\tcss.push(\"gantt_split_parent\");\r\n\t\t}\r\n\r\n\t\tif (cfg.select_task && gantt.isSelectedTask(itemId)) {\r\n\t\t\tcss.push(\"gantt_selected\");\r\n\t\t}\r\n\r\n\t\tif (itemId == state.drag_id) {\r\n\t\t\tcss.push(\"gantt_drag_\" + state.drag_mode);\r\n\t\t\tif (state.touch_drag) {\r\n\t\t\t\tcss.push(\"gantt_touch_\" + state.drag_mode);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (state.link_source_id == itemId){\r\n\t\t\tcss.push(\"gantt_link_source\");\r\n\t\t\tif(state.link_from_start) {\r\n\t\t\t\tcss.push(\"gantt_link_from_start\");\r\n\t\t\t}else{\r\n\t\t\t\tcss.push(\"gantt_link_from_end\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (state.link_target_id == itemId)\r\n\t\t\tcss.push(\"gantt_link_target\");\r\n\r\n\r\n\t\tif (cfg.highlight_critical_path && gantt.isCriticalTask) {\r\n\t\t\tif (gantt.isCriticalTask(task))\r\n\t\t\t\tcss.push(\"gantt_critical_task\");\r\n\t\t}\r\n\r\n\t\tif (state.link_landing_area &&\r\n\t\t\t(state.link_target_id && state.link_source_id) &&\r\n\t\t\t(state.link_target_id != state.link_source_id) &&\r\n\t\t\t(state.link_target_id == itemId || state.link_source_id == itemId)) {\r\n\r\n\t\t\tvar from_id = state.link_source_id;\r\n\t\t\tvar from_start = state.link_from_start;\r\n\t\t\tvar to_start = state.link_to_start;\r\n\r\n\t\t\tvar allowDrag = gantt.isLinkAllowed(from_id, itemId, from_start, to_start);\r\n\r\n\t\t\tvar dragClass = \"\";\r\n\t\t\tif (allowDrag) {\r\n\t\t\t\tif (to_start)\r\n\t\t\t\t\tdragClass = \"link_start_allow\";\r\n\t\t\t\telse\r\n\t\t\t\t\tdragClass = \"link_finish_allow\";\r\n\t\t\t} else {\r\n\t\t\t\tif (to_start)\r\n\t\t\t\t\tdragClass = \"link_start_deny\";\r\n\t\t\t\telse\r\n\t\t\t\t\tdragClass = \"link_finish_deny\";\r\n\t\t\t}\r\n\t\t\tcss.push(dragClass);\r\n\t\t}\r\n\t\treturn css.join(\" \");\r\n\t}\r\n\r\n\tfunction _render_pair(parent, css, task, content, config, margin) {\r\n\t\tvar state = gantt.getState();\r\n\t\tvar className, element;\r\n\t\tif (+task.start_date >= +state.min_date) {\r\n\t\t\tclassName = [css, config.rtl ? \"task_right\" : \"task_left\", \"task_start_date\"];\r\n\t\t\telement = content(className.join(\" \"));\r\n\t\t\telement.setAttribute(\"data-bind-property\", \"start_date\");\r\n\t\t\tif(margin){\r\n\t\t\t\telement.style.marginLeft = margin + \"px\";\r\n\t\t\t}\r\n\t\t\tparent.appendChild(element);\r\n\t\t}\r\n\r\n\t\tif (+task.end_date <= +state.max_date){\r\n\t\t\tclassName = [css, config.rtl ? \"task_left\" : \"task_right\", \"task_end_date\"];\r\n\t\t\telement = content(className.join(\" \"));\r\n\t\t\telement.setAttribute(\"data-bind-property\", \"end_date\");\r\n\t\t\tif(margin){\r\n\t\t\t\telement.style.marginRight = margin + \"px\";\r\n\t\t\t}\r\n\t\t\tparent.appendChild(element);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn _render_task_element;\r\n}\r\n\r\nexport default createTaskRenderer;","import isInViewPort from \"./viewport/is_bar_in_viewport\";\r\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\r\nimport createBaseBarRender from \"./task_bar_render\";\r\n\r\nexport default function createTaskRenderer(gantt){\r\n\tvar defaultRender = createBaseBarRender(gantt);\r\n\treturn {\r\n\t\trender: defaultRender,\r\n\t\tupdate: null,\r\n\t\t//getRectangle: getBarRectangle\r\n\t\tisInViewPort: isInViewPort,\r\n\t\tgetVisibleRange: getVisibleRange\r\n\t};\r\n};","export default function () {\r\n  // eslint-disable-next-line no-console\r\n  console.error(\"You are trying to use a Pro feature that is not available in the GPL version.\");\r\n  return {\r\n    render: function (){},\r\n    isInViewPort: function (){},\r\n    getVisibleRange: function (){}\r\n  };\r\n};\r\n","export default function(item, view, config){\r\n\treturn {\r\n\t\ttop: view.getItemTop(item.id),\r\n\t\theight: view.getItemHeight(item.id),\r\n\t\tleft: 0,\r\n\t\tright: Infinity\r\n\t};\r\n};","export default function getVisibleCellsRange(scale, viewport){\r\n\tvar firstCellIndex = 0;\r\n\tvar lastCellIndex = scale.left.length - 1;\r\n\tif(viewport){\r\n\t\tfor(var i = 0; i < scale.left.length; i++){\r\n\t\t\tvar left = scale.left[i];\r\n\t\t\tif(left < viewport.x){\r\n\t\t\t\tfirstCellIndex = i;\r\n\t\t\t}\r\n\t\t\tif(left > viewport.x_end){\r\n\t\t\t\tlastCellIndex = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\tstart: firstCellIndex,\r\n\t\tend: lastCellIndex\r\n\t};\r\n};","import isLegacyRender from \"../is_legacy_smart_render\";\r\n\r\nexport default function isColumnVisible(columnIndex, scale, viewPort, gantt){\r\n\tvar width = scale.width[columnIndex];\r\n\tif(width <= 0){\r\n\t\treturn false;\r\n\t}\r\n\tif(!gantt.config.smart_rendering || isLegacyRender(gantt)){\r\n\t\treturn true;\r\n\t}\r\n\tvar cellLeftCoord = scale.left[columnIndex] - width;\r\n\tvar cellRightCoord = scale.left[columnIndex] + width;\r\n\treturn (cellLeftCoord <= viewPort.x_end && cellRightCoord >= viewPort.x);//do not render skipped columns\r\n};","export default function (items, gantt){\r\n\tvar placeholderConfig = gantt.config.timeline_placeholder;\r\n\titems = items || [];\r\n\tif (placeholderConfig && items.filter(e => e.id === 'timeline_placeholder_task').length === 0){\r\n\t\tvar state = gantt.getState();\r\n\t\tvar lastTaskId = null;\r\n\t\tvar start_date = state.min_date;\r\n\t\tvar end_date = state.max_date;\r\n\t\tif (items.length){\r\n\t\t\tlastTaskId = items[items.length -1].id;\r\n\t\t}\r\n\t\tvar placeholderTask = {\r\n\t\t\tstart_date: start_date, \r\n\t\t\tend_date: end_date, \r\n\t\t\trow_height: placeholderConfig.height || 0,\r\n\t\t\tid: \"timeline_placeholder_task\", \r\n\t\t\tunscheduled: true,\r\n\t\t\tlastTaskId: lastTaskId, \r\n\t\t\tcalendar_id: placeholderConfig.calendar || \"global\",\r\n\t\t\t$source:[], \r\n\t\t\t$target: []\r\n\t\t};\r\n\t\titems.push(placeholderTask);\r\n\t}\r\n};","import isInViewPort from \"./viewport/is_link_in_viewport\";\r\nimport getVisibleRange from \"./viewport/factory/get_visible_link_range\";\r\nimport { childrenHaveBaselines, getMaxParentHeight } from \"./baseline_helper\";\r\n\r\n\r\nfunction createLinkRender(gantt){\r\n\r\nfunction _render_link_element(link, view, config) {\r\n\tvar source = gantt.getTask(link.source);\r\n\tif(source.hide_bar){\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar target = gantt.getTask(link.target);\r\n\tif(target.hide_bar){\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar pt = path_builder.get_endpoint(link, view, source, target);\r\n\tvar dy = pt.e_y - pt.y;\r\n\tvar dx = pt.e_x - pt.x;\r\n\tif(!dx && !dy){\r\n\t\treturn null;\r\n\t}\r\n\r\n\r\n\tvar dots = path_builder.get_points(link, view, source, target);\r\n\tconst lines = drawer.get_lines(dots, view);\r\n\r\n\tconst shapes = transform_lines_to_shapes(lines.filter(l => l.size > 0), config);\r\n  \r\n\tconst div = render_shapes(shapes, view, link, config);\r\n\r\n\r\n\tvar css = \"gantt_task_link\";\r\n\r\n\tif (link.color) {\r\n\t\tcss += \" gantt_link_inline_color\";\r\n\t}\r\n\tvar cssTemplate = gantt.templates.link_class ? gantt.templates.link_class(link) : \"\";\r\n\tif (cssTemplate) {\r\n\t\tcss += \" \" + cssTemplate;\r\n\t}\r\n\r\n\tif (config.highlight_critical_path && gantt.isCriticalLink) {\r\n\t\tif (gantt.isCriticalLink(link))\r\n\t\t\tcss += \" gantt_critical_link\";\r\n\t}\r\n\r\n\tdiv.className = css;\r\n\r\n\tif(view.$config.link_attribute){\r\n\t\tdiv.setAttribute(view.$config.link_attribute, link.id);\r\n\t\tdiv.setAttribute(\"link_id\", link.id);\r\n\t}\r\n\tif (link.color) {\r\n\t\tdiv.style.setProperty(\"--dhx-gantt-link-background\", link.color);\r\n\t}\r\n\r\n\tgantt._waiAria.linkAttr(link, div);\r\n\r\n\treturn div;\r\n}\r\n\r\n\tfunction render_shapes(shapes, view, link, config) {\r\n\t\tconst container = document.createElement(\"div\");\r\n\r\n\t\tshapes.forEach(shape => {\r\n\t\t\tlet element;\r\n\t\t\tif (shape.type === 'line') {\r\n\t\t\t\telement = drawer.render_line(shape.data, null, view, link.source);\r\n\t\t\t} else if (shape.type === 'corner') {\r\n\t\t\t\telement = drawer.render_corner(shape.data, view);\r\n\t\t\t}else if (shape.type === 'arrow') {\r\n\t\t\t\telement = drawer.render_arrow(shape.data, config);\r\n\t\t\t}\r\n\r\n\t\t\tcontainer.appendChild(element);\r\n\t\t});\r\n\r\n\t\treturn container;\r\n\t}\r\n\r\n\tfunction transform_lines_to_shapes(lines, config) {\r\n\t\tconst radius = config.link_radius || 4;\r\n\t\tconst arrowSize = config.link_arrow_size || 6; // Arrow size from config\r\n\t\tconst shapes = [];\r\n\t\r\n\t\tfor (let i = 0; i < lines.length; i++) {\r\n\t\t\tconst line = lines[i];\r\n\t\t\tconst nextLine = lines[i + 1];\r\n\t\r\n\t\t\tif (!nextLine || config.link_radius <= 1) {\r\n\t\t\t\tshapes.push({ type: 'line', data: line });\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\r\n\t\t\tif (line.direction !== nextLine.direction) {\r\n\t\t\t\tif(line.size < radius || nextLine.size < radius){\r\n\t\t\t\t\tshapes.push({ type: 'line', data: line });\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tline.size -= radius;\r\n\t\t\t\tshapes.push({ type: 'line', data: line });\r\n\t\r\n\t\t\t\tlet cornerX = line.x;\r\n\t\t\t\tlet cornerY = line.y - config.link_line_width / 2;\r\n\t\r\n\t\t\t\tswitch (line.direction) {\r\n\t\t\t\t\tcase 'right':\r\n\t\t\t\t\t\tcornerX += line.size;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'left':\r\n\t\t\t\t\t\tcornerX -= line.size;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'down':\r\n\t\t\t\t\t\tcornerY += line.size;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'up':\r\n\t\t\t\t\t\tcornerY -= line.size;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tconst corner = {\r\n\t\t\t\t\tx: cornerX,\r\n\t\t\t\t\ty: cornerY,\r\n\t\t\t\t\tdirection: { from: line.direction, to: nextLine.direction },\r\n\t\t\t\t\tradius\r\n\t\t\t\t};\r\n\t\t\t\tshapes.push({ type: 'corner', data: corner });\r\n\t\r\n\t\t\t\tswitch (nextLine.direction) {\r\n\t\t\t\t\tcase 'right':\r\n\t\t\t\t\t\tnextLine.x += radius;\r\n\t\t\t\t\t\tnextLine.size -= radius;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'left':\r\n\t\t\t\t\t\tnextLine.x -= radius;\r\n\t\t\t\t\t\tnextLine.size -= radius;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'down':\r\n\t\t\t\t\t\tnextLine.y += radius;\r\n\t\t\t\t\t\tnextLine.size -= radius;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'up':\r\n\t\t\t\t\t\tnextLine.y -= radius;\r\n\t\t\t\t\t\tnextLine.size -= radius;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tshapes.push({ type: 'line', data: line });\r\n\t\t\t}\r\n\t\t}\r\n\t\r\n\t\tconst lastLine = lines[lines.length - 1];\r\n\t\r\n\t\tif (lastLine.direction === 'right' || lastLine.direction === 'left') {\r\n\t\t\tlastLine.size -= arrowSize*3/4; \r\n\t\r\n\t\t\tlet arrowX = lastLine.direction === 'right' ? (lastLine.x + lastLine.size) : lastLine.x - lastLine.size - arrowSize/2;\r\n\t\t\tlet arrowY = lastLine.y - (config.link_line_width / 2) - (arrowSize / 2) + 1;\r\n\t\r\n\t\t\tif(lastLine.direction === 'left'){\r\n\t\t\t\tarrowY -= 1;// left pointing arrows for some reason need adjustments\r\n\t\t\t\tarrowX -= 2;\r\n\t\t\t}else{\r\n\t\t\t\tarrowX -= 1;\r\n\t\t\t}\r\n\t\t\tconst arrow = {\r\n\t\t\t\tx: arrowX,\r\n\t\t\t\ty: arrowY,\r\n\t\t\t\tsize: arrowSize,\r\n\t\t\t\tdirection: lastLine.direction\r\n\t\t\t};\r\n\t\r\n\t\t\tshapes.push({ type: 'line', data: lastLine });\r\n\t\t\tshapes.push({ type: 'arrow', data: arrow });\r\n\t\t} else {\r\n\t\t\tshapes.push({ type: 'line', data: lastLine });\r\n\t\t}\r\n\t\r\n\t\treturn shapes;\r\n\t}\r\n\t\r\n\r\n\r\nvar drawer = {\r\n\tcurrent_pos: null,\r\n\tdirs: {\"left\": 'left', \"right\": 'right', \"up\": 'up', \"down\": 'down'},\r\n\tpath: [],\r\n\tclear: function () {\r\n\t\tthis.current_pos = null;\r\n\t\tthis.path = [];\r\n\t},\r\n\tpoint: function (pos) {\r\n\t\tthis.current_pos = gantt.copy(pos);\r\n\t},\r\n\tget_lines: function (dots) {\r\n\t\tthis.clear();\r\n\t\tthis.point(dots[0]);\r\n\t\tfor (var i = 1; i < dots.length; i++) {\r\n\t\t\tthis.line_to(dots[i]);\r\n\t\t}\r\n\t\treturn this.get_path();\r\n\t},\r\n\tline_to: function (pos) {\r\n\t\tvar next = gantt.copy(pos);\r\n\t\tvar prev = this.current_pos;\r\n\r\n\t\tvar line = this._get_line(prev, next);\r\n\t\tthis.path.push(line);\r\n\t\tthis.current_pos = next;\r\n\t},\r\n\tget_path: function () {\r\n\t\treturn this.path;\r\n\t},\r\n\tget_wrapper_sizes: function (v, view, itemId) {\r\n\t\tvar config = view.$getConfig();\r\n\t\tvar res,\r\n\t\t\twrapper_size = config.link_wrapper_width,\r\n\t\t\ty = v.y - (wrapper_size) / 2;\r\n\t\tswitch (v.direction) {\r\n\t\t\tcase this.dirs.left:\r\n\t\t\t\tres = {\r\n\t\t\t\t\ttop: y,\r\n\t\t\t\t\theight: wrapper_size,\r\n\t\t\t\t\tlineHeight: wrapper_size,\r\n\t\t\t\t\tleft: v.x - v.size - wrapper_size / 2,\r\n\t\t\t\t\twidth: v.size + wrapper_size\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tcase this.dirs.right:\r\n\t\t\t\tres = {\r\n\t\t\t\t\ttop: y,\r\n\t\t\t\t\tlineHeight: wrapper_size,\r\n\t\t\t\t\theight: wrapper_size,\r\n\t\t\t\t\tleft: v.x - wrapper_size / 2,\r\n\t\t\t\t\twidth: v.size + wrapper_size\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tcase this.dirs.up:\r\n\t\t\t\tres = {\r\n\t\t\t\t\ttop: y - v.size,\r\n\t\t\t\t\tlineHeight: v.size + wrapper_size,\r\n\t\t\t\t\theight: v.size + wrapper_size,\r\n\t\t\t\t\tleft: v.x - wrapper_size / 2,\r\n\t\t\t\t\twidth: wrapper_size\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tcase this.dirs.down:\r\n\t\t\t\tres = {\r\n\t\t\t\t\ttop: y /*- wrapper_size/2*/,\r\n\t\t\t\t\tlineHeight: v.size + wrapper_size,\r\n\t\t\t\t\theight: v.size + wrapper_size,\r\n\t\t\t\t\tleft: v.x - wrapper_size / 2,\r\n\t\t\t\t\twidth: wrapper_size\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn res;\r\n\t},\r\n\tget_line_sizes: function (v, view) {\r\n\t\tvar config = view.$getConfig();\r\n\t\tvar res,\r\n\t\t\tline_size = config.link_line_width,\r\n\t\t\twrapper_size = config.link_wrapper_width,\r\n\t\t\tsize = v.size + line_size;\r\n\t\tswitch (v.direction) {\r\n\t\t\tcase this.dirs.left:\r\n\t\t\tcase this.dirs.right:\r\n\t\t\t\tres = {\r\n\t\t\t\t\theight: line_size,\r\n\t\t\t\t\twidth: size,\r\n\t\t\t\t\tmarginTop: (wrapper_size - line_size) / 2,\r\n\t\t\t\t\tmarginLeft: (wrapper_size - line_size) / 2\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tcase this.dirs.up:\r\n\t\t\tcase this.dirs.down:\r\n\t\t\t\tres = {\r\n\t\t\t\t\theight: size,\r\n\t\t\t\t\twidth: line_size,\r\n\t\t\t\t\tmarginTop: (wrapper_size - line_size) / 2,\r\n\t\t\t\t\tmarginLeft: (wrapper_size - line_size) / 2\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\r\n\t\treturn res;\r\n\t},\r\n\trender_line: function (v, end, view, itemId) {\r\n\t\tvar pos = this.get_wrapper_sizes(v, view, itemId);\r\n\t\tvar wrapper = document.createElement(\"div\");\r\n\t\twrapper.style.cssText = [\r\n\t\t\t\"top:\" + pos.top + \"px\",\r\n\t\t\t\"left:\" + pos.left + \"px\",\r\n\t\t\t\"height:\" + pos.height + \"px\",\r\n\t\t\t\"width:\" + pos.width + \"px\"\r\n\t\t].join(';');\r\n\t\twrapper.className = \"gantt_line_wrapper\";\r\n\r\n\t\tvar innerPos = this.get_line_sizes(v, view);\r\n\t\tvar inner = document.createElement(\"div\");\r\n\t\tinner.style.cssText = [\r\n\t\t\t\"height:\" + innerPos.height + \"px\",\r\n\t\t\t\"width:\" + innerPos.width + \"px\",\r\n\t\t\t\"margin-top:\" + innerPos.marginTop + \"px\",\r\n\t\t\t\"margin-left:\" + innerPos.marginLeft + \"px\"\r\n\t\t].join(\";\");\r\n\r\n\t\tinner.className = \"gantt_link_line_\" + v.direction;\r\n\t\twrapper.appendChild(inner);\r\n\r\n\t\treturn wrapper;\r\n\t},\r\n\r\n\trender_corner: function (corner, view) {\r\n\t\tconst radius = corner.radius;\r\n\t\tconst config = view.$getConfig();\r\n\t\tconst lineWidth = config.link_line_width || 2;\r\n\t\tconst cornerDiv = document.createElement(\"div\");\r\n\t\r\n\t\tcornerDiv.classList.add(\"gantt_link_corner\");\r\n\t\tcornerDiv.classList.add(`gantt_link_corner_${corner.direction.from}_${corner.direction.to}`);\r\n\t\r\n\t\tcornerDiv.style.width = `${radius}px`;\r\n\t\tcornerDiv.style.height = `${radius}px`;\r\n\t\r\n\t\tlet borderVertical;\r\n\t\tlet borderHorizontal;\r\n\r\n\t\tif (corner.direction.from === 'right' && corner.direction.to === 'down') {\r\n\t\t\tborderVertical = \"Right\";\r\n\t\t\tborderHorizontal = \"Top\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y}px`;\r\n\t\t} else if (corner.direction.from === 'down' && corner.direction.to === 'right') {\r\n\t\t\tborderVertical = \"Left\";\r\n\t\t\tborderHorizontal = \"Bottom\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y}px`;\r\n\t\t} else if (corner.direction.from === 'right' && corner.direction.to === 'up') {\r\n\t\t\tborderVertical = \"Right\";\r\n\t\t\tborderHorizontal = \"Bottom\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y - radius}px`;\r\n\t\t} else if (corner.direction.from === 'up' && corner.direction.to === 'right') {\r\n\t\t\tborderVertical = \"Left\";\r\n\t\t\tborderHorizontal = \"Top\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y - radius}px`;\r\n\t\t} else if (corner.direction.from === 'left' && corner.direction.to === 'down') {\r\n\t\t\tborderVertical = \"Left\";\r\n\t\t\tborderHorizontal = \"Top\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - radius - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y}px`;\r\n\t\t} else if (corner.direction.from === 'down' && corner.direction.to === 'left') {\r\n\t\t\tborderVertical = \"Right\";\r\n\t\t\tborderHorizontal = \"Bottom\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - radius - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y}px`;\r\n\t\t} else if (corner.direction.from === 'left' && corner.direction.to === 'up') {\r\n\t\t\tborderVertical = \"Left\";\r\n\t\t\tborderHorizontal = \"Bottom\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - radius - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y - radius}px`;\r\n\t\t} else if (corner.direction.from === 'up' && corner.direction.to === 'left') {\r\n\t\t\tborderVertical = \"Right\";\r\n\t\t\tborderHorizontal = \"Top\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - radius - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y - radius}px`;\r\n\t\t}\r\n\r\n\t\tcornerDiv.style[`border${borderHorizontal}Width`] = `${lineWidth}px`;\r\n\t\tcornerDiv.style[`border${borderVertical}Width`] = `${lineWidth}px`;\r\n\t\tcornerDiv.style[`border${borderVertical}Style`] = `solid`;\r\n\t\tcornerDiv.style[`border${borderHorizontal}Style`] = `solid`;\r\n\t\tcornerDiv.style[`border${borderHorizontal}${borderVertical}Radius`] = `${radius}px`;\r\n\r\n\t\r\n\t\treturn cornerDiv;\r\n\t},\r\n\r\n\trender_arrow(arrow, config) {\r\n\t\tvar div = document.createElement(\"div\");\r\n\t\tvar top = arrow.y;\r\n\t\tvar left = arrow.x;\r\n\t\r\n\t\tvar size = config.link_arrow_size;\r\n\t\tdiv.style.setProperty(\"--dhx-gantt-icon-size\", `${size}px`);\r\n\t\r\n\t\tvar className = \"gantt_link_arrow gantt_link_arrow_\" + arrow.direction;\r\n\r\n\t\tdiv.style.top = top + \"px\";\r\n\t\tdiv.style.left = left + 'px';\r\n\t\tdiv.className = className;\r\n\t\r\n\t\treturn div;\r\n\t},\r\n\t\r\n\t_get_line: function (from, to) {\r\n\t\tvar direction = this.get_direction(from, to);\r\n\t\tvar vect = {\r\n\t\t\tx: from.x,\r\n\t\t\ty: from.y,\r\n\t\t\tdirection: this.get_direction(from, to)\r\n\t\t};\r\n\t\tif (direction == this.dirs.left || direction == this.dirs.right) {\r\n\t\t\tvect.size = Math.abs(from.x - to.x);\r\n\t\t} else {\r\n\t\t\tvect.size = Math.abs(from.y - to.y);\r\n\t\t}\r\n\t\treturn vect;\r\n\t},\r\n\tget_direction: function (from, to) {\r\n\t\tvar direction = 0;\r\n\t\tif (to.x < from.x) {\r\n\t\t\tdirection = this.dirs.left;\r\n\t\t} else if (to.x > from.x) {\r\n\t\t\tdirection = this.dirs.right;\r\n\t\t} else if (to.y > from.y) {\r\n\t\t\tdirection = this.dirs.down;\r\n\t\t} else {\r\n\t\t\tdirection = this.dirs.up;\r\n\t\t}\r\n\t\treturn direction;\r\n\t}\r\n\r\n};\r\n\r\nvar path_builder = {\r\n\r\n\tpath: [],\r\n\tclear: function () {\r\n\t\tthis.path = [];\r\n\t},\r\n\tcurrent: function () {\r\n\t\treturn this.path[this.path.length - 1];\r\n\t},\r\n\tpoint: function (next) {\r\n\t\tif (!next)\r\n\t\t\treturn this.current();\r\n\r\n\t\tthis.path.push(gantt.copy(next));\r\n\t\treturn next;\r\n\t},\r\n\tpoint_to: function (direction, diff, point) {\r\n\t\tif (!point)\r\n\t\t\tpoint = gantt.copy(this.point());\r\n\t\telse\r\n\t\t\tpoint = {x: point.x, y: point.y};\r\n\t\tvar dir = drawer.dirs;\r\n\t\tswitch (direction) {\r\n\t\t\tcase (dir.left):\r\n\t\t\t\tpoint.x -= diff;\r\n\t\t\t\tbreak;\r\n\t\t\tcase (dir.right):\r\n\t\t\t\tpoint.x += diff;\r\n\t\t\t\tbreak;\r\n\t\t\tcase (dir.up):\r\n\t\t\t\tpoint.y -= diff;\r\n\t\t\t\tbreak;\r\n\t\t\tcase (dir.down):\r\n\t\t\t\tpoint.y += diff;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn this.point(point);\r\n\t},\r\n\tget_points: function (link, view, source, target) {\r\n\t\tvar pt = this.get_endpoint(link, view, source, target);\r\n\t\tvar xy = gantt.config;\r\n\r\n\t\tvar dy = pt.e_y - pt.y;\r\n\t\tvar dx = pt.e_x - pt.x;\r\n\r\n\t\tvar dir = drawer.dirs;\r\n\r\n\t\tvar rowHeight = view.getItemHeight(link.source);\r\n\r\n\t\tthis.clear();\r\n\t\tthis.point({x: pt.x, y: pt.y});\r\n\r\n\t\tvar shiftX = 2 * xy.link_arrow_size;//just random size for first line\r\n\t\tvar lineType = this.get_line_type(link, view.$getConfig());\r\n\r\n\t\tvar forward = (pt.e_x > pt.x);\r\n\t\tif (lineType.from_start && lineType.to_start) {\r\n\t\t\tthis.point_to(dir.left, shiftX);\r\n\t\t\tif (forward) {\r\n\t\t\t\tthis.point_to(dir.down, dy);\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t} else {\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t\tthis.point_to(dir.down, dy);\r\n\t\t\t}\r\n\t\t\tthis.point_to(dir.right, shiftX);\r\n\r\n\t\t} else if (!lineType.from_start && lineType.to_start) {\r\n\t\t\t// GS-2619. No need to add loops for the split tasks (zero dy means the tasks are on the same line)\r\n\t\t\tif (dy !== 0){\r\n\t\t\t\tforward = (pt.e_x > (pt.x + 2 * shiftX));\r\n\t\t\t}\r\n\t\t\tthis.point_to(dir.right, shiftX);\r\n\t\t\tif (forward) {\r\n\t\t\t\tdx -= shiftX;\r\n\t\t\t\tthis.point_to(dir.down, dy);\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t} else {\r\n\t\t\t\tdx -= 2 * shiftX;\r\n\t\t\t\tvar sign = dy > 0 ? 1 : -1;\r\n\r\n\t\t\t\tthis.point_to(dir.down, sign * (rowHeight / 2));\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t\tthis.point_to(dir.down, sign * ( Math.abs(dy) - (rowHeight / 2)));\r\n\t\t\t\tthis.point_to(dir.right, shiftX);\r\n\t\t\t}\r\n\r\n\t\t} else if (!lineType.from_start && !lineType.to_start) {\r\n\t\t\tthis.point_to(dir.right, shiftX);\r\n\t\t\tif (forward) {\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t\tthis.point_to(dir.down, dy);\r\n\t\t\t} else {\r\n\t\t\t\tthis.point_to(dir.down, dy);\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t}\r\n\t\t\tthis.point_to(dir.left, shiftX);\r\n\t\t} else if (lineType.from_start && !lineType.to_start) {\r\n\t\t\t// GS-2619. No need to add loops for the split tasks (zero dy means the tasks are on the same line)\r\n\t\t\tif (dy !== 0){\r\n\t\t\t\tforward = (pt.e_x > (pt.x - 2 * shiftX));\r\n\t\t\t}\r\n\t\t\tthis.point_to(dir.left, shiftX);\r\n\r\n\t\t\tif (!forward) {\r\n\t\t\t\tdx += shiftX;\r\n\t\t\t\tthis.point_to(dir.down, dy);\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t} else {\r\n\t\t\t\tdx += 2 * shiftX;\r\n\t\t\t\tvar sign = dy > 0 ? 1 : -1;\r\n\t\t\t\tthis.point_to(dir.down, sign * (rowHeight / 2));\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t\tthis.point_to(dir.down, sign * ( Math.abs(dy) - (rowHeight / 2)));\r\n\t\t\t\tthis.point_to(dir.left, shiftX);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn this.path;\r\n\t},\r\n\tget_line_type: function(link, config){\r\n\t\tvar types = config.links;\r\n\t\tvar from_start = false, to_start = false;\r\n\t\tif (link.type == types.start_to_start) {\r\n\t\t\tfrom_start = to_start = true;\r\n\t\t} else if (link.type == types.finish_to_finish) {\r\n\t\t\tfrom_start = to_start = false;\r\n\t\t} else if (link.type == types.finish_to_start) {\r\n\t\t\tfrom_start = false;\r\n\t\t\tto_start = true;\r\n\t\t} else if (link.type == types.start_to_finish) {\r\n\t\t\tfrom_start = true;\r\n\t\t\tto_start = false;\r\n\t\t} else {\r\n\t\t\tgantt.assert(false, \"Invalid link type\");\r\n\t\t}\r\n\r\n\t\tif(config.rtl){\r\n\t\t\tfrom_start = !from_start;\r\n\t\t\tto_start = !to_start;\r\n\t\t}\r\n\r\n\t\treturn {from_start: from_start, to_start: to_start};\r\n\t},\r\n\r\n\tget_endpoint: function (link, view, source, target) {\r\n\t\tvar config = view.$getConfig();\r\n\r\n\t\tvar lineType = this.get_line_type(link, config);\r\n\t\tvar from_start = lineType.from_start,\r\n\t\t\tto_start = lineType.to_start;\r\n\r\n\t\tvar from = getMilestonePosition(source, view, config),\r\n\t\t\tto = getMilestonePosition(target, view, config);\r\n\r\n\t\treturn {\r\n\t\t\tx: from_start ? from.left : (from.left + from.width),\r\n\t\t\te_x: to_start ? to.left : (to.left + to.width),\r\n\t\t\ty: from.top + (from.rowHeight/2) - 1,\r\n\t\t\te_y: to.top + (to.rowHeight/2) - 1\r\n\t\t};\r\n\t}\r\n};\r\n\r\nfunction getMilestonePosition(task, view, config){\r\n\tvar pos = view.getItemPosition(task);\r\n\r\n\t// GS-2270: Link to the split children shouldn't exceed the parent row height\r\n\tlet splitParams = getMaxParentHeight(gantt, view, task);\r\n\tlet maxHeight = splitParams.maxHeight;\r\n\r\n\tlet splitChild = splitParams.splitChild;\r\n\tconst baselinesOnDifferentRow = gantt.config.baselines && (gantt.config.baselines.render_mode == \"separateRow\" || gantt.config.baselines.render_mode == \"individualRow\");\r\n\tconst baselines = baselinesOnDifferentRow && task.baselines && task.baselines.length;\r\n\r\n\tif (splitParams.shrinkHeight){\r\n\t\tpos.rowHeight = maxHeight;\r\n\t}\r\n\r\n\tlet milestoneWidth;\r\n\tlet milestoneTask = gantt.getTaskType(task.type) == config.types.milestone;\r\n\tif(milestoneTask){\r\n\t\tlet milestoneHeight = view.getBarHeight(task.id, true);\r\n\t\tmilestoneWidth = Math.sqrt(2*milestoneHeight*milestoneHeight);\r\n\t\tif (splitParams.shrinkHeight && maxHeight < milestoneHeight){\r\n\t\t\tmilestoneHeight = maxHeight;\r\n\t\t\tmilestoneWidth = maxHeight;\r\n\t\t}\r\n\t\tpos.left -= milestoneWidth / 2;\r\n\t\tpos.width = milestoneWidth;\r\n\t} \r\n\tif (splitChild){\r\n\t\tif (maxHeight >= pos.height) {\r\n\t\t\tconst siblingBaselines = childrenHaveBaselines(gantt, task.parent);\r\n\t\t\tif (baselines || siblingBaselines){\r\n\t\t\t\tif (milestoneTask){\r\n\t\t\t\t\tpos.rowHeight = pos.height + 4;\r\n\t\t\t\t\tpos.left += (pos.width - pos.rowHeight + 4) / 2;\r\n\t\t\t\t\tpos.width = pos.rowHeight - 3;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tpos.rowHeight = pos.height + 6;\r\n\t\t\t\t}\r\n\t\t\t} else if (milestoneTask) {\r\n\t\t\t\tpos.left += (milestoneWidth - pos.height) / 2;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tpos.rowHeight = maxHeight + 2;\r\n\t\t\tif (milestoneTask){\r\n\t\t\t\tpos.left += (pos.width - pos.rowHeight + 4) / 2;\r\n\t\t\t\tpos.width = pos.rowHeight - 3;\r\n\t\t\t}\r\n\t\t}\r\n\t} else if (baselines){\r\n\t\tpos.rowHeight = pos.height + 4;\r\n\t}\r\n\r\n\treturn pos;\r\n}\r\n\r\n\r\nreturn {\r\n\trender: _render_link_element,\r\n\tupdate: null,\r\n\t//getRectangle: getLinkRectangle\r\n\tisInViewPort: isInViewPort,\r\n\tgetVisibleRange: getVisibleRange()\r\n};\r\n}\r\n\r\nexport default createLinkRender;","export default function(item, viewport, view, config, gantt){\r\n    // GS-2481 and GS-1715, don't remove selected task when using keyboard shortcuts and when the inline editor is opened\r\n    if(gantt.$ui.getView(\"grid\") && ((gantt.config.keyboard_navigation && gantt.getSelectedId()) || (gantt.ext.inlineEditors && gantt.ext.inlineEditors.getState().id))) {\r\n\t\t//GS-2661: selected task might be collapsed\r\n\t\tif(!item.$expanded_branch) return false;\r\n\t\treturn true;\r\n\t}\r\n    var top = view.getItemTop(item.id);\r\n\tvar height = view.getItemHeight(item.id);\r\n\r\n\tif(top > viewport.y_end || top + height < viewport.y){\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn true;\r\n};","import * as helpers from \"../utils/helpers\";\r\n\r\nexport default function createResourceTimelineBuilder(gantt){\r\n\r\n\tlet resourceTaskCache = {};\r\n\r\n\tgantt.$data.tasksStore.attachEvent(\"onStoreUpdated\", function(){\r\n\t\tresourceTaskCache = {};\r\n\t});\r\n\r\n\tfunction getResourceLoad(resource, resourceProperty, scale, timeline){\r\n\t\tconst cacheKey = resource.id + \"_\" + resourceProperty  + \"_\" + scale.unit + \"_\" + scale.step;\r\n\t\tlet res;\r\n\t\tif (!resourceTaskCache[cacheKey]) {\r\n\t\t\tres = resourceTaskCache[cacheKey] = calculateResourceLoad(resource, resourceProperty, scale, timeline);\r\n\r\n\t\t} else {\r\n\t\t\tres = resourceTaskCache[cacheKey];\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\r\n\tfunction calculateResourceLoadFromAssignments(items, scale, assignmentsPassed){\r\n\t\tconst scaleUnit = scale.unit;\r\n\t\tconst scaleStep = scale.step;\r\n\t\tconst timegrid = {};\r\n\r\n\t\tconst precalculatedTimes = {};\r\n\t\tfor (let i = 0; i < items.length; i++) {\r\n\t\t\tconst item = items[i];\r\n\t\t\tlet task = item;\r\n\t\t\tif(assignmentsPassed){\r\n\t\t\t\ttask = gantt.getTask(item.task_id);\r\n\t\t\t}\r\n\t\t\tif (task.unscheduled){\r\n\t\t\t\tcontinue; // do not process assignments for unscheduled tasks\r\n\t\t\t}\r\n\t\t\tlet minDate = (item.start_date || task.start_date);\r\n\t\t\tlet maxDate = (item.end_date || task.end_date);\r\n\t\t\tif(assignmentsPassed){\r\n\t\t\t\tif(item.start_date){\r\n\t\t\t\t\tminDate = new Date(Math.max(item.start_date.valueOf(), task.start_date.valueOf()));\r\n\t\t\t\t}\r\n\t\t\t\tif(item.end_date){\r\n\t\t\t\t\tmaxDate = new Date(Math.min(item.end_date.valueOf(), task.end_date.valueOf()));\r\n\t\t\t\t}\r\n\t\t\t\t// GS-2063: handle case with fixedDates mode\r\n\t\t\t\tif(item.mode && item.mode == \"fixedDates\"){\r\n\t\t\t\t\tminDate = item.start_date;\r\n\t\t\t\t\tmaxDate = item.end_date;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlet firstColumn = helpers.findBinary(scale.trace_x, minDate.valueOf());\r\n\t\t\tlet minScaleDate = new Date(scale.trace_x[firstColumn] || gantt.date[scaleUnit + \"_start\"](new Date(minDate)));\r\n\t\t\t// GS-2307: need to take into account that task could start before the min scale date\r\n\t\t\t// so the task would be added to timegrid\r\n\t\t\tlet currDate = new Date(Math.min(minDate.valueOf(), minScaleDate.valueOf())); \r\n\r\n\t\t\tlet calendar = gantt.config.work_time ? gantt.getTaskCalendar(task) : gantt;\r\n\t\t\tprecalculatedTimes[calendar.id] = {};\r\n\t\t\twhile (currDate < maxDate) {\r\n\t\t\t\tconst cachedTimes = precalculatedTimes[calendar.id];\r\n\r\n\t\t\t\tlet date = currDate;\r\n\t\t\t\tconst timestamp = date.valueOf();\r\n\r\n\t\t\t\tcurrDate = gantt.date.add(currDate, scaleStep, scaleUnit);\r\n\r\n\t\t\t\tif(cachedTimes[timestamp] === false){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!timegrid[timestamp]){\r\n\t\t\t\t\ttimegrid[timestamp] = {tasks: [], assignments: []};\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttimegrid[timestamp].tasks.push(task);\r\n\t\t\t\tif(assignmentsPassed){\r\n\t\t\t\t\ttimegrid[timestamp].assignments.push(item);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn timegrid;\r\n\t}\r\n\r\n\tfunction calculateResourceLoad(resource, resourceProperty, scale, timeline) {\r\n\r\n\t\tlet items;\r\n\t\tlet assignmentsPassed = false;\r\n\t\tlet timegrid = {};\r\n\r\n\t\tif(gantt.config.process_resource_assignments && resourceProperty === gantt.config.resource_property){\r\n\t\t\tif(resource.$role == \"task\"){\r\n\t\t\t\titems = gantt.getResourceAssignments(resource.$resource_id, resource.$task_id);\r\n\t\t\t}else{\r\n\t\t\t\titems = gantt.getResourceAssignments(resource.id);\r\n\t\t\t}\r\n\r\n\t\t\tassignmentsPassed = true;\r\n\t\t}else if(resource.$role == \"task\"){\r\n\t\t\titems = [];\r\n\t\t}else{\r\n\t\t\titems = gantt.getTaskBy(resourceProperty, resource.id);\r\n\t\t}\r\n\r\n\t\ttimegrid = calculateResourceLoadFromAssignments(items, scale, assignmentsPassed);\r\n\t\tconst scaleUnit = scale.unit;\r\n\t\tconst scaleStep = scale.step;\r\n\r\n\t\tconst timetable = [];\r\n\t\tlet start, end, tasks, assignments, cell;\r\n\t\tconst config = timeline.$getConfig();\r\n\r\n\t\tfor(let i = 0; i < scale.trace_x.length; i++){\r\n\t\t\tstart = new Date(scale.trace_x[i]);\r\n\t\t\tend = gantt.date.add(start, scaleStep, scaleUnit);\r\n\t\t\tcell = timegrid[start.valueOf()] || {};\r\n\t\t\ttasks = cell.tasks || [];\r\n\t\t\tassignments = cell.assignments || [];\r\n\t\t\tif(tasks.length || config.resource_render_empty_cells){\r\n\t\t\t\ttimetable.push({\r\n\t\t\t\t\tstart_date: start,\r\n\t\t\t\t\tend_date: end,\r\n\t\t\t\t\ttasks: tasks,\r\n\t\t\t\t\tassignments: assignments\r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\ttimetable.push(null);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn timetable;\r\n\t}\r\n\r\n\r\n\r\n\treturn getResourceLoad;\r\n};","import * as domHelpers from \"../utils/dom_helpers\";\r\nimport isPlaceholderTask from \"../../../utils/placeholder_task\";\r\n\r\nfunction _init_dnd(gantt, grid) {\r\n\tvar DnD = gantt.$services.getService(\"dnd\");\r\n\r\n\tif(!grid.$config.bind || !gantt.getDatastore(grid.$config.bind)){\r\n\t\treturn;\r\n\t}\r\n\r\n\tfunction locate(e){\r\n\t\treturn domHelpers.locateAttribute(e, grid.$config.item_attribute);\r\n\t}\r\n\r\n\tfunction getStore(){\r\n\t\treturn gantt.getDatastore(grid.$config.bind);\r\n\t}\r\n\r\n\tfunction checkPlaceholderTask(id){\r\n\t\treturn isPlaceholderTask(id, gantt, getStore());\r\n\t}\r\n\r\n\tvar dnd = new DnD(grid.$grid_data, {updates_per_second: 60});\r\n\tif (gantt.defined(grid.$getConfig().dnd_sensitivity))\r\n\t\tdnd.config.sensitivity = grid.$getConfig().dnd_sensitivity;\r\n\r\n\tdnd.attachEvent(\"onBeforeDragStart\", gantt.bind(function (obj, e) {\r\n\t\tvar el = locate(e);\r\n\t\tif (!el) return false;\r\n\t\tif (gantt.hideQuickInfo) gantt.hideQuickInfo();\r\n\r\n\t\tif (domHelpers.closest(e.target, \".gantt_grid_editor_placeholder\")){\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar id = el.getAttribute(grid.$config.item_attribute);\r\n\t\tif (checkPlaceholderTask(id)) return false;\r\n\r\n\t\tvar datastore = getStore();\r\n\r\n\t\tvar task = datastore.getItem(id);\r\n\r\n\t\tif (gantt.isReadonly(task))\r\n\t\t\treturn false;\r\n\r\n\t\tdnd.config.initial_open_state = task.$open;\r\n\t\tif (!gantt.callEvent(\"onRowDragStart\", [id, e.target || e.srcElement, e])) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t}, gantt));\r\n\r\n\tdnd.attachEvent(\"onAfterDragStart\", gantt.bind(function (obj, e) {\r\n\t\tvar el = locate(e);\r\n\t\tdnd.config.marker.innerHTML = el.outerHTML;\r\n\t\tvar element = dnd.config.marker.firstChild;\r\n\t\tif(element){\r\n\t\t\telement.style.position = \"static\";\r\n\t\t}\r\n\r\n\t\tdnd.config.id = el.getAttribute(grid.$config.item_attribute);\r\n\r\n\t\tvar store = getStore();\r\n\r\n\t\tvar task = store.getItem(dnd.config.id);\r\n\t\tdnd.config.index = store.getBranchIndex(dnd.config.id);\r\n\t\tdnd.config.parent = task.parent;\r\n\t\ttask.$open = false;\r\n\t\ttask.$transparent = true;\r\n\t\tthis.refreshData();\r\n\t}, gantt));\r\n\r\n\tdnd.lastTaskOfLevel = function (level) {\r\n\t\tvar last_item = null;\r\n\t\tvar store = getStore();\r\n\t\tvar tasks = store.getItems();\r\n\t\tfor (var i = 0, len = tasks.length; i < len; i++) {\r\n\t\t\tif (tasks[i].$level == level) {\r\n\t\t\t\tlast_item = tasks[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn last_item ? last_item.id : null;\r\n\t};\r\n\tdnd._getGridPos = gantt.bind(function (e) {\r\n\t\tvar pos = domHelpers.getNodePosition(grid.$grid_data);\r\n\t\t// row offset\r\n\t\tvar x = pos.x + grid.$grid.scrollLeft;\r\n\t\tvar y = e.pos.y - 10;\r\n\r\n\t\tvar rowHeight = grid.getItemHeight(dnd.config.id);\r\n\t\t// prevent moving row out of grid_data container\r\n\t\tif (y < pos.y) y = pos.y;\r\n\t\tvar gridHeight = grid.getTotalHeight();\r\n\t\tif (y > pos.y + gridHeight - rowHeight) y = pos.y + gridHeight - rowHeight;\r\n\t\tconst maxBottom = pos.y + pos.height;\r\n\t\tif (y > maxBottom - rowHeight) {\r\n\t\t\ty = maxBottom - rowHeight;\r\n\t\t}\r\n\r\n\t\tpos.x = x;\r\n\t\tpos.y = y;\r\n\t\treturn pos;\r\n\t}, gantt);\r\n\tdnd._getTargetY = gantt.bind(function (e) {\r\n\t\tvar pos = domHelpers.getNodePosition(grid.$grid_data);\r\n\t\tvar scrollPos = grid.$state.scrollTop || 0;\r\n\t\tvar maxBottom = gantt.$grid_data.getBoundingClientRect().height + scrollPos;\r\n\r\n\t\tvar y = e.pageY - pos.y + scrollPos;\r\n\t\tif (y > maxBottom) {\r\n\t\t\ty = maxBottom;\r\n\t\t} else if (y < scrollPos) {\r\n\t\t\ty = scrollPos;\r\n\t\t}\r\n\t\treturn y;\r\n\t}, gantt);\r\n\tdnd._getTaskByY = gantt.bind(function (y, dropIndex) {\r\n\r\n\t\tvar store = getStore();\r\n\r\n\t\ty = y || 0;\r\n\r\n\t\tvar index = grid.getItemIndexByTopPosition(y);\r\n\t\tindex = dropIndex < index ? index - 1 : index;\r\n\r\n\t\tif (index > store.countVisible() - 1)\r\n\t\t\treturn null;\r\n\r\n\t\treturn store.getIdByIndex(index);\r\n\t}, gantt);\r\n\tdnd.attachEvent(\"onDragMove\", gantt.bind(function (obj, e) {\r\n\t\tvar gridDataSizes = gantt.$grid_data.getBoundingClientRect();\r\n\t\tvar maxBottom = gridDataSizes.height + gridDataSizes.y + (grid.$state.scrollTop || 0) + window.scrollY;\r\n\t\tvar dd = dnd.config;\r\n\t\tvar pos = dnd._getGridPos(e);\r\n\r\n\t\tgantt._waiAria.reorderMarkerAttr(dd.marker);\r\n\r\n\t\tvar config = grid.$getConfig(),\r\n\t\t\tstore = getStore();\r\n\r\n\t\t// setting position of row\r\n\t\tif (pos.y < maxBottom) {\r\n\t\t\tdd.marker.style.top = pos.y + \"px\";\r\n\t\t} else {\r\n\t\t\tdd.marker.style.top = maxBottom + \"px\";\r\n\t\t}\r\n\t\tdd.marker.style.left = pos.x + 10 + \"px\";\r\n\t\tconst containerSize = domHelpers.getNodePosition(gantt.$root);\r\n\t\tif (pos.width > containerSize.width){\r\n\t\t\tdd.marker.style.width = containerSize.width - 10 - 2 + \"px\";\r\n\t\t\tdd.marker.style.overflow = \"hidden\";\t\r\n\t\t}\r\n\r\n\t\t// highlight row when mouseover\r\n\t\tvar item = store.getItem(dnd.config.id);\r\n\t\tvar targetY = dnd._getTargetY(e);\r\n\t\tvar el = dnd._getTaskByY(targetY, store.getIndexById(item.id));\r\n\r\n\t\tif (!store.exists(el)) {\r\n\t\t\tel = dnd.lastTaskOfLevel(config.order_branch_free ? item.$level : 0);\r\n\t\t\tif (el == dnd.config.id) {\r\n\t\t\t\tel = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction allowedLevel(next, item) {\r\n\t\t\treturn (!(store.isChildOf(over.id, item.id)) && (next.$level == item.$level || config.order_branch_free));\r\n\t\t}\r\n\r\n\t\tif (store.exists(el)) {\r\n\t\t\tvar over = store.getItem(el);\r\n\r\n\t\t\tvar itemTop = grid.getItemTop(over.id);\r\n\t\t\tvar itemHeight = grid.getItemHeight(over.id);\r\n\t\t\tif (itemTop + itemHeight / 2 < targetY) {\r\n\t\t\t\t//hovering over bottom part of item, check can be drop to bottom\r\n\t\t\t\tvar index = store.getIndexById(over.id);\r\n\t\t\t\tvar nextId = store.getNext(over.id);//adds +1 when hovering over placeholder\r\n\t\t\t\tvar next = store.getItem(nextId);\r\n\t\t\t\tif (checkPlaceholderTask(nextId)){\r\n\t\t\t\t\tvar prevId = store.getPrev(next.id);\r\n\t\t\t\t\tnext = store.getItem(prevId);\r\n\t\t\t\t}\r\n\t\t\t\tif (next) {\r\n\t\t\t\t\tif (next.id != item.id) {\r\n\t\t\t\t\t\tover = next; //there is a valid target\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tif (config.order_branch_free) {\r\n\t\t\t\t\t\t\tif (!(store.isChildOf(item.id, over.id) && store.getChildren(over.id).length == 1))\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tstore.move(item.id, store.getBranchIndex(over.id) + 1, store.getParent(over.id));\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//we at end of the list, check and drop at the end of list\r\n\t\t\t\t\tnextId = store.getIdByIndex(index);\r\n\t\t\t\t\tnext = store.getItem(nextId);\r\n\r\n\t\t\t\t\tif (checkPlaceholderTask(nextId)){\r\n\t\t\t\t\t\tvar prevId = store.getPrev(next.id);\r\n\t\t\t\t\t\tnext = store.getItem(prevId);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (allowedLevel(next, item) && next.id != item.id) {\r\n\t\t\t\t\t\tstore.move(item.id, -1, store.getParent(next.id));\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (config.order_branch_free) {\r\n\t\t\t\tif (over.id != item.id && allowedLevel(over, item) && !checkPlaceholderTask(over.id)) {\r\n\t\t\t\t\tif (!store.hasChild(over.id)) {\r\n\t\t\t\t\t\tover.$open = true;\r\n\t\t\t\t\t\tstore.move(item.id, -1, over.id);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (store.getIndexById(over.id) || itemHeight / 3 < targetY) return;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//if item is on different level, check the one before it\r\n\t\t\tvar index = store.getIndexById(over.id),\r\n\t\t\t\tprevId = store.getIdByIndex(index - 1);\r\n\r\n\t\t\tvar prev = store.getItem(prevId);\r\n\r\n\t\t\tvar shift = 1;\r\n\t\t\twhile ((!prev || prev.id == over.id) && index - shift >= 0) {\r\n\r\n\t\t\t\tprevId = store.getIdByIndex(index - shift);\r\n\t\t\t\tprev = store.getItem(prevId);\r\n\t\t\t\tshift++;\r\n\t\t\t}\r\n\r\n\t\t\tif (item.id == over.id || checkPlaceholderTask(over.id)) return;\r\n\t\t\t//replacing item under cursor\r\n\t\t\tif (allowedLevel(over, item) && item.id != over.id) {\r\n\t\t\t\tstore.move(item.id, 0, 0, over.id);\r\n\r\n\t\t\t} else if (over.$level == item.$level - 1 && !store.getChildren(over.id).length) {\r\n\t\t\t\tstore.move(item.id, 0, over.id);\r\n\r\n\t\t\t} else if (prev && (allowedLevel(prev, item)) && (item.id != prev.id)) {\r\n\t\t\t\tstore.move(item.id, -1, store.getParent(prev.id));\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}, gantt));\r\n\r\n\tdnd.attachEvent(\"onDragEnd\", gantt.bind(function () {\r\n\t\tvar store = getStore();\r\n\t\tvar task = store.getItem(dnd.config.id);\r\n\t\ttask.$transparent = false;\r\n\t\ttask.$open = dnd.config.initial_open_state;\r\n\r\n\t\tif (this.callEvent(\"onBeforeRowDragEnd\", [dnd.config.id, dnd.config.parent, dnd.config.index]) === false) {\r\n\t\t\tstore.move(dnd.config.id, dnd.config.index, dnd.config.parent);\r\n\t\t\ttask.$drop_target = null;\r\n\t\t} else {\r\n\t\t\tthis.callEvent(\"onRowDragEnd\", [dnd.config.id, task.$drop_target]);\r\n\t\t}\r\n\t\tgantt.render();\r\n\t\tthis.refreshData();\r\n\t}, gantt));\r\n}\r\n\r\nexport default {\r\n\tinit: _init_dnd\r\n};","/**\r\n * The state object for order branch drag and drop\r\n */\r\n\r\nimport * as utils from \"../../../../utils/utils\";\r\n\r\nexport default {\r\n\tcreateDropTargetObject: function createDropTargetObject(parent) {\r\n\t\tvar res = {\r\n\t\t\ttargetParent: null,\r\n\t\t\ttargetIndex: 0,\r\n\t\t\ttargetId: null,\r\n\t\t\tchild: false,\r\n\t\t\tnextSibling: false,\r\n\t\t\tprevSibling: false\r\n\t\t};\r\n\r\n\t\tif (parent) {\r\n\t\t\tutils.mixin(res, parent, true);\r\n\t\t}\r\n\t\treturn res;\r\n\t},\r\n\tnextSiblingTarget: function nextSiblingTarget(dndTaskId, targetTaskId, store) {\r\n\t\tvar result = this.createDropTargetObject();\r\n\t\tresult.targetId = targetTaskId;\r\n\t\tresult.nextSibling = true;\r\n\t\tresult.targetParent = store.getParent(result.targetId);\r\n\t\tresult.targetIndex = store.getBranchIndex(result.targetId);\r\n\t\tif(store.getParent(dndTaskId) != result.targetParent || result.targetIndex < store.getBranchIndex(dndTaskId)){\r\n\t\t\tresult.targetIndex += 1;\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\tprevSiblingTarget: function prevSiblingTarget(dndTaskId, targetTaskId, store) {\r\n\t\tvar result = this.createDropTargetObject();\r\n\t\tresult.targetId = targetTaskId;\r\n\t\tresult.prevSibling = true;\r\n\t\tresult.targetParent = store.getParent(result.targetId);\r\n\t\tresult.targetIndex = store.getBranchIndex(result.targetId);\r\n\t\tif(store.getParent(dndTaskId) == result.targetParent && result.targetIndex > store.getBranchIndex(dndTaskId)){\r\n\t\t\tresult.targetIndex -= 1;\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\tfirstChildTarget: function firstChildTarget(dndTaskId, targetTaskId, store) {\r\n\t\tvar result = this.createDropTargetObject();\r\n\t\tresult.targetId = targetTaskId;\r\n\t\tresult.targetParent = result.targetId;\r\n\t\tresult.targetIndex = 0;\r\n\t\tresult.child = true;\r\n\t\treturn result;\r\n\t},\r\n\tlastChildTarget: function lastChildTarget(dndTaskId, targetTaskId, store) {\r\n\t\tvar children = store.getChildren(targetTaskId);\r\n\t\tvar result = this.createDropTargetObject();\r\n\t\tresult.targetId = children[children.length - 1];\r\n\t\tresult.targetParent = targetTaskId;\r\n\t\tresult.targetIndex = children.length;\r\n\t\tresult.nextSibling = true;\r\n\t\treturn result;\r\n\t}\r\n};","/**\r\n * resolve dnd position of the task when gantt.config.order_branch_free = false\r\n */\r\n\r\nimport dropTarget from \"./drop_target\";\r\n\r\nfunction getLast(store){\r\n\tvar current = store.getNext();\r\n\twhile(store.exists(current)){\r\n\r\n\t\tvar next = store.getNext(current);\r\n\t\tif(!store.exists(next)){\r\n\t\t\treturn current;\r\n\t\t}else{\r\n\t\t\tcurrent = next;\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction findClosesTarget(dndTaskId, taskId, allowedLevel, store, up){\r\n\tvar prev = taskId;\r\n\twhile(store.exists(prev)){\r\n\t\tvar targetLevel = store.calculateItemLevel(store.getItem(prev));\r\n\t\tif((targetLevel === allowedLevel || targetLevel === (allowedLevel - 1)) && store.getBranchIndex(prev) > -1){\r\n\t\t\tbreak;\r\n\t\t}else {\r\n\t\t\tprev = up ? store.getPrev(prev) : store.getNext(prev);\r\n\t\t}\r\n\t}\r\n\r\n\tif(store.exists(prev)){\r\n\t\tif(store.calculateItemLevel(store.getItem(prev)) === allowedLevel){\r\n\t\t\treturn up ? dropTarget.nextSiblingTarget(dndTaskId, prev, store) : dropTarget.prevSiblingTarget(dndTaskId, prev, store);\r\n\t\t}else{\r\n\t\t\treturn dropTarget.firstChildTarget(dndTaskId, prev, store);\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction findTargetAbove(dndTaskId, taskId, allowedLevel, store){\r\n\treturn findClosesTarget(dndTaskId, taskId, allowedLevel, store, true);\r\n}\r\nfunction findTargetBelow(dndTaskId, taskId, allowedLevel, store){\r\n\treturn findClosesTarget(dndTaskId, taskId, allowedLevel, store, false);\r\n}\r\n\r\nexport default function getSameLevelDropPosition(dndTaskId, targetTaskId, relTargetPos, eventTop, store, level){\r\n\tvar result;\r\n\tif(targetTaskId !== store.$getRootId()){\r\n\t\tvar targetTask = store.getItem(targetTaskId);\r\n\t\tvar targetLevel = store.calculateItemLevel(targetTask);\r\n\t\tif(targetLevel === level){\r\n\t\t\tvar prevSibling = store.getPrevSibling(targetTaskId);\r\n\t\t\tif(relTargetPos < 0.5 && !prevSibling){\r\n\t\t\t\tresult = dropTarget.prevSiblingTarget(dndTaskId, targetTaskId, store);\r\n\t\t\t}else{\r\n\t\t\t\tif(relTargetPos < 0.5){\r\n\t\t\t\t\ttargetTaskId = prevSibling;\r\n\t\t\t\t}\r\n\t\t\t\tresult = dropTarget.nextSiblingTarget(dndTaskId, targetTaskId, store);\r\n\t\t\t}\r\n\t\t}else if(targetLevel > level){\r\n\t\t\tstore.eachParent(function(parent){\r\n\t\t\t\tif(store.calculateItemLevel(parent) === level){\r\n\t\t\t\t\ttargetTaskId = parent.id;\r\n\t\t\t\t}\r\n\t\t\t}, targetTask); \r\n\t\t\tresult = findTargetAbove(dndTaskId, targetTaskId, level, store);\r\n\t\t}else{\r\n\t\t\tvar targetAbove = findTargetAbove(dndTaskId, targetTaskId, level, store);\r\n\t\t\tvar targetBelow = findTargetBelow(dndTaskId, targetTaskId, level, store);\r\n\t\t\tresult = (relTargetPos < 0.5) ? targetAbove : targetBelow;\r\n\t\t}\r\n\t}else{\r\n\t\tvar rootId = store.$getRootId();\r\n\t\tvar rootLevel = store.getChildren(rootId);\r\n\t\tresult = dropTarget.createDropTargetObject();\r\n\t\tif(rootLevel.length && eventTop >= 0){\r\n\t\t\tresult = findTargetAbove(dndTaskId, getLast(store), level, store);\r\n\t\t}else{\r\n\t\t\tresult = findTargetBelow(dndTaskId, rootId, level, store);\r\n\t\t}\r\n\t}\r\n\r\n\treturn result;\r\n};\r\n","import * as domHelpers from \"../../utils/dom_helpers\";\r\n\r\n/**\r\n * methods for highlighting current drag and drop position\r\n */\r\n\r\nfunction highlightPosition(target, root, grid){\r\n\tvar markerPos = getTaskMarkerPosition(target, grid);\r\n\t// setting position of row\r\n\troot.marker.style.left = markerPos.x + 9 + \"px\";\r\n\troot.marker.style.width = markerPos.width + \"px\";\r\n\troot.marker.style.overflow = \"hidden\";\r\n\tvar markerLine = root.markerLine;\r\n\tif(!markerLine){\r\n\t\tmarkerLine = document.createElement(\"div\");\r\n\t\tmarkerLine.className = \"gantt_drag_marker gantt_grid_dnd_marker\";\r\n\t\tmarkerLine.innerHTML = \"<div class='gantt_grid_dnd_marker_line'></div>\";\r\n\t\tmarkerLine.style.pointerEvents = \"none\";\r\n\t}\r\n\r\n\tif(target.child){\r\n\t\thighlightFolder(target, markerLine, grid);\r\n\t}else{\r\n\t\thighlightRow(target, markerLine, grid);\r\n\t}\r\n\r\n\tif(!root.markerLine){\r\n\t\tdocument.body.appendChild(markerLine);\r\n\t\troot.markerLine = markerLine;\r\n\t}\r\n}\r\n\r\nfunction removeLineHighlight(root){\r\n\tif(root.markerLine && root.markerLine.parentNode){\r\n\t\troot.markerLine.parentNode.removeChild(root.markerLine);\r\n\t}\r\n\troot.markerLine = null;\r\n}\r\n\r\nfunction highlightRow(target, markerLine, grid){\r\n\tvar linePos = getLineMarkerPosition(target, grid);\r\n\tvar maxBottom = grid.$grid_data.getBoundingClientRect().bottom + window.scrollY;\r\n\r\n\tmarkerLine.innerHTML = \"<div class='gantt_grid_dnd_marker_line'></div>\";\r\n\tmarkerLine.style.left = linePos.x + \"px\";\r\n\tmarkerLine.style.height = \"4px\";\r\n\r\n\tvar markerLineTop = linePos.y - 2;\r\n\tmarkerLine.style.top = markerLineTop + \"px\";\r\n\tmarkerLine.style.width = linePos.width + \"px\";\r\n\r\n\tif (markerLineTop > maxBottom) {\r\n\t\tmarkerLine.style.top = maxBottom + 'px';\r\n\t}\r\n\r\n\treturn markerLine;\r\n}\r\nfunction highlightFolder(target, markerFolder, grid){\r\n\tvar id = target.targetParent;\r\n\tvar pos = gridToPageCoordinates({x: 0, y: grid.getItemTop(id)}, grid);\r\n\tvar maxBottom = grid.$grid_data.getBoundingClientRect().bottom + window.scrollY;\r\n\r\n\tlet folderHighlightWidth = setWidthWithinContainer(grid.$gantt, grid.$grid_data.offsetWidth);\t\r\n\r\n\tmarkerFolder.innerHTML = \"<div class='gantt_grid_dnd_marker_folder'></div>\";\r\n\tmarkerFolder.style.width = folderHighlightWidth + \"px\";\r\n\tmarkerFolder.style.top = pos.y + \"px\";\r\n\tmarkerFolder.style.left = pos.x  + \"px\";\r\n\tmarkerFolder.style.height = grid.getItemHeight(id) + \"px\";\r\n\tif (pos.y > maxBottom) {\r\n\t\tmarkerFolder.style.top = maxBottom + 'px';\r\n\t}\r\n\r\n\treturn markerFolder;\r\n}\r\n\r\nfunction getLineMarkerPosition(target, grid){\r\n\tvar store = grid.$config.rowStore;\r\n\tvar pos = {x:0, y:0};\r\n\tvar indentNode = grid.$grid_data.querySelector(\".gantt_tree_indent\");\r\n\tvar indent = 15;\r\n\tvar level = 0;\r\n\tif(indentNode){\r\n\t\tindent = indentNode.offsetWidth;\r\n\t}\r\n\tvar iconWidth = 40;\r\n\tif(target.targetId !== store.$getRootId()){\r\n\t\tvar itemTop = grid.getItemTop(target.targetId);\r\n\t\tvar itemHeight = grid.getItemHeight(target.targetId);\r\n\t\tlevel = store.exists(target.targetId) ? store.calculateItemLevel(store.getItem(target.targetId)) : 0;\r\n\r\n\t\tif(target.prevSibling){\r\n\t\t\tpos.y = itemTop;\r\n\t\t}else if(target.nextSibling){\r\n\t\t\tvar childCount = 0;\r\n\t\t\tstore.eachItem(function(child){\r\n\t\t\t\tif(store.getIndexById(child.id) !== -1)\r\n\t\t\t\t\tchildCount++;\r\n\t\t\t}, target.targetId);\r\n\r\n\t\t\tpos.y = itemTop + itemHeight + childCount*itemHeight;\r\n\t\t}else {\r\n\t\t\tpos.y = itemTop + itemHeight;\r\n\t\t\tlevel += 1;\r\n\t\t}\r\n\t}\r\n\tpos.x = iconWidth + level * indent;\r\n\tpos.width = setWidthWithinContainer(grid.$gantt, Math.max(grid.$grid_data.offsetWidth - pos.x, 0), pos.x);\r\n\treturn gridToPageCoordinates(pos, grid);\r\n}\r\n\r\nfunction gridToPageCoordinates(pos, grid){\r\n\tvar gridPos = domHelpers.getNodePosition(grid.$grid_data);\r\n\tpos.x += gridPos.x + grid.$grid.scrollLeft;\r\n\tpos.y += gridPos.y - grid.$grid_data.scrollTop;\r\n\treturn pos;\r\n}\r\n\r\nfunction getTaskMarkerPosition(e, grid) {\r\n\tvar pos = domHelpers.getNodePosition(grid.$grid_data);\r\n\tvar ePos = domHelpers.getRelativeEventPosition(e, grid.$grid_data);\r\n\t// row offset\r\n\tvar x = pos.x + grid.$grid.scrollLeft;\r\n\tvar y = ePos.y - 10;\r\n\r\n\tvar rowHeight = grid.getItemHeight(e.targetId);\r\n\t// prevent moving row out of grid_data container\r\n\tif (y < pos.y) y = pos.y;\r\n\tvar gridHeight = grid.getTotalHeight();\r\n\tif (y > pos.y + gridHeight - rowHeight) y = pos.y + gridHeight - rowHeight;\r\n\r\n\tpos.x = x;\r\n\tpos.y = y;\r\n\tpos.width = setWidthWithinContainer(grid.$gantt, pos.width, 9);\r\n\treturn pos;\r\n}\r\n\r\nfunction setWidthWithinContainer(gantt, width, offset = 0){\r\n\tconst containerSize = domHelpers.getNodePosition(gantt.$root);\r\n\tif (width > containerSize.width){\r\n\t\twidth = containerSize.width - offset - 2;\r\n\t}\r\n\treturn width;\r\n}\r\n\r\nexport default {\r\n\tremoveLineHighlight: removeLineHighlight,\r\n\thighlightPosition: highlightPosition\r\n};\r\n","import * as domHelpers from \"../utils/dom_helpers\";\r\nimport dropTarget from \"./tasks_grid_dnd_marker_helpers/drop_target\";\r\nimport getLockedLevelTarget from \"./tasks_grid_dnd_marker_helpers/locked_level\";\r\nimport getMultiLevelTarget from \"./tasks_grid_dnd_marker_helpers/multi_level\";\r\nimport higlighter from \"./tasks_grid_dnd_marker_helpers/highlight\";\r\nimport isPlaceholderTask from \"../../../utils/placeholder_task\";\r\n\r\nfunction _init_dnd(gantt, grid) {\r\n\tvar DnD = gantt.$services.getService(\"dnd\");\r\n\r\n\tif(!grid.$config.bind || !gantt.getDatastore(grid.$config.bind)){\r\n\t\treturn;\r\n\t}\r\n\r\n\tfunction locate(e){\r\n\t\treturn domHelpers.locateAttribute(e, grid.$config.item_attribute);\r\n\t}\r\n\r\n\tfunction getStore(){\r\n\t\treturn gantt.getDatastore(grid.$config.bind);\r\n\t}\r\n\r\n\tfunction checkPlaceholderTask(id){\r\n\t\treturn isPlaceholderTask(id, gantt, getStore());\r\n\t}\r\n\r\n\tvar dnd = new DnD(grid.$grid_data, {updates_per_second: 60});\r\n\tif (gantt.defined(grid.$getConfig().dnd_sensitivity))\r\n\t\tdnd.config.sensitivity = grid.$getConfig().dnd_sensitivity;\r\n\r\n\tdnd.attachEvent(\"onBeforeDragStart\", gantt.bind(function (obj, e) {\r\n\t\tvar el = locate(e);\r\n\t\tif (!el) return false;\r\n\t\tif (gantt.hideQuickInfo) gantt.hideQuickInfo();\r\n\t\tif (domHelpers.closest(e.target, \".gantt_grid_editor_placeholder\")){\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar id = el.getAttribute(grid.$config.item_attribute);\r\n\t\tvar datastore = grid.$config.rowStore;\r\n\t\tvar task = datastore.getItem(id);\r\n\r\n\t\tif (gantt.isReadonly(task) || checkPlaceholderTask(id))\r\n\t\t\treturn false;\r\n\r\n\t\tdnd.config.initial_open_state = task.$open;\r\n\t\tif (!gantt.callEvent(\"onRowDragStart\", [id, e.target || e.srcElement, e])) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t}, gantt));\r\n\r\n\tdnd.attachEvent(\"onAfterDragStart\", gantt.bind(function (obj, e) {\r\n\t\tvar el = locate(e);\r\n\r\n\t\tdnd.config.marker.innerHTML = el.outerHTML;\r\n\t\tvar element = dnd.config.marker.firstChild;\r\n\t\tif(element){\r\n\t\t\tdnd.config.marker.style.opacity = 0.4;\r\n\t\t\telement.style.position = \"static\";\r\n\t\t\telement.style.pointerEvents = \"none\";\r\n\t\t}\r\n\r\n\t\tdnd.config.id = el.getAttribute(grid.$config.item_attribute);\r\n\r\n\t\tvar store = grid.$config.rowStore;\r\n\r\n\t\tvar task = store.getItem(dnd.config.id);\r\n\t\tdnd.config.level = store.calculateItemLevel(task);\r\n\t\tdnd.config.drop_target = dropTarget.createDropTargetObject({\r\n\t\t\ttargetParent: store.getParent(task.id),\r\n\t\t\ttargetIndex: store.getBranchIndex(task.id),\r\n\t\t\ttargetId: task.id,\r\n\t\t\tnextSibling: true\r\n\t\t});\r\n\r\n\t\ttask.$open = false;\r\n\t\ttask.$transparent = true;\r\n\t\tthis.refreshData();\r\n\t}, gantt));\r\n\r\n\tfunction getTargetTaskId(e){\r\n\t\tvar y = domHelpers.getRelativeEventPosition(e, grid.$grid_data).y;\r\n\t\tvar store = grid.$config.rowStore;\r\n\r\n\t\tif (!document.doctype){\r\n\t\t\ty += window.scrollY;\r\n\t\t}\r\n\t\ty = y || 0;\r\n\r\n\t\t// limits for the marker according to the layout layer\r\n\t\tvar scrollPos = grid.$state.scrollTop || 0;\r\n\t\tvar maxBottom = gantt.$grid_data.getBoundingClientRect().height + scrollPos + window.scrollY;\r\n\t\tvar minTop = scrollPos;\r\n\r\n\t\tvar firstVisibleTaskIndex = grid.getItemIndexByTopPosition(grid.$state.scrollTop);\r\n\t\tif (!store.exists(firstVisibleTaskIndex)){\r\n\t\t\tfirstVisibleTaskIndex = store.countVisible() - 1;\r\n\t\t}\r\n\t\tif (firstVisibleTaskIndex < 0) {\r\n\t\t\treturn store.$getRootId();\r\n\t\t}\r\n\r\n\t\tvar firstVisibleTaskId = store.getIdByIndex(firstVisibleTaskIndex);\r\n\r\n\t\tvar firstVisibleTaskPos = grid.$state.scrollTop / grid.getItemHeight(firstVisibleTaskId);\r\n\t\tvar hiddenTaskPart = firstVisibleTaskPos - Math.floor(firstVisibleTaskPos);\r\n\t\tif (hiddenTaskPart > 0.1 && hiddenTaskPart < 0.9) {\r\n\t\t\tmaxBottom = maxBottom - grid.getItemHeight(firstVisibleTaskId) * hiddenTaskPart;\r\n\t\t\tminTop = minTop + grid.getItemHeight(firstVisibleTaskId) * (1 - hiddenTaskPart);\r\n\t\t}\r\n\r\n\t\t// GS-715. The placeholder task row shouldn't be draggable below the Gantt container\r\n\t\tconst gridPosition = domHelpers.getNodePosition(grid.$grid_data);\r\n\t\tconst gridBottom = gridPosition.y + gridPosition.height;\r\n\t\tconst placeholderRowHeight = dnd.config.marker.offsetHeight;\r\n\t\tif (y + placeholderRowHeight + window.scrollY >= maxBottom){\r\n\t\t\tdnd.config.marker.style.top = gridBottom - placeholderRowHeight\t+ \"px\";\r\n\t\t}\r\n\r\n\t\tif (y >= maxBottom) {\r\n\t\t\ty = maxBottom;\r\n\t\t} else if (y <= minTop) {\r\n\t\t\ty = minTop;\r\n\t\t\tdnd.config.marker.style.top = gridPosition.y + \"px\";\r\n\t\t}\r\n\r\n\t\tvar index = grid.getItemIndexByTopPosition(y);\r\n\r\n\t\tif (index > store.countVisible() - 1 || index < 0) {\r\n\t\t\treturn store.$getRootId();\r\n\t\t}\r\n\r\n\t\tvar targetId = store.getIdByIndex(index);\r\n\t\tif (checkPlaceholderTask(targetId)) {\r\n\t\t\treturn store.getPrevSibling(targetId);\r\n\t\t}\r\n\r\n\t\treturn store.getIdByIndex(index);\r\n\t}\r\n\r\n\tfunction getDropPosition(e){\r\n\t\tvar targetTaskId = getTargetTaskId(e);\r\n\t\tvar relTargetPos = null;\r\n\t\tvar store = grid.$config.rowStore;\r\n\t\tvar config = grid.$getConfig();\r\n\t\tvar lockLevel = !config.order_branch_free;\r\n\r\n\t\tvar eventTop = domHelpers.getRelativeEventPosition(e, grid.$grid_data).y;\r\n\t\tif (!document.doctype){\r\n\t\t\teventTop += window.scrollY;\r\n\t\t}\r\n\r\n\t\tif(targetTaskId !== store.$getRootId()) {\r\n\t\t\tvar rowTop = grid.getItemTop(targetTaskId);\r\n\t\t\tvar rowHeight = grid.getItemHeight(targetTaskId);\r\n\t\t\trelTargetPos = (eventTop - rowTop) / rowHeight;\r\n\t\t}\r\n\r\n\t\tvar result;\r\n\t\tif(!lockLevel){\r\n\t\t\tresult = getMultiLevelTarget(dnd.config.id, targetTaskId, relTargetPos, eventTop, store);\r\n\t\t}else{\r\n\t\t\tresult = getLockedLevelTarget(dnd.config.id, targetTaskId, relTargetPos, eventTop, store, dnd.config.level);\r\n\t\t\tif(result && result.targetParent && checkPlaceholderTask(result.targetParent)){\r\n\t\t\t\ttargetTaskId = store.getPrevSibling(result.targetParent);\r\n\t\t\t\tresult = getLockedLevelTarget(dnd.config.id, targetTaskId, relTargetPos, eventTop, store, dnd.config.level);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tdnd.attachEvent(\"onDragMove\", gantt.bind(function (obj, e) {\r\n\t\tvar target = getDropPosition(e);\r\n\r\n\t\tif(!target ||\r\n\t\t\tgantt.callEvent(\"onBeforeRowDragMove\", [dnd.config.id, target.targetParent, target.targetIndex]) === false){\r\n\t\t\t\ttarget = dropTarget.createDropTargetObject(dnd.config.drop_target);\r\n\t\t\t}\r\n\r\n\t\thiglighter.highlightPosition(target, dnd.config, grid);\r\n\t\tdnd.config.drop_target = target;\r\n\t\tgantt._waiAria.reorderMarkerAttr(dnd.config.marker);\r\n\r\n\t\tthis.callEvent(\"onRowDragMove\", [dnd.config.id, target.targetParent, target.targetIndex]);\r\n\t\treturn true;\r\n\t}, gantt));\r\n\r\n\tdnd.attachEvent(\"onDragEnd\", gantt.bind(function () {\r\n\t\tvar store = grid.$config.rowStore;\r\n\t\tvar task = store.getItem(dnd.config.id);\r\n\r\n\t\thiglighter.removeLineHighlight(dnd.config);\r\n\r\n\t\ttask.$transparent = false;\r\n\t\ttask.$open = dnd.config.initial_open_state;\r\n\t\tvar target = dnd.config.drop_target;\r\n\r\n\t\tif (this.callEvent(\"onBeforeRowDragEnd\", [dnd.config.id, target.targetParent, target.targetIndex]) === false) {\r\n\t\t\ttask.$drop_target = null;\r\n\t\t} else {\r\n\t\t\tstore.move(dnd.config.id, target.targetIndex, target.targetParent);\r\n\t\t\tgantt.render();\r\n\t\t\tthis.callEvent(\"onRowDragEnd\", [dnd.config.id, target.targetParent, target.targetIndex]);\r\n\t\t}\r\n\t\tstore.refresh(task.id);\r\n\t}, gantt));\r\n}\r\n\r\nexport default {\r\n\tinit: _init_dnd\r\n};","/**\r\n * resolve dnd position of the task when gantt.config.order_branch_free = true\r\n */\r\n\r\nimport dropTarget from \"./drop_target\";\r\n\r\nexport default function getMultiLevelDropPosition(dndTaskId, targetTaskId, relTargetPos, eventTop, store){\r\n\tvar result;\r\n\r\n\tif(targetTaskId !== store.$getRootId()){\r\n\t\tif(relTargetPos < 0.25){\r\n\t\t\tresult = dropTarget.prevSiblingTarget(dndTaskId, targetTaskId, store);\r\n\t\t}else if(relTargetPos > 0.60 && !(store.hasChild(targetTaskId) && store.getItem(targetTaskId).$open)){\r\n\t\t\tresult = dropTarget.nextSiblingTarget(dndTaskId, targetTaskId, store);\r\n\t\t}else {\r\n\t\t\tresult = dropTarget.firstChildTarget(dndTaskId, targetTaskId, store);\r\n\t\t}\r\n\t}else{\r\n\t\tvar rootId = store.$getRootId();\r\n\t\tif(store.hasChild(rootId) && eventTop >= 0){\r\n\t\t\tresult = dropTarget.lastChildTarget(dndTaskId, rootId, store);\r\n\t\t}else{\r\n\t\t\tresult = dropTarget.firstChildTarget(dndTaskId, rootId, store);\r\n\t\t}\r\n\t}\r\n\r\n\treturn result;\r\n};","import * as utils from \"../../../utils/utils\";\r\nimport rowDnd from \"./tasks_grid_dnd\";\r\nimport rowDndMarker from \"./tasks_grid_dnd_marker\";\r\nimport mouseEventContainer from \"../mouse_event_container\";\r\n\r\nvar initializer = (function(){\r\n\treturn function(gantt){\r\n\t\treturn {\r\n\t\t\tonCreated: function (grid) {\r\n\t\t\t\tgrid.$config = utils.mixin(grid.$config, {\r\n\t\t\t\t\tbind: \"task\"\r\n\t\t\t\t});\r\n\t\t\t\tif(grid.$config.id == \"grid\") {\r\n\t\t\t\t\tthis.extendGantt(grid);\r\n\t\t\t\t\tgantt.ext.inlineEditors = gantt.ext._inlineEditors.createEditors(grid);\r\n\t\t\t\t\tgantt.ext.inlineEditors.init();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._mouseDelegates = mouseEventContainer(gantt);\r\n\t\t\t},\r\n\t\t\tonInitialized: function (grid) {\r\n\t\t\t\tvar config = grid.$getConfig();\r\n\t\t\t\tif (config.order_branch) {\r\n\t\t\t\t\tif(config.order_branch == \"marker\"){\r\n\t\t\t\t\t\trowDndMarker.init(grid.$gantt, grid);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\trowDnd.init(grid.$gantt, grid);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.initEvents(grid, gantt);\r\n\t\t\t\tif(grid.$config.id == \"grid\") {\r\n\t\t\t\t\tthis.extendDom(grid);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonDestroyed: function (grid) {\r\n\t\t\t\tif(grid.$config.id == \"grid\") {\r\n\t\t\t\t\t// GS-1288. We need to only detach the store and its events without detaching the\r\n\t\t\t\t\t// inline editor's events. Otherwise, we won't be able to access them\r\n\t\t\t\t\tgantt.ext.inlineEditors.detachStore();\r\n\t\t\t\t}\r\n\t\t\t\tthis.clearEvents(grid, gantt);\r\n\t\t\t},\r\n\r\n\t\t\tinitEvents: function (grid, gantt) {\r\n\t\t\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_row\", gantt.bind(function (e, id, trg) {\r\n\t\t\t\t\tconst config = grid.$getConfig();\r\n\t\t\t\t\tif (id !== null) {\r\n\t\t\t\t\t\tconst task = this.getTask(id);\r\n\t\t\t\t\t\tif (config.scroll_on_click) {\r\n\t\t\t\t\t\t\tconst notOpenIcon = !gantt._is_icon_open_click(e);\r\n\t\t\t\t\t\t\tconst visibleTimeline = gantt.$ui.getView(\"timeline\");\r\n\t\t\t\t\t\t\t// don't need to scroll to the date when the timeline is not visible\r\n\t\t\t\t\t\t\t// or when we click on the open/close icon\r\n\t\t\t\t\t\t\tif (notOpenIcon && visibleTimeline){\r\n\t\t\t\t\t\t\t\tthis.showDate(task.start_date);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tgantt.callEvent(\"onTaskRowClick\", [id, trg]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, gantt), grid.$grid);\r\n\r\n\t\t\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_grid_head_cell\", gantt.bind(function (e, id, trg) {\r\n\t\t\t\t\tvar column = trg.getAttribute(\"data-column-id\");\r\n\r\n\t\t\t\t\tif (!gantt.callEvent(\"onGridHeaderClick\", [column, e]))\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tvar config = grid.$getConfig();\r\n\r\n\t\t\t\t\tif (column == \"add\") {\r\n\t\t\t\t\t\tvar mouseEvents = gantt.$services.getService(\"mouseEvents\");\r\n\t\t\t\t\t\tmouseEvents.callHandler(\"click\", \"gantt_add\", grid.$grid, [e, config.root_id]);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (config.sort && column) { // GS-929: if there is no column name, we cannot sort the column\r\n\t\t\t\t\t\tvar sorting_method = column,\r\n\t\t\t\t\t\t\tconf;\r\n\r\n\t\t\t\t\t\tfor (var i = 0; i < config.columns.length; i++) {\r\n\t\t\t\t\t\t\tif (config.columns[i].name == column) {\r\n\t\t\t\t\t\t\t\tconf = config.columns[i];\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (conf && conf.sort !== undefined && conf.sort !== true) {\r\n\t\t\t\t\t\t\tsorting_method = conf.sort;\r\n\r\n\t\t\t\t\t\t\tif (!sorting_method) { // column sort property 'false', no sorting\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar sort = (this._sort && this._sort.direction && this._sort.name == column) ? this._sort.direction : \"desc\";\r\n\t\t\t\t\t\t// invert sort direction\r\n\t\t\t\t\t\tsort = (sort == \"desc\") ? \"asc\" : \"desc\";\r\n\t\t\t\t\t\tthis._sort = {\r\n\t\t\t\t\t\t\tname: column,\r\n\t\t\t\t\t\t\tdirection: sort\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis.sort(sorting_method, sort == \"desc\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}, gantt), grid.$grid);\r\n\r\n\t\t\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_add\", gantt.bind(function (e, id, trg) {\r\n\t\t\t\t\tvar config = grid.$getConfig();\r\n\t\t\t\t\tif (config.readonly) return;\r\n\r\n\t\t\t\t\tvar item = {};\r\n\t\t\t\t\tthis.createTask(item, id ? id : gantt.config.root_id);\r\n\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}, gantt), grid.$grid);\r\n\r\n\t\t\t},\r\n\r\n\t\t\tclearEvents: function(grid, gantt){\r\n\t\t\t\tthis._mouseDelegates.destructor();\r\n\t\t\t\tthis._mouseDelegates = null;\r\n\t\t\t},\r\n\r\n\t\t\textendDom: function(grid){\r\n\t\t\t\tgantt.$grid = grid.$grid;\r\n\t\t\t\tgantt.$grid_scale = grid.$grid_scale;\r\n\t\t\t\tgantt.$grid_data = grid.$grid_data;\r\n\t\t\t},\r\n\t\t\textendGantt: function(grid){\r\n\t\t\t\tgantt.getGridColumns = gantt.bind(grid.getGridColumns, grid);\r\n\r\n\t\t\t\tgrid.attachEvent(\"onColumnResizeStart\", function(){\r\n\t\t\t\t\treturn gantt.callEvent(\"onColumnResizeStart\", arguments);\r\n\t\t\t\t});\r\n\t\t\t\tgrid.attachEvent(\"onColumnResize\", function(){\r\n\t\t\t\t\treturn gantt.callEvent(\"onColumnResize\", arguments);\r\n\t\t\t\t});\r\n\t\t\t\tgrid.attachEvent(\"onColumnResizeEnd\", function(){\r\n\t\t\t\t\treturn gantt.callEvent(\"onColumnResizeEnd\", arguments);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tgrid.attachEvent(\"onColumnResizeComplete\", function(columns, totalWidth){\r\n\t\t\t\t\tgantt.config.grid_width = totalWidth;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tgrid.attachEvent(\"onBeforeRowResize\", function(){\r\n\t\t\t\t\treturn gantt.callEvent(\"onBeforeRowResize\", arguments);\r\n\t\t\t\t});\r\n\t\t\t\tgrid.attachEvent(\"onRowResize\", function(){\r\n\t\t\t\t\treturn gantt.callEvent(\"onRowResize\", arguments);\r\n\t\t\t\t});\r\n\t\t\t\tgrid.attachEvent(\"onBeforeRowResizeEnd\", function(){\r\n\t\t\t\t\treturn gantt.callEvent(\"onBeforeRowResizeEnd\", arguments);\r\n\t\t\t\t});\r\n\t\t\t\tgrid.attachEvent(\"onAfterRowResize\", function(){\r\n\t\t\t\t\treturn gantt.callEvent(\"onAfterRowResize\", arguments);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n})();\r\n\r\nexport default initializer;","import * as domHelpers from \"../utils/dom_helpers\";\r\nimport * as utils from \"../../../utils/utils\";\r\nimport timeout from \"../../../utils/timeout\";\r\nimport * as helpers from \"../../../utils/helpers\";\r\n\r\nfunction createTaskDND(timeline, gantt) {\r\n\tvar services = gantt.$services;\r\n\treturn {\r\n\t\tdrag: null,\r\n\t\tdragMultiple: {},\r\n\t\t_events: {\r\n\t\t\tbefore_start: {},\r\n\t\t\tbefore_finish: {},\r\n\t\t\tafter_finish: {}\r\n\t\t},\r\n\t\t_handlers: {},\r\n\t\tinit: function() {\r\n\t\t\tthis._domEvents = gantt._createDomEventScope();\r\n\t\t\tthis.clear_drag_state();\r\n\t\t\tvar drag = gantt.config.drag_mode;\r\n\t\t\tthis.set_actions();\r\n\r\n\t\t\tvar stateService = services.getService(\"state\");\r\n\t\t\tstateService.registerProvider(\"tasksDnd\", utils.bind(function() {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdrag_id : this.drag ? this.drag.id : undefined,\r\n\t\t\t\t\tdrag_mode : this.drag ? this.drag.mode : undefined,\r\n\t\t\t\t\tdrag_from_start : this.drag ? this.drag.left : undefined\r\n\t\t\t\t};\r\n\t\t\t}, this));\r\n\r\n\t\t\tvar evs = {\r\n\t\t\t\t\"before_start\": \"onBeforeTaskDrag\",\r\n\t\t\t\t\"before_finish\": \"onBeforeTaskChanged\",\r\n\t\t\t\t\"after_finish\": \"onAfterTaskDrag\"\r\n\t\t\t};\r\n\t\t\t//for now, all drag operations will trigger the same events\r\n\t\t\tfor (var stage in this._events) {\r\n\t\t\t\tfor (var mode in drag) {\r\n\t\t\t\t\tthis._events[stage][mode] = evs[stage];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._handlers[drag.move] = this._move;\r\n\t\t\tthis._handlers[drag.resize] = this._resize;\r\n\t\t\tthis._handlers[drag.progress] = this._resize_progress;\r\n\t\t},\r\n\t\tset_actions: function() {\r\n\t\t\tvar data = timeline.$task_data;\r\n\t\t\tthis._domEvents.attach(data, \"mousemove\", gantt.bind(function(e) {\r\n\t\t\t\tthis.on_mouse_move(e);\r\n\t\t\t}, this));\r\n\t\t\tthis._domEvents.attach(data, \"mousedown\", gantt.bind(function(e) {\r\n\t\t\t\tthis.on_mouse_down(e);\r\n\t\t\t}, this));\r\n\t\t\tthis._domEvents.attach(document.body, \"mouseup\", gantt.bind(function(e) {\r\n\t\t\t\tthis.on_mouse_up(e);\r\n\t\t\t}, this));\r\n\t\t},\r\n\r\n\t\t_getPositioningContext: function(task) {\r\n\t\t\tif(timeline._getPositioningContext) {\r\n\t\t\t\treturn timeline._getPositioningContext(task);\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\r\n\t\tclear_drag_state: function() {\r\n\t\t\tthis.drag = {\r\n\t\t\t\tid: null,\r\n\t\t\t\tmode: null,\r\n\t\t\t\tpos: null,\r\n\t\t\t\tstart_x: null,\r\n\t\t\t\tstart_y: null,\r\n\t\t\t\tobj: null,\r\n\t\t\t\tleft: null\r\n\t\t\t};\r\n\t\t\tthis.dragMultiple = {};\r\n\t\t},\r\n\t\t_resize: function(task, shift, drag) {\r\n\t\t\tvar cfg = timeline.$getConfig();\r\n\t\t\tvar coords_x = this._drag_task_coords(task, drag);\r\n\t\t\tif (drag.left) {\r\n\t\t\t\ttask.start_date = gantt.dateFromPos(coords_x.start + shift, this._getPositioningContext(task));\r\n\t\t\t\tif (!task.start_date) {\r\n\t\t\t\t\ttask.start_date = new Date(gantt.getState().min_date);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\ttask.end_date = gantt.dateFromPos(coords_x.end + shift, this._getPositioningContext(task));\r\n\t\t\t\tif (!task.end_date) {\r\n\t\t\t\t\ttask.end_date = new Date(gantt.getState().max_date);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar minDurationInUnits = this._calculateMinDuration(cfg.min_duration, cfg.duration_unit);\r\n\t\t\tif (task.end_date - task.start_date < cfg.min_duration) {\r\n\t\t\t\tif (drag.left)\r\n\t\t\t\t\ttask.start_date = gantt.calculateEndDate(task.end_date, -minDurationInUnits, cfg.duration_unit, task);\r\n\t\t\t\telse\r\n\t\t\t\t\ttask.end_date = gantt.calculateEndDate(task.start_date, minDurationInUnits, cfg.duration_unit, task);\r\n\t\t\t}\r\n\t\t\tgantt._init_task_timing(task);\r\n\t\t},\r\n\t\t_calculateMinDuration: function(duration, unit) {\r\n\t\t\tvar inMs = {\r\n\t\t\t\t\"minute\": 60000,\r\n\t\t\t\t\"hour\": 3600000,\r\n\t\t\t\t\"day\": 86400000,\r\n\t\t\t\t\"week\": 604800000,\r\n\t\t\t\t\"month\": 2419200000,\r\n\t\t\t\t\"year\": 31356000000\r\n\t\t\t};\r\n\t\t\treturn Math.ceil(duration / inMs[unit]);\r\n\t\t},\r\n\t\t_resize_progress: function(task, shift, drag) {\r\n\t\t\tvar coords_x = this._drag_task_coords(task, drag);\r\n\r\n\t\t\tvar config = timeline.$getConfig();\r\n\t\t\tvar diffValue = !config.rtl ? (drag.pos.x - coords_x.start) : (coords_x.start - drag.pos.x);\r\n\r\n\t\t\tvar diff = Math.max(0, diffValue);\r\n\t\t\ttask.progress = Math.min(1, diff / Math.abs(coords_x.end - coords_x.start));\r\n\t\t},\r\n\t\t_find_max_shift: function(dragItems, shift) {\r\n\t\t\tvar correctShift;\r\n\t\t\tfor (var i in dragItems) {\r\n\t\t\t\tvar drag = dragItems[i];\r\n\t\t\t\tvar task = gantt.getTask(drag.id);\r\n\t\t\t\tif (task.unscheduled){\r\n\t\t\t\t\t// GS-1674. There is no need to check the tasks that are ignored by projects\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar coords_x = this._drag_task_coords(task, drag);\r\n\t\t\t\tvar minX = gantt.posFromDate(new Date(gantt.getState().min_date), this._getPositioningContext(task));\r\n\t\t\t\tvar maxX = gantt.posFromDate(new Date(gantt.getState().max_date), this._getPositioningContext(task));\r\n\r\n\t\t\t\tif (coords_x.end + shift > maxX) {\r\n\t\t\t\t\tvar maxShift = maxX - coords_x.end;\r\n\t\t\t\t\tif (maxShift < correctShift || correctShift === undefined) {\r\n\t\t\t\t\t\tcorrectShift = maxShift;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (coords_x.start + shift < minX) {\r\n\t\t\t\t\tvar minShift = minX - coords_x.start;\r\n\t\t\t\t\tif (minShift > correctShift || correctShift === undefined) {\r\n\t\t\t\t\t\tcorrectShift = minShift;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn correctShift;\r\n\t\t},\r\n\t\t_move: function(task, shift, drag, multipleDragShift) {\r\n\t\t\tvar coords_x = this._drag_task_coords(task, drag);\r\n\t\t\tvar new_start = null,\r\n\t\t\tnew_end = null;\r\n\t\t\t// GS-454: If we drag multiple tasks, rely on the dates instead of timeline coordinates\r\n\t\t\tif (multipleDragShift){\r\n\t\t\t\tnew_start = new Date(+drag.obj.start_date + multipleDragShift),\r\n\t\t\t\tnew_end = new Date(+drag.obj.end_date + multipleDragShift);\r\n\t\t\t} else {\r\n\t\t\t\tnew_start = gantt.dateFromPos(coords_x.start + shift, this._getPositioningContext(task)),\r\n\t\t\t\tnew_end = gantt.dateFromPos(coords_x.end + shift, this._getPositioningContext(task));\r\n\t\t\t}\r\n\t\t\tif (!new_start) {\r\n\t\t\t\ttask.start_date = new Date(gantt.getState().min_date);\r\n\t\t\t\ttask.end_date = gantt.dateFromPos(gantt.posFromDate(task.start_date) + (coords_x.end - coords_x.start), this._getPositioningContext(task));\r\n\t\t\t} else if (!new_end) {\r\n\t\t\t\ttask.end_date = new Date(gantt.getState().max_date);\r\n\t\t\t\ttask.start_date = gantt.dateFromPos(gantt.posFromDate(task.end_date) - (coords_x.end - coords_x.start), this._getPositioningContext(task));\r\n\t\t\t} else {\r\n\t\t\t\ttask.start_date = new_start;\r\n\t\t\t\ttask.end_date = new_end;\r\n\t\t\t}\r\n\t\t},\r\n\t\t_drag_task_coords: function(t, drag) {\r\n\t\t\tvar start = drag.obj_s_x = drag.obj_s_x || gantt.posFromDate(t.start_date, this._getPositioningContext(t));\r\n\t\t\tvar end = drag.obj_e_x = drag.obj_e_x || gantt.posFromDate(t.end_date, this._getPositioningContext(t));\r\n\t\t\treturn {\r\n\t\t\t\tstart: start,\r\n\t\t\t\tend: end\r\n\t\t\t};\r\n\t\t},\r\n\t\t_mouse_position_change: function(oldPos, newPos) {\r\n\t\t\tvar dx = oldPos.x - newPos.x,\r\n\t\t\t\tdy = oldPos.y - newPos.y;\r\n\t\t\treturn Math.sqrt(dx * dx + dy * dy);\r\n\t\t},\r\n\t\t_is_number: function(n) {\r\n\t\t\treturn !isNaN(parseFloat(n)) && isFinite(n);\r\n\t\t},\r\n\r\n\t\ton_mouse_move: function(e) {\r\n\t\t\tif (this.drag.start_drag) {\r\n\t\t\t\tvar pos = domHelpers.getRelativeEventPosition(e, gantt.$task_data);\r\n\r\n\t\t\t\tvar sX = this.drag.start_drag.start_x,\r\n\t\t\t\t\tsY = this.drag.start_drag.start_y;\r\n\r\n\t\t\t\tif ((Date.now() - this.drag.timestamp > 50) ||\r\n\t\t\t\t\t(this._is_number(sX) && this._is_number(sY) && this._mouse_position_change({\r\n\t\t\t\t\t\tx: sX,\r\n\t\t\t\t\t\ty: sY\r\n\t\t\t\t\t}, pos) > 20)) {\r\n\t\t\t\t\tthis._start_dnd(e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar drag = this.drag;\r\n\r\n\t\t\tif (drag.mode) {\r\n\t\t\t\tif (!timeout(this, 40))//limit update frequency\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tthis._update_on_move(e);\r\n\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_update_item_on_move: function(shift, id, mode, drag, e, multipleDragShift) {\r\n\t\t\tvar task = gantt.getTask(id);\r\n\t\t\tvar original = gantt.mixin({}, task);\r\n\t\t\tvar copy = gantt.mixin({}, task);\r\n\t\t\tthis._handlers[mode].apply(this, [copy, shift, drag, multipleDragShift]);\r\n\t\t\tgantt.mixin(task, copy, true);\r\n\t\t\t//gantt._update_parents(drag.id, true);\r\n\t\t\tgantt.callEvent(\"onTaskDrag\", [task.id, mode, copy, original, e]);\r\n\t\t\tgantt.mixin(task, copy, true);\r\n\t\t\tgantt.refreshTask(id);\r\n\t\t},\r\n\r\n\t\t_update_on_move: function(e) {\r\n\t\t\tvar drag = this.drag;\r\n\t\t\tvar config = timeline.$getConfig();\r\n\t\t\tif (drag.mode) {\r\n\t\t\t\tvar pos = domHelpers.getRelativeEventPosition(e, timeline.$task_data);\r\n\t\t\t\tif (drag.pos && drag.pos.x == pos.x)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tdrag.pos = pos;\r\n\r\n\t\t\t\tconst task = gantt.getTask(drag.id);\r\n\r\n\t\t\t\tvar curr_date = gantt.dateFromPos(pos.x, this._getPositioningContext(task));\r\n\t\t\t\tif (!curr_date || isNaN(curr_date.getTime()))\r\n\t\t\t\t\treturn;\r\n\r\n\r\n\t\t\t\tvar shift = pos.x - drag.start_x;\r\n\t\t\t\t\r\n\t\t\t\tif (this._handlers[drag.mode]) {\r\n\t\t\t\t\tif (drag.mode === config.drag_mode.move) {\r\n\t\t\t\t\t\tvar dragHash = {};\r\n\r\n\t\t\t\t\t\tif (this._isMultiselect()) {\r\n\t\t\t\t\t\t\tvar selectedTasksIds = gantt.getSelectedTasks();\r\n\t\t\t\t\t\t\tif (selectedTasksIds.indexOf(drag.id) >= 0) {\r\n\t\t\t\t\t\t\t\tdragHash = this.dragMultiple;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar dragProject = false;\r\n\t\t\t\t\t\tif (gantt.isSummaryTask(task) && gantt.config.drag_project) {\r\n\t\t\t\t\t\t\tvar initialDrag = {};\r\n\t\t\t\t\t\t\tinitialDrag[drag.id] = utils.copy(drag);\r\n\t\t\t\t\t\t\tdragProject = true;\r\n\t\t\t\t\t\t\tdragHash = utils.mixin(initialDrag, this.dragMultiple);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar maxShift = this._find_max_shift(dragHash, shift);\r\n\t\t\t\t\t\tif (maxShift !== undefined) {\r\n\t\t\t\t\t\t\tshift = maxShift;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis._update_item_on_move(shift, drag.id, drag.mode, drag, e);\r\n\r\n\t\t\t\t\t\tlet multipleDragShift;\r\n\t\t\t\t\t\tif (maxShift === undefined) {\r\n\t\t\t\t\t\t\t// GS-2593. If the timeline is repainted during the drag (infinite scale scenario)\r\n\t\t\t\t\t\t\t// we need to update the initial drag position to correctly update\r\n\t\t\t\t\t\t\t// the position of other dragged tasks\r\n\t\t\t\t\t\t\tconst newStartPos = gantt.posFromDate(drag.obj.start_date, this._getPositioningContext(drag.obj));\r\n\t\t\t\t\t\t\tconst newEndPos = gantt.posFromDate(drag.obj.end_date, this._getPositioningContext(drag.obj));\r\n\t\t\t\t\t\t\t// calculate the offset only when the drag started\r\n\t\t\t\t\t\t\tif (drag.handle_offset === undefined){\r\n\t\t\t\t\t\t\t\tconst width = newEndPos - newStartPos;\r\n\t\t\t\t\t\t\t\tconst dragPos = drag.start_x - newStartPos;\r\n\t\t\t\t\t\t\t\tdrag.handle_offset = dragPos / width;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconst newWidth = Math.abs(newEndPos - newStartPos);\r\n\t\t\t\t\t\t\tlet dragX = newStartPos + newWidth * drag.handle_offset;\r\n\r\n\t\t\t\t\t\t\t// GS-454: Calculate the date shift in milliseconds instead of pixels\r\n\t\t\t\t\t\t\tconst shiftDate = gantt.dateFromPos(dragX, this._getPositioningContext(drag.obj));\r\n\t\t\t\t\t\t\tmultipleDragShift = curr_date - shiftDate;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor (var i in dragHash) {\r\n\t\t\t\t\t\t\tvar childDrag = dragHash[i];\r\n\t\t\t\t\t\t\tif(dragProject && childDrag.id != drag.id){\r\n\t\t\t\t\t\t\t\tgantt._bulk_dnd = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis._update_item_on_move(shift, childDrag.id, childDrag.mode, childDrag, e, multipleDragShift);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tgantt._bulk_dnd = false;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// for resize and progress\r\n\t\t\t\t\t\tthis._update_item_on_move(shift, drag.id, drag.mode, drag, e);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgantt._update_parents(drag.id);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\ton_mouse_down: function(e, src) {\r\n\t\t\t// on Mac we do not get onmouseup event when clicking right mouse button leaving us in dnd state\r\n\t\t\t// let's ignore right mouse button then\r\n\t\t\tif (e.button == 2 && e.button !== undefined)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tvar config = timeline.$getConfig();\r\n\t\t\tvar id = gantt.locate(e);\r\n\t\t\tvar task = null;\r\n\t\t\tif (gantt.isTaskExists(id)) {\r\n\t\t\t\ttask = gantt.getTask(id);\r\n\t\t\t}\r\n\r\n\t\t\tif (gantt.isReadonly(task) || this.drag.mode) return;\r\n\r\n\t\t\tthis.clear_drag_state();\r\n\r\n\t\t\tsrc = src || (e.target || e.srcElement);\r\n\r\n\t\t\tvar className = domHelpers.getClassName(src);\r\n\t\t\tvar drag = this._get_drag_mode(className, src);\r\n\r\n\t\t\tif (!className || !drag) {\r\n\t\t\t\tif (src.parentNode)\r\n\t\t\t\t\treturn this.on_mouse_down(e, src.parentNode);\r\n\t\t\t\telse\r\n\t\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (!drag) {\r\n\t\t\t\tif (gantt.checkEvent(\"onMouseDown\") && gantt.callEvent(\"onMouseDown\", [className.split(\" \")[0]])) {\r\n\t\t\t\t\tif (src.parentNode)\r\n\t\t\t\t\t\treturn this.on_mouse_down(e, src.parentNode);\r\n\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (drag.mode && drag.mode != config.drag_mode.ignore && config[\"drag_\" + drag.mode]) {\r\n\t\t\t\t\tid = gantt.locate(src);\r\n\t\t\t\t\ttask = gantt.copy(gantt.getTask(id) || {});\r\n\r\n\t\t\t\t\tif (gantt.isReadonly(task)) {\r\n\t\t\t\t\t\tthis.clear_drag_state();\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ((gantt.isSummaryTask(task) && !(task.auto_scheduling === false) && !config.drag_project) && drag.mode != config.drag_mode.progress) {//only progress drag is allowed for tasks with flexible duration\r\n\t\t\t\t\t\tthis.clear_drag_state();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdrag.id = id;\r\n\t\t\t\t\tvar pos = domHelpers.getRelativeEventPosition(e, gantt.$task_data);\r\n\r\n\t\t\t\t\tdrag.start_x = pos.x;\r\n\t\t\t\t\tdrag.start_y = pos.y;\r\n\t\t\t\t\tdrag.obj = task;\r\n\t\t\t\t\tthis.drag.start_drag = drag;\r\n\t\t\t\t\tthis.drag.timestamp = Date.now();\r\n\r\n\t\t\t\t} else\r\n\t\t\t\t\tthis.clear_drag_state();\r\n\t\t\t}\r\n\t\t},\r\n\t\t_fix_dnd_scale_time: function(task, drag) {\r\n\t\t\tvar config = timeline.$getConfig();\r\n\t\t\tvar unit = gantt.getScale().unit,\r\n\t\t\t\tstep = gantt.getScale().step;\r\n\t\t\tif (!config.round_dnd_dates) {\r\n\t\t\t\tunit = 'minute';\r\n\t\t\t\tstep = config.time_step;\r\n\t\t\t}\r\n\r\n\t\t\tfunction fixStart(task) {\r\n\t\t\t\tif (!gantt.config.correct_work_time)\r\n\t\t\t\t\treturn;\r\n\t\t\t\tvar config = timeline.$getConfig();\r\n\t\t\t\tif (!gantt.isWorkTime(task.start_date, undefined, task))\r\n\t\t\t\t\ttask.start_date = gantt.calculateEndDate({\r\n\t\t\t\t\t\tstart_date: task.start_date,\r\n\t\t\t\t\t\tduration: -1,\r\n\t\t\t\t\t\tunit: config.duration_unit,\r\n\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfunction fixEnd(task) {\r\n\t\t\t\tif (!gantt.config.correct_work_time)\r\n\t\t\t\t\treturn;\r\n\t\t\t\tvar config = timeline.$getConfig();\r\n\t\t\t\tif (!gantt.isWorkTime(new Date(task.end_date - 1), undefined, task))\r\n\t\t\t\t\ttask.end_date = gantt.calculateEndDate({\r\n\t\t\t\t\t\tstart_date: task.end_date,\r\n\t\t\t\t\t\tduration: 1,\r\n\t\t\t\t\t\tunit: config.duration_unit,\r\n\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tconst dndContext = timeline._getPositioningContext(task);\r\n\r\n\t\t\tif (drag.mode == config.drag_mode.resize) {\r\n\t\t\t\tif (drag.left) {\r\n\t\t\t\t\ttask.start_date = gantt.roundDate({date: task.start_date, unit: unit, step: step});\r\n\t\r\n\t\t\t\t\tif(dndContext && dndContext.calendar){\r\n\t\t\t\t\t\ttask.start_date = dndContext.calendar.getClosestWorkTime({date: task.start_date, dir:\"future\"});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfixStart(task);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttask.end_date = gantt.roundDate({date: task.end_date, unit: unit, step: step});\r\n\t\t\t\t\tif(dndContext && dndContext.calendar){\r\n\t\t\t\t\t\ttask.end_date = dndContext.calendar.getClosestWorkTime({date: task.end_date});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfixEnd(task);\r\n\t\t\t\t}\r\n\t\t\t} else if (drag.mode == config.drag_mode.move) {\r\n\t\t\t\ttask.start_date = gantt.roundDate({date: task.start_date, unit: unit, step: step});\r\n\t\t\t\t\r\n\t\t\t\tif(dndContext && dndContext.calendar){\r\n\t\t\t\t\ttask.start_date = dndContext.calendar.getClosestWorkTime({date: task.start_date, dir:\"future\"});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfixStart(task);\r\n\t\t\t\ttask.end_date = gantt.calculateEndDate(task);\r\n\t\t\t}\r\n\t\t},\r\n\t\t_fix_working_times: function(task, drag) {\r\n\t\t\tvar config = timeline.$getConfig();\r\n\t\t\tvar drag = drag || {mode: config.drag_mode.move};\r\n\r\n\t\t\tif (drag.mode == config.drag_mode.resize) {\r\n\t\t\t\tif (drag.left) {\r\n\t\t\t\t\ttask.start_date = gantt.getClosestWorkTime({date: task.start_date, dir: 'future', task: task});\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttask.end_date = gantt.getClosestWorkTime({date: task.end_date, dir: 'past', task: task});\r\n\t\t\t\t}\r\n\t\t\t} else if (drag.mode == config.drag_mode.move) {\r\n\t\t\t\tgantt.correctTaskWorkTime(task);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_finalize_mouse_up: function(taskId, config, drag, e) {\r\n\t\t\tvar task = gantt.getTask(taskId);\r\n\r\n\t\t\tif (config.work_time && config.correct_work_time) {\r\n\t\t\t\tthis._fix_working_times(task, drag);\r\n\t\t\t}\r\n\r\n\t\t\tthis._fix_dnd_scale_time(task, drag);\r\n\r\n\t\t\tif (!this._fireEvent(\"before_finish\", drag.mode, [taskId, drag.mode, gantt.copy(drag.obj), e])) {\r\n\t\t\t\t//drag.obj._dhx_changed = false;\r\n\t\t\t\tthis.clear_drag_state();\r\n\t\t\t\tif (taskId == drag.id) {\r\n\t\t\t\t\tdrag.obj._dhx_changed = false;\r\n\t\t\t\t\tgantt.mixin(task, drag.obj, true);\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tgantt.refreshTask(task.id);\r\n\t\t\t\t// GS-2013. Repaint parent projects when the drag is cancelled\r\n\t\t\t\tif (task.$level > 100){\r\n\t\t\t\t\t// When there are too many tasks to repaint, it is better to repaint Gantt\r\n\t\t\t\t\tlet shouldRepaint = false;\r\n\t\t\t\t\tgantt.eachParent(function(parent){\r\n\t\t\t\t\t\tif (!shouldRepaint && parent.type === gantt.config.types.project) {\r\n\t\t\t\t\t\t\tconst initialDates = {start_date: parent.start_date, end_date: parent.end_date};\r\n\t\t\t\t\t\t\tgantt.resetProjectDates(parent);\r\n\t\t\t\t\t\t\tif (+initialDates.start_date !== +parent.start_date || +initialDates.end_date !== +parent.end_date){\r\n\t\t\t\t\t\t\t\tshouldRepaint = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},task.id);\r\n\t\t\t\t\tif (shouldRepaint){\r\n\t\t\t\t\t\tgantt.refreshData();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// If there are not so many parents especially if there are split tasks,\r\n\t\t\t\t\t// it is better to repaint individual tasks\r\n\t\t\t\t\tgantt.eachParent(function(parent){\r\n\t\t\t\t\t\tif (parent.type === gantt.config.types.project) {\r\n\t\t\t\t\t\t\tconst initialDates = {start_date: parent.start_date, end_date: parent.end_date};\r\n\t\t\t\t\t\t\tgantt.resetProjectDates(parent);\r\n\t\t\t\t\t\t\tif (+initialDates.start_date !== +parent.start_date || +initialDates.end_date !== +parent.end_date){\r\n\t\t\t\t\t\t\t\tgantt.refreshTask(parent.id);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},task.id);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar drag_id = taskId;\r\n\r\n\t\t\t\tgantt._init_task_timing(task);\r\n\r\n\t\t\t\tthis.clear_drag_state();\r\n\t\t\t\tgantt.updateTask(task.id);\r\n\t\t\t\tthis._fireEvent(\"after_finish\", drag.mode, [drag_id, drag.mode, e]);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\ton_mouse_up: function(e) {\r\n\r\n\t\t\tvar drag = this.drag;\r\n\t\t\tif (drag.mode && drag.id) {\r\n\t\t\t\tvar config = timeline.$getConfig();\r\n\t\t\t\t//drop\r\n\t\t\t\tvar task = gantt.getTask(drag.id);\r\n\t\t\t\tvar dragMultiple = this.dragMultiple;\r\n\r\n\t\t\t\tvar finalizingBulkMove = false;\r\n\t\t\t\tvar moveCount = 0;\r\n\t\t\t\tif (drag.mode === config.drag_mode.move) {\r\n\t\t\t\t\tif ((gantt.isSummaryTask(task) && config.drag_project) || (this._isMultiselect())) {\r\n\t\t\t\t\t\tfinalizingBulkMove = true;\r\n\t\t\t\t\t\tmoveCount = Object.keys(dragMultiple).length;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar doFinalize = function doFinalize(){\r\n\t\t\t\t\tif(finalizingBulkMove){\r\n\t\t\t\t\t\tfor (var i in dragMultiple) {\r\n\t\t\t\t\t\t\t// GS-1057: Don't call drag events for the dragged task as they will be called later\r\n\t\t\t\t\t\t\tif (dragMultiple[i].id != drag.id){\r\n\t\t\t\t\t\t\t\tthis._finalize_mouse_up(dragMultiple[i].id, config, dragMultiple[i], e);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._finalize_mouse_up(drag.id, config, drag, e);\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(finalizingBulkMove && moveCount > 10){// 10 - arbitrary threshold for bulk dnd at which we start doing complete repaint to refresh\r\n\t\t\t\t\tgantt.batchUpdate(function(){\r\n\t\t\t\t\t\tdoFinalize.call(this);\r\n\t\t\t\t\t}.bind(this));\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdoFinalize.call(this);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\tthis.clear_drag_state();\r\n\t\t},\r\n\t\t_get_drag_mode: function(className, el) {\r\n\t\t\tvar config = timeline.$getConfig();\r\n\t\t\tvar modes = config.drag_mode;\r\n\t\t\tvar classes = (className || \"\").split(\" \");\r\n\t\t\tvar classname = classes[0];\r\n\t\t\tvar drag = {mode: null, left: null};\r\n\t\t\tswitch (classname) {\r\n\t\t\t\tcase \"gantt_task_line\":\r\n\t\t\t\tcase \"gantt_task_content\":\r\n\t\t\t\t\tdrag.mode = modes.move;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"gantt_task_drag\":\r\n\t\t\t\t\tdrag.mode = modes.resize;\r\n\r\n\t\t\t\t\tvar dragProperty = el.getAttribute(\"data-bind-property\");\r\n\r\n\t\t\t\t\tif (dragProperty == \"start_date\") {\r\n\t\t\t\t\t\tdrag.left = true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdrag.left = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"gantt_task_progress_drag\":\r\n\t\t\t\t\tdrag.mode = modes.progress;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"gantt_link_control\":\r\n\t\t\t\tcase \"gantt_link_point\":\r\n\t\t\t\t\tdrag.mode = modes.ignore;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tdrag = null;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\treturn drag;\r\n\r\n\t\t},\r\n\r\n\t\t_start_dnd: function(e) {\r\n\t\t\tvar drag = this.drag = this.drag.start_drag;\r\n\t\t\tdelete drag.start_drag;\r\n\r\n\t\t\tvar cfg = timeline.$getConfig();\r\n\t\t\tvar id = drag.id;\r\n\r\n\t\t\tif (!cfg[\"drag_\" + drag.mode] || !gantt.callEvent(\"onBeforeDrag\", [id, drag.mode, e]) || !this._fireEvent(\"before_start\", drag.mode, [id, drag.mode, e])) {\r\n\t\t\t\tthis.clear_drag_state();\r\n\t\t\t} else {\r\n\t\t\t\tdelete drag.start_drag;\r\n\t\t\t\tvar task = gantt.getTask(id);\r\n\t\t\t\tif (gantt.isReadonly(task)){\r\n\t\t\t\t\tthis.clear_drag_state();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (this._isMultiselect()) {\r\n\t\t\t\t\t// for don't move selected tasks when drag unselected task\r\n\t\t\t\t\tvar selectedTasksIds = gantt.getSelectedTasks();\r\n\t\t\t\t\tif (selectedTasksIds.indexOf(drag.id) >= 0) {\r\n\t\t\t\t\t\thelpers.forEach(selectedTasksIds, gantt.bind(function(taskId) {\r\n\t\t\t\t\t\t\tvar selectedTask = gantt.getTask(taskId);\r\n\t\t\t\t\t\t\tif (gantt.isSummaryTask(selectedTask) && gantt.config.drag_project && drag.mode == cfg.drag_mode.move) {\r\n\t\t\t\t\t\t\t\tthis._addSubtasksToDragMultiple(selectedTask.id);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis.dragMultiple[taskId] = gantt.mixin({\r\n\t\t\t\t\t\t\t\tid: selectedTask.id,\r\n\t\t\t\t\t\t\t\tobj: gantt.copy(selectedTask)\r\n\t\t\t\t\t\t\t}, this.drag);\r\n\t\t\t\t\t\t}, this));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// for move unselected summary\r\n\t\t\t\tif (gantt.isSummaryTask(task) && gantt.config.drag_project && drag.mode == cfg.drag_mode.move) {\r\n\t\t\t\t\tthis._addSubtasksToDragMultiple(task.id);\r\n\t\t\t\t}\r\n\t\t\t\tgantt.callEvent(\"onTaskDragStart\", []);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\t_fireEvent: function(stage, mode, params) {\r\n\t\t\tgantt.assert(this._events[stage], \"Invalid stage:{\" + stage + \"}\");\r\n\r\n\t\t\tvar trigger = this._events[stage][mode];\r\n\r\n\t\t\tgantt.assert(trigger, \"Unknown after drop mode:{\" + mode + \"}\");\r\n\t\t\tgantt.assert(params, \"Invalid event arguments\");\r\n\r\n\r\n\t\t\tif (!gantt.checkEvent(trigger))\r\n\t\t\t\treturn true;\r\n\r\n\t\t\treturn gantt.callEvent(trigger, params);\r\n\t\t},\r\n\r\n\t\tround_task_dates: function(task) {\r\n\t\t\tvar drag_state = this.drag;\r\n\t\t\tvar config = timeline.$getConfig();\r\n\t\t\tif (!drag_state) {\r\n\t\t\t\tdrag_state = {mode: config.drag_mode.move};\r\n\t\t\t}\r\n\t\t\tthis._fix_dnd_scale_time(task, drag_state);\r\n\t\t},\r\n\t\tdestructor: function() {\r\n\t\t\tthis._domEvents.detachAll();\r\n\t\t},\r\n\t\t_isMultiselect: function() {\r\n\t\t\treturn gantt.config.drag_multiple && !!(gantt.getSelectedTasks && gantt.getSelectedTasks().length > 0);\r\n\t\t},\r\n\t\t_addSubtasksToDragMultiple: function(summaryId) {\r\n\t\t\tgantt.eachTask(function(child) {\r\n\t\t\t\tthis.dragMultiple[child.id] = gantt.mixin({\r\n\t\t\t\t\tid: child.id,\r\n\t\t\t\t\tobj: gantt.copy(child)\r\n\t\t\t\t}, this.drag);\r\n\t\t\t}, summaryId, this);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction initTaskDND() {\r\n\tvar _tasks_dnd;\r\n\treturn {\r\n\t\textend: function(timeline) {\r\n\t\t\ttimeline.roundTaskDates = function(task) {\r\n\t\t\t\t_tasks_dnd.round_task_dates(task);\r\n\t\t\t};\r\n\r\n\t\t},\r\n\t\tinit: function(timeline, gantt) {\r\n\t\t\t_tasks_dnd = createTaskDND(timeline, gantt);\r\n\t\t\t// TODO: entry point for touch handlers, move touch to timeline\r\n\t\t\ttimeline._tasks_dnd = _tasks_dnd;\r\n\t\t\treturn _tasks_dnd.init(gantt);\r\n\t\t},\r\n\t\tdestructor: function() {\r\n\t\t\tif (_tasks_dnd) {\r\n\t\t\t\t_tasks_dnd.destructor();\r\n\t\t\t\t_tasks_dnd = null;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default {\r\n\tcreateTaskDND: initTaskDND\r\n};","import * as domHelpers from \"../utils/dom_helpers\";\r\n\r\nvar initLinksDND = function(timeline, gantt) {\r\n\tvar _link_landing,\r\n\t\t_link_target_task,\r\n\t\t_link_target_task_start,\r\n\t\t_link_source_task,\r\n\t\t_link_source_task_start,\r\n\t\tmarkerDefaultOffset = 10,\r\n\t\tscrollDefaultSize = 18;\r\n\r\n\tfunction getDndState(){\r\n\t\treturn {\r\n\t\t\tlink_source_id : _link_source_task,\r\n\t\t\tlink_target_id : _link_target_task,\r\n\t\t\tlink_from_start : _link_source_task_start,\r\n\t\t\tlink_to_start : _link_target_task_start,\r\n\t\t\tlink_landing_area : _link_landing\r\n\t\t};\r\n\t}\r\n\r\n\tvar services = gantt.$services;\r\n\r\n\tvar state = services.getService(\"state\");\r\n\tvar DnD = services.getService(\"dnd\");\r\n\r\n\tstate.registerProvider(\"linksDnD\", getDndState);\r\n\r\n\tvar start_marker = \"task_start_date\",\r\n\t\tend_marker = \"task_end_date\",\r\n\t\tlink_edge_marker = \"gantt_link_point\",\r\n\t\tlink_landing_hover_area = \"gantt_link_control\";\r\n\r\n\tvar dnd = new DnD(timeline.$task_bars, {\r\n\t\tsensitivity : 0,\r\n\t\tupdates_per_second : 60,\r\n\t\tmousemoveContainer: gantt.$root,\r\n\t\tselector: \".\" + link_edge_marker,\r\n\t\tpreventDefault: true\r\n\t});\r\n\r\n\tdnd.attachEvent(\"onBeforeDragStart\", gantt.bind(function(obj,e) {\r\n\t\tvar target = (e.target||e.srcElement);\r\n\t\tresetDndState();\r\n\t\tif(gantt.getState(\"tasksDnd\").drag_id)\r\n\t\t\treturn false;\r\n\r\n\t\tif(domHelpers.locateClassName(target, link_edge_marker)){\r\n\t\t\tif(domHelpers.locateClassName(target, start_marker))\r\n\t\t\t\t_link_source_task_start = true;\r\n\r\n\t\t\tvar sid = gantt.locate(e);\r\n\t\t\t_link_source_task = sid;\r\n\r\n\t\t\tvar t = gantt.getTask(sid);\r\n\t\t\tif(gantt.isReadonly(t)){\r\n\t\t\t\tresetDndState();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tthis._dir_start = {\r\n\t\t\t\tx: dnd.config.original_element_sizes.x + dnd.config.original_element_sizes.width/2,\r\n\t\t\t\ty: dnd.config.original_element_sizes.y + dnd.config.original_element_sizes.height/2\r\n\t\t\t};\r\n\r\n\t\t\treturn true;\r\n\t\t}else{\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t}, this));\r\n\r\n\tdnd.attachEvent(\"onAfterDragStart\", gantt.bind(function(obj,e) {\r\n\t\tif(gantt.config.touch) {\r\n\t\t\tgantt.refreshData();\r\n\t\t}\r\n\t\tupdateMarkedHtml(dnd.config.marker);\r\n\t}, this));\r\n\r\n\tfunction getVieportSize(){\r\n\t\tvar root = gantt.$root;\r\n\t\treturn { right: root.offsetWidth, bottom: root.offsetHeight };\r\n\t}\r\n\tfunction getMarkerSize (marker){\r\n\t\tvar width = 0, height = 0;\r\n\t\tif(marker){\r\n\t\t\twidth = marker.offsetWidth || 0;\r\n\t\t\theight = marker.offsetHeight || 0;\r\n\t\t}\r\n\t\treturn { width: width, height: height };\r\n\t}\r\n\r\n\tfunction getPosition(e, marker){\r\n\t\tvar oldPos = dnd.getPosition(e);\r\n\r\n\t\tvar markerSize = getMarkerSize(marker);\r\n\t\tvar viewportSize = getVieportSize();\r\n\r\n\t\tvar offsetX = gantt.config.tooltip_offset_x || markerDefaultOffset;\r\n\t\tvar offsetY = gantt.config.tooltip_offset_y || markerDefaultOffset;\r\n\r\n\t\tvar scrollSize = gantt.config.scroll_size || scrollDefaultSize;\r\n\r\n\t\t// GS-1315: Add offset if there are elements above Gantt\r\n\t\tvar ganttOffsetY = gantt.$container.getBoundingClientRect().y + window.scrollY;\r\n\r\n\t\tvar position = {\r\n\t\t\ty: oldPos.y + offsetY,\r\n\t\t\tx: oldPos.x + offsetX,\r\n\t\t\tbottom: oldPos.y + markerSize.height + offsetY + scrollSize,\r\n\t\t\tright: oldPos.x + markerSize.width + offsetX + scrollSize\r\n\t\t};\r\n\r\n\t\tif(position.bottom > viewportSize.bottom + ganttOffsetY){\r\n\t\t\tposition.y = viewportSize.bottom + ganttOffsetY - markerSize.height - offsetY;\r\n\t\t}\r\n\r\n\t\tif(position.right > viewportSize.right){\r\n\t\t\tposition.x = viewportSize.right - markerSize.width - offsetX;\r\n\t\t}\r\n\t\treturn position;\r\n\t}\r\n\r\n\tdnd.attachEvent(\"onDragMove\", gantt.bind(function(obj,e, actualTarget) {\r\n\t\tvar dd = dnd.config;\r\n\t\tvar pos = getPosition(e, dd.marker);\r\n\t\tadvanceMarker(dd.marker, pos);\r\n\t\tvar landing = !!domHelpers.locateClassName(e, link_landing_hover_area);\r\n\r\n\t\tvar prevTarget = _link_target_task;\r\n\t\tvar prevLanding = _link_landing;\r\n\t\tvar prevToStart = _link_target_task_start;\r\n\r\n\t\tlet to_start = true;\r\n\t\tlet targ;\r\n\t\tif (e.target.shadowRoot && actualTarget){\r\n\t\t\ttarg = actualTarget;\r\n\t\t} else {\r\n\t\t\ttarg = gantt.locate(e);\r\n\t\t}\r\n\r\n\t\t// can drag and drop link to another gantt on the page, such links are not supported\r\n\t\tvar eventTarget = domHelpers.getTargetNode(e);\r\n\r\n\t\tvar sameGantt = domHelpers.isChildOf(eventTarget, gantt.$root);\r\n\t\tif(!sameGantt){\r\n\t\t\tlanding = false;\r\n\t\t\ttarg = null;\r\n\t\t}\r\n\r\n\t\tif(landing){\r\n\t\t\t//refreshTask\r\n\t\t\tto_start = !domHelpers.locateClassName(e, end_marker);\r\n\t\t\tlanding = !!targ;\r\n\t\t}\r\n\r\n\t\t_link_target_task = targ;\r\n\t\t_link_landing = landing;\r\n\t\t_link_target_task_start = to_start;\r\n\r\n\t\tif(landing){\r\n\r\n\t\t\tvar node = domHelpers.locateClassName(e, link_landing_hover_area);\r\n\t\t\r\n\t\t\tconst point = node.querySelector(`.${link_edge_marker}`);\r\n\t\t\tif(point){\r\n\t\t\t\tconst absCoords = domHelpers.getRelativeNodePosition(point, timeline.$task_bg);\r\n\t\t\t\tthis._dir_end = {\r\n\t\t\t\t\tx: absCoords.x + point.offsetWidth/2,\r\n\t\t\t\t\ty: absCoords.y + point.offsetHeight/2\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t}else{\r\n\t\t\tthis._dir_end = domHelpers.getRelativeEventPosition(e, timeline.$task_data);\r\n\t\t\tif(gantt.env.isEdge){ // to fix margin collapsing\r\n\t\t\t\tthis._dir_end.y += window.scrollY;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar targetChanged = !(prevLanding == landing && prevTarget == targ && prevToStart == to_start);\r\n\t\tif(targetChanged){\r\n\t\t\tif(prevTarget)\r\n\t\t\t\tgantt.refreshTask(prevTarget, false);\r\n\t\t\tif(targ)\r\n\t\t\t\tgantt.refreshTask(targ, false);\r\n\t\t}\r\n\r\n\t\tif(targetChanged){\r\n\t\t\tupdateMarkedHtml(dd.marker);\r\n\t\t}\r\n\r\n\t\tshowDirectingLine(this._dir_start.x, this._dir_start.y, this._dir_end.x, this._dir_end.y);\r\n\r\n\t\treturn true;\r\n\t}, this));\r\n\r\n\r\n\tdnd.attachEvent(\"onDragEnd\", gantt.bind(function() {\r\n\t\tvar drag = getDndState();\r\n\r\n\t\tif(drag.link_source_id && drag.link_target_id && drag.link_source_id != drag.link_target_id){\r\n\t\t\tvar type = gantt._get_link_type(drag.link_from_start, drag.link_to_start);\r\n\r\n\t\t\tvar link = {source : drag.link_source_id, target: drag.link_target_id, type:type};\r\n\t\t\tif(link.type && gantt.isLinkAllowed(link)) {\r\n\t\t\t\tif(gantt.callEvent(\"onLinkCreated\", [link])){\r\n\t\t\t\t\tgantt.addLink(link);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tresetDndState();\r\n\r\n\t\tif(gantt.config.touch) {\r\n\t\t\tgantt.refreshData();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (drag.link_source_id)\r\n\t\t\t\tgantt.refreshTask(drag.link_source_id, false);\r\n\t\t\tif (drag.link_target_id)\r\n\t\t\t\tgantt.refreshTask(drag.link_target_id, false);\r\n\t\t}\r\n\t\tremoveDirectionLine();\r\n\t}, this));\r\n\r\n\tfunction updateMarkedHtml(marker){\r\n\t\tvar link = getDndState();\r\n\r\n\t\tvar css = [\"gantt_link_tooltip\"];\r\n\t\tif(link.link_source_id && link.link_target_id){\r\n\t\t\tif(gantt.isLinkAllowed(link.link_source_id, link.link_target_id, link.link_from_start, link.link_to_start)){\r\n\t\t\t\tcss.push(\"gantt_allowed_link\");\r\n\t\t\t}else{\r\n\t\t\t\tcss.push(\"gantt_invalid_link\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar className = gantt.templates.drag_link_class(link.link_source_id, link.link_from_start, link.link_target_id, link.link_to_start);\r\n\t\tif(className)\r\n\t\t\tcss.push(className);\r\n\r\n\t\tvar html = \"<div class='\"+className+ \"'>\" +\r\n\t\t\tgantt.templates.drag_link(link.link_source_id, link.link_from_start, link.link_target_id, link.link_to_start) +\r\n\t\t\t\"</div>\";\r\n\t\tmarker.innerHTML = html;\r\n\t}\r\n\r\n\tfunction advanceMarker(marker, pos){\r\n\t\tmarker.style.left = pos.x + \"px\";\r\n\t\tmarker.style.top = pos.y + \"px\";\r\n\t}\r\n\r\n\tfunction resetDndState(){\r\n\t\t_link_source_task =\r\n\t\t\t_link_source_task_start =\r\n\t\t\t\t_link_target_task = null;\r\n\t\t_link_target_task_start = true;\r\n\t}\r\n\tfunction showDirectingLine(s_x, s_y, e_x, e_y){\r\n\t\tvar div = getDirectionLine();\r\n\r\n\t\tvar link = getDndState();\r\n\r\n\t\tvar css = [\"gantt_link_direction\"];\r\n\t\tif(gantt.templates.link_direction_class){\r\n\t\t\tcss.push(gantt.templates.link_direction_class(link.link_source_id, link.link_from_start, link.link_target_id, link.link_to_start));\r\n\t\t}\r\n\r\n\t\tvar dist =Math.sqrt( (Math.pow(e_x - s_x, 2)) + (Math.pow(e_y - s_y, 2)) );\r\n\t\tdist = Math.max(0, dist - 3);\r\n\t\tif(!dist)\r\n\t\t\treturn;\r\n\r\n\t\tdiv.className = css.join(\" \");\r\n\t\tvar tan = (e_y - s_y)/(e_x - s_x),\r\n\t\t\tangle = Math.atan(tan);\r\n\r\n\t\tif(coordinateCircleQuarter(s_x, e_x, s_y, e_y) == 2){\r\n\t\t\tangle += Math.PI;\r\n\t\t}else if(coordinateCircleQuarter(s_x, e_x, s_y, e_y) == 3){\r\n\t\t\tangle -= Math.PI;\r\n\t\t}\r\n\r\n\r\n\r\n\t\tvar sin = Math.sin(angle),\r\n\t\t\tcos = Math.cos(angle),\r\n\t\t\ttop = Math.round(s_y),\r\n\t\t\tleft = Math.round(s_x);\r\n\r\n\r\n\t\tvar style = [\r\n\t\t\t\"-webkit-transform: rotate(\"+angle+\"rad)\",\r\n\t\t\t\"-moz-transform: rotate(\"+angle+\"rad)\",\r\n\t\t\t\"-ms-transform: rotate(\"+angle+\"rad)\",\r\n\t\t\t\"-o-transform: rotate(\"+angle+\"rad)\",\r\n\t\t\t\"transform: rotate(\"+angle+\"rad)\",\r\n\t\t\t\"width:\" + Math.round(dist) + \"px\"\r\n\t\t];\r\n\r\n\t\tif(window.navigator.userAgent.indexOf(\"MSIE 8.0\") != -1){\r\n\t\t\t//ms-filter breaks styles in ie9, so add it only for 8th\r\n\t\t\tstyle.push(\"-ms-filter: \\\"\" + ieTransform(sin, cos) + \"\\\"\");\r\n\r\n\t\t\tvar shiftLeft = Math.abs(Math.round(s_x - e_x)),\r\n\t\t\t\tshiftTop = Math.abs(Math.round(e_y - s_y));\r\n\t\t\t//fix rotation axis\r\n\t\t\tswitch(coordinateCircleQuarter(s_x, e_x, s_y, e_y)){\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\ttop -= shiftTop;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tleft -= shiftLeft;\r\n\t\t\t\t\ttop -= shiftTop;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tleft -= shiftLeft;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tstyle.push(\"top:\" +  top + \"px\");\r\n\t\tstyle.push(\"left:\" +  left + \"px\");\r\n\r\n\t\tdiv.style.cssText = style.join(\";\");\r\n\t}\r\n\r\n\tfunction ieTransform(sin, cos){\r\n\t\treturn \"progid:DXImageTransform.Microsoft.Matrix(\"+\r\n\t\t\t\"M11 = \"+cos+\",\"+\r\n\t\t\t\"M12 = -\"+sin+\",\"+\r\n\t\t\t\"M21 = \"+sin+\",\"+\r\n\t\t\t\"M22 = \"+cos+\",\"+\r\n\t\t\t\"SizingMethod = 'auto expand'\"+\r\n\t\t\")\";\r\n\t}\r\n\tfunction coordinateCircleQuarter(sX, eX, sY, eY){\r\n\t\tif(eX >= sX){\r\n\t\t\tif(eY <= sY){\r\n\t\t\t\treturn 1;\r\n\t\t\t}else{\r\n\t\t\t\treturn 4;\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tif(eY <= sY){\r\n\t\t\t\treturn 2;\r\n\t\t\t}else{\r\n\t\t\t\treturn 3;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\tfunction getDirectionLine(){\r\n\t\tif(!dnd._direction || !dnd._direction.parentNode){\r\n\t\t\tdnd._direction = document.createElement(\"div\");\r\n\t\t\ttimeline.$task_links.appendChild(dnd._direction);\r\n\t\t}\r\n\t\treturn dnd._direction;\r\n\t}\r\n\tfunction removeDirectionLine(){\r\n\t\tif(dnd._direction){\r\n\t\t\tif (dnd._direction.parentNode)\t//the event line can be detached because of data refresh\r\n\t\t\t\tdnd._direction.parentNode.removeChild(dnd._direction);\r\n\r\n\t\t\tdnd._direction = null;\r\n\t\t}\r\n\t}\r\n\tgantt.attachEvent(\"onGanttRender\", gantt.bind(function() {\r\n\t\tif(dnd._direction){\r\n\t\t\tshowDirectingLine(this._dir_start.x, this._dir_start.y, this._dir_end.x, this._dir_end.y);\r\n\t\t}\r\n\t}, this));\r\n};\r\n\r\nexport default {\r\n\tcreateLinkDND: function(){\r\n\t\treturn {\r\n\t\t\tinit: initLinksDND\r\n\t\t};\r\n\t}\r\n};","import * as utils from \"../../../utils/utils\";\r\nimport taskDnD from \"./tasks_dnd\";\r\nimport linkDnD from \"./links_dnd\";\r\nimport * as domHelpers from \"../utils/dom_helpers\";\r\nimport MouseDelegates from \"../mouse_event_container\";\r\n\r\nvar initializer = (function(){\r\n\treturn function(gantt){\r\n\t\tvar services = gantt.$services;\r\n\t\treturn {\r\n\t\t\tonCreated: function (timeline) {\r\n\t\t\t\tvar config = timeline.$config;\r\n\t\t\t\tconfig.bind = utils.defined(config.bind) ? config.bind : \"task\";\r\n\t\t\t\tconfig.bindLinks = utils.defined(config.bindLinks) ? config.bindLinks : \"link\";\r\n\r\n\t\t\t\ttimeline._linksDnD = linkDnD.createLinkDND();\r\n\t\t\t\ttimeline._tasksDnD = taskDnD.createTaskDND();\r\n\t\t\t\ttimeline._tasksDnD.extend(timeline);\r\n\r\n\t\t\t\tthis._mouseDelegates = MouseDelegates(gantt);\r\n\t\t\t},\r\n\t\t\tonInitialized: function (timeline) {\r\n\t\t\t\tthis._attachDomEvents(gantt);\r\n\r\n\t\t\t\tthis._attachStateProvider(gantt, timeline);\r\n\r\n\t\t\t\ttimeline._tasksDnD.init(timeline, gantt);\r\n\t\t\t\ttimeline._linksDnD.init(timeline, gantt);\r\n\r\n\t\t\t\tif(timeline.$config.id == \"timeline\"){\r\n\t\t\t\t\tthis.extendDom(timeline);\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\t\t\tonDestroyed: function (timeline) {\r\n\t\t\t\tthis._clearDomEvents(gantt);\r\n\t\t\t\tthis._clearStateProvider(gantt);\r\n\t\t\t\tif (timeline._tasksDnD) {\r\n\t\t\t\t\ttimeline._tasksDnD.destructor();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\textendDom: function(timeline){\r\n\t\t\t\tgantt.$task = timeline.$task;\r\n\t\t\t\tgantt.$task_scale = timeline.$task_scale;\r\n\t\t\t\tgantt.$task_data = timeline.$task_data;\r\n\t\t\t\tgantt.$task_bg = timeline.$task_bg;\r\n\t\t\t\tgantt.$task_links = timeline.$task_links;\r\n\t\t\t\tgantt.$task_bars = timeline.$task_bars;\r\n\t\t\t},\r\n\r\n\t\t\t_clearDomEvents: function(){\r\n\t\t\t\tthis._mouseDelegates.destructor();\r\n\t\t\t\tthis._mouseDelegates = null;\r\n\t\t\t},\r\n\r\n\t\t\t_attachDomEvents: function(gantt){\r\n\t\t\t\tfunction _delete_link_handler(id, e) {\r\n\t\t\t\t\tif (id && this.callEvent(\"onLinkDblClick\", [id, e])) {\r\n\r\n\t\t\t\t\t\tvar link = this.getLink(id);\r\n\t\t\t\t\t\tif (this.isReadonly(link)) return;\r\n\r\n\t\t\t\t\t\tvar title = \"\";\r\n\t\t\t\t\t\tvar question = this.locale.labels.link + \" \" + this.templates.link_description(this.getLink(id)) + \" \" + this.locale.labels.confirm_link_deleting;\r\n\r\n\t\t\t\t\t\twindow.setTimeout(function () {\r\n\t\t\t\t\t\t\tgantt._delete_link_confirm({\r\n\t\t\t\t\t\t\t\tlink: link,\r\n\t\t\t\t\t\t\t\tmessage: question,\r\n\t\t\t\t\t\t\t\ttitle: title,\r\n\t\t\t\t\t\t\t\tcallback: function () {\r\n\t\t\t\t\t\t\t\t\tgantt.deleteLink(id);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}, (this.config.touch ? 300 : 1));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_task_link\", gantt.bind(function (e, trg) {\r\n\t\t\t\t\tvar id = this.locate(e, this.config.link_attribute);\r\n\t\t\t\t\tif (id) {\r\n\t\t\t\t\t\tthis.callEvent(\"onLinkClick\", [id, e]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, gantt), this.$task);\r\n\r\n\t\t\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_scale_cell\", gantt.bind(function (e, trg) {\r\n\t\t\t\t\tvar pos = domHelpers.getRelativeEventPosition(e, gantt.$task_data);\r\n\t\t\t\t\tvar date = gantt.dateFromPos(pos.x);\r\n\t\t\t\t\tvar coll = Math.floor(gantt.columnIndexByDate(date));\r\n\r\n\t\t\t\t\tvar coll_date = gantt.getScale().trace_x[coll];\r\n\r\n\t\t\t\t\tgantt.callEvent(\"onScaleClick\", [e, coll_date]);\r\n\t\t\t\t}, gantt), this.$task);\r\n\r\n\t\t\t\tthis._mouseDelegates.delegate(\"doubleclick\", \"gantt_task_link\", gantt.bind(function (e, id, trg) {\r\n\t\t\t\t\tvar id = this.locate(e, gantt.config.link_attribute);\r\n\t\t\t\t\t_delete_link_handler.call(this, id, e);\r\n\t\t\t\t}, gantt), this.$task);\r\n\r\n\t\t\t\tthis._mouseDelegates.delegate(\"doubleclick\", \"gantt_link_point\", gantt.bind(function (e, id, trg) {\r\n\t\t\t\t\tvar id = this.locate(e),\r\n\t\t\t\t\t\ttask = this.getTask(id);\r\n\r\n\t\t\t\t\tvar link = null;\r\n\t\t\t\t\tif (trg.parentNode && domHelpers.getClassName(trg.parentNode)) {\r\n\t\t\t\t\t\tif (domHelpers.getClassName(trg.parentNode).indexOf(\"_left\") > -1) {\r\n\t\t\t\t\t\t\tlink = task.$target[0];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tlink = task.$source[0];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (link)\r\n\t\t\t\t\t\t_delete_link_handler.call(this, link, e);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}, gantt), this.$task);\r\n\t\t\t},\r\n\r\n\t\t\t_attachStateProvider: function(gantt, timeline){\r\n\t\t\t\tvar self = timeline;\r\n\t\t\t\tvar state = services.getService(\"state\");\r\n\t\t\t\tstate.registerProvider(\"tasksTimeline\", function(){\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tscale_unit: self._tasks ? self._tasks.unit : undefined,\r\n\t\t\t\t\t\tscale_step:  self._tasks ? self._tasks.step  : undefined\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\t_clearStateProvider: function(){\r\n\t\t\t\tvar state = services.getService(\"state\");\r\n\t\t\t\tstate.unregisterProvider(\"tasksTimeline\");\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\r\n})();\r\n\r\nexport default initializer;","import * as domHelpers from \"./utils/dom_helpers\";\r\n\r\nvar initializer = (function() {\r\n\treturn function (gantt) {\r\n\t\treturn {\r\n\r\n\t\t\tgetVerticalScrollbar: function(){\r\n\t\t\t\treturn gantt.$ui.getView(\"scrollVer\");\r\n\t\t\t},\r\n\t\t\tgetHorizontalScrollbar: function(){\r\n\t\t\t\treturn gantt.$ui.getView(\"scrollHor\");\r\n\t\t\t},\r\n\r\n\t\t\t_legacyGridResizerClass: function(layout){\r\n\t\t\t\tvar resizers = layout.getCellsByType(\"resizer\");\r\n\t\t\t\tfor(var i = 0; i < resizers.length; i++){\r\n\t\t\t\t\tvar r = resizers[i];\r\n\t\t\t\t\tvar gridResizer = false;\r\n\r\n\t\t\t\t\tvar prev = r.$parent.getPrevSibling(r.$id);\r\n\t\t\t\t\tif(prev && prev.$config && prev.$config.id === \"grid\"){\r\n\t\t\t\t\t\tgridResizer= true;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tvar next = r.$parent.getNextSibling(r.$id);\r\n\t\t\t\t\t\tif(next && next.$config && next.$config.id === \"grid\"){\r\n\t\t\t\t\t\t\tgridResizer= true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(gridResizer){\r\n\t\t\t\t\t\tr.$config.css = (r.$config.css ? r.$config.css + \" \" : \"\") + \"gantt_grid_resize_wrap\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tonCreated: function(layout) {\r\n\t\t\t\tvar first = true;\r\n\r\n\t\t\t\tthis._legacyGridResizerClass(layout);\r\n\r\n\t\t\t\tlayout.attachEvent(\"onBeforeResize\", function() {\r\n\t\t\t\t\tvar mainTimeline = gantt.$ui.getView(\"timeline\");\r\n\t\t\t\t\tif (mainTimeline)\r\n\t\t\t\t\t\tmainTimeline.$config.hidden = mainTimeline.$parent.$config.hidden = !gantt.config.show_chart;\r\n\r\n\t\t\t\t\tvar mainGrid = gantt.$ui.getView(\"grid\");\r\n\r\n\t\t\t\t\tif(!mainGrid)\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tvar colsWidth = mainGrid._getColsTotalWidth();\r\n\t\t\t\t\tvar hideGrid = !gantt.config.show_grid || !gantt.config.grid_width || colsWidth === 0;\r\n\t\t\t\t\tif (first && !hideGrid && colsWidth !== false){\r\n\t\t\t\t\t\t\tgantt.config.grid_width = colsWidth;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmainGrid.$config.hidden = mainGrid.$parent.$config.hidden = hideGrid;\r\n\r\n\t\t\t\t\tif (!mainGrid.$config.hidden) {\r\n\t\t\t\t\t\t/* restrict grid width due to min_width, max_width, min_grid_column_width */\r\n\t\t\t\t\t\tvar grid_limits = mainGrid._getGridWidthLimits();\r\n\t\t\t\t\t\tif (grid_limits[0] && gantt.config.grid_width < grid_limits[0])\r\n\t\t\t\t\t\t\tgantt.config.grid_width = grid_limits[0];\r\n\t\t\t\t\t\tif (grid_limits[1] && gantt.config.grid_width > grid_limits[1])\r\n\t\t\t\t\t\t\tgantt.config.grid_width = grid_limits[1];\r\n\t\t\t\t\t\tif (mainTimeline && gantt.config.show_chart){\r\n\r\n\t\t\t\t\t\t\tmainGrid.$config.width = gantt.config.grid_width - 1;\r\n\r\n\t\t\t\t\t\t\t// GS-1314: Don't let the non-scrollable grid to be larger than the container with the correct width\r\n\t\t\t\t\t\t\tif (!mainGrid.$config.scrollable && mainGrid.$config.scrollY && gantt.$root.offsetWidth){\r\n\t\t\t\t\t\t\t\tvar ganttContainerWidth = mainGrid.$gantt.$layout.$container.offsetWidth;\r\n\t\t\t\t\t\t\t\tvar verticalScrollbar = gantt.$ui.getView(mainGrid.$config.scrollY);\r\n\t\t\t\t\t\t\t\tvar verticalScrollbarWidth = verticalScrollbar.$config.width;\r\n\r\n\t\t\t\t\t\t\t\t// GS-2488: to prevent grid from occupying the whole gantt container(timeline will be disabled) \r\n\t\t\t\t\t\t\t\t// need to leave min width for timeline\r\n\t\t\t\t\t\t\t\tvar gridOverflow = ganttContainerWidth - (mainGrid.$config.width + verticalScrollbarWidth) - 4;\r\n\t\t\t\t\t\t\t\tif (gridOverflow < 0){\r\n\t\t\t\t\t\t\t\t\tmainGrid.$config.width += gridOverflow;\r\n\t\t\t\t\t\t\t\t\tgantt.config.grid_width += gridOverflow;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (!first) {\r\n\t\t\t\t\t\t\t\tif (mainTimeline && !domHelpers.isChildOf(mainTimeline.$task, layout.$view)) {\r\n\t\t\t\t\t\t\t\t\t// timeline is being displayed after being not visible, reset grid with from full screen\r\n\t\t\t\t\t\t\t\t\tif (!mainGrid.$config.original_grid_width) {\r\n\t\t\t\t\t\t\t\t\t\tvar skinSettings = gantt.skins[gantt.skin];\r\n\t\t\t\t\t\t\t\t\t\tif(skinSettings && skinSettings.config && skinSettings.config.grid_width){\r\n\t\t\t\t\t\t\t\t\t\t\tmainGrid.$config.original_grid_width =  skinSettings.config.grid_width;\r\n\t\t\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t\t\tmainGrid.$config.original_grid_width = 0;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tgantt.config.grid_width = mainGrid.$config.original_grid_width;\r\n\t\t\t\t\t\t\t\t\tmainGrid.$parent.$config.width = gantt.config.grid_width;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tmainGrid.$parent._setContentSize(mainGrid.$config.width, null);\r\n\t\t\t\t\t\t\t\t\tgantt.$layout._syncCellSizes(mainGrid.$parent.$config.group, {value: gantt.config.grid_width, isGravity: false});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tmainGrid.$parent.$config.width = gantt.config.grid_width;\r\n\t\t\t\t\t\t\t\tif (mainGrid.$parent.$config.group) {\r\n\t\t\t\t\t\t\t\t\tgantt.$layout._syncCellSizes(mainGrid.$parent.$config.group, {value: mainGrid.$parent.$config.width, isGravity: false});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (mainTimeline && domHelpers.isChildOf(mainTimeline.$task, layout.$view)) {\r\n\t\t\t\t\t\t\t\t// hiding timeline, remember grid with to restore it when timeline is displayed again\r\n\t\t\t\t\t\t\t\tmainGrid.$config.original_grid_width = gantt.config.grid_width;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (!first) {\r\n\t\t\t\t\t\t\t\tmainGrid.$parent.$config.width = 0;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfirst = false;\r\n\t\t\t\t});\r\n\t\t\t\tthis._initScrollStateEvents(layout);\r\n\t\t\t},\r\n\r\n\t\t\t_initScrollStateEvents: function(layout) {\r\n\t\t\t\tgantt._getVerticalScrollbar = this.getVerticalScrollbar;\r\n\t\t\t\tgantt._getHorizontalScrollbar = this.getHorizontalScrollbar;\r\n\r\n\t\t\t\tvar vertical = this.getVerticalScrollbar();\r\n\t\t\t\tvar horizontal = this.getHorizontalScrollbar();\r\n\t\t\t\tif (vertical) {\r\n\t\t\t\t\tvertical.attachEvent(\"onScroll\", function(oldPos, newPos, dir){\r\n\t\t\t\t\t\tvar scrollState = gantt.getScrollState();\r\n\t\t\t\t\t\tgantt.callEvent(\"onGanttScroll\", [scrollState.x, oldPos, scrollState.x, newPos]);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tif (horizontal) {\r\n\t\t\t\t\thorizontal.attachEvent(\"onScroll\", function(oldPos, newPos, dir){\r\n\t\t\t\t\t\tvar scrollState = gantt.getScrollState();\r\n\t\t\t\t\t\tgantt.callEvent(\"onGanttScroll\", [oldPos, scrollState.y, newPos, scrollState.y]);\r\n\r\n\t\t\t\t\t\t// if the grid doesn't fit the width, scroll the row container\r\n\t\t\t\t\t\tvar grid = gantt.$ui.getView(\"grid\");\r\n\t\t\t\t\t\tif (grid && grid.$grid_data && !grid.$config.scrollable){\r\n\t\t\t\t\t\t\tgrid.$grid_data.style.left = grid.$grid.scrollLeft + \"px\";\r\n\t\t\t\t\t\t\tgrid.$grid_data.scrollLeft = grid.$grid.scrollLeft;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlayout.attachEvent(\"onResize\", function(){\r\n\t\t\t\t\tif (vertical && !gantt.$scroll_ver){\r\n\t\t\t\t\t\tgantt.$scroll_ver = vertical.$scroll_ver;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (horizontal && !gantt.$scroll_hor){\r\n\t\t\t\t\t\tgantt.$scroll_hor = horizontal.$scroll_hor;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\t_findGridResizer: function(layout, grid){\r\n\t\t\t\tvar resizers = layout.getCellsByType(\"resizer\");\r\n\r\n\t\t\t\tvar gridFirst = true;\r\n\t\t\t\tvar gridResizer;\r\n\t\t\t\tfor(var i = 0; i < resizers.length; i++){\r\n\t\t\t\t\tvar res = resizers[i];\r\n\t\t\t\t\tres._getSiblings();\r\n\t\t\t\t\tvar prev = res._behind;\r\n\t\t\t\t\tvar next = res._front;\r\n\t\t\t\t\tif(prev && prev.$content === grid || (prev.isChild && prev.isChild(grid))){\r\n\t\t\t\t\t\tgridResizer = res;\r\n\t\t\t\t\t\tgridFirst = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}else if(next && next.$content === grid || (next.isChild && next.isChild(grid))){\r\n\t\t\t\t\t\tgridResizer = res;\r\n\t\t\t\t\t\tgridFirst = false;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn {\r\n\t\t\t\t\tresizer: gridResizer,\r\n\t\t\t\t\tgridFirst: gridFirst\r\n\t\t\t\t};\r\n\t\t\t},\r\n\r\n\t\t\tonInitialized: function (layout) {\r\n\t\t\t\tvar grid = gantt.$ui.getView(\"grid\");\r\n\r\n\t\t\t\tvar resizeInfo = this._findGridResizer(layout, grid);\r\n\r\n\t\t\t\t// expose grid resize events\r\n\t\t\t\tif(resizeInfo.resizer){\r\n\t\t\t\t\tvar gridFirst = resizeInfo.gridFirst,\r\n\t\t\t\t\t\tnext = resizeInfo.resizer;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tif(next.$config.mode !== \"x\"){\r\n\t\t\t\t\t\treturn;// track only horizontal resize\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar initialWidth;\r\n\t\t\t\t\tnext.attachEvent(\"onResizeStart\", function(prevCellWidth, nextCellWidth){\r\n\r\n\t\t\t\t\t\tvar grid = gantt.$ui.getView(\"grid\");\r\n\t\t\t\t\t\tvar viewCell = grid ? grid.$parent : null;\r\n\t\t\t\t\t\tif(viewCell){\r\n\t\t\t\t\t\t\tvar limits = grid._getGridWidthLimits();\r\n\r\n\t\t\t\t\t\t\t// min grid width is defined by min widths of its columns, unless grid has horizontal scroll\r\n\t\t\t\t\t\t\tif(!grid.$config.scrollable)\r\n\t\t\t\t\t\t\t\tviewCell.$config.minWidth = limits[0];\r\n\r\n\t\t\t\t\t\t\tviewCell.$config.maxWidth = limits[1];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tinitialWidth = gridFirst ? prevCellWidth : nextCellWidth;\r\n\t\t\t\t\t\treturn gantt.callEvent(\"onGridResizeStart\", [initialWidth]);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tnext.attachEvent(\"onResize\", function(newBehindSize, newFrontSize){\r\n\t\t\t\t\t\tvar newSize = gridFirst ? newBehindSize : newFrontSize;\r\n\t\t\t\t\t\treturn gantt.callEvent(\"onGridResize\", [initialWidth, newSize]);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tnext.attachEvent(\"onResizeEnd\", function(oldBackSize, oldFrontSize, newBackSize, newFrontSize){\r\n\r\n\t\t\t\t\t\tvar oldSize = gridFirst ? oldBackSize : oldFrontSize;\r\n\t\t\t\t\t\tvar newSize = gridFirst ? newBackSize : newFrontSize;\r\n\t\t\t\t\t\tvar grid = gantt.$ui.getView(\"grid\");\r\n\t\t\t\t\t\tvar viewCell = grid ? grid.$parent : null;\r\n\t\t\t\t\t\tif(viewCell){\r\n\t\t\t\t\t\t\tviewCell.$config.minWidth = undefined;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar res = gantt.callEvent(\"onGridResizeEnd\", [oldSize, newSize]);\r\n\t\t\t\t\t\tif(res && newSize !== 0){// new size may be numeric zero when cell size is defined by 'gravity', actual size will be calculated by layout later\r\n\t\t\t\t\t\t\tgantt.config.grid_width = newSize;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn res;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\t\t\tonDestroyed: function (timeline) {\r\n\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t};\r\n})();\r\n\r\nexport default initializer;","import uiFactory from \"./ui_factory\";\r\nimport mouseEvents from \"./mouse\";\r\nimport createLayers from \"./gantt_layers\";\r\nimport Cell from \"./layout/cell\";\r\nimport Layout from \"./layout/layout\";\r\nimport ViewLayout from \"./layout/view_layout\";\r\nimport ViewCell from \"./layout/view_cell\";\r\nimport Resizer from \"./layout/resizer_cell\";\r\nimport Scrollbar from \"./layout/scrollbar_cell\";\r\nimport Timeline from \"./timeline/timeline\";\r\nimport Grid from \"./grid/grid\";\r\nimport ResourceGrid from \"./grid/resource_grid\";\r\nimport ResourceGridLightbox from \"./grid/resource_grid_lightbox\";\r\nimport ResourceTimeline from \"./timeline/resource_timeline\";\r\nimport ResourceHistogram from \"./timeline/resource_histogram\";\r\n\r\n\r\nimport gridEditorsFactory from \"./grid/editors/controller\";\r\n\r\nimport renderTaskBar from \"./render/task_bar_smart_render\";\r\nimport renderTimedProjectBar from \"./render/task_project_smart_render\";\r\nimport renderSplitTaskBar from \"./render/task_split_render\";\r\nimport renderRollupTaskBar from \"./render/task_rollup_render\";\r\nimport renderTaskBg from \"./render/task_bg_render\";\r\nimport renderLink from \"./render/link_render\";\r\nimport gridRenderer from \"./render/task_grid_line_render\";\r\nimport resourceMatrixRenderer from \"./render/resource_matrix_render\";\r\nimport resourceHistogramRenderer from \"./render/resource_histogram_render\";\r\nimport gridTaskRowResizerRenderer from \"./render/task_grid_row_resize_render\";\r\nimport renderConstraints from \"./render/task_constraints_render\";\r\nimport renderDeadline from \"./render/task_deadline_render\";\r\nimport renderBaselines from \"./render/task_baselines_render\";\r\nimport mainGridInitializer from \"./grid/main_grid_initializer\";\r\nimport mainTimelineInitializer from \"./timeline/main_timeline_initializer\";\r\nimport mainLayoutInitializer from \"./main_layout_initializer\";\r\n\r\nfunction initUI(gantt){\r\n\tfunction attachInitializer(view, initializer){\r\n\t\tvar ext = initializer(gantt);\r\n\t\tif(ext.onCreated)\r\n\t\t\text.onCreated(view);\r\n\t\tview.attachEvent(\"onReady\", function(){\r\n\t\t\tif(ext.onInitialized)\r\n\t\t\t\text.onInitialized(view);\r\n\t\t});\r\n\t\tview.attachEvent(\"onDestroy\", function(){\r\n\t\t\tif(ext.onDestroyed)\r\n\t\t\t\text.onDestroyed(view);\r\n\t\t});\r\n\t}\r\n\r\n\tvar factory = uiFactory.createFactory(gantt);\r\n\tfactory.registerView(\"cell\", Cell);\r\n\tfactory.registerView(\"resizer\", Resizer);\r\n\tfactory.registerView(\"scrollbar\", Scrollbar);\r\n\tfactory.registerView(\"layout\", Layout, function(view){\r\n\t\tvar id = view.$config ? view.$config.id : null;\r\n\t\tif(id === \"main\"){\r\n\t\t\tattachInitializer(view, mainLayoutInitializer);\r\n\t\t}\r\n\t});\r\n\tfactory.registerView(\"viewcell\", ViewCell);\r\n\tfactory.registerView(\"multiview\", ViewLayout);\r\n\tfactory.registerView(\"timeline\", Timeline, function(view){\r\n\t\tvar id = view.$config ? view.$config.id : null;\r\n\t\tif(id === \"timeline\" || view.$config.bind == \"task\"){\r\n\t\t\tattachInitializer(view, mainTimelineInitializer);\r\n\t\t}\r\n\t});\r\n\tfactory.registerView(\"grid\", Grid, function(view){\r\n\t\tvar id = view.$config ? view.$config.id : null;\r\n\t\tif(id === \"grid\" || view.$config.bind == \"task\"){\r\n\t\t\tattachInitializer(view, mainGridInitializer);\r\n\t\t}\r\n\t});\r\n\r\n\tfactory.registerView(\"resourceGrid\", ResourceGrid);\r\n\tfactory.registerView(\"GridRL\", ResourceGridLightbox);\r\n\tfactory.registerView(\"resourceTimeline\", ResourceTimeline);\r\n\tfactory.registerView(\"resourceHistogram\", ResourceHistogram);\r\n\r\n\tvar layersEngine = createLayers(gantt);\r\n\r\n\tvar inlineEditors = gridEditorsFactory(gantt);\r\n\r\n\tgantt.ext.inlineEditors = inlineEditors;\r\n\tgantt.ext._inlineEditors = inlineEditors;\r\n\tinlineEditors.init(gantt);\r\n\r\n\treturn {\r\n\t\tfactory:factory,\r\n\t\tmouseEvents: mouseEvents.init(gantt),\r\n\t\tlayersApi: layersEngine.init(),\r\n\t\trender:{\r\n\t\t\tgridLine: function(){\r\n\t\t\t\treturn gridRenderer(gantt);\r\n\t\t\t},\r\n\t\t\ttaskBg: function(){\r\n\t\t\t\treturn renderTaskBg(gantt);\r\n\t\t\t},\r\n\t\t\ttaskBar: function(){\r\n\t\t\t\treturn renderTaskBar(gantt);\r\n\t\t\t},\r\n\t\t\ttimedProjectBar: function(){\r\n\t\t\t\treturn renderTimedProjectBar(gantt);\r\n\t\t\t},\r\n\t\t\ttaskRollupBar: function() {\r\n\t\t\t\treturn renderRollupTaskBar(gantt);\r\n\t\t\t},\r\n\t\t\ttaskSplitBar: function(){\r\n\t\t\t\treturn renderSplitTaskBar(gantt);\r\n\t\t\t},\r\n\t\t\ttaskConstraints: function(){\r\n\t\t\t\treturn renderConstraints(gantt);\r\n\t\t\t},\r\n\t\t\ttaskDeadline: function(){\r\n\t\t\t\treturn renderDeadline(gantt);\r\n\t\t\t},\r\n\t\t\ttaskBaselines: function(){\r\n\t\t\t\treturn renderBaselines(gantt);\r\n\t\t\t},\r\n\t\t\tlink: function(){\r\n\t\t\t\treturn renderLink(gantt);\r\n\t\t\t},\r\n\t\t\tresourceRow: function(){\r\n\t\t\t\treturn resourceMatrixRenderer(gantt);\r\n\t\t\t},\r\n\t\t\tresourceHistogram: function(){\r\n\t\t\t\treturn resourceHistogramRenderer(gantt);\r\n\t\t\t},\r\n\t\t\tgridTaskRowResizer: function(){\r\n\t\t\t\treturn gridTaskRowResizerRenderer(gantt);\r\n\t\t\t}\r\n\t\t},\r\n\t\tlayersService: {\r\n\t\t\tgetDataRender: function(name){\r\n\t\t\t\treturn layersEngine.getDataRender(name, gantt);\r\n\t\t\t},\r\n\t\t\tcreateDataRender: function(config){\r\n\t\t\t\treturn layersEngine.createDataRender(config, gantt);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default {\r\n\tinit: initUI\r\n};","export default null;","import * as helpers from \"../../../utils/helpers\";\r\nimport getRowRectangle from \"./viewport/get_grid_row_rectangle\";\r\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\r\nimport isInViewPort from \"./viewport/is_grid_row_in_viewport\";\r\n\r\nfunction createGridLineRender(gantt){\r\n\r\n\tfunction _render_grid_item(item, view, config, viewport) {\r\n\t\tvar columns = view.getGridColumns();\r\n\t\tvar templates = view.$getTemplates();\r\n\r\n\t\tvar store = view.$config.rowStore;\r\n\r\n\t\tvar cells = [];\r\n\t\tvar has_child;\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tvar last = i == columns.length - 1;\r\n\t\t\tvar col = columns[i];\r\n\t\t\tvar cell;\r\n\r\n\t\t\tvar value;\r\n\t\t\tvar textValue;\r\n\t\t\tif (col.name == \"add\") {\r\n\t\t\t\tvar aria = gantt._waiAria.gridAddButtonAttrString(col);\r\n\r\n\t\t\t\tvalue = \"<div \" + aria + \" class='gantt_add'></div>\";\r\n\t\t\t\ttextValue = \"\";\r\n\t\t\t} else {\r\n\t\t\t\tif (col.template)\r\n\t\t\t\t\tvalue = col.template(item);\r\n\t\t\t\telse\r\n\t\t\t\t\tvalue = item[col.name];\r\n\r\n\t\t\t\tif (helpers.isDate(value)){\r\n\t\t\t\t\tvalue = templates.date_grid(value, item, col.name);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (value === null || value === undefined) {\r\n\t\t\t\t\tvalue = \"\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttextValue = value;\r\n\t\t\t\tvalue = \"<div class='gantt_tree_content'>\" + value + \"</div>\";\r\n\t\t\t}\r\n\t\t\tvar css = \"gantt_cell\" + (last ? \" gantt_last_cell\" : \"\");\r\n\r\n\t\t\tvar tree = [];\r\n\t\t\tif (col.tree) {\r\n\t\t\t\tcss += \" gantt_cell_tree\";\r\n\t\t\t\tfor (var j = 0; j < item.$level; j++)\r\n\t\t\t\t\ttree.push(templates.grid_indent(item));\r\n\r\n\t\t\t\thas_child = store.hasChild(item.id) && !(gantt.isSplitTask(item) && !gantt.config.open_split_tasks);\r\n\t\t\t\tif (has_child) {\r\n\t\t\t\t\ttree.push(templates.grid_open(item));\r\n\t\t\t\t\ttree.push(templates.grid_folder(item));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttree.push(templates.grid_blank(item));\r\n\t\t\t\t\ttree.push(templates.grid_file(item));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar style = \"width:\" + (col.width - (last ? 1 : 0)) + \"px;\";\r\n\t\t\tif (this.defined(col.align)){\r\n\t\t\t\tvar flexAlign = {\r\n\t\t\t\t\tright: \"flex-end\",\r\n\t\t\t\t\tleft: \"flex-start\",\r\n\t\t\t\t\tcenter: \"center\"\r\n\t\t\t\t};\r\n\t\t\t\tvar justifyContent = flexAlign[col.align];\r\n\r\n\t\t\t\tstyle += \"text-align:\" + col.align + \";justify-content:\"  + justifyContent + \";\";\r\n\t\t\t}\r\n\r\n\t\t\tvar aria = gantt._waiAria.gridCellAttrString(col, textValue, item);\r\n\r\n\t\t\ttree.push(value);\r\n\t\t\tcell = \"<div class='\" + css + \"' data-column-index='\"+i+\"' data-column-name='\"+col.name+\"' style='\" + style + \"' \" + aria + \">\" + tree.join(\"\") + \"</div>\";\r\n\t\t\tcells.push(cell);\r\n\t\t}\r\n\t\t// GS-291. The odd class should be assigned correctly\r\n\t\tcss = \"\";\r\n\t\tconst storeName = store.$config.name;\r\n\t\tswitch (storeName) {\r\n\t\t\tcase \"task\":\r\n\t\t\t\tcss = gantt.getGlobalTaskIndex(item.id) % 2 === 0 ? \"\" : \" odd\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"resource\":\r\n\t\t\t\tcss = store.visibleOrder.indexOf(item.id) % 2 === 0 ? \"\" : \" odd\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tcss += (item.$transparent) ? \" gantt_transparent\" : \"\";\r\n\r\n\t\tcss += (item.$dataprocessor_class ? \" \" + item.$dataprocessor_class : \"\");\r\n\r\n\t\tif (templates.grid_row_class) {\r\n\t\t\tvar css_template = templates.grid_row_class.call(gantt, item.start_date, item.end_date, item);\r\n\t\t\tif (css_template)\r\n\t\t\t\tcss += \" \" + css_template;\r\n\t\t}\r\n\r\n\t\tif(store.isSelected(item.id)) {\r\n\t\t\tcss += \" gantt_selected\";\r\n\t\t}\r\n\r\n\t\tvar el = document.createElement(\"div\");\r\n\t\tel.className = \"gantt_row\" + css + \" gantt_row_\" + gantt.getTaskType(item.type);\r\n\t\tvar height = view.getItemHeight(item.id);\r\n\t\tel.style.height = height + \"px\";\r\n\t\tel.style.lineHeight = height + \"px\";\r\n\r\n\t\tif(config.smart_rendering){\r\n\t\t\tel.style.position = \"absolute\";\r\n\t\t\tel.style.left = \"0px\";\r\n\t\t\tel.style.top = view.getItemTop(item.id) + \"px\";\r\n\t\t}\r\n\r\n\t\tif(view.$config.item_attribute){\r\n\t\t\tel.setAttribute(view.$config.item_attribute, item.id);\r\n\t\t\tel.setAttribute(view.$config.bind + \"_id\", item.id); // 'task_id'/'resource_id' for backward compatibility\r\n\t\t}\r\n\r\n\t\tgantt._waiAria.taskRowAttr(item, el);\r\n\r\n\t\tel.innerHTML = cells.join(\"\");\r\n\t\treturn el;\r\n\t}\r\n\r\n\tfunction onrender(item, rowNode, view){\r\n\t\tvar columns = view.getGridColumns();\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tvar column = columns[i];\r\n\t\t\tif (column.onrender){\r\n\r\n\t\t\t\t// find cell node for current column\r\n\t\t\t\tvar cellNode = rowNode.querySelector(`[data-column-name=\"${column.name}\"]`);\r\n\t\t\t\tif (cellNode) {\r\n\t\t\t\t\tvar content = column.onrender(item, cellNode);\r\n\t\t\t\t\tif (content && typeof content === \"string\") {\r\n\t\t\t\t\t\tcellNode.innerHTML = content;\r\n\t\t\t\t\t} else if (content && typeof content === \"object\") {\r\n\t\t\t\t\t\t// render object to node using additional functionality\r\n\t\t\t\t\t\tif (gantt.config.external_render){\r\n\t\t\t\t\t\t\tvar adapter = gantt.config.external_render;\r\n\t\t\t\t\t\t\tif (adapter.isElement(content)){\r\n\t\t\t\t\t\t\t\tadapter.renderElement(content, cellNode);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\trender: _render_grid_item,\r\n\t\tupdate: null,\r\n\t\tgetRectangle: getRowRectangle,\r\n\t\tisInViewPort: isInViewPort,\r\n\t\tgetVisibleRange: getVisibleRange,\r\n\t\tonrender: onrender\r\n\t};\r\n}\r\n\r\nexport default createGridLineRender;","import getRowRectangle from \"./viewport/get_bg_row_rectangle\";\r\nimport isLegacyRender from \"./is_legacy_smart_render\";\r\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\r\nimport getVisibleCellsRange from \"./viewport/get_visible_cells_range\";\r\nimport isColumnVisible from \"./viewport/is_column_visible\";\r\nimport bgPlaceholder from \"./prerender/task_bg_placeholder\";\r\n\r\nfunction createTaskBgRender(gantt){\r\n\tvar renderedCells = {};\r\n\tvar visibleCells = {};\r\n\r\n\tfunction cleanupCell(itemId) {\r\n\t\tif (renderedCells[itemId]) {\r\n\t\t\tfor (let columnIndex in renderedCells[itemId]) {\r\n\t\t\t\tconst cell = renderedCells[itemId][columnIndex];\r\n\t\t\t\tif (cell && cell.parentNode) {\r\n\t\t\t\t\tcell.parentNode.removeChild(cell);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tdelete renderedCells[itemId];\r\n\t\t}\r\n\t\tif (visibleCells[itemId]) {\r\n\t\t\tdelete visibleCells[itemId];\r\n\t\t}\r\n\t}\r\n\r\n\t// GS-3018: Add cleanup method for all cells\r\n\tfunction cleanupAll() {\r\n\t\tfor (let itemId in renderedCells) {\r\n\t\t\tcleanupCell(itemId);\r\n\t\t}\r\n\t\trenderedCells = {};\r\n\t\tvisibleCells = {};\r\n\t}\r\n\r\n\tfunction isRendered(item, columnIndex){\r\n\t\tif(renderedCells[item.id][columnIndex] && renderedCells[item.id][columnIndex].parentNode){\r\n\t\t\treturn true;\r\n\t\t}else{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction detachRenderedCell(itemId, columnIndex){\r\n\t\tif(renderedCells[itemId] && renderedCells[itemId][columnIndex] &&\r\n\t\t\trenderedCells[itemId][columnIndex].parentNode\r\n\t\t\t){\r\n\t\t\t\trenderedCells[itemId][columnIndex].parentNode.removeChild(renderedCells[itemId][columnIndex]);\r\n\t\t\t}\r\n\t}\r\n\r\n\tfunction getCellClassTemplate(view){\r\n\t\tvar templates = view.$getTemplates();\r\n\t\tvar cssTemplate;\r\n\t\tif (typeof templates.task_cell_class !== \"undefined\") {\r\n\t\t\tcssTemplate = templates.task_cell_class;\r\n\t\t\t// eslint-disable-next-line no-console\r\n\t\t\tvar log = console.warn || console.log;\r\n\t\t\tlog('gantt.templates.task_cell_class template is deprecated and will be removed soon. Please use gantt.templates.timeline_cell_class instead.');\r\n\t\t} else {\r\n\t\t\tcssTemplate = templates.timeline_cell_class;\r\n\t\t}\r\n\t\treturn cssTemplate;\r\n\t}\r\n\tfunction getCellContentTemplate(view){\r\n\t\tvar templates = view.$getTemplates();\r\n\t\tvar contentTemplate = templates.timeline_cell_content;\r\n\t\treturn contentTemplate;\r\n\t}\r\n\r\n\tfunction renderCells(item, node, view, config, viewPort){\r\n\t\tvar cfg = view.getScale();\r\n\t\tvar count = cfg.count;\r\n\t\tvar cssTemplate = getCellClassTemplate(view);\r\n\t\tvar contentTemplate = getCellContentTemplate(view);\r\n\r\n\t\tif (config.show_task_cells) {\r\n\t\t\tif(!renderedCells[item.id]){\r\n\t\t\t\trenderedCells[item.id] = {};\r\n\t\t\t}\r\n\t\t\tif(!visibleCells[item.id]){\r\n\t\t\t\tvisibleCells[item.id] = {};\r\n\t\t\t}\r\n\r\n\t\t\tvar range = getVisibleCellsRange(cfg, viewPort);\r\n\r\n\t\t\tfor(var i in visibleCells[item.id]){\r\n\t\t\t\tvar index = visibleCells[item.id][i];\r\n\r\n\t\t\t\tif(Number(index) < range.start || Number(index) > range.end){\r\n\t\t\t\t\tdetachRenderedCell(item.id, index);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvisibleCells[item.id] = {};\r\n\t\t\t// TODO: do not iterate all cell, only ones in the viewport and once that are already rendered\r\n\t\t\tfor (var columnIndex = range.start; columnIndex <= range.end; columnIndex++) {\r\n\t\t\t\tvar cell = renderOneCell(cfg, columnIndex, item, viewPort, count, cssTemplate, contentTemplate, config);\r\n\t\t\t\tif(!cell && isRendered(item, columnIndex)){\r\n\t\t\t\t\tdetachRenderedCell(item.id, columnIndex);\r\n\t\t\t\t}else if (cell && !cell.parentNode){\r\n\t\t\t\t\tnode.appendChild(cell);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction renderOneCell(scale, columnIndex, item, viewPort, count, cssTemplate, contentTemplate, config){\r\n\t\tvar width = scale.width[columnIndex],\r\n\t\t\tcssclass = \"\";\r\n\r\n\t\tif (isColumnVisible(columnIndex, scale, viewPort, gantt)) {//do not render skipped columns\r\n\r\n\t\t\tvar cssTemplateContent = cssTemplate(item, scale.trace_x[columnIndex]);\r\n\t\t\tvar htmlTemplateContent = \"\";\r\n\t\t\tif (contentTemplate) {// for backward compatibility, contentTemplate was added in 7.2.0+, will be undefined if someone used copy of old config/template object\r\n\t\t\t\thtmlTemplateContent = contentTemplate(item, scale.trace_x[columnIndex]);\r\n\t\t\t}\r\n\r\n\t\t\tif(config.static_background){\r\n\t\t\t\t// if cell render in static background is not allowed, or if it's a blank cell\r\n\t\t\t\tvar customCell = !!(cssTemplateContent || htmlTemplateContent);\r\n\t\t\t\tif(!(config.static_background_cells && customCell)){\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(renderedCells[item.id][columnIndex]){\r\n\t\t\t\tvisibleCells[item.id][columnIndex] = columnIndex;\r\n\t\t\t\treturn renderedCells[item.id][columnIndex];\r\n\t\t\t}\r\n\t\t\tvar cell = document.createElement(\"div\");\r\n\t\t\tcell.style.width = (width) + \"px\";\r\n\r\n\t\t\tcssclass = \"gantt_task_cell\" + (columnIndex == count - 1 ? \" gantt_last_cell\" : \"\");\r\n\t\t\tif (cssTemplateContent) {\r\n\t\t\t\tcssclass += \" \" + cssTemplateContent;\r\n\t\t\t}\r\n\t\t\tcell.className = cssclass;\r\n\r\n\t\t\tif (htmlTemplateContent) {\r\n\t\t\t\tcell.innerHTML = htmlTemplateContent;\r\n\t\t\t}\r\n\r\n\t\t\tcell.style.position = \"absolute\";\r\n\t\t\tcell.style.left = scale.left[columnIndex] + \"px\";\r\n\t\t\trenderedCells[item.id][columnIndex] = cell;\r\n\t\t\tvisibleCells[item.id][columnIndex] = columnIndex;\r\n\r\n\t\t\treturn cell;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tfunction _render_bg_line(item, view, config, viewPort) {\r\n\t\tvar templates = view.$getTemplates();\r\n\t\tvar cfg = view.getScale();\r\n\t\tvar count = cfg.count;\r\n\r\n\t\tif(config.static_background && !config.static_background_cells){\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar row = document.createElement(\"div\");\r\n\r\n\t\tvar cellCssTemplate = getCellClassTemplate(view);\r\n\t\tvar cellHtmlTemplate = getCellContentTemplate(view);\r\n\r\n\t\tvar range;\r\n\r\n\t\tif(!viewPort || !config.smart_rendering || isLegacyRender(gantt)){\r\n\t\t\trange = {\r\n\t\t\t\tstart: 0,\r\n\t\t\t\tend: count - 1\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\trange = getVisibleCellsRange(cfg, viewPort.x);\r\n\t\t}\r\n\t\tif (config.show_task_cells) {\r\n\t\t\trenderedCells[item.id] = {};\r\n\t\t\tvisibleCells[item.id] = {};\r\n\t\t\tfor (var columnIndex = range.start; columnIndex <= range.end; columnIndex++) {\r\n\t\t\t\tvar cell = renderOneCell(cfg, columnIndex, item, viewPort, count, cellCssTemplate, cellHtmlTemplate, config);\r\n\t\t\t\tif(cell){\r\n\t\t\t\t\trow.appendChild(cell);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// GS-291. The odd class should be assigned correctly\r\n\t\tconst store = view.$config.rowStore;\r\n\t\tconst odd = store.getIndexById(item.id) % 2 !== 0;\r\n\r\n\t\tvar cssTemplate = templates.task_row_class(item.start_date, item.end_date, item);\r\n\t\tvar css = \"gantt_task_row\" + (odd ? \" odd\" : \"\") + (cssTemplate ? ' ' + cssTemplate : '');\r\n\r\n\t\tif(store.isSelected(item.id)) {\r\n\t\t\tcss += \" gantt_selected\";\r\n\t\t}\r\n\r\n\t\trow.className = css;\r\n\r\n\t\tif (config.smart_rendering) {\r\n\t\t\trow.style.position = \"absolute\";\r\n\t\t\trow.style.top = view.getItemTop(item.id) + \"px\";\r\n\t\t\trow.style.width = \"100%\";\r\n\t\t}else{\r\n\t\t\trow.style.position = \"relative\";\r\n\t\t}\r\n\t\trow.style.height = (view.getItemHeight(item.id)) + \"px\";\r\n\r\n\t\tif (item.id == \"timeline_placeholder_task\"){\r\n\t\t\tvar placeholderTop = 0;\r\n\t\t\tif (item.lastTaskId){\r\n\t\t\t\tvar lastTaskTop = view.getItemTop(item.lastTaskId);\r\n\t\t\t\tvar lastTaskHeight = view.getItemHeight(item.lastTaskId);\r\n\t\t\t\tplaceholderTop = lastTaskTop + lastTaskHeight;\t\r\n\t\t\t}\r\n\r\n\t\t\tvar maxHeight = item.row_height || view.$task_data.offsetHeight;\r\n\r\n\t\t\tvar placeholderHeight = maxHeight - placeholderTop;\r\n\t\t\t// So that it won't exceed the placeholder timeline height\r\n\t\t\tif (placeholderHeight < 0){\r\n\t\t\t\tplaceholderHeight = 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (config.smart_rendering) {\r\n\t\t\t\trow.style.top = placeholderTop + \"px\";\t\r\n\t\t\t}\r\n\t\t\trow.style.height = placeholderHeight + \"px\";\r\n\t\t}\r\n\r\n\r\n\t\tif(view.$config.item_attribute){\r\n\t\t\trow.setAttribute(view.$config.item_attribute, item.id);\r\n\t\t\trow.setAttribute(view.$config.bind + \"_id\", item.id); // 'task_id'/'resource_id' for backward compatibility\r\n\t\t}\r\n\r\n\t\treturn row;\r\n\t}\r\n\r\n\treturn {\r\n\t\trender: _render_bg_line,\r\n\t\tupdate: renderCells,\r\n\t\tclear: cleanupAll,\r\n\t\tgetRectangle: getRowRectangle,\r\n\t\tgetVisibleRange: getVisibleRange,\r\n\t\tprepareData: bgPlaceholder\r\n\t};\r\n}\r\n\r\nexport default createTaskBgRender;\r\n","import createBaseBarRender from \"./task_bar_render\";\r\nimport isInViewPort from \"./viewport/is_bar_in_viewport\";\r\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\r\n\r\nfunction createTaskRenderer(gantt){\r\n\tconst defaultRender = createBaseBarRender(gantt);\r\n\r\n\tconst renderedNodes = {};\r\n\r\n\tfunction checkVisibility(child, viewPort, timeline, config, gantt){\r\n\t\tlet isVisible = true;\r\n\t\t// GS-2123. Don't render rollup tasks that are outside the viewport\r\n\t\tif (config.smart_rendering){\r\n\t\t\tisVisible = isInViewPort(child, viewPort, timeline, config, gantt);\r\n\t\t}\r\n\t\treturn isVisible;\r\n\t}\r\n\r\n\tfunction generateChildElement(task, child, timeline, sizes){\r\n\t\tconst childCopy = gantt.copy(gantt.getTask(child.id));\r\n\t\tchildCopy.$rendered_at = task.id;\r\n\t\t// a way to filter rollup tasks:\r\n\t\tconst displayRollup = gantt.callEvent(\"onBeforeRollupTaskDisplay\", [childCopy.id, childCopy, task.id]);\r\n\t\tif (displayRollup === false){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst element = defaultRender(childCopy, timeline);\r\n\t\tif(!element){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst height = timeline.getBarHeight(task.id, child.type == gantt.config.types.milestone);\r\n\t\tconst padding = Math.floor((timeline.getItemHeight(task.id) - height) / 2);\r\n\r\n\t\telement.style.top = (sizes.top + padding) + \"px\";\r\n\t\telement.classList.add(\"gantt_rollup_child\");\r\n\t\telement.setAttribute(\"data-rollup-parent-id\", task.id);\r\n\r\n\t\treturn element;\r\n\t}\r\n\r\n\tfunction getKey(childId, renderParentId){\r\n\t\treturn childId + \"_\" + renderParentId;\r\n\t}\r\n\r\n\r\n\tfunction renderRollupTask(task, timeline, config, viewPort) {\r\n\t\tif (task.rollup !== false && task.$rollup && task.$rollup.length) {\r\n\t\t\tconst el = document.createElement('div'),\r\n\t\t\t\tsizes = gantt.getTaskPosition(task);\r\n\r\n\t\t\t// vertical position is not important for the rollup tasks as long as the parent is rendered\r\n\t\t\tif (viewPort){\r\n\t\t\t\tviewPort.y = 0;\r\n\t\t\t\tviewPort.y_end = gantt.$task_bg.scrollHeight;\r\n\t\t\t}\r\n\r\n\t\t\ttask.$rollup.forEach(function(itemId){\r\n\t\t\t\tif (!gantt.isTaskExists(itemId)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tconst child = gantt.getTask(itemId);\r\n\t\t\t\tlet isVisible = checkVisibility(child, viewPort, timeline, config, gantt);\r\n\t\t\t\tif (!isVisible){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst element = generateChildElement(task, child, timeline, sizes);\r\n\t\t\t\tif (element) {\r\n\t\t\t\t\trenderedNodes[getKey(child.id, task.id)] = element;\r\n\t\t\t\t\tel.appendChild(element);\r\n\t\t\t\t} else{\r\n\t\t\t\t\trenderedNodes[getKey(child.id, task.id)] = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\t\t\treturn el;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction repaintRollupTask(task, itemNode, timeline, config, viewPort) {\r\n\t\tconst el = document.createElement(\"div\"),\r\n\t\tsizes = gantt.getTaskPosition(task);\r\n\r\n\t\t// vertical position is not important for the rollup tasks as long as the parent is rendered\r\n\t\tviewPort.y = 0;\r\n\t\tviewPort.y_end = gantt.$task_bg.scrollHeight;\r\n\r\n\t\ttask.$rollup.forEach(function(itemId){\r\n\t\t\tconst child = gantt.getTask(itemId);\r\n\t\t\tconst rollupKey = getKey(child.id, task.id);\r\n\t\t\tlet isVisible = checkVisibility(child, viewPort, timeline, config, gantt);\r\n\t\t\tif (isVisible !== !!renderedNodes[rollupKey]) {\r\n\r\n\t\t\t\tif (isVisible) {\r\n\t\t\t\t\tconst element = generateChildElement(task, child, timeline, sizes);\r\n\t\t\t\t\trenderedNodes[rollupKey] = element || false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\trenderedNodes[rollupKey] = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!!renderedNodes[rollupKey]) {\r\n\t\t\t\tel.appendChild(renderedNodes[rollupKey]);\r\n\t\t\t}\r\n\t\t\titemNode.innerHTML = \"\";\r\n\t\t\titemNode.appendChild(el);\r\n\t\t});\r\n\t}\r\n\r\n\r\n\r\n\treturn {\r\n\t\trender: renderRollupTask,\r\n\t\tupdate: repaintRollupTask,\r\n\t\t//getRectangle: getBarRectangle\r\n\t\tisInViewPort: isInViewPort,\r\n\t\tgetVisibleRange: getVisibleRange\r\n\t};\r\n}\r\n\r\nexport default createTaskRenderer;","import getRectangle from \"./viewport/get_bg_row_rectangle\";\r\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\r\nimport getVisibleCellsRange from \"./viewport/get_visible_cells_range\";\r\nimport isColumnVisible from \"./viewport/is_column_visible\";\r\nimport resourceTimetable from \"../../resource_timetable_builder\";\r\n\r\nfunction generateRenderResourceLine(gantt){\r\n\tvar getResourceLoad = resourceTimetable(gantt);\r\n\tvar renderedResourceLines = {};\r\n\r\n\tfunction renderResourceLineCell(resource, day, templates, config, timeline){\r\n\t\tvar css = templates.resource_cell_class(day.start_date, day.end_date, resource, day.tasks, day.assignments);\r\n\t\tvar content = templates.resource_cell_value(day.start_date, day.end_date, resource, day.tasks, day.assignments);\r\n\t\tvar height = timeline.getItemHeight(resource.id) - 1;\r\n\r\n\t\tif (css || content){\r\n\t\t\tvar sizes = timeline.getItemPosition(resource, day.start_date, day.end_date);\r\n\t\t\tvar el = document.createElement('div');\r\n\t\t\tel.setAttribute(timeline.$config.item_attribute, resource.id);\r\n\t\t\tel.className = [\"gantt_resource_marker\", css].join(\" \");\r\n\r\n\t\t\tel.style.cssText = [\r\n\t\t\t\t'left:' + sizes.left + 'px',\r\n\t\t\t\t'width:' + sizes.width + 'px',\r\n\t\t\t\t'height:' + (height) + 'px',\r\n\t\t\t\t'line-height:' + (height) + 'px',\r\n\t\t\t\t'top:' + sizes.top + 'px'\r\n\t\t\t].join(\";\");\r\n\r\n\t\t\tif(content)\r\n\t\t\t\tel.innerHTML = content;\r\n\r\n\t\t\treturn el;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tfunction detachRenderedResourceLine(id, index){\r\n\t\tif(renderedResourceLines[id] && renderedResourceLines[id][index] &&\r\n\t\t\trenderedResourceLines[id][index].parentNode\r\n\t\t\t){\r\n\t\t\t\trenderedResourceLines[id][index].parentNode.removeChild(renderedResourceLines[id][index]);\r\n\t\t\t}\r\n\t}\r\n\r\n\tfunction renderResourceLine(resource, timeline, config, viewport) {\r\n\t\tvar templates = timeline.$getTemplates();\r\n\t\tvar scale = timeline.getScale();\r\n\t\tvar timetable = getResourceLoad(resource, config.resource_property, timeline.getScale(), timeline);\r\n\t\tvar smartRendering = !!viewport;//no viewport means smart rendering is disabled\r\n\t\tvar cells = [];\r\n\t\trenderedResourceLines[resource.id] = {};\r\n\r\n\t\tvar range = getVisibleCellsRange(scale, viewport);\r\n\t\tfor (var columnIndex = range.start; columnIndex <= range.end; columnIndex++) {\r\n\r\n\t\t\tvar day = timetable[columnIndex];\r\n\t\t\tif(!day){\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif(smartRendering && !isColumnVisible(columnIndex, scale, viewport, gantt)){\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tvar cell = renderResourceLineCell(resource, day, templates, config, timeline);\r\n\t\t\tif(cell){\r\n\t\t\t\tcells.push(cell);\r\n\t\t\t\trenderedResourceLines[resource.id][columnIndex] = cell;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar row = null;\r\n\t\tif(cells.length){\r\n\t\t\trow = document.createElement(\"div\");\r\n\t\t\tfor(var i = 0; i < cells.length; i++){\r\n\t\t\t\trow.appendChild(cells[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn row;\r\n\t}\r\n\r\n\tfunction updateResourceLine(resource, node, timeline, config, viewport) {\r\n\t\tvar templates = timeline.$getTemplates();\r\n\t\tvar scale = timeline.getScale();\r\n\t\tvar timetable = getResourceLoad(resource, config.resource_property, timeline.getScale(), timeline);\r\n\r\n\t\tvar range = getVisibleCellsRange(scale, viewport);\r\n\r\n\t\tvar checkedColumns = {};\r\n\t\tif(renderedResourceLines && renderedResourceLines[resource.id]){\r\n\t\t\tfor(var i in renderedResourceLines[resource.id]){\r\n\t\t\t\tcheckedColumns[i] = i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (var columnIndex = range.start; columnIndex <= range.end; columnIndex++) {\r\n\t\t\tvar day = timetable[columnIndex];\r\n\t\t\tcheckedColumns[columnIndex] = false;\r\n\t\t\tif(!day){\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif(!isColumnVisible(columnIndex, scale, viewport, gantt)){\r\n\t\t\t\tdetachRenderedResourceLine(resource.id, columnIndex);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif(!renderedResourceLines[resource.id] || !renderedResourceLines[resource.id][columnIndex]){\r\n\t\t\t\tvar cell = renderResourceLineCell(resource, day, templates, config, timeline);\r\n\t\t\t\tif(cell){\r\n\t\t\t\t\tnode.appendChild(cell);\r\n\t\t\t\t\trenderedResourceLines[resource.id][columnIndex] = cell;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if(renderedResourceLines[resource.id] && renderedResourceLines[resource.id][columnIndex] && !renderedResourceLines[resource.id][columnIndex].parentNode){\r\n\t\t\t\tnode.appendChild(renderedResourceLines[resource.id][columnIndex]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor(var i in checkedColumns){\r\n\t\t\tif(checkedColumns[i] !== false){\r\n\t\t\t\tdetachRenderedResourceLine(resource.id, i);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\trender: renderResourceLine,\r\n\t\tupdate: updateResourceLine,\r\n\t\tgetRectangle: getRectangle,\r\n\t\tgetVisibleRange: getVisibleRange\r\n\t};\r\n}\r\n\r\nexport default generateRenderResourceLine;","import getRowRectangle from \"./viewport/get_grid_row_rectangle\";\r\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\r\n\r\nfunction createGridTaskRowResizerRender(gantt){\r\n\r\n\tfunction _render_grid_item(item, view, viewport) {\r\n\r\n\t\tvar config = view.$getConfig();\r\n\t\tvar resize_el = document.createElement(\"div\");\r\n\t\tresize_el.className = \"gantt_task_grid_row_resize_wrap\";\r\n\r\n\t\tresize_el.style.top = (view.getItemTop(item.id) + view.getItemHeight(item.id)) + \"px\";\r\n\r\n\t\tresize_el.innerHTML = \"<div class='gantt_task_grid_row_resize' role='cell'></div>\";\r\n\t\tresize_el.setAttribute(config.task_grid_row_resizer_attribute, item.id);\r\n\r\n\t\tgantt._waiAria.rowResizerAttr(resize_el);\r\n\t\treturn resize_el;\r\n\t}\r\n\r\n\treturn {\r\n\t\trender: _render_grid_item,\r\n\t\tupdate: null,\r\n\t\tgetRectangle: getRowRectangle,\r\n\t\tgetVisibleRange: getVisibleRange\r\n\t};\r\n}\r\n\r\nexport default createGridTaskRowResizerRender;","function _configure(col, data, force) {\r\n\tfor (var key in data)\r\n\t\tif (typeof col[key] == \"undefined\" || force)\r\n\t\t\tcol[key] = data[key];\r\n}\r\n\r\nfunction _get_skin(force, gantt) {\r\n\r\n\tconst styles = getComputedStyle(gantt.$root);\r\n\tconst themeVar = styles.getPropertyValue(\"--dhx-gantt-theme\");\r\n\tlet isCssVarTheme = !!themeVar;\r\n\tlet themeName;\r\n\r\n\t\r\n\tif(isCssVarTheme){\r\n\t\tthemeName = themeVar;\r\n\t}else{\r\n\t\tvar skin = gantt.skin;\r\n\t\tthemeName = skin;\r\n\t\tif (!skin || force) {\r\n\t\t\tvar links = document.getElementsByTagName(\"link\");\r\n\t\t\tfor (var i = 0; i < links.length; i++) {\r\n\t\t\t\tvar res = links[i].href.match(\"dhtmlxgantt_([a-z_]+).css\");\r\n\t\t\t\tif (res) {\r\n\t\t\t\t\tif (gantt.skins[res[1]] || !skin) {\r\n\t\t\t\t\t\tthemeName = res[1];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tgantt._theme_info = {\r\n\t\ttheme: themeName,\r\n\t\tcssVarTheme: isCssVarTheme\r\n\t};\r\n\r\n\r\n\r\n\tgantt.skin = themeName || \"terrace\";\r\n\tvar skinset = gantt.skins[gantt.skin] || gantt.skins[\"terrace\"];\r\n\r\n\t//apply skin related settings\r\n\t_configure(gantt.config, skinset.config, force);\r\n\r\n\tif(!isCssVarTheme){\r\n\t\tgantt.config.link_radius = 1;\r\n\t}\r\n\r\n\tvar config = gantt.getGridColumns();\r\n\tif (config[1] && !gantt.defined(config[1].width))\r\n\t\tconfig[1].width = skinset._second_column_width;\r\n\tif (config[2] && !gantt.defined(config[2].width))\r\n\t\tconfig[2].width = skinset._third_column_width;\r\n\t\r\n\tfor (var i=0; i<config.length; i++) {\r\n\t\tvar column = config[i];\r\n\t\tif (column.name == \"add\") {\r\n\t\t\tif(!column.width){\r\n\t\t\t\tcolumn.width = 44;\r\n\t\t\t}\r\n\t\t\tif (!(gantt.defined(column.min_width) && gantt.defined(column.max_width))) {\r\n\t\t\t\tcolumn.min_width = column.min_width || column.width;\r\n\t\t\t\tcolumn.max_width = column.max_width || column.width;\r\n\t\t\t}\r\n\t\t\tif (column.min_width)\r\n\t\t\t\tcolumn.min_width = +column.min_width;\r\n\t\t\tif (column.max_width)\r\n\t\t\t\tcolumn.max_width = +column.max_width;\r\n\t\t\tif (column.width) {\r\n\t\t\t\tcolumn.width = +column.width;\r\n\t\t\t\tcolumn.width = (column.min_width && column.min_width > column.width) ? column.min_width : column.width;\r\n\t\t\t\tcolumn.width = (column.max_width && column.max_width < column.width) ? column.max_width : column.width;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (skinset.config.task_height){\r\n\t\tgantt.config.task_height = skinset.config.task_height || \"full\";\r\n\t}\r\n\tif (skinset.config.bar_height){\r\n\t\tgantt.config.bar_height = skinset.config.bar_height || \"full\";\r\n\t}\r\n\r\n\tif (skinset._lightbox_template)\r\n\t\tgantt._lightbox_template = skinset._lightbox_template;\r\n\r\n\tif (skinset._redefine_lightbox_buttons) {\r\n\t\tgantt.config.buttons_right = skinset._redefine_lightbox_buttons[\"buttons_right\"];\r\n\t\tgantt.config.buttons_left = skinset._redefine_lightbox_buttons[\"buttons_left\"];\r\n\t}\r\n\r\n\r\n\tgantt.resetLightbox();\r\n}\r\n\r\n\r\n\r\nexport default function(gantt) {\r\n\t\r\n\tif(!gantt.resetSkin){\r\n\t\tgantt.resetSkin = function () {\r\n\t\t\tthis.skin = \"\";\r\n\t\t\t_get_skin(true, this);\r\n\t\t};\r\n\t\tgantt.skins = {};\r\n\r\n\t\tgantt.attachEvent(\"onGanttLayoutReady\", function(){\r\n\t\t\t_get_skin(false, this);\r\n\t\t\tmonitorThemeChange();\r\n\t\t});\r\n\t}\r\n\r\n\tgantt._addThemeClass = function(){\r\n\t\tdocument.documentElement.setAttribute(\"data-gantt-theme\", gantt.skin);\r\n\t};\r\n\r\n\tgantt.setSkin = function(value){\r\n\t\tconst skinChanged = this.skin !== value;\r\n\t\tthis.skin = value;\r\n\t\tgantt._addThemeClass();\r\n\t\tmonitorThemeChange();\r\n\t\tif(gantt.$root){\r\n\t\t\t_get_skin(skinChanged ? false : true, gantt);\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t\t\r\n\t\t//\r\n\t};\r\n\r\n\r\n\tlet monitorIntervalId = null;\r\n\tfunction monitorThemeChange(){\r\n\t\tconst container = gantt.$root;\r\n\t\t\r\n\t\tif(monitorIntervalId){\r\n\t\t\tclearInterval(monitorIntervalId);\r\n\t\t}\r\n\t\t\r\n\t\tif(container){\r\n\t\t\tmonitorIntervalId = setInterval(() => {\r\n\t\t\t\tconst csstheme = getComputedStyle(container).getPropertyValue('--dhx-gantt-theme');\r\n\t\t\t\tif(csstheme && csstheme !== gantt.skin){\r\n\t\t\t\t\tgantt.setSkin(csstheme);\r\n\t\t\t\t}\r\n\r\n\t\t\t}, 100);\r\n\t\t}\r\n\t}\r\n\tgantt.attachEvent(\"onDestroy\", function(){\r\n\t\tclearInterval(monitorIntervalId);\r\n\t});\r\n};","import * as domHelpers from \"../utils/dom_helpers\";\r\nimport isHeadless from \"../../../utils/is_headless\";\r\n\r\nexport default function(gantt){\r\n\r\n\tvar scrollRange = 50,\r\n\t\tscrollStep = 30,\r\n\t\tscrollDelay = 10,\r\n\t\tscrollSpeed = 50;\r\n\r\n\tvar interval = null,\r\n\t\tisMove = false,\r\n\t\tdelayTimeout = null,\r\n\t\tstartPos = {\r\n\t\t\tstarted: false\r\n\t\t},\r\n\t\teventPos = {};\r\n\r\n\r\n\tfunction isDisplayed(element){\r\n\t\treturn element &&\r\n\t\t\tdomHelpers.isChildOf(element, gantt.$root) &&\r\n\t\t\telement.offsetHeight;\r\n\t}\r\n\r\n\tfunction getAutoscrollContainer(){\r\n\t\tvar element;\r\n\t\tif(isDisplayed(gantt.$task)){\r\n\t\t\telement = gantt.$task;\r\n\t\t}else if(isDisplayed(gantt.$grid)){\r\n\t\t\telement = gantt.$grid;\r\n\t\t}else{\r\n\t\t\telement = gantt.$root;\r\n\t\t}\r\n\r\n\t\treturn element;\r\n\t}\r\n\r\n\tfunction isScrollState() {\r\n\t\tvar dragMarker = !!document.querySelector(\".gantt_drag_marker\");\r\n\t\tvar isResize = !!document.querySelector(\".gantt_drag_marker.gantt_grid_resize_area\")\r\n\t\t\t|| !!document.querySelector(\".gantt_drag_marker.gantt_row_grid_resize_area\") ;\r\n\t\tvar isLink = !!document.querySelector(\".gantt_link_direction\");\r\n\t\tvar state = gantt.getState();\r\n\t\tvar isClickDrag = state.autoscroll;\r\n\t\tisMove = dragMarker && !isResize && !isLink;\r\n\r\n\t\treturn !((!state.drag_mode && !dragMarker) || isResize) || isClickDrag;\r\n\t}\r\n\r\n\tfunction defineDelayTimeout(state) {\r\n\t\tif (delayTimeout) {\r\n\t\t\tclearTimeout(delayTimeout);\r\n\t\t\tdelayTimeout = null;\r\n\t\t}\r\n\t\tif (state) {\r\n\t\t\tvar speed = gantt.config.autoscroll_speed;\r\n\t\t\tif (speed && speed < 10) // limit speed value to 10\r\n\t\t\t\tspeed = 10;\r\n\r\n\t\t\tdelayTimeout = setTimeout(function() {\r\n\t\t\t\tinterval = setInterval(tick, speed || scrollSpeed);\r\n\t\t\t}, gantt.config.autoscroll_delay || scrollDelay);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction defineScrollInterval(state) {\r\n\t\tif (state) {\r\n\t\t\tdefineDelayTimeout(true);\r\n\t\t\tif (!startPos.started) {\r\n\t\t\t\tstartPos.x = eventPos.x;\r\n\t\t\t\tstartPos.y = eventPos.y;\r\n\t\t\t\tstartPos.started = true;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (interval) {\r\n\t\t\t\tclearInterval(interval);\r\n\t\t\t\tinterval = null;\r\n\t\t\t}\r\n\t\t\tdefineDelayTimeout(false);\r\n\t\t\tstartPos.started = false;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction autoscrollInterval(event) {\r\n\t\tvar isScroll = isScrollState();\r\n\r\n\t\tif ((interval || delayTimeout) && !isScroll) {\r\n\t\t\tdefineScrollInterval(false);\r\n\t\t}\r\n\r\n\t\tif (!gantt.config.autoscroll || !isScroll) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\teventPos = {\r\n\t\t\tx: event.clientX,\r\n\t\t\ty: event.clientY\r\n\t\t};\r\n\r\n\t\t// if it is a mobile device, we need to detect the touch event coords\r\n\t\tif (event.type == \"touchmove\"){\r\n\t\t\teventPos.x = event.targetTouches[0].clientX;\r\n\t\t\teventPos.y = event.targetTouches[0].clientY;\r\n\t\t}\r\n\r\n\t\tif (!interval && isScroll) {\r\n\t\t\tdefineScrollInterval(true);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction tick() {\r\n\r\n\t\tif (!isScrollState()) {\r\n\t\t\tdefineScrollInterval(false);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar container = getAutoscrollContainer();\r\n\t\tif(!container){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// GS-1150: if we reorder or resize something in the grid, we should obtain the grid container\r\n\t\tvar gridDrag = false;\r\n\t\tvar gridMarkers = [\r\n\t\t\t\".gantt_drag_marker.gantt_grid_resize_area\",\r\n\t\t\t\".gantt_drag_marker .gantt_row.gantt_row_task\",\r\n\t\t\t\".gantt_drag_marker.gantt_grid_dnd_marker\"\r\n\t\t];\r\n\t\tgridMarkers.forEach(function (selector) {\r\n\t\t\tgridDrag = gridDrag || !!document.querySelector(selector);\r\n\t\t});\r\n\t\tif (gridDrag){\r\n\t\t\tcontainer = gantt.$grid;\r\n\t\t}\r\n\r\n\t\tvar box = domHelpers.getNodePosition(container);\r\n\r\n\t\tvar posX = eventPos.x - box.x;\r\n\t\tvar posY = eventPos.y - box.y + window.scrollY; // GS-1315: window.scrollY here and below for the elements above Gantt\r\n\r\n\t\tvar scrollLeft = isMove ? 0 : need_scroll(posX, box.width, startPos.x - box.x);\r\n\t\tvar scrollTop = need_scroll(posY, box.height, startPos.y - box.y + window.scrollY);\r\n\r\n\t\tvar scrollState = gantt.getScrollState();\r\n\r\n\t\tvar currentScrollTop = scrollState.y,\r\n\t\t\tscrollOuterHeight = scrollState.inner_height,\r\n\t\t\tscrollInnerHeight = scrollState.height,\r\n\t\t\tcurrentScrollLeft = scrollState.x,\r\n\t\t\tscrollOuterWidth = scrollState.inner_width,\r\n\t\t\tscrollInnerWidth = scrollState.width;\r\n\r\n\t\t// do scrolling only if we have scrollable area to do so\r\n\t\tif (scrollTop && !scrollOuterHeight) {\r\n\t\t\tscrollTop = 0;\r\n\t\t} else if (scrollTop < 0 && !currentScrollTop) {\r\n\t\t\tscrollTop = 0;\r\n\t\t} else if (scrollTop > 0 && currentScrollTop + scrollOuterHeight >= scrollInnerHeight + 2) {\r\n\t\t\tscrollTop = 0;\r\n\t\t}\r\n\r\n\t\tif (scrollLeft && !scrollOuterWidth) {\r\n\t\t\tscrollLeft = 0;\r\n\t\t} else if (scrollLeft < 0 && !currentScrollLeft) {\r\n\t\t\tscrollLeft = 0;\r\n\t\t} else if (scrollLeft > 0 && currentScrollLeft + scrollOuterWidth >= scrollInnerWidth) {\r\n\t\t\tscrollLeft = 0;\r\n\t\t}\r\n\r\n\t\tvar step = gantt.config.autoscroll_step;\r\n\r\n\t\tif (step && step < 2) // limit step value to 2\r\n\t\t\tstep = 2;\r\n\r\n\t\tscrollLeft = scrollLeft * (step || scrollStep);\r\n\t\tscrollTop = scrollTop * (step || scrollStep);\r\n\r\n\t\tif (scrollLeft || scrollTop) {\r\n\t\t\tscroll(scrollLeft, scrollTop);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction need_scroll(pos, boxSize, startCoord) {\r\n\t\tif ((pos - scrollRange < 0) && (pos < startCoord))\r\n\t\t\treturn -1;\r\n\t\telse if ((pos > boxSize - scrollRange) && (pos > startCoord))\r\n\t\t\treturn 1;\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tfunction scroll(left, top) {\r\n\t\tvar scrollState = gantt.getScrollState();\r\n\r\n\t\tvar scrollLeft = null,\r\n\t\t\tscrollTop = null;\r\n\r\n\t\tif (left) {\r\n\t\t\tscrollLeft = scrollState.x + left;\r\n\t\t\tscrollLeft = Math.min(scrollState.width, scrollLeft);\r\n\t\t\tscrollLeft = Math.max(0, scrollLeft);\r\n\t\t}\r\n\r\n\t\tif (top) {\r\n\t\t\tscrollTop = scrollState.y + top;\r\n\t\t\tscrollTop = Math.min(scrollState.height, scrollTop);\r\n\t\t\tscrollTop = Math.max(0, scrollTop);\r\n\t\t}\r\n\r\n\t\tgantt.scrollTo(scrollLeft, scrollTop);\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onGanttReady\", function() {\r\n\t\tif(!isHeadless(gantt)){\r\n\t\t\tvar eventElement = domHelpers.getRootNode(gantt.$root) || document.body;\r\n\t\t\tgantt.eventRemove(eventElement, \"mousemove\", autoscrollInterval);\r\n\t\t\tgantt.event(eventElement, \"mousemove\", autoscrollInterval);\r\n\r\n\t\t\tgantt.eventRemove(eventElement, \"touchmove\", autoscrollInterval);\r\n\t\t\tgantt.event(eventElement, \"touchmove\", autoscrollInterval);\r\n\r\n\t\t\tgantt.eventRemove(eventElement, \"pointermove\", autoscrollInterval);\r\n\t\t\tgantt.event(eventElement, \"pointermove\", autoscrollInterval);\r\n\t\t}\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onDestroy\", function(){\r\n\t\tdefineScrollInterval(false);\r\n\t});\r\n\r\n};","if (typeof window !== \"undefined\" && window.jQuery){\r\n\r\n\t(function( $ ){\r\n\r\n\t\tvar methods = [];\r\n\t\t$.fn.dhx_gantt = function(config){\r\n\t\t\tconfig = config || {};\r\n\t\t\tif (typeof(config) === 'string') {\r\n\t\t\t\tif (methods[config] ) {\r\n\t\t\t\t\treturn methods[config].apply(this, []);\r\n\t\t\t\t}else {\r\n\t\t\t\t\t$.error('Method ' +  config + ' does not exist on jQuery.dhx_gantt');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar views = [];\r\n\t\t\t\tthis.each(function() {\r\n\t\t\t\t\tif (this && this.getAttribute){\r\n\t\t\t\t\t\tif (!this.gantt && !(window.gantt.$root == this)){\r\n\r\n\t\t\t\t\t\t\tvar newgantt = (window.gantt.$container && window.Gantt) ? window.Gantt.getGanttInstance():window.gantt;\r\n\t\t\t\t\t\t\tfor (var key in config)\r\n\t\t\t\t\t\t\t\tif (key!=\"data\")\r\n\t\t\t\t\t\t\t\t\tnewgantt.config[key] = config[key];\r\n\r\n\t\t\t\t\t\t\tnewgantt.init(this);\r\n\t\t\t\t\t\t\tif (config.data)\r\n\t\t\t\t\t\t\t\tnewgantt.parse(config.data);\r\n\r\n\t\t\t\t\t\t\tviews.push(newgantt);\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tviews.push(typeof this.gantt == \"object\" ? this.gantt : window.gantt);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\r\n\t\t\t\tif (views.length === 1) return views[0];\r\n\t\t\t\treturn views;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t})(window.jQuery);\r\n\r\n}\r\n\r\n\r\nexport default null;","if (typeof window !== \"undefined\" && window.dhtmlx){\r\n\r\n\tif (!window.dhtmlx.attaches)\r\n\twindow.dhtmlx.attaches = {};\r\n\r\n\twindow.dhtmlx.attaches.attachGantt=function(start, end, gantt){\r\n\t\tvar obj = document.createElement(\"DIV\");\r\n\r\n\t\tgantt = gantt || window.gantt;\r\n\r\n\t\tobj.id = \"gantt_\"+ gantt.uid();\r\n\t\tobj.style.width = \"100%\";\r\n\t\tobj.style.height = \"100%\";\r\n\t\tobj.cmp = \"grid\";\r\n\r\n\t\tdocument.body.appendChild(obj);\r\n\t\tthis.attachObject(obj.id);\r\n\t\tthis.dataType = \"gantt\";\r\n\t\tthis.dataObj = gantt;\r\n\r\n\t\tvar that = this.vs[this.av];\r\n\t\tthat.grid = gantt;\r\n\r\n\t\tgantt.init(obj.id, start, end);\r\n\t\tobj.firstChild.style.border = \"none\";\r\n\r\n\t\tthat.gridId = obj.id;\r\n\t\tthat.gridObj = obj;\r\n\r\n\t\tvar method_name=\"_viewRestore\";\r\n\t\treturn this.vs[this[method_name]()].grid;\r\n\t};\r\n\r\n}\r\nif (typeof window !== \"undefined\" && typeof(window.dhtmlXCellObject) != \"undefined\") {\r\n\r\n\twindow.dhtmlXCellObject.prototype.attachGantt=function(start, end, gantt){\r\n\t\tgantt = gantt || window.gantt;\r\n\r\n\t\tvar obj = document.createElement(\"DIV\");\r\n\t\tobj.id = \"gantt_\"+gantt.uid();\r\n\t\tobj.style.width = \"100%\";\r\n\t\tobj.style.height = \"100%\";\r\n\t\tobj.cmp = \"grid\";\r\n\r\n\t\tdocument.body.appendChild(obj);\r\n\t\tthis.attachObject(obj.id);\r\n\r\n\t\tthis.dataType = \"gantt\";\r\n\t\tthis.dataObj = gantt;\r\n\r\n\t\tgantt.init(obj.id, start, end);\r\n\t\tobj.firstChild.style.border = \"none\";\r\n\r\n\t\tobj = null;\r\n\t\tthis.callEvent(\"_onContentAttach\",[]);\r\n\r\n\t\treturn this.dataObj;\r\n\t};\r\n}\r\n\r\nexport default null;","import env from \"../../../utils/env\";\r\nimport eventable from \"../../../utils/eventable\";\r\nimport { IScale, TModifierKeys } from \"../../common/config\";\r\n\r\ninterface ITimelineZoomConfig {\r\n\thandler?: (e: Event) => {};\r\n\tstartDate?: Date;\r\n\tendDate?: Date;\r\n\tlevels: IZoomLevel[];\r\n\tactiveLevelIndex?: number;\r\n\twidthStep?: number;\r\n\tminColumnWidth?: number;\r\n\tmaxColumnWidth?: number;\r\n\tuseKey?: \"ctrlKey\" | \"altKey\" | \"shiftKey\";\r\n\ttrigger?: \"wheel\" | null | undefined;\r\n\telement?: Element | (() => Element);\r\n}\r\n\r\nconst USE_KEY = [\"ctrlKey\", \"altKey\", \"shiftKey\", \"metaKey\"];\r\n\r\ninterface IZoomLevel {\r\n\tname?: string;\r\n\tscale_height?: number;\r\n\tmin_column_width: number;\r\n\tscales: IScale[];\r\n}\r\n\r\nconst _defaultScales = [\r\n\t[\r\n\t\t{\r\n\t\t\tunit: \"month\",\r\n\t\t\tdate: \"%M\",\r\n\t\t\tstep: 1\r\n\t\t},\r\n\t\t{\r\n\t\t\tunit: \"day\",\r\n\t\t\tdate: \"%d\",\r\n\t\t\tstep: 1\r\n\t\t}\r\n\t],\r\n\t[\r\n\t\t{\r\n\t\t\tunit: \"day\",\r\n\t\t\tdate: \"%d %M\",\r\n\t\t\tstep: 1\r\n\t\t}\r\n\t],\r\n\t[\r\n\t\t{\r\n\t\t\tunit: \"day\",\r\n\t\t\tdate: \"%d %M\",\r\n\t\t\tstep: 1\r\n\t\t},\r\n\t\t{\r\n\t\t\tunit: \"hour\",\r\n\t\t\tdate: \"%H:00\",\r\n\t\t\tstep: 8\r\n\t\t}\r\n\t],\r\n\t[\r\n\t\t{\r\n\t\t\tunit: \"day\",\r\n\t\t\tdate: \"%d %M\",\r\n\t\t\tstep: 1\r\n\t\t},\r\n\t\t{\r\n\t\t\tunit: \"hour\",\r\n\t\t\tdate: \"%H:00\",\r\n\t\t\tstep: 1\r\n\t\t}\r\n\t]\r\n];\r\n\r\nexport default class TimelineZoom {\r\n\tpublic attachEvent: (eventName: string, handler: () => void) => string;\r\n\tpublic callEvent: (eventName: string, args: any[]) => any;\r\n\tpublic detachEvent: (eventName: string) => any;\r\n\tprotected _initialStartDate: Date;\r\n\tprotected _initialEndDate: Date;\r\n\tprotected _activeLevelIndex: number;\r\n\tprotected _levels: IZoomLevel[];\r\n\tprotected _handler: (e: any) => void;\r\n\tprotected $gantt;\r\n\tprotected _widthStep: number;\r\n\tprotected _minColumnWidth: number;\r\n\tprotected _maxColumnWidth: number;\r\n\tprotected _useKey: TModifierKeys;\r\n\tprotected _visibleDate: Date;\r\n\tprotected _initialized: boolean;\r\n\tprotected _domEvents: any;\r\n\r\n\tconstructor(gantt) {\r\n\t\tthis.$gantt = gantt;\r\n\t\tthis._domEvents = this.$gantt._createDomEventScope();\r\n\t}\r\n\r\n\tpublic init(config: ITimelineZoomConfig) {\r\n\t\t// GS-1354 and GS-1318. If we check the headless mode using the function,\r\n\t\t// it will return false when Gantt is not initialized, but we may want to do it later\r\n\t\tif(this.$gantt.env.isNode){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._initialStartDate = config.startDate;\r\n\t\tthis._initialEndDate = config.endDate;\r\n\t\tthis._activeLevelIndex = config.activeLevelIndex ? config.activeLevelIndex : 0;\r\n\t\tthis._levels = this._mapScales(config.levels || _defaultScales);\r\n\t\tthis._handler = config.handler || this._defaultHandler;\r\n\t\tthis._minColumnWidth = config.minColumnWidth || 60;\r\n\t\tthis._maxColumnWidth = config.maxColumnWidth || 240;\r\n\t\tthis._widthStep = config.widthStep || 3/8 * config.minColumnWidth;\r\n\t\tthis._useKey = config.useKey;\r\n\r\n\t\tif(!this._initialized){\r\n\t\t\teventable(this);\r\n\t\t\tthis.$gantt.attachEvent(\"onGanttScroll\", () => {\r\n\t\t\t\tthis._getVisibleDate();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis._domEvents.detachAll();\r\n\r\n\t\tif(config.trigger === \"wheel\"){\r\n\t\t\tif(this.$gantt.$root){\r\n\t\t\t\tthis._attachWheelEvent(config);\r\n\t\t\t}else{\r\n\t\t\t\t// GS-1322. This way the handler works for the init and resetLayout methods\r\n\t\t\t\tthis.$gantt.attachEvent(\"onGanttLayoutReady\", () => {\r\n\t\t\t\t\tthis.$gantt.attachEvent(\"onGanttRender\", () => {\r\n\t\t\t\t\t\tthis._attachWheelEvent(config);\r\n\t\t\t\t\t}, {once: true});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._initialized = true;\r\n\t\tthis.setLevel(this._activeLevelIndex);\r\n\t}\r\n\r\n\tpublic zoomIn = () => {\r\n\t\tconst index = this.getCurrentLevel() - 1;\r\n\t\tif(index < 0){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.setLevel(index);\r\n\t};\r\n\r\n\tpublic zoomOut = () => {\r\n\t\tconst index = this.getCurrentLevel() + 1;\r\n\t\tif(index > this._levels.length - 1){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.setLevel(index);\r\n\t};\r\n\r\n\tpublic getCurrentLevel = () => {\r\n\t\treturn this._activeLevelIndex;\r\n\t};\r\n\r\n\tpublic getLevels = () => {\r\n\t\treturn this._levels;\r\n\t};\r\n\r\n\tpublic setLevel = (level: number|string) => {\r\n\t\tconst zoomLevel = this._getZoomIndexByName(level);\r\n\r\n\t\tif(zoomLevel === -1){\r\n\t\t\tthis.$gantt.assert(zoomLevel !== -1, \"Invalid zoom level for gantt.ext.zoom.setLevel. \" + level + \" is not an expected value.\");\r\n\t\t}\r\n\t\tthis._setLevel(zoomLevel, 0);\r\n\t};\r\n\r\n\tprotected _getZoomIndexByName = (levelName: number|string) => {\r\n\t\tlet zoomLevel:number = -1;\r\n\t\tif(typeof levelName === \"string\"){\r\n\t\t\tif(!isNaN(Number(levelName)) &&  this._levels[Number(levelName)]){\r\n\t\t\t\tzoomLevel = Number(levelName);\r\n\t\t\t}else{\r\n\t\t\t\tfor(let i = 0; i < this._levels.length; i++){\r\n\t\t\t\t\tif(this._levels[i].name === levelName){\r\n\t\t\t\t\t\tzoomLevel = i;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tzoomLevel = levelName;\r\n\t\t}\r\n\t\treturn zoomLevel;\r\n\t};\r\n\r\n\tprotected _mapScales(levels: IScale[][] | any): IZoomLevel[]{\r\n\t\treturn levels.map((l) => {\r\n\t\t\tif(Array.isArray(l)){\r\n\t\t\t\treturn {\r\n\t\t\t\t\tscales: l\r\n\t\t\t\t};\r\n\t\t\t}else{\r\n\t\t\t\treturn l;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected _getVisibleDate = () => {\r\n\t\t// GS-1450. Don't try to get the visible date if there is no timeline\r\n\t\tif (!this.$gantt.$task){\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tconst scrollPos = this.$gantt.getScrollState().x;\r\n\t\tconst viewPort = this.$gantt.$task.offsetWidth;\r\n\t\tthis._visibleDate = this.$gantt.dateFromPos(scrollPos + viewPort/2);\r\n\t};\r\n\r\n\tprotected _setLevel = (level: number, cursorOffset: number) => {\r\n\t\tthis._activeLevelIndex = level;\r\n\r\n\t\tconst gantt = this.$gantt;\r\n\t\tconst nextConfig = gantt.copy(this._levels[this._activeLevelIndex]);\r\n\t\tconst chartConfig = gantt.copy(nextConfig);\r\n\t\tdelete chartConfig.name;\r\n\r\n\t\tgantt.mixin(gantt.config, chartConfig, true);\r\n\r\n\t\t// GS-1148: Change scales for the resource views\r\n\t\tconst resourceViews = [\r\n\t\t\t\"resourceTimeline\",\r\n\t\t\t\"resourceHistogram\"\r\n\t\t];\r\n\r\n\t\tresourceViews.forEach(function(name){\r\n\t\t\tconst resourceView = gantt.$ui.getView(name);\r\n\t\t\tif (resourceView){\r\n\t\t\t\tconst resourceConfig = resourceView.$getConfig();\r\n\t\t\t\tif (!resourceConfig.fixed_scales){\r\n\t\t\t\t\tgantt.mixin(resourceConfig, chartConfig, true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst isRendered = !!gantt.$root && !!gantt.$task;\r\n\r\n\t\tif(isRendered){\r\n\t\t\tif(cursorOffset){\r\n\t\t\t\tconst cursorDate = this.$gantt.dateFromPos(cursorOffset + this.$gantt.getScrollState().x);\r\n\t\t\t\tthis.$gantt.render();\r\n\t\t\t\tconst newPosition = this.$gantt.posFromDate(cursorDate);\r\n\t\t\t\tthis.$gantt.scrollTo(newPosition - cursorOffset);\r\n\t\t\t}else{\r\n\t\t\t\tconst viewPort = this.$gantt.$task.offsetWidth;\r\n\t\t\t\tif(!this._visibleDate){\r\n\t\t\t\t\tthis._getVisibleDate();\r\n\t\t\t\t}\r\n\t\t\t\tconst middleDate = this._visibleDate;\r\n\t\t\t\tthis.$gantt.render();\r\n\t\t\t\tconst newPosition = this.$gantt.posFromDate(middleDate);\r\n\t\t\t\tthis.$gantt.scrollTo(newPosition - viewPort/2);\r\n\t\t\t}\r\n\r\n\t\t\tthis.callEvent(\"onAfterZoom\", [this._activeLevelIndex, nextConfig]);\r\n\t\t}\r\n\t};\r\n\r\n\tprivate _attachWheelEvent = (config) => {\r\n\t\tconst event = env.isFF ? \"wheel\" : \"mousewheel\";\r\n\t\tlet el: Element;\r\n\t\tif(typeof config.element === \"function\"){\r\n\t\t\tel = config.element();\r\n\t\t}else{\r\n\t\t\tel = config.element as Element;\r\n\t\t}\r\n\t\tif (!el){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._domEvents.attach(el, event, this.$gantt.bind(function(e) {\r\n\t\t\tif (this._useKey) {\r\n\t\t\t\tif (USE_KEY.indexOf(this._useKey) < 0) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tif (!e[this._useKey]) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (typeof this._handler === \"function\") {\r\n\t\t\t\tthis._handler.apply(this, [e]);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}, this), {passive: false});\r\n\t};\r\n\r\n\tprivate _defaultHandler = (e: any):void => {\r\n\t\tconst timelineOffset = this.$gantt.$task.getBoundingClientRect().x;\r\n\t\tconst cursorOffset = e.clientX - timelineOffset;\r\n\t\tconst wheelY = this.$gantt.env.isFF ? (e.deltaY*-40) : e.wheelDelta;\r\n\t\tlet wheelUp = false;\r\n\t\tif (wheelY > 0) {\r\n\t\t\twheelUp = true;\r\n\t\t}\r\n\t\te.preventDefault();\r\n\t\te.stopPropagation();\r\n\t\tthis._setScaleSettings(wheelUp, cursorOffset);\r\n\t};\r\n\r\n\tprivate _setScaleSettings(wheelUp: boolean, cursorOffset: number) {\r\n\t\tif (wheelUp) {\r\n\t\t\tthis._stepUp(cursorOffset);\r\n\t\t} else {\r\n\t\t\tthis._stepDown(cursorOffset);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _setScaleDates = () => {\r\n\t\tif(this._initialStartDate && this._initialEndDate){\r\n\t\t\tthis.$gantt.config.start_date = this._initialStartDate;\r\n\t\t\tthis.$gantt.config.end_date = this._initialEndDate;\r\n\t\t}\r\n\t};\r\n\r\n\tprivate _stepUp(cursorOffset) {\r\n\t\tif (this._activeLevelIndex >= this._levels.length - 1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet nextLevel = this._activeLevelIndex;\r\n\t\tthis._setScaleDates();\r\n\r\n\t\tif(this._widthStep){\r\n\t\t\tlet newColumnWidth = this.$gantt.config.min_column_width + this._widthStep;\r\n\t\t\tif (newColumnWidth > this._maxColumnWidth) {\r\n\t\t\t\tnewColumnWidth = this._minColumnWidth;\r\n\t\t\t\tnextLevel++;\r\n\t\t\t}\r\n\r\n\t\t\tthis.$gantt.config.min_column_width = newColumnWidth;\r\n\t\t}else{\r\n\t\t\tnextLevel++;\r\n\t\t}\r\n\t\tthis._setLevel(nextLevel, cursorOffset);\r\n\t}\r\n\tprivate _stepDown(cursorOffset) {\r\n\t\tif (this._activeLevelIndex < 1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet nextLevel = this._activeLevelIndex;\r\n\t\tthis._setScaleDates();\r\n\r\n\t\tif(this._widthStep){\r\n\t\t\tlet newColumnWidth = this.$gantt.config.min_column_width - this._widthStep;\r\n\t\t\tif (newColumnWidth < this._minColumnWidth) {\r\n\t\t\t\tnewColumnWidth = this._maxColumnWidth;\r\n\t\t\t\tnextLevel--;\r\n\t\t\t}\r\n\t\t\tthis.$gantt.config.min_column_width = newColumnWidth;\r\n\t\t}else{\r\n\t\t\tnextLevel--;\r\n\t\t}\r\n\t\tthis._setLevel(nextLevel, cursorOffset);\r\n\t}\r\n}","export default function(gantt) {\r\n\r\n\tgantt.config.touch_drag = 75; //nearly immediate dnd\r\n\tgantt.config.touch = true;\r\n\tgantt.config.touch_feedback = true;\r\n\tgantt.config.touch_feedback_duration = 1;\r\n\tgantt._prevent_touch_scroll = false;\r\n\r\n\r\n\tgantt._touch_feedback = function () {\r\n\t\tif (gantt.config.touch_feedback) {\r\n\t\t\tif (navigator.vibrate)\r\n\t\t\t\tnavigator.vibrate(gantt.config.touch_feedback_duration);\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\t\tif (gantt.$container)\t{\r\n\t\t\taddTouchEvents();\r\n\t\t}\r\n\t});\r\n\tgantt.attachEvent(\"onGanttLayoutReady\", function(){\r\n\t\tif (gantt.$container)\t{\r\n\t\t\t\tgantt.attachEvent(\"onGanttRender\", addTouchEvents, {once: true});\r\n\t\t}\r\n\t});\r\n\r\n\tfunction addTouchEvents(){\r\n\t\tif (gantt.config.touch != \"force\")\r\n\t\t\tgantt.config.touch = gantt.config.touch &&\r\n\t\t\t\t((navigator.userAgent.indexOf(\"Mobile\") != -1) ||\r\n\t\t\t\t\t(navigator.userAgent.indexOf(\"iPad\") != -1) ||\r\n\t\t\t\t\t(navigator.userAgent.indexOf(\"Android\") != -1) ||\r\n\t\t\t\t\t(navigator.userAgent.indexOf(\"Touch\") != -1)) ||\r\n\t\t\t\t\t((navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1));\r\n\r\n\t\tif (gantt.config.touch) {\r\n\t\t\t// IE doesn't support touch events. In other cases, a user may connect\r\n\t\t\t// a touch device at any time, so it should work in the forced touch mode\r\n\t\t\tconst touchEventsSupported = !gantt.env.isIE || !!window.navigator.maxTouchPoints;\r\n\r\n\t\t\tif (touchEventsSupported) {\r\n\t\t\t\tgantt._touch_events([\"touchmove\", \"touchstart\", \"touchend\"], function (ev) {\r\n\t\t\t\t\tif (ev.touches && ev.touches.length > 1) return null;\r\n\t\t\t\t\tif (ev.touches[0])\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\ttarget: ev.target,\r\n\t\t\t\t\t\t\tpageX: ev.touches[0].pageX,\r\n\t\t\t\t\t\t\tpageY: ev.touches[0].pageY,\r\n\t\t\t\t\t\t\tclientX: ev.touches[0].clientX,\r\n\t\t\t\t\t\t\tclientY: ev.touches[0].clientY\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\treturn ev;\r\n\t\t\t\t}, function (ev) {\r\n\t\t\t\t\treturn ev.defaultPrevented;\r\n\t\t\t\t});\r\n\t\t\t} else if (window.PointerEvent) {\r\n\t\t\t\tgantt._touch_events([\"pointermove\", \"pointerdown\", \"pointerup\"], function (ev) {\r\n\t\t\t\t\tif (ev.pointerType == \"mouse\") return null;\r\n\t\t\t\t\treturn ev;\r\n\t\t\t\t}, function (ev) {\r\n\t\t\t\t\treturn (!ev || (ev.pointerType == \"mouse\" ));\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tfunction findTargetView(event){\r\n\t\tvar allViews = gantt.$layout.getCellsByType(\"viewCell\");\r\n\r\n\t\tfor(var i = 0; i < allViews.length; i++){\r\n\t\t\tvar box = allViews[i].$view.getBoundingClientRect();\r\n\t\t\tif(event.clientX >= box.left && event.clientX <= box.right &&\r\n\t\t\t\tevent.clientY <= box.bottom && event.clientY >= box.top){\r\n\t\t\t\t\treturn allViews[i];\r\n\t\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getScrollState(view){\r\n\t\tvar scrollX = view.$config.scrollX ? gantt.$ui.getView(view.$config.scrollX) : null;\r\n\t\tvar scrollY = view.$config.scrollY ? gantt.$ui.getView(view.$config.scrollY) : null;\r\n\r\n\t\tvar scrollState = {x: null, y: null};\r\n\t\tif(scrollX){\r\n\t\t\tvar state = scrollX.getScrollState();\r\n\t\t\tif(state.visible){\r\n\t\t\t\tscrollState.x = scrollX.$view.scrollLeft;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(scrollY){\r\n\t\t\tvar state = scrollY.getScrollState();\r\n\t\t\tif(state.visible){\r\n\t\t\t\tscrollState.y = scrollY.$view.scrollTop;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn scrollState;\r\n\t}\r\n\r\n\tfunction scrollView(view, left, top){\r\n\t\tvar scrollX = view.$config.scrollX ? gantt.$ui.getView(view.$config.scrollX) : null;\r\n\t\tvar scrollY = view.$config.scrollY ? gantt.$ui.getView(view.$config.scrollY) : null;\r\n\r\n\t\tif(scrollX){\r\n\t\t\tscrollX.scrollTo(left, null);\r\n\t\t}\r\n\t\tif(scrollY){\r\n\t\t\tscrollY.scrollTo(null, top);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getTaskDND(){\r\n\t\tvar tasksDnD;\r\n\t\tif(gantt.$ui.getView(\"timeline\")){\r\n\t\t\ttasksDnD = gantt.$ui.getView(\"timeline\")._tasks_dnd;\r\n\t\t}\r\n\t\treturn tasksDnD;\r\n\t}\r\n\r\n\tvar touchHandlers = [];\r\n\r\n//we can't use native scrolling, as we need to sync momentum between different parts\r\n//so we will block native scroll and use the custom one\r\n//in future we can add custom momentum\r\n\tgantt._touch_events = function (names, accessor, ignore) {\r\n\t\t//webkit on android need to be handled separately\r\n\t\tvar dblclicktime = 0;\r\n\t\tvar actionMode = false;\r\n\t\tvar scrollMode = false;\r\n\t\tvar actionStart = null;\r\n\t\tvar previousActionStart = null;\r\n\t\tvar scrollState;\r\n\t\tvar longTapTimer = null;\r\n\t\tvar currentDndId = null;\r\n\t\tvar dndNodes = [];\r\n\t\tvar targetView = null;\r\n\t\tlet multiTouchEvents = {};\r\n\r\n\t\tfor(var i = 0; i < touchHandlers.length; i++){\r\n\t\t\tgantt.eventRemove(touchHandlers[i][0], touchHandlers[i][1], touchHandlers[i][2]);\r\n\t\t}\r\n\t\ttouchHandlers = [];\r\n\r\n\t\t//touch move\r\n\t\ttouchHandlers.push([gantt.$container, names[0], function (e) {\r\n\t\t\tvar tasksDnD = getTaskDND();\r\n\r\n\t\t\t\tif (ignore(e)) return;\r\n\r\n\t\t\t\t//ignore common and scrolling moves\r\n\t\t\t\tif (!actionMode) return;\r\n\r\n\t\t\t\tif (longTapTimer) clearTimeout(longTapTimer);\r\n\r\n\t\t\t\tvar source = accessor(e);\r\n\t\t\t\tif (tasksDnD && (tasksDnD.drag.id || tasksDnD.drag.start_drag)) {\r\n\t\t\t\t\ttasksDnD.on_mouse_move(source);\r\n\t\t\t\t\tif (e.preventDefault)\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.cancelBubble = true;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tif (!gantt._prevent_touch_scroll) {\r\n\t\t\t\t\tif (source && actionStart) {\r\n\t\t\t\t\t\tvar dx = actionStart.pageX - source.pageX;\r\n\t\t\t\t\t\tvar dy = actionStart.pageY - source.pageY;\r\n\t\t\t\t\t\tif (!scrollMode && (Math.abs(dx) > 5 || Math.abs(dy) > 5)) {\r\n\t\t\t\t\t\t\tscrollMode = true;\r\n\t\t\t\t\t\t\t//gantt._touch_scroll_active = scroll_mode = true;\r\n\t\t\t\t\t\t\tdblclicktime = 0;\r\n\r\n\t\t\t\t\t\t\tif(targetView){\r\n\t\t\t\t\t\t\t\tscrollState = getScrollState(targetView);\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\tscrollState = gantt.getScrollState();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (scrollMode) {\r\n\r\n\t\t\t\t\t\t\tvar newScrollState;\r\n\t\t\t\t\t\t\tvar scrollX = scrollState.x + dx;\r\n\t\t\t\t\t\t\tvar scrollY = scrollState.y + dy;\r\n\t\t\t\t\t\t\tif(targetView){\r\n\t\t\t\t\t\t\t\tscrollView(targetView, scrollX, scrollY);\r\n\t\t\t\t\t\t\t\tnewScrollState = getScrollState(targetView);\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\tgantt.scrollTo(scrollX, scrollY);\r\n\t\t\t\t\t\t\t\tnewScrollState = gantt.getScrollState();\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif ((scrollState.x != newScrollState.x && dy > 2 * dx) ||\r\n\t\t\t\t\t\t\t\t(scrollState.y != newScrollState.y && dx > 2 * dy )) {\r\n\t\t\t\t\t\t\t\treturn block_action(e);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn block_action(e);\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}]);\r\n\r\n\t\t// prevent page drag on touch move\r\n\t\ttry{\r\n\t\t\tdocument.addEventListener('touchmove', function(e) {\r\n\t\t\t\tif (gantt._touch_drag) {\r\n\t\t\t\t\tblock_action(e);\r\n\t\t\t\t}\r\n\t\t\t}, { passive: false });\r\n\t\t}\r\n\t\tcatch(e){\r\n\t\t\t// eslint-disable-next-line no-console\r\n\t\t\tconsole.warn(\"Cannot prevent touch event for the page drag\");\r\n\t\t}\r\n\r\n\t\t//block touch context menu in IE10\r\n\t\ttouchHandlers.push([this.$container, \"contextmenu\", function (e) {\r\n\t\t\tif (actionMode)\r\n\t\t\t\treturn block_action(e);\r\n\t\t}]);\r\n\r\n\t\t//touch start\r\n\t\ttouchHandlers.push([this.$container, names[1], function (e) {\r\n\t\t\tmultiTouchEvents = e.touches.length;\r\n\t\t\t// block pull-to-refresh\r\n\t\t\tif(document && document.body){\r\n\t\t\t\tdocument.body.classList.add(\"gantt_touch_active\");\r\n\t\t\t}\r\n\r\n\t\t\tif (ignore(e)) return;\r\n\t\t\tif (e.touches && e.touches.length > 1) {\r\n\t\t\t\tactionMode = false;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tactionStart = accessor(e);\r\n\t\t\ttargetView = findTargetView(actionStart);\r\n\t\t\tif (!gantt._locate_css(actionStart, \"gantt_hor_scroll\") && !gantt._locate_css(actionStart, \"gantt_ver_scroll\")) {\r\n\t\t\t\tactionMode = true;\r\n\t\t\t}\r\n\t\t\tvar tasksDnD = getTaskDND();\r\n\r\n\t\t\t//long tap\r\n\t\t\tlongTapTimer = setTimeout(function () {\r\n\t\t\t\tvar taskId = gantt.locate(actionStart);\r\n\t\t\t\tif (tasksDnD && (taskId && !gantt._locate_css(actionStart, \"gantt_link_control\") && !gantt._locate_css(actionStart, \"gantt_grid_data\"))) {\r\n\t\t\t\t\ttasksDnD.on_mouse_down(actionStart);\r\n\r\n\t\t\t\t\tif (tasksDnD.drag && tasksDnD.drag.start_drag) {\r\n\t\t\t\t\t\t// we need that as touch events break if the target node is removed from the DOM\r\n\t\t\t\t\t\tcloneTaskRendered(taskId);\r\n\t\t\t\t\t\ttasksDnD._start_dnd(actionStart);\r\n\t\t\t\t\t\tgantt._touch_drag = true;\r\n\r\n\t\t\t\t\t\tgantt.refreshTask(taskId);\r\n\r\n\t\t\t\t\t\tgantt._touch_feedback();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlongTapTimer = null;\r\n\t\t\t}, gantt.config.touch_drag);\r\n\t\t}]);\r\n\r\n\t\t//touch end\r\n\t\ttouchHandlers.push([this.$container, names[2], function (e) {\r\n\t\t\tif(document && document.body){\r\n\t\t\t\tdocument.body.classList.remove(\"gantt_touch_active\");\r\n\t\t\t}\r\n\t\t\tif (ignore(e)) return;\r\n\t\t\tif (longTapTimer) clearTimeout(longTapTimer);\r\n\t\t\tgantt._touch_drag = false;\r\n\t\t\tactionMode = false;\r\n\t\t\tvar source = accessor(e);\r\n\r\n\t\t\tvar tasksDnD = getTaskDND();\r\n\r\n\t\t\tif(tasksDnD)\r\n\t\t\t\ttasksDnD.on_mouse_up(source);\r\n\r\n\t\t\tif (currentDndId && gantt.isTaskExists(currentDndId)) {\r\n\t\t\t\tgantt.refreshTask(currentDndId);\r\n\t\t\t\tif(dndNodes.length){\r\n\t\t\t\t\tdndNodes.forEach(function(node){\r\n\t\t\t\t\t\tif(node.parentNode){\r\n\t\t\t\t\t\t\tnode.parentNode.removeChild(node);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tgantt._touch_feedback();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//gantt._touch_scroll_active = action_mode = scroll_mode = false;\r\n\t\t\tactionMode = scrollMode = false;\r\n\t\t\tdndNodes = [];\r\n\t\t\tcurrentDndId = null;\r\n\r\n\t\t\t//dbl-tap handling\r\n\t\t\tif (actionStart && dblclicktime) {\r\n\t\t\t\tvar now = new Date();\r\n\t\t\t\t// doubletap shouldn't happen with multitouch\r\n\t\t\t\tconst noMultitouch = multiTouchEvents <= 1;\r\n\t\t\t\t// double click events shouldn't fire when we quickly tap on different nodes\r\n\t\t\t\tconst sameTarget = previousActionStart && previousActionStart.target.innerHTML == actionStart.target.innerHTML;\r\n\t\t\t\tif ((now - dblclicktime) < 500 && noMultitouch && sameTarget) {\r\n\r\n\t\t\t\t\tvar mouseEvents = gantt.$services.getService(\"mouseEvents\");\r\n\t\t\t\t\tmouseEvents.onDoubleClick(actionStart);\r\n\t\t\t\t\tblock_action(e);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdblclicktime = now;\r\n\t\t\t\t\tpreviousActionStart = actionStart;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tdblclicktime = new Date();\r\n\t\t\t}\r\n\t\t}]);\r\n\r\n\t\tfor(var i = 0; i < touchHandlers.length; i++){\r\n\t\t\tgantt.event(touchHandlers[i][0], touchHandlers[i][1], touchHandlers[i][2]);\r\n\t\t}\r\n\r\n\t\t//common helper, prevents event\r\n\t\tfunction block_action(e) {\r\n\t\t\tif (e && e.preventDefault && e.cancelable){\r\n\t\t\t\te.preventDefault();\r\n\t\t\t}\r\n\t\t\te.cancelBubble = true;\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tfunction cloneTaskRendered(taskId) {\r\n\t\t\tconst renders = gantt._getTaskLayers();\r\n\t\t\tlet task = gantt.getTask(taskId);\r\n\t\t\tif (task) {\r\n\t\t\t\tlet visible = gantt.isTaskVisible(taskId);\r\n\t\t\t\tif (visible){\r\n\t\t\t\t\tcurrentDndId = taskId;\r\n\t\t\t\t\tfor (let i = 0; i < renders.length; i++) {\r\n\t\t\t\t\t\ttask = renders[i].rendered[taskId];\r\n\t\t\t\t\t\tif (task && task.getAttribute(gantt.config.task_attribute) && task.getAttribute(gantt.config.task_attribute) == taskId) {\r\n\t\t\t\t\t\t\tconst copy = task.cloneNode(true);\r\n\t\t\t\t\t\t\tdndNodes.push(task);\r\n\t\t\t\t\t\t\trenders[i].rendered[taskId] = copy;\r\n\t\t\t\t\t\t\ttask.style.display = \"none\";\r\n\t\t\t\t\t\t\tcopy.className += \" gantt_drag_move \";\r\n\t\t\t\t\t\t\ttask.parentNode.appendChild(copy);\r\n\t\t\t\t\t\t\t//return copy;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (task.$split_subtask){\r\n\t\t\t\t\tlet renderedParent = task.$rendered_parent;\r\n\t\t\t\t\tvisible = gantt.isTaskVisible(renderedParent);\r\n\t\t\t\t\tif (!visible){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcurrentDndId = taskId;\r\n\t\t\t\t\tfor (let i = 0; i < renders.length; i++) {\r\n\t\t\t\t\t\tconst parent = renders[i].rendered[renderedParent];\r\n\t\t\t\t\t\tlet taskNode;\r\n\t\t\t\t\t\tif (parent && parent.childNodes){\r\n\t\t\t\t\t\t\ttaskNode = parent.querySelector(`[${gantt.config.task_attribute}=\"${task.id}\"]`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (taskNode) {\r\n\t\t\t\t\t\t\t// move the child node to a different parent as the task bar will be repainted\r\n\t\t\t\t\t\t\t// and the initial node will be lost\r\n\t\t\t\t\t\t\tconst copy = taskNode.cloneNode(true);\r\n\t\t\t\t\t\t\ttaskNode.parentNode.appendChild(copy);\r\n\r\n\t\t\t\t\t\t\tgantt.$task_bars.appendChild(taskNode);\r\n\t\t\t\t\t\t\ttaskNode.style.display = \"none\";\r\n\r\n\t\t\t\t\t\t\t// don't add the node as rendered otherwise it will be lost:\r\n\t\t\t\t\t\t\t// renders[i].rendered[taskId] = taskNode;\r\n\t\t\t\t\t\t\t// instead, add it to dndNodes as its elements will be removed after drag\r\n\t\t\t\t\t\t\tdndNodes.push(taskNode);\r\n\r\n\t\t\t\t\t\t\ttaskNode = null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n};","function dummy() {\r\n\t// eslint-disable-next-line\r\n\tconsole.log(\"Method is not implemented.\"); \r\n}\r\nfunction BaseControl() {\r\n}\r\n\r\n// base methods will be runned in gantt context\r\nBaseControl.prototype.render = dummy; // arguments: sns\r\nBaseControl.prototype.set_value = dummy; // arguments: node, value, ev, sns(config)\r\nBaseControl.prototype.get_value = dummy; // arguments node, ev, sns(config)\r\nBaseControl.prototype.focus = dummy; // arguments: node\r\n\r\nexport default function(gantt) { // we could send current instance of gantt to module\r\n\treturn BaseControl;\r\n};","import * as helpers from \"../../../utils/helpers\";\r\n\r\nvar htmlHelpers = {\r\n\tgetHtmlSelect: function(options, attributes, value) {\r\n\t\tvar innerHTML = \"\";\r\n\t\tvar _this = this;\r\n\r\n\t\toptions = options || [];\r\n\t\t\r\n\t\thelpers.forEach(options, function(entry) {\r\n\t\t\tvar _attributes = [{ key: \"value\", value: entry.key }];\r\n\r\n\t\t\tif (value == entry.key) {\r\n\t\t\t\t_attributes[_attributes.length] = { key: \"selected\", value: \"selected\" };\r\n\t\t\t}\r\n\t\t\tif (entry.attributes) {\r\n\t\t\t\t_attributes = _attributes.concat(entry.attributes);\r\n\t\t\t}\r\n\t\t\tinnerHTML += _this.getHtmlOption({ innerHTML: entry.label }, _attributes);\r\n\t\t});\r\n\r\n\t\treturn _getHtmlContainer(\"select\", { innerHTML: innerHTML }, attributes);\r\n\t},\r\n\tgetHtmlOption: function(options, attributes) { return _getHtmlContainer(\"option\", options, attributes); },\r\n\tgetHtmlButton: function(options, attributes) { return _getHtmlContainer(\"button\", options, attributes); },\r\n\tgetHtmlDiv: function(options, attributes) { return _getHtmlContainer(\"div\", options, attributes); },\r\n\tgetHtmlLabel: function(options, attributes) { return _getHtmlContainer(\"label\", options, attributes); },\r\n\tgetHtmlInput: function(attributes) {\r\n\t\treturn \"<input\" + _getHtmlAttributes(attributes || []) + \">\";\r\n\t}\r\n};\r\n\r\nfunction _getHtmlContainer(tag, options, attributes) {\r\n\tvar html;\r\n\r\n\toptions = options || [];\r\n\t\r\n\thtml = \"<\" + tag + _getHtmlAttributes(attributes || []) + \">\" + (options.innerHTML || \"\") + \"</\" + tag +\">\";\r\n\treturn html;\r\n\r\n}\r\n\r\nfunction _getHtmlAttributes(attributes) {\r\n\tvar html = \"\";\r\n\r\n\thelpers.forEach(attributes, function(entry) {\r\n\t\thtml += \" \" + entry.key + \"='\" + entry.value + \"'\";\r\n\t});\r\n\treturn html;\r\n}\r\n\r\nexport default htmlHelpers;","import __extends from \"../../../../utils/extends\";\r\nimport htmlHelpers from \"../../utils/html_helpers\";\r\n\r\nimport Super from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tconst _super = Super(gantt);\r\n\r\n\tfunction SelectControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this;\r\n\t\r\n\t\treturn self; \r\n\t}\r\n\t\r\n\t__extends(SelectControl, _super);\r\n\t\r\n\tSelectControl.prototype.render = function(sns) {\r\n\t\tconst height = sns.height ? `height:${sns.height}px;` : '';\r\n\t\tlet html = `<div class='gantt_cal_ltext gantt_section_${sns.name}' ${height ? `style='${height}'` : ''}>`;\r\n\r\n\t\thtml += htmlHelpers.getHtmlSelect(sns.options, [{ key: \"style\", value: \"width:100%;\" }, { key: \"title\", value: sns.name }]);\r\n\t\thtml += \"</div>\";\r\n\t\treturn html;\r\n\t};\r\n\r\n\tSelectControl.prototype.set_value = function(node, value, ev, sns) {\r\n\t\tvar select = node.firstChild;\r\n\t\tif (!select._dhx_onchange && sns.onchange) {\r\n\t\t\tselect.onchange = sns.onchange;\r\n\t\t\tselect._dhx_onchange = true;\r\n\t\t}\r\n\t\tif (typeof value === \"undefined\")\r\n\t\t\tvalue = (select.options[0] || {}).value;\r\n\t\tselect.value = value || \"\";\r\n\t};\r\n\t\r\n\tSelectControl.prototype.get_value = function(node) {\r\n\t\treturn node.firstChild.value;\r\n\t};\r\n\t\r\n\tSelectControl.prototype.focus = function(node) {\r\n\t\tvar a = node.firstChild;\r\n\t\tgantt._focus(a, true);\r\n\t};\r\n\t\r\n\treturn SelectControl;\r\n};","import __extends from \"../../../../utils/extends\";\r\nimport SelectControl from \"./select_control\";\r\nexport default function(gantt) {\r\n\tvar _super = SelectControl(gantt);\r\n\r\n\tfunction ParentControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this; \r\n\r\n\t\treturn self; \r\n\t}\r\n\r\n\t__extends(ParentControl, _super);\r\n\r\n\r\n\tParentControl.prototype.render = function(sns) {\r\n\t\treturn _display(sns, false);\r\n\t};\r\n\r\n\tParentControl.prototype.set_value = function(node, value, ev, config) {\r\n\t\t// GS-1051. If the value is `0`, the set_value function in the select control won't select \r\n\t\t// the first child because (0 || '') = '';\r\n\t\tif (value === 0) value = \"0\";\r\n\r\n\t\t// GS-1374. Usually, the ID is not specified,\r\n\t\t// we need to add it to keep the options and exclude the current task\r\n\t\tif (!ev.id && gantt.getState().lightbox) {\r\n\t\t\tev.id = gantt.getLightboxValues().id;\r\n\t\t}\r\n\r\n\t\tvar tmpDom = document.createElement(\"div\");\r\n\t\ttmpDom.innerHTML = _display(config, ev.id);\r\n\t\tvar newOptions = tmpDom.removeChild(tmpDom.firstChild);\r\n\t\tnode.onselect = null;\r\n\t\tnode.parentNode.replaceChild(newOptions, node);\r\n\r\n\t\treturn gantt.form_blocks.select.set_value.apply(gantt, [newOptions, value, ev, config]);\r\n\t};\r\n\r\n\tfunction _display(config, item_id) {\r\n\t\tvar tasks = [],\r\n\t\t\toptions = [];\r\n\t\tif (item_id) {\r\n\t\t\ttasks = gantt.getTaskByTime();\r\n\t\t\tif (config.allow_root) {\r\n\t\t\t\ttasks.unshift({id: gantt.config.root_id, text: config.root_label || \"\"});\r\n\t\t\t}\r\n\t\t\ttasks = _filter(tasks, config, item_id);\r\n\t\t\tif (config.sort) {\r\n\t\t\t\ttasks.sort(config.sort);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar text = config.template || gantt.templates.task_text;\r\n\t\tfor (var i = 0; i < tasks.length; i++) {\r\n\t\t\tvar label = text.apply(gantt, [tasks[i].start_date, tasks[i].end_date, tasks[i]]);\r\n\t\t\tif (label === undefined) {\r\n\t\t\t\tlabel = \"\";\r\n\t\t\t}\r\n\t\t\toptions.push({\r\n\t\t\t\tkey: tasks[i].id,\r\n\t\t\t\tlabel: label\r\n\t\t\t});\r\n\t\t}\r\n\t\tconfig.options = options;\r\n\t\tconfig.map_to = config.map_to || \"parent\";\r\n\t\treturn gantt.form_blocks.select.render.apply(this, arguments);\r\n\t}\r\n\r\n\tfunction _filter(options, config, item_id) {\r\n\t\tvar filter = config.filter || function() {\r\n\t\t\treturn true;\r\n\t\t};\r\n\r\n\t\toptions = options.slice(0);\r\n\r\n\t\tfor (var i = 0; i < options.length; i++) {\r\n\t\t\tvar task = options[i];\r\n\t\t\tif (task.id == item_id || gantt.isChildOf(task.id, item_id) || filter(task.id, task) === false) {\r\n\t\t\t\toptions.splice(i, 1);\r\n\t\t\t\ti--;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn options;\r\n\t}\r\n\treturn ParentControl;\r\n};","\r\nimport * as helpers from \"../../../../utils/helpers\";\r\nimport __extends from \"../../../../utils/extends\";\r\nimport Super from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tconst _super = Super(gantt);\r\n\r\n\tconst localCache = {\r\n\t\tresources: {},\r\n\t\tresourcesValues: {},\r\n\t\tfilter: {},\r\n\t\teventsInitialized: {},\r\n\t\tgridID: null,\r\n\t\tresource_filter_value: null,\r\n\t\tinitialValues: [],\r\n\t\tnewValues: []\r\n\t};\r\n\r\n\tconst selectResEditor = { type: \"select\", map_to: \"resource_id\" , options: gantt.serverList(\"resourceOptions\")};\r\n\tconst numberEditor = { type: \"number\", map_to: \"value\", min: 0, max: 100 };\r\n\r\n\tconst dateToStr = gantt.date.date_to_str(\"%d-%m-%Y\");\r\n\r\n\tgantt.resource_table = {\r\n\t\tscale_height: 35,\r\n\t\trow_height: 35,\r\n\t\tcolumns: [\r\n\t\t\t{\r\n\t\t\t\tname: \"resource\", label: \"Resource\", align: \"center\", width: 80, editor: selectResEditor, template: function (assignment) {\r\n\t\t\t\t\tlet defaultValue = \"Unassigned\";\r\n\t\t\t\t\tconst resource = gantt.getDatastore(gantt.config.resource_store).getItem(assignment.resource_id);\r\n\t\t\t\t\treturn resource ? resource.text : defaultValue;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tname: \"hours/Day\", label: \"Hours/Day\", align: \"center\", width: 70, editor: numberEditor, template: function (assignment) {\r\n\t\t\t\t\treturn assignment.value ? +assignment.value : ``;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tname: \"start\", label: \"Start\", align: \"center\", width: 100, template: function (assignment) {\r\n\t\t\t\t\treturn assignment.start_date ? dateToStr(assignment.start_date) : ``;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tname: \"end\", label: \"End\", align: \"center\", width: 100, template: function (assignment) {\r\n\t\t\t\t\treturn assignment.end_date ? dateToStr(assignment.end_date) : ``;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tname: \"duration\", label: \"Duration\", align: \"center\", width: 80, template: function (assignment) {\r\n\t\t\t\t\tif (assignment.duration) {\r\n\t\t\t\t\t\treturn `${assignment.duration} day${assignment.duration == 1 ? '' : 's'}`;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn ``;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tname: \"delete\", label: \"Delete\", align: \"center\", width: 80, template: function (assignment) {\r\n\t\t\t\t\treturn `<div data-assignment-id='${assignment.id}' data-assignment-delete='${assignment.id}' class='dhx_gantt_icon dhx_gantt_icon_delete'></div>`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t],\r\n\t\tresource_default_assignment: {\r\n\t\t\tduration: null,\r\n\t\t\tvalue: 8,\r\n\t\t\tstart_date: null,\r\n\t\t\tend_date: null,\r\n\t\t\tmode: \"default\"\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.attachEvent(\"onAfterLightbox\", _clearCached);\r\n\r\n\tfunction newResourcesControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this;\r\n\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(newResourcesControl, _super);\r\n\r\n\tfunction _generateResourceInputSection(index, name) {\r\n\t\tconst resourceFilterPlaceholder = gantt.locale.labels.resources_filter_placeholder || \"Search...\";\r\n\t\tconst html = `<div class='gantt_resource_selector_filter_wrapper gantt_cal_lsection' data-section-name='${name}'>\r\n\t\t\t\t\t\t<div class='gantt_cal_ltext gantt_resources_filter'>\r\n\t\t\t\t\t\t\t<label class=\"dhx_gantt_icon dhx_gantt_icon_search\">\r\n\t\t\t\t\t\t\t\t<input type='text' class='gantt_resources_filter_input' placeholder='${resourceFilterPlaceholder}' tab-index=\"-1\"> \r\n\t\t\t\t\t\t\t<label>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div role='button' aria-label='Add Assignment' class='gantt_custom_button gantt_add_resources' data-index='${index}'><div class='gantt_custom_button_add_resources gantt_add'></div><div class='gantt_custom_button_label'>${gantt.locale.labels.resources_add_button}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>`;\r\n\t\treturn html;\r\n\t}\r\n\r\n\r\n\tfunction _generateResourceTable(node, assignments, task, sns) {\r\n\t\t// destroy grid if it exists\r\n\t\tif(gantt.$ui.getView(\"GridRL\") && !localCache.gridID){\r\n\t\t\tgantt.$ui.getView(\"GridRL\").destructor();\r\n\t\t}\r\n\r\n\t\tif (!localCache.gridID) {\r\n\t\t\t// temp store for assignments in the lightbox\r\n\t\t\tconst resourceTable = document.createElement(\"div\");\r\n\t\t\tresourceTable.classList.add(\"gantt_resource_selector_grid\");\r\n\t\t\tconst tempAssignmentStore = gantt.createDatastore({\r\n\t\t\t\tname: \"temp_resource_assignment_store\",\r\n\t\t\t\tinitItem: function (item) {\r\n\t\t\t\t\tif (!item.id) {\r\n\t\t\t\t\t\titem.id = gantt.uid();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn item;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tgantt.$data.tempAssignmentsStore = tempAssignmentStore; // link to gantt\r\n\t\t\tconst gridConfig = {...gantt.config.layout, id: \"GridRL\", sectionName: sns.name };\r\n\t\t\tconst grid = gantt.$ui.createView(\"GridRL\", gantt.$root, gridConfig);  // creating grid\r\n\t\t\tgrid.init(resourceTable); // init grid\r\n\t\t\tconst width = gantt._lightbox.offsetWidth - (gantt.config.wide_form ? 150 : 0); \r\n\t\t\tgrid.setSize(width, \"auto\"); // set width and height of the grid\r\n\t\t\tgantt.ext.inlineEditorsLightbox = gantt.ext._inlineEditors.createEditors(grid); //attach inline editors\r\n\t\t\tgantt.ext.inlineEditorsLightbox.init();\r\n\t\t\tlocalCache.gridID = grid.$id;\r\n\t\t\tnode.appendChild(resourceTable);\r\n\t\t\tconst resourceAssignmentsStore = gantt.getDatastore(gantt.config.resource_assignment_store);  // main store\r\n\t\t\tconst searchItems = [];\r\n\t\t\tresourceAssignmentsStore.eachItem(function(item){\r\n\t\t\t\tif(item.task_id && item.task_id == task.id){\r\n\t\t\t\t\tsearchItems.push(item);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tconst clonedAssignments = structuredClone(searchItems); // clone\r\n\t\t\ttempAssignmentStore.parse(clonedAssignments); // add all assignments from main to temp\r\n\t\t}\r\n\r\n\t\tgantt.$data.tempAssignmentsStore.attachEvent(\"onFilterItem\", function(id, assignment) {\r\n\t\t\tif (assignment.task_id == task.id){\r\n\t\t\t\tif (!localCache.resource_filter_value) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet resource = gantt.getDatastore(gantt.config.resource_store).getItem(assignment.resource_id);\r\n\t\t\t\t\tif (resource.text.toLowerCase().indexOf(localCache.resource_filter_value) > -1) return true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t});\r\n\t\tgantt.refreshData();\r\n\t}\r\n\r\n\tfunction _generateAssignmentDefaultRow(sectionName) {\r\n\t\tlet resource_id;\r\n\t\tconst task = gantt.getTask(gantt._lightbox_id);\r\n\t\tconst assignments = gantt.getTaskAssignments(task.id);\r\n\t\tif(assignments.length){\r\n\t\t\tresource_id = assignments[0].resource_id;\r\n\t\t} else {\r\n\t\t\tconst resources = gantt.serverList(\"resourceOptions\");\r\n\t\t\tif(resources.length){\r\n\t\t\t\tresource_id = resources[0].id;\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(`There is no any resources in resource store, please check your data:\r\n\t\t\t\t\thttps://docs.dhtmlx.com/gantt/desktop__resource_management.html#assigningresources`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst tempAssignmentStore = gantt.getDatastore(\"temp_resource_assignment_store\");\r\n\t\tconst lightboxSection = gantt.getLightboxSection(sectionName).section;\r\n\t\tconst resourceConfig = lightboxSection.config ?? gantt.resource_table;\r\n\t\tconst config = resourceConfig.resource_default_assignment ?? gantt.resource_table.resource_default_assignment;\r\n\r\n\t\ttempAssignmentStore.addItem({\r\n\t\t\tresource_id,\r\n\t\t\ttask_id: task.id,\r\n\t\t\tduration: config.duration ?? gantt.calculateDuration(task),\r\n\t\t\tvalue: config.value,\r\n\t\t\tstart_date: config.start_date ?? task.start_date,\r\n\t\t\tend_date: config.end_date ?? task.end_date,\r\n\t\t\tmode: config.mode\r\n\t\t});\r\n\t\tgantt.refreshData();\r\n\t}\r\n\r\n\tfunction _setFocus(container){\r\n\t\tconst resourceRows = container.querySelectorAll(\".gantt_row.gantt_row_task\");\r\n\t\tif(resourceRows){\r\n\t\t\tconst lastRow = resourceRows[resourceRows.length -1];\r\n\t\t\tconst resourceCell = lastRow.querySelector(\".gantt_cell\");\r\n\t\t\tif(resourceCell){\r\n\t\t\t\tconst {id, columnName} = gantt.ext.inlineEditorsLightbox.locateCell(resourceCell);\r\n\t\t\t\tif(id && columnName){\r\n\t\t\t\t\tgantt.ext.inlineEditorsLightbox.startEdit(id, columnName);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tnewResourcesControl.prototype.render = function(sns) {\r\n\t\tif(!sns.options){\r\n\t\t\tsns.options = gantt.serverList(\"resourceOptions\");\r\n\t\t}\r\n\r\n\t\tif(!sns.map_to || sns.map_to == \"resource_selector\" || sns.map_to == \"auto\"){\r\n\t\t\tsns.map_to = gantt.config.resource_property;\r\n\t\t}\r\n\r\n\t\tlet html;\r\n\t\t// if set fixed height for this element, then resize of lightbox will be calculated improperly\r\n\t\thtml = `<div${!isNaN(sns.height) ? \" style='height:auto;'\" : \"\"} class='gantt_section_${sns.name}' data-section-name='${sns.name}'>`;\r\n\t\thtml += _generateResourceInputSection(sns.index, sns.name);\r\n\t\thtml += `</div>`;\r\n\t\thtml += `<div class=\"resources_section_placeholder\" style='display:none;'>${gantt.locale.labels.resources_section_placeholder}</div>`;\r\n\t\treturn html;\r\n\t};\r\n\r\n\tnewResourcesControl.prototype.button_click = function (index, el, section, container) {\r\n\t\tconst sectionName = section.getAttribute(\"data-section-name\") || container.getAttribute(\"data-section-name\");\r\n\t\tconst firstAddBtn = document.querySelector(\"[data-resource-selector-section]\");\r\n\t\tconst placeholder = document.querySelector(\".resources_section_placeholder\");\r\n\t\tconst resourceSection = document.querySelector(`.gantt_section_${sectionName} .gantt_resource_selector_filter_wrapper`);\r\n\t\tconst resourceGrid = document.querySelector(`.gantt_section_${sectionName} .gantt_grid`);\r\n\t\tfirstAddBtn.style.display = \"none\";\r\n\r\n\t\tif (gantt.callEvent(\"onSectionButton\", [gantt._lightbox_id, section]) === false) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (el.closest(\".gantt_custom_button.gantt_add_resources\")){\r\n\t\t\tplaceholder.style.display = \"none\";\r\n\t\t\tconst tempAssignmentStore = gantt.getDatastore(\"temp_resource_assignment_store\");\r\n\r\n\t\t\tif(tempAssignmentStore && tempAssignmentStore.getItems().length == 0){\r\n\t\t\t\tresourceSection.style.display = \"flex\";\r\n\t\t\t\tresourceGrid.style.display = \"block\";\r\n\t\t\t}\r\n\r\n\t\t\t_generateAssignmentDefaultRow(sectionName);\r\n\t\t\t_setFocus(container);\r\n\t\t}\r\n\t};\r\n\r\n\tfunction setInitialValues(task){\r\n\t\tlocalCache.initialValues = [];\r\n\t\tlocalCache.newValues = [];\r\n\t\tconst assignmentStore = gantt.$data.assignmentsStore;\r\n\t\tconst storeAssignments = assignmentStore.find(function (a) {\r\n\t\t\treturn a.task_id == task.id;\r\n\t\t});\r\n\t\tfor (let i = 0; i < storeAssignments.length; i++) {\r\n\t\t\tlocalCache.initialValues[i] = { resource_id: storeAssignments[i].resource_id, value: storeAssignments[i].value, id: storeAssignments[i].id };\r\n\t\t}\r\n\t}\r\n\r\n\tnewResourcesControl.prototype.set_value = function(node, assignments, task, sns, initialized) {\r\n\t\tlet firstAddBtn = document.querySelector(\"[data-resource-selector-section]\");\r\n\t\tlet placeholder = document.querySelector(\".resources_section_placeholder\");\r\n\t\tsetInitialValues(task);\r\n\t\tif(!initialized){\r\n\t\t\t\t_generateResourceTable(node, assignments, task, sns);\r\n\t\t\t\t_setFilterCache(node, sns);\r\n\t\t\t\t_initEvents(node, assignments, sns, this);\r\n\t\t\t\tfirstAddBtn.style.display = \"none\";\r\n\t\t\t\tlet resourceGrid = document.querySelector(`.gantt_section_${sns.name} .gantt_grid`);\r\n\t\t\t\tlet resourceSection = document.querySelector(`.gantt_section_${sns.name} .gantt_resource_selector_filter_wrapper`);\r\n\t\t\t\tresourceGrid.style.display = \"none\";\r\n\t\t\t\tresourceSection.style.display = \"none\";\r\n\t\t}\r\n\t\tconst tempAssignmentStore = gantt.getDatastore(\"temp_resource_assignment_store\");\r\n\t\tif(tempAssignmentStore) {\r\n\t\t\tlet resourceSection = document.querySelector(`.gantt_section_${sns.name} .gantt_resource_selector_filter_wrapper`);\r\n\t\t\tlet resourceGrid = document.querySelector(`.gantt_section_${sns.name} .gantt_grid`);\r\n\r\n\t\t\tif(tempAssignmentStore.getItems().length == 0){\r\n\t\t\t\tif(firstAddBtn.style.display == \"none\"){\r\n\t\t\t\t\tfirstAddBtn.style.display = \"flex\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tresourceSection.style.display = \"none\";\r\n\t\t\t\tresourceGrid.style.display = \"none\";\r\n\t\t\t\tplaceholder.style.display = \"block\";\r\n\t\t\t} else {\r\n\t\t\t\tresourceSection.style.display = \"flex\";\r\n\t\t\t\tresourceGrid.style.display = \"block\";\r\n\t\t\t\tplaceholder.style.display = \"none\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tgantt._center_lightbox(gantt.getLightbox());\r\n\t};\r\n\r\n\tnewResourcesControl.prototype.get_value = function(node, task, sns, type) {\r\n\t\tconst tempAssignmentStore = gantt.getDatastore(\"temp_resource_assignment_store\");\r\n\t\tconst storeAssignments = tempAssignmentStore.find(function (a) {\r\n\t\t\treturn a.task_id == task.id;\r\n\t\t});\r\n\t\tfor (let i = 0; i < storeAssignments.length; i++) {\r\n\t\t\tlocalCache.newValues[i] = { \r\n\t\t\t\tresource_id: storeAssignments[i].resource_id.toString(), \r\n\t\t\t\tvalue: storeAssignments[i].value, \r\n\t\t\t\tid: storeAssignments[i].id, \r\n\t\t\t\tstart_date: storeAssignments[i].start_date,\r\n\t\t\t\tend_date: storeAssignments[i].end_date,\r\n\t\t\t\tduration: storeAssignments[i].duration,\r\n\t\t\t\tmode: storeAssignments[i].mode,\r\n\t\t\t\tdelay: storeAssignments[i].delay\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (type == \"save\"){\r\n\t\t\treturn localCache.newValues;\r\n\t\t} else {\r\n\t\t\treturn localCache.initialValues;\r\n\t\t}\r\n\t};\r\n\r\n\tfunction getVisibleResources(task, options){\r\n\t\tlet visibleResources = [];\r\n\t\tconst tempAssignmentStore = gantt.getDatastore(\"temp_resource_assignment_store\");\r\n\t\tconst currentAssignments = tempAssignmentStore.find(function (a) {\r\n\t\t\treturn a.task_id == task.id;\r\n\t\t});\r\n\t\tfor (let i = 0; i < currentAssignments.length; i++) {\r\n\t\t\tlet resource = gantt.getDatastore(gantt.config.resource_store).getItem(currentAssignments[i].resource_id);\r\n\t\t\tif(resource){\r\n\t\t\t\tvisibleResources.push(resource);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn visibleResources;\r\n\t}\r\n\r\n\tfunction _getValue(el) {\r\n\t\treturn el.value.trim();\r\n\t}\r\n\r\n\tfunction _initEvents(node, ev, sns, context) {\r\n\t\tif (localCache.eventsInitialized[sns.id]) return;\r\n\r\n\t\tvar _applyFilter = function(e) {\r\n\t\t\t_saveValues(sns, node);\r\n\t\t\tvar resultSns;\r\n\t\t\tvar query;\r\n\t\t\tvar input;\r\n\t\t\tvar filterCache = _getFilterCache(sns);\r\n\t\t\tinput = filterCache.input;\r\n\r\n\t\t\tquery = _getValue(input);\r\n\t\t\tlocalCache.resource_filter_value = query.toLowerCase();\r\n\t\t\tfilterCache.filterApplied = !!query;\r\n\t\t\tif (gantt.getState().lightbox) {\r\n\t\t\t\tev = gantt.getLightboxValues();\r\n\t\t\t}\r\n\t\t\tresultSns = _getSnsToHideUnsetted(sns, ev, query);\r\n\t\t\tvar value = ev[sns.map_to];\r\n\t\t\tcontext.form_blocks.resource_selector.set_value(node, value, ev, resultSns);\r\n\t\t};\r\n\r\n\t\tfunction _saveValues(sns, domElement) {\r\n\t\t\tvar selector = _getInputElementSelector();\r\n\t\t\tvar inputs = domElement.querySelectorAll(selector);\r\n\r\n\t\t\tlocalCache.resourcesValues[sns.id] = localCache.resourcesValues[sns.id] || {};\r\n\r\n\t\t\tfor (var i = 0; i < inputs.length; i++) {\r\n\t\t\t\tvar key = inputs[i].getAttribute(\"data-item-id\");\r\n\t\t\t\tvar originalAssignmentId = inputs[i].getAttribute(\"data-assignment-id\");\r\n\t\t\t\tif (!inputs[i].disabled) {\r\n\t\t\t\t\tlocalCache.resourcesValues[sns.id][key] = {value: inputs[i].value, id: originalAssignmentId};\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdelete localCache.resourcesValues[sns.id][key];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t_applyFilter = helpers.throttle(_applyFilter, 100);\r\n\r\n\t\t_getFilterCache(sns).container.addEventListener(\"keyup\", _applyFilter);\r\n\t\t_getFilterCache(sns).container.addEventListener(\"input\", _applyFilter, true);\r\n\t\t_getFilterCache(sns).container.addEventListener(\"change\", _applyFilter, true);\r\n\t\tlocalCache.eventsInitialized[sns.id] = true;\r\n\t}\r\n\r\n\tfunction _getSnsToHideUnsetted(controlConfig, task, query, hideUnsetted) {\r\n\t\tvar comparison;\r\n\t\tvar resultConfig = gantt.copy(controlConfig);\r\n\r\n\t\tif (query === \"\") {// show all\r\n\t\t\tresultConfig.resources = [];\r\n\t\t\tlet resourceIds = localCache.newValues.map(obj => {\r\n\t\t\t\treturn obj.resource_id;\r\n\t\t\t});\r\n\t\t\tif(resourceIds && resourceIds.length > 0){\r\n\t\t\t\tfor (let i = 0; i < resourceIds.length; i++) {\r\n\t\t\t\t\tlet resource = gantt.getDatastore(gantt.config.resource_store).getItem(resourceIds[i]);\r\n\t\t\t\t\tif(resource){\r\n\t\t\t\t\t\tresultConfig.resources.push(resource);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn resultConfig;\r\n\t\t}\r\n\r\n\t\tcomparison = function(entry) {// show matching labels only\r\n\t\t\tif (entry.text.toLowerCase().indexOf(query.toLowerCase()) >= 0) {\r\n\t\t\t\treturn entry;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tresultConfig.resources = getVisibleResources(task, controlConfig.options);\r\n\t\tresultConfig.resources = helpers.arrayFilter(resultConfig.resources, comparison);\r\n\t\treturn resultConfig;\r\n\t}\r\n\r\n\tfunction _getInputElementSelector(isChecked) {\r\n\t\tif(isChecked === undefined){\r\n\t\t\treturn \".gantt_resource_amount_input\";\r\n\t\t}else{\r\n\t\t\treturn \"[data-checked='\"+(isChecked ? \"true\" : \"false\") + \"'] .gantt_resource_amount_input\";\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _setFilterCache(node, sns) {\r\n\t\tif (!localCache.filter[sns.id]) {\r\n\t\t\tvar container = node.querySelector(\".gantt_resources_filter\");\r\n\t\t\tvar input = container.querySelector(\".gantt_resources_filter_input\");\r\n\r\n\t\t\tlocalCache.filter[sns.id] = {\r\n\t\t\t\tcontainer: container,\r\n\t\t\t\tinput: input,\r\n\t\t\t\tfilterApplied: false\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn localCache.filter[sns.id];\r\n\t}\r\n\r\n\tfunction _getFilterCache(sns) {\r\n\t\treturn localCache.filter[sns.id];\r\n\t}\r\n\r\n\tfunction _clearCached() {\r\n\t\tfor (var key in localCache.filter) {\r\n\t\t\tlocalCache.filter[key].input.value = \"\";\r\n\t\t\tlocalCache.filter[key].filterApplied = false;\r\n\t\t}\r\n\t\tlocalCache.resourcesValues = {};\r\n\t\tlocalCache.eventsInitialized = {};\r\n\t\tlocalCache.resource_filter_value = null;\r\n\t\tlocalCache.gridID = null;\r\n\t\tlocalCache.initialValues = [];\r\n\t\tlocalCache.newValues = [];\r\n\t}\r\n\r\n\treturn newResourcesControl;\r\n};","import TemplateControlConstructor from \"./controls/template_control\";\r\nimport TextareaControlConstructor from \"./controls/textarea_control\";\r\nimport TimeControlConstructor from \"./controls/time_control\";\r\nimport SelectControlConstructor from \"./controls/select_control\";\r\nimport CheckboxControlConstructor from \"./controls/checkbox_control\";\r\nimport RadioControlConstructor from \"./controls/radio_control\";\r\nimport DurationControlConstructor from \"./controls/duration_control\";\r\nimport ParentControlConstructor from \"./controls/parent_control\";\r\nimport ResourcesControlConstructor from \"./controls/resources_control\";\r\nimport ConstraintControlConstructor from \"./controls/constraint_control\";\r\nimport TypeselectControlConstructor from \"./controls/typeselect_control\";\r\nimport BaselineControlConstructor from \"./controls/baseline_control\";\r\nimport NewResourcesControlConstructor from \"./controls/resource_selector_control\";\r\n\r\nimport * as domHelpers from \"../utils/dom_helpers\";\r\nimport * as helpers from \"../../../utils/helpers\";\r\n\t\r\n\r\nexport default function (gantt) {\r\n\r\n\r\n\tvar TemplateControl = TemplateControlConstructor(gantt);\r\n\tvar TextareaControl = TextareaControlConstructor(gantt);\r\n\tvar TimeControl = TimeControlConstructor(gantt);\r\n\tvar SelectControl = SelectControlConstructor(gantt);\r\n\tvar CheckboxControl = CheckboxControlConstructor(gantt);\r\n\tvar RadioControl = RadioControlConstructor(gantt);\r\n\tvar DurationControl = DurationControlConstructor(gantt);\r\n\tvar ParentControl = ParentControlConstructor(gantt);\r\n\tvar ResourcesControl = ResourcesControlConstructor(gantt);\r\n\tvar ConstraintControl = ConstraintControlConstructor(gantt);\r\n\tvar TypeselectControl = TypeselectControlConstructor(gantt);\r\n\tvar BaselineControl = BaselineControlConstructor(gantt);\r\n\tvar NewResourcesControl = NewResourcesControlConstructor(gantt);\r\n\r\n\tgantt._lightbox_methods = {};\r\n\tgantt._lightbox_template = \"<div class='gantt_cal_ltitle'><span class='gantt_mark'>&nbsp;</span><span class='gantt_time'></span><span class='gantt_title'></span></div><div class='gantt_cal_larea'></div>\";\r\n\tgantt._lightbox_template = `<div class='gantt_cal_ltitle'><div class=\"dhx_cal_ltitle_descr\"><span class='gantt_mark'>&nbsp;</span><span class='gantt_time'></span><span class='dhx_title'></span>\r\n</div>\r\n<div class=\"gantt_cal_ltitle_controls\">\r\n\t<a class=\"gantt_cal_ltitle_close_btn dhx_gantt_icon dhx_gantt_icon_close\"></a>\r\n\r\n</div></div><div class='gantt_cal_larea'></div>`;\r\n\r\n\t// GS-1952. Attaching the lightbox to the BODY element is not considered secure.\r\n\t// Attach it to Gantt container for Salesforce and other secure environments\r\n\tgantt._lightbox_root = gantt.$root;\r\n\tfunction setParentNode() {\r\n\t\tconst cspEnvironment = gantt.config.csp === true;\r\n\t\tif (cspEnvironment || gantt.env.isSalesforce) {\r\n\t\t\tgantt._lightbox_root = gantt.$root;\r\n\t\t} else {\r\n\t\t\tgantt._lightbox_root = document.body;\r\n\t\t}\r\n\t}\r\n\r\n\t//TODO: gantt._lightbox_id is changed from data.js and accessed from autoscheduling, check if it can be removed from gantt object\r\n\tvar state = gantt.$services.getService(\"state\");\r\n\tstate.registerProvider(\"lightbox\", function () {\r\n\t\treturn {\r\n\t\t\tlightbox: gantt._lightbox_id\r\n\t\t};\r\n\t});\r\n\r\n\tgantt.showLightbox = function (id) {\r\n\t\tvar task = this.getTask(id);\r\n\t\tif (!this.callEvent(\"onBeforeLightbox\", [id])) {\r\n\t\t\tif(gantt.isTaskExists(id) && gantt.getTask(id).$new){\r\n\t\t\t\t//GS-2340 if 'onBeforeLightbox' returns 'false' need update the order in datastore\r\n\t\t\t\tthis.$data.tasksStore._updateOrder();\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar box = this.getLightbox(this.getTaskType(task.type));\r\n\r\n\t\tthis.showCover(box);\r\n\t\tthis._fill_lightbox(id, box);\r\n\t\tthis._setLbPosition(box);\r\n\t\tthis._waiAria.lightboxVisibleAttr(box);\r\n\r\n\t\tthis.callEvent(\"onLightbox\", [id]);\r\n\t};\r\n\r\n\tfunction _is_chart_visible(gantt) {\r\n\t\tvar timeline = gantt.$ui.getView(\"timeline\");\r\n\t\tif (timeline && timeline.isVisible()) {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tgantt._get_timepicker_step = function () {\r\n\t\tif (this.config.round_dnd_dates) {\r\n\t\t\tvar step;\r\n\t\t\tif (_is_chart_visible(this)) {\r\n\t\t\t\tvar scale = gantt.getScale();\r\n\t\t\t\tstep = (helpers.getSecondsInUnit(scale.unit) * scale.step) / 60;//timepicker step is measured in minutes\r\n\t\t\t}\r\n\r\n\t\t\tif (!step || step >= 60 * 24) {\r\n\t\t\t\tstep = this.config.time_step;\r\n\t\t\t}\r\n\t\t\treturn step;\r\n\t\t}\r\n\t\treturn this.config.time_step;\r\n\t};\r\n\tgantt.getLabel = function (property, key) {\r\n\t\tvar sections = this._get_typed_lightbox_config();\r\n\t\tfor (var i = 0; i < sections.length; i++) {\r\n\t\t\tif (sections[i].map_to == property) {\r\n\t\t\t\tvar options = sections[i].options;\r\n\t\t\t\tfor (var j = 0; j < options.length; j++) {\r\n\t\t\t\t\tif (options[j].key == key) {\r\n\t\t\t\t\t\treturn options[j].label;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn \"\";\r\n\t};\r\n\r\n\tgantt.updateCollection = function (list_name, collection) {\r\n\t\tcollection = collection.slice(0);\r\n\t\tvar list = gantt.serverList(list_name);\r\n\t\tif (!list) return false;\r\n\t\tlist.splice(0, list.length);\r\n\t\tlist.push.apply(list, collection || []);\r\n\t\tgantt.resetLightbox();\r\n\t};\r\n\tgantt.getLightboxType = function () {\r\n\t\treturn this.getTaskType(this._lightbox_type);\r\n\t};\r\n\tgantt.getLightbox = function (type) {\r\n\t\tvar lightboxDiv;\r\n\t\tvar fullWidth;\r\n\t\tvar html;\r\n\t\tvar sns;\r\n\t\tvar ds;\r\n\t\tvar classNames = \"\";\r\n\t\tsetParentNode();\r\n\r\n\t\tif (type === undefined)\r\n\t\t\ttype = this.getLightboxType();\r\n\r\n\t\tif (!this._lightbox || this.getLightboxType() != this.getTaskType(type)) {\r\n\t\t\tthis._lightbox_type = this.getTaskType(type);\r\n\t\t\tlightboxDiv = document.createElement(\"div\");\r\n\t\t\tclassNames = \"gantt_cal_light\";\r\n\t\t\tfullWidth = this._is_lightbox_timepicker();\r\n\r\n\t\t\tif (gantt.config.wide_form)\r\n\t\t\t\tclassNames += \" gantt_cal_light_wide\";\r\n\r\n\t\t\tif (fullWidth) {\r\n\t\t\t\tclassNames += \" gantt_cal_light_full\";\r\n\t\t\t}\r\n\r\n\t\t\tlightboxDiv.className = classNames;\r\n\r\n\t\t\tlightboxDiv.style.visibility = \"hidden\";\r\n\t\t\thtml = this._lightbox_template;\r\n\t\t\thtml += \"<div class='gantt_cal_lcontrols'>\";\r\n\t\t\thtml += getHtmlButtons(this.config.buttons_left);\r\n\t\t\thtml += \"<div class='gantt_cal_lcontrols_push_right'></div>\";\r\n\t\t\thtml += getHtmlButtons(this.config.buttons_right, true);\r\n\t\t\thtml += \"</div>\";\r\n\r\n\t\t\tlightboxDiv.innerHTML = html;\r\n\r\n\t\t\tgantt._waiAria.lightboxAttr(lightboxDiv);\r\n\r\n\t\t\tif (gantt.config.drag_lightbox) {\r\n\t\t\t\tlightboxDiv.firstChild.onmousedown = gantt._ready_to_dnd;\r\n\t\t\t\tlightboxDiv.firstChild.addEventListener('touchstart', function(e){\r\n\t\t\t\t\tgantt._ready_to_dnd(e.touches[0]);\r\n\t\t\t\t});\r\n\t\t\t\tlightboxDiv.firstChild.onselectstart = function () {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t};\r\n\t\t\t\tlightboxDiv.firstChild.style.cursor = \"pointer\";\r\n\t\t\t\tgantt._init_dnd_events();\r\n\t\t\t}\r\n\r\n\t\t\t// GS-1428: If there is lightbox node, we need to remove it from the DOM\r\n\t\t\tif (this._lightbox){\r\n\t\t\t\tthis.resetLightbox();\r\n\t\t\t}\r\n\t\t\tshow_cover();\r\n\t\t\tthis._cover.insertBefore(lightboxDiv, this._cover.firstChild);\r\n\t\t\tthis._lightbox = lightboxDiv;\r\n\r\n\t\t\tsns = this._get_typed_lightbox_config(type);\r\n\t\t\thtml = this._render_sections(sns);\r\n\r\n\t\t\tds = lightboxDiv.querySelector(\"div.gantt_cal_larea\");\r\n\t\t\t\r\n\t\t\t//GS-1131. If gantt_cal_larea is displayed, Firefox renders buttons incorrectly;\r\n\t\t\tvar backup_overflow = ds.style.overflow;\r\n\t\t\tds.style.overflow = 'hidden';\r\n\r\n\t\t\tds.innerHTML = html;\r\n\r\n\t\t\t\r\n\r\n\t\t\tbindLabelsToInputs(sns);\r\n\r\n\t\t\tds.style.overflow = backup_overflow;\r\n\r\n\t\t\tthis._init_lightbox_events(this);\r\n\t\t\tlightboxDiv.style.display = \"none\";\r\n\t\t\tlightboxDiv.style.visibility = \"visible\";\r\n\t\t}\r\n\t\treturn this._lightbox;\r\n\t};\r\n\r\n\tgantt._render_sections = function (sns) {\r\n\t\tvar html = \"\";\r\n\t\tfor (var i = 0; i < sns.length; i++) {\r\n\t\t\tvar block = this.form_blocks[sns[i].type];\r\n\t\t\tif (!block) continue; //ignore incorrect blocks\r\n\t\t\tsns[i].id = \"area_\" + this.uid();\r\n\r\n\t\t\tvar display = sns[i].hidden ? \" style='display:none'\" : \"\";\r\n\t\t\tvar button = \"\";\r\n\t\t\tif (sns[i].button) {\r\n\t\t\t\tbutton = \"<div class='gantt_custom_button' data-index='\" + i + \"'><div class='gantt_custom_button_\" + sns[i].button + \"'></div><div class='gantt_custom_button_label'>\" + this.locale.labels[\"button_\" + sns[i].button] + \"</div></div>\";\r\n\t\t\t}\r\n\t\t\tif (sns[i].type == \"baselines\") {\r\n\t\t\t\tbutton = \"<div class='gantt_custom_button gantt_remove_baselines' data-index='\" + i + \"'><div class='gantt_custom_button_delete_baselines'></div><div class='gantt_custom_button_label'>\" + this.locale.labels.baselines_remove_all_button + \"</div></div>\" +\r\n\t\t\t\t\"<div class='gantt_custom_button gantt_add_baselines' data-index='\" + i + \"'><div class='gantt_custom_button_add_baseline'></div><div class='gantt_custom_button_label'>\" + this.locale.labels.baselines_add_button + \"</div></div>\";\r\n\t\t\t}\r\n\t\t\tif (sns[i].type == \"resource_selector\") {\r\n\t\t\t\tsns[i].index = i;\r\n\t\t\t\tbutton = `<div class='gantt_custom_button gantt_add_resources' data-index='${i}' data-resource-selector-section='${i}' data-section-name='${sns.name}'><div class='gantt_custom_button_add_resources gantt_add'></div><div class='gantt_custom_button_label'>${this.locale.labels.resources_add_button}</div></div>`;\r\n\t\t\t}\r\n\t\t\tif (this.config.wide_form) {\r\n\t\t\t\thtml += \"<div class='gantt_wrap_section' \" + display + \">\";\r\n\t\t\t}\r\n\t\t\thtml += \"<div id='\" + sns[i].id + \"' class='gantt_cal_lsection'><label>\" + button + (sns[i].label || this.locale.labels[\"section_\" + sns[i].name]||sns[i].name) + \"</label></div>\" + block.render.call(this, sns[i]);\r\n\t\t\thtml += \"</div>\";\r\n\t\t}\r\n\t\treturn html;\r\n\t};\r\n\r\n\tgantt._center_lightbox = function(box){\r\n\t\tgantt._setLbPosition(box);\r\n\t};\r\n\tgantt._setLbPosition = function(box) {\r\n\t\tif(!box){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst rootElement = gantt._lightbox_root || gantt.$root;\r\n\t\tbox.style.top = Math.max(rootElement.offsetHeight / 2 - box.offsetHeight/2, 0) + \"px\";\r\n\t\tbox.style.left = Math.max(rootElement.offsetWidth / 2 - box.offsetWidth/2, 0) + \"px\";\r\n\t};\r\n\r\n\tgantt.showCover = function (box) {\r\n\t\tif (box){\r\n\t\t\tbox.style.display=\"block\";\r\n\t\r\n\t\t\tthis._setLbPosition(box);\r\n\t\t}\r\n\t\tshow_cover();\r\n\t\tthis._cover.style.display = \"\";\r\n\t};\r\n\tconst show_cover=function(){\r\n\t\tif(gantt._cover) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\tgantt._cover=document.createElement(\"div\");\r\n\t\tgantt._cover.className=\"gantt_cal_cover\";\r\n\t\tgantt._cover.style.display = \"none\";\r\n\t\r\n\t\tgantt.event(gantt._cover, \"mousemove\", gantt._move_while_dnd);\r\n\t\tgantt.event(gantt._cover, \"mouseup\", gantt._finish_dnd);\r\n\t\r\n\t\tconst rootElement = gantt._lightbox_root || gantt.$root;\r\n\t\trootElement.appendChild(gantt._cover);\r\n\t};\r\n\r\n\tgantt._init_lightbox_events = function () {\r\n\t\tgantt.lightbox_events = {};\r\n\r\n\r\n\t\tgantt.lightbox_events.gantt_save_btn = function () {\r\n\t\t\tgantt._save_lightbox();\r\n\t\t};\r\n\r\n\r\n\t\tgantt.lightbox_events.gantt_delete_btn = function () {\r\n\t\t\tgantt._lightbox_current_type = null;\r\n\t\t\tif (!gantt.callEvent(\"onLightboxDelete\", [gantt._lightbox_id]))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (gantt.isTaskExists(gantt._lightbox_id)) {\r\n\t\t\t\tgantt.$click.buttons[\"delete\"](gantt._lightbox_id);\r\n\t\t\t} else {\r\n\t\t\t\tgantt.hideLightbox();\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\r\n\t\tgantt.lightbox_events.gantt_cancel_btn = function () {\r\n\t\t\tgantt._cancel_lightbox();\r\n\t\t};\r\n\r\n\r\n\t\tgantt.lightbox_events[\"default\"] = function (e, src) {\r\n\t\t\tif (src.getAttribute(\"data-dhx-button\")) {\r\n\t\t\t\tgantt.callEvent(\"onLightboxButton\", [src.className, src, e]);\r\n\t\t\t} else {\r\n\t\t\t\tvar index, block, sec;\r\n\r\n\t\t\t\tvar className = domHelpers.getClassName(src);\r\n\t\t\t\tif (className.indexOf(\"gantt_custom_button\") != -1) {\r\n\t\t\t\t\tif (className.indexOf(\"gantt_custom_button_\") != -1) {\r\n\t\t\t\t\t\tindex = src.parentNode.getAttribute(\"data-index\");\r\n\t\t\t\t\t\tsec = src;\r\n\t\t\t\t\t\twhile (sec && domHelpers.getClassName(sec).indexOf(\"gantt_cal_lsection\") == -1) {\r\n\t\t\t\t\t\t\tsec = sec.parentNode;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tindex = src.getAttribute(\"data-index\");\r\n\t\t\t\t\t\tsec = src.closest(\".gantt_cal_lsection\");\r\n\t\t\t\t\t\tsrc = src.firstChild;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar sections = gantt._get_typed_lightbox_config();\r\n\r\n\t\t\t\tif (index) {\r\n\t\t\t\t\tindex = index * 1;\r\n\t\t\t\t\tblock = gantt.form_blocks[sections[index * 1].type];\r\n\t\t\t\t\tblock.button_click(index, src, sec, sec.nextSibling);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\tthis.event(gantt.getLightbox(), \"click\", function (e) {\r\n\t\t\tif(e.target.closest(\".gantt_cal_ltitle_close_btn\")){\r\n\t\t\t\tgantt._cancel_lightbox();\r\n\t\t\t}\r\n\t\t\tvar src = domHelpers.getTargetNode(e);\r\n\r\n\t\t\tvar className = domHelpers.getClassName(src);\r\n\t\t\tif (!className) {\r\n\t\t\t\tsrc = src.previousSibling;\r\n\t\t\t\tclassName = domHelpers.getClassName(src);\r\n\t\t\t}\r\n\t\t\tif (src && className && className.indexOf(\"gantt_btn_set\") === 0) {\r\n\t\t\t\tsrc = src.firstChild;\r\n\t\t\t\tclassName = domHelpers.getClassName(src);\r\n\t\t\t}\r\n\t\t\tif (src && className) {\r\n\t\t\t\tvar func = gantt.defined(gantt.lightbox_events[src.className]) ? gantt.lightbox_events[src.className] : gantt.lightbox_events[\"default\"];\r\n\t\t\t\treturn func(e, src);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tgantt.getLightbox().onkeydown = function (e) {\r\n\t\t\tvar event = e || window.event;\r\n\t\t\tvar target = e.target || e.srcElement;\r\n\t\t\tvar buttonTarget = domHelpers.getClassName(target).indexOf(\"gantt_btn_set\") > -1;\r\n\r\n\t\t\tswitch ((e || event).keyCode) {\r\n\t\t\t\tcase gantt.constants.KEY_CODES.SPACE: {\r\n\t\t\t\t\tif ((e || event).shiftKey) return;\r\n\t\t\t\t\tif (buttonTarget && target.click) {\r\n\t\t\t\t\t\ttarget.click();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tcase gantt.keys.edit_save:\r\n\t\t\t\t\tif ((e || event).shiftKey) return;\r\n\t\t\t\t\tif (buttonTarget && target.click) {\r\n\t\t\t\t\t\ttarget.click();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tgantt._save_lightbox();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase gantt.keys.edit_cancel:\r\n\t\t\t\t\tgantt._cancel_lightbox();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\r\n\tgantt._cancel_lightbox = function () {\r\n\t\tvar task = this.getLightboxValues(\"cancel\");\r\n\t\tgantt._lightbox_current_type = null;\r\n\t\tthis.callEvent(\"onLightboxCancel\", [this._lightbox_id, task.$new]);\r\n\t\tif (gantt.isTaskExists(task.id) && task.$new) {\r\n\t\t\tthis.silent(function () {\r\n\t\t\t\tgantt.$data.tasksStore.removeItem(task.id);\r\n\t\t\t\tgantt._update_flags(task.id, null);\r\n\t\t\t});\r\n\t\t\tthis.refreshData();\r\n\t\t}\r\n\r\n\t\tthis.hideLightbox();\r\n\t};\r\n\r\n\tgantt._save_lightbox = function () {\r\n\t\tvar task = this.getLightboxValues(\"save\");\r\n\t\tgantt._lightbox_current_type = null;\r\n\t\tif (!this.callEvent(\"onLightboxSave\", [this._lightbox_id, task, !!task.$new]))\r\n\t\t\treturn;\r\n\r\n\t\t// GS-2170. Do not recalculate the indexes and dates of other tasks\r\n\t\t// as they will be recalculated in the `refreshData`\r\n\t\tgantt.$data.tasksStore._skipTaskRecalculation = \"lightbox\";\r\n\t\tif (task.$new) {\r\n\t\t\tdelete task.$new;\r\n\t\t\tthis.addTask(task, task.parent, this.getTaskIndex(task.id));\r\n\t\t} else if (this.isTaskExists(task.id)) {\r\n\t\t\tthis.mixin(this.getTask(task.id), task, true);\r\n\t\t\tthis.refreshTask(task.id);\r\n\t\t\tthis.updateTask(task.id);\r\n\t\t}\r\n\t\tgantt.$data.tasksStore._skipTaskRecalculation = false;\r\n\t\tthis.refreshData();\r\n\r\n\t\t// TODO: do we need any blockable events here to prevent closing lightbox?\r\n\t\tthis.hideLightbox();\r\n\t};\r\n\r\n\tgantt._resolve_default_mapping = function (section) {\r\n\t\tvar mapping = section.map_to;\r\n\t\tvar time_controls = { \"time\": true, \"time_optional\": true, \"duration\": true, \"duration_optional\": true };\r\n\t\tif (time_controls[section.type]) {\r\n\t\t\tif (section.map_to == \"auto\") {\r\n\t\t\t\tmapping = { start_date: \"start_date\", end_date: \"end_date\", duration: \"duration\" };\r\n\t\t\t} else if (typeof (section.map_to) === \"string\") {\r\n\t\t\t\tmapping = { start_date: section.map_to };\r\n\t\t\t}\r\n\t\t} else if (section.type === \"constraint\") {\r\n\t\t\tif (!section.map_to || typeof (section.map_to) === \"string\") {\r\n\t\t\t\tmapping = { constraint_type: \"constraint_type\", constraint_date: \"constraint_date\" };\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn mapping;\r\n\t};\r\n\r\n\tgantt.getLightboxValues = function (type) {\r\n\t\tlet task = {};\r\n\r\n\t\tif (gantt.isTaskExists(this._lightbox_id)) {\r\n\t\t\ttask = this.mixin({}, this.getTask(this._lightbox_id));\r\n\t\t}\r\n\r\n\t\tconst sns = this._get_typed_lightbox_config();\r\n\t\t// GS-2370: if there is a resource with its calendar\r\n\t\t// need to place time section at the end\r\n\t\tconst sortedSns = [...sns].sort((a, b) => {\r\n\t\t\tif (a.name === \"time\") return 1;\r\n\t\t\tif (b.name === \"time\") return -1;\r\n\t\t\treturn 0;\r\n\t\t});\r\n\t\tfor (let i = 0; i < sortedSns.length; i++) {\r\n\t\t\tlet node = gantt._lightbox_root.querySelector(\"#\" + sortedSns[i].id);\r\n\t\t\tnode = (node ? node.nextSibling : node);\r\n\t\t\tlet block = this.form_blocks[sortedSns[i].type];\r\n\t\t\tif (!block) continue;\r\n\t\t\tlet res = block.get_value.call(this, node, task, sortedSns[i], type);\r\n\t\t\tlet map_to = gantt._resolve_default_mapping(sortedSns[i]);\r\n\t\t\tif (typeof map_to == \"string\" && map_to != \"auto\") {\r\n\t\t\t\ttask[map_to] = res;\r\n\t\t\t} else if (typeof map_to == \"object\") {\r\n\t\t\t\tfor (let property in map_to) {\r\n\t\t\t\t\tif (map_to[property])\r\n\t\t\t\t\t\ttask[map_to[property]] = res[property];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// GS-1282 We need to preserve the task type even if the lightbox doesn't have the typeselect section\r\n\t\t// GS-2460 set the current type from selector\r\n\t\tif (gantt._lightbox_current_type) {\r\n\t\t\ttask.type = gantt._lightbox_current_type;\r\n\t\t}\r\n\r\n\t\treturn task;\r\n\t};\r\n\r\n\r\n\tgantt.hideLightbox = function () {\r\n\t\tvar box = this.getLightbox();\r\n\t\tif (box) box.style.display = \"none\";\r\n\r\n\t\tthis._waiAria.lightboxHiddenAttr(box);\r\n\t\tthis._lightbox_id = null;\r\n\r\n\t\tthis.hideCover(box);\r\n\t\tthis.resetLightbox();\r\n\t\tthis.callEvent(\"onAfterLightbox\", []);\r\n\t};\r\n\tgantt.hideCover = function (box) {\r\n\t\tif(box){\r\n\t\t\tbox.style.display = \"none\";\r\n\t\t}\r\n\t\tif (this._cover)\r\n\t\t\tthis._cover.parentNode.removeChild(this._cover);\r\n\t\tthis._cover = null;\r\n\t};\r\n\r\n\tgantt.resetLightbox = function () {\r\n\t\tif (gantt._lightbox && !gantt._custom_lightbox)\r\n\t\t\tgantt._lightbox.remove();\r\n\t\tgantt._lightbox = null;\r\n\t};\r\n\tgantt._set_lightbox_values = function (data, box) {\r\n\t\tvar task = data;\r\n\t\tvar s = box.getElementsByTagName(\"span\");\r\n\t\tvar lightboxHeader = [];\r\n\t\tif (gantt.templates.lightbox_header) {\r\n\t\t\tlightboxHeader.push(\"\");\r\n\t\t\tlightboxHeader.push(gantt.templates.lightbox_header(task.start_date, task.end_date, task));\r\n\t\t\ts[1].innerHTML = \"\";\r\n\t\t\ts[2].innerHTML = gantt.templates.lightbox_header(task.start_date, task.end_date, task);\r\n\t\t} else {\r\n\t\t\tlightboxHeader.push(this.templates.task_time(task.start_date, task.end_date, task));\r\n\t\t\tlightboxHeader.push(String(this.templates.task_text(task.start_date, task.end_date, task) || \"\").substr(0, 70)); //IE6 fix\r\n\t\t\ts[1].innerHTML = this.templates.task_time(task.start_date, task.end_date, task);\r\n\t\t\ts[2].innerHTML = String(this.templates.task_text(task.start_date, task.end_date, task) || \"\").substr(0, 70); //IE6 fix\r\n\t\t}\r\n\t\ts[1].innerHTML = lightboxHeader[0];\r\n\t\ts[2].innerHTML = lightboxHeader[1];\r\n\r\n\t\tgantt._waiAria.lightboxHeader(box, lightboxHeader.join(\" \"));\r\n\r\n\t\tvar sns = this._get_typed_lightbox_config(this.getLightboxType());\r\n\t\tfor (var i = 0; i < sns.length; i++) {\r\n\t\t\tvar section = sns[i];\r\n\r\n\t\t\tif (!this.form_blocks[section.type]) {\r\n\t\t\t\tcontinue;//skip incorrect sections, same check is done during rendering\r\n\t\t\t}\r\n\r\n\r\n\t\t\tvar node = gantt._lightbox_root.querySelector(\"#\" + section.id).nextSibling;\r\n\t\t\tvar block = this.form_blocks[section.type];\r\n\t\t\tvar map_to = gantt._resolve_default_mapping(sns[i]);\r\n\t\t\tvar value = this.defined(task[map_to]) ? task[map_to] : section.default_value;\r\n\t\t\tblock.set_value.call(gantt, node, value, task, section);\r\n\r\n\t\t\tif (section.focus)\r\n\t\t\t\tblock.focus.call(gantt, node);\r\n\t\t}\r\n\t\tif (gantt.isTaskExists(data.id)){\r\n\t\t\tgantt._lightbox_id = data.id;\r\n\t\t}\r\n\t};\r\n\tgantt._fill_lightbox = function (id, box) {\r\n\t\tvar task = this.getTask(id);\r\n\t\tthis._set_lightbox_values(task, box);\r\n\t};\r\n\r\n\r\n\tgantt.getLightboxSection = function (name) {\r\n\t\tvar config = this._get_typed_lightbox_config();\r\n\t\tvar i = 0;\r\n\t\tfor (i; i < config.length; i++)\r\n\t\t\tif (config[i].name == name)\r\n\t\t\t\tbreak;\r\n\t\tvar section = config[i];\r\n\t\tif (!section)\r\n\t\t\treturn null;\r\n\r\n\t\tif (!this._lightbox)\r\n\t\t\tthis.getLightbox();\r\n\t\tvar header = gantt._lightbox_root.querySelector(\"#\" + section.id);\r\n\t\tvar node = header.nextSibling;\r\n\r\n\t\tvar result = {\r\n\t\t\tsection: section,\r\n\t\t\theader: header,\r\n\t\t\tnode: node,\r\n\t\t\tgetValue: function (ev) {\r\n\t\t\t\treturn gantt.form_blocks[section.type].get_value.call(gantt, node, (ev || {}), section);\r\n\t\t\t},\r\n\t\t\tsetValue: function (value, ev) {\r\n\t\t\t\treturn gantt.form_blocks[section.type].set_value.call(gantt, node, value, (ev || {}), section);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar handler = this._lightbox_methods[\"get_\" + section.type + \"_control\"];\r\n\t\treturn handler ? handler(result) : result;\r\n\t};\r\n\r\n\tgantt._lightbox_methods.get_template_control = function (result) {\r\n\t\tresult.control = result.node;\r\n\t\treturn result;\r\n\t};\r\n\tgantt._lightbox_methods.get_select_control = function (result) {\r\n\t\tresult.control = result.node.getElementsByTagName(\"select\")[0];\r\n\t\treturn result;\r\n\t};\r\n\tgantt._lightbox_methods.get_textarea_control = function (result) {\r\n\t\tresult.control = result.node.getElementsByTagName(\"textarea\")[0];\r\n\t\treturn result;\r\n\t};\r\n\tgantt._lightbox_methods.get_time_control = function (result) {\r\n\t\tresult.control = result.node.getElementsByTagName(\"select\"); // array\r\n\t\treturn result;\r\n\t};\r\n\r\n\r\n\tgantt._init_dnd_events = function () {\r\n\t\tvar eventElement = gantt._lightbox_root;\r\n\t\tthis.event(eventElement, \"mousemove\", gantt._move_while_dnd);\r\n\t\tthis.event(eventElement, \"mouseup\", gantt._finish_dnd);\r\n\t\tthis.event(eventElement, \"touchmove\", function (e){\r\n\t\t\tgantt._move_while_dnd(e.touches[0]);\r\n\t\t});\r\n\t\tthis.event(eventElement, \"touchend\", function (e){\r\n\t\t\tgantt._finish_dnd(e.touches[0]);\r\n\t\t});\r\n\t\t// GS-1952: In Salesforce environment, the lightbox is attached to the Gantt container. \r\n\t\t// So when Gantt is reinitialized, the events are no longer attached to the Gantt container.\r\n\t\t// gantt._init_dnd_events = function () {\r\n\t\t// };\r\n\t};\r\n\tgantt._move_while_dnd = function (event) {\r\n\t\tif (gantt._dnd_start_lb) {\r\n\t\t\tif (!document.gantt_unselectable) {\r\n\t\t\t\tgantt._lightbox_root.className += \" gantt_unselectable\";\r\n\t\t\t\tdocument.gantt_unselectable = true;\r\n\t\t\t}\r\n\t\t\tvar lb = gantt.getLightbox();\r\n\t\t\tvar now = [event.pageX, event.pageY];\r\n\t\t\tlb.style.top = gantt._lb_start[1] + now[1] - gantt._dnd_start_lb[1] + \"px\";\r\n\t\t\tlb.style.left = gantt._lb_start[0] + now[0] - gantt._dnd_start_lb[0] + \"px\";\r\n\t\t}\r\n\t};\r\n\tgantt._ready_to_dnd = function (event) {\r\n\t\tvar lb = gantt.getLightbox();\r\n\t\tgantt._lb_start = [lb.offsetLeft, lb.offsetTop];\r\n\t\tgantt._dnd_start_lb = [event.pageX, event.pageY];\r\n\t};\r\n\tgantt._finish_dnd = function () {\r\n\t\tif (gantt._lb_start) {\r\n\t\t\tgantt._lb_start = gantt._dnd_start_lb = false;\r\n\t\t\tgantt._lightbox_root.className = gantt._lightbox_root.className.replace(\" gantt_unselectable\", \"\");\r\n\t\t\tdocument.gantt_unselectable = false;\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tgantt._focus = function (node, select) {\r\n\t\tif (node && node.focus) {\r\n\t\t\tif (gantt.config.touch) {\r\n\t\t\t\t//do not focus editor, to prevent auto-zoom\r\n\t\t\t} else {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (select && node.select) node.select();\r\n\t\t\t\t\tnode.focus();\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\t// silent errors\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tgantt.form_blocks = {\r\n\t\tgetTimePicker: function (sns, hidden) {\r\n\t\t\tvar html = \"\";\r\n\t\t\tvar cfg = this.config;\r\n\t\t\tvar i;\r\n\t\t\tvar options;\r\n\t\t\tvar ariaAttrs;\r\n\t\t\tvar readonly;\r\n\t\t\tvar display;\r\n\t\t\tvar settings = {\r\n\t\t\t\tfirst: 0,\r\n\t\t\t\tlast: 24 * 60,\r\n\t\t\t\tdate: this.date.date_part(new Date(gantt._min_date.valueOf())),\r\n\t\t\t\ttimeFormat: getTimeFormat(sns)\r\n\t\t\t};\r\n\r\n\t\t\t// map: default order => real one\r\n\t\t\tsns._time_format_order = { size: 0 };\r\n\r\n\t\t\tif (gantt.config.limit_time_select) {\r\n\t\t\t\tsettings.first = 60 * cfg.first_hour;\r\n\t\t\t\tsettings.last = 60 * cfg.last_hour + 1;\r\n\t\t\t\tsettings.date.setHours(cfg.first_hour);\r\n\t\t\t}\r\n\r\n\t\t\tfor (i = 0; i < settings.timeFormat.length; i++) {\r\n\t\t\t\t// adding spaces between selects\r\n\t\t\t\tif (i > 0) {\r\n\t\t\t\t\thtml += \" \";\r\n\t\t\t\t}\r\n\r\n\t\t\t\toptions = getHtmlTimePickerOptions(sns, i, settings);\r\n\r\n\t\t\t\tif (options) {\r\n\t\t\t\t\tariaAttrs = gantt._waiAria.lightboxSelectAttrString(settings.timeFormat[i]);\r\n\t\t\t\t\treadonly = sns.readonly ? \"disabled='disabled'\" : \"\";\r\n\t\t\t\t\tdisplay = hidden ? \" style='display:none' \" : \"\";\r\n\t\t\t\t\thtml += \"<select \" + readonly + display + ariaAttrs + \">\" + options + \"</select>\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn html;\r\n\t\t},\r\n\t\tgetTimePickerValue: function (selects, config, offset) {\r\n\t\t\tvar map = config._time_format_order;\r\n\t\t\tvar needSetTime = gantt.defined(map[3]);\r\n\r\n\t\t\tvar time;\r\n\t\t\tvar hours = 0;\r\n\t\t\tvar minutes = 0;\r\n\r\n\t\t\tvar mapOffset = offset || 0;\r\n\r\n\t\t\tif (needSetTime) {\r\n\t\t\t\ttime = parseInt(selects[map[3] + mapOffset].value, 10);\r\n\t\t\t\thours = Math.floor(time / 60);\r\n\t\t\t\tminutes = time % 60;\r\n\t\t\t}\r\n\t\t\treturn new Date(selects[map[2] + mapOffset].value, selects[map[1] + mapOffset].value, selects[map[0] + mapOffset].value, hours, minutes);\r\n\t\t},\r\n\r\n\t\t_fill_lightbox_select: function (s, i, d, map) {\r\n\t\t\ts[i + map[0]].value = d.getDate();\r\n\t\t\ts[i + map[1]].value = d.getMonth();\r\n\t\t\ts[i + map[2]].value = d.getFullYear();\r\n\t\t\tif (gantt.defined(map[3])) {\r\n\t\t\t\tvar v = d.getHours() * 60 + d.getMinutes();\r\n\t\t\t\tv = Math.round(v / gantt._get_timepicker_step()) * gantt._get_timepicker_step();\r\n\t\t\t\tvar input = s[i + map[3]];\r\n\t\t\t\tinput.value = v;\r\n\t\t\t\t//in case option not shown\r\n\t\t\t\tinput.setAttribute(\"data-value\", v);\r\n\t\t\t}\r\n\t\t},\r\n\t\ttemplate: new TemplateControl(),\r\n\t\ttextarea: new TextareaControl(),\r\n\t\tselect: new SelectControl(),\r\n\t\ttime: new TimeControl(),\r\n\t\tduration: new DurationControl(),\r\n\t\tparent: new ParentControl(),\r\n\t\tradio: new RadioControl(),\r\n\t\tcheckbox: new CheckboxControl(),\r\n\t\tresources: new ResourcesControl(),\r\n\t\tconstraint: new ConstraintControl(),\r\n\t\tbaselines: new BaselineControl(),\r\n\t\ttypeselect: new TypeselectControl(),\r\n\t\tresource_selector: new NewResourcesControl()\r\n\t};\r\n\r\n\tgantt._is_lightbox_timepicker = function () {\r\n\t\tvar s = this._get_typed_lightbox_config();\r\n\t\tfor (var i = 0; i < s.length; i++)\r\n\t\t\tif (s[i].name == \"time\" && s[i].type == \"time\")\r\n\t\t\t\treturn true;\r\n\t\treturn false;\r\n\t};\r\n\r\n\tgantt._delete_task_confirm = function ({task, message, title, callback, ok}){\r\n\t\tgantt._simple_confirm(message, title, callback, ok);\r\n\t};\r\n\tgantt._delete_link_confirm = function({link, message, title, callback, ok}){\r\n\t\tgantt._simple_confirm(message, title, callback, ok);\r\n\t};\r\n\r\n\tgantt._simple_confirm = function (message, title, callback, ok) {\r\n\t\tif (!message)\r\n\t\t\treturn callback();\r\n\t\tvar opts = { text: message };\r\n\t\tif (title)\r\n\t\t\topts.title = title;\r\n\t\tif (ok) {\r\n\t\t\topts.ok = ok;\r\n\t\t}\r\n\t\tif (callback) {\r\n\t\t\topts.callback = function (result) {\r\n\t\t\t\tif (result)\r\n\t\t\t\t\tcallback();\r\n\t\t\t};\r\n\t\t}\r\n\t\tgantt.confirm(opts);\r\n\t};\r\n\r\n\tfunction _get_type_name(type_value) {\r\n\t\tfor (var i in this.config.types) {\r\n\t\t\tif (this.config.types[i] == type_value) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn \"task\";\r\n\t}\r\n\r\n\tgantt._get_typed_lightbox_config = function (type) {\r\n\t\tif (type === undefined) {\r\n\t\t\ttype = this.getLightboxType();\r\n\t\t}\r\n\r\n\t\tvar field = _get_type_name.call(this, type);\r\n\r\n\t\tif (gantt.config.lightbox[field + \"_sections\"]) {\r\n\t\t\treturn gantt.config.lightbox[field + \"_sections\"];\r\n\t\t} else {\r\n\t\t\treturn gantt.config.lightbox.sections;\r\n\t\t}\r\n\t};\r\n\r\n\tgantt._silent_redraw_lightbox = function (type) {\r\n\t\tvar oldType = this.getLightboxType();\r\n\r\n\t\tif (this.getState().lightbox) {\r\n\t\t\tvar taskId = this.getState().lightbox;\r\n\t\t\tvar formData = this.getLightboxValues(),\r\n\t\t\t\ttask = this.copy(this.getTask(taskId));\r\n\r\n\t\t\tthis.resetLightbox();\r\n\r\n\t\t\tvar updTask = this.mixin(task, formData, true);\r\n\t\t\tvar box = this.getLightbox(type ? type : undefined);\r\n\t\t\tthis._set_lightbox_values(updTask, box);\r\n\t\t\tthis.showCover(box);\r\n\t\t} else {\r\n\t\t\tthis.resetLightbox();\r\n\t\t\tthis.getLightbox(type ? type : undefined);\r\n\t\t}\r\n\t\tthis.callEvent(\"onLightboxChange\", [oldType, this.getLightboxType()]);\r\n\t};\r\n\r\n\tfunction bindLabelsToInputs(sns) {\r\n\t\tvar section;\r\n\t\tvar label;\r\n\t\tvar labelBlock;\r\n\t\tvar inputBlock;\r\n\t\tvar input;\r\n\t\tvar i;\r\n\r\n\t\tfor (i = 0; i < sns.length; i++) {\r\n\t\t\tsection = sns[i];\r\n\t\t\tlabelBlock = gantt._lightbox_root.querySelector(\"#\" + section.id);\r\n\r\n\t\t\tif (!section.id || !labelBlock) continue;\r\n\r\n\t\t\tlabel = labelBlock.querySelector(\"label\");\r\n\t\t\tinputBlock = labelBlock.nextSibling;\r\n\r\n\t\t\tif (!inputBlock) continue;\r\n\r\n\t\t\tinput = inputBlock.querySelector(\"input, select, textarea\");\r\n\t\t\tif (input) {\r\n\t\t\t\tinput.id = input.id || \"input_\" + gantt.uid();\r\n\t\t\t\tsection.inputId = input.id;\r\n\t\t\t\tlabel.setAttribute(\"for\", section.inputId);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getHtmlButtons(buttons, floatRight) {\r\n\t\tvar button;\r\n\t\tvar ariaAttr;\r\n\t\tvar html = \"\";\r\n\t\tvar i;\r\n\r\n\t\tfor (i = 0; i < buttons.length; i++) {\r\n\t\t\t// needed to migrate from 'dhx_something' to 'gantt_something' naming in a lightbox\r\n\t\t\tbutton = gantt.config._migrate_buttons[buttons[i]] ? gantt.config._migrate_buttons[buttons[i]] : buttons[i];\r\n\r\n\t\t\tariaAttr = gantt._waiAria.lightboxButtonAttrString(button);\r\n\t\t\thtml += \"<div \" + ariaAttr + \" class='gantt_btn_set gantt_left_btn_set \" + button + \"_set'\" + \"><div dhx_button='1' data-dhx-button='1' class='\" + button + \"'></div><div>\" + gantt.locale.labels[button] + \"</div></div>\";\r\n\t\t}\r\n\t\treturn html;\r\n\t}\r\n\r\n\tfunction getTimeFormat(sns) {\r\n\t\tvar scale;\r\n\t\tvar unit;\r\n\t\tvar result;\r\n\r\n\t\tif (sns.time_format) return sns.time_format;\r\n\r\n\t\t// default order\r\n\t\tresult = [\"%d\", \"%m\", \"%Y\"];\r\n\t\tscale = gantt.getScale();\r\n\t\tunit = scale ? scale.unit : gantt.config.duration_unit;\r\n\t\tif (helpers.getSecondsInUnit(unit) < helpers.getSecondsInUnit(\"day\")) {\r\n\t\t\tresult.push(\"%H:%i\");\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfunction getHtmlTimePickerOptions(sns, index, settings) {\r\n\t\tvar range;\r\n\t\tvar offset;\r\n\t\tvar start_year;\r\n\t\tvar end_year;\r\n\t\tvar i;\r\n\t\tvar time;\r\n\t\tvar diff;\r\n\t\tvar tdate;\r\n\t\tvar html = \"\";\r\n\r\n\t\tswitch (settings.timeFormat[index]) {\r\n\t\t\tcase \"%Y\":\r\n\t\t\t\tsns._time_format_order[2] = index;\r\n\t\t\t\tsns._time_format_order.size++;\r\n\t\t\t\t//year\r\n\r\n\t\t\t\tif (sns.year_range) {\r\n\t\t\t\t\tif (!isNaN(sns.year_range)) {\r\n\t\t\t\t\t\trange = sns.year_range;\r\n\t\t\t\t\t} else if (sns.year_range.push) {\r\n\t\t\t\t\t\t// if\r\n\t\t\t\t\t\tstart_year = sns.year_range[0];\r\n\t\t\t\t\t\tend_year = sns.year_range[1];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\trange = range || 10;\r\n\t\t\t\toffset = offset || Math.floor(range / 2);\r\n\t\t\t\tstart_year = start_year || settings.date.getFullYear() - offset;\r\n\t\t\t\tend_year = end_year || gantt.getState().max_date.getFullYear() + offset;\r\n\r\n\t\t\t\tfor (i = start_year; i <= end_year; i++)\r\n\t\t\t\t\thtml += \"<option value='\" + (i) + \"'>\" + (i) + \"</option>\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%m\":\r\n\t\t\t\tsns._time_format_order[1] = index;\r\n\t\t\t\tsns._time_format_order.size++;\r\n\t\t\t\t//month\r\n\t\t\t\tfor (i = 0; i < 12; i++)\r\n\t\t\t\t\thtml += \"<option value='\" + i + \"'>\" + gantt.locale.date.month_full[i] + \"</option>\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%d\":\r\n\t\t\t\tsns._time_format_order[0] = index;\r\n\t\t\t\tsns._time_format_order.size++;\r\n\t\t\t\t//days\r\n\t\t\t\tfor (i = 1; i < 32; i++)\r\n\t\t\t\t\thtml += \"<option value='\" + i + \"'>\" + i + \"</option>\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%H:%i\":\r\n\t\t\t\t//  var last = 24*60, first = 0;\r\n\t\t\t\tsns._time_format_order[3] = index;\r\n\t\t\t\tsns._time_format_order.size++;\r\n\t\t\t\t//hours\r\n\t\t\t\ti = settings.first;\r\n\t\t\t\ttdate = settings.date.getDate();\r\n\t\t\t\tsns._time_values = [];\r\n\r\n\t\t\t\twhile (i < settings.last) {\r\n\t\t\t\t\ttime = gantt.templates.time_picker(settings.date);\r\n\t\t\t\t\thtml += \"<option value='\" + i + \"'>\" + time + \"</option>\";\r\n\t\t\t\t\tsns._time_values.push(i);\r\n\t\t\t\t\tsettings.date.setTime(settings.date.valueOf() + gantt._get_timepicker_step() * 60 * 1000);\r\n\t\t\t\t\tdiff = (settings.date.getDate() != tdate) ? 1 : 0; // moved or not to the next day\r\n\t\t\t\t\ti = diff * 24 * 60 + settings.date.getHours() * 60 + settings.date.getMinutes();\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn html;\r\n\t}\r\n};","import __extends from \"../../../../utils/extends\";\r\n\r\nimport Super from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tconst _super = Super(gantt);\r\n\r\n\tfunction TemplateControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this; \r\n\t\treturn self; \r\n\t}\r\n\r\n\t__extends(TemplateControl, _super);\r\n\r\n\r\n\tTemplateControl.prototype.render = function(sns) {\r\n\t\tlet height = sns.height ? `${sns.height}px` : '';\r\n\t\treturn `<div class='gantt_cal_ltext gantt_cal_template gantt_section_${sns.name}' ${height ? `style='height:${height};'` : ''}></div>`;\r\n\t};\r\n\r\n\tTemplateControl.prototype.set_value = function(node, value) {\r\n\t\tnode.innerHTML = value || \"\";\r\n\t};\r\n\r\n\tTemplateControl.prototype.get_value = function(node) {\r\n\t\treturn node.innerHTML || \"\";\r\n\t};\r\n\r\n\tTemplateControl.prototype.focus = function() {};\r\n\r\n\treturn TemplateControl;\r\n};","import __extends from \"../../../../utils/extends\";\r\n\r\nimport Super from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tconst _super = Super(gantt);\r\n\r\n\tfunction TextareaControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this;\r\n\r\n\t\treturn self; \r\n\t}\r\n\r\n\t__extends(TextareaControl, _super);\r\n\r\n\tTextareaControl.prototype.render = function(sns) {\r\n\t\tconst height = (sns.height || \"130\") + \"px\";\r\n\t\tconst placeholder = sns.placeholder ? `placeholder='${sns.placeholder}'` : \"\";\r\n\t\treturn `<div class='gantt_cal_ltext gantt_section_${sns.name}' style='height:${height};' ${placeholder}><textarea></textarea></div>`;\r\n\t};\r\n\r\n\tTextareaControl.prototype.set_value = function(node, value) {\r\n\t\tgantt.form_blocks.textarea._get_input(node).value = value || \"\";\r\n\t};\r\n\r\n\tTextareaControl.prototype.get_value = function(node) {\r\n\t\treturn gantt.form_blocks.textarea._get_input(node).value;\r\n\t};\r\n\r\n\tTextareaControl.prototype.focus = function(node) {\r\n\t\tvar a = gantt.form_blocks.textarea._get_input(node);\r\n\t\tgantt._focus(a, true);\r\n\t};\r\n\r\n\tTextareaControl.prototype._get_input = function(node) {\r\n\t\treturn node.querySelector(\"textarea\");\r\n\t};\r\n\r\n\treturn TextareaControl;\r\n};","import __extends from \"../../../../utils/extends\";\r\n\r\nimport Super from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tconst _super = Super(gantt);\r\n\r\n\tfunction TimeControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this;\r\n\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(TimeControl, _super);\r\n\r\n\tTimeControl.prototype.render = function (sns) {\r\n\t\tvar time = gantt.form_blocks.getTimePicker.call(this, sns);\r\n\t\tlet sectionClassName = \"gantt_section_time\";\r\n\t\tif (sns.name !== \"time\"){\r\n\t\t\tsectionClassName += \" gantt_section_\" + sns.name;\r\n\t\t}\r\n\t\tvar html = \"<div style='padding-top:0px;font-size:inherit;text-align:center;' class='\" + sectionClassName + \"'>\";\r\n\t\thtml += time;\r\n\r\n\t\tif (sns.single_date) {\r\n\t\t\ttime = gantt.form_blocks.getTimePicker.call(this, sns, true);\r\n\t\t\thtml += \"<span></span>\";\r\n\t\t} else {\r\n\t\t\thtml += \"<span class='gantt_section_time_spacer'> &nbsp;&ndash;&nbsp; </span>\";\r\n\t\t}\r\n\r\n\t\thtml += time;\r\n\t\thtml += \"</div>\";\r\n\t\treturn html;\r\n\t};\r\n\r\n\tTimeControl.prototype.set_value = function (node, value, ev, config) {\r\n\t\tvar cfg = config;\r\n\t\tvar s = node.getElementsByTagName(\"select\");\r\n\t\tvar map = config._time_format_order;\r\n\r\n\t\tif (cfg.auto_end_date) {\r\n\t\t\tvar _update_lightbox_select = function () {\r\n\t\t\t\tstart_date = new Date(s[map[2]].value, s[map[1]].value, s[map[0]].value, 0, 0);\r\n\t\t\t\tend_date = gantt.calculateEndDate({ start_date: start_date, duration: 1, task: ev });\r\n\t\t\t\tgantt.form_blocks._fill_lightbox_select(s, map.size, end_date, map, cfg);\r\n\t\t\t};\r\n\t\t\tfor (var i = 0; i < 4; i++) {\r\n\t\t\t\ts[i].onchange = _update_lightbox_select;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar mapping = gantt._resolve_default_mapping(config);\r\n\r\n\t\tif (typeof (mapping) === \"string\") mapping = { start_date: mapping };\r\n\r\n\t\tvar start_date = ev[mapping.start_date] || new Date();\r\n\t\tvar end_date = ev[mapping.end_date] || gantt.calculateEndDate({\r\n\t\t\tstart_date: start_date,\r\n\t\t\tduration: 1,\r\n\t\t\ttask: ev\r\n\t\t});\r\n\r\n\t\tgantt.form_blocks._fill_lightbox_select(s, 0, start_date, map, cfg);\r\n\t\tgantt.form_blocks._fill_lightbox_select(s, map.size, end_date, map, cfg);\r\n\t};\r\n\r\n\tTimeControl.prototype.get_value = function (node, ev, config) {\r\n\t\tvar selects = node.getElementsByTagName(\"select\");\r\n\t\tvar startDate;\r\n\t\tvar map = config._time_format_order;\r\n\t\tfunction _getEndDate(selects, map, startDate) {\r\n\t\t\tvar endDate = gantt.form_blocks.getTimePickerValue(selects, config, map.size);\r\n\t\t\t// GS-1010: We need to add a way to obtain exact end_date for validation\r\n\t\t\tif (endDate <= startDate) {  // when end date seems wrong\r\n\t\t\t\tif (config.autofix_end !== false || config.single_date) { // auto correct it in two cases - when the auto correction is not disabled, or when we have 'single date' control and the user don't have the UI to specify the end date\r\n\t\t\t\t\treturn gantt.date.add(startDate, gantt._get_timepicker_step(), \"minute\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn endDate;\r\n\t\t}\r\n\r\n\t\tstartDate = gantt.form_blocks.getTimePickerValue(selects, config);\r\n\r\n\t\tif (typeof gantt._resolve_default_mapping(config) === \"string\") {\r\n\t\t\treturn startDate;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tstart_date: startDate,\r\n\t\t\tend_date: _getEndDate(selects, map, startDate)\r\n\t\t};\r\n\t};\r\n\r\n\tTimeControl.prototype.focus = function (node) {\r\n\t\tgantt._focus(node.getElementsByTagName(\"select\")[0]);\r\n\t};\r\n\r\n\treturn TimeControl;\r\n};","import * as helpers from \"../../../../utils/helpers\";\r\nimport __extends from \"../../../../utils/extends\";\r\nimport BaseConstrutor from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tvar _super = BaseConstrutor(gantt);\r\n\r\n\tfunction CheckboxControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this;\r\n\r\n\t\treturn self; \r\n\t}\r\n\r\n\t__extends(CheckboxControl, _super);\r\n\r\n\tCheckboxControl.prototype.render = function(sns) {\r\n\t\tconst height = sns.height ? `height:${sns.height}px;` : '';\r\n\t\tlet html = `<div class='gantt_cal_ltext gantt_cal_lcheckbox gantt_section_${sns.name}' ${height ? `style='${height}'` : ''}>`;\r\n\r\n\t\tif (sns.options && sns.options.length) {\r\n\t\t\tfor (var i = 0; i < sns.options.length; i++) {\r\n\t\t\t\thtml += \"<label><input type='checkbox' value='\" + sns.options[i].key + \"' name='\" + sns.name + \"'>\" + sns.options[i].label + \"</label>\";\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tsns.single_value = true;\r\n\t\t\thtml += \"<label><input type='checkbox' name='\" + sns.name + \"'></label>\";\r\n\t\t}\r\n\t\thtml += \"</div>\";\r\n\t\treturn html;\r\n\t};\r\n\r\n\tCheckboxControl.prototype.set_value = function(node, value, ev, sns) {\r\n\t\tvar checkboxes = Array.prototype.slice.call(node.querySelectorAll(\"input[type=checkbox]\"));\r\n\r\n\t\tif (!node._dhx_onchange && sns.onchange) {\r\n\t\t\tnode.onchange = sns.onchange;\r\n\t\t\tnode._dhx_onchange = true;\r\n\t\t}\r\n\r\n\t\tif(sns.single_value){\r\n\t\t\tvar box = checkboxes[0];\r\n\t\t\tbox.checked = !!value;\r\n\t\t}else{\r\n\t\t\thelpers.forEach(checkboxes, function(entry) {\r\n\t\t\t\tentry.checked = value ? value.indexOf(entry.value) >= 0 : false;\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tCheckboxControl.prototype.get_value = function(node, task, sns) {\r\n\t\tif(sns.single_value){\r\n\t\t\tvar box = node.querySelector(\"input[type=checkbox]\");\r\n\t\t\treturn box.checked;\r\n\t\t}else{\r\n\t\t\treturn helpers.arrayMap(Array.prototype.slice.call(node.querySelectorAll(\"input[type=checkbox]:checked\")), function(entry) {\r\n\t\t\t\treturn entry.value;\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tCheckboxControl.prototype.focus = function(node) {\r\n\t\tgantt._focus(node.querySelector(\"input[type=checkbox]\"));\r\n\t};\r\n\r\n\treturn CheckboxControl;\r\n};","import __extends from \"../../../../utils/extends\";\r\nimport Super from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tconst _super = Super(gantt);\r\n\r\n\tfunction RadioControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this;\r\n\r\n\t\treturn self; \r\n\t}\r\n\r\n\t__extends(RadioControl, _super);\r\n\r\n\tRadioControl.prototype.render = function(sns) {\r\n\t\tconst height = sns.height ? `${sns.height}px` : '';\r\n\t\tlet html = `<div class='gantt_cal_ltext gantt_cal_lradio gantt_section_${sns.name}' ${height ? `style='height:${height};'` : ''}>`;\r\n\r\n\t\tif (sns.options && sns.options.length) {\r\n\t\t\tfor (var i = 0; i < sns.options.length; i++) {\r\n\t\t\t\thtml += \"<label><input type='radio' value='\" + sns.options[i].key + \"' name='\" + sns.name + \"'>\" + sns.options[i].label + \"</label>\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\thtml += \"</div>\";\r\n\t\treturn html;\r\n\t};\r\n\r\n\tRadioControl.prototype.set_value = function(node, value, ev, sns) {\r\n\t\tvar radio;\r\n\r\n\t\tif (!sns.options || !sns.options.length) return;\r\n\r\n\t\tradio = node.querySelector(\"input[type=radio][value='\" + value + \"']\") ||\r\n\t\t\t\tnode.querySelector(\"input[type=radio][value='\" + sns.default_value + \"']\");\r\n\r\n\t\tif (!radio) return;\r\n\r\n\t\tif (!node._dhx_onchange && sns.onchange) {\r\n\t\t\tnode.onchange = sns.onchange;\r\n\t\t\tnode._dhx_onchange = true;\r\n\t\t}\r\n\r\n\t\tradio.checked = true;\r\n\t};\r\n\r\n\tRadioControl.prototype.get_value = function(node, ev) {\r\n\t\tvar result = node.querySelector(\"input[type=radio]:checked\");\r\n\r\n\t\treturn result ? result.value : \"\";\r\n\t};\r\n\r\n\tRadioControl.prototype.focus = function(node) {\r\n\t\tgantt._focus(node.querySelector(\"input[type=radio]\"));\r\n\t};\r\n\r\n\treturn RadioControl;\r\n};","import __extends from \"../../../../utils/extends\";\r\n\r\nimport DurationFormatterNumeric from  \"../../../common/duration_formatter_numeric\";\r\nimport BaseConstrutor from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tvar _super = BaseConstrutor(gantt);\r\n\r\n\tfunction DurationControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this; \r\n\r\n\t\treturn self; \r\n\t}\r\n\r\n\tfunction getFormatter(config) {\r\n\t\treturn config.formatter || new DurationFormatterNumeric();\r\n\t}\r\n\r\n\t__extends(DurationControl, _super);\r\n\r\n\tDurationControl.prototype.render = function(sns) {\r\n\t\tvar time = \"<div class='gantt_time_selects'>\" + gantt.form_blocks.getTimePicker.call(this, sns) + \"</div>\";\r\n\t\tvar label = \" \"+ gantt.locale.labels[gantt.config.duration_unit + \"s\"] +\" \";\r\n\t\tvar singleDate = sns.single_date ? \" style='display:none'\" : \"\";\r\n\t\tvar readonly = sns.readonly ? \" disabled='disabled'\" : \"\";\r\n\t\tvar ariaAttr = gantt._waiAria.lightboxDurationInputAttrString(sns);\r\n\r\n\t\tvar durationInputClass = \"gantt_duration_value\";\r\n\t\tif(sns.formatter) {\r\n\t\t\tlabel = \"\";\r\n\t\t\tdurationInputClass += \" gantt_duration_value_formatted\" ;\r\n\t\t}\r\n\r\n\t\tvar duration = \"<div class='gantt_duration' \" + singleDate + \">\" +\r\n\t\t\"<div class='gantt_duration_inputs'>\" +\r\n\t\t\t\"<input type='button' class='gantt_duration_dec' value=''\" + readonly + \">\" +\r\n\t\t\t\"<input type='text' value='5days' class='\"+durationInputClass+\"'\" + readonly + \" \" + ariaAttr + \">\" +\r\n\t\t\t\"<input type='button' class='gantt_duration_inc' value='+'\" + readonly + \">\"+\r\n\t\t\t\"</div>\" +\r\n\t\t\t\"<div class='gantt_duration_end_date'>\"+label+\"<span></span></div>\" +\r\n\t\t\t\"</div>\" +\r\n\t\t\t\"</div>\";\r\n\t\tlet sectionClassName = \"gantt_section_time gantt_section_duration\";\r\n\t\tif (sns.name !== \"time\"){\r\n\t\t\tsectionClassName += \" gantt_section_\" + sns.name;\r\n\t\t}\t\r\n\t\tvar html = \"<div style='padding-top:0px;font-size:inherit;' class='\" + sectionClassName + \"'>\" + time + \" \" + duration + \"</div>\";\r\n\t\treturn html;\r\n\t};\r\n\r\n\tDurationControl.prototype.set_value = function(node, value, ev, config) {\r\n\t\tvar s = node.getElementsByTagName(\"select\");\r\n\t\tvar inps = node.getElementsByTagName(\"input\");\r\n\t\tvar duration = inps[1];\r\n\t\tvar btns = [inps[0], inps[2]];\r\n\t\tvar endspan = node.getElementsByTagName(\"span\")[0];\r\n\t\tvar map = config._time_format_order;\r\n\t\tvar mapping;\r\n\t\tvar start_date;\r\n\t\tvar end_date;\r\n\t\tvar duration_val;\r\n\r\n\t\tfunction _calc_date() {\r\n\t\t\tvar start_date = _getStartDate.call(gantt, node, config);\r\n\t\t\tvar duration = _getDuration.call(gantt, node, config);\r\n\t\t\tvar end_date = gantt.calculateEndDate({start_date: start_date, duration: duration, task: ev});\r\n\r\n\t\t\tvar template = gantt.templates.task_end_date || gantt.templates.task_date;\r\n\t\t\tendspan.innerHTML = template(end_date);\r\n\t\t}\r\n\r\n\t\tfunction _change_duration(step) {\r\n\t\t\tvar value = duration.value;\r\n\r\n\t\t\tvalue = getFormatter(config).parse(value);\r\n\t\t\tif (window.isNaN(value))\r\n\t\t\t\tvalue = 0;\r\n\t\t\tvalue += step;\r\n\t\t\tif (value < 1) value = 1;\r\n\t\t\tduration.value = getFormatter(config).format(value);\r\n\t\t\t_calc_date();\r\n\t\t}\r\n\r\n\t\tbtns[0].onclick = gantt.bind(function() {\r\n\t\t\t_change_duration(-1 * gantt.config.duration_step);\r\n\t\t}, this);\r\n\t\tbtns[1].onclick = gantt.bind(function() {\r\n\t\t\t_change_duration(1 * gantt.config.duration_step);\r\n\t\t}, this);\r\n\t\ts[0].onchange = _calc_date;\r\n\t\ts[1].onchange = _calc_date;\r\n\t\ts[2].onchange = _calc_date;\r\n\t\tif (s[3]) s[3].onchange = _calc_date;\r\n\r\n\t\tduration.onkeydown = gantt.bind(function(e) {\r\n\t\t\tvar code; \r\n\r\n\t\t\te = e || window.event;\r\n\t\t\tcode = (e.charCode || e.keyCode || e.which);\r\n\t\t\t\r\n\t\t\tif (code == gantt.constants.KEY_CODES.DOWN) {\r\n\t\t\t\t_change_duration(-1 * gantt.config.duration_step);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (code == gantt.constants.KEY_CODES.UP) {\r\n\t\t\t\t_change_duration(1 * gantt.config.duration_step);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\twindow.setTimeout(_calc_date, 1);\r\n\t\t}, this);\r\n\r\n\t\tduration.onchange = gantt.bind(_calc_date, this);\r\n\r\n\t\tmapping = gantt._resolve_default_mapping(config);\r\n\t\tif (typeof(mapping) === \"string\") mapping = {start_date: mapping};\r\n\r\n\t\tstart_date = ev[mapping.start_date] || new Date();\r\n\t\tend_date = ev[mapping.end_date] || gantt.calculateEndDate({\r\n\t\t\tstart_date: start_date,\r\n\t\t\tduration: 1,\r\n\t\t\ttask: ev\r\n\t\t});\r\n\t\tduration_val = Math.round(ev[mapping.duration]) || gantt.calculateDuration({\r\n\t\t\tstart_date: start_date,\r\n\t\t\tend_date: end_date,\r\n\t\t\ttask: ev\r\n\t\t});\r\n\t\tduration_val = getFormatter(config).format(duration_val);\r\n\r\n\t\tgantt.form_blocks._fill_lightbox_select(s, 0, start_date, map, config);\r\n\t\tduration.value = duration_val;\r\n\t\t_calc_date();\r\n\t};\r\n\r\n\tDurationControl.prototype.get_value = function(node, ev, config) {\r\n\t\tvar startDate = _getStartDate(node, config);\r\n\t\tvar duration = _getDuration(node, config);\r\n\t\tvar endDate = gantt.calculateEndDate({start_date: startDate, duration: duration, task: ev});\r\n\r\n\t\tif (typeof gantt._resolve_default_mapping(config) == \"string\") {\r\n\t\t\treturn startDate;\r\n\t\t}\r\n\t\t//GS-3144: consider scale-projection\r\n\t\tif(gantt.getScale().projection && gantt.getCalendar(\"timescale-projection-calendar\")){\r\n\t\t\tconst projectionCalendar = gantt.getCalendar(\"timescale-projection-calendar\");\r\n\t\t\tstartDate = projectionCalendar.getClosestWorkTime({ \r\n\t\t\t\tdate: startDate, \r\n\t\t\t\tunit: gantt.config.duration_unit,\r\n\t\t\t\tdir: \"future\" \r\n\t\t\t});\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tstart_date: startDate,\r\n\t\t\tend_date: endDate,\r\n\t\t\tduration: duration\r\n\t\t};\r\n\t};\r\n\r\n\tDurationControl.prototype.focus = function(node) {\r\n\t\tgantt._focus(node.getElementsByTagName(\"select\")[0]);\r\n\t};\r\n\r\n\r\n\tfunction _getStartDate(node, config) {\r\n\t\tvar s = node.getElementsByTagName(\"select\");\r\n\t\tvar map = config._time_format_order;\r\n\t\tvar hours = 0;\r\n\t\tvar minutes = 0;\r\n\r\n\t\tif (gantt.defined(map[3])) {\r\n\t\t\tvar input = s[map[3]];\r\n\t\t\tvar time = parseInt(input.value, 10);\r\n\t\t\tif (isNaN(time) && input.hasAttribute(\"data-value\")) {\r\n\t\t\t\ttime = parseInt(input.getAttribute(\"data-value\"), 10);\r\n\t\t\t}\r\n\r\n\t\t\thours = Math.floor(time / 60);\r\n\t\t\tminutes = time % 60;\r\n\t\t}\r\n\t\treturn new Date(s[map[2]].value, s[map[1]].value, s[map[0]].value, hours, minutes);\r\n\t}\r\n\r\n\tfunction _getDuration(node, config) {\r\n\t\tvar duration = node.getElementsByTagName(\"input\")[1];\r\n\r\n\t\tduration = getFormatter(config).parse(duration.value);\r\n\t\tif (!duration || window.isNaN(duration)) duration = 1;\r\n\t\tif (duration < 0) duration *= -1;\r\n\t\treturn duration;\r\n\t}\r\n\r\n\treturn DurationControl; \r\n};","import __extends from \"../../../../utils/extends\";\r\nimport htmlHelpers from \"../../utils/html_helpers\";\r\nimport BaseConstrutor from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tvar _super = BaseConstrutor(gantt);\r\n\r\n\tfunction ConstraintControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this;\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(ConstraintControl, _super);\r\n\r\n\tfunction isNonTimedConstraint(value) {\r\n\t\tif (!value || value === gantt.config.constraint_types.ASAP || value === gantt.config.constraint_types.ALAP) {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction toggleTimeSelect(timeSelects, typeValue) {\r\n\t\tvar isNonTimed = isNonTimedConstraint(typeValue);\r\n\t\tfor (var i = 0; i < timeSelects.length; i++) {\r\n\t\t\ttimeSelects[i].disabled = isNonTimed;\r\n\t\t}\r\n\t}\r\n\r\n\tConstraintControl.prototype.render = function (sns) {\r\n\t\tconst height = sns.height ? `height:${sns.height}px;` : '';\r\n\t\tlet html = `<div class='gantt_cal_ltext gantt_section_${sns.name}' ${height ? `style='${height}'` : ''}>`;\r\n\r\n\t\tvar options = [];\r\n\t\tfor (var i in gantt.config.constraint_types) {\r\n\t\t\toptions.push({ key: gantt.config.constraint_types[i], label: gantt.locale.labels[gantt.config.constraint_types[i]] });\r\n\t\t}\r\n\r\n\t\tsns.options = sns.options || options;\r\n\r\n\t\thtml += \"<span data-constraint-type-select>\" + htmlHelpers.getHtmlSelect(sns.options, [{ key: \"data-type\", value: \"constraint-type\" }]) + \"</span>\";\r\n\r\n\t\tvar timeLabel = gantt.locale.labels[\"constraint_date\"] || \"Constraint date\";\r\n\t\thtml += \"<label data-constraint-time-select>\" + timeLabel + \": \" + gantt.form_blocks.getTimePicker.call(this, sns) + \"</label>\";\r\n\r\n\t\thtml += \"</div>\";\r\n\t\treturn html;\r\n\t};\r\n\r\n\tConstraintControl.prototype.set_value = function (node, value, task, config) {\r\n\t\tvar typeSelect = node.querySelector(\"[data-constraint-type-select] select\");\r\n\t\tvar timeSelects = node.querySelectorAll(\"[data-constraint-time-select] select\");\r\n\t\tvar map = config._time_format_order;\r\n\r\n\t\tvar mapping = gantt._resolve_default_mapping(config);\r\n\r\n\t\tif (!typeSelect._eventsInitialized) {\r\n\t\t\ttypeSelect.addEventListener(\"change\", function (e) {\r\n\t\t\t\ttoggleTimeSelect(timeSelects, e.target.value);\r\n\t\t\t});\r\n\t\t\ttypeSelect._eventsInitialized = true;\r\n\t\t}\r\n\r\n\t\tvar constraintDate = task[mapping.constraint_date] || new Date();\r\n\t\tgantt.form_blocks._fill_lightbox_select(timeSelects, 0, constraintDate, map, config);\r\n\r\n\t\tvar constraintType = task[mapping.constraint_type] || gantt.getConstraintType(task);\r\n\t\ttypeSelect.value = constraintType;\r\n\t\ttoggleTimeSelect(timeSelects, constraintType);\r\n\t};\r\n\r\n\tConstraintControl.prototype.get_value = function (node, task, config) {\r\n\t\tvar typeSelect = node.querySelector(\"[data-constraint-type-select] select\");\r\n\t\tvar timeSelects = node.querySelectorAll(\"[data-constraint-time-select] select\");\r\n\r\n\t\tvar constraintType = typeSelect.value;\r\n\t\tvar constraintDate = null;\r\n\t\tif (!isNonTimedConstraint(constraintType)) {\r\n\t\t\tconstraintDate = gantt.form_blocks.getTimePickerValue(timeSelects, config);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tconstraint_type: constraintType,\r\n\t\t\tconstraint_date: constraintDate\r\n\t\t};\r\n\t};\r\n\r\n\tConstraintControl.prototype.focus = function (node) {\r\n\t\tgantt._focus(node.querySelector(\"select\"));\r\n\t};\r\n\r\n\treturn ConstraintControl;\r\n};","import __extends from \"../../../../utils/extends\";\r\n\r\nimport Super from \"./select_control\";\r\n\r\nexport default function(gantt) {\r\n\tconst _super = Super(gantt);\r\n\r\n\tfunction TypeselectControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this;\r\n\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(TypeselectControl, _super);\r\n\r\n\tTypeselectControl.prototype.render = function(sns) {\r\n\t\tvar types = gantt.config.types,\r\n\t\t\tlocale = gantt.locale.labels,\r\n\t\t\toptions = [];\r\n\r\n\t\tvar filter = sns.filter || function (typeKey, typeValue) {\r\n\t\t\tif (!types.placeholder || typeValue !== types.placeholder) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t};\r\n\t\tfor (var i in types) {\r\n\t\t\tif (!filter(i, types[i]) === false) {\r\n\t\t\t\toptions.push({ key: types[i], label: locale[\"type_\" + i] });\r\n\t\t\t}\r\n\t\t}\r\n\t\tsns.options = options;\r\n\r\n\t\tvar oldOnChange = sns.onchange;\r\n\t\tsns.onchange = function () {\r\n\t\t\tgantt._lightbox_current_type = this.value;\r\n\t\t\tgantt.changeLightboxType(this.value);\r\n\t\t\tif (typeof oldOnChange == 'function') {\r\n\t\t\t\toldOnChange.apply(this, arguments);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\treturn _super.prototype.render.apply(this, arguments);\r\n\t};\r\n\r\n\treturn TypeselectControl;\r\n};\r\n","\r\nimport __extends from \"../../../../utils/extends\";\r\nimport DurationFormatterNumeric from \"../../../common/duration_formatter_numeric\";\r\nimport BaseConstrutor from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tvar _super = BaseConstrutor(gantt);\r\n\r\n\tfunction DurationControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this; \r\n\r\n\t\treturn self; \r\n\t}\r\n\r\n\tfunction getFormatter(config) {\r\n\t\treturn config.formatter || new DurationFormatterNumeric();\r\n\t}\r\n\r\n\tfunction _generateBaselineRow (node, baseline, task, config){\r\n\t\tconst time = \"<div class='gantt_time_selects'>\" + gantt.form_blocks.getTimePicker.call(gantt, config) + \"</div>\";\r\n\t\tlet durationLabel = \" \"+ gantt.locale.labels[gantt.config.duration_unit + \"s\"] +\" \";\r\n\t\tconst singleDate = config.single_date ? \" style='display:none'\" : \"\";\r\n\t\tconst readonly = config.readonly ? \" disabled='disabled'\" : \"\";\r\n\t\tconst ariaAttr = gantt._waiAria.lightboxDurationInputAttrString(config);\r\n\t\tconst deleteLabel = gantt.locale.labels.baselines_remove_button;\r\n\r\n\t\tlet durationInputClass = \"gantt_duration_value\";\r\n\t\tif(config.formatter) {\r\n\t\t\tdurationLabel = \"\";\r\n\t\t\tdurationInputClass += \" gantt_duration_value_formatted\";\r\n\t\t}\r\n\r\n\t\tconst durationEl = \"<div class='gantt_duration' \" + singleDate + \">\" +\r\n\t\t\"<div class='gantt_duration_inputs'>\" +\r\n\t\t\t\"<input type='button' class='gantt_duration_dec' value='-'\" + readonly + \">\" +\r\n\t\t\t\"<input type='text' value='5days' class='\"+durationInputClass+\"'\" + readonly + \" \" + ariaAttr + \">\" +\r\n\t\t\t\"<input type='button' class='gantt_duration_inc' value='+'\" + readonly + \">\"+\r\n\t\t\t\"</div>\" +\r\n\t\t\t\"<div class='gantt_duration_end_date'>\"+durationLabel+\"<span></span></div>\" +\r\n\t\t\t\"</div>\" +\r\n\t\t\t\"</div>\";\r\n\r\n\t\tconst deleteButton = `<div><div class='baseline_delete_button gantt_custom_button dhx_gantt_icon dhx_gantt_icon_delete' aria-label='${deleteLabel}'></div></div>`;\r\n\r\n\t\tconst baselineRow = document.createElement(\"div\");\r\n\t\tbaselineRow.className = \"gantt_section_time gantt_section_duration\";\r\n\t\tbaselineRow.setAttribute(\"data-baseline-id\", baseline.id);\r\n\t\tbaselineRow.innerHTML = time + durationEl + deleteButton + \"<br>\";\r\n\t\tnode.appendChild(baselineRow);\r\n\r\n\t\tvar s = baselineRow.getElementsByTagName(\"select\");\r\n\t\tvar inps = baselineRow.getElementsByTagName(\"input\");\r\n\t\tvar duration = inps[1];\r\n\t\tvar btns = [inps[0], inps[2]];\r\n\t\tvar endspan = baselineRow.getElementsByTagName(\"span\")[0];\r\n\t\tvar map = config._time_format_order;\r\n\t\tvar mapping;\r\n\t\tvar start_date;\r\n\t\tvar end_date;\r\n\t\tvar duration_val;\r\n\r\n\t\tconst deleteEl = baselineRow.querySelector(\".baseline_delete_button\");\r\n\t\tdeleteEl.onclick = function(e){\r\n\t\t\tconst section = baselineRow.parentNode;\r\n\t\t\tbaselineRow.innerHTML = \"\";\r\n\t\t\tbaselineRow.remove();\r\n\t\t\tif (section.innerHTML === \"\"){\r\n\t\t\t\tsection.innerHTML = gantt.locale.labels.baselines_section_placeholder;\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\r\n\t\tfunction _calc_date() {\r\n\t\t\tvar start_date = _getStartDate.call(gantt, baselineRow, config);\r\n\t\t\tvar duration = _getDuration.call(gantt, baselineRow, config);\r\n\t\t\tvar end_date = gantt.calculateEndDate({start_date: start_date, duration: duration, task: task});\r\n\r\n\t\t\tvar template = gantt.templates.task_end_date || gantt.templates.task_date;\r\n\t\t\tendspan.innerHTML = template(end_date);\r\n\t\t}\r\n\r\n\t\tfunction _change_duration(step) {\r\n\t\t\tvar value = duration.value;\r\n\r\n\t\t\tvalue = getFormatter(config).parse(value);\r\n\t\t\tif (window.isNaN(value))\r\n\t\t\t\tvalue = 0;\r\n\t\t\tvalue += step;\r\n\t\t\tif (value < 1) value = 1;\r\n\t\t\tduration.value = getFormatter(config).format(value);\r\n\t\t\t_calc_date();\r\n\t\t}\r\n\r\n\t\tbtns[0].onclick = gantt.bind(function() {\r\n\t\t\t_change_duration(-1 * gantt.config.duration_step);\r\n\t\t}, gantt);\r\n\t\tbtns[1].onclick = gantt.bind(function() {\r\n\t\t\t_change_duration(1 * gantt.config.duration_step);\r\n\t\t}, gantt);\r\n\t\ts[0].onchange = _calc_date;\r\n\t\ts[1].onchange = _calc_date;\r\n\t\ts[2].onchange = _calc_date;\r\n\t\tif (s[3]) s[3].onchange = _calc_date;\r\n\r\n\t\tduration.onkeydown = gantt.bind(function(e) {\r\n\t\t\tvar code; \r\n\r\n\t\t\te = e || window.event;\r\n\t\t\tcode = (e.charCode || e.keyCode || e.which);\r\n\t\t\t\r\n\t\t\tif (code == gantt.constants.KEY_CODES.DOWN) {\r\n\t\t\t\t_change_duration(-1 * gantt.config.duration_step);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (code == gantt.constants.KEY_CODES.UP) {\r\n\t\t\t\t_change_duration(1 * gantt.config.duration_step);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\twindow.setTimeout(_calc_date, 1);\r\n\t\t}, gantt);\r\n\r\n\t\tduration.onchange = gantt.bind(_calc_date, gantt);\r\n\r\n\t\tmapping = gantt._resolve_default_mapping(config);\r\n\t\tif (typeof(mapping) === \"string\") mapping = {start_date: mapping};\r\n\r\n\t\tstart_date = baseline.start_date || new Date();\r\n\t\tend_date = baseline.end_date || gantt.calculateEndDate({\r\n\t\t\tstart_date: start_date,\r\n\t\t\tduration: 1,\r\n\t\t\ttask\r\n\t\t});\r\n\t\tduration_val = gantt.calculateDuration({\r\n\t\t\tstart_date: start_date,\r\n\t\t\tend_date: end_date,\r\n\t\t\ttask\r\n\t\t});\r\n\t\tduration_val = getFormatter(config).format(duration_val);\r\n\r\n\t\tgantt.form_blocks._fill_lightbox_select(s, 0, start_date, map, config);\r\n\t\tduration.value = duration_val;\r\n\t\t_calc_date();\r\n\t}\r\n\r\n\t__extends(DurationControl, _super);\r\n\r\n\tDurationControl.prototype.render = function(sns) {\r\n\t\tconst baselineSection = `<div style='height: ${sns.height || 110}px; font-size:inherit;' class='gantt_section_baselines'></div>`;\r\n\t\treturn baselineSection;\r\n\t};\r\n\r\n\tDurationControl.prototype.set_value = function(node, value, task, config) {\r\n\t\tif (task.baselines){\r\n\t\t\tnode.innerHTML = \"\";\r\n\r\n\t\t\ttask.baselines.forEach((baseline)=>{\r\n\t\t\t\t_generateBaselineRow(node, baseline, task, config);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tnode.innerHTML = gantt.locale.labels.baselines_section_placeholder;\r\n\t\t}\t\t\r\n\r\n\t};\r\n\r\n\tDurationControl.prototype.get_value = function(node, task, config) {\r\n\t\tconst baselines = [];\r\n\t\tconst baselineRows = node.querySelectorAll(`[data-baseline-id]`);\r\n\t\tbaselineRows.forEach((baselineNode)=>{\r\n\t\t\tconst baselineId = baselineNode.dataset.baselineId;\r\n\t\t\tconst baselineStore = gantt.getDatastore(\"baselines\");\r\n\t\t\tlet baseline = baselineStore.getItem(baselineId);\r\n\t\t\tlet updatedBaseline;\r\n\t\t\tif (baseline){\r\n\t\t\t\tupdatedBaseline = gantt.copy(baseline);\r\n\t\t\t} else {\r\n\t\t\t\tupdatedBaseline = {\r\n\t\t\t\t\tid: gantt.uid(),\r\n\t\t\t\t\ttask_id: task.id,\r\n\t\t\t\t\ttext: \"Baseline 1\"\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tupdatedBaseline.start_date = _getStartDate(baselineNode, config);\r\n\t\t\tupdatedBaseline.duration = _getDuration(baselineNode, config);\r\n\t\t\tupdatedBaseline.end_date = gantt.calculateEndDate({start_date: updatedBaseline.start_date, duration: updatedBaseline.duration, task});\r\n\r\n\t\t\tbaselines.push(updatedBaseline);\r\n\t\t});\r\n\r\n\t\treturn baselines;\r\n\t};\r\n\r\n\tDurationControl.prototype.button_click = function (index, el, section, container) {\r\n\t\tif (gantt.callEvent(\"onSectionButton\", [gantt._lightbox_id, section]) === false) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (el.closest(\".gantt_custom_button.gantt_remove_baselines\")){\r\n\t\t\tcontainer.innerHTML = gantt.locale.labels.baselines_section_placeholder;\r\n\t\t}\r\n\t\tif (el.closest(\".gantt_custom_button.gantt_add_baselines\")){\r\n\t\t\tif (container.innerHTML == gantt.locale.labels.baselines_section_placeholder){\r\n\t\t\t\tcontainer.innerHTML = \"\";\r\n\t\t\t}\r\n\t\t\tconst task = gantt.getTask(gantt._lightbox_id);\r\n\t\t\tconst baseline = {\r\n\t\t\t\tid: gantt.uid(),\r\n\t\t\t\ttask_id: task.id,\r\n\t\t\t\ttext: \"Baseline 1\",\r\n\t\t\t\tstart_date: task.start_date,\r\n\t\t\t\tend_date: task.end_date\r\n\t\t\t};\r\n\t\t\tconst config = gantt._get_typed_lightbox_config()[index];\r\n\t\t\t_generateBaselineRow(container, baseline, task, config);\r\n\t\t}\r\n\t};\r\n\r\n\tDurationControl.prototype.focus = function(node) {\r\n\t\tgantt._focus(node.getElementsByTagName(\"select\")[0]);\r\n\t};\r\n\r\n\r\n\tfunction _getStartDate(node, config) {\r\n\t\tvar s = node.getElementsByTagName(\"select\");\r\n\t\tvar map = config._time_format_order;\r\n\t\tvar hours = 0;\r\n\t\tvar minutes = 0;\r\n\r\n\t\tif (gantt.defined(map[3])) {\r\n\t\t\tvar input = s[map[3]];\r\n\t\t\tvar time = parseInt(input.value, 10);\r\n\t\t\tif (isNaN(time) && input.hasAttribute(\"data-value\")) {\r\n\t\t\t\ttime = parseInt(input.getAttribute(\"data-value\"), 10);\r\n\t\t\t}\r\n\r\n\t\t\thours = Math.floor(time / 60);\r\n\t\t\tminutes = time % 60;\r\n\t\t}\r\n\t\treturn new Date(s[map[2]].value, s[map[1]].value, s[map[0]].value, hours, minutes);\r\n\t}\r\n\r\n\tfunction _getDuration(node, config) {\r\n\t\tvar duration = node.getElementsByTagName(\"input\")[1];\r\n\r\n\t\tduration = getFormatter(config).parse(duration.value);\r\n\t\tif (!duration || window.isNaN(duration)) duration = 1;\r\n\t\tif (duration < 0) duration *= -1;\r\n\t\treturn duration;\r\n\t}\r\n\r\n\treturn DurationControl; \r\n};","import * as utils from \"../utils/utils\";\r\nimport env from \"../utils/env\";\r\nimport isHeadless from \"../utils/is_headless\";\r\nimport * as domHelpers from \"./ui/utils/dom_helpers\";\r\nimport * as codeHelpers from \"../utils/helpers\";\r\nimport domEventScope from \"./ui/utils/dom_event_scope\";\r\nimport messages from \"./ui/message\";\r\nimport ui from \"./ui/index\";\r\nimport createLayoutFacade from \"./facades/layout\";\r\nimport taskLayers from \"./data_task_layers\";\r\n\r\nimport skin from \"./ui/skin\";\r\nimport skyblue from \"../css/skins/skyblue\";\r\nimport meadow from \"../css/skins/meadow\";\r\nimport terrace from \"../css/skins/terrace\";\r\nimport broadway from \"../css/skins/broadway\";\r\nimport material from \"../css/skins/material\";\r\nimport dark from \"../css/skins/dark\";\r\nimport contrast_black from \"../css/skins/contrast_black\";\r\nimport contrast_white from \"../css/skins/contrast_white\";\r\nimport plugins from \"./ui/plugins\";\r\nimport touch from \"./ui/touch\";\r\nimport lightbox from \"./ui/lightbox\";\r\nimport lightbox_optional_time from \"./ui/lightbox/lightbox_optional_time\";\r\nimport wai_aria from \"./ui/wai_aria\";\r\n\r\n\r\nexport default function(gantt) {\r\n\r\n\tif(!env.isNode){\r\n\r\n\t\tgantt.utils = {\r\n\t\t\tarrayFind: codeHelpers.arrayFind,\r\n\t\t\tdom: domHelpers\r\n\t\t};\r\n\r\n\t\tvar domEvents = domEventScope();\r\n\t\tgantt.event = domEvents.attach;\r\n\t\tgantt.eventRemove = domEvents.detach;\r\n\t\tgantt._eventRemoveAll = domEvents.detachAll;\r\n\t\tgantt._createDomEventScope = domEvents.extend;\r\n\r\n\t\tutils.mixin(gantt, messages(gantt));\r\n\t\tvar uiApi = ui.init(gantt);\r\n\t\tgantt.$ui = uiApi.factory;\r\n\t\tgantt.$ui.layers = uiApi.render;\r\n\t\tgantt.$mouseEvents = uiApi.mouseEvents;\r\n\t\tgantt.$services.setService(\"mouseEvents\", function () {\r\n\t\t\treturn gantt.$mouseEvents;\r\n\t\t});\r\n\t\tgantt.mixin(gantt, uiApi.layersApi);\r\n\r\n\t\ttaskLayers(gantt);\r\n\r\n\t\tgantt.$services.setService(\"layers\", function () {\r\n\t\t\treturn uiApi.layersService;\r\n\t\t});\r\n\r\n\t\tgantt.mixin(gantt, createLayoutFacade());\r\n\t\tskin(gantt);\r\n\t\tskyblue(gantt);\r\n\t\tdark(gantt);\r\n\t\tmeadow(gantt);\r\n\t\tterrace(gantt);\r\n\t\tbroadway(gantt);\r\n\t\tmaterial(gantt);\r\n\t\tcontrast_black(gantt);\r\n\t\tcontrast_white(gantt);\r\n\t\tplugins(gantt);\r\n\t\ttouch(gantt);\r\n\t\tlightbox(gantt);\r\n\t\tlightbox_optional_time(gantt);\r\n\t\twai_aria(gantt);\r\n\r\n\t\tgantt.locate = function(e) {\r\n\t\t\tvar trg = domHelpers.getTargetNode(e);\r\n\r\n\t\t\t// ignore empty rows/cells of the timeline\r\n\t\t\tif(domHelpers.closest(trg, \".gantt_task_row\")){\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tvar targetAttribute = arguments[1] || this.config.task_attribute;\r\n\r\n\t\t\tvar node = domHelpers.locateAttribute(trg, targetAttribute);\r\n\t\t\tif(node){\r\n\t\t\t\treturn node.getAttribute(targetAttribute);\r\n\t\t\t}else{\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tgantt._locate_css = function(e, classname, strict){\r\n\t\t\treturn domHelpers.locateClassName(e, classname, strict);\r\n\t\t};\r\n\r\n\t\tgantt._locateHTML = function(e, attribute) {\r\n\t\t\treturn domHelpers.locateAttribute(e, attribute || this.config.task_attribute);\r\n\t\t};\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onParse\", function(){\r\n\t\tif(!isHeadless(gantt)){\r\n\t\t\tgantt.attachEvent(\"onGanttRender\", function(){\r\n\t\t\t\tif(gantt.config.initial_scroll){\r\n\t\t\t\t\tvar firstTask = gantt.getTaskByIndex(0);\r\n\t\t\t\t\tvar id = firstTask ? firstTask.id : gantt.config.root_id;\r\n\t\t\t\t\t// GS-1450. Don't scroll to the task if there is no timeline\r\n\t\t\t\t\tif(gantt.isTaskExists(id) && gantt.$task && gantt.utils.dom.isChildOf(gantt.$task, gantt.$container)){\r\n\t\t\t\t\t\tgantt.showTask(id);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, {once: true});\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onBeforeGanttReady\", function(){\r\n\t\tif (!this.config.scroll_size)\r\n\t\t\tthis.config.scroll_size = domHelpers.getScrollSize() || 15;\r\n\r\n\t\tif(!isHeadless(gantt)){\r\n\t\t\t// detach listeners before clearing old DOM, possible IE errors when accessing detached nodes\r\n\t\t\tthis._eventRemoveAll();\r\n\t\t\tthis.$mouseEvents.reset();\r\n\r\n\t\t\tthis.resetLightbox();\r\n\t\t}\r\n\r\n\t});\r\n\r\n\t// GS-1261: scroll the views to the right side when RTL is enabled\r\n\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\t\tif(!isHeadless(gantt) && gantt.config.rtl){\r\n\t\t\tgantt.$layout.getCellsByType(\"viewCell\").forEach(function(cell){ \r\n\t\t\t\tvar attachedScrollbar = cell.$config.scrollX;\r\n\t\t\t\tif (!attachedScrollbar) return;\r\n\r\n\t\t\t\tvar scrollbar = gantt.$ui.getView(attachedScrollbar);\r\n\t\t\t\tif (scrollbar) scrollbar.scrollTo(scrollbar.$config.scrollSize,0);\r\n\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\t// GS-1649: check if extensions are connected via files\r\n\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\t\tif(!isHeadless(gantt)){\r\n\r\n\t\t\tvar activePlugins = gantt.plugins();\r\n\r\n\t\t\tvar availablePlugins = {\r\n\t\t\t\tauto_scheduling: gantt.autoSchedule,\r\n\t\t\t\tclick_drag: gantt.ext.clickDrag,\r\n\t\t\t\tcritical_path: gantt.isCriticalTask,\r\n\t\t\t\tdrag_timeline: gantt.ext.dragTimeline,\r\n\t\t\t\texport_api: gantt.exportToPDF,\r\n\t\t\t\tfullscreen: gantt.ext.fullscreen,\r\n\t\t\t\tgrouping: gantt.groupBy,\r\n\t\t\t\tkeyboard_navigation: gantt.ext.keyboardNavigation,\r\n\t\t\t\tmarker: gantt.addMarker,\r\n\t\t\t\tmultiselect: gantt.eachSelectedTask,\r\n\t\t\t\toverlay: gantt.ext.overlay,\r\n\t\t\t\tquick_info: gantt.templates.quick_info_content,\r\n\t\t\t\ttooltip: gantt.ext.tooltips,\r\n\t\t\t\tundo: gantt.undo\r\n\t\t\t};\r\n\r\n\t\t\tfor (let plugin in availablePlugins){\r\n\t\t\t\tif (availablePlugins[plugin] && !activePlugins[plugin]){\r\n\t\t\t\t\t// eslint-disable-next-line no-console\r\n\t\t\t\t\tconsole.warn(`You connected the '${plugin}' extension via an obsolete file. \r\nTo fix it, you need to remove the obsolete file and connect the extension via the plugins method: https://docs.dhtmlx.com/gantt/api__gantt_plugins.html`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n};","export default function(gantt) {\r\n\tdelete gantt.addTaskLayer;\r\n\tdelete gantt.addLinkLayer;\r\n};","function createLayoutFacade(){\r\n\r\n\tfunction getTimeline(gantt){\r\n\t\treturn gantt.$ui.getView(\"timeline\");\r\n\t}\r\n\r\n\tfunction getGrid(gantt){\r\n\t\treturn gantt.$ui.getView(\"grid\");\r\n\t}\r\n\r\n\tfunction getBaseCell(gantt){\r\n\t\tvar timeline = getTimeline(gantt);\r\n\t\tif (timeline && !timeline.$config.hidden){\r\n\t\t\treturn timeline;\r\n\t\t} else{\r\n\t\t\tvar grid = getGrid(gantt);\r\n\t\t\tif (grid && !grid.$config.hidden){\r\n\t\t\t\treturn grid;\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getVerticalScrollbar(gantt){\r\n\t\tvar baseCell = null;\r\n\t\t// GS-1150: if we reorder or resize something in the grid, we should obtain the grid container\r\n\t\tvar gridDrag = false;\r\n\t\tvar gridMarkers = [\r\n\t\t\t\".gantt_drag_marker.gantt_grid_resize_area\",\r\n\t\t\t\".gantt_drag_marker .gantt_row.gantt_row_task\",\r\n\t\t\t\".gantt_drag_marker.gantt_grid_dnd_marker\"\r\n\t\t];\r\n\t\tgridMarkers.forEach(function (selector) {\r\n\t\t\tgridDrag = gridDrag || !!document.querySelector(selector);\r\n\t\t});\r\n\t\tif (gridDrag){\r\n\t\t\tbaseCell = getGrid(gantt);\r\n\t\t} else{\r\n\t\t\tbaseCell = getBaseCell(gantt);\r\n\t\t}\r\n\r\n\t\t// GS-1827. If there is no grid and timeline, there is no scrollbar for them\r\n\t\tif (!baseCell){\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar verticalScrollbar = getAttachedScrollbar(gantt, baseCell, \"scrollY\");\r\n\t\treturn verticalScrollbar;\r\n\t}\r\n\r\n\tfunction getHorizontalScrollbar(gantt){\r\n\t\tvar baseCell = getBaseCell(gantt);\r\n\t\tif (!baseCell || baseCell.id == \"grid\"){\r\n\t\t\treturn null; // if the timeline is not displayed, do not return the scrollbar\r\n\t\t}\r\n\t\tvar horizontalScrollbar = getAttachedScrollbar(gantt, baseCell, \"scrollX\");\r\n\t\treturn horizontalScrollbar;\r\n\t}\r\n\r\n\tfunction getAttachedScrollbar(gantt, cell, type){\r\n\t\tvar attachedScrollbar = cell.$config[type];\r\n\t\tvar scrollbarView = gantt.$ui.getView(attachedScrollbar);\r\n\t\treturn scrollbarView;\r\n\t}\r\n\r\n\tvar DEFAULT_VALUE = \"DEFAULT_VALUE\";\r\n\r\n\tfunction tryCall(getView, method, args, fallback){\r\n\t\tvar view = getView(this);\r\n\t\tif (!(view && view.isVisible())) {\r\n\t\t\tif(fallback){\r\n\t\t\t\treturn fallback();\r\n\t\t\t}else{\r\n\t\t\t\treturn DEFAULT_VALUE;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn view[method].apply(view, args);\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\r\n\t\tgetColumnIndex: function(name) {\r\n\t\t\tvar res = tryCall.call(this, getGrid, \"getColumnIndex\", [name]);\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdateFromPos: function(x) {\r\n\t\t\tvar res = tryCall.call(this, getTimeline, \"dateFromPos\", Array.prototype.slice.call(arguments));\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn this.getState().min_date;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tposFromDate: function(date) {\r\n\t\t\tvar res = tryCall.call(this, getTimeline, \"posFromDate\", Array.prototype.slice.call(arguments));\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetRowTop: function(index) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar res = tryCall.call(self, getTimeline, \"getRowTop\", [index],\r\n\t\t\t\tfunction(){ return tryCall.call(self, getGrid, \"getRowTop\", [index]);}\r\n\t\t\t\t);\r\n\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetTaskTop: function(id) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar res = tryCall.call(self, getTimeline, \"getItemTop\", [id],\r\n\t\t\t\tfunction(){ return tryCall.call(self, getGrid, \"getItemTop\", [id]);}\r\n\t\t\t);\r\n\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\tgetTaskPosition: function(task, start_date, end_date) {\r\n\t\t\tvar res = tryCall.call(this, getTimeline, \"getItemPosition\", [task, start_date, end_date]);\r\n\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\tvar top = this.getTaskTop(task.id);\r\n\t\t\t\tvar height = this.getTaskBarHeight(task.id);\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tleft: 0,\r\n\t\t\t\t\ttop: top,\r\n\t\t\t\t\theight: height,\r\n\t\t\t\t\twidth: 0\r\n\t\t\t\t};\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetTaskBarHeight: function(taskId, isMilestoneRender) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar res = tryCall.call(self, getTimeline, \"getBarHeight\", [taskId, isMilestoneRender],\r\n\t\t\t\tfunction(){ return tryCall.call(self, getGrid, \"getItemHeight\", [taskId]);}\r\n\t\t\t);\r\n\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetTaskHeight: function(taskId) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar res = tryCall.call(self, getTimeline, \"getItemHeight\", [taskId],\r\n\t\t\t\tfunction(){ return tryCall.call(self, getGrid, \"getItemHeight\", [taskId]);}\r\n\t\t\t);\r\n\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\tcolumnIndexByDate: function(date) {\r\n\t\t\tvar res = tryCall.call(this, getTimeline, \"columnIndexByDate\", [date]);\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\troundTaskDates: function() {\r\n\t\t\ttryCall.call(this, getTimeline, \"roundTaskDates\", []);\r\n\t\t},\r\n\r\n\t\tgetScale: function() {\r\n\t\t\tvar res = tryCall.call(this, getTimeline, \"getScale\", []);\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn null;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetTaskNode: function(id) {\r\n\t\t\tvar timeline = getTimeline(this);\r\n\t\t\tif (!timeline || !timeline.isVisible()) {\r\n\t\t\t\treturn null;\r\n\t\t\t} else {\r\n\t\t\t\tvar node = timeline._taskRenderer.rendered[id];\r\n\t\t\t\tif(!node){\r\n\t\t\t\t\tvar domAttr = timeline.$config.item_attribute;\r\n\t\t\t\t\tnode = timeline.$task_bars.querySelector(\"[\" +domAttr+ \"='\"+id+\"']\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn node || null;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\tgetLinkNode: function(id) {\r\n\t\t\tvar timeline = getTimeline(this);\r\n\t\t\tif (!timeline.isVisible()) {\r\n\t\t\t\treturn null;\r\n\t\t\t} else {\r\n\t\t\t\treturn timeline._linkRenderer.rendered[id];\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tscrollTo: function(left, top){\r\n\t\t\tvar vertical = getVerticalScrollbar(this);\r\n\t\t\tvar horizontal = getHorizontalScrollbar(this);\r\n\r\n\t\t\tvar oldH = {position: 0},\r\n\t\t\t\toldV = {position: 0};\r\n\r\n\t\t\tif(vertical){\r\n\t\t\t\toldV = vertical.getScrollState();\r\n\t\t\t}\r\n\t\t\tif(horizontal){\r\n\t\t\t\toldH = horizontal.getScrollState();\r\n\t\t\t}\r\n\r\n\t\t\tvar scrollHorizontal = (horizontal && left*1 == left);\r\n\t\t\tvar scrollVertical = (vertical && top*1 == top);\r\n\t\t\tvar scrollBoth = scrollHorizontal && scrollVertical;\r\n\r\n\t\t\tif(scrollBoth){\r\n\t\t\t\t// some views will be scrolled both horizontally and vertically and smart rendering can be called twice\r\n\t\t\t\t// set flag in order not to invoke smart rendering at the horizontal scroll stage\r\n\t\t\t\t// so it will repaint only once when the scroll is completed\r\n\t\t\t\tvar verticalViews = vertical._getLinkedViews();\r\n\t\t\t\tvar horizontalViews = horizontal._getLinkedViews();\r\n\r\n\t\t\t\tvar commonViews = [];\r\n\t\t\t\tfor(var i = 0; i < verticalViews.length; i++){\r\n\t\t\t\t\tfor(var j = 0; j < horizontalViews.length; j++){\r\n\r\n\t\t\t\t\t\tif(verticalViews[i].$config.id && horizontalViews[j].$config.id && verticalViews[i].$config.id === horizontalViews[j].$config.id){\r\n\t\t\t\t\t\t\tcommonViews.push(verticalViews[i].$config.id);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (scrollHorizontal){\r\n\t\t\t\tif(commonViews){\r\n\t\t\t\t\tcommonViews.forEach((function(viewId){\r\n\t\t\t\t\t\tthis.$ui.getView(viewId).$config.$skipSmartRenderOnScroll = true;\r\n\t\t\t\t\t}).bind(this));\r\n\t\t\t\t}\r\n\r\n\t\t\t\thorizontal.scroll(left);\r\n\t\t\t\tif(commonViews){\r\n\t\t\t\t\tcommonViews.forEach((function(viewId){\r\n\t\t\t\t\t\tthis.$ui.getView(viewId).$config.$skipSmartRenderOnScroll = false;\r\n\t\t\t\t\t}).bind(this));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(scrollVertical){\r\n\t\t\t\tvertical.scroll(top);\r\n\t\t\t}\r\n\r\n\t\t\tvar newV = {position: 0},\r\n\t\t\t\tnewH = {position: 0};\r\n\t\t\tif(vertical){\r\n\t\t\t\tnewV = vertical.getScrollState();\r\n\t\t\t}\r\n\t\t\tif(horizontal){\r\n\t\t\t\tnewH = horizontal.getScrollState();\r\n\t\t\t}\r\n\r\n\t\t\tthis.callEvent(\"onGanttScroll\", [oldH.position, oldV.position, newH.position, newV.position]);\r\n\t\t},\r\n\r\n\t\tshowDate: function(date){\r\n\t\t\tvar date_x = this.posFromDate(date);\r\n\t\t\tvar scroll_to = Math.max(date_x - this.config.task_scroll_offset, 0);\r\n\t\t\tthis.scrollTo(scroll_to);\r\n\t\t},\r\n\t\tshowTask: function(id) {\r\n\t\t\tvar pos = this.getTaskPosition(this.getTask(id));\r\n\r\n\t\t\t// GS-1261: we need to show the start_date even in the RTL mode\r\n\t\t\tvar leftPos = pos.left;\r\n\t\t\tif (this.config.rtl) leftPos = pos.left + pos.width;\r\n\r\n\t\t\tvar left = Math.max(leftPos - this.config.task_scroll_offset, 0);\r\n\r\n\t\t\tvar dataHeight = this._scroll_state().y;\r\n\t\t\tvar top;\r\n\t\t\tif(!dataHeight){\r\n\t\t\t\ttop = pos.top;\r\n\t\t\t}else{\r\n\t\t\t\ttop = pos.top - (dataHeight - this.getTaskBarHeight(id))/2;\r\n\t\t\t}\r\n\r\n\t\t\tthis.scrollTo(left, top);\r\n\t\t\t// GS-1150: if the grid and timeline have different scrollbars, we need to scroll thegrid to show the task\r\n\t\t\tvar gridCell = getGrid(this);\r\n\t\t\tvar timelineCell = getTimeline(this);\r\n\t\t\tif (gridCell && timelineCell && gridCell.$config.scrollY != timelineCell.$config.scrollY){\r\n\t\t\t\tvar gridScrollbar = getAttachedScrollbar(this, gridCell, \"scrollY\");\r\n\t\t\t\tgridScrollbar.scrollTo(null, top);\r\n\t\t\t}\r\n\t\t},\r\n\t\t_scroll_state: function(){\r\n\t\t\tvar result = {\r\n\t\t\t\tx: false,\r\n\t\t\t\ty: false,\r\n\t\t\t\tx_pos: 0,\r\n\t\t\t\ty_pos: 0,\r\n\t\t\t\tscroll_size: this.config.scroll_size + 1,//1px for inner content\r\n\t\t\t\tx_inner: 0,\r\n\t\t\t\ty_inner: 0\r\n\t\t\t};\r\n\r\n\t\t\tvar scrollVer = getVerticalScrollbar(this),\r\n\t\t\t\tscrollHor = getHorizontalScrollbar(this);\r\n\t\t\tif(scrollHor){\r\n\t\t\t\tvar horState = scrollHor.getScrollState();\r\n\t\t\t\tif(horState.visible){\r\n\t\t\t\t\tresult.x = horState.size;\r\n\t\t\t\t\tresult.x_inner = horState.scrollSize;\r\n\t\t\t\t}\r\n\t\t\t\tresult.x_pos = horState.position || 0;\r\n\t\t\t}\r\n\r\n\t\t\tif(scrollVer){\r\n\t\t\t\tvar verState = scrollVer.getScrollState();\r\n\t\t\t\tif(verState.visible){\r\n\t\t\t\t\tresult.y = verState.size;\r\n\r\n\t\t\t\t\tresult.y_inner = verState.scrollSize;\r\n\t\t\t\t}\r\n\t\t\t\tresult.y_pos = verState.position || 0;\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\tgetScrollState: function(){\r\n\t\t\tvar state = this._scroll_state();\r\n\t\t\treturn { x:state.x_pos, y:state.y_pos, inner_width:state.x, inner_height:state.y, width: state.x_inner, height: state.y_inner };\r\n\t\t},\r\n\r\n\t\tgetLayoutView: function(cellName){\r\n\t\t\treturn this.$ui.getView(cellName);\r\n\t\t},\r\n\r\n\t\tscrollLayoutCell: function(cellName, left, top){\r\n\t\t\tconst cell = this.$ui.getView(cellName);\r\n\t\t\tif (!cell){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (left !== null){\r\n\t\t\t\tconst horizontalScroll = this.$ui.getView(cell.$config.scrollX);\r\n\t\t\t\tif (horizontalScroll){\r\n\t\t\t\t\thorizontalScroll.scrollTo(left, null);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (top !== null){\r\n\t\t\t\tconst verticalScroll = this.$ui.getView(cell.$config.scrollY);\r\n\t\t\t\tif (verticalScroll){\r\n\t\t\t\t\tverticalScroll.scrollTo(null, top);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t};\r\n\r\n}\r\n\r\nexport default createLayoutFacade;","export default function(gantt) {\r\ngantt.skins.skyblue = {\r\n\tconfig:{\r\n\t\tgrid_width:370,\r\n\t\trow_height: 27,\r\n\t\tbar_height_padding:4,\r\n\t\tscale_height: 27,\r\n\t\tlink_line_width:1,\r\n\t\tlink_arrow_size:8,\r\n\t\tlink_radius:2,\r\n\t\tlightbox_additional_height:75\r\n\t},\r\n\t_second_column_width:95,\r\n\t_third_column_width:80\r\n};\r\n\r\n};","export default function(gantt) {\r\ngantt.skins.dark = {\r\n\tconfig:{\r\n\t\tgrid_width:390,\r\n\t\trow_height: 36,\r\n\t\tscale_height: 36,\r\n\t\tlink_line_width:2,\r\n\t\tlink_arrow_size:12,\r\n\t\tbar_height_padding:9,\r\n\t\tlightbox_additional_height:75\r\n\t},\r\n\t_second_column_width:100,\r\n\t_third_column_width:70\t\t\r\n};\r\n\r\n};","export default function(gantt) {\r\ngantt.skins.meadow = {\r\n\tconfig:{\r\n\t\tgrid_width:380,\r\n\t\trow_height: 27,\r\n\t\tscale_height: 30,\r\n\t\tlink_line_width:2,\r\n\t\tlink_arrow_size:10,\r\n\t\tbar_height_padding:4,\r\n\t\tlightbox_additional_height:72\r\n\t},\r\n\t_second_column_width:95,\r\n\t_third_column_width:80\r\n};\r\n\r\n};","export default function(gantt) {\r\ngantt.skins.terrace = {\r\n\tconfig:{\r\n\t\tgrid_width:390,\r\n\t\trow_height: 36,\r\n\t\tscale_height: 36,\r\n\t\tlink_line_width:2,\r\n\t\tlink_arrow_size:12,\r\n\t\tbar_height_padding:9,\r\n\t\tlightbox_additional_height:75\r\n\t},\r\n\t_second_column_width:100,\r\n\t_third_column_width:70\t\t\r\n};\r\n\r\n};","export default function(gantt) {\r\n\tgantt.skins.broadway = {\r\n\t\tconfig: {\r\n\t\t\tgrid_width: 390,\r\n\t\t\trow_height: 35,\r\n\t\t\tscale_height: 35,\r\n\t\t\tlink_line_width: 1,\r\n\t\t\tlink_arrow_size: 9,\r\n\t\t\tbar_height_padding:4,\r\n\t\t\tlightbox_additional_height: 86\r\n\t\t},\r\n\t\t_second_column_width: 100,\r\n\t\t_third_column_width: 80,\r\n\r\n\t\t_lightbox_template: \"<div class='gantt_cal_ltitle'><span class='gantt_mark'>&nbsp;</span><span class='gantt_time'></span><span class='gantt_title'></span><div class='gantt_cancel_btn'></div></div><div class='gantt_cal_larea'></div>\",\r\n\t\t_config_buttons_left: {},\r\n\t\t_config_buttons_right: {\r\n\t\t\t\"gantt_delete_btn\": \"icon_delete\",\r\n\t\t\t\"gantt_save_btn\": \"icon_save\"\r\n\t\t}\r\n\t};\r\n};","export default function(gantt) {\r\n\tgantt.skins.material = {\r\n\t\tconfig: {\r\n\t\t\tgrid_width: 411,\r\n\t\t\trow_height: 34,\r\n\t\t\tscale_height: 36,\r\n\t\t\tlink_line_width: 2,\r\n\t\t\tlink_arrow_size: 12,\r\n\t\t\tbar_height_padding:9,\r\n\t\t\tlightbox_additional_height: 80\r\n\t\t},\r\n\t\t_second_column_width: 110,\r\n\t\t_third_column_width: 75,\r\n\t\t_redefine_lightbox_buttons: {\r\n\t\t\t\"buttons_left\": [\"dhx_delete_btn\"],\r\n\t\t\t\"buttons_right\": [\"dhx_cancel_btn\", \"dhx_save_btn\"]\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.attachEvent(\"onAfterTaskDrag\", function (id) {\r\n\t\tvar t = gantt.getTaskNode(id);\r\n\t\tif (t) {\r\n\t\t\tt.className += \" gantt_drag_animation\";\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tvar indx = t.className.indexOf(\" gantt_drag_animation\");\r\n\t\t\t\tif (indx > -1) {\r\n\t\t\t\t\tt.className = t.className.slice(0, indx);\r\n\t\t\t\t}\r\n\t\t\t}, 200);\r\n\t\t}\r\n\t});\r\n\r\n};","export default function(gantt) {\r\ngantt.skins[\"contrast_black\"] = {\r\n\tconfig:{\r\n\t\tgrid_width:390,\r\n\t\trow_height: 35,\r\n\t\tscale_height: 35,\r\n\t\tlink_line_width:2,\r\n\t\tlink_arrow_size:12,\r\n\t\tlightbox_additional_height:75\r\n\t},\r\n\t_second_column_width:100,\r\n\t_third_column_width:80\r\n};\r\n\r\n};","export default function(gantt) {\r\ngantt.skins[\"contrast_white\"] = {\r\n\tconfig:{\r\n\t\tgrid_width:390,\r\n\t\trow_height: 35,\r\n\t\tscale_height: 35,\r\n\t\tlink_line_width:2,\r\n\t\tlink_arrow_size:12,\r\n\t\tlightbox_additional_height:75\r\n\t},\r\n\t_second_column_width:100,\r\n\t_third_column_width:80\r\n};\r\n\r\n};","import autoscroll from \"./autoscroll\";\r\nimport jquery_hooks from \"./jquery_hooks\";\r\nimport dhtmlx_hooks from \"./dhtmlx_hooks\";\r\nimport TimelineZoom from \"./timeline_zoom\";\r\n\r\n\r\nexport default function(gantt){\r\n\tif(!gantt.ext){\r\n\t\tgantt.ext = {};\r\n\t}\r\n\r\n\tvar modules = [\r\n\t\tautoscroll,\r\n\t\tjquery_hooks,\r\n\t\tdhtmlx_hooks\r\n\t];\r\n\r\n\tfor(var i = 0; i < modules.length; i++){\r\n\t\tif(modules[i])\r\n\t\t\tmodules[i](gantt);\r\n\t}\r\n\r\n\tgantt.ext.zoom = new TimelineZoom(gantt);\r\n};","export default function(gantt) {\r\n\r\n\tgantt._extend_to_optional = function (lightbox_block) {\r\n\r\n\t\tvar duration = lightbox_block;\r\n\t\tvar optional_time = {\r\n\t\t\trender: duration.render,\r\n\t\t\tfocus: duration.focus,\r\n\t\t\tset_value: function (node, value, task, section) {\r\n\t\t\t\tvar mapping = gantt._resolve_default_mapping(section);\r\n\t\t\t\tif (!task[mapping.start_date] || (mapping.start_date == \"start_date\" && this._isAllowedUnscheduledTask(task))) {\r\n\t\t\t\t\toptional_time.disable(node, section);\r\n\t\t\t\t\tvar val = {};\r\n\r\n\t\t\t\t\tfor (var i in mapping) {\r\n\t\t\t\t\t\t//take default values from the time control from task start/end dates\r\n\t\t\t\t\t\tval[mapping[i]] = task[i];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn duration.set_value.call(gantt, node, value, val, section);//set default value\r\n\t\t\t\t} else {\r\n\t\t\t\t\toptional_time.enable(node, section);\r\n\t\t\t\t\treturn duration.set_value.call(gantt, node, value, task, section);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tget_value: function (node, task, section) {\r\n\t\t\t\tif (section.disabled) {\r\n\t\t\t\t\treturn {start_date: null};\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn duration.get_value.call(gantt, node, task, section);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tupdate_block: function (node, section) {\r\n\t\t\t\tgantt.callEvent(\"onSectionToggle\", [gantt._lightbox_id, section]);\r\n\t\t\t\tnode.style.display = section.disabled ? \"none\" : \"\";\r\n\r\n\t\t\t\tif (section.button) {\r\n\t\t\t\t\tvar button = node.previousSibling.querySelector(\".gantt_custom_button_label\"),\r\n\t\t\t\t\t\tlabels = gantt.locale.labels;\r\n\r\n\t\t\t\t\tvar button_text = section.disabled ? labels[section.name + \"_enable_button\"] : labels[section.name + \"_disable_button\"];\r\n\r\n\t\t\t\t\tbutton.innerHTML = button_text;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdisable: function (node, section) {\r\n\t\t\t\tsection.disabled = true;\r\n\t\t\t\toptional_time.update_block(node, section);\r\n\r\n\t\t\t},\r\n\t\t\tenable: function (node, section) {\r\n\t\t\t\tsection.disabled = false;\r\n\t\t\t\toptional_time.update_block(node, section);\r\n\t\t\t},\r\n\t\t\tbutton_click: function (index, el, section, container) {\r\n\t\t\t\tif (gantt.callEvent(\"onSectionButton\", [gantt._lightbox_id, section]) === false) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar config = gantt._get_typed_lightbox_config()[index];\r\n\t\t\t\tif (config.disabled) {\r\n\t\t\t\t\toptional_time.enable(container, config);\r\n\t\t\t\t} else {\r\n\t\t\t\t\toptional_time.disable(container, config);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\treturn optional_time;\r\n\t};\r\n\r\n\tgantt.form_blocks.duration_optional = gantt._extend_to_optional(gantt.form_blocks.duration);\r\n\tgantt.form_blocks.time_optional = gantt._extend_to_optional(gantt.form_blocks.time);\r\n\r\n};","export default function(gantt){\r\n\tvar htmlTags = new RegExp(\"<(?:.|\\n)*?>\", \"gm\");\r\n\tvar extraSpaces = new RegExp(\" +\", \"gm\");\r\n\r\n\tfunction stripHTMLLite(htmlText){\r\n\t\treturn (htmlText + \"\")\r\n\t\t\t.replace(htmlTags, \" \").\r\n\t\t\treplace(extraSpaces, \" \");\r\n\t}\r\n\r\n\tvar singleQuotes = new RegExp(\"'\", \"gm\");\r\n\tfunction escapeQuotes(text){\r\n\t\treturn (text + \"\").replace(singleQuotes, \"&#39;\");\r\n\t}\r\n\r\n\tgantt._waiAria = {\r\n\t\tgetAttributeString: function(attr){\r\n\t\t\tvar attributes = [\" \"];\r\n\t\t\tfor(var i in attr){\r\n\t\t\t\tvar text = escapeQuotes(stripHTMLLite(attr[i]));\r\n\t\t\t\tattributes.push(i + \"='\" + text + \"'\");\r\n\t\t\t}\r\n\t\t\tattributes.push(\" \");\r\n\t\t\treturn attributes.join(\" \");\r\n\r\n\t\t},\r\n\r\n\t\tgetTimelineCellAttr:function(dateString){\r\n\r\n\t\t\treturn gantt._waiAria.getAttributeString({\"aria-label\": dateString});\r\n\t\t},\r\n\r\n\t\t_taskCommonAttr: function(task, div){\r\n\r\n\t\t\tif(!(task.start_date && task.end_date))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tdiv.setAttribute(\"aria-label\", stripHTMLLite(gantt.templates.tooltip_text(task.start_date, task.end_date, task)));\r\n\r\n\t\t\tif(task.$dataprocessor_class){\r\n\t\t\t\tdiv.setAttribute(\"aria-busy\", true);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\tsetTaskBarAttr: function(task, div){\r\n\t\t\tthis._taskCommonAttr(task, div);\r\n\r\n\t\t\t// task bars are complex elements that should be treated as a single element\r\n\t\t\tdiv.setAttribute(\"role\", \"img\");\r\n\r\n\t\t\tif(!gantt.isReadonly(task) && gantt.config.drag_move){\r\n\t\t\t\tif(task.id != gantt.getState(\"tasksDnd\").drag_id){\r\n\t\t\t\t\tdiv.setAttribute(\"aria-grabbed\", false);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdiv.setAttribute(\"aria-grabbed\", true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\ttaskRowAttr: function(task, div){\r\n\r\n\t\t\tthis._taskCommonAttr(task, div);\r\n\r\n\t\t\tif(!gantt.isReadonly(task) && gantt.config.order_branch){\r\n\t\t\t\tdiv.setAttribute(\"aria-grabbed\", false);\r\n\t\t\t}\r\n\r\n\t\t\tdiv.setAttribute(\"role\", \"row\");\r\n\t\t\t// selected attribute should be added only to the grid  because\r\n\t\t\t// other parts don't have the keyboard navigation\r\n\t\t\tdiv.setAttribute(\"aria-selected\", gantt.isSelectedTask(task.id) ? \"true\" : \"false\");\r\n\r\n\t\t\t// allowed values start from 1, set 1 for non-tree datastores\r\n\t\t\tdiv.setAttribute(\"aria-level\", task.$level + 1 || 1);\r\n\r\n\t\t\tif(gantt.hasChild(task.id)){\r\n\t\t\t\tdiv.setAttribute(\"aria-expanded\", task.$open ? \"true\" : \"false\");\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tlinkAttr: function(link, div){\r\n\r\n\t\t\tvar linkTypes = gantt.config.links;\r\n\r\n\t\t\tvar toStart = link.type == linkTypes.finish_to_start || link.type == linkTypes.start_to_start;\r\n\t\t\tvar fromStart = link.type == linkTypes.start_to_start || link.type == linkTypes.start_to_finish;\r\n\r\n\t\t\tvar content = gantt.locale.labels.link + \" \" +  gantt.templates.drag_link(link.source, fromStart, link.target, toStart);\r\n\r\n\t\t\t// links are complex elements that should be treated as a single element\r\n\t\t\tdiv.setAttribute(\"role\", \"img\");\r\n\r\n\t\t\tdiv.setAttribute(\"aria-label\", stripHTMLLite(content));\r\n\t\t},\r\n\r\n\t\tgridSeparatorAttr: function(div){\r\n\t\t\t// the only valid role for the grid header\r\n\t\t\tdiv.setAttribute(\"role\", \"columnheader\");\r\n\t\t},\r\n\t\trowResizerAttr: function(div){\r\n\t\t\t// the only valid role for the grid header\r\n\t\t\tdiv.setAttribute(\"role\", \"row\");\r\n\t\t},\r\n\r\n\t\tlightboxHiddenAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"aria-hidden\", \"true\");\r\n\t\t},\r\n\r\n\t\tlightboxVisibleAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"aria-hidden\", \"false\");\r\n\t\t},\r\n\r\n\t\tlightboxAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"role\", \"dialog\");\r\n\t\t\tdiv.setAttribute(\"aria-hidden\", \"true\");\r\n\t\t\tdiv.firstChild.setAttribute(\"role\", \"heading\");\r\n\t\t\tdiv.firstChild.setAttribute(\"aria-level\", \"1\");\r\n\t\t},\r\n\r\n\t\tlightboxButtonAttrString:function(buttonName){\r\n\t\t\treturn this.getAttributeString({\"role\":\"button\", \"aria-label\":gantt.locale.labels[buttonName], \"tabindex\":\"0\"});\r\n\t\t},\r\n\r\n\t\tlightboxHeader: function(div, headerText){\r\n\t\t\tdiv.setAttribute(\"aria-label\", headerText);\r\n\t\t},\r\n\r\n\t\tlightboxSelectAttrString: function(time_option){\r\n\t\t\tvar label = \"\";\r\n\r\n\t\t\tswitch (time_option) {\r\n\t\t\t\tcase \"%Y\":\r\n\t\t\t\t\tlabel = gantt.locale.labels.years;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%m\":\r\n\t\t\t\t\tlabel = gantt.locale.labels.months;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%d\":\r\n\t\t\t\t\tlabel = gantt.locale.labels.days;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%H:%i\":\r\n\t\t\t\t\tlabel = gantt.locale.labels.hours + gantt.locale.labels.minutes;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\treturn gantt._waiAria.getAttributeString({\"aria-label\": label});\r\n\t\t},\r\n\r\n\t\tlightboxDurationInputAttrString: function(section){\r\n\t\t\treturn this.getAttributeString({\r\n\t\t\t\t\"aria-label\": gantt.locale.labels.column_duration,\r\n\t\t\t\t\"aria-valuemin\": \"0\",\r\n\t\t\t\t\"role\": \"spinbutton\"\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tinlineEditorAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"role\", \"row\");\r\n\t\t},\r\n\r\n\t\tgridAttrString: function(){\r\n\t\t\treturn [\" role='treegrid'\", gantt.config.multiselect ? \"aria-multiselectable='true'\" : \"aria-multiselectable='false'\", \" \"].join(\" \");\r\n\t\t},\r\n\r\n\r\n\t\tgridScaleRowAttrString: function(){\r\n\t\t\treturn \"role='row'\";\r\n\t\t},\r\n\r\n\t\tgridScaleCellAttrString: function(column, label){\r\n\t\t\tvar attrs = \"\";\r\n\t\t\tif(column.name == \"add\"){\r\n\t\t\t\t// a more precise role is button, but it is not valid for the grid header\r\n\t\t\t\tattrs = this.getAttributeString({\"role\":\"columnheader\", \"aria-label\": gantt.locale.labels.new_task});\r\n\t\t\t}else{\r\n\r\n\t\t\t\tvar attributes = {\r\n\t\t\t\t\t\"role\":\"columnheader\",\r\n\t\t\t\t\t\"aria-label\": gantt.config.external_render && gantt.config.external_render.isElement(label) ? \"\" : label\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(gantt._sort && gantt._sort.name == column.name){\r\n\t\t\t\t\tif(gantt._sort.direction == \"asc\"){\r\n\t\t\t\t\t\tattributes[\"aria-sort\"] = \"ascending\";\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tattributes[\"aria-sort\"] = \"descending\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tattrs = this.getAttributeString(attributes);\r\n\t\t\t}\r\n\t\t\treturn attrs;\r\n\t\t},\r\n\r\n\t\tgridDataAttrString: function(){\r\n\t\t\treturn \"role='rowgroup'\";\r\n\t\t},\r\n\r\n\t\treorderMarkerAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"role\", \"grid\");\r\n\t\t\tdiv.firstChild.removeAttribute(\"aria-level\");\r\n\t\t\tdiv.firstChild.setAttribute(\"aria-grabbed\", \"true\");\r\n\t\t},\r\n\r\n\t\tgridCellAttrString: function(column, textValue, task){\r\n\t\t\tvar attributes = {\"role\":\"gridcell\", \"aria-label\": textValue};\r\n\t\t\tif(!column.editor || gantt.isReadonly(task)){\r\n\t\t\t\tattributes[\"aria-readonly\"] = true;\r\n\t\t\t}\r\n\r\n\t\t\treturn this.getAttributeString(attributes);\r\n\t\t},\r\n\r\n\t\tgridAddButtonAttrString: function(column){\r\n\t\t\treturn this.getAttributeString({\"role\":\"button\", \"aria-label\": gantt.locale.labels.new_task});\r\n\t\t},\r\n\r\n\t\tmessageButtonAttrString: function(buttonLabel){\r\n\t\t\treturn \"tabindex='0' role='button' aria-label='\"+buttonLabel+\"'\";\r\n\t\t},\r\n\r\n\t\tmessageInfoAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"role\", \"alert\");\r\n\t\t\t//div.setAttribute(\"tabindex\", \"-1\");\r\n\t\t},\r\n\r\n\t\tmessageModalAttr: function(div, uid){\r\n\t\t\tdiv.setAttribute(\"role\", \"dialog\");\r\n\t\t\tif(uid){\r\n\t\t\t\tdiv.setAttribute(\"aria-labelledby\", uid);\r\n\t\t\t}\r\n\r\n\t\t//\tdiv.setAttribute(\"tabindex\", \"-1\");\r\n\t\t},\r\n\r\n\t\tquickInfoAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"role\", \"dialog\");\r\n\t\t},\r\n\r\n\t\tquickInfoHeaderAttrString: function(){\r\n\t\t\treturn \" role='heading' aria-level='1' \";\r\n\t\t},\r\n\r\n\t\tquickInfoHeader: function(div, header){\r\n\t\t\tdiv.setAttribute(\"aria-label\", header);\r\n\t\t},\r\n\r\n\t\tquickInfoButtonAttrString: function(label){\r\n\t\t\treturn gantt._waiAria.getAttributeString({\"role\":\"button\", \"aria-label\":label, \"tabindex\":\"0\"});\r\n\t\t},\r\n\r\n\t\ttooltipAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"role\", \"tooltip\");\r\n\t\t},\r\n\r\n\t\ttooltipVisibleAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"aria-hidden\", \"false\");\r\n\t\t},\r\n\r\n\t\ttooltipHiddenAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"aria-hidden\", \"true\");\r\n\t\t}\r\n\t};\r\n\r\n\tfunction isDisabled(){\r\n\t\treturn !gantt.config.wai_aria_attributes;\r\n\t}\r\n\r\n\tfor(var i in gantt._waiAria){\r\n\t\tgantt._waiAria[i] = (function(payload){\r\n\t\t\treturn function(){\r\n\t\t\t\tif(isDisabled()){\r\n\t\t\t\t\treturn \"\";\r\n\t\t\t\t}\r\n\t\t\t\treturn payload.apply(this, arguments);\r\n\t\t\t};\r\n\t\t})(gantt._waiAria[i]);\r\n\t}\r\n\r\n\r\n};","import extensions from \"./ext/extensions_gpl\";\r\nimport base from \"./factory/make_instance_web\";\r\nimport scope from \"./utils/global\";\r\nconst gantt = (scope as any).gantt = base(extensions);\r\n\r\nexport default gantt;\r\nexport { gantt };","import \"../css/dhtmlxgantt.less\";\r\n\r\nimport factory from \"./make_instance_common\";\r\nimport ui from \"../core/ui_core\";\r\nimport ajaxLoading from \"../core/loading/ajax_loading\";\r\nimport dynamicLoading from \"../core/loading/dynamic_loading\";\r\n\r\nexport default function(supportedExtensions) {\r\n\tvar gantt = factory(supportedExtensions);\r\n\r\n\tif(!gantt.env.isNode){\r\n\t\tui(gantt);\r\n\t\tajaxLoading(gantt);\r\n\t\tdynamicLoading(gantt);\r\n\t}\r\n\r\n\treturn gantt;\r\n};","export default function(gantt) {\r\n\tgantt.load = function (url, type, callback) {\r\n\t\tthis._load_url = url;\r\n\t\tthis.assert(arguments.length, \"Invalid load arguments\");\r\n\r\n\t\tvar tp = 'json', cl = null;\r\n\t\tif (arguments.length >= 3) {\r\n\t\t\ttp = type;\r\n\t\t\tcl = callback;\r\n\t\t} else {\r\n\t\t\tif (typeof arguments[1] == \"string\")\r\n\t\t\t\ttp = arguments[1];\r\n\t\t\telse if (typeof arguments[1] == \"function\")\r\n\t\t\t\tcl = arguments[1];\r\n\t\t}\r\n\r\n\t\tthis._load_type = tp;\r\n\r\n\t\tthis.callEvent(\"onLoadStart\", [url, tp]);\r\n\r\n\t\treturn this.ajax.get(url, gantt.bind(function (l) {\r\n\t\t\tthis.on_load(l, tp);\r\n\t\t\tthis.callEvent(\"onLoadEnd\", [url, tp]);\r\n\t\t\tif (typeof cl == \"function\")\r\n\t\t\t\tcl.call(this);\r\n\t\t}, this));\r\n\t};\r\n};"],"names":["getNodePosition","elem","top","left","right","bottom","getBoundingClientRect","box","body","document","docElem","documentElement","parentNode","scrollTop","window","pageYOffset","scrollLeft","pageXOffset","clientTop","clientLeft","offsetWidth","offsetHeight","parseInt","offsetTop","offsetLeft","offsetParent","y","Math","round","x","width","height","isVisible","node","display","visibility","getComputedStyle","style","currentStyle","hasNonNegativeTabIndex","isNaN","getAttribute","hasHref","a","area","nodeName","loLowerCase","isEnabled","input","select","textarea","button","object","toLowerCase","hasAttribute","getFocusableNodes","root","nodes","querySelectorAll","join","nodesArray","Array","prototype","slice","call","i","length","$position","sort","b","tabIndex","splice","getScrollSize","div","createElement","cssText","appendChild","clientWidth","removeChild","max","getClassName","className","baseVal","indexOf","_trimString","addClassName","removeClassName","name","split","regEx","RegExp","replace","toNode","getElementById","querySelector","_slave","insertNode","newone","innerHTML","child","firstChild","removeNode","getChildNodes","css","ch","childNodes","len","out","obj","push","getTargetNode","e","trg","tagName","event","target","srcElement","shadowRoot","composedPath","locateAttribute","attribute","host","str","String","trim","this","apply","locateClassName","classname","strict","undefined","ind","charAt","getRelativeEventPosition","ev","d","clientX","clientY","touches","getRelativeNodePosition","parent","childPos","parentPos","isChildOf","closest","element","selector","matches","msMatchesSelector","webkitMatchesSelector","el","contains","parentElement","nodeType","console","error","getClosestSizedElement","isShadowDomSupported","head","createShadowRoot","attachShadow","getActiveElement","activeElement","getSelection","focusNode","getRootNode","ShadowRoot","classList","test","scope","global","EventsManager$1","gantt","_mouseDown","_touchStarts","_touchActive","_longTapTimer","_gantt","_domEvents","_createDomEventScope","selectedRegion","useKey","ignore","_target","getViewPort","_originPosition","_restoreOriginPosition","position","state","$services","getService","registerProvider","autoscroll","scheduledDndCoordinates","startDragAndDrop","setStart","copy","setPosition","setEnd","attach","startDrag","eventElement","domHelpers.getRootNode","$root","getTouchEvent","changedTouches","stopDrag","dragMove","setTimeout","config","touch_drag","clearTimeout","filterTargets","getFilterTargets","utils","dom","preventDefault","_getCoordinates","coordinates","dragEnd","dragTimeline","ext","clickDrag","dragTimelineUseKey","drag_timeline","abs","relative","render","detachAll","unregisterProvider","detach","viewPort","viewPortBounds","absolute","EventHost","_silent_mode","listeners","_silentStart","_silentEnd","makeEventable","eventHost","attachEvent","eventName","handler","settings","handlers","index","eventStorage","combinedResult","handlerResult","arguments","addEvent","t","handlerId","id","once","originalHandler","removeEvent","clear","thisObject","bind","attachAll","callback","callEvent","eventArguments","handlerName","concat","checkEvent","detachEvent","list","eventId","detachAllEvents","units","second","minute","hour","day","week","month","quarter","year","getSecondsInUnit","unit","forEach","arr","workArray","arrayFind","find","arrayIncludes","item","includes","isArray","pop","isDate","getFullYear","getMonth","getDate","isValidDate","getTime","delay","timeout","timer","result","$cancelTimeout","$pending","args","$execute","replaceValidZeroId","rootId","checkZeroId","findBinary","array","prev","low","high","floor","SelectedRegion","view","_el","defaultRender","start","end","min","_singleRow","pos","_getTaskPositionByTop","_startPoint","_view","_viewPort","add","_callback","_endPoint","draw","eventable","singleRow","_useRequestAnimationFrame","useRequestAnimationFrame","requestAnimationFrame","getElement","startPoint","_startDate","dateFromPos","endPoint","_endDate","_positionPoint","positionPoint","getState","max_date","valueOf","tasksByTime","getTaskByTime","tasksByIndex","_getTasksByTop","getInBounds","startValue","endValue","startIndex","endIndex","getTaskByIndex","getItemIndexByTopPosition","task","getItemHeight","getItemTop","dataHeight","getTotalHeight","row_height","getTaskCount","_dragInProgress","EventsManager","_calculateDirectionVector","_trace","dots","vectors","resultVector","vector","magnitude","sqrt","angleDegrees","atan2","PI","_applyDndReadyStyles","_timeline","$task","_clearDndReadyStyles","remove","_getScrollPosition","timeline","$ui","getView","$config","scrollX","getScrollState","scrollY","_countNewScrollPosition","coords","shiftX","shiftY","_scrollState","_setScrollPosition","scrollLayoutCell","$id","_stopDrag","_originalReadonly","readonly","_originAutoscroll","_startDrag","create","destructor","enabled","clickDragUseKey","click_drag","scrollPosition","seed","plainObjectConstructor","constructor","toString","helpers.isDate","Date","helpers.isArray","Object","$$typeof","hasOwnProperty","mixin","source","force","f","defined","uid","functor","capture","addEventListener","eventRemove","removeEventListener","ScaleHelper","dateHelper","date","getSum","sizes","from","to","summ","setSumWidth","sum_width","scale","parts","diff","adjustSize","full_width","splitSize","count","full","share","sortScales","scales","cellSize","step","_prepareScaleObject","format","template","date_to_str","projection","column_width","primaryScale","templates","scale_cell_class","getAdditionalScales","map","prepareConfigs","min_coll_width","container_width","scale_height","minDate","maxDate","rtl","heights","configs","main_scale","cfg","initScaleConfig","processIgnores","display_count","initColSizes","limitVisibleRange","unshift","alineScaleColumns","reverseScale","setPosSettings","reverse","trace_x","indexes","trace_indexes","trace_index_transition","_ignore_time_config","skip_off_time","skip","probe","isWorkTime","ignore_x","min_col_width","line_height","cont_width","column_count","fixedMode","baseCellWidth","col_width","ignores","min_date","utils.mixin","eachColumn","trace_x_ascending","iterateScales","lower_scale","upper_scale","upper_dates","lower_dates","prevUpper","up","target_index","upper_start","upper_end","lower_start","lower_end","targetWidth","curr","tzOffset","getTimezoneOffset","_correct_dst_change","dates","last","lastDate","outDate","shared","modals","modalsStack","isModal","afterPopup","$destroyed","focus","startModal","trapFocus","endModal","currentTarget","$keyboardNavigation","traceLightbox","getLightbox","focusElement","QuickInfo","show","_showForTask","_showAtCoordinates","hide","forced","qi","_quickInfoBox","_quickInfoBoxId","taskId","_quickInfoTask","quick_info_detached","getNode","setContainer","container","_container","setContent","content","defaultContent","header","title","buttons","quickinfo_buttons","_createQuickInfoElement","titleBox","titleContent","titleDate","main","controls","_waiAria","quickInfoHeader","html","ariaAttr","quickInfoButtonAttrString","locale","labels","_qiButtonClickHandler","_qiKeyPressHandler","_qi_button_click","code","which","_appendAtCoordinates","show_quick_info","_getContainer","_get_event_counter_part","xViewport","yViewport","_init_quick_info","_prepare_quick_info_classname","_fill_quick_data","_show_quick_info","offset","domEv","getTaskNode","getTaskRowNode","scroll","dx","dy","quickInfoAttr","quickInfoHeaderAttrString","getTask","_quickInfoReadonly","isReadonly","getTaskType","quick_info_class","start_date","end_date","allowedButtons","isEditor","icon_delete","icon_edit","quick_info_title","quick_info_date","quick_info_content","popupHeight","scrolls","screenWidth","relativePopupBottom","mask","$click","$task_data","$grid_data","$grid","$layout","createScope","utils.event","utils.eventRemove","eventScope","staticArray","extend","Tooltip","_tooltipNode","tooltipAttr","_root","domHelpers.isChildOf","_isLikeMouseEvent","_calculateTooltipPosition","tooltipVisibleAttr","tooltipHiddenAttr","viewport","_getViewPortSize","tooltipNode","tooltip","offsetX","tooltip_offset_x","offsetY","tooltip_offset_y","mouse","domHelpers.getRelativeEventPosition","containerPos","domHelpers.getNodePosition","_getViewPort","TooltipManager","_listeners","domEventsScope","_initDelayedFunctions","delayHide","watchableTarget","eventTarget","domHelpers.getTargetNode","targetNode","domHelpers.closest","doOnMouseEnter","onmouseenter","onmousemove","onmouseleave","listener","cloneDomEvent","clone","createEvent","delayShow","helpers.delay","tooltip_timeout","tooltip_hide_timeout","noTrack","onBeforeUndo","onBeforeRedo","batchActions","Monitor","undo","_batchAction","_batchMode","_ignore","_ignoreMoveEvents","_initialTasks","_initialLinks","_nestedTasks","_nestedLinks","_undo","_attachEvents","type","overwrite","undo_types","_storeTask","link","_storeLink","isMoveEventsIgnored","newValue","startIgnore","stopIgnore","_timeout","stopBatchAction","action","logAction","_storeTaskCommand","command","update","$local_index","getTaskIndex","_storeEntityCommand","getInitialTask","move","entity","children","childrenLinks","_storeLinkCommand","taskIds","tasks","linkIds","_getLinks","setInitialTask","uniqueLinks","links","setInitialLink","$index","getGlobalTaskIndex","setInitialTaskObject","getLink","deleteCacheCooldown","saveInitialAll","clearInitialTasks","eachTask","clearInitialLinks","getLinks","getMoveObjectByTaskId","startBatchAction","clearUndoStack","clearRedoStack","onTaskAdded","onTaskUpdated","onTaskDeleted","onLinkAdded","onLinkUpdated","onLinkDeleted","onTaskMoved","toggleIgnoreMoveEvents","store","nested","setNestedTasks","datastore","getDatastore","tindex","dragId","projectDrag","drag_id","isSummaryTask","drag_project","plugins","multiselect","selectedIds","getSelectedTasks","inlineEditors","onBeforeEditStartId","onEditStart","$data","tempAssignmentsStore","_lightbox_id","updateConfigs","undoEnabled","commands","old","actionType","entityType","_storeCommand","isTaskExists","getInitialLink","$source","$target","linkId","Undo","maxSteps","redoEnabled","invert","revert","value","oldValue","inverseCommands","types","assert","_undoStack","_redoStack","stack","getRedoStack","undo_steps","undo_actions","redo","_pop","_reorderCommands","_applyAction","_push","shift","weights","any","actionWeights","weightA","entities","actions","methods","get","isExists","batchUpdate","method","getMethod","check","prop","copyProperty","startsWith","extensions","defaultConfig","setClickDrag","$container","_isDragInProgress","fullscreen","isExpanded","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","isFullscreenAvailable","fullscreenEnabled","webkitFullscreenEnabled","mozFullScreenEnabled","msFullscreenEnabled","backupBodyPadding","overflow","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","backupElementSizes","zIndex","modified","backupPositioning","updateSizes","expandGantt","onFullScreenChange","getFullscreenElement","positions","originalPositioning","setFullScreenSizes","record","cantFullscreen","warning","log","expand","requestArguments","webkitRequestFullscreen","Element","ALLOW_KEYBOARD_INPUT","requestFullscreen","msRequestFullscreen","mozRequestFullScreen","requestExitFullscreen","msExitFullscreen","mozCancelFullScreen","webkitExitFullscreen","exitFullscreen","toggle","collapse","keyboard_navigation","keyboard_navigation_cells","_compose","res","p","shortcuts","createCommand","modifiers","alt","ctrl","meta","keyCode","parse","shortcut","expr","getExpressions","words","getWords","j","commandKeys","specialKeys","charCodeAt","getCommandFromEvent","domEvent","shiftKey","altKey","ctrlKey","metaKey","printableKey","fromCharCode","getHashFromEvent","getHash","junctionChar","term","combinationChar","backspace","tab","enter","esc","space","down","home","pageup","pagedown","delete","insert","plus","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","EventHandler","_handlers","findHandler","hash","doAction","facade","returnValue","unbind","bindAll","initKeys","keys","domHelpers.getFocusableNodes","focusable","currentFocus","domHelpers.getActiveElement","currentIndex","lastItem","firstItem","GanttNode","blur","scrollHorizontal","dir","getScale","scrollTo","posFromDate","scrollVertical","KeyNavNode","isValid","fallback","moveTo","dispatcher","setActiveNode","compareTo","canStringifyThis","canStringifyThat","eventFacade","setAttribute","$eventAttached","HeaderCell","show_grid","getVisibleTaskCount","getGridColumns","TaskRow","visibleColumns","fromDomElement","cellElement","domHelpers.locateClassName","previousSibling","$grid_scale","columns","taskRow","rootLevel","getChildren","root_id","TaskCell","click","createTask","globalIndex","splitItem","$split_subtask","parentId","getParent","nextIndex","locate","isTaskVisible","task_attribute","replaceAll","keptFocus","getTaskPosition","getTaskHeight","viewWidth","viewHeight","inner_width","inner_height","visibleTimeline","show_chart","scroll_on_click","task_scroll_offset","grid","scrollPositionX","scrollPositionY","attachedScrollbarHorizontal","scrollable","scrollbarHorizontal","attachedScrollbarVertical","scrollbarVertical","nextElement","prevTask","getPrev","nextTask","getNext","hasChild","$open","open","close","prevId","getPrevSibling","moveTask","updateTask","isSelectedTask","unselectTask","selectTask","showLightbox","columnIndex","domHelpers.locateAttribute","show_tasks_outside_timescale","row","isActive","activeNode","globalNode","enable","getActiveNode","disable","getDefaultNode","setDefaultNode","inputs","focusGlobalNode","blurNode","focusChanged","keyDownHandler","defaultPrevented","ganttNode","awaitsFocus","clearDelay","isTaskFocused","isInlineEditorCell","isNoKeyboardNavigationElement","focusHandler","$preventDefault","reFocusActiveNode","outsideGantt","localName","domElement","mousedownHandler","locateTask","taskBar","gridLeft","gridRight","nodePosition","rightPosition","positionX","column","removeAttribute","onReady","tasksStore","currentNode","gridDataTopScroll","gridDataBottomScroll","_smart_render","updateRender","_redrawTasks","renderers","items","focusedItemVisible","createdTaskId","keepFocusOnNewTask","placeholder","nodeConstructor","placeholder_task","focusOnCreate","oldId","newId","interval","setInterval","getScope","mode","scopes","headerCell","taskCell","findVisibleColumnIndex","columnName","clearInterval","keyNavFacade","addShortcut","scopeObject","getShortcutHandler","getCommandHandler","removeShortcut","keyboardNavigation","quick_info","quickInfo","text","substr","details","task_time","addButton","collapseButton","expandButton","events","hidingFunction","clearQuickInfo","hideQuickInfo","showQuickInfo","tooltipManager","tooltips","tooltipFor","touch","touch_tooltip","targetTaskId","tooltip_text","hideTooltip","link_source_id","monitor","isEqualIds","first","updTask","changeTaskCommandId","updLink","oldTaskId","newTaskId","changeLinkCommandId","updateTasksIds","entry","updateLinksIds","getUndoStack","setUndoStack","setRedoStack","saveState","getInitialState","marker","render_marker","show_markers","marker_class","markerHeight","getRowTop","timeline_placeholder","scrollHeight","external_render","isElement","renderElement","initMarkerArea","$marker_area","markerArea","_markers","createDatastore","initItem","renderMarkers","createDataRender","defaultContainer","addLayer","getMarker","getItem","addMarker","addItem","deleteMarker","exists","removeItem","updateMarker","refresh","_getMarkers","getItems","multiselect_one_level","_multiselect","_selected","_one_level","_active","_first_selected_when_shift","getDefaultSelected","selected","getSelected","setFirstSelected","getFirstSelected","updateState","active","select_task","reset","setLastSelected","silent","unselect","getLastSelected","getSelectedId","afterSelect","isSelected","forSelected","isSameLevel","calculateTaskLevel","_quickRefresh","refreshTask","doSelection","_is_icon_open_click","target_ev","defaultLast","isLast","multiSelect","singleSelection","controller","cell","locateCell","inline_editors_multiselect_open","getEditorConfig","startEdit","blockSelection","first_indx","target_indx","last_indx","tmp","old_selectTask","old_unselectTask","toggleTaskSelection","eachSelectedTask","getLastSelectedTask","old_isSelected","new_id","task_id","oldSelectedId","oldSelectedTask","newSelectedTask","differentTreeLevel","$level","export_api","_apiUrl","previousDateRage","str_to_date","date_format","data","_serializeHtml","_prepareConfigPDF","_serializeAll","_fixColumns","raw","_preparePDFConfigRaw","version","_sendToExport","_pdfExportRouter","_serializePlain","smartRendering","smart_rendering","visual","convert","_eachTaskTimed","_serializeTimeline","_serializeGrid","rawDates","_serializeScales","worktime","_getWorktimeSettings","formData","File","FormData","append","_sendImportAjaxExcel","_sendImportAjaxMSP","importFromPrimaveraP6","importFromMSProject","skip_circular_links","oldXmlFormat","xml_format","oldFormatDate","format_date","oldXmlDate","xml_date","oldDateFormat","exportServiceDateFormat","_customProjectProperties","_customTaskProperties","_clearRecLinks","_exportConfig","$custom_data","custom","exportToPrimaveraP6","exportToMSProject","label","url","pack","cb","ajax","post","base","$template","server","JSON","stringify","sheet","xhr","XMLHttpRequest","onreadystatechange","readyState","status","onload","info","responseText","setRequestHeader","send","encodeURIComponent","_xdr","loader","xdoc","xmlDoc","col","editor","editor_types","skin","_serializableGanttConfig","_markColumns","_ajaxToExport","form","_createHiddenForm","submit","_hidden_export_form","constraint_date","deadline","key","formatDate","_color_box","_color_hash","color","_getColor","backgroundColor","parsedRanges","minutes","range","startMinute","endMinute","defaultWorkTimes","hours","time","work_time","wTime","_working_time_helper","get_calendar","worktimes","parsed","_getMinutesWorktimeSettings","master","branch","_pull","_originalCopyObject","json","_copyObject","task_text","_copyObjectBase","serializeTask","rgb","match","toISOstring","_copyObjectColumns","_copyObjectPlainExcel","original_start_date","original_end_date","calculateEndDate","duration","_generatedScales","_generateScales","scaleHelper","helper","ignore_time","ignored_colls","getSubScales","scalesConfig","min_column_width","days","helpers.findBinary","_copyObjectTable","startDate","endDate","getDayIndex","columnIndexByDate","allScales","$start","_getDayIndex","$end","hiddenCells","scaleCellsWidth","$type","$rendered_type","tmps","$text","$left","leftside_text","$right","rightside_text","$color","cellCss","task_class","styles","_getStyles","ct","val","date_grid","smartScales","smart_scales","_copyObjectAll","_exportSerialize","_copyObjectPlainICal","availWidth","autosize","autosize_min_width","_getScales","minWidth","$scaleHelper","_getRaw","custom_dataset","serialize","childBar","_copyObjectColors","split_bars","skippedTasks","sibling","overlap","cover","filteredIds","visibleOrder","filteredDataset","cellColors","timeline_cell_class","task_cell_class","steps","Infinity","scaleCell","scaleCell_class","scaleCss","exportMode","cols","ccount","tree","xmlFormat","_lvl","_setLevel","_makeLinksSameLevel","skippedLinks","_clearCircDependencies","_clearLinksSameLevel","_clearLevel","usedTasks","prevLink","sources","$_source","_onCircDependencyFind","targets","curLink","targetTask","_source","targetLvl","linkT","sourceParent","targetParent","$_target","project","projectName","projectDates","getSubtaskDates","start_end","manual","_getAutoSchedulingConfig","durationUnit","projectProperties","taskProperties","resourceProperties","exportToPDF","exportToPNG","exportToICal","exportToExcel","exportToJSON","importFromExcel","constants","KEY_CODES","UP","DOWN","LEFT","RIGHT","SPACE","ENTER","DELETE","ESC","TAB","ExtensionsManager","addExtension","_extensions","getExtension","isWindowAwailable","nav","navigator","userAgent","env","isIE","isOpera","isChrome","isSafari","isFF","isIPad","search","isEdge","isNode","isSalesforce","serialized","createConfig","Error","async","headers","fastVersion","utc","dateToStrFn","Function","to_fixed","getISOWeek","getWeek","splt","strToDateFn","dateString","cspVersion","getUTCDate","getUTCMonth","getUTCFullYear","day_short","getUTCDay","getDay","day_full","month_short","month_full","getUTCHours","getHours","getUTCMinutes","getMinutes","getUTCSeconds","getSeconds","getUTCISOWeek","set","temp","month_short_hash","month_full_hash","UTC","canUseCsp","useCsp","csp","init","s","date_part","setHours","hour_start","setTime","time_part","week_start","start_on_monday","month_start","setDate","quarter_start","res_month","m","setMonth","year_start","day_start","setMinutes","minute_start","setSeconds","getMilliseconds","setMilliseconds","_add_days","modifiedDate","inc","originalDate","incCondition","getHoursCondition","getDateCondition","ndate","setYear","add_quarter","num","cspCompliantVersion","_getWeekNumber","isoWeek","nday","first_thursday","year_number","ordinal_date","convert_to_utc","parseDate","parse_date","token","_url","_token","_mode","_seed","_queue","api","_events","Accept","credentials","fetch","then","websocket","_wrapper","connect","_socket","onclose","n","location","protocol","o","r","WebSocket","onmessage","fire","onError","_send","_resubscribe","Promise","_uid","resolve","reject","onCall","filter","catch","onResponse","remoteEvents","remote","remote_client.Client","req","_ready","load","back","_remote","ready","on","checkTimeout","updPerSecond","_on_timeout","ceil","StateService","stateProviders","internal","provider","Promise$1","$powerArray","$create","$removeAt","$remove","$find","$insertAt","$each","$map","$filter","isPlaceholderTask","DataStore","pull","$initItem","powerArray","fullOrder","_skip_refresh","_filterRule","_searchVisibleOrder","_indexRangeCache","_getItemsCache","_attachDataChange","_parseInner","loaded","copyOnParse","utils.copy","isSilent","_updateOrder","updateItem","utils.defined","_removeItemInner","_addItemInner","order","data_size","getVisibleItems","getIndexRange","utils.uid","sync_link","_changeIdInner","changeId","_moveInner","sindex","getIdByIndex","clearAll","alreadySilent","arraysEqual","arr1","arr2","quick","skipFilter","_quick_refresh","_mark_recompute","oldOrder","countVisible","eachItem","rule","filteredOrder","placeholderIds","_ganttConfig","cacheKey","ret","getIndexById","_getNullIfUndefined","getFirst","getLast","SplitTasksHelper","_datastore","isSplitItem","isSubrowSplitItem","split_placement","isDefaultSplitItem","isInlineSplitItem","TreeDataStore","_branches","_splitTaskHelper","loadedItem","existingItem","$parentProperty","parentProperty","$getRootId","$openInitially","openInitially","_eachItemMainRangeCache","getConfig","splitParents","splitItems","taskOpenState","taskVisibility","haveSplitItems","_isSplitItem","_isDefaultItem","_isInlineChildItem","canOpenSplitTasks","open_split_tasks","_isSplitChildItem","$expanded_branch","isHeadless","_buildTree","setParent","_add_branch","calculateItemLevel","getBranchIndex","targetIndex","_move_branch","$rendered_parent","_replace_branch_child","_traverseBranches","itemId","sid","source_pid","tbranch","siblings","getSiblings","tid","childId","pid","getNextSibling","nextSibling","level","eachParent","_setParentInner","new_pid","_eachItemCached","cache","_eachItemIterate","startId","itemsStack","useCache","buildCache","startItem","parentsHash","old_parent","new_parent","old_id","newbranch","field","desc","criteria","original_criteria","els","renderedParent","actualParent","_skipTaskRecalculation","datastoreRender","itemRepainter","renderer","renders","getLayers","render_item","allData","loadedRanges","layer","layerData","get_visible_range","ids","prepare_data","render_items","update_items","extraDataArr","skipRepaint","batch_update","getDataRender","onUpdateRequest","change_id","getDatastores","storeNames","facadeFactory","$StoreType","self","open_tree_initially","deepcopy_on_parse","selectedId","deleteItem","subItem","storeAccessName","dropService","storeList","setService","_getDatastores","refreshData","scrollState","stores","preserve_scroll","getScrollbarsInfo","scroll_info","scrollbarNodeVisible","$view","boundViews","viewName","refresh_links","refreshLinks","refreshLink","_bulk_dnd","hasSplitParent","isSplitTask","linksStore","_update_flags","userdata","_clear_data","oldSelectId","_skipResourceRepaint","addTask","lightbox","parentObj","deleteTask","utils.bind","startTask","changeTaskId","oldid","newid","getLinkCount","isLinkExists","addLink","updateLink","deleteLink","changeLinkId","_init_tasks_range","PrimaryScaleHelper","scale_offset_minimal","start_interval","onlyProjectTasks","duration_unit","deadlines","extendRangeForDates","constraint_type","apply_constraints","constraint_types","ASAP","ALAP","baselines","baseline","_min_date","_max_date","updateTasksRange","fit_tasks","old_min","old_max","copyLinkIdsArray","targetHash","copyLinkIds","treeHelper","getSubtreeLinks","getSubtreeTasks","DataProcessorEvents","dp","$gantt","$dp","_dataProcessorHandlers","cascadeDelete","clientSideDelete","setGanttMode","setUpdated","_sendTaskOrder","cascade_delete","deleteAfterConfirmation","needDbDelete","needCascadeDelete","dpMode","updateMode","setUpdateMode","cascade","storeItem","sendAllData","_tSend","_waitMode","itemLinks","_links","_dp","_tMode","_serverProcessor","_ganttMode","substring","serverProcessor","pluralizedMode","urlSeparator","upd","xml","_xmlNodeToJSON","isExist","objData","property","assignmentsStore","handleResourceCRUD","handleResourceAssignmentCRUD","handleBaselineCRUD","updated","updatedRows","clientOnly","getUserData","_in_progress","resources","dataprocessor_assignments","resource_assignment_store","insertedTasks","pendingAssignments","insertResourceAssignment","assignment","dataprocessor_resources","resourcesStore","resource_store","resource","dataprocessor_baselines","baselineStore","helpers.forEach","SimpleStorage","_storage","getStoredItem","_Gt","DataProcessor$1","serverProcessorURL","action_param","autoUpdate","_headers","_payload","_postDelim","_routerParametersFormat","_invalid","messages","inserted","deleted","invalid","invalid_cell","enableUTFencoding","total","payload","_serializeAsJson","_router","router","_utf","escape","getSyncState","dnd","rowId","findRow","existing","set_invalid","setUserData","is_invalid","markRow","sendData","_methods","editStop","pendingUpdateModes","modes","checkBeforeUpdate","_beforeSendData","_getRowData","_serializeAsJSON","serialize_one","security_key","pref","valid","_forEachUpdatedRow","_sendData","_getAllData","pattern","_uActions","btag","ganttMode","correct","originalSid","that","_xml","getGanttMode","reqUrl","filePath","tag","processCallback","afterUpdateCallback","finalizeUpdate","xmltop","cleanUpdate","atag","xpath","_initialized","_dp_init","_setDefaultTransactionMode","delete_confirmation","_change_id","_row_style","$dataprocessor_class","_delete_task","$drop_target","setDp","dataProcessorEvents","user","_user","_needUpdate","_updateBusy","afterAutoUpdate","fullSync","loadUpdate","xml_node","getUpdates","vers","_getXmlNodeValue","updates","newState","dataToSend","processedData","_cleanupArgumentsBeforeSend","_cleanupItemBeforeSend","updatedItem","output","taskState","taskAction","getActionByState","_onResolvedCreateUpdate","actionPromise","errorMsgStart","errorMsgEnd","queryParams","afterUpdate","dhxVersion","urlParams","_applyPayload","preprocessedData","query","setTransactionMode","nodeValue","hasOne","traversedObjects","_prepareDate","helpers.arrayIncludes","_prepareArray","_prepareObject","rawItem","processedItem","dataItem","_prepareDataItem","DataProcessor","DataProcessor.DataProcessor","tMode","createMethod","disableMethod","methodName","dummyMethod","restoreMethod","disableMethods","methodsHash","restoreMethods","batchUpdatePayload","noRedraw","dp_mode","call_dp","resetProjects","resetProjectDates","wbs","_needRecalc","_isRecalcNeeded","_isGroupSort","_getWBSCode","_calcWBS","$virtual","$wbs","_setWBSCode","getWBSCode","getByWBSCode","_isFirst","_prevSibling","_getPrevNonPlaceholderSibling","_increaseWBS","_parent","siblingiId","_wbs","prevSibling","currentId","resetCache","getTaskByWBSCode","createResourceMethods","resourceTaskCache","singleResourceCacheBuilt","falsyValuePrefix","random","resourceHashFunction","getCacheKey","resourceIds","typeFilter","getResourceTasks","matchingResources","resourceId","resourceValue","resource_id","selectAssignments","resource_property","owners","getTaskBy","propertyName","propertyValue","getResourceAssignments","assignments","createHelper","resourcePlugin","renderEditableLabel","editable","$task_id","$resource_id","renderSummaryLabel","sum","reduce","Number","editableResourceCellTemplate","$role","editableResourceCellClass","capacity","getSummaryResourceAssignments","childResource","initEditableDiagram","resource_render_empty_cells","timeoutId","makeEditable","cancelAnimationFrame","contentEditable","getCellsByType","$content","currentFocusIndex","handleAssignmentEdit","strValue","innerText","assignmentId","assignmentStore","nextChunk","calculateDuration","updateTaskAssignments","editedElem","dom_helpers.getFocusableNodes","focusableElementsAfterRender","focusableElements","focusableElementsAfterUpdate","targetAfterUpdate","editable_resource_diagram","fetchTasks","lightbox_resources","lightboxOptions","resourceStoreConfig","initItems","storeType","$resourcesStore","options","lightboxOptionsFnc","updateCollection","histogram_cell_class","histogram_cell_label","histogram_cell_allocated","histogram_cell_capacity","defaultResourceCellClass","defaultResourceCellTemplate","resource_cell_value","resource_cell_class","resource_assignments","resourceAssignmentsProperty","process_resource_assignments","resourceAssignmentFormats","resourceAssignmentFormat","assignmentModes","initAssignmentFields","initDelay","timing","_assignmentTimeFromTask","resourceAssignmentsStore","_makeAssignmentsFromTask","resourceAssignments","detectFormat","usedIds","defaultMode","_updateTaskBack","_assignAssignments","_loadAssignmentsFromTask","_syncAssignments","storeAssignments","taskValues","assignmentsStoreValues","inBoth","inTaskNotInStore","inStoreNotInTask","taskOwner","ownerId","foundOwnerAssignment","taskSearch","storeSearch","processedIds","inTask","inStore","ignoreFields","_syncOnTaskUpdate","totalAssignments","needUpdate","needUpdateFor","undoBatchCancel","assignmentsHash","getTaskAssignments","taskAssignmentsCache","unscheduled","idsSearch","deleteIds","resourceAssignmentsCache","resourceTaskAssignmentsCache","searchTaskId","resourceTaskCacheKey","getTaskResources","uniqueResources","addPlaceholder","callIfEnabled","insertPlaceholder","placeholders","new_task","afterEdit","newTask","dataProcessor","_silencedPlaceholder","isPlaceholderLink","auto_task_types","auto_types","checkTaskType","changedTypes","targetType","getTaskTypeToUpdate","$needsUpdate","updateParentTypes","group_mode","delTaskParent","allTypes","hasChildren","taskType","originalRowDndParent","originalMoveTaskParent","isParsingDone","updateAfterRemoveChild","DurationFormatterNumeric","canParse","_re","LinkFormatterSimple","_linkReg","linkPart","exec","_findSource","finish_to_start","lag","pred","reqTemplate","_oe","formatters","durationFormatter","DurationFormatter","linkFormatter","LinkFormatter","empty_state_screen","show_empty_state","emptyStateElement","isGanttEmpty","placeholderContainer","empty_state_text_link","empty_state_text_description","clickEvents","attachAddTaskEvent","domHelpers","getContainer","wrapper","marginTop","oldNodes","detachAddTaskEvents","renderContent","emptyStateElementNode","hasBaselinesBelow","baselinesOnDifferentRow","render_mode","isSplitParent","bar_height","_adjustSplitParentHeight","maxParentHeight","adjustTaskHeightForBaselines","childHeight","_increaseSplitParentHeight","parentHeight","getLayoutView","getBarHeight","maxHeight","subtaskId","subtask","subtaskHeight","_addBaselinesToTask","newBaseline","existingBaseline","baselineSize","baselineAmount","subrowHeight","timelineView","shouldRepaint","iteratedBaselines","taskBaselines","existingBaselines","getTaskBaselines","exisingBaseline","repaint","RemoteEvents","Client","createHandlers","updateQueue","updateTimeout","remoteUpdates","message","processUpdate","processQueue","taskData","warn","initTask","existingTask","remoteTask","lightbox_id","linkData","existingLink","assign","liveUpdates","parsing","jsonParseError","on_load","resp","responseURL","_process_loading","collections","_load_collections","assignmentsByTasks","getTasksByTime","collections_loaded","collection","serverList","option","option_key","$ignore","dhx_security","serializeLink","_copyLink","rawLinks","baselineCopy","attrs_only","attributes","_getCollections","opts","itms","attrs","k","attr","_getXML","toptag","getXMLTopNode","skey","evs","progress","oldxml","startdate","est","enddate","predecessortasks","IsWorkTimeArgument","calendar","ClosestWorkTimeArgument","CalculateEndDateArgument","GetDurationArgument","calendarArgumentsHelper","getWorkHoursArguments","helpers.isValidDate","setWorkTimeArguments","unsetWorkTimeArguments","isWorkTimeArguments","processedConfig","getClosestWorkTimeArguments","arg","_getStartEndConfig","param","argumentType","duration_step","getDurationArguments","hasDurationArguments","calculateEndDateArguments","WorkTimeCalendarMerger","_getIntervals","hoursArray","_toHoursArray","intervalsArray","formatHHMM","secondsValue","minutePart","_intersectHourRanges","baseArray","overridesArray","current","_mergeAdjacentIntervals","_mergeHoursConfig","firstHours","secondHours","merge","firstCalendar","secondCalendar","firstConfig","secondConfig","customWeeks","mergedSettings","processCalendar","config1","config2","date1","date2","hours2","WorkUnitsMapCache","timestamp","_cache","has","subCache","rawValue","unitCache","yearCache","Map","WorkUnitsObjectCache","LargerUnitsCache","getMinutesPerWeek","weekStart","_weekCache","_calendar","minutesPerWeek","getHoursPerDay","getMinutesPerMonth","monthStart","_monthCache","minutesPerMonth","nextMonth","DateDurationCache","stepCache","durations","endDates","compute","_getCacheObject","startDateTimestamp","_endDateCacheKey","resultTimestamp","_durationCacheKey","endDateTimestamp","CalendarWorkTimeStrategy","argumentsHelper","_workingUnitsCache","_largeUnitsCache","_dateDurationCache","_worktime","_cached_timestamps","_cached_timestamps_count","_clearCaches","_getUnitOrder","_resetTimestampCache","_timestamp","_checkIfWorkingUnit","hasDuration","_is_work_day","_getWorkHours","_is_work_hour","startHour","endHour","_getTimeOfDayStamp","dayEnd","_is_work_minute","checkTime","_nextDate","_getWorkUnitsBetweenGeneric","stepStart","stepEnd","next","checkFirst","checkLast","isLastStep","_isWorkTime","unitOrder","biggerTimeUnit","_getClosestWorkTimeFuture","_getMinutesPerHour","hourStart","hourEnd","_getMinutesPerDay","durationMinutes","durationHours","_getWorkUnitsForRange","getUnitsPerDay","_getMinutesBetweenSingleDay","_getIntervalTimestamp","minuteFrom","minuteTo","_getMinutesBetween","firstDayStart","firstDayEnd","lastDayStart","lastDayEnd","startPart","endPart","_getHoursBetween","_setConfig","_parseSettings","haveCustomWeeks","customWeeksRangeStart","customWeeksRangeEnd","customWeeksBoundaries","_parseHours","minCustomRangeStart","maxCustomRangeEnd","customTime","rangeStart","rangeEnd","fromReadable","toReadable","currentWeek","_tryChangeCalendarSettings","backup","hasWorkTime","_arraysEqual","_compareSettings","mySettings","thatSettings","myDays","otherDates","myHours","otherHours","equals","myWeek","thatWeek","getWorkHours","dayStartDate","dateValue","endHours","timestampRanges","part","timerangeConfig","durationSeconds","setWorkTime","calendarConfig","unsetWorkTime","reset_calendar","dateKey","isWorkUnit","setItem","getDuration","_calculateDuration","sign","mult","getEndDate","_calculateEndDate","_calculateMinuteEndDate","_subtractMinuteDate","_calculateHourEndDate","_addInterval","stopAction","added","dstShift","_addHoursUntilDayEnd","rangeHours","addHours","intervalEnd","durationLeft","hoursPerDay","_addMinutesUntilHourEnd","rangeMinutes","addMinutes","_subtractMinutesUntilHourStart","hourStartTimestamp","initialDateTimestamp","getClosestWorkTime","minutePrecision","_isMinutePrecision","addedInterval","calculatedDay","daySchedule","minutesInDay","dayStart","iterateFromDayEnd","isWorkHour","workInterval","prevInterval","minutesInHour","_getClosestWorkTimePast","times","lastInterval","_getClosestWorkTime","inputDate","direction","closestFuture","closestPast","_getClosestWorkTimeGeneric","_findClosestTimeInDay","resultDate","fromDayEnd","_getClosestWorkMinute","increment","hasRegularHours","_checkWorkHours","dayConfig","legacyResourceCalendarConfig","isLegacyResourceCalendarFormat","resourceCalendarsProperty","getResourceProperty","resourceCalendarsConfig","resource_calendars","getCalendarIdFromLegacyConfig","calendarId","dynamicResourceCalendars","dynamicCalendars","getCalendarIdFromMultipleResources","manager","getResourceCalendar","tempCalendar","mergeCalendars","addCalendar","CalendarManager","_calendars","_legacyConfig","_isLegacyConfig","createDefaultCalendars","CalendarDisabledTimeStrategy","TimeCalculator","calendarManager","createArgumentsHelper","$disabledCalendar","NoWorkTimeCalendar","_convertWorkTimeSettings","datesConfig","weekdays","entries","setting","calendars","mergeHelper","CalendarMergeHelper","_createCalendarFromConfig","createCalendar","apiCore","preparedConfig","parentCalendar","defaults","fulltime","getCalendar","getCalendars","_getOwnCalendar","calendar_property","resourceProperty","dynamic_resource_calendars","calendarsConfig","getTaskCalendar","taskObject","groupMode","inherit_calendar","currentTask","$effective_calendar","isCalendar","deleteCalendar","restoreConfigCalendars","possibleCalendar","every","fixedUnits","_getCalendar","worktimeFacadeFactory","timeCalculator","_hasDuration","isUnscheduledTask","_isAllowedUnscheduledTask","show_unscheduled","_isTaskInTimelineLimits","taskStart","taskEnd","_getProjectEnd","project_end","_getProjectStart","project_start","getDefaultTaskDate","parent_id","schedule_from_end","_set_default_task_timing","details_on_create","$new","showTask","_tasks_dnd","drag","getTaskTimingMode","task_type","$no_start","$no_end","scheduled_summary","auto_scheduling","milestone","updateTaskTiming","assignProjectDates","taskTiming","summaryDateFields","manuallyScheduledSummaryDateFields","dateFields","_init_task_timing","getSubtaskInfo","rollup","inlineSplit","rootTask","isScheduledSummary","task_mode","dirty","$calculate_duration","min_duration","effectiveCalendar","taskMode","$rollup","$inlineSplit","getSubtaskDuration","_update_parents","updateAll","has_changed","startDateField","$auto_start_date","endDateField","$auto_end_date","oldStart","oldEnd","roundDate","upper","lower","colIndex","correctTaskWorkTime","correct_work_time","listenWindowResize","resizeDelay","resizeTimeout","container_resize_timeout","previousSize","getContainerSize","container_resize_method","lowlevelResizeWatcher","$scrollbarRepaint","currentSize","repaintGantt","previousHeight","previousWidth","gantt_core","show_errors","expire","invalidContainerMessage","validateNode","cloneNode","_reinit","dropLayout","_clearTaskLayers","_clearLinkLayers","rebuildLayout","calculateScaleRange","layout","createView","getPropertyValue","resizeWatcher","wai_aria_attributes","contentWindow","resetLayout","initTemplates","domHelpers.toNode","$mouseEvents","edit","question","confirm_deleting","confirm_deleting_title","_delete_task_confirm","hideLightbox","visibleDate","_sort","posX","_getHorizontalScrollbar","codeScrollLeft","preserveScroll","resize","zoom","new_pos","posY","x_pos","setSizes","changeLightboxType","getLightboxType","_silent_redraw_lightbox","_get_link_type","from_start","to_start","start_to_start","start_to_finish","finish_to_finish","isLinkAllowed","prevOffset","time_unit","helpers.getSecondsInUnit","offsetChanged","domHelpers.getClassName","icon_save","icon_cancel","icon_details","confirm_closing","section_description","section_time","section_type","section_deadline","section_baselines","section_new_resources","column_wbs","column_text","column_start_date","column_duration","column_add","confirm_link_deleting","link_start","link_end","type_task","type_project","type_milestone","weeks","months","years","message_ok","message_cancel","section_constraint","asap","alap","snet","snlt","fnet","fnlt","mso","mfo","resources_add_button","resources_filter_placeholder","resources_filter_label","resources_section_placeholder","baselines_section_placeholder","baselines_add_button","baselines_remove_button","baselines_remove_all_button","deadline_enable_button","deadline_disable_button","LocaleManager","addLocale","_locales","getLocale","DHXGantt","license","edit_save","edit_cancel","factory","supportedExtensions","extensionManager","ExtensionManager","activePlugins","plugin","services","getter","service","rows","resizer","autoscroll_speed","show_links","show_task_cells","static_background","static_background_cells","branch_loading","branch_loading_property","show_loading","server_utc","show_progress","drag_links","drag_progress","drag_resize","drag_move","drag_mode","round_dnd_dates","link_wrapper_width","link_arrow_size","autofit","align","inherit_scale_class","time_step","task_date","time_picker","link_attribute","layer_attribute","buttons_left","_migrate_buttons","dhx_save_btn","dhx_cancel_btn","dhx_delete_btn","buttons_right","sections","map_to","project_sections","milestone_sections","single_date","drag_lightbox","details_on_dblclick","initial_scroll","order_branch","order_branch_free","task_height","bar_height_padding","min_grid_column_width","grid_resizer_column_attribute","keep_grid_width","grid_resize","grid_elastic_columns","resize_rows","task_grid_row_resizer_attribute","min_task_grid_row_height","readonly_property","editable_property","type_renderers","optimize_render","prevent_default_scroll","horizontal_scroll_key","drag_multiple","DOMParser","ActiveXObject","loadXML","parseFromString","tagname","responseXML","getElementsByTagName","xpathExp","docObj","selectNodes","ownerDocument","evaluate","XPathResult","ANY_TYPE","iterateNext","_call","onLoad","getSync","put","postData","del","postSync","isQt","noCache","toUpperCase","copyDomEvent","pageX","pageY","DnD","_obj","_settings","inputMethods","getInputMethods","_drag_start_timer","clearDragTimer","eventParams","passive","accessor","timeStamp","original_target","original_element_sizes","domHelpers.getClosestSizedElement","actualTarget","dragStart","traceDragEvents","inputMethod","mousemove","dragScroll","limited_mousemove","started","updates_per_second","dndActive","cancelable","mousemoveContainer","mouseup","checkPositionChange","diff_x","diff_y","pow","sensitivity","initDnDMarker","backupEventTarget","getEvent","backup_element","maxTouchPoints","elementFromPoint","PointerEvent","pointerType","getPosition","_prevent_touch_scroll","_touch_drag","_touch_feedback","targetTouches","rootNode","getOwnPropertyDescriptor","templatesLoader","regTemplates","initTemplate","initial","template_name","c","progress_text","grid_header_class","task_end_date","grid_row_class","task_row_class","timeline_cell_content","scale_row_class","grid_indent","grid_folder","grid_file","grid_open","grid_blank","task_unscheduled_time","grid_date_format","link_class","link_description","drag_link","drag_link_class","tooltip_date_format","baseline_text","stateService","selected_task","deletedLinks","originalTask","checkLinkedTaskVisibility","noDuplicateIds","sync_link_delete","sourceTask","sync_links","mapEvents","conf","mapFrom","mapTo","sourceEvent","targetEvent","taskLinks","sourceMatch","targetMatch","typeMatch","changedTask","oldState","sourceVisible","targetVisible","onItemLoading","onBeforeAdd","onAfterAdd","onBeforeUpdate","onAfterUpdate","onBeforeDelete","onAfterDelete","onIdChange","onBeforeItemMove","onAfterItemMove","onFilterItem","onItemOpen","onItemClose","onBeforeSelect","onAfterSelect","onAfterUnselect","createDataProcessor","modules","new_task_placeholder","remote_events","getAutoSchedulingConfig","getDefaultAutoSchedulingConfig","gap_behavior","descendant_links","schedule_on_parse","move_projects","use_progress","project_constraint","show_constraints","schedulingConfig","move_asap_tasks","auto_scheduling_compatibility","auto_scheduling_strict","auto_scheduling_descendant_links","auto_scheduling_initial","auto_scheduling_move_projects","auto_scheduling_use_progress","auto_scheduling_project_constraint","getGridColumn","activate","_cached_functions","update_if_changed","critical_path_mode","wrap_methods","_prefetch_originals","prefetch","methodname","original","optimizer","argumentsArray","l","get_arguments_hash","cached_values","has_cached_value","get_cached_value","cache_value","arguments_hash","is_date","values","stringify_argument","deactivate","setup","override_gantt","gantt_methods","highlight_critical_path","deactivTimeout","_eventRemoveAll","resetLightbox","i18n","en","ar","be","ca","cn","cs","da","de","es","fa","fi","fr","he","hr","hu","it","jp","kr","nb","nl","no","pl","pt","ro","ru","si","sk","sv","tr","ua","setLocale","localeObject","gantt_save_btn","gantt_cancel_btn","gantt_delete_btn","boxAttribute","_dhx_msg_cfg","usercall","modalBox","modal_key","messageBox","keyboard","cancelBubble","modality","onkeydown","messageButtonAttrString","getFirstDefined","_createBox","ok","cancel","contentId","messageModalAttr","inner","btn","onclick","hidden","innerWidth","innerHeight","alertPopup","confirmPopup","boxPopup","box_params","params","messageInfoAttr","insertBefore","timers","hideAll","popups","alert","confirm","modalbox","extendSettings","parentSettings","own","$extendedConfig","setPrototypeOf","configurable$1","parentView","parentConfig","parentTemplates","$getConfig","$getTemplates","uiFactory$1","views","createdViews","creator","configure","configurable","$parent","initUI","registerView","viewConstructor","createMouseHandler","eventHandlers","doubleclick","contextMenu","addEventTarget","onClick","findEventHandlers","callEventHandlers","onContextMenu","src","delegateHandlers","h","onDoubleClick","onMouseMove","_last_move_event","domEvents","delegate","elementHandlers","callHandler","mouseEvents","genericViewPortChecker","x_end","y_end","isLegacyRender","getRowRectangle","getVisibleTasksRange","indexStart","indexEnd","extraTasksIds","inlineEditorId","layerFactory","renderFactory","task_area_pulls","task_area_renderers","getRenderer","renderMethod","updateMethod","getRectangle","renderCallbackMethod","specializedViewPortChecker","basicGetRectangle","onrender","isInViewPort","layerView","viewConfig","rendererViewPort","useBuffer","remove_item","rendered","clear_container","basicGetRange","getVisibleRange","prepareData","buffer","createDocumentFragment","vis","itemsSearch","renderedItems","newElements","nodesToRemove","renderCalledFor","itemNode","restore","replace_item","item_id","newNode","replaceChild","clearRenderers","createGroup","relativeRoot","defaultFilters","initLayer","renderGroup","tempCollection","filters","_add","getLayer","pending","isConnected","topmost","rel","mergeFilters","requestUpdate","eachLayer","removeLayer","filter_methods","filter_method","barRectangle","startCoord","_getPositioningContext","endCoord","calculated","clearCache","rec","sourceBox","targetBox","initialized","visibleBoxes","isLinkInViewPort","sourceTop","sourceHeight","targetTop","targetHeight","sourceLeft","sourceRight","targetLeft","targetRight","$skipSmartRenderOnScroll","Cell","headerHeight","$domEvents","$name","$factory","$externalComponent","_headerClickHandler","final","$preResize","topCont","topSize","getSize","maxWidth","minHeight","setSize","_hide","cellIndex","moveView","$toHTML","renderedElement","canCollapse","$fill","collapsed","size","gravity","getContentSize","$lastSize","contentX","contentY","_getBorderSizes","borders","horizontal","vertical","_currentBorders","_borders","_sizeHeader","_sizeContent","_setBorders","domHelpers.removeClassName","cssHash","domHelpers.addClassName","xLayout","transform","__extends","__","Layout","_super","_this","_parseConfig","domHelpers.removeNode","$cells","_resizeScrollbars","scrollbars","scrollChanged","visibleScrollbars","hiddenScrollbars","scrollbarsToHide","showScrollbar","scrollbar","hideScrollbar","shouldHide","shouldShow","visibleGroups","group","scrollbarsInfo","visible","scrollSize","_getLinkedViews","x_inner","y_inner","y_pos","_syncCellSizes","groupName","newSize","groups","_eachChild","_syncGroupSize","cells","_xLayout","newSizeValue","isGravity","ownSize","resizeSibling","siblingSize","totalGravity","totalSize","mainGrid","grid_width","startStage","mainCall","_resizeInProgress","contentViews","setContentSize","_getAutosizeMode","$originalWidthStored","$originalWidth","$originalHeightStored","$originalHeight","isChild","cellId","sub","getCells","domHelpers.insertNode","domHelpers.getChildNodes","contentWidth","contentHeight","_cleanElSize","_getBoxStyles","computed","properties","boxSizing","clientHeight","MozBoxSizing","horPaddings","borderLeftWidth","borderRightWidth","vertPaddings","borderTopWidth","borderBottomWidth","borderBox","outerWidth","outerHeight","boxSizes","contentSizes","_sizes","margin","_calcFreeSpace","side","_free","_gravity","_calcSize","_configureBorders","borderClass","lastVisibleIndex","lastCell","borderColorClass","_updateCellVisibility","oldVisibleCells","_visibleCells","firstCall","visibleCells","parentVisibility","hide_empty","hideCell","cellView","marginSide","ViewLayout","$cell","byMaxSize","otherCell","ViewCell","childConfig","$initialized","unload","_setContentSize","outerX","outerY","childSize","ScrollbarCell","SCROLL_MODIFIER_KEYS","_scrollHorizontalHandler","_scrollVerticalHandler","_outerScrollVerticalHandler","_outerScrollHorizontalHandler","_mouseWheelHandler","scroll_size","_isHorizontal","eachCell","_isVertical","_initVertical","_initHorizontal","_initMouseWheel","_initLinkedViews","_getRootParent","_eachView","$scroll_hor","$scroll_ver","_updateLinkedViews","scrollHorizontally","_scrolling","oldSize","scrollVertically","_wheel_time","_oldLeft","_getScrollSize","outerSize","isHorizontal","linked","scrollProperty","innerSizeProperty","outerProperty","_getScrollOffset","cellScrollSize","nonScrollableSize","outerScroll","innerScroll","scrollSizes","_setScrollSize","toggleVisibility","_getScaleOffset","parentLayout","_oldTop","_checkWheelTarget","connectedViews","wheelSpeed","wheelSpeedConfig","wheel_scroll_sensitivity","ff","deltaX","wheelDeltaX","deltaY","wheelDelta","multiplier","deltaMode","wx","wy","horizontalScrollModifier","oldLeft","detail","oldTop","createMixin","getItemTopCache","getRowTopCache","getItemHeightCache","totalHeightCache","getItemHeightCacheState","quickPosition","cachedRowHeight","canUseSimpleCalc","_getRowHeight","_refreshState","rowStore","globalRowHeight","canUseSimpleCalculation","_resetTopPositionHeight","_resetHeight","getCacheStateTotalHeight","shouldClearHeightCache","all","itemIndex","_fillHeightCache","defaultHeight","globalHeight","itemHeightCache","sumHeight","getHeight","visibleItems","totalHeight","canvasRender","destroy","Timeline","_posFromDateCache","_posFromWorkTimeCache","_timelineDragScroll","topPositionMixin","$task_scale","taskBg","$task_bg","$task_baselines","$task_links","$task_bars","$task_constraints","$task_deadlines","_tasks","linksAttr","bindLinks","item_attribute","layers","_createLayerConfig","linkLayers","_attachLayers","backgroundImage","data_els","scrollWidth","scrolled","_refreshScales","_scales","_getScaleChunkHtml","taskFilter","taskLayers","expose","hide_bar","_taskLayers","_linkLayers","_bindStore","taskRenderer","bar_layer","_taskRenderer","_initStaticBackgroundRender","linkStore","linkRenderer","linkLayer","_linkRenderer","staticRender","_staticBgHandler","staticBgContainer","$task_bg_static","staticBackgroundHeight","_clearLayers","_render_tasks_scales","scales_html","outer_width","helpers","cfgs","fromPos","toPos","cssClass","tplClass","_prepareScaleHtml","globalConfig","globalTemplates","cssclass","g","floatConfig","sticky","labelPosition","approxLabelWidth","labelPos","translateValue","getTimelineCellAttr","context","_getColumnDuration","cellStartDate","absolutePositionDate","trimStartSec","cellEnd","cellDuration","intervals","_getWorkTrimForCell","secondsInsideTrim","mappedTimestampMs","posFromWorkTime","wholeCells","partCell","roundPos","cellDurationMs","cellEndDate","earliestWorkSecondInCell","latestWorkSecondInCell","intervalsSinceCellStart","dayDate","dayIndex","dayIntervals","dayStartOffsetSeconds","absoluteStartSeconds","absoluteEndSeconds","workintervalStart","workintervalEnd","dateOffset","fraction","posLeft","cellWidth","_getNextVisibleColumn","visibleDateIndex","_getPrevVisibleColumn","_getClosestVisibleColumn","dateIndex","visibleIndex","transition","getItemPosition","xLeft","xRight","displayStart","displayEnd","rowHeight","isMilestoneRender","_timelineCacheAttached","_unbindStore","ScrollableGrid","_scrollOrder","getCurrentX","_dnd","_scrollView","attachEvents","isScrollable","gridBoundingRect","maxLeft","minLeft","currentX","autoscrollRight","autoscrollStart","autoscrollLeft","autoscrollStop","scrollStep","COLUMN_ID_ATTR_NAME","ColumnsGridDnd","_targetMarker","calculateCurrentPosition","eventX","DND","_scrollableGrid","_draggedCell","draggedColumn","draggedIndex","_gridConfig","outerHTML","lineHeight","_dragX","columnIndexes","findColumnsIndexes","setMarkerPosition","drawTargetMarker","targetColumn","cleanTargetMarker","reorderColumns","draggedId","xBefore","xAfter","currentColumn","startX","endX","columnRelativePos","compare","relativeX","getCorrection","gridOffset","nextPosition","Grid","$state","clearTaskStoreHandler","_delayRender","ownStore","handlerIdProperty","$attachedResourceViewHandler","$attachedTaskStoreHandler","gridAriaAttr","gridAttrString","gridDataAriaAttr","gridDataAttrString","reorder_grid_columns","gridScaleRowAttrString","doOnRender","_renderHeaderResizers","_mouseDelegates","mouseEventContainer","resizerrow","_task_grid_row_resize","row_before_start","row_id","row_after_start","row_drag_move","dd","itemHeight","itemTop","pointerPosition","markerStartPosition","marker_height","minPointerPosition","row_drag_end","oldItemHeight","finalHeight","dnd_sensitivity","_addLayers","_initEvents","_columnDND","ColumnDnd","_validateColumnWidth","numericWidth","elasticColumns","_setColumnsWidth","columnProperty","newColumnWidth","columnsWidth","_getGridWidth","_gridCacheAttached","_initSmartRenderingPlaceholder","_calculateGridWidth","_renderGridHeader","getColumnIndex","excludeHidden","hiddenIndexShift","getColumn","gridLine","gridTaskRowResizer","_refreshPlaceholderOnStoreUpdate","$rowsPlaceholder","_getColumnWidth","min_width","new_width","max_width","_checkGridColumnMinWidthLimits","_getGridWidthLimits","min_limit","max_limit","newWidth","start_index","columns_width","final_width","extra_width","start_width","iterator","curExtra","_getColsTotalWidth","cols_width","v","parseFloat","unknown","gridWidth","delta","changed","lineHeigth","renderableComponents","colWidth","componentLabel","gridScaleCellAttrString","GridRL","_getResourceConfig","resource_table","domEventScope","_getResourceColumns","_getResourceSection","getLightboxSection","sectionName","section","inlineEditorsLightbox","initGrid","destroyGrid","_linkToTaskStore","previousDragId","relevantResources","delayRender","linkedStore","repaintStack","_getRelevantResources","_updateNestedTasks","_getIdsFromAssignments","Set","resourceStore","toAddArray","toAdd","toDelete","addedTasks","resourceData","resource1","resource2","defaultMapping","isChanged","save","tempAssignmentStore","resourceSection","block","form_blocks","_lightbox_root","set_value","lightbox_events","_save_lightbox","onShow","preventKeyNav","shouldPrevent","editPrevCell","editNextCell","onkeyup","onwheel","onHide","keyNavMappings","onBlurDelay","keyNav","activeCell","editorState","hasEditor","editorType","anyModifier","BaseFactory","BaseEditor","get_input","get_value","is_changed","currentValue","is_valid","textEditorFactory","TextEditor","numberEditorFactory","NumberEditor","oninput","selectEditorFactory","SelectEditor","optionsHtml","dateEditorFactory","html5DateFormat","dateToStr","strToDate","DateEditor","minValue","maxValue","predecessorEditorFactory","PredecessorEditor","getFormatter","formatter","parseInputString","predecessors","delimiter","formatPredecessors","formatLinkKey","getLinksDiff","predecessorCodes","selectedLinks","existingLinksSearch","linksToAdd","linkKey","linksToDelete","linksDiff","autoSchedule","inputPredecessors","taskPredecessors","durationEditorFactory","linkedPropertiesProcessor","decreaseStartDate","initConfigs","number","predecessor","keyboardMapping","mapping","setMapping","getMapping","eventBus","inlineEditController","createEditors","_createPlaceholder","inlineEditorAttr","updateTaskDateProperties","ganttHandlers","_itemId","_columnName","_editor","_editorType","_placeholder","asyncShow","setValue","_lightbox","editorConfig","onAfterShow","_onReMount","editorResult","getValue","_getItemValue","inline_editors_date_processing","_findEditableCell","nextColumn","getNextCell","getFirstCell","getLastCell","canChangeRow","moveRow","nextItem","editNextRow","skipReadonly","editPrevRow","detachStore","isBarInViewport","createTaskRenderer","_task_default_render","controlsMargin","padd","hasBaselines","milestoneHeight","milestoneWidth","done","pr","taskEditable","timelineDrag","markerPos","basic","link_from_start","link_target_id","isCriticalTask","link_landing_area","from_id","link_to_start","dragClass","progressColor","textColor","u","setProperty","_get_link_crossing_css","marginStyle","_render_side_content","setTaskBarAttr","_render_pair","outer","showLinkPoints","cond","ln","tp","marginLeft","marginRight","defaultRenderer","createBaseBarRender","resourceHistogramRenderer","getVisibleCellsRange","firstCellIndex","lastCellIndex","isColumnVisible","cellLeftCoord","cellRightCoord","bgPlaceholder","placeholderConfig","lastTaskId","placeholderTask","calendar_id","createLinkRender","drawer","current_pos","dirs","path","point","get_lines","line_to","get_path","line","_get_line","get_wrapper_sizes","wrapper_size","get_line_sizes","line_size","link_line_width","render_line","innerPos","render_corner","corner","radius","lineWidth","cornerDiv","borderVertical","borderHorizontal","arrow","get_direction","vect","path_builder","point_to","get_points","get_endpoint","xy","e_y","e_x","lineType","get_line_type","forward","getMilestonePosition","splitParams","heightLimit","shrinkHeight","splitChild","milestoneTask","siblingBaselines","shapes","lines","link_radius","arrowSize","nextLine","cornerX","cornerY","lastLine","arrowX","arrowY","shape","render_arrow","cssTemplate","isCriticalLink","linkAttr","createResourceTimelineBuilder","assignmentsPassed","timegrid","scaleUnit","scaleStep","precalculatedTimes","firstColumn","minScaleDate","currDate","cachedTimes","timetable","rowDnd","checkPlaceholderTask","getStore","initial_open_state","$transparent","lastTaskOfLevel","last_item","_getGridPos","gridHeight","maxBottom","_getTargetY","scrollPos","_getTaskByY","dropIndex","gridDataSizes","reorderMarkerAttr","containerSize","targetY","allowedLevel","over","nextId","dropTarget","createDropTargetObject","targetId","nextSiblingTarget","dndTaskId","prevSiblingTarget","firstChildTarget","lastChildTarget","findClosesTarget","targetLevel","findTargetAbove","findTargetBelow","getSameLevelDropPosition","relTargetPos","eventTop","targetAbove","targetBelow","gridToPageCoordinates","gridPos","setWidthWithinContainer","higlighter","removeLineHighlight","markerLine","highlightPosition","ePos","pointerEvents","markerFolder","folderHighlightWidth","linePos","indentNode","indent","iconWidth","childCount","markerLineTop","rowDndMarker","opacity","drop_target","getDropPosition","doctype","minTop","firstVisibleTaskIndex","firstVisibleTaskId","firstVisibleTaskPos","hiddenTaskPart","gridPosition","gridBottom","placeholderRowHeight","lockLevel","getLockedLevelTarget","initializer","onCreated","extendGantt","_inlineEditors","onInitialized","initEvents","extendDom","onDestroyed","clearEvents","notOpenIcon","showDate","sorting_method","totalWidth","taskDnD","createTaskDND","roundTaskDates","round_task_dates","dragMultiple","before_start","before_finish","after_finish","clear_drag_state","set_actions","drag_from_start","stage","_move","_resize","_resize_progress","on_mouse_move","on_mouse_down","on_mouse_up","start_x","start_y","coords_x","_drag_task_coords","minDurationInUnits","_calculateMinDuration","diffValue","_find_max_shift","dragItems","correctShift","minX","maxX","maxShift","minShift","multipleDragShift","new_start","new_end","obj_s_x","obj_e_x","_mouse_position_change","oldPos","newPos","_is_number","isFinite","start_drag","sX","sY","now","_start_dnd","_update_on_move","_update_item_on_move","curr_date","dragHash","_isMultiselect","dragProject","initialDrag","newStartPos","newEndPos","handle_offset","dragPos","dragX","childDrag","_get_drag_mode","_fix_dnd_scale_time","fixStart","dndContext","_fix_working_times","_finalize_mouse_up","_fireEvent","_dhx_changed","initialDates","finalizingBulkMove","moveCount","doFinalize","dragProperty","selectedTasksIds","selectedTask","_addSubtasksToDragMultiple","trigger","drag_state","summaryId","initLinksDND","_link_landing","_link_target_task","_link_target_task_start","_link_source_task","_link_source_task_start","getDndState","link_edge_marker","link_landing_hover_area","markerSize","viewportSize","ganttOffsetY","updateMarkedHtml","resetDndState","showDirectingLine","s_x","s_y","_direction","getDirectionLine","link_direction_class","dist","tan","angle","atan","coordinateCircleQuarter","sin","cos","shiftLeft","shiftTop","eX","eY","_dir_start","landing","prevTarget","prevLanding","prevToStart","targ","absCoords","domHelpers.getRelativeNodePosition","_dir_end","targetChanged","linkDnD","_linksDnD","_tasksDnD","MouseDelegates","_attachDomEvents","_attachStateProvider","_clearDomEvents","_clearStateProvider","_delete_link_handler","_delete_link_confirm","coll","coll_date","scale_unit","scale_step","getVerticalScrollbar","getHorizontalScrollbar","_legacyGridResizerClass","resizers","gridResizer","mainTimeline","colsWidth","hideGrid","grid_limits","ganttContainerWidth","verticalScrollbarWidth","gridOverflow","original_grid_width","skinSettings","skins","_initScrollStateEvents","_getVerticalScrollbar","_findGridResizer","gridFirst","_getSiblings","_behind","_front","resizeInfo","initialWidth","prevCellWidth","nextCellWidth","viewCell","limits","newBehindSize","newFrontSize","oldBackSize","oldFrontSize","newBackSize","ui$1","attachInitializer","uiFactory","Scrollbar","mainLayoutInitializer","mainTimelineInitializer","mainGridInitializer","ResourceGrid","ResourceGridLightbox","ResourceTimeline","ResourceHistogram","layersEngine","createLayerFactory","previusSiblingContainer","defaultContainerSibling","addTaskLayer","rangeFunction","getVisibleTaskRange","_getTaskLayers","removeTaskLayer","addLinkLayer","getVisibleLinksRangeFactory","isLinkInViewport","_getLinkLayers","removeLinkLayer","gridEditorsFactory","layersApi","textValue","aria","gridAddButtonAttrString","justifyContent","center","gridCellAttrString","css_template","taskRowAttr","rowNode","cellNode","adapter","renderedCells","cleanupCell","isRendered","detachRenderedCell","getCellClassTemplate","getCellContentTemplate","renderOneCell","contentTemplate","cssTemplateContent","htmlTemplateContent","customCell","cellCssTemplate","cellHtmlTemplate","odd","placeholderTop","placeholderHeight","renderTaskBar","timedProjectBar","renderTimedProjectBar","taskRollupBar","renderedNodes","checkVisibility","generateChildElement","childCopy","$rendered_at","getKey","renderParentId","rollupKey","taskSplitBar","renderSplitTaskBar","taskConstraints","renderConstraints","taskDeadline","renderDeadline","renderBaselines","renderLink","resourceRow","getResourceLoad","resourceTimetable","renderedResourceLines","renderResourceLineCell","detachRenderedResourceLine","checkedColumns","resourceHistogram","resize_el","rowResizerAttr","layersService","_get_skin","themeVar","themeName","isCssVarTheme","href","_theme_info","theme","cssVarTheme","skinset","_second_column_width","_third_column_width","_lightbox_template","_redefine_lightbox_buttons","isMove","delayTimeout","startPos","eventPos","isDisplayed","isScrollState","dragMarker","isResize","isLink","isClickDrag","defineDelayTimeout","speed","tick","autoscroll_delay","defineScrollInterval","autoscrollInterval","isScroll","gridDrag","need_scroll","currentScrollTop","scrollOuterHeight","scrollInnerHeight","currentScrollLeft","scrollOuterWidth","scrollInnerWidth","autoscroll_step","boxSize","$","jQuery","fn","dhx_gantt","each","newgantt","Gantt","getGanttInstance","dhtmlx","attaches","attachGantt","cmp","attachObject","dataType","dataObj","vs","av","border","gridId","gridObj","dhtmlXCellObject","USE_KEY","_defaultScales","TimelineZoom","zoomIn","getCurrentLevel","setLevel","zoomOut","_levels","_activeLevelIndex","getLevels","zoomLevel","_getZoomIndexByName","levelName","_getVisibleDate","_visibleDate","cursorOffset","nextConfig","chartConfig","resourceView","resourceConfig","fixed_scales","cursorDate","newPosition","middleDate","_attachWheelEvent","_useKey","_handler","_defaultHandler","timelineOffset","wheelUp","stopPropagation","_setScaleSettings","_setScaleDates","_initialStartDate","_initialEndDate","activeLevelIndex","_mapScales","levels","_minColumnWidth","minColumnWidth","_maxColumnWidth","maxColumnWidth","_widthStep","widthStep","_stepUp","_stepDown","nextLevel","addTouchEvents","platform","_touch_events","getTaskDND","tasksDnD","touch_feedback","touch_feedback_duration","vibrate","touchHandlers","names","dblclicktime","actionMode","scrollMode","actionStart","previousActionStart","longTapTimer","currentDndId","dndNodes","targetView","multiTouchEvents","newScrollState","block_action","allViews","_locate_css","taskNode","noMultitouch","sameTarget","dummy","BaseControl","Super","htmlHelpers","getHtmlSelect","_attributes","getHtmlOption","_getHtmlContainer","getHtmlButton","getHtmlDiv","getHtmlLabel","getHtmlInput","_getHtmlAttributes","ResourcesControlConstructor","SelectControl","sns","_dhx_onchange","onchange","_focus","ParentControlConstructor","ParentControl","_display","allow_root","root_label","getLightboxValues","tmpDom","newOptions","onselect","NewResourcesControlConstructor","localCache","resourcesValues","eventsInitialized","gridID","resource_filter_value","initialValues","newValues","selectResEditor","newResourcesControl","_getFilterCache","resource_default_assignment","filterApplied","button_click","firstAddBtn","resourceGrid","resourceRows","resourceCell","resourceTable","gridConfig","wide_form","searchItems","clonedAssignments","structuredClone","_applyFilter","resultSns","_saveValues","filterCache","controlConfig","comparison","resultConfig","visibleResources","currentAssignments","resource_selector","originalAssignmentId","disabled","wait","_center_lightbox","TemplateControl","TextareaControl","_get_input","TimeControl","getTimePicker","sectionClassName","_time_format_order","auto_end_date","_update_lightbox_select","_fill_lightbox_select","_resolve_default_mapping","selects","getTimePickerValue","autofix_end","_get_timepicker_step","SelectControlConstructor","CheckboxControl","BaseConstrutor","single_value","checkboxes","checked","resArray","RadioControl","radio","default_value","DurationControl","_getStartDate","_getDuration","singleDate","lightboxDurationInputAttrString","durationInputClass","duration_val","inps","btns","endspan","_calc_date","_change_duration","charCode","ResourcesControl","ConstraintControl","isNonTimedConstraint","toggleTimeSelect","timeSelects","typeValue","isNonTimed","typeSelect","_eventsInitialized","constraintDate","constraintType","getConstraintType","TypeselectControl","typeKey","oldOnChange","_lightbox_current_type","BaselineControl","_generateBaselineRow","durationLabel","deleteLabel","durationEl","deleteButton","baselineRow","baselineNode","baselineId","dataset","updatedBaseline","_get_typed_lightbox_config","NewResourcesControl","_lightbox_methods","showCover","_fill_lightbox","_setLbPosition","lightboxVisibleAttr","getLabel","list_name","_lightbox_type","lightboxDiv","fullWidth","ds","classNames","_is_lightbox_timepicker","getHtmlButtons","lightboxAttr","onmousedown","_ready_to_dnd","onselectstart","cursor","_init_dnd_events","show_cover","_cover","_render_sections","backup_overflow","labelBlock","inputBlock","inputId","_init_lightbox_events","rootElement","_move_while_dnd","_finish_dnd","_get_type_name","type_value","floatRight","lightboxButtonAttrString","getTimeFormat","time_format","getHtmlTimePickerOptions","start_year","end_year","tdate","timeFormat","year_range","_time_values","_cancel_lightbox","sec","buttonTarget","time_optional","duration_optional","sortedSns","lightboxHiddenAttr","hideCover","_custom_lightbox","_set_lightbox_values","lightboxHeader","lightbox_header","get_template_control","control","get_select_control","get_textarea_control","get_time_control","_dnd_start_lb","gantt_unselectable","lb","_lb_start","ariaAttrs","limit_time_select","first_hour","last_hour","lightboxSelectAttrString","mapOffset","checkbox","constraint","typeselect","_simple_confirm","oldType","ui","codeHelpers.arrayFind","uiApi","getTimeline","getGrid","getBaseCell","baseCell","getAttachedScrollbar","attachedScrollbar","DEFAULT_VALUE","tryCall","getTaskTop","getTaskBarHeight","domAttr","getLinkNode","oldH","oldV","verticalViews","horizontalViews","commonViews","viewId","newV","newH","date_x","scroll_to","leftPos","_scroll_state","gridCell","timelineCell","scrollVer","scrollHor","horState","verState","cellName","horizontalScroll","verticalScroll","resetSkin","monitorThemeChange","_addThemeClass","setSkin","skinChanged","monitorIntervalId","csstheme","skyblue","lightbox_additional_height","dark","meadow","terrace","broadway","_config_buttons_left","_config_buttons_right","material","indx","_extend_to_optional","lightbox_block","optional_time","update_block","button_text","htmlTags","extraSpaces","stripHTMLLite","htmlText","singleQuotes","escapeQuotes","getAttributeString","_taskCommonAttr","linkTypes","toStart","fromStart","gridSeparatorAttr","buttonName","role","tabindex","headerText","time_option","buttonLabel","targetAttribute","_locateHTML","firstTask","domHelpers.getScrollSize","availablePlugins","critical_path","grouping","groupBy","overlay","_load_url","cl","_load_type"],"mappings":"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","x_google_ignoreList":[45]}