{"version":3,"file":"dhtmlxgantt.js","sources":["../../sources/core/ui/utils/dom_helpers.js","../../sources/utils/global.js","../../sources/ext/click_drag/eventsManager.ts","../../sources/utils/eventable.js","../../sources/utils/helpers.js","../../sources/ext/click_drag/selectedRegion.ts","../../sources/ext/click_drag/index.ts","../../sources/ext/drag_timeline/eventsManager.ts","../../sources/ext/drag_timeline/index.ts","../../sources/utils/utils.js","../../sources/core/ui/timeline/scales.js","../../sources/core/ui/timeline/scales_ignore.js","../../sources/ext/export_api/index.ts","../../sources/ext/fullscreen/index.ts","../../sources/ext/keyboard_navigation/common/keyboard_shortcuts.js","../../sources/ext/keyboard_navigation/common/eventhandler.js","../../sources/ext/keyboard_navigation/common/trap_modal_focus.js","../../sources/ext/keyboard_navigation/elements/gantt_node.js","../../sources/ext/keyboard_navigation/elements/nav_node.js","../../sources/ext/keyboard_navigation/elements/header_cell.js","../../sources/ext/keyboard_navigation/elements/task_row.js","../../sources/ext/keyboard_navigation/elements/task_cell.js","../../sources/ext/keyboard_navigation/modals.js","../../sources/ext/keyboard_navigation/core.js","../../sources/ext/keyboard_navigation.js","../../sources/ext/marker.js","../../sources/ext/multiselect.js","../../sources/ext/quick_info/quickInfo.ts","../../sources/ext/quick_info/index.ts","../../sources/core/ui/utils/dom_event_scope.js","../../sources/ext/tooltip/tooltip.ts","../../sources/ext/tooltip/tooltipManager.ts","../../sources/ext/tooltip/index.ts","../../sources/ext/undo/monitor.ts","../../sources/ext/undo/undo.ts","../../sources/ext/undo/index.ts","../../sources/ext/extensions_gpl.ts","../../sources/constants/index.js","../../sources/ext/extension_manager.ts","../../sources/core/common/services.js","../../sources/core/common/config.ts","../../sources/utils/env.js","../../sources/core/common/serialize.ts","../../sources/core/common/ajax.js","../../sources/core/common/date_parsers/fast_version.ts","../../sources/core/common/date_parsers/csp_compliant_version.ts","../../sources/core/common/date.js","../../node_modules/remote-client/dist/remote.es6.js","../../sources/core/remote/remote_events.js","../../sources/utils/timeout.js","../../sources/core/common/dnd.js","../../sources/core/common/templates.js","../../sources/core/common/state.js","../../sources/utils/promise.js","../../sources/core/facades/datastore_tasks.js","../../sources/core/facades/datastore_links.js","../../sources/core/datastore/power_array.js","../../sources/utils/placeholder_task.js","../../sources/core/datastore/datastore.js","../../sources/core/common/split_task_helpers.ts","../../sources/core/datastore/treedatastore.js","../../sources/core/datastore/select.js","../../sources/utils/is_headless.js","../../sources/core/datastore/datastore_render.js","../../sources/core/facades/datastore.js","../../sources/core/gantt_data_range.js","../../sources/utils/task_tree_helpers.js","../../sources/core/datastore/datastore_hooks.js","../../sources/core/dataprocessor/data_processor_events.ts","../../sources/core/dataprocessor/extend_gantt.ts","../../sources/core/dataprocessor/simple_storage.ts","../../sources/core/dataprocessor/data_processor.ts","../../sources/core/dataprocessor/index.js","../../sources/core/plugins/batch_update.js","../../sources/core/plugins/wbs.js","../../sources/core/plugins/resources.js","../../sources/core/plugins/resource_assignments.js","../../sources/core/plugins/new_task_placeholder.js","../../sources/core/plugins/auto_task_types.js","../../sources/core/common/duration_formatter_numeric.ts","../../sources/core/common/link_formatter_simple.ts","../../sources/core/plugins/formatters.js","../../sources/core/plugins/empty_state_screen.ts","../../sources/core/ui/render/baseline_helper.js","../../sources/core/plugins/baselines.js","../../sources/core/plugins/remote_events/remote_events.ts","../../sources/core/plugins/remote_events/handlers.js","../../sources/core/plugins/remote_events/index.js","../../sources/core/plugins/auto_scheduling_config.js","../../sources/core/plugins/index.js","../../sources/core/grid_column_api.gpl.js","../../sources/core/tasks.js","../../sources/core/loading/parsing.js","../../sources/core/worktime/calendar_arguments_helper.js","../../sources/core/worktime/strategy/work_calendar_merger.js","../../sources/core/worktime/strategy/work_unit_cache/workunit_map_cache.ts","../../sources/core/worktime/strategy/work_unit_cache/workunit_object_cache.ts","../../sources/core/worktime/strategy/work_unit_cache/larger_units_helper.ts","../../sources/core/worktime/strategy/work_unit_cache/index.ts","../../sources/core/worktime/strategy/work_unit_cache/date_duration_cache.ts","../../sources/core/worktime/strategy/calendar_strategy.js","../../sources/core/worktime/legacy_resource_config.js","../../sources/core/worktime/dynamic_resource_calendars.js","../../sources/core/worktime/calendar_manager.js","../../sources/core/worktime/strategy/no_work_time.js","../../sources/core/worktime/time_calculator.js","../../sources/core/facades/worktime_calendars.js","../../sources/core/worktime/work_time.js","../../sources/core/data.js","../../sources/core/data_task_types.gpl.js","../../sources/core/cached_functions.js","../../sources/core/ui/resize_listener.js","../../sources/core/common/assert.js","../../sources/core/gantt_core.js","../../sources/core/destructor.js","../../sources/locale/locale_ar.ts","../../sources/locale/locale_be.ts","../../sources/locale/locale_ca.ts","../../sources/locale/locale_cn.ts","../../sources/locale/locale_cs.ts","../../sources/locale/locale_da.ts","../../sources/locale/locale_de.ts","../../sources/locale/locale_el.ts","../../sources/locale/locale_en.ts","../../sources/locale/locale_es.ts","../../sources/locale/locale_fa.ts","../../sources/locale/locale_fi.ts","../../sources/locale/locale_fr.ts","../../sources/locale/locale_he.ts","../../sources/locale/locale_hr.ts","../../sources/locale/locale_hu.ts","../../sources/locale/locale_id.ts","../../sources/locale/locale_it.ts","../../sources/locale/locale_jp.ts","../../sources/locale/locale_kr.ts","../../sources/locale/locale_manager.ts","../../sources/locale/locale_nb.ts","../../sources/locale/locale_nl.ts","../../sources/locale/locale_no.ts","../../sources/locale/locale_pl.ts","../../sources/locale/locale_pt.ts","../../sources/locale/locale_ro.ts","../../sources/locale/locale_ru.ts","../../sources/locale/locale_si.ts","../../sources/locale/locale_sk.ts","../../sources/locale/locale_sv.ts","../../sources/locale/locale_tr.ts","../../sources/locale/locale_ua.ts","../../sources/locale/index.ts","../../sources/factory/make_instance_common.js","../../sources/core/ui/message.js","../../sources/core/ui/configurable.js","../../sources/core/ui/ui_factory.js","../../sources/core/ui/mouse.js","../../sources/core/ui/render/viewport/is_in_viewport.js","../../sources/core/ui/render/is_legacy_smart_render.js","../../sources/core/ui/render/viewport/get_grid_row_rectangle.js","../../sources/core/ui/render/viewport/get_visible_bars_range.js","../../sources/core/ui/render/render_factory.js","../../sources/core/ui/render/layer_engine.js","../../sources/core/ui/render/viewport/get_bar_rectangle.js","../../sources/core/ui/render/viewport/get_link_rectangle.js","../../sources/core/ui/render/viewport/factory/get_visible_link_range.js","../../sources/core/ui/render/viewport/is_link_in_viewport.js","../../sources/core/ui/gantt_layers.js","../../sources/core/ui/layout/cell.js","../../sources/utils/extends.js","../../sources/core/ui/layout/layout.js","../../sources/core/ui/layout/view_layout.js","../../sources/core/ui/layout/view_cell.js","../../sources/core/ui/layout/resizer_cell.gpl.js","../../sources/core/ui/layout/scrollbar_cell.js","../../sources/core/ui/row_position_fixed_height.js","../../sources/core/ui/row_position_mixin.js","../../sources/core/ui/timeline/tasks_canvas_render.gpl.js","../../sources/core/ui/timeline/timeline_layers_gpl.js","../../sources/core/ui/timeline/timeline.js","../../sources/core/ui/grid/grid_resize.gpl.js","../../sources/core/ui/grid/task_grid_row_resize.js","../../sources/core/ui/plugins/column_grid_dnd/scrollable_grid.ts","../../sources/core/ui/plugins/column_grid_dnd/column_grid_dnd.ts","../../sources/core/ui/mouse_event_container.js","../../sources/core/ui/grid/grid.js","../../sources/core/ui/resource_store_mixin.js","../../sources/core/ui/grid/resource_grid_lightbox.js","../../sources/core/ui/grid/editors/keyboard_mappings/default.js","../../sources/core/ui/grid/editors/keyboard_mappings/keyboard_navigation.js","../../sources/core/ui/grid/editors/keyboard_mappings.js","../../sources/core/ui/grid/editors/editors/base.js","../../sources/core/ui/grid/editors/editors/text.js","../../sources/core/ui/grid/editors/editors/number.js","../../sources/core/ui/grid/editors/editors/select.js","../../sources/core/ui/grid/editors/editors/date.js","../../sources/core/ui/grid/editors/editors/predecessor.js","../../sources/core/ui/grid/editors/editors/duration.js","../../sources/core/ui/grid/editors/linked_properties.js","../../sources/core/ui/grid/editors/controller.js","../../sources/core/ui/render/viewport/is_bar_in_viewport.js","../../sources/core/ui/render/task_bar_render.js","../../sources/core/ui/render/task_bar_smart_render.js","../../sources/core/ui/render/dummy_layer.js","../../sources/core/ui/render/task_rollup_render.js","../../sources/core/ui/render/viewport/get_bg_row_rectangle.js","../../sources/core/ui/render/viewport/get_visible_cells_range.js","../../sources/core/ui/render/viewport/is_column_visible.js","../../sources/core/ui/render/prerender/task_bg_placeholder.js","../../sources/core/ui/render/task_bg_render.js","../../sources/core/ui/render/link_render.js","../../sources/core/ui/render/viewport/is_grid_row_in_viewport.js","../../sources/core/ui/render/task_grid_line_render.js","../../sources/core/resource_timetable_builder.js","../../sources/core/ui/render/resource_matrix_render.js","../../sources/core/ui/render/task_grid_row_resize_render.js","../../sources/core/ui/grid/tasks_grid_dnd.js","../../sources/core/ui/grid/tasks_grid_dnd_marker_helpers/drop_target.js","../../sources/core/ui/grid/tasks_grid_dnd_marker_helpers/locked_level.js","../../sources/core/ui/grid/tasks_grid_dnd_marker_helpers/multi_level.js","../../sources/core/ui/grid/tasks_grid_dnd_marker_helpers/highlight.js","../../sources/core/ui/grid/tasks_grid_dnd_marker.js","../../sources/core/ui/grid/main_grid_initializer.js","../../sources/core/ui/timeline/tasks_dnd.js","../../sources/core/ui/timeline/links_dnd.js","../../sources/core/ui/timeline/main_timeline_initializer.js","../../sources/core/ui/main_layout_initializer.js","../../sources/core/ui/index.js","../../sources/core/facades/layout.js","../../sources/core/data_task_layers.gpl.js","../../sources/core/ui/skin.js","../../sources/css/skins/skyblue.js","../../sources/css/skins/meadow.js","../../sources/css/skins/terrace.js","../../sources/css/skins/broadway.js","../../sources/css/skins/material.js","../../sources/css/skins/dark.js","../../sources/css/skins/contrast_black.js","../../sources/css/skins/contrast_white.js","../../sources/core/ui/plugins/autoscroll.js","../../sources/core/ui/plugins/jquery_hooks.js","../../sources/core/ui/plugins/dhtmlx_hooks.js","../../sources/core/ui/plugins/timeline_zoom.ts","../../sources/core/ui/plugins/index.js","../../sources/core/ui/touch.js","../../sources/core/ui/lightbox/controls/base_control.js","../../sources/core/ui/lightbox/controls/template_control.js","../../sources/core/ui/lightbox/controls/textarea_control.js","../../sources/core/ui/lightbox/controls/time_control.js","../../sources/core/ui/utils/html_helpers.js","../../sources/core/ui/lightbox/controls/select_control.js","../../sources/core/ui/lightbox/controls/checkbox_control.js","../../sources/core/ui/lightbox/controls/radio_control.js","../../sources/core/ui/lightbox/controls/duration_control.js","../../sources/core/ui/lightbox/controls/parent_control.js","../../sources/core/ui/lightbox/controls/constraint_control.js","../../sources/core/ui/lightbox/controls/typeselect_control.js","../../sources/core/ui/lightbox/controls/baseline_control.js","../../sources/core/ui/lightbox/controls/resource_selector_control.js","../../sources/core/ui/lightbox/index.js","../../sources/core/ui/lightbox/lightbox_optional_time.js","../../sources/core/ui/wai_aria.js","../../sources/core/ui_core.js","../../sources/core/loading/ajax_loading.js","../../sources/factory/make_instance_web.js","../../sources/dhtmlxgantt.gpl.ts"],"sourcesContent":["//returns position of html element on the page\r\nfunction getNodePosition(elem) {\r\n\tvar top=0, left=0, right=0, bottom=0;\r\n\tif (elem.getBoundingClientRect) { //HTML5 method\r\n\t\tvar box = elem.getBoundingClientRect();\r\n\t\tvar body = document.body;\r\n\t\tvar docElem = (document.documentElement ||\r\n\t\t\tdocument.body.parentNode ||\r\n\t\t\tdocument.body);\r\n\r\n\t\tvar scrollTop = window.pageYOffset || docElem.scrollTop || body.scrollTop;\r\n\t\tvar scrollLeft = window.pageXOffset || docElem.scrollLeft || body.scrollLeft;\r\n\t\tvar clientTop = docElem.clientTop || body.clientTop || 0;\r\n\t\tvar clientLeft = docElem.clientLeft || body.clientLeft || 0;\r\n\t\ttop  = box.top +  scrollTop - clientTop;\r\n\t\tleft = box.left + scrollLeft - clientLeft;\r\n\r\n\t\tright = document.body.offsetWidth - box.right;\r\n\t\tbottom = document.body.offsetHeight - box.bottom;\r\n\t} else { //fallback to naive approach\r\n\t\twhile(elem) {\r\n\t\t\ttop = top + parseInt(elem.offsetTop,10);\r\n\t\t\tleft = left + parseInt(elem.offsetLeft,10);\r\n\t\t\telem = elem.offsetParent;\r\n\t\t}\r\n\r\n\t\tright = document.body.offsetWidth - elem.offsetWidth - left;\r\n\t\tbottom = document.body.offsetHeight - elem.offsetHeight - top;\r\n\t}\r\n\treturn { y: Math.round(top), x: Math.round(left), width:elem.offsetWidth, height:elem.offsetHeight, right: Math.round(right), bottom: Math.round(bottom) };\r\n}\r\n\r\nfunction isVisible(node){\r\n\tvar display = false,\r\n\t\tvisibility = false;\r\n\tif(window.getComputedStyle){\r\n\t\tvar style = window.getComputedStyle(node, null);\r\n\t\tdisplay = style[\"display\"];\r\n\t\tvisibility = style[\"visibility\"];\r\n\t}else if(node.currentStyle){\r\n\t\tdisplay = node.currentStyle[\"display\"];\r\n\t\tvisibility = node.currentStyle[\"visibility\"];\r\n\t}\r\n\treturn (display != \"none\" && visibility != \"hidden\");\r\n}\r\n\r\nfunction hasNonNegativeTabIndex(node){\r\n\treturn !isNaN(node.getAttribute(\"tabindex\")) && (node.getAttribute(\"tabindex\")*1 >= 0);\r\n}\r\n\r\nfunction hasHref(node){\r\n\tvar canHaveHref = {\"a\": true, \"area\": true};\r\n\tif(canHaveHref[node.nodeName.loLowerCase()]){\r\n\t\treturn !!node.getAttribute(\"href\");\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nfunction isEnabled(node){\r\n\tvar canDisable = {\"input\":true, \"select\":true, \"textarea\":true, \"button\":true, \"object\":true};\r\n\tif(canDisable[node.nodeName.toLowerCase()]){\r\n\t\treturn !node.hasAttribute(\"disabled\");\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n\r\nfunction getFocusableNodes(root){\r\n\tvar nodes = root.querySelectorAll([\r\n\t\t\"a[href]\",\r\n\t\t\"area[href]\",\r\n\t\t\"input\",\r\n\t\t\"select\",\r\n\t\t\"textarea\",\r\n\t\t\"button\",\r\n\t\t\"iframe\",\r\n\t\t\"object\",\r\n\t\t\"embed\",\r\n\t\t\"[tabindex]\",\r\n\t\t\"[contenteditable]\"\r\n\t].join(\", \"));\r\n\r\n\tvar nodesArray = Array.prototype.slice.call(nodes, 0);\r\n\t\r\n\tfor(var i = 0; i < nodesArray.length; i++){\r\n\t\tnodesArray[i].$position = i;\r\n\t\t// we remember original nodes order, \r\n\t\t// so when we sort them by tabindex we ensure order of nodes with same tabindex is preserved, \r\n\t\t// since some browsers do unstable sort\r\n\t}\r\n\t\r\n\t// use tabindex to sort focusable nodes\r\n\tnodesArray.sort(function(a, b) {\r\n\t\tif(a.tabIndex === 0 && b.tabIndex !== 0){\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\tif(a.tabIndex !== 0 && b.tabIndex === 0){\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\t\r\n\t\tif (a.tabIndex === b.tabIndex){\r\n\t\t\t// ensure we do stable sort\r\n\t\t\treturn a.$position - b.$position;\r\n\t\t}\r\n\t\tif (a.tabIndex < b.tabIndex) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\treturn 1;\r\n\t});\r\n\t\r\n\tfor(var i = 0; i < nodesArray.length; i++){\r\n\t\tvar node = nodesArray[i];\r\n\t\tvar isValid = (hasNonNegativeTabIndex(node)  || isEnabled(node) || hasHref(node)) && isVisible(node);\r\n\t\tif(!isValid){\r\n\t\t\tnodesArray.splice(i, 1);\r\n\t\t\ti--;\r\n\t\t}\r\n\t}\r\n\treturn nodesArray;\r\n}\r\n\r\nfunction getScrollSize(){\r\n\tvar div = document.createElement(\"div\");\r\n\tdiv.style.cssText=\"visibility:hidden;position:absolute;left:-1000px;width:100px;padding:0px;margin:0px;height:110px;min-height:100px;overflow-y:scroll;\";\r\n\r\n\tdocument.body.appendChild(div);\r\n\tvar width = div.offsetWidth-div.clientWidth;\r\n\tdocument.body.removeChild(div);\r\n\r\n\treturn Math.max(width, 15);\r\n}\r\n\r\nfunction getClassName(node){\r\n\tif(!node) return \"\";\r\n\r\n\tvar className = node.className || \"\";\r\n\tif(className.baseVal)//'className' exist but not a string - IE svg element in DOM\r\n\t\tclassName = className.baseVal;\r\n\r\n\tif(!className.indexOf)\r\n\t\tclassName = \"\";\r\n\r\n\treturn _trimString(className);\r\n}\r\n\r\nfunction addClassName(node, className){\r\n\tif (className && node.className.indexOf(className) === -1) {\r\n\t\tnode.className += \" \" + className;\r\n\t}\r\n}\r\n\r\nfunction removeClassName(node, name) {\r\n\tname = name.split(\" \");\r\n\tfor (var i = 0; i < name.length; i++) {\r\n\t\tvar regEx = new RegExp(\"\\\\s?\\\\b\" + name[i] + \"\\\\b(?![-_.])\", \"\");\r\n\t\tnode.className = node.className.replace(regEx, \"\");\r\n\t}\r\n}\r\n\r\nfunction hasClass(element, className){\r\n\tif ('classList' in element) {\r\n\t\treturn element.classList.contains(className);\r\n\t} else { \r\n\t\treturn new RegExp(\"\\\\b\" + className + \"\\\\b\").test(element.className);\r\n\t}\r\n}\r\n\r\nfunction toNode(node) {\r\n\tif (typeof node === \"string\") {\r\n\t\treturn (document.getElementById(node) || document.querySelector(node) || document.body);\r\n\t}\r\n\treturn node || document.body;\r\n}\r\n\r\nvar _slave;\r\nfunction insertNode(node, newone) {\r\n\tif(!_slave){\r\n\t\t_slave = document.createElement(\"div\");\r\n\t}\r\n\t_slave.innerHTML = newone;\r\n\tvar child = _slave.firstChild;\r\n\tnode.appendChild(child);\r\n\treturn child;\r\n}\r\n\r\nfunction removeNode(node) {\r\n\tif (node && node.parentNode) {\r\n\t\tnode.parentNode.removeChild(node);\r\n\t}\r\n}\r\n\r\nfunction getChildNodes(node, css) {\r\n\tvar ch = node.childNodes;\r\n\tvar len = ch.length;\r\n\tvar out = [];\r\n\tfor (var i = 0; i < len; i++) {\r\n\t\tvar obj = ch[i];\r\n\t\tif (obj.className && obj.className.indexOf(css) !== -1) {\r\n\t\t\tout.push(obj);\r\n\t\t}\r\n\t}\r\n\treturn out;\r\n}\r\n\r\nfunction getTargetNode(e) {\r\n\tvar trg;\r\n\tif (e.tagName)\r\n\t\ttrg = e;\r\n\telse {\r\n\t\te = e || window.event;\r\n\t\ttrg = e.target || e.srcElement;\r\n\t\tif (trg.shadowRoot && e.composedPath) {\r\n\t\t\ttrg = e.composedPath()[0];\r\n\t\t}\r\n\t}\r\n\treturn trg;\r\n}\r\n\r\nfunction locateAttribute(e, attribute) {\r\n\tif(!attribute) return;\r\n\r\n\tvar trg = getTargetNode(e);\r\n\r\n\twhile (trg){\r\n\t\tif (trg.getAttribute){\t//text nodes has not getAttribute\r\n\t\t\tvar test = trg.getAttribute(attribute);\r\n\t\t\tif (test) return trg;\r\n\t\t}\r\n\t\t// GS-2941. With the `host`, Gantt will continue iteration outside the ShadowDOM\r\n\t\ttrg = trg.parentNode || trg.host;\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction _trimString(str){\r\n\tvar func = String.prototype.trim || function(){ return this.replace(/^\\s+|\\s+$/g, \"\"); };\r\n\treturn func.apply(str);\r\n}\r\n\r\nfunction locateClassName(e, classname, strict){\r\n\tvar trg = getTargetNode(e);\r\n\tvar css = \"\";\r\n\r\n\tif(strict === undefined)\r\n\t\tstrict = true;\r\n\r\n\twhile (trg){\r\n\t\tcss = getClassName(trg);\r\n\t\tif(css){\r\n\t\t\tvar ind = css.indexOf(classname);\r\n\t\t\tif (ind >= 0){\r\n\t\t\t\tif (!strict)\r\n\t\t\t\t\treturn trg;\r\n\r\n\t\t\t\t//check that we have exact match\r\n\t\t\t\tvar left = (ind === 0) || (!_trimString(css.charAt(ind - 1)));\r\n\t\t\t\tvar right = ((ind + classname.length >= css.length)) || (!_trimString(css.charAt(ind + classname.length)));\r\n\r\n\t\t\t\tif (left && right)\r\n\t\t\t\t\treturn trg;\r\n\t\t\t}\r\n\t\t}\r\n\t\ttrg=trg.parentNode;\r\n\t}\r\n\treturn null;\r\n}\r\n\r\n/*\r\nevent position relatively to DOM element\r\n */\r\nfunction getRelativeEventPosition(ev, node){\r\n\tconst d = document.documentElement;\r\n\tconst box = getNodePosition(node);\r\n\t//GS-2809: condition to check event(mouse or touch)\r\n\tconst { clientX, clientY } = ev.touches?.[0] ?? ev;\r\n\treturn {\r\n\t\tx: clientX + d.scrollLeft - d.clientLeft - box.x + node.scrollLeft,\r\n\t\ty: clientY + d.scrollTop - d.clientTop - box.y + node.scrollTop\r\n\t};\r\n}\r\n\r\nfunction getRelativeNodePosition(child, parent){\r\n\tconst childPos = getNodePosition(child);\r\n\tconst parentPos = getNodePosition(parent);\r\n\treturn {\r\n\t\tx: childPos.x - parentPos.x,\r\n\t\ty: childPos.y - parentPos.y\r\n\t};\r\n}\r\n\r\nfunction isChildOf(child, parent){\r\n\tif(!child || !parent){\r\n\t\treturn false;\r\n\t}\r\n\r\n\twhile(child && child != parent) {\r\n\t\tchild = child.parentNode;\r\n\t}\r\n\r\n\treturn child === parent;\r\n}\r\n\r\nfunction closest(element, selector){\r\n\tif(element.closest){\r\n\t\treturn element.closest(selector);\r\n\t}else if(element.matches || element.msMatchesSelector || element.webkitMatchesSelector){\r\n\t\tvar el = element;\r\n\t\tif (!document.documentElement.contains(el)) return null;\r\n\t\tdo {\r\n\t\t\tvar method = el.matches || el.msMatchesSelector || el.webkitMatchesSelector;\r\n\r\n\t\t\tif (method.call(el, selector)) return el;\r\n\t\t\tel = el.parentElement || el.parentNode;\r\n\t\t} while (el !== null && el.nodeType === 1); \r\n\t\treturn null;\r\n\t}else{\r\n\t\t// eslint-disable-next-line no-console\r\n\t\tconsole.error(\"Your browser is not supported\");\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nfunction getClosestSizedElement(element) {\r\n\twhile (element) {\r\n\t\tif (element.offsetWidth > 0 && element.offsetHeight > 0) {\r\n\t\t\treturn element;\r\n\t\t}\r\n\t\telement = element.parentElement;\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction isShadowDomSupported() {\r\n\treturn document.head.createShadowRoot || document.head.attachShadow;\r\n}\r\n\r\n/**\r\n * Returns element that has the browser focus, or null if no element has focus.\r\n * Works with shadow DOM, so it's prefereed to use this function instead of document.activeElement directly.\r\n * @returns HTMLElement\r\n */\r\nfunction getActiveElement(){\r\n\tvar activeElement = document.activeElement;\r\n\tif (activeElement.shadowRoot) {\r\n\t\tactiveElement = activeElement.shadowRoot.activeElement;\r\n\t}\r\n\tif (activeElement === document.body && document.getSelection) {\r\n\t\tactiveElement = document.getSelection().focusNode || document.body;\r\n\t}\r\n\r\n\treturn activeElement;\r\n}\r\n\r\n/**\r\n * Returns document.body or the host node of the ShadowRoot, if the element is attached to ShadowDom\r\n * @param {HTMLElement} element \r\n * @returns HTMLElement\r\n */\r\nfunction getRootNode(element) {\r\n\tif (!element) {\r\n\t\treturn document.body;\r\n\t}\r\n\tif (!isShadowDomSupported()) {\r\n\t\treturn document.body;\r\n\t}\r\n\twhile (element.parentNode && (element = element.parentNode)) {\r\n\t\tif (element instanceof ShadowRoot) {\r\n\t\t\treturn element.host;\r\n\t\t}\r\n\t}\r\n\treturn document.body;\r\n}\r\n\r\nfunction hasShadowParent(element) {\r\n\treturn !!getRootNode(element);\r\n}\r\n\r\nexport {\r\n\tgetNodePosition,\r\n\tgetFocusableNodes,\r\n\tgetScrollSize,\r\n\tgetClassName,\r\n\taddClassName,\r\n\tremoveClassName,\r\n\tinsertNode,\r\n\tremoveNode,\r\n\tgetChildNodes,\r\n\ttoNode,\r\n\tlocateClassName,\r\n\tlocateAttribute,\r\n\tgetTargetNode,\r\n\tgetRelativeEventPosition,\r\n\tisChildOf,\r\n\thasClass,\r\n\tclosest,\r\n\tgetRootNode,\r\n\thasShadowParent,\r\n\tisShadowDomSupported,\r\n\tgetActiveElement,\r\n\tgetRelativeNodePosition,\r\n\tgetClosestSizedElement\r\n};","\r\n/* eslint-disable no-restricted-globals */\r\nvar globalScope;\r\nif(typeof window !== \"undefined\"){\r\n\tglobalScope = window;\r\n}else{\r\n\tglobalScope = global;\r\n}\r\n/* eslint-enable no-restricted-globals */\r\n\r\nexport default globalScope;","import * as domHelpers from \"../../core/ui/utils/dom_helpers\";\r\nimport global from \"../../utils/global\";\r\nimport { SelectedRegion } from \"./selectedRegion\";\r\n\r\nexport class EventsManager {\r\n\tprivate _mouseDown: boolean = false;\r\n\tprivate _touchStarts: boolean = false;\r\n\tprivate _touchActive: boolean = false;\r\n\tprivate _longTapTimer: any = false;\r\n\tprivate _domEvents: any;\r\n\tprivate _originPosition: string;\r\n\tprivate _gantt: any;\r\n\tprivate _restoreOriginPosition: () => void;\r\n\tconstructor(gantt: any) {\r\n\t\tthis._gantt = gantt;\r\n\t\tthis._domEvents = gantt._createDomEventScope();\r\n\t}\r\n\r\n\tattach(selectedRegion: SelectedRegion, useKey?: \"shiftKey\" | \"ctrlKey\" | \"altKey\", ignore?: any): void {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst _target = selectedRegion.getViewPort();\r\n\t\tthis._originPosition = global.getComputedStyle(_target).display;\r\n\t\tthis._restoreOriginPosition = () => {\r\n\t\t\t_target.style.position = this._originPosition;\r\n\t\t};\r\n\t\tif (this._originPosition === \"static\") {\r\n\t\t\t_target.style.position = \"relative\";\r\n\t\t}\r\n\t\tconst state = gantt.$services.getService(\"state\");\r\n\t\tstate.registerProvider(\"clickDrag\", () => {\r\n\t\t\tconst result = { autoscroll: false };\r\n\t\t\treturn result;\r\n\t\t});\r\n\r\n\r\n\t\tlet scheduledDndCoordinates:any = null;\r\n\t\tconst startDragAndDrop = () => {\r\n\t\t\tif (!scheduledDndCoordinates) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis._mouseDown = true;\r\n\t\t\tselectedRegion.setStart(gantt.copy(scheduledDndCoordinates));\r\n\t\t\tselectedRegion.setPosition(gantt.copy(scheduledDndCoordinates));\r\n\t\t\tselectedRegion.setEnd(gantt.copy(scheduledDndCoordinates));\r\n\t\t\tscheduledDndCoordinates = null;\r\n\t\t};\r\n\r\n\t\t// mouse events\r\n\t\tthis._domEvents.attach(_target, \"mousedown\", (event) => {\r\n\t\t\tstartDrag(event);\r\n\t\t});\r\n\t\tconst eventElement = domHelpers.getRootNode(gantt.$root) || document.body;\r\n\t\tthis._domEvents.attach(eventElement, \"mouseup\", (event) => {\r\n\t\t\tstopDrag(event);\r\n\t\t});\r\n\t\tthis._domEvents.attach(_target, \"mousemove\", (event) => {\r\n\t\t\tdragMove(event);\r\n\t\t});\r\n\r\n\t\t// touch events\r\n\t\tthis._domEvents.attach(_target, \"touchstart\", (event) => {\r\n\t\t\tthis._touchStarts = true;\r\n\t\t\tthis._longTapTimer = setTimeout(()=> {\r\n\t\t\t\tif (this._touchStarts){\r\n\t\t\t\t\tstartDrag(getTouchEvent (event));\r\n\t\t\t\t\tthis._touchStarts = false;\r\n\t\t\t\t\tthis._touchActive = true;\r\n\t\t\t\t}\r\n\t\t\t}, this._gantt.config.touch_drag);\r\n\t\t});\r\n\r\n\t\tthis._domEvents.attach(eventElement, \"touchend\", (event) => {\r\n\t\t\tthis._touchStarts = false;\r\n\t\t\tthis._touchActive = false;\r\n\t\t\tclearTimeout(this._longTapTimer);\r\n\t\t\tstopDrag(getTouchEvent (event));\r\n\t\t});\r\n\t\tthis._domEvents.attach(_target, \"touchmove\", (event) => {\r\n\t\t\tif (this._touchActive){\r\n\t\t\t\tlet filterTargets = getFilterTargets();\r\n\t\t\t\tif (filterTargets && gantt.utils.dom.closest(event.target, filterTargets)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tdragMove(getTouchEvent (event));\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t} else {\r\n\t\t\t\tthis._touchStarts = false;\r\n\t\t\t\tclearTimeout(this._longTapTimer);\t\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfunction getTouchEvent (event){\r\n\t\t\tconst touchEvent = event.changedTouches && event.changedTouches[0] || event;\r\n\t\t\treturn touchEvent;\r\n\t\t}\r\n\r\n\t\tconst getFilterTargets = () => {\r\n\t\t\tlet filterTargets = \".gantt_task_line, .gantt_task_link\";\r\n\t\t\tif (ignore !== undefined) {\r\n\t\t\t\tif (ignore instanceof Array) {\r\n\t\t\t\t\tfilterTargets = ignore.join(\", \");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfilterTargets = ignore;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn filterTargets;\r\n\t\t};\r\n\r\n\t\tconst startDrag: any = (event) => {\r\n\t\t\tscheduledDndCoordinates = null;\r\n\t\t\tlet filterTargets = getFilterTargets();\r\n\t\t\tif (filterTargets) {\r\n\t\t\t\tif (gantt.utils.dom.closest(event.target, filterTargets)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tstate.registerProvider(\"clickDrag\", () => {\r\n\t\t\t\tconst result = { autoscroll: this._mouseDown };\r\n\t\t\t\treturn result;\r\n\t\t\t});\r\n\r\n\t\t\tif (useKey && event[useKey] !== true) { return; }\r\n\t\t\tscheduledDndCoordinates = this._getCoordinates(event, selectedRegion);\r\n\t\t};\r\n\r\n\t\tconst stopDrag: any = (event) => {\r\n\t\t\tscheduledDndCoordinates = null;\r\n\t\t\tif (useKey && event[useKey] !== true) { return; }\r\n\t\t\tif (this._mouseDown === true) {\r\n\t\t\t\tthis._mouseDown = false;\r\n\t\t\t\tconst coordinates = this._getCoordinates(event, selectedRegion);\r\n\t\t\t\tselectedRegion.dragEnd(coordinates);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tconst dragMove: any = (event) => {\r\n\t\t\tif (useKey && event[useKey] !== true) { return; }\r\n\t\t\t// GS-854. If we don't have useKey for the click_drag extension,\r\n\t\t\t// check the drag_timeline to not simultaneously use both extensions\r\n\t\t\tconst dragTimeline = this._gantt.ext.clickDrag;\r\n\t\t\tconst dragTimelineUseKey = (this._gantt.config.drag_timeline || {}).useKey;\r\n\t\t\tif (dragTimeline && dragTimelineUseKey) {\r\n\t\t\t\tif (!useKey && event[dragTimelineUseKey]) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet coordinates:any = null;\r\n\t\t\tif(!this._mouseDown && scheduledDndCoordinates){\r\n\t\t\t\tcoordinates = this._getCoordinates(event, selectedRegion);\r\n\t\t\t\tif(Math.abs(scheduledDndCoordinates.relative.left - coordinates.relative.left) > 5){\r\n\t\t\t\t\t// add small threshold not to start dnd on simple click\r\n\t\t\t\t\tstartDragAndDrop();\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (this._mouseDown === true) {\r\n\t\t\t\tcoordinates = this._getCoordinates(event, selectedRegion);\r\n\t\t\t\tselectedRegion.setEnd(coordinates);\r\n\t\t\t\tselectedRegion.render();\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tdetach(): void {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis._domEvents.detachAll();\r\n\t\tif(this._restoreOriginPosition){\r\n\t\t\tthis._restoreOriginPosition();\r\n\t\t}\r\n\r\n\t\tconst state = gantt.$services.getService(\"state\");\r\n\t\tstate.unregisterProvider(\"clickDrag\");\r\n\t}\r\n\r\n\tdestructor(): void {\r\n\t\tthis.detach();\r\n\t}\r\n\r\n\tprivate _getCoordinates(event: MouseEvent, selectedRegion: SelectedRegion) {\r\n\t\tconst viewPort = selectedRegion.getViewPort();\r\n\t\tconst viewPortBounds = viewPort.getBoundingClientRect();\r\n\t\tconst { clientX, clientY } = event;\r\n\t\tconst result = {\r\n\t\t\tabsolute: {\r\n\t\t\t\tleft: clientX,\r\n\t\t\t\ttop: clientY\r\n\t\t\t},\r\n\t\t\trelative: {\r\n\t\t\t\tleft: clientX - viewPortBounds.left + viewPort.scrollLeft,\r\n\t\t\t\ttop: clientY - viewPortBounds.top + viewPort.scrollTop\r\n\t\t\t}\r\n\t\t};\r\n\t\treturn result;\r\n\t}\r\n}","var EventHost = function(){\r\n\tthis._silent_mode = false;\r\n\tthis.listeners = {};\r\n};\r\n\r\nEventHost.prototype = {\r\n\t_silentStart: function() {\r\n\t\tthis._silent_mode = true;\r\n\t},\r\n\t_silentEnd: function() {\r\n\t\tthis._silent_mode = false;\r\n\t}\r\n};\r\n\r\nvar\tcreateEventStorage = function(obj) {\r\n\tvar handlers = {};\r\n\tvar index = 0;\r\n\tvar eventStorage = function(){\r\n\t\tvar combinedResult = true;\r\n\t\tfor(var i in handlers){\r\n\t\t\tvar handlerResult = handlers[i].apply(obj, arguments);\r\n\t\t\tcombinedResult=combinedResult && handlerResult;\r\n\t\t}\r\n\t\treturn combinedResult;\r\n\t};\r\n\teventStorage.addEvent=function(handler, settings){\r\n\t\tif (typeof (handler) == \"function\"){\r\n\t\t\tvar handlerId;\r\n\t\t\tif(settings && settings.id){\r\n\t\t\t\thandlerId = settings.id;\r\n\t\t\t}else{\r\n\t\t\t\thandlerId = index;\r\n\t\t\t\tindex++;\r\n\t\t\t}\r\n\r\n\t\t\tif(settings && settings.once){\r\n\t\t\t\tvar originalHandler = handler;\r\n\t\t\t\thandler = function(){\r\n\t\t\t\t\toriginalHandler();\r\n\t\t\t\t\teventStorage.removeEvent(handlerId);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\thandlers[handlerId] = handler;\r\n\t\t\treturn handlerId;\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n\teventStorage.removeEvent=function(id){\r\n\t\tdelete handlers[id];\r\n\t};\r\n\r\n\teventStorage.clear = function(){\r\n\t\thandlers = {};\r\n\t};\r\n\r\n\treturn eventStorage;\r\n};\r\n\r\nfunction makeEventable(obj){\r\n\r\n\tvar eventHost = new EventHost();\r\n\tobj.attachEvent=function(eventName, handler, settings){\r\n\t\teventName = 'ev_'+eventName.toLowerCase();\r\n\t\tif (!eventHost.listeners[eventName]){\r\n\t\t\teventHost.listeners[eventName] = createEventStorage(this);\r\n\t\t}\r\n\r\n\t\tif(settings && settings.thisObject){\r\n\t\t\thandler = handler.bind(settings.thisObject);\r\n\t\t}\r\n\r\n\t\tvar innerId = eventHost.listeners[eventName].addEvent(handler, settings);\r\n\r\n\t\tvar handlerId = (eventName+':'+innerId); //return ID (ev_eventname:1)\r\n\t\tif(settings && settings.id){\r\n\t\t\thandlerId = settings.id;\r\n\t\t}\r\n\t\treturn handlerId;\r\n\t};\r\n\r\n\tobj.attachAll = function(callback){\r\n\t\tthis.attachEvent('listen_all', callback);\r\n\t};\r\n\r\n\tobj.callEvent=function(name, eventArguments){\r\n\t\tif (eventHost._silent_mode) return true;\r\n\r\n\t\tvar handlerName = 'ev_'+name.toLowerCase();\r\n\r\n\t\tvar listeners = eventHost.listeners;\r\n\t\tif (listeners['ev_listen_all']){\r\n\t\t\tlisteners['ev_listen_all'].apply(this, [name].concat(eventArguments));\r\n\t\t}\r\n\r\n\t\tif (listeners[handlerName])\r\n\t\t\treturn listeners[handlerName].apply(this, eventArguments);\r\n\t\treturn true;\r\n\t};\r\n\r\n\tobj.checkEvent=function(name){\r\n\t\tvar listeners = eventHost.listeners;\r\n\t\treturn (!!listeners['ev_'+name.toLowerCase()]);\r\n\t};\r\n\r\n\tobj.detachEvent=function(id){\r\n\t\tif (id){\r\n\t\t\tvar listeners = eventHost.listeners;\r\n\t\t\tfor(var i in listeners){\r\n\t\t\t\tlisteners[i].removeEvent(id); //remove event\r\n\t\t\t}\r\n\r\n\t\t\tvar list = id.split(':');//get EventName and ID\r\n\t\t\tvar listeners = eventHost.listeners;\r\n\t\t\tif(list.length === 2){\r\n\t\t\t\tvar eventName = list[0];\r\n\t\t\t\tvar eventId = list[1];\r\n\t\t\t\tif(listeners[eventName]){\r\n\t\t\t\t\tlisteners[eventName].removeEvent(eventId); //remove event\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tobj.detachAllEvents = function(){\r\n\t\tfor (var name in eventHost.listeners) {\r\n\t\t\teventHost.listeners[name].clear();\r\n\t\t}\r\n\t};\r\n\r\n}\r\n\r\nexport default makeEventable;","var units = {\r\n\t\"second\": 1,\r\n\t\"minute\": 60,\r\n\t\"hour\": 60 * 60,\r\n\t\"day\": 60 * 60 * 24,\r\n\t\"week\": 60 * 60 * 24 * 7,\r\n\t\"month\": 60 * 60 * 24 * 30,\r\n\t\"quarter\": 60 * 60 * 24 * 30 * 3,\r\n\t\"year\": 60 * 60 * 24 * 365\r\n};\r\nfunction getSecondsInUnit(unit){\r\n\treturn units[unit] || units.hour;\r\n}\r\n\r\nfunction forEach(arr, callback) {\r\n\tif (arr.forEach) {\r\n\t\tarr.forEach(callback);\r\n\t} else {\r\n\t\tvar workArray = arr.slice();\r\n\t\tfor (var i = 0; i < workArray.length; i++) {\r\n\t\t\tcallback(workArray[i], i);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction arrayMap(arr, callback) {\r\n\tif (arr.map) {\r\n\t\treturn arr.map(callback);\r\n\t} else {\r\n\t\tvar workArray = arr.slice();\r\n\t\tvar resArray = [];\r\n\r\n\t\tfor (var i = 0; i < workArray.length; i++) {\r\n\t\t\tresArray.push(callback(workArray[i], i));\r\n\t\t}\r\n\t\treturn resArray;\r\n\t}\r\n}\r\n\r\n\r\nfunction arrayFind(arr, callback) {\r\n\tif (arr.find) {\r\n\t\treturn arr.find(callback);\r\n\t} else {\r\n\t\tfor (var i = 0; i < arr.length; i++) {\r\n\t\t\tif (callback(arr[i], i)) {\r\n\t\t\t\treturn arr[i];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction arrayIncludes(arr, item) {\r\n\tif(arr.includes){\r\n\t\treturn arr.includes(item);\r\n\t}else{\r\n\t\tfor (var i = 0; i < arr.length; i++) {\r\n\t\t\tif (arr[i] === item) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\n// iframe-safe array type check instead of using instanceof\r\nfunction isArray(obj){\r\n\tif(Array.isArray){\r\n\t\treturn Array.isArray(obj);\r\n\t}else{\r\n\t\t// close enough\r\n\t\treturn (obj && obj.length !== undefined && obj.pop && obj.push);\r\n\t}\r\n}\r\n\r\n// non-primitive string object, e.g. new String(\"abc\")\r\nfunction isStringObject(obj){\r\n\treturn obj && typeof obj === \"object\"\r\n\t\t&& Function.prototype.toString.call(obj.constructor) === \"function String() { [native code] }\";\r\n}\r\n\r\n// non-primitive number object, e.g. new Number(5)\r\nfunction isNumberObject(obj){\r\n\treturn obj && typeof obj === \"object\"\r\n\t\t&& Function.prototype.toString.call(obj.constructor) === \"function Number() { [native code] }\";\r\n}\r\n\r\n// non-primitive number object, e.g. new Boolean(true)\r\nfunction isBooleanObject(obj){\r\n\treturn obj && typeof obj === \"object\"\r\n\t\t&& Function.prototype.toString.call(obj.constructor) === \"function Boolean() { [native code] }\";\r\n}\r\n\r\nfunction isDate(obj) {\r\n\tif (obj && typeof obj === \"object\") {\r\n\t\treturn !!(obj.getFullYear && obj.getMonth && obj.getDate);\r\n\t} else {\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nfunction isValidDate(obj){\r\n\treturn isDate(obj) && !isNaN(obj.getTime());\r\n}\r\n\r\nfunction arrayFilter(arr, callback) {\r\n\tvar result = [];\r\n\r\n\tif (arr.filter) {\r\n\t\treturn arr.filter(callback);\r\n\t} else {\r\n\t\tfor (var i = 0; i < arr.length; i++) {\r\n\t\t\tif (callback(arr[i], i)) {\r\n\t\t\t\tresult[result.length] = arr[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n}\r\n\r\nfunction hashToArray(hash) {\r\n\tvar result = [];\r\n\r\n\tfor (var key in hash) {\r\n\t\tif (hash.hasOwnProperty(key)) {\r\n\t\t\tresult.push(hash[key]);\r\n\t\t}\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nfunction arraySome(arr, callback) {\r\n\tif (arr.length === 0) return false;\r\n\r\n\tfor (var i = 0; i < arr.length; i++) {\r\n\t\tif (callback(arr[i], i, arr)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nfunction arrayDifference(arr, callback) {\r\n\treturn arrayFilter(arr, function(item, i) {\r\n\t\treturn !callback(item, i);\r\n\t});\r\n}\r\n\r\nfunction throttle (callback, timeout) {\r\n\tvar wait = false;\r\n\r\n\treturn function () {\r\n\t\tif (!wait) {\r\n\t\t\tcallback.apply(null, arguments);\r\n\t\t\twait = true;\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\twait = false;\r\n\t\t\t}, timeout);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction delay (callback, timeout){\r\n\tvar timer;\r\n\r\n\tvar result = function() {\r\n\t\tresult.$cancelTimeout();\r\n\t\tresult.$pending = true;\r\n\t\tvar args = Array.prototype.slice.call(arguments);\r\n\t\ttimer = setTimeout(function(){\r\n\t\t\tcallback.apply(this, args);\r\n\t\t\tresult.$pending = false;\r\n\t\t}, timeout);\r\n\t};\r\n\r\n\tresult.$pending = false;\r\n\tresult.$cancelTimeout = function(){\r\n\t\tclearTimeout(timer);\r\n\t\tresult.$pending = false;\r\n\t};\r\n\tresult.$execute = function(){\r\n\t\tvar args = Array.prototype.slice.call(arguments);\r\n\t\tcallback.apply(this, args);\r\n\t\tresult.$cancelTimeout();\r\n\t};\r\n\r\n\treturn result;\r\n}\r\n\r\nfunction sortArrayOfHash(arr, field, desc) {\r\n\tvar compare = function(a, b) {\r\n\t\treturn a < b;\r\n\t};\r\n\r\n\tarr.sort(function(a, b) {\r\n\t\tif (a[field] === b[field]) return 0;\r\n\r\n\t\treturn desc ? compare(a[field], b[field]) : compare(b[field], a[field]);\r\n\t});\r\n}\r\n\r\nfunction objectKeys(obj) {\r\n\tif (Object.keys) {\r\n\t\treturn Object.keys(obj);\r\n\t}\r\n\tvar result = [];\r\n\tvar key;\r\n\tfor (key in obj) {\r\n\t\tif (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n\t\t\tresult.push(key);\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}\r\n\r\nfunction isEventable(obj) {\r\n\treturn obj.attachEvent && obj.detachEvent;\r\n}\r\n\r\n//GS-1090: A task should be able to have the id = 0\r\nfunction replaceValidZeroId(id, rootId) {\r\n\tif (checkZeroId(id) && !checkZeroId(rootId)){\r\n\t\tid = \"0\";\r\n\t}\r\n\treturn id;\r\n}\r\n\r\nfunction checkZeroId(id) {\r\n\tif (id === 0){\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nfunction findBinary(array, target) {\r\n\t// modified binary search, target value not exactly match array elements, looking for closest one\r\n\r\n\tvar low = 0, high = array.length - 1, i, item, prev;\r\n\twhile (low <= high) {\r\n\r\n\t\ti = Math.floor((low + high) / 2);\r\n\t\titem = +array[i];\r\n\t\tprev = +array[i - 1];\r\n\t\tif (item < target) {\r\n\t\t\tlow = i + 1;\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif (item > target) {\r\n\t\t\tif (!(!isNaN(prev) && prev < target)) {\r\n\t\t\t\thigh = i - 1;\r\n\t\t\t\tcontinue;\r\n\t\t\t} else {\r\n\t\t\t\t// if target is between 'i' and 'i-1' return 'i - 1'\r\n\t\t\t\treturn i - 1;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\twhile (+array[i] == +array[i + 1]) i++;\r\n\r\n\t\treturn i;\r\n\t}\r\n\treturn array.length - 1;\r\n}\r\n\r\nexport {\r\n\tgetSecondsInUnit,\r\n\tforEach,\r\n\tarrayMap,\r\n\tarrayIncludes,\r\n\tarrayFind,\r\n\tarrayFilter,\r\n\tarrayDifference,\r\n\tarraySome,\r\n\thashToArray,\r\n\tsortArrayOfHash,\r\n\tthrottle,\r\n\tisArray,\r\n\tisDate,\r\n\tisValidDate,\r\n\tisStringObject,\r\n\tisNumberObject,\r\n\tisBooleanObject,\r\n\tdelay,\r\n\tobjectKeys,\r\n\tisEventable,\r\n\treplaceValidZeroId,\r\n\tcheckZeroId,\r\n\tfindBinary\r\n};","import eventable from \"../../utils/eventable\";\r\nimport { isEventable } from \"../../utils/helpers\";\r\n\r\nexport interface ISelectedRegionConfig {\r\n\tclassName?: string;\r\n\trender?: (startPoint: IPoint, endPoint: IPoint) => HTMLElement;\r\n\tviewPort?: HTMLElement;\r\n\tuseRequestAnimationFrame: boolean;\r\n\tcallback?: (startPoint: IPoint, endPoint: IPoint, startDate: Date, endDate: Date, tasksByDate: any[], tasksByIndex: any[]) => void;\r\n\tsingleRow: boolean;\r\n}\r\n\r\ninterface ICoordinates {\r\n\tleft: number;\r\n\ttop: number;\r\n}\r\n\r\nexport interface IPoint {\r\n\tabsolute: ICoordinates;\r\n\trelative: ICoordinates;\r\n}\r\n\r\nexport class SelectedRegion {\r\n\trender: () => void;\r\n\tprivate _viewPort: HTMLElement & eventable;\r\n\tprivate _el: HTMLElement = document.createElement(\"div\");\r\n\tprivate _callback: (startPoint: IPoint, endPoint: IPoint, startDate: Date, endDate: Date, tasksByDate: any[], tasksByIndex: any[]) => void;\r\n\tprivate _startPoint: IPoint;\r\n\tprivate _endPoint: IPoint;\r\n\tprivate _positionPoint: IPoint;\r\n\tprivate _useRequestAnimationFrame: boolean;\r\n\tprivate _startDate: Date;\r\n\tprivate _endDate: Date;\r\n\tprivate _singleRow: boolean;\r\n\tprivate _gantt: any;\r\n\tprivate _view: any;\r\n\r\n\tconstructor(config: ISelectedRegionConfig, gantt: any, view: any) {\r\n\t\tthis._gantt = gantt;\r\n\t\tthis._view = view;\r\n\t\tthis._viewPort = config.viewPort;\r\n\t\tthis._el.classList.add(config.className);\r\n\t\tif (typeof config.callback === \"function\") {\r\n\t\t\tthis._callback = config.callback;\r\n\t\t}\r\n\r\n\t\tthis.render = () => {\r\n\t\t\tlet node;\r\n\t\t\tif(config.render){\r\n\t\t\t\tnode = config.render(this._startPoint, this._endPoint);\r\n\t\t\t}else{\r\n\t\t\t\tnode = this.defaultRender(this._startPoint, this._endPoint);\r\n\t\t\t}\r\n\r\n\t\t\tif(node !== this._el){\r\n\t\t\t\tif(this._el && this._el.parentNode){\r\n\t\t\t\t\tthis._el.parentNode.removeChild(this._el);\r\n\t\t\t\t}\r\n\t\t\t\tthis._el = node;\r\n\t\t\t}\r\n\r\n\t\t\tif (config.className !== \"\") {\r\n\t\t\t\tthis._el.classList.add(config.className);\r\n\t\t\t}\r\n\t\t\tthis.draw();\r\n\t\t};\r\n\r\n\t\tif (!isEventable(this._viewPort)) {\r\n\t\t\teventable(this._viewPort);\r\n\t\t}\r\n\t\tthis._singleRow = config.singleRow;\r\n\t\tthis._useRequestAnimationFrame = config.useRequestAnimationFrame;\r\n\t}\r\n\r\n\tdefaultRender = (start: IPoint, end: IPoint) => {\r\n\t\tif(!this._el){\r\n\t\t\tthis._el = document.createElement(\"div\");\r\n\t\t}\r\n\t\tconst node = this._el;\r\n\t\t// const gantt = this._gantt;\r\n\r\n\t\tconst top = Math.min(start.relative.top, end.relative.top);\r\n\t\tconst bottom = Math.max(start.relative.top, end.relative.top);\r\n\t\tconst left = Math.min(start.relative.left, end.relative.left);\r\n\t\tconst right = Math.max(start.relative.left, end.relative.left);\r\n\r\n\t\tif (this._singleRow) {\r\n\t\t\tconst pos = this._getTaskPositionByTop(this._startPoint.relative.top);\r\n\t\t\tnode.style.height = pos.height + \"px\";\r\n\t\t\tnode.style.top = pos.top + \"px\";\r\n\t\t} else {\r\n\t\t\tnode.style.height = Math.abs(bottom - top) + \"px\";\r\n\t\t\tnode.style.top = top + \"px\";\r\n\t\t}\r\n\t\tnode.style.width = Math.abs(right - left) + \"px\";\r\n\t\tnode.style.left = left + \"px\";\r\n\t\treturn node;\r\n\t};\r\n\r\n\tdraw() {\r\n\t\tif (this._useRequestAnimationFrame) {\r\n\t\t\treturn requestAnimationFrame(() => {\r\n\t\t\t\tthis._viewPort.appendChild(this.getElement());\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tthis._viewPort.appendChild(this.getElement());\r\n\t\t}\r\n\t}\r\n\r\n\tclear() {\r\n\t\tif (this._useRequestAnimationFrame) {\r\n\t\t\treturn requestAnimationFrame(() => {\r\n\t\t\t\tif (!this._el.parentNode) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis._viewPort.removeChild(this._el);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tif (!this._el.parentNode) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis._viewPort.removeChild(this._el);\r\n\t\t}\r\n\t}\r\n\r\n\tgetElement() {\r\n\t\treturn this._el;\r\n\t}\r\n\r\n\tgetViewPort() {\r\n\t\treturn this._viewPort;\r\n\t}\r\n\r\n\tsetStart(startPoint: IPoint) {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis._startPoint = startPoint;\r\n\t\tthis._startDate = gantt.dateFromPos(this._startPoint.relative.left);\r\n\t\tthis._viewPort.callEvent(\"onBeforeDrag\", [this._startPoint]);\r\n\t}\r\n\r\n\tsetEnd(endPoint: IPoint) {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis._endPoint = endPoint;\r\n\t\tif (this._singleRow) {\r\n\t\t\tconst pos = this._getTaskPositionByTop(this._startPoint.relative.top);\r\n\t\t\tthis._endPoint.relative.top = pos.top;\r\n\t\t}\r\n\t\tthis._endDate = gantt.dateFromPos(this._endPoint.relative.left);\r\n\t\tif (this._startPoint.relative.left > this._endPoint.relative.left) {\r\n\t\t\tthis._positionPoint = {\r\n\t\t\t\trelative: { left: this._endPoint.relative.left, top: this._positionPoint.relative.top },\r\n\t\t\t\tabsolute: { left: this._endPoint.absolute.left, top: this._positionPoint.absolute.top }\r\n\t\t\t};\r\n\t\t}\r\n\t\tif (this._startPoint.relative.top > this._endPoint.relative.top) {\r\n\t\t\tthis._positionPoint = {\r\n\t\t\t\trelative: { left: this._positionPoint.relative.left, top: this._endPoint.relative.top },\r\n\t\t\t\tabsolute: { left: this._positionPoint.absolute.left, top: this._endPoint.absolute.top }\r\n\t\t\t};\r\n\t\t}\r\n\r\n\r\n\t\tthis._viewPort.callEvent(\"onDrag\", [this._startPoint, this._endPoint]);\r\n\t}\r\n\r\n\tsetPosition(positionPoint: IPoint) {\r\n\t\tthis._positionPoint = positionPoint;\r\n\t}\r\n\r\n\tdragEnd(endPoint: IPoint) {\r\n\t\tconst gantt = this._gantt;\r\n\t\tif(endPoint.relative.left < 0){\r\n\t\t\tendPoint.relative.left = 0;\r\n\t\t}\r\n\t\tthis._viewPort.callEvent(\"onBeforeDragEnd\", [this._startPoint, endPoint]);\r\n\t\tthis.setEnd(endPoint);\r\n\t\t// GS-1422. The endDate can be null if we drag the mouse outside the Gantt container\r\n\t\tthis._endDate = this._endDate || gantt.getState().max_date;\r\n\r\n\t\tif (this._startDate.valueOf() > this._endDate.valueOf()) {\r\n\t\t\t[ this._startDate, this._endDate ] = [ this._endDate, this._startDate ];\r\n\t\t}\r\n\t\tthis.clear();\r\n\t\tconst tasksByTime = gantt.getTaskByTime(this._startDate, this._endDate);\r\n\t\tconst tasksByIndex = this._getTasksByTop(this._startPoint.relative.top, this._endPoint.relative.top);\r\n\r\n\t\tthis._viewPort.callEvent(\"onDragEnd\", [this._startPoint, this._endPoint]);\r\n\t\tif (this._callback) {\r\n\t\t\tthis._callback(this._startPoint, this._endPoint, this._startDate, this._endDate, tasksByTime, tasksByIndex);\r\n\t\t}\r\n\t}\r\n\r\n\tgetInBounds() {\r\n\t\treturn this._singleRow;\r\n\t}\r\n\r\n\tprivate _getTasksByTop(start: number, end:number) {\r\n\t\tconst gantt = this._gantt;\r\n\t\tlet startValue = start;\r\n\t\tlet endValue = end;\r\n\t\tif (start > end) {\r\n\t\t\tstartValue = end;\r\n\t\t\tendValue = start;\r\n\t\t}\r\n\t\tconst startIndex = this._getTaskPositionByTop(startValue).index;\r\n\t\tconst endIndex = this._getTaskPositionByTop(endValue).index;\r\n\t\tconst result = [];\r\n\t\tfor (let i = startIndex; i <= endIndex; i++) {\r\n\t\t\tconst task = gantt.getTaskByIndex(i);\r\n\t\t\tif (task) {\r\n\t\t\t\tresult.push(gantt.getTaskByIndex(i));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprivate _getTaskPositionByTop(top: number){\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst view = this._view;\r\n\t\tconst index = view.getItemIndexByTopPosition(top);\r\n\t\tconst task = gantt.getTaskByIndex(index);\r\n\t\tif(task){\r\n\t\t\tconst height = view.getItemHeight(task.id);\r\n\t\t\tconst itemTop = view.getItemTop(task.id);\r\n\t\t\treturn {\r\n\t\t\t\ttop: itemTop || 0,\r\n\t\t\t\theight: height || 0,\r\n\t\t\t\tindex\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tconst dataHeight = view.getTotalHeight();\r\n\t\t\treturn {\r\n\t\t\t\ttop: top > dataHeight ? dataHeight : 0,\r\n\t\t\t\theight: gantt.config.row_height,\r\n\t\t\t\tindex: top > dataHeight ? gantt.getTaskCount() : 0\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n}","import { EventsManager } from \"./eventsManager\";\r\nimport { ISelectedRegionConfig, SelectedRegion } from \"./selectedRegion\";\r\n\r\nexport default function(gantt: any){\r\n\tif (!gantt.ext) {\r\n\t\tgantt.ext = {};\r\n\t}\r\n\r\n\tconst defaultConfig: ISelectedRegionConfig = {\r\n\t\tclassName: \"gantt_click_drag_rect\",\r\n\t\tuseRequestAnimationFrame: true,\r\n\t\tcallback: undefined,\r\n\t\tsingleRow: false\r\n\t};\r\n\r\n\tfunction setClickDrag(){\r\n\t\tconst config: ISelectedRegionConfig = { viewPort: gantt.$task_data, ...defaultConfig };\r\n\t\tif (gantt.ext.clickDrag){\r\n\t\t\tgantt.ext.clickDrag.destructor();\r\n\t\t}\r\n\t\tgantt.ext.clickDrag = new EventsManager(gantt);\r\n\t\tconst clickDrag = gantt.config.click_drag;\r\n\t\tconfig.render = clickDrag.render || defaultConfig.render;\r\n\t\tconfig.className = clickDrag.className || defaultConfig.className;\r\n\t\tconfig.callback = clickDrag.callback || defaultConfig.callback;\r\n\t\tconfig.viewPort = clickDrag.viewPort || gantt.$task_data;\r\n\t\tconfig.useRequestAnimationFrame = clickDrag.useRequestAnimationFrame === undefined ?\r\n\t\t\tdefaultConfig.useRequestAnimationFrame : clickDrag.useRequestAnimationFrame;\r\n\r\n\t\tconfig.singleRow = clickDrag.singleRow === undefined ? defaultConfig.singleRow : clickDrag.singleRow;\r\n\t\tconst timeline = gantt.$ui.getView(\"timeline\");\r\n\t\tconst selectedRegion = new SelectedRegion(config, gantt, timeline);\r\n\t\tgantt.ext.clickDrag.attach(selectedRegion, clickDrag.useKey, clickDrag.ignore);\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onGanttReady\", () => {\r\n\t\tif (gantt.config.click_drag){\r\n\t\t\tsetClickDrag();\r\n\t\t}\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onGanttLayoutReady\", function(){\r\n\t\tif (gantt.$container && gantt.config.click_drag){\r\n\t\t\tgantt.attachEvent(\"onGanttRender\", function(){\r\n\t\t\t\tsetClickDrag();\r\n\t\t\t}, {once:true});\r\n\t\t}\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onDestroy\", () => {\r\n\t\tif (gantt.ext.clickDrag){\r\n\t\t\tgantt.ext.clickDrag.destructor();\r\n\t\t}\r\n\t});\r\n\r\n}","interface IPoint {\r\n\tx: number;\r\n\ty: number;\r\n}\r\n\r\nlet _dragInProgress: boolean = false;\r\n\r\nexport class EventsManager {\r\n\tstatic create(gantt: any) {\r\n\t\treturn new EventsManager(gantt);\r\n\t}\r\n\tstatic _isDragInProgress() {\r\n\t\treturn _dragInProgress;\r\n\t}\r\n\tprivate _mouseDown: boolean = false;\r\n\tprivate _startPoint: IPoint;\r\n\tprivate _scrollState: IPoint;\r\n\tprivate _originAutoscroll: boolean;\r\n\tprivate _domEvents: any;\r\n\tprivate _timeline: any;\r\n\tprivate _gantt: any;\r\n\tprivate _trace: IPoint[];\r\n\tprivate _originalReadonly: boolean;\r\n\r\n\tconstructor(gantt: any) {\r\n\t\tthis._gantt = gantt;\r\n\t\tthis._domEvents = gantt._createDomEventScope();\r\n\t\tthis._trace = [];\r\n\t}\r\n\r\n\tdestructor() {\r\n\t\tthis._domEvents.detachAll();\r\n\t}\r\n\r\n\tattach(timeline: any): void {\r\n\t\tthis._timeline = timeline;\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis._domEvents.attach(timeline.$task, \"mousedown\", (event) => {\r\n\t\t\tif (!gantt.config.drag_timeline) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst { useKey,ignore, enabled } = gantt.config.drag_timeline;\r\n\t\t\tif(enabled === false) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet filterTargets = \".gantt_task_line, .gantt_task_link\";\r\n\t\t\tif(ignore !== undefined) {\r\n\t\t\t\tif(ignore instanceof Array){\r\n\t\t\t\t\tfilterTargets = ignore.join(\", \");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfilterTargets = ignore;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (filterTargets) {\r\n\t\t\t\tif (gantt.utils.dom.closest(event.target, filterTargets)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (useKey && event[useKey] !== true) { return; }\r\n\r\n\t\t\tthis._startDrag(event);\r\n\t\t});\r\n\r\n\t\tthis._domEvents.attach(document, \"keydown\", (event) => {\r\n\t\t\tif (!gantt.config.drag_timeline) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst { useKey } = gantt.config.drag_timeline;\r\n\t\t\tif (useKey && event[useKey] === true) {\r\n\t\t\t\tthis._applyDndReadyStyles();\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis._domEvents.attach(document, \"keyup\", (event) => {\r\n\t\t\tif (!gantt.config.drag_timeline) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst { useKey } = gantt.config.drag_timeline;\r\n\t\t\tif (useKey && event[useKey] === false) {\r\n\t\t\t\tthis._clearDndReadyStyles();\r\n\t\t\t\tthis._stopDrag(event);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis._domEvents.attach(document, \"mouseup\", (event) => {\r\n\t\t\tthis._stopDrag(event);\r\n\t\t});\r\n\t\tthis._domEvents.attach(gantt.$root, \"mouseup\", (event) => {\r\n\t\t\tthis._stopDrag(event);\r\n\t\t});\r\n\t\tthis._domEvents.attach(document, \"mouseleave\", (event) => {\r\n\t\t\tthis._stopDrag(event);\r\n\t\t});\r\n\t\tthis._domEvents.attach(gantt.$root, \"mouseleave\", (event) => {\r\n\t\t\tthis._stopDrag(event);\r\n\t\t});\r\n\r\n\t\tthis._domEvents.attach(gantt.$root, \"mousemove\", (event) => {\r\n\t\t\tif (!gantt.config.drag_timeline) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst { useKey } = gantt.config.drag_timeline;\r\n\t\t\tif (useKey && event[useKey] !== true) { return; }\r\n\t\t\t// GS-854. If we don't have useKey for the drag_timeline extension,\r\n\t\t\t// check the click_drag to not simultaneously use both extensions\r\n\t\t\tconst clickDrag = this._gantt.ext.clickDrag;\r\n\t\t\tconst clickDragUseKey = (this._gantt.config.click_drag || {}).useKey;\r\n\t\t\tif (clickDrag && clickDragUseKey) {\r\n\t\t\t\tif (!useKey && event[clickDragUseKey]) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this._mouseDown === true) {\r\n\t\t\t\tthis._trace.push({ x: event.clientX, y: event.clientY });\r\n\t\t\t\tconst scrollPosition: IPoint = this._countNewScrollPosition({ x: event.clientX, y: event.clientY });\r\n\t\t\t\tthis._setScrollPosition(timeline, scrollPosition);\r\n\t\t\t\tthis._scrollState = scrollPosition;\r\n\t\t\t\tthis._startPoint = { x: event.clientX, y: event.clientY };\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprivate _calculateDirectionVector = () => {\r\n\t\tconst traceSteps = 10;\r\n\t\tif(this._trace.length >= traceSteps) {\r\n\t\t\tconst dots = this._trace.slice(this._trace.length - traceSteps);\r\n\r\n\t\t\tconst vectors = [];\r\n\t\t\tfor(let i = 1; i < dots.length; i++) {\r\n\t\t\t\tvectors.push({\r\n\t\t\t\t\tx: dots[i].x - dots[i - 1].x,\r\n\t\t\t\t\ty: dots[i].y - dots[i - 1].y\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tconst resultVector = {x:0, y:0};\r\n\r\n\t\t\tvectors.forEach((vector) => {\r\n\t\t\t\tresultVector.x += vector.x;\r\n\t\t\t\tresultVector.y += vector.y;\r\n\t\t\t});\r\n\r\n\t\t\tconst magnitude = Math.sqrt(resultVector.x*resultVector.x + resultVector.y*resultVector.y);\r\n\t\t\tconst angleDegrees = Math.atan2(Math.abs(resultVector.y), Math.abs(resultVector.x)) * 180 / Math.PI;\r\n\r\n\t\t\treturn {\r\n\t\t\t\tmagnitude,\r\n\t\t\t\tangleDegrees\r\n\t\t\t};\r\n\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n\r\n\tprivate _applyDndReadyStyles = (): void => {\r\n\t\tthis._timeline.$task.classList.add(\"gantt_timeline_move_available\");\r\n\t};\r\n\r\n\tprivate _clearDndReadyStyles = (): void => {\r\n\t\tthis._timeline.$task.classList.remove(\"gantt_timeline_move_available\");\r\n\t};\r\n\r\n\tprivate _getScrollPosition = (timeline: any): IPoint => {\r\n\t\tconst gantt = this._gantt;\r\n\t\treturn {\r\n\t\t\tx: gantt.$ui.getView(timeline.$config.scrollX).getScrollState().position,\r\n\t\t\ty: gantt.$ui.getView(timeline.$config.scrollY).getScrollState().position\r\n\t\t};\r\n\t};\r\n\tprivate _countNewScrollPosition = (coords: IPoint): IPoint => {\r\n\t\tconst vector = this._calculateDirectionVector();\r\n\t\tlet shiftX = this._startPoint.x - coords.x;\r\n\t\tlet shiftY = this._startPoint.y - coords.y;\r\n\t\tif(vector){\r\n\t\t\tif(vector.angleDegrees < 15){\r\n\t\t\t\tshiftY = 0;\r\n\t\t\t} else if(vector.angleDegrees > 75){\r\n\t\t\t\tshiftX = 0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst result = {\r\n\t\t\tx: this._scrollState.x + shiftX,\r\n\t\t\ty: this._scrollState.y + shiftY\r\n\t\t};\r\n\t\treturn result;\r\n\t};\r\n\tprivate _setScrollPosition = (timeline: any, coords: IPoint): void => {\r\n\t\tconst gantt = this._gantt;\r\n\t\trequestAnimationFrame(() => {\r\n\t\t\tgantt.scrollLayoutCell(timeline.$id, coords.x, coords.y);\r\n\t\t});\r\n\t};\r\n\tprivate _stopDrag = (event: Event): void => {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis._trace = [];\r\n\t\tgantt.$root.classList.remove(\"gantt_noselect\");\r\n\r\n\t\t// We need to set the readonly mode because with the key modifiers, \r\n\t\t// users may expect to start dragging the timeline on the task and link coordinates\r\n\t\tif(this._originalReadonly !== undefined && this._mouseDown){\r\n\t\t\tgantt.config.readonly = this._originalReadonly;\r\n\t\t\tif(gantt.config.drag_timeline && gantt.config.drag_timeline.render){\r\n\t\t\t\tgantt.render();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(this._originAutoscroll !== undefined){\r\n\t\t\tgantt.config.autoscroll = this._originAutoscroll;\r\n\t\t}\r\n\r\n\t\tif(gantt.config.drag_timeline){\r\n\t\t\tconst { useKey } = gantt.config.drag_timeline;\r\n\t\t\tif (useKey && event[useKey] !== true) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._mouseDown = false;\r\n\t\t_dragInProgress = false;\r\n\t};\r\n\r\n\tprivate _startDrag = (event: any) : void => {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis._originAutoscroll = gantt.config.autoscroll;\r\n\t\tgantt.config.autoscroll = false;\r\n\t\t_dragInProgress = true;\r\n\r\n\t\tgantt.$root.classList.add(\"gantt_noselect\");\r\n\t\tthis._originalReadonly = gantt.config.readonly;\r\n\t\tgantt.config.readonly = true;\r\n\r\n\t\tif(gantt.config.drag_timeline && gantt.config.drag_timeline.render){\r\n\t\t\tgantt.render();\r\n\t\t}\r\n\r\n\t\tthis._trace = [];\r\n\t\tthis._mouseDown = true;\r\n\t\tconst { x, y } = this._getScrollPosition(this._timeline);\r\n\t\tthis._scrollState = { x, y };\r\n\t\tthis._startPoint = { x: event.clientX, y: event.clientY };\r\n\t\tthis._trace.push(this._startPoint);\r\n\t};\r\n}","import { EventsManager } from \"./eventsManager\";\r\nexport default function(gantt: any){\r\n\tif (!gantt.ext){\r\n\t\tgantt.ext = {};\r\n\t}\r\n\r\n\tgantt.ext.dragTimeline = {\r\n\t\tcreate: () => EventsManager.create(gantt),\r\n\t\t_isDragInProgress: () => EventsManager._isDragInProgress\r\n\t};\r\n\r\n\tgantt.config.drag_timeline = {\r\n\t\tenabled: true,\r\n\t\trender: false\r\n\t};\r\n}","import * as helpers from \"./helpers\";\r\n\r\nvar plainObjectConstructor = ({}).constructor.toString();\r\nfunction isCustomType(object){\r\n\tvar constructorString = object.constructor.toString();\r\n\r\n\treturn constructorString !== plainObjectConstructor;\r\n}\r\n\r\nfunction isExternalType(object){\r\n\t// react elements are not plain objects, but they are not custom types either\r\n\t// can't deep copy them\r\n\treturn object.$$typeof && object.$$typeof.toString().includes(\"react.\");\r\n}\r\n\r\nfunction copy(object) {\r\n\tvar i, result; // iterator, types array, result\r\n\r\n\tif (object && typeof object == \"object\") {\r\n\r\n\t\tswitch (true){\r\n\t\t\tcase (helpers.isDate(object)):\r\n\t\t\t\tresult = new Date(object);\r\n\t\t\t\tbreak;\r\n\t\t\tcase (helpers.isArray(object)):\r\n\t\t\t\tresult = new Array(object.length);\r\n\t\t\t\tfor(i = 0; i < object.length; i++){\r\n\t\t\t\t\tresult[i] = copy(object[i]);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t/*\t\tcase (helpers.isStringObject(object)):\r\n\t\t\t\tresult = new String(object);\r\n\t\t\t\tbreak;\r\n\t\t\tcase (helpers.isNumberObject(object)):\r\n\t\t\t\tresult = new Number(object);\r\n\t\t\t\tbreak;\r\n\t\t\tcase (helpers.isBooleanObject(object)):\r\n\t\t\t\tresult = new Boolean(object);\r\n\t\t\t\tbreak;*/\r\n\t\t\tdefault:\r\n\t\t\t\tif(isCustomType(object)){\r\n\t\t\t\t\tresult = Object.create(object);\r\n\t\t\t\t}else if (isExternalType(object)){\r\n\t\t\t\t\tresult = object;\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult = {};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (i in object) {\r\n\t\t\t\t\tif (Object.prototype.hasOwnProperty.apply(object, [i]))\r\n\t\t\t\t\t\tresult[i] = copy(object[i]);\r\n\t\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\treturn result || object;\r\n}\r\n\r\nfunction mixin (target, source, force){\r\n\tfor (var f in source)\r\n\t\tif (((target[f] === undefined) || force)) target[f]=source[f];\r\n\treturn target;\r\n}\r\n\r\nfunction defined(obj) {\r\n\treturn typeof(obj) != \"undefined\";\r\n}\r\n\r\nvar seed;\r\nfunction uid() {\r\n\tif (!seed)\r\n\t\tseed = (new Date()).valueOf();\r\n\r\n\tseed++;\r\n\treturn seed;\r\n}\r\n\r\n//creates function with specified \"this\" pointer\r\nfunction bind(functor, object){\r\n\tif(functor.bind)\r\n\t\treturn functor.bind(object);\r\n\telse\r\n\t\treturn function(){ return functor.apply(object,arguments); };\r\n}\r\n\r\nfunction event(el, event, handler, capture){\r\n\tif (el.addEventListener)\r\n\t\tel.addEventListener(event, handler, capture === undefined ? false : capture);\r\n\r\n\telse if (el.attachEvent)\r\n\t\tel.attachEvent(\"on\"+event, handler);\r\n}\r\n\r\nfunction eventRemove(el, event, handler, capture){\r\n\tif (el.removeEventListener)\r\n\t\tel.removeEventListener(event, handler, capture === undefined ? false : capture);\r\n\r\n\telse if (el.detachEvent)\r\n\t\tel.detachEvent(\"on\"+event, handler);\r\n}\r\n\r\nexport {\r\n\tcopy,\r\n\tdefined,\r\n\tmixin,\r\n\tuid,\r\n\tbind,\r\n\tevent,\r\n\teventRemove\r\n};","import * as utils from \"../../../utils/utils\";\r\n\r\nfunction ScaleHelper(gantt){\r\n\tvar dateHelper = gantt.date;\r\n\tvar services = gantt.$services;\r\n\r\n\treturn {\r\n\t\tgetSum: function (sizes, from, to) {\r\n\t\t\tif (to === undefined)\r\n\t\t\t\tto = sizes.length - 1;\r\n\t\t\tif (from === undefined)\r\n\t\t\t\tfrom = 0;\r\n\r\n\t\t\tvar summ = 0;\r\n\t\t\tfor (var i = from; i <= to; i++)\r\n\t\t\t\tsumm += sizes[i];\r\n\r\n\t\t\treturn summ;\r\n\t\t},\r\n\t\tsetSumWidth: function (sum_width, scale, from, to) {\r\n\t\t\tvar parts = scale.width;\r\n\r\n\t\t\tif (to === undefined)\r\n\t\t\t\tto = parts.length - 1;\r\n\t\t\tif (from === undefined)\r\n\t\t\t\tfrom = 0;\r\n\t\t\tvar length = to - from + 1;\r\n\r\n\t\t\tif (from > parts.length - 1 || length <= 0 || to > parts.length - 1)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tvar oldWidth = this.getSum(parts, from, to);\r\n\r\n\t\t\tvar diff = sum_width - oldWidth;\r\n\r\n\t\t\tthis.adjustSize(diff, parts, from, to);\r\n\t\t\tthis.adjustSize(-diff, parts, to + 1);\r\n\r\n\t\t\tscale.full_width = this.getSum(parts);\r\n\t\t},\r\n\t\tsplitSize: function (width, count) {\r\n\t\t\tvar arr = [];\r\n\t\t\tfor (var i = 0; i < count; i++) arr[i] = 0;\r\n\r\n\t\t\tthis.adjustSize(width, arr);\r\n\t\t\treturn arr;\r\n\r\n\t\t},\r\n\t\tadjustSize: function (width, parts, from, to) {\r\n\t\t\tif (!from)\r\n\t\t\t\tfrom = 0;\r\n\t\t\tif (to === undefined)\r\n\t\t\t\tto = parts.length - 1;\r\n\r\n\t\t\tvar length = to - from + 1;\r\n\r\n\t\t\tvar full = this.getSum(parts, from, to);\r\n\r\n\t\t\tfor (var i = from; i <= to; i++) {\r\n\t\t\t\tvar share = Math.floor(width * (full ? (parts[i] / full) : (1 / length)));\r\n\r\n\t\t\t\tfull -= parts[i];\r\n\t\t\t\twidth -= share;\r\n\t\t\t\tlength--;\r\n\r\n\t\t\t\tparts[i] += share;\r\n\t\t\t}\r\n\t\t\tparts[parts.length - 1] += width;\r\n\t\t},\r\n\t\tsortScales: function (scales) {\r\n\t\t\tfunction cellSize(unit, step) {\r\n\t\t\t\tvar d = new Date(1970, 0, 1);\r\n\t\t\t\treturn dateHelper.add(d, step, unit) - d;\r\n\t\t\t}\r\n\r\n\t\t\tscales.sort(function (a, b) {\r\n\t\t\t\tif (cellSize(a.unit, a.step) < cellSize(b.unit, b.step)) {\r\n\t\t\t\t\treturn 1;\r\n\t\t\t\t} else if (cellSize(a.unit, a.step) > cellSize(b.unit, b.step)) {\r\n\t\t\t\t\treturn -1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tfor (var i = 0; i < scales.length; i++) {\r\n\t\t\t\tscales[i].index = i;\r\n\t\t\t}\r\n\t\t},\r\n\t\t_prepareScaleObject: function(scale){\r\n\t\t\tvar format = scale.format;\r\n\t\t\tif(!format){\r\n\t\t\t\tformat = scale.template || scale.date || \"%d %M\";\r\n\t\t\t}\r\n\r\n\t\t\tif(typeof format === \"string\"){\r\n\t\t\t\tformat = gantt.date.date_to_str(format);\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\tunit: scale.unit || \"day\",\r\n\t\t\t\tstep: scale.step || 1,\r\n\t\t\t\tformat: format,\r\n\t\t\t\tcss: scale.css,\r\n\t\t\t\tprojection: scale.projection || null,\r\n\t\t\t\tcolumn_width: scale.column_width || null\r\n\t\t\t};\r\n\t\t},\r\n\t\tprimaryScale: function(config) {\r\n\t\t\tconst scaleConfig = config || gantt.config;\r\n\r\n\t\t\tconst primaryScale = scaleConfig.scales[0];\r\n\t\t\tconst result = {\r\n\t\t\t\tunit: primaryScale.unit,\r\n\t\t\t\tstep: primaryScale.step,\r\n\t\t\t\ttemplate: primaryScale.template,\r\n\t\t\t\tformat: primaryScale.format,\r\n\t\t\t\tdate: primaryScale.date,\r\n\t\t\t\tcss: primaryScale.css || gantt.templates.scale_cell_class,\r\n\t\t\t\tprojection: primaryScale.projection || null,\r\n\t\t\t\tcolumn_width: primaryScale.column_width || null\r\n\t\t\t};\r\n\r\n\t\t\treturn this._prepareScaleObject(result);\r\n\t\t},\r\n\t\tgetAdditionalScales: function(config) {\r\n\t\t\tconst scaleConfig = config || gantt.config;\r\n\t\t\tconst scales = scaleConfig.scales.slice(1);\r\n\r\n\t\t\treturn scales.map(function(scale){\r\n\t\t\t\treturn this._prepareScaleObject(scale);\r\n\t\t\t}.bind(this));\r\n\t\t},\r\n\t\tprepareConfigs: function (scales, min_coll_width, container_width, scale_height, minDate, maxDate, rtl) {\r\n\t\t\tvar heights = this.splitSize(scale_height, scales.length);\r\n\t\t\tvar full_width = container_width;\r\n\r\n\t\t\tvar configs = [];\r\n\t\t\tfor (var i = scales.length - 1; i >= 0; i--) {\r\n\t\t\t\tvar main_scale = (i == scales.length - 1);\r\n\t\t\t\tvar cfg = this.initScaleConfig(scales[i], minDate, maxDate);\r\n\t\t\t\tif (main_scale) {\r\n\t\t\t\t\tthis.processIgnores(cfg);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(main_scale && cfg.column_width){\r\n\t\t\t\t\tfull_width = cfg.column_width * (cfg.display_count || cfg.count);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.initColSizes(cfg, min_coll_width, full_width, heights[i]);\r\n\t\t\t\tthis.limitVisibleRange(cfg);\r\n\r\n\t\t\t\tif (main_scale) {\r\n\t\t\t\t\tfull_width = cfg.full_width;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconfigs.unshift(cfg);\r\n\t\t\t}\r\n\r\n\r\n\t\t\tfor (var i = 0; i < configs.length - 1; i++) {\r\n\t\t\t\tthis.alineScaleColumns(configs[configs.length - 1], configs[i]);\r\n\t\t\t}\r\n\t\t\tfor (var i = 0; i < configs.length; i++) {\r\n\r\n\t\t\t\tif(rtl){\r\n\t\t\t\t\tthis.reverseScale(configs[i]);\r\n\t\t\t\t}\r\n\t\t\t\tthis.setPosSettings(configs[i]);\r\n\t\t\t}\r\n\t\t\treturn configs;\r\n\r\n\t\t},\r\n\r\n\t\treverseScale: function(scale){\r\n\t\t\tscale.width = scale.width.reverse();\r\n\t\t\tscale.trace_x = scale.trace_x.reverse();\r\n\r\n\t\t\tvar indexes = scale.trace_indexes;\r\n\t\t\tscale.trace_indexes = {};\r\n\t\t\tscale.trace_index_transition = {};\r\n\t\t\tscale.rtl = true;\r\n\t\t\tfor(var i = 0; i < scale.trace_x.length; i++){\r\n\t\t\t\tscale.trace_indexes[scale.trace_x[i].valueOf()] = i;\r\n\t\t\t\tscale.trace_index_transition[indexes[scale.trace_x[i].valueOf()]] = i;\r\n\t\t\t}\r\n\t\t\treturn scale;\r\n\t\t},\r\n\r\n\t\tsetPosSettings: function (config) {\r\n\t\t\tfor (var i = 0, len = config.trace_x.length; i < len; i++) {\r\n\t\t\t\tconfig.left.push((config.width[i - 1] || 0) + (config.left[i - 1] || 0));\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_ignore_time_config: function (date, scale) {\r\n\r\n\t\t\tif (gantt.config.skip_off_time) {\r\n\t\t\t\tvar skip = true;\r\n\t\t\t\tvar probe = date;\r\n\r\n\t\t\t\t// check dates in case custom scale unit, e.g. {unit: \"month\", step: 3}\r\n\t\t\t\tfor (var i = 0; i < scale.step; i++) {\r\n\t\t\t\t\tif (i) {\r\n\t\t\t\t\t\tprobe = dateHelper.add(date, i, scale.unit);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tskip = skip && !this.isWorkTime(probe, scale.unit);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn skip;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\t//defined in an extension\r\n\t\tprocessIgnores: function (config) {\r\n\t\t\tconfig.ignore_x = {};\r\n\t\t\tconfig.display_count = config.count;\r\n\t\t},\r\n\t\tinitColSizes: function (config, min_col_width, full_width, line_height) {\r\n\t\t\tvar cont_width = full_width;\r\n\r\n\t\t\tconfig.height = line_height;\r\n\r\n\t\t\tvar column_count = config.display_count === undefined ? config.count : config.display_count;\r\n\r\n\t\t\tif (!column_count)\r\n\t\t\t\tcolumn_count = 1;\r\n\r\n\t\t\tconst fixedMode = !isNaN(config.column_width*1) && config.column_width*1 > 0;\r\n\t\t\tif (fixedMode) {\r\n\t\t\t\tconst baseCellWidth = config.column_width*1;\r\n\t\t\t\tconfig.col_width = baseCellWidth;\r\n\t\t\t\tcont_width = baseCellWidth * column_count;\r\n\t\t\t} else {\r\n\t\t\t\tconfig.col_width = Math.floor(cont_width / column_count);\r\n\t\t\t\tif (min_col_width) {\r\n\t\t\t\t\tif (config.col_width < min_col_width) {\r\n\t\t\t\t\t\tconfig.col_width = min_col_width;\r\n\t\t\t\t\t\tcont_width = config.col_width * column_count;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconfig.width = [];\r\n\t\t\tvar ignores = config.ignore_x || {};\r\n\t\t\tfor (var i = 0; i < config.trace_x.length; i++) {\r\n\t\t\t\tif (ignores[config.trace_x[i].valueOf()] || (config.display_count == config.count)) {\r\n\t\t\t\t\tif(fixedMode){\r\n\t\t\t\t\t\tconfig.width[i] = config.col_width;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconfig.width[i] = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// width of month columns should be proportional month duration\r\n\t\t\t\t\tvar width = 1;\r\n\t\t\t\t\tif (config.unit == \"month\") {\r\n\t\t\t\t\t\tvar days = Math.round((dateHelper.add(config.trace_x[i], config.step, config.unit) - config.trace_x[i]) / (1000 * 60 * 60 * 24));\r\n\t\t\t\t\t\twidth = days;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconfig.width[i] = width;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(!fixedMode){\r\n\t\t\t\tthis.adjustSize(cont_width - this.getSum(config.width)/* 1 width per column from the code above */, config.width);\r\n\t\t\t}\r\n\r\n\t\t\tconfig.full_width = this.getSum(config.width);\r\n\t\t},\r\n\t\tinitScaleConfig: function (config, min_date, max_date) {\r\n\t\t\tvar cfg = utils.mixin({\r\n\t\t\t\tcount: 0,\r\n\t\t\t\tcol_width: 0,\r\n\t\t\t\tfull_width: 0,\r\n\t\t\t\theight: 0,\r\n\t\t\t\twidth: [],\r\n\t\t\t\tleft: [],\r\n\t\t\t\ttrace_x: [],\r\n\t\t\t\ttrace_indexes: {},\r\n\t\t\t\tmin_date: new Date(min_date),\r\n\t\t\t\tmax_date: new Date(max_date)\r\n\t\t\t}, config);\r\n\r\n\t\t\tthis.eachColumn(config.unit, config.step, min_date, max_date, function (date) {\r\n\t\t\t\tcfg.count++;\r\n\t\t\t\tcfg.trace_x.push(new Date(date));\r\n\t\t\t\tcfg.trace_indexes[date.valueOf()] = cfg.trace_x.length - 1;\r\n\t\t\t});\r\n\r\n\t\t\tcfg.trace_x_ascending = cfg.trace_x.slice();\r\n\t\t\treturn cfg;\r\n\t\t},\r\n\t\titerateScales: function (lower_scale, upper_scale, from, to, callback) {\r\n\t\t\tvar upper_dates = upper_scale.trace_x;\r\n\t\t\tvar lower_dates = lower_scale.trace_x;\r\n\r\n\t\t\tvar prev = from || 0;\r\n\t\t\tvar end = to || (lower_dates.length - 1);\r\n\t\t\tvar prevUpper = 0;\r\n\r\n\r\n\t\t\tfor (var up = 1; up < upper_dates.length; up++) {\r\n\t\t\t\tvar target_index = (lower_scale.trace_indexes[+upper_dates[up]]);\r\n\t\t\t\tif (target_index !== undefined && target_index <= end) {\r\n\t\t\t\t\tif (callback) {\r\n\t\t\t\t\t\tcallback.apply(this, [prevUpper, up, prev, target_index]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tprev = target_index;\r\n\t\t\t\t\tprevUpper = up;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\talineScaleColumns: function (lower_scale, upper_scale, from, to) {\r\n\t\t\tthis.iterateScales(lower_scale, upper_scale, from, to, function (upper_start, upper_end, lower_start, lower_end) {\r\n\t\t\t\tvar targetWidth = this.getSum(lower_scale.width, lower_start, lower_end - 1);\r\n\t\t\t\tvar actualWidth = this.getSum(upper_scale.width, upper_start, upper_end - 1);\r\n\t\t\t\tif (actualWidth != targetWidth) {\r\n\t\t\t\t\tthis.setSumWidth(targetWidth, upper_scale, upper_start, upper_end - 1);\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\teachColumn: function (unit, step, min_date, max_date, callback) {\r\n\t\t\tvar start = new Date(min_date),\r\n\t\t\t\tend = new Date(max_date);\r\n\t\t\tif (dateHelper[unit + \"_start\"]) {\r\n\t\t\t\tstart = dateHelper[unit + \"_start\"](start);\r\n\t\t\t}\r\n\r\n\t\t\tvar curr = new Date(start);\r\n\t\t\tif (+curr >= +end) {\r\n\t\t\t\tend = dateHelper.add(curr, step, unit);\r\n\t\t\t}\r\n\t\t\twhile (+curr < +end) {\r\n\t\t\t\tcallback.call(this, new Date(curr));\r\n\t\t\t\tvar tzOffset = curr.getTimezoneOffset();\r\n\t\t\t\tcurr = dateHelper.add(curr, step, unit);\r\n\t\t\t\tcurr = gantt._correct_dst_change(curr, tzOffset, step, unit);\r\n\t\t\t\tif (dateHelper[unit + '_start'])\r\n\t\t\t\t\tcurr = dateHelper[unit + \"_start\"](curr);\r\n\t\t\t}\r\n\t\t},\r\n\t\tlimitVisibleRange: function (cfg) {\r\n\t\t\tvar dates = cfg.trace_x;\r\n\r\n\t\t\tvar left = 0, right = cfg.width.length - 1;\r\n\t\t\tvar diff = 0;\r\n\t\t\tif (+dates[0] < +cfg.min_date && left != right) {\r\n\t\t\t\tvar width = Math.floor(cfg.width[0] * ((dates[1] - cfg.min_date) / (dates[1] - dates[0])));\r\n\t\t\t\tdiff += cfg.width[0] - width;\r\n\t\t\t\tcfg.width[0] = width;\r\n\r\n\t\t\t\tdates[0] = new Date(cfg.min_date);\r\n\t\t\t}\r\n\r\n\t\t\tvar last = dates.length - 1;\r\n\t\t\tvar lastDate = dates[last];\r\n\t\t\tvar outDate = dateHelper.add(lastDate, cfg.step, cfg.unit);\r\n\t\t\tif (+outDate > +cfg.max_date && last > 0) {\r\n\t\t\t\tvar width = cfg.width[last] - Math.floor(cfg.width[last] * ((outDate - cfg.max_date) / (outDate - lastDate)));\r\n\t\t\t\tdiff += cfg.width[last] - width;\r\n\t\t\t\tcfg.width[last] = width;\r\n\t\t\t}\r\n\r\n\t\t\tif (diff) {\r\n\t\t\t\tvar full = this.getSum(cfg.width);\r\n\t\t\t\tvar shared = 0;\r\n\t\t\t\tfor (var i = 0; i < cfg.width.length; i++) {\r\n\t\t\t\t\tvar share = Math.floor(diff * (cfg.width[i] / full));\r\n\t\t\t\t\tcfg.width[i] += share;\r\n\t\t\t\t\tshared += share;\r\n\t\t\t\t}\r\n\t\t\t\tthis.adjustSize(diff - shared, cfg.width);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default ScaleHelper;\r\n","\r\nimport ScaleHelper from \"./scales\";\r\n\r\nfunction ScaleIgnoreHelper(gantt){\r\n\tvar helper = new ScaleHelper(gantt);\r\n\r\n\thelper.processIgnores = function (config) {\r\n\t\tvar display_count = config.count;\r\n\t\tconfig.ignore_x = {};\r\n\t\tif (gantt.ignore_time || gantt.config.skip_off_time) {\r\n\t\t\tvar ignore = gantt.ignore_time || function () {\r\n\t\t\t\treturn false;\r\n\t\t\t};\r\n\t\t\tdisplay_count = 0;\r\n\r\n\t\t\tfor (var i = 0; i < config.trace_x.length; i++) {\r\n\r\n\t\t\t\tif (ignore.call(gantt, config.trace_x[i]) || this._ignore_time_config.call(gantt, config.trace_x[i], config)) {\r\n\t\t\t\t\tconfig.ignore_x[config.trace_x[i].valueOf()] = true;\r\n\t\t\t\t\tconfig.ignored_colls = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdisplay_count++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tconfig.display_count = display_count;\r\n\t};\r\n\r\n\treturn helper;\r\n}\r\n\r\nexport default ScaleIgnoreHelper;","/* eslint-disable */\r\n\r\nimport ScaleHelper from \"../../core/ui/timeline/scales_ignore\";\r\nimport * as helpers from \"../../utils/helpers\";\r\n\r\nexport default function(gantt: any) {\r\n\r\n\tgantt.ext = gantt.ext || {};\r\n\r\n\tgantt.ext.export_api = gantt.ext.export_api || {\r\n\r\n\t\t_apiUrl: \"https://export.dhtmlx.com/gantt\",\r\n\r\n\t\t_preparePDFConfigRaw(config:any, type:any){\r\n\t\t\tlet previousDateRage:any = null;\r\n\t\t\tif (config.start && config.end){\r\n\t\t\t\tpreviousDateRage = {\r\n\t\t\t\t\tstart_date: gantt.config.start_date,\r\n\t\t\t\t\tend_date: gantt.config.end_date,\r\n\t\t\t\t};\r\n\t\t\t\tgantt.config.start_date = gantt.date.str_to_date(gantt.config.date_format)(config.start);\r\n\t\t\t\tgantt.config.end_date = gantt.date.str_to_date(gantt.config.date_format)(config.end);\r\n\t\t\t}\r\n\r\n\t\t\tconfig = gantt.mixin(config, {\r\n\t\t\t\tname: \"gantt.\" + type, data: gantt.ext.export_api._serializeHtml()\r\n\t\t\t});\r\n\r\n\t\t\tif (previousDateRage){\r\n\t\t\t\tgantt.config.start_date = previousDateRage.start_date;\r\n\t\t\t\tgantt.config.end_date = previousDateRage.end_date;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_prepareConfigPDF(config:any, type:any){\r\n\t\t\tconfig = gantt.mixin((config || {}), {\r\n\t\t\t\tname: \"gantt.\" + type,\r\n\t\t\t\tdata: gantt.ext.export_api._serializeAll(),\r\n\t\t\t\tconfig: gantt.config\r\n\t\t\t});\r\n\t\t\tgantt.ext.export_api._fixColumns(config.config.columns);\r\n\t\t\treturn config;\r\n\t\t},\r\n\r\n\t\t_pdfExportRouter(config:any, type:any){\r\n\t\t\tif (config && config.raw) {\r\n\t\t\t\tgantt.ext.export_api._preparePDFConfigRaw(config, type);\r\n\t\t\t} else {\r\n\t\t\t\tconfig = gantt.ext.export_api._prepareConfigPDF(config, type);\r\n\t\t\t}\r\n\t\t\tconfig.version = gantt.version;\r\n\t\t\tgantt.ext.export_api._sendToExport(config, type);\r\n\t\t},\r\n\r\n\t\texportToPDF(config:any) {\r\n\t\t\tgantt.ext.export_api._pdfExportRouter(config, \"pdf\");\r\n\t\t},\r\n\r\n\t\texportToPNG(config:any) {\r\n\t\t\tgantt.ext.export_api._pdfExportRouter(config, \"png\");\r\n\t\t},\r\n\r\n\r\n\t\texportToICal(config:any) {\r\n\t\t\tconfig = gantt.mixin((config || {}), {\r\n\t\t\t\tname: \"gantt.ical\",\r\n\t\t\t\tdata: gantt.ext.export_api._serializePlain().data,\r\n\t\t\t\tversion: gantt.version\r\n\t\t\t});\r\n\t\t\tgantt.ext.export_api._sendToExport(config, \"ical\");\r\n\t\t},\r\n\r\n\t\texportToExcel(config:any) {\r\n\t\t\tconfig = config || {};\r\n\r\n\t\t\tlet tasks;\r\n\t\t\tlet dates: any = [];\r\n\t\t\tlet state;\r\n\t\t\tlet scroll;\r\n\t\t\t// GS-2124, we need to get all task nodes to correctly obtain the colors\r\n\t\t\tconst smartRendering = gantt.config.smart_rendering;\r\n\t\t\tif (config.visual === \"base-colors\"){\r\n\t\t\t\tgantt.config.smart_rendering = false;\r\n\t\t\t}\r\n\r\n\t\t\tif (config.start || config.end) {\r\n\t\t\t\tstate = gantt.getState();\r\n\t\t\t\tdates = [gantt.config.start_date, gantt.config.end_date];\r\n\t\t\t\tscroll = gantt.getScrollState();\r\n\t\t\t\tconst convert = gantt.date.str_to_date(gantt.config.date_format);\r\n\t\t\t\ttasks = gantt.eachTask;\r\n\r\n\t\t\t\tif (config.start){\r\n\t\t\t\t\tgantt.config.start_date = convert(config.start);\r\n\t\t\t\t}\r\n\t\t\t\tif (config.end){\r\n\t\t\t\t\tgantt.config.end_date = convert(config.end);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgantt.render();\r\n\t\t\t\tgantt.config.smart_rendering = smartRendering;\r\n\r\n\t\t\t\tgantt.eachTask = gantt.ext.export_api._eachTaskTimed(gantt.config.start_date, gantt.config.end_date);\r\n\t\t\t} else if (config.visual === \"base-colors\"){\r\n\t\t\t\tgantt.render();\r\n\t\t\t\tgantt.config.smart_rendering = smartRendering;\r\n\t\t\t}\r\n\r\n\t\t\tconfig = gantt.mixin(config, {\r\n\t\t\t\tname: \"gantt.xlsx\",\r\n\t\t\t\ttitle: \"Tasks\",\r\n\t\t\t\tdata: gantt.ext.export_api._serializeTimeline(config),\r\n\t\t\t\tcolumns: gantt.ext.export_api._serializeGrid({ raw: config.raw, rawDates: true }),\r\n\t\t\t\tversion: gantt.version\r\n\t\t\t});\r\n\r\n\t\t\tif (config.visual){\r\n\t\t\t\tconfig.scales = gantt.ext.export_api._serializeScales(config);\r\n\t\t\t}\r\n\r\n\t\t\tgantt.ext.export_api._sendToExport(config, \"excel\");\r\n\r\n\t\t\tif (config.start || config.end) {\r\n\t\t\t\tgantt.config.start_date = state.min_date;\r\n\t\t\t\tgantt.config.end_date = state.max_date;\r\n\t\t\t\tgantt.eachTask = tasks;\r\n\r\n\t\t\t\tgantt.render();\r\n\t\t\t\tgantt.scrollTo(scroll.x, scroll.y);\r\n\r\n\t\t\t\tgantt.config.start_date = dates[0];\r\n\t\t\t\tgantt.config.end_date = dates[1];\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\texportToJSON(config:any) {\r\n\t\t\tconfig = gantt.mixin((config || {}), {\r\n\t\t\t\tname: \"gantt.json\",\r\n\t\t\t\tdata: gantt.ext.export_api._serializeAll(),\r\n\t\t\t\tconfig: gantt.config,\r\n\t\t\t\tcolumns: gantt.ext.export_api._serializeGrid(),\r\n\t\t\t\tworktime: gantt.ext.export_api._getWorktimeSettings(),\r\n\t\t\t\tversion: gantt.version\r\n\t\t\t});\r\n\t\t\tgantt.ext.export_api._sendToExport(config, \"json\");\r\n\t\t},\r\n\r\n\r\n\t\timportFromExcel(config:any) {\r\n\t\t\ttry {\r\n\t\t\t\tconst formData = config.data;\r\n\t\t\t\tif (formData instanceof File) {\r\n\t\t\t\t\tconst data = new FormData();\r\n\t\t\t\t\tdata.append(\"file\", formData);\r\n\t\t\t\t\tconfig.data = data;\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {}\r\n\t\t\tgantt.ext.export_api._sendImportAjaxExcel(config);\r\n\t\t},\r\n\r\n\t\timportFromMSProject(config:any) {\r\n\t\t\tconst formData = config.data;\r\n\t\t\ttry {\r\n\t\t\t\tif (formData  instanceof File) {\r\n\t\t\t\t\tconst data = new FormData();\r\n\t\t\t\t\tdata.append(\"file\", formData);\r\n\t\t\t\t\tconfig.data = data;\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {}\r\n\t\t\tgantt.ext.export_api._sendImportAjaxMSP(config);\r\n\t\t},\r\n\r\n\t\timportFromPrimaveraP6(config:any) {\r\n\t\t\tconfig.type = \"primaveraP6-parse\";\r\n\t\t\treturn gantt.importFromMSProject(config);\r\n\t\t},\r\n\r\n\t\texportToMSProject(config:any) {\r\n\t\t\tconfig = config || {};\r\n\t\t\tconfig.skip_circular_links = config.skip_circular_links === undefined ? true : !!config.skip_circular_links;\r\n\r\n\t\t\tconst oldXmlFormat = gantt.templates.xml_format;\r\n\t\t\tconst oldFormatDate = gantt.templates.format_date;\r\n\t\t\tconst oldXmlDate = gantt.config.xml_date;\r\n\t\t\tconst oldDateFormat = gantt.config.date_format;\r\n\r\n\t\t\tconst exportServiceDateFormat = \"%d-%m-%Y %H:%i:%s\";\r\n\r\n\t\t\tgantt.config.xml_date = exportServiceDateFormat;\r\n\t\t\tgantt.config.date_format = exportServiceDateFormat;\r\n\t\t\tgantt.templates.xml_format = gantt.date.date_to_str(exportServiceDateFormat);\r\n\t\t\tgantt.templates.format_date = gantt.date.date_to_str(exportServiceDateFormat);\r\n\t\t\tconst data = gantt.ext.export_api._serializeAll();\r\n\r\n\t\t\tgantt.ext.export_api._customProjectProperties(data, config);\r\n\r\n\t\t\tgantt.ext.export_api._customTaskProperties(data, config);\r\n\r\n\t\t\tif (config.skip_circular_links) {\r\n\t\t\t\tgantt.ext.export_api._clearRecLinks(data);\r\n\t\t\t}\r\n\r\n\t\t\tconfig = gantt.ext.export_api._exportConfig(data, config);\r\n\r\n\t\t\tgantt.ext.export_api._sendToExport(config, config.type || \"msproject\");\r\n\t\t\tgantt.config.xml_date = oldXmlDate;\r\n\t\t\tgantt.config.date_format = oldDateFormat;\r\n\t\t\tgantt.templates.xml_format = oldXmlFormat;\r\n\t\t\tgantt.templates.format_date = oldFormatDate;\r\n\r\n\t\t\tgantt.config.$custom_data = null;\r\n\t\t\tgantt.config.custom = null;\r\n\t\t},\r\n\r\n\t\texportToPrimaveraP6(config:any) {\r\n\t\t\tconfig = config || {};\r\n\t\t\tconfig.type = \"primaveraP6\";\r\n\t\t\treturn gantt.exportToMSProject(config);\r\n\t\t},\r\n\r\n\t\t_fixColumns(columns:any) {\r\n\t\t\tfor (let i = 0; i < columns.length; i++) {\r\n\t\t\t\tcolumns[i].label = columns[i].label || gantt.locale.labels[\"column_\" + columns[i].name];\r\n\t\t\t\tif (typeof columns[i].width === \"string\") {\r\n\t\t\t\t\tcolumns[i].width = columns[i].width * 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_xdr(url:any, pack:any, cb:any) {\r\n\t\t\tgantt.ajax.post(url, pack, cb);\r\n\t\t},\r\n\r\n\t\t_markColumns(base:any) {\r\n\t\t\tconst columns = base.config.columns;\r\n\t\t\tif (columns){\r\n\t\t\t\tfor (let i = 0; i < columns.length; i++) {\r\n\t\t\t\t\tif (columns[i].template){\r\n\t\t\t\t\t\tcolumns[i].$template = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\t_sendImportAjaxExcel(config:any) {\r\n\t\t\tconst url = config.server || gantt.ext.export_api._apiUrl;\r\n\t\t\tconst store = config.store || 0;\r\n\t\t\tconst formData = config.data;\r\n\t\t\tconst callback = config.callback;\r\n\r\n\t\t\tformData.append(\"type\", \"excel-parse\");\r\n\t\t\tformData.append(\"data\", JSON.stringify({\r\n\t\t\t\tsheet: config.sheet || 0\r\n\t\t\t}));\r\n\r\n\t\t\tif (store){\r\n\t\t\t\tformData.append(\"store\", store);\r\n\t\t\t}\r\n\r\n\t\t\tconst xhr = new XMLHttpRequest();\r\n\t\t\txhr.onreadystatechange = function(e) {\r\n\t\t\t\tif (xhr.readyState === 4 && xhr.status === 0) {// network error\r\n\t\t\t\t\tif (callback) {\r\n\t\t\t\t\t\tcallback(null);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\txhr.onload = function() {\r\n\t\t\t\tconst fail = xhr.status > 400;\r\n\t\t\t\tlet info = null;\r\n\r\n\t\t\t\tif (!fail) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tinfo = JSON.parse(xhr.responseText);\r\n\t\t\t\t\t} catch (e) { }\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (callback) {\r\n\t\t\t\t\tcallback(info);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\txhr.open(\"POST\", url, true);\r\n\t\t\txhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\r\n\t\t\txhr.send(formData);\r\n\t\t},\r\n\r\n\r\n\t\t_ajaxToExport(data:any, type:any, callback:any) {\r\n\t\t\tdelete data.callback;\r\n\r\n\t\t\tconst url = data.server || gantt.ext.export_api._apiUrl;\r\n\t\t\tconst pack = \"type=\" + type + \"&store=1&data=\" + encodeURIComponent(JSON.stringify(data));\r\n\r\n\t\t\tconst cb = function(loader:any) {\r\n\t\t\t\tconst xdoc = loader.xmlDoc || loader;\r\n\t\t\t\tconst fail = xdoc.status > 400;\r\n\t\t\t\tlet info = null;\r\n\r\n\t\t\t\tif (!fail) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tinfo = JSON.parse(xdoc.responseText);\r\n\t\t\t\t\t} catch (e) { }\r\n\t\t\t\t}\r\n\t\t\t\tcallback(info);\r\n\t\t\t};\r\n\r\n\t\t\tgantt.ext.export_api._xdr(url, pack, cb);\r\n\t\t},\r\n\t\t_serializableGanttConfig(config:any) {\r\n\t\t\tconst result = gantt.mixin({}, config);\r\n\r\n\t\t\tif (result.columns) {\r\n\t\t\t\tresult.columns = result.columns.map(function(col:any) {\r\n\t\t\t\t\tconst copy = gantt.mixin({}, col);\r\n\t\t\t\t\tdelete copy.editor;\r\n\t\t\t\t\treturn copy;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tdelete result.editor_types;\r\n\t\t\treturn result;\r\n\t\t},\r\n\r\n\t\t_sendToExport(data:any, type:any) {\r\n\t\t\tconst convert = gantt.date.date_to_str(gantt.config.date_format || gantt.config.xml_date);\r\n\t\t\tif(!data.skin){\r\n\t\t\t\tdata.skin = gantt.skin;\r\n\t\t\t}\r\n\t\t\tif (data.config) {\r\n\t\t\t\tdata.config = gantt.copy(gantt.ext.export_api._serializableGanttConfig(data.config));\r\n\t\t\t\tgantt.ext.export_api._markColumns(data, type);\r\n\r\n\t\t\t\tif (data.config.start_date && data.config.end_date) {\r\n\t\t\t\t\tif (data.config.start_date instanceof Date) {\r\n\t\t\t\t\t\tdata.config.start_date = convert(data.config.start_date);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (data.config.end_date instanceof Date) {\r\n\t\t\t\t\t\tdata.config.end_date = convert(data.config.end_date);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (data.callback) {\r\n\t\t\t\treturn gantt.ext.export_api._ajaxToExport(data, type, data.callback);\r\n\t\t\t}\r\n\r\n\t\t\tconst form = gantt.ext.export_api._createHiddenForm();\r\n\t\t\tform.firstChild.action = data.server || gantt.ext.export_api._apiUrl;\r\n\t\t\tform.firstChild.childNodes[0].value = JSON.stringify(data);\r\n\t\t\tform.firstChild.childNodes[1].value = type;\r\n\t\t\tform.firstChild.submit();\r\n\t\t},\r\n\r\n\t\t_createHiddenForm() {\r\n\t\t\tif (!gantt.ext.export_api._hidden_export_form) {\r\n\t\t\t\tconst t = gantt.ext.export_api._hidden_export_form = document.createElement(\"div\");\r\n\t\t\t\tt.style.display = \"none\";\r\n\t\t\t\tt.innerHTML = \"<form method='POST' target='_blank'><textarea name='data' style='width:0px; height:0px;' readonly='true'></textarea><input type='hidden' name='type' value=''></form>\";\r\n\t\t\t\tdocument.body.appendChild(t);\r\n\t\t\t}\r\n\t\t\treturn gantt.ext.export_api._hidden_export_form;\r\n\t\t},\r\n\r\n\r\n\t\t_copyObjectBase(obj: any) {\r\n\t\t\tconst copy: any = {\r\n\t\t\t\tstart_date: undefined,\r\n\t\t\t\tend_date: undefined,\r\n\t\t\t\tconstraint_date: undefined,\r\n\t\t\t\tdeadline: undefined\r\n\t\t\t};\r\n\t\t\tfor (const key in obj) {\r\n\t\t\t\tif (key.charAt(0) === \"$\" || key === \"baselines\"){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tcopy[key] = obj[key];\r\n\t\t\t}\r\n\t\t\tconst formatDate = gantt.templates.xml_format || gantt.templates.format_date;\r\n\r\n\t\t\tcopy.start_date = formatDate(copy.start_date);\r\n\t\t\tif (copy.end_date){\r\n\t\t\t\tcopy.end_date = formatDate(copy.end_date);\r\n\t\t\t}\r\n\t\t\tif (copy.constraint_date){\r\n\t\t\t\tcopy.constraint_date = formatDate(copy.constraint_date);\r\n\t\t\t}\r\n\t\t\tif (copy.deadline){\r\n\t\t\t\tcopy.deadline = formatDate(copy.deadline);\r\n\t\t\t}\r\n\r\n\t\t\treturn copy;\r\n\t\t},\r\n\r\n\r\n\t\t_color_box: null,\r\n\t\t_color_hash: {},\r\n\r\n\t\t_getStyles(css:any) {\r\n\t\t\tif (!gantt.ext.export_api._color_box) {\r\n\t\t\t\tgantt.ext.export_api._color_box = document.createElement(\"DIV\");\r\n\t\t\t\tgantt.ext.export_api._color_box.style.cssText = \"position:absolute; display:none;\";\r\n\t\t\t\tdocument.body.appendChild(gantt.ext.export_api._color_box);\r\n\t\t\t}\r\n\t\t\tif (gantt.ext.export_api._color_hash[css]){\r\n\t\t\t\treturn gantt.ext.export_api._color_hash[css];\r\n\t\t\t}\r\n\r\n\t\t\tgantt.ext.export_api._color_box.className = css;\r\n\t\t\tconst color = gantt.ext.export_api._getColor(gantt.ext.export_api._color_box, \"color\");\r\n\t\t\tconst backgroundColor = gantt.ext.export_api._getColor(gantt.ext.export_api._color_box, \"backgroundColor\");\r\n\t\t\treturn (gantt.ext.export_api._color_hash[css] = color + \";\" + backgroundColor);\r\n\t\t},\r\n\r\n\r\n\t\t_getMinutesWorktimeSettings(parsedRanges:any) {\r\n\t\t\tconst minutes:any = [];\r\n\t\t\tparsedRanges.forEach(function(range:any) {\r\n\t\t\t\tminutes.push(range.startMinute);\r\n\t\t\t\tminutes.push(range.endMinute);\r\n\t\t\t});\r\n\t\t\treturn minutes;\r\n\t\t},\r\n\r\n\t\t_getWorktimeSettings() {\r\n\r\n\t\t\tconst defaultWorkTimes = {\r\n\t\t\t\thours: [0, 24],\r\n\t\t\t\tminutes: null,\r\n\t\t\t\tdates: { 0: true, 1: true, 2: true, 3: true, 4: true, 5: true, 6: true }\r\n\t\t\t};\r\n\r\n\t\t\tlet time: any;\r\n\t\t\tif (!gantt.config.work_time) {\r\n\t\t\t\ttime = defaultWorkTimes;\r\n\t\t\t} else {\r\n\t\t\t\tconst wTime = gantt._working_time_helper;\r\n\t\t\t\tif (wTime && wTime.get_calendar) {\r\n\t\t\t\t\ttime = wTime.get_calendar();\r\n\t\t\t\t} else if (wTime) {\r\n\t\t\t\t\ttime = {\r\n\t\t\t\t\t\thours: wTime.hours,\r\n\t\t\t\t\t\tminutes: null,\r\n\t\t\t\t\t\tdates: wTime.dates\r\n\t\t\t\t\t};\r\n\t\t\t\t} else if (gantt.config.worktimes && gantt.config.worktimes.global) {\r\n\t\t\t\t\tconst settings = gantt.config.worktimes.global;\r\n\r\n\t\t\t\t\tif (settings.parsed) {\r\n\t\t\t\t\t\tconst minutes = gantt.ext.export_api._getMinutesWorktimeSettings(settings.parsed.hours);\r\n\t\t\t\t\t\ttime = {\r\n\t\t\t\t\t\t\thours: null,\r\n\t\t\t\t\t\t\tminutes,\r\n\t\t\t\t\t\t\tdates: {}\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tfor (const i in settings.parsed.dates) {\r\n\t\t\t\t\t\t\tif (Array.isArray(settings.parsed.dates[i])) {\r\n\t\t\t\t\t\t\t\ttime.dates[i] = gantt.ext.export_api._getMinutesWorktimeSettings(settings.parsed.dates[i]);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttime.dates[i] = settings.parsed.dates[i];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttime = {\r\n\t\t\t\t\t\t\thours: settings.hours,\r\n\t\t\t\t\t\t\tminutes: null,\r\n\t\t\t\t\t\t\tdates: settings.dates\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttime = defaultWorkTimes;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn time;\r\n\t\t},\r\n\r\n\r\n\t\t_eachTaskTimed(start:any, end:any) {\r\n\t\t\treturn function(code:any, parent:any, master:any) {\r\n\t\t\t\tparent = parent || gantt.config.root_id;\r\n\t\t\t\tmaster = master || gantt;\r\n\r\n\t\t\t\tconst branch = gantt.getChildren(parent);\r\n\t\t\t\tif (branch){\r\n\t\t\t\t\tfor (let i = 0; i < branch.length; i++) {\r\n\t\t\t\t\t\tconst item = gantt._pull[branch[i]];\r\n\t\t\t\t\t\tif ((!start || item.end_date > start) && (!end || item.start_date < end)){\r\n\t\t\t\t\t\t\tcode.call(master, item);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (gantt.hasChild(item.id)){\r\n\t\t\t\t\t\t\tgantt.eachTask(code, item.id, master);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\r\n\r\n\t\t// patch broken json serialization in gantt 2.1\r\n\t\t_originalCopyObject: gantt.json._copyObject,\r\n\r\n\t\t_copyObjectPlainICal(task: any) {\r\n\t\t\tconst text = gantt.templates.task_text(task.start_date, task.end_date, task);\r\n\r\n\t\t\tconst copy = gantt.ext.export_api._copyObjectBase(task);\r\n\t\t\tcopy.text = text || copy.text;\r\n\r\n\t\t\treturn copy;\r\n\t\t},\r\n\r\n\t\t_copyObjectPlainExcel(task: any) {\r\n\t\t\tconst text = gantt.templates.task_text(task.start_date, task.end_date, task);\r\n\r\n\t\t\tconst copy = gantt.json.serializeTask(task);\r\n\t\t\tcopy.text = text || copy.text;\r\n\r\n\t\t\treturn copy;\r\n\t\t},\r\n\r\n\t\t_getColor(node:any, style:any) {\r\n\t\t\tlet value = node.currentStyle ? node.currentStyle[style] : getComputedStyle(node, null)[style];\r\n\t\t\t// if we get the black background color for the progress bar, \r\n\t\t\t// most likely, it is the transparent color.\r\n\t\t\t// In that case, we need to confirm that and return the color of the task bar\r\n\t\t\tif (node.closest(\".gantt_task_progress\") && value === \"rgba(0, 0, 0, 0.15)\"){\r\n\t\t\t\tnode = node.parentNode.parentNode;\r\n\t\t\t\tvalue = node.currentStyle ? node.currentStyle[style] : getComputedStyle(node, null)[style];\r\n\t\t\t}\r\n\t\t\tconst rgb = value.replace(/\\s/g, \"\").match(/^rgba?\\((\\d+),(\\d+),(\\d+)/i);\r\n\t\t\treturn ((rgb && rgb.length === 4) ?\r\n\t\t\t\t(\"0\" + parseInt(rgb[1], 10).toString(16)).slice(-2) +\r\n\t\t\t\t(\"0\" + parseInt(rgb[2], 10).toString(16)).slice(-2) +\r\n\t\t\t\t(\"0\" + parseInt(rgb[3], 10).toString(16)).slice(-2) : value).replace(\"#\", \"\");\r\n\t\t},\r\n\r\n\r\n\t\t// excel serialization\r\n\t\t_copyObjectTable(obj:any) {\r\n\t\t\t// Excel interprets UTC time as local time in every timezone, send local time instead of actual UTC time.\r\n\t\t\t// https://github.com/SheetJS/js-xlsx/issues/126#issuecomment-60531614\r\n\t\t\tconst toISOstring = gantt.date.date_to_str(\"%Y-%m-%dT%H:%i:%s.000Z\");\r\n\r\n\t\t\tconst copy = gantt.ext.export_api._copyObjectColumns(obj, gantt.ext.export_api._copyObjectPlainExcel(obj));\r\n\t\t\tif (copy.start_date){\r\n\t\t\t\tif (typeof copy.start_date === \"string\"){\r\n\t\t\t\t\tcopy.original_start_date = gantt.date.str_to_date(gantt.config.date_format)(copy.start_date);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcopy.original_start_date = copy.start_date;\r\n\t\t\t\t\tcopy.start_date = toISOstring(obj.start_date);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (copy.end_date){\r\n\t\t\t\tif (typeof copy.end_date === \"string\"){\r\n\t\t\t\t\tcopy.original_end_date = gantt.date.str_to_date(gantt.config.date_format)(copy.end_date);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcopy.original_end_date = copy.end_date;\r\n\t\t\t\t\tcopy.end_date = toISOstring(obj.end_date);\r\n\t\t\t\t}\r\n\t\t\t} else if (copy.original_start_date){\r\n\t\t\t\tcopy.original_end_date = gantt.calculateEndDate({\r\n\t\t\t\t\tstart_date: copy.original_start_date,\r\n\t\t\t\t\tduration: copy.duration,\r\n\t\t\t\t\ttask: copy\r\n\t\t\t\t});\r\n\t\t\t\tcopy.end_date = toISOstring(copy.original_end_date);\r\n\t\t\t}\r\n\r\n\t\t\treturn copy;\r\n\t\t},\r\n\r\n\t\t_generatedScales: null,\r\n\t\t_generateScales(){\r\n\t\t\tconst state = gantt.getState();\r\n\t\t\tconst scaleHelper = ScaleHelper(gantt);\r\n\t\t\tconst scales = [scaleHelper.primaryScale(gantt.config)].concat(scaleHelper.getSubScales(gantt.config));\r\n\r\n\t\t\tconst scalesConfig = scaleHelper.prepareConfigs(scales, gantt.config.min_column_width, 1000, gantt.config.scale_height - 1, state.min_date, state.max_date, gantt.config.rtl);\r\n\t\t\tgantt.ext.export_api._generatedScales = scalesConfig;\r\n\t\t\treturn scalesConfig;\r\n\t\t},\r\n\r\n\t\t_getDayIndex (scales:any, date:any){\r\n\t\t\tlet days = scales.trace_indexes\r\n\t\t\tif (days[+date]) {\r\n\t\t\t\treturn days[+date]\r\n\t\t\t} else {\r\n\t\t\t\tdays = scales.trace_x;\r\n\t\t\t\tconst state = gantt.getState();\r\n\r\n\t\t\t\tif (+date <= state.min_date) {\r\n\t\t\t\t\tif (gantt.config.rtl) {\r\n\t\t\t\t\t\treturn days.length;\r\n\t\t\t\t\t} else{\r\n\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (+date >= state.max_date) {\r\n\t\t\t\t\tif (gantt.config.rtl) {\r\n\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn days.length;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tconst index = helpers.findBinary(days, +date);\r\n\t\t\t\treturn index;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_copyObjectColors(obj:any, config:any) {\r\n\t\t\tconst copy = gantt.ext.export_api._copyObjectTable(obj);\r\n\r\n\t\t\tlet startDate = copy.original_start_date;\r\n\t\t\tlet endDate = copy.original_end_date;\r\n\r\n\t\t\tlet getDayIndex = gantt.columnIndexByDate;\r\n\r\n\t\t\tlet scales;\r\n\t\t\tif (gantt.ext.export_api._generatedScales){ \r\n\t\t\t\tconst allScales = gantt.ext.export_api._generatedScales;\r\n\t\t\t\tscales = allScales[allScales.length - 1];\r\n\r\n\t\t\t\tcopy.$start = gantt.ext.export_api._getDayIndex(scales, startDate);\r\n\t\t\t\tcopy.$end = gantt.ext.export_api._getDayIndex(scales, endDate);\r\n\t\t\t} else {\r\n\t\t\t\tscales = gantt.getScale();\r\n\t\t\t\tcopy.$start = getDayIndex.call(gantt, startDate);\r\n\t\t\t\tcopy.$end = getDayIndex.call(gantt, endDate);\r\n\t\t\t}\r\n\r\n\t\t\t// GS-2100. Correct bar position considering hidden cells\r\n\t\t\tlet hiddenCells = 0;\r\n\t\t\tconst scaleCellsWidth = scales.width;\r\n\t\t\tif (scaleCellsWidth.indexOf(0) > -1) {\r\n\t\t\t\tlet i = 0;\r\n\t\t\t\tfor (i; i < copy.$start; i++) {\r\n\t\t\t\t\tif (!scaleCellsWidth[i]) {\r\n\t\t\t\t\t\thiddenCells++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcopy.$start -= hiddenCells;\r\n\r\n\t\t\t\tfor (i; i < copy.$end; i++) {\r\n\t\t\t\t\tif (!scaleCellsWidth[i]) {\r\n\t\t\t\t\t\thiddenCells++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcopy.$end -= hiddenCells;\r\n\t\t\t}\r\n\r\n\t\t\tcopy.$level = obj.$level;\r\n\t\t\tcopy.$type = obj.$rendered_type;\r\n\r\n\t\t\tconst tmps = gantt.templates;\r\n\t\t\tcopy.$text = tmps.task_text(obj.start, obj.end_date, obj);\r\n\t\t\tcopy.$left = tmps.leftside_text ? tmps.leftside_text(obj.start, obj.end_date, obj) : \"\";\r\n\t\t\tcopy.$right = tmps.rightside_text ? tmps.rightside_text(obj.start, obj.end_date, obj) : \"\";\r\n\r\n\t\t\tconst node = gantt.getTaskNode && gantt.getTaskNode(obj.id);\r\n\t\t\tif (node && node.firstChild) {\r\n\t\t\t\tlet targetNode = node;\r\n\t\t\t\tif (config.visual !== \"base-colors\"){\r\n\t\t\t\t\ttargetNode = node.querySelector(\".gantt_task_progress\")\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet color = gantt.ext.export_api._getColor(targetNode, \"backgroundColor\");\r\n\t\t\t\tif (color === \"363636\"){\r\n\t\t\t\t\tcolor = gantt.ext.export_api._getColor(node, \"backgroundColor\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcopy.$color = color;\r\n\t\t\t} else if (obj.color){\r\n\t\t\t\tcopy.$color = obj.color;\r\n\t\t\t} else {\r\n\t\t\t\tconst cellCss = gantt.templates.task_class(obj.start, obj.end, obj);\r\n\t\t\t\tif (cellCss){\r\n\t\t\t\t\tconst styles = gantt.ext.export_api._getStyles(cellCss);\r\n\t\t\t\t\tcopy.$color = styles.split(\";\")[1]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn copy;\r\n\t\t},\r\n\r\n\t\t_copyObjectColumns(obj:any, copy:any) {\r\n\t\t\tfor (let i = 0; i < gantt.config.columns.length; i++) {\r\n\t\t\t\tconst ct = gantt.config.columns[i].template;\r\n\t\t\t\tif (ct) {\r\n\t\t\t\t\tlet val = ct(obj);\r\n\t\t\t\t\tif (val instanceof Date){\r\n\t\t\t\t\t\tval = gantt.templates.date_grid(val, obj);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcopy[\"_\" + i] = val;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn copy;\r\n\t\t},\r\n\r\n\t\t_copyObjectAll(obj:any) {\r\n\t\t\tconst copy = gantt.ext.export_api._copyObjectBase(obj);\r\n\r\n\t\t\tconst templates = [\r\n\t\t\t\t\"leftside_text\",\r\n\t\t\t\t\"rightside_text\",\r\n\t\t\t\t\"task_text\",\r\n\t\t\t\t\"progress_text\",\r\n\t\t\t\t\"task_class\"\r\n\t\t\t];\r\n\r\n\t\t\t// serialize all text templates\r\n\t\t\tfor (let i = 0; i < templates.length; i++) {\r\n\t\t\t\tconst template = gantt.templates[templates[i]];\r\n\t\t\t\tif (template){\r\n\t\t\t\t\tcopy[\"$\" + i] = template(obj.start_date, obj.end_date, obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tgantt.ext.export_api._copyObjectColumns(obj, copy);\r\n\t\t\tcopy.open = obj.$open;\r\n\t\t\treturn copy;\r\n\t\t},\r\n\r\n\r\n\t\t_serializeHtml() {\r\n\t\t\tconst smartScales = gantt.config.smart_scales;\r\n\t\t\tconst smartRendering = gantt.config.smart_rendering;\r\n\t\t\tif (smartScales || smartRendering) {\r\n\t\t\t\tgantt.config.smart_rendering = false;\r\n\t\t\t\tgantt.config.smart_scales = false;\r\n\t\t\t\tgantt.render();\r\n\t\t\t}\r\n\r\n\t\t\tconst html = gantt.$container.parentNode.innerHTML;\r\n\r\n\t\t\tif (smartScales || smartRendering) {\r\n\t\t\t\tgantt.config.smart_scales = smartScales;\r\n\t\t\t\tgantt.config.smart_rendering = smartRendering;\r\n\t\t\t\tgantt.render();\r\n\t\t\t}\r\n\r\n\t\t\treturn html;\r\n\t\t},\r\n\r\n\t\t_serializeAll() {\r\n\t\t\tgantt.json._copyObject = gantt.ext.export_api._copyObjectAll;\r\n\t\t\tconst data = gantt.ext.export_api._exportSerialize();\r\n\t\t\tgantt.json._copyObject = gantt.ext.export_api._originalCopyObject;\r\n\t\t\treturn data;\r\n\t\t},\r\n\r\n\t\t_serializePlain() {\r\n\t\t\tconst oldXmlFormat = gantt.templates.xml_format;\r\n\t\t\tconst oldFormatDate = gantt.templates.format_date;\r\n\t\t\tgantt.templates.xml_format = gantt.date.date_to_str(\"%Y%m%dT%H%i%s\", true);\r\n\t\t\tgantt.templates.format_date = gantt.date.date_to_str(\"%Y%m%dT%H%i%s\", true);\r\n\t\t\tgantt.json._copyObject = gantt.ext.export_api._copyObjectPlainICal;\r\n\r\n\t\t\tconst data = gantt.ext.export_api._exportSerialize();\r\n\r\n\t\t\tgantt.templates.xml_format = oldXmlFormat;\r\n\t\t\tgantt.templates.format_date = oldFormatDate;\r\n\t\t\tgantt.json._copyObject = gantt.ext.export_api._originalCopyObject;\r\n\r\n\t\t\tdelete data.links;\r\n\t\t\treturn data;\r\n\t\t},\r\n\r\n\t\t_getRaw() {\r\n\t\t\tconst timeline = gantt.$ui.getView(\"timeline\");\r\n\t\t\tif (timeline && gantt.config.show_chart) {\r\n\t\t\t\tlet availWidth = timeline.$config.width;\r\n\t\t\t\tif (gantt.config.autosize === \"x\" || gantt.config.autosize === \"xy\") {\r\n\t\t\t\t\tavailWidth = Math.max(gantt.config.autosize_min_width, 0);\r\n\t\t\t\t}\r\n\t\t\t\tconst state = gantt.getState();\r\n\t\t\t\tconst scales = timeline._getScales();\r\n\t\t\t\tconst minWidth = gantt.config.min_column_width;\r\n\t\t\t\tconst height = gantt.config.scale_height - 1;\r\n\t\t\t\tconst rtl = gantt.config.rtl;\r\n\r\n\t\t\t\treturn timeline.$scaleHelper.prepareConfigs(scales, minWidth, availWidth, height, state.min_date, state.max_date, rtl);\r\n\t\t\t} else {\r\n\t\t\t\treturn gantt.ext.export_api._generateScales();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_serializeTimeline(config:any) {\r\n\t\t\tgantt.ext.export_api._generatedScales = null;\r\n\t\t\tlet scales;\r\n\t\t\tif (config.visual){\r\n\t\t\t\tscales = gantt.ext.export_api._getRaw(config.start, config.end);\r\n\t\t\t}\r\n\t\t\tif (config.data){\r\n\t\t\t\tconfig.custom_dataset = true;\r\n\t\t\t}\r\n\r\n\t\t\tlet tasks = config.data || gantt.serialize().data;\r\n\t\t\ttasks.forEach(function(task:any, index:any){\r\n\t\t\t\tif (config.visual){\r\n\t\t\t\t\t// Save split tasks dates inside the parent object\r\n\t\t\t\t\tif (task.render == \"split\"){\r\n\t\t\t\t\t\tconst children:any = [];\r\n\t\t\t\t\t\tif (config.custom_dataset){\r\n\t\t\t\t\t\t\ttasks.forEach(function(child:any){\r\n\t\t\t\t\t\t\t\tif (child.parent == task.id){\r\n\t\t\t\t\t\t\t\t\tconst childBar = gantt.ext.export_api._copyObjectColors(child, config);\r\n\t\t\t\t\t\t\t\t\tchildBar.$split_subtask = true;\r\n\t\t\t\t\t\t\t\t\tchildren.push(childBar);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tgantt.eachTask(function(child:any){\r\n\t\t\t\t\t\t\t\tconst childBar = gantt.ext.export_api._copyObjectColors(child, config);\r\n\t\t\t\t\t\t\t\tchildren.push(childBar);\r\n\t\t\t\t\t\t\t}, task.id);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ttask.split_bars = [];\r\n\r\n\t\t\t\t\t\t// Skip overlap children\r\n\t\t\t\t\t\tconst skippedTasks:any = {};\r\n\t\t\t\t\t\tfor (let i = 0; i < children.length; i++) {\r\n\t\t\t\t\t\t\tconst child = children[i];\r\n\t\t\t\t\t\t\tfor (let j = 0; j < children.length; j++) {\r\n\t\t\t\t\t\t\t\tconst sibling = children[j];\r\n\t\t\t\t\t\t\t\tif (child.id == sibling.id || skippedTasks[sibling.id]){\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tconst overlap = +child.original_start_date < +sibling.original_start_date && +sibling.original_start_date <= +child.original_end_date;\r\n\t\t\t\t\t\t\t\t// const overlap = +child.original_start_date < +sibling.original_end_date && +sibling.original_end_date <= +child.original_end_date;\r\n\t\t\t\t\t\t\t\tconst cover = +sibling.original_start_date <= +child.original_start_date && +child.original_end_date <= +sibling.original_end_date;\r\n\t\t\t\t\t\t\t\tif (overlap){\r\n\t\t\t\t\t\t\t\t\tchild.original_end_date = sibling.original_start_date;\r\n\t\t\t\t\t\t\t\t\tchild.end_date = sibling.start_date;\r\n\t\t\t\t\t\t\t\t\tchild.$end = sibling.$start;\r\n\t\t\t\t\t\t\t\t\t// child.original_start_date = sibling.original_end_date;\r\n\t\t\t\t\t\t\t\t\t// child.start_date = sibling.end_date;\r\n\t\t\t\t\t\t\t\t\t// child.$start = sibling.$end;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (cover){\r\n\t\t\t\t\t\t\t\t\t// skip the task as it won't be visible\r\n\t\t\t\t\t\t\t\t\tskippedTasks[child.id] = true;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (!skippedTasks[child.id]){\r\n\t\t\t\t\t\t\t\ttask.split_bars.push(child)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ttasks[index] = task;\r\n\t\t\t\t\t} else if (!task.$split_subtask){\r\n\t\t\t\t\t\ttasks[index] = gantt.ext.export_api._copyObjectColors(task, config);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\ttasks[index] = gantt.ext.export_api._copyObjectTable(task);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t\t// Filter tasks\r\n\t\t\tif (config.raw && !config.data){\r\n\t\t\t\tconst taskStore = gantt.getDatastore(\"task\");\r\n\t\t\t\tconst filteredIds = taskStore.visibleOrder;\r\n\t\t\t\tif (tasks.length !== filteredIds.length){\r\n\t\t\t\t\tconst filteredDataset:any = [];\r\n\t\t\t\t\ttasks.forEach(function(task:any){\r\n\t\t\t\t\t\tif (filteredIds.indexOf(task.id) > -1){\r\n\t\t\t\t\t\t\tfilteredDataset.push(task);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\ttasks = filteredDataset;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (config.cellColors) {\r\n\t\t\t\tconst css = gantt.templates.timeline_cell_class || gantt.templates.task_cell_class;\r\n\t\t\t\tif (css) {\r\n\t\t\t\t\tlet steps = scales[0].trace_x;\r\n\t\t\t\t\tfor (let i = 1; i < scales.length; i++){\r\n\t\t\t\t\t\tif (scales[i].trace_x.length > steps.length){\r\n\t\t\t\t\t\t\tsteps = scales[i].trace_x;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (let i = 0; i < tasks.length; i++) {\r\n\t\t\t\t\t\ttasks[i].styles = [];\r\n\t\t\t\t\t\tconst task = gantt.getTask(tasks[i].id);\r\n\t\t\t\t\t\tfor (let j = 0; j < steps.length; j++) {\r\n\t\t\t\t\t\t\tconst date = steps[j];\r\n\t\t\t\t\t\t\tconst cellCss = css(task, date);\r\n\t\t\t\t\t\t\tif (cellCss){\r\n\t\t\t\t\t\t\t\ttasks[i].styles.push({ index: j, styles: gantt.ext.export_api._getStyles(cellCss) });\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn tasks;\r\n\t\t},\r\n\r\n\t\t_serializeScales(config:any) {\r\n\t\t\tconst scales:any = [];\r\n\t\t\tconst raw = gantt.ext.export_api._getRaw();\r\n\r\n\t\t\tlet min = Infinity;\r\n\t\t\tlet max = 0;\r\n\t\t\tfor (let i = 0; i < raw.length; i++) {\r\n\t\t\t\tmin = Math.min(min, raw[i].col_width);\r\n\t\t\t}\r\n\r\n\t\t\tfor (let i = 0; i < raw.length; i++) {\r\n\t\t\t\tlet start = 0;\r\n\t\t\t\tlet end = 0;\r\n\t\t\t\tconst row:any = [];\r\n\r\n\t\t\t\tscales.push(row);\r\n\t\t\t\tconst step = raw[i];\r\n\t\t\t\tmax = Math.max(max, step.trace_x.length);\r\n\t\t\t\tconst template = step.format || step.template || gantt.date.date_to_str(step.date);\r\n\r\n\t\t\t\tfor (let j = 0; j < step.trace_x.length; j++) {\r\n\t\t\t\t\tconst date = step.trace_x[j];\r\n\t\t\t\t\tend = start + Math.round(step.width[j] / min);\r\n\r\n\t\t\t\t\tconst scaleCell = { text: template(date), start, end, styles: \"\" };\r\n\r\n\t\t\t\t\tif (config.cellColors) {\r\n\t\t\t\t\t\tconst css = step.css || gantt.templates.scaleCell_class;\r\n\t\t\t\t\t\tif (css) {\r\n\t\t\t\t\t\t\tconst scaleCss = css(date);\r\n\t\t\t\t\t\t\tif (scaleCss){\r\n\t\t\t\t\t\t\t\tscaleCell.styles = gantt.ext.export_api._getStyles(scaleCss);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\trow.push(scaleCell);\r\n\t\t\t\t\tstart = end;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn { width: max, height: scales.length, data: scales };\r\n\t\t},\r\n\r\n\t\t_serializeGrid(config:any) {\r\n\t\t\tgantt.exportMode = true;\r\n\r\n\t\t\tconst columns:any = [];\r\n\t\t\tconst cols = gantt.config.columns;\r\n\r\n\t\t\tlet ccount = 0;\r\n\t\t\tfor (let i = 0; i < cols.length; i++) {\r\n\t\t\t\tif (cols[i].name === \"add\" || cols[i].name === \"buttons\") {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (config && config.raw && cols[i].hide){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcolumns[ccount] = {\r\n\t\t\t\t\tid: ((cols[i].template) ? (\"_\" + i) : cols[i].name),\r\n\t\t\t\t\theader: cols[i].label || gantt.locale.labels[\"column_\" + cols[i].name],\r\n\t\t\t\t\twidth: (cols[i].width ? Math.floor(cols[i].width / 4) : \"\"),\r\n\t\t\t\t\ttree: cols[i].tree || false\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (cols[i].name === \"duration\"){\r\n\t\t\t\t\tcolumns[ccount].type = \"number\";\r\n\t\t\t\t}\r\n\t\t\t\tif (cols[i].name === \"start_date\" || cols[i].name === \"end_date\") {\r\n\t\t\t\t\tcolumns[ccount].type = \"date\";\r\n\t\t\t\t\tif (config && config.rawDates){\r\n\t\t\t\t\t\tcolumns[ccount].id = cols[i].name;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tccount++;\r\n\t\t\t}\r\n\r\n\t\t\tgantt.exportMode = false;\r\n\t\t\treturn columns;\r\n\t\t},\r\n\r\n\t\t_exportSerialize() {\r\n\t\t\tgantt.exportMode = true;\r\n\r\n\t\t\tconst xmlFormat = gantt.templates.xml_format;\r\n\t\t\tconst formatDate = gantt.templates.format_date;\r\n\r\n\t\t\t// use configuration date format for serialization so date could be parsed on the export\r\n\t\t\t// required when custom format date function is defined\r\n\t\t\tgantt.templates.xml_format =\r\n\t\t\t\tgantt.templates.format_date =\r\n\t\t\t\tgantt.date.date_to_str(gantt.config.date_format || gantt.config.xml_date);\r\n\r\n\t\t\tconst data = gantt.serialize();\r\n\r\n\t\t\tgantt.templates.xml_format = xmlFormat;\r\n\t\t\tgantt.templates.format_date = formatDate;\r\n\t\t\tgantt.exportMode = false;\r\n\t\t\treturn data;\r\n\t\t},\r\n\r\n\r\n\t\t_setLevel(data:any) {\r\n\t\t\tfor (let i = 0; i < data.length; i++) {\r\n\t\t\t\t// tslint:disable-next-line triple-equals\r\n\t\t\t\tif (data[i].parent == 0) {\r\n\t\t\t\t\tdata[i]._lvl = 1;\r\n\t\t\t\t}\r\n\t\t\t\tfor (let j = i + 1; j < data.length; j++) {\r\n\t\t\t\t\t// tslint:disable-next-line triple-equals\r\n\t\t\t\t\tif (data[i].id == data[j].parent) {\r\n\t\t\t\t\t\tdata[j]._lvl = data[i]._lvl + 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_clearLevel(data:any) {\r\n\t\t\tfor (let i = 0; i < data.length; i++) {\r\n\t\t\t\tdelete data[i]._lvl;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_clearRecLinks(data:any) {\r\n\t\t\tgantt.ext.export_api._setLevel(data.data);\r\n\t\t\tconst tasks:any = {};\r\n\t\t\tfor (let i = 0; i < data.data.length; i++) {\r\n\t\t\t\ttasks[data.data[i].id] = data.data[i];\r\n\t\t\t}\r\n\r\n\t\t\tconst links:any = {};\r\n\r\n\t\t\tfor (let i = 0; i < data.links.length; i++) {\r\n\t\t\t\tconst link = data.links[i];\r\n\t\t\t\tif (gantt.isTaskExists(link.source) && gantt.isTaskExists(link.target) &&\r\n\t\t\t\t\ttasks[link.source] && tasks[link.target]) {\r\n\t\t\t\t\tlinks[link.id] = link;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (const j in links) {\r\n\t\t\t\tgantt.ext.export_api._makeLinksSameLevel(links[j], tasks);\r\n\t\t\t}\r\n\r\n\t\t\tconst skippedLinks = {};\r\n\t\t\tfor (const j in tasks) {\r\n\t\t\t\tgantt.ext.export_api._clearCircDependencies(tasks[j], links, tasks, {}, skippedLinks, null);\r\n\t\t\t}\r\n\r\n\t\t\tif (Object.keys(links)) {\r\n\t\t\t\tgantt.ext.export_api._clearLinksSameLevel(links, tasks);\r\n\t\t\t}\r\n\r\n\t\t\tfor (let i = 0; i < data.links.length; i++) {\r\n\t\t\t\tif (!links[data.links[i].id]) {\r\n\t\t\t\t\tdata.links.splice(i, 1);\r\n\t\t\t\t\ti--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tgantt.ext.export_api._clearLevel(data.data);\r\n\t\t},\r\n\r\n\t\t_clearCircDependencies(task:any, links:any, tasks:any, usedTasks:any, skippedLinks:any, prevLink:any) {\r\n\t\t\tconst sources = task.$_source;\r\n\t\t\tif (!sources) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (usedTasks[task.id]) {\r\n\t\t\t\tgantt.ext.export_api._onCircDependencyFind(prevLink, links, usedTasks, skippedLinks);\r\n\t\t\t}\r\n\r\n\t\t\tusedTasks[task.id] = true;\r\n\r\n\t\t\tconst targets:any = {};\r\n\r\n\t\t\tfor (let i = 0; i < sources.length; i++) {\r\n\t\t\t\tif (skippedLinks[sources[i]]) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tconst curLink = links[sources[i]];\r\n\t\t\t\tconst targetTask = tasks[curLink._target];\r\n\t\t\t\tif (targets[targetTask.id]) { // two link from one task to another\r\n\t\t\t\t\tgantt.ext.export_api._onCircDependencyFind(curLink, links, usedTasks, skippedLinks);\r\n\t\t\t\t}\r\n\t\t\t\ttargets[targetTask.id] = true;\r\n\t\t\t\tgantt.ext.export_api._clearCircDependencies(targetTask, links, tasks, usedTasks, skippedLinks, curLink);\r\n\t\t\t}\r\n\t\t\tusedTasks[task.id] = false;\r\n\t\t},\r\n\r\n\t\t_onCircDependencyFind(link:any, links:any, usedTasks:any, skippedLinks:any) {\r\n\t\t\tif (link) {\r\n\t\t\t\tif (gantt.callEvent(\"onExportCircularDependency\", [link.id, link])) {\r\n\t\t\t\t\tdelete links[link.id];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdelete usedTasks[link._source];\r\n\t\t\t\tdelete usedTasks[link._target];\r\n\t\t\t\tskippedLinks[link.id] = true;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_makeLinksSameLevel(link:any, tasks:any) {\r\n\t\t\tlet task;\r\n\t\t\tlet targetLvl;\r\n\t\t\tconst linkT:any = {\r\n\t\t\t\ttarget: tasks[link.target],\r\n\t\t\t\tsource: tasks[link.source]\r\n\t\t\t};\r\n\t\t\t// tslint:disable-next-line triple-equals\r\n\t\t\tif (linkT.target._lvl != linkT.source._lvl) {\r\n\t\t\t\tif (linkT.target._lvl < linkT.source._lvl) {\r\n\t\t\t\t\ttask = \"source\";\r\n\t\t\t\t\ttargetLvl = linkT.target._lvl;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttask = \"target\";\r\n\t\t\t\t\ttargetLvl = linkT.source._lvl;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdo {\r\n\t\t\t\t\tconst parent = tasks[linkT[task].parent];\r\n\t\t\t\t\tif (!parent) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlinkT[task] = parent;\r\n\t\t\t\t} while (linkT[task]._lvl < targetLvl);\r\n\r\n\t\t\t\tlet sourceParent = tasks[linkT.source.parent];\r\n\t\t\t\tlet\ttargetParent = tasks[linkT.target.parent];\r\n\t\t\t\t// tslint:disable-next-line triple-equals\r\n\t\t\t\twhile (sourceParent && targetParent && sourceParent.id != targetParent.id) {\r\n\t\t\t\t\tlinkT.source = sourceParent;\r\n\t\t\t\t\tlinkT.target = targetParent;\r\n\t\t\t\t\tsourceParent = tasks[linkT.source.parent];\r\n\t\t\t\t\ttargetParent = tasks[linkT.target.parent];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlink._target = linkT.target.id;\r\n\t\t\tlink._source = linkT.source.id;\r\n\r\n\t\t\tif (!linkT.target.$_target){\r\n\t\t\t\tlinkT.target.$_target = [];\r\n\t\t\t}\r\n\t\t\tlinkT.target.$_target.push(link.id);\r\n\r\n\t\t\tif (!linkT.source.$_source){\r\n\t\t\t\tlinkT.source.$_source = [];\r\n\t\t\t}\r\n\t\t\tlinkT.source.$_source.push(link.id);\r\n\t\t},\r\n\r\n\t\t_clearLinksSameLevel(links:any, tasks:any) {\r\n\t\t\tfor (const link in links) {\r\n\t\t\t\tdelete links[link]._target;\r\n\t\t\t\tdelete links[link]._source;\r\n\t\t\t}\r\n\r\n\t\t\tfor (const task in tasks) {\r\n\t\t\t\tdelete tasks[task].$_source;\r\n\t\t\t\tdelete tasks[task].$_target;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\t_customProjectProperties(data:any, config:any) {\r\n\t\t\tif (config && config.project) {\r\n\t\t\t\tfor (const i in config.project) {\r\n\t\t\t\t\tif (!gantt.config.$custom_data){\r\n\t\t\t\t\t\tgantt.config.$custom_data = {};\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgantt.config.$custom_data[i] = typeof config.project[i] === \"function\" ? config.project[i](gantt.config) : config.project[i];\r\n\t\t\t\t}\r\n\t\t\t\tdelete config.project;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_customTaskProperties(data:any, config:any) {\r\n\t\t\tif (config && config.tasks) {\r\n\t\t\t\tdata.data.forEach(function(el:any) {\r\n\t\t\t\t\tfor (const i in config.tasks) {\r\n\t\t\t\t\t\tif (!el.$custom_data){\r\n\t\t\t\t\t\t\tel.$custom_data = {};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tel.$custom_data[i] = typeof config.tasks[i] === \"function\" ? config.tasks[i](el, gantt.config) : config.tasks[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tdelete config.tasks;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_exportConfig(data:any, config:any) {\r\n\t\t\tconst projectName = config.name || \"gantt.xml\";\r\n\t\t\tdelete config.name;\r\n\r\n\t\t\tgantt.config.custom = config;\r\n\r\n\t\t\tconst time = gantt.ext.export_api._getWorktimeSettings();\r\n\r\n\t\t\tconst projectDates = gantt.getSubtaskDates();\r\n\t\t\tif (projectDates.start_date && projectDates.end_date) {\r\n\t\t\t\tconst formatDate = gantt.templates.format_date || gantt.templates.xml_format;\r\n\t\t\t\tgantt.config.start_end = {\r\n\t\t\t\t\tstart_date: formatDate(projectDates.start_date),\r\n\t\t\t\t\tend_date: formatDate(projectDates.end_date)\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tconst autoSchedulingConfig = gantt._getAutoSchedulingConfig();\r\n\r\n\t\t\tconst manual = !!(autoSchedulingConfig.enabled);\r\n\r\n\t\t\tconst res:any = {\r\n\t\t\t\tcallback: config.callback || null,\r\n\t\t\t\tconfig: gantt.config,\r\n\t\t\t\tdata,\r\n\t\t\t\tmanual,\r\n\t\t\t\tname: projectName,\r\n\t\t\t\tworktime: time\r\n\t\t\t};\r\n\t\t\tfor (const i in config) {\r\n\t\t\t\tres[i] = config[i];\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t},\r\n\r\n\r\n\t\t_sendImportAjaxMSP(config:any) {\r\n\t\t\tconst url = config.server || gantt.ext.export_api._apiUrl;\r\n\t\t\tconst store = config.store || 0;\r\n\t\t\tconst formData = config.data;\r\n\t\t\tconst callback = config.callback;\r\n\r\n\t\t\tconst settings = {\r\n\t\t\t\tdurationUnit: config.durationUnit || undefined,\r\n\t\t\t\tprojectProperties: config.projectProperties || undefined,\r\n\t\t\t\ttaskProperties: config.taskProperties || undefined,\r\n\t\t\t\tresourceProperties: config.resourceProperties || undefined,\r\n\t\t\t};\r\n\r\n\t\t\tformData.append(\"type\", config.type || \"msproject-parse\");\r\n\t\t\tformData.append(\"data\", JSON.stringify(settings));\r\n\r\n\t\t\tif (store){\r\n\t\t\t\tformData.append(\"store\", store);\r\n\t\t\t}\r\n\r\n\t\t\tconst xhr = new XMLHttpRequest();\r\n\t\t\txhr.onreadystatechange = function(e) {\r\n\t\t\t\tif (xhr.readyState === 4 && xhr.status === 0) {// network error\r\n\t\t\t\t\tif (callback) {\r\n\t\t\t\t\t\tcallback(null);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\txhr.onload = function(){\r\n\t\t\t\tconst fail = xhr.status > 400;\r\n\t\t\t\tlet info = null;\r\n\r\n\t\t\t\tif (!fail) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tinfo = JSON.parse(xhr.responseText);\r\n\t\t\t\t\t} catch (e) { }\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (callback) {\r\n\t\t\t\t\tcallback(info);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\txhr.open(\"POST\", url, true);\r\n\t\t\txhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\r\n\t\t\txhr.send(formData);\r\n\t\t}\r\n\r\n\t};\r\n\r\n\r\n\tgantt.exportToPDF = gantt.ext.export_api.exportToPDF;\r\n\tgantt.exportToPNG = gantt.ext.export_api.exportToPNG;\r\n\tgantt.exportToICal = gantt.ext.export_api.exportToICal;\r\n\tgantt.exportToExcel = gantt.ext.export_api.exportToExcel;\r\n\tgantt.exportToJSON = gantt.ext.export_api.exportToJSON;\r\n\tgantt.importFromExcel = gantt.ext.export_api.importFromExcel;\r\n\tgantt.importFromMSProject = gantt.ext.export_api.importFromMSProject;\r\n\tgantt.exportToMSProject = gantt.ext.export_api.exportToMSProject;\r\n\tgantt.importFromPrimaveraP6 = gantt.ext.export_api.importFromPrimaveraP6;\r\n\tgantt.exportToPrimaveraP6 = gantt.ext.export_api.exportToPrimaveraP6;\r\n\r\n\r\n\treturn gantt.ext.export_api;\r\n}\r\n","export default function(gantt: any){\r\n\r\ninterface IBody extends HTMLElement {\r\n\tmsRequestFullscreen?: () => void;\r\n\tmozRequestFullScreen?: () => void;\r\n\twebkitRequestFullscreen?: (ALLOW_KEYBOARD_INPUT: any) => void;\r\n}\r\n\r\n\r\ninterface IConsole extends Console {\r\n\twarning?: (str: string) => void;\r\n}\r\n\r\ninterface IDocument extends Document {\r\n\tfullscreenElement: Element;\r\n\tmozFullScreenElement?: Element;\r\n\twebkitFullscreenElement?: Element;\r\n\tmsFullscreenElement?: Element;\r\n\twebkitFullscreenEnabled?: boolean;\r\n\tmozFullScreenEnabled?: boolean;\r\n\tmsFullscreenEnabled?: boolean;\r\n\tmsExitFullscreen?: () => void;\r\n\tmozCancelFullScreen?: () => void;\r\n\twebkitExitFullscreen?: () => void;\r\n}\r\n\r\ninterface IElement extends Element {\r\n\tALLOW_KEYBOARD_INPUT?: boolean;\r\n}\r\n\r\ninterface IElementSizes extends ISizes {\r\n\tmodified: boolean;\r\n}\r\n\r\ninterface ISizes {\r\n\twidth: null | string;\r\n\theight: null | string;\r\n\ttop: null | string;\r\n\tleft: null | string;\r\n\tposition: null | string;\r\n\tzIndex: null | number;\r\n}\r\n\r\nfunction isExpanded() {\r\n\tconst element = ((document as IDocument).fullscreenElement ||\r\n\t\t(document as IDocument).mozFullScreenElement ||\r\n\t\t(document as IDocument).webkitFullscreenElement ||\r\n\t\t(document as IDocument).msFullscreenElement);\r\n\treturn !!(element && element === document.body);\r\n}\r\n\r\nfunction isFullscreenAvailable() {\r\n\ttry {\r\n\t\treturn (document as IDocument).fullscreenEnabled ||\r\n\t\t\t(document as IDocument).webkitFullscreenEnabled ||\r\n\t\t\t(document as IDocument).mozFullScreenEnabled ||\r\n\t\t\t(document as IDocument).msFullscreenEnabled;\r\n\t} catch (e) {\r\n\t\t// eslint-disable-next-line no-console\r\n\t\tconsole.error(\"Fullscreen is not available:\", e); \r\n\t}\r\n}\r\n\r\nconst state = gantt.$services.getService(\"state\");\r\nstate.registerProvider(\"fullscreen\", () => {\r\n\tif (isFullscreenAvailable()){\r\n\t\treturn { fullscreen: isExpanded() };\r\n\t} else {\r\n\t\treturn undefined;\r\n\t}\r\n});\r\n\r\nlet backupBodyPadding = {\r\n\toverflow: null,\r\n\tpadding: null,\r\n\tpaddingTop: null,\r\n\tpaddingRight: null,\r\n\tpaddingBottom: null,\r\n\tpaddingLeft: null\r\n};\r\n\r\nconst backupElementSizes: IElementSizes = {\r\n\twidth: null,\r\n\theight: null,\r\n\ttop: null,\r\n\tleft: null,\r\n\tposition: null,\r\n\tzIndex: null,\r\n\tmodified: false\r\n};\r\n\r\nlet backupPositioning = null;\r\nfunction resetParentPositioning(root){\r\n\tlet parent = root.parentNode;\r\n\tconst positions = [];\r\n\twhile(parent && parent.style){\r\n\t\tpositions.push({\r\n\t\t\telement: parent,\r\n\t\t\toriginalPositioning: parent.style.position\r\n\t\t});\r\n\t\tparent.style.position = \"static\";\r\n\t\tparent = parent.parentNode;\r\n\t}\r\n\treturn positions;\r\n}\r\n\r\nfunction restoreParentPositioning(positions: any[]){\r\n\tpositions.forEach(record => {\r\n\t\trecord.element.style.position = record.originalPositioning;\r\n\t});\r\n}\r\n\r\n// expand gantt root element to fullscreen automatically\r\nfunction setFullScreenSizes() {\r\n\tconst root = gantt.ext.fullscreen.getFullscreenElement();\r\n\tconst body = document.body;\r\n\tupdateSizes(root.style, backupElementSizes);\r\n\tbackupBodyPadding = {\r\n\t\toverflow: body.style.overflow,\r\n\t\tpadding: body.style.padding ? body.style.padding : null,\r\n\t\tpaddingTop: body.style.paddingTop ? body.style.paddingTop : null,\r\n\t\tpaddingRight: body.style.paddingRight ? body.style.paddingRight : null,\r\n\t\tpaddingBottom: body.style.paddingBottom ? body.style.paddingBottom : null,\r\n\t\tpaddingLeft: body.style.paddingLeft ? body.style.paddingLeft : null\r\n\t};\r\n\r\n\tif (body.style.padding) {\r\n\t\tbody.style.padding = \"0\";\r\n\t}\r\n\tif (body.style.paddingTop) {\r\n\t\tbody.style.paddingTop = \"0\";\r\n\t}\r\n\tif (body.style.paddingRight) {\r\n\t\tbody.style.paddingRight = \"0\";\r\n\t}\r\n\tif (body.style.paddingBottom) {\r\n\t\tbody.style.paddingBottom = \"0\";\r\n\t}\r\n\tif (body.style.paddingLeft) {\r\n\t\tbody.style.paddingLeft = \"0\";\r\n\t}\r\n\r\n\tbody.style.overflow = \"hidden\";\r\n\r\n\troot.style.width = \"100vw\";\r\n\troot.style.height = \"100vh\";\r\n\troot.style.top = \"0px\";\r\n\troot.style.left = \"0px\";\r\n\troot.style.position = \"absolute\";\r\n\troot.style.zIndex = 1;\r\n\tbackupElementSizes.modified = true;\r\n\tbackupPositioning = resetParentPositioning(root);\r\n}\r\n\r\nfunction restoreSizes() {\r\n\tconst root = gantt.ext.fullscreen.getFullscreenElement();\r\n\tconst body = document.body;\r\n\tif (backupElementSizes.modified) {\r\n\t\tif (backupBodyPadding.padding) {\r\n\t\t\tbody.style.padding = backupBodyPadding.padding;\r\n\t\t}\r\n\t\tif (backupBodyPadding.paddingTop) {\r\n\t\t\tbody.style.paddingTop = backupBodyPadding.paddingTop;\r\n\t\t}\r\n\t\tif (backupBodyPadding.paddingRight) {\r\n\t\t\tbody.style.paddingRight = backupBodyPadding.paddingRight;\r\n\t\t}\r\n\t\tif (backupBodyPadding.paddingBottom) {\r\n\t\t\tbody.style.paddingBottom = backupBodyPadding.paddingBottom;\r\n\t\t}\r\n\t\tif (backupBodyPadding.paddingLeft) {\r\n\t\t\tbody.style.paddingLeft = backupBodyPadding.paddingLeft;\r\n\t\t}\r\n\r\n\t\tbody.style.overflow = backupBodyPadding.overflow;\r\n\t\tbackupBodyPadding = {\r\n\t\t\toverflow: null,\r\n\t\t\tpadding: null,\r\n\t\t\tpaddingTop: null,\r\n\t\t\tpaddingRight: null,\r\n\t\t\tpaddingBottom: null,\r\n\t\t\tpaddingLeft: null\r\n\t\t};\r\n\t\tupdateSizes(backupElementSizes, root.style);\r\n\t\tbackupElementSizes.modified = false;\r\n\t}\r\n\trestoreParentPositioning(backupPositioning);\r\n\tbackupPositioning = null;\r\n}\r\n\r\nfunction updateSizes(source: ISizes, target: ISizes) {\r\n\ttarget.width = source.width;\r\n\ttarget.height = source.height;\r\n\ttarget.top = source.top;\r\n\ttarget.left = source.left;\r\n\ttarget.position = source.position;\r\n\ttarget.zIndex = source.zIndex;\r\n}\r\n\r\nfunction addDOMEvents() {\r\n\tgantt.event(document, \"webkitfullscreenchange\", onFullScreenChange);\r\n\tgantt.event(document, \"mozfullscreenchange\", onFullScreenChange);\r\n\tgantt.event(document, \"MSFullscreenChange\", onFullScreenChange);\r\n\t// For IE on Win 10\r\n\tgantt.event(document, \"fullscreenChange\", onFullScreenChange);\r\n\tgantt.event(document, \"fullscreenchange\", onFullScreenChange);\r\n}\r\n\r\nlet expandGantt = false;\r\nfunction onFullScreenChange() {\r\n\tif (!gantt.$container) {\r\n\t\t// do nothing if gantt is not yet initialized\r\n\t\treturn;\r\n\t}\r\n\tlet event: \"onExpand\" | \"onCollapse\";\r\n\tconst isBodyExpanded = isExpanded();\r\n\r\n\tif (isBodyExpanded) {\r\n\t\tif (expandGantt) {\r\n\t\t\tevent = \"onExpand\";\r\n\t\t\tsetFullScreenSizes();\r\n\t\t}\r\n\t} else if (expandGantt) {\r\n\t\texpandGantt = false;\r\n\t\tevent = \"onCollapse\";\r\n\t\trestoreSizes();\r\n\t}\r\n\tsetTimeout(() => {\r\n\t\tgantt.render();\r\n\t});\r\n\tsetTimeout(() => {\r\n\t\tgantt.callEvent(event, [gantt.ext.fullscreen.getFullscreenElement()]);\r\n\t});\r\n}\r\n\r\nfunction cantFullscreen() {\r\n\tif (!gantt.$container) { // check is gantt initialized or not\r\n\t\treturn true;\r\n\t}\r\n\tif (!gantt.ext.fullscreen.getFullscreenElement()) {\r\n\t\treturn true;\r\n\t}\r\n\tif (!isFullscreenAvailable()) {\r\n\t\t// eslint-disable-next-line no-console\r\n\t\tconst method = (console as IConsole).warning || console.log;\r\n\t\tmethod(\"The `fullscreen` feature not being allowed, or full-screen mode not being supported\");\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\ngantt.ext.fullscreen = {\r\n\texpand(): void {\r\n\t\tif (cantFullscreen()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (isExpanded()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!gantt.callEvent(\"onBeforeExpand\", [this.getFullscreenElement()])) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\texpandGantt = true;\r\n\r\n\t\t// we switch body to fullscreen and then expand fullscreen element to viewport\r\n\t\t// we do it to correct display common elements: lightboxes, tooltip etc.\r\n\t\tconst element = document.body as IBody;\r\n\t\tconst requestArguments = element.webkitRequestFullscreen ?\r\n\t\t\t[(Element as unknown as IElement).ALLOW_KEYBOARD_INPUT] : [];\r\n\r\n\t\tconst requestFullscreen = element.msRequestFullscreen ||\r\n\t\t\telement.mozRequestFullScreen ||\r\n\t\t\telement.webkitRequestFullscreen ||\r\n\t\t\telement.requestFullscreen;\r\n\r\n\t\tif (requestFullscreen) {\r\n\t\t\trequestFullscreen.apply(element, requestArguments);\r\n\t\t}\r\n\t},\r\n\tcollapse(): void {\r\n\t\tif (cantFullscreen()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!isExpanded()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!gantt.callEvent(\"onBeforeCollapse\", [this.getFullscreenElement()])) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst requestExitFullscreen = (document as IDocument).msExitFullscreen ||\r\n\t\t\t(document as IDocument).mozCancelFullScreen ||\r\n\t\t\t(document as IDocument).webkitExitFullscreen ||\r\n\t\t\t(document as IDocument).exitFullscreen;\r\n\r\n\t\tif (requestExitFullscreen) {\r\n\t\t\trequestExitFullscreen.apply(document);\r\n\t\t}\r\n\t},\r\n\ttoggle(): void {\r\n\t\tif (cantFullscreen()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!isExpanded()) {\r\n\t\t\tthis.expand();\r\n\t\t} else {\r\n\t\t\tthis.collapse();\r\n\t\t}\r\n\r\n\t},\r\n\tgetFullscreenElement(): HTMLElement {\r\n\t\treturn gantt.$root;\r\n\t}\r\n};\r\n\r\ngantt.expand = function() {\r\n\tgantt.ext.fullscreen.expand();\r\n};\r\n\r\ngantt.collapse = function(){\r\n\tgantt.ext.fullscreen.collapse();\r\n};\r\n\r\ngantt.attachEvent(\"onGanttReady\", addDOMEvents);\r\n\r\n}","export default function(gantt) {\r\n\r\n\tgantt.$keyboardNavigation.shortcuts = {\r\n\t\tcreateCommand: function () {\r\n\t\t\treturn {\r\n\t\t\t\tmodifiers: {\r\n\t\t\t\t\t\"shift\": false,\r\n\t\t\t\t\t\"alt\": false,\r\n\t\t\t\t\t\"ctrl\": false,\r\n\t\t\t\t\t\"meta\": false\r\n\t\t\t\t},\r\n\t\t\t\tkeyCode: null\r\n\t\t\t};\r\n\t\t},\r\n\t\tparse: function (shortcut) {\r\n\t\t\tvar commands = [];\r\n\r\n\t\t\tvar expr = this.getExpressions(this.trim(shortcut));\r\n\t\t\tfor (var i = 0; i < expr.length; i++) {\r\n\t\t\t\tvar words = this.getWords(expr[i]);\r\n\r\n\t\t\t\tvar command = this.createCommand();\r\n\r\n\t\t\t\tfor (var j = 0; j < words.length; j++) {\r\n\t\t\t\t\tif (this.commandKeys[words[j]]) {\r\n\t\t\t\t\t\tcommand.modifiers[words[j]] = true;\r\n\t\t\t\t\t} else if (this.specialKeys[words[j]]) {\r\n\t\t\t\t\t\tcommand.keyCode = this.specialKeys[words[j]];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcommand.keyCode = words[j].charCodeAt(0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcommands.push(command);\r\n\t\t\t}\r\n\t\t\treturn commands;\r\n\t\t},\r\n\r\n\t\tgetCommandFromEvent: function (domEvent) {\r\n\t\t\tvar command = this.createCommand();\r\n\t\t\tcommand.modifiers.shift = !!domEvent.shiftKey;\r\n\t\t\tcommand.modifiers.alt = !!domEvent.altKey;\r\n\t\t\tcommand.modifiers.ctrl = !!domEvent.ctrlKey;\r\n\t\t\tcommand.modifiers.meta = !!domEvent.metaKey;\r\n\t\t\tcommand.keyCode = domEvent.which || domEvent.keyCode;\r\n\r\n\t\t\tif(command.keyCode >= 96 && command.keyCode <= 105){\r\n\t\t\t\t// numpad keys 96-105 -> 48-57\r\n\t\t\t\tcommand.keyCode -= 48;//convert numpad  number code to regular number code\r\n\t\t\t}\r\n\r\n\t\t\tvar printableKey = String.fromCharCode(command.keyCode);\r\n\t\t\tif (printableKey) {\r\n\t\t\t\tcommand.keyCode = printableKey.toLowerCase().charCodeAt(0);\r\n\t\t\t}\r\n\t\t\treturn command;\r\n\t\t},\r\n\r\n\t\tgetHashFromEvent: function (domEvent) {\r\n\t\t\treturn this.getHash(this.getCommandFromEvent(domEvent));\r\n\t\t},\r\n\r\n\t\tgetHash: function (command) {\r\n\t\t\tvar parts = [];\r\n\t\t\tfor (var i in command.modifiers) {\r\n\t\t\t\tif (command.modifiers[i]) {\r\n\t\t\t\t\tparts.push(i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tparts.push(command.keyCode);\r\n\r\n\t\t\treturn parts.join(this.junctionChar);\r\n\t\t},\r\n\r\n\t\tgetExpressions: function (shortcut) {\r\n\t\t\treturn shortcut.split(this.junctionChar);\r\n\t\t},\r\n\t\tgetWords: function (term) {\r\n\t\t\treturn term.split(this.combinationChar);\r\n\t\t},\r\n\t\ttrim: function (shortcut) {\r\n\t\t\treturn shortcut.replace(/\\s/g, \"\");\r\n\t\t},\r\n\t\tjunctionChar: \",\",\r\n\t\tcombinationChar: \"+\",\r\n\t\tcommandKeys: {\r\n\t\t\t\"shift\": 16,\r\n\t\t\t\"alt\": 18,\r\n\t\t\t\"ctrl\": 17,\r\n\t\t\t\"meta\": true\r\n\t\t},\r\n\t\tspecialKeys: {\r\n\t\t\t\"backspace\": 8,\r\n\t\t\t\"tab\": 9,\r\n\t\t\t\"enter\": 13,\r\n\t\t\t\"esc\": 27,\r\n\t\t\t\"space\": 32,\r\n\t\t\t\"up\": 38,\r\n\t\t\t\"down\": 40,\r\n\t\t\t\"left\": 37,\r\n\t\t\t\"right\": 39,\r\n\t\t\t\"home\": 36,\r\n\t\t\t\"end\": 35,\r\n\t\t\t\"pageup\": 33,\r\n\t\t\t\"pagedown\": 34,\r\n\t\t\t\"delete\": 46,\r\n\t\t\t\"insert\": 45,\r\n\t\t\t\"plus\": 107,\r\n\t\t\t\"f1\": 112,\r\n\t\t\t\"f2\": 113,\r\n\t\t\t\"f3\": 114,\r\n\t\t\t\"f4\": 115,\r\n\t\t\t\"f5\": 116,\r\n\t\t\t\"f6\": 117,\r\n\t\t\t\"f7\": 118,\r\n\t\t\t\"f8\": 119,\r\n\t\t\t\"f9\": 120,\r\n\t\t\t\"f10\": 121,\r\n\t\t\t\"f11\": 122,\r\n\t\t\t\"f12\": 123\r\n\t\t}\r\n\t};\r\n};","export default function(gantt) {\r\n\r\n\tgantt.$keyboardNavigation.EventHandler = {\r\n\t\t_handlers: null,\r\n\t\tfindHandler: function (command) {\r\n\t\t\tif (!this._handlers) this._handlers = {};\r\n\t\t\tvar shortcuts = gantt.$keyboardNavigation.shortcuts;\r\n\t\t\tvar hash = shortcuts.getHash(command);\r\n\r\n\t\t\treturn this._handlers[hash];\r\n\t\t},\r\n\r\n\t\tdoAction: function (command, e) {\r\n\t\t\tvar handler = this.findHandler(command);\r\n\t\t\tif (handler) {\r\n\t\t\t\tvar eventFacade = gantt.$keyboardNavigation.facade;\r\n\r\n\t\t\t\tif(eventFacade.callEvent(\"onBeforeAction\", [command, e]) === false){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\thandler.call(this, e);\r\n\r\n\t\t\t\tif (e.preventDefault) e.preventDefault();\r\n\t\t\t\telse e.returnValue = false;\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\tbind: function (shortcut, handler) {\r\n\t\t\tif (!this._handlers) this._handlers = {};\r\n\r\n\t\t\tvar shortcuts = gantt.$keyboardNavigation.shortcuts;\r\n\r\n\t\t\tvar commands = shortcuts.parse(shortcut);\r\n\t\t\tfor (var i = 0; i < commands.length; i++) {\r\n\t\t\t\tthis._handlers[shortcuts.getHash(commands[i])] = handler;\r\n\t\t\t}\r\n\t\t},\r\n\t\tunbind: function (shortcut) {\r\n\t\t\tvar shortcuts = gantt.$keyboardNavigation.shortcuts;\r\n\r\n\t\t\tvar commands = shortcuts.parse(shortcut);\r\n\t\t\tfor (var i = 0; i < commands.length; i++) {\r\n\t\t\t\tif (this._handlers[shortcuts.getHash(commands[i])]) {\r\n\t\t\t\t\tdelete this._handlers[shortcuts.getHash(commands[i])];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tbindAll: function (map) {\r\n\t\t\tfor (var i in map) {\r\n\t\t\t\tthis.bind(i, map[i]);\r\n\t\t\t}\r\n\t\t},\r\n\t\tinitKeys: function () {\r\n\t\t\tif (!this._handlers)\r\n\t\t\t\tthis._handlers = {};\r\n\t\t\tif (this.keys) {\r\n\t\t\t\tthis.bindAll(this.keys);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n};","import * as domHelpers from \"../../../core/ui/utils/dom_helpers\";\r\n\r\nexport default function(gantt) {\r\n\r\n\t(function () {\r\n\t\t\r\n\t\tgantt.$keyboardNavigation.getFocusableNodes = domHelpers.getFocusableNodes;\r\n\r\n\t\tgantt.$keyboardNavigation.trapFocus = function trapFocus(root, e) {\r\n\t\t\tif (e.keyCode != 9) return false;\r\n\r\n\t\t\tvar focusable = gantt.$keyboardNavigation.getFocusableNodes(root);\r\n\t\t\tvar currentFocus = domHelpers.getActiveElement();\r\n\t\t\tvar currentIndex = -1;\r\n\t\t\tfor (var i = 0; i < focusable.length; i++) {\r\n\t\t\t\tif (focusable[i] == currentFocus) {\r\n\t\t\t\t\tcurrentIndex = i;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (e.shiftKey) {\r\n\t\t\t\t// back tab\r\n\t\t\t\tif (currentIndex <= 0) {\r\n\t\t\t\t\t// go to the last element if we focused on the first\r\n\t\t\t\t\tvar lastItem = focusable[focusable.length - 1];\r\n\t\t\t\t\tif (lastItem) {\r\n\t\t\t\t\t\tlastItem.focus();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\t\t\t\t// forward tab\r\n\t\t\t\tif (currentIndex >= focusable.length - 1) {\r\n\t\t\t\t\t// forward tab from last element should go back to the first element\r\n\t\t\t\t\tvar firstItem = focusable[0];\r\n\t\t\t\t\tif (firstItem) {\r\n\t\t\t\t\t\tfirstItem.focus();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t};\r\n\t})();\r\n\r\n};","export default function(gantt) {\r\n\r\n\tgantt.$keyboardNavigation.GanttNode = function () {\r\n\t};\r\n\r\n\tgantt.$keyboardNavigation.GanttNode.prototype = gantt._compose(\r\n\t\tgantt.$keyboardNavigation.EventHandler,\r\n\t\t{\r\n\r\n\t\t\tfocus: function () {\r\n\t\t\t\tgantt.focus();\r\n\t\t\t},\r\n\r\n\t\t\tblur: function () {\r\n\r\n\t\t\t},\r\n\r\n\t\t\tisEnabled: function () {\r\n\t\t\t\treturn gantt.$container.hasAttribute(\"tabindex\");\r\n\t\t\t},\r\n\r\n\t\t\tscrollHorizontal: function scrollHorizontal(dir) {\r\n\t\t\t\tvar date = gantt.dateFromPos(gantt.getScrollState().x);\r\n\t\t\t\tvar scale = gantt.getScale();\r\n\t\t\t\tvar step = dir < 0 ? -scale.step : scale.step;\r\n\t\t\t\tdate = gantt.date.add(date, step, scale.unit);\r\n\t\t\t\tgantt.scrollTo(gantt.posFromDate(date));\r\n\t\t\t},\r\n\r\n\t\t\tscrollVertical: function scrollVertical(dir) {\r\n\t\t\t\tvar top = gantt.getScrollState().y;\r\n\t\t\t\tvar step = gantt.config.row_height;\r\n\t\t\t\tgantt.scrollTo(null, top + (dir < 0 ? -1 : 1) * step);\r\n\t\t\t},\r\n\r\n\t\t\tkeys: {\r\n\t\t\t\t\"alt+left\": function (e) {\r\n\t\t\t\t\tthis.scrollHorizontal(-1);\r\n\t\t\t\t},\r\n\t\t\t\t\"alt+right\": function (e) {\r\n\t\t\t\t\tthis.scrollHorizontal(1);\r\n\t\t\t\t},\r\n\t\t\t\t\"alt+up\": function (e) {\r\n\t\t\t\t\tthis.scrollVertical(-1);\r\n\t\t\t\t},\r\n\t\t\t\t\"alt+down\": function (e) {\r\n\t\t\t\t\tthis.scrollVertical(1);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// undo\r\n\t\t\t\t\"ctrl+z\": function () {\r\n\t\t\t\t\tif (gantt.undo) gantt.undo();\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// redo\r\n\t\t\t\t\"ctrl+r\": function () {\r\n\t\t\t\t\tif (gantt.redo) gantt.redo();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\r\n\tgantt.$keyboardNavigation.GanttNode.prototype.bindAll(gantt.$keyboardNavigation.GanttNode.prototype.keys);\r\n\r\n};","export default function(gantt) {\r\n\r\n\tgantt.$keyboardNavigation.KeyNavNode = function () {\r\n\t};\r\n\r\n\tgantt.$keyboardNavigation.KeyNavNode.prototype = gantt._compose(\r\n\t\tgantt.$keyboardNavigation.EventHandler,\r\n\t\t{\r\n\t\t\tisValid: function () {\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t\tfallback: function () {\r\n\t\t\t\treturn null;\r\n\t\t\t},\r\n\r\n\t\t\tmoveTo: function (element) {\r\n\t\t\t\tgantt.$keyboardNavigation.dispatcher.setActiveNode(element);\r\n\t\t\t},\r\n\r\n\t\t\tcompareTo: function (b) {\r\n\t\t\t\t// good enough comparison of two random objects\r\n\t\t\t\tif (!b) return false;\r\n\t\t\t\tfor (var i in this) {\r\n\t\t\t\t\tif (!!this[i] != !!b[i]) return false;\r\n\r\n\t\t\t\t\tvar canStringifyThis = !!(this[i] && this[i].toString);\r\n\t\t\t\t\tvar canStringifyThat = !!(b[i] && b[i].toString);\r\n\t\t\t\t\tif (canStringifyThat != canStringifyThis) return false;\r\n\t\t\t\t\tif (!(canStringifyThat && canStringifyThis)) {\r\n\t\t\t\t\t\tif (b[i] != this[i]) return false;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (b[i].toString() != this[i].toString())\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\r\n\t\t\tgetNode: function () {\r\n\t\t\t},\r\n\t\t\tfocus: function () {\r\n\t\t\t\tvar node = this.getNode();\r\n\t\t\t\tif(!node)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tvar eventFacade = gantt.$keyboardNavigation.facade;\r\n\r\n\t\t\t\tif(eventFacade.callEvent(\"onBeforeFocus\", [node]) === false){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (node) {\r\n\t\t\t\t\tnode.setAttribute(\"tabindex\", \"-1\");\r\n\t\t\t\t\tif(!node.$eventAttached){\r\n\t\t\t\t\t\tnode.$eventAttached = true;\r\n\t\t\t\t\t\tgantt.event(node, \"focus\",function(e){\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}, false);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//node.className += \" gantt_focused\";\r\n\t\t\t\t\tif (gantt.utils.dom.isChildOf(document.activeElement, node)){\r\n\t\t\t\t\t\tnode = document.activeElement;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (node.focus) node.focus();\r\n\r\n\t\t\t\t\teventFacade.callEvent(\"onFocus\", [this.getNode()]);\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\t\t\tblur: function () {\r\n\t\t\t\tvar node = this.getNode();\r\n\t\t\t\tif (node) {\r\n\t\t\t\t\tvar eventFacade = gantt.$keyboardNavigation.facade;\r\n\t\t\t\t\teventFacade.callEvent(\"onBlur\", [node]);\r\n\t\t\t\t\tnode.setAttribute(\"tabindex\", \"-1\");\r\n\t\t\t\t\t//node.className = (node.className || \"\").replace(/ ?gantt_focused/g, \"\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\r\n};","import * as domHelpers from \"../../../core/ui/utils/dom_helpers\";\r\n\r\nexport default function(gantt) {\r\n\r\n\tgantt.$keyboardNavigation.HeaderCell = function (index) {\r\n\t\tthis.index = index || 0;\r\n\t};\r\n\r\n\tgantt.$keyboardNavigation.HeaderCell.prototype = gantt._compose(\r\n\t\tgantt.$keyboardNavigation.KeyNavNode,\r\n\t\t{\r\n\t\t\t_handlers: null,\r\n\r\n\t\t\tisValid: function () {\r\n\t\t\t\tif (!gantt.config.show_grid) {\r\n\t\t\t\t\tif (gantt.getVisibleTaskCount())\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\treturn !!gantt.getGridColumns()[this.index] || !gantt.getVisibleTaskCount();\r\n\t\t\t},\r\n\t\t\tfallback: function () {\r\n\t\t\t\tif (!gantt.config.show_grid) {\r\n\t\t\t\t\tif (gantt.getVisibleTaskCount()) {\r\n\t\t\t\t\t\treturn new gantt.$keyboardNavigation.TaskRow();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t\tvar visibleColumns = gantt.getGridColumns();\r\n\t\t\t\tvar index = this.index;\r\n\t\t\t\twhile (index >= 0) {\r\n\t\t\t\t\tif (visibleColumns[index])\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tindex--;\r\n\t\t\t\t}\r\n\t\t\t\tif (visibleColumns[index]) {\r\n\t\t\t\t\treturn new gantt.$keyboardNavigation.HeaderCell(index);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tfromDomElement: function(el){\r\n\t\t\t\tvar cellElement = domHelpers.locateClassName(el, \"gantt_grid_head_cell\");\r\n\t\t\t\tif(cellElement){\r\n\t\t\t\t\tvar index = 0;\r\n\t\t\t\t\twhile(cellElement && cellElement.previousSibling){\r\n\t\t\t\t\t\tcellElement = cellElement.previousSibling;\r\n\t\t\t\t\t\tindex += 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn new gantt.$keyboardNavigation.HeaderCell(index);\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tgetNode: function () {\r\n\t\t\t\tconst scale = gantt.$grid_scale;\r\n\t\t\t\tif (!scale){\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t\tconst cells = scale.childNodes;\r\n\t\t\t\treturn cells[this.index];\r\n\t\t\t},\r\n\r\n\r\n\t\t\tkeys: {\r\n\r\n\t\t\t\t\"left\": function () {\r\n\t\t\t\t\tif (this.index > 0) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.HeaderCell(this.index - 1));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"right\": function () {\r\n\t\t\t\t\tvar columns = gantt.getGridColumns();\r\n\t\t\t\t\tif (this.index < columns.length - 1) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.HeaderCell(this.index + 1));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"down\": function () {\r\n\t\t\t\t\tvar taskRow;\r\n\t\t\t\t\tvar rootLevel = gantt.getChildren(gantt.config.root_id);\r\n\t\t\t\t\tif (gantt.isTaskExists(rootLevel[0])) {\r\n\t\t\t\t\t\ttaskRow = rootLevel[0];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (taskRow) {\r\n\t\t\t\t\t\tif (gantt.config.keyboard_navigation_cells) {\r\n\t\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(taskRow, this.index));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskRow(taskRow));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\t\"end\": function () {\r\n\t\t\t\t\tvar columns = gantt.getGridColumns();\r\n\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.HeaderCell(columns.length - 1));\r\n\t\t\t\t},\r\n\t\t\t\t\"home\": function () {\r\n\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.HeaderCell(0));\r\n\t\t\t\t},\r\n\r\n\r\n\t\t\t\t// press header button\r\n\t\t\t\t\"enter, space\": function () {\r\n\t\t\t\t\tvar node = domHelpers.getActiveElement();\r\n\t\t\t\t\tnode.click();\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// add new task\r\n\t\t\t\t\"ctrl+enter\": function () {\r\n\t\t\t\t\tif (gantt.isReadonly(this)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgantt.createTask({}, this.taskId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\r\n\tgantt.$keyboardNavigation.HeaderCell.prototype.bindAll(gantt.$keyboardNavigation.HeaderCell.prototype.keys);\r\n\r\n};","export default function(gantt) {\r\n\r\n\tgantt.$keyboardNavigation.TaskRow = function (taskId) {\r\n\t\tif (!taskId) {\r\n\t\t\tvar rootLevel = gantt.getChildren(gantt.config.root_id);\r\n\t\t\tif (rootLevel[0]) {\r\n\t\t\t\ttaskId = rootLevel[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.taskId = taskId;\r\n\t\tif (gantt.isTaskExists(this.taskId)) {\r\n\t\t\tthis.index = gantt.getTaskIndex(this.taskId);\r\n\t\t\tthis.globalIndex = gantt.getGlobalTaskIndex(this.taskId);\r\n\t\t\tthis.splitItem = !!gantt.getTask(this.taskId).$split_subtask;\r\n\t\t\tthis.parentId = gantt.getParent(this.taskId);\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.$keyboardNavigation.TaskRow.prototype = gantt._compose(\r\n\t\tgantt.$keyboardNavigation.KeyNavNode,\r\n\t\t{\r\n\t\t\t_handlers: null,\r\n\t\t\tisValid: function () {\r\n\t\t\t\treturn gantt.isTaskExists(this.taskId) && (gantt.getTaskIndex(this.taskId) > -1);\r\n\t\t\t},\r\n\t\t\tfallback: function () {\r\n\t\t\t\tif (!gantt.getVisibleTaskCount()) {\r\n\t\t\t\t\tvar header = new gantt.$keyboardNavigation.HeaderCell();\r\n\t\t\t\t\tif (!header.isValid()) return null;\r\n\t\t\t\t\telse return header;\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tif(!this.splitItem){\r\n\t\t\t\t\t\tvar nextIndex = -1;\r\n\t\t\t\t\t\t// GS-1393. When Gantt tries to restore the focus, it should rely on the global index\r\n\t\t\t\t\t\tif (gantt.getTaskByIndex(this.globalIndex - 1)) {\r\n\t\t\t\t\t\t\tnextIndex = this.globalIndex - 1;\r\n\t\t\t\t\t\t} else if (gantt.getTaskByIndex(this.globalIndex + 1)) {\r\n\t\t\t\t\t\t\tnextIndex = this.globalIndex + 1;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar globalIndex = this.globalIndex;\r\n\t\t\t\t\t\t\twhile (globalIndex >= 0) {\r\n\t\t\t\t\t\t\t\tif (gantt.getTaskByIndex(globalIndex)) {\r\n\t\t\t\t\t\t\t\t\tnextIndex = globalIndex;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tglobalIndex--;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (nextIndex > -1) {\r\n\t\t\t\t\t\t\treturn new gantt.$keyboardNavigation.TaskRow(gantt.getTaskByIndex(nextIndex).id);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\t\treturn new gantt.$keyboardNavigation.TaskRow(this.parentId);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tfromDomElement: function(el){\r\n\t\t\t\tif(gantt.config.keyboard_navigation_cells){\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar taskId = gantt.locate(el);\r\n\t\t\t\tif(gantt.isTaskExists(taskId)){\r\n\t\t\t\t\treturn new gantt.$keyboardNavigation.TaskRow(taskId);\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tgetNode: function () {\r\n\t\t\t\tif (gantt.isTaskExists(this.taskId) && gantt.isTaskVisible(this.taskId)) {\r\n\t\t\t\t\tif (gantt.config.show_grid) {\r\n\t\t\t\t\t\treturn gantt.$grid.querySelector(`.gantt_row[${gantt.config.task_attribute}=\"${String(this.taskId).replaceAll('\"', '\\\\\"')}\"]`);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn gantt.getTaskNode(this.taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tfocus: function (keptFocus) {\r\n\t\t\t\tif(!keptFocus) {\r\n\t\t\t\t\tconst pos = gantt.getTaskPosition(gantt.getTask(this.taskId));\r\n\t\t\t\t\tconst height = gantt.getTaskHeight(this.taskId);\r\n\t\t\t\t\tconst scroll = gantt.getScrollState();\r\n\r\n\t\t\t\t\tlet viewWidth;\r\n\t\t\t\t\tif(gantt.$task){\r\n\t\t\t\t\t\tviewWidth = gantt.$task.offsetWidth;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tviewWidth = scroll.inner_width;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet viewHeight;\r\n\t\t\t\t\tif(gantt.$grid_data || gantt.$task_data){\r\n\t\t\t\t\t\tviewHeight = (gantt.$grid_data || gantt.$task_data).offsetHeight;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tviewHeight = scroll.inner_height;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst visibleTimeline = gantt.config.show_chart && gantt.$ui.getView(\"timeline\");\r\n\r\n\t\t\t\t\tif (pos.top < scroll.y || pos.top + height > (scroll.y + viewHeight)) {\r\n\t\t\t\t\t\t// GS-2346: additional scrolling to be sure that the task will be in the required range\r\n\t\t\t\t\t\tgantt.scrollTo(null, pos.top - 20);\r\n\t\t\t\t\t} else if (gantt.config.scroll_on_click && visibleTimeline) {\r\n\t\t\t\t\t\t// horizontal scroll activated\r\n\t\t\t\t\t\tif (pos.left > (scroll.x + viewWidth)) { // scroll forward to the start of the task\r\n\t\t\t\t\t\t\tgantt.scrollTo(pos.left - gantt.config.task_scroll_offset);\r\n\t\t\t\t\t\t} else if (pos.left + pos.width < scroll.x) {  // scroll back to the end of the task\r\n\t\t\t\t\t\t\tgantt.scrollTo(pos.left + pos.width - gantt.config.task_scroll_offset);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgantt.$keyboardNavigation.KeyNavNode.prototype.focus.apply(this, [keptFocus]);\r\n\r\n\t\t\t\t// GS-152 if there are scrollbars with custom names, change their scroll position\r\n\t\t\t\tscrollGrid();\r\n\r\n\t\t\t\tfunction scrollGrid() {\r\n\t\t\t\t\tvar grid = gantt.$ui.getView(\"grid\");\r\n\t\t\t\t\tif (!grid || !grid.$grid_data){\r\n\t\t\t\t\t\t// GS-1805. Don't try to focus the row that doesn't exist\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar scrollPositionX = parseInt(grid.$grid.scrollLeft);\r\n\t\t\t\t\tvar scrollPositionY = parseInt(grid.$grid_data.scrollTop);\r\n\r\n\t\t\t\t\tvar attachedScrollbarHorizontal = grid.$config.scrollX;\r\n\r\n\t\t\t\t\tif (attachedScrollbarHorizontal && grid.$config.scrollable) {\r\n\t\t\t\t\t\tvar scrollbarHorizontal = gantt.$ui.getView(attachedScrollbarHorizontal);\r\n\t\t\t\t\t\tif (scrollbarHorizontal) {\r\n\t\t\t\t\t\t\tscrollbarHorizontal.scrollTo(scrollPositionX, scrollPositionY);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar attachedScrollbarVertical = grid.$config.scrollY;\r\n\r\n\t\t\t\t\tif (attachedScrollbarVertical) {\r\n\t\t\t\t\t\tvar scrollbarVertical = gantt.$ui.getView(attachedScrollbarVertical);\r\n\t\t\t\t\t\tif (scrollbarVertical) {\r\n\t\t\t\t\t\t\tscrollbarVertical.scrollTo(scrollPositionX, scrollPositionY);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\r\n\t\t\tkeys: {\r\n\t\t\t\t\"pagedown\": function () {\r\n\t\t\t\t\tif (gantt.getVisibleTaskCount()) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskRow(gantt.getTaskByIndex(gantt.getVisibleTaskCount() - 1).id));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"pageup\": function () {\r\n\t\t\t\t\tif (gantt.getVisibleTaskCount()) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskRow(gantt.getTaskByIndex(0).id));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"up\": function () {\r\n\t\t\t\t\tvar nextElement = null;\r\n\t\t\t\t\tvar prevTask = gantt.getPrev(this.taskId);\r\n\t\t\t\t\tif (!gantt.isTaskExists(prevTask)) {\r\n\t\t\t\t\t\tnextElement = new gantt.$keyboardNavigation.HeaderCell();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnextElement = new gantt.$keyboardNavigation.TaskRow(prevTask);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.moveTo(nextElement);\r\n\t\t\t\t},\r\n\t\t\t\t\"down\": function () {\r\n\t\t\t\t\tvar nextTask = gantt.getNext(this.taskId);\r\n\t\t\t\t\tif (gantt.isTaskExists(nextTask)) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskRow(nextTask));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\t\"shift+down\": function(){\r\n\t\t\t\t\tif(gantt.hasChild(this.taskId) && !gantt.getTask(this.taskId).$open){\r\n\t\t\t\t\t\tgantt.open(this.taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"shift+up\": function(){\r\n\t\t\t\t\tif(gantt.hasChild(this.taskId) && gantt.getTask(this.taskId).$open){\r\n\t\t\t\t\t\tgantt.close(this.taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"shift+right\": function() {\r\n\t\t\t\t\tif (gantt.isReadonly(this)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar prevId = gantt.getPrevSibling(this.taskId);\r\n\t\t\t\t\tif(gantt.isTaskExists(prevId) && !gantt.isChildOf(this.taskId, prevId)){\r\n\t\t\t\t\t\tvar parent = gantt.getTask(prevId);\r\n\t\t\t\t\t\tparent.$open = true;\r\n\t\t\t\t\t\tvar result = gantt.moveTask(this.taskId, -1, prevId);\r\n\t\t\t\t\t\tif(result !== false)\r\n\t\t\t\t\t\t\tgantt.updateTask(this.taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"shift+left\": function() {\r\n\t\t\t\t\tif (gantt.isReadonly(this)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar parent = gantt.getParent(this.taskId);\r\n\t\t\t\t\tif(gantt.isTaskExists(parent)){\r\n\t\t\t\t\t\tvar result =  gantt.moveTask(this.taskId, gantt.getTaskIndex(parent) + 1, gantt.getParent(parent));\r\n\t\t\t\t\t\tif(result !== false)\r\n\t\t\t\t\t\t\tgantt.updateTask(this.taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// select\r\n\t\t\t\t\"space\": function (e) {\r\n\t\t\t\t\tif (!gantt.isSelectedTask(this.taskId)) {\r\n\t\t\t\t\t\tgantt.selectTask(this.taskId);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tgantt.unselectTask(this.taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// collapse\r\n\t\t\t\t\"ctrl+left\": function (e) {\r\n\t\t\t\t\tgantt.close(this.taskId);\r\n\t\t\t\t},\r\n\t\t\t\t// expand\r\n\t\t\t\t\"ctrl+right\": function (e) {\r\n\t\t\t\t\tgantt.open(this.taskId);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// delete task\r\n\t\t\t\t\"delete\": function (e) {\r\n\t\t\t\t\tif (gantt.isReadonly(this)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgantt.$click.buttons[\"delete\"](this.taskId);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// open lightbox\r\n\t\t\t\t\"enter\": function () {\r\n\t\t\t\t\tif (gantt.isReadonly(this)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgantt.showLightbox(this.taskId);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// add subtask\r\n\t\t\t\t\"ctrl+enter\": function () {\r\n\t\t\t\t\tif (gantt.isReadonly(this)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgantt.createTask({}, this.taskId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\tgantt.$keyboardNavigation.TaskRow.prototype.bindAll(gantt.$keyboardNavigation.TaskRow.prototype.keys);\r\n\r\n};","import * as domHelpers from \"../../../core/ui/utils/dom_helpers\";\r\nimport {replaceValidZeroId} from \"../../../utils/helpers\";\r\n\r\nexport default function(gantt) {\r\n\r\n\r\n\tgantt.$keyboardNavigation.TaskCell = function (taskId, index) {\r\n\t\ttaskId = replaceValidZeroId(taskId, gantt.config.root_id);\r\n\t\tif (!taskId) {\r\n\t\t\tvar rootLevel = gantt.getChildren(gantt.config.root_id);\r\n\t\t\tif (rootLevel[0]) {\r\n\t\t\t\ttaskId = rootLevel[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.taskId = taskId;\r\n\t\tthis.columnIndex = index || 0;\r\n\t\t// provided task may not exist, in this case node will be detectes as invalid\r\n\t\tif (gantt.isTaskExists(this.taskId)) {\r\n\t\t\tthis.index = gantt.getTaskIndex(this.taskId);\r\n\t\t\tthis.globalIndex = gantt.getGlobalTaskIndex(this.taskId);\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.$keyboardNavigation.TaskCell.prototype = gantt._compose(\r\n\t\tgantt.$keyboardNavigation.TaskRow,\r\n\t\t{\r\n\t\t\t_handlers: null,\r\n\t\t\tisValid: function () {\r\n\r\n\t\t\t\treturn gantt.$keyboardNavigation.TaskRow.prototype.isValid.call(this) && !!gantt.getGridColumns()[this.columnIndex];\r\n\t\t\t},\r\n\t\t\tfallback: function () {\r\n\r\n\t\t\t\tvar node = gantt.$keyboardNavigation.TaskRow.prototype.fallback.call(this);\r\n\t\t\t\tvar result = node;\r\n\t\t\t\tif (node instanceof gantt.$keyboardNavigation.TaskRow) {\r\n\t\t\t\t\tvar visibleColumns = gantt.getGridColumns();\r\n\t\t\t\t\tvar index = this.columnIndex;\r\n\t\t\t\t\twhile (index >= 0) {\r\n\t\t\t\t\t\tif (visibleColumns[index])\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tindex--;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (visibleColumns[index]) {\r\n\t\t\t\t\t\tresult = new gantt.$keyboardNavigation.TaskCell(node.taskId, index);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn result;\r\n\t\t\t},\r\n\r\n\t\t\tfromDomElement: function(el){\r\n\t\t\t\tif(!gantt.config.keyboard_navigation_cells){\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar taskId = gantt.locate(el);\r\n\t\t\t\tif(gantt.isTaskExists(taskId)){\r\n\t\t\t\t\tvar index = 0;\r\n\t\t\t\t\tvar cellElement = domHelpers.locateAttribute(el, \"data-column-index\");\r\n\r\n\t\t\t\t\tif(cellElement){\r\n\t\t\t\t\t\tindex = cellElement.getAttribute(\"data-column-index\")*1;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn new gantt.$keyboardNavigation.TaskCell(taskId, index);\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tgetNode: function () {\r\n\t\t\t\tif (gantt.isTaskExists(this.taskId) && (gantt.isTaskVisible(this.taskId) || gantt.config.show_tasks_outside_timescale)) {\r\n\t\t\t\t\tif (gantt.config.show_grid && gantt.$grid) {\r\n\t\t\t\t\t\tvar row = gantt.$grid.querySelector(\".gantt_row[\" + gantt.config.task_attribute + \"='\" + this.taskId + \"']\");\r\n\t\t\t\t\t\tif(!row)\r\n\t\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t\treturn row.querySelector(\"[data-column-index='\"+this.columnIndex+\"']\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn gantt.getTaskNode(this.taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tkeys: {\r\n\t\t\t\t\"up\": function () {\r\n\r\n\t\t\t\t\tvar nextElement = null;\r\n\t\t\t\t\tvar prevTask = gantt.getPrev(this.taskId);\r\n\t\t\t\t\tif (!gantt.isTaskExists(prevTask)) {\r\n\t\t\t\t\t\tnextElement = new gantt.$keyboardNavigation.HeaderCell(this.columnIndex);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnextElement = new gantt.$keyboardNavigation.TaskCell(prevTask, this.columnIndex);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.moveTo(nextElement);\r\n\t\t\t\t},\r\n\t\t\t\t\"down\": function () {\r\n\t\t\t\t\tvar nextTask = gantt.getNext(this.taskId);\r\n\t\t\t\t\tif (gantt.isTaskExists(nextTask)) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(nextTask, this.columnIndex));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"left\": function () {\r\n\t\t\t\t\tif (this.columnIndex > 0) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(this.taskId, this.columnIndex - 1));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"right\": function () {\r\n\t\t\t\t\tvar columns = gantt.getGridColumns();\r\n\t\t\t\t\tif (this.columnIndex < columns.length - 1) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(this.taskId, this.columnIndex + 1));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\t\"end\": function () {\r\n\t\t\t\t\tvar columns = gantt.getGridColumns();\r\n\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(this.taskId, columns.length - 1));\r\n\t\t\t\t},\r\n\t\t\t\t\"home\": function () {\r\n\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(this.taskId, 0));\r\n\t\t\t\t},\r\n\t\t\t\t\"pagedown\": function () {\r\n\t\t\t\t\tif (gantt.getVisibleTaskCount()) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(gantt.getTaskByIndex(gantt.getVisibleTaskCount() - 1).id, this.columnIndex));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"pageup\": function () {\r\n\t\t\t\t\tif (gantt.getVisibleTaskCount()) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(gantt.getTaskByIndex(0).id, this.columnIndex));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\r\n\r\n\tgantt.$keyboardNavigation.TaskCell.prototype.bindAll(gantt.$keyboardNavigation.TaskRow.prototype.keys);\r\n\tgantt.$keyboardNavigation.TaskCell.prototype.bindAll(gantt.$keyboardNavigation.TaskCell.prototype.keys);\r\n\r\n};","export default function(gantt) {\r\n\r\n\t(function () {\r\n\t\tvar modalsStack = [];\r\n\r\n\t\tfunction isModal() {\r\n\t\t\treturn !!modalsStack.length;\r\n\t\t}\r\n\r\n\t\tfunction afterPopup(box) {\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tif (!isModal()){\r\n\t\t\t\t\tif(!gantt.$destroyed){\r\n\t\t\t\t\t\tgantt.focus();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, 1);\r\n\t\t}\r\n\r\n\t\tfunction startModal(box) {\r\n\t\t\tgantt.eventRemove(box, \"keydown\", trapFocus);\r\n\t\t\tgantt.event(box, \"keydown\", trapFocus);\r\n\t\t\tmodalsStack.push(box);\r\n\t\t\t//gantt.$keyboardNavigation.dispatcher.disable();\r\n\t\t}\r\n\r\n\t\tfunction endModal() {\r\n\t\t\tvar box = modalsStack.pop();\r\n\t\t\tif (box) {\r\n\t\t\t\tgantt.eventRemove(box, \"keydown\", trapFocus);\r\n\t\t\t}\r\n\t\t\tafterPopup(box);\r\n\r\n\t\t}\r\n\r\n\r\n\t\tfunction isTopModal(box) {\r\n\t\t\treturn box == modalsStack[modalsStack.length - 1];\r\n\t\t}\r\n\r\n\t\tfunction trapFocus(event) {\r\n\t\t\tvar target = event.currentTarget;\r\n\t\t\tif (!isTopModal(target)) return;\r\n\r\n\t\t\tgantt.$keyboardNavigation.trapFocus(target, event);\r\n\t\t}\r\n\r\n\t\tfunction traceLightbox() {\r\n\t\t\tstartModal(gantt.getLightbox());\r\n\t\t}\r\n\r\n\t\tgantt.attachEvent(\"onLightbox\", traceLightbox);\r\n\t\tgantt.attachEvent(\"onAfterLightbox\", endModal);\r\n\t\tgantt.attachEvent(\"onLightboxChange\", function () {\r\n\t\t\tendModal();\r\n\t\t\ttraceLightbox();\r\n\t\t});\r\n\r\n\r\n\t\tgantt.attachEvent(\"onAfterQuickInfo\", function () {\r\n\t\t\tafterPopup();\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onMessagePopup\", function (box) {\r\n\t\t\tsaveFocus();\r\n\t\t\tstartModal(box);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterMessagePopup\", function () {\r\n\t\t\tendModal();\r\n\t\t\trestoreFocus();\r\n\t\t});\r\n\r\n\t\tvar focusElement = null;\r\n\r\n\t\tfunction saveFocus() {\r\n\t\t\tfocusElement = gantt.utils.dom.getActiveElement();\r\n\t\t}\r\n\r\n\t\tfunction restoreFocus() {\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tif (focusElement && focusElement.focus) {\r\n\t\t\t\t\tfocusElement.focus();\r\n\t\t\t\t\tfocusElement = null;\r\n\t\t\t\t}\r\n\t\t\t}, 1);\r\n\t\t}\r\n\r\n\t\tgantt.$keyboardNavigation.isModal = isModal;\r\n\r\n\r\n\t})();\r\n\r\n};","export default function(gantt) {\r\n\r\n\tgantt.$keyboardNavigation.dispatcher = {\r\n\t\tisActive: false,\r\n\t\tactiveNode: null,\r\n\t\tglobalNode: new gantt.$keyboardNavigation.GanttNode(),\r\n\r\n\t\tenable: function () {\r\n\t\t\tthis.isActive = true;\r\n\t\t\tthis.setActiveNode(this.getActiveNode());\r\n\t\t},\r\n\r\n\t\tdisable: function () {\r\n\t\t\tthis.isActive = false;\r\n\t\t},\r\n\r\n\t\tisEnabled: function () {\r\n\t\t\treturn !!this.isActive;\r\n\t\t},\r\n\r\n\t\tgetDefaultNode: function () {\r\n\t\t\tvar node;\r\n\t\t\tif (gantt.config.keyboard_navigation_cells) {\r\n\t\t\t\tnode = new gantt.$keyboardNavigation.TaskCell();\r\n\t\t\t} else {\r\n\t\t\t\tnode = new gantt.$keyboardNavigation.TaskRow();\r\n\t\t\t}\r\n\r\n\t\t\tif (!node.isValid()) {\r\n\t\t\t\tnode = node.fallback();\r\n\t\t\t}\r\n\t\t\treturn node;\r\n\t\t},\r\n\r\n\t\tsetDefaultNode: function () {\r\n\t\t\tthis.setActiveNode(this.getDefaultNode());\r\n\t\t},\r\n\r\n\t\tgetActiveNode: function () {\r\n\t\t\tvar node = this.activeNode;\r\n\t\t\tif (node && !node.isValid()) {\r\n\t\t\t\tnode = node.fallback();\r\n\t\t\t}\r\n\t\t\treturn node;\r\n\t\t},\r\n\r\n\t\tfromDomElement: function(e){\r\n\t\t\tvar inputs = [\r\n\t\t\t\tgantt.$keyboardNavigation.TaskRow,\r\n\t\t\t\tgantt.$keyboardNavigation.TaskCell,\r\n\t\t\t\tgantt.$keyboardNavigation.HeaderCell\r\n\t\t\t];\r\n\t\t\tfor(var i = 0; i < inputs.length; i++){\r\n\t\t\t\tif(inputs[i].prototype.fromDomElement){\r\n\t\t\t\t\tvar node = inputs[i].prototype.fromDomElement(e);\r\n\t\t\t\t\tif(node) return node;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\r\n\t\tfocusGlobalNode: function () {\r\n\t\t\tthis.blurNode(this.globalNode);\r\n\t\t\tthis.focusNode(this.globalNode);\r\n\t\t},\r\n\r\n\t\tsetActiveNode: function (el) {\r\n\t\t\t//console.trace()\r\n\t\t\tvar focusChanged = true;\r\n\t\t\tif (this.activeNode) {\r\n\t\t\t\tif (this.activeNode.compareTo(el)) {\r\n\t\t\t\t\tfocusChanged = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.isEnabled()) {\r\n\t\t\t\tif(focusChanged)\r\n\t\t\t\t\tthis.blurNode(this.activeNode);\r\n\r\n\t\t\t\tthis.activeNode = el;\r\n\t\t\t\tthis.focusNode(this.activeNode, !focusChanged);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tfocusNode: function (el, keptFocus) {\r\n\t\t\tif (el && el.focus) {\r\n\t\t\t\tel.focus(keptFocus);\r\n\t\t\t}\r\n\t\t},\r\n\t\tblurNode: function (el) {\r\n\t\t\tif (el && el.blur) {\r\n\t\t\t\tel.blur();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tkeyDownHandler: function (e) {\r\n\r\n\t\t\tif (gantt.$keyboardNavigation.isModal())\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (!this.isEnabled())\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif(e.defaultPrevented){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar ganttNode = this.globalNode;\r\n\r\n\t\t\tvar command = gantt.$keyboardNavigation.shortcuts.getCommandFromEvent(e);\r\n\r\n\t\t\tvar activeElement = this.getActiveNode();\r\n\t\t\tvar eventFacade = gantt.$keyboardNavigation.facade;\r\n\t\t\tif(eventFacade.callEvent(\"onKeyDown\", [command, e]) === false){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (!activeElement) {\r\n\t\t\t\tthis.setDefaultNode();\r\n\t\t\t} else if (activeElement.findHandler(command)) {\r\n\t\t\t\tactiveElement.doAction(command, e);\r\n\t\t\t} else if (ganttNode.findHandler(command)) {\r\n\t\t\t\tganttNode.doAction(command, e);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\t_timeout: null,\r\n\t\tawaitsFocus: function(){\r\n\t\t\treturn this._timeout !== null;\r\n\t\t},\r\n\t\tdelay: function(callback, delay){\r\n\r\n\t\t\tclearTimeout(this._timeout);\r\n\t\t\tthis._timeout = setTimeout(gantt.bind(function(){\r\n\t\t\t\tthis._timeout = null;\r\n\t\t\t\tcallback();\r\n\t\t\t}, this)  , delay || 1);\r\n\r\n\t\t},\r\n\t\tclearDelay: function(){\r\n\t\t\tclearTimeout(this._timeout);\r\n\t\t}\r\n\t};\r\n\r\n};","import eventable from \"../utils/eventable\";\r\nimport * as domHelpers from \"../core/ui/utils/dom_helpers\";\r\n\r\nimport keyboard_shortcuts from \"./keyboard_navigation/common/keyboard_shortcuts\";\r\nimport eventhandler from \"./keyboard_navigation/common/eventhandler\";\r\nimport trap_modal_focus from \"./keyboard_navigation/common/trap_modal_focus\";\r\nimport gantt_node from \"./keyboard_navigation/elements/gantt_node\";\r\nimport nav_node from \"./keyboard_navigation/elements/nav_node\";\r\nimport header_cell from \"./keyboard_navigation/elements/header_cell\";\r\nimport task_row from \"./keyboard_navigation/elements/task_row\";\r\nimport task_cell from \"./keyboard_navigation/elements/task_cell\";\r\nimport modals from \"./keyboard_navigation/modals\";\r\nimport core from \"./keyboard_navigation/core\";\r\n\r\n\r\n\r\nexport default function(gantt){\r\n\tfunction setupKeyNav(gantt){\r\n\t\tgantt.config.keyboard_navigation = true;\r\n\t\tgantt.config.keyboard_navigation_cells = false;\r\n\r\n\t\tgantt.$keyboardNavigation = {};\r\n\r\n\t\tgantt._compose = function(){\r\n\t\t\tvar parts = Array.prototype.slice.call(arguments, 0);\r\n\t\t\tvar res = {};\r\n\t\t\tfor(var i = 0; i < parts.length; i++){\r\n\t\t\t\tvar obj = parts[i];\r\n\t\t\t\tif(typeof obj == \"function\"){\r\n\t\t\t\t\tobj = new obj();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor(var p in obj){\r\n\t\t\t\t\tres[p] = obj[p];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t};\r\n\r\n\t\tkeyboard_shortcuts(gantt);\r\n\t\teventhandler(gantt);\r\n\t\ttrap_modal_focus(gantt);\r\n\t\tgantt_node(gantt);\r\n\t\tnav_node(gantt);\r\n\t\theader_cell(gantt);\r\n\t\ttask_row(gantt);\r\n\t\ttask_cell(gantt);\r\n\t\tmodals(gantt);\r\n\t\tcore(gantt);\r\n\r\n\r\n\t\t(function(){\r\n\t\t\tvar dispatcher = gantt.$keyboardNavigation.dispatcher;\r\n\r\n\t\t\tdispatcher.isTaskFocused = function(id){\r\n\t\t\t\tvar node = dispatcher.activeNode;\r\n\t\t\t\tif(node instanceof gantt.$keyboardNavigation.TaskRow || node instanceof gantt.$keyboardNavigation.TaskCell) {\r\n\t\t\t\t\tif (node.taskId == id) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t};\r\n\r\n\t\t\tvar keyDownHandler = function(e){\r\n\t\t\t\tif(!gantt.config.keyboard_navigation) return;\r\n\t\t\t\t// GS-734 & GS-1078: we don't need keyboard navigation inside inline editors\r\n\t\t\t\tif(!gantt.config.keyboard_navigation_cells && isInlineEditorCell(e)) return;\r\n\r\n\t\t\t\tif (isNoKeyboardNavigationElement(e) || isLightboxElement(e)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn dispatcher.keyDownHandler(e);\r\n\t\t\t};\r\n\r\n\t\t\tvar focusHandler = function(e){\r\n\t\t\t\tif(dispatcher.$preventDefault){\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tgantt.$container.blur();\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t// do nothing if key-nav focus is already planned\r\n\t\t\t\t} else if (!dispatcher.awaitsFocus()) {\r\n\t\t\t\t\t// otherwise - re-focus key-nav element on gantt focus\r\n\t\t\t\t\tdispatcher.focusGlobalNode();\r\n\t\t\t\t}\r\n\r\n\t\t\t};\r\n\r\n\t\t\tvar reFocusActiveNode = function(){\r\n\t\t\t\tif(!dispatcher.isEnabled())\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tconst outsideGantt = !domHelpers.isChildOf(document.activeElement, gantt.$container) && document.activeElement.localName != \"body\";\r\n\t\t\t\tvar activeNode = dispatcher.getActiveNode();\r\n\t\t\t\tif(!activeNode || outsideGantt)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tvar domElement = activeNode.getNode();\r\n\t\t\t\tvar top, left;\r\n\t\t\t\tif(domElement && domElement.parentNode){\r\n\t\t\t\t\ttop = domElement.parentNode.scrollTop;\r\n\t\t\t\t\tleft = domElement.parentNode.scrollLeft;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tactiveNode.focus(true);\r\n\r\n\t\t\t\tif(domElement && domElement.parentNode){\r\n\t\t\t\t\tdomElement.parentNode.scrollTop = top;\r\n\t\t\t\t\tdomElement.parentNode.scrollLeft = left;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\r\n\t\t\tgantt.attachEvent(\"onDataRender\", function(){\r\n\t\t\t\tif(!gantt.config.keyboard_navigation) return;\r\n\t\t\t\treFocusActiveNode();\r\n\t\t\t});\r\n\r\n\t\t\tgantt.attachEvent(\"onGanttRender\", function(){\r\n\t\t\t\t//GS-2230: in case if `getGanttInstance` created without container\r\n\t\t\t\tif(!gantt.$root) return;\r\n\t\t\t\tgantt.eventRemove(gantt.$root, \"keydown\", keyDownHandler);\r\n\t\t\t\tgantt.eventRemove(gantt.$container, \"focus\", focusHandler);\r\n\t\t\t\tgantt.eventRemove(gantt.$container, \"mousedown\", mousedownHandler);\r\n\r\n\t\t\t\tif(gantt.config.keyboard_navigation){\r\n\r\n\t\t\t\t\tgantt.event(gantt.$root, \"keydown\", keyDownHandler);\r\n\t\t\t\t\tgantt.event(gantt.$container, \"focus\", focusHandler);\r\n\t\t\t\t\tgantt.event(gantt.$container, \"mousedown\", mousedownHandler);\r\n\t\t\t\t\tgantt.$container.setAttribute(\"tabindex\", \"0\");\r\n\r\n\t\t\t\t}else{\r\n\t\t\t\t\tgantt.$container.removeAttribute(\"tabindex\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tfunction getTaskNodeConstructor(){\r\n\t\t\t\tif (gantt.config.keyboard_navigation_cells) {\r\n\t\t\t\t\treturn gantt.$keyboardNavigation.TaskCell;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn gantt.$keyboardNavigation.TaskRow;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction isInlineEditorCell(e){\r\n\t\t\t\treturn !!domHelpers.closest(e.target, \".gantt_grid_editor_placeholder\");\r\n\t\t\t}\r\n\t\t\t// GS-1445. Cancel keyboard navigation within custom elements\r\n\t\t\tfunction isNoKeyboardNavigationElement(e){\r\n\t\t\t\treturn !!domHelpers.closest(e.target, \".no_keyboard_navigation\");\r\n\t\t\t}\r\n\t\t\tfunction isLightboxElement(e){\r\n\t\t\t\treturn !!domHelpers.closest(e.target, \".gantt_cal_light\");\r\n\t\t\t}\r\n\r\n\t\t\tfunction mousedownHandler(e){\r\n\t\t\t\tif(!gantt.config.keyboard_navigation) return true;\r\n\t\t\t\t// GS-734 & GS-1078: we don't need keyboard navigation inside inline editors\r\n\t\t\t\tif(!gantt.config.keyboard_navigation_cells && isInlineEditorCell(e)) return true;\r\n\r\n\t\t\t\tif (isNoKeyboardNavigationElement(e)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar focusNode;\r\n\t\t\t\tvar locateTask = dispatcher.fromDomElement(e);\r\n\t\t\t\tif(locateTask){\r\n\t\t\t\t\t//var node = getTaskNodeConstructor();\r\n\t\t\t\t\tif(dispatcher.activeNode instanceof gantt.$keyboardNavigation.TaskCell && domHelpers.isChildOf(e.target, gantt.$task)){\r\n\t\t\t\t\t\tlocateTask = new gantt.$keyboardNavigation.TaskCell(locateTask.taskId, dispatcher.activeNode.columnIndex);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfocusNode = locateTask;\r\n\t\t\t\t\t// GS-1541 and GS-1542. If you click on the task row element (possible with custom styles)\r\n\t\t\t\t\t// or the task bar element, there is no information about the target grid cell,\r\n\t\t\t\t\t// so we need to set focus on the first visible cell\r\n\t\t\t\t\tconst visibleGrid = gantt.config.show_grid && gantt.$ui.getView(\"grid\");\r\n\t\t\t\t\tif(visibleGrid && gantt.config.keyboard_navigation_cells){\r\n\t\t\t\t\t\tconst taskRow = e.target.classList.contains(\"gantt_row\");\r\n\t\t\t\t\t\tconst taskBar = e.target.closest(\".gantt_task_line\");\r\n\r\n\t\t\t\t\t\tconst gridLeft = gantt.utils.dom.getNodePosition(gantt.$grid).x;\r\n\t\t\t\t\t\tconst gridRight = gridLeft + gantt.$grid.offsetWidth;\r\n\t\t\t\t\t\tconst nodePosition = gantt.utils.dom.getNodePosition(document.activeElement).x;\r\n\t\t\t\t\t\tconst nodeHidden = nodePosition < gridLeft || gridRight < nodePosition;\r\n\r\n\t\t\t\t\t\tif (taskRow || (taskBar && nodeHidden)){\r\n\t\t\t\t\t\t\tlet scrollPosition = gantt.$grid.scrollLeft;\r\n\t\t\t\t\t\t\tconst rightPosition = scrollPosition + gantt.$grid.offsetWidth;\r\n\t\t\t\t\t\t\tlet positionX = 0;\r\n\t\t\t\t\t\t\tif (taskRow){\r\n\t\t\t\t\t\t\t\tscrollPosition = gantt.utils.dom.getRelativeEventPosition(e, gantt.$grid).x;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tfor (let i = 0; i < gantt.config.columns.length; i++) {\r\n\t\t\t\t\t\t\t\tconst column = gantt.config.columns[i];\r\n\t\t\t\t\t\t\t\tif (column.hide){\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tpositionX += column.width;\r\n\t\t\t\t\t\t\t\tif (scrollPosition < positionX){\r\n\t\t\t\t\t\t\t\t\tif (rightPosition < positionX){\r\n\t\t\t\t\t\t\t\t\t\tpositionX -= column.width;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tfocusNode.columnIndex = i;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (focusNode) {\r\n\t\t\t\t\tif (!dispatcher.isEnabled()) {\r\n\t\t\t\t\t\tdispatcher.activeNode = focusNode;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdispatcher.delay(function () {\r\n\t\t\t\t\t\t\tdispatcher.setActiveNode(focusNode);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// empty click should drop focus from gantt, insert of reselecting default node\r\n\t\t\t\t\tdispatcher.$preventDefault = true;\r\n\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\tdispatcher.$preventDefault = false;\r\n\t\t\t\t\t}, 300);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar onReady = gantt.attachEvent(\"onGanttReady\", function(){\r\n\t\t\t\t// restore focus on repainted tasks\r\n\t\t\t\tgantt.detachEvent(onReady);\r\n\r\n\t\t\t\tgantt.$data.tasksStore.attachEvent(\"onStoreUpdated\", function(id){\r\n\t\t\t\t\tif (gantt.config.keyboard_navigation && dispatcher.isEnabled()) {\r\n\t\t\t\t\t\tconst currentNode = dispatcher.getActiveNode();\r\n\t\t\t\t\t\tconst grid = gantt.$ui.getView(\"grid\");\r\n\t\t\t\t\t\tif (!grid || !grid.$grid_data){\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst top = grid.getItemTop(id);\r\n\t\t\t\t\t\tconst gridDataTopScroll = grid.$grid_data.scrollTop;\r\n\t\t\t\t\t\tconst gridDataBottomScroll = gridDataTopScroll + grid.$grid_data.getBoundingClientRect().height;\r\n\t\t\t\t\t\tif(currentNode && currentNode.taskId == id){\r\n\t\t\t\t\t\t\t// GS-2539: Don't refocus the node if it is selected and outside the visible range in the grid\r\n\t\t\t\t\t\t\tif(gridDataTopScroll <= top && gridDataBottomScroll >= top){\r\n\t\t\t\t\t\t\t\treFocusActiveNode();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(gantt._smart_render){\r\n\t\t\t\t\tvar updateRender = gantt._smart_render._redrawTasks;\r\n\t\t\t\t\tgantt._smart_render._redrawTasks = function(renderers, items){\r\n\t\t\t\t\t\tif(gantt.config.keyboard_navigation && dispatcher.isEnabled()){\r\n\t\t\t\t\t\t\tvar currentNode = dispatcher.getActiveNode();\r\n\t\t\t\t\t\t\tif(currentNode && currentNode.taskId !== undefined){\r\n\t\t\t\t\t\t\t\tvar focusedItemVisible = false;\r\n\t\t\t\t\t\t\t\tfor(var i = 0; i < items.length; i++){\r\n\t\t\t\t\t\t\t\t\tif(items[i].id == currentNode.taskId && items[i].start_date){\r\n\t\t\t\t\t\t\t\t\t\tfocusedItemVisible = true;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif(!focusedItemVisible){\r\n\t\t\t\t\t\t\t\t\titems.push(gantt.getTask(currentNode.taskId));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar res = updateRender.apply(this, arguments);\r\n\r\n\t\t\t\t\t\treturn res;\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\r\n\t\t\tlet createdTaskId = null;\r\n\t\t\tlet keepFocusOnNewTask = false;\r\n\t\t\tgantt.attachEvent(\"onTaskCreated\", function (task) {\r\n\t\t\t\tcreatedTaskId = task.id;\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\r\n\t\t\tgantt.attachEvent(\"onAfterTaskAdd\", function(id,item){\r\n\t\t\t\tif(!gantt.config.keyboard_navigation) return true;\r\n\t\t\t\tif(dispatcher.isEnabled()){\r\n\r\n\t\t\t\t\t// GS-1394. After adding a new task, the focus shouldn't change to the placeholder task\r\n\t\t\t\t\tif (id == createdTaskId) {\r\n\t\t\t\t\t\tkeepFocusOnNewTask = true;\r\n\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\tkeepFocusOnNewTask = false;\r\n\t\t\t\t\t\t\tcreatedTaskId = null;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (keepFocusOnNewTask && item.type == gantt.config.types.placeholder) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar columnIndex = 0;\r\n\t\t\t\t\tvar node = dispatcher.activeNode;\r\n\t\t\t\t\tif(node instanceof gantt.$keyboardNavigation.TaskCell){\r\n\t\t\t\t\t\tcolumnIndex = node.columnIndex;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar nodeConstructor = getTaskNodeConstructor();\r\n\r\n\t\t\t\t\tif (item.type == gantt.config.types.placeholder && gantt.config.placeholder_task.focusOnCreate === false) {\r\n\t\t\t\t\t\t// do not focus on the placeholder task\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdispatcher.setActiveNode(new nodeConstructor(id, columnIndex));\r\n\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tgantt.attachEvent(\"onTaskIdChange\", function(oldId, newId){\r\n\t\t\t\tif(!gantt.config.keyboard_navigation) return true;\r\n\r\n\t\t\t\tvar node = dispatcher.activeNode;\r\n\t\t\t\tif(dispatcher.isTaskFocused(oldId)){\r\n\t\t\t\t\tnode.taskId = newId;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\r\n\t\t\tvar interval = setInterval(function(){\r\n\t\t\t\tif(!gantt.config.keyboard_navigation) return;\r\n\t\t\t\tif(!dispatcher.isEnabled()){\r\n\t\t\t\t\tdispatcher.enable();\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}, 500);\r\n\r\n\t\t\tgantt.attachEvent(\"onDestroy\", function(){\r\n\t\t\t\tclearInterval(interval);\r\n\t\t\t});\r\n\r\n\t\t\tfunction getScopeName(obj){\r\n\t\t\t\tif(obj instanceof gantt.$keyboardNavigation.GanttNode){\r\n\t\t\t\t\treturn \"gantt\";\r\n\t\t\t\t}else if(obj instanceof gantt.$keyboardNavigation.HeaderCell){\r\n\t\t\t\t\treturn \"headerCell\";\r\n\t\t\t\t}else if(obj instanceof gantt.$keyboardNavigation.TaskRow){\r\n\t\t\t\t\treturn \"taskRow\";\r\n\t\t\t\t}else if(obj instanceof gantt.$keyboardNavigation.TaskCell){\r\n\t\t\t\t\treturn \"taskCell\";\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tfunction getScope(mode){\r\n\t\t\t\tvar scopes = {\r\n\t\t\t\t\t\"gantt\":gantt.$keyboardNavigation.GanttNode,\r\n\t\t\t\t\t\"headerCell\": gantt.$keyboardNavigation.HeaderCell,\r\n\t\t\t\t\t\"taskRow\": gantt.$keyboardNavigation.TaskRow,\r\n\t\t\t\t\t\"taskCell\": gantt.$keyboardNavigation.TaskCell\r\n\t\t\t\t};\r\n\r\n\t\t\t\treturn scopes[mode] || scopes.gantt;\r\n\t\t\t}\r\n\r\n\t\t\tfunction findVisibleColumnIndex(columnName) {\r\n\t\t\t\tvar columns = gantt.getGridColumns();\r\n\t\t\t\tfor (var i = 0; i < columns.length; i++){\r\n\t\t\t\t\tif(columns[i].name == columnName){\r\n\t\t\t\t\t\treturn i;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\r\n\t\t\tvar keyNavFacade = {};\r\n\t\t\teventable(keyNavFacade);\r\n\t\t\tgantt.mixin(keyNavFacade, {\r\n\t\t\t\taddShortcut: function(shortcut, handler, scope){\r\n\t\t\t\t\tvar scopeObject = getScope(scope);\r\n\t\t\t\t\tif(scopeObject){\r\n\t\t\t\t\t\tscopeObject.prototype.bind(shortcut, handler);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tgetShortcutHandler: function(shortcut, scope){\r\n\t\t\t\t\tvar commands = gantt.$keyboardNavigation.shortcuts.parse(shortcut);\r\n\t\t\t\t\tif(commands.length){\r\n\t\t\t\t\t\treturn keyNavFacade.getCommandHandler(commands[0], scope);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tgetCommandHandler: function(command, scope){\r\n\t\t\t\t\tvar scopeObject = getScope(scope);\r\n\t\t\t\t\tif(scopeObject){\r\n\t\t\t\t\t\tif(command){\r\n\t\t\t\t\t\t\treturn scopeObject.prototype.findHandler(command);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tremoveShortcut: function(shortcut, scope){\r\n\t\t\t\t\tvar scopeObject = getScope(scope);\r\n\t\t\t\t\tif(scopeObject){\r\n\t\t\t\t\t\tscopeObject.prototype.unbind(shortcut);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tfocus: function(config){\r\n\t\t\t\t\tvar type = config ? config.type : null;\r\n\t\t\t\t\tvar constructor = getScope(type);\r\n\t\t\t\t\tvar node;\r\n\t\t\t\t\tswitch (type){\r\n\t\t\t\t\t\tcase \"taskCell\":\r\n\t\t\t\t\t\t\tnode = new constructor(config.id, findVisibleColumnIndex(config.column));\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"taskRow\":\r\n\t\t\t\t\t\t\tnode = new constructor(config.id);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"headerCell\":\r\n\t\t\t\t\t\t\tnode = new constructor(findVisibleColumnIndex(config.column));\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdispatcher.delay(function(){\r\n\t\t\t\t\t\tif(node){\r\n\t\t\t\t\t\t\tdispatcher.setActiveNode(node);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tdispatcher.enable();\r\n\t\t\t\t\t\t\tif(!dispatcher.getActiveNode()){\r\n\r\n\t\t\t\t\t\t\t\tdispatcher.setDefaultNode();\r\n\t\t\t\t\t\t\t}else{\r\n\r\n\t\t\t\t\t\t\t\tif(!dispatcher.awaitsFocus()){\r\n\t\t\t\t\t\t\t\t\tdispatcher.enable();\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\r\n\t\t\t\tgetActiveNode: function(){\r\n\t\t\t\t\tif(dispatcher.isEnabled()){\r\n\t\t\t\t\t\tvar node = dispatcher.getActiveNode();\r\n\t\t\t\t\t\tvar scope = getScopeName(node);\r\n\t\t\t\t\t\tvar columns = gantt.getGridColumns();\r\n\t\t\t\t\t\tswitch (scope){\r\n\t\t\t\t\t\t\tcase \"taskCell\":\r\n\t\t\t\t\t\t\t\treturn {type:\"taskCell\", id:node.taskId, column:columns[node.columnIndex].name};\r\n\t\t\t\t\t\t\tcase \"taskRow\":\r\n\t\t\t\t\t\t\t\treturn {type:\"taskRow\", id:node.taskId};\r\n\t\t\t\t\t\t\tcase \"headerCell\":\r\n\t\t\t\t\t\t\t\treturn {type:\"headerCell\", column:columns[node.index].name};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tgantt.$keyboardNavigation.facade = keyNavFacade;\r\n\r\n\t\t\tgantt.ext.keyboardNavigation = keyNavFacade;\r\n\t\t\tgantt.focus = function(){\r\n\t\t\t\tkeyNavFacade.focus();\r\n\t\t\t};\r\n\t\t\tgantt.addShortcut = keyNavFacade.addShortcut;\r\n\t\t\tgantt.getShortcutHandler = keyNavFacade.getShortcutHandler;\r\n\t\t\tgantt.removeShortcut = keyNavFacade.removeShortcut;\r\n\t\t})();\r\n\r\n\r\n\t}\r\n\r\n\tsetupKeyNav(gantt);\r\n\r\n\r\n\r\n};","\r\nexport default function(gantt){\r\n\r\nif(!gantt._markers) {\r\n\tgantt._markers = gantt.createDatastore({\r\n\t\tname: \"marker\",\r\n\t\tinitItem: function (marker) {\r\n\t\t\tmarker.id = marker.id || gantt.uid();\r\n\t\t\treturn marker;\r\n\t\t}\r\n\t});\r\n}\r\n\r\ngantt.config.show_markers = true;\r\n\r\nfunction render_marker(marker){\r\n\tif(!gantt.config.show_markers)\r\n\t\treturn false;\r\n\r\n\tif(!marker.start_date)\r\n\t\treturn false;\r\n\r\n\tvar state = gantt.getState();\r\n\tif(+marker.start_date > +state.max_date)\r\n\t\treturn;\r\n\tif((!marker.end_date || +marker.end_date < +state.min_date) && +marker.start_date < +state.min_date)\r\n\t\treturn;\r\n\r\n\tvar div = document.createElement(\"div\");\r\n\r\n\tdiv.setAttribute(\"data-marker-id\", marker.id);\r\n\r\n\tvar css = \"gantt_marker\";\r\n\tif(gantt.templates.marker_class)\r\n\t\tcss += \" \" + gantt.templates.marker_class(marker);\r\n\r\n\tif(marker.css){\r\n\t\tcss += \" \" + marker.css;\r\n\t}\r\n\r\n\tif(gantt.templates.marker_class)\r\n\t\tcss += \" \" + gantt.templates.marker_class(marker);\r\n\r\n\tif(marker.title){\r\n\t\tdiv.title = marker.title;\r\n\t}\r\n\tdiv.className = css;\r\n\r\n\tvar start = gantt.posFromDate(marker.start_date);\r\n\tdiv.style.left = start + \"px\";\r\n\tlet markerHeight = Math.max(gantt.getRowTop(gantt.getVisibleTaskCount()), 0) + \"px\";\r\n\tif (gantt.config.timeline_placeholder && gantt.$task_data){\r\n\t\tmarkerHeight = gantt.$task_data.scrollHeight + \"px\";\r\n\t}\r\n\tdiv.style.height = markerHeight;\r\n\tif(marker.end_date){\r\n\t\tvar end = gantt.posFromDate(marker.end_date);\r\n\t\tdiv.style.width = Math.max((end - start), 0) + \"px\";\r\n\r\n\t}\r\n\r\n\tif(marker.text){\r\n\t\tlet content = null;\r\n\t\tif(typeof marker.text === \"function\"){\r\n\t\t\tcontent = marker.text(marker);\r\n\t\t}else {\r\n\t\t\tcontent = marker.text;\r\n\t\t}\r\n\t\tif(content){\r\n\t\t\tif(gantt.config.external_render && gantt.config.external_render.isElement(content)){\r\n\t\t\t\tdiv.innerHTML = \"<div class='gantt_marker_content' ></div>\";\r\n\t\t\t\tgantt.config.external_render.renderElement(content, div.querySelector(\".gantt_marker_content\"));\r\n\t\t\t}else{\r\n\t\t\t\tdiv.innerHTML = \"<div class='gantt_marker_content' >\" + marker.text + \"</div>\";\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\r\n\t\t\r\n\t}\r\n\r\n\treturn div;\r\n}\r\n\r\nfunction initMarkerArea(){\r\n\t// GS-481. Reset $marker_area if there is no timeline\r\n\tif(!gantt.$task_data || !gantt.$root.contains(gantt.$task_data)){\r\n\t\tgantt.$marker_area = null;\r\n\t\treturn;\r\n\t}\r\n\r\n\t// GS-2084. Don't add $marker_area when it already exists\r\n\tif(gantt.$marker_area && gantt.$task_data.contains(gantt.$marker_area)){\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar markerArea = document.createElement(\"div\");\r\n\tmarkerArea.className = \"gantt_marker_area\";\r\n\tgantt.$task_data.appendChild(markerArea);\r\n\tgantt.$marker_area = markerArea;\r\n}\r\n\r\ngantt.attachEvent(\"onBeforeGanttRender\", function(){\r\n\tif(!gantt.$marker_area)\r\n\t\tinitMarkerArea();\r\n});\r\n\r\ngantt.attachEvent(\"onDataRender\", function(){\r\n\tif(!gantt.$marker_area){\r\n\t\tinitMarkerArea();\r\n\t\tgantt.renderMarkers();\r\n\t}\r\n});\r\n\r\ngantt.attachEvent(\"onGanttLayoutReady\", function(){\r\n\t// GS-1304 - markers should attach when layout is initialized, both on gantt.init and gantt.resetLayout\r\n\t// wait for \"onBeforeGanttRender\", so all layout elements will be in DOM\r\n\tgantt.attachEvent(\"onBeforeGanttRender\", function(){\r\n\t\t// GS-882. If markers are rendered in the onDataRender handler, \r\n\t\t// they are not attached to the layer, so we need to remove the DOM elements\r\n\t\tif (gantt.$marker_area) {\r\n\t\t\tgantt.$marker_area.innerHTML = \"\";\r\n\t\t}\r\n\t\tinitMarkerArea();\r\n\r\n\t\tvar layers = gantt.$services.getService(\"layers\");\r\n\t\tvar markerRenderer = layers.createDataRender({\r\n\t\t\tname: \"marker\",\r\n\t\t\tdefaultContainer: function(){ return gantt.$marker_area;}\r\n\t\t});\r\n\t\tmarkerRenderer.addLayer(render_marker);\r\n\t}, {once: true});\r\n});\r\n\r\ngantt.getMarker = function(id){\r\n\tif(!this._markers) return null;\r\n\r\n\treturn this._markers.getItem(id);\r\n};\r\n\r\ngantt.addMarker = function(marker){\r\n\treturn this._markers.addItem(marker);\r\n};\r\n\r\ngantt.deleteMarker = function(id){\r\n\tif(!this._markers.exists(id))\r\n\t\treturn false;\r\n\r\n\tthis._markers.removeItem(id);\r\n\treturn true;\r\n};\r\ngantt.updateMarker = function(id){\r\n\tthis._markers.refresh(id);\r\n};\r\n\r\ngantt._getMarkers = function(){\r\n\treturn this._markers.getItems();\r\n};\r\n\r\ngantt.renderMarkers = function () {\r\n\tthis._markers.refresh();\r\n};\r\n\r\n};","import {replaceValidZeroId} from \"../utils/helpers\";\r\n\r\nexport default function(gantt){\r\n\r\ngantt.config.multiselect = true;\r\ngantt.config.multiselect_one_level = false;\r\n\r\ngantt._multiselect = {\r\n\t_selected: {},\r\n\t_one_level: false,\r\n\t_active: true,\r\n\t_first_selected_when_shift: null,\r\n\tgetDefaultSelected: function() {\r\n\t\tvar selected = this.getSelected();\r\n\t\treturn selected.length ? selected[selected.length - 1] : null;\r\n\t},\r\n\tsetFirstSelected: function(id) {\r\n\t\tthis._first_selected_when_shift = id;\r\n\t},\r\n\tgetFirstSelected: function() {\r\n\t\treturn this._first_selected_when_shift;\r\n\t},\r\n\tisActive: function() {\r\n\t\tthis.updateState();\r\n\t\treturn this._active;\r\n\t},\r\n\tupdateState: function() {\r\n\t\tthis._one_level = gantt.config.multiselect_one_level;\r\n\t\tvar active = this._active;\r\n\t\tthis._active = gantt.config.select_task;\r\n\t\tif (this._active != active) {\r\n\t\t\tthis.reset();\r\n\t\t}\r\n\t},\r\n\treset: function () {\r\n\t\tthis._selected = {};\r\n\t},\r\n\tsetLastSelected: function (id) {\r\n\t\tgantt.$data.tasksStore.silent(function(){\r\n\t\t\tvar store = gantt.$data.tasksStore;\r\n\t\t\tif (id)\r\n\t\t\t\tstore.select(id+\"\");\r\n\t\t\telse\r\n\t\t\t\tstore.unselect(null);\r\n\t\t});\r\n\t},\r\n\tgetLastSelected: function () {\r\n\t\tvar last = gantt.$data.tasksStore.getSelectedId();\r\n\t\tif (last && gantt.isTaskExists(last))\r\n\t\t\treturn last;\r\n\t\treturn null;\r\n\t},\r\n\tselect: function (id, e) {\r\n\t\tif (id && gantt.callEvent(\"onBeforeTaskMultiSelect\", [id, true, e]) && gantt.callEvent(\"onBeforeTaskSelected\", [id])) {\r\n\t\t\tthis._selected[id] = true;\r\n\t\t\tthis.setLastSelected(id);\r\n\t\t\tthis.afterSelect(id);\r\n\t\t\tgantt.callEvent(\"onTaskMultiSelect\", [id, true, e]);\r\n\t\t\tgantt.callEvent(\"onTaskSelected\", [id]);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\ttoggle: function (id, e) {\r\n\t\tif (this._selected[id]) {\r\n\t\t\tthis.unselect(id, e);\r\n\t\t} else {\r\n\t\t\tthis.select(id, e);\r\n\t\t}\r\n\t},\r\n\tunselect: function (id, e) {\r\n\t\tif (id && gantt.callEvent(\"onBeforeTaskMultiSelect\", [id, false, e])) {\r\n\t\t\tthis._selected[id] = false;\r\n\t\t\tif (this.getLastSelected() == id)\r\n\t\t\t\tthis.setLastSelected(this.getDefaultSelected());\r\n\t\t\tthis.afterSelect(id);\r\n\t\t\tgantt.callEvent(\"onTaskMultiSelect\", [id, false, e]);\r\n\t\t\tgantt.callEvent(\"onTaskUnselected\", [id]);\r\n\t\t}\r\n\t},\r\n\tisSelected: function (id) {\r\n\t\treturn !!(gantt.isTaskExists(id) && this._selected[id]);\r\n\t},\r\n\tgetSelected: function () {\r\n\t\tvar res = [];\r\n\t\tfor (var i in this._selected) {\r\n\t\t\tif (this._selected[i] && gantt.isTaskExists(i)) {\r\n\t\t\t\tres.push(i);\r\n\t\t\t} else {\r\n\t\t\t\tthis._selected[i] = false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tres.sort(function(a, b) {\r\n\t\t\treturn gantt.getGlobalTaskIndex(a) > gantt.getGlobalTaskIndex(b) ? 1 : -1;\r\n\t\t});\r\n\t\treturn res;\r\n\t},\r\n\tforSelected: function (callback) {\r\n\t\tvar selected = this.getSelected();\r\n\t\tfor (var i = 0; i < selected.length; i++) {\r\n\t\t\tcallback(selected[i]);\r\n\t\t}\r\n\t},\r\n\tisSameLevel: function(id) {\r\n\t\tif (!this._one_level)\r\n\t\t\treturn true;\r\n\t\tvar last = this.getLastSelected();\r\n\t\tif (!last)\r\n\t\t\treturn true;\r\n\t\tif (!(gantt.isTaskExists(last) && gantt.isTaskExists(id)))\r\n\t\t\treturn true;\r\n\t\treturn !!(gantt.calculateTaskLevel(gantt.getTask(last)) == gantt.calculateTaskLevel(gantt.getTask(id)));\r\n\t},\r\n\tafterSelect: function(id) {\r\n\t\tif (gantt.isTaskExists(id)){\r\n\t\t\t// FIXME: quick workaround to prevent re-filtering inside refresh on multiselect\r\n\t\t\tgantt._quickRefresh(function(){\r\n\t\t\t\tgantt.refreshTask(id);\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\tdoSelection: function(e) {\r\n\t\tif (!this.isActive())\r\n\t\t\treturn false;\r\n\r\n\t\t// deny selection when click on 'expand' or 'collapse' icons\r\n\t\tif (gantt._is_icon_open_click(e))\r\n\t\t\treturn false;\r\n\r\n\t\tvar target_ev = gantt.locate(e);\r\n\t\tif (!target_ev)\r\n\t\t\treturn false;\r\n\r\n\t\tif (!gantt.callEvent(\"onBeforeMultiSelect\", [e]))\r\n\t\t\treturn false;\r\n\r\n\t\tvar selected = this.getSelected();\r\n\t\tvar defaultLast = this.getFirstSelected();\r\n\t\tvar isLast = false;\r\n\t\tvar last = this.getLastSelected();\r\n\t\tvar multiSelect = gantt.config.multiselect;\r\n\r\n\r\n\t\tvar singleSelection = (function () {\r\n\t\t\t// GS-719: If the multiselect extension is added we still need a way\r\n\t\t\t// to open the inline editors after clicking on the cells in the grid\r\n\t\t\tconst controller = gantt.ext.inlineEditors;\r\n\t\t\tif(controller && controller.getState){\r\n\t\t\t\tconst state = controller.getState();\r\n\t\t\t\tconst cell = controller.locateCell(e.target);\r\n\r\n\t\t\t\tif (gantt.config.inline_editors_multiselect_open && cell && controller.getEditorConfig(cell.columnName)) {\r\n\t\t\t\t\tif (controller.isVisible() && state.id == cell.id && state.columnName == cell.columnName) {\r\n\t\t\t\t\t\t// do nothing if editor is already active in this cell\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcontroller.startEdit(cell.id, cell.columnName);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.setFirstSelected(target_ev);\r\n\r\n\t\t\tif (!this.isSelected(target_ev)) {\r\n\t\t\t\tthis.select(target_ev, e);\r\n\t\t\t}\r\n\t\t\tselected = this.getSelected();\r\n\t\t\tfor (var i = 0; i < selected.length; i++) {\r\n\t\t\t\tif (selected[i] !== target_ev) {\r\n\t\t\t\t\tthis.unselect(selected[i], e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}).bind(this);\r\n\r\n\t\tvar blockSelection = (function(){\r\n\t\t\tif (!last)\r\n\t\t\t\tlast = target_ev;\r\n\t\t\telse if (target_ev) {\r\n\t\t\t\tvar first_indx = gantt.getGlobalTaskIndex(this.getFirstSelected());\r\n\t\t\t\tvar target_indx = gantt.getGlobalTaskIndex(target_ev);\r\n\t\t\t\tvar last_indx = gantt.getGlobalTaskIndex(last);\r\n\t\t\t\t// GS-1969: if the selected tasks are collapsed, need to remove them\r\n\t\t\t\tif(first_indx == -1 || last_indx == -1){\r\n\t\t\t\t\tfirst_indx = target_indx;\r\n\t\t\t\t\tthis.reset();\r\n\t\t\t\t}\r\n\t\t\t\t// clear prev selection\r\n\t\t\t\tvar tmp = last;\r\n\t\t\t\twhile (gantt.getGlobalTaskIndex(tmp) !== first_indx) {\r\n\t\t\t\t\tthis.unselect(tmp, e);\r\n\t\t\t\t\ttmp = (first_indx > last_indx) ? gantt.getNext(tmp) : gantt.getPrev(tmp);\r\n\t\t\t\t}\r\n\t\t\t\ttmp = target_ev;\r\n\t\t\t\twhile (gantt.getGlobalTaskIndex(tmp) !== first_indx) {\r\n\t\t\t\t\tif (this.select(tmp, e) && !isLast) {\r\n\t\t\t\t\t\tisLast = true;\r\n\t\t\t\t\t\tdefaultLast = tmp;\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttmp = (first_indx > target_indx) ? gantt.getNext(tmp) : gantt.getPrev(tmp);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}).bind(this);\r\n\r\n\r\n\t\tif (multiSelect && (e.ctrlKey || e.metaKey)) {\r\n\t\t\tif (!this.isSelected(target_ev))\r\n\t\t\t\tthis.setFirstSelected(target_ev);\r\n\r\n\t\t\tif (target_ev) {\r\n\t\t\t\tthis.toggle(target_ev, e);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\telse if (multiSelect && e.shiftKey) {\r\n\t\t\tif (!gantt.isTaskExists(this.getFirstSelected()) || this.getFirstSelected() === null) {\r\n\t\t\t\tthis.setFirstSelected(target_ev);\r\n\t\t\t}\r\n\r\n\t\t\tif (selected.length) { // select a group of tasks\r\n\t\t\t\tblockSelection();\r\n\t\t\t}\r\n\t\t\telse { // select a task when no task is selected and Shift is pressed\r\n\t\t\t\tsingleSelection();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\telse { // no key press or no multiple selection on the mouse click\r\n\t\t\tsingleSelection();\r\n\t\t}\r\n\r\n\r\n\t\tif (this.isSelected(target_ev)) {\r\n\t\t\tthis.setLastSelected(target_ev);\r\n\t\t} else if (defaultLast) {\r\n\t\t\tif (target_ev == last)\r\n\t\t\t\tthis.setLastSelected(e.shiftKey ? defaultLast : this.getDefaultSelected());\r\n\t\t} else {\r\n\t\t\tthis.setLastSelected(null);\r\n\t\t}\r\n\r\n\t\tif (!this.getSelected().length)\r\n\t\t\tthis.setLastSelected(null);\r\n\r\n\t\tif (!this.getLastSelected() || !this.isSelected(this.getFirstSelected()))\r\n\t\t\tthis.setFirstSelected(this.getLastSelected());\r\n\r\n\t\treturn true;\r\n\t}\r\n};\r\n\r\n(function(){\r\n\tvar old_selectTask = gantt.selectTask;\r\n\tgantt.selectTask = function(id) {\r\n\t\tid = replaceValidZeroId(id, this.config.root_id);\r\n\t\tif (!id)\r\n\t\t\treturn false;\r\n\t\tvar multiselect = gantt._multiselect;\r\n\t\tvar res = id;\r\n\t\tif (multiselect.isActive()) {\r\n\t\t\tif (multiselect.select(id, null)) {\r\n\t\t\t\tmultiselect.setLastSelected(id);\r\n\t\t\t}\r\n\t\t\tmultiselect.setFirstSelected(multiselect.getLastSelected());\r\n\t\t} else {\r\n\t\t\tres = old_selectTask.call(this, id);\r\n\t\t}\r\n\t\treturn res;\r\n\t};\r\n\r\n\tvar old_unselectTask = gantt.unselectTask;\r\n\tgantt.unselectTask = function(id) {\r\n\t\tvar multiselect = gantt._multiselect;\r\n\t\tvar isActive = multiselect.isActive();\r\n\t\tid = id || multiselect.getLastSelected();\r\n\t\tif(id && isActive) {\r\n\t\t\tmultiselect.unselect(id, null);\r\n\t\t\tif (id == multiselect.getLastSelected())\r\n\t\t\t\tmultiselect.setLastSelected(null);\r\n\t\t\tgantt.refreshTask(id);\r\n\t\t\tmultiselect.setFirstSelected(multiselect.getLastSelected());\r\n\t\t}\r\n\t\tvar res = id;\r\n\t\tif (!isActive)\r\n\t\t\tres = old_unselectTask.call(this, id);\r\n\t\treturn res;\r\n\t};\r\n\r\n\tgantt.toggleTaskSelection = function(id) {\r\n\t\tvar multiselect = gantt._multiselect;\r\n\t\tif (id && multiselect.isActive()) {\r\n\t\t\tmultiselect.toggle(id);\r\n\t\t\tmultiselect.setFirstSelected(multiselect.getLastSelected());\r\n\t\t}\r\n\t};\r\n\tgantt.getSelectedTasks = function() {\r\n\t\tvar multiselect = gantt._multiselect;\r\n\t\tmultiselect.isActive();\r\n\t\treturn multiselect.getSelected();\r\n\t};\r\n\tgantt.eachSelectedTask = function(callback){\r\n\t\treturn this._multiselect.forSelected(callback);\r\n\t};\r\n\tgantt.isSelectedTask = function(id){\r\n\t\treturn this._multiselect.isSelected(id);\r\n\t};\r\n\tgantt.getLastSelectedTask = function(){\r\n\t\treturn this._multiselect.getLastSelected();\r\n\t};\r\n\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\t\tvar old_isSelected = gantt.$data.tasksStore.isSelected;\r\n\t\tgantt.$data.tasksStore.isSelected = function(id){\r\n\t\t\tif (gantt._multiselect.isActive()) {\r\n\t\t\t\treturn gantt._multiselect.isSelected(id);\r\n\t\t\t}\r\n\t\t\treturn old_isSelected.call(this, id);\r\n\t\t};\r\n\t});\r\n})();\r\n\r\ngantt.attachEvent(\"onTaskIdChange\", function (id, new_id) {\r\n\tvar multiselect = gantt._multiselect;\r\n\tif (!multiselect.isActive())\r\n\t\treturn true;\r\n\tif (gantt.isSelectedTask(id)) {\r\n\t\tmultiselect.unselect(id, null);\r\n\t\tmultiselect.select(new_id, null);\r\n\t}\r\n});\r\n\r\ngantt.attachEvent(\"onAfterTaskDelete\", function (id, item) {\r\n\tvar multiselect = gantt._multiselect;\r\n\tif (!multiselect.isActive())\r\n\t\treturn true;\r\n\r\n\tif (multiselect._selected[id]) {\r\n\t\t// GS-1057: don't unselect the task here because the task is already unselected \r\n\t\t// it was in the select.js file before it was deleted\r\n\t\t// multiselect.unselect(id, null);\r\n\t\tmultiselect._selected[id] = false;\r\n\t\tmultiselect.setLastSelected(multiselect.getDefaultSelected());\r\n\t}\r\n\r\n\tmultiselect.forSelected(function (task_id) {\r\n\t\tif (!gantt.isTaskExists(task_id))\r\n\t\t\tmultiselect.unselect(task_id, null);\r\n\t});\r\n});\r\n\r\ngantt.attachEvent(\"onBeforeTaskMultiSelect\", function(id, state, e){\r\n\tconst multiselect = gantt._multiselect;\r\n\tif (state && multiselect.isActive()) {\r\n\t\t//GS-1321: prevent unselecting task\r\n\t\tlet oldSelectedId = gantt.getSelectedId();\r\n\t\tlet oldSelectedTask = null;\r\n\t\tif (oldSelectedId) {\r\n\t\t\toldSelectedTask = gantt.getTask(oldSelectedId);\r\n\t\t}\r\n\t\tlet newSelectedTask = gantt.getTask(id);\r\n\t\tlet differentTreeLevel = false;\r\n\t\tif (oldSelectedTask && oldSelectedTask.$level != newSelectedTask.$level){\r\n\t\t\tdifferentTreeLevel = true;\r\n\t\t}\r\n\r\n\t\tif (gantt.config.multiselect_one_level && differentTreeLevel && !e.ctrlKey && !e.shiftKey) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif (multiselect._one_level) {\r\n\t\t\treturn multiselect.isSameLevel(id);\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n});\r\n\r\ngantt.attachEvent(\"onTaskClick\", function(id, e) {\r\n\tif (gantt._multiselect.doSelection(e))\r\n\t\tgantt.callEvent(\"onMultiSelect\", [e]);\r\n\treturn true;\r\n});\r\n\r\n};","\r\ninterface IQuickInfoContainer{\r\n\tparent: HTMLElement;\r\n\txViewport: HTMLElement;\r\n\tyViewport: HTMLElement;\r\n}\r\n\r\nexport class QuickInfo {\r\n\tprivate _quickInfoTask: TaskID;\r\n\tprivate _quickInfoBoxId: number | string;\r\n\tprivate _quickInfoBox: HTMLElement;\r\n\tprivate _quickInfoReadonly: boolean | null;\r\n\tprivate _container: HTMLElement;\r\n\tprivate _gantt: any;\r\n\r\n\tconstructor(gantt: any) {\r\n\t\tthis._gantt = gantt;\r\n\t}\r\n\r\n\t// show at coordinates:\r\n\t// show(x: number, y: number)\r\n\t// show for a task:\r\n\t// show(id: TaskID)\r\n\tshow : {\r\n\t\t(x: number, y: number) : void;\r\n\t\t(id: TaskID) : void;\r\n\t} = (id: TaskID | number, y? : number) : void => {\r\n\t\tif (y === undefined) {\r\n\t\t\tthis._showForTask(id);\r\n\t\t} else {\r\n\t\t\tthis._showAtCoordinates(id as number, y);\r\n\t\t}\r\n\t};\r\n\r\n\thide = (forced?: boolean) : any => {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst qi = this._quickInfoBox;\r\n\t\tthis._quickInfoBoxId = 0;\r\n\t\tconst taskId = this._quickInfoTask;\r\n\t\tthis._quickInfoTask = null;\r\n\r\n\t\tif (qi && qi.parentNode){\r\n\r\n\t\t\tif (gantt.config.quick_info_detached) {\r\n\t\t\t\tgantt.callEvent(\"onAfterQuickInfo\", [taskId]);\r\n\t\t\t\treturn qi.parentNode.removeChild(qi);\r\n\t\t\t}\r\n\r\n\t\t\tqi.className += \" gantt_qi_hidden\";\r\n\t\t\tif (qi.style.right === \"auto\"){\r\n\t\t\t\tqi.style.left = \"-350px\";\r\n\t\t\t} else {\r\n\t\t\t\tqi.style.right = \"-350px\";\r\n\t\t\t}\r\n\r\n\t\t\tif (forced) {\r\n\t\t\t\tqi.style.left = qi.style.right = \"\";\r\n\t\t\t\tqi.parentNode.removeChild(qi);\r\n\t\t\t}\r\n\t\t\tgantt.callEvent(\"onAfterQuickInfo\", [taskId]);\r\n\t\t}\r\n\t};\r\n\r\n\tgetNode = (): HTMLElement => {\r\n\t\tif(this._quickInfoBox) {\r\n\t\t\treturn this._quickInfoBox;\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n\r\n\tsetContainer = (container: string|HTMLElement): void => {\r\n\t\tif(container){\r\n\t\t\tthis._container = typeof container === \"string\" ? document.getElementById(container) : container;\r\n\t\t}\r\n\t};\r\n\r\n\tsetContent = (content?: IQuickInfoContent) => {\r\n\t\tconst gantt = this._gantt;\r\n\r\n\t\tconst defaultContent = {\r\n\t\t\ttaskId: null,\r\n\t\t\theader: {\r\n\t\t\t\ttitle: \"\",\r\n\t\t\t\tdate: \"\"\r\n\t\t\t},\r\n\t\t\tcontent: \"\",\r\n\t\t\tbuttons: gantt.config.quickinfo_buttons\r\n\t\t};\r\n\r\n\t\tif(!content){\r\n\t\t\tcontent = defaultContent;\r\n\t\t}\r\n\r\n\t\tif(!content.taskId){\r\n\t\t\tcontent.taskId = defaultContent.taskId;\r\n\t\t}\r\n\r\n\t\tif(!content.header){\r\n\t\t\tcontent.header = defaultContent.header;\r\n\t\t}\r\n\r\n\t\tif(!content.header.title){\r\n\t\t\tcontent.header.title = defaultContent.header.title;\r\n\t\t}\r\n\t\tif(!content.header.date){\r\n\t\t\tcontent.header.date = defaultContent.header.date;\r\n\t\t}\r\n\t\tif(!content.content){\r\n\t\t\tcontent.content = defaultContent.content;\r\n\t\t}\r\n\t\tif(!content.buttons){\r\n\t\t\tcontent.buttons = defaultContent.buttons;\r\n\t\t}\r\n\r\n\r\n\t\tlet qi = this.getNode();\r\n\t\tif(!qi){\r\n\t\t\tqi = this._createQuickInfoElement();\r\n\t\t}\r\n\r\n\t\tif(content.taskId){\r\n\t\t\tthis._quickInfoBoxId = content.taskId;\r\n\t\t}\r\n\r\n\t\tconst titleBox = qi.querySelector(\".gantt_cal_qi_title\") as HTMLElement;\r\n\t\tconst titleContent = titleBox.querySelector(\".gantt_cal_qi_tcontent\");\r\n\t\tconst titleDate = titleBox.querySelector(\".gantt_cal_qi_tdate\");\r\n\t\tconst main = qi.querySelector(\".gantt_cal_qi_content\");\r\n\t\tconst controls = qi.querySelector(\".gantt_cal_qi_controls\") as HTMLElement;\r\n\r\n\t\tgantt._waiAria.quickInfoHeader(qi, [content.header.title, content.header.date].join(\" \"));\r\n\r\n\t\ttitleContent.innerHTML = content.header.title;\r\n\t\ttitleDate.innerHTML = content.header.date;\r\n\r\n\t\tif(!content.header.title && !content.header.date){\r\n\t\t\ttitleBox.style.display = \"none\";\r\n\t\t}else{\r\n\t\t\ttitleBox.style.display = \"\";\r\n\t\t}\r\n\t\tmain.innerHTML = content.content;\r\n\r\n\t\tconst buttons = content.buttons;\r\n\t\tif(!buttons.length){\r\n\t\t\tcontrols.style.display = \"none\";\r\n\t\t}else{\r\n\t\t\tcontrols.style.display = \"\";\r\n\t\t}\r\n\t\tlet html = \"\";\r\n\t\tfor (let i = 0; i < buttons.length; i++){\r\n\r\n\t\t\tconst ariaAttr = gantt._waiAria.quickInfoButtonAttrString(gantt.locale.labels[buttons[i]]);\r\n\r\n\t\t\thtml += `<div class=\"gantt_qi_big_icon ${buttons[i]} dhx_gantt_${buttons[i]}\" title=\"${gantt.locale.labels[buttons[i]]}\" ${ariaAttr}>\r\n            <div class='dhx_menu_icon dhx_gantt_icon ${buttons[i]} gantt_menu_icon dhx_gantt_${buttons[i]}'></div>\r\n            <div>${gantt.locale.labels[buttons[i]]}</div>\r\n         </div>`;\r\n\t\t}\r\n\t\tcontrols.innerHTML = html;\r\n\r\n\t\tgantt.eventRemove(qi, \"click\", this._qiButtonClickHandler);\r\n\t\tgantt.eventRemove(qi, \"keypress\", this._qiKeyPressHandler);\r\n\r\n\t\tgantt.event(qi, \"click\", this._qiButtonClickHandler);\r\n\t\tgantt.event(qi, \"keypress\", this._qiKeyPressHandler);\r\n\t};\r\n\r\n\tprivate _qiButtonClickHandler = (ev) => {\r\n\t\tthis._qi_button_click(ev.target);\r\n\t};\r\n\r\n\tprivate _qiKeyPressHandler = (e) => {\r\n\r\n\t\tconst code = e.which;\r\n\t\tif (code === 13 || code === 32){\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis._qi_button_click(e.target);\r\n\t\t\t},1);\r\n\t\t}\r\n\t};\r\n\r\n\tprivate _showAtCoordinates(x: number, y: number) : void {\r\n\t\tthis.hide(true);\r\n\t\tthis._quickInfoBoxId = 0;\r\n\t\tthis._quickInfoTask = null;\r\n\t\tif(!this._quickInfoBox){\r\n\t\t\tthis._createQuickInfoElement();\r\n\t\t\tthis.setContent();\r\n\t\t}\r\n\r\n\t\tthis._appendAtCoordinates(x, y);\r\n\t\tthis._gantt.callEvent(\"onQuickInfo\", [null]);\r\n\t}\r\n\r\n\tprivate _showForTask(id: TaskID) : void {\r\n\t\tconst gantt = this._gantt;\r\n\t\tif ((\r\n\t\t\tid === this._quickInfoBoxId &&\r\n\t\t\tgantt.utils.dom.isChildOf(this._quickInfoBox, document.body)\r\n\t\t) || !gantt.config.show_quick_info) {\r\n\t\t\t// not show if the quick info is already displayed for this task, or if it shouldn't be displayed\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.hide(true);\r\n\t\tconst offset = 6; // offset TASK <> QI-BOX in 'px'\r\n\t\tconst container = this._getContainer();\r\n\t\tconst pos = this._get_event_counter_part(id, offset, container.xViewport, container.yViewport);\r\n\r\n\t\tif (pos){\r\n\t\t\tthis._quickInfoBox = this._init_quick_info(id);\r\n\t\t\tthis._quickInfoTask = id;\r\n\t\t\tthis._quickInfoBox.className = this._prepare_quick_info_classname(id);\r\n\r\n\t\t\tthis._fill_quick_data(id);\r\n\t\t\tthis._show_quick_info(pos, offset);\r\n\t\t\tgantt.callEvent(\"onQuickInfo\", [id]);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _get_event_counter_part(id: TaskID, offset: number, xViewport: HTMLElement, yViewport: HTMLElement) : any {\r\n\t\tconst gantt = this._gantt;\r\n\t\tlet domEv = gantt.getTaskNode(id);\r\n\t\tif (!domEv) {\r\n\t\t\tdomEv = gantt.getTaskRowNode(id);\r\n\t\t\tif (!domEv) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet left = 0;\r\n\t\tconst top = offset + domEv.offsetTop + domEv.offsetHeight;\r\n\r\n\t\tlet node = domEv;\r\n\r\n\t\tif (gantt.utils.dom.isChildOf(node, xViewport)) {\r\n\t\t\twhile (node && node !== xViewport){\r\n\t\t\t\tleft += node.offsetLeft;\r\n\t\t\t\tnode = node.offsetParent;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst scroll = gantt.getScrollState();\r\n\r\n\t\tif(node){\r\n\t\t\tconst dx = (left + domEv.offsetWidth/2) - scroll.x > (xViewport.offsetWidth/2) ? 1 : 0;\r\n\t\t\tconst dy = (top + domEv.offsetHeight/2) - scroll.y > (yViewport.offsetHeight/2) ? 1 : 0;\r\n\r\n\t\t\treturn { left, top, dx, dy, width:domEv.offsetWidth, height:domEv.offsetHeight };\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprivate _createQuickInfoElement() : HTMLElement {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst qi = document.createElement(\"div\");\r\n\t\tqi.className += \"gantt_cal_quick_info\";\r\n\t\tgantt._waiAria.quickInfoAttr(qi);\r\n\r\n\t\t// title\r\n\t\tconst ariaAttr = gantt._waiAria.quickInfoHeaderAttrString();\r\n\t\tvar html = `\r\n\t\t<div class=\"gantt_cal_qi_tcontrols\">\r\n\t\t\t<a class=\"gantt_cal_qi_close_btn dhx_gantt_icon dhx_gantt_icon_close\"></a>\r\n\t\t</div>\r\n\t\t<div class=\"gantt_cal_qi_title\" ${ariaAttr}>\r\n\t\t\t\t\r\n\t\t\t\t<div class=\"gantt_cal_qi_tcontent\"></div>\r\n\t\t\t\t<div class=\"gantt_cal_qi_tdate\"></div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"gantt_cal_qi_content\"></div>`;\r\n\r\n\t\t//buttons\r\n\t\thtml += \"<div class=\\\"gantt_cal_qi_controls\\\">\";\r\n\r\n\t\thtml += \"</div>\";\r\n\r\n\t\tqi.innerHTML = html;\r\n\r\n\r\n\t\tif (gantt.config.quick_info_detached) {\r\n\t\t\tconst container = this._getContainer();\r\n\t\t\tgantt.event(container.parent, \"scroll\", () => { this.hide(); });\r\n\t\t}\r\n\r\n\t\tthis._quickInfoBox = qi;\r\n\t\treturn qi;\r\n\t}\r\n\r\n\tprivate _init_quick_info(id: TaskID) : HTMLElement {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst task = gantt.getTask(id);\r\n\t\t\r\n\r\n\t\tif(typeof this._quickInfoReadonly === \"boolean\"){\r\n\t\t\tif(gantt.isReadonly(task) !== this._quickInfoReadonly){\r\n\t\t\t\tthis.hide(true);\r\n\t\t\t\tthis._quickInfoBox = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._quickInfoReadonly = gantt.isReadonly(task);\r\n\r\n\t\tif (!this._quickInfoBox){\r\n\t\t\tthis._quickInfoBox = this._createQuickInfoElement();\r\n\t\t}\r\n\r\n\t\treturn this._quickInfoBox;\r\n\t}\r\n\r\n\tprivate _prepare_quick_info_classname(id: TaskID) : string {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst task = gantt.getTask(id);\r\n\t\tconst taskType = gantt.getTaskType(task);\r\n\r\n\t\tlet css = `gantt_cal_quick_info gantt_${taskType}`;\r\n\t\tconst template = gantt.templates.quick_info_class(task.start_date, task.end_date, task);\r\n\r\n\t\tif(template){\r\n\t\t\tcss += \" \" + template;\r\n\t\t}\r\n\t\treturn css;\r\n\t}\r\n\r\n\tprivate _fill_quick_data(id: TaskID) : void {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst ev = gantt.getTask(id);\r\n\r\n\t\tthis._quickInfoBoxId = id;\r\n\r\n\t\tlet allowedButtons = [];\r\n\t\tif (this._quickInfoReadonly){\r\n\t\t\tconst buttons = gantt.config.quickinfo_buttons;\r\n\t\t\tconst isEditor = {icon_delete: true, icon_edit: true};\r\n\t\t\tfor (let i = 0; i < buttons.length; i++){\r\n\t\t\t\tif(this._quickInfoReadonly && isEditor[buttons[i]]){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tallowedButtons.push(buttons[i]);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tallowedButtons = gantt.config.quickinfo_buttons;\r\n\t\t}\r\n\r\n\t\tthis.setContent({\r\n\t\t\theader: {\r\n\t\t\t\ttitle: gantt.templates.quick_info_title(ev.start_date, ev.end_date, ev),\r\n\t\t\t\tdate: gantt.templates.quick_info_date(ev.start_date, ev.end_date, ev)\r\n\t\t\t},\r\n\t\t\tcontent: gantt.templates.quick_info_content(ev.start_date, ev.end_date, ev),\r\n\t\t\tbuttons: allowedButtons\r\n\t\t});\r\n\t}\r\n\r\n\tprivate _appendAtCoordinates(x: number, y: number): void {\r\n\t\tconst qi = this._quickInfoBox;\r\n\t\tconst container = this._getContainer();\r\n\t\tif (!qi.parentNode ||\r\n\t\t\tqi.parentNode.nodeName.toLowerCase() === \"#document-fragment\"){ // IE8\r\n\t\t\tcontainer.parent.appendChild(qi);\r\n\t\t}\r\n\r\n\t\tqi.style.left = x + \"px\";\r\n\t\tqi.style.top = y + \"px\";\r\n\t}\r\n\r\n\tprivate _show_quick_info(pos: any, offset: number) : void {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst qi = this._quickInfoBox;\r\n\t\tif (gantt.config.quick_info_detached) {\r\n\t\t\tconst container = this._getContainer();\r\n\t\t\tif (!qi.parentNode ||\r\n\t\t\t\tqi.parentNode.nodeName.toLowerCase() === \"#document-fragment\"){ // IE8\r\n\t\t\t\tcontainer.parent.appendChild(qi);\r\n\t\t\t}\r\n\t\t\tconst width = qi.offsetWidth;\r\n\t\t\tconst popupHeight = qi.offsetHeight;\r\n\r\n\t\t\tconst scrolls = gantt.getScrollState();\r\n\t\t\tconst xViewport = container.xViewport;\r\n\t\t\tconst yViewport = container.yViewport;\r\n\t\t\tconst screenWidth = xViewport.offsetWidth + scrolls.x - width;\r\n\r\n\t\t\tconst relativePopupTop = pos.top - scrolls.y;\r\n\t\t\tconst relativePopupBottom = relativePopupTop + popupHeight;\r\n\r\n\t\t\tlet top = pos.top;\r\n\t\t\tif(relativePopupBottom > yViewport.offsetHeight / 2){\r\n\t\t\t\ttop = pos.top - (popupHeight + pos.height + 2*offset);\r\n\t\t\t\tif(top < scrolls.y && relativePopupBottom <= yViewport.offsetHeight){\r\n\t\t\t\t\ttop = pos.top;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (top < scrolls.y) {\r\n\t\t\t\ttop = scrolls.y;\r\n\t\t\t}\r\n\r\n\t\t\tconst x = Math.min(Math.max(scrolls.x, pos.left - pos.dx*(width - pos.width)), screenWidth);\r\n\t\t\tconst y = top;\r\n\r\n\t\t\tthis._appendAtCoordinates(x, y);\r\n\t\t} else {\r\n\t\t\tqi.style.top = 20 + \"px\";\r\n\t\t\tif (pos.dx === 1){\r\n\t\t\t\tqi.style.right = \"auto\";\r\n\t\t\t\tqi.style.left = \"-300px\";\r\n\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tqi.style.left = \"10px\";\r\n\t\t\t\t},1);\r\n\t\t\t} else {\r\n\t\t\t\tqi.style.left = \"auto\";\r\n\t\t\t\tqi.style.right = \"-300px\";\r\n\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tqi.style.right = \"10px\";\r\n\t\t\t\t},1);\r\n\t\t\t}\r\n\t\t\tqi.className += \" gantt_qi_\"+(pos.dx === 1 ? \"left\" : \"right\");\r\n\t\t\tgantt.$root.appendChild(qi);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _qi_button_click(node: any) : void {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst box = this._quickInfoBox;\r\n\t\tif (!node || node === box){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(node.closest(\".gantt_cal_qi_close_btn\")){\r\n\t\t\tthis.hide();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst mask = node.className;\r\n\t\tif (mask.indexOf(\"_icon\") !== -1){\r\n\t\t\tconst id = this._quickInfoBoxId;\r\n\t\t\tgantt.$click.buttons[mask.split(\" \")[1].replace(\"icon_\",\"\")](id);\r\n\t\t} else {\r\n\t\t\tthis._qi_button_click(node.parentNode);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _getContainer(): IQuickInfoContainer{\r\n\t\tconst gantt = this._gantt;\r\n\t\tlet container = this._container ? this._container : gantt.$task_data;\r\n\t\tif (container && container.offsetHeight && container.offsetWidth) {\r\n\t\t\treturn {\r\n\t\t\t\tparent: container,\r\n\t\t\t\txViewport: gantt.$task,\r\n\t\t\t\tyViewport: gantt.$task_data\r\n\t\t\t};\r\n\t\t}\r\n\t\tcontainer = this._container ? this._container : gantt.$grid_data;\r\n\t\tif (container && container.offsetHeight && container.offsetWidth) {\r\n\t\t\treturn {\r\n\t\t\t\tparent: container,\r\n\t\t\t\txViewport: gantt.$grid,\r\n\t\t\t\tyViewport: gantt.$grid_data\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tparent: this._container ? this._container : gantt.$layout,\r\n\t\t\txViewport: gantt.$layout,\r\n\t\t\tyViewport: gantt.$layout\r\n\t\t};\r\n\t}\r\n}\r\n","import { QuickInfo } from \"./quickInfo\";\r\n\r\nexport default function(gantt: any){\r\n\r\nif (!gantt.ext) {\r\n\tgantt.ext = {};\r\n}\r\ngantt.ext.quickInfo = new QuickInfo(gantt);\r\n\r\ngantt.config.quickinfo_buttons = [\"icon_edit\", \"icon_delete\"];\r\ngantt.config.quick_info_detached = true;\r\ngantt.config.show_quick_info = true;\r\n\r\ngantt.templates.quick_info_title = function(start, end, ev){ return ev.text.substr(0,50); };\r\ngantt.templates.quick_info_content = function(start, end, ev){ return ev.details || ev.text; };\r\ngantt.templates.quick_info_date = function(start, end, ev){\r\n\treturn gantt.templates.task_time(start, end, ev);\r\n};\r\ngantt.templates.quick_info_class = function(start, end, task){ return \"\"; };\r\n\r\ngantt.attachEvent(\"onTaskClick\", function(id,e){\r\n\t// GS-1460 and GS-1787. Don't show Quick Info when clicking on the add, collapse, and expand buttons\r\n\tconst addButton = gantt.utils.dom.closest(e.target, \".gantt_add\");\r\n\tconst collapseButton = gantt.utils.dom.closest(e.target, \".gantt_close\");\r\n\tconst expandButton = gantt.utils.dom.closest(e.target, \".gantt_open\");\r\n\tconst showQuickInfo = !addButton && !collapseButton && !expandButton;\r\n\tif (showQuickInfo){\r\n\t\tsetTimeout(function() {\r\n\t\t\tgantt.ext.quickInfo.show(id);\r\n\t\t}, 0);\r\n\t}\r\n\r\n\treturn true;\r\n});\r\n\r\nconst events = [\"onViewChange\", \"onLightbox\", \"onBeforeTaskDelete\", \"onBeforeDrag\"];\r\nconst hidingFunction = function(){\r\n\tgantt.ext.quickInfo.hide();\r\n\treturn true;\r\n};\r\nfor (let i=0; i<events.length; i++){\r\n\tgantt.attachEvent(events[i], hidingFunction);\r\n}\r\n// GS-957: We don't want to hide QuickInfo when we click on it.\r\ngantt.attachEvent(\"onEmptyClick\", function(e){\r\n\tlet hideQuickInfo = true;\r\n\tconst parent = document.querySelector(\".gantt_cal_quick_info\");\r\n\tif (parent){\r\n\t\tconst quickInfoClick = gantt.utils.dom.isChildOf(e.target, parent);\r\n\t\tif (quickInfoClick){\r\n\t\t\thideQuickInfo = false;\r\n\t\t}\r\n\t}\r\n\tif (hideQuickInfo){\r\n\t\thidingFunction();\r\n\t}\r\n});\r\nfunction clearQuickInfo() {\r\n\tgantt.ext.quickInfo.hide();\r\n\tgantt.ext.quickInfo._quickInfoBox = null;\r\n\treturn true;\r\n}\r\ngantt.attachEvent(\"onGanttReady\", clearQuickInfo);\r\ngantt.attachEvent(\"onDestroy\", clearQuickInfo);\r\n\r\n// eslint-disable-next-line no-restricted-globals\r\ngantt.event(window, \"keydown\", function(e){\r\n\tif (e.keyCode === 27){\r\n\t\tgantt.ext.quickInfo.hide();\r\n\t}\r\n});\r\n\r\ngantt.showQuickInfo = function(){\r\n\tgantt.ext.quickInfo.show.apply(gantt.ext.quickInfo, arguments);\r\n};\r\ngantt.hideQuickInfo = function(){\r\n\tgantt.ext.quickInfo.hide.apply(gantt.ext.quickInfo, arguments);\r\n};\r\n\r\n}","import * as utils from \"../../../utils/utils\";\r\n\r\nfunction createScope(addEvent, removeEvent) {\r\n\taddEvent = addEvent || utils.event;\r\n\tremoveEvent = removeEvent || utils.eventRemove;\r\n\r\n\tvar handlers = [];\r\n\r\n\tvar eventScope = {\r\n\t\tattach: function(el, event, callback, capture){\r\n\t\t\thandlers.push({element: el, event:event, callback: callback, capture: capture});\r\n\t\t\taddEvent(el, event, callback, capture);\r\n\t\t},\r\n\t\tdetach: function(el, event, callback, capture){\r\n\t\t\tremoveEvent(el, event, callback, capture);\r\n\t\t\tfor(var i = 0; i < handlers.length; i++){\r\n\t\t\t\tvar handler = handlers[i];\r\n\t\t\t\tif (handler.element === el && handler.event === event && handler.callback === callback && handler.capture === capture) {\r\n\t\t\t\t\thandlers.splice(i, 1);\r\n\t\t\t\t\ti--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tdetachAll: function () {\r\n\t\t\tvar staticArray = handlers.slice();\r\n\t\t\t// original handlers array can be spliced on every iteration\r\n\t\t\tfor (var i = 0; i < staticArray.length; i++){\r\n\t\t\t\tvar handler = staticArray[i];\r\n\t\t\t\teventScope.detach(handler.element, handler.event, handler.callback, handler.capture);\r\n\t\t\t\teventScope.detach(handler.element, handler.event, handler.callback, undefined);\r\n\t\t\t\teventScope.detach(handler.element, handler.event, handler.callback, false);\r\n\t\t\t\teventScope.detach(handler.element, handler.event, handler.callback, true);\r\n\t\t\t}\r\n\t\t\thandlers.splice(0, handlers.length);\r\n\t\t},\r\n\t\textend: function(){\r\n\t\t\treturn createScope(this.event, this.eventRemove);\r\n\t\t}\r\n\t};\r\n\r\n\treturn eventScope;\r\n}\r\n\r\nexport default createScope;","import * as domHelpers from \"../../core/ui/utils/dom_helpers\";\r\n\r\n/* eslint-disable no-restricted-globals */\r\n\r\ninterface IViewPosition{\r\n\ttop: number;\r\n\tleft: number;\r\n}\r\n\r\ninterface IViewBox extends IViewPosition{\r\n\twidth: number;\r\n\theight: number;\r\n\tbottom: number;\r\n\tright: number;\r\n}\r\n\r\nexport class Tooltip {\r\n\tprivate _root: HTMLElement;\r\n\tprivate _tooltipNode: HTMLElement;\r\n\tprivate _gantt: any;\r\n\r\n\tconstructor(gantt: any){\r\n\t\tthis._gantt = gantt;\r\n\t}\r\n\r\n\tgetNode() : HTMLElement {\r\n\t\tconst gantt = this._gantt;\r\n\t\tif (!this._tooltipNode){\r\n\t\t\tthis._tooltipNode = document.createElement(\"div\");\r\n\t\t\tthis._tooltipNode.className = \"gantt_tooltip\";\r\n\t\t\tgantt._waiAria.tooltipAttr(this._tooltipNode);\r\n\t\t}\r\n\t\treturn this._tooltipNode;\r\n\t}\r\n\r\n\tsetViewport(node: HTMLElement):Tooltip{\r\n\t\tthis._root = node;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tshow(left: number, top: number): Tooltip;\r\n\tshow(event: MouseEvent): Tooltip;\r\n\tshow(left: number | MouseEvent, top?: number): Tooltip {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst container = document.body;\r\n\t\tconst node = this.getNode();\r\n\r\n\t\tif(!domHelpers.isChildOf(node, container)){\r\n\t\t\tthis.hide();\r\n\t\t\t// GS-2463. Don't put the node beyond the body coordinates\r\n\t\t\t// as it may trigger the resize event\r\n\t\t\tnode.style.top = node.style.top || \"0px\";\r\n\t\t\tnode.style.left = node.style.left || \"0px\";\r\n\t\t\tcontainer.appendChild(node);\r\n\t\t}\r\n\r\n\t\tif (this._isLikeMouseEvent(left)) {\r\n\t\t\tconst position = this._calculateTooltipPosition(left as MouseEvent);\r\n\t\t\ttop = position.top;\r\n\t\t\tleft = position.left;\r\n\t\t}\r\n\r\n\t\tnode.style.top = top + \"px\";\r\n\t\tnode.style.left = left + \"px\";\r\n\r\n\t\tgantt._waiAria.tooltipVisibleAttr(node);\r\n\t\treturn this;\r\n\t}\r\n\thide() : Tooltip{\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst node = this.getNode();\r\n\t\tif(node && node.parentNode){\r\n\t\t\tnode.parentNode.removeChild(node);\r\n\t\t}\r\n\t\tgantt._waiAria.tooltipHiddenAttr(node);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetContent(html: string) : Tooltip{\r\n\t\tconst node = this.getNode();\r\n\t\tnode.innerHTML = html;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t// it is for salesforce, because it proxies event to it own events\r\n\tprivate _isLikeMouseEvent(event: any): boolean {\r\n\t\tif (!event || typeof event !== \"object\") {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn \"clientX\" in event && \"clientY\" in event;\r\n\t}\r\n\r\n\tprivate _getViewPort() : HTMLElement {\r\n\t\treturn this._root || document.body;\r\n\t}\r\n\r\n\r\n\tprivate _calculateTooltipPosition(event: MouseEvent): IViewPosition{\r\n\t\tconst gantt = this._gantt;\r\n\t\t// top/left coordinates inside the viewport by mouse position\r\n\t\tconst viewport =  this._getViewPortSize();\r\n\t\tconst tooltipNode = this.getNode();\r\n\t\tconst tooltip: IViewBox = {\r\n\t\t\ttop:0,\r\n\t\t\tleft: 0,\r\n\t\t\twidth: tooltipNode.offsetWidth,\r\n\t\t\theight: tooltipNode.offsetHeight,\r\n\t\t\tbottom: 0,\r\n\t\t\tright: 0\r\n\t\t};\r\n\r\n\t\tconst offsetX = gantt.config.tooltip_offset_x;\r\n\t\tconst offsetY = gantt.config.tooltip_offset_y;\r\n\r\n\t\tconst container = document.body;\r\n\t\tconst mouse = domHelpers.getRelativeEventPosition(event, container);\r\n\t\tconst containerPos = domHelpers.getNodePosition(container);\r\n\t\tmouse.y += containerPos.y; // to fix margin collapsing\r\n\r\n\t\ttooltip.top = mouse.y;\r\n\t\ttooltip.left = mouse.x;\r\n\t\ttooltip.top += offsetY;\r\n\t\ttooltip.left += offsetX;\r\n\t\ttooltip.bottom = tooltip.top + tooltip.height;\r\n\t\ttooltip.right = tooltip.left + tooltip.width;\r\n\r\n\t\tconst scrollTop = window.scrollY + container.scrollTop; // to fix margin collapsing\r\n\t\t// edge cases when the tooltip element can be partially hidden by edges of the viewport\r\n\t\tif(tooltip.top < viewport.top - scrollTop){\r\n\t\t\ttooltip.top = viewport.top;\r\n\t\t\ttooltip.bottom = tooltip.top + tooltip.height;\r\n\t\t}else if(tooltip.bottom > viewport.bottom){\r\n\t\t\ttooltip.bottom = viewport.bottom;\r\n\t\t\ttooltip.top = tooltip.bottom - tooltip.height;\r\n\t\t}\r\n\r\n\t\tif(tooltip.left < viewport.left){\r\n\t\t\ttooltip.left = viewport.left;\r\n\t\t\ttooltip.right = viewport.left + tooltip.width;\r\n\t\t}else if(tooltip.right > viewport.right){\r\n\t\t\ttooltip.right = viewport.right;\r\n\t\t\ttooltip.left = tooltip.right - tooltip.width;\r\n\t\t}\r\n\r\n\t\tif(mouse.x >= tooltip.left && mouse.x <= tooltip.right) {\r\n\t\t\ttooltip.left = mouse.x - tooltip.width - offsetX;\r\n\t\t\ttooltip.right = tooltip.left + tooltip.width;\r\n\t\t}\r\n\r\n\t\tif(mouse.y >= tooltip.top && mouse.y <= tooltip.bottom) {\r\n\t\t\ttooltip.top = mouse.y - tooltip.height - offsetY;\r\n\t\t\ttooltip.bottom = tooltip.top + tooltip.height;\r\n\t\t}\r\n\r\n\t\t// GS-2827: when tooltip width too long\r\n\t\tif(tooltip.left < 0){\r\n\t\t\ttooltip.left = 0;\r\n\t\t}\r\n\t\tif(tooltip.right < 0){\r\n\t\t\ttooltip.right = 0;\r\n\t\t}\r\n\r\n\t\treturn tooltip;\r\n\t}\r\n\r\n\tprivate _getViewPortSize() : IViewBox {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst container = this._getViewPort();\r\n\t\tlet viewport = container;\r\n\t\tlet scrollTop = window.scrollY + document.body.scrollTop;\r\n\t\tlet scrollLeft = window.scrollX + document.body.scrollLeft;\r\n\t\tlet pos;\r\n\t\t// support for the initial tooltip mode where the tooltip element was attached to the data area of gantt\r\n\t\tif(container === gantt.$task_data){\r\n\t\t\tviewport = gantt.$task;\r\n\t\t\tscrollTop = 0;\r\n\t\t\tscrollLeft = 0;\r\n\t\t\tpos = domHelpers.getNodePosition(gantt.$task);\r\n\t\t}else{\r\n\t\t\tpos = domHelpers.getNodePosition(viewport);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tleft:pos.x + scrollLeft,\r\n\t\t\ttop: pos.y + scrollTop,\r\n\t\t\twidth: pos.width,\r\n\t\t\theight: pos.height,\r\n\t\t\tbottom: pos.y + pos.height + scrollTop,\r\n\t\t\tright: pos.x + pos.width + scrollLeft\r\n\t\t};\r\n\t}\r\n}\r\n","import domEventsScope from \"../../core/ui/utils/dom_event_scope\";\r\nimport * as domHelpers from \"../../core/ui/utils/dom_helpers\";\r\nimport * as helpers from \"../../utils/helpers\";\r\nimport { Tooltip } from \"./tooltip\";\r\n\r\ninterface ITrackerTarget {\r\n\tselector: string;\r\n\tonmouseenter: (event: MouseEvent, node: HTMLElement) => void;\r\n\tonmousemove: (event: MouseEvent, node: HTMLElement) => void;\r\n\tonmouseleave: (event: MouseEvent, node: HTMLElement) => void;\r\n\tglobal: boolean;\r\n}\r\n\r\ninterface ITooltipConfig {\r\n\tselector: string;\r\n\thtml: (event: MouseEvent, node: HTMLElement) => string;\r\n\tglobal: boolean;\r\n}\r\n\r\nexport class TooltipManager{\r\n\ttooltip: Tooltip;\r\n\tprotected _domEvents: any;\r\n\tprivate _listeners: object = {};\r\n\tprivate _gantt: any;\r\n\tprivate delayShow: any;\r\n\tprivate delayHide: any;\r\n\r\n\tconstructor(gantt: any) {\r\n\t\tthis.tooltip = new Tooltip(gantt);\r\n\t\tthis._gantt = gantt;\r\n\t\tthis._domEvents = domEventsScope();\r\n\t\tthis._initDelayedFunctions();\r\n\t}\r\n\r\n\tdestructor(): void{\r\n\t\tthis.tooltip.hide();\r\n\t\tthis._domEvents.detachAll();\r\n\t}\r\n\thideTooltip(): void{\r\n\t\tthis.delayHide();\r\n\t}\r\n\tattach(config: ITrackerTarget): void {\r\n\t\tlet root = document.body;\r\n\t\tconst gantt = this._gantt;\r\n\t\tif(!config.global){\r\n\t\t\troot = gantt.$root;\r\n\t\t}\r\n\r\n\t\tlet watchableTarget = null;\r\n\t\tconst handler = (event) => {\r\n\t\t\tconst eventTarget = domHelpers.getTargetNode(event);\r\n\t\t\tconst targetNode = domHelpers.closest(eventTarget, config.selector);\r\n\t\t\tif(domHelpers.isChildOf(eventTarget, this.tooltip.getNode())){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst doOnMouseEnter = () => {\r\n\t\t\t\twatchableTarget = targetNode;\r\n\t\t\t\tconfig.onmouseenter(event, targetNode);\r\n\t\t\t};\r\n\r\n\t\t\tif(watchableTarget){\r\n\t\t\t\tif(targetNode && targetNode === watchableTarget){\r\n\t\t\t\t\tconfig.onmousemove(event, targetNode);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tconfig.onmouseleave(event, watchableTarget);\r\n\t\t\t\t\twatchableTarget = null;\r\n\r\n\t\t\t\t\tif(targetNode && targetNode !== watchableTarget){\r\n\t\t\t\t\t\tdoOnMouseEnter();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tif(targetNode){\r\n\t\t\t\t\tdoOnMouseEnter();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.detach(config.selector);\r\n\t\tthis._domEvents.attach(root, \"mousemove\", handler);\r\n\t\tthis._listeners[config.selector] = {\r\n\t\t\tnode: root,\r\n\t\t\thandler\r\n\t\t};\r\n\t}\r\n\r\n\tdetach(selector: string): void {\r\n\t\tconst listener = this._listeners[selector];\r\n\t\tif(listener){\r\n\t\t\tthis._domEvents.detach(listener.node, \"mousemove\", listener.handler);\r\n\t\t}\r\n\t}\r\n\r\n\ttooltipFor(config: ITooltipConfig): void {\r\n\t\tconst cloneDomEvent = (event: MouseEvent) => {\r\n\t\t\tlet clone = event;\r\n\t\t\t// making events survive timeout in ie\r\n\t\t\t// tslint:disable-next-line no-string-literal\r\n\t\t\tif(document[\"createEventObject\"] && !document.createEvent){\r\n\t\t\t\t// tslint:disable-next-line no-string-literal\r\n\t\t\t\tclone = document[\"createEventObject\"](event);\r\n\t\t\t}\r\n\t\t\treturn clone;\r\n\t\t};\r\n\t\tthis._initDelayedFunctions();\r\n\t\tthis.attach({\r\n\t\t\tselector: config.selector,\r\n\t\t\tglobal: config.global,\r\n\t\t\tonmouseenter:(event: MouseEvent, node: HTMLElement) => {\r\n\t\t\t\tconst html = config.html(event, node);\r\n\t\t\t\tif(html){\r\n\t\t\t\t\tthis.delayShow(cloneDomEvent(event), html);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonmousemove:(event: MouseEvent, node: HTMLElement) => {\r\n\t\t\t\tconst html = config.html(event, node);\r\n\t\t\t\tif(html){\r\n\t\t\t\t\tthis.delayShow(cloneDomEvent(event), html);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.delayShow.$cancelTimeout();\r\n\t\t\t\t\tthis.delayHide();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonmouseleave:() => {\r\n\t\t\t\tthis.delayShow.$cancelTimeout();\r\n\t\t\t\tthis.delayHide();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprivate _initDelayedFunctions(){\r\n\t\tconst gantt = this._gantt;\r\n\t\t// reset delayed functions in order to apply current values of tooltip_timeout\r\n\t\tif(this.delayShow){\r\n\t\t\tthis.delayShow.$cancelTimeout();\r\n\t\t}\r\n\t\tif(this.delayHide){\r\n\t\t\tthis.delayHide.$cancelTimeout();\r\n\t\t}\r\n\t\tthis.tooltip.hide();\r\n\r\n\t\tthis.delayShow = helpers.delay((event: MouseEvent, html: string) => {\r\n\t\t\tif(gantt.callEvent(\"onBeforeTooltip\", [event]) === false) {\r\n\t\t\t\tthis.tooltip.hide();\r\n\t\t\t} else {\r\n\t\t\t\tthis.tooltip.setContent(html);\r\n\t\t\t\tthis.tooltip.show(event);\r\n\t\t\t}\r\n\t\t}, gantt.config.tooltip_timeout || 1);\r\n\r\n\t\tthis.delayHide = helpers.delay(() => {\r\n\t\t\tthis.delayShow.$cancelTimeout();\r\n\t\t\tthis.tooltip.hide();\r\n\t\t}, gantt.config.tooltip_hide_timeout || 1);\r\n\t}\r\n\r\n}","import {TooltipManager} from \"./tooltipManager\";\r\n\r\nexport default function(gantt: any){\r\n\r\ngantt.config.tooltip_timeout = 30;\r\ngantt.config.tooltip_offset_y = 20;\r\ngantt.config.tooltip_offset_x = 10;\r\ngantt.config.tooltip_hide_timeout = 30;\r\n\r\n\r\n\r\nconst tooltipManager = new TooltipManager(gantt);\r\n\r\ngantt.ext.tooltips = tooltipManager;\r\n\r\ngantt.attachEvent(\"onGanttReady\", function(){\r\n\t//GS-2230: in case if `getGanttInstance` created without container\r\n\tif(!gantt.$root) return;\r\n\ttooltipManager.tooltipFor({\r\n\t\tselector: \"[\"+gantt.config.task_attribute+\"]:not(.gantt_task_row)\",\r\n\t\thtml: (event: MouseEvent) => {\r\n\t\t\tif (gantt.config.touch && !gantt.config.touch_tooltip) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst targetTaskId = gantt.locate(event);\r\n\t\t\tif(gantt.isTaskExists(targetTaskId)){\r\n\t\t\t\tconst task = gantt.getTask(targetTaskId);\r\n\t\t\t\treturn gantt.templates.tooltip_text(task.start_date, task.end_date, task);\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\tglobal: false\r\n\t});\r\n});\r\n\r\ngantt.attachEvent(\"onDestroy\", function() {\r\n\ttooltipManager.destructor();\r\n});\r\n\r\ngantt.attachEvent(\"onLightbox\", function() {\r\n\ttooltipManager.hideTooltip();\r\n});\r\nconst isLinkCreate = () => {\r\n\tconst state = gantt.getState();\r\n\treturn !!state.link_source_id;\r\n};\r\ngantt.attachEvent(\"onBeforeTooltip\", function() {\r\n\tif (isLinkCreate()){\r\n\t\treturn false;\r\n\t}\r\n});\r\n\r\ngantt.attachEvent(\"onGanttScroll\", function(){\r\n\ttooltipManager.hideTooltip();\r\n});\r\n\r\n}","import { IInlineEditState, IMonitor, IUndo, IUndoCommand, TActionType, TEntityType, TUndoValue } from \"./types\";\r\n\r\nconst noTrack = {\r\n\tonBeforeUndo: \"onAfterUndo\",\r\n\tonBeforeRedo: \"onAfterRedo\"\r\n};\r\n\r\nconst batchActions = [\r\n\t\"onTaskDragStart\",\r\n\t\"onAfterTaskUpdate\",\r\n\t\"onAfterParentExpand\",\r\n\t\"onAfterTaskDelete\",\r\n\t\"onBeforeBatchUpdate\"\r\n];\r\n\r\nexport class Monitor implements IMonitor {\r\n\tprivate _batchAction = null;\r\n\tprivate _batchMode = false;\r\n\tprivate _ignore = false;\r\n\tprivate _ignoreMoveEvents = false;\r\n\tprivate _initialTasks = {};\r\n\tprivate _initialLinks = {};\r\n\tprivate _nestedTasks =  {};\r\n\tprivate _nestedLinks = {};\r\n\tprivate _timeout;\r\n\tprivate _gantt: any;\r\n\tprivate _undo: IUndo;\r\n\r\n\tconstructor(undo: IUndo, gantt: any) {\r\n\t\tthis._undo = undo;\r\n\t\tthis._gantt = gantt;\r\n\t\tthis._attachEvents();\r\n\t}\r\n\r\n\tstore(id: TaskID | LinkID, type: TEntityType, overwrite: boolean = false) {\r\n\t\tif (type === this._gantt.config.undo_types.task) {\r\n\t\t\treturn this._storeTask(id, overwrite);\r\n\t\t}\r\n\t\tif (type === this._gantt.config.undo_types.link) {\r\n\t\t\treturn this._storeLink(id, overwrite);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tisMoveEventsIgnored() {\r\n\t\treturn this._ignoreMoveEvents;\r\n\t}\r\n\ttoggleIgnoreMoveEvents(newValue?: boolean) {\r\n\t\tthis._ignoreMoveEvents = newValue || false;\r\n\t}\r\n\tstartIgnore() {\r\n\t\tthis._ignore = true;\r\n\t}\r\n\tstopIgnore() {\r\n\t\tthis._ignore = false;\r\n\t}\r\n\tstartBatchAction() {\r\n\t\t// try catching updates made from event handlers using timeout\r\n\t\tif (!this._timeout){\r\n\t\t\tthis._timeout = setTimeout(() => {\r\n\t\t\t\tthis.stopBatchAction();\r\n\t\t\t\tthis._timeout = null;\r\n\t\t\t}, 10);\r\n\t\t}\r\n\r\n\r\n\t\tif (this._ignore || this._batchMode) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._batchMode = true;\r\n\t\tthis._batchAction = this._undo.action.create();\r\n\t}\r\n\tstopBatchAction() {\r\n\t\tif (this._ignore) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst undo = this._undo;\r\n\t\tif (this._batchAction) {\r\n\t\t\tundo.logAction(this._batchAction);\r\n\t\t}\r\n\t\tthis._batchMode = false;\r\n\t\tthis._batchAction = null;\r\n\t}\r\n\tonTaskAdded(task: ITask) {\r\n\t\tif (!this._ignore) {\r\n\t\t\tthis._storeTaskCommand(task, this._undo.command.type.add);\r\n\t\t}\r\n\t}\r\n\tonTaskUpdated(task: ITask) {\r\n\t\tif (!this._ignore) {\r\n\t\t\tthis._storeTaskCommand(task, this._undo.command.type.update);\r\n\t\t}\r\n\t}\r\n\tonTaskMoved(task: ITask) {\r\n\t\tif (!this._ignore) {\r\n\t\t\t(task as any).$local_index = this._gantt.getTaskIndex(task.id);\r\n\t\t\tthis._storeEntityCommand(\r\n\t\t\t\ttask,\r\n\t\t\t\tthis.getInitialTask(task.id),\r\n\t\t\t\tthis._undo.command.type.move,\r\n\t\t\t\tthis._undo.command.entity.task\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\tonTaskDeleted(task: ITask) {\r\n\t\tif (!this._ignore) {\r\n\t\t\tthis._storeTaskCommand(task, this._undo.command.type.remove);\r\n\t\t\tif (this._nestedTasks[task.id]) {\r\n\t\t\t\tconst children = this._nestedTasks[task.id];\r\n\t\t\t\tfor (let i = 0; i < children.length; i++) {\r\n\t\t\t\t\tthis._storeTaskCommand(children[i], this._undo.command.type.remove);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this._nestedLinks[task.id]) {\r\n\t\t\t\tconst childrenLinks = this._nestedLinks[task.id];\r\n\t\t\t\tfor (let i = 0; i < childrenLinks.length; i++) {\r\n\t\t\t\t\tthis._storeLinkCommand(childrenLinks[i], this._undo.command.type.remove);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tonLinkAdded(link: ILink) {\r\n\t\tif (!this._ignore) {\r\n\t\t\tthis._storeLinkCommand(link, this._undo.command.type.add);\r\n\t\t}\r\n\t}\r\n\tonLinkUpdated(link: ILink) {\r\n\t\tif (!this._ignore) {\r\n\t\t\tthis._storeLinkCommand(link, this._undo.command.type.update);\r\n\t\t}\r\n\t}\r\n\tonLinkDeleted(link: ILink) {\r\n\t\tif (!this._ignore) {\r\n\t\t\tthis._storeLinkCommand(link, this._undo.command.type.remove);\r\n\t\t}\r\n\t}\r\n\tsetNestedTasks(id: TaskID, taskIds: TaskID[]) {\r\n\t\tconst gantt = this._gantt;\r\n\t\tlet task = null;\r\n\t\tconst tasks = [];\r\n\t\tlet\tlinkIds = this._getLinks(gantt.getTask(id));\r\n\r\n\t\tfor (let i = 0; i < taskIds.length; i++) {\r\n\t\t\ttask = this.setInitialTask(taskIds[i]);\r\n\t\t\tlinkIds = linkIds.concat(this._getLinks(task));\r\n\t\t\ttasks.push(task);\r\n\t\t}\r\n\r\n\t\tconst uniqueLinks = {};\r\n\t\tfor (let i = 0; i < linkIds.length; i++) {\r\n\t\t\tuniqueLinks[linkIds[i]] = true;\r\n\t\t}\r\n\t\tconst links = [];\r\n\t\tfor (const i in uniqueLinks) {\r\n\t\t\tlinks.push(this.setInitialLink(i));\r\n\t\t}\r\n\t\tthis._nestedTasks[id] = tasks;\r\n\t\tthis._nestedLinks[id] = links;\r\n\t}\r\n\tsetInitialTask(id: TaskID, overwrite?: boolean) {\r\n\t\tconst gantt = this._gantt;\r\n\t\tif (overwrite || (!this._initialTasks[id] || !this._batchMode)) {\r\n\t\t\tconst task = gantt.copy(gantt.getTask(id));\r\n\t\t\ttask.$index = gantt.getGlobalTaskIndex(id);\r\n\t\t\ttask.$local_index = gantt.getTaskIndex(id);\r\n\t\t\tthis.setInitialTaskObject(id, task);\r\n\t\t}\r\n\t\treturn this._initialTasks[id];\r\n\t}\r\n\tgetInitialTask(id: TaskID) {\r\n\t\treturn this._initialTasks[id];\r\n\t}\r\n\tclearInitialTasks() {\r\n\t\tthis._initialTasks = {};\r\n\t}\r\n\tsetInitialTaskObject(id: TaskID, object: ITask) {\r\n\t\tthis._initialTasks[id] = object;\r\n\t}\r\n\tsetInitialLink(id: LinkID, overwrite?: boolean) {\r\n\t\tif (!this._initialLinks[id] || !this._batchMode) {\r\n\t\t\tthis._initialLinks[id] = this._gantt.copy(this._gantt.getLink(id));\r\n\t\t}\r\n\t\treturn this._initialLinks[id];\r\n\t}\r\n\tgetInitialLink(id: LinkID) {\r\n\t\treturn this._initialLinks[id];\r\n\t}\r\n\tclearInitialLinks() {\r\n\t\tthis._initialLinks = {};\r\n\t}\r\n\tprivate _attachEvents() {\r\n\t\tlet deleteCacheCooldown = null;\r\n\t\tconst gantt = this._gantt;\r\n\r\n\t\tconst saveInitialAll = () => {\r\n\t\t\tif (!deleteCacheCooldown) {\r\n\t\t\t\tdeleteCacheCooldown = setTimeout(() => {\r\n\t\t\t\t\tdeleteCacheCooldown = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.clearInitialTasks();\r\n\t\t\t\tgantt.eachTask((task: ITask) => {\r\n\t\t\t\t\tthis.setInitialTask(task.id);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.clearInitialLinks();\r\n\t\t\t\tgantt.getLinks().forEach((link: ILink) => {\r\n\t\t\t\t\tthis.setInitialLink(link.id);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t\tconst getMoveObjectByTaskId = (id: TaskID) => {\r\n\t\t\treturn gantt.copy(gantt.getTask(id));\r\n\t\t};\r\n\r\n\t\tfor (const i in noTrack) {\r\n\t\t\tgantt.attachEvent(i, () => {\r\n\t\t\t\tthis.startIgnore();\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t\tgantt.attachEvent(noTrack[i], () => {\r\n\t\t\t\tthis.stopIgnore();\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfor (let i  = 0; i < batchActions.length; i++) {\r\n\t\t\tgantt.attachEvent(batchActions[i], () => {\r\n\t\t\t\tthis.startBatchAction();\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tgantt.attachEvent(\"onParse\", () => {\r\n\t\t\tthis._undo.clearUndoStack();\r\n\t\t\tthis._undo.clearRedoStack();\r\n\t\t\tsaveInitialAll();\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterTaskAdd\", (id: TaskID, task: ITask) => {\r\n\t\t\tthis.setInitialTask(id, true);\r\n\t\t\tthis.onTaskAdded(task);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterTaskUpdate\", (id: TaskID, task: ITask) => {\r\n\t\t\tthis.onTaskUpdated(task);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterParentExpand\", (id: TaskID, task: ITask) => {\r\n\t\t\tthis.onTaskUpdated(task);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterTaskDelete\", (id: TaskID, task: ITask) => {\r\n\t\t\tthis.onTaskDeleted(task);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterLinkAdd\", (id: LinkID, link: ILink) => {\r\n\t\t\tthis.setInitialLink(id, true);\r\n\t\t\tthis.onLinkAdded(link);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterLinkUpdate\", (id: LinkID, link: ILink) => {\r\n\t\t\tthis.onLinkUpdated(link);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterLinkDelete\", (id: LinkID, link: ILink) => {\r\n\t\t\tthis.onLinkDeleted(link);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onRowDragEnd\", (id: TaskID, target: TaskID) => {\r\n\t\t\tthis.onTaskMoved(getMoveObjectByTaskId(id));\r\n\t\t\tthis.toggleIgnoreMoveEvents();\r\n\t\t\treturn true;\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onBeforeTaskDelete\", (id: TaskID) => {\r\n\t\t\tthis.store(id, gantt.config.undo_types.task);\r\n\t\t\tconst nested = [];\r\n\r\n\t\t\t// remember task indexes in case their being deleted in a loop, so they could be restored in the correct order\r\n\t\t\tsaveInitialAll();\r\n\r\n\t\t\tgantt.eachTask((task: ITask) => {\r\n\t\t\t\tnested.push(task.id);\r\n\t\t\t}, id);\r\n\t\t\tthis.setNestedTasks(id, nested);\r\n\t\t\treturn true;\r\n\t\t});\r\n\t\tconst datastore = gantt.getDatastore(\"task\");\r\n\r\n\t\tdatastore.attachEvent(\"onBeforeItemMove\", (id: TaskID, parent: TaskID, tindex: number) => {\r\n\t\t\tif (!this.isMoveEventsIgnored()) {\r\n\t\t\t\tsaveInitialAll();\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tdatastore.attachEvent(\"onAfterItemMove\", (id: TaskID, parent: TaskID, tindex: number) => {\r\n\t\t\tif (!this.isMoveEventsIgnored()) {\r\n\t\t\t\tthis.onTaskMoved(getMoveObjectByTaskId(id));\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onRowDragStart\", (id: TaskID, target: TaskID, e: Event) => {\r\n\t\t\tthis.toggleIgnoreMoveEvents(true);\r\n\t\t\tsaveInitialAll();\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tlet dragId = null;\r\n\t\tlet projectDrag = false;\r\n\t\tgantt.attachEvent(\"onBeforeTaskDrag\", (taskId: TaskID) => {\r\n\t\t\tdragId = gantt.getState().drag_id;\r\n\t\t\tif (dragId === taskId){\r\n\t\t\t\tconst task = gantt.getTask(taskId);\r\n\t\t\t\tif (gantt.isSummaryTask(task) && gantt.config.drag_project){\r\n\t\t\t\t\tprojectDrag = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// GS-99. Store the initial task dates before multiple drag\r\n\t\t\tif (gantt.plugins().multiselect){\r\n\t\t\t\tconst selectedIds = gantt.getSelectedTasks();\r\n\t\t\t\tif (selectedIds.length > 1){\r\n\t\t\t\t\tselectedIds.forEach((id)=>{\r\n\t\t\t\t\t\tthis.store(id, gantt.config.undo_types.task, true);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this.store(taskId, gantt.config.undo_types.task);\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onAfterTaskDrag\", (taskId: TaskID) => {\r\n\t\t\t// if we drag multiple tasks and other tasks move to another date after that,\r\n\t\t\t// auto-scheduling/correct work time should occur in anoher command.\r\n\t\t\t// otherwise, when we undo the changes, the task constraint is not restored correctly\r\n\t\t\tconst multipleDrag = projectDrag || (gantt.plugins().multiselect && gantt.getSelectedTasks().length > 1);\r\n\t\t\tif (multipleDrag && dragId === taskId){\r\n\t\t\t\tprojectDrag = false;\r\n\t\t\t\tdragId = null;\r\n\t\t\t\tthis.stopBatchAction();\r\n\t\t\t}\r\n\t\t\t// GS-99. When dragging multiple tasks, we need to store the initial tasks\r\n\t\t\tthis.store(taskId, gantt.config.undo_types.task, true);\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onLightbox\", (taskId: TaskID) => this.store(taskId, gantt.config.undo_types.task));\r\n\r\n\t\tgantt.attachEvent(\"onBeforeTaskAutoSchedule\", (task: ITask) => {\r\n\t\t\tthis.store(task.id, gantt.config.undo_types.task, true);\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tif (gantt.ext.inlineEditors) {\r\n\t\t\t// remove the onGanttLayoutReady wrapper when GS-1288 is merged\r\n\t\t\tlet onBeforeEditStartId = null;\r\n\t\t\tlet onEditStart = null;\r\n\t\t\tgantt.attachEvent(\"onGanttLayoutReady\", () => {\r\n\t\t\t\tif (onBeforeEditStartId) {\r\n\t\t\t\t\tgantt.ext.inlineEditors.detachEvent(onBeforeEditStartId);\r\n\t\t\t\t}\r\n\t\t\t\tif (onEditStart) {\r\n\t\t\t\t\tgantt.ext.inlineEditors.detachEvent(onEditStart);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tonEditStart = gantt.ext.inlineEditors.attachEvent(\"onEditStart\", (state: IInlineEditState) => {\r\n\t\t\t\t\t// GS-2598: skip saving changes of resource lightbox grid\r\n\t\t\t\t\tif(gantt.$data.tempAssignmentsStore && gantt._lightbox_id){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.store(state.id, gantt.config.undo_types.task);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// GS-99. If another inline editor is opened and we open a new inline editor,\r\n\t\t\t\t// we shouldn't use the batchAction\r\n\t\t\t\tonBeforeEditStartId = gantt.ext.inlineEditors.attachEvent(\"onBeforeEditStart\", (state: IInlineEditState) => {\r\n\t\t\t\t\tthis.stopBatchAction();\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _storeCommand(command: IUndoCommand) {\r\n\t\tconst undo = this._undo;\r\n\t\tundo.updateConfigs();\r\n\r\n\t\tif (!undo.undoEnabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this._batchMode) {\r\n\t\t\tthis._batchAction.commands.push(command);\r\n\t\t} else {\r\n\t\t\tconst action = undo.action.create([command]);\r\n\t\t\tundo.logAction(action);\r\n\t\t}\r\n\t}\r\n\tprivate _storeEntityCommand(obj: TUndoValue, old: TUndoValue, actionType: TActionType, entityType: TEntityType) {\r\n\t\tconst undo = this._undo;\r\n\t\tconst command = undo.command.create(obj, old, actionType, entityType);\r\n\t\tthis._storeCommand(command);\r\n\t}\r\n\tprivate _storeTaskCommand(obj: ITask, type: TActionType) {\r\n\t\tif(this._gantt.isTaskExists(obj.id)){\r\n\t\t\t(obj as any).$local_index = this._gantt.getTaskIndex(obj.id);\r\n\t\t}\r\n\r\n\t\tthis._storeEntityCommand(obj, this.getInitialTask(obj.id), type, this._undo.command.entity.task);\r\n\t}\r\n\tprivate _storeLinkCommand(obj: ILink, type: TActionType) {\r\n\t\tthis._storeEntityCommand(obj, this.getInitialLink(obj.id), type, this._undo.command.entity.link);\r\n\t}\r\n\tprivate _getLinks(task: ITask) {\r\n\t\treturn task.$source.concat(task.$target);\r\n\t}\r\n\tprivate _storeTask(taskId: TaskID, overwrite: boolean = false) {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis.setInitialTask(taskId, overwrite);\r\n\t\tgantt.eachTask((child: ITask) => {\r\n\t\t\tthis.setInitialTask(child.id);\r\n\t\t}, taskId);\r\n\t\treturn true;\r\n\t}\r\n\tprivate _storeLink(linkId: LinkID, overwrite: boolean = false) {\r\n\t\tthis.setInitialLink(linkId, overwrite);\r\n\t\treturn true;\r\n\t}\r\n}","import { IUndo, IUndoCommand, IUndoCommands, IUndoPropAction, IUndoPropCommand, TActionType, TEntityType, TUndoStack, TUndoValue } from \"./types\";\r\n\r\nconst MAX_UNDO_STEPS = 100;\r\n\r\nexport class Undo implements IUndo {\r\n\r\n\tmaxSteps = MAX_UNDO_STEPS;\r\n\tundoEnabled = true;\r\n\tredoEnabled = true;\r\n\taction: IUndoPropAction = {\r\n\t\tcreate: (commands?: IUndoCommand[]): IUndoCommands => {\r\n\t\t\treturn { commands: (commands ? commands.slice() : []) };\r\n\t\t},\r\n\t\tinvert: (action: IUndoCommands): IUndoCommands => {\r\n\t\t\tconst gantt = this._gantt;\r\n\t\t\tconst revert = gantt.copy(action);\r\n\t\t\tconst commands = this.command;\r\n\t\t\tfor (let i = 0; i < action.commands.length; i++) {\r\n\t\t\t\tconst command = revert.commands[i] = commands.invert(revert.commands[i]);\r\n\t\t\t\tif (command.type === commands.type.update || command.type === commands.type.move) {\r\n\t\t\t\t\t[command.value, command.oldValue] = [command.oldValue, command.value];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn revert as IUndoCommands;\r\n\t\t}\r\n\t};\r\n\tcommand: IUndoPropCommand = {\r\n\t\t// entities that require different processing for undoing-redoing changes (gantt.config.undo_types)\r\n\t\tentity: null,\r\n\r\n\t\t// types of traced actions (gantt.config.undo_actions)\r\n\t\ttype: null,\r\n\r\n\t\tcreate: (value: TUndoValue, oldValue: TUndoValue, type: TActionType, entity: TEntityType): IUndoCommand => {\r\n\t\t\tconst gantt = this._gantt;\r\n\t\t\treturn {\r\n\t\t\t\tentity,\r\n\t\t\t\ttype,\r\n\t\t\t\tvalue: gantt.copy(value),\r\n\t\t\t\toldValue: gantt.copy(oldValue || value)\r\n\t\t\t};\r\n\t\t},\r\n\t\tinvert: (command: IUndoCommand): IUndoCommand => {\r\n\t\t\tconst gantt = this._gantt;\r\n\t\t\tconst revert = gantt.copy(command);\r\n\t\t\trevert.type = this.command.inverseCommands(command.type);\r\n\t\t\treturn revert;\r\n\t\t},\r\n\t\tinverseCommands: (command: TActionType): TActionType => {\r\n\t\t\tconst gantt = this._gantt;\r\n\t\t\tconst types = this.command.type;\r\n\t\t\tswitch (command) {\r\n\t\t\t\tcase types.update:\r\n\t\t\t\t\treturn types.update;\r\n\t\t\t\tcase types.remove:\r\n\t\t\t\t\treturn types.add;\r\n\t\t\t\tcase types.add:\r\n\t\t\t\t\treturn types.remove;\r\n\t\t\t\tcase types.move:\r\n\t\t\t\t\treturn types.move;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tgantt.assert(false, \"Invalid command \"+ command);\r\n\t\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tprivate _undoStack = [];\r\n\tprivate _redoStack = [];\r\n\tprivate _gantt: any;\r\n\r\n\tconstructor(gantt: any){\r\n\t\tthis._gantt = gantt;\r\n\t}\r\n\tgetUndoStack() {\r\n\t\treturn this._undoStack;\r\n\t}\r\n\tsetUndoStack(stack: []) {\r\n\t\tthis._undoStack = stack;\r\n\t}\r\n\r\n\tgetRedoStack() {\r\n\t\treturn this._redoStack;\r\n\t}\r\n\tsetRedoStack(stack: []) {\r\n\t\tthis._redoStack = stack;\r\n\t}\r\n\r\n\tclearUndoStack() {\r\n\t\tthis._undoStack = [];\r\n\t}\r\n\r\n\tclearRedoStack() {\r\n\t\tthis._redoStack = [];\r\n\t}\r\n\r\n\tupdateConfigs() {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis.maxSteps = gantt.config.undo_steps || MAX_UNDO_STEPS;\r\n\t\tthis.command.entity = gantt.config.undo_types;\r\n\t\tthis.command.type = gantt.config.undo_actions;\r\n\t\tthis.undoEnabled = !!gantt.config.undo;\r\n\t\tthis.redoEnabled = !!gantt.config.redo; // GS-873, Redo should work even when the `gantt.config.undo` is disabled.\r\n\t}\r\n\r\n\tundo() {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis.updateConfigs();\r\n\t\tif (!this.undoEnabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst action = this._pop(this._undoStack);\r\n\t\tif (action) {\r\n\t\t\tthis._reorderCommands(action);\r\n\t\t}\r\n\t\tif (gantt.callEvent(\"onBeforeUndo\", [action]) !== false) {\r\n\t\t\tif (action) {\r\n\t\t\t\tthis._applyAction(this.action.invert(action));\r\n\t\t\t\tthis._push(this._redoStack, gantt.copy(action));\r\n\t\t\t\tgantt.callEvent(\"onAfterUndo\", [action]);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tgantt.callEvent(\"onAfterUndo\", [null]);\r\n\t}\r\n\r\n\tredo() {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis.updateConfigs();\r\n\t\tif (!this.redoEnabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst action = this._pop(this._redoStack);\r\n\t\tif (action) {\r\n\t\t\tthis._reorderCommands(action);\r\n\t\t}\r\n\r\n\t\tif (gantt.callEvent(\"onBeforeRedo\", [action]) !== false) {\r\n\t\t\tif (action) {\r\n\t\t\t\tthis._applyAction(action);\r\n\t\t\t\tthis._push(this._undoStack, gantt.copy(action));\r\n\t\t\t\tgantt.callEvent(\"onAfterRedo\", [action]);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tgantt.callEvent(\"onAfterRedo\", [null]);\r\n\t}\r\n\r\n\t// storeUndo:\r\n\tlogAction(action: IUndoCommands) {\r\n\t\tthis._push(this._undoStack, action);\r\n\t\tthis._redoStack = [];\r\n\t}\r\n\r\n\tprivate _push(stack: TUndoStack, action: IUndoCommands): IUndoCommands {\r\n\t\tconst gantt = this._gantt;\r\n\t\tif (!action.commands.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst event = stack === this._undoStack ? \"onBeforeUndoStack\" : \"onBeforeRedoStack\";\r\n\t\tif (gantt.callEvent(event, [action]) === false){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// commands can be removed from event handler\r\n\t\tif (!action.commands.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tstack.push(action);\r\n\t\twhile (stack.length > this.maxSteps) {\r\n\t\t\tstack.shift();\r\n\t\t}\r\n\t\treturn action;\r\n\t}\r\n\r\n\tprivate _pop(stack: TUndoStack): IUndoCommands {\r\n\t\treturn stack.pop();\r\n\t}\r\n\r\n\tprivate _reorderCommands(action) {\r\n\t\t// firstly process tasks and only then links\r\n\t\t// in order to ensure links are added not earlier than their tasks\r\n\t\t// firstly to 'move' actions and only then updates\r\n\t\tconst weights = { any: 0, link:1, task:2 };\r\n\t\tconst actionWeights = { move: 1, any:0 };\r\n\t\taction.commands.sort(function(a, b) {\r\n\t\t\tif (a.entity === \"task\" && b.entity === \"task\") {\r\n\t\t\t\tif (a.type !== b.type) {\r\n\t\t\t\t\treturn (actionWeights[b.type] || 0) - (actionWeights[a.type] || 0);\r\n\t\t\t\t} else if (a.type === \"move\" && a.oldValue && b.oldValue && b.oldValue.parent === a.oldValue.parent) {\r\n\t\t\t\t\treturn a.oldValue.$index - b.oldValue.$index;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst weightA = weights[a.entity] || weights.any;\r\n\t\t\t\tconst weightB = weights[b.entity] || weights.any;\r\n\t\t\t\treturn weightB - weightA;\r\n\t\t\t}\r\n\r\n\t\t});\r\n\t}\r\n\r\n\tprivate _applyAction(action: IUndoCommands) {\r\n\t\tlet command = null;\r\n\t\tconst entities = this.command.entity;\r\n\t\tconst actions = this.command.type;\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst methods = {};\r\n\t\tmethods[entities.task] = {\r\n\t\t\tadd: \"addTask\",\r\n\t\t\tget: \"getTask\",\r\n\t\t\tupdate: \"updateTask\",\r\n\t\t\tremove: \"deleteTask\",\r\n\t\t\tmove: \"moveTask\",\r\n\t\t\tisExists: \"isTaskExists\"\r\n\t\t};\r\n\t\tmethods[entities.link] = {\r\n\t\t\tadd: \"addLink\",\r\n\t\t\tget: \"getLink\",\r\n\t\t\tupdate: \"updateLink\",\r\n\t\t\tremove: \"deleteLink\",\r\n\t\t\tisExists: \"isLinkExists\"\r\n\t\t};\r\n\r\n\t\tgantt.batchUpdate(function() {\r\n\t\t\t// it is logical to undo actions from the last one to the first one\r\n\t\t\t// but we have to do it from the first one because the order\r\n\t\t\t// of tasks ($index and $local_index) depends on the existing tasks\r\n\t\t\tfor (let i = 0; i < action.commands.length; i++) {\r\n\t\t\t\tcommand = action.commands[i];\r\n\t\t\t\tconst method = methods[command.entity][command.type];\r\n\t\t\t\tconst getMethod = methods[command.entity].get;\r\n\t\t\t\tconst check = methods[command.entity].isExists;\r\n\r\n\t\t\t\tif (command.type === actions.add) {\r\n\t\t\t\t\tgantt[method](command.oldValue, command.oldValue.parent, command.oldValue.$local_index);\r\n\t\t\t\t} else if (command.type === actions.remove) {\r\n\t\t\t\t\tif (gantt[check](command.value.id)) {\r\n\t\t\t\t\t\tgantt[method](command.value.id);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command.type === actions.update) {\r\n\t\t\t\t\tconst item = gantt[getMethod](command.value.id);\r\n\t\t\t\t\tfor(const prop in command.value){\r\n\t\t\t\t\t\tconst internalProperty = prop.startsWith(\"$\") || prop.startsWith(\"_\");\r\n\t\t\t\t\t\tconst whitelist = [\"$open\"];\r\n\t\t\t\t\t\tlet copyProperty = !internalProperty;\r\n\t\t\t\t\t\tif (whitelist.indexOf(prop) > -1){\r\n\t\t\t\t\t\t\tcopyProperty = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(copyProperty){\r\n\t\t\t\t\t\t\titem[prop] = command.value[prop];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tgantt[method](command.value.id);\r\n\t\t\t\t} else if (command.type === actions.move) {\r\n\t\t\t\t\tgantt[method](command.value.id, command.value.$local_index, command.value.parent);\r\n\t\t\t\t\t// GS-680: We should send the changes to the server after we undo vertical reorder\r\n\t\t\t\t\tgantt.callEvent(\"onRowDragEnd\", [command.value.id]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}","import { Monitor } from \"./monitor\";\r\nimport { IMonitor, IUndoCommand, TEntityType, TUndoStack } from \"./types\";\r\nimport { Undo } from \"./undo\";\r\n\r\nexport default function(gantt: any){\r\n\r\nconst _undo = new Undo(gantt);\r\nconst monitor: IMonitor = new Monitor(_undo, gantt);\r\n\r\ngantt.config.undo = true;\r\ngantt.config.redo = true;\r\n\r\n/**\r\n * entities that require different processing for undoing-redoing changes\r\n * @type {{link: string, task: string}}\r\n */\r\ngantt.config.undo_types = {\r\n\tlink: \"link\",\r\n\ttask: \"task\"\r\n};\r\n\r\n/**\r\n * types of traced actions\r\n * @type {{update: string, remove: string, add: string}}\r\n */\r\ngantt.config.undo_actions = {\r\n\tupdate: \"update\",\r\n\tremove: \"remove\", // remove item from datastore\r\n\tadd: \"add\",\r\n\tmove: \"move\" // move task in grid\r\n};\r\n\r\nif (!gantt.ext) {\r\n\tgantt.ext = {};\r\n}\r\n\r\ngantt.ext.undo = {\r\n\tundo: () => _undo.undo(),\r\n\tredo: () => _undo.redo(),\r\n\tgetUndoStack: () => _undo.getUndoStack(),\r\n\tsetUndoStack: (stack:[]) => _undo.setUndoStack(stack),\r\n\tgetRedoStack: () => _undo.getRedoStack(),\r\n\tsetRedoStack: (stack:[]) => _undo.setRedoStack(stack),\r\n\tclearUndoStack: () => _undo.clearUndoStack(),\r\n\tclearRedoStack: () => _undo.clearRedoStack(),\r\n\tsaveState: (id: TaskID | LinkID, type: TEntityType) => monitor.store(id, type, true),\r\n\tgetInitialState: (id: TaskID | LinkID, type: TEntityType) => {\r\n\t\tif(type === gantt.config.undo_types.link){\r\n\t\t\treturn monitor.getInitialLink(id);\r\n\t\t}else{\r\n\t\t\treturn monitor.getInitialTask(id);\r\n\t\t}\r\n\t}\r\n};\r\n\r\ngantt.undo = gantt.ext.undo.undo;\r\ngantt.redo = gantt.ext.undo.redo;\r\ngantt.getUndoStack = gantt.ext.undo.getUndoStack;\r\ngantt.getRedoStack = gantt.ext.undo.getRedoStack;\r\ngantt.clearUndoStack = gantt.ext.undo.clearUndoStack;\r\ngantt.clearRedoStack = gantt.ext.undo.clearRedoStack;\r\n\r\nfunction isEqualIds(first: TaskID, second: TaskID){\r\n\treturn String(first) === String(second);\r\n};\r\n\r\nfunction updTask(task: ITask, oldId: TaskID, newId: TaskID) {\r\n\tif (!task) { return; }\r\n\r\n\tif (isEqualIds(task.id, oldId)) {\r\n\t\ttask.id = newId;\r\n\t}\r\n\r\n\tif (isEqualIds(task.parent, oldId)) {\r\n\t\ttask.parent = newId;\r\n\t}\r\n}\r\n\r\nfunction changeTaskCommandId(command: IUndoCommand, oldId: TaskID, newId: TaskID) {\r\n\tupdTask(command.value, oldId, newId);\r\n\tupdTask(command.oldValue, oldId, newId);\r\n}\r\n\r\nfunction updLink(link: ILink, oldTaskId: TaskID, newTaskId: TaskID) {\r\n\tif (!link) { return; }\r\n\tif (isEqualIds(link.source, oldTaskId)) {\r\n\t\tlink.source = newTaskId;\r\n\t}\r\n\tif (isEqualIds(link.target, oldTaskId)) {\r\n\t\tlink.target = newTaskId;\r\n\t}\r\n}\r\n\r\nfunction changeLinkCommandId(command: IUndoCommand, oldId: LinkID, newId: LinkID) {\r\n\tupdLink(command.value, oldId, newId);\r\n\tupdLink(command.oldValue, oldId, newId);\r\n}\r\n\r\nfunction updateTasksIds(log: TUndoStack, oldId: TaskID, newId: TaskID) {\r\n\tconst undo = _undo;\r\n\r\n\tfor (let i = 0; i < log.length; i++) {\r\n\t\tconst entry = log[i];\r\n\t\tfor (let j = 0; j < entry.commands.length; j++) {\r\n\t\t\tif (entry.commands[j].entity === undo.command.entity.task) {\r\n\t\t\t\tchangeTaskCommandId(entry.commands[j], oldId, newId);\r\n\t\t\t} else if (entry.commands[j].entity === undo.command.entity.link) {\r\n\t\t\t\tchangeLinkCommandId(entry.commands[j], oldId, newId);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction updateLinksIds(log: TUndoStack, oldId: LinkID, newId: LinkID) {\r\n\tconst undo = _undo;\r\n\r\n\tfor (let i = 0; i < log.length; i++) {\r\n\t\tconst entry = log[i];\r\n\t\tfor (let j = 0; j < entry.commands.length; j++) {\r\n\t\t\tconst command = entry.commands[j];\r\n\t\t\tif (command.entity === undo.command.entity.link) {\r\n\t\t\t\tif (command.value && command.value.id === oldId) {\r\n\t\t\t\t\tcommand.value.id = newId;\r\n\t\t\t\t}\r\n\t\t\t\tif (command.oldValue && command.oldValue.id === oldId) {\r\n\t\t\t\t\tcommand.oldValue.id = newId;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\ngantt.attachEvent(\"onTaskIdChange\", (oldId: TaskID, newId: TaskID) => {\r\n\tconst undo = _undo;\r\n\tupdateTasksIds(undo.getUndoStack(), oldId, newId);\r\n\tupdateTasksIds(undo.getRedoStack(), oldId, newId);\r\n});\r\n\r\ngantt.attachEvent(\"onLinkIdChange\", (oldId: LinkID, newId: LinkID) => {\r\n\tconst undo = _undo;\r\n\tupdateLinksIds(undo.getUndoStack(), oldId, newId);\r\n\tupdateLinksIds(undo.getRedoStack(), oldId, newId);\r\n});\r\n\r\ngantt.attachEvent(\"onGanttReady\", () => {\r\n\t_undo.updateConfigs();\r\n});\r\n\r\n}","\r\nimport click_drag from \"./click_drag\";\r\nimport drag_timeline from \"./drag_timeline\";\r\nimport export_api from \"./export_api\";\r\nimport fullscreen from \"./fullscreen\";\r\nimport keyboard_navigation from \"./keyboard_navigation\";\r\nimport marker from \"./marker\";\r\nimport multiselect from \"./multiselect\";\r\nimport quick_info from \"./quick_info\";\r\nimport tooltip from \"./tooltip\";\r\nimport undo from \"./undo\";\r\n\r\nexport default {\r\n\tclick_drag,\r\n\tdrag_timeline,\r\n\tfullscreen,\r\n\tkeyboard_navigation,\r\n\tquick_info,\r\n\ttooltip,\r\n\tundo,\r\n\tmarker,\r\n\tmultiselect,\r\n\texport_api\r\n};","export default {\r\n\tKEY_CODES: {\r\n\t\tUP: 38,\r\n\t\tDOWN: 40,\r\n\t\tLEFT: 37,\r\n\t\tRIGHT: 39,\r\n\t\tSPACE: 32,\r\n\t\tENTER: 13,\r\n\t\tDELETE: 46,\r\n\t\tESC: 27,\r\n\t\tTAB: 9\r\n\t}\r\n};","export default class ExtensionsManager{\r\n\tprivate _extensions:{[key:string]: GanttPlugin };\r\n\r\n\tconstructor(config: {[key:string]: GanttPlugin }){\r\n\t\tthis._extensions = {};\r\n\t\tfor(const i in config){\r\n\t\t\tthis._extensions[i] = config[i];\r\n\t\t}\r\n\t}\r\n\r\n\taddExtension = (name: string, ext: GanttPlugin) => {\r\n\t\tthis._extensions[name] = ext;\r\n\t};\r\n\r\n\tgetExtension = (name: string): GanttPlugin => {\r\n\t\treturn this._extensions[name];\r\n\t};\r\n}","export default function(){\r\n\tvar services = {};\r\n\tfunction register (name, getter){\r\n\t\tservices[name] = getter;\r\n\t}\r\n\r\n\tfunction getService(name){\r\n\t\tif(!services[name]){\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn services[name]();\r\n\t}\r\n\r\n\tfunction dropService(name) {\r\n\t\tif (services[name]) {\r\n\t\t\tdelete services[name];\r\n\t\t}\r\n\t}\r\n\r\n\tvar servicesEnum = {};\r\n\r\n\treturn {\r\n\t\tservices: servicesEnum,\r\n\t\tsetService: register,\r\n\t\tgetService: getService,\r\n\t\tdropService: dropService,\r\n\t\tdestructor: function(){\r\n\t\t\tfor(var i in services){\r\n\t\t\t\tif(services[i]){\r\n\t\t\t\t\tvar service = services[i];\r\n\t\t\t\t\tif(service && service.destructor){\r\n\t\t\t\t\t\tservice.destructor();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tservices = null;\r\n\t\t}\r\n\t};\r\n};\r\n","type DurationUnits = \"minute\" | \"hour\" | \"day\" | \"week\" | \"month\" | \"year\";\r\ntype Align = \"left\" | \"center\" | \"right\";\r\ntype SectionType = \"textarea\"\r\n\t\t\t\t\t| \"time\"\r\n\t\t\t\t\t| \"duration\"\r\n\t\t\t\t\t| \"select\"\r\n\t\t\t\t\t| \"typeselect\"\r\n\t\t\t\t\t| \"parent\"\r\n\t\t\t\t\t| \"template\"\r\n\t\t\t\t\t| \"checkbox\"\r\n\t\t\t\t\t| \"radio\"\r\n\t\t\t\t\t| \"resources\"\r\n\t\t\t\t\t| \"constraint\";\r\n\r\ntype LightboxSection = Array<ILightboxSection\r\n\t| ILightboxTimeAndDurationSection\r\n\t| ILightboxInputControl\r\n\t| ILightboxSelectControl\r\n\t| ILightboxParentControl\r\n\t| ILightboxTypeselectControl>;\r\n\r\ntype LayoutView = \"grid\"\r\n\t| \"timeline\"\r\n\t| \"resizer\"\r\n\t| \"scrollbar\"\r\n\t| \"resourceGrid\"\r\n\t| \"resourceTimeline\";\r\n\r\ninterface IColumnItem {\r\n\tname: string;\r\n\tlabel?: string;\r\n\ttree?: boolean;\r\n\talign?: Align;\r\n\thide?: boolean;\r\n\tmax_width?: number;\r\n\tmin_width?: number;\r\n\tresize?: boolean;\r\n\ttemplate?: (obj: any) => string;\r\n\twidth?: number | \"*\";\r\n}\r\n\r\nexport type TModifierKeys = \"metaKey\" | \"ctrlKey\" | \"altKey\" | \"shiftKey\" | false | undefined;\r\n\r\nexport interface IScale {\r\n\tcss?: () => string;\r\n\tdate?: string;\r\n\tstep: number;\r\n\ttemplate?: (date: Date) => string;\r\n\tunit: DurationUnits;\r\n}\r\n\r\ninterface ILightboxSection {\r\n\tname: string;\r\n\tmap_to: string;\r\n\ttype: SectionType;\r\n\theight?: number;\r\n\tfocus?: boolean;\r\n}\r\n\r\ninterface ILightboxTimeAndDurationSection extends ILightboxSection {\r\n\treadonly: boolean;\r\n\tyear_range: number[] | number;\r\n\tsingle_date: boolean;\r\n\ttime_format: string;\r\n}\r\n\r\ninterface ILightboxInputControl extends ILightboxSection {\r\n\tdefault_value?: any;\r\n\toptions?: Array<{key: string, label: string}>;\r\n}\r\n\r\ninterface ILightboxSelectControl extends ILightboxInputControl {\r\n\tonchange: () => boolean | undefined;\r\n}\r\n\r\ninterface ILightboxParentControl extends ILightboxSection {\r\n\tallow_root: boolean;\r\n\troot_label: string;\r\n\tsort?: (a: any, b: any) => -1 | 0 | 1;\r\n\tfilter?: (task: string | number | object) => boolean;\r\n\ttemplate?: (start: Date, end: Date, ev: object) => string;\r\n}\r\n\r\ninterface ILightboxTypeselectControl extends ILightboxSection {\r\n\tfilter?: (typeName: string) => boolean;\r\n}\r\n\r\n\r\ninterface ILayoutScrollbar {\r\n\tview: \"scrollbar\";\r\n\tscroll?: \"x\" | \"y\";\r\n\tid: string;\r\n\theight?: number;\r\n\twidth?: number;\r\n}\r\n\r\ninterface ILayoutView {\r\n\tview: LayoutView;\r\n\tid?: string;\r\n\tscrollX?: string;\r\n\tscrollY?: string;\r\n\tconfig?: object;\r\n}\r\n\r\ninterface ILayoutGrid extends ILayoutView {\r\n\tview: \"grid\";\r\n\tbind?: string;\r\n}\r\n\r\ninterface ILayoutTimeline extends ILayoutView {\r\n\tview: \"timeline\";\r\n\tbindLinks?: string;\r\n\tlayers?: any[];\r\n}\r\n\r\ninterface ILayoutResizer {\r\n\tview?: undefined;\r\n\tresizer: boolean;\r\n\twidth: number;\r\n}\r\n\r\ninterface ILayoutResourceGrid extends ILayoutView {\r\n\tview: \"resourceGrid\";\r\n\twidth: number;\r\n\tgroup: \"string\";\r\n}\r\n\r\ninterface ILayoutResourceTimeline extends ILayoutView {\r\n\tview: \"resourceTimeline\";\r\n\twidth: number;\r\n\tgroup: \"string\";\r\n}\r\n\r\ninterface ILayoutHtml {\r\n\thtml: string;\r\n\tcss: string;\r\n\twidth: number;\r\n}\r\n\r\ntype LayoutRow = ILayoutGrid\r\n\t| ILayoutTimeline\r\n\t| ILayoutResizer\r\n\t| ILayoutResourceGrid\r\n\t| ILayoutResourceTimeline\r\n\t| ILayoutHtml\r\n\t| ILayoutScrollbar\r\n\t| { cols: LayoutCol[] };\r\n\r\ntype LayoutCol = ILayoutGrid\r\n\t| ILayoutTimeline\r\n\t| ILayoutResizer\r\n\t| ILayoutResourceGrid\r\n\t| ILayoutResourceTimeline\r\n\t| ILayoutHtml\r\n\t| ILayoutScrollbar\r\n\t| { rows: LayoutRow[] };\r\n\r\ninterface ILayout {\r\n\tcss: string;\r\n\trows?: LayoutRow[];\r\n\tcols?: LayoutCol[];\r\n}\r\n\r\ntype TCsp = boolean | \"auto\";\r\n\r\ninterface IResourceConfig {\r\n\tdataprocessor_assignments?: boolean;\r\n\tdataprocessor_resources?: boolean;\r\n\teditable_resource_diagram?: boolean;\r\n\tresource_store?: {\r\n\t\ttype?: \"treeDataStore\"|\"dataStore\"|string;\r\n\t\tfetchTasks?: boolean;\r\n\t\tinitItem?: (item: any) => any;\r\n\t};\r\n\tlightbox_resources?: (resources: any[]) => any[];\r\n\r\n}\r\n\r\ninterface IGanttConfig {\r\n\tlayout: ILayout;\r\n\tlinks: {\r\n\t\tfinish_to_start: \"0\";\r\n\t\tstart_to_start: \"1\";\r\n\t\tfinish_to_finish: \"2\";\r\n\t\tstart_to_finish: \"3\";\r\n\t};\r\n\ttypes: {\r\n\t\ttask: string;\r\n\t\tproject: string;\r\n\t\tmilestone: string;\r\n\t};\r\n\tauto_types: boolean;\r\n\tduration_unit: DurationUnits;\r\n\twork_time: boolean;\r\n\tcorrect_work_time: boolean;\r\n\tdeadlines: boolean;\r\n\tskip_off_time: boolean;\r\n\tcascade_delete: boolean;\r\n\tautosize: boolean | string;\r\n\tautoscroll: boolean;\r\n\tshow_links: boolean;\r\n\tshow_task_cells: boolean;\r\n\tautosize_min_width: number;\r\n\tautoscroll_speed: number;\r\n\tdeepcopy_on_parse: boolean;\r\n\tstatic_background: boolean;\r\n\tstatic_background_cells: boolean;\r\n\tbranch_loading: boolean;\r\n\tbranch_loading_property: string;\r\n\tshow_loading: boolean;\r\n\tshow_chart: boolean;\r\n\tshow_grid: boolean;\r\n\tmin_duration: number;\r\n\tdate_format: string; // use instead xml_date\r\n\txml_date?: string; // deprecated\r\n\tstart_on_monday: boolean;\r\n\tserver_utc: boolean;\r\n\tshow_progress: boolean;\r\n\tfit_tasks: boolean;\r\n\tselect_task: boolean;\r\n\tscroll_on_click: boolean;\r\n\tsmart_rendering: boolean;\r\n\tpreserve_scroll: boolean;\r\n\treadonly: boolean;\r\n\tcontainer_resize_timeout: number;\r\n\r\n\t/*grid */\r\n\tdate_grid: string;\r\n\r\n\tdrag_links: boolean;\r\n\tdrag_progress: boolean;\r\n\tdrag_resize: boolean;\r\n\tdrag_project: boolean;\r\n\tdrag_move: boolean;\r\n\tdrag_mode: {\r\n\t\tresize: \"resize\",\r\n\t\tprogress: \"progress\",\r\n\t\tmove: \"move\",\r\n\t\tignore: \"ignore\"\r\n\t};\r\n\tround_dnd_dates: boolean;\r\n\tlink_wrapper_width: number;\r\n\troot_id: string | number;\r\n\r\n\tlink_arrow_size:number;\r\n\r\n\tautofit: boolean;\r\n\tcolumns: IColumnItem[];\r\n\r\n\t/* scale*/\r\n\tscales: IScale[];\r\n\r\n\tscale_offset_minimal: boolean;\r\n\r\n\tinherit_scale_class: boolean;\r\n\r\n\r\n\ttime_step: number;\r\n\tduration_step: number;\r\n\r\n\r\n\ttask_date: string;\r\n\ttime_picker: string;\r\n\ttask_attribute: string;\r\n\tlink_attribute: string;\r\n\tlayer_attribute: string;\r\n\tbuttons_left: string[];\r\n\t_migrate_buttons: {\r\n\t\tdhx_save_btn: \"gantt_save_btn\",\r\n\t\tdhx_cancel_btn: \"gantt_cancel_btn\",\r\n\t\tdhx_delete_btn: \"gantt_delete_btn\"\r\n\t};\r\n\r\n\tbuttons_right: string[];\r\n\r\n\r\n\tlightbox: {\r\n\t\tsections?: LightboxSection,\r\n\t\tproject_sections?: LightboxSection,\r\n\t\tmilestone_sections?: LightboxSection\r\n\t};\r\n\tdrag_lightbox: boolean;\r\n\tsort: boolean;\r\n\tdetails_on_create: boolean;\r\n\tdetails_on_dblclick: boolean;\r\n\tinitial_scroll: boolean;\r\n\ttask_scroll_offset: number;\r\n\r\n\torder_branch: boolean;\r\n\torder_branch_free: boolean;\r\n\r\n\t// task_height is deprecated, use 'bar_height` instead\r\n\ttask_height: number | \"full\" | undefined;\r\n\tbar_height: number | \"full\";\r\n\tmin_column_width: number;\r\n\tbar_height_padding: number,\r\n\trow_height: number,\r\n\r\n\t// min width for grid column (when resizing)\r\n\tmin_grid_column_width: number;\r\n\t// name of the attribute with column index for resize element\r\n\tgrid_resizer_column_attribute: string;\r\n\t// name of the attribute with column index for resize element\r\n\t// grid_resizer_attribute: string; // usage of this parameter is not found\r\n\r\n\t// grid width can be increased after the column has been resized\r\n\tkeep_grid_width: boolean;\r\n\r\n\t// grid width can be adjusted\r\n\tgrid_resize: boolean;\r\n\tgrid_elastic_columns: boolean;\r\n\tshow_tasks_outside_timescale: boolean;\r\n\tshow_unscheduled: boolean;\r\n\treadonly_property: string;\r\n\teditable_property: string;\r\n\tcalendar_property: string;\r\n\tresource_calendars: object;\r\n\tdynamic_resource_calendars: boolean;\r\n\tinherit_calendar: boolean;\r\n\ttype_renderers: object;\r\n\r\n\tresize_rows: boolean;\r\n\t// name of the attribute with row index for resize element\r\n\ttask_grid_row_resizer_attribute: string;\r\n\t// min height for row (when resizing)\r\n\tmin_task_grid_row_height: number;\r\n\r\n\topen_tree_initially: boolean;\r\n\toptimize_render: boolean;\r\n\tprevent_default_scroll: boolean;\r\n\tshow_errors: boolean;\r\n\twai_aria_attributes: boolean;\r\n\tsmart_scales: boolean;\r\n\trtl: boolean;\r\n\tplaceholder_task: boolean | object;\r\n\thorizontal_scroll_key: TModifierKeys;\r\n\tdrag_timeline: {\r\n\t\tuseKey: TModifierKeys;\r\n\t\tignore: string;\r\n\t\trender?: boolean;\r\n\t};\r\n\tdrag_multiple: boolean;\r\n\tcsp: TCsp;\r\n\r\n\tresources?: IResourceConfig;\r\n\r\n\tauto_scheduling: object;\r\n}\r\n\r\nexport default () => {\r\n\tconst result: IGanttConfig = {\r\n\t\tlayout: {\r\n\t\t\tcss: \"gantt_container\",\r\n\t\t\trows: [\r\n\t\t\t\t{\r\n\t\t\t\t\tcols: [\r\n\t\t\t\t\t\t{view: \"grid\", scrollX: \"scrollHor\", scrollY: \"scrollVer\"},\r\n\t\t\t\t\t\t{resizer: true, width: 1},\r\n\t\t\t\t\t\t{view: \"timeline\", scrollX: \"scrollHor\", scrollY: \"scrollVer\"},\r\n\t\t\t\t\t\t{view: \"scrollbar\", id: \"scrollVer\"}\r\n\t\t\t\t\t]\r\n\t\t\t\t},\r\n\t\t\t\t{view: \"scrollbar\", id: \"scrollHor\", height: 20}\r\n\t\t\t]\r\n\t\t},\r\n\t\tlinks: {\r\n\t\t\tfinish_to_start: \"0\",\r\n\t\t\tstart_to_start: \"1\",\r\n\t\t\tfinish_to_finish: \"2\",\r\n\t\t\tstart_to_finish: \"3\"\r\n\t\t},\r\n\t\ttypes: {\r\n\t\t\ttask: \"task\",\r\n\t\t\tproject: \"project\",\r\n\t\t\tmilestone: \"milestone\"\r\n\t\t},\r\n\t\tauto_types: false,\r\n\t\tduration_unit: \"day\",\r\n\t\twork_time: false,\r\n\t\tcorrect_work_time: false,\r\n\t\tskip_off_time: false,\r\n\r\n\t\tcascade_delete: true,\r\n\r\n\t\tautosize: false,\r\n\t\tautosize_min_width: 0,\r\n\t\tautoscroll: true,\r\n\t\tautoscroll_speed: 30,\r\n\t\tdeepcopy_on_parse: false,\r\n\t\tshow_links: true,\r\n\t\tshow_task_cells: true,\r\n\t\t// replace backgroung of the task area with a canvas img\r\n\t\tstatic_background: false,\r\n\t\tstatic_background_cells: true,\r\n\t\tbranch_loading: false,\r\n\t\tbranch_loading_property: \"$has_child\",\r\n\t\tshow_loading: false,\r\n\t\tshow_chart: true,\r\n\t\tshow_grid: true,\r\n\t\tmin_duration: 60 * 60 * 1000,\r\n\t\tdate_format: \"%d-%m-%Y %H:%i\", // use instead xml_date\r\n\t\txml_date: undefined, // \"%d-%m-%Y %H:%i\", // deprecated\r\n\t\tstart_on_monday: true,\r\n\t\tserver_utc: false,\r\n\t\tshow_progress: true,\r\n\t\tfit_tasks: false,\r\n\t\tselect_task: true,\r\n\t\tscroll_on_click: true,\r\n\t\tsmart_rendering: true,\r\n\t\tpreserve_scroll: true,\r\n\t\treadonly: false,\r\n\t\tcontainer_resize_timeout: 20,\r\n\t\tdeadlines: true,\r\n\r\n\t\t/*grid */\r\n\t\tdate_grid: \"%Y-%m-%d\",\r\n\r\n\t\tdrag_links: true,\r\n\t\tdrag_progress: true,\r\n\t\tdrag_resize: true,\r\n\t\tdrag_project: false,\r\n\t\tdrag_move: true,\r\n\t\tdrag_mode: {\r\n\t\t\tresize: \"resize\",\r\n\t\t\tprogress: \"progress\",\r\n\t\t\tmove: \"move\",\r\n\t\t\tignore: \"ignore\"\r\n\t\t},\r\n\t\tround_dnd_dates: true,\r\n\t\tlink_wrapper_width: 20,\r\n\t\tlink_arrow_size:12,\r\n\t\troot_id: 0,\r\n\r\n\t\tautofit: false, // grid column automatic fit grid_width config\r\n\t\tcolumns: [\r\n\t\t\t{name: \"text\", tree: true, width: \"*\", resize: true},\r\n\t\t\t{name: \"start_date\", align: \"center\", resize: true},\r\n\t\t\t{name: \"duration\", align: \"center\"},\r\n\t\t\t{name: \"add\", width: 44}\r\n\t\t],\r\n\r\n\t\t/*scale*/\r\n\r\n\t\tscale_offset_minimal: true,\r\n\t\tinherit_scale_class: false,\r\n\r\n\t\tscales: [\r\n\t\t\t{\r\n\t\t\t\tunit: \"day\",\r\n\t\t\t\tstep: 1,\r\n\t\t\t\tdate: \"%d %M\"\r\n\t\t\t}\r\n\t\t],\r\n\r\n\t\ttime_step: 60,\r\n\t\tduration_step: 1,\r\n\t\ttask_date: \"%d %F %Y\",\r\n\t\ttime_picker: \"%H:%i\",\r\n\t\ttask_attribute: \"data-task-id\",\r\n\t\tlink_attribute: \"data-link-id\",\r\n\t\tlayer_attribute: \"data-layer\",\r\n\t\tbuttons_left: [\r\n\t\t\t\"gantt_save_btn\",\r\n\t\t\t\"gantt_cancel_btn\"\r\n\t\t],\r\n\t\t_migrate_buttons: {\r\n\t\t\tdhx_save_btn: \"gantt_save_btn\",\r\n\t\t\tdhx_cancel_btn: \"gantt_cancel_btn\",\r\n\t\t\tdhx_delete_btn: \"gantt_delete_btn\"\r\n\t\t},\r\n\t\tbuttons_right: [\r\n\t\t\t\"gantt_delete_btn\"\r\n\t\t],\r\n\t\tlightbox: {\r\n\t\t\tsections: [\r\n\t\t\t\t{name: \"description\", height: 70, map_to: \"text\", type: \"textarea\", focus: true},\r\n\t\t\t\t{name: \"time\", type: \"duration\", map_to: \"auto\"}\r\n\t\t\t],\r\n\t\t\tproject_sections: [\r\n\t\t\t\t{name: \"description\", height: 70, map_to: \"text\", type: \"textarea\", focus: true},\r\n\t\t\t\t{name: \"type\", type: \"typeselect\", map_to: \"type\"},\r\n\t\t\t\t{name: \"time\", type: \"duration\", readonly: true, map_to: \"auto\"}\r\n\t\t\t],\r\n\t\t\tmilestone_sections: [\r\n\t\t\t\t{name: \"description\", height: 70, map_to: \"text\", type: \"textarea\", focus: true},\r\n\t\t\t\t{name: \"type\", type: \"typeselect\", map_to: \"type\"},\r\n\t\t\t\t{name: \"time\", type: \"duration\", single_date: true, map_to: \"auto\"}\r\n\t\t\t]\r\n\t\t},\r\n\t\tdrag_lightbox: true,\r\n\t\tsort: false,\r\n\t\tdetails_on_create: true,\r\n\t\tdetails_on_dblclick: true,\r\n\t\tinitial_scroll: true,\r\n\t\ttask_scroll_offset: 100,\r\n\r\n\t\torder_branch: false,\r\n\t\torder_branch_free: false,\r\n\r\n\t\t// task height is deprecated, use 'bar_height' instead\r\n\t\ttask_height: undefined,// number px of 'full' for row height\r\n\t\tbar_height: \"full\",\r\n\t\tbar_height_padding:9,\r\n\t\tmin_column_width: 70,\r\n\r\n\t\t// min width for grid column (when resizing)\r\n\t\tmin_grid_column_width: 70,\r\n\t\t// name of the attribute with column index for resize element\r\n\t\tgrid_resizer_column_attribute: \"data-column-index\",\r\n\t\t// name of the attribute with column index for resize element\r\n\t\t// grid_resizer_attribute: \"grid_resizer\", // - usage of this parameter is not found in code\r\n\r\n\t\t// grid width can be increased after the column has been resized\r\n\t\tkeep_grid_width: false,\r\n\r\n\t\t// grid width can be adjusted\r\n\t\tgrid_resize: false,\r\n\t\tgrid_elastic_columns: false,\r\n\t\tshow_tasks_outside_timescale: false,\r\n\t\tshow_unscheduled: true,\r\n\r\n\t\tresize_rows: false,\r\n\t\t// name of the attribute with row index for resize element\r\n\t\ttask_grid_row_resizer_attribute: \"data-row-index\",\r\n\t\t// min height for row (when resizing)\r\n\t\tmin_task_grid_row_height: 30,\r\n\t\trow_height: 36,\r\n\r\n\t\t//\r\n\t\treadonly_property: \"readonly\",\r\n\t\teditable_property: \"editable\",\r\n\t\tcalendar_property: \"calendar_id\",\r\n\t\tresource_calendars: {},\r\n\t\tdynamic_resource_calendars: false,\r\n\t\tinherit_calendar: false,\r\n\t\ttype_renderers: {},\r\n\r\n\t\topen_tree_initially: false,\r\n\t\toptimize_render: true,\r\n\t\tprevent_default_scroll: false,\r\n\t\tshow_errors: true,\r\n\t\twai_aria_attributes: true,\r\n\t\tsmart_scales: true,\r\n\t\trtl:false,\r\n\t\tplaceholder_task: false,\r\n\t\thorizontal_scroll_key: \"shiftKey\",\r\n\t\tdrag_timeline: {\r\n\t\t\tuseKey: undefined,\r\n\t\t\tignore: \".gantt_task_line, .gantt_task_link\",\r\n\t\t\trender: false\r\n\t\t},\r\n\t\tdrag_multiple: true,\r\n\t\tcsp: \"auto\",\r\n\t\tauto_scheduling: {}\r\n\t};\r\n\treturn result;\r\n};\r\n","import global from \"./global\";\r\n\r\n/* eslint-disable no-restricted-globals */\r\nvar isWindowAwailable = typeof window !== \"undefined\";\r\n\r\n/* eslint-enable no-restricted-globals */\r\n\r\nconst nav = typeof navigator !== \"undefined\" ? navigator : {userAgent:\"\"};\r\n\r\nexport default {\r\n\tisIE: isWindowAwailable && (nav.userAgent.indexOf(\"MSIE\") >= 0 || nav.userAgent.indexOf(\"Trident\") >= 0),\r\n\tisOpera: isWindowAwailable && (nav.userAgent.indexOf(\"Opera\") >= 0 || nav.userAgent.indexOf(\"OPR\") >= 0),\r\n\tisChrome: isWindowAwailable && (nav.userAgent.indexOf(\"Chrome\") >= 0),\r\n\tisSafari: isWindowAwailable && (nav.userAgent.indexOf(\"Safari\") >= 0 || nav.userAgent.indexOf(\"Konqueror\") >= 0),\r\n\tisFF: isWindowAwailable && (nav.userAgent.indexOf(\"Firefox\") >= 0),\r\n\tisIPad: isWindowAwailable && (nav.userAgent.search(/iPad/gi) >= 0),\r\n\tisEdge: isWindowAwailable && (nav.userAgent.indexOf(\"Edge\")!=-1),\r\n\tisNode: (!isWindowAwailable || typeof navigator == \"undefined\" || (typeof PRODUCTION !== \"undefined\" && PRODUCTION === \"test\")),\r\n\tisSalesforce: isWindowAwailable && (!!global[\"Sfdc\"] || !!global[\"$A\"] || global[\"Aura\"])\r\n};\r\n","export default function serialize(data: object | string) {\r\n\tif (typeof data === \"string\" || typeof data === \"number\") {\r\n\t\treturn data;\r\n\t}\r\n\r\n\tlet result = \"\";\r\n\r\n\tfor (const key in data) {\r\n\t\tlet serialized = \"\";\r\n\t\tif (data.hasOwnProperty(key)) {\r\n\t\t\tif (typeof data[key] === \"string\") {\r\n\t\t\t\tserialized = encodeURIComponent(data[key]);\r\n\t\t\t} else if (typeof data[key] === \"number\") {\r\n\t\t\t\tserialized = String(data[key]);\r\n\t\t\t} else {\r\n\t\t\t\tserialized = encodeURIComponent(JSON.stringify(data[key]));\r\n\t\t\t}\r\n\t\t\tserialized = key + \"=\" + serialized;\r\n\r\n\t\t\tif (result.length) {\r\n\t\t\t\tserialized = \"&\" + serialized;\r\n\t\t\t}\r\n\t\t\tresult += serialized;\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}\r\n","import env from \"../../utils/env\";\r\nimport global from \"../../utils/global\";\r\nimport serialize from \"./serialize\";\r\n\r\nfunction createConfig(method, args) {\r\n\tvar result = {\r\n\t\tmethod: method\r\n\t};\r\n\r\n\tif (args.length === 0) {\r\n\t\tthrow new Error(\"Arguments list of query is wrong.\");\r\n\t}\r\n\tif (args.length === 1) {\r\n\t\tif (typeof args[0] === \"string\") {\r\n\t\t\tresult.url = args[0];\r\n\t\t\tresult.async = true;\r\n\t\t} else {\r\n\t\t\tresult.url = args[0].url;\r\n\t\t\tresult.async = (args[0].async || true);\r\n\t\t\tresult.callback = args[0].callback;\r\n\t\t\tresult.headers = args[0].headers;\r\n\t\t}\r\n\t\tif (method === \"POST\" || \"PUT\") {\r\n\t\t\tif (args[0].data) {\r\n\t\t\t\tif (typeof args[0].data !== \"string\") {\r\n\t\t\t\t\tresult.data = serialize(args[0].data);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult.data = args[0].data;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tresult.data = \"\";\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tresult.url = args[0];\r\n\tswitch(method) {\r\n\t\tcase \"GET\":\r\n\t\tcase \"DELETE\":\r\n\t\t\tresult.callback = args[1];\r\n\t\t\tresult.headers = args[2];\r\n\t\tbreak;\r\n\t\tcase \"POST\":\r\n\t\tcase \"PUT\":\r\n\t\t\tif (args[1]) {\r\n\t\t\t\tif (typeof args[1] !== \"string\") {\r\n\t\t\t\t\tresult.data = serialize(args[1]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult.data = args[1];\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tresult.data = \"\";\r\n\t\t\t}\r\n\t\t\tresult.callback = args[2];\r\n\t\t\tresult.headers = args[3];\r\n\t\tbreak;\r\n\t}\r\n\treturn result;\r\n}\r\n\r\nexport default function(gantt) {\r\n\treturn {\r\n\r\n\t\t// if false - dhxr param will added to prevent caching on client side (default),\r\n\t\t// if true - do not add extra params\r\n\t\tcache: true,\r\n\r\n\t\t// default method for load/loadStruct, post/get allowed\r\n\t\t// get - since 4.1.1, this should fix 412 error for macos safari\r\n\t\tmethod: \"get\",\r\n\r\n\t\tparse: function(data) {\r\n\t\t\tif (typeof data !== \"string\") return data;\r\n\r\n\t\t\tvar obj;\r\n\t\t\tdata = data.replace(/^[\\s]+/,\"\");\r\n\t\t\tif (typeof DOMParser !== \"undefined\" && !env.isIE) { // ff,ie9\r\n\t\t\t\tobj = (new DOMParser()).parseFromString(data, \"text/xml\");\r\n\t\t\t} else if (typeof global.ActiveXObject !== \"undefined\") {\r\n\t\t\t\tobj = new global.ActiveXObject(\"Microsoft.XMLDOM\");\r\n\t\t\t\tobj.async = \"false\";\r\n\t\t\t\tobj.loadXML(data);\r\n\t\t\t}\r\n\t\t\treturn obj;\r\n\t\t},\r\n\t\txmltop: function(tagname, xhr, obj) {\r\n\t\t\tif (typeof xhr.status == \"undefined\" || xhr.status < 400) {\r\n\t\t\t\tvar xml = (!xhr.responseXML) ? this.parse(xhr.responseText || xhr) : (xhr.responseXML || xhr);\r\n\t\t\t\tif (xml && xml.documentElement !== null && !xml.getElementsByTagName(\"parsererror\").length) {\r\n\t\t\t\t\treturn xml.getElementsByTagName(tagname)[0];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (obj !== -1) gantt.callEvent(\"onLoadXMLError\",[\"Incorrect XML\", arguments[1], obj]);\r\n\t\t\treturn document.createElement(\"DIV\");\r\n\t\t},\r\n\t\txpath: function(xpathExp, docObj) {\r\n\t\t\tif (!docObj.nodeName) docObj = docObj.responseXML || docObj;\r\n\t\t\tif (env.isIE) {\r\n\t\t\t\treturn docObj.selectNodes(xpathExp)||[];\r\n\t\t\t} else {\r\n\t\t\t\tvar rows = [];\r\n\t\t\t\tvar first;\r\n\t\t\t\tvar col = (docObj.ownerDocument||docObj).evaluate(xpathExp, docObj, null, XPathResult.ANY_TYPE, null);\r\n\r\n\t\t\t\twhile (true){\r\n\t\t\t\t\tfirst = col.iterateNext();\r\n\t\t\t\t\tif(first){\r\n\t\t\t\t\t\trows.push(first);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn rows;\r\n\t\t\t}\r\n\t\t},\r\n\t\tquery: function(config) {\r\n\t\t\treturn this._call(\r\n\t\t\t\t(config.method || \"GET\"),\r\n\t\t\t\tconfig.url,\r\n\t\t\t\tconfig.data || \"\",\r\n\t\t\t\t(config.async || true),\r\n\t\t\t\tconfig.callback,\r\n\t\t\t\tconfig.headers\r\n\t\t\t);\r\n\t\t},\r\n\t\tget: function(url, onLoad, headers) {\r\n\t\t\tvar config = createConfig(\"GET\", arguments);\r\n\t\t\treturn this.query(config);\r\n\t\t},\r\n\t\tgetSync: function(url, headers) {\r\n\t\t\tvar config = createConfig(\"GET\", arguments);\r\n\t\t\tconfig.async = false;\r\n\t\t\treturn this.query(config);\r\n\t\t},\r\n\t\tput: function(url, postData, onLoad, headers) {\r\n\t\t\tvar config = createConfig(\"PUT\", arguments);\r\n\t\t\treturn this.query(config);\r\n\t\t},\r\n\t\tdel: function(url, onLoad, headers) {\r\n\t\t\t/**\r\n\t\t\t * https://tools.ietf.org/html/rfc7231#section-4.3.5\r\n\t\t\t * A payload within a DELETE request message has no defined semantics;\r\n\t\t\t * sending a payload body on a DELETE request might cause some existing\r\n\t\t\t * implementations to reject the request.\r\n\t\t\t */\r\n\t\t\tvar config = createConfig(\"DELETE\", arguments);\r\n\t\t\treturn this.query(config);\r\n\t\t},\r\n\t\tpost: function(url, postData, onLoad, headers) {\r\n\t\t\tif (arguments.length == 1) {\r\n\t\t\t\tpostData = \"\";\r\n\t\t\t} else if (arguments.length == 2 && typeof(postData) == \"function\") {\r\n\t\t\t\tonLoad = postData;\r\n\t\t\t\tpostData = \"\";\r\n\t\t\t}\r\n\t\t\tvar config = createConfig(\"POST\", arguments);\r\n\t\t\treturn this.query(config);\r\n\t\t},\r\n\t\tpostSync: function(url, postData, headers) {\r\n\t\t\tpostData = (postData === null ? \"\" : String(postData));\r\n\r\n\t\t\tvar config = createConfig(\"POST\", arguments);\r\n\t\t\tconfig.async = false;\r\n\t\t\treturn this.query(config);\r\n\t\t},\r\n\t\t_call: function(method, url, postData, async, onLoad, headers) {\r\n\t\t\treturn new gantt.Promise(function(resolve, reject) {\r\n\t\t\t\tvar t = (typeof XMLHttpRequest !== undefined ? new XMLHttpRequest() : new global.ActiveXObject(\"Microsoft.XMLHTTP\"));\r\n\t\t\t\tvar isQt = (navigator.userAgent.match(/AppleWebKit/) !== null && navigator.userAgent.match(/Qt/) !== null && navigator.userAgent.match(/Safari/) !== null);\r\n\r\n\t\t\t\tif (!!async) {\r\n\t\t\t\t\tt.onreadystatechange = function() {\r\n\t\t\t\t\t\tif ((t.readyState == 4) || (isQt && t.readyState == 3)) { // what for long response and status 404?\r\n\t\t\t\t\t\t\tconst errorStatus = t.status < 200 || t.status > 299;\r\n\t\t\t\t\t\t\tif (errorStatus || t.responseText === \"\")\r\n\t\t\t\t\t\t\t\tif (!gantt.callEvent(\"onAjaxError\", [t])) return;\r\n\r\n\t\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\t\tif (typeof(onLoad) == \"function\") {\r\n\t\t\t\t\t\t\t\t\tonLoad.apply(global, [{xmlDoc:t, filePath:url}]); // dhtmlx-compat, response.xmlDoc.responseXML/responseText\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tresolve(t);\r\n\t\t\t\t\t\t\t\tif (typeof(onLoad) == \"function\") {\r\n\t\t\t\t\t\t\t\t\tonLoad = null;\r\n\t\t\t\t\t\t\t\t\tt = null;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}, 0);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvar noCache = !this || !this.cache;\r\n\t\t\t\tif (method == \"GET\" && noCache) {\r\n\t\t\t\t\turl += (url.indexOf(\"?\")>=0?\"&\":\"?\")+\"dhxr\"+new Date().getTime()+\"=1\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tt.open(method, url, async);\r\n\r\n\t\t\t\tif (headers){\r\n\t\t\t\t\tfor (var key in headers)\r\n\t\t\t\t\t\tt.setRequestHeader(key, headers[key]);\r\n\t\t\t\t} else if (method.toUpperCase() == \"POST\" || method == \"PUT\" || method == \"DELETE\") {\r\n\t\t\t\t\tt.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\r\n\t\t\t\t} else if (method == \"GET\") {\r\n\t\t\t\t\tpostData = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tt.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\r\n\r\n\t\t\t\tt.send(postData);\r\n\r\n\t\t\t\tif (!async) return {xmlDoc:t, filePath:url}; // dhtmlx-compat, response.xmlDoc.responseXML/responseText\r\n\t\t\t});\r\n\t\t},\r\n\t\turlSeparator: function(str){\r\n\t\t\tif (str.indexOf(\"?\") != -1)\r\n\t\t\t\treturn \"&\";\r\n\t\t\telse\r\n\t\t\t\treturn \"?\";\r\n\t\t}\r\n\t};\r\n};\r\n","const dateToStr = (format: string, utc: boolean, gantt) => {\r\n\tformat = format.replace(/%[a-zA-Z]/g, (a) => {\r\n\t\tswitch (a) {\r\n\t\t\tcase \"%d\":\r\n\t\t\t\treturn `\"+to_fixed(date.get${utc?\"UTC\":\"\"}Date())+\"`;\r\n\t\t\tcase \"%m\":\r\n\t\t\t\treturn `\"+to_fixed((date.get${utc?\"UTC\":\"\"}Month()+1))+\"`;\r\n\t\t\tcase \"%j\":\r\n\t\t\t\treturn `\"+date.get${utc?\"UTC\":\"\"}Date()+\"`;\r\n\t\t\tcase \"%n\":\r\n\t\t\t\treturn `\"+(date.get${utc?\"UTC\":\"\"}Month()+1)+\"`;\r\n\t\t\tcase \"%y\":\r\n\t\t\t\treturn `\"+to_fixed(date.get${utc?\"UTC\":\"\"}FullYear()%100)+\"`;\r\n\t\t\tcase \"%Y\":\r\n\t\t\t\treturn `\"+date.get${utc?\"UTC\":\"\"}FullYear()+\"`;\r\n\t\t\tcase \"%D\":\r\n\t\t\t\treturn `\"+locale.date.day_short[date.get${utc?\"UTC\":\"\"}Day()]+\"`;\r\n\t\t\tcase \"%l\":\r\n\t\t\t\treturn `\"+locale.date.day_full[date.get${utc?\"UTC\":\"\"}Day()]+\"`;\r\n\t\t\tcase \"%M\":\r\n\t\t\t\treturn `\"+locale.date.month_short[date.get${utc?\"UTC\":\"\"}Month()]+\"`;\r\n\t\t\tcase \"%F\":\r\n\t\t\t\treturn `\"+locale.date.month_full[date.get${utc?\"UTC\":\"\"}Month()]+\"`;\r\n\t\t\tcase \"%h\":\r\n\t\t\t\treturn `\"+to_fixed((date.get${utc?\"UTC\":\"\"}Hours()+11)%12+1)+\"`;\r\n\t\t\tcase \"%g\":\r\n\t\t\t\treturn `\"+((date.get${utc?\"UTC\":\"\"}Hours()+11)%12+1)+\"`;\r\n\t\t\tcase \"%G\":\r\n\t\t\t\treturn `\"+date.get${utc?\"UTC\":\"\"}Hours()+\"`;\r\n\t\t\tcase \"%H\":\r\n\t\t\t\treturn `\"+to_fixed(date.get${utc?\"UTC\":\"\"}Hours())+\"`;\r\n\t\t\tcase \"%i\":\r\n\t\t\t\treturn `\"+to_fixed(date.get${utc?\"UTC\":\"\"}Minutes())+\"`;\r\n\t\t\tcase \"%a\":\r\n\t\t\t\treturn `\"+(date.get${utc?\"UTC\":\"\"}Hours()>11?\"pm\":\"am\")+\"`;\r\n\t\t\tcase \"%A\":\r\n\t\t\t\treturn `\"+(date.get${utc?\"UTC\":\"\"}Hours()>11?\"PM\":\"AM\")+\"`;\r\n\t\t\tcase \"%s\":\r\n\t\t\t\treturn `\"+to_fixed(date.get${utc?\"UTC\":\"\"}Seconds())+\"`;\r\n\t\t\tcase \"%W\":\r\n\t\t\t\treturn `\"+to_fixed(getISOWeek(date))+\"`;\r\n\t\t\tcase \"%w\":\r\n\t\t\t\treturn `\"+to_fixed(getWeek(date))+\"`;\r\n\t\t\tdefault:\r\n\t\t\t\treturn a;\r\n\t\t}\r\n\t});\r\n\r\n\t// tslint:disable-next-line: function-constructor\r\n\tconst dateToStrFn = new Function(\"date\", \"to_fixed\", \"locale\", \"getISOWeek\", \"getWeek\", `return \"${format}\";`);\r\n\r\n\treturn (date: Date) => {\r\n\t\treturn dateToStrFn(date, gantt.date.to_fixed, gantt.locale, gantt.date.getISOWeek, gantt.date.getWeek);\r\n\t};\r\n};\r\n\r\n\r\nconst strToDate = (format: string, utc: boolean, gantt:any) => {\r\n\tlet splt = \"var temp=date.match(/[a-zA-Z]+|[0-9]+/g);\";\r\n\tconst mask = format.match(/%[a-zA-Z]/g);\r\n\tfor (let i = 0; i < mask.length; i++) {\r\n\t\tswitch (mask[i]) {\r\n\t\t\tcase \"%j\":\r\n\t\t\tcase \"%d\":\r\n\t\t\t\tsplt += `set[2]=temp[${i}]||1;`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%n\":\r\n\t\t\tcase \"%m\":\r\n\t\t\t\tsplt += `set[1]=(temp[${i}]||1)-1;`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%y\":\r\n\t\t\t\tsplt += `set[0]=temp[${i}]*1+(temp[${i}]>50?1900:2000);`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%g\":\r\n\t\t\tcase \"%G\":\r\n\t\t\tcase \"%h\":\r\n\t\t\tcase \"%H\":\r\n\t\t\t\tsplt += `set[3]=temp[${i}]||0;`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%i\":\r\n\t\t\t\tsplt += `set[4]=temp[${i}]||0;`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%Y\":\r\n\t\t\t\tsplt += `set[0]=temp[${i}]||0;`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%a\":\r\n\t\t\tcase \"%A\":\r\n\t\t\t\tsplt += `set[3]=set[3]%12+((temp[${i}]||'').toLowerCase()=='am'?0:12);`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%s\":\r\n\t\t\t\tsplt += `set[5]=temp[${i}]||0;`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%M\":\r\n\t\t\t\tsplt += `set[1]=locale.date.month_short_hash[temp[${i}]]||0;`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%F\":\r\n\t\t\t\tsplt += `set[1]=locale.date.month_full_hash[temp[${i}]]||0;`;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tlet code = \"set[0],set[1],set[2],set[3],set[4],set[5]\";\r\n\tif (utc) { code = ` Date.UTC(${code})`; }\r\n\t// tslint:disable-next-line: function-constructor\r\n\tconst strToDateFn = new Function(\"date\", \"locale\", `var set=[0,0,1,0,0,0]; ${splt} return new Date(${code});`);\r\n\r\n\treturn (dateString) => {\r\n\t\treturn strToDateFn(dateString, gantt.locale);\r\n\t};\r\n};\r\n\r\nconst fastVersion = {\r\n\tdate_to_str: dateToStr,\r\n\tstr_to_date: strToDate\r\n};\r\n\r\nexport default fastVersion;","const dateToStr = (format: string, utc: boolean, gantt) => {\r\n\treturn (date) => {\r\n\t\treturn format.replace(/%[a-zA-Z]/g, (a) => {\r\n\t\t\tswitch (a) {\r\n\t\t\t\tcase \"%d\": return utc ? gantt.date.to_fixed(date.getUTCDate()) : gantt.date.to_fixed(date.getDate());\r\n\t\t\t\tcase \"%m\": return utc ? gantt.date.to_fixed((date.getUTCMonth() + 1)) : gantt.date.to_fixed((date.getMonth() + 1));\r\n\t\t\t\tcase \"%j\": return utc ? date.getUTCDate() : date.getDate();\r\n\t\t\t\tcase \"%n\": return utc ? (date.getUTCMonth() + 1) : (date.getMonth() + 1);\r\n\t\t\t\tcase \"%y\": return utc ? gantt.date.to_fixed(date.getUTCFullYear() % 100) : gantt.date.to_fixed(date.getFullYear() % 100);\r\n\t\t\t\tcase \"%Y\": return utc ? date.getUTCFullYear() : date.getFullYear();\r\n\t\t\t\tcase \"%D\": return utc ? gantt.locale.date.day_short[date.getUTCDay()] : gantt.locale.date.day_short[date.getDay()];\r\n\t\t\t\tcase \"%l\": return utc ? gantt.locale.date.day_full[date.getUTCDay()] : gantt.locale.date.day_full[date.getDay()];\r\n\t\t\t\tcase \"%M\": return utc ? gantt.locale.date.month_short[date.getUTCMonth()] : gantt.locale.date.month_short[date.getMonth()];\r\n\t\t\t\tcase \"%F\": return utc ? gantt.locale.date.month_full[date.getUTCMonth()] : gantt.locale.date.month_full[date.getMonth()];\r\n\t\t\t\tcase \"%h\": return utc ? gantt.date.to_fixed((date.getUTCHours() + 11) % 12 + 1) : gantt.date.to_fixed((date.getHours() + 11) % 12 + 1);\r\n\t\t\t\tcase \"%g\": return utc ? ((date.getUTCHours() + 11) % 12 + 1) : ((date.getHours() + 11) % 12 + 1);\r\n\t\t\t\tcase \"%G\": return utc ? date.getUTCHours() : date.getHours();\r\n\t\t\t\tcase \"%H\": return utc ? gantt.date.to_fixed(date.getUTCHours()) : gantt.date.to_fixed(date.getHours());\r\n\t\t\t\tcase \"%i\": return utc ? gantt.date.to_fixed(date.getUTCMinutes()) : gantt.date.to_fixed(date.getMinutes());\r\n\t\t\t\tcase \"%a\": return utc ? (date.getUTCHours() > 11 ? \"pm\" : \"am\") : (date.getHours() > 11 ? \"pm\" : \"am\");\r\n\t\t\t\tcase \"%A\": return utc ? (date.getUTCHours() > 11 ? \"PM\" : \"AM\") : (date.getHours() > 11 ? \"PM\" : \"AM\");\r\n\t\t\t\tcase \"%s\": return utc ? gantt.date.to_fixed(date.getUTCSeconds()) : gantt.date.to_fixed(date.getSeconds());\r\n\t\t\t\tcase \"%W\": return utc ? gantt.date.to_fixed(gantt.date.getUTCISOWeek(date)) : gantt.date.to_fixed(gantt.date.getISOWeek(date));\r\n\t\t\t\tcase \"%w\": return gantt.date.to_fixed(gantt.date.getWeek(date));\r\n\t\t\t\tdefault: return a;\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n};\r\nconst strToDate = (format: string, utc: boolean, gantt:any) => {\r\n\treturn (date: string) => {\r\n\t\tconst set: Array<string|number> = [0, 0, 1, 0, 0, 0];\r\n\t\tconst temp = date.match(/[a-zA-Z]+|[0-9]+/g);\r\n\t\tconst mask = format.match(/%[a-zA-Z]/g);\r\n\r\n\t\tfor (let i = 0; i < mask.length; i++) {\r\n\t\t\tswitch (mask[i]) {\r\n\t\t\t\tcase \"%j\":\r\n\t\t\t\tcase \"%d\":\r\n\t\t\t\t\tset[2] = temp[i] as unknown as number || 1;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%n\":\r\n\t\t\t\tcase \"%m\":\r\n\t\t\t\t\tset[1] = (temp[i] as unknown as number || 1) - 1;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%y\":\r\n\t\t\t\t\tset[0] = temp[i] as unknown as number * 1 + ((temp[i] as unknown as number) > 50 ? 1900 : 2000);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%g\":\r\n\t\t\t\tcase \"%G\":\r\n\t\t\t\tcase \"%h\":\r\n\t\t\t\tcase \"%H\":\r\n\t\t\t\t\tset[3] = temp[i] as unknown as number || 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%i\":\r\n\t\t\t\t\tset[4] = temp[i] as unknown as number || 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%Y\":\r\n\t\t\t\t\tset[0] = temp[i] as unknown as number || 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%a\":\r\n\t\t\t\tcase \"%A\":\r\n\t\t\t\t\tset[3] = set[3] as number % 12 + ((temp[i] || \"\").toLowerCase() === \"am\" ? 0 : 12);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%s\":\r\n\t\t\t\t\tset[5] = temp[i] || 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%M\":\r\n\t\t\t\t\tset[1] = gantt.locale.date.month_short_hash[temp[i]] || 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%F\":\r\n\t\t\t\t\tset[1] = gantt.locale.date.month_full_hash[temp[i]] || 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (utc) {\r\n\t\t\treturn new Date(Date.UTC(\r\n\t\t\t\tset[0] as number,\r\n\t\t\t\tset[1] as number,\r\n\t\t\t\tset[2] as number,\r\n\t\t\t\tset[3] as number,\r\n\t\t\t\tset[4] as number,\r\n\t\t\t\tset[5] as number\r\n\t\t\t));\r\n\t\t}\r\n\t\treturn new Date(\r\n\t\t\tset[0] as number,\r\n\t\t\tset[1] as number,\r\n\t\t\tset[2] as number,\r\n\t\t\tset[3] as number,\r\n\t\t\tset[4] as number,\r\n\t\t\tset[5] as number\r\n\t\t);\r\n\t};\r\n\r\n};\r\n\r\n\r\nconst cspVersion = {\r\n\tdate_to_str: dateToStr,\r\n\tstr_to_date: strToDate\r\n};\r\n\r\nexport default cspVersion;","/*\r\n %d - the day as a number with a leading zero ( 01 to 31 );\r\n %j - the day as a number without a leading zero ( 1 to 31 );\r\n %D - the day as an abbreviation ( Sun to Sat );\r\n %l - the day as a full name ( Sunday to Saturday );\r\n %W - the ISO-8601 week number of the year. Weeks start on Monday; 1)\r\n %m - the month as a number without a leading zero ( 1 to 12 );\r\n %n - the month as a number with a leading zero ( 01 to 12);\r\n %M - the month as an abbreviation ( Jan to Dec );\r\n %F - the month as a full name ( January to December );\r\n %y - the year as a two-digit number ( 00 to 99 );\r\n %Y - the year as a four-digit number ( 19009999 );\r\n %h - the hour based on the 12-hour clock ( 00 to 11 );\r\n %H - the hour based on the 24-hour clock ( 00 to 23 );\r\n %i - the minute as a number with a leading zero ( 00 to 59 );\r\n %s - the second as a number without a leading zero ( 00 to 59 ); 2)\r\n %a - displays am (for times from midnight until noon) and pm (for times from noon until midnight);\r\n %A - displays AM (for times from midnight until noon) and PM (for times from noon until midnight).\r\n*/\r\n\r\nimport fastVersion from \"./date_parsers/fast_version\";\r\nimport cspCompliantVersion from \"./date_parsers/csp_compliant_version\";\r\n\r\nexport default function(gantt) {\r\n\tvar canUseCsp = null;\r\n\tfunction cspAutoCheck() {\r\n\t\ttry {\r\n\t\t\tnew Function(\"canUseCsp = false;\");\r\n\t\t} catch(e) {\r\n\t\t\tcanUseCsp = true;\r\n\t\t}\r\n\t}\r\n\tfunction useCsp() {\r\n\t\tvar result = false;\r\n\t\tif (gantt.config.csp === \"auto\") {\r\n\t\t\tif(canUseCsp === null) {\r\n\t\t\t\tcspAutoCheck();\r\n\t\t\t}\r\n\t\t\tresult = canUseCsp;\r\n\t\t} else {\r\n\t\t\tresult = gantt.config.csp;\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tvar dateHelper = {\r\n\t\tinit: function () {\r\n\t\t\tvar locale = gantt.locale;\r\n\r\n\t\t\tvar s = locale.date.month_short;\r\n\t\t\tvar t = locale.date.month_short_hash = {};\r\n\t\t\tfor (var i = 0; i < s.length; i++)\r\n\t\t\t\tt[s[i]] = i;\r\n\r\n\t\t\tvar s = locale.date.month_full;\r\n\t\t\tvar t = locale.date.month_full_hash = {};\r\n\t\t\tfor (var i = 0; i < s.length; i++)\r\n\t\t\t\tt[s[i]] = i;\r\n\t\t},\r\n\t\tdate_part: function (date) {\r\n\t\t\tvar old = new Date(date);\r\n\t\t\tdate.setHours(0);\r\n\t\t\tthis.hour_start(date);\r\n\t\t\tif (date.getHours() && //shift to yesterday on dst\r\n\t\t\t\t(date.getDate() < old.getDate() || date.getMonth() < old.getMonth() || date.getFullYear() < old.getFullYear()))\r\n\t\t\t\tdate.setTime(date.getTime() + 60 * 60 * 1000 * (24 - date.getHours()));\r\n\t\t\treturn date;\r\n\t\t},\r\n\t\ttime_part: function (date) {\r\n\t\t\treturn (date.valueOf() / 1000 - date.getTimezoneOffset() * 60) % 86400;\r\n\t\t},\r\n\t\tweek_start: function (date) {\r\n\t\t\tvar shift = date.getDay();\r\n\t\t\tif (gantt.config.start_on_monday) {\r\n\t\t\t\tif (shift === 0) shift = 6;\r\n\t\t\t\telse shift--;\r\n\t\t\t}\r\n\t\t\treturn this.date_part(this.add(date, -1 * shift, \"day\"));\r\n\t\t},\r\n\t\tmonth_start: function (date) {\r\n\t\t\tdate.setDate(1);\r\n\t\t\treturn this.date_part(date);\r\n\t\t},\r\n\t\tquarter_start: function (date) {\r\n\t\t\tthis.month_start(date);\r\n\t\t\tvar m = date.getMonth(),\r\n\t\t\t\tres_month;\r\n\r\n\t\t\tif (m >= 9) {\r\n\t\t\t\tres_month = 9;\r\n\t\t\t} else if (m >= 6) {\r\n\t\t\t\tres_month = 6;\r\n\t\t\t} else if (m >= 3) {\r\n\t\t\t\tres_month = 3;\r\n\t\t\t} else {\r\n\t\t\t\tres_month = 0;\r\n\t\t\t}\r\n\r\n\t\t\tdate.setMonth(res_month);\r\n\t\t\treturn date;\r\n\t\t},\r\n\t\tyear_start: function (date) {\r\n\t\t\tdate.setMonth(0);\r\n\t\t\treturn this.month_start(date);\r\n\t\t},\r\n\t\tday_start: function (date) {\r\n\t\t\treturn this.date_part(date);\r\n\t\t},\r\n\t\thour_start: function (date) {\r\n\t\t\tif (date.getMinutes())\r\n\t\t\t\tdate.setMinutes(0);\r\n\t\t\tthis.minute_start(date);\r\n\r\n\t\t\treturn date;\r\n\t\t},\r\n\t\tminute_start: function (date) {\r\n\t\t\tif (date.getSeconds())\r\n\t\t\t\tdate.setSeconds(0);\r\n\t\t\tif (date.getMilliseconds())\r\n\t\t\t\tdate.setMilliseconds(0);\r\n\t\t\treturn date;\r\n\t\t},\r\n\t\t_add_days: function (modifiedDate, inc, originalDate) {\r\n\r\n\t\t\tmodifiedDate.setDate(modifiedDate.getDate() + inc);\r\n\t\t\tvar incCondition = inc >= 0;\r\n\t\t\tvar getHoursCondition = !originalDate.getHours() && modifiedDate.getHours(); //shift to yesterday on dst\r\n\t\t\tvar getDateCondition = (modifiedDate.getDate() <= originalDate.getDate() || modifiedDate.getMonth() < originalDate.getMonth() || modifiedDate.getFullYear() < originalDate.getFullYear());\r\n\t\t\tif (incCondition && getHoursCondition && getDateCondition){\r\n\t\t\t\tmodifiedDate.setTime(modifiedDate.getTime() + 60 * 60 * 1000 * (24 - modifiedDate.getHours()));\r\n\t\t\t}\r\n\t\t\tvar worktimeCalculation = inc > 1;\r\n\t\t\tif (worktimeCalculation && getHoursCondition){\r\n\t\t\t\t// try to shift the modified Date to 00:00\r\n\t\t\t\tmodifiedDate.setHours(0);\r\n\t\t\t}\r\n\t\t\treturn modifiedDate;\r\n\t\t},\r\n\r\n\t\tadd: function (date, inc, mode) {\r\n\t\t\t/*jsl:ignore*/\r\n\t\t\tvar ndate = new Date(date.valueOf());\r\n\t\t\tswitch (mode) {\r\n\t\t\t\tcase \"day\":\r\n\t\t\t\t\tndate = this._add_days(ndate, inc, date);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"week\":\r\n\t\t\t\t\tndate = this._add_days(ndate, inc * 7, date);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"month\":\r\n\t\t\t\t\tndate.setMonth(ndate.getMonth() + inc);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"year\":\r\n\t\t\t\t\tndate.setYear(ndate.getFullYear() + inc);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"hour\":\r\n\t\t\t\t\t/*\r\n\t\t\t\t\t\tadding hours/minutes via setHour(getHour() + inc) gives weird result when\r\n\t\t\t\t\t\tadding one hour to the time before switch to a Daylight Saving time\r\n\r\n\t\t\t\t\t\texample: //Sun Mar 30 2014 01:00:00 GMT+0100 (W. Europe Standard Time)\r\n\t\t\t\t\t\tnew Date(2014, 02, 30, 1).setHours(2)\r\n\t\t\t\t\t\t>>Sun Mar 30 2014 01:00:00 GMT+0100 (W. Europe Standard Time)\r\n\r\n\t\t\t\t\t\tsetTime seems working as expected\r\n\t\t\t\t\t */\r\n\t\t\t\t\tndate.setTime(ndate.getTime() + inc * 60 * 60 * 1000);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"minute\":\r\n\r\n\t\t\t\t\tndate.setTime(ndate.getTime() + inc * 60 * 1000);\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn this[\"add_\" + mode](date, inc, mode);\r\n\t\t\t}\r\n\t\t\treturn ndate;\r\n\t\t\t/*jsl:end*/\r\n\t\t},\r\n\t\tadd_quarter: function (date, inc) {\r\n\t\t\treturn this.add(date, inc * 3, \"month\");\r\n\t\t},\r\n\r\n\t\tto_fixed: function (num) {\r\n\t\t\tif (num < 10) return \"0\" + num;\r\n\t\t\treturn num;\r\n\t\t},\r\n\t\tcopy: function (date) {\r\n\t\t\treturn new Date(date.valueOf());\r\n\t\t},\r\n\t\tdate_to_str: function (format, utc) {\r\n\t\t\tvar result = fastVersion;\r\n\t\t\tif (useCsp()) {\r\n\t\t\t\tresult = cspCompliantVersion;\r\n\t\t\t}\r\n\t\t\treturn result.date_to_str(format, utc, gantt);\r\n\t\t},\r\n\t\tstr_to_date: function (format, utc) {\r\n\t\t\tvar result = fastVersion;\r\n\t\t\tif (useCsp()) {\r\n\t\t\t\tresult = cspCompliantVersion;\r\n\t\t\t}\r\n\t\t\treturn result.str_to_date(format, utc, gantt);\r\n\t\t},\r\n\t\tgetISOWeek: function (ndate) {\r\n\t\t\treturn gantt.date._getWeekNumber(ndate, true);\r\n\t\t},\r\n\t\t_getWeekNumber: function(ndate, isoWeek){\r\n\t\t\tif (!ndate) return false;\r\n\t\t\tvar nday = ndate.getDay();\r\n\t\t\tif(isoWeek){\r\n\t\t\t\tif (nday === 0) {\r\n\t\t\t\t\tnday = 7;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar first_thursday = new Date(ndate.valueOf());\r\n\t\t\tfirst_thursday.setDate(ndate.getDate() + (4 - nday));\r\n\t\t\tvar year_number = first_thursday.getFullYear(); // year of the first Thursday\r\n\t\t\tvar ordinal_date = Math.round((first_thursday.getTime() - new Date(year_number, 0, 1).getTime()) / 86400000); //ordinal date of the first Thursday - 1 (so not really ordinal date)\r\n\t\t\tvar week_number = 1 + Math.floor(ordinal_date / 7);\r\n\t\t\treturn week_number;\r\n\t\t},\r\n\r\n\t\tgetWeek: function(ndate){\r\n\t\t\treturn gantt.date._getWeekNumber(ndate, gantt.config.start_on_monday);\r\n\t\t},\r\n\t\tgetUTCISOWeek: function (ndate) {\r\n\t\t\treturn gantt.date.getISOWeek(ndate);\r\n\t\t},\r\n\t\tconvert_to_utc: function (date) {\r\n\t\t\treturn new Date(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds());\r\n\t\t},\r\n\t\tparseDate: function (date, format) {\r\n\t\t\t// raw date may be of type string, number (timestamp) or something else\r\n\t\t\t// do not check for instanceof Date explicitly, since we may swap native date with different date implementation at some point\r\n\t\t\tif (date && !date.getFullYear) {\r\n\t\t\t\tif (typeof(format) !== \"function\") {\r\n\t\t\t\t\tif (typeof(format) === \"string\") {\r\n\t\t\t\t\t\tif (format === \"parse_date\" || format === \"xml_date\") {\r\n\t\t\t\t\t\t\tformat = gantt.defined(gantt.templates.xml_date) ? gantt.templates.xml_date : gantt.templates.parse_date;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tformat = gantt.defined(gantt.templates[format]) ? gantt.templates[format] : gantt.date.str_to_date(format);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tformat = gantt.defined(gantt.templates.xml_date) ? gantt.templates.xml_date : gantt.templates.parse_date;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (date) {\r\n\t\t\t\t\tdate = format(date);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdate = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn date;\r\n\t\t}\r\n\t};\r\n\treturn dateHelper;\r\n};","class t{constructor(t){const{url:e,token:s}=t;this._url=e,this._token=s,this._mode=1,this._seed=1,this._queue=[],this.data={},this.api={},this._events={}}headers(){return{Accept:\"application/json\",\"Content-Type\":\"application/json\",\"Remote-Token\":this._token}}fetch(t,e){const s={credentials:\"include\",headers:this.headers()};return e&&(s.method=\"POST\",s.body=e),fetch(t,s).then(t=>t.json())}load(t){return t&&(this._url=t),this.fetch(this._url).then(t=>this.parse(t))}parse(t){const{key:e,websocket:s}=t;e&&(this._token=t.key);for(const e in t.data)this.data[e]=t.data[e];for(const e in t.api){const s=this.api[e]={},i=t.api[e];for(const t in i)s[t]=this._wrapper(e+\".\"+t)}return s&&this.connect(),this}connect(){const t=this._socket;t&&(this._socket=null,t.onclose=function(){},t.close()),this._mode=2,this._socket=function(t,e,s,i){let n=e;\"/\"===n[0]&&(n=document.location.protocol+\"//\"+document.location.host+e);n=n.replace(/^http(s|):/,\"ws$1:\");const o=-1!=n.indexOf(\"?\")?\"&\":\"?\";n=`${n}${o}token=${s}&ws=1`;const r=new WebSocket(n);return r.onclose=()=>setTimeout(()=>t.connect(),2e3),r.onmessage=e=>{const s=JSON.parse(e.data);switch(s.action){case\"result\":t.result(s.body,[]);break;case\"event\":t.fire(s.body.name,s.body.value);break;case\"start\":i();break;default:t.onError(s.data)}},r}(this,this._url,this._token,()=>(this._mode=3,this._send(),this._resubscribe(),this))}_wrapper(t){return function(){const e=[].slice.call(arguments);let s=null;const i=new Promise((i,n)=>{s={data:{id:this._uid(),name:t,args:e},status:1,resolve:i,reject:n},this._queue.push(s)});return this.onCall(s,i),3===this._mode?this._send(s):setTimeout(()=>this._send(),1),i}.bind(this)}_uid(){return(this._seed++).toString()}_send(t){if(2==this._mode)return void setTimeout(()=>this._send(),100);const e=t?[t]:this._queue.filter(t=>1===t.status);if(!e.length)return;const s=e.map(t=>(t.status=2,t.data));3!==this._mode?this.fetch(this._url,JSON.stringify(s)).catch(t=>this.onError(t)).then(t=>this.result(t,s)):this._socket.send(JSON.stringify({action:\"call\",body:s}))}result(t,e){const s={};if(t)for(let e=0;e<t.length;e++)s[t[e].id]=t[e];else for(let t=0;t<e.length;t++)s[e[t].id]={id:e[t].id,error:\"Network Error\",data:null};for(let t=this._queue.length-1;t>=0;t--){const e=this._queue[t],i=s[e.data.id];i&&(this.onResponse(e,i),i.error?e.reject(i.error):e.resolve(i.data),this._queue.splice(t,1))}}on(t,e){const s=this._uid();let i=this._events[t];const n=!!i;return n||(i=this._events[t]=[]),i.push({id:s,handler:e}),n||3!=this._mode||this._socket.send(JSON.stringify({action:\"subscribe\",name:t})),{name:t,id:s}}_resubscribe(){if(3==this._mode)for(const t in this._events)this._socket.send(JSON.stringify({action:\"subscribe\",name:t}))}detach(t){if(!t){if(3==this._mode)for(const t in this._events)this._socket.send(JSON.stringify({action:\"unsubscribe\",key:t}));return void(this._events={})}const{id:e,name:s}=t,i=this._events[s];if(i){const t=i.filter(t=>t.id!=e);t.length?this._events[s]=t:(delete this._events[s],3==this._mode&&this._socket.send(JSON.stringify({action:\"unsubscribe\",name:s})))}}fire(t,e){const s=this._events[t];if(s)for(let t=0;t<s.length;t++)s[t].handler(e)}onError(t){return null}onCall(t,e){}onResponse(t,e){}}export{t as Client};\n//# sourceMappingURL=remote.es6.js.map\n","import * as remote_client from \"remote-client\";\r\nexport const remoteEvents = function(url, token) {\r\n    const remote = new remote_client.Client({\r\n      url,\r\n      token\r\n    });\r\n\r\n    // temporary patch, as we do not want credentials\r\n    remote.fetch = function (url, body) {\r\n      const req = {\r\n        headers: this.headers()\r\n      };\r\n      if (body) {\r\n        req.method = \"POST\";\r\n        req.body = body;\r\n      }\r\n\r\n      return fetch(url, req).then((res) => res.json());\r\n    };\r\n\r\n    this._ready = remote.load().then((back) => (this._remote = back));\r\n\r\n    function ready() {\r\n      return this._ready;\r\n    }\r\n  \r\n    function on(name, handler) {\r\n      this.ready().then((back) => {\r\n        if (typeof name === \"string\") back.on(name, handler);\r\n        else {\r\n          for (const key in name) {\r\n            back.on(key, name[key]);\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    this.ready = ready;\r\n    this.on = on;\r\n  };\r\n\r\n","function checkTimeout(host, updPerSecond){\r\n\tif (!updPerSecond)\r\n\t\treturn true;\r\n\t\r\n\tif (host._on_timeout)\r\n\t\treturn false;\r\n\t\r\n\tvar timeout = Math.ceil(1000/updPerSecond);\r\n\tif (timeout < 2) return true;\r\n\r\n\tsetTimeout(function(){\r\n\t\tdelete host._on_timeout;\r\n\t}, timeout);\r\n\r\n\thost._on_timeout = true;\r\n\treturn true;\r\n}\r\n\r\nexport default checkTimeout;","import eventable from \"../../utils/eventable\";\r\nimport * as utils from \"../../utils/utils\";\r\nimport timeout from \"../../utils/timeout\";\r\nimport global from \"../../utils/global\";\r\nimport * as domHelpers from \"../ui/utils/dom_helpers\";\r\n\r\nexport default function(gantt){\r\n\r\n\tfunction copyDomEvent(e){\r\n\t\treturn {\r\n\t\t\ttarget: e.target || e.srcElement,\r\n\t\t\tpageX: e.pageX,\r\n\t\t\tpageY: e.pageY,\r\n\t\t\tclientX: e.clientX,\r\n\t\t\tclientY: e.clientY,\r\n\t\t\tmetaKey: e.metaKey,\r\n\t\t\tshiftKey: e.shiftKey,\r\n\t\t\tctrlKey: e.ctrlKey,\r\n\t\t\taltKey: e.altKey\r\n\t\t};\r\n\t}\r\n\r\n\tfunction DnD(obj, config) {\r\n\t\tthis._obj = obj;\r\n\t\tthis._settings = config || {};\r\n\t\teventable(this);\r\n\r\n\t\tvar inputMethods = this.getInputMethods();\r\n\r\n\t\tthis._drag_start_timer = null;\r\n\t\tgantt.attachEvent(\"onGanttScroll\", utils.bind(function (left, top) {\r\n\t\t\tthis.clearDragTimer();\r\n\t\t}, this));\r\n\r\n\t\tvar lastDown = 0;\r\n\t\tvar eventParams = {passive: false};\r\n\t\tfor(var i = 0; i < inputMethods.length; i++){\r\n\t\t\t(utils.bind(function(input){\r\n\r\n\t\t\t\tgantt.event(obj, input.down, utils.bind(function (e) {\r\n\t\t\t\t\tif(!input.accessor(e)){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (typeof e.button !== 'undefined' && e.button !== 0) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(config.preventDefault && config.selector && domHelpers.closest(e.target, config.selector)){\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (gantt.config.touch && e.timeStamp && e.timeStamp - lastDown < 300) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis._settings.original_target = copyDomEvent(e);\r\n\r\n\t\t\t\t\tthis._settings.original_element_sizes = {\r\n\t\t\t\t\t\t...domHelpers.getRelativeEventPosition(e, domHelpers.getClosestSizedElement(obj)), \r\n\t\t\t\t\t\twidth: e.target.offsetWidth,\r\n\t\t\t\t\t\theight: e.target.offsetHeight\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tif (gantt.config.touch) {\r\n\t\t\t\t\t\tlet actualTarget = e.target; // for ShadowDOM (GS-2409)\r\n\t\t\t\t\t\tthis.clearDragTimer();\r\n\t\t\t\t\t\tthis._drag_start_timer = setTimeout(utils.bind(function () {\r\n\t\t\t\t\t\t\tif(gantt.getState().lightbox){\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis.dragStart(obj, e, input, actualTarget);\r\n\t\t\t\t\t\t}, this), gantt.config.touch_drag);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis.dragStart(obj, e, input);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, this), eventParams);\r\n\t\t\t\tvar eventElement = document.body;\r\n\t\t\t\tgantt.event(eventElement, input.up, utils.bind(function (e) {\r\n\t\t\t\t\tif(!input.accessor(e)){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.clearDragTimer();\r\n\t\t\t\t}, this), eventParams);\r\n\r\n\t\t\t}, this))(inputMethods[i]);\r\n\t\t}\r\n\t}\r\n\r\n\tDnD.prototype = {\r\n\t\ttraceDragEvents: function (domElement, inputMethod) {\r\n\t\t\tvar mousemove = utils.bind(function (e) {\r\n\t\t\t\treturn this.dragMove(domElement, e, inputMethod.accessor);\r\n\t\t\t}, this);\r\n\t\t\tutils.bind(function (e) {\r\n\t\t\t\treturn this.dragScroll(domElement, e);\r\n\t\t\t}, this);\r\n\r\n\t\t\tvar limited_mousemove = utils.bind(function (e) {\r\n\t\t\t\tif (this.config.started && utils.defined(this.config.updates_per_second)) {\r\n\t\t\t\t\tif (!timeout(this, this.config.updates_per_second))\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar dndActive = mousemove(e);\r\n\r\n\t\t\t\tif (dndActive) {\r\n\t\t\t\t\ttry{\r\n\t\t\t\t\t\tif (e && e.preventDefault && e.cancelable){//e.cancelable condition - because navigator.vibrate is blocked by Chrome\r\n\t\t\t\t\t\t\te.preventDefault();//Cancel default action on DND\r\n\t\t\t\t\t\t} //Cancel default action on DND\r\n\t\t\t\t\t}catch (e){\r\n\t\t\t\t\t\t// just suppress the exception, nothing needed to be done here\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//e.cancelBubble = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn dndActive;\r\n\t\t\t}, this);\r\n\t\t\tvar eventElement = domHelpers.getRootNode(gantt.$root);\r\n\t\t\tvar mousemoveContainer = this.config.mousemoveContainer || domHelpers.getRootNode(gantt.$root);\r\n\r\n\t\t\tvar eventParams = {passive: false};\r\n\t\t\tvar mouseup = utils.bind(function (e) {\r\n\t\t\t\tgantt.eventRemove(mousemoveContainer, inputMethod.move, limited_mousemove);\r\n\t\t\t\tgantt.eventRemove(eventElement, inputMethod.up, mouseup, eventParams);\r\n\t\t\t\treturn this.dragEnd(domElement);\r\n\t\t\t}, this);\r\n\r\n\t\t\tgantt.event(mousemoveContainer, inputMethod.move, limited_mousemove, eventParams);\r\n\t\t\tgantt.event(eventElement, inputMethod.up, mouseup, eventParams);\r\n\t\t},\r\n\t\tcheckPositionChange: function (pos) {\r\n\t\t\tvar diff_x = pos.x - this.config.pos.x;\r\n\t\t\tvar diff_y = pos.y - this.config.pos.y;\r\n\t\t\tvar distance = Math.sqrt(Math.pow(Math.abs(diff_x), 2) + Math.pow(Math.abs(diff_y), 2));\r\n\r\n\t\t\tif (distance > this.config.sensitivity) {\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t},\r\n\t\tinitDnDMarker: function () {\r\n\t\t\t// create dnd placeholder and put it in dom\r\n\t\t\tvar marker = this.config.marker = document.createElement(\"div\");\r\n\t\t\tmarker.className = \"gantt_drag_marker\";\r\n\t\t\t// GS-1333: don't show any message when we resize grid columns\r\n\t\t\tmarker.innerHTML = \"\";\r\n\t\t\tdocument.body.appendChild(marker);\r\n\t\t},\r\n\t\tbackupEventTarget: function (domEvent, getEvent, actualTarget) {\r\n\t\t\tif (!gantt.config.touch) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// keep original event target in DOM in order to keep dnd on touchmove event\r\n\t\t\tvar e = getEvent(domEvent);\r\n\r\n\t\t\t// GS-2409. We need the target element when Gantt is inside ShadowDOM\r\n\t\t\tlet el = e.target || e.srcElement;\r\n\t\t\tif (el.shadowRoot && actualTarget) {\r\n\t\t\t\tel = actualTarget;\r\n\t\t\t}\r\n\r\n\t\t\tvar copy = el.cloneNode(true);\r\n\t\t\t//this.config.target.target = copy;\r\n\t\t\tthis.config.original_target = copyDomEvent(e);\r\n\t\t\tthis.config.original_target.target = copy;\r\n\t\t\tthis.config.backup_element = el;\r\n\t\t\tel.parentNode.appendChild(copy);\r\n\r\n\t\t\tel.style.display = \"none\";\r\n\t\t\tconst mousemoveContainer = this.config.mousemoveContainer || gantt.$root || document.body;\r\n\t\t\tmousemoveContainer.appendChild(el);\r\n\t\t},\r\n\t\tgetInputMethods: function () {\r\n\t\t\t// bind actions to browser events\r\n\t\t\tvar inputMethods = [];\r\n\r\n\t\t\tinputMethods.push({\r\n\t\t\t\t\"move\": \"mousemove\",\r\n\t\t\t\t\"down\": \"mousedown\",\r\n\t\t\t\t\"up\": \"mouseup\",\r\n\t\t\t\t\"accessor\": function (e) {\r\n\t\t\t\t\treturn e;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (gantt.config.touch) {\r\n\t\t\t\tconst touchEventsSupported = !gantt.env.isIE || !!global.maxTouchPoints;\r\n\r\n\t\t\t\tif(touchEventsSupported){\r\n\t\t\t\t\tinputMethods.push({\r\n\t\t\t\t\t\t\"move\": \"touchmove\",\r\n\t\t\t\t\t\t\"down\": \"touchstart\",\r\n\t\t\t\t\t\t\"up\": \"touchend\",\r\n\t\t\t\t\t\t\"accessor\": function (ev) {\r\n\t\t\t\t\t\t\tif (ev.touches && ev.touches.length > 1) return null;\r\n\t\t\t\t\t\t\tif (ev.touches[0])\r\n\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\ttarget: document.elementFromPoint(ev.touches[0].clientX, ev.touches[0].clientY),\r\n\t\t\t\t\t\t\t\t\tpageX: ev.touches[0].pageX,\r\n\t\t\t\t\t\t\t\t\tpageY: ev.touches[0].pageY,\r\n\t\t\t\t\t\t\t\t\tclientX: ev.touches[0].clientX,\r\n\t\t\t\t\t\t\t\t\tclientY: ev.touches[0].clientY\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\treturn ev;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}else if(global.PointerEvent){\r\n\t\t\t\t\tinputMethods.push({\r\n\t\t\t\t\t\t\"move\": \"pointermove\",\r\n\t\t\t\t\t\t\"down\": \"pointerdown\",\r\n\t\t\t\t\t\t\"up\": \"pointerup\",\r\n\t\t\t\t\t\t\"accessor\": function (ev) {\r\n\t\t\t\t\t\t\tif (ev.pointerType == \"mouse\") return null;\r\n\t\t\t\t\t\t\treturn ev;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn inputMethods;\r\n\t\t},\r\n\t\tclearDragTimer: function () {\r\n\t\t\tif (this._drag_start_timer) {\r\n\t\t\t\tclearTimeout(this._drag_start_timer);\r\n\t\t\t\tthis._drag_start_timer = null;\r\n\t\t\t}\r\n\t\t},\r\n\t\tdragStart: function (obj, e, inputMethod, actualTarget) {\r\n\t\t\tif (this.config && this.config.started) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.config = {\r\n\t\t\t\tobj: obj,\r\n\t\t\t\tmarker: null,\r\n\t\t\t\tstarted: false,\r\n\t\t\t\tpos: this.getPosition(e),\r\n\t\t\t\tsensitivity: 4\r\n\t\t\t};\r\n\t\t\tif (this._settings)\r\n\t\t\t\tutils.mixin(this.config, this._settings, true);\r\n\r\n\r\n\t\t\tthis.traceDragEvents(obj, inputMethod);\r\n\r\n\t\t\tgantt._prevent_touch_scroll = true;\r\n\t\t\t// GS-2664. Prevent grid scroll only if we can reorder rows\r\n\t\t\tif (e.target.closest(\".gantt_row\") && !gantt.config.order_branch){\r\n\t\t\t\tgantt._prevent_touch_scroll = false;\r\n\t\t\t}\r\n\t\t\tdocument.body.classList.add(\"gantt_noselect\");\r\n\r\n\t\t\tif (gantt.config.touch) {\r\n\t\t\t\tthis.dragMove(obj, e, inputMethod.accessor, actualTarget);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tdragMove: function (obj, e, getEvent, actualTarget) {\r\n\t\t\tvar source = getEvent(e);\r\n\t\t\tif (!source) return false;\r\n\r\n\t\t\tif (!this.config.marker && !this.config.started) {\r\n\t\t\t\tvar pos = this.getPosition(source);\r\n\r\n\t\t\t\tif (gantt.config.touch || this.checkPositionChange(pos)) {\r\n\t\t\t\t\t// real drag starts here,\r\n\t\t\t\t\t// when user moves mouse at first time after onmousedown\r\n\t\t\t\t\tthis.config.started = true;\r\n\t\t\t\t\tthis.config.ignore = false;\r\n\t\t\t\t\tgantt._touch_drag = true;\r\n\t\t\t\t\tif (this.callEvent(\"onBeforeDragStart\", [obj, this.config.original_target]) === false) {\r\n\t\t\t\t\t\tthis.config.ignore = true;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.backupEventTarget(e, getEvent, actualTarget);\r\n\t\t\t\t\tthis.initDnDMarker();\r\n\t\t\t\t\tgantt._touch_feedback();\r\n\t\t\t\t\tthis.callEvent(\"onAfterDragStart\", [obj, this.config.original_target]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.config.ignore = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!this.config.ignore) {\r\n\t\t\t\t// GS-1279 Gantt crashes on Mobile Firefox after starting to create a link and moving finger outisde the page.\r\n\t\t\t\tif (e.targetTouches && !source.target) return;\r\n\t\t\t\tconst rootNode = gantt.$root.getRootNode();\r\n\t\t\t\tconst insideShadowDOM = rootNode instanceof ShadowRoot;\r\n\t\t\t\tif (insideShadowDOM){\r\n\t\t\t\t\t// second condition is necessary for tests and running Gantt from HTML page\r\n\t\t\t\t\tif (actualTarget && Object.getOwnPropertyDescriptor(source, \"target\")){\r\n\t\t\t\t\t\tsource.target = actualTarget;\r\n\t\t\t\t\t} else if (rootNode.elementFromPoint && e.targetTouches){\r\n\t\t\t\t\t\tconst touch = e.targetTouches[0];\r\n\t\t\t\t\t\tsource.target = rootNode.elementFromPoint(touch.clientX, touch.clientY);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tsource.pos = this.getPosition(source);\r\n\t\t\t\tthis.config.marker.style.left = source.pos.x + \"px\";\r\n\t\t\t\tthis.config.marker.style.top = source.pos.y + \"px\";\r\n\t\t\t\tthis.callEvent(\"onDragMove\", [obj, source, actualTarget]);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\tdragEnd: function (obj) {\r\n\t\t\tvar target = this.config.backup_element;\r\n\t\t\tif (target && target.parentNode) {\r\n\t\t\t\ttarget.parentNode.removeChild(target);\r\n\t\t\t}\r\n\t\t\tgantt._prevent_touch_scroll = false;\r\n\t\t\tif (this.config.marker) {\r\n\t\t\t\tthis.config.marker.parentNode.removeChild(this.config.marker);\r\n\t\t\t\tthis.config.marker = null;\r\n\r\n\t\t\t\tthis.callEvent(\"onDragEnd\", []);\r\n\t\t\t}\r\n\t\t\tthis.config.started = false;\r\n\t\t\tgantt._touch_drag = false;\r\n\t\t\tdocument.body.classList.remove(\"gantt_noselect\");\r\n\t\t},\r\n\r\n\t\tgetPosition: function (e) {\r\n\t\t\tvar x = 0, y = 0;\r\n\t\t\tif (e.pageX || e.pageY) {\r\n\t\t\t\tx = e.pageX;\r\n\t\t\t\ty = e.pageY;\r\n\t\t\t} else if (e.clientX || e.clientY) {\r\n\t\t\t\tx = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;\r\n\t\t\t\ty = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;\r\n\t\t\t}\r\n\t\t\treturn {x: x, y: y};\r\n\t\t}\r\n\t};\r\n\r\n\treturn DnD;\r\n};\r\n","export default function(gantt) {\r\n\r\n\tvar regTemplates = {};\r\n\r\n\tfunction initTemplate(name, initial, template_name) {\r\n\t\ttemplate_name = template_name || name;\r\n\t\tvar config = gantt.config,\r\n\t\t\ttemplates = gantt.templates;\r\n\r\n\t\tif (gantt.config[name] && regTemplates[template_name] != config[name]) {\r\n\t\t\tif (!(initial && templates[template_name])) {\r\n\t\t\t\ttemplates[template_name] = gantt.date.date_to_str(config[name]);\r\n\t\t\t\tregTemplates[template_name] = config[name];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction initTemplates() {\r\n\t\tvar date = gantt.date;\r\n\r\n\t\t//build configuration based templates\r\n\t\tvar d = date.date_to_str;\r\n\t\tvar c = gantt.config;\r\n\t\tvar format_date = d(c.xml_date || c.date_format, c.server_utc);\r\n\t\tvar parse_date = date.str_to_date(c.xml_date || c.date_format, c.server_utc);\r\n\r\n\t\tinitTemplate(\"date_scale\", true, undefined, gantt.config, gantt.templates);\r\n\t\tinitTemplate(\"date_grid\", true, \"grid_date_format\", gantt.config, gantt.templates);\r\n\t\tinitTemplate(\"task_date\", true, undefined, gantt.config, gantt.templates);\r\n\r\n\t\tgantt.mixin(gantt.templates, {\r\n\t\t\txml_format: undefined, // deprecated\r\n\t\t\tformat_date: format_date,\r\n\r\n\t\t\txml_date: undefined, // deprecated\r\n\t\t\tparse_date: parse_date,\r\n\r\n\t\t\tprogress_text: function (start, end, task) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\tgrid_header_class: function (column, config) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\r\n\t\t\ttask_text: function (start, end, task) {\r\n\t\t\t\treturn task.text;\r\n\t\t\t},\r\n\t\t\ttask_class: function (start, end, task) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\ttask_end_date: function (date) {\r\n\t\t\t\treturn gantt.templates.task_date(date);\r\n\t\t\t},\r\n\t\t\tgrid_row_class: function (start, end, task) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\ttask_row_class: function (start, end, task) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\ttimeline_cell_class: function (item, date) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\ttimeline_cell_content: function (item, date) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\tscale_cell_class: function (date) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\tscale_row_class: function (date) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\r\n\t\t\tgrid_indent: function (item) {\r\n\t\t\t\treturn \"<div class='gantt_tree_indent'></div>\";\r\n\t\t\t},\r\n\t\t\tgrid_folder: function (item) {\r\n\t\t\t\treturn \"<div class='gantt_tree_icon gantt_folder_\" + (item.$open ? \"open\" : \"closed\") + \"'></div>\";\r\n\t\t\t},\r\n\t\t\tgrid_file: function (item) {\r\n\t\t\t\treturn \"<div class='gantt_tree_icon gantt_file'></div>\";\r\n\t\t\t},\r\n\t\t\tgrid_open: function (item) {\r\n\t\t\t\treturn \"<div class='gantt_tree_icon gantt_\" + (item.$open ? \"close\" : \"open\") + \"'></div>\";\r\n\t\t\t},\r\n\t\t\tgrid_blank: function (item) {\r\n\t\t\t\treturn \"<div class='gantt_tree_icon gantt_blank'></div>\";\r\n\t\t\t},\r\n\t\t\tdate_grid: function (date, item, column) {\r\n\t\t\t\tif (item && gantt.isUnscheduledTask(item) && gantt.config.show_unscheduled) {\r\n\t\t\t\t\treturn gantt.templates.task_unscheduled_time(item);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn gantt.templates.grid_date_format(date, column);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\ttask_time: function (start, end, ev) {\r\n\t\t\t\tif (gantt.isUnscheduledTask(ev) && gantt.config.show_unscheduled) {\r\n\t\t\t\t\treturn gantt.templates.task_unscheduled_time(ev);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn gantt.templates.task_date(start) + \" - \" + gantt.templates.task_end_date(end);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\ttask_unscheduled_time: function (task) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\r\n\t\t\ttime_picker: d(c.time_picker),\r\n\t\t\tlink_class: function (link) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\tlink_description: function (link) {\r\n\t\t\t\tvar from = gantt.getTask(link.source),\r\n\t\t\t\t\tto = gantt.getTask(link.target);\r\n\r\n\t\t\t\treturn \"<b>\" + from.text + \"</b> &ndash;  <b>\" + to.text + \"</b>\";\r\n\t\t\t},\r\n\r\n\t\t\tdrag_link: function (from, from_start, to, to_start) {\r\n\t\t\t\tfrom = gantt.getTask(from);\r\n\t\t\t\tvar labels = gantt.locale.labels;\r\n\r\n\t\t\t\tvar text = \"<b>\" + from.text + \"</b> \" + (from_start ? labels.link_start : labels.link_end) + \"<br/>\";\r\n\t\t\t\tif (to) {\r\n\t\t\t\t\tto = gantt.getTask(to);\r\n\t\t\t\t\ttext += \"<b> \" + to.text + \"</b> \" + (to_start ? labels.link_start : labels.link_end) + \"<br/>\";\r\n\t\t\t\t}\r\n\t\t\t\treturn text;\r\n\t\t\t},\r\n\t\t\tdrag_link_class: function (from, from_start, to, to_start) {\r\n\t\t\t\tvar add = \"\";\r\n\r\n\t\t\t\tif (from && to) {\r\n\t\t\t\t\tvar allowed = gantt.isLinkAllowed(from, to, from_start, to_start);\r\n\t\t\t\t\tadd = \" \" + (allowed ? \"gantt_link_allow\" : \"gantt_link_deny\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn \"gantt_link_tooltip\" + add;\r\n\t\t\t},\r\n\r\n\t\t\t/* used for aria-labels of bar elements and for tooltip.js */\r\n\t\t\ttooltip_date_format: date.date_to_str(\"%Y-%m-%d\"),\r\n\t\t\ttooltip_text: function (start, end, event) {\r\n\t\t\t\treturn `<div>Task: ${event.text}</div>\r\n\t\t\t\t<div>Start date: ${gantt.templates.tooltip_date_format(start)}</div>\r\n\t\t\t\t<div>End date: ${gantt.templates.tooltip_date_format(end)}</div>`;\r\n\t\t\t},\r\n\t\t\tbaseline_text: function (task, baseline, index) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\treturn {\r\n\t\tinitTemplates: initTemplates,\r\n\t\tinitTemplate: initTemplate\r\n\t};\r\n\r\n};","import * as utils from \"../../utils/utils\";\r\n\r\nvar StateService = (function(){\r\n\tvar stateProviders = {};\r\n\r\n\tfunction getState(name){\r\n\t\tvar provider = stateProviders[name];\r\n\t\tif(provider){\r\n\t\t\treturn stateProviders[name].method();\r\n\t\t}else{\r\n\t\t\tvar res = {};\r\n\t\t\tfor(var i in stateProviders){\r\n\t\t\t\tif(!stateProviders[i].internal)\r\n\t\t\t\t\tutils.mixin(res, stateProviders[i].method(), true);\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction registerProvider(name, provider, internal){\r\n\t\tstateProviders[name] = { method: provider, internal: internal};\r\n\t}\r\n\r\n\tfunction unregisterProvider(name){\r\n\t\tdelete stateProviders[name];\r\n\t}\r\n\r\n\treturn {\r\n\t\tgetState: getState,\r\n\t\tregisterProvider: registerProvider,\r\n\t\tunregisterProvider: unregisterProvider\r\n\t};\r\n});\r\n\r\nexport default StateService;\r\n\r\n","export default Promise;","import * as utils from \"../../utils/utils\";\r\nimport {replaceValidZeroId} from \"../../utils/helpers\";\r\n\r\nvar createTasksDatastoreFacade = function(){\r\n\treturn {\r\n\tgetTask: function (id) {\r\n\t\tid = replaceValidZeroId(id, this.config.root_id);\r\n\t\tthis.assert(id, \"Invalid argument for gantt.getTask\");\r\n\t\tvar task = this.$data.tasksStore.getItem(id);\r\n\t\tthis.assert(task, \"Task not found id=\" + id);\r\n\t\treturn task;\r\n\t},\r\n\tgetTaskByTime: function (from, to) {\r\n\t\tvar p = this.$data.tasksStore.getItems();\r\n\r\n\t\tvar res = [];\r\n\r\n\t\tif (!(from || to)) {\r\n\t\t\tres = p;\r\n\t\t} else {\r\n\t\t\tfrom = +from || -Infinity;\r\n\t\t\tto = +to || Infinity;\r\n\t\t\tfor (var t = 0; t < p.length; t++){\r\n\t\t\t\tvar task = p[t];\r\n\t\t\t\tif (+task.start_date < to && +task.end_date > from)\r\n\t\t\t\t\tres.push(task);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn res;\r\n\t},\r\n\tisTaskExists: function (id) {\r\n\t\tif(!this.$data || !this.$data.tasksStore){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn this.$data.tasksStore.exists(id);\r\n\t},\r\n\tupdateTask: function (id, item) {\r\n\t\tif (!utils.defined(item)) item = this.getTask(id);\r\n\t\tthis.$data.tasksStore.updateItem(id, item);\r\n\t\tif(this.isTaskExists(id))\r\n\t\t\tthis.refreshTask(id);\r\n\t},\r\n\taddTask: function (item, parent, index) {\r\n\t\tif (!utils.defined(item.id))\r\n\t\t\titem.id = utils.uid();\r\n\r\n\t\t//GS-761: assert unique ID\r\n\t\tif (this.isTaskExists(item.id)){\r\n\t\t\tvar task = this.getTask(item.id);\r\n\t\t\tif (task.$index != item.$index) {\r\n\t\t\t\t// Someone may try to mistakenly add a task with the same ID, and most likely\r\n\t\t\t\t// use the string format for the dates. Gantt shouldn't break in this scenario\r\n\t\t\t\tif (item.start_date && typeof item.start_date === \"string\"){\r\n\t\t\t\t\titem.start_date = this.date.parseDate(item.start_date, \"parse_date\");\r\n\t\t\t\t}\r\n\t\t\t\tif (item.end_date && typeof item.end_date === \"string\"){\r\n\t\t\t\t\titem.end_date = this.date.parseDate(item.end_date, \"parse_date\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn this.$data.tasksStore.updateItem(item.id, item);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tif (!utils.defined(parent)) parent = this.getParent(item) || 0;\r\n\t\tif (!this.isTaskExists(parent)) parent = this.config.root_id;\r\n\t\tthis.setParent(item, parent);\r\n\r\n\t\t// GS-1583. Save the $open state to the Undo Stack\r\n\t\tif (this.getState().lightbox && this.isTaskExists(parent)) {\r\n\t\t\tvar parentObj = this.getTask(parent);\r\n\t\t\tthis.callEvent(\"onAfterParentExpand\", [parent, parentObj]);\r\n\t\t}\r\n\t\treturn this.$data.tasksStore.addItem(item, index, parent);\r\n\t},\r\n\tdeleteTask: function (id) {\r\n\t\tid = replaceValidZeroId(id, this.config.root_id);\r\n\t\treturn this.$data.tasksStore.removeItem(id);\r\n\t},\r\n\tgetTaskCount: function () {\r\n\t\treturn this.$data.tasksStore.count();\r\n\t},\r\n\tgetVisibleTaskCount: function () {\r\n\t\treturn this.$data.tasksStore.countVisible();\r\n\t},\r\n\tgetTaskIndex: function (id) {\r\n\t\treturn this.$data.tasksStore.getBranchIndex(id);\r\n\t},\r\n\tgetGlobalTaskIndex: function (id) {\r\n\t\tid = replaceValidZeroId(id, this.config.root_id);\r\n\t\tthis.assert(id, \"Invalid argument\");\r\n\t\treturn this.$data.tasksStore.getIndexById(id);\r\n\t},\r\n\teachTask: function (code, parent, master) {\r\n\t\treturn this.$data.tasksStore.eachItem(utils.bind(code, master||this), parent);\r\n\t},\r\n\teachParent: function (callback, startTask, master) {\r\n\t\treturn this.$data.tasksStore.eachParent(utils.bind(callback, master || this), startTask);\r\n\t},\r\n\tchangeTaskId: function (oldid, newid) {\r\n\t\tthis.$data.tasksStore.changeId(oldid, newid);\r\n\t\tvar task = this.$data.tasksStore.getItem(newid);\r\n\r\n\t\tvar links = [];\r\n\r\n\t\tif (task.$source) {\r\n\t\t\tlinks = links.concat(task.$source);\r\n\t\t}\r\n\t\tif (task.$target) {\r\n\t\t\tlinks = links.concat(task.$target);\r\n\t\t}\r\n\r\n\t\tfor (var i = 0; i < links.length; i++) {\r\n\t\t\tvar link = this.getLink(links[i]);\r\n\t\t\tif (link.source == oldid) {\r\n\t\t\t\tlink.source = newid;\r\n\t\t\t}\r\n\t\t\tif (link.target == oldid) {\r\n\t\t\t\tlink.target = newid;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tcalculateTaskLevel: function (item) {\r\n\t\treturn this.$data.tasksStore.calculateItemLevel(item);\r\n\t},\r\n\tgetNext: function (id) {\r\n\t\treturn this.$data.tasksStore.getNext(id);\r\n\t},\r\n\tgetPrev: function (id) {\r\n\t\treturn this.$data.tasksStore.getPrev(id);\r\n\t},\r\n\tgetParent: function (id) {\r\n\t\treturn this.$data.tasksStore.getParent(id);\r\n\t},\r\n\tsetParent: function (task, new_pid, silent) {\r\n\t\treturn this.$data.tasksStore.setParent(task, new_pid, silent);\r\n\t},\r\n\tgetSiblings: function (id) {\r\n\t\treturn this.$data.tasksStore.getSiblings(id).slice();\r\n\t},\r\n\tgetNextSibling: function (id) {\r\n\t\treturn this.$data.tasksStore.getNextSibling(id);\r\n\t},\r\n\tgetPrevSibling: function (id) {\r\n\t\treturn this.$data.tasksStore.getPrevSibling(id);\r\n\t},\r\n\tgetTaskByIndex: function(index){\r\n\t\tvar id = this.$data.tasksStore.getIdByIndex(index);\r\n\t\tif(this.isTaskExists(id)){\r\n\t\t\treturn this.getTask(id);\r\n\t\t}else{\r\n\t\t\treturn null;\r\n\t\t}\r\n\t},\r\n\tgetChildren: function (id) {\r\n\t\tif(!this.hasChild(id)){\r\n\t\t\treturn [];\r\n\t\t}else{\r\n\t\t\treturn this.$data.tasksStore.getChildren(id).slice();\r\n\t\t}\r\n\t},\r\n\thasChild: function (id) {\r\n\t\treturn this.$data.tasksStore.hasChild(id);\r\n\t},\r\n\topen: function (id) {\r\n\t\tthis.$data.tasksStore.open(id);\r\n\t},\r\n\tclose: function (id) {\r\n\t\tthis.$data.tasksStore.close(id);\r\n\t},\r\n\tmoveTask: function (sid, tindex, parent) {\r\n\t\tparent = replaceValidZeroId(parent, this.config.root_id);\r\n\t\treturn this.$data.tasksStore.move.apply(this.$data.tasksStore, arguments);\r\n\t},\r\n\tsort: function(field, desc, parent, silent) {\r\n\t\tvar render = !silent;//4th argument to cancel redraw after sorting\r\n\r\n\t\tthis.$data.tasksStore.sort(field, desc, parent);\r\n\t\tthis.callEvent(\"onAfterSort\", [field, desc, parent]);\r\n\r\n\t\tif (render) {\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t}\r\n};\r\n};\r\n\r\nexport default createTasksDatastoreFacade;\r\n\r\n\r\n","import * as utils from \"../../utils/utils\";\r\n\r\n\r\nvar createLinksStoreFacade = function(){\r\n\treturn {\r\n\tgetLinkCount: function () {\r\n\t\treturn this.$data.linksStore.count();\r\n\t},\r\n\r\n\tgetLink : function (id) {\r\n\t\treturn this.$data.linksStore.getItem(id);\r\n\t},\r\n\r\n\tgetLinks : function () {\r\n\t\treturn this.$data.linksStore.getItems();\r\n\t},\r\n\r\n\tisLinkExists : function (id) {\r\n\t\treturn this.$data.linksStore.exists(id);\r\n\t},\r\n\r\n\taddLink : function (link) {\r\n\t\treturn this.$data.linksStore.addItem(link);\r\n\t},\r\n\r\n\tupdateLink : function (id, data) {\r\n\t\tif (!utils.defined(data))\r\n\t\t\tdata = this.getLink(id);\r\n\t\tthis.$data.linksStore.updateItem(id, data);\r\n\t},\r\n\r\n\tdeleteLink : function (id) {\r\n\t\treturn this.$data.linksStore.removeItem(id);\r\n\t},\r\n\r\n\tchangeLinkId : function (oldid, newid) {\r\n\t\treturn this.$data.linksStore.changeId(oldid, newid);\r\n\t}\r\n};\r\n};\r\n\r\nexport default createLinksStoreFacade;","import * as utils from \"../../utils/utils\";\r\n\r\nvar $powerArray  = {\r\n\t$create: function(array){\r\n\t\treturn utils.mixin(array || [], this);\r\n\t},\r\n\t//remove element at specified position\r\n\t$removeAt:function(pos,len){\r\n\t\tif (pos>=0) this.splice(pos,(len||1));\r\n\t},\r\n\t//find element in collection and remove it\r\n\t$remove:function(value){\r\n\t\tthis.$removeAt(this.$find(value));\r\n\t},\r\n\t//add element to collection at specific position\r\n\t$insertAt:function(data,pos){\r\n\t\tif (!pos && pos!==0) \t//add to the end by default\r\n\t\t\tthis.push(data);\r\n\t\telse {\r\n\t\t\tvar b = this.splice(pos,(this.length-pos));\r\n\t\t\tthis[pos] = data;\r\n\t\t\tthis.push.apply(this,b); //reconstruct array without loosing this pointer\r\n\t\t}\r\n\t},\r\n\t//return index of element, -1 if it doesn't exists\r\n\t$find:function(data){\r\n\t\tfor (var i=0; i<this.length; i++)\r\n\t\t\tif (data==this[i]) return i;\r\n\t\treturn -1;\r\n\t},\r\n\t//execute some method for each element of array\r\n\t$each:function(functor,master){\r\n\t\tfor (var i=0; i < this.length; i++)\r\n\t\t\tfunctor.call((master||this),this[i]);\r\n\t},\r\n\t//create new array from source, by using results of functor\r\n\t$map:function(functor,master){\r\n\t\tfor (var i=0; i < this.length; i++)\r\n\t\t\tthis[i]=functor.call((master||this),this[i]);\r\n\t\treturn this;\r\n\t},\r\n\t$filter:function(functor, master){\r\n\t\tfor (var i=0; i < this.length; i++)\r\n\t\t\tif (!functor.call((master||this),this[i])){\r\n\t\t\t\tthis.splice(i,1);\r\n\t\t\t\ti--;\r\n\t\t\t}\r\n\t\treturn this;\r\n\t}\r\n};\r\n\r\nexport default $powerArray;","/**\r\n * Check the over task or draggble task is placeholder task\r\n */\r\n\r\nexport default function isPlaceholderTask(id, gantt, store, config) {\r\n\t// return false;\r\n\tvar config = gantt ? gantt.config : config;\r\n\tif (config && config.placeholder_task) {\r\n\t\tif (store.exists(id)){\r\n\t\t\tvar item = store.getItem(id);\r\n\t\t\treturn item.type === config.types.placeholder;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n};","import powerArray from \"./power_array\";\r\nimport * as utils from \"../../utils/utils\";\r\nimport eventable from \"../../utils/eventable\";\r\nimport isPlaceholderTask from \"../../utils/placeholder_task\";\r\n\r\nvar DataStore = function(config){\r\n\tthis.pull = {};\r\n\tthis.$initItem = config.initItem;\r\n\tthis.visibleOrder = powerArray.$create();\r\n\tthis.fullOrder = powerArray.$create();\r\n\tthis._skip_refresh = false;\r\n\tthis._filterRule = null;\r\n\tthis._searchVisibleOrder = {};\r\n\tthis._indexRangeCache = {};\r\n\tthis._getItemsCache = null;\r\n\tthis.$config = config;\r\n\teventable(this);\r\n\r\n\tthis._attachDataChange(function(){\r\n\t\tthis._indexRangeCache = {};\r\n\t\tthis._getItemsCache = null;\r\n\t\treturn true;\r\n\t});\r\n\treturn this;\r\n};\r\nDataStore.prototype = {\r\n\r\n\t_attachDataChange: function(callback){\r\n\t\tthis.attachEvent(\"onClearAll\", callback);\r\n\t\tthis.attachEvent(\"onBeforeParse\", callback);\r\n\t\tthis.attachEvent(\"onBeforeUpdate\", callback);\r\n\t\tthis.attachEvent(\"onBeforeDelete\", callback);\r\n\t\tthis.attachEvent(\"onBeforeAdd\", callback);\r\n\t\tthis.attachEvent(\"onParse\", callback);\r\n\t\tthis.attachEvent(\"onBeforeFilter\", callback);\r\n\t},\r\n\t_parseInner: function(data){\r\n\t\tvar item = null,\r\n\t\t\tloaded = [];\r\n\t\tfor(var i = 0, len = data.length; i< len; i++){\r\n\t\t\titem = data[i];\r\n\t\t\tif(this.$initItem){\r\n\t\t\t\tif(this.$config.copyOnParse()){\r\n\t\t\t\t\titem = utils.copy(item);\r\n\t\t\t\t}\r\n\t\t\t\titem = this.$initItem(item);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(this.callEvent(\"onItemLoading\", [item])){\r\n\t\t\t\tif (!this.pull.hasOwnProperty(item.id)) {\r\n\t\t\t\t\tthis.fullOrder.push(item.id);\r\n\t\t\t\t}\r\n\t\t\t\tloaded.push(item);\r\n\t\t\t\tthis.pull[item.id] = item;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn loaded;\r\n\t},\r\n\tparse: function(data){\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tthis.callEvent(\"onBeforeParse\", [data]);\r\n\t\t}\r\n\t\tvar loaded = this._parseInner(data);\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tthis.refresh();\r\n\t\t\tthis.callEvent(\"onParse\", [loaded]);\r\n\t\t}\r\n\t},\r\n\tgetItem: function(id){\r\n\t\treturn this.pull[id];\r\n\t},\r\n\r\n\t_updateOrder: function(code){\r\n\t\tcode.call(this.visibleOrder);\r\n\t\tcode.call(this.fullOrder);\r\n\t},\r\n\tupdateItem: function(id, item){\r\n\t\tif (!utils.defined(item)) item = this.getItem(id);\r\n\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tif (this.callEvent(\"onBeforeUpdate\", [item.id, item]) === false) return false;\r\n\t\t}\r\n\t\t// This is how it worked before updating the properties:\r\n\t\t// this.pull[id]=item;\r\n\t\tutils.mixin(this.pull[id],item, true);\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tthis.callEvent(\"onAfterUpdate\", [item.id, item]);\r\n\t\t\tthis.callEvent(\"onStoreUpdated\", [item.id, item, \"update\"]);\r\n\t\t}\r\n\t},\r\n\r\n\t_removeItemInner: function(id){\r\n\t\t//clear from collections\r\n\t\t//this.visibleOrder.$remove(id);\r\n\t\tthis._updateOrder(function(){ this.$remove(id);});\r\n\t\tdelete this.pull[id];\r\n\t},\r\n\r\n\tremoveItem: function(id){\r\n\t\t//utils.assert(this.exists(id), \"Not existing ID in remove command\"+id);\r\n\r\n\t\tvar obj = this.getItem(id);\t//save for later event\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tif (this.callEvent(\"onBeforeDelete\", [obj.id, obj]) === false) return false;\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onAfterDeleteConfirmed\", [obj.id, obj]);\r\n\t\tthis._removeItemInner(id);\r\n\t\t\r\n\t\tif (this.isSilent()) {\r\n\t\t\tthis.callEvent(\"onAfterSilentDelete\", [obj.id, obj]);\r\n\t\t}\r\n\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tthis.filter();\r\n\t\t\tthis.callEvent(\"onAfterDelete\", [obj.id, obj]);\r\n\t\t\t//repaint signal\r\n\t\t\tthis.callEvent(\"onStoreUpdated\", [obj.id, obj, \"delete\"]);\r\n\t\t}\r\n\t},\r\n\r\n\t_addItemInner: function(item, index){\r\n\t\t//in case of treetable order is sent as 3rd parameter\r\n\t\t//var order = index;\r\n\r\n\t\tif(this.exists(item.id)){\r\n\t\t\tthis.silent(function(){this.updateItem(item.id, item);});\r\n\t\t}else{\r\n\t\t\tvar order = this.visibleOrder;\r\n\r\n\t\t\t//by default item is added to the end of the list\r\n\t\t\tvar data_size = order.length;\r\n\r\n\t\t\tif (!utils.defined(index) || index < 0)\r\n\t\t\t\tindex = data_size;\r\n\t\t\t//check to prevent too big indexes\r\n\t\t\tif (index > data_size){\r\n\t\t\t\t//dhx.log(\"Warning\",\"DataStore:add\",\"Index of out of bounds\");\r\n\t\t\t\tindex = Math.min(order.length,index);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\t//gantt.assert(!this.exists(id), \"Not unique ID\");\r\n\r\n\t\tthis.pull[item.id]=item;\r\n\t\tthis._updateOrder(function(){\r\n\t\t\tif(this.$find(item.id) === -1)\r\n\t\t\t\tthis.$insertAt(item.id,index);\r\n\t\t});\r\n\t\tthis.filter();\r\n\t\t//order.$insertAt(item.id,index);\r\n\t},\r\n\r\n\r\n\tisVisible: function(id){\r\n\t\treturn this.visibleOrder.$find(id) > -1;\r\n\t},\r\n\tgetVisibleItems: function(){\r\n\t\treturn this.getIndexRange();\r\n\t},\r\n\r\n\taddItem: function(item, index){\r\n\t\tif (!utils.defined(item.id))\r\n\t\t\titem.id = utils.uid();\r\n\r\n\t\tif(this.$initItem){\r\n\t\t\titem = this.$initItem(item);\r\n\t\t}\r\n\r\n\t\tif (!this.isSilent()){\r\n\t\t\tif (this.callEvent(\"onBeforeAdd\", [item.id, item]) === false) return false;\r\n\t\t}\r\n\r\n\r\n\t\tthis._addItemInner(item, index);\r\n\r\n\t\tif (!this.isSilent()){\r\n\t\t\tthis.callEvent(\"onAfterAdd\",[item.id, item]);\r\n\t\t\t//repaint signal\r\n\t\t\tthis.callEvent(\"onStoreUpdated\",[item.id,item,\"add\"]);\r\n\t\t} else {\r\n\t\t\tif(this.sync_link){\r\n\t\t\t\tthis.sync_link(item);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn item.id;\r\n\t},\r\n\r\n\t_changeIdInner: function(oldId, newId){\r\n\t\tif(this.pull[oldId])\r\n\t\t\tthis.pull[newId] = this.pull[oldId];\r\n\r\n\t\tvar visibleOrder = this._searchVisibleOrder[oldId];\r\n\t\tthis.pull[newId].id = newId;\r\n\t\tthis._updateOrder(function(){\r\n\t\t\tthis[this.$find(oldId)] = newId;\r\n\t\t});\r\n\t\tthis._searchVisibleOrder[newId] = visibleOrder;\r\n\t\tdelete this._searchVisibleOrder[oldId];\r\n\r\n\t\t//this.visibleOrder[this.visibleOrder.$find(oldId)]=newId;\r\n\t\tdelete this.pull[oldId];\r\n\t},\r\n\tchangeId: function(oldId, newId){\r\n\t\tthis._changeIdInner(oldId, newId);\r\n\r\n\t\tthis.callEvent(\"onIdChange\", [oldId, newId]);\r\n\r\n\t},\r\n\texists: function(id){\r\n\t\treturn !!(this.pull[id]);\r\n\t},\r\n\r\n\t_moveInner: function(sindex, tindex){\r\n\t\tvar id = this.getIdByIndex(sindex);\r\n\r\n\t\tthis._updateOrder(function(){\r\n\t\t\tthis.$removeAt(sindex);\r\n\t\t\tthis.$insertAt(id,Math.min(this.length, tindex));\r\n\t\t});\r\n\t\t//this.visibleOrder.$removeAt(sindex);\t//remove at old position\r\n\t\t//if (sindex<tindex) tindex--;\t//correct shift, caused by element removing\r\n\t\t//this.visibleOrder.$insertAt(id,Math.min(this.visibleOrder.length, tindex));\t//insert at new position\r\n\t},\r\n\r\n\tmove: function(sindex, tindex){\r\n\t\t//gantt.assert(sindex>=0 && tindex>=0, \"DataStore::move\",\"Incorrect indexes\");\r\n\r\n\t\tvar id = this.getIdByIndex(sindex);\r\n\t\tvar obj = this.getItem(id);\r\n\t\tthis._moveInner(sindex, tindex);\r\n\r\n\t\tif (!this.isSilent()) {\r\n\t\t\t//repaint signal\r\n\t\t\tthis.callEvent(\"onStoreUpdated\", [obj.id, obj, \"move\"]);\r\n\t\t}\r\n\t},\r\n\tclearAll: function(){\r\n\t\tif(this.$destroyed){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// GS-956 We need to unselect the resource as its ID is cached\r\n\t\tthis.silent(function(){\r\n\t\t\tthis.unselect();\r\n\t\t});\r\n\t\tthis.pull = {};\r\n\t\tthis.visibleOrder = powerArray.$create();\r\n\t\tthis.fullOrder = powerArray.$create();\r\n\t\tif (this.isSilent()) return;\r\n\t\tthis.callEvent(\"onClearAll\",[]);\r\n\t\tthis.refresh();\r\n\t},\r\n\r\n\tsilent:function(code, master){\r\n\t\tvar alreadySilent = false;\r\n\t\tif(this.isSilent()) {\r\n\t\t\talreadySilent = true;\r\n\t\t}\r\n\t\tthis._skip_refresh = true;\r\n\t\tcode.call(master||this);\r\n\t\t\r\n\t\tif (!alreadySilent) {\r\n\t\t\tthis._skip_refresh = false;\r\n\t\t}\r\n\t},\r\n\tisSilent: function(){\r\n\t\treturn !!this._skip_refresh;\r\n\t},\r\n\r\n\tarraysEqual: function (arr1, arr2) {\r\n\t\tif(arr1.length !== arr2.length)\r\n\t\t\treturn false;\r\n\t\tfor(var i = 0; i < arr1.length; i++) {\r\n\t\t\tif(arr1[i] !== arr2[i])\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\trefresh: function(id, quick){\r\n\t\tif(this.$destroyed){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.isSilent()) return;\r\n\r\n\t\tvar item;\r\n\t\tif(id){\r\n\t\t\titem = this.getItem(id);\r\n\t\t}\r\n\r\n\t\tvar args;\r\n\t\tif (id){\r\n\t\t\targs = [id, item, \"paint\"];\r\n\t\t}else{\r\n\t\t\targs = [null,null,null];\r\n\t\t}\r\n\r\n\t\tif(this.callEvent(\"onBeforeStoreUpdate\", args) === false){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar skipFilter = this._quick_refresh && !this._mark_recompute;\r\n\t\tthis._mark_recompute = false;\r\n\t\tif(id){\r\n\t\t\t// if item changes visible order (e.g. expand-collapse branch) - do a complete repaint\r\n\t\t\tif(!quick && !skipFilter){\r\n\t\t\t\tvar oldOrder = this.visibleOrder;\r\n\t\t\t\tthis.filter();\r\n\t\t\t\tif(!this.arraysEqual(oldOrder, this.visibleOrder)){\r\n\t\t\t\t\tid = undefined;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}else if(!skipFilter){\r\n\t\t\tthis.filter();\r\n\t\t}\r\n\r\n\t\tif (id){\r\n\t\t\targs = [id, item, \"paint\"];\r\n\t\t}else{\r\n\t\t\targs = [null,null,null];\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onStoreUpdated\",args);\r\n\t},\r\n\r\n\tcount: function(){\r\n\t\treturn this.fullOrder.length;\r\n\t},\r\n\tcountVisible: function(){\r\n\t\treturn this.visibleOrder.length;\r\n\t},\r\n\r\n\tsort: function(sort){},\r\n\r\n\tserialize: function(){},\r\n\r\n\teachItem: function(code){\r\n\t\tfor (var i=0; i<this.fullOrder.length; i++) {\r\n\t\t\tvar item = this.getItem(this.fullOrder[i]);\r\n\t\t\tcode.call(this, item);\r\n\t\t}\r\n\t},\r\n\r\n\tfind: function(filter) {\r\n\t\tvar result = [];\r\n\t\tthis.eachItem(function(item) {\r\n\t\t\tif(filter(item)){\r\n\t\t\t\tresult.push(item);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t},\r\n\r\n\tfilter: function(rule){\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tthis.callEvent(\"onBeforeFilter\", []);\r\n\t\t}\r\n\t\tthis.callEvent(\"onPreFilter\", []);\r\n\t\tvar filteredOrder = powerArray.$create();\r\n\t\tvar placeholderIds = [];\r\n\t\tthis.eachItem(function(item){\r\n\t\t\tif(this.callEvent(\"onFilterItem\", [item.id, item])){\r\n\t\t\t\tif(isPlaceholderTask(item.id, null, this, this._ganttConfig)){\r\n\t\t\t\t\tplaceholderIds.push(item.id);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfilteredOrder.push(item.id);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfor(var i = 0; i < placeholderIds.length; i++){\r\n\t\t\tfilteredOrder.push(placeholderIds[i]);\r\n\t\t}\r\n\r\n\t\tthis.visibleOrder = filteredOrder;\r\n\t\tthis._searchVisibleOrder = {};\r\n\t\tfor(var i = 0; i < this.visibleOrder.length; i++){\r\n\t\t\tthis._searchVisibleOrder[this.visibleOrder[i]] = i;\r\n\t\t}\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tthis.callEvent(\"onFilter\", []);\r\n\t\t}\r\n\t},\r\n\r\n\tgetIndexRange: function(from, to){\r\n\t\tvar max = Math.min((to||Infinity),this.countVisible()-1);\r\n\t\tvar min = from||0;\r\n\r\n\t\tvar cacheKey = min + '-' + max;\r\n\t\tif(this._indexRangeCache[cacheKey]){\r\n\t\t\treturn this._indexRangeCache[cacheKey].slice();\r\n\t\t}\r\n\r\n\t\tvar ret= [];\r\n\t\tfor (var i=min; i <= max; i++)\r\n\t\t\tret.push(this.getItem(this.visibleOrder[i]));\r\n\r\n\t\tthis._indexRangeCache[cacheKey] = ret.slice();\r\n\t\treturn ret;\r\n\t},\r\n\tgetItems: function(){\r\n\t\tif(this._getItemsCache){\r\n\t\t\treturn this._getItemsCache.slice();\r\n\t\t}\r\n\r\n\t\tvar res = [];\r\n\t\tfor(var i in this.pull){\r\n\t\t\tres.push(this.pull[i]);\r\n\t\t}\r\n\t\tthis._getItemsCache = res.slice();\r\n\r\n\t\treturn res;\r\n\t},\r\n\r\n\tgetIdByIndex: function(index){\r\n\t\treturn this.visibleOrder[index];\r\n\t},\r\n\tgetIndexById: function(id){\r\n\t\tvar res = this._searchVisibleOrder[id];\r\n\t\tif(res === undefined){\r\n\t\t\tres = -1;\r\n\t\t}\r\n\t\treturn res;\r\n\t},\r\n\t_getNullIfUndefined: function(value){\r\n\t\tif(value === undefined){\r\n\t\t\treturn null;\r\n\t\t}else{\r\n\t\t\treturn value;\r\n\t\t}\r\n\t},\r\n\tgetFirst: function(){\r\n\t\treturn this._getNullIfUndefined(this.visibleOrder[0]);\r\n\t},\r\n\tgetLast: function(){\r\n\t\treturn this._getNullIfUndefined(this.visibleOrder[this.visibleOrder.length-1]);\r\n\t},\r\n\tgetNext: function(id){\r\n\t\treturn this._getNullIfUndefined(this.visibleOrder[this.getIndexById(id) + 1]);\r\n\t},\r\n\tgetPrev: function(id){\r\n\t\treturn this._getNullIfUndefined(this.visibleOrder[this.getIndexById(id) - 1]);\r\n\t},\r\n\tdestructor: function(){\r\n\t\tthis.callEvent(\"onDestroy\", []);\r\n\t\tthis.detachAllEvents();\r\n\t\tthis.$destroyed = true;\r\n\t\tthis.pull = null;\r\n\t\tthis.$initItem = null;\r\n\t\tthis.visibleOrder = null;\r\n\t\tthis.fullOrder = null;\r\n\t\tthis._skip_refresh = null;\r\n\t\tthis._filterRule = null;\r\n\t\tthis._searchVisibleOrder = null;\r\n\t\tthis._indexRangeCache = {};\r\n\t}\r\n};\r\n\r\nexport default DataStore;","export default class SplitTasksHelper {\r\n\r\n\t_datastore: any = null;\r\n\r\n\tconstructor (datastore: any) {\r\n\t\tthis._datastore = datastore;\r\n\t}\r\n\tisSplitItem = (item: any) => {\r\n\t\treturn (item.render == \"split\" && this._datastore.hasChild(item.id));\r\n\t};\r\n\tisSubrowSplitItem = (item: any) => {\r\n\t\treturn (item.split_placement == \"subrow\");\r\n\t};\r\n\tisDefaultSplitItem = (item: any) => {\r\n\t\treturn (item.split_placement == \"auto\" || item.split_placement === undefined);\r\n\t};\r\n\tisInlineSplitItem = (item: any) => {\r\n\t\treturn (item.split_placement == \"inline\");\r\n\t};\r\n};","import powerArray from \"./power_array\";\r\nimport * as utils from \"../../utils/utils\";\r\nimport * as helpers from \"../../utils/helpers\";\r\nimport DataStore from \"./datastore\";\r\nimport isPlaceholderTask from \"../../utils/placeholder_task\";\r\nimport {replaceValidZeroId} from \"../../utils/helpers\";\r\nimport SplitTasksHelper from \"../common/split_task_helpers\";\r\n\r\nvar TreeDataStore = function(config){\r\n\tDataStore.apply(this, [config]);\r\n\tthis._branches = {};\r\n\tthis._splitTaskHelper = new SplitTasksHelper(this);\r\n\r\n\tthis.pull = {};\r\n\t//GS-761 Update existing item instead of adding it to the new position\r\n\tthis.$initItem = function (item){\r\n\t\tvar loadedItem = item;\r\n\t\tif(config.initItem){\r\n\t\t\tloadedItem = config.initItem(loadedItem);\r\n\t\t}\r\n\t\tvar existingItem = this.getItem(item.id);\r\n\t\tif(existingItem && !isEqualIds(existingItem.parent,loadedItem.parent)){\r\n\t\t\tthis.move(loadedItem.id, loadedItem.$index || -1, loadedItem.parent || this._ganttConfig.root_id);\r\n\t\t}\r\n\t\treturn loadedItem;\r\n\t};\r\n\tthis.$parentProperty = config.parentProperty || \"parent\";\r\n\r\n\tif(typeof config.rootId !== \"function\"){\r\n\t\tthis.$getRootId = (function(val){\r\n\t\t\treturn function(){return val;};\r\n\t\t})(config.rootId || 0);\r\n\t}else{\r\n\t\tthis.$getRootId = config.rootId;\r\n\t}\r\n\r\n\t// TODO: replace with live reference to gantt config\r\n\tthis.$openInitially = config.openInitially;\r\n\r\n\tthis.visibleOrder = powerArray.$create();\r\n\tthis.fullOrder = powerArray.$create();\r\n\tthis._searchVisibleOrder = {};\r\n\tthis._indexRangeCache = {};\r\n\tthis._eachItemMainRangeCache = null;\r\n\tthis._getItemsCache = null;\r\n\tthis._skip_refresh = false;\r\n\r\n\tthis._ganttConfig = null;\r\n\tif(config.getConfig){\r\n\t\tthis._ganttConfig = config.getConfig();\r\n\t}\r\n\r\n\tvar splitParents = {};\r\n\tvar splitItems = {};\r\n\r\n\tvar taskOpenState = {};\r\n\tvar taskVisibility = {};\r\n\tvar haveSplitItems = false;\r\n\r\n\tthis._attachDataChange(function(){\r\n\t\tthis._indexRangeCache = {};\r\n\t\tthis._eachItemMainRangeCache = null;\r\n\t\tthis._getItemsCache = null;\r\n\t\treturn true;\r\n\t});\r\n\r\n\tthis.attachEvent(\"onPreFilter\", function(){\r\n\t\tthis._indexRangeCache = {};\r\n\t\tthis._eachItemMainRangeCache = null;\r\n\r\n\t\tsplitParents = {};\r\n\t\tsplitItems = {};\r\n\t\ttaskOpenState = {};\r\n\t\ttaskVisibility = {};\r\n\t\thaveSplitItems = false;\r\n\r\n\t\tthis.eachItem(function(item){\r\n\t\t\tvar parent = this.getParent(item.id);\r\n\t\t\tif(item.$open && taskOpenState[parent] !== false){\r\n\t\t\t\ttaskOpenState[item.id] = true;\r\n\t\t\t}else{\r\n\t\t\t\ttaskOpenState[item.id] = false;\r\n\t\t\t}\r\n\r\n\t\t\tif(this._isSplitItem(item)){\r\n\t\t\t\thaveSplitItems = true;\r\n\t\t\t\tsplitParents[item.id] = true;\r\n\t\t\t\tsplitItems[item.id] = true;\r\n\t\t\t}\r\n\r\n\r\n\t\t\tif(haveSplitItems && splitItems[parent]){\r\n\t\t\t\tif(this._isDefaultItem(item) || this._isInlineChildItem(item)) splitItems[item.id] = true;\r\n\t\t\t}\r\n\r\n\r\n\t\t\tif(taskOpenState[parent] || taskOpenState[parent] === undefined || this._isInlineChildItem(item)){\r\n\t\t\t\ttaskVisibility[item.id] = true;\r\n\t\t\t}else{\r\n\t\t\t\ttaskVisibility[item.id] = false;\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\tthis.attachEvent(\"onFilterItem\", function(id, item){\r\n\r\n\t\tvar canOpenSplitTasks = false;\r\n\t\tif(this._ganttConfig){\r\n\t\t\tvar canOpenSplitTasks = this._ganttConfig.open_split_tasks;\r\n\t\t}\r\n\r\n\t\tvar open = taskVisibility[item.id];\r\n\r\n\t\tif(haveSplitItems){\r\n\t\t\tif(open && splitItems[item.id] && !splitParents[item.id]){\r\n\t\t\t\topen = !!canOpenSplitTasks;\r\n\t\t\t}\r\n\r\n\t\t\tif(splitItems[item.id] && !splitParents[item.id]){\r\n\t\t\t\tif(!this._isSplitChildItem(item)) item.$split_subtask = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\titem.$expanded_branch = !!taskVisibility[item.id];\r\n\t\tif(this._isInlineChildItem(item)){\r\n\t\t\topen = false;\r\n\t\t}\r\n\t\treturn !!open;\r\n\t});\r\n\r\n\tthis.attachEvent(\"onFilter\", function(){\r\n\t\tsplitParents = {};\r\n\t\tsplitItems = {};\r\n\r\n\t\ttaskOpenState = {};\r\n\t\ttaskVisibility = {};\r\n\t});\r\n\r\n\treturn this;\r\n};\r\n\r\nTreeDataStore.prototype = utils.mixin({\r\n\r\n\t\t_buildTree: function(data){\r\n\t\t\tvar item = null;\r\n\t\t\tvar rootId = this.$getRootId();\r\n\t\t\tfor (var i = 0, len = data.length; i < len; i++){\r\n\t\t\t\titem = data[i];\r\n\t\t\t\tthis.setParent(item, replaceValidZeroId(this.getParent(item), rootId) || rootId);\r\n\t\t\t}\r\n\r\n\t\t\t// calculating $level for each item\r\n\t\t\tfor (var i = 0, len = data.length; i < len; i++){\r\n\t\t\t\titem = data[i];\r\n\t\t\t\tthis._add_branch(item);\r\n\t\t\t\titem.$level = this.calculateItemLevel(item);\r\n\t\t\t\titem.$local_index = this.getBranchIndex(item.id);\r\n\r\n\t\t\t\tif (!utils.defined(item.$open)) {\r\n\t\t\t\t\titem.$open = utils.defined(item.open) ? item.open : this.$openInitially();\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\tthis._updateOrder();\r\n\t\t},\r\n\t\t_isSplitItem: function(item){\r\n\t\t\treturn this._splitTaskHelper.isSplitItem(item);\r\n\t\t},\r\n\t\t_isSplitChildItem: function(item){\r\n\t\t\treturn this._splitTaskHelper.isSubrowSplitItem(item);\r\n\t\t},\r\n\t\t_isDefaultItem: function(item){\r\n\t\t\treturn this._splitTaskHelper.isDefaultSplitItem(item);\r\n\t\t},\r\n\t\t_isInlineChildItem: function(item){\r\n\t\t\treturn this._splitTaskHelper.isInlineSplitItem(item);\r\n\t\t},\r\n\t\tparse: function(data){\r\n\t\t\tif (!this._skip_refresh) {\r\n\t\t\t\tthis.callEvent(\"onBeforeParse\", [data]);\r\n\t\t\t}\r\n\t\t\tvar loaded = this._parseInner(data);\r\n\t\t\tthis._buildTree(loaded);\r\n\t\t\tthis.filter();\r\n\t\t\tif (!this._skip_refresh) {\r\n\t\t\t\tthis.callEvent(\"onParse\", [loaded]);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_addItemInner: function(item, index){\r\n\r\n\t\t\tvar parent = this.getParent(item);\r\n\r\n\t\t\tif(!utils.defined(parent)){\r\n\t\t\t\tparent = this.$getRootId();\r\n\t\t\t\tthis.setParent(item, parent);\r\n\t\t\t}\r\n\r\n\t\t\tvar parentIndex = this.getIndexById(parent);\r\n\t\t\tvar targetIndex = parentIndex + Math.min(Math.max(index, 0), this.visibleOrder.length);\r\n\r\n\t\t\tif(targetIndex*1 !== targetIndex){\r\n\t\t\t\ttargetIndex = undefined;\r\n\t\t\t}\r\n\t\t\tDataStore.prototype._addItemInner.call(this, item, targetIndex);\r\n\t\t\tthis.setParent(item, parent);\r\n\r\n\t\t\tif(item.hasOwnProperty(\"$rendered_parent\")){\r\n\t\t\t\tthis._move_branch(item, item.$rendered_parent);\r\n\t\t\t}\r\n\t\t\tthis._add_branch(item, index);\r\n\t\t},\r\n\t\t_changeIdInner: function(oldId, newId){\r\n\t\t\tvar children = this.getChildren(oldId);\r\n\t\t\tvar visibleOrder = this._searchVisibleOrder[oldId];\r\n\r\n\t\t\tDataStore.prototype._changeIdInner.call(this, oldId, newId);\r\n\r\n\t\t\tvar parent = this.getParent(newId);\r\n\r\n\t\t\tthis._replace_branch_child(parent, oldId, newId);\r\n\r\n\t\t\tif(this._branches[oldId]){\r\n\t\t\t\tthis._branches[newId] = this._branches[oldId];\r\n\t\t\t}\r\n\t\t\tfor(var i = 0; i < children.length; i++){\r\n\t\t\t\tvar child = this.getItem(children[i]);\r\n\t\t\t\tchild[this.$parentProperty] = newId;\r\n\t\t\t\tchild.$rendered_parent = newId;\r\n\t\t\t}\r\n\r\n\t\t\tthis._searchVisibleOrder[newId] = visibleOrder;\r\n\t\t\tdelete this._branches[oldId];\r\n\t\t},\r\n\r\n\t\t_traverseBranches: function(code, parent){\r\n\t\t\tif (!utils.defined(parent)) {\r\n\t\t\t\tparent = this.$getRootId();\r\n\t\t\t}\r\n\t\t\tvar branch = this._branches[parent];\r\n\t\t\tif (branch) {\r\n\t\t\t\tfor (var i = 0; i < branch.length; i++) {\r\n\t\t\t\t\tvar itemId = branch[i];\r\n\t\t\t\t\tcode.call(this, itemId);\r\n\t\t\t\t\tif (this._branches[itemId])\r\n\t\t\t\t\t\tthis._traverseBranches(code, itemId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_updateOrder: function(code){\r\n\r\n\t\t\tthis.fullOrder = powerArray.$create();\r\n\t\t\tthis._traverseBranches(function(taskId){\r\n\t\t\t\tthis.fullOrder.push(taskId);\r\n\t\t\t});\r\n\r\n\t\t\tif(code)\r\n\t\t\t\tDataStore.prototype._updateOrder.call(this, code);\r\n\t\t},\r\n\r\n\t\t_removeItemInner: function(id){\r\n\r\n\t\t\tvar items = [];\r\n\t\t\tthis.eachItem(function(child){\r\n\t\t\t\titems.push(child);\r\n\t\t\t}, id);\r\n\r\n\t\t\titems.push(this.getItem(id));\r\n\r\n\t\t\tfor(var i = 0; i < items.length; i++){\r\n\r\n\t\t\t\tthis._move_branch(items[i], this.getParent(items[i]), null);\r\n\t\t\t\tDataStore.prototype._removeItemInner.call(this, items[i].id);\r\n\t\t\t\tthis._move_branch(items[i], this.getParent(items[i]), null);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tmove: function(sid, tindex, parent){\r\n\t\t\t//target id as 4th parameter\r\n\t\t\tvar id = arguments[3];\r\n\t\t\tvar config = this._ganttConfig || {};\r\n\t\t\tvar root_id = config.root_id || 0;\r\n\t\t\tid = replaceValidZeroId(id, root_id);\r\n\t\t\tif (id) {\r\n\t\t\t\tif (id === sid) return;\r\n\r\n\t\t\t\tparent = this.getParent(id);\r\n\t\t\t\ttindex = this.getBranchIndex(id);\r\n\t\t\t}\r\n\t\t\tif(isEqualIds(sid, parent)){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (!utils.defined(parent)) {\r\n\t\t\t\tparent = this.$getRootId();\r\n\t\t\t}\r\n\t\t\tvar source = this.getItem(sid);\r\n\t\t\tvar source_pid = this.getParent(source.id);\r\n\r\n\t\t\tvar tbranch = this.getChildren(parent);\r\n\t\t\tconst siblings = this.getSiblings(sid);\r\n\r\n\t\t\tif (tindex == -1)\r\n\t\t\t\ttindex = tbranch.length + 1;\r\n\t\t\tif (isEqualIds(source_pid, parent)) {\r\n\t\t\t\tvar sindex = this.getBranchIndex(sid);\r\n\t\t\t\tif (sindex == tindex) return;\r\n\t\t\t\t//GS-3004: prevent reorder single task in the root tree\r\n\t\t\t\tif (parent === gantt.config.root_id && siblings.length <= 1) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\r\n\t\t\tif(this.callEvent(\"onBeforeItemMove\", [sid, parent, tindex]) === false)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\tvar placeholderIds = [];\r\n\t\t\tfor(var i = 0; i < tbranch.length; i++){\r\n\t\t\t\tif (isPlaceholderTask(tbranch[i], null, this, this._ganttConfig)){\r\n\t\t\t\t\tplaceholderIds.push(tbranch[i]);\r\n\t\t\t\t\ttbranch.splice(i, 1);\r\n\t\t\t\t\ti--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._replace_branch_child(source_pid, sid);\r\n\t\t\ttbranch = this.getChildren(parent);\r\n\r\n\t\t\tvar tid = tbranch[tindex];\r\n\t\t\ttid = replaceValidZeroId(tid, root_id);\r\n\t\t\tif (!tid) //adding as last element\r\n\t\t\t\ttbranch.push(sid);\r\n\t\t\telse\r\n\t\t\t\ttbranch = tbranch.slice(0, tindex).concat([ sid ]).concat(tbranch.slice(tindex));\r\n\r\n\t\t\tif (placeholderIds.length){\r\n\t\t\t\ttbranch = tbranch.concat(placeholderIds);\r\n\t\t\t}\r\n\t\t\t// GS-2423 to return initial parent to the task before it will be moved\r\n\t\t\tif (!isEqualIds(source.$rendered_parent, source_pid) && !isEqualIds(source_pid, parent)){\r\n\t\t\t\tsource.$rendered_parent = source_pid;\r\n\t\t\t}\r\n\t\t\tthis.setParent(source, parent);\r\n\t\t\tthis._branches[parent] = tbranch;\r\n\r\n\t\t\tvar diff = this.calculateItemLevel(source) - source.$level;\r\n\t\t\tsource.$level += diff;\r\n\t\t\tthis.eachItem(function(item){\r\n\t\t\t\titem.$level += diff;\r\n\t\t\t}, source.id, this);\r\n\r\n\r\n\t\t\tthis._moveInner(this.getIndexById(sid), this.getIndexById(parent) + tindex);\r\n\r\n\t\t\tthis.callEvent(\"onAfterItemMove\", [sid, parent, tindex]);\r\n\t\t\tthis.refresh();\r\n\t\t},\r\n\r\n\t\tgetBranchIndex: function(id){\r\n\t\t\tvar branch = this.getChildren(this.getParent(id));\r\n\t\t\tlet index = branch.indexOf(id + \"\");\r\n\t\t\tif (index == -1){\r\n\t\t\t\tindex = branch.indexOf(+id);\r\n\t\t\t}\r\n\t\t\treturn index;\r\n\t\t},\r\n\t\thasChild: function(id){\r\n\t\t\tvar branch = this._branches[id];\r\n\t\t\treturn branch && branch.length;\r\n\t\t},\r\n\t\tgetChildren: function(id){\r\n\t\t\tvar branch = this._branches[id];\r\n\t\t\treturn branch ? branch : powerArray.$create();\r\n\t\t},\r\n\r\n\t\tisChildOf: function(childId, parentId){\r\n\t\t\tif (!this.exists(childId))\r\n\t\t\t\treturn false;\r\n\t\t\tif (parentId === this.$getRootId())\r\n\t\t\t\treturn true;\r\n\r\n\t\t\tif (!this.hasChild(parentId))\r\n\t\t\t\treturn false;\r\n\r\n\t\t\tvar item = this.getItem(childId);\r\n\t\t\tvar pid = this.getParent(childId);\r\n\r\n\t\t\tvar parent = this.getItem(parentId);\r\n\t\t\tif(parent.$level >= item.$level){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\twhile (item && this.exists(pid)) {\r\n\t\t\t\titem = this.getItem(pid);\r\n\r\n\t\t\t\tif (item && isEqualIds(item.id, parentId))\r\n\t\t\t\t\treturn true;\r\n\t\t\t\tpid = this.getParent(item);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\tgetSiblings: function(id){\r\n\t\t\tif(!this.exists(id)){\r\n\t\t\t\treturn powerArray.$create();\r\n\t\t\t}\r\n\t\t\tvar parent = this.getParent(id);\r\n\t\t\treturn this.getChildren(parent);\r\n\r\n\t\t},\r\n\t\tgetNextSibling: function(id){\r\n\t\t\tvar siblings = this.getSiblings(id);\r\n\t\t\tfor(var i= 0, len = siblings.length; i < len; i++){\r\n\t\t\t\tif(isEqualIds(siblings[i], id)){\r\n\t\t\t\t\tvar nextSibling = siblings[i+1];\r\n\t\t\t\t\tif (nextSibling === 0 && i > 0){\r\n\t\t\t\t\t\tnextSibling = \"0\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn nextSibling || null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\tgetPrevSibling: function(id){\r\n\t\t\tvar siblings = this.getSiblings(id);\r\n\t\t\tfor(var i= 0, len = siblings.length; i < len; i++){\r\n\t\t\t\tif(isEqualIds(siblings[i], id)){\r\n\t\t\t\t\tvar previousSibling = siblings[i-1];\r\n\t\t\t\t\tif (previousSibling === 0 && i > 0){\r\n\t\t\t\t\t\tpreviousSibling = \"0\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn previousSibling || null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\tgetParent: function(id){\r\n\t\t\tvar item = null;\r\n\t\t\tif(id.id !== undefined){\r\n\t\t\t\titem = id;\r\n\t\t\t}else{\r\n\t\t\t\titem = this.getItem(id);\r\n\t\t\t}\r\n\r\n\t\t\tvar parent;\r\n\t\t\tif(item){\r\n\t\t\t\tparent = item[this.$parentProperty];\r\n\t\t\t}else{\r\n\t\t\t\tparent = this.$getRootId();\r\n\t\t\t}\r\n\t\t\treturn parent;\r\n\r\n\t\t},\r\n\r\n\t\tclearAll: function(){\r\n\t\t\tthis._branches = {};\r\n\t\t\tDataStore.prototype.clearAll.call(this);\r\n\t\t},\r\n\r\n\t\tcalculateItemLevel: function(item){\r\n\t\t\tvar level = 0;\r\n\t\t\tthis.eachParent(function(){\r\n\t\t\t\tlevel++;\r\n\t\t\t}, item);\r\n\t\t\treturn level;\r\n\t\t},\r\n\r\n\t\t_setParentInner: function(item, new_pid, silent){\r\n\t\t\tif(!silent){\r\n\t\t\t\tif(item.hasOwnProperty(\"$rendered_parent\")){\r\n\t\t\t\t\tthis._move_branch(item, item.$rendered_parent, new_pid);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis._move_branch(item, item[this.$parentProperty], new_pid);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetParent: function(item, new_pid, silent){\r\n\t\t\tthis._setParentInner(item, new_pid, silent);\r\n\r\n\t\t\titem[this.$parentProperty] = new_pid;\r\n\t\t},\r\n\r\n\t\t_eachItemCached: function(code, cache){\r\n\t\t\tfor(var i = 0, len = cache.length; i < len; i++){\r\n\t\t\t\tcode.call(this, cache[i]);\r\n\t\t\t}\r\n\t\t},\r\n\t\t_eachItemIterate: function(code, startId, cache){\r\n\t\t\tvar itemsStack = this.getChildren(startId);\r\n\t\t\tif(itemsStack.length){\r\n\t\t\t\titemsStack = itemsStack.slice().reverse();\r\n\t\t\t}\r\n\t\t\twhile(itemsStack.length){\r\n\t\t\t\tvar itemId = itemsStack.pop();\r\n\t\t\t\tvar item = this.getItem(itemId);\r\n\t\t\t\tcode.call(this, item);\r\n\t\t\t\tif(cache){\r\n\t\t\t\t\tcache.push(item);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(this.hasChild(item.id)){\r\n\t\t\t\t\tvar children = this.getChildren(item.id);\r\n\t\t\t\t\tvar len = children.length;\r\n\t\t\t\t\tfor(var i = len - 1; i >= 0; i--){\r\n\t\t\t\t\t\titemsStack.push(children[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\teachItem: function(code, parent){\r\n\t\t\tvar rootId = this.$getRootId();\r\n\t\t\tif (!utils.defined(parent)) {\r\n\t\t\t\tparent = rootId;\r\n\t\t\t}\r\n\t\t\tvar startId = replaceValidZeroId(parent, rootId) || rootId;\r\n\r\n\t\t\tvar useCache = false;\r\n\t\t\tvar buildCache = false;\r\n\t\t\tvar cache = null;\r\n\t\t\tif(startId === rootId){\r\n\t\t\t\tif(this._eachItemMainRangeCache){\r\n\t\t\t\t\tuseCache = true;\r\n\t\t\t\t\tcache = this._eachItemMainRangeCache;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tbuildCache = true;\r\n\t\t\t\t\tcache = this._eachItemMainRangeCache = [];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(useCache){\r\n\t\t\t\tthis._eachItemCached(code, cache);\r\n\t\t\t}else{\r\n\t\t\t\tthis._eachItemIterate(code, startId, buildCache ? cache : null);\r\n\t\t\t}\r\n\t\t},\r\n\t\teachParent: function(code, startItem) {\r\n\t\t\tvar parentsHash = {};\r\n\t\t\tvar item = startItem;\r\n\t\t\tvar parent = this.getParent(item);\r\n\r\n\t\t\twhile (this.exists(parent)) {\r\n\t\t\t\tif (parentsHash[parent]) {\r\n\t\t\t\t\tthrow new Error(\"Invalid tasks tree. Cyclic reference has been detected on task \" + parent);\r\n\t\t\t\t}\r\n\t\t\t\tparentsHash[parent] = true;\r\n\t\t\t\titem = this.getItem(parent);\r\n\t\t\t\tcode.call(this, item);\r\n\t\t\t\tparent = this.getParent(item);\r\n\t\t\t}\r\n\t\t},\r\n\t\t_add_branch: function(item, index, parent){\r\n\t\t\tvar pid = parent === undefined ? this.getParent(item) : parent;\r\n\t\t\tif (!this.hasChild(pid))\r\n\t\t\t\tthis._branches[pid] = powerArray.$create();\r\n\t\t\tvar branch = this.getChildren(pid);\r\n\t\t\tvar added_already = branch.indexOf(item.id + \"\") > -1 || branch.indexOf(+item.id) > -1;\r\n\t\t\tif(!added_already){\r\n\t\t\t\tif(index*1 == index){\r\n\r\n\t\t\t\t\tbranch.splice(index, 0, item.id);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tbranch.push(item.id);\r\n\t\t\t\t}\r\n\r\n\t\t\t\titem.$rendered_parent = pid;\r\n\t\t\t}\r\n\t\t},\r\n\t\t_move_branch: function(item, old_parent, new_parent){\r\n\t\t\tthis._eachItemMainRangeCache = null;\r\n\t\t\t//this.setParent(item, new_parent);\r\n\t\t\t//this._sync_parent(task);\r\n\t\t\tthis._replace_branch_child(old_parent, item.id);\r\n\t\t\tif(this.exists(new_parent) || isEqualIds(new_parent, this.$getRootId())){\r\n\r\n\t\t\t\tthis._add_branch(item, undefined, new_parent);\r\n\t\t\t}else{\r\n\t\t\t\tdelete this._branches[item.id];\r\n\t\t\t}\r\n\t\t\titem.$level =  this.calculateItemLevel(item);\r\n\t\t\tthis.eachItem(function(child){\r\n\t\t\t\tchild.$level = this.calculateItemLevel(child);\r\n\t\t\t}, item.id);\r\n\t\t},\r\n\r\n\t\t_replace_branch_child: function(node, old_id, new_id){\r\n\t\t\tvar branch = this.getChildren(node);\r\n\t\t\tif (branch && node !== undefined){\r\n\t\t\t\tvar newbranch = powerArray.$create();\r\n\r\n\t\t\t\tlet index = branch.indexOf(old_id + \"\");\r\n\t\t\t\tif (index == -1 && !isNaN(+old_id)){\r\n\t\t\t\t\tindex = branch.indexOf(+old_id);\r\n\t\t\t\t} \r\n\r\n\t\t\t\tif (index > -1){\r\n\t\t\t\t\tif (new_id){\r\n\t\t\t\t\t\tbranch.splice(index, 1, new_id);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbranch.splice(index, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tnewbranch = branch;\r\n\r\n\t\t\t\tthis._branches[node] = newbranch;\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\tsort: function(field, desc, parent){\r\n\t\t\tif (!this.exists(parent)) {\r\n\t\t\t\tparent = this.$getRootId();\r\n\t\t\t}\r\n\r\n\t\t\tif (!field) field = \"order\";\r\n\t\t\tvar criteria = (typeof(field) == \"string\") ? (function(a, b) {\r\n\t\t\t\tif (a[field] == b[field] ||\r\n\t\t\t\t\t(helpers.isDate(a[field]) && helpers.isDate(b[field]) && a[field].valueOf() == b[field].valueOf()))\r\n\t\t\t\t{\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar result = a[field] > b[field];\r\n\t\t\t\treturn result ? 1 : -1;\r\n\t\t\t}) : field;\r\n\r\n\t\t\tif (desc) {\r\n\t\t\t\tvar original_criteria = criteria;\r\n\t\t\t\tcriteria = function (a, b) {\r\n\t\t\t\t\treturn original_criteria(b, a);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tvar els = this.getChildren(parent);\r\n\r\n\t\t\tif (els){\r\n\t\t\t\tvar temp = [];\r\n\t\t\t\tfor (var i = els.length - 1; i >= 0; i--)\r\n\t\t\t\t\ttemp[i] = this.getItem(els[i]);\r\n\r\n\t\t\t\ttemp.sort(criteria);\r\n\r\n\t\t\t\tfor (var i = 0; i < temp.length; i++) {\r\n\t\t\t\t\tels[i] = temp[i].id;\r\n\t\t\t\t\tthis.sort(field, desc, els[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tfilter: function(rule){\r\n\t\t\tfor(let i in this.pull){\r\n\t\t\t\tconst renderedParent = this.pull[i].$rendered_parent;\r\n\t\t\t\tconst actualParent = this.getParent(this.pull[i]);\r\n\t\t\t\t//GS-2339: could be different types of the ids\r\n\t\t\t\tif(!isEqualIds(renderedParent,actualParent)){\r\n\t\t\t\t\tthis._move_branch(this.pull[i], renderedParent, actualParent);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn DataStore.prototype.filter.apply(this, arguments);\r\n\t\t},\r\n\r\n\t\topen: function(id){\r\n\t\t\tif(this.exists(id)){\r\n\t\t\t\tthis.getItem(id).$open = true;\r\n\t\t\t\t// GS-2170. Do not recalculate the indexes and dates as they will be recalculated later\r\n\t\t\t\tthis._skipTaskRecalculation = true;\r\n\t\t\t\tthis.callEvent(\"onItemOpen\", [id]);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tclose: function(id){\r\n\t\t\tif(this.exists(id)){\r\n\t\t\t\tthis.getItem(id).$open = false;\r\n\t\t\t\t// GS-2170. Do not recalculate the indexes and dates as they will be recalculated later\r\n\t\t\t\tthis._skipTaskRecalculation = true;\r\n\t\t\t\tthis.callEvent(\"onItemClose\", [id]);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdestructor: function(){\r\n\t\t\tDataStore.prototype.destructor.call(this);\r\n\t\t\tthis._branches = null;\r\n\t\t\tthis._indexRangeCache = {};\r\n\t\t\tthis._eachItemMainRangeCache = null;\r\n\t\t}\r\n\t},\r\n\tDataStore.prototype\r\n);\r\n\r\nfunction isEqualIds(first, second){\r\n\treturn String(first) === String(second);\r\n};\r\n\r\nexport default TreeDataStore;","function createDataStoreSelectMixin(store){\r\n\tvar selectedId = null;\r\n\r\n\tvar deleteItem = store._removeItemInner;\r\n\t\r\n\tfunction unselect(id){\r\n\t\tselectedId = null;\r\n\t\tthis.callEvent(\"onAfterUnselect\", [id]);\r\n\t}\r\n\r\n\tstore._removeItemInner = function(id){\r\n\t\tif(selectedId == id){\r\n\t\t\tunselect.call(this, id);\r\n\t\t}\r\n\r\n\t\tif(selectedId && this.eachItem){\r\n\t\t\tthis.eachItem(function(subItem){\r\n\t\t\t\tif(subItem.id == selectedId){\r\n\t\t\t\t\tunselect.call(this, subItem.id);\r\n\t\t\t\t}\r\n\t\t\t}, id);\r\n\t\t}\r\n\r\n\t\treturn deleteItem.apply(this, arguments);\r\n\t};\r\n\r\n\tstore.attachEvent(\"onIdChange\", function(oldId, newId) {\r\n\t\tif (store.getSelectedId() == oldId) {\r\n\t\t\tstore.silent(function () {\r\n\t\t\t\tstore.unselect(oldId);\r\n\t\t\t\tstore.select(newId);\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\treturn {\r\n\t\tselect: function(id){\r\n\t\t\tif (id){\r\n\r\n\t\t\t\tif(selectedId == id)\r\n\t\t\t\t\treturn selectedId;\r\n\r\n\t\t\t\tif(!this._skip_refresh) {\r\n\t\t\t\t\tif (!this.callEvent(\"onBeforeSelect\", [id])) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.unselect();\r\n\r\n\t\t\t\tselectedId = id;\r\n\r\n\t\t\t\tif(!this._skip_refresh) {\r\n\t\t\t\t\tthis.refresh(id);\r\n\t\t\t\t\tthis.callEvent(\"onAfterSelect\", [id]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn selectedId;\r\n\t\t},\r\n\t\tgetSelectedId: function(){\r\n\t\t\treturn selectedId;\r\n\t\t},\r\n\t\tisSelected: function(id){\r\n\t\t\treturn id == selectedId;\r\n\t\t},\r\n\t\tunselect: function(id){\r\n\t\t\tvar id = id || selectedId;\r\n\t\t\tif(!id)\r\n\t\t\t\treturn;\r\n\t\t\tselectedId = null;\r\n\t\t\tif(!this._skip_refresh){\r\n\t\t\t\tthis.refresh(id);\r\n\t\t\t\tunselect.call(this, id);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default createDataStoreSelectMixin;","import env from \"./env\";\r\n\r\nexport default function(gantt){\r\n\treturn env.isNode || !gantt.$root;\r\n};","import isHeadless from \"../../utils/is_headless\";\r\n\r\nconst storeRenderCreator = function(name, gantt){\r\n\r\n\tconst store = gantt.getDatastore(name);\r\n\r\n\tconst itemRepainter = {\r\n\t\trenderItem: function(id, renderer){\r\n\r\n\t\t\tconst renders = renderer.getLayers();\r\n\r\n\t\t\tconst item = store.getItem(id);\r\n\t\t\tif(item && store.isVisible(id)) {\r\n\t\t\t\tfor (let i = 0; i < renders.length; i++)\r\n\t\t\t\t\trenders[i].render_item(item);\r\n\t\t\t}\r\n\t\t},\r\n\t\trenderItems: function(renderer){\r\n\t\t\tconst renderers = renderer.getLayers();\r\n\t\t\tfor (let i = 0; i < renderers.length; i++) {\r\n\t\t\t\trenderers[i].clear();\r\n\t\t\t}\r\n\r\n\t\t\tlet allData = null;\r\n\r\n\t\t\tconst loadedRanges = {};\r\n\t\t\tfor (let i = 0; i < renderers.length; i++) {\r\n\t\t\t\tconst layer = renderers[i];\r\n\t\t\t\tlet layerData;\r\n\t\t\t\tif(layer.get_visible_range){\r\n\r\n\t\t\t\t\tvar range = layer.get_visible_range(store);\r\n\t\t\t\t\tif(range.start !== undefined && range.end !== undefined){\r\n\t\t\t\t\t\tvar key = range.start + \" - \" + range.end;\r\n\t\t\t\t\t\tif(loadedRanges[key]){\r\n\t\t\t\t\t\t\tlayerData = loadedRanges[key];\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tlayerData = store.getIndexRange(range.start, range.end);\r\n\t\t\t\t\t\t\tloadedRanges[key] = layerData;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else if(range.ids !== undefined){\r\n\t\t\t\t\t\tlayerData = range.ids.map(function(id){\r\n\t\t\t\t\t\t\treturn store.getItem(id);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tthrow new Error(\"Invalid range returned from 'getVisibleRange' of the layer\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif(!allData){\r\n\t\t\t\t\t\tallData = store.getVisibleItems();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlayerData = allData;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (layer.prepare_data) {\r\n\t\t\t\t\t// GS-1605. Highlight timeline cells below tasks and in an empty chart\r\n\t\t\t\t\tlayer.prepare_data(layerData);\r\n\t\t\t\t}\r\n\r\n\t\t\t\trenderers[i].render_items(layerData);\r\n\t\t\t}\r\n\t\t},\r\n\t\tupdateItems: function(layer) {\r\n\t\t\tif(layer.update_items){\r\n\t\t\t\tlet data = [];\r\n\t\t\t\tif(layer.get_visible_range){\r\n\r\n\t\t\t\t\tvar range = layer.get_visible_range(store);\r\n\t\t\t\t\tif(range.start !== undefined && range.end !== undefined){\r\n\t\t\t\t\t\tdata = store.getIndexRange(range.start, range.end);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(range.ids !== undefined){\r\n\t\t\t\t\t\tlet extraDataArr = range.ids.map(function(id){\r\n\t\t\t\t\t\t\treturn store.getItem(id);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t// GS-2502: range.ids might not exist in other datastores\r\n\t\t\t\t\t\tif(extraDataArr.length > 0){\r\n\t\t\t\t\t\t\textraDataArr = extraDataArr.filter(element => element !== undefined);\r\n\t\t\t\t\t\t\tdata = data.concat(extraDataArr);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif((range.start == undefined || range.end == undefined) && range.ids == undefined)  {\r\n\t\t\t\t\t\tthrow new Error(\"Invalid range returned from 'getVisibleRange' of the layer\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdata = store.getVisibleItems();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (layer.prepare_data) {\r\n\t\t\t\t\t// GS-1605. Highlight timeline cells below tasks and in an empty chart\r\n\t\t\t\t\tlayer.prepare_data(data, layer);\r\n\t\t\t\t}\r\n\t\t\t\tlayer.update_items(data);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tstore.attachEvent(\"onStoreUpdated\", function(id, item, action){\r\n\t\tif(isHeadless(gantt)){\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tconst renderer = gantt.$services.getService(\"layers\").getDataRender(name);\r\n\t\tif(renderer){\r\n\t\t\trenderer.onUpdateRequest = function(layer){\r\n\t\t\t\titemRepainter.updateItems(layer);\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n\r\n\tfunction skipRepaint(gantt){\r\n\t\tconst state = gantt.$services.getService(\"state\");\r\n\t\tif(state.getState(\"batchUpdate\").batch_update){\r\n\t\t\treturn true;\r\n\t\t}else{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tstore.attachEvent(\"onStoreUpdated\", function(id, item, action){\r\n\t\tif(skipRepaint(gantt)){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!id || action == \"move\" || action == \"delete\"){\r\n\t\t\tstore.callEvent(\"onBeforeRefreshAll\", []);\r\n\t\t\tstore.callEvent(\"onAfterRefreshAll\", []);\r\n\t\t}else{\r\n\t\t\tstore.callEvent(\"onBeforeRefreshItem\", [item.id]);\r\n\t\t\tstore.callEvent(\"onAfterRefreshItem\", [item.id]);\r\n\t\t}\r\n\t});\r\n\r\n\tstore.attachEvent(\"onAfterRefreshAll\", function(){\r\n\t\tif(isHeadless(gantt)){\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tconst renderer = gantt.$services.getService(\"layers\").getDataRender(name);\r\n\t\tif(renderer && !skipRepaint(gantt)){\r\n\t\t\titemRepainter.renderItems(renderer);\r\n\t\t}\r\n\t});\r\n\tstore.attachEvent(\"onAfterRefreshItem\", function(id){\r\n\t\tif(isHeadless(gantt)){\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tconst renderer = gantt.$services.getService(\"layers\").getDataRender(name);\r\n\t\tif(renderer){\r\n\t\t\titemRepainter.renderItem(id, renderer);\r\n\t\t}\r\n\t});\r\n\r\n\t// TODO: probably can be done more in a more efficient way\r\n\tstore.attachEvent(\"onItemOpen\", function(){\r\n\t\tif(isHeadless(gantt) || store.isSilent()){\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tgantt.render();\r\n\t});\r\n\r\n\tstore.attachEvent(\"onItemClose\", function(){\r\n\t\tif(isHeadless(gantt) || store.isSilent()){\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tgantt.render();\r\n\t});\r\n\r\n\tfunction refreshId(renders, oldId, newId, item) {\r\n\t\tfor (let i = 0; i < renders.length; i++) {\r\n\t\t\trenders[i].change_id(oldId, newId);\r\n\t\t}\r\n\t}\r\n\r\n\tstore.attachEvent(\"onIdChange\", function(oldId, newId){\r\n\t\tif(isHeadless(gantt)){\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// in case of linked datastores (tasks <-> links), id change should recalculate something in linked datastore before any repaint\r\n\t\t// use onBeforeIdChange for this hook.\r\n\t\t// TODO: use something more reasonable instead\r\n\t\tstore.callEvent(\"onBeforeIdChange\", [oldId, newId]);\r\n\r\n\t\tif(skipRepaint(gantt)){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!store.isSilent()){\r\n\t\t\tconst renderer = gantt.$services.getService(\"layers\").getDataRender(name);\r\n\t\t\tif(renderer){ // missing check for renderer GS-1814\r\n\t\t\t\trefreshId(renderer.getLayers(), oldId, newId, store.getItem(newId));\r\n\t\t\t\titemRepainter.renderItem(newId, renderer);\r\n\t\t\t}else{\r\n\t\t\t\t// GS-1814 repaint ui to apply new id when the datastore don't have own renderer\r\n\t\t\t\tgantt.render();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n};\r\n\r\nexport default {\r\n\tbindDataStore: storeRenderCreator\r\n};","import * as utils from \"../../utils/utils\";\r\nimport createTasksFacade from \"./datastore_tasks\";\r\nimport createLinksFacade from \"./datastore_links\";\r\nimport DataStore from \"../datastore/datastore\";\r\nimport TreeDataStore from \"../datastore/treedatastore\";\r\nimport createDatastoreSelect from \"../datastore/select\";\r\nimport datastoreRender from \"../datastore/datastore_render\";\r\nimport isHeadless from \"../../utils/is_headless\";\r\nimport {replaceValidZeroId} from \"../../utils/helpers\";\r\n\r\nfunction getDatastores(){\r\n\tvar storeNames = this.$services.getService(\"datastores\");\r\n\tvar res = [];\r\n\tfor(var i = 0; i < storeNames.length; i++){\r\n\t\tvar store = this.getDatastore(storeNames[i]);\r\n\t\tif(!store.$destroyed){\r\n\t\t\tres.push(store);\r\n\t\t}\r\n\t}\r\n\treturn res;\r\n}\r\n\r\nvar createDatastoreFacade = function(){\r\n\treturn {\r\n\tcreateDatastore: function(config){\r\n\r\n\t\tvar $StoreType = (config.type || \"\").toLowerCase() == \"treedatastore\" ? TreeDataStore : DataStore;\r\n\r\n\t\tif (config) {\r\n\t\t\tvar self = this;\r\n\t\t\tconfig.openInitially = function(){ return self.config.open_tree_initially; };\r\n\t\t\tconfig.copyOnParse = function(){ return self.config.deepcopy_on_parse; };\r\n\t\t}\r\n\r\n\t\tvar store = new $StoreType(config);\r\n\t\tthis.mixin(store, createDatastoreSelect(store));\r\n\r\n\t\tif (config.name) {\r\n\t\t\tvar servicePrefix = \"datastore:\";\r\n\t\t\tvar storeAccessName = servicePrefix + config.name;\r\n\r\n\t\t\tstore.attachEvent(\"onDestroy\", function(){\r\n\t\t\t\tthis.$services.dropService(storeAccessName);\r\n\t\t\t\tvar storeList = this.$services.getService(\"datastores\");\r\n\t\t\t\tfor(var i = 0; i < storeList.length; i++){\r\n\t\t\t\t\tif(storeList[i] === config.name){\r\n\t\t\t\t\t\tstoreList.splice(i, 1);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}.bind(this));\r\n\r\n\t\t\tthis.$services.dropService(storeAccessName);\r\n\t\t\tthis.$services.setService(storeAccessName, function() { return store; } );\r\n\r\n\t\t\tvar storeList = this.$services.getService(\"datastores\");\r\n\t\t\tif (!storeList) {\r\n\t\t\t\tstoreList = [];\r\n\t\t\t\tthis.$services.setService(\"datastores\", function() { return storeList; });\r\n\t\t\t\tstoreList.push(config.name);\r\n\t\t\t} else if (storeList.indexOf(config.name) < 0) {\r\n\t\t\t\tstoreList.push(config.name);\r\n\t\t\t}\r\n\r\n\t\t\tdatastoreRender.bindDataStore(config.name, this);\r\n\r\n\t\t}\r\n\r\n\t\treturn store;\r\n\t},\r\n\tgetDatastore: function(name){\r\n\t\treturn this.$services.getService(\"datastore:\" + name);\r\n\t},\r\n\t_getDatastores: getDatastores,\r\n\r\n\trefreshData: function () {\r\n\t\tvar scrollState;\r\n\t\tif(!isHeadless(this)){\r\n\t\t\tscrollState = this.getScrollState();\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onBeforeDataRender\", []);\r\n\r\n\t\tvar stores = getDatastores.call(this);\r\n\t\tfor(var i = 0; i < stores.length; i++){\r\n\t\t\tstores[i].refresh();\r\n\t\t}\r\n\r\n\t\tif(this.config.preserve_scroll && !isHeadless(this)){\r\n\t\t\tif(scrollState.x || scrollState.y){\r\n\t\t\t\tthis.scrollTo(scrollState.x, scrollState.y);\r\n\t\t\t}\r\n\t\t\t// GS-2866: need to restore the scroll position after resizing the resource view\r\n\t\t\t// in case if it was increased\r\n\t\t\tconst scrollbarsInfo = this.$layout.getScrollbarsInfo();\r\n\t\t\tscrollbarsInfo.forEach((scroll_info) => {\r\n\t\t\t\tconst scroll = this.$ui.getView(scroll_info.id);\r\n\t\t\t\tif(!scroll) return;\r\n\t\t\t\tconst scrollbarNodeVisible = this.utils.dom.isChildOf(scroll.$view, this.$container);\r\n\t\t\t\tscroll_info.boundViews.forEach((viewName) => {\r\n\t\t\t\t\tconst view = this.$ui.getView(viewName);\r\n\t\t\t\t\tif(scroll_info.y){\r\n\t\t\t\t\t\tif(view && !scrollbarNodeVisible){\r\n\t\t\t\t\t\t\tview.scrollTo(undefined, 0);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.callEvent(\"onDataRender\", []);\r\n\r\n\t},\r\n\r\n\tisChildOf: function(childId, parentId){\r\n\t\treturn this.$data.tasksStore.isChildOf(childId, parentId);\r\n\t},\r\n\r\n\trefreshTask: function (taskId, refresh_links) {\r\n\t\tvar task = this.getTask(taskId);\r\n\t\tvar self = this;\r\n\t\tfunction refreshLinks(){\r\n\t\t\tif (refresh_links !== undefined && !refresh_links)\r\n\t\t\t\treturn;\r\n\t\t\tfor (var i = 0; i < task.$source.length; i++) {\r\n\t\t\t\tself.refreshLink(task.$source[i]);\r\n\t\t\t}\r\n\t\t\tfor (var i = 0; i < task.$target.length; i++) {\r\n\t\t\t\tself.refreshLink(task.$target[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (task && this.isTaskVisible(taskId)) {\r\n\t\t\tthis.$data.tasksStore.refresh(taskId, !!this.getState(\"tasksDnd\").drag_id || refresh_links === false);// do quick refresh during drag and drop\r\n\t\t\trefreshLinks();\r\n\t\t}else if(this.isTaskExists(taskId) && this.isTaskExists(this.getParent(taskId)) && !this._bulk_dnd){\r\n\t\t\tthis.refreshTask(this.getParent(taskId));\r\n\r\n\t\t\tvar hasSplitParent = false;\r\n\t\t\tthis.eachParent(function(parent){\r\n\t\t\t\tif(hasSplitParent || this.isSplitTask(parent)){\r\n\t\t\t\t\thasSplitParent = true;\r\n\t\t\t\t}\r\n\t\t\t}, taskId);\r\n\t\t\tif(hasSplitParent){\r\n\t\t\t\trefreshLinks();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t},\r\n\trefreshLink: function (linkId) {\r\n\t\tthis.$data.linksStore.refresh(linkId, !!this.getState(\"tasksDnd\").drag_id);// do quick refresh during drag and drop\r\n\t},\r\n\r\n\tsilent: function(code){\r\n\t\tvar gantt = this;\r\n\t\tgantt.$data.tasksStore.silent(function(){\r\n\t\t\tgantt.$data.linksStore.silent(function(){\r\n\t\t\t\tcode();\r\n\t\t\t});\r\n\t\t});\r\n\t},\r\n\r\n\tclearAll: function () {\r\n\t\tvar stores = getDatastores.call(this);\r\n\t\t\r\n\t\t// clear all stores without invoking clearAll event\r\n\t\t// in order to prevent calling handlers when only some stores are cleared\r\n\t\tfor(var i = 0; i < stores.length; i++){\r\n\t\t\tstores[i].silent(function(){\r\n\t\t\t\tstores[i].clearAll();\t\r\n\t\t\t});\r\n\t\t}\r\n\t\t// run clearAll again to invoke events\r\n\t\tfor(var i = 0; i < stores.length; i++){\r\n\t\t\tstores[i].clearAll();\t\r\n\t\t}\r\n\r\n\t\tthis._update_flags();\r\n\t\tthis.userdata = {};\r\n\t\tthis.callEvent(\"onClear\", []);\r\n\t\tthis.render();\r\n\t},\r\n\t_clear_data: function () {\r\n\t\tthis.$data.tasksStore.clearAll();\r\n\t\tthis.$data.linksStore.clearAll();\r\n\t\tthis._update_flags();\r\n\t\tthis.userdata = {};\r\n\t},\r\n\r\n\tselectTask: function(id){\r\n\t\tvar store = this.$data.tasksStore;\r\n\t\tif(!this.config.select_task)\r\n\t\t\treturn false;\r\n\t\tid = replaceValidZeroId(id, this.config.root_id);\r\n\t\tif (id){\r\n\t\t\tlet oldSelectId = this.getSelectedId();\r\n\t\t\t// Don't repaint the resource panel as the data didn't change\r\n\t\t\tstore._skipResourceRepaint = true;\r\n\t\t\tstore.select(id);\r\n\t\t\tstore._skipResourceRepaint = false;\r\n\t\t\t// GS-730. Split task is not included in the tree, \r\n\t\t\t// so the datastore renderer will think that the task is not visible\r\n\t\t\tif (oldSelectId && store.pull[oldSelectId].$split_subtask && oldSelectId != id) {\r\n\t\t\t\tthis.refreshTask(oldSelectId);\r\n\t\t\t}\r\n\t\t\tif (store.pull[id].$split_subtask && oldSelectId != id) {// GS-1850. Do not repaint split task after double click\r\n\t\t\t\tthis.refreshTask(id);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn store.getSelectedId();\r\n\t},\r\n\tunselectTask: function(id){\r\n\t\tvar store = this.$data.tasksStore;\r\n\t\tstore.unselect(id);\r\n\t\t// GS-730. Split task is not included in the tree, \r\n\t\t// so the datastore renderer will think that the task is not visible\r\n\t\tif (id && store.pull[id].$split_subtask) {\r\n\t\t\tthis.refreshTask(id);\r\n\t\t}\r\n\t},\r\n\tisSelectedTask: function(id){\r\n\t\treturn this.$data.tasksStore.isSelected(id);\r\n\t},\r\n\tgetSelectedId: function() {\r\n\t\treturn this.$data.tasksStore.getSelectedId();\r\n\t}\r\n};\r\n};\r\n\r\nfunction createFacade(){\r\n\tvar res = utils.mixin({}, createDatastoreFacade());\r\n\tutils.mixin(res, createTasksFacade());\r\n\tutils.mixin(res, createLinksFacade());\r\n\treturn res;\r\n}\r\n\r\n\r\n\r\n\r\nexport default {create: createFacade};","import ScaleHelper from \"./ui/timeline/scales_ignore\";\r\nimport PrimaryScaleHelper from \"./ui/timeline/scales\";\r\n\r\nfunction resolveConfigRange(unit, gantt){\r\n\tvar range = {\r\n\t\tstart_date:null,\r\n\t\tend_date:null\r\n\t};\r\n\r\n\tif (gantt.config.start_date && gantt.config.end_date) {\r\n\t\trange.start_date = gantt.date[unit + \"_start\"](new Date(gantt.config.start_date));\r\n\r\n\t\tvar end = new Date(gantt.config.end_date);\r\n\t\tvar start_interval = gantt.date[unit + \"_start\"](new Date(end));\r\n\t\tif (+end != +start_interval) {\r\n\t\t\tend = gantt.date.add(start_interval, 1, unit);\r\n\t\t} else {\r\n\t\t\tend = start_interval;\r\n\t\t}\r\n\r\n\t\trange.end_date = end;\r\n\t}\r\n\treturn range;\r\n}\r\n\r\nfunction _scale_range_unit(gantt) {\r\n\tconst primaryScale = (new PrimaryScaleHelper(gantt)).primaryScale();\r\n\tlet unit = primaryScale.unit;\r\n\tlet step = primaryScale.step;\r\n\tif (gantt.config.scale_offset_minimal) {\r\n\r\n\t\tconst helper = new ScaleHelper(gantt);\r\n\t\tconst scales = [helper.primaryScale()].concat(helper.getAdditionalScales());\r\n\r\n\t\thelper.sortScales(scales);\r\n\t\tunit = scales[scales.length - 1].unit;\r\n\t\tstep = scales[scales.length - 1].step || 1;\r\n\t}\r\n\treturn { unit:unit, step:step };\r\n}\r\n\r\nfunction _init_tasks_range(gantt) {\r\n\tvar cfg = _scale_range_unit(gantt);\r\n\tvar unit = cfg.unit,\r\n\t\tstep = cfg.step;\r\n\tvar range = resolveConfigRange(unit, gantt);\r\n\r\n\t// GS-1544: Show correct date range if we have tasks or only projects\r\n\tif(!(range.start_date && range.end_date)){\r\n\t\tvar onlyProjectTasks = true;\r\n\t\tvar tasks = gantt.getTaskByTime();\r\n\t\tfor (var i = 0; i < tasks.length; i++) {\r\n\t\t\tvar task = tasks[i];\r\n\t\t\tif (task.type !== gantt.config.types.project){\r\n\t\t\t\tonlyProjectTasks = false;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (tasks.length && onlyProjectTasks){\r\n\t\t\tvar start_date = tasks[0].start_date;\r\n\t\t\tvar end_date = gantt.date.add(start_date, 1, gantt.config.duration_unit);\r\n\t\t\trange = {\r\n\t\t\t\tstart_date: new Date(start_date),\r\n\t\t\t\tend_date: new Date(end_date)\r\n\t\t\t};\r\n\t\t} else{\r\n\t\t\trange = gantt.getSubtaskDates();\r\n\t\t}\r\n\r\n\t\tif(!range.start_date || !range.end_date){\r\n\t\t\trange = {\r\n\t\t\t\tstart_date: new Date(),\r\n\t\t\t\tend_date: new Date()\r\n\t\t\t};\r\n\t\t}\r\n\t\t// extend the displayed date range including the constraints, deadlines and baselines\r\n\t\tgantt.eachTask(function(task){\r\n\t\t\tif (gantt.config.deadlines && task.deadline){\r\n\t\t\t\textendRangeForDates(range, task.deadline, task.deadline);\r\n\t\t\t}\r\n\t\t\tif (task.constraint_date && task.constraint_type){\r\n\t\t\t\tif (gantt._getAutoSchedulingConfig().apply_constraints && gantt.config.constraint_types && task.constraint_type !== gantt.config.constraint_types.ASAP && task.constraint_type !== gantt.config.constraint_types.ALAP){\r\n\t\t\t\t\textendRangeForDates(range, task.constraint_date, task.constraint_date);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (gantt.config.baselines && task.baselines){\r\n\t\t\t\ttask.baselines.forEach(function(baseline){\r\n\t\t\t\t\textendRangeForDates(range, baseline.start_date, baseline.end_date);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\trange.start_date = gantt.date[unit + \"_start\"](range.start_date);\r\n\t\trange.start_date = gantt.calculateEndDate({\r\n\t\t\tstart_date: gantt.date[unit + \"_start\"](range.start_date),\r\n\t\t\tduration: -1,\r\n\t\t\tunit: unit,\r\n\t\t\tstep:step\r\n\t\t});//one free column before first task\r\n\r\n\t\trange.end_date = gantt.date[unit + \"_start\"](range.end_date);\r\n\t\trange.end_date = gantt.calculateEndDate({start_date: range.end_date, duration: 2, unit: unit, step:step});//one free column after last task\r\n\t}\r\n\r\n\tgantt._min_date = range.start_date;\r\n\tgantt._max_date = range.end_date;\r\n}\r\n\r\nfunction extendRangeForDates(range, start_date, end_date){\r\n\tif (start_date < range.start_date){\r\n\t\trange.start_date = new Date(start_date);\r\n\t}\r\n\tif (end_date > range.end_date){\r\n\t\trange.end_date = new Date(end_date);\r\n\t}\r\n}\r\n\r\nfunction _adjust_scales(gantt) {\r\n\tif (gantt.config.fit_tasks) {\r\n\t\tvar old_min = +gantt._min_date,\r\n\t\t\told_max = +gantt._max_date;\r\n\t\t//this._init_tasks_range();\r\n\t\tif (+gantt._min_date != old_min || +gantt._max_date != old_max) {\r\n\t\t\tgantt.render();\r\n\r\n\t\t\tgantt.callEvent(\"onScaleAdjusted\", []);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nexport default function updateTasksRange(gantt){\r\n\t_init_tasks_range(gantt);\r\n\t_adjust_scales(gantt);\r\n};\r\n","function copyLinkIdsArray(gantt, linkIds, targetHash){\r\n\tfor(var i = 0; i < linkIds.length; i++) {\r\n\t\tif(gantt.isLinkExists(linkIds[i])){\r\n\t\t\ttargetHash[linkIds[i]] = gantt.getLink(linkIds[i]);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction copyLinkIds(gantt, task, targetHash){\r\n\tcopyLinkIdsArray(gantt, task.$source, targetHash);\r\n\tcopyLinkIdsArray(gantt, task.$target, targetHash);\r\n}\r\n\r\nfunction getSubtreeLinks(gantt, rootId){\r\n\tvar res = {};\r\n\r\n\tif(gantt.isTaskExists(rootId)){\r\n\t\tcopyLinkIds(gantt, gantt.getTask(rootId), res);\r\n\t}\r\n\r\n\tgantt.eachTask(function(child){\r\n\t\tcopyLinkIds(gantt, child, res);\r\n\t}, rootId);\r\n\r\n\treturn res;\r\n}\r\n\r\nfunction getSubtreeTasks(gantt, rootId){\r\n\tvar res = {};\r\n\r\n\tgantt.eachTask(function(child){\r\n\t\tres[child.id] = child;\r\n\t}, rootId);\r\n\r\n\treturn res;\r\n}\r\n\r\nexport default {\r\n\tgetSubtreeLinks: getSubtreeLinks,\r\n\tgetSubtreeTasks: getSubtreeTasks\r\n};","import * as utils from \"../../utils/utils\";\r\nimport facadeFactory from \"./../facades/datastore\";\r\nimport calculateScaleRange from \"../gantt_data_range\";\r\nimport isPlaceholderTask from \"../../utils/placeholder_task\";\r\n\r\nimport treeHelper from \"../../utils/task_tree_helpers\";\r\n\r\nfunction initDataStores(gantt){\r\n\r\n\tvar facade = facadeFactory.create();\r\n\tutils.mixin(gantt, facade);\r\n\tvar tasksStore = gantt.createDatastore({\r\n\t\tname: \"task\",\r\n\t\ttype: \"treeDatastore\",\r\n\t\trootId: function() { return gantt.config.root_id; },\r\n\t\tinitItem: utils.bind(_init_task, gantt),\r\n\t\tgetConfig: function() { return gantt.config; }\r\n\t});\r\n\r\n\tvar linksStore = gantt.createDatastore({\r\n\t\tname: \"link\",\r\n\t\tinitItem: utils.bind(_init_link, gantt)\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onDestroy\", function(){\r\n\t\ttasksStore.destructor();\r\n\t\tlinksStore.destructor();\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onLinkValidation\", function(link){\r\n\t\tif(gantt.isLinkExists(link.id) || link.id === \"predecessor_generated\"){\r\n\t\t\t// link was already added into gantt\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar source = gantt.getTask(link.source);\r\n\t\tvar taskLinks = source.$source;\r\n\t\tfor (var i = 0; i < taskLinks.length; i++) {\r\n\t\t\tvar existingLink = gantt.getLink(taskLinks[i]);\r\n\r\n\t\t\tvar sourceMatch = link.source == existingLink.source;\r\n\t\t\tvar targetMatch = link.target == existingLink.target;\r\n\t\t\tvar typeMatch = link.type == existingLink.type;\r\n\r\n\t\t\t// prevent creating duplicated links from the UI\r\n\t\t\tif (sourceMatch && targetMatch && typeMatch) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t});\r\n\r\n\ttasksStore.attachEvent(\"onBeforeRefreshAll\", function(){\r\n\r\n\t\t// GS-2170 do not recalculate indexes and dates as the event will be called later in the onStoreUpdate event\r\n\t\tif (tasksStore._skipTaskRecalculation){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar order = tasksStore.getVisibleItems();\r\n\r\n\t\tfor(var i=0; i < order.length; i++){\r\n\t\t\tvar item = order[i];\r\n\t\t\titem.$index = i;\r\n\t\t\titem.$local_index = gantt.getTaskIndex(item.id);\r\n\t\t\tgantt.resetProjectDates(item);\r\n\t\t}\r\n\r\n\t});\r\n\r\n\ttasksStore.attachEvent(\"onFilterItem\", function(id, task) {\r\n\t\tif (gantt.config.show_tasks_outside_timescale) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar min = null, max = null;\r\n\t\tif (gantt.config.start_date && gantt.config.end_date) {\r\n\t\t\tif (gantt._isAllowedUnscheduledTask(task)) return true;\r\n\t\t\tmin = gantt.config.start_date.valueOf();\r\n\t\t\tmax = gantt.config.end_date.valueOf();\r\n\r\n\t\t\tif (+task.start_date > max || +task.end_date < +min)\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t});\r\n\r\n\ttasksStore.attachEvent(\"onIdChange\", function(oldId, newId){\r\n\t\tgantt._update_flags(oldId, newId);\r\n\r\n\t\tvar changedTask = gantt.getTask(newId);\r\n\t\tif(!tasksStore.isSilent()){\r\n\t\t\tif(changedTask.$split_subtask || changedTask.rollup){\r\n\t\t\t\tgantt.eachParent(function(parent){\r\n\t\t\t\t\tgantt.refreshTask(parent.id);\r\n\t\t\t\t}, newId);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\ttasksStore.attachEvent(\"onAfterUpdate\", function(id){\r\n\t\tgantt._update_parents(id);\r\n\t\tif(gantt.getState(\"batchUpdate\").batch_update){\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tvar task = tasksStore.getItem(id);\r\n\t\tif (!task.$source) task.$source = [];\r\n\t\tfor (var i = 0; i < task.$source.length; i++) {\r\n\t\t\tlinksStore.refresh(task.$source[i]);\r\n\t\t}\r\n\t\tif (!task.$target) task.$target = [];\r\n\t\tfor (var i = 0; i < task.$target.length; i++) {\r\n\t\t\tlinksStore.refresh(task.$target[i]);\r\n\t\t}\r\n\t});\r\n\r\n\ttasksStore.attachEvent(\"onBeforeItemMove\", function(sid, parent, tindex){\r\n\t\t// GS-125. Don't allow users to move the placeholder task\r\n\t\tif (isPlaceholderTask(sid, gantt, tasksStore)){\r\n\t\t\t//eslint-disable-next-line\r\n\t\t\tconsole.log(\"The placeholder task cannot be moved to another position.\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t});\r\n\r\n\ttasksStore.attachEvent(\"onAfterItemMove\", function(sid, parent, tindex){\r\n\t\tvar source = gantt.getTask(sid);\r\n\r\n\t\tif(this.getNextSibling(sid) !== null){\r\n\t\t\tsource.$drop_target = this.getNextSibling(sid);\r\n\t\t} else if(this.getPrevSibling(sid) !== null){\r\n\t\t\tsource.$drop_target = \"next:\" + this.getPrevSibling(sid);\r\n\t\t}else{\r\n\t\t\tsource.$drop_target = \"next:null\";\r\n\t\t}\r\n\r\n\t});\r\n\r\n\ttasksStore.attachEvent(\"onStoreUpdated\", function(id, item, action){\r\n\t\tif(action == \"delete\"){\r\n\t\t\tgantt._update_flags(id, null);\r\n\t\t}\r\n\r\n\t\tvar state = gantt.$services.getService(\"state\");\r\n\t\tif(state.getState(\"batchUpdate\").batch_update){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(gantt.config.fit_tasks && action !== \"paint\"){\r\n\t\t\tvar oldState = gantt.getState();\r\n\t\t\tcalculateScaleRange(gantt);\r\n\t\t\tvar newState = gantt.getState();\r\n\r\n\t\t\t//this._init_tasks_range();\r\n\t\t\tif (+oldState.min_date != +newState.min_date || +oldState.max_date != +newState.max_date) {\r\n\t\t\t\tgantt.render();\r\n\r\n\t\t\t\tgantt.callEvent(\"onScaleAdjusted\", []);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif(action == \"add\" || action == \"move\" || action == \"delete\"){\r\n\t\t\tif(gantt.$layout){\r\n\t\t\t\t// GS-2170. Do not recalculate the indexes and dates of other tasks in the\r\n\t\t\t\t// onBeforeResize layout event, but do it later. If lightbox is opened, it will\r\n\t\t\t\t// trigger the refreshData, so the indexes and dates will be recalculated there\r\n\t\t\t\tif (this.$config.name == \"task\" && (action == \"add\" || action == \"delete\")){\r\n\t\t\t\t\tif (this._skipTaskRecalculation != \"lightbox\"){\r\n\t\t\t\t\t\tthis._skipTaskRecalculation = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tgantt.$layout.resize();\r\n\t\t\t}\r\n\r\n\t\t}else if(!id){\r\n\t\t\tlinksStore.refresh();\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tlinksStore.attachEvent(\"onAfterAdd\", function(id, link){\r\n\t\tlinksStore.sync_link(link);\r\n\t});\r\n\tlinksStore.attachEvent(\"onAfterUpdate\", function(id, link){\r\n\t\tsync_links();\r\n\t});\r\n\tlinksStore.attachEvent(\"onAfterDelete\", function(id, link){\r\n\t\tsync_link_delete(link);\r\n\t});\r\n\tlinksStore.attachEvent(\"onAfterSilentDelete\", function(id, link){\r\n\t\tsync_link_delete(link);\r\n\t});\r\n\tlinksStore.attachEvent(\"onBeforeIdChange\", function(oldId, newId){\r\n\t\tsync_link_delete(gantt.mixin({id:oldId}, gantt.$data.linksStore.getItem(newId)));\r\n\t\tlinksStore.sync_link(gantt.$data.linksStore.getItem(newId));\r\n\t});\r\n\r\n\tfunction checkLinkedTaskVisibility(taskId){\r\n\t\tvar isVisible = gantt.isTaskVisible(taskId);\r\n\t\tif(!isVisible && gantt.isTaskExists(taskId)){\r\n\t\t\tvar parent = gantt.getParent(taskId);\r\n\t\t\tif(gantt.isTaskExists(parent) && gantt.isTaskVisible(parent)){\r\n\t\t\t\tparent = gantt.getTask(parent);\r\n\t\t\t\tif(gantt.isSplitTask(parent)){\r\n\t\t\t\t\tisVisible = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn isVisible;\r\n\t}\r\n\r\n\tlinksStore.attachEvent(\"onFilterItem\", function(id, link){\r\n\t\tif (!gantt.config.show_links) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar sourceVisible = checkLinkedTaskVisibility(link.source);\r\n\t\tvar targetVisible = checkLinkedTaskVisibility(link.target);\r\n\r\n\t\tif (!(sourceVisible && targetVisible) ||\r\n\t\t\tgantt._isAllowedUnscheduledTask(gantt.getTask(link.source)) || gantt._isAllowedUnscheduledTask(gantt.getTask(link.target)))\r\n\t\t\treturn false;\r\n\r\n\t\treturn gantt.callEvent(\"onBeforeLinkDisplay\", [id, link]);\r\n\t});\r\n\r\n\r\n\t(function(){\r\n\t\t// delete all connected links after task is deleted\r\n\t\tvar deletedLinks = {};\r\n\r\n\t\tgantt.attachEvent(\"onBeforeTaskDelete\", function(id, item){\r\n\t\t\tdeletedLinks[id] = treeHelper.getSubtreeLinks(gantt, id);\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onAfterTaskDelete\", function(id, item) {\r\n\t\t\tif(deletedLinks[id]){\r\n\t\t\t\tgantt.$data.linksStore.silent(function(){\r\n\t\t\t\t\tfor(var i in deletedLinks[id]){\r\n\t\t\t\t\t\tif (gantt.isLinkExists(i)){\r\n\t\t\t\t\t\t\tgantt.$data.linksStore.removeItem(i);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsync_link_delete(deletedLinks[id][i]);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdeletedLinks[id] = null;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t})();\r\n\r\n\tgantt.attachEvent(\"onAfterLinkDelete\", function(id, link) {\r\n\t\t// GS-1786. Repaint tasks only if they are loaded\r\n\t\tif(gantt.isTaskExists(link.source)){\r\n\t\t\tgantt.refreshTask(link.source);\r\n\t\t}\r\n\t\tif(gantt.isTaskExists(link.target)){\r\n\t\t\tgantt.refreshTask(link.target);\r\n\t\t}\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onParse\", sync_links);\r\n\r\n\tmapEvents({\r\n\t\tsource: linksStore,\r\n\t\ttarget: gantt,\r\n\t\tevents:{\r\n\t\t\t\"onItemLoading\":\"onLinkLoading\",\r\n\t\t\t\"onBeforeAdd\":\"onBeforeLinkAdd\",\r\n\t\t\t\"onAfterAdd\":\"onAfterLinkAdd\",\r\n\t\t\t\"onBeforeUpdate\":\"onBeforeLinkUpdate\",\r\n\t\t\t\"onAfterUpdate\":\"onAfterLinkUpdate\",\r\n\t\t\t\"onBeforeDelete\":\"onBeforeLinkDelete\",\r\n\t\t\t\"onAfterDelete\":\"onAfterLinkDelete\",\r\n\t\t\t\"onIdChange\":\"onLinkIdChange\"\r\n\t\t}\r\n\t});\r\n\r\n\tmapEvents({\r\n\t\tsource: tasksStore,\r\n\t\ttarget: gantt,\r\n\t\tevents:{\r\n\t\t\t\"onItemLoading\":\"onTaskLoading\",\r\n\t\t\t\"onBeforeAdd\":\"onBeforeTaskAdd\",\r\n\t\t\t\"onAfterAdd\":\"onAfterTaskAdd\",\r\n\t\t\t\"onBeforeUpdate\":\"onBeforeTaskUpdate\",\r\n\t\t\t\"onAfterUpdate\":\"onAfterTaskUpdate\",\r\n\t\t\t\"onBeforeDelete\":\"onBeforeTaskDelete\",\r\n\t\t\t\"onAfterDelete\":\"onAfterTaskDelete\",\r\n\t\t\t\"onIdChange\":\"onTaskIdChange\",\r\n\t\t\t\"onBeforeItemMove\":\"onBeforeTaskMove\",\r\n\t\t\t\"onAfterItemMove\":\"onAfterTaskMove\",\r\n\t\t\t\"onFilterItem\":\"onBeforeTaskDisplay\",\r\n\t\t\t\"onItemOpen\":\"onTaskOpened\",\r\n\t\t\t\"onItemClose\":\"onTaskClosed\",\r\n\t\t\t\"onBeforeSelect\":\"onBeforeTaskSelected\",\r\n\t\t\t\"onAfterSelect\":\"onTaskSelected\",\r\n\t\t\t\"onAfterUnselect\":\"onTaskUnselected\"\r\n\t\t}\r\n\t});\r\n\r\n\tgantt.$data = {\r\n\t\ttasksStore: tasksStore,\r\n\t\tlinksStore: linksStore\r\n\t};\r\n\r\n\tlinksStore.sync_link = function(link) {\r\n\t\tif(gantt.isTaskExists(link.source)){\r\n\t\t\tvar sourceTask = gantt.getTask(link.source);\r\n\t\t\tsourceTask.$source = sourceTask.$source || [];\r\n\t\t\tif (noDuplicateIds(link.id, sourceTask.$source)){\r\n\t\t\t\tsourceTask.$source.push(link.id);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(gantt.isTaskExists(link.target)){\r\n\t\t\tvar targetTask = gantt.getTask(link.target);\r\n\t\t\ttargetTask.$target = targetTask.$target || [];\r\n\t\t\tif (noDuplicateIds(link.id, targetTask.$target)){\r\n\t\t\t\ttargetTask.$target.push(link.id);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t// GS-2085. Don't add duplicate link IDs\r\n\tfunction noDuplicateIds(id, array){\r\n\t\treturn array.indexOf(String(id)) === -1 && array.indexOf(Number(id)) === -1;\r\n\t}\r\n\r\n\tfunction sync_link_delete(link){\r\n\t\tif(gantt.isTaskExists(link.source)){\r\n\t\t\tvar sourceTask = gantt.getTask(link.source);\r\n\t\t\tfor(var i = 0; i < sourceTask.$source.length; i++){\r\n\t\t\t\tif(sourceTask.$source[i] == link.id){\r\n\t\t\t\t\tsourceTask.$source.splice(i, 1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(gantt.isTaskExists(link.target)){\r\n\t\t\tvar targetTask = gantt.getTask(link.target);\r\n\t\t\tfor(var i = 0; i < targetTask.$target.length; i++){\r\n\t\t\t\tif(targetTask.$target[i] == link.id){\r\n\t\t\t\t\ttargetTask.$target.splice(i, 1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction sync_links() {\r\n\t\tvar task = null;\r\n\t\tvar tasks = gantt.$data.tasksStore.getItems();\r\n\r\n\t\tfor(var i = 0, len = tasks.length; i < len; i++){\r\n\t\t\ttask = tasks[i];\r\n\t\t\ttask.$source = [];\r\n\t\t\ttask.$target = [];\r\n\t\t}\r\n\r\n\t\tvar links = gantt.$data.linksStore.getItems();\r\n\t\tfor (var i = 0, len = links.length; i < len; i++) {\r\n\r\n\t\t\tvar link = links[i];\r\n\t\t\tlinksStore.sync_link(link);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction mapEvents(conf){\r\n\t\tvar mapFrom = conf.source;\r\n\t\tvar mapTo = conf.target;\r\n\t\tfor(var i in conf.events){\r\n\t\t\t(function(sourceEvent, targetEvent){\r\n\t\t\t\tmapFrom.attachEvent(sourceEvent, function(){\r\n\t\t\t\t\treturn mapTo.callEvent(targetEvent, Array.prototype.slice.call(arguments));\r\n\t\t\t\t}, targetEvent);\r\n\t\t\t})(i, conf.events[i]);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _init_task(task) {\r\n\t\tif (!this.defined(task.id))\r\n\t\t\ttask.id = this.uid();\r\n\r\n\t\tif (task.start_date)\r\n\t\t\ttask.start_date = gantt.date.parseDate(task.start_date, \"parse_date\");\r\n\t\tif (task.end_date)\r\n\t\t\ttask.end_date = gantt.date.parseDate(task.end_date, \"parse_date\");\r\n\r\n\r\n\t\tvar duration = null;\r\n\t\tif (task.duration || task.duration === 0) {\r\n\t\t\ttask.duration = duration = task.duration * 1;\r\n\t\t}\r\n\r\n\t\tif (duration) {\r\n\t\t\tif (task.start_date && !task.end_date) {\r\n\t\t\t\ttask.end_date = this.calculateEndDate(task);\r\n\t\t\t} else if (!task.start_date && task.end_date) {\r\n\t\t\t\ttask.start_date = this.calculateEndDate({\r\n\t\t\t\t\tstart_date: task.end_date,\r\n\t\t\t\t\tduration: -task.duration,\r\n\t\t\t\t\ttask: task\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t//task.$calculate_duration = false;\r\n\t\t}\r\n\r\n\t\tif (gantt.config.deadlines !== false && task.deadline){\r\n\t\t\ttask.deadline = gantt.date.parseDate(task.deadline, \"parse_date\");\r\n\t\t}\r\n\r\n\t\ttask.progress = Number(task.progress) || 0;\r\n\r\n\t\tif (this._isAllowedUnscheduledTask(task)) {\r\n\t\t\tthis._set_default_task_timing(task);\r\n\t\t}\r\n\t\tthis._init_task_timing(task);\r\n\t\tif (task.start_date && task.end_date)\r\n\t\t\tthis.correctTaskWorkTime(task);\r\n\r\n\t\ttask.$source = [];\r\n\t\ttask.$target = [];\r\n\r\n\t\tvar originalTask = this.$data.tasksStore.getItem(task.id);\r\n\t\tif (originalTask && !utils.defined(task.open)) {\r\n\t\t\t// if a task with the same id is already in the gantt and the new object doesn't specify the `open` state -\r\n\t\t\t// restore the `open` state we already have in the chart\r\n\t\t\ttask.$open = originalTask.$open;\r\n\t\t}\r\n\r\n\t\tif (task.parent === undefined) {\r\n\t\t\ttask.parent = this.config.root_id;\r\n\t\t}\r\n\t\tif(task.open){\r\n\t\t\ttask.$open = true;\r\n\t\t}\r\n\t\treturn task;\r\n\t}\r\n\r\n\tfunction _init_link(link) {\r\n\t\tif (!this.defined(link.id))\r\n\t\t\tlink.id = this.uid();\r\n\t\treturn link;\r\n\t}\r\n}\r\n\r\n\r\nexport default initDataStores;\r\n","import * as helpers from \"../../utils/helpers\";\r\nimport treeHelper from \"../../utils/task_tree_helpers\";\r\n\r\n\r\nexport default class DataProcessorEvents {\r\n\tprotected _dataProcessorHandlers: any[];\r\n\tprotected $gantt: any;\r\n\tprotected $dp: any;\r\n\r\n\tconstructor(gantt: any, dp: any) {\r\n\t\tthis.$gantt = gantt;\r\n\t\tthis.$dp = dp;\r\n\t\tthis._dataProcessorHandlers = [];\r\n\t}\r\n\r\n\tattach() {\r\n\t\tconst dp = this.$dp;\r\n\t\tconst gantt = this.$gantt;\r\n\t\tconst cascadeDelete = {};\r\n\r\n\t\tconst clientSideDelete = (id) => {\r\n\t\t\treturn this.clientSideDelete(id, dp, gantt);\r\n\t\t};\r\n\r\n\t\tfunction getTaskLinks(task) {\r\n\t\t\tlet _links = [];\r\n\r\n\t\t\tif (task.$source) {\r\n\t\t\t\t_links = _links.concat(task.$source);\r\n\t\t\t}\r\n\t\t\tif (task.$target) {\r\n\t\t\t\t_links = _links.concat(task.$target);\r\n\t\t\t}\r\n\r\n\t\t\treturn _links;\r\n\t\t}\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterTaskAdd\", function(id, item) { // tslint:disable-line\r\n\t\t\tif (gantt.isTaskExists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"tasks\");\r\n\t\t\t\tdp.setUpdated(id, true, \"inserted\");\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterTaskUpdate\", function(id, item) { // tslint:disable-line\r\n\t\t\tif (gantt.isTaskExists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"tasks\");\r\n\t\t\t\tdp.setUpdated(id, true);\r\n\r\n\t\t\t\t// gantt can be destroyed/reinitialized after dp.setUpdated\r\n\t\t\t\tif(gantt._sendTaskOrder){\r\n\t\t\t\t\tgantt._sendTaskOrder(id, item);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onBeforeTaskDelete\", function(id, item) { // tslint:disable-line\r\n\t\t\tif (gantt.config.cascade_delete) {\r\n\t\t\t\tcascadeDelete[id] = {\r\n\t\t\t\t\ttasks: treeHelper.getSubtreeTasks(gantt, id),\r\n\t\t\t\t\tlinks: treeHelper.getSubtreeLinks(gantt, id)\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t// GS-631. Keep the deleted item in Gantt until we receive the successful response from the server\r\n\t\t\tif (dp.deleteAfterConfirmation) {\r\n\t\t\t\tdp.setGanttMode(\"tasks\");\r\n\t\t\t\tdp.setUpdated(id, true, \"deleted\");\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}));\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterTaskDelete\", function(id, item) { // tslint:disable-line\r\n\t\t\tdp.setGanttMode(\"tasks\");\r\n\r\n\t\t\t// not send delete request if item is not inserted into the db - just remove it from the client\r\n\t\t\tconst needDbDelete = !clientSideDelete(id);\r\n\t\t\tconst needCascadeDelete = gantt.config.cascade_delete && cascadeDelete[id];\r\n\t\t\tif (!needDbDelete && !needCascadeDelete) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (needCascadeDelete) {\r\n\t\t\t\tconst dpMode = dp.updateMode;\r\n\t\t\t\tdp.setUpdateMode(\"off\");\r\n\r\n\t\t\t\tconst cascade = cascadeDelete[id];\r\n\t\t\t\tfor (const i in cascade.tasks) {\r\n\t\t\t\t\tif (!clientSideDelete(i)) {\r\n\t\t\t\t\t\tdp.storeItem(cascade.tasks[i]);\r\n\t\t\t\t\t\tdp.setUpdated(i, true, \"deleted\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tdp.setGanttMode(\"links\");\r\n\t\t\t\tfor (const i in cascade.links) {\r\n\t\t\t\t\tif (!clientSideDelete(i)) {\r\n\t\t\t\t\t\tdp.storeItem(cascade.links[i]);\r\n\t\t\t\t\t\tdp.setUpdated(i, true, \"deleted\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcascadeDelete[id] = null;\r\n\r\n\t\t\t\tif (dpMode !== \"off\") {\r\n\t\t\t\t\tdp.sendAllData();\r\n\t\t\t\t}\r\n\t\t\t\tdp.setGanttMode(\"tasks\");\r\n\t\t\t\tdp.setUpdateMode(dpMode);\r\n\t\t\t}\r\n\r\n\t\t\tif (needDbDelete){\r\n\t\t\t\tdp.storeItem(item);\r\n\t\t\t\tif (!dp.deleteAfterConfirmation){\r\n\t\t\t\t\tdp.setUpdated(id, true, \"deleted\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n\t\t\tif (dp.updateMode !== \"off\" && !dp._tSend) {\r\n\t\t\t\tdp.sendAllData();\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterLinkUpdate\", function(id, item) { // tslint:disable-line\r\n\t\t\tif (gantt.isLinkExists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"links\");\r\n\t\t\t\tdp.setUpdated(id, true);\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterLinkAdd\", function(id, item) { // tslint:disable-line\r\n\t\t\tif (gantt.isLinkExists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"links\");\r\n\t\t\t\tdp.setUpdated(id, true,\"inserted\");\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterLinkDelete\", function(id, item) { // tslint:disable-line\r\n\t\t\tdp.setGanttMode(\"links\");\r\n\r\n\t\t\tconst needDbDelete = !clientSideDelete(id);\r\n\t\t\tif (!needDbDelete) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdp.storeItem(item);\r\n\t\t\tdp.setUpdated(id, true,\"deleted\");\r\n\t\t}));\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onRowDragEnd\", function(id, target) { // tslint:disable-line\r\n\t\t\tgantt._sendTaskOrder(id, gantt.getTask(id));\r\n\t\t}));\r\n\r\n\t\tlet tasks = null;\r\n\t\tlet links = null;\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onTaskIdChange\", function(oldId, newId) { // tslint:disable-line\r\n\t\t\tif (!dp._waitMode) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst children = gantt.getChildren(newId);\r\n\t\t\tif (children.length) {\r\n\t\t\t\ttasks = tasks || {};\r\n\r\n\t\t\t\tfor (let i = 0; i < children.length; i++) {\r\n\t\t\t\t\tconst ch = this.getTask(children[i]);\r\n\t\t\t\t\ttasks[ch.id] = ch;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst item = this.getTask(newId);\r\n\t\t\tconst itemLinks = getTaskLinks(item);\r\n\r\n\t\t\tif (itemLinks.length) {\r\n\t\t\t\tlinks = links || {};\r\n\r\n\t\t\t\tfor (let i = 0; i < itemLinks.length; i++) {\r\n\t\t\t\t\tconst link = this.getLink(itemLinks[i]);\r\n\t\t\t\t\tlinks[link.id] = link;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tdp.attachEvent(\"onAfterUpdateFinish\", function() {\r\n\t\t\tif (tasks || links) {\r\n\t\t\t\tgantt.batchUpdate(function() {\r\n\t\t\t\t\tfor (const id in tasks) {\r\n\t\t\t\t\t\tgantt.updateTask(tasks[id].id);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (const id in links) {\r\n\t\t\t\t\t\tgantt.updateLink(links[id].id);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttasks = null;\r\n\t\t\t\t\tlinks = null;\r\n\t\t\t\t});\r\n\t\t\t\tif (tasks) {\r\n\t\t\t\t\tgantt._dp.setGanttMode(\"tasks\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tgantt._dp.setGanttMode(\"links\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tdp.attachEvent(\"onBeforeDataSending\", function() {\r\n\t\t\tif (this._tMode === \"CUSTOM\") {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tlet url = this._serverProcessor;\r\n\t\t\tif (this._tMode === \"REST-JSON\" || this._tMode === \"REST\") {\r\n\t\t\t\tconst mode = this._ganttMode;\r\n\r\n\t\t\t\turl = url.substring(0, url.indexOf(\"?\") > -1 ? url.indexOf(\"?\") : url.length);\r\n\t\t\t\t// editing=true&\r\n\t\t\t\tthis.serverProcessor = url + (url.slice(-1) === \"/\" ? \"\" : \"/\") + mode;\r\n\t\t\t} else {\r\n\t\t\t\tconst pluralizedMode = this._ganttMode + \"s\";\r\n\t\t\t\tthis.serverProcessor = url + gantt.ajax.urlSeparator(url) + \"gantt_mode=\" + pluralizedMode;\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tdp.attachEvent(\"insertCallback\", function insertCallback(upd, id, parent, mode) { // tslint:disable-line\r\n\t\t\tconst data = upd.data || gantt.xml._xmlNodeToJSON(upd.firstChild);\r\n\t\t\tconst methods = {\r\n\t\t\t\tadd: gantt.addTask,\r\n\t\t\t\tisExist: gantt.isTaskExists\r\n\t\t\t};\r\n\t\t\tif (mode === \"links\") {\r\n\t\t\t\tmethods.add = gantt.addLink;\r\n\t\t\t\tmethods.isExist = gantt.isLinkExists;\r\n\t\t\t}\r\n\t\t\tif (methods.isExist.call(gantt, id)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdata.id = id;\r\n\t\t\tmethods.add.call(gantt, data);\r\n\t\t});\r\n\r\n\t\tdp.attachEvent(\"updateCallback\", function updateCallback(upd, id) {\r\n\t\t\tconst data = upd.data || gantt.xml._xmlNodeToJSON(upd.firstChild);\r\n\t\t\tif (!gantt.isTaskExists(id)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst objData = gantt.getTask(id);\r\n\t\t\tfor (const key in data) {\r\n\t\t\t\tlet property = data[key];\r\n\t\t\t\tswitch (key) {\r\n\t\t\t\t\tcase \"id\":\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\tcase \"start_date\":\r\n\t\t\t\t\tcase \"end_date\":\r\n\t\t\t\t\t\tproperty = gantt.defined(gantt.templates.xml_date) ? gantt.templates.xml_date(property) : gantt.templates.parse_date(property);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"duration\":\r\n\t\t\t\t\t\tobjData.end_date = gantt.calculateEndDate({start_date: objData.start_date, duration: property, task:objData});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tobjData[key] = property;\r\n\t\t\t}\r\n\t\t\tgantt.updateTask(id);\r\n\t\t\tgantt.refreshData();\r\n\t\t});\r\n\t\tdp.attachEvent(\"deleteCallback\", function deleteCallback(upd, id, parent, mode) { // tslint:disable-line\r\n\t\t\tconst methods = {\r\n\t\t\t\tdelete: gantt.deleteTask,\r\n\t\t\t\tisExist: gantt.isTaskExists\r\n\t\t\t};\r\n\t\t\tif (mode === \"links\") {\r\n\t\t\t\tmethods.delete = gantt.deleteLink;\r\n\t\t\t\tmethods.isExist = gantt.isLinkExists;\r\n\t\t\t} else if(mode === \"assignment\") {\r\n\t\t\t\tmethods.delete = function(val) {\r\n\t\t\t\t\tgantt.$data.assignmentsStore.remove(val);\r\n\t\t\t\t};\r\n\t\t\t\tmethods.isExist = function(val){\r\n\t\t\t\t\treturn gantt.$data.assignmentsStore.exists(val);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif (methods.isExist.call(gantt, id)) {\r\n\t\t\t\tmethods.delete.call(gantt, id);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.handleResourceCRUD(dp, gantt);\r\n\t\tthis.handleResourceAssignmentCRUD(dp, gantt);\r\n\t\tthis.handleBaselineCRUD(dp, gantt);\r\n\t}\r\n\r\n\tclientSideDelete(id, dp, gantt){\r\n\t\tconst updated = dp.updatedRows.slice();\r\n\t\tlet clientOnly = false;\r\n\r\n\t\tif(gantt.getUserData(id, \"!nativeeditor_status\", dp._ganttMode) === \"true_deleted\"){\r\n\t\t\tclientOnly = true;\r\n\t\t\tdp.setUpdated(id,false);\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < updated.length && !dp._in_progress[id]; i++) {\r\n\t\t\tif (updated[i] === id) {\r\n\t\t\t\tif (gantt.getUserData(id, \"!nativeeditor_status\", dp._ganttMode) === \"inserted\") {\r\n\t\t\t\t\tclientOnly = true;\r\n\t\t\t\t}\r\n\t\t\t\tdp.setUpdated(id,false);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn clientOnly;\r\n\t}\r\n\r\n\thandleResourceAssignmentCRUD(dp, gantt){\r\n\t\tif(!gantt.config.resources || gantt.config.resources.dataprocessor_assignments !== true){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst assignmentsStore = gantt.getDatastore(gantt.config.resource_assignment_store);\r\n\t\tconst insertedTasks = {};\r\n\t\tconst pendingAssignments = {};\r\n\r\n\t\tgantt.attachEvent(\"onBeforeTaskAdd\", function(id, task){\r\n\t\t\tinsertedTasks[id] = true;\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tfunction putAssignmentToQueue(item){\r\n\t\t\tpendingAssignments[item.id] = item;\r\n\t\t\tinsertedTasks[item.task_id] = true;\r\n\t\t}\r\n\r\n\t\tfunction insertResourceAssignment(assignment){\r\n\t\t\tconst id = assignment.id;\r\n\t\t\tif (assignmentsStore.exists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"assignment\");\r\n\t\t\t\tdp.setUpdated(id, true,\"inserted\");\r\n\t\t\t}\r\n\t\t\tdelete pendingAssignments[id];\r\n\t\t}\r\n\r\n\t\tgantt.attachEvent(\"onTaskIdChange\", function(id, newId){\r\n\t\t\tdelete insertedTasks[id];\r\n\t\t});\r\n\r\n\t\tassignmentsStore.attachEvent(\"onAfterAdd\", (id, item) => {\r\n\t\t\tif(insertedTasks[item.task_id]){\r\n\t\t\t\t// inserting assignment of new task\r\n\t\t\t\t// task is not saved yet, need to wait till it gets permanent id and save assigmnents after that\r\n\t\t\t\tputAssignmentToQueue(item);\r\n\t\t\t}else{\r\n\t\t\t\tinsertResourceAssignment(item);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tassignmentsStore.attachEvent(\"onAfterUpdate\", (id, item) => {\r\n\t\t\tif (assignmentsStore.exists(id)) {\r\n\t\t\t\tif(pendingAssignments[id]){\r\n\t\t\t\t\tinsertResourceAssignment(item);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdp.setGanttMode(\"assignment\");\r\n\t\t\t\t\tdp.setUpdated(id, true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tassignmentsStore.attachEvent(\"onAfterDelete\", (id, item) => {\r\n\t\t\tdp.setGanttMode(\"assignment\");\r\n\r\n\t\t\tconst needDbDelete = !this.clientSideDelete(id, dp, gantt);\r\n\t\t\tif (!needDbDelete) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdp.storeItem(item);\r\n\t\t\tdp.setUpdated(id, true,\"deleted\");\r\n\t\t});\r\n\r\n\t}\r\n\r\n\thandleResourceCRUD(dp, gantt){\r\n\t\tif(!gantt.config.resources || gantt.config.resources.dataprocessor_resources !== true){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst resourcesStore = gantt.getDatastore(gantt.config.resource_store);\r\n\r\n\t\tfunction insertResource(resource){\r\n\t\t\tconst id = resource.id;\r\n\t\t\tif (resourcesStore.exists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"resource\");\r\n\t\t\t\tdp.setUpdated(id, true,\"inserted\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tresourcesStore.attachEvent(\"onAfterAdd\", (id, item) => {\r\n\t\t\tinsertResource(item);\r\n\t\t});\r\n\r\n\t\tresourcesStore.attachEvent(\"onAfterUpdate\", (id, item) => {\r\n\t\t\tif (resourcesStore.exists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"resource\");\r\n\t\t\t\tdp.setUpdated(id, true);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tresourcesStore.attachEvent(\"onAfterDelete\", (id, item) => {\r\n\t\t\tdp.setGanttMode(\"resource\");\r\n\r\n\t\t\tconst needDbDelete = !this.clientSideDelete(id, dp, gantt);\r\n\t\t\tif (!needDbDelete) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdp.storeItem(item);\r\n\t\t\tdp.setUpdated(id, true,\"deleted\");\r\n\t\t});\r\n\r\n\t}\r\n\r\n\thandleBaselineCRUD(dp, gantt){\r\n\t\tif(!gantt.config.baselines || gantt.config.baselines.dataprocessor_baselines !== true){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst baselineStore = gantt.getDatastore(gantt.config.baselines.datastore);\r\n\r\n\t\tfunction insertResource(resource){\r\n\t\t\tconst id = resource.id;\r\n\t\t\tif (baselineStore.exists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"baseline\");\r\n\t\t\t\tdp.setUpdated(id, true,\"inserted\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tbaselineStore.attachEvent(\"onAfterAdd\", (id, item) => {\r\n\t\t\tinsertResource(item);\r\n\t\t});\r\n\r\n\t\tbaselineStore.attachEvent(\"onAfterUpdate\", (id, item) => {\r\n\t\t\tif (baselineStore.exists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"baseline\");\r\n\t\t\t\tdp.setUpdated(id, true);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tbaselineStore.attachEvent(\"onAfterDelete\", (id, item) => {\r\n\t\t\tdp.setGanttMode(\"baseline\");\r\n\r\n\t\t\tconst needDbDelete = !this.clientSideDelete(id, dp, gantt);\r\n\t\t\tif (!needDbDelete) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdp.storeItem(item);\r\n\t\t\tdp.setUpdated(id, true,\"deleted\");\r\n\t\t});\r\n\t}\r\n\r\n\tdetach() {\r\n\t\thelpers.forEach(this._dataProcessorHandlers, (e) => {\r\n\t\t\tthis.$gantt.detachEvent(e);\r\n\t\t});\r\n\t\tthis._dataProcessorHandlers = [];\r\n\t}\r\n}\r\n","\r\nexport default function extendGantt(gantt: any, dp: any) {\r\n\tgantt.getUserData = function(id, name, store) {\r\n\t\tif (!this.userdata) {\r\n\t\t\tthis.userdata = {};\r\n\t\t}\r\n\t\tthis.userdata[store] = this.userdata[store] || {};\r\n\t\tif (this.userdata[store][id] && this.userdata[store][id][name]) {\r\n\t\t\treturn this.userdata[store][id][name];\r\n\t\t}\r\n\t\treturn \"\";\r\n\t};\r\n\tgantt.setUserData = function(id, name, value, store) {\r\n\t\tif (!this.userdata) {\r\n\t\t\tthis.userdata = {};\r\n\t\t}\r\n\t\tthis.userdata[store] = this.userdata[store] || {};\r\n\t\tthis.userdata[store][id] = this.userdata[store][id] || {};\r\n\t\tthis.userdata[store][id][name] = value;\r\n\t};\r\n\r\n\tgantt._change_id = function(oldId, newId) {\r\n\t\tswitch (this._dp._ganttMode) {\r\n\t\t\tcase \"task\":\r\n\t\t\t\tthis.changeTaskId(oldId, newId);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"link\":\r\n\t\t\t\tthis.changeLinkId(oldId, newId);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"assignment\":\r\n\t\t\t\tthis.$data.assignmentsStore.changeId(oldId, newId);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"resource\":\r\n\t\t\t\tthis.$data.resourcesStore.changeId(oldId, newId);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"baseline\":\r\n\t\t\t\tthis.$data.baselineStore.changeId(oldId, newId);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(`Invalid mode of the dataProcessor after database id is received: ${this._dp._ganttMode}, new id: ${newId}`);\r\n\t\t}\r\n\t};\r\n\r\n\tgantt._row_style = function(rowId, classname){\r\n\t\tif (this._dp._ganttMode !== \"task\") {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!gantt.isTaskExists(rowId)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst task = gantt.getTask(rowId);\r\n\t\ttask.$dataprocessor_class = classname;\r\n\t\tgantt.refreshTask(rowId);\r\n\t};\r\n\r\n\t// fake method for dataprocessor\r\n\tgantt._delete_task = function(rowId, node) {}; // tslint:disable-line\r\n\r\n\tgantt._sendTaskOrder = function(id, item){\r\n\t\tif (item.$drop_target) {\r\n\t\t\tthis._dp.setGanttMode(\"task\");\r\n\t\t\tthis.getTask(id).target = item.$drop_target;\r\n\t\t\tthis._dp.setUpdated(id, true,\"order\");\r\n\t\t\tdelete this.getTask(id).$drop_target;\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.setDp = function() {\r\n\t\tthis._dp = dp;\r\n\t};\r\n\r\n\tgantt.setDp();\r\n}","import * as utils from \"../../utils/utils\";\r\n\r\nexport default class SimpleStorage {\r\n\tpublic static create = () : SimpleStorage => {\r\n\t\treturn new SimpleStorage();\r\n\t};\r\n\r\n\tprotected _storage: { [id: string]: any; };\r\n\r\n\tprotected constructor() {\r\n\t\tthis._storage = {};\r\n\t}\r\n\r\n\tpublic clear = (): void => {\r\n\t\tthis._storage = {};\r\n\t};\r\n\r\n\tpublic storeItem = (item: any): void => {\r\n\t\tthis._storage[item.id] = utils.copy(item);\r\n\t};\r\n\r\n\tpublic getStoredItem = (id: string): any => {\r\n\t\treturn this._storage[id] || null;\r\n\t};\r\n}","import eventable from \"../../utils/eventable\";\r\nimport * as helpers from \"../../utils/helpers\";\r\nimport * as utils from \"../../utils/utils\";\r\nimport DataProcessorEvents from \"./data_processor_events\";\r\nimport extendGantt from \"./extend_gantt\";\r\nimport SimpleStorage from \"./simple_storage\";\r\nimport global from \"../../utils/global\";\r\n\r\nexport interface DataProcessor { // tslint:disable-line\r\n\t$gantt: any;\r\n\tdetachAllEvents: any;\r\n\tattachEvent: any;\r\n\tcallEvent: any;\r\n\r\n\tserverProcessor: string;\r\n\taction_param: string;\r\n\tupdatedRows: any[];\r\n\tautoUpdate: boolean;\r\n\tupdateMode: string;\r\n\tmessages: any[];\r\n\tstyles: object;\r\n\tdnd: any;\r\n\tdeleteAfterConfirmation?: any;\r\n}\r\n\r\nexport function createDataProcessor(config: any) {\r\n\tlet router;\r\n\tlet tMode;\r\n\tlet headers;\r\n\tif (config instanceof Function) {\r\n\t\trouter = config;\r\n\t} else if (config.hasOwnProperty(\"router\")) {\r\n\t\trouter = config.router;\r\n\t} else if (config.hasOwnProperty(\"assignment\") || config.hasOwnProperty(\"baseline\") || config.hasOwnProperty(\"link\") || config.hasOwnProperty(\"task\")) {\r\n\t\trouter = config;\r\n\t} else if(config.hasOwnProperty(\"headers\")){\r\n\t\t// GS-2312 for custom headers\r\n\t\theaders = config.headers;\r\n\t}\r\n\tif (router) {\r\n\t\ttMode = \"CUSTOM\";\r\n\t} else {\r\n\t\ttMode = config.mode || \"REST-JSON\";\r\n\t}\r\n\tconst gantt = this; // tslint:disable-line\r\n\tconst dp = new DataProcessor(config.url);\r\n\r\n\r\n\tdp.init(gantt);\r\n\tdp.setTransactionMode({\r\n\t\tmode: tMode,\r\n\t\trouter,\r\n\t\theaders\r\n\t}, config.batchUpdate);\r\n\tif(config.deleteAfterConfirmation){\r\n\t\tdp.deleteAfterConfirmation = config.deleteAfterConfirmation;\r\n\t}\r\n\treturn dp;\r\n}\r\n\r\nexport class DataProcessor {\r\n\tpublic modes: object;\r\n\tpublic serverProcessor: string;\r\n\tpublic action_param: string; // tslint:disable-line\r\n\tpublic updatedRows: any[];\r\n\tpublic autoUpdate: boolean;\r\n\tpublic updateMode: string;\r\n\tpublic messages: any[];\r\n\tpublic styles: object;\r\n\tpublic dnd: any;\r\n\r\n\tprotected _tMode: string;\r\n\tprotected _headers: any;\r\n\tprotected _payload: any;\r\n\tprotected _postDelim: string;\r\n\tprotected _waitMode: number;\r\n\tprotected _in_progress: object; // tslint:disable-line\r\n\tprotected _invalid: object;\r\n\tprotected _storage: SimpleStorage;\r\n\tprotected _tSend: boolean;\r\n\tprotected _serializeAsJson: boolean;\r\n\tprotected _router: any;\r\n\tprotected _utf: boolean;\r\n\tprotected _methods: any[];\r\n\tprotected _user: any;\r\n\tprotected _uActions: object;\r\n\tprotected _needUpdate: boolean;\r\n\tprotected _ganttMode: \"task\"|\"link\";\r\n\tprotected _routerParametersFormat: \"parameters\"|\"object\";\r\n\r\n\tprotected _silent_mode: any; // tslint:disable-line\r\n\tprotected _updateBusy: any;\r\n\tprotected _serverProcessor: any;\r\n\tprotected _initialized: boolean;\r\n\r\n\tconstructor(serverProcessorURL?) {\r\n\t\tthis.serverProcessor = serverProcessorURL;\r\n\t\tthis.action_param = \"!nativeeditor_status\";\r\n\r\n\t\tthis.updatedRows = []; // ids of updated rows\r\n\r\n\t\tthis.autoUpdate = true;\r\n\t\tthis.updateMode = \"cell\";\r\n\t\tthis._headers = null;\r\n\t\tthis._payload = null;\r\n\t\tthis._postDelim = \"_\";\r\n\t\tthis._routerParametersFormat = \"parameters\";\r\n\r\n\t\tthis._waitMode = 0;\r\n\t\tthis._in_progress = {}; // ?\r\n\t\tthis._storage = SimpleStorage.create();\r\n\t\tthis._invalid = {};\r\n\t\tthis.messages = [];\r\n\r\n\t\tthis.styles = {\r\n\t\t\tupdated: \"font-weight:bold;\",\r\n\t\t\tinserted: \"font-weight:bold;\",\r\n\t\t\tdeleted: \"text-decoration : line-through;\",\r\n\t\t\tinvalid: \"background-color:FFE0E0;\",\r\n\t\t\tinvalid_cell: \"border-bottom:2px solid red;\",\r\n\t\t\terror: \"color:red;\",\r\n\t\t\tclear: \"font-weight:normal;text-decoration:none;\"\r\n\t\t};\r\n\t\tthis.enableUTFencoding(true);\r\n\t\teventable(this);\r\n\t}\r\n\r\n\tsetTransactionMode(mode:any, total?:any) {\r\n\t\tif (typeof mode === \"object\") {\r\n\t\t\tthis._tMode = mode.mode || this._tMode;\r\n\r\n\t\t\tif (utils.defined(mode.headers)) {\r\n\t\t\t\tthis._headers = mode.headers;\r\n\t\t\t}\r\n\r\n\t\t\tif (utils.defined(mode.payload)) {\r\n\t\t\t\tthis._payload = mode.payload;\r\n\t\t\t}\r\n\t\t\tthis._tSend = !!total;\r\n\t\t} else {\r\n\t\t\tthis._tMode = mode;\r\n\t\t\tthis._tSend = total;\r\n\t\t}\r\n\r\n\t\tif (this._tMode === \"REST\") {\r\n\t\t\tthis._tSend = false;\r\n\t\t}\r\n\r\n\t\tif (this._tMode === \"JSON\" || this._tMode === \"REST-JSON\") {\r\n\t\t\tthis._tSend = false;\r\n\t\t\tthis._serializeAsJson = true;\r\n\t\t\tthis._headers = this._headers || {};\r\n\t\t\tthis._headers[\"Content-Type\"] = \"application/json\";\r\n\t\t}else{\r\n\t\t\tif(this._headers && !this._headers[\"Content-Type\"]){\r\n\t\t\t\tthis._headers[\"Content-Type\"] = \"application/x-www-form-urlencoded\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._tMode === \"CUSTOM\") {\r\n\t\t\tthis._tSend = false;\r\n\t\t\tthis._router = mode.router;\r\n\t\t}\r\n\t}\r\n\r\n\tescape(data:any) {\r\n\t\tif (this._utf) {\r\n\t\t\treturn encodeURIComponent(data);\r\n\t\t} else {\r\n\t\t\treturn escape(data);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: allows to set escaping mode\r\n\t * @param: true - utf based escaping, simple - use current page encoding\r\n\t * @type: public\r\n\t */\r\n\tenableUTFencoding(mode:boolean) {\r\n\t\tthis._utf = !!mode;\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: get state of updating\r\n\t * @returns:   true - all in sync with server, false - some items not updated yet.\r\n\t * @type: public\r\n\t */\r\n\tgetSyncState() {\r\n\t\treturn !this.updatedRows.length;\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: set if rows should be send to server automatically\r\n\t * @param: mode - \"row\" - based on row selection changed, \"cell\" - based on cell editing finished, \"off\" - manual data sending\r\n\t * @type: public\r\n\t */\r\n\tsetUpdateMode(mode: string, dnd: any) {\r\n\t\tthis.autoUpdate = (mode === \"cell\");\r\n\t\tthis.updateMode = mode;\r\n\t\tthis.dnd = dnd;\r\n\t}\r\n\r\n\tignore(code: any, master: any) {\r\n\t\tthis._silent_mode = true;\r\n\t\tcode.call(master || global);\r\n\t\tthis._silent_mode = false;\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: mark row as updated/normal. check mandatory fields, initiate autoupdate (if turned on)\r\n\t * @param: rowId - id of row to set update-status for\r\n\t * @param: state - true for \"updated\", false for \"not updated\"\r\n\t * @param: mode - update mode name\r\n\t * @type: public\r\n\t */\r\n\tsetUpdated(rowId:number|string, state: boolean, mode?: string) {\r\n\t\tif (this._silent_mode) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst ind = this.findRow(rowId);\r\n\r\n\t\tmode = mode || \"updated\";\r\n\t\tconst existing = this.$gantt.getUserData(rowId, this.action_param, this._ganttMode);\r\n\t\tif (existing && mode === \"updated\") {\r\n\t\t\tmode = existing;\r\n\t\t}\r\n\t\tif (state) {\r\n\t\t\tthis.set_invalid(rowId, false); // clear previous error flag\r\n\t\t\tthis.updatedRows[ind] = rowId;\r\n\t\t\tthis.$gantt.setUserData(rowId, this.action_param, mode, this._ganttMode);\r\n\t\t\tif (this._in_progress[rowId]) {\r\n\t\t\t\tthis._in_progress[rowId] = \"wait\";\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (!this.is_invalid(rowId)) {\r\n\t\t\t\tthis.updatedRows.splice(ind, 1);\r\n\t\t\t\tthis.$gantt.setUserData(rowId, this.action_param, \"\", this._ganttMode);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.markRow(rowId, state, mode);\r\n\t\tif (state && this.autoUpdate) {\r\n\t\t\tthis.sendData(rowId);\r\n\t\t}\r\n\t}\r\n\r\n\tmarkRow(id: number | string, state: boolean, mode: string) {\r\n\t\tlet str = \"\";\r\n\t\tconst invalid = this.is_invalid(id);\r\n\t\tif (invalid) {\r\n\t\t\tstr = this.styles[invalid];\r\n\t\t\tstate = true;\r\n\t\t}\r\n\t\tif (this.callEvent(\"onRowMark\", [id, state, mode, invalid])) {\r\n\t\t\t// default logic\r\n\t\t\tstr = this.styles[state ? mode : \"clear\"] + \" \" + str;\r\n\r\n\t\t\tthis.$gantt[this._methods[0]](id, str);\r\n\r\n\t\t\tif (invalid && invalid.details) {\r\n\t\t\t\tstr += this.styles[invalid + \"_cell\"];\r\n\t\t\t\tfor (let i = 0; i < invalid.details.length; i++) {\r\n\t\t\t\t\tif (invalid.details[i]) {\r\n\t\t\t\t\t\tthis.$gantt[this._methods[1]](id, i, str);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetActionByState(state: string):string {\r\n\t\tif (state === \"inserted\") {\r\n\t\t\treturn \"create\";\r\n\t\t}\r\n\r\n\t\tif (state === \"updated\") {\r\n\t\t\treturn \"update\";\r\n\t\t}\r\n\r\n\t\tif (state === \"deleted\") {\r\n\t\t\treturn \"delete\";\r\n\t\t}\r\n\r\n\t\t// reorder\r\n\t\treturn \"update\";\r\n\t}\r\n\r\n\tgetState(id: number | string) {\r\n\t\treturn this.$gantt.getUserData(id, this.action_param, this._ganttMode);\r\n\t}\r\n\r\n\tis_invalid(id: number | string) {\r\n\t\treturn this._invalid[id];\r\n\t}\r\n\r\n\tset_invalid(id: number | string, mode: any, details?) {\r\n\t\tif (details) {\r\n\t\t\tmode = {\r\n\t\t\t\tvalue: mode,\r\n\t\t\t\tdetails,\r\n\t\t\t\ttoString: function() { // tslint:disable-line\r\n\t\t\t\t\treturn this.value.toString();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t\tthis._invalid[id] = mode;\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: check mandatory fields and verify values of cells, initiate update (if specified). Can be redefined in order to provide custom validation\r\n\t * @param: rowId - id of row to set update-status for\r\n\t * @type: public\r\n\t */\r\n\t// tslint:disable-next-line\r\n\tcheckBeforeUpdate(rowId: number | string) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: send row(s) values to server\r\n\t * @param: rowId - id of row which data to send. If not specified, then all \"updated\" rows will be send\r\n\t * @type: public\r\n\t */\r\n\tsendData(rowId?: any) {\r\n\t\tif (this.$gantt.editStop) {\r\n\t\t\tthis.$gantt.editStop();\r\n\t\t}\r\n\r\n\t\tif (typeof rowId === \"undefined\" || this._tSend) {\r\n\r\n\t\t\tconst pendingUpdateModes = [];\r\n\t\t\tif(this.modes){\r\n\t\t\t\tconst knownModes = [\"task\", \"link\", \"assignment\", \"baseline\"];\r\n\t\t\t\tknownModes.forEach((mode) => {\r\n\t\t\t\t\tif(this.modes[mode] && this.modes[mode].updatedRows.length){\r\n\t\t\t\t\t\tpendingUpdateModes.push(mode);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (pendingUpdateModes.length){\r\n\t\t\t\tfor(let i = 0; i < pendingUpdateModes.length; i++){\r\n\t\t\t\t\tthis.setGanttMode(pendingUpdateModes[i]);\r\n\t\t\t\t\tthis.sendAllData();\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t} else {\r\n\t\t\t\treturn this.sendAllData();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._in_progress[rowId]) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tthis.messages = [];\r\n\t\tif (!this.checkBeforeUpdate(rowId) && this.callEvent(\"onValidationError\", [rowId, this.messages])) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tthis._beforeSendData(this._getRowData(rowId), rowId);\r\n\t}\r\n\r\n\tserialize(data: any, id: any) {\r\n\t\tif (this._serializeAsJson) {\r\n\t\t\treturn  this._serializeAsJSON(data);\r\n\t\t}\r\n\r\n\t\tif (typeof data === \"string\") {\r\n\t\t\treturn data;\r\n\t\t}\r\n\t\tif (typeof id !== \"undefined\") {\r\n\t\t\treturn this.serialize_one(data, \"\");\r\n\t\t} else {\r\n\t\t\tconst stack = [];\r\n\t\t\tconst keys = [];\r\n\t\t\tfor (const key in data) {\r\n\t\t\t\tif (data.hasOwnProperty(key)) {\r\n\t\t\t\t\tstack.push(this.serialize_one(data[key], key + this._postDelim));\r\n\t\t\t\t\tkeys.push(key);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tstack.push(\"ids=\" + this.escape(keys.join(\",\")));\r\n\t\t\tif (this.$gantt.security_key) {\r\n\t\t\t\tstack.push(\"dhx_security=\" + this.$gantt.security_key);\r\n\t\t\t}\r\n\t\t\treturn stack.join(\"&\");\r\n\t\t}\r\n\t}\r\n\r\n\tserialize_one(data: any, pref: string) {\r\n\t\tif (typeof data === \"string\") {\r\n\t\t\treturn data;\r\n\t\t}\r\n\t\tconst stack: string[] = [];\r\n\t\tlet serialized = \"\";\r\n\t\tfor (const key in data)\r\n\t\t\tif (data.hasOwnProperty(key)) {\r\n\t\t\t\tif ((key === \"id\" ||\r\n\t\t\t\t\tkey == this.action_param) && // tslint:disable-line\r\n\t\t\t\t\tthis._tMode === \"REST\") {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (typeof data[key] === \"string\" || typeof data[key] === \"number\") {\r\n\t\t\t\t\tserialized = String(data[key]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tserialized = JSON.stringify(data[key]);\r\n\t\t\t\t}\r\n\t\t\t\tstack.push(this.escape((pref || \"\") + key) + \"=\" + this.escape(serialized));\r\n\t\t\t}\r\n\t\treturn stack.join(\"&\");\r\n\t}\r\n\r\n\tsendAllData() {\r\n\t\tif (!this.updatedRows.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.messages = [];\r\n\t\tlet valid: any = true;\r\n\r\n\t\tthis._forEachUpdatedRow(function(rowId) {\r\n\t\t\tvalid = valid && this.checkBeforeUpdate(rowId);\r\n\t\t});\r\n\r\n\t\tif (!valid && !this.callEvent(\"onValidationError\", [\"\", this.messages])) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (this._tSend) {\r\n\t\t\tthis._sendData(this._getAllData());\r\n\t\t} else {\r\n\t\t\t// this.updatedRows can be spliced from onBeforeUpdate via dp.setUpdated false\r\n\t\t\t// use an iterator instead of for(var i = 0; i < this.updatedRows; i++) then\r\n\t\t\tthis._forEachUpdatedRow(function(rowId) {\r\n\t\t\t\tif (!this._in_progress[rowId]) {\r\n\t\t\t\t\tif (this.is_invalid(rowId)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._beforeSendData(this._getRowData(rowId), rowId);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tfindRow(pattern: any) {\r\n\t\tlet i = 0;\r\n\t\tfor (i = 0; i < this.updatedRows.length; i++) {\r\n\t\t\tif (pattern == this.updatedRows[i]) { // tslint:disable-line\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn i;\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: define custom actions\r\n\t * @param: name - name of action, same as value of action attribute\r\n\t * @param: handler - custom function, which receives a XMl response content for action\r\n\t * @type: private\r\n\t */\r\n\tdefineAction(name: string, handler: any) {\r\n\t\tif (!this._uActions) {\r\n\t\t\tthis._uActions = {};\r\n\t\t}\r\n\t\tthis._uActions[name] = handler;\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: used in combination with setOnBeforeUpdateHandler to create custom client-server transport system\r\n\t * @param: sid - id of item before update\r\n\t * @param: tid - id of item after up0ate\r\n\t * @param: action - action name\r\n\t * @type: public\r\n\t * @topic: 0\r\n\t */\r\n\tafterUpdateCallback(sid: number | string, tid: number | string, action: string, btag: any, ganttMode: string) {\r\n\t\tif(!this.$gantt){\r\n\t\t\t// destructor has been called before the callback\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.setGanttMode(ganttMode);\r\n\r\n\t\tconst marker = sid;\r\n\t\tconst correct = (action !== \"error\" && action !== \"invalid\");\r\n\t\tif (!correct) {\r\n\t\t\tthis.set_invalid(sid, action);\r\n\t\t}\r\n\t\tif ((this._uActions) && (this._uActions[action]) && (!this._uActions[action](btag))) {\r\n\t\t\treturn (delete this._in_progress[marker]);\r\n\t\t}\r\n\r\n\t\tif (this._in_progress[marker] !== \"wait\") {\r\n\t\t\tthis.setUpdated(sid, false);\r\n\t\t}\r\n\r\n\t\tconst originalSid = sid;\r\n\r\n\t\tswitch (action) {\r\n\t\t\tcase \"inserted\":\r\n\t\t\tcase \"insert\":\r\n\t\t\t\tif (tid != sid) { // tslint:disable-line\r\n\t\t\t\t\tthis.setUpdated(sid, false);\r\n\t\t\t\t\tthis.$gantt[this._methods[2]](sid, tid);\r\n\t\t\t\t\tsid = tid;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"delete\":\r\n\t\t\tcase \"deleted\":\r\n\t\t\t\tif(!this.deleteAfterConfirmation || this._ganttMode !== \"task\"){\r\n\t\t\t\t\tthis.$gantt.setUserData(sid, this.action_param, \"true_deleted\", this._ganttMode);\r\n\t\t\t\t\tthis.$gantt[this._methods[3]](sid);\r\n\t\t\t\t\tdelete this._in_progress[marker];\r\n\t\t\t\t\treturn this.callEvent(\"onAfterUpdate\", [sid, action, tid, btag]);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif (this._ganttMode === \"task\" && this.$gantt.isTaskExists(sid)) {\r\n\t\t\t\t\t\tthis.$gantt.setUserData(sid, this.action_param, \"true_deleted\", this._ganttMode);\r\n\t\t\t\t\t\tconst task = this.$gantt.getTask(sid);\r\n\t\t\t\t\t\tthis.$gantt.silent(() => {\r\n\t\t\t\t\t\t\tthis.$gantt.deleteTask(sid);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tthis.$gantt.callEvent(\"onAfterTaskDelete\", [sid, task]);\r\n\t\t\t\t\t\tthis.$gantt.render();\r\n\t\t\t\t\t\tdelete this._in_progress[marker];\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn this.callEvent(\"onAfterUpdate\", [sid, action, tid, btag]);\r\n\t\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (this._in_progress[marker] !== \"wait\") {\r\n\t\t\tif (correct) {\r\n\t\t\t\tthis.$gantt.setUserData(sid, this.action_param, \"\", this._ganttMode);\r\n\t\t\t}\r\n\t\t\tdelete this._in_progress[marker];\r\n\t\t} else {\r\n\t\t\tdelete this._in_progress[marker];\r\n\t\t\tthis.setUpdated(tid, true, this.$gantt.getUserData(sid, this.action_param, this._ganttMode));\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onAfterUpdate\", [originalSid, action, tid, btag]);\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: response from server\r\n\t * @param: xml - XMLLoader object with response XML\r\n\t * @type: private\r\n\t */\r\n\tafterUpdate(that: any, xml: any, id?:any) {\r\n\t\tlet _xml;\r\n\t\tif (arguments.length === 3) {\r\n\t\t\t_xml = arguments[1];\r\n\t\t} else {\r\n\t\t\t// old dataprocessor\r\n\t\t\t_xml = arguments[4];\r\n\t\t}\r\n\t\tlet mode = this.getGanttMode();\r\n\t\tconst reqUrl = _xml.filePath || _xml.url;\r\n\r\n\t\tif (this._tMode !== \"REST\" && this._tMode !== \"REST-JSON\") {\r\n\t\t\tif (reqUrl.indexOf(\"gantt_mode=links\") !== -1) {\r\n\t\t\t\tmode = \"link\";\r\n\t\t\t} else if (reqUrl.indexOf(\"gantt_mode=assignments\") !== -1) {\r\n\t\t\t\tmode = \"assignment\";\r\n\t\t\t} else if (reqUrl.indexOf(\"gantt_mode=baselines\") !== -1) {\r\n\t\t\t\tmode = \"baseline\";\r\n\t\t\t} else {\r\n\t\t\t\tmode = \"task\";\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (reqUrl.indexOf(\"/link\") >= 0) {\r\n\t\t\t\tmode = \"link\";\r\n\t\t\t} else if(reqUrl.indexOf(\"/assignment\") >= 0){\r\n\t\t\t\tmode = \"assignment\";\r\n\t\t\t} else if(reqUrl.indexOf(\"/baseline\") >= 0){\r\n\t\t\t\tmode = \"baseline\";\r\n\t\t\t} else {\r\n\t\t\t\tmode = \"task\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.setGanttMode(mode);\r\n\r\n\t\tconst ajax = this.$gantt.ajax;\r\n\t\t// try to use json first\r\n\t\tlet tag;\r\n\r\n\t\ttry {\r\n\t\t\ttag = JSON.parse(xml.xmlDoc.responseText);\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\t} catch (e) {\r\n\r\n\t\t\t// empty response also can be processed by json handler\r\n\t\t\tif (!xml.xmlDoc.responseText.length) {\r\n\t\t\t\ttag = {};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst processCallback = (itemId: any) => {\r\n\t\t\tconst action = tag.action || this.getState(itemId) || \"updated\";\r\n\t\t\tconst sid = tag.sid || itemId[0];\r\n\t\t\tconst tid = tag.tid || itemId[0];\r\n\t\t\tthat.afterUpdateCallback(sid, tid, action, tag, mode);\r\n\t\t};\r\n\t\tif (tag) {\r\n\t\t\t// GS-753. When multiple tasks are updated, unhighlight all of them\r\n\t\t\tif (Array.isArray(id) && id.length > 1) {\r\n\t\t\t\tid.forEach((taskId) => processCallback(taskId));\r\n\t\t\t} else {\r\n\t\t\t\tprocessCallback(id);\r\n\t\t\t}\r\n\t\t\tthat.finalizeUpdate();\r\n\t\t\tthis.setGanttMode(mode);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// xml response\r\n\t\tconst top = ajax.xmltop(\"data\", xml.xmlDoc); // fix incorrect content type in IE\r\n\t\tif (!top) {\r\n\t\t\treturn this.cleanUpdate(id);\r\n\t\t}\r\n\t\tconst atag = ajax.xpath(\"//data/action\", top);\r\n\t\tif (!atag.length) {\r\n\t\t\treturn this.cleanUpdate(id);\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < atag.length; i++) {\r\n\t\t\tconst btag = atag[i];\r\n\t\t\tconst action = btag.getAttribute(\"type\");\r\n\t\t\tconst sid = btag.getAttribute(\"sid\");\r\n\t\t\tconst tid = btag.getAttribute(\"tid\");\r\n\r\n\t\t\tthat.afterUpdateCallback(sid, tid, action, btag, mode);\r\n\t\t}\r\n\t\tthat.finalizeUpdate();\r\n\t}\r\n\r\n\tcleanUpdate(id: any[]) {\r\n\t\tif (id) {\r\n\t\t\tfor (let i = 0; i < id.length; i++) {\r\n\t\t\t\tdelete this._in_progress[id[i]];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfinalizeUpdate() {\r\n\t\tif (this._waitMode) {\r\n\t\t\tthis._waitMode--;\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onAfterUpdateFinish\", []);\r\n\t\tif (!this.updatedRows.length) {\r\n\t\t\tthis.callEvent(\"onFullSync\", []);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: initializes data-processor\r\n\t * @param: gantt - dhtmlxGantt object to attach this data-processor to\r\n\t * @type: public\r\n\t */\r\n\tinit(gantt: any) {\r\n\t\tif (this._initialized) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.$gantt = gantt;\r\n\t\tif (this.$gantt._dp_init) {\r\n\t\t\tthis.$gantt._dp_init(this);\r\n\t\t}\r\n\r\n\t\tthis._setDefaultTransactionMode();\r\n\r\n\t\tthis.styles = {\r\n\t\t\tupdated:\"gantt_updated\",\r\n\t\t\torder:\"gantt_updated\",\r\n\t\t\tinserted:\"gantt_inserted\",\r\n\t\t\tdeleted:\"gantt_deleted\",\r\n\t\t\tdelete_confirmation:\"gantt_deleted\",\r\n\t\t\tinvalid:\"gantt_invalid\",\r\n\t\t\terror:\"gantt_error\",\r\n\t\t\tclear:\"\"\r\n\t\t};\r\n\r\n\t\tthis._methods=[\"_row_style\",\"setCellTextStyle\",\"_change_id\",\"_delete_task\"];\r\n\t\textendGantt(this.$gantt, this);\r\n\t\tconst dataProcessorEvents = new DataProcessorEvents(this.$gantt, this);\r\n\t\tdataProcessorEvents.attach();\r\n\t\tthis.attachEvent(\"onDestroy\", function() {\r\n\t\t\tdelete this.setGanttMode;\r\n\t\t\tdelete this._getRowData;\r\n\r\n\t\t\tdelete this.$gantt._dp;\r\n\t\t\tdelete this.$gantt._change_id;\r\n\t\t\tdelete this.$gantt._row_style;\r\n\t\t\tdelete this.$gantt._delete_task;\r\n\t\t\tdelete this.$gantt._sendTaskOrder;\r\n\t\t\tdelete this.$gantt;\r\n\r\n\t\t\tdataProcessorEvents.detach();\r\n\t\t});\r\n\t\tthis.$gantt.callEvent(\"onDataProcessorReady\", [this]);\r\n\t\tthis._initialized = true;\r\n\t}\r\n\r\n\tsetOnAfterUpdate(handler) {\r\n\t\tthis.attachEvent(\"onAfterUpdate\", handler);\r\n\t}\r\n\r\n\tsetOnBeforeUpdateHandler(handler) {\r\n\t\tthis.attachEvent(\"onBeforeDataSending\", handler);\r\n\t}\r\n\r\n\t/* starts autoupdate mode\r\n\t\t@param interval time interval for sending update requests\r\n\t*/\r\n\tsetAutoUpdate(interval, user) {\r\n\t\tinterval = interval || 2000;\r\n\r\n\t\tthis._user = user || (new Date()).valueOf();\r\n\t\tthis._needUpdate = false;\r\n\r\n\t\tthis._updateBusy = false;\r\n\r\n\t\tthis.attachEvent(\"onAfterUpdate\", this.afterAutoUpdate); // arguments sid, action, tid, xml_node;\r\n\r\n\t\tthis.attachEvent(\"onFullSync\", this.fullSync);\r\n\r\n\t\tsetInterval(() => {\r\n\t\t\tthis.loadUpdate();\r\n\t\t}, interval);\r\n\t}\r\n\r\n\t/* process updating request response\r\n\t\tif status == collision version is deprecated\r\n\t\tset flag for autoupdating immediately\r\n\t*/\r\n\tafterAutoUpdate(sid, action, tid, xml_node) { // tslint:disable-line\r\n\t\tif (action === \"collision\") {\r\n\t\t\tthis._needUpdate = true;\r\n\t\t\treturn false;\r\n\t\t} else {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\t/* callback function for onFillSync event\r\n\t\tcall update function if it's need\r\n\t*/\r\n\tfullSync() {\r\n\t\tif (this._needUpdate) {\r\n\t\t\tthis._needUpdate = false;\r\n\t\t\tthis.loadUpdate();\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/* sends query to the server and call callback function\r\n\t*/\r\n\tgetUpdates(url, callback) {\r\n\t\tconst ajax = this.$gantt.ajax;\r\n\t\tif (this._updateBusy) {\r\n\t\t\treturn false;\r\n\t\t} else {\r\n\t\t\tthis._updateBusy = true;\r\n\t\t}\r\n\r\n\t\tajax.get(url, callback);\r\n\r\n\t}\r\n\r\n\t/* loads updates and processes them\r\n\t*/\r\n\tloadUpdate() {\r\n\t\tconst ajax = this.$gantt.ajax;\r\n\t\tconst version = this.$gantt.getUserData(0, \"version\", this._ganttMode);\r\n\t\tlet url = this.serverProcessor + ajax.urlSeparator(this.serverProcessor) + [\"dhx_user=\" + this._user, \"dhx_version=\" + version].join(\"&\");\r\n\t\turl = url.replace(\"editing=true&\", \"\");\r\n\t\tthis.getUpdates(url, (xml) => {\r\n\t\t\tconst vers = ajax.xpath(\"//userdata\", xml);\r\n\t\t\tthis.$gantt.setUserData(0, \"version\", this._getXmlNodeValue(vers[0]), this._ganttMode);\r\n\r\n\t\t\tconst updates = ajax.xpath(\"//update\", xml);\r\n\t\t\tif (updates.length) {\r\n\t\t\t\tthis._silent_mode = true;\r\n\r\n\t\t\t\tfor (let i = 0; i < updates.length; i++) {\r\n\t\t\t\t\tconst status = updates[i].getAttribute(\"status\");\r\n\t\t\t\t\tconst id = updates[i].getAttribute(\"id\");\r\n\t\t\t\t\tconst parent = updates[i].getAttribute(\"parent\");\r\n\t\t\t\t\tswitch (status) {\r\n\t\t\t\t\t\tcase \"inserted\":\r\n\t\t\t\t\t\t\tthis.callEvent(\"insertCallback\", [updates[i], id, parent]);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"updated\":\r\n\t\t\t\t\t\t\tthis.callEvent(\"updateCallback\", [updates[i], id, parent]);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"deleted\":\r\n\t\t\t\t\t\t\tthis.callEvent(\"deleteCallback\", [updates[i], id, parent]);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._silent_mode = false;\r\n\t\t\t}\r\n\r\n\t\t\tthis._updateBusy = false;\r\n\t\t});\r\n\t}\r\n\r\n\tdestructor() {\r\n\t\tthis.callEvent(\"onDestroy\", []);\r\n\t\tthis.detachAllEvents();\r\n\r\n\t\tthis.updatedRows = [];\r\n\t\tthis._in_progress = {}; // ?\r\n\t\tthis._invalid = {};\r\n\t\tthis._storage.clear();\r\n\t\tthis._storage = null;\r\n\t\tthis._headers = null;\r\n\t\tthis._payload = null;\r\n\t\tdelete this._initialized;\r\n\t}\r\n\r\n\tsetGanttMode(mode) {\r\n\t\tif (mode === \"tasks\") {\r\n\t\t\tmode = \"task\";\r\n\t\t} else if (mode === \"links\") {\r\n\t\t\tmode = \"link\";\r\n\t\t}\r\n\r\n\t\tconst modes = this.modes || {};\r\n\t\tconst ganttMode = this.getGanttMode();\r\n\t\tif (ganttMode) {\r\n\t\t\tmodes[ganttMode] = {\r\n\t\t\t\t_in_progress : this._in_progress,\r\n\t\t\t\t_invalid: this._invalid,\r\n\t\t\t\t_storage: this._storage,\r\n\t\t\t\tupdatedRows : this.updatedRows\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tlet newState = modes[mode];\r\n\t\tif (!newState) {\r\n\t\t\tnewState = modes[mode] = {\r\n\t\t\t\t_in_progress : {},\r\n\t\t\t\t_invalid : {},\r\n\t\t\t\t_storage : SimpleStorage.create(),\r\n\t\t\t\tupdatedRows : []\r\n\t\t\t};\r\n\t\t}\r\n\t\tthis._in_progress = newState._in_progress;\r\n\t\tthis._invalid = newState._invalid;\r\n\t\tthis._storage = newState._storage;\r\n\t\tthis.updatedRows = newState.updatedRows;\r\n\t\tthis.modes = modes;\r\n\t\tthis._ganttMode = mode;\r\n\t}\r\n\tgetGanttMode():string {\r\n\t\treturn this._ganttMode;\r\n\t}\r\n\r\n\tstoreItem(item) {\r\n\t\tthis._storage.storeItem(item);\r\n\t}\r\n\r\n\turl(url: string) {\r\n\t\tthis.serverProcessor = this._serverProcessor = url;\r\n\t}\r\n\r\n\tprotected _beforeSendData(data: any, rowId: any) {\r\n\t\tif (!this.callEvent(\"onBeforeUpdate\", [rowId, this.getState(rowId), data])) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tthis._sendData(data, rowId);\r\n\t}\r\n\r\n\tprotected _serializeAsJSON(data: any) {\r\n\t\tif (typeof data === \"string\") {\r\n\t\t\treturn data;\r\n\t\t}\r\n\r\n\t\tconst copy = utils.copy(data);\r\n\t\tif (this._tMode === \"REST-JSON\") {\r\n\t\t\tdelete copy.id;\r\n\t\t\tdelete copy[this.action_param];\r\n\t\t}\r\n\r\n\t\treturn JSON.stringify(copy);\r\n\t}\r\n\r\n\tprotected _applyPayload(url: string) {\r\n\t\tconst ajax = this.$gantt.ajax;\r\n\t\tif (this._payload) {\r\n\t\t\tfor (const key in this._payload) {\r\n\t\t\t\turl = url + ajax.urlSeparator(url) + this.escape(key) + \"=\" + this.escape(this._payload[key]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn url;\r\n\t}\r\n\r\n\t// GET/POST/JSON modes of the dataProcessor didn't send the whole data items in 'delete' requests\r\n\t// clear extra info from the data in order not to change the request format\r\n\tprotected _cleanupArgumentsBeforeSend(dataToSend: any) {\r\n\t\tlet processedData;\r\n\t\tif(dataToSend[this.action_param] === undefined){// hash of updated items, and not an individual item\r\n\t\t\tprocessedData = {};\r\n\t\t\tfor(const i in dataToSend) {\r\n\t\t\t\tprocessedData[i] = this._cleanupArgumentsBeforeSend(dataToSend[i]);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tprocessedData = this._cleanupItemBeforeSend(dataToSend);\r\n\t\t}\r\n\t\treturn processedData;\r\n\t}\r\n\tprotected _cleanupItemBeforeSend(updatedItem: any) {\r\n\t\tlet output = null;\r\n\t\tif(updatedItem){\r\n\t\t\tif(updatedItem[this.action_param] === \"deleted\"){\r\n\t\t\t\toutput = {};\r\n\t\t\t\toutput.id = updatedItem.id;\r\n\t\t\t\toutput[this.action_param] = updatedItem[this.action_param];\r\n\t\t\t}else{\r\n\t\t\t\toutput = updatedItem;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn output;\r\n\t}\r\n\r\n\tprotected _sendData(dataToSend: any, rowId?: any) {\r\n\t\tif (!dataToSend) {\r\n\t\t\treturn; // nothing to send\r\n\t\t}\r\n\t\tif (!this.callEvent(\"onBeforeDataSending\", rowId ? [rowId, this.getState(rowId), dataToSend] : [null, null, dataToSend])) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (rowId) {\r\n\t\t\tthis._in_progress[rowId] = (new Date()).valueOf();\r\n\t\t}\r\n\r\n\t\tconst ajax = this.$gantt.ajax;\r\n\r\n\t\tif (this._tMode === \"CUSTOM\") {\r\n\t\t\tconst taskState = this.getState(rowId);\r\n\t\t\tconst taskAction = this.getActionByState(taskState);\r\n\t\t\tdelete dataToSend[this.action_param]; // not send !nativeeditor_status parameter in router mode\r\n\t\t\tconst ganttMode = this.getGanttMode();\r\n\t\t\tconst _onResolvedCreateUpdate = (tag) => {\r\n\t\t\t\tlet action = taskState || \"updated\";\r\n\t\t\t\tlet sid = rowId;\r\n\t\t\t\tlet tid = rowId;\r\n\r\n\t\t\t\tif (tag) {\r\n\t\t\t\t\taction = tag.action || taskState;\r\n\t\t\t\t\tsid = tag.sid || sid;\r\n\t\t\t\t\ttid = tag.id || tag.tid || tid;\r\n\t\t\t\t}\r\n\t\t\t\tthis.afterUpdateCallback(sid, tid, action, tag, ganttMode);\r\n\t\t\t};\r\n\r\n\t\t\tlet actionPromise;\r\n\t\t\tif (this._router instanceof Function) {\r\n\t\t\t\tif(this._routerParametersFormat === \"object\"){\r\n\t\t\t\t\tconst obj = {\r\n\t\t\t\t\t\tentity: ganttMode,\r\n\t\t\t\t\t\taction: taskAction,\r\n\t\t\t\t\t\tdata: dataToSend,\r\n\t\t\t\t\t\tid: rowId\r\n\t\t\t\t\t};\r\n\t\t\t\t\tactionPromise = this._router(obj);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tactionPromise = this._router(ganttMode, taskAction, dataToSend, rowId);\r\n\t\t\t\t}\r\n\t\t\t} else if (this._router[ganttMode] instanceof Function) {\r\n\t\t\t\tactionPromise = this._router[ganttMode](taskAction, dataToSend, rowId);\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconst errorMsgStart = \"Incorrect configuration of gantt.createDataProcessor\";\r\n\t\t\t\tconst errorMsgEnd = `\r\nYou need to either add missing properties to the dataProcessor router object or to use a router function.\r\nSee https://docs.dhtmlx.com/gantt/desktop__server_side.html#customrouting and https://docs.dhtmlx.com/gantt/api__gantt_createdataprocessor.html for details.`;\r\n\r\n\t\t\t\tif(!this._router[ganttMode]){\r\n\t\t\t\t\tthrow new Error(`${errorMsgStart}: router for the **${ganttMode}** entity is not defined. ${errorMsgEnd}`);\r\n\t\t\t\t}\r\n\t\t\t\tswitch (taskState) {\r\n\t\t\t\t\tcase \"inserted\":\r\n\t\t\t\t\t\tif(!this._router[ganttMode].create){\r\n\t\t\t\t\t\t\tthrow new Error(`${errorMsgStart}: **create** action for the **${ganttMode}** entity is not defined. ${errorMsgEnd}`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tactionPromise = this._router[ganttMode].create(dataToSend);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"deleted\":\r\n\t\t\t\t\t\tif(!this._router[ganttMode].delete){\r\n\t\t\t\t\t\t\tthrow new Error(`${errorMsgStart}: **delete** action for the **${ganttMode}** entity is not defined. ${errorMsgEnd}`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tactionPromise = this._router[ganttMode].delete(rowId);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tif(!this._router[ganttMode].update){\r\n\t\t\t\t\t\t\tthrow new Error(`${errorMsgStart}: **update**\" action for the **${ganttMode}** entity is not defined. ${errorMsgEnd}`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tactionPromise = this._router[ganttMode].update(dataToSend, rowId);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(actionPromise){\r\n\t\t\t\t// neither promise nor {tid: newId} response object\r\n\t\t\t\tif(!actionPromise.then &&\r\n\t\t\t\t\t(actionPromise.id === undefined && actionPromise.tid === undefined && actionPromise.action === undefined)){\r\n\t\t\t\t\tthrow new Error(\"Incorrect router return value. A Promise or a response object is expected\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(actionPromise.then){\r\n\t\t\t\t\tactionPromise.then(_onResolvedCreateUpdate).catch((error) => {\r\n\t\t\t\t\t\tif(error && error.action){\r\n\t\t\t\t\t\t\t_onResolvedCreateUpdate(error);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t_onResolvedCreateUpdate({ action: \"error\", value: error});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\t// custom method may return a response object in case of sync action\r\n\t\t\t\t\t_onResolvedCreateUpdate(actionPromise);\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\t_onResolvedCreateUpdate(null);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet queryParams: any;\r\n\t\tqueryParams = {\r\n\t\t\tcallback: (xml) => {\r\n\t\t\t\tconst ids = [];\r\n\r\n\t\t\t\tif (rowId) {\r\n\t\t\t\t\tids.push(rowId);\r\n\t\t\t\t} else if (dataToSend) {\r\n\t\t\t\t\tfor (const key in dataToSend) {\r\n\t\t\t\t\t\tids.push(key);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn this.afterUpdate(this, xml, ids);\r\n\t\t\t},\r\n\t\t\theaders: this._headers\r\n\t\t};\r\n\r\n\t\tconst dhxVersion = \"dhx_version=\" + this.$gantt.getUserData(0, \"version\", this._ganttMode);\r\n\t\tconst urlParams = this.serverProcessor + (this._user ? (ajax.urlSeparator(this.serverProcessor) + [\"dhx_user=\" + this._user, dhxVersion].join(\"&\")) : \"\");\r\n\t\tlet url: any = this._applyPayload(urlParams);\r\n\t\tlet data;\r\n\r\n\t\tswitch (this._tMode) {\r\n\t\t\tcase \"GET\":\r\n\t\t\t\tdata = this._cleanupArgumentsBeforeSend(dataToSend);\r\n\t\t\t\tqueryParams.url = url + ajax.urlSeparator(url) + this.serialize(data, rowId);\r\n\t\t\t\tqueryParams.method = \"GET\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"POST\":\r\n\t\t\t\tdata = this._cleanupArgumentsBeforeSend(dataToSend);\r\n\t\t\t\tqueryParams.url = url;\r\n\t\t\t\tqueryParams.method = \"POST\";\r\n\t\t\t\tqueryParams.data = this.serialize(data, rowId);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"JSON\":\r\n\t\t\t\tdata = {};\r\n\t\t\t\tconst preprocessedData = this._cleanupItemBeforeSend(dataToSend);\r\n\t\t\t\tfor (const key in preprocessedData) {\r\n\t\t\t\t\tif (key === this.action_param || key === \"id\" || key === \"gr_id\") {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdata[key] = preprocessedData[key];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tqueryParams.url = url;\r\n\t\t\t\tqueryParams.method = \"POST\";\r\n\t\t\t\tqueryParams.data = JSON.stringify({\r\n\t\t\t\t\tid: rowId,\r\n\t\t\t\t\taction: dataToSend[this.action_param],\r\n\t\t\t\t\tdata\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"REST\":\r\n\t\t\tcase \"REST-JSON\":\r\n\t\t\t\turl = urlParams.replace(/(&|\\?)editing=true/, \"\");\r\n\t\t\t\tdata = \"\";\r\n\r\n\t\t\t\tswitch (this.getState(rowId)) {\r\n\t\t\t\t\tcase \"inserted\":\r\n\t\t\t\t\t\tqueryParams.method = \"POST\";\r\n\t\t\t\t\t\tqueryParams.data = this.serialize(dataToSend, rowId);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"deleted\":\r\n\t\t\t\t\t\tqueryParams.method = \"DELETE\";\r\n\t\t\t\t\t\turl = url + (url.slice(-1) === \"/\" ? \"\" : \"/\") + rowId;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tqueryParams.method = \"PUT\";\r\n\t\t\t\t\t\tqueryParams.data = this.serialize(dataToSend, rowId);\r\n\t\t\t\t\t\turl = url + (url.slice(-1) === \"/\" ? \"\" : \"/\") + rowId;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tqueryParams.url = this._applyPayload(url);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tthis._waitMode++;\r\n\t\treturn ajax.query(queryParams);\r\n\t}\r\n\r\n\tprotected _forEachUpdatedRow(code: any) {\r\n\t\tconst updatedRows = this.updatedRows.slice();\r\n\t\tfor (let i = 0; i < updatedRows.length; i++) {\r\n\t\t\tconst rowId = updatedRows[i];\r\n\t\t\tif (this.$gantt.getUserData(rowId, this.action_param, this._ganttMode)) {\r\n\t\t\t\tcode.call(this, rowId);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _setDefaultTransactionMode() {\r\n\t\tif (this.serverProcessor) {\r\n\t\t\tthis.setTransactionMode(\"POST\", true);\r\n\t\t\tthis.serverProcessor += (this.serverProcessor.indexOf(\"?\") !== -1 ? \"&\" : \"?\") + \"editing=true\";\r\n\t\t\tthis._serverProcessor = this.serverProcessor;\r\n\t\t}\r\n\t}\r\n\r\n\t/* returns xml node value\r\n\t\t@param node\r\n\t\t\txml node\r\n\t*/\r\n\tprotected _getXmlNodeValue(node) {\r\n\t\tif (node.firstChild) {\r\n\t\t\treturn node.firstChild.nodeValue;\r\n\t\t}\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tprotected _getAllData() {\r\n\t\tconst out = {};\r\n\t\tlet hasOne = false;\r\n\r\n\t\tthis._forEachUpdatedRow(function(id) {\r\n\t\t\tif (this._in_progress[id] || this.is_invalid(id)){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst row = this._getRowData(id);\r\n\t\t\tif (!this.callEvent(\"onBeforeUpdate\", [id, this.getState(id), row])) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tout[id] = row;\r\n\t\t\thasOne = true;\r\n\t\t\tthis._in_progress[id] = (new Date()).valueOf();\r\n\t\t});\r\n\r\n\t\treturn hasOne ? out : null;\r\n\t}\r\n\r\n\tprotected _prepareDate(value: Date) : string {\r\n\t\treturn this.$gantt.defined(this.$gantt.templates.xml_format) ? this.$gantt.templates.xml_format(value) : this.$gantt.templates.format_date(value);\r\n\t}\r\n\r\n\tprotected _prepareArray(value: any[], traversedObjects: object[]) : any[] {\r\n\t\ttraversedObjects.push(value);\r\n\r\n\t\treturn value.map((item) => {\r\n\t\t\tif(helpers.isDate(item)){\r\n\t\t\t\treturn this._prepareDate(item);\r\n\t\t\t} else if (Array.isArray(item) && !helpers.arrayIncludes(traversedObjects, item)){\r\n\t\t\t\treturn this._prepareArray(item, traversedObjects);\r\n\t\t\t} else if (item && typeof item === \"object\" && !helpers.arrayIncludes(traversedObjects, item)) {\r\n\t\t\t\treturn this._prepareObject(item, traversedObjects);\r\n\t\t\t} else {\r\n\t\t\t\treturn item;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected _prepareObject(rawItem: any, traversedObjects: object[]) : any {\r\n\t\tconst processedItem = {};\r\n\t\ttraversedObjects.push(rawItem);\r\n\r\n\t\tfor (const key in rawItem) {\r\n\t\t\tif (key.substr(0, 1) === \"$\") {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tconst value = rawItem[key];\r\n\t\t\tif (helpers.isDate(value)) {\r\n\t\t\t\tprocessedItem[key] = this._prepareDate(value);\r\n\t\t\t} else if(value === null) {\r\n\t\t\t\tprocessedItem[key] = \"\";\r\n\t\t\t} else if (Array.isArray(value) && !helpers.arrayIncludes(traversedObjects, value)){\r\n\t\t\t\tprocessedItem[key] = this._prepareArray(value, traversedObjects);\r\n\t\t\t} else if (value && typeof value === \"object\" && !helpers.arrayIncludes(traversedObjects, value)) {\r\n\t\t\t\tprocessedItem[key] = this._prepareObject(value, traversedObjects);\r\n\t\t\t} else {\r\n\t\t\t\tprocessedItem[key] = value;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn processedItem;\r\n\t}\r\n\r\n\tprotected _prepareDataItem(rawItem: any): any {\r\n\t\tconst processedItem = this._prepareObject(rawItem, []);\r\n\r\n\t\tprocessedItem[this.action_param] = this.$gantt.getUserData(rawItem.id, this.action_param, this._ganttMode);\r\n\t\treturn processedItem;\r\n\t}\r\n\r\n\tprotected getStoredItem(id){\r\n\t\treturn this._storage.getStoredItem(id);\r\n\t}\r\n\r\n\tprotected _getRowData(id) {\r\n\t\tlet dataItem;\r\n\t\tconst gantt = this.$gantt;\r\n\t\tif (this.getGanttMode() === \"task\") {\r\n\t\t\tif(gantt.isTaskExists(id)){\r\n\t\t\t\tdataItem =this.$gantt.getTask(id);\r\n\t\t\t}\r\n\t\t} else if (this.getGanttMode() === \"assignment\") {\r\n\t\t\tif(this.$gantt.$data.assignmentsStore.exists(id)){\r\n\t\t\t\tdataItem =this.$gantt.$data.assignmentsStore.getItem(id);\r\n\t\t\t}\r\n\t\t} else if (this.getGanttMode() === \"baseline\") {\r\n\t\t\tif(this.$gantt.$data.baselineStore.exists(id)){\r\n\t\t\t\tdataItem =this.$gantt.$data.baselineStore.getItem(id);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(gantt.isLinkExists(id)){\r\n\t\t\t\tdataItem =this.$gantt.getLink(id);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!dataItem) {\r\n\t\t\tdataItem = this.getStoredItem(id);\r\n\t\t}\r\n\r\n\t\tif (!dataItem) {\r\n\t\t\tdataItem = { id };\r\n\t\t}\r\n\r\n\t\treturn this._prepareDataItem(dataItem);\r\n\t}\r\n}","import * as DataProcessor from \"./data_processor\";\r\nexport default {\r\n\tDEPRECATED_api: function(server) {\r\n\t\treturn new (DataProcessor.DataProcessor)(server);\r\n\t},\r\n\tcreateDataProcessor: DataProcessor.createDataProcessor\r\n};","import global from \"../../utils/global\";\r\n\r\nfunction createMethod(gantt){\r\n\tvar methods = {};\r\n\tvar isActive = false;\r\n\tfunction disableMethod(methodName, dummyMethod){\r\n\t\tdummyMethod = typeof dummyMethod == \"function\" ? dummyMethod : function(){};\r\n\r\n\t\tif(!methods[methodName]){\r\n\t\t\tmethods[methodName] = this[methodName];\r\n\t\t\tthis[methodName] = dummyMethod;\r\n\t\t}\r\n\t}\r\n\tfunction restoreMethod(methodName){\r\n\t\tif(methods[methodName]){\r\n\t\t\tthis[methodName] = methods[methodName];\r\n\t\t\tmethods[methodName] = null;\r\n\t\t}\r\n\t}\r\n\tfunction disableMethods(methodsHash){\r\n\t\tfor(var i in methodsHash){\r\n\t\t\tdisableMethod.call(this, i, methodsHash[i]);\r\n\t\t}\r\n\t}\r\n\tfunction restoreMethods(){\r\n\t\tfor(var i in methods){\r\n\t\t\trestoreMethod.call(this, i);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction batchUpdatePayload(callback){\r\n\t\ttry{\r\n\t\t\tcallback();\r\n\t\t}catch(e){\r\n\t\t\tglobal.console.error(e);\r\n\t\t}\r\n\t}\r\n\r\n\tvar state = gantt.$services.getService(\"state\");\r\n\tstate.registerProvider(\"batchUpdate\", function(){\r\n\t\treturn {\r\n\t\t\tbatch_update: isActive\r\n\t\t};\r\n\t}, false);\r\n\r\n\treturn function batchUpdate(callback, noRedraw) {\r\n\t\tif(isActive){\r\n\t\t\t// batch mode is already active\r\n\t\t\tbatchUpdatePayload(callback);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar call_dp = (this._dp && this._dp.updateMode != \"off\");\r\n\t\tvar dp_mode;\r\n\t\tif (call_dp){\r\n\t\t\tdp_mode = this._dp.updateMode;\r\n\t\t\tthis._dp.setUpdateMode(\"off\");\r\n\t\t}\r\n\r\n\t\t// temporary disable some methods while updating multiple tasks\r\n\t\tvar resetProjects = {};\r\n\t\tvar methods = {\r\n\t\t\t\"render\":true,\r\n\t\t\t\"refreshData\":true,\r\n\t\t\t\"refreshTask\":true,\r\n\t\t\t\"refreshLink\":true,\r\n\t\t\t\"resetProjectDates\":function(task){\r\n\t\t\t\tresetProjects[task.id] = task;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tdisableMethods.call(this, methods);\r\n\r\n\t\tisActive = true;\r\n\t\tthis.callEvent(\"onBeforeBatchUpdate\", []);\r\n\r\n\t\tbatchUpdatePayload(callback);\r\n\r\n\t\tthis.callEvent(\"onAfterBatchUpdate\", []);\r\n\r\n\t\trestoreMethods.call(this);\r\n\r\n\t\t// do required updates after changes applied\r\n\t\tfor(var i in resetProjects){\r\n\t\t\tthis.resetProjectDates(resetProjects[i]);\r\n\t\t}\r\n\r\n\t\tisActive = false;\r\n\r\n\t\tif(!noRedraw){\r\n\t\t\tthis.render();\r\n\t\t}\r\n\r\n\t\tif (call_dp) {\r\n\t\t\tthis._dp.setUpdateMode(dp_mode);\r\n\t\t\tthis._dp.setGanttMode(\"task\");\r\n\t\t\tthis._dp.sendData();\r\n\t\t\tthis._dp.setGanttMode(\"link\");\r\n\t\t\tthis._dp.sendData();\r\n\t\t}\r\n\t};\r\n\r\n\r\n\r\n}\r\n\r\nexport default function(gantt){\r\n\tgantt.batchUpdate = createMethod(gantt);\r\n};","const createWbs = (function(gantt){\r\n\treturn {\r\n\t_needRecalc: true,\r\n\treset: function(){\r\n\t\tthis._needRecalc = true;\r\n\t},\r\n\t_isRecalcNeeded: function(){\r\n\t\treturn (!this._isGroupSort() && this._needRecalc);\r\n\t},\r\n\t_isGroupSort: function() {\r\n\t\treturn !!(gantt.getState().group_mode);\r\n\t},\r\n\t_getWBSCode: function(task) {\r\n\t\tif(!task) return \"\";\r\n\r\n\t\tif(this._isRecalcNeeded()){\r\n\t\t\tthis._calcWBS();\r\n\t\t}\r\n\r\n\t\tif(task.$virtual) return \"\";\r\n\t\tif(this._isGroupSort()) return task.$wbs || \"\";\r\n\r\n\t\tif(!task.$wbs) {\r\n\t\t\tthis.reset();\r\n\t\t\tthis._calcWBS();\r\n\t\t}\r\n\t\treturn task.$wbs;\r\n\t},\r\n\t_setWBSCode: function(task, value) {\r\n\t\ttask.$wbs = value;\r\n\t},\r\n\tgetWBSCode: function(task) {\r\n\t\treturn this._getWBSCode(task);\r\n\t},\r\n\tgetByWBSCode: function(code){\r\n\t\tlet parts = code.split(\".\");\r\n\t\tlet currentNode = gantt.config.root_id;\r\n\t\tfor(let i = 0; i < parts.length; i++){\r\n\t\t\tconst children = gantt.getChildren(currentNode);\r\n\t\t\tlet index = parts[i]*1 - 1;\r\n\t\t\tif(gantt.isTaskExists(children[index])){\r\n\t\t\t\tcurrentNode = children[index];\r\n\t\t\t}else{\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(gantt.isTaskExists(currentNode)){\r\n\t\t\treturn gantt.getTask(currentNode);\r\n\t\t}else{\r\n\t\t\treturn null;\r\n\t\t}\r\n\t},\r\n\t_calcWBS: function() {\r\n\t\tif(!this._isRecalcNeeded()) return;\r\n\r\n\t\tlet _isFirst = true;\r\n\t\tgantt.eachTask(function(ch) {\r\n\t\t\tif(ch.type == gantt.config.types.placeholder) return;\r\n\t\t\tif(_isFirst) {\r\n\t\t\t\t_isFirst = false;\r\n\t\t\t\tthis._setWBSCode(ch, \"1\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst _prevSibling = this._getPrevNonPlaceholderSibling(ch.id);\r\n\t\t\tif (_prevSibling !== null) {\r\n\t\t\t\tthis._increaseWBS(ch, _prevSibling);\r\n\t\t\t} else {\r\n\t\t\t\tlet _parent = gantt.getParent(ch.id);\r\n\t\t\t\tthis._setWBSCode(ch, gantt.getTask(_parent).$wbs + \".1\");\r\n\t\t\t}\r\n\t\t}, gantt.config.root_id, this);\r\n\r\n\t\tthis._needRecalc = false;\r\n\t},\r\n\t_increaseWBS: function(task, siblingiId){\r\n\t\tlet _wbs = gantt.getTask(siblingiId).$wbs;\r\n\t\tif(_wbs) {\r\n\t\t\t_wbs = _wbs.split(\".\");\r\n\t\t\t_wbs[_wbs.length-1]++;\r\n\t\t\tthis._setWBSCode(task, _wbs.join(\".\"));\r\n\t\t}\r\n\t},\r\n\t_getPrevNonPlaceholderSibling: function(childId) {\r\n\t\tlet prevSibling;\r\n\t\tlet currentId = childId;\r\n\t\tdo {\r\n\t\t\tprevSibling = gantt.getPrevSibling(currentId);\r\n\t\t\tcurrentId = prevSibling;\r\n\t\t} while (prevSibling !== null && gantt.getTask(prevSibling).type == gantt.config.types.placeholder);\r\n\t\treturn prevSibling;\r\n   }\r\n};\r\n});\r\n\r\nexport default function(gantt){\r\n\tconst wbs = createWbs(gantt);\r\n\tgantt.getWBSCode = function getWBSCode(task) {\r\n\t\treturn wbs.getWBSCode(task);\r\n\t};\r\n\r\n\tgantt.getTaskByWBSCode = function(code) {\r\n\t\treturn wbs.getByWBSCode(code);\r\n\t};\r\n\r\n\tfunction resetCache(){\r\n\t\twbs.reset();\r\n\t\treturn true;\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onAfterTaskMove\", resetCache);\r\n\tgantt.attachEvent(\"onBeforeParse\", resetCache);\r\n\tgantt.attachEvent(\"onAfterTaskDelete\", resetCache);\r\n\tgantt.attachEvent(\"onAfterTaskAdd\", resetCache);\r\n\tgantt.attachEvent(\"onAfterSort\", resetCache);\r\n\r\n};\r\n","import * as helpers from \"../../utils/helpers\";\r\nimport * as dom_helpers from \"../ui/utils/dom_helpers\";\r\nfunction createResourceMethods(gantt){\r\n\r\n\tvar resourceTaskCache = {};\r\n\tvar singleResourceCacheBuilt = false;\r\n\r\n\tgantt.$data.tasksStore.attachEvent(\"onStoreUpdated\", function(){\r\n\t\tresourceTaskCache = {};\r\n\t\tsingleResourceCacheBuilt = false;\r\n\t});\r\n\tgantt.attachEvent(\"onBeforeGanttRender\", function(){\r\n\t\tresourceTaskCache = {};\r\n\t});\r\n\r\n\tfunction getTaskBy(propertyName, propertyValue, typeFilter) {\r\n\t\tif (typeof propertyName == \"function\") {\r\n\t\t\treturn filterResourceTasks(propertyName);\r\n\t\t} else {\r\n\t\t\tif (helpers.isArray(propertyValue)) {\r\n\t\t\t\treturn getResourceTasks(propertyName, propertyValue, typeFilter);\r\n\t\t\t} else {\r\n\t\t\t\treturn getResourceTasks(propertyName, [propertyValue], typeFilter);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction filterResourceTasks(filter) {\r\n\t\tvar res = [];\r\n\t\tgantt.eachTask(function (task) {\r\n\t\t\tif (filter(task)) {\r\n\t\t\t\tres.push(task);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn res;\r\n\t}\r\n\r\n\tvar falsyValuePrefix = String(Math.random());\r\n\tfunction resourceHashFunction(value){\r\n\t\tif (value === null){\r\n\t\t\treturn falsyValuePrefix + String(value);\r\n\t\t}\r\n\t\treturn String(value);\r\n\t}\r\n\r\n\tfunction getCacheKey(resourceIds, property, typeFilter) {\r\n\t\tif (Array.isArray(resourceIds)) {\r\n\t\t\treturn resourceIds.map(function (value) {\r\n\t\t\t\treturn resourceHashFunction(value);\r\n\t\t\t}).join(\"_\") + `_${property}_${typeFilter}`;\r\n\t\t} else {\r\n\t\t\treturn resourceHashFunction(resourceIds) + `_${property}_${typeFilter}`;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getResourceTasks(property, resourceIds, typeFilter) {\r\n\t\tvar res;\r\n\t\tvar cacheKey = getCacheKey(resourceIds, property, JSON.stringify(typeFilter));\r\n\t\tvar matchingResources = {};\r\n\t\thelpers.forEach(resourceIds, function(resourceId) {\r\n\t\t\tmatchingResources[resourceHashFunction(resourceId)] = true;\r\n\t\t});\r\n\r\n\t\tif (!resourceTaskCache[cacheKey]) {\r\n\t\t\tres = resourceTaskCache[cacheKey] = [];\r\n\t\t\tgantt.eachTask(function (task) {\r\n\t\t\t\tif (typeFilter) {\r\n\t\t\t\t\tif (!typeFilter[gantt.getTaskType(task)]) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (task.type == gantt.config.types.project) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (property in task) {\r\n\t\t\t\t\tvar resourceValue;\r\n\t\t\t\t\tif (!helpers.isArray(task[property])) {\r\n\t\t\t\t\t\tresourceValue = [task[property]];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresourceValue = task[property];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\thelpers.forEach(resourceValue, function(value) {\r\n\t\t\t\t\t\tvar resourceValue = (value && value.resource_id) ? value.resource_id : value;\r\n\r\n\t\t\t\t\t\tif (matchingResources[resourceHashFunction(resourceValue)]) {\r\n\t\t\t\t\t\t\tres.push(task);\r\n\t\t\t\t\t\t}else if(!singleResourceCacheBuilt){\r\n\r\n\t\t\t\t\t\t\tvar key = getCacheKey(value, property);\r\n\t\t\t\t\t\t\tif(!resourceTaskCache[key]){\r\n\t\t\t\t\t\t\t\tresourceTaskCache[key] = [];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tresourceTaskCache[key].push(task);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tsingleResourceCacheBuilt = true;\r\n\t\t} else {\r\n\t\t\tres = resourceTaskCache[cacheKey];\r\n\t\t}\r\n\r\n\t\treturn res;\r\n\t}\r\n\r\n\tfunction selectAssignments(resourceId, taskId, result){\r\n\t\tvar property = gantt.config.resource_property;\r\n\t\tvar owners = [];\r\n\t\tif (gantt.getDatastore(\"task\").exists(taskId)) {\r\n\t\t\tvar task = gantt.getTask(taskId);\r\n\t\t\towners = task[property] || [];\r\n\t\t}\r\n\r\n\t\tif (!Array.isArray(owners)) {\r\n\t\t\towners = [owners];\r\n\t\t}\r\n\t\tfor (var i = 0; i < owners.length; i++) {\r\n\t\t\tif (owners[i].resource_id == resourceId) {\r\n\t\t\t\tresult.push({task_id: task.id, resource_id:owners[i].resource_id, value:owners[i].value});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getResourceAssignments(resourceId, taskId){\r\n\t\t// resource assignment as an independent module:\r\n\t\t// {taskId:, resourceId, value}\r\n\t\t// TODO: probably should add a separate datastore for these\r\n\t\tvar assignments = [];\r\n\t\tvar property = gantt.config.resource_property;\r\n\t\tif(taskId !== undefined){\r\n\t\t\tselectAssignments(resourceId, taskId, assignments);\r\n\t\t}else{\r\n\t\t\tvar tasks = gantt.getTaskBy(property, resourceId);\r\n\t\t\ttasks.forEach(function(task){\r\n\t\t\t\tselectAssignments(resourceId, task.id, assignments);\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn assignments;\r\n\t}\r\n\r\n\treturn {\r\n\t\tgetTaskBy: getTaskBy,\r\n\t\tgetResourceAssignments: getResourceAssignments\r\n\t};\r\n}\r\n\r\nfunction createHelper(gantt){\r\n\tconst resourcePlugin = {\r\n\t\trenderEditableLabel: function(start_date, end_date, resource, tasks, assignments){\r\n\t\t\tconst editable = gantt.config.readonly ? \"\" : \"contenteditable\";\r\n\t\t\tif(start_date < resource.end_date && end_date > resource.start_date){\r\n\t\t\t\tfor(let i = 0; i < assignments.length; i++){\r\n\t\t\t\t\tconst a = assignments[i];\r\n\t\t\t\t\t\treturn \"<div \"+editable+\" data-assignment-cell data-assignment-id='\"+a.id+\"'\"+\r\n\t\t\t\t\t\t\" data-row-id='\"+resource.id+\"'\"+\r\n\t\t\t\t\t\t\" data-task='\"+resource.$task_id+\"'\"+\r\n\t\t\t\t\t\t\" data-start-date='\"+gantt.templates.format_date(start_date)+\"'\"+\r\n\t\t\t\t\t\t\" data-end-date='\"+gantt.templates.format_date(end_date)+\"'>\" + a.value + \"</div>\";\r\n\t\t\t\t}\r\n\t\t\t\treturn \"<div \"+editable+\" data-assignment-cell data-empty \"+ \r\n\t\t\t\t\t\t\" data-row-id='\"+resource.id+\"'\"+\r\n\t\t\t\t\t\t\" data-resource-id='\"+resource.$resource_id+\"'\"+\r\n\t\t\t\t\t\t\" data-task='\"+resource.$task_id+\"'\"+\r\n\t\t\t\t\t\t\" data-start-date='\"+gantt.templates.format_date(start_date)+\"'\"+\r\n\t\t\t\t\t\t\"'  data-end-date='\"+gantt.templates.format_date(end_date)+\"'>-</div>\";\r\n\t\t\t}\r\n\t\t\treturn \"\";\r\n\t\t},\r\n\t\trenderSummaryLabel: function(start_date, end_date, resource, tasks, assignments){\r\n\t\t\tlet sum = assignments.reduce(function(total, assignment){ \r\n\t\t\t\treturn total + Number(assignment.value);\r\n\t\t\t}, 0);\r\n\r\n\t\t\tif(sum % 1){\r\n\t\t\t\tsum = Math.round(sum * 10)/10;\r\n\t\t\t}\r\n\r\n\t\t\tif(sum){\r\n\t\t\t\treturn \"<div>\" + sum + \"</div>\";\r\n\t\t\t}\r\n\t\t\treturn \"\";\r\n\t\t},\r\n\t\teditableResourceCellTemplate: function(start_date, end_date, resource, tasks, assignments){\r\n\t\t\tif(resource.$role === \"task\"){\r\n\t\t\t\treturn resourcePlugin.renderEditableLabel(start_date, end_date, resource, tasks, assignments);\r\n\t\t\t}else{\r\n\t\t\t\treturn resourcePlugin.renderSummaryLabel(start_date, end_date, resource, tasks, assignments);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\t\r\n\t\teditableResourceCellClass: function(start_date, end_date, resource, tasks, assignments){\r\n\t\t\tconst css = [];\r\n\t\t\tcss.push(\"resource_marker\");\r\n\r\n\t\t\tif(resource.$role === \"task\"){\r\n\t\t\t\tcss.push(\"task_cell\");\r\n\t\t\t}else{\r\n\t\t\t\tcss.push(\"resource_cell\");\r\n\t\t\t}\r\n\r\n\t\t\tconst sum = assignments.reduce(function(total, assignment){ \r\n\t\t\t\treturn total + Number(assignment.value);\r\n\t\t\t}, 0);\r\n\r\n\t\t\tlet capacity = Number(resource.capacity);\r\n\t\t\tif(isNaN(capacity)){\r\n\t\t\t\tcapacity = 8;\r\n\t\t\t}\r\n\t\t\tif (sum <= capacity) {\r\n\t\t\t\tcss.push(\"workday_ok\");\r\n\t\t\t} else {\r\n\t\t\t\tcss.push(\"workday_over\");\r\n\t\t\t}\r\n\t\t\treturn css.join(\" \");\r\n\t\t},\r\n\t\tgetSummaryResourceAssignments: function getResourceAssignments(resourceId) {\r\n\t\t\tlet assignments;\r\n\t\t\tconst store = gantt.getDatastore(gantt.config.resource_store);\r\n\t\t\tconst resource = store.getItem(resourceId);\r\n\r\n\t\t\tif(resource.$role === \"task\"){\r\n\t\t\t\tassignments = gantt.getResourceAssignments(resource.$resource_id, resource.$task_id);\r\n\t\t\t}else{\r\n\t\t\t\tassignments = gantt.getResourceAssignments(resourceId);\r\n\t\t\t\tif(store.eachItem){\r\n\t\t\t\t\tstore.eachItem(function(childResource){\r\n\t\t\t\t\t\tif(childResource.$role !== \"task\"){\r\n\t\t\t\t\t\t\tassignments = assignments.concat(gantt.getResourceAssignments(childResource.id));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, resourceId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn assignments;\r\n\t\t},\r\n\t\t\r\n\t\tinitEditableDiagram: function(){\r\n\t\t\tgantt.config.resource_render_empty_cells = true;\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t(function(){\r\n\t\t\t\t/// salesforce locker workaround\r\n\t\t\t\t// SF removes 'contenteditable' attribute from cells\r\n\t\t\t\t// restore it on render\r\n\t\t\t\tlet timeoutId = null;\r\n\t\t\t\tfunction makeEditable() {\r\n\t\t\t\t\tif (timeoutId) {\r\n\t\t\t\t\t\tcancelAnimationFrame(timeoutId);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttimeoutId = requestAnimationFrame(function () {\r\n\t\t\t\t\t\tif (gantt.$container){\r\n\t\t\t\t\t\t\tvar cells = Array.prototype.slice.call(gantt.$container.querySelectorAll(\".resourceTimeline_cell [data-assignment-cell]\"));\r\n\t\t\t\t\t\t\tcells.forEach(function (cell) {\r\n\t\t\t\t\t\t\t\tcell.contentEditable = true;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\t\t\t\t\tgantt.getDatastore(gantt.config.resource_assignment_store).attachEvent(\"onStoreUpdated\", makeEditable);\r\n\t\t\t\t\tgantt.getDatastore(gantt.config.resource_store).attachEvent(\"onStoreUpdated\", makeEditable);\r\n\t\t\t\t}, {once: true});\r\n\t\t\t\tgantt.attachEvent(\"onGanttLayoutReady\", function(){\r\n\t\t\t\t\tconst ganttViews = gantt.$layout.getCellsByType(\"viewCell\");\r\n\t\t\t\t\tganttViews.forEach(function(view){\r\n\t\t\t\t\t\tif(view.$config && view.$config.view === \"resourceTimeline\" && view.$content){\r\n\t\t\t\t\t\t\tview.$content.attachEvent(\"onScroll\", makeEditable);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t})();\r\n\t\t\t//GS-2766: need to restore focus after updating assignments\r\n\t\t\tlet currentFocusIndex = null;\r\n\t\t\tfunction setNextFocus(){\r\n\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\tconst focusableElementsAfterRender = dom_helpers.getFocusableNodes(gantt.$container);\r\n\t\t\t\t\tif(currentFocusIndex > -1){\r\n\t\t\t\t\t\tfocusableElementsAfterRender[currentFocusIndex +1]?.focus();\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 300);\r\n\t\t\t};\r\n\r\n\t\t\tfunction handleAssignmentEdit(e, elem){\r\n\t\t\t\tlet target = elem || e.target.closest(\".resourceTimeline_cell [data-assignment-cell]\");\r\n\t\t\t\tif(target){\r\n\t\t\t\t\tlet strValue = (target.innerText || \"\").trim();\r\n\t\t\t\t\tif(strValue == \"-\"){\r\n\t\t\t\t\t\tstrValue = \"0\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet value = Number(strValue);\r\n\t\t\t\t\tlet rowId = target.getAttribute(\"data-row-id\");\r\n\t\t\t\t\tlet assignmentId = target.getAttribute(\"data-assignment-id\");\r\n\t\t\t\t\tlet taskId = target.getAttribute(\"data-task\");\r\n\t\t\t\t\tlet resourceId = target.getAttribute(\"data-resource-id\");\r\n\t\t\t\t\tlet startDate = gantt.templates.parse_date(target.getAttribute(\"data-start-date\"));\r\n\t\t\t\t\tlet endDate = gantt.templates.parse_date(target.getAttribute(\"data-end-date\"));\r\n\r\n\t\t\t\t\tconst assignmentStore = gantt.getDatastore(gantt.config.resource_assignment_store);\r\n\t\t\t\t\tif(isNaN(value)){\r\n\t\t\t\t\t\tgantt.getDatastore(gantt.config.resource_store).refresh(rowId);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tconst task = gantt.getTask(taskId);\r\n\t\t\t\t\t\tif(assignmentId){\r\n\t\t\t\t\t\t\t// GS-2141. Track the changes by the Undo extension\r\n\t\t\t\t\t\t\tif (gantt.plugins().undo){\r\n\t\t\t\t\t\t\t\tgantt.ext.undo.saveState(taskId, \"task\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconst assignment = assignmentStore.getItem(assignmentId);\r\n\t\t\t\t\t\t\tif(!assignment || value === assignment.value){\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(assignment.start_date.valueOf() === startDate.valueOf() && assignment.end_date.valueOf() === endDate.valueOf()){\r\n\t\t\t\t\t\t\t\tassignment.value = value;\r\n\t\t\t\t\t\t\t\tif(!value){\r\n\t\t\t\t\t\t\t\t\tassignmentStore.removeItem(assignment.id);\r\n\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\tassignmentStore.updateItem(assignment.id);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif(assignment.end_date.valueOf() > endDate.valueOf()){\r\n\t\t\t\t\t\t\t\t\tconst nextChunk = gantt.copy(assignment);\r\n\t\t\t\t\t\t\t\t\tnextChunk.id = gantt.uid();\r\n\t\t\t\t\t\t\t\t\tnextChunk.start_date = endDate;\r\n\t\t\t\t\t\t\t\t\tnextChunk.duration = gantt.calculateDuration({\r\n\t\t\t\t\t\t\t\t\t\tstart_date: nextChunk.start_date,\r\n\t\t\t\t\t\t\t\t\t\tend_date: nextChunk.end_date,\r\n\t\t\t\t\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\tnextChunk.delay = gantt.calculateDuration({\r\n\t\t\t\t\t\t\t\t\t\tstart_date: task.start_date,\r\n\t\t\t\t\t\t\t\t\t\tend_date: nextChunk.start_date,\r\n\t\t\t\t\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\tnextChunk.mode = assignment.mode || \"default\";\r\n\t\t\t\t\t\t\t\t\tif(nextChunk.duration !== 0){\r\n\t\t\t\t\t\t\t\t\t\tassignmentStore.addItem(nextChunk);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif(assignment.start_date.valueOf() < startDate.valueOf()){\r\n\t\t\t\t\t\t\t\t\tassignment.end_date = startDate;\r\n\t\t\t\t\t\t\t\t\tassignment.duration = gantt.calculateDuration({\r\n\t\t\t\t\t\t\t\t\t\tstart_date: assignment.start_date,\r\n\t\t\t\t\t\t\t\t\t\tend_date: assignment.end_date,\r\n\t\t\t\t\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\tassignment.mode = \"fixedDuration\";\r\n\r\n\t\t\t\t\t\t\t\t\tif(assignment.duration === 0){\r\n\t\t\t\t\t\t\t\t\t\tassignmentStore.removeItem(assignment.id);\r\n\t\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t\tassignmentStore.updateItem(assignment.id);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\tassignmentStore.removeItem(assignment.id);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif(value){\r\n\t\t\t\t\t\t\t\t\tassignmentStore.addItem({\r\n\t\t\t\t\t\t\t\t\t\ttask_id: assignment.task_id,\r\n\t\t\t\t\t\t\t\t\t\tresource_id: assignment.resource_id,\r\n\t\t\t\t\t\t\t\t\t\tvalue: value,\r\n\t\t\t\t\t\t\t\t\t\tstart_date: startDate,\r\n\t\t\t\t\t\t\t\t\t\tend_date: endDate,\r\n\t\t\t\t\t\t\t\t\t\tduration: gantt.calculateDuration({\r\n\t\t\t\t\t\t\t\t\t\t\tstart_date: startDate,\r\n\t\t\t\t\t\t\t\t\t\t\tend_date: endDate,\r\n\t\t\t\t\t\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\t\t\tdelay: gantt.calculateDuration({\r\n\t\t\t\t\t\t\t\t\t\t\tstart_date: task.start_date,\r\n\t\t\t\t\t\t\t\t\t\t\tend_date: startDate,\r\n\t\t\t\t\t\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\t\t\tmode: \"fixedDuration\"\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tgantt.updateTaskAssignments(task.id);\r\n\t\t\t\t\t\t\tgantt.updateTask(task.id);\r\n\r\n\t\t\t\t\t\t}else if(value){\r\n\t\t\t\t\t\t\tlet assignment = {\r\n\t\t\t\t\t\t\t\ttask_id: taskId,\r\n\t\t\t\t\t\t\t\tresource_id: resourceId,\r\n\t\t\t\t\t\t\t\tvalue: value,\r\n\t\t\t\t\t\t\t\tstart_date: startDate,\r\n\t\t\t\t\t\t\t\tend_date: endDate,\r\n\t\t\t\t\t\t\t\tduration: gantt.calculateDuration({\r\n\t\t\t\t\t\t\t\t\tstart_date: startDate,\r\n\t\t\t\t\t\t\t\t\tend_date: endDate,\r\n\t\t\t\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\tdelay: gantt.calculateDuration({\r\n\t\t\t\t\t\t\t\t\tstart_date: task.start_date,\r\n\t\t\t\t\t\t\t\t\tend_date: startDate,\r\n\t\t\t\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\tmode: \"fixedDuration\"\r\n\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t\tassignmentStore.addItem(assignment);\r\n\t\t\t\t\t\t\tgantt.updateTaskAssignments(task.id);\r\n\t\t\t\t\t\t\tgantt.updateTask(task.id);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\t\t\t\tlet editedElem = null;\r\n\t\t\t\tgantt.event(gantt.$container, \"keypress\", function(e){\r\n\t\t\t\t\tlet target = e.target.closest(\".resourceTimeline_cell [data-assignment-cell]\");\r\n\t\t\t\t\tif(target){\r\n\t\t\t\t\t\tif (e.keyCode === 13 || e.keyCode === 27) {\r\n\t\t\t\t\t\t\ttarget.blur();\r\n\t\t\t\t\t\t\thandleAssignmentEdit(e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\teditedElem = e.target;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tgantt.event(gantt.$container, \"keydown\", function(event){\r\n\t\t\t\t\tif (event.key === \"Tab\") {\r\n\t\t\t\t\t\tconst focusableElements = dom_helpers.getFocusableNodes(gantt.$container);\r\n\t\t\t\t\t\tcurrentFocusIndex = focusableElements.indexOf(document.activeElement);\r\n\t\t\t\t\t\thandleAssignmentEdit(event);\r\n\t\t\t\t\t\tsetNextFocus();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tgantt.event(gantt.$container, \"click\", function(e) {\r\n\t\t\t\t\tif(editedElem){\r\n\t\t\t\t\t\thandleAssignmentEdit(e, editedElem);\r\n\t\t\t\t\t\teditedElem = null;\r\n\t\t\t\t\t\t//handle click on the editable content\r\n\t\t\t\t\t\tif(e.target.hasAttribute(\"data-assignment-id\")){\r\n\t\t\t\t\t\t\tconst focusableElements = gantt.$container.querySelectorAll(\"[contenteditable='true']\");\r\n\t\t\t\t\t\t\tconst target = Array.from(focusableElements).find(elem =>\r\n\t\t\t\t\t\t\t\telem.getAttribute(\"data-start-date\") == e.target.getAttribute(\"data-start-date\") &&\r\n\t\t\t\t\t\t\t\telem.getAttribute(\"data-assignment-id\") == e.target.getAttribute(\"data-assignment-id\")\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t//set focus after editing assignment\r\n\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\tconst focusableElementsAfterUpdate = gantt.$container.querySelectorAll(\"[contenteditable='true']\");\r\n\t\t\t\t\t\t\t\tconst targetAfterUpdate = Array.from(focusableElementsAfterUpdate).find(elem =>\r\n\t\t\t\t\t\t\t\t\telem.getAttribute(\"data-start-date\") == target.getAttribute(\"data-start-date\") &&\r\n\t\t\t\t\t\t\t\t\telem.getAttribute(\"data-row-id\") == target.getAttribute(\"data-row-id\")\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\tif (targetAfterUpdate) {\r\n\t\t\t\t\t\t\t\t\ttargetAfterUpdate.focus();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}, 400);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}, {once: true});\r\n\t\t}\r\n\t};\r\n\treturn resourcePlugin;\r\n}\r\n\r\nexport default function(gantt){\r\n\tvar methods = createResourceMethods(gantt);\r\n\t\r\n\tgantt.ext.resources = createHelper(gantt);\r\n\r\n\tgantt.config.resources = {\r\n\t\tdataprocessor_assignments: false,\r\n\t\tdataprocessor_resources: false,\r\n\t\teditable_resource_diagram: false,\r\n\t\tresource_store: {\r\n\t\t\ttype: \"treeDataStore\",\r\n\t\t\tfetchTasks: false,\r\n\t\t\tinitItem: function(item) {\r\n\t\t\t\titem.parent = item.parent || gantt.config.root_id;\r\n\t\t\t\titem[gantt.config.resource_property] = item.parent;\r\n\t\t\t\titem.open = true;\r\n\t\t\t\treturn item;\r\n\t\t\t}\r\n\t\t},\r\n\t\tlightbox_resources: function selectResourceControlOptions(resources){\r\n\t\t\tconst lightboxOptions = [];\r\n\t\t\tconst store = gantt.getDatastore(gantt.config.resource_store);\r\n\t\t\tresources.forEach(function(res) {\r\n\t\t\t\tif (!store.hasChild(res.id)) {\r\n\t\t\t\t\tconst copy = gantt.copy(res);\r\n\t\t\t\t\tcopy.key = res.id;\r\n\t\t\t\t\tcopy.label = res.text;\r\n\t\t\t\t\tlightboxOptions.push(copy);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn lightboxOptions;\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.attachEvent(\"onBeforeGanttReady\", function(){\r\n\t\tif(gantt.getDatastore(gantt.config.resource_store)){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst resourceStoreConfig = gantt.config.resources ? gantt.config.resources.resource_store : undefined;\r\n\t\tlet fetchTasks = resourceStoreConfig ? resourceStoreConfig.fetchTasks : undefined;\r\n\t\tif(gantt.config.resources && gantt.config.resources.editable_resource_diagram){\r\n\t\t\tfetchTasks = true;\r\n\t\t}\r\n\r\n\t\tlet initItems = function(item) {\r\n\t\t\titem.parent = item.parent || gantt.config.root_id;\r\n\t\t\titem[gantt.config.resource_property] = item.parent;\r\n\t\t\titem.open = true;\r\n\t\t\treturn item;\r\n\t\t};\r\n\r\n\t\tif(resourceStoreConfig && resourceStoreConfig.initItem){\r\n\t\t\tinitItems = resourceStoreConfig.initItem;\r\n\t\t}\r\n\r\n\t\tconst storeType = resourceStoreConfig && resourceStoreConfig.type ? resourceStoreConfig.type : \"treeDatastore\";\r\n\r\n\t\tgantt.$resourcesStore = gantt.createDatastore({\r\n\t\t\tname: gantt.config.resource_store,\r\n\t\t\ttype: storeType,\r\n\t\t\tfetchTasks: fetchTasks !== undefined ? fetchTasks : false,\r\n\t\t\tinitItem: initItems\r\n\t\t});\r\n\r\n\t\tgantt.$data.resourcesStore = gantt.$resourcesStore;\r\n\r\n\t\tgantt.$resourcesStore.attachEvent(\"onParse\", function() {\r\n\t\t\tfunction selectResourceControlOptions(resources){\r\n\t\t\t\tconst lightboxOptions = [];\r\n\t\t\t\tresources.forEach(function(res) {\r\n\t\t\t\t\tconst copy = gantt.copy(res);\r\n\t\t\t\t\tcopy.key = res.id;\r\n\t\t\t\t\tcopy.label = res.text;\r\n\t\t\t\t\tlightboxOptions.push(copy);\r\n\t\t\t\t});\r\n\t\t\t\treturn lightboxOptions;\r\n\t\t\t}\r\n\r\n\t\t\tlet lightboxOptionsFnc = selectResourceControlOptions;\r\n\t\t\tlet options;\r\n\t\t\tif(gantt.config.resources && gantt.config.resources.lightbox_resources){\r\n\t\t\t\tlightboxOptionsFnc = gantt.config.resources.lightbox_resources;\r\n\t\t\t}\r\n\t\t\tif(gantt.config.resources && gantt.config.resources.editable_resource_diagram){\r\n\t\t\t\t// GS-2604: case for the next parsed resources\r\n\t\t\t\t// to filter only resources with assignments\r\n\t\t\t\tconst resources = gantt.$resourcesStore.getItems();\r\n\t\t\t\tconst filteredResources = resources.filter(resource => {\r\n\t\t\t\t\tlet assignments = gantt.getResourceAssignments(resource.id);\r\n\t\t\t\t\tif(!gantt.$resourcesStore.hasChild(resource.id) || (assignments && assignments.length)){\r\n\t\t\t\t\t\tif(resource.$resource_id && resource.$task_id){\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\toptions = lightboxOptionsFnc(filteredResources);\r\n\t\t\t} else {\r\n\t\t\t\toptions = lightboxOptionsFnc(gantt.$resourcesStore.getItems());\r\n\t\t\t}\r\n\t\t\tgantt.updateCollection(\"resourceOptions\", options);\r\n\t\t});\r\n\t});\r\n\r\n\tgantt.getTaskBy = methods.getTaskBy;\r\n\tgantt.getResourceAssignments = methods.getResourceAssignments;\r\n\tgantt.config.resource_property = \"owner_id\";\r\n\tgantt.config.resource_store = \"resource\";\r\n\tgantt.config.resource_render_empty_cells = false;\r\n\r\n\t/**\r\n\t * these are placeholder functions that should be redefined by the user\r\n\t*/\r\n\tgantt.templates.histogram_cell_class = function(start_date, end_date, resource, tasks, assignments) {};\r\n\tgantt.templates.histogram_cell_label = function(start_date, end_date, resource, tasks, assignments) {\r\n\t\treturn tasks.length + \"/3\";\r\n\t};\r\n\tgantt.templates.histogram_cell_allocated = function(start_date, end_date, resource, tasks, assignments) {\r\n\t\treturn tasks.length / 3;\r\n\t};\r\n\tgantt.templates.histogram_cell_capacity = function(start_date, end_date, resource, tasks, assignments) {\r\n\t\treturn 0;\r\n\t};\r\n\r\n\r\n\tconst defaultResourceCellClass = function(start, end, resource, tasks, assignments) {\r\n\t\tvar css = \"\";\r\n\t\tif (tasks.length <= 1) {\r\n\t\t\tcss = \"gantt_resource_marker_ok\";\r\n\t\t} else {\r\n\t\t\tcss = \"gantt_resource_marker_overtime\";\r\n\t\t}\r\n\t\treturn css;\r\n\t};\r\n\r\n\tconst defaultResourceCellTemplate = function(start, end, resource, tasks, assignments) {\r\n\t\treturn tasks.length * 8;\r\n\t};\r\n\r\n\tgantt.templates.resource_cell_value = defaultResourceCellTemplate;\r\n\tgantt.templates.resource_cell_class = defaultResourceCellClass;\r\n\r\n\t//editable_resource_diagram\r\n\tgantt.attachEvent(\"onBeforeGanttReady\", function(){\r\n\t\tif(gantt.config.resources && gantt.config.resources.editable_resource_diagram){\r\n\r\n\t\t\tgantt.config.resource_render_empty_cells = true;\r\n\t\t\tif(gantt.templates.resource_cell_value === defaultResourceCellTemplate){\r\n\t\t\t\tgantt.templates.resource_cell_value = gantt.ext.resources.editableResourceCellTemplate;\r\n\t\t\t}\r\n\t\t\tif(gantt.templates.resource_cell_class === defaultResourceCellClass){\r\n\t\t\t\tgantt.templates.resource_cell_class = gantt.ext.resources.editableResourceCellClass;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tgantt.ext.resources.initEditableDiagram(gantt);\r\n\t\t}\r\n\t});\r\n};\r\n\r\n\r\n","export default function (gantt) {\r\n\tvar resourceAssignmentsProperty = \"$resourceAssignments\";\r\n\tgantt.config.resource_assignment_store = \"resourceAssignments\";\r\n\tgantt.config.process_resource_assignments = true;\r\n\r\n\tvar resourceAssignmentFormats = {\r\n\t\tauto: \"auto\",\r\n\t\tsingleValue: \"singleValue\",\r\n\t\tvalueArray: \"valueArray\",\r\n\t\tresourceValueArray: \"resourceValueArray\",\r\n\t\tassignmentsArray: \"assignmentsArray\"\r\n\t};\r\n\tvar resourceAssignmentFormat = resourceAssignmentFormats.auto;//\"primitiveSingle\";//\"primitive\";//\"object\"|\"assignment\"\r\n\r\n\tvar assignmentModes = {\r\n\t\tfixedDates: \"fixedDates\",\r\n\t\tfixedDuration: \"fixedDuration\",\r\n\t\tdefault: \"default\"\r\n\t};\r\n\r\n\r\n\tfunction initAssignmentFields(item, task){\r\n\t\tif (item.start_date) {\r\n\t\t\titem.start_date = gantt.date.parseDate(item.start_date, \"parse_date\");\r\n\t\t} else {\r\n\t\t\titem.start_date = null;\r\n\t\t}\r\n\r\n\t\tif (item.end_date) {\r\n\t\t\titem.end_date = gantt.date.parseDate(item.end_date, \"parse_date\");\r\n\t\t} else {\r\n\t\t\titem.end_date = null;\r\n\t\t}\r\n\r\n\t\tvar delay = Number(item.delay);\r\n\t\tvar initDelay = false;\r\n\t\tif (!isNaN(delay)) {\r\n\t\t\titem.delay = delay;\r\n\t\t} else {\r\n\t\t\titem.delay = 0;\r\n\t\t\tinitDelay = true;\r\n\t\t}\r\n\r\n\t\tif (!gantt.defined(item.value)) {\r\n\t\t\titem.value = null;\r\n\t\t}\r\n\r\n\t\tif (!item.task_id || !item.resource_id) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\titem.mode = item.mode || assignmentModes.default;\r\n\r\n\t\tif(item.mode === assignmentModes.fixedDuration){\r\n\t\t\tif(isNaN(Number(item.duration))){\r\n\t\t\t\ttask = task || gantt.getTask(item.task_id);\r\n\t\t\t\titem.duration = gantt.calculateDuration({\r\n\t\t\t\t\tstart_date: item.start_date,\r\n\t\t\t\t\tend_date: item.end_date,\r\n\t\t\t\t\tid: task\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif(initDelay){\r\n\t\t\t\ttask = task || gantt.getTask(item.task_id);\r\n\t\t\t\titem.delay = gantt.calculateDuration({\r\n\t\t\t\t\tstart_date: task.start_date,\r\n\t\t\t\t\tend_date: item.start_date,\r\n\t\t\t\t\tid: task\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (item.mode !== assignmentModes.fixedDates && (task || gantt.isTaskExists(item.task_id))) {\r\n\t\t\ttask = task || gantt.getTask(item.task_id);\r\n\t\t\tvar timing = _assignmentTimeFromTask(item, task);\r\n\t\t\titem.start_date = timing.start_date;\r\n\t\t\titem.end_date = timing.end_date;\r\n\t\t\titem.duration = timing.duration;\r\n\t\t}\r\n\t}\r\n\t// gantt init\r\n\tvar resourceAssignmentsStore = gantt.createDatastore({\r\n\t\tname: gantt.config.resource_assignment_store,\r\n\t\tinitItem: function (item) {\r\n\t\t\tif (!item.id) {\r\n\t\t\t\titem.id = gantt.uid();\r\n\t\t\t}\r\n\r\n\t\t\tinitAssignmentFields(item);\r\n\r\n\t\t\treturn item;\r\n\t\t}\r\n\t});\r\n\t\r\n\tgantt.$data.assignmentsStore = resourceAssignmentsStore;\r\n\r\n\tfunction _assignmentTimeFromTask(assignment, task) {\r\n\r\n\t\tif (assignment.mode === assignmentModes.fixedDates) {\r\n\t\t\treturn {\r\n\t\t\t\tstart_date: assignment.start_date,\r\n\t\t\t\tend_date: assignment.end_date,\r\n\t\t\t\tduration: assignment.duration\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tvar start = assignment.delay ? gantt.calculateEndDate({\r\n\t\t\t\tstart_date: task.start_date,\r\n\t\t\t\tduration: assignment.delay,\r\n\t\t\t\ttask: task\r\n\t\t\t}) : new Date(task.start_date);\r\n\r\n\t\t\tvar end;\r\n\t\t\tvar duration;\r\n\t\t\tif (assignment.mode === assignmentModes.fixedDuration) {\r\n\t\t\t\tend = gantt.calculateEndDate({\r\n\t\t\t\t\tstart_date: start,\r\n\t\t\t\t\tduration: assignment.duration,\r\n\t\t\t\t\ttask: task\r\n\t\t\t\t});\r\n\t\t\t\tduration = assignment.duration;\r\n\t\t\t} else {\r\n\t\t\t\tend = new Date(task.end_date);\r\n\t\t\t\tduration = task.duration - assignment.delay;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tstart_date: start,\r\n\t\t\tend_date: end,\r\n\t\t\tduration: duration\r\n\t\t};\r\n\t}\r\n\r\n\t// data loading\r\n\r\n\tfunction _makeAssignmentsFromTask(task) {\r\n\t\tconst property = gantt.config.resource_property;\r\n\t\tlet assignments = task[property];\r\n\t\tconst resourceAssignments = [];\r\n\t\tlet detectFormat = resourceAssignmentFormat === resourceAssignmentFormats.auto;\r\n\r\n\t\tif (gantt.defined(assignments) && assignments) {\r\n\t\t\tif (!Array.isArray(assignments)) {\r\n\t\t\t\tassignments = [assignments];\r\n\t\t\t\tif (detectFormat) {\r\n\t\t\t\t\tresourceAssignmentFormat = resourceAssignmentFormats.singleValue;\r\n\t\t\t\t\tdetectFormat = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst usedIds = {};\r\n\t\t\tassignments.forEach(function (res) {\r\n\t\t\t\tif (!res.resource_id) { // when resource is a string/number\r\n\t\t\t\t\tres = { resource_id: res };\r\n\t\t\t\t\tif (detectFormat) {\r\n\t\t\t\t\t\tresourceAssignmentFormat = resourceAssignmentFormats.valueArray;\r\n\t\t\t\t\t\tdetectFormat = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//\tisSimpleArray = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (detectFormat) {\r\n\t\t\t\t\tif (res.id && res.resource_id) {\r\n\t\t\t\t\t\tresourceAssignmentFormat = resourceAssignmentFormats.assignmentsArray;\r\n\t\t\t\t\t\tdetectFormat = false;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresourceAssignmentFormat = resourceAssignmentFormats.resourceValueArray;\r\n\t\t\t\t\t\tdetectFormat = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet defaultMode = assignmentModes.default;\r\n\t\t\t\tif(!res.mode){\r\n\t\t\t\t\tif((res.start_date && res.end_date) || (res.start_date && res.duration)){\r\n\t\t\t\t\t\tdefaultMode = assignmentModes.fixedDuration;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet id;\r\n\t\t\t\tif(!res.id && res.$id && !usedIds[res.$id]){\r\n\t\t\t\t\tid = res.$id;\r\n\t\t\t\t} else if(res.id && !usedIds[res.id]){\r\n\t\t\t\t\tid = res.id;\r\n\t\t\t\t} else{\r\n\t\t\t\t\tid = gantt.uid();\r\n\t\t\t\t}\r\n\t\t\t\tusedIds[id] = true;\r\n\r\n\t\t\t\tconst assignment = {\r\n\t\t\t\t\tid: id,\r\n\t\t\t\t\tstart_date: res.start_date,\r\n\t\t\t\t\tduration: res.duration,\r\n\t\t\t\t\tend_date: res.end_date,\r\n\t\t\t\t\tdelay: res.delay,\r\n\t\t\t\t\ttask_id: task.id,\r\n\t\t\t\t\tresource_id: res.resource_id,\r\n\t\t\t\t\tvalue: res.value,\r\n\t\t\t\t\tmode: res.mode || defaultMode\r\n\t\t\t\t};\r\n\t\t\t\t// GS-2490: to add custom properties to assignment\r\n\t\t\t\t// need to exclude $id which incfluences on render \r\n\t\t\t\tObject.keys(res).forEach(key => {\r\n\t\t\t\t\tif(key != \"$id\") {\r\n\t\t\t\t\t\tassignment[key] = res[key];\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(!(assignment.start_date && assignment.start_date.getMonth \r\n\t\t\t\t\t&& assignment.end_date && assignment.end_date.getMonth && typeof assignment.duration === \"number\")){\r\n\t\t\t\t\tinitAssignmentFields(assignment, task);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tresourceAssignments.push(assignment);\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn resourceAssignments;\r\n\t}\r\n\r\n\tfunction _updateTaskBack(taskId) {\r\n\t\t// GS-1493. In some cases, the resource assignment store has the tasks that no longer exist\r\n\t\tif (!gantt.isTaskExists(taskId)){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst task = gantt.getTask(taskId);\r\n\t\t//GS-2977: get the updated assignments\r\n\t\tconst assignments = resourceAssignmentsStore.find(a => a.task_id == task.id);\r\n\t\t_assignAssignments(task, assignments);\r\n\t}\r\n\r\n\tfunction _assignAssignments(task, assignments){\r\n\t\tassignments.sort(function(a, b){\r\n\t\t\tif(a.start_date && b.start_date && a.start_date.valueOf() != b.start_date.valueOf()){\r\n\t\t\t\treturn a.start_date - b.start_date;\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (resourceAssignmentFormat == resourceAssignmentFormats.assignmentsArray) {\r\n\t\t\ttask[gantt.config.resource_property] = assignments;\r\n\t\t} else if (resourceAssignmentFormat == resourceAssignmentFormats.resourceValueArray) {\r\n\t\t\ttask[gantt.config.resource_property] = assignments.map(function (a) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t$id: a.id,\r\n\t\t\t\t\tstart_date: a.start_date,\r\n\t\t\t\t\tduration: a.duration,\r\n\t\t\t\t\tend_date: a.end_date,\r\n\t\t\t\t\tdelay: a.delay,\r\n\t\t\t\t\tresource_id: a.resource_id,\r\n\t\t\t\t\tvalue: a.value,\r\n\t\t\t\t\tmode: a.mode\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\ttask[resourceAssignmentsProperty] = assignments;\r\n\t}\r\n\r\n\tfunction _loadAssignmentsFromTask(task) {\r\n\t\tvar assignments = _makeAssignmentsFromTask(task);\r\n\t\tvar taskAssignments = [];\r\n\t\tassignments.forEach(function (a) {\r\n\t\t\ta.id = a.id || gantt.uid();\r\n\t\t\t//var newId = resourceAssignmentsStore.addItem(a);\r\n\t\t\ttaskAssignments.push(a);\r\n\t\t});\r\n\r\n\t\treturn assignments;\r\n\t}\r\n\r\n\tfunction diffAssignments(taskValues, assignmentsStoreValues) {\r\n\t\tvar result = {\r\n\t\t\tinBoth: [],\r\n\t\t\tinTaskNotInStore: [],\r\n\t\t\tinStoreNotInTask: []\r\n\t\t};\r\n\r\n\t\tif (resourceAssignmentFormat == resourceAssignmentFormats.singleValue) {\r\n\t\t\tvar taskOwner = taskValues[0];\r\n\t\t\tvar ownerId = taskOwner ? taskOwner.resource_id : null;\r\n\t\t\tvar foundOwnerAssignment = false;\r\n\t\t\tassignmentsStoreValues.forEach(function (a) {\r\n\t\t\t\tif (a.resource_id != ownerId) {\r\n\t\t\t\t\tresult.inStoreNotInTask.push(a);\r\n\t\t\t\t} else if (a.resource_id == ownerId) {\r\n\t\t\t\t\tresult.inBoth.push({ store: a, task: taskOwner });\r\n\t\t\t\t\tfoundOwnerAssignment = true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (!foundOwnerAssignment && taskOwner) {\r\n\t\t\t\tresult.inTaskNotInStore.push(taskOwner);\r\n\t\t\t}\r\n\r\n\r\n\t\t} else if (resourceAssignmentFormat == resourceAssignmentFormats.valueArray){\r\n\r\n\t\t\tvar taskSearch = {};\r\n\t\t\tvar storeSearch = {};\r\n\t\t\tvar processedIds = {};\r\n\t\t\ttaskValues.forEach(function (a) {\r\n\t\t\t\ttaskSearch[a.resource_id] = a;\r\n\t\t\t});\r\n\t\t\tassignmentsStoreValues.forEach(function (a) {\r\n\t\t\t\tstoreSearch[a.resource_id] = a;\r\n\t\t\t});\r\n\t\t\ttaskValues.concat(assignmentsStoreValues).forEach(function (a) {\r\n\t\t\t\tif (processedIds[a.resource_id]) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tprocessedIds[a.resource_id] = true;\r\n\t\t\t\tvar inTask = taskSearch[a.resource_id];\r\n\t\t\t\tvar inStore = storeSearch[a.resource_id];\r\n\r\n\t\t\t\tif (inTask && inStore) {\r\n\t\t\t\t\tresult.inBoth.push({ store: inStore, task: inTask });\r\n\t\t\t\t} else if (inTask && !inStore) {\r\n\t\t\t\t\tresult.inTaskNotInStore.push(inTask);\r\n\t\t\t\t} else if (!inTask && inStore) {\r\n\t\t\t\t\tresult.inStoreNotInTask.push(inStore);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else if ((resourceAssignmentFormat == resourceAssignmentFormats.assignmentsArray)\r\n\t\t\t|| (resourceAssignmentFormat == resourceAssignmentFormats.resourceValueArray)) {\r\n\t\t\tvar taskSearch = {};\r\n\t\t\tvar storeSearch = {};\r\n\t\t\tvar processedIds = {};\r\n\t\t\ttaskValues.forEach(function (a) {\r\n\t\t\t\ttaskSearch[a.id || a.$id] = a;\r\n\t\t\t});\r\n\t\t\tassignmentsStoreValues.forEach(function (a) {\r\n\t\t\t\tstoreSearch[a.id] = a;\r\n\t\t\t});\r\n\t\t\ttaskValues.concat(assignmentsStoreValues).forEach(function (a) {\r\n\t\t\t\tvar id = a.id || a.$id;\r\n\t\t\t\tif (processedIds[id]) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tprocessedIds[id] = true;\r\n\t\t\t\tvar inTask = taskSearch[id];\r\n\t\t\t\tvar inStore = storeSearch[id];\r\n\r\n\t\t\t\tif (inTask && inStore) {\r\n\t\t\t\t\tresult.inBoth.push({ store: inStore, task: inTask });\r\n\t\t\t\t} else if (inTask && !inStore) {\r\n\t\t\t\t\tresult.inTaskNotInStore.push(inTask);\r\n\t\t\t\t} else if (!inTask && inStore) {\r\n\t\t\t\t\tresult.inStoreNotInTask.push(inStore);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfunction assignmentHasChanged(source, target) {\r\n\t\tvar ignoreFields = {\r\n\t\t\tid: true\r\n\t\t};\r\n\r\n\t\tfor (var i in source) {\r\n\t\t\tif (!ignoreFields[i]) {\r\n\t\t\t\tif (String(source[i]) !== String(target[i])) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tfunction updateAssignment(source, target) {\r\n\t\tvar ignoreFields = {\r\n\t\t\tid: true\r\n\t\t};\r\n\r\n\t\tfor (var i in source) {\r\n\t\t\tif (!ignoreFields[i]) {\r\n\t\t\t\ttarget[i] = source[i];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _syncAssignments(task, storeAssignments){\r\n\t\tvar tasksAssignments = _makeAssignmentsFromTask(task);\r\n\r\n\t\tvar diff = diffAssignments(tasksAssignments, storeAssignments);\r\n\t\tdiff.inStoreNotInTask.forEach(function (a) {\r\n\t\t\tresourceAssignmentsStore.removeItem(a.id);\r\n\t\t});\r\n\t\tdiff.inTaskNotInStore.forEach(function (a) {\r\n\t\t\tresourceAssignmentsStore.addItem(a);\r\n\t\t});\r\n\r\n\t\tdiff.inBoth.forEach(function (a) {\r\n\t\t\tif (assignmentHasChanged(a.task, a.store)) {\r\n\t\t\t\tupdateAssignment(a.task, a.store);\r\n\t\t\t\tresourceAssignmentsStore.updateItem(a.store.id);\r\n\t\t\t} else {\r\n\t\t\t\tif (a.task.start_date && a.task.end_date && a.task.mode !== assignmentModes.fixedDates) {\r\n\t\t\t\t\tvar timing = _assignmentTimeFromTask(a.store, task);\r\n\t\t\t\t\tif (a.store.start_date.valueOf() != timing.start_date.valueOf() || a.store.end_date.valueOf() != timing.end_date.valueOf()) {\r\n\t\t\t\t\t\ta.store.start_date = timing.start_date;\r\n\t\t\t\t\t\ta.store.end_date = timing.end_date;\r\n\t\t\t\t\t\ta.store.duration = timing.duration;\r\n\t\t\t\t\t\tresourceAssignmentsStore.updateItem(a.store.id);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t_updateTaskBack(task.id);\r\n\t}\r\n\r\n\tfunction _syncOnTaskUpdate(task) {\r\n\t\tvar storeAssignments = task[resourceAssignmentsProperty] || resourceAssignmentsStore.find(function (a) {\r\n\t\t\treturn a.task_id == task.id;\r\n\t\t});\r\n\r\n\t\t_syncAssignments(task, storeAssignments);\r\n\t}\r\n\r\n\tfunction _syncOnTaskDelete(ids) {\r\n\t\tvar idsSearch = {};\r\n\t\tids.forEach(function (id) {\r\n\t\t\tidsSearch[id] = true;\r\n\t\t});\r\n\t\tvar taskResources = resourceAssignmentsStore.find(function (a) {\r\n\t\t\treturn idsSearch[a.task_id];\r\n\t\t});\r\n\t\ttaskResources.forEach(function (a) {\r\n\t\t\tresourceAssignmentsStore.removeItem(a.id);\r\n\t\t});\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\r\n\t\tif (gantt.config.process_resource_assignments) {\r\n\t\t\tgantt.attachEvent(\"onParse\", function () {\r\n\t\t\t\tgantt.silent(function () {\r\n\t\t\t\t\tresourceAssignmentsStore.clearAll();\r\n\t\t\t\t\tvar totalAssignments = [];\r\n\t\t\t\t\tgantt.eachTask(function (task) {\r\n\t\t\t\t\t\tif (task.type === gantt.config.types.project) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar assignments = _loadAssignmentsFromTask(task);\r\n\t\t\t\t\t\t_assignAssignments(task, assignments);\r\n\r\n\t\t\t\t\t\tassignments.forEach(function (a) {\r\n\t\t\t\t\t\t\ttotalAssignments.push(a);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\tresourceAssignmentsStore.parse(totalAssignments);\r\n\t\t\t\t});\r\n\r\n\t\t\t});\r\n\r\n\t\t\tvar batchUpdate = false;\r\n\t\t\tvar needUpdate = false;\r\n\t\t\tvar needUpdateFor = {};\r\n\t\t\tvar undoBatchCancel = false;\r\n\t\t\tgantt.attachEvent(\"onBeforeBatchUpdate\", function(){\r\n\t\t\t\tbatchUpdate = true;\r\n\t\t\t});\r\n\t\t\tgantt.attachEvent(\"onAfterBatchUpdate\", function(){\r\n\t\t\t\t\r\n\t\t\t\tif(needUpdate){\r\n\t\t\t\t\tvar assignmentsHash = {};\r\n\t\t\t\t\tfor(var i in needUpdateFor){\r\n\t\t\t\t\t\tassignmentsHash[i] = gantt.getTaskAssignments(needUpdateFor[i].id);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// GS-2546. If we add a task that has the data in the old format,\r\n\t\t\t\t\t// we need to reset the cache as the assignment will be added\r\n\t\t\t\t\t// to the assignment store, but the cache won't have the changes\r\n\t\t\t\t\tif (gantt.config.process_resource_assignments && resourceAssignmentFormat === \"resourceValueArray\"){\r\n\t\t\t\t\t\ttaskAssignmentsCache = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor(var i in needUpdateFor){\r\n\t\t\t\t\t\t_syncAssignments(needUpdateFor[i], assignmentsHash[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tneedUpdate = false;\r\n\t\t\t\tbatchUpdate = false;\r\n\t\t\t\tneedUpdateFor = {};\r\n\t\t\t});\r\n\r\n\t\t\tgantt.attachEvent(\"onTaskCreated\", function (item) {\r\n\t\t\t\tvar assignments = _loadAssignmentsFromTask(item);\r\n\t\t\t\tresourceAssignmentsStore.parse(assignments);\r\n\t\t\t\t_assignAssignments(item, assignments);\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t\tgantt.attachEvent(\"onAfterTaskUpdate\", function (id, item) {\r\n\t\t\t\tif(batchUpdate){\r\n\t\t\t\t\tneedUpdate = true;\r\n\t\t\t\t\tneedUpdateFor[id] = item;\r\n\t\t\t\t}else if (!item.unscheduled){\r\n\t\t\t\t\t_syncOnTaskUpdate(item);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tgantt.attachEvent(\"onAfterTaskAdd\", function (id, item) {\r\n\t\t\t\tif(batchUpdate){\r\n\t\t\t\t\tneedUpdate = true;\r\n\t\t\t\t\tneedUpdateFor[id] = item;\r\n\t\t\t\t}else{\r\n\t\t\t\t\t_syncOnTaskUpdate(item);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t/*\tgantt.attachEvent(\"onRowDragMove\", function (id) {\r\n\t\t\t\t_syncOnTaskUpdate(gantt.getTask(id));\r\n\t\t\t});*/\r\n\t\t\tgantt.attachEvent(\"onRowDragEnd\", function (id) {\r\n\t\t\t\t_syncOnTaskUpdate(gantt.getTask(id));\r\n\t\t\t});\r\n\t\t\tgantt.$data.tasksStore.attachEvent(\"onAfterDeleteConfirmed\", function (id, item) {\r\n\t\t\t\tvar deleteIds = [id];\r\n\t\t\t\tgantt.eachTask(function (task) {\r\n\t\t\t\t\tdeleteIds.push(task.id);\r\n\t\t\t\t}, id);\r\n\t\t\t\t_syncOnTaskDelete(deleteIds);\r\n\t\t\t});\r\n\t\t\tgantt.$data.tasksStore.attachEvent(\"onClearAll\", function () {\r\n\t\t\t\tresourceAssignmentsCache = null;\r\n\t\t\t\tresourceTaskAssignmentsCache = null;\r\n\t\t\t\ttaskAssignmentsCache = null;\r\n\t\t\t\tresourceAssignmentsStore.clearAll();\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t\tgantt.attachEvent(\"onTaskIdChange\", function (id, new_id) {\r\n\t\t\t\tvar taskResources = resourceAssignmentsStore.find(function (a) {\r\n\t\t\t\t\treturn a.task_id == id;\r\n\t\t\t\t});\r\n\t\t\t\ttaskResources.forEach(function (a) {\r\n\t\t\t\t\ta.task_id = new_id;\r\n\t\t\t\t\tresourceAssignmentsStore.updateItem(a.id);\r\n\t\t\t\t});\r\n\t\t\t\t_updateTaskBack(new_id);\r\n\t\t\t\t//any custom logic here\r\n\t\t\t});\r\n\t\t\t// GS-2144. When we Undo something, the cache should be reset\r\n\t\t\t// during the `onStoreUpdated` event to properly update the assignments\r\n\t\t\tgantt.attachEvent(\"onBeforeUndo\", function (action) {\r\n\t\t\t\tundoBatchCancel = true;\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t\tgantt.attachEvent(\"onAfterUndo\", function (action) {\r\n\t\t\t\tundoBatchCancel = true;\r\n\t\t\t});\r\n\r\n\r\n\t\t\tvar resourceAssignmentsCache = null;\r\n\t\t\tvar resourceTaskAssignmentsCache = null;\r\n\t\t\tvar taskAssignmentsCache = null;\r\n\r\n\t\t\tresourceAssignmentsStore.attachEvent(\"onStoreUpdated\", function resetCache(){\r\n\t\t\t\tif(batchUpdate && !undoBatchCancel){\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\tresourceAssignmentsCache = null;\r\n\t\t\t\tresourceTaskAssignmentsCache = null;\r\n\t\t\t\ttaskAssignmentsCache = null;\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\r\n\t\t\tgantt.getResourceAssignments = function (resourceId, taskId) {\r\n\t\t\t\tvar searchTaskId = gantt.defined(taskId) && taskId !== null;\r\n\r\n\t\t\t\tif(resourceAssignmentsCache === null){\r\n\t\t\t\t\tresourceAssignmentsCache = {};\r\n\t\t\t\t\tresourceTaskAssignmentsCache = {};\r\n\r\n\t\t\t\t\tresourceAssignmentsStore.eachItem(function (a) {\r\n\t\t\t\t\t\tif(!resourceAssignmentsCache[a.resource_id]){\r\n\t\t\t\t\t\t\tresourceAssignmentsCache[a.resource_id] = [];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tresourceAssignmentsCache[a.resource_id].push(a);\r\n\r\n\t\t\t\t\t\tvar resourceTaskCacheKey = a.resource_id + \"-\" + a.task_id;\r\n\t\t\t\t\t\tif(!resourceTaskAssignmentsCache[resourceTaskCacheKey]){\r\n\t\t\t\t\t\t\tresourceTaskAssignmentsCache[resourceTaskCacheKey] = [];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tresourceTaskAssignmentsCache[resourceTaskCacheKey].push(a);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tif(searchTaskId){\r\n\t\t\t\t\treturn (resourceTaskAssignmentsCache[resourceId + \"-\" + taskId] || []).slice();\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn (resourceAssignmentsCache[resourceId] || []).slice();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t\r\n\t\t\tgantt.getTaskAssignments = function (taskId) {\r\n\t\t\t\tif(taskAssignmentsCache === null){\r\n\t\t\t\t\tvar result = [];\r\n\t\t\t\t\ttaskAssignmentsCache = {};\r\n\t\t\t\t\tresourceAssignmentsStore.eachItem(function (a) {\r\n\t\t\t\t\t\tif(!taskAssignmentsCache[a.task_id]){\r\n\t\t\t\t\t\t\ttaskAssignmentsCache[a.task_id] = [];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttaskAssignmentsCache[a.task_id].push(a);\r\n\t\t\t\t\t\tif (a.task_id == taskId) {\r\n\t\t\t\t\t\t\tresult.push(a);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn (taskAssignmentsCache[taskId] || []).slice();\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tgantt.getTaskResources = function (taskId) {\r\n\t\t\t\tconst store = gantt.getDatastore(\"resource\");\r\n\t\t\t\tconst assignments = gantt.getTaskAssignments(taskId);\r\n\t\r\n\t\t\t\tconst uniqueResources = {};\r\n\t\t\t\tassignments.forEach(function(a){\r\n\t\t\t\t\tif(!uniqueResources[a.resource_id]){\r\n\t\t\t\t\t\tuniqueResources[a.resource_id] = a.resource_id;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tconst resources = [];\r\n\t\t\t\tfor(const i in uniqueResources){\r\n\t\t\t\t\tconst res = store.getItem(uniqueResources[i]);\r\n\t\t\t\t\tif(res){\r\n\t\t\t\t\t\tresources.push(res);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn resources;\r\n\t\t\t};\r\n\r\n\t\t\tgantt.updateTaskAssignments = _updateTaskBack;\r\n\t\t}\r\n\t}, {once: true});\r\n};","export default function addPlaceholder(gantt){\r\n\tfunction isEnabled(){\r\n\t\treturn gantt.config.placeholder_task;\r\n\t}\r\n\r\n\tfunction callIfEnabled(callback){\r\n\t\treturn function(){\r\n\t\t\tif(!isEnabled()){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn callback.apply(this, arguments);\r\n\t\t};\r\n\t}\r\n\r\n\tfunction silenceDataProcessor(dataProcessor){\r\n\t\tif(dataProcessor && !dataProcessor._silencedPlaceholder){\r\n\t\t\tdataProcessor._silencedPlaceholder = true;\r\n\t\t\tdataProcessor.attachEvent(\"onBeforeUpdate\", callIfEnabled(function(id, state, data){\r\n\t\t\t\tif(data.type == gantt.config.types.placeholder){\r\n\t\t\t\t\tdataProcessor.setUpdated(id, false);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}));\r\n\t\t}\r\n\t}\r\n\r\n\tfunction insertPlaceholder(){\r\n\t\tvar placeholders = gantt.getTaskBy(\"type\", gantt.config.types.placeholder);\r\n\t\tif(!placeholders.length || !gantt.isTaskExists(placeholders[0].id)){\r\n\t\t\tvar placeholder = {\r\n\t\t\t\tunscheduled: true,\r\n\t\t\t\ttype: gantt.config.types.placeholder,\r\n\t\t\t\tduration:0,\r\n\t\t\t\ttext: gantt.locale.labels.new_task\r\n\t\t\t};\r\n\t\t\tif(gantt.callEvent(\"onTaskCreated\", [placeholder]) === false){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tgantt.addTask(placeholder);\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n\r\n\tfunction afterEdit(id){\r\n\t\tvar item = gantt.getTask(id);\r\n\t\tif(item.type == gantt.config.types.placeholder) {\r\n\t\t\tif(item.start_date && item.end_date && item.unscheduled){\r\n\t\t\t\titem.unscheduled = false;\r\n\t\t\t}\r\n\r\n\t\t\tgantt.batchUpdate(function(){\r\n\t\t\t\tvar newTask = gantt.copy(item);\r\n\t\t\t\tgantt.silent(function(){\r\n\t\t\t\t\tgantt.deleteTask(item.id);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tdelete newTask[\"!nativeeditor_status\"];\r\n\t\t\t\tnewTask.type = gantt.config.types.task;\r\n\t\t\t\tnewTask.id = gantt.uid();\r\n\t\t\t\tgantt.addTask(newTask);\r\n\r\n\t\t\t\t//insertPlaceholder();\r\n\t\t\t});\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tgantt.config.types.placeholder = \"placeholder\";\r\n\tgantt.attachEvent(\"onDataProcessorReady\", callIfEnabled(silenceDataProcessor));\r\n\r\n\tvar ready = false;\r\n\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\t\tif(ready){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tready = true;\r\n\t\tgantt.attachEvent(\"onAfterTaskUpdate\", callIfEnabled(afterEdit));\r\n\t\tgantt.attachEvent(\"onAfterTaskAdd\", callIfEnabled(function(id, task){\r\n\t\t\tif(task.type != gantt.config.types.placeholder){\r\n\t\t\t\tvar placeholders = gantt.getTaskBy(\"type\", gantt.config.types.placeholder);\r\n\t\t\t\tplaceholders.forEach(function(p){\r\n\t\t\t\t\tgantt.silent(function(){\r\n\t\t\t\t\t\tif(gantt.isTaskExists(p.id))\r\n\t\t\t\t\t\t\tgantt.deleteTask(p.id);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\tinsertPlaceholder();\r\n\t\t\t}\r\n\t\t}));\r\n\t\tgantt.attachEvent(\"onParse\", callIfEnabled(insertPlaceholder));\r\n\t});\r\n\r\n\tfunction isPlaceholderTask(taskId){\r\n\t\tif(gantt.config.types.placeholder && gantt.isTaskExists(taskId)){\r\n\t\t\tvar task = gantt.getTask(taskId);\r\n\t\t\tif(task.type == gantt.config.types.placeholder){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tfunction isPlaceholderLink(link){\r\n\t\tif(isPlaceholderTask(link.source) || isPlaceholderTask(link.target)){\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tgantt.attachEvent(\"onLinkValidation\", function(link){\r\n\t\tif(isPlaceholderLink(link)){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t});\r\n\tgantt.attachEvent(\"onBeforeLinkAdd\", function(id,link){\r\n\t\tif(isPlaceholderLink(link)){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onBeforeUndoStack\", function(action){\r\n\t\tfor(var i = 0; i < action.commands.length; i++){\r\n\t\t\tvar command = action.commands[i];\r\n\t\t\tif(command.entity === \"task\" && command.value.type === gantt.config.types.placeholder){\r\n\t\t\t\taction.commands.splice(i,1);\r\n\t\t\t\ti--;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t});\r\n\r\n};","export default function(gantt) {\r\n\tfunction isEnabled() {\r\n\t\treturn gantt.config.auto_types && // if enabled\r\n\t\t\t(gantt.getTaskType(gantt.config.types.project) == gantt.config.types.project);// and supported\r\n\t}\r\n\r\n\tfunction callIfEnabled(callback) {\r\n\t\treturn function() {\r\n\t\t\tif (!isEnabled()) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn callback.apply(this, arguments);\r\n\t\t};\r\n\t}\r\n\r\n\tfunction checkTaskType(id, changedTypes) {\r\n\t\tvar task = gantt.getTask(id);\r\n\t\tvar targetType = getTaskTypeToUpdate(task);\r\n\t\tif (targetType !== false && gantt.getTaskType(task) !== targetType) {\r\n\t\t\tchangedTypes.$needsUpdate = true;\r\n\t\t\tchangedTypes[task.id] = {task: task, type: targetType};\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getUpdatedTypes(id, changedTypes) {\r\n\t\tchangedTypes = changedTypes || {};\r\n\t\t\r\n\t\tcheckTaskType(id, changedTypes);\r\n\t\tgantt.eachParent(function(parent) {\r\n\t\t\tcheckTaskType(parent.id, changedTypes);\r\n\t\t}, id);\r\n\r\n\t\treturn changedTypes;\r\n\t}\r\n\r\n\tfunction applyChanges(changedTypes) {\r\n\t\tfor (var i in changedTypes) {\r\n\t\t\tif(changedTypes[i] && changedTypes[i].task){\r\n\t\t\t\tvar task = changedTypes[i].task;\r\n\t\t\t\ttask.type = changedTypes[i].type;\r\n\t\t\t\tgantt.updateTask(task.id);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction updateParentTypes(startId) {\r\n\t\tif (gantt.getState().group_mode) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar changedTypes = getUpdatedTypes(startId);\r\n\t\tif (changedTypes.$needsUpdate) {\r\n\t\t\tgantt.batchUpdate(function() {\r\n\t\t\t\tapplyChanges(changedTypes);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tvar delTaskParent;\r\n\r\n\tfunction updateTaskType(task, targetType) {\r\n\t\tif(!gantt.getState().group_mode){\r\n\t\t\ttask.type = targetType;\r\n\t\t\tgantt.updateTask(task.id);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getTaskTypeToUpdate(task) {\r\n\t\tvar allTypes = gantt.config.types;\r\n\t\tvar hasChildren = gantt.hasChild(task.id);\r\n\t\tvar taskType = gantt.getTaskType(task.type);\r\n\r\n\t\tif (hasChildren && taskType === allTypes.task) {\r\n\t\t\treturn allTypes.project;\r\n\t\t}\r\n\r\n\t\tif (!hasChildren && taskType === allTypes.project) {\r\n\t\t\treturn allTypes.task;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tvar isParsingDone = true;\r\n\r\n\tgantt.attachEvent(\"onParse\", callIfEnabled(function() {\r\n\t\tisParsingDone = false;\r\n\t\tif(gantt.getState().group_mode){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tgantt.batchUpdate(function() {\r\n\t\t\tgantt.eachTask(function(task) {\r\n\t\t\t\tvar targetType = getTaskTypeToUpdate(task);\r\n\t\t\t\tif (targetType !== false) {\r\n\t\t\t\t\tupdateTaskType(task, targetType);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tisParsingDone = true;\r\n\t}));\r\n\r\n\tgantt.attachEvent(\"onAfterTaskAdd\", callIfEnabled(function(id) {\r\n\t\tif (isParsingDone) {\r\n\t\t\tupdateParentTypes(id);\r\n\t\t}\r\n\t}));\r\n\r\n\tgantt.attachEvent(\"onAfterTaskUpdate\", callIfEnabled(function(id) {\r\n\t\tif (isParsingDone) {\r\n\t\t\tupdateParentTypes(id);\r\n\t\t}\r\n\t}));\r\n\r\n\tfunction updateAfterRemoveChild(id){\r\n\t\tif (id != gantt.config.root_id && gantt.isTaskExists(id)) {\r\n\t\t\tupdateParentTypes(id);\r\n\t\t}\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onBeforeTaskDelete\", callIfEnabled(function(id, task) {\r\n\t\tdelTaskParent = gantt.getParent(id);\r\n\t\treturn true;\r\n\t}));\r\n\r\n\tgantt.attachEvent(\"onAfterTaskDelete\", callIfEnabled(function(id, task) {\r\n\t\tupdateAfterRemoveChild(delTaskParent);\r\n\t}));\r\n\r\n\r\n\tvar originalRowDndParent;\r\n\r\n\tgantt.attachEvent(\"onRowDragStart\", callIfEnabled(function(id, target, e) {\r\n\t\toriginalRowDndParent = gantt.getParent(id);\r\n\t\treturn true;\r\n\t}));\r\n\r\n\tgantt.attachEvent(\"onRowDragEnd\", callIfEnabled(function(id, target) {\r\n\t\tupdateAfterRemoveChild(originalRowDndParent);\r\n\t\tupdateParentTypes(id);\r\n\t}));\r\n\r\n\tvar originalMoveTaskParent;\r\n\r\n\tgantt.attachEvent(\"onBeforeTaskMove\", callIfEnabled(function(sid, parent, tindex) {\r\n\t\toriginalMoveTaskParent = gantt.getParent(sid);\r\n\t\treturn true;\r\n\t}));\r\n\r\n\tgantt.attachEvent(\"onAfterTaskMove\", callIfEnabled(function(id, parent, tindex) {\r\n\t\tif (document.querySelector(\".gantt_drag_marker\")) {\r\n\t\t\t// vertical dnd in progress\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tupdateAfterRemoveChild(originalMoveTaskParent);\r\n\t\tupdateParentTypes(id);\r\n\t}));\r\n};","export default class DurationFormatterNumeric implements IDurationFormatter {\r\n\tstatic create = (settings: IDurationFormatterConfig = null): IDurationFormatter => {\r\n\t\treturn new DurationFormatterNumeric();\r\n\t};\r\n\tcanParse = (value: string) : boolean => {\r\n\t\treturn !isNaN(this.parse(value));\r\n\t};\r\n\tformat = (value: number) : string => {\r\n\t\treturn String(value);\r\n\t};\r\n\tparse = (value: string) : number => {\r\n\t\treturn parseInt(value, 10);\r\n\t};\r\n}","export default class LinkFormatterSimple implements ILinkFormatter {\r\n\tstatic create = (settings: ILinkFormatterConfig = null, gantt: any): LinkFormatterSimple => {\r\n\t\treturn new LinkFormatterSimple(gantt);\r\n\t};\r\n\tprotected _linkReg: RegExp;\r\n\tprotected _gantt: any;\r\n\r\n\tconstructor(gantt: any) {\r\n\t\tthis._linkReg = /^[0-9\\.]+/;\r\n\t\tthis._gantt = gantt;\r\n\t}\r\n\r\n\tformat = (link: ILink) : string => {\r\n\t\tconst wbs = this._getWBSCode(link.source);\r\n\t\treturn wbs;\r\n\t};\r\n\r\n\tcanParse = (value: string) : boolean => {\r\n\t\treturn this._linkReg.test(value);\r\n\t};\r\n\tparse = (value: string) : ILink => {\r\n\t\tif(!this.canParse(value)){\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst linkPart = this._linkReg.exec(value)[0].trim();\r\n\r\n\t\tconst source = this._findSource(linkPart) || null;\r\n\r\n\t\treturn {\r\n\t\t\tid: undefined,\r\n\t\t\tsource,\r\n\t\t\ttarget: null,\r\n\t\t\ttype: this._gantt.config.links.finish_to_start,\r\n\t\t\tlag: 0\r\n\t\t};\r\n\t};\r\n\r\n\tprotected _getWBSCode = (source: number | string) => {\r\n\t\tconst pred = this._gantt.getTask(source);\r\n\t\treturn this._gantt.getWBSCode(pred);\r\n\t};\r\n\r\n\tprotected _findSource = (value: string) => {\r\n\t\tconst reqTemplate = new RegExp(\"^[0-9\\.]+\", \"i\");\r\n\t\tif(reqTemplate.exec(value)){\r\n\t\t\tconst wbs = reqTemplate.exec(value)[0];\r\n\t\t\tconst task = this._gantt.getTaskByWBSCode(wbs);\r\n\t\t\tif(task){\r\n\t\t\t\treturn task.id;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n}","\r\nimport DurationFormatter from \"../common/duration_formatter\";\r\nimport LinkFormatter from \"../common/link_formatter\";\r\n\r\nexport default function(gantt){\r\n\tgantt.ext.formatters = {\r\n\t\tdurationFormatter: function(settings){\r\n\t\t\tif(!settings){\r\n\t\t\t\tsettings = {};\r\n\t\t\t}\r\n\t\t\tif(!settings.store){\r\n\t\t\t\tsettings.store = gantt.config.duration_unit;\r\n\t\t\t}\r\n\t\t\tif(!settings.enter){\r\n\t\t\t\tsettings.enter = gantt.config.duration_unit;\r\n\t\t\t}\r\n\t\t\treturn DurationFormatter.create(settings, gantt);\r\n\t\t},\r\n\t\tlinkFormatter: function(settings){\r\n\t\t\treturn LinkFormatter.create(settings, gantt);\r\n\t\t}\r\n\t};\r\n};","export default function(gantt: any){\r\n\r\n\tgantt.ext = gantt.ext || {};\r\n\tgantt.config.show_empty_state = false;\r\n\r\n\tgantt.ext.emptyStateElement = gantt.ext.emptyStateElement || {\r\n\t\tisEnabled() {\r\n\t\t\treturn gantt.config.show_empty_state === true;\r\n\t\t},\r\n\t\tisGanttEmpty(){\r\n\t\t\treturn !gantt.getTaskByTime().length;\r\n\t\t},\r\n\t\trenderContent(container){\r\n\t\t\tconst placeholderTextElement = `<div class='gantt_empty_state_text'>\r\n    <div class='gantt_empty_state_text_link' data-empty-state-create-task>${gantt.locale.labels.empty_state_text_link}</div>\r\n    <div class='gantt_empty_state_text_description'>${gantt.locale.labels.empty_state_text_description}</div>\r\n    </div>`;\r\n\t\t\tconst placeholderImageElement = \"<div class='gantt_empty_state_image'></div>\";\r\n\r\n\t\t\tconst placeholderContainer = `<div class='gantt_empty_state'>${placeholderImageElement}${placeholderTextElement}</div>`;\r\n\t\t\tcontainer.innerHTML = placeholderContainer;\r\n\t\t},\r\n\r\n\t\tclickEvents: [],\r\n\t\tattachAddTaskEvent(){\r\n\t\t\tconst id = gantt.attachEvent(\"onEmptyClick\", function(e){\r\n\t\t\t\tconst domHelpers = gantt.utils.dom;\r\n\t\t\t\tconst gridPlaceholder = domHelpers.closest(e.target, \"[data-empty-state-create-task]\");\r\n\t\t\t\tif (gridPlaceholder){\r\n\t\t\t\t\tgantt.createTask({\r\n\t\t\t\t\t\tid: gantt.uid(),\r\n\t\t\t\t\t\ttext: \"New Task\"\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis.clickEvents.push(id);\r\n\t\t},\r\n\t\tdetachAddTaskEvents(){\r\n\t\t\tthis.clickEvents.forEach(function(event){\r\n\t\t\t\tgantt.detachEvent(event);\r\n\t\t\t});\r\n\t\t\tthis.clickEvents = [];\r\n\t\t},\r\n\r\n\t\tgetContainer(){\r\n\t\t\tif (gantt.$container) {\r\n\t\t\t\tconst domHelpers = gantt.utils.dom;\r\n\t\t\t\tif (gantt.$container.contains(gantt.$grid_data)) {\r\n\t\t\t\t\treturn domHelpers.closest(gantt.$grid_data, \".gantt_layout_content\");\r\n\t\t\t\t}\r\n\t\t\t\tif (gantt.$container.contains(gantt.$task_data)){\r\n\t\t\t\t\treturn domHelpers.closest(gantt.$task_data, \".gantt_layout_content\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t},\r\n\r\n\t\tgetNode(){\r\n\t\t\tconst container = this.getContainer();\r\n\t\t\tif (!container){\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tconst emptyStateElementNode = container.querySelector(\".gantt_empty_state_wrapper\");\r\n\t\t\treturn emptyStateElementNode;\r\n\t\t},\r\n\r\n\t\tshow(){\r\n\t\t\tconst container = this.getContainer();\r\n\t\t\tif (!container && this.isGanttEmpty()){\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tconst wrapper = document.createElement(\"div\");\r\n\t\t\twrapper.className = \"gantt_empty_state_wrapper\";\r\n\t\t\twrapper.style.marginTop = (gantt.config.scale_height - container.offsetHeight) + \"px\";\r\n\t\t\tconst oldNodes = gantt.$container.querySelectorAll(\".gantt_empty_state_wrapper\");\r\n\t\t\t// for IE11\r\n\t\t\tArray.prototype.forEach.call(oldNodes, function(node){\r\n\t\t\t\tnode.parentNode.removeChild(node);\r\n\t\t\t});\r\n\r\n\t\t\tthis.detachAddTaskEvents();\r\n\t\t\tthis.attachAddTaskEvent();\r\n\r\n\t\t\tcontainer.appendChild(wrapper);\r\n\t\t\tthis.renderContent(wrapper);\r\n\t\t},\r\n\t\thide(){\r\n\t\t\tconst emptyStateElementNode = this.getNode();\r\n\t\t\tif (emptyStateElementNode){\r\n\t\t\t\temptyStateElementNode.parentNode.removeChild(emptyStateElementNode);\r\n\t\t\t} else{\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tinit(){ }\r\n\t};\r\n\r\n\tgantt.attachEvent(\"onDataRender\", function() {\r\n\t\tconst emptyStateElement = gantt.ext.emptyStateElement;\r\n\t\tif (emptyStateElement.isEnabled() && emptyStateElement.isGanttEmpty()) {\r\n\t\t\temptyStateElement.show();\r\n\t\t} else {\r\n\t\t\temptyStateElement.hide();\r\n\t\t}\r\n\t});\r\n\r\n\r\n\r\n\r\n}\r\n","export const hasBaselinesBelow = function (gantt, task) {\r\n  const baselines = task.baselines && task.baselines.length;\r\n  const baselinesOnDifferentRow = gantt.config.baselines.render_mode == \"separateRow\" || gantt.config.baselines.render_mode == \"individualRow\";\r\n  if (baselines && baselinesOnDifferentRow) {\r\n    return true;\r\n  }\r\n};\r\n\r\nexport const childrenHaveBaselines = function (gantt, taskId) {\r\n  let hasBaselines = false;\r\n  gantt.eachTask(function (child) {\r\n    if (hasBaselines) {\r\n      return;\r\n    }\r\n    hasBaselines = hasBaselinesBelow(gantt, child);\r\n  }, taskId);\r\n  return hasBaselines;\r\n};\r\n\r\nexport const isSplitChild = function (gantt, id) {\r\n  let splitChild = false;\r\n  gantt.eachParent(function (parent) {\r\n    if (isSplitParent(parent)) {\r\n      splitChild = true;\r\n    }\r\n  }, id);\r\n  return splitChild;\r\n};\r\n\r\nexport const isSplitParent = function (task) {\r\n  return task.render && task.render == \"split\" && !task.$open;\r\n};\r\n\r\nexport const getMaxParentHeight = function (gantt, view, task, heightLimit) {\r\n  let maxHeight = heightLimit || view.$task_data.scrollHeight;\r\n  let shrinkHeight = false;\r\n  let splitChild = false;\r\n\r\n  gantt.eachParent(function (parent) {\r\n    if (isSplitParent(parent)) {\r\n      splitChild = true;\r\n      const parentSizes = view.getItemPosition(parent);\r\n      const parentHeight = parentSizes.rowHeight;\r\n      if (parentHeight < maxHeight) {\r\n        maxHeight = parentHeight;\r\n        shrinkHeight = true;\r\n      }\r\n    }\r\n  }, task.id);\r\n\r\n  return { maxHeight, shrinkHeight, splitChild };\r\n};\r\n\r\nexport const getMilestoneHeight = function (height) {\r\n  return Math.sqrt(2 * height * height);\r\n};\r\n\r\nexport const getInvertedMilestoneHeight = function (height) {\r\n  return Math.round(height / Math.sqrt(2));\r\n};\r\n\r\nexport const getAdjustedPosition = function (gantt, timeline, sizes, heightLimit, task, childBaselines) {\r\n  const baselines = hasBaselinesBelow(gantt, task);\r\n\r\n  const splitParams = getMaxParentHeight(gantt, timeline, task);\r\n  let maxHeight = splitParams.maxHeight;\r\n\r\n  let height = sizes.height;\r\n  let largerHeight = height > heightLimit;\r\n  let noNeedToShrink = sizes.rowHeight >= heightLimit && !splitParams.splitChild && !baselines;\r\n  if (largerHeight || noNeedToShrink) {\r\n    height = heightLimit;\r\n  }\r\n\r\n  if (maxHeight < height) {\r\n    height = maxHeight;\r\n  }\r\n\r\n  let marginTop = Math.floor((sizes.rowHeight - height) / 2);\r\n\r\n  if (splitParams.splitChild) {\r\n    marginTop = Math.floor((maxHeight - height) / 2);\r\n  }\r\n  if (childBaselines || baselines) {\r\n    let heightDiff = Math.min(sizes.height, maxHeight) - height;\r\n\r\n    let additionalMargin = 2;\r\n    let exceedBarHeight = baselines && task.bar_height >= task.row_height;\r\n    let exceedParentHeight = splitParams.splitChild && sizes.height >= maxHeight;\r\n    if (exceedBarHeight || exceedParentHeight){\r\n      additionalMargin = 0;\r\n    }\r\n\r\n    marginTop = Math.floor(heightDiff / 2) + additionalMargin;\r\n    const bottom = height + marginTop;\r\n    if (bottom > sizes.rowHeight || bottom > maxHeight) {\r\n      // marginTop = 0;\r\n    }\r\n  }\r\n\r\n  return { height, marginTop };\r\n};\r\n\r\nexport default {\r\n  hasBaselinesBelow,\r\n  childrenHaveBaselines,\r\n  isSplitChild,\r\n  isSplitParent,\r\n  getMaxParentHeight,\r\n  getMilestoneHeight,\r\n  getInvertedMilestoneHeight,\r\n  getAdjustedPosition\r\n};\r\n","import { hasBaselinesBelow, isSplitParent } from \"../ui/render/baseline_helper\";\r\nimport isHeadless from \"../../utils/is_headless\";\r\n\r\nexport default function (gantt) {\r\n  gantt.config.baselines = {\r\n    datastore: \"baselines\",\r\n    render_mode: false,\r\n    dataprocessor_baselines: false,\r\n    row_height: 16,\r\n    bar_height: 8\r\n  };\r\n\r\n  function initBaselineFields(item, task) {\r\n    // don't add baseline if it doesn't belong to any task\r\n    // or if doesn't have the dates\r\n    if (!item.task_id || (!item.start_date && !item.end_date)) {\r\n      return false;\r\n    }\r\n\r\n    if (item.start_date) {\r\n      item.start_date = gantt.date.parseDate(item.start_date, \"parse_date\");\r\n    } else {\r\n      item.start_date = null;\r\n    }\r\n\r\n    if (item.end_date) {\r\n      item.end_date = gantt.date.parseDate(item.end_date, \"parse_date\");\r\n    } else {\r\n      item.end_date = null;\r\n    }\r\n\r\n    // set min baseline duration\r\n    item.duration = item.duration || 1;\r\n\r\n    // GS-2636. Calculate the 3rd date parameter basing on existing date parameters\r\n    if (item.start_date && !item.end_date){\r\n      item.end_date = gantt.calculateEndDate(item.start_date, item.duration);\r\n    } else if (item.end_date && !item.start_date){\r\n      item.start_date = gantt.calculateEndDate(item.end_date, -item.duration);\r\n    } \r\n  }\r\n  // gantt init\r\n  const baselineStore = gantt.createDatastore({\r\n    name: gantt.config.baselines.datastore,\r\n    initItem: function (item) {\r\n      if (!item.id) {\r\n        item.id = gantt.uid();\r\n      }\r\n\r\n      initBaselineFields(item);\r\n\r\n      return item;\r\n    }\r\n  });\r\n\r\n  gantt.$data.baselineStore = baselineStore;\r\n\r\n  function _syncBaselines(task) {\r\n    let shouldRepaint = false;\r\n    const iteratedBaselines = {};\r\n\r\n    const taskBaselines = task.baselines || [];\r\n    const existingBaselines = gantt.getTaskBaselines(task.id);\r\n\r\n    if (taskBaselines.length != existingBaselines.length) {\r\n      shouldRepaint = true;\r\n    }\r\n\r\n    taskBaselines.forEach(function (baseline) {\r\n      iteratedBaselines[baseline.id] = true;\r\n      const exisingBaseline = baselineStore.getItem(baseline.id);\r\n      if (exisingBaseline) {\r\n        const start = +exisingBaseline.start_date !== +baseline.start_date;\r\n        const end = +exisingBaseline.end_date !== +baseline.end_date;\r\n        if (start || end) {\r\n          baselineStore.updateItem(baseline.id, baseline);\r\n        }\r\n      } else {\r\n        baselineStore.addItem(baseline);\r\n      }\r\n    });\r\n\r\n    existingBaselines.forEach(function (baseline) {\r\n      if (!iteratedBaselines[baseline.id]) {\r\n        baselineStore.removeItem(baseline.id);\r\n      }\r\n    });\r\n\r\n    if (shouldRepaint) {\r\n      if (isSplitParent(task)){\r\n        // here we adjust the parent height, then adjust it with the total child height\r\n        _adjustSplitParentHeight (task);\r\n      } else {\r\n        gantt.adjustTaskHeightForBaselines(task);\r\n      }\r\n      gantt.render();\r\n    }\r\n  }\r\n\r\n  function _deleteOrphanBaselines() {\r\n    baselineStore.eachItem(function (baseline) {\r\n      if (!gantt.isTaskExists(baseline.task_id)) {\r\n        baselineStore.removeItem(baseline.id);\r\n      }\r\n    });\r\n  }\r\n\r\n  function _adjustSplitParentHeight (task){\r\n    let maxParentHeight = 0;\r\n\r\n    gantt.adjustTaskHeightForBaselines(task);\r\n\r\n    gantt.eachTask(function(child){\r\n      let childHeight = child.row_height || gantt.config.row_height;\r\n\r\n      maxParentHeight = maxParentHeight || childHeight;\r\n      if (childHeight > maxParentHeight){\r\n        maxParentHeight = childHeight;\r\n      }\r\n    }, task.id);\r\n\r\n    if (task.row_height < maxParentHeight){\r\n      task.row_height = maxParentHeight;\r\n    }\r\n  }\r\n\r\n  gantt.adjustTaskHeightForBaselines = function (task) {\r\n    let height, baselineSize, betweenBaselines;\r\n    let margins = 2;\r\n    let baselineAmount = task.baselines && task.baselines.length || 0;\r\n    const subrowHeight = gantt.config.baselines.row_height;\r\n    //const baselineBarHeight = task?.baselines.bar_height\r\n\r\n    const timelineView = gantt.getLayoutView(\"timeline\");\r\n    if (!timelineView || !gantt.config.show_chart){\r\n      return;\r\n    }\r\n\r\n    switch (gantt.config.baselines.render_mode) {\r\n      case \"taskRow\":\r\n        task.row_height = task.bar_height + 8;\r\n        break;\r\n\r\n      case \"separateRow\":\r\n        height = timelineView.getBarHeight(task.id);\r\n        if (baselineAmount) {\r\n          task.bar_height = task.bar_height || height;\r\n\r\n          if (task.bar_height > height){\r\n            height = task.bar_height;\r\n          }\r\n\r\n          task.row_height = height + subrowHeight;\r\n        } else if (task.bar_height) {\r\n          task.row_height = task.bar_height + 4;\r\n        }\r\n\r\n        _increaseSplitParentHeight(task);\r\n        break;\r\n\r\n      case \"individualRow\":\r\n        height = timelineView.getBarHeight(task.id);\r\n\r\n        if (baselineAmount) {\r\n          task.bar_height = task.bar_height || height;\r\n\r\n          if (task.bar_height > height){\r\n            height = task.bar_height;\r\n          }\r\n\r\n          baselineSize = subrowHeight * baselineAmount;\r\n       //   betweenBaselines = 3 * (baselineAmount + 1);\r\n\r\n          task.row_height = height + baselineSize + margins;\r\n        } else if (task.bar_height){\r\n          task.row_height = task.bar_height + 4;\r\n        }\r\n\r\n        _increaseSplitParentHeight(task);\r\n        break;\r\n      default:\r\n        task.row_height = task.bar_height + 8;\r\n        break;\r\n    }\r\n  };\r\n\r\n  function _increaseSplitParentHeight(task) {\r\n    gantt.eachParent(function (parent) {\r\n      if (isSplitParent(parent)) {\r\n        const parentHeight = parent.row_height || gantt.getLayoutView(\"timeline\").getBarHeight(parent.id);\r\n        let maxHeight = task.row_height;\r\n\r\n        // iterate only direct children\r\n        const subtasks = gantt.getChildren(parent.id);\r\n        subtasks.forEach(function (subtaskId) {\r\n          const subtask = gantt.getTask(subtaskId);\r\n          if (subtask.id == task.id) {\r\n            return;\r\n          }\r\n          const subtaskHeight = subtask.row_height || gantt.getLayoutView(\"timeline\").getBarHeight(subtask.id);\r\n          maxHeight = maxHeight || subtaskHeight;\r\n          if (subtaskHeight > maxHeight) {\r\n            maxHeight = subtaskHeight;\r\n          }\r\n        });\r\n\r\n        parent.row_height = maxHeight;\r\n        parent.bar_height = parent.bar_height || parentHeight;\r\n      }\r\n    }, task.id);\r\n  }\r\n\r\n  function _addBaselinesToTask(baseline){\r\n    const taskId = baseline.task_id;\r\n    if (gantt.isTaskExists(taskId)) {\r\n      const task = gantt.getTask(taskId);\r\n\r\n      task.baselines = task.baselines || [];\r\n\r\n      let newBaseline = true;\r\n      for (let i = 0; i < task.baselines.length; i++) {\r\n        let existingBaseline = task.baselines[i];\r\n        if (existingBaseline.id == baseline.id){\r\n          newBaseline = false;\r\n          gantt.mixin(existingBaseline, baseline, true);\r\n          break;\r\n        }\r\n      }\r\n      if (newBaseline){\r\n        task.baselines.push(baseline);\r\n      }\r\n\r\n      if(!isHeadless(gantt)){\r\n        if (isSplitParent(task)){\r\n          _adjustSplitParentHeight (task);\r\n        } else {\r\n          gantt.adjustTaskHeightForBaselines(task);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  gantt.attachEvent(\r\n    \"onGanttReady\",\r\n    function () {\r\n\r\n      if(!gantt.config.baselines){\r\n        return;\r\n      }\r\n\r\n      gantt.attachEvent(\"onParse\", function () {\r\n        baselineStore.eachItem(function (baseline) {\r\n          _addBaselinesToTask(baseline);\r\n        });\r\n      });\r\n\r\n      gantt.attachEvent(\"onBeforeTaskUpdate\", function (id, task) {\r\n        _syncBaselines(task);\r\n        return true;\r\n      });\r\n\r\n      gantt.attachEvent(\"onAfterUndo\", function(action){\r\n        const baselinesRenderedBelow = gantt.config.baselines.render_mode == \"separateRow\" || gantt.config.baselines.render_mode == \"individualRow\";\r\n        if (baselinesRenderedBelow && action){\r\n          let repaint = false;\r\n          action.commands.forEach(function(command){\r\n            if (command.entity == \"task\"){\r\n              const taskId = command.value.id;\r\n              if (gantt.isTaskExists(taskId)){\r\n                const task = gantt.getTask(taskId);\r\n                if (task.parent && gantt.isTaskExists(task.parent)){\r\n                  const parent = gantt.getTask(task.parent);\r\n                  if (isSplitParent(parent)){\r\n                    _adjustSplitParentHeight (parent);\r\n                    repaint = true;\r\n                  }\r\n                }\r\n              }    \r\n            }\r\n          });\r\n          if (repaint){\r\n            gantt.render();\r\n          }\r\n        }\r\n      });\r\n\r\n      gantt.attachEvent(\"onAfterTaskDelete\", function (id, task) {\r\n        if (hasBaselinesBelow){\r\n          if (task.parent && gantt.isTaskExists(task.parent)){\r\n            const parent = gantt.getTask(task.parent);\r\n            if (isSplitParent(parent)){\r\n              _adjustSplitParentHeight (parent);\r\n            }\r\n          }\r\n        }\r\n        _deleteOrphanBaselines();\r\n      });\r\n\r\n      gantt.getTaskBaselines = function (taskId) {\r\n        const baselines = [];\r\n        baselineStore.eachItem(function (baseline) {\r\n          if (baseline.task_id == taskId) {\r\n            baselines.push(baseline);\r\n          }\r\n        });\r\n        return baselines;\r\n      };\r\n      gantt.$data.baselineStore.attachEvent(\"onClearAll\", function () {\r\n        gantt.eachTask(function(task){\r\n          if (task.baselines){\r\n            delete task.baselines;\r\n          }\r\n        });\r\n        // The data should not be repainted as otherwise it causes issues when we have resource \r\n        // assignments and group tasks. It should be fixed when we add a repaint stack\r\n        // gantt.refreshData();\r\n        return true;\r\n      });\r\n      // GS-3170: case for adding with datastore\r\n      gantt.$data.baselineStore.attachEvent(\"onBeforeAdd\", function(id, item){\r\n        _addBaselinesToTask(item);\r\n      });\r\n      gantt.$data.tasksStore.attachEvent(\"onClearAll\", function () {\r\n        baselineStore.clearAll();\r\n        return true;\r\n      });\r\n      gantt.attachEvent(\"onTaskIdChange\", function (id, new_id) {\r\n        const baselines = baselineStore.find(function (a) {\r\n          return a.task_id == id;\r\n        });\r\n        baselines.forEach(function (a) {\r\n          a.task_id = new_id;\r\n          baselineStore.updateItem(a.id);\r\n        });\r\n      });\r\n    },\r\n    { once: true }\r\n  );\r\n};\r\n","import { Client } from \"remote-client\";\r\n\r\nexport default class RemoteEvents {\r\n\tprotected _remote: any;\r\n\tprotected _ready: Promise<any>;\r\n\r\n\tconstructor(url: string, token: string) {\r\n\t\tconst remote = new Client({\r\n\t\t\turl,\r\n\t\t\ttoken\r\n\t\t});\r\n\r\n\t\t// temporary patch, as we do not want credentials\r\n\t\tremote.fetch = function (url: string, body?: BodyInit) {\r\n\t\t\tconst req: RequestInit = {\r\n\t\t\t\theaders: this.headers()\r\n\t\t\t};\r\n\t\t\tif (body) {\r\n\t\t\t\treq.method = \"POST\";\r\n\t\t\t\treq.body = body;\r\n\t\t\t}\r\n\r\n\t\t\treturn fetch(url, req).then(res => res.json());\r\n\t\t};\r\n\r\n\t\tthis._ready = remote.load().then(back => (this._remote = back));\r\n\t}\r\n\r\n\tprotected ready() {\r\n\t\treturn this._ready;\r\n\t}\r\n\r\n\tprotected on(name: string | any, handler?: any) {\r\n\t\tthis.ready().then(back => {\r\n\t\t\tif (typeof name === \"string\") back.on(name, handler);\r\n\t\t\telse {\r\n\t\t\t\tfor (const key in name) {\r\n\t\t\t\t\tback.on(key, name[key]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n","function createHandlers(gantt) {\r\n\tlet updateQueue = [];\r\n\tlet updateTimeout = null;\r\n\tconst UPDATE_DELAY = 50;\r\n\r\n\tfunction remoteUpdates(message) {\r\n\t\tif (!message || !message.type || !(message.task?.id || message.link?.id)) {\r\n\t\t\t// eslint-disable-next-line no-console\r\n\t\t\tconsole.error(\"Invalid message format:\", message);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst { type, task, link } = message;\r\n\t\tif ((task && gantt._dp._in_progress[task.id]) || (link && gantt._dp._in_progress[link.id])) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (type === \"add-task\") {\r\n\t\t\tfor (const id in gantt._dp._in_progress) {\r\n\t\t\t\tif (gantt._dp.getState(id) === \"inserted\") {\r\n\t\t\t\t\tgantt._dp.attachEvent(\"onFullSync\", function () {\r\n\t\t\t\t\t\tif (!gantt.isTaskExists(task.id)) {\r\n\t\t\t\t\t\t\tprocessUpdate(message);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, { once: true });\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tupdateQueue.push(message);\r\n\t\tif (updateTimeout) clearTimeout(updateTimeout);\r\n\t\tupdateTimeout = setTimeout(processQueue, UPDATE_DELAY);\r\n\t}\r\n\r\n\tfunction processQueue() {\r\n\t\tif (updateQueue.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (updateQueue.length === 1) {\r\n\t\t\tprocessUpdate(updateQueue[0]);\r\n\t\t} else {\r\n\t\t\tgantt.batchUpdate(function () {\r\n\t\t\t\t\tupdateQueue.forEach(message => {\r\n\t\t\t\t\t\tprocessUpdate(message);\r\n\t\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tupdateQueue = [];\r\n\t}\r\n\r\n\tfunction processUpdate(message) {\r\n\t\tconst { type, task, link } = message;\r\n\t\tswitch (type) {\r\n\t\t\tcase \"add-task\":\r\n\t\t\t\thandleAddTask(task);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"update-task\":\r\n\t\t\t\thandleUpdateTask(task);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"delete-task\":\r\n\t\t\t\thandleDeleteTask(task);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"add-link\":\r\n\t\t\t\thandleAddLink(link);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"update-link\":\r\n\t\t\t\thandleUpdateLink(link);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"delete-link\":\r\n\t\t\t\thandleDeleteLink(link);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction ignore(code){\r\n\t\tif(gantt._dp){\r\n\t\t\tgantt._dp.ignore(code);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcode();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction handleAddTask(taskData) {\r\n\t\tif (gantt.isTaskExists(taskData.id)) {\r\n\t\t\t// eslint-disable-next-line no-console\r\n\t\t\tconsole.warn(`Task with ID ${taskData.id} already exists. Skipping add.`);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttaskData.start_date = gantt.templates.parse_date(taskData.start_date);\r\n\t\tif (taskData.end_date) taskData.end_date = gantt.templates.parse_date(taskData.end_date);\r\n\r\n\t\tignore(() => {\r\n\t\t\tgantt.addTask(taskData);\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tfunction handleUpdateTask(taskData) {\r\n\t\tconst sid = taskData.id;\r\n\r\n\t\tif (!gantt.getTask(sid)) {\r\n\t\t\t// eslint-disable-next-line no-console\r\n\t\t\tconsole.warn(`Task with ID ${sid} does not exist. Skipping update.`);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst initTask = gantt.getDatastore(\"task\").$initItem.bind(gantt.getDatastore(\"task\"));\r\n\r\n\t\tconst existingTask = gantt.getTask(sid);\r\n\r\n\t\tignore(() => {\r\n\r\n\t\t\tconst remoteTask = initTask(taskData);\r\n\t\t\t\r\n\t\t\tfor (let key in remoteTask) {\r\n\t\t\t\texistingTask[key] = remoteTask[key];\r\n\t\t\t}\r\n\t\t\t//Object.assign(existingTask, taskData);\r\n\t\t//\texistingTask.start_date = gantt.templates.parse_date(taskData.start_date);\r\n\t\t\t//if (existingTask.end_date && taskData.end_date) { \r\n\t\t\t//\texistingTask.end_date = gantt.templates.parse_date(taskData.end_date);\r\n\t\t\tif (!remoteTask.end_date) {\r\n\t\t\t\texistingTask.end_date = gantt.calculateEndDate(existingTask);\r\n\t\t\t}\r\n\r\n\t\t\tgantt.updateTask(sid);\r\n\r\n\t\t\tif (sid !== taskData.id) {\r\n\t\t\t\tgantt.changeTaskId(sid, taskData.id);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tfunction handleDeleteTask(taskData) {\r\n\t\tconst sid = taskData.id;\r\n\r\n\t\tif (!gantt.isTaskExists(sid)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tignore(() => {\r\n\t\t\tconst task = gantt.getTask(sid);\r\n\r\n\t\t\tif (task) {\r\n\t\t\t\t// handle unsaved edits in the lightbox\r\n\t\t\t\tif (gantt.getState().lightbox_id == sid) {\r\n\t\t\t\t\t//this._new_event = this._lightbox_id;\r\n\t\t\t\t\ttaskData.id = this._lightbox_id;\r\n\t\t\t\t\tlet currentTask = gantt.getTask(this._lightbox_id);\r\n\t\t\t\t\tcurrentTask = taskData;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// delete the task\r\n\t\t\t\tgantt.deleteTask(sid, true);\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tfunction handleAddLink(linkData) {\r\n\t\tif (gantt.isLinkExists(linkData.id)) {\r\n\t\t\t// eslint-disable-next-line no-console\r\n\t\t\tconsole.warn(`Link with ID ${linkData.id} already exists. Skipping add.`);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tignore(() => {\r\n\t\t\tgantt.addLink(linkData);\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tfunction handleUpdateLink(linkData) {\r\n\t\tconst sid = linkData.id;\r\n\r\n\t\tif (!gantt.isLinkExists(sid)) {\r\n\t\t\t// eslint-disable-next-line no-console\r\n\t\t\tconsole.warn(`Link with ID ${sid} does not exist. Skipping update.`);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst existingLink= gantt.getLink(sid);\r\n\r\n\t\tignore(() => {\r\n\t\t\tObject.assign(existingLink, linkData);\r\n\t\t\tgantt.updateLink(sid);\r\n\r\n\t\t\tif (sid !== linkData.id) {\r\n\t\t\t\tgantt.changeLinkId(sid, linkData.id);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tfunction handleDeleteLink(linkData) {\r\n\t\tconst sid = linkData.id;\r\n\r\n\t\tif (!gantt.getLink(sid)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tignore(() => {\r\n\t\t\tconst task = gantt.getLink(sid);\r\n\r\n\t\t\tif (task) {\r\n\t\t\t\t// handle unsaved edits in the lightbox\r\n\t\t\t\tif (gantt.getState().lightbox_id == sid) {\r\n\t\t\t\t\t//this._new_event = this._lightbox_id;\r\n\t\t\t\t\tlinkData.id = this._lightbox_id;\r\n\t\t\t\t\tlet currentTask = gantt.getLink(this._lightbox_id);\r\n\t\t\t\t\tcurrentTask = linkData;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// delete the link\r\n\t\t\t\tgantt.deleteLink(sid, true);\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t}\r\n\r\n\treturn {\r\n\t\ttasks: remoteUpdates,\r\n\t\tlinks: remoteUpdates\r\n\t};\r\n}\r\n\r\nexport default createHandlers;","import RemoteEvents from \"./remote_events\";\r\nimport createHandlers from \"./handlers\";\r\n\r\nexport default function remoteEvents(gantt) {\r\n\tif (!gantt.ext){\r\n\t\tgantt.ext = {};\r\n\t}\r\n\r\n\tgantt.ext.liveUpdates = {\r\n\t\tRemoteEvents,\r\n\t\tremoteUpdates: createHandlers(gantt)\r\n\t};\r\n}\r\n\r\n","export default function(gantt){\r\n\tfunction getDefaultAutoSchedulingConfig(){\r\n\t\treturn {\r\n\t\t\tenabled: false,\r\n\t\t\tapply_constraints: false,\r\n\t\t\tgap_behavior: \"preserve\",\r\n\t\t\tdescendant_links: false,\r\n\t\t\tschedule_on_parse: true,\r\n\t\t\tmove_projects: true,\r\n\t\t\tuse_progress: false,\r\n\r\n\t\t\tschedule_from_end: false,\r\n\t\t\tproject_constraint: false,\r\n\t\t\tshow_constraints: false\r\n\t\t};\r\n\t}\r\n\r\n\tfunction getAutoSchedulingConfig() {\r\n\t\tconst config = gantt.config;\r\n\r\n\t\t// if already using new-style object  return as is\r\n\t\tif (typeof config.auto_scheduling === \"object\") {\r\n\r\n\t\t\tconst schedulingConfig = {...getDefaultAutoSchedulingConfig(), ...config.auto_scheduling};\r\n\r\n\t\t\t// backward compatibility for {mode, strict, move_asap_tasks} properties\r\n\t\t\tif(schedulingConfig.mode){\r\n\t\t\t\tschedulingConfig.apply_constraints = schedulingConfig.mode === \"constraints\";\r\n\t\t\t\tdelete schedulingConfig.mode;\r\n\t\t\t}\r\n\r\n\t\t\tif(schedulingConfig.strict !== undefined){\r\n\t\t\t\tschedulingConfig.gap_behavior = schedulingConfig.strict ? \"compress\" : \"preserve\";\r\n\t\t\t\tdelete schedulingConfig.strict;\r\n\t\t\t}\r\n\r\n\t\t\tif(schedulingConfig.move_asap_tasks !== undefined){\r\n\t\t\t\tschedulingConfig.gap_behavior = schedulingConfig.move_asap_tasks ? \"compress\" : \"preserve\";\r\n\t\t\t\tdelete schedulingConfig.move_asap_tasks;\r\n\t\t\t}\r\n\t\t\treturn schedulingConfig;\r\n\t\t}\r\n\r\n\t\t// backward compatibility: build config from old flags\r\n\t\tconst enabled = !!config.auto_scheduling;\r\n\r\n\t\treturn {\r\n\t\t\t...getDefaultAutoSchedulingConfig(),\r\n\t\t\t...{\r\n\t\t\t\tenabled,\r\n\t\t\t\tapply_constraints: config.auto_scheduling_compatibility ?? false,\r\n\t\t\t\tgap_behavior: config.auto_scheduling_strict !== true ? \"preserve\" : \"compress\",\r\n\t\t\t\tdescendant_links: config.auto_scheduling_descendant_links ?? false,\r\n\t\t\t\tschedule_on_parse: config.auto_scheduling_initial ?? true,\r\n\t\t\t\tmove_projects: config.auto_scheduling_move_projects ?? true,\r\n\t\t\t\tuse_progress: config.auto_scheduling_use_progress ?? false,\r\n\r\n\t\t\t\tschedule_from_end: config.schedule_from_end ?? false,\r\n\t\t\t\tproject_constraint: config.auto_scheduling_project_constraint ?? false,\r\n\t\t\t\tshow_constraints: false\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\treturn {\r\n\t\tgetDefaultAutoSchedulingConfig,\r\n\t\tgetAutoSchedulingConfig\r\n\t};\r\n};","import batch_update from \"./batch_update\";\r\nimport wbs from \"./wbs\";\r\nimport resources from \"./resources\";\r\nimport resource_assignments from \"./resource_assignments\";\r\nimport new_task_placeholder from \"./new_task_placeholder\";\r\nimport auto_task_types from \"./auto_task_types\";\r\nimport formatters from \"./formatters\";\r\nimport empty_state_screen from \"./empty_state_screen\";\r\nimport baselines from \"./baselines\";\r\nimport remote_events from \"./remote_events/index\";\r\nimport auto_scheduling_config from \"./auto_scheduling_config\";\r\n\r\nexport default function(gantt){\r\n\tif(!gantt.ext){\r\n\t\tgantt.ext = {};\r\n\t}\r\n\r\n\tvar modules = [\r\n\t\tbatch_update,\r\n\t\twbs,\r\n\t\tresources,\r\n\t\tresource_assignments,\r\n\t\tnew_task_placeholder,\r\n\t\tauto_task_types,\r\n\t\tformatters,\r\n\t\tempty_state_screen,\r\n\t\tbaselines,\r\n\t\tremote_events\r\n\t];\r\n\r\n\tfor(var i = 0; i < modules.length; i++){\r\n\t\tif(modules[i])\r\n\t\t\tmodules[i](gantt);\r\n\t}\r\n\r\n\tconst { getAutoSchedulingConfig} = auto_scheduling_config(gantt);\r\n\tgantt._getAutoSchedulingConfig = getAutoSchedulingConfig;\r\n};","export default function(gantt) {\r\n\tgantt.getGridColumn = function(name) {\r\n\t\tvar columns = gantt.config.columns;\r\n\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tif (columns[i].name == name)\r\n\t\t\t\treturn columns[i];\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t};\r\n\r\n\tgantt.getGridColumns = function() {\r\n\t\treturn gantt.config.columns.slice();\r\n\t};\r\n};","export default function(gantt) {\r\n\tgantt.isReadonly = function (item) {\r\n\r\n\t\tif((typeof item == \"number\" || typeof item == \"string\") && gantt.isTaskExists(item)){\r\n\t\t\titem = gantt.getTask(item);\r\n\t\t}\r\n\t\tif (item && item[this.config.editable_property]) {\r\n\t\t\treturn false;\r\n\t\t} else {\r\n\t\t\treturn (item && item[this.config.readonly_property]) || this.config.readonly;\r\n\t\t}\r\n\t};\r\n};","import * as helpers from \"../../utils/helpers\";\r\n\r\nexport default function(gantt) {\r\n\tgantt.load = function(){\r\n\t\tthrow new Error(\"gantt.load() method is not available in the node.js, use gantt.parse() instead\");\r\n\t};\r\n\tgantt.parse = function (data, type) {\r\n\t\tthis.on_load({xmlDoc: {responseText: data}}, type);\r\n\t};\r\n\r\n\tgantt.serialize = function (type) {\r\n\t\ttype = type || \"json\";\r\n\t\treturn this[type].serialize();\r\n\t};\r\n\r\n\t/*\r\n\ttasks and relations\r\n\t{\r\n\tdata:[\r\n\t\t{\r\n\t\t\t\"id\":\"string\",\r\n\t\t\t\"text\":\"...\",\r\n\t\t\t\"start_date\":\"Date or string\",\r\n\t\t\t\"end_date\":\"Date or string\",\r\n\t\t\t\"duration\":\"number\",\r\n\t\t\t\"progress\":\"0..1\",\r\n\t\t\t\"parent_id\":\"string\",\r\n\t\t\t\"order\":\"number\"\r\n\t\t},...],\r\n\tlinks:[\r\n\t\t{\r\n\t\t\tid:\"string\",\r\n\t\t\tsource:\"string\",\r\n\t\t\ttarget:\"string\",\r\n\t\t\ttype:\"string\"\r\n\t\t},...],\r\n\tcollections:{\r\n\t\t\tcollectionName:[\r\n\t\t\t\t{key:, label:, optional:...},...\r\n\t\t\t],...\r\n\t\t}\r\n\t}\r\n\r\n\t* */\r\n\r\n\tgantt.on_load = function (resp, type) {\r\n\t\tif(resp.xmlDoc && resp.xmlDoc.status === 404){ // work if we don't have a file at current url\r\n\t\t\tthis.assert(false, \"Failed to load the data from <a href='\" + resp.xmlDoc.responseURL + \"' target='_blank'>\" \r\n\t\t\t\t+ resp.xmlDoc.responseURL + \"</a>, server returns 404\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(gantt.$destroyed){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.callEvent(\"onBeforeParse\", []);\r\n\t\tif (!type)\r\n\t\t\ttype = \"json\";\r\n\t\tthis.assert(this[type], \"Invalid data type:'\" + type + \"'\");\r\n\r\n\t\tvar raw = resp.xmlDoc.responseText;\r\n\r\n\t\tvar data = this[type].parse(raw, resp);\r\n\t\tthis._process_loading(data);\r\n\t};\r\n\r\n\tfunction attachAssignmentsToTasks(tasks, assignments) {\r\n\t\tconst assignmentsByTasks = {};\r\n\t\tassignments.forEach((a)=>{\r\n\t\t\tif(!assignmentsByTasks[a.task_id]) {\r\n\t\t\t\tassignmentsByTasks[a.task_id] = [];\r\n\t\t\t}\r\n\t\t\tassignmentsByTasks[a.task_id].push(a);\r\n\t\t});\r\n\t\ttasks.forEach((t) => {\r\n\t\t\tt[gantt.config.resource_property] = assignmentsByTasks[t.id] || [];\r\n\t\t});\t\r\n\t}\r\n\t\r\n\tgantt._process_loading = function (data) {\r\n\t\tif(data.collections)\r\n\t\t\tthis._load_collections(data.collections);\r\n\r\n\t\tif(data.resources && this.$data.resourcesStore){\r\n\t\t\tthis.$data.resourcesStore.parse(data.resources);\r\n\t\t}\r\n\t\tif(gantt.config.baselines && data.baselines && this.$data.baselineStore){\r\n\t\t\tthis.$data.baselineStore.parse(data.baselines);\r\n\t\t}\r\n\t\t\r\n\t\tconst tasks = data.data || data.tasks;\r\n\t\tif(data.assignments){\r\n\t\t\tattachAssignmentsToTasks(tasks && tasks.length ? tasks : gantt.getTasksByTime(), data.assignments);\r\n\t\t}\r\n\r\n\t\tif(tasks){\r\n\t\t\tthis.$data.tasksStore.parse(tasks);\r\n\t\t}\r\n\t\tvar links = data.links || ((data.collections && data.collections.links) ? data.collections.links : []);\r\n\t\tthis.$data.linksStore.parse(links);\r\n\r\n\t\t//this._sync_links();\r\n\t\tthis.callEvent(\"onParse\", []);\r\n\t\tthis.render();\r\n\t};\r\n\r\n\tgantt._load_collections = function (collections) {\r\n\t\tvar collections_loaded = false;\r\n\t\tfor (var key in collections) {\r\n\t\t\tif (collections.hasOwnProperty(key)) {\r\n\t\t\t\tcollections_loaded = true;\r\n\t\t\t\tvar collection = collections[key];\r\n\t\t\t\t// GS-1728. Create an empty serverList if it doesn't exist\r\n\t\t\t\tthis.serverList[key] = this.serverList[key] || [];\r\n\t\t\t\tvar arr = this.serverList[key];\r\n\t\t\t\tif (!arr) continue;\r\n\t\t\t\tarr.splice(0, arr.length); //clear old options\r\n\t\t\t\tfor (var j = 0; j < collection.length; j++) {\r\n\t\t\t\t\tvar option = collection[j];\r\n\t\t\t\t\tvar obj = this.copy(option);\r\n\t\t\t\t\tobj.key = obj.value;// resulting option object\r\n\r\n\t\t\t\t\tfor (var option_key in option) {\r\n\t\t\t\t\t\tif (option.hasOwnProperty(option_key)) {\r\n\t\t\t\t\t\t\tif (option_key == \"value\" || option_key == \"label\")\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\tobj[option_key] = option[option_key]; // obj['value'] = option['value']\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tarr.push(obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (collections_loaded)\r\n\t\t\tthis.callEvent(\"onOptionsLoad\", []);\r\n\t};\r\n\r\n\tgantt.attachEvent(\"onBeforeTaskDisplay\", function (id, task) {\r\n\t\treturn !task.$ignore;\r\n\t});\r\n\r\n\tfunction jsonParseError(data){\r\n\t\tgantt.assert(false, \"Can't parse data: incorrect value of gantt.parse or gantt.load method. \"\r\n\t\t\t+ \"Actual argument value: \" + JSON.stringify(data));\r\n\t\tthrow new Error(\"Invalid argument for gantt.parse or gantt.load. An object or a JSON string of format https://docs.dhtmlx.com/gantt/desktop__supported_data_formats.html#json is expected. Actual argument value: \"\r\n\t\t\t+ JSON.stringify(data));\r\n\t}\r\n\r\n\tgantt.json = {\r\n\t\tparse: function (data) {\r\n\t\t\tif(!data){\r\n\t\t\t\tjsonParseError(data);\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof data == \"string\") {\r\n\t\t\t\tif (typeof JSON != undefined){\r\n\t\t\t\t\ttry{\r\n\t\t\t\t\t\tdata = JSON.parse(data);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch(e) {\r\n\t\t\t\t\t\tjsonParseError(data);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tgantt.assert(false, \"JSON is not supported\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (data.dhx_security)\r\n\t\t\t\tgantt.security_key = data.dhx_security;\r\n\t\t\treturn data;\r\n\t\t},\r\n\t\tserializeTask: function (task) {\r\n\t\t\treturn this._copyObject(task);\r\n\t\t},\r\n\t\tserializeLink: function (link) {\r\n\t\t\treturn this._copyLink(link);\r\n\t\t},\r\n\t\t_copyLink: function (obj) {\r\n\t\t\tvar copy = {};\r\n\t\t\tfor (var key in obj)\r\n\t\t\t\tcopy[key] = obj[key];\r\n\t\t\treturn copy;\r\n\t\t},\r\n\t\t_copyObject: function (obj) {\r\n\t\t\tvar copy = {};\r\n\t\t\tfor (var key in obj) {\r\n\t\t\t\tif (key.charAt(0) == \"$\")\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\tcopy[key] = obj[key];\r\n\r\n\t\t\t\tif (helpers.isDate(copy[key])) {\r\n\t\t\t\t\tcopy[key] = gantt.defined(gantt.templates.xml_format) ? gantt.templates.xml_format(copy[key]) : gantt.templates.format_date(copy[key]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn copy;\r\n\t\t},\r\n\t\tserialize: function () {\r\n\t\t\tvar tasks = [];\r\n\t\t\tvar links = [];\r\n\t\t\tlet baselines = [];\r\n\r\n\t\t\tgantt.eachTask(function (obj) {\r\n\t\t\t\tgantt.resetProjectDates(obj);\r\n\t\t\t\ttasks.push(this.serializeTask(obj));\r\n\t\t\t}, gantt.config.root_id, this);\r\n\r\n\t\t\tvar rawLinks = gantt.getLinks();\r\n\t\t\tfor (var i = 0; i < rawLinks.length; i++) {\r\n\t\t\t\tlinks.push(this.serializeLink(rawLinks[i]));\r\n\t\t\t}\r\n\r\n\t\t\tconst baselineStore = gantt.getDatastore(\"baselines\");\r\n\t\t\tbaselineStore.eachItem(function(baseline){\r\n\t\t\t\tconst baselineCopy = gantt.json.serializeTask(baseline);\r\n\t\t\t\tbaselines.push(baselineCopy);\r\n\t\t\t});\r\n\r\n\t\t\treturn {\r\n\t\t\t\tdata: tasks,\r\n\t\t\t\tlinks,\r\n\t\t\t\tbaselines\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n\r\n\t/*\r\n\t<data>\r\n\t\t<task id:\"some\" parent_id=\"0\" progress=\"0.5\">\r\n\t\t\t<text>My task 1</text>\r\n\t\t\t<start_date>16.08.2013</start_date>\r\n\t\t\t<end_date>22.08.2013</end_date>\r\n\t\t</task>\r\n\t\t<coll_options>\r\n\t\t\t<links>\r\n\t\t\t\t<link source='a1' target='b2' type='c3' />\r\n\t\t\t</links>\r\n\t\t</coll_options>\r\n\t</data>\r\n\t*/\r\n\r\n\tfunction xmlParseError(data){\r\n\t\tgantt.assert(false, \"Can't parse data: incorrect value of gantt.parse or gantt.load method. \"\r\n\t\t\t+ \"Actual argument value: \" + JSON.stringify(data));\r\n\t\tthrow new Error(\"Invalid argument for gantt.parse or gantt.load. An XML of format https://docs.dhtmlx.com/gantt/desktop__supported_data_formats.html#xmldhtmlxgantt20 is expected. Actual argument value: \"\r\n\t\t\t+ JSON.stringify(data));\r\n\t}\r\n\r\n\tgantt.xml = {\r\n\t\t_xmlNodeToJSON: function (node, attrs_only) {\r\n\t\t\tvar t = {};\r\n\t\t\tfor (var i = 0; i < node.attributes.length; i++)\r\n\t\t\t\tt[node.attributes[i].name] = node.attributes[i].value;\r\n\r\n\t\t\tif (!attrs_only) {\r\n\t\t\t\tfor (var i = 0; i < node.childNodes.length; i++) {\r\n\t\t\t\t\tvar child = node.childNodes[i];\r\n\t\t\t\t\tif (child.nodeType == 1)\r\n\t\t\t\t\t\tt[child.tagName] = child.firstChild ? child.firstChild.nodeValue : \"\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!t.text) t.text = node.firstChild ? node.firstChild.nodeValue : \"\";\r\n\t\t\t}\r\n\r\n\t\t\treturn t;\r\n\t\t},\r\n\t\t_getCollections: function (loader) {\r\n\t\t\tvar collection = {};\r\n\t\t\tvar opts = gantt.ajax.xpath(\"//coll_options\", loader);\r\n\t\t\tfor (var i = 0; i < opts.length; i++) {\r\n\t\t\t\tvar bind = opts[i].getAttribute(\"for\");\r\n\t\t\t\tvar arr = collection[bind] = [];\r\n\t\t\t\tvar itms = gantt.ajax.xpath(\".//item\", opts[i]);\r\n\t\t\t\tfor (var j = 0; j < itms.length; j++) {\r\n\t\t\t\t\tvar itm = itms[j];\r\n\t\t\t\t\tvar attrs = itm.attributes;\r\n\t\t\t\t\tvar obj = {key: itms[j].getAttribute(\"value\"), label: itms[j].getAttribute(\"label\")};\r\n\t\t\t\t\tfor (var k = 0; k < attrs.length; k++) {\r\n\t\t\t\t\t\tvar attr = attrs[k];\r\n\t\t\t\t\t\tif (attr.nodeName == \"value\" || attr.nodeName == \"label\")\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\tobj[attr.nodeName] = attr.nodeValue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tarr.push(obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn collection;\r\n\t\t},\r\n\t\t_getXML: function (text, loader, toptag) {\r\n\t\t\ttoptag = toptag || \"data\";\r\n\t\t\tif (!loader.getXMLTopNode) {\r\n\t\t\t\tloader = gantt.ajax.parse(loader);\r\n\t\t\t}\r\n\r\n\t\t\tvar xml = gantt.ajax.xmltop(toptag, loader.xmlDoc);\r\n\t\t\tif (!xml || xml.tagName != toptag) {\r\n\t\t\t\txmlParseError(text);\r\n\t\t\t}\r\n\r\n\t\t\tvar skey = xml.getAttribute(\"dhx_security\");\r\n\t\t\tif (skey)\r\n\t\t\t\tgantt.security_key = skey;\r\n\r\n\t\t\treturn xml;\r\n\t\t},\r\n\t\tparse: function (text, loader) {\r\n\t\t\tloader = this._getXML(text, loader);\r\n\t\t\tvar data = {};\r\n\r\n\t\t\tvar evs = data.data = [];\r\n\t\t\tvar xml = gantt.ajax.xpath(\"//task\", loader);\r\n\r\n\t\t\tfor (var i = 0; i < xml.length; i++)\r\n\t\t\t\tevs[i] = this._xmlNodeToJSON(xml[i]);\r\n\r\n\t\t\tdata.collections = this._getCollections(loader);\r\n\t\t\treturn data;\r\n\t\t},\r\n\t\t_copyLink: function (obj) {\r\n\t\t\treturn \"<item id='\" + obj.id + \"' source='\" + obj.source + \"' target='\" + obj.target + \"' type='\" + obj.type + \"' />\";\r\n\t\t},\r\n\t\t_copyObject: function (obj) {\r\n\t\t\treturn \"<task id='\" + obj.id + \"' parent='\" + (obj.parent || \"\") + \"' start_date='\" + obj.start_date + \"' duration='\" + obj.duration + \"' open='\" + (!!obj.open) + \"' progress='\" + obj.progress + \"' end_date='\" + obj.end_date + \"'><![CDATA[\" + obj.text + \"]]></task>\";\r\n\t\t},\r\n\t\tserialize: function () {\r\n\t\t\tvar tasks = [];\r\n\t\t\tvar links = [];\r\n\r\n\t\t\tvar json = gantt.json.serialize();\r\n\t\t\tfor (var i = 0, len = json.data.length; i < len; i++) {\r\n\t\t\t\ttasks.push(this._copyObject(json.data[i]));\r\n\t\t\t}\r\n\t\t\tfor (var i = 0, len = json.links.length; i < len; i++) {\r\n\t\t\t\tlinks.push(this._copyLink(json.links[i]));\r\n\t\t\t}\r\n\t\t\treturn \"<data>\" + tasks.join(\"\") + \"<coll_options for='links'>\" + links.join(\"\") + \"</coll_options></data>\";\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tgantt.oldxml = {\r\n\t\tparse: function (text, loader) {\r\n\t\t\tloader = gantt.xml._getXML(text, loader, \"projects\");\r\n\t\t\tvar data = {collections: {links: []}};\r\n\r\n\t\t\tvar evs = data.data = [];\r\n\t\t\tvar xml = gantt.ajax.xpath(\"//task\", loader);\r\n\r\n\t\t\tfor (var i = 0; i < xml.length; i++) {\r\n\t\t\t\tevs[i] = gantt.xml._xmlNodeToJSON(xml[i]);\r\n\t\t\t\tvar parent = xml[i].parentNode;\r\n\r\n\t\t\t\tif (parent.tagName == \"project\")\r\n\t\t\t\t\tevs[i].parent = \"project-\" + parent.getAttribute(\"id\");\r\n\t\t\t\telse\r\n\t\t\t\t\tevs[i].parent = parent.parentNode.getAttribute(\"id\");\r\n\t\t\t}\r\n\r\n\t\t\txml = gantt.ajax.xpath(\"//project\", loader);\r\n\t\t\tfor (var i = 0; i < xml.length; i++) {\r\n\t\t\t\tvar ev = gantt.xml._xmlNodeToJSON(xml[i], true);\r\n\t\t\t\tev.id = \"project-\" + ev.id;\r\n\t\t\t\tevs.push(ev);\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0; i < evs.length; i++) {\r\n\t\t\t\tvar ev = evs[i];\r\n\t\t\t\tev.start_date = ev.startdate || ev.est;\r\n\t\t\t\tev.end_date = ev.enddate;\r\n\t\t\t\tev.text = ev.name;\r\n\t\t\t\tev.duration = ev.duration / 8;\r\n\t\t\t\tev.open = 1;\r\n\t\t\t\tif (!ev.duration && !ev.end_date) ev.duration = 1;\r\n\t\t\t\tif (ev.predecessortasks)\r\n\t\t\t\t\tdata.collections.links.push({\r\n\t\t\t\t\t\ttarget: ev.id,\r\n\t\t\t\t\t\tsource: ev.predecessortasks,\r\n\t\t\t\t\t\ttype: gantt.config.links.finish_to_start\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\t\t},\r\n\t\tserialize: function () {\r\n\t\t\tgantt.message(\"Serialization to 'old XML' is not implemented\");\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.serverList = function (name, array) {\r\n\t\tif (array) {\r\n\t\t\tthis.serverList[name] = array.slice(0);\r\n\t\t} else if (!this.serverList[name]) {\r\n\t\t\tthis.serverList[name] = [];\r\n\t\t}\r\n\t\treturn this.serverList[name];\r\n\t};\r\n\r\n};","import * as utils from \"../../utils/utils\";\r\nimport * as helpers from \"../../utils/helpers\";\r\n\r\n\r\nfunction IsWorkTimeArgument(date, unit, task, id, calendar){\r\n\tthis.date = date;\r\n\tthis.unit = unit;\r\n\tthis.task = task;\r\n\tthis.id = id;\r\n\tthis.calendar = calendar;\r\n\treturn this;\r\n}\r\n\r\nfunction ClosestWorkTimeArgument(date, dir, unit, task, id, calendar){\r\n\tthis.date = date;\r\n\tthis.dir = dir;\r\n\tthis.unit = unit;\r\n\tthis.task = task;\r\n\tthis.id = id;\r\n\tthis.calendar = calendar;\r\n\treturn this;\r\n}\r\n\r\nfunction CalculateEndDateArgument(start_date, duration, unit, step, task, id, calendar){\r\n\tthis.start_date = start_date;\r\n\tthis.duration = duration;\r\n\tthis.unit = unit;\r\n\tthis.step = step;\r\n\tthis.task = task;\r\n\tthis.id = id;\r\n\tthis.calendar = calendar;\r\n\treturn this;\r\n}\r\n\r\nfunction GetDurationArgument(start, end, task, calendar) {\r\n\tthis.start_date = start;\r\n\tthis.end_date = end;\r\n\tthis.task = task;\r\n\tthis.calendar = calendar;\r\n\tthis.unit = null;\r\n\tthis.step = null;\r\n\treturn this;\r\n}\r\n\r\nvar calendarArgumentsHelper = function(gantt){\r\n\treturn {\r\n\t\tgetWorkHoursArguments: function () {\r\n\t\t\tvar config = arguments[0];\r\n\t\t\tif (helpers.isDate(config)) {\r\n\t\t\t\tconfig = {\r\n\t\t\t\t\tdate: config\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\tconfig = utils.mixin({}, config);\r\n\t\t\t}\r\n\r\n\t\t\tif(!helpers.isValidDate(config.date)){\r\n\t\t\t\tgantt.assert(false, \"Invalid date argument for getWorkHours method\");\r\n\t\t\t\tthrow new Error(\"Invalid date argument for getWorkHours method\");\r\n\t\t\t}\r\n\r\n\t\t\treturn config;\r\n\t\t},\r\n\t\tsetWorkTimeArguments: function () {\r\n\t\t\treturn arguments[0];\r\n\t\t},\r\n\t\tunsetWorkTimeArguments: function () {\r\n\t\t\treturn arguments[0];\r\n\t\t},\r\n\t\tisWorkTimeArguments: function () {\r\n\t\t\tvar config = arguments[0];\r\n\t\t\tif(config instanceof IsWorkTimeArgument){\r\n\t\t\t\treturn config;\r\n\t\t\t}\r\n\r\n\t\t\tvar processedConfig;\r\n\t\t\tif (!config.date) {\r\n\t\t\t\t//IsWorkTimeArgument(date, unit, task, id, calendar)\r\n\t\t\t\tprocessedConfig = new IsWorkTimeArgument(arguments[0], arguments[1], arguments[2], null, arguments[3]);\r\n\t\t\t} else {\r\n\t\t\t\tprocessedConfig = new IsWorkTimeArgument(config.date, config.unit, config.task, null, config.calendar);\r\n\t\t\t}\r\n\r\n\t\t\tprocessedConfig.unit = processedConfig.unit || gantt.config.duration_unit;\r\n\r\n\t\t\tif(!helpers.isValidDate(processedConfig.date)){\r\n\t\t\t\tgantt.assert(false, \"Invalid date argument for isWorkTime method\");\r\n\t\t\t\tthrow new Error(\"Invalid date argument for isWorkTime method\");\r\n\t\t\t}\r\n\r\n\t\t\treturn processedConfig;\r\n\t\t},\r\n\t\tgetClosestWorkTimeArguments: function (arg) {\r\n\t\t\tvar config = arguments[0];\r\n\t\t\tif (config instanceof ClosestWorkTimeArgument)\r\n\t\t\t\treturn config;\r\n\r\n\t\t\tvar processedConfig;\r\n\t\t\tif (helpers.isDate(config)) {\r\n\t\t\t\tprocessedConfig = new ClosestWorkTimeArgument(config);\r\n\r\n\t\t\t} else {\r\n\t\t\t\tprocessedConfig = new ClosestWorkTimeArgument(\r\n\t\t\t\t\tconfig.date,\r\n\t\t\t\t\tconfig.dir,\r\n\t\t\t\t\tconfig.unit,\r\n\t\t\t\t\tconfig.task,\r\n\t\t\t\t\tnull,//config.id,\r\n\t\t\t\t\tconfig.calendar\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tif(config.id){\r\n\t\t\t\tprocessedConfig.task = config;\r\n\t\t\t}\r\n\t\t\tprocessedConfig.dir = config.dir || 'any';\r\n\t\t\tprocessedConfig.unit = config.unit || gantt.config.duration_unit;\r\n\r\n\t\t\tif(!helpers.isValidDate(processedConfig.date)){\r\n\t\t\t\tgantt.assert(false, \"Invalid date argument for getClosestWorkTime method\");\r\n\t\t\t\tthrow new Error(\"Invalid date argument for getClosestWorkTime method\");\r\n\t\t\t}\r\n\t\t\treturn processedConfig;\r\n\t\t},\r\n\r\n\t\t_getStartEndConfig: function (param) {\r\n\t\t\tvar argumentType = GetDurationArgument;\r\n\t\t\tvar config;\r\n\t\t\tif (param instanceof argumentType)\r\n\t\t\t\treturn param;\r\n\r\n\t\t\tif (helpers.isDate(param)) {\r\n\t\t\t\tconfig = new argumentType(arguments[0], arguments[1], arguments[2], arguments[3]);\r\n\t\t\t} else {\r\n\t\t\t\tconfig = new argumentType(param.start_date, param.end_date, param.task);\r\n\t\t\t\tif (param.id !== null && param.id !== undefined) {\r\n\t\t\t\t\tconfig.task = param;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconfig.unit = config.unit || gantt.config.duration_unit;\r\n\t\t\tconfig.step = config.step || gantt.config.duration_step;\r\n\t\t\tconfig.start_date = config.start_date || config.start || config.date;\r\n\r\n\t\t\tif(!helpers.isValidDate(config.start_date)){\r\n\t\t\t\tgantt.assert(false, \"Invalid start_date argument for getDuration method\");\r\n\t\t\t\tthrow new Error(\"Invalid start_date argument for getDuration method\");\r\n\t\t\t}\r\n\r\n\t\t\tif(!helpers.isValidDate(config.end_date)){\r\n\t\t\t\tgantt.assert(false, \"Invalid end_date argument for getDuration method\");\r\n\t\t\t\tthrow new Error(\"Invalid end_date argument for getDuration method\");\r\n\t\t\t}\r\n\r\n\t\t\treturn config;\r\n\t\t},\r\n\r\n\t\tgetDurationArguments: function (start, end, unit, step) {\r\n\t\t\treturn this._getStartEndConfig.apply(this, arguments);\r\n\t\t},\r\n\r\n\t\thasDurationArguments: function (start, end, unit, step) {\r\n\t\t\treturn this._getStartEndConfig.apply(this, arguments);\r\n\t\t},\r\n\r\n\t\tcalculateEndDateArguments: function (start, duration, unit, step) {\r\n\t\t\tvar config = arguments[0];\r\n\t\t\tif (config instanceof CalculateEndDateArgument)\r\n\t\t\t\treturn config;\r\n\r\n\t\t\tvar processedConfig;\r\n\t\t\t//CalculateEndDateArgument(start_date, duration, unit, step, task, id, calendar)\r\n\t\t\tif (helpers.isDate(config)) {\r\n\t\t\t\tprocessedConfig = new CalculateEndDateArgument(\r\n\t\t\t\t\targuments[0],\r\n\t\t\t\t\targuments[1],\r\n\t\t\t\t\targuments[2],\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\targuments[3],\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\targuments[4]\r\n\t\t\t\t);\r\n\r\n\t\t\t} else {\r\n\t\t\t\tprocessedConfig = new CalculateEndDateArgument(\r\n\t\t\t\t\tconfig.start_date,\r\n\t\t\t\t\tconfig.duration,\r\n\t\t\t\t\tconfig.unit,\r\n\t\t\t\t\tconfig.step,\r\n\t\t\t\t\tconfig.task,\r\n\t\t\t\t\tnull,//config.id,\r\n\t\t\t\t\tconfig.calendar\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tif(config.id !== null && config.id !== undefined){\r\n\t\t\t\tprocessedConfig.task = config;\r\n\r\n\t\t\t\t// received a task object as an argument\r\n\t\t\t\t// ignore 'unit' and 'step' properties in this case, since it's likely a part of data model of a task\r\n\t\t\t\tprocessedConfig.unit = null;\r\n\t\t\t\tprocessedConfig.step = null;\r\n\t\t\t}\r\n\r\n\t\t\tprocessedConfig.unit = processedConfig.unit || gantt.config.duration_unit;\r\n\t\t\tprocessedConfig.step = processedConfig.step || gantt.config.duration_step;\r\n\r\n\t\t\tif(!helpers.isValidDate(processedConfig.start_date)){\r\n\t\t\t\tgantt.assert(false, \"Invalid start_date argument for calculateEndDate method\");\r\n\t\t\t\tthrow new Error(\"Invalid start_date argument for calculateEndDate method\");\r\n\t\t\t}\r\n\r\n\t\t\treturn processedConfig;\r\n\t\t}\r\n\t};\r\n};\r\n\r\n\r\nexport default calendarArgumentsHelper;","import * as utils from \"../../../utils/utils\";\r\nfunction WorkTimeCalendarMerger(){\r\n}\r\n\r\nWorkTimeCalendarMerger.prototype = {\r\n\r\n\r\n\t/**\r\n\t * convert hours array items into objects, e.g. [8, 12, 17, 18] -> [{start: 8, end: 12}, {start:17, end:18}]\r\n\t * @param {Array} hoursArray\r\n\t */\r\n\t_getIntervals: function(hoursArray){\r\n\t\tvar result = [];\r\n\t\tfor(var i = 0; i < hoursArray.length; i += 2){\r\n\r\n\t\t\tresult.push({\r\n\t\t\t\tstart: hoursArray[i],\r\n\t\t\t\tend: hoursArray[i+1]\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/**\r\n\t * Convert ranges config into hours array\r\n\t * [{start: 8, end: 12}, {start:17, end:18}] --> [8, 12, 17, 18]\r\n\t * @param {*} intervalsArray\r\n\t */\r\n\t_toHoursArray: function(intervalsArray){\r\n\t\tvar result = [];\r\n\r\n\t\tfunction toFixed(value){\r\n\t\t\tvar str = String(value);\r\n\t\t\tif(str.length < 2){\r\n\t\t\t\tstr = \"0\" + str;\r\n\t\t\t}\r\n\t\t\treturn str;\r\n\t\t}\r\n\t\tfunction formatHHMM(secondsValue){\r\n\t\t\tvar hours = Math.floor(secondsValue / (60*60));\r\n\t\t\tvar minutePart = secondsValue - hours * 60 * 60;\r\n\r\n\t\t\tvar minutes = Math.floor(minutePart / (60));\r\n\t\t\treturn hours + \":\" + toFixed(minutes);\r\n\t\t}\r\n\t\tfor(var i = 0; i < intervalsArray.length; i++){\r\n\t\t\tresult.push(\r\n\t\t\t\tformatHHMM(intervalsArray[i].start) +\r\n\t\t\t\t\"-\" +\r\n\t\t\t\tformatHHMM(intervalsArray[i].end)\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/**\r\n\t * Build intersection of hour intervals. e.g.\r\n\t * first: [{start: 8, end: 12}, {start:13, end:18}]\r\n\t * second: [{start: 10, end: 15}]\r\n\t * result: [{start: 10, end: 12}, {start: 13, end: 15}]\r\n\t * @param {Array} first\r\n\t * @param {Array} second\r\n\t */\r\n\t_intersectHourRanges: function(first, second){\r\n\t\tvar result = [];\r\n\r\n\t\tvar baseArray = first.length > second.length ? first : second;\r\n\t\tvar overridesArray = first === baseArray ? second: first;\r\n\t\tbaseArray = baseArray.slice();\r\n\t\toverridesArray = overridesArray.slice();\r\n\r\n\t\tvar result = [];\r\n\t\tfor(var i = 0; i < baseArray.length; i++){\r\n\t\t\tvar base = baseArray[i];\r\n\r\n\t\t\tfor(var j = 0; j < overridesArray.length; j++){\r\n\t\t\t\tvar current = overridesArray[j];\r\n\t\t\t\tif(current.start < base.end && current.end > base.start){\r\n\t\t\t\t\tresult.push({\r\n\t\t\t\t\t\tstart: Math.max(base.start, current.start),\r\n\t\t\t\t\t\tend: Math.min(base.end, current.end)\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif(base.end > current.end){\r\n\t\t\t\t\t\toverridesArray.splice(j, 1);\r\n\t\t\t\t\t\tj--;\r\n\t\t\t\t\t\ti--;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/**\r\n\t * Reduce the number of ranges in config when possible,\r\n\t * joins ranges that can be merged\r\n\t * parts: [{start: 8, end: 12}, {start:12, end:13}, {start: 15, end: 17}]\r\n\t * result: [{start: 8, end: 13}, {start: 15, end: 17}]\r\n\t * @param {Array} parts\r\n\t */\r\n\t_mergeAdjacentIntervals: function(parts){\r\n\t\tvar result = parts.slice();\r\n\t\tresult.sort(function(a, b){\r\n\t\t\treturn a.start - b.start;\r\n\t\t});\r\n\t\tvar base = result[0];\r\n\t\tfor(var i = 1; i < result.length; i++){\r\n\t\t\tvar current = result[i];\r\n\t\t\tif(current.start <= base.end){\r\n\t\t\t\tif(current.end > base.end){\r\n\t\t\t\t\tbase.end = current.end;\r\n\t\t\t\t}\r\n\t\t\t\tresult.splice(i, 1);\r\n\t\t\t\ti--;\r\n\t\t\t}else{\r\n\t\t\t\tbase = current;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t_mergeHoursConfig: function(firstHours, secondHours){\r\n\t\t//var firstIntervals = this._getIntervals(firstHours);\r\n\t\t//var secondIntervals = this._getIntervals(secondHours);\r\n\r\n\t\treturn this._mergeAdjacentIntervals(\r\n\t\t\tthis._intersectHourRanges(firstHours, secondHours)\r\n\t\t);\r\n\t},\r\n\r\n\tmerge: function(first, second){\r\n\t\tconst firstCalendar = utils.copy(first.getConfig());\r\n\t\tconst secondCalendar = utils.copy(second.getConfig());\r\n\r\n\t\tconst firstConfig = firstCalendar.parsed;\r\n\t\tconst secondConfig = secondCalendar.parsed;\r\n\r\n\t\t// GS-2101. The customWeeks config shouldn't have parsed values as we'll parse them later\r\n\t\tfirstConfig.customWeeks = firstCalendar.customWeeks;\r\n\t\tsecondConfig.customWeeks = secondCalendar.customWeeks;\r\n\r\n\t\tvar mergedSettings = {\r\n\t\t\thours: this._toHoursArray(this._mergeHoursConfig(firstConfig.hours, secondConfig.hours)),\r\n\t\t\tdates: {},\r\n\t\t\tcustomWeeks: {}\r\n\t\t};\r\n\r\n\t\tconst processCalendar = (config1, config2) => {\r\n\t\t\tfor (let i in config1.dates) {\r\n\t\t\t\tconst date1 = config1.dates[i];\r\n\t\r\n\t\t\t\t// dates contain day-of-week rules [0-7] and rules for specific dates (js date timestamps) - set false date rules initially\r\n\t\t\t\tif (+i > 1000) {\r\n\t\t\t\t\tmergedSettings.dates[i] = false;\r\n\t\t\t\t}\r\n\t\t\t\t// Check if the key exists in the fisrt calendar object\r\n\t\t\t\tfor (const key in config2.dates) {\r\n\t\t\t\t\tconst date2 = config2.dates[key];\r\n\t\r\n\t\t\t\t\t// Logical AND for week days\r\n\t\t\t\t\tif (key == i) {\r\n\t\t\t\t\t\tmergedSettings.dates[i] = !!(date1 && date2);\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t// Handle case where dates are arrays\r\n\t\t\t\t\tif (Array.isArray(date1)) {\r\n\t\t\t\t\t\tconst hours2 = Array.isArray(date2) ? date2 : config2.hours;\r\n\t\t\t\t\t\tmergedSettings.dates[i] = this._toHoursArray(this._mergeHoursConfig(date1, hours2));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\r\n\t\t// Check both calendars\r\n\t\tprocessCalendar(firstConfig, secondConfig);\r\n\t\tprocessCalendar(secondConfig, firstConfig);\r\n\r\n\t\t// transfer and overwrite custom week calendars\r\n\t\tif(firstConfig.customWeeks){\r\n\t\t\tfor(var i in firstConfig.customWeeks){\r\n\t\t\t\tmergedSettings.customWeeks[i] = firstConfig.customWeeks[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(secondConfig.customWeeks){\r\n\t\t\tfor(var i in secondConfig.customWeeks){\r\n\t\t\t\t// GS-2101. If both calendars have the same name for a period, we need to rename it\r\n\t\t\t\tif (mergedSettings.customWeeks[i]){\r\n\t\t\t\t\tmergedSettings.customWeeks[i + \"_second\"] = secondConfig.customWeeks[i];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmergedSettings.customWeeks[i] = secondConfig.customWeeks[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn mergedSettings;\r\n\r\n\t}\r\n\r\n};\r\n\r\nexport default WorkTimeCalendarMerger;","\r\n\r\nimport { IWorkUnitCache } from \"./workunit_cache_interface\";\r\n\r\nexport class WorkUnitsMapCache implements IWorkUnitCache {\r\n\tprivate _cache: Map<string, Array<Map<string, boolean>>>;\r\n\tconstructor() {\r\n\t\tthis.clear();\r\n\t}\r\n\r\n\tgetItem(unit: string, timestamp: string, value: Date): number|boolean {\r\n\t\tif (this._cache.has(unit)) {\r\n\t\t\tconst unitCache = this._cache.get(unit);\r\n\r\n\t\t\tconst subCache = unitCache[value.getFullYear()];\r\n\t\t\tif (subCache && subCache.has(timestamp)) {\r\n\t\t\t\treturn subCache.get(timestamp);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn -1;\r\n\t}\r\n\tsetItem(unit: string, timestamp: string, value: boolean, rawValue: Date): void {\r\n\t\tif (!unit || !timestamp) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst cache = this._cache;\r\n\t\tconst year = rawValue.getFullYear();\r\n\r\n\t\tlet unitCache;\r\n\t\tif (!cache.has(unit)) {\r\n\t\t\tunitCache = [];\r\n\t\t\tcache.set(unit, unitCache);\r\n\t\t} else {\r\n\t\t\tunitCache = cache.get(unit);\r\n\t\t}\r\n\r\n\t\tlet yearCache = unitCache[year];\r\n\t\tif(!yearCache){\r\n\t\t\tyearCache = unitCache[year] = new Map<string, boolean>();\r\n\t\t}\r\n\r\n\r\n\t\tyearCache.set(timestamp, value);\r\n\t}\r\n\tclear(): void{\r\n\t\tthis._cache = new Map<string, Array<Map<string, boolean>>>();\r\n\t}\r\n}","import { IWorkUnitCache } from \"./workunit_cache_interface\";\r\n\r\nexport class WorkUnitsObjectCache implements IWorkUnitCache {\r\n\tprivate _cache: any;\r\n\tconstructor() {\r\n\t\tthis.clear();\r\n\t}\r\n\r\n\tgetItem(unit: string, timestamp: string, value: Date): number|boolean {\r\n\t\tconst cache = this._cache;\r\n\t\tif (cache && cache[unit]) {\r\n\t\t\tconst units = cache[unit];\r\n\t\t\tif(units === undefined){\r\n\t\t\t\treturn -1;\r\n\t\t\t}\r\n\t\t\tconst subCache = units[value.getFullYear()];\r\n\t\t\tif (subCache && subCache[timestamp] !== undefined) {\r\n\t\t\t\treturn subCache[timestamp];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn -1;\r\n\t}\r\n\tsetItem(unit: string, timestamp: string, value: boolean, rawValue: Date): void {\r\n\t\tif (!unit || !timestamp) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst cache = this._cache;\r\n\r\n\t\tif (!cache) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!cache[unit]) {\r\n\t\t\tcache[unit] = [];\r\n\t\t}\r\n\t\tconst unitCache = cache[unit];\r\n\r\n\t\tconst year = rawValue.getFullYear();\r\n\t\tlet yearCache = unitCache[year];\r\n\t\tif(!yearCache){\r\n\t\t\tyearCache = unitCache[year] = {};\r\n\t\t}\r\n\t\tyearCache[timestamp] = value;\r\n\t}\r\n\tclear(): void{\r\n\t\tthis._cache = {};\r\n\t}\r\n}","\r\n\r\nexport class LargerUnitsCache {\r\n\tprivate _weekCache: Map<number, number>;\r\n\tprivate _monthCache: Map<number, number>;\r\n\tprivate _calendar: any;\r\n\tconstructor(calendar) {\r\n\t\tthis.clear();\r\n\t\tthis._calendar = calendar;\r\n\t}\r\n\r\n\tgetMinutesPerWeek = (weekStart: Date) => {\r\n\t\tconst key = weekStart.valueOf();\r\n\r\n\t\tif(this._weekCache.has(key)){\r\n\t\t\treturn this._weekCache.get(key);\r\n\t\t}\r\n\r\n\t\tconst calendar = this._calendar;\r\n\t\tconst gantt = this._calendar.$gantt;\r\n\r\n\t\tlet minutesPerWeek = 0;\r\n\t\tlet start = gantt.date.week_start(new Date(weekStart));\r\n\t\tfor(let i = 0; i < 7; i++){\r\n\t\t\tminutesPerWeek += calendar.getHoursPerDay(start) * 60;\r\n\t\t\tstart = gantt.date.add(start, 1, \"day\");\r\n\t\t}\r\n\r\n\t\tthis._weekCache.set(key, minutesPerWeek);\r\n\t\treturn minutesPerWeek;\r\n\t};\r\n\r\n\tgetMinutesPerMonth = (monthStart: Date) => {\r\n\t\tconst key = monthStart.valueOf();\r\n\r\n\t\tif(this._monthCache.has(key)){\r\n\t\t\treturn this._monthCache.get(key);\r\n\t\t}\r\n\r\n\t\tconst calendar = this._calendar;\r\n\t\tconst gantt = this._calendar.$gantt;\r\n\r\n\t\tlet minutesPerMonth = 0;\r\n\t\tlet start = gantt.date.week_start(new Date(monthStart));\r\n\t\tconst nextMonth = gantt.date.add(start, 1, \"month\").valueOf();\r\n\t\twhile(start.valueOf() < nextMonth){\r\n\t\t\tminutesPerMonth += calendar.getHoursPerDay(start) * 60;\r\n\t\t\tstart = gantt.date.add(start, 1, \"day\");\r\n\t\t}\r\n\r\n\t\tthis._monthCache.set(key, minutesPerMonth);\r\n\t\treturn minutesPerMonth;\r\n\t};\r\n\r\n\tclear = (): void => {\r\n\t\tthis._weekCache = new Map<number, number>();\r\n\t\tthis._monthCache = new Map<number, number>();\r\n\t};\r\n}","import { IWorkUnitCache } from \"./workunit_cache_interface\";\r\nimport { WorkUnitsMapCache } from \"./workunit_map_cache\";\r\nimport { WorkUnitsObjectCache } from \"./workunit_object_cache\";\r\nexport { LargerUnitsCache } from \"./larger_units_helper\";\r\n\r\nexport function createCacheObject(): IWorkUnitCache {\r\n\r\n\t// worktime hash is on the hot path,\r\n\t// Map seems to work faster than plain array, use it whenever possible\r\n\tif (typeof Map !== \"undefined\") {\r\n\t\treturn new WorkUnitsMapCache();\r\n\t} else {\r\n\t\treturn new WorkUnitsObjectCache();\r\n\t}\r\n}\r\n","export class DateDurationCache  {\r\n\tprivate _cache: any;\r\n\tconstructor() {\r\n\t\tthis.clear();\r\n\t}\r\n\r\n\t_getCacheObject(startDate: Date, unit: string, step:number){\r\n\t\tconst cache = this._cache;\r\n\t\tif (!cache[unit]) {\r\n\t\t\tcache[unit] = [];\r\n\t\t}\r\n\t\tlet unitCache = cache[unit];\r\n\t\tif(!unitCache) {\r\n\t\t\tunitCache = cache[unit] = {};\r\n\t\t}\r\n\r\n\t\tlet stepCache = unitCache[step];\r\n\t\tif(!stepCache) {\r\n\t\t\tstepCache = unitCache[step] = {};\r\n\t\t}\r\n\r\n\t\tconst year = startDate.getFullYear();\r\n\t\tlet yearCache = stepCache[year];\r\n\t\tif(!yearCache){\r\n\t\t\tyearCache = stepCache[year] = {durations: {}, endDates: {}};\r\n\t\t}\r\n\r\n\t\treturn yearCache;\r\n\t}\r\n\t_endDateCacheKey(startDate: number, duration: number){\r\n\t\treturn String(startDate) + \"-\" + String(duration);\r\n\t}\r\n\t_durationCacheKey(startDate: number, endDate: number){\r\n\t\treturn String(startDate) + \"-\" + String(endDate);\r\n\t}\r\n\tgetEndDate(startDate: Date, duration: number, unit: string, step: number, compute: () => Date): number|null{\r\n\t\tconst cache = this._getCacheObject(startDate, unit, step);\r\n\r\n\t\tconst startDateTimestamp = startDate.valueOf();\r\n\t\tconst key = this._endDateCacheKey(startDateTimestamp, duration);\r\n\t\tlet endDate;\r\n\t\tif(cache.endDates[key] === undefined){\r\n\t\t\tconst result = compute();\r\n\t\t\tconst resultTimestamp = result.valueOf();\r\n\t\t\tcache.endDates[key] = resultTimestamp;\r\n\t\t\tcache.durations[this._durationCacheKey(startDateTimestamp, resultTimestamp)] = duration;\r\n\t\t\tendDate = result;\r\n\t\t}else{\r\n\t\t\tendDate = new Date(cache.endDates[key]);\r\n\t\t}\r\n\r\n\t\treturn endDate;\r\n\t}\r\n\r\n\tgetDuration(startDate: Date, endDate: Date, unit: string, step: number, compute: () => number): number|null{\r\n\t\tconst cache = this._getCacheObject(startDate, unit, step);\r\n\r\n\t\tconst startDateTimestamp = startDate.valueOf();\r\n\t\tconst endDateTimestamp = endDate.valueOf();\r\n\t\tconst key = this._durationCacheKey(startDateTimestamp, endDateTimestamp);\r\n\t\tlet duration;\r\n\t\tif(cache.durations[key] === undefined){\r\n\t\t\tconst result = compute();\r\n\t\t\tcache.durations[key] = result.valueOf();\r\n\r\n\t\t\t// can't populate end date due to logic of end date calculation, current unit tests capture it\r\n\t\t\t// cache.endDates[this._endDateCacheKey(startDateTimestamp, result)] = endDateTimestamp;\r\n\t\t\tduration = result;\r\n\t\t}else{\r\n\t\t\tduration = cache.durations[key];\r\n\t\t}\r\n\r\n\t\treturn duration;\r\n\t}\r\n\r\n\tclear(): void{\r\n\t\tthis._cache = {};\r\n\t}\r\n}","import {createCacheObject} from \"./work_unit_cache\";\r\nimport {LargerUnitsCache} from \"./work_unit_cache\";\r\nimport * as utils from \"../../../utils/utils\";\r\nimport {DateDurationCache} from \"./work_unit_cache/date_duration_cache\";\r\n\r\nfunction CalendarWorkTimeStrategy(gantt, argumentsHelper) {\r\n\tthis.argumentsHelper = argumentsHelper;\r\n\tthis.$gantt = gantt;\r\n\tthis._workingUnitsCache = createCacheObject();\r\n\tthis._largeUnitsCache = new LargerUnitsCache(this);\r\n\tthis._dateDurationCache = new DateDurationCache();\r\n\tthis._worktime = null;\r\n\tthis._cached_timestamps = {};\r\n\tthis._cached_timestamps_count = 0;\r\n}\r\n\r\nCalendarWorkTimeStrategy.prototype = {\r\n\tunits: [\r\n\t\t\"year\",\r\n\t\t\"month\",\r\n\t\t\"week\",\r\n\t\t\"day\",\r\n\t\t\"hour\",\r\n\t\t\"minute\"\r\n\t],\r\n\t_clearCaches: function(){\r\n\t\tthis._workingUnitsCache.clear();\r\n\t\tthis._largeUnitsCache.clear();\r\n\t\tthis._dateDurationCache.clear();\r\n\t},\r\n\t// cache previously calculated worktime\r\n\t_getUnitOrder: function (unit) {\r\n\t\tfor (var i = 0, len = this.units.length; i < len; i++) {\r\n\t\t\tif (this.units[i] == unit)\r\n\t\t\t\treturn i;\r\n\t\t}\r\n\t},\r\n\t_resetTimestampCache: function(){\r\n\t\tthis._cached_timestamps = {};\r\n\t\tthis._cached_timestamps_count = 0;\r\n\t},\r\n\t_timestamp: function (settings) {\r\n\t\t// minor optimization, store calculated timestamps to reduce computations\r\n\t\t// reset cache when number of keys exceeds large number where key lookup may became more expensive than the recalculation\r\n\t\tif(this._cached_timestamps_count > 1000000){\r\n\t\t\tthis._resetTimestampCache();\r\n\t\t}\r\n\r\n\t\tvar timestamp = null;\r\n\t\tif ((settings.day || settings.day === 0)) {\r\n\t\t\ttimestamp = settings.day;\r\n\t\t} else if (settings.date) {\r\n\t\t\tvar value = String(settings.date.valueOf());\r\n\t\t\tif(this._cached_timestamps[value]){\r\n\t\t\t\ttimestamp = this._cached_timestamps[value];\r\n\t\t\t}else{\r\n\t\t\t\t// store worktime datestamp in utc so it could be recognized in different timezones (e.g. opened locally and sent to the export service in different timezone)\r\n\t\t\t\ttimestamp = Date.UTC(settings.date.getFullYear(), settings.date.getMonth(), settings.date.getDate());\r\n\t\t\t\tthis._cached_timestamps[value] = timestamp;\r\n\t\t\t\tthis._cached_timestamps_count++;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\treturn timestamp;\r\n\t},\r\n\t_checkIfWorkingUnit: function (date, unit) {\r\n\t\t// GS-596: If unit is larger than day or has a custom logic\r\n\t\tif (!this[\"_is_work_\" + unit]) {\r\n\t\t\tconst from = this.$gantt.date[`${unit}_start`](new Date(date));\r\n\t\t\tconst to = this.$gantt.date.add(from, 1, unit);\r\n\t\t\treturn this.hasDuration(from, to);\r\n\t\t}\r\n\t\treturn this[\"_is_work_\" + unit](date);\r\n\t},\r\n\t//checkings for particular time units\r\n\t//methods for month-year-week can be defined, otherwise always return 'true'\r\n\t_is_work_day: function (date) {\r\n\t\tvar val = this._getWorkHours(date);\r\n\r\n\t\tif (Array.isArray(val)) {\r\n\t\t\treturn val.length > 0;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t_is_work_hour: function (date) {\r\n\t\tvar hours = this._getWorkHours(date); // [{start: 8*60*60, end: 12*60*60}, {start: 13*60*60, end: 17*60*60}]\r\n\t\tvar value = date.getHours();\r\n\t\tfor (var i = 0; i < hours.length; i++) {\r\n\t\t\tif(value >= hours[i].startHour && value < hours[i].endHour){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\t_getTimeOfDayStamp: function(date, dayEnd) {\r\n\t\tvar hours = date.getHours();\r\n\t\tif(!date.getHours() && !date.getMinutes() && dayEnd){\r\n\t\t\thours = 24;\r\n\t\t}\r\n\t\treturn hours * 60 * 60 + date.getMinutes() * 60;\r\n\t},\r\n\r\n\t_is_work_minute: function(date){\r\n\t\tvar hours = this._getWorkHours(date); // [{start: 8*60*60, end: 12*60*60}, {start: 13*60*60, end: 17*60*60}]\r\n\t\tvar checkTime = this._getTimeOfDayStamp(date);\r\n\t\tfor (var i = 0; i < hours.length; i++) {\r\n\t\t\tif(checkTime >= hours[i].start && checkTime < hours[i].end){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\t_nextDate: function (start, unit, step) {\r\n\t\treturn this.$gantt.date.add(start, step, unit);\r\n\t},\r\n\t_getWorkUnitsBetweenGeneric: function (from, to, unit, step) {\r\n\t\tvar dateHelper = this.$gantt.date;\r\n\t\tvar start = new Date(from),\r\n\t\t\tend = new Date(to);\r\n\t\tstep = step || 1;\r\n\t\tvar units = 0;\r\n\r\n\r\n\t\tvar next = null;\r\n\t\tvar stepStart,\r\n\t\t\tstepEnd;\r\n\r\n\t\t// calculating decimal durations, i.e. 2016-09-20 00:05:00 - 2016-09-20 01:00:00 ~ 0.95 instead of 1\r\n\t\t// and also  2016-09-20 00:00:00 - 2016-09-20 00:05:00 ~ 0.05 instead of 1\r\n\t\t// durations must be rounded later\r\n\t\tvar checkFirst = false;\r\n\t\tstepStart = dateHelper[unit + \"_start\"](new Date(start));\r\n\t\tif (stepStart.valueOf() != start.valueOf()) {\r\n\t\t\tcheckFirst = true;\r\n\t\t}\r\n\t\tvar checkLast = false;\r\n\t\tstepEnd = dateHelper[unit + \"_start\"](new Date(to));\r\n\t\tif (stepEnd.valueOf() != to.valueOf()) {\r\n\t\t\tcheckLast = true;\r\n\t\t}\r\n\r\n\t\tvar isLastStep = false;\r\n\t\twhile (start.valueOf() < end.valueOf()) {\r\n\t\t\tnext = this._nextDate(start, unit, step);\r\n\t\t\tisLastStep = (next.valueOf() > end.valueOf());\r\n\r\n\t\t\tif (this._isWorkTime(start, unit)) {\r\n\t\t\t\tif (checkFirst || (checkLast && isLastStep)) {\r\n\t\t\t\t\tstepStart = dateHelper[unit + \"_start\"](new Date(start));\r\n\t\t\t\t\tstepEnd = dateHelper.add(stepStart, step, unit);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (checkFirst) {\r\n\t\t\t\t\tcheckFirst = false;\r\n\t\t\t\t\tnext = this._nextDate(stepStart, unit, step);\r\n\t\t\t\t\tunits += ((stepEnd.valueOf() - start.valueOf()) / (stepEnd.valueOf() - stepStart.valueOf()));\r\n\t\t\t\t} else if (checkLast && isLastStep) {\r\n\t\t\t\t\tcheckLast = false;\r\n\t\t\t\t\tunits += ((end.valueOf() - start.valueOf()) / (stepEnd.valueOf() - stepStart.valueOf()));\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tunits++;\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tvar unitOrder = this._getUnitOrder(unit);\r\n\t\t\t\tvar biggerTimeUnit = this.units[unitOrder - 1];\r\n\t\t\t\tif(biggerTimeUnit && !this._isWorkTime(start, biggerTimeUnit)){\r\n\t\t\t\t\tnext = this._getClosestWorkTimeFuture(start, biggerTimeUnit);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tstart = next;\r\n\t\t}\r\n\t\treturn units;\r\n\t},\r\n\r\n\t_getMinutesPerHour: function (date) {\r\n\t\tvar hourStart = this._getTimeOfDayStamp(date);\r\n\t\tvar hourEnd = this._getTimeOfDayStamp(this._nextDate(date, \"hour\", 1));\r\n\t\tif (hourEnd === 0){\r\n\t\t\thourEnd = 24 * 60 * 60;\r\n\t\t}\r\n\t\tvar worktimes = this._getWorkHours(date);\r\n\r\n\t\tfor(var i = 0; i < worktimes.length; i++){\r\n\t\t\tvar interval = worktimes[i];\r\n\t\t\tif(hourStart >= interval.start && hourEnd <= interval.end){\r\n\t\t\t\treturn 60;// hour inside a working interval, all hour is a work hour\r\n\t\t\t}else if(hourStart < interval.end && hourEnd > interval.start){\r\n\t\t\t\t// hour is partially work time\r\n\t\t\t\tvar duration = Math.min(hourEnd, interval.end) - Math.max(hourStart, interval.start);\r\n\t\t\t\treturn duration / 60;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn 0;\r\n\t},\r\n\r\n\t_getMinutesPerDay: function (date) {\r\n\t\tvar hours = this._getWorkHours(date);\r\n\t\tvar res = 0;\r\n\t\thours.forEach(function(interval){\r\n\t\t\tres+= interval.durationMinutes;\r\n\t\t});\r\n\t\treturn res;\r\n\t},\r\n\tgetHoursPerDay: function (date) {\r\n\t\tvar hours = this._getWorkHours(date);\r\n\t\tvar res = 0;\r\n\t\thours.forEach(function(interval){\r\n\t\t\tres+= interval.durationHours;\r\n\t\t});\r\n\t\treturn res;\r\n\t},\r\n\t_getWorkUnitsForRange: function (from, to, unit, step) {\r\n\t\tvar total = 0;\r\n\t\tvar start = new Date(from),\r\n\t\t\tend = new Date(to);\r\n\r\n\t\tvar getUnitsPerDay;\r\n\t\tif (unit == \"minute\") {\r\n\t\t\tgetUnitsPerDay = utils.bind(this._getMinutesPerDay, this);\r\n\t\t} else {\r\n\t\t\tgetUnitsPerDay = utils.bind(this.getHoursPerDay, this);\r\n\t\t}\r\n\r\n\t\twhile (start.valueOf() < end.valueOf()) {\r\n\t\t\tif(end - start > 1000*60*60*24*32 && start.getDate() === 0) {\r\n\t\t\t\tvar units = this._largeUnitsCache.getMinutesPerMonth(start);\r\n\t\t\t\tif(unit == \"hour\"){\r\n\t\t\t\t\tunits = units / 60;\r\n\t\t\t\t}\r\n\t\t\t\ttotal += units;\r\n\t\t\t\tstart = this.$gantt.date.add(start, 1, \"month\");\r\n\t\t\t\tcontinue;\r\n\t\t\t}else if(end - start > 1000*60*60*24*16) {\r\n\t\t\t\tvar weekStart = this.$gantt.date.week_start(new Date(start));\r\n\t\t\t\tif(start.valueOf() === weekStart.valueOf()){\r\n\t\t\t\t\tvar units = this._largeUnitsCache.getMinutesPerWeek(start);\r\n\t\t\t\t\tif(unit == \"hour\"){\r\n\t\t\t\t\t\tunits = units / 60;\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttotal += units;\r\n\t\t\t\t\tstart = this.$gantt.date.add(start, 7, \"day\");\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t//\tif (this._isWorkTime(start, \"day\")) {\r\n\t\t\ttotal += getUnitsPerDay(start);\r\n\t\t//\t}\r\n\t\t\tstart = this._nextDate(start, \"day\", 1);\r\n\t\t}\r\n\r\n\t\treturn total / step;\r\n\t},\r\n\r\n\r\n\t_getMinutesBetweenSingleDay: function(from, to){\r\n\t\tvar range = this._getIntervalTimestamp(from, to);\r\n\t\tvar worktimes = this._getWorkHours(from);\r\n\t\tvar result = 0;\r\n\r\n\t\tfor(var i = 0; i < worktimes.length; i++){\r\n\t\t\tvar interval = worktimes[i];\r\n\t\t\tif(range.end >= interval.start && range.start <= interval.end){\r\n\t\t\t\tvar minuteFrom = Math.max(interval.start, range.start);\r\n\t\t\t\tvar minuteTo = Math.min(interval.end, range.end);\r\n\r\n\t\t\t\tresult += (minuteTo - minuteFrom) / 60;\r\n\t\t\t\trange.start = minuteTo;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn Math.floor(result);\r\n\t},\r\n\r\n\t_getMinutesBetween: function(from, to, unit, step){\r\n\t\tvar start = new Date(from),\r\n\t\t\tend = new Date(to);\r\n\t\tstep = step || 1;\r\n\r\n\t\tvar firstDayStart = new Date(start);\r\n\t\tvar firstDayEnd = this.$gantt.date.add(this.$gantt.date.day_start(new Date(start)), 1, \"day\");\r\n\r\n\t\tif (end.valueOf() <= firstDayEnd.valueOf()) {\r\n\t\t\treturn this._getMinutesBetweenSingleDay(from, to);\r\n\t\t} else {\r\n\r\n\t\t\tvar lastDayStart = this.$gantt.date.day_start(new Date(end));\r\n\t\t\tvar lastDayEnd = end;\r\n\r\n\t\t\tvar startPart = this._getMinutesBetweenSingleDay(firstDayStart, firstDayEnd);\r\n\t\t\tvar endPart = this._getMinutesBetweenSingleDay(lastDayStart, lastDayEnd);\r\n\r\n\t\t\tvar rangePart = this._getWorkUnitsForRange(firstDayEnd, lastDayStart, unit, step);\r\n\t\t\tvar total = startPart + rangePart + endPart;\r\n\r\n\t\t\treturn total;\r\n\t\t}\r\n\t},\r\n\t// optimized method for calculating work units duration of large time spans\r\n\t// implemented for hours and minutes units, bigger time units don't benefit from the optimization so much\r\n\t_getHoursBetween: function (from, to, unit, step) {\r\n\t\tvar start = new Date(from),\r\n\t\t\tend = new Date(to);\r\n\t\tstep = step || 1;\r\n\r\n\t\tvar firstDayStart = new Date(start);\r\n\t\tvar firstDayEnd = this.$gantt.date.add(this.$gantt.date.day_start(new Date(start)), 1, \"day\");\r\n\r\n\t\tif (end.valueOf() <= firstDayEnd.valueOf()) {\r\n\t\t\treturn Math.round(this._getMinutesBetweenSingleDay(from, to) / 60);\r\n\t\t} else {\r\n\r\n\t\t\tvar lastDayStart = this.$gantt.date.day_start(new Date(end));\r\n\t\t\tvar lastDayEnd = end;\r\n\r\n\t\t\tvar startPart = this._getMinutesBetweenSingleDay(firstDayStart, firstDayEnd, unit, step) / 60;\r\n\t\t\tvar endPart = this._getMinutesBetweenSingleDay(lastDayStart, lastDayEnd, unit, step) / 60;\r\n\r\n\t\t\tvar rangePart = this._getWorkUnitsForRange(firstDayEnd, lastDayStart, unit, step);\r\n\t\t\tvar total = startPart + rangePart + endPart;\r\n\r\n\t\t\treturn Math.round(total);\r\n\t\t}\r\n\t},\r\n\r\n\tgetConfig: function () {\r\n\t\treturn this._worktime;\r\n\t},\r\n\t_setConfig: function (settings) {\r\n\t\tthis._worktime = settings;\r\n\t\tthis._parseSettings();\r\n\t\tthis._clearCaches();\r\n\t},\r\n\t_parseSettings: function() {\r\n\t\tvar settings = this.getConfig();\r\n\t\tsettings.parsed = {\r\n\t\t\tdates: {},\r\n\t\t\thours: null,\r\n\t\t\thaveCustomWeeks: false,\r\n\t\t\tcustomWeeks: {},\r\n\t\t\tcustomWeeksRangeStart: null,\r\n\t\t\tcustomWeeksRangeEnd: null,\r\n\t\t\tcustomWeeksBoundaries: []\r\n\t\t};\r\n\r\n\t\tsettings.parsed.hours = this._parseHours(settings.hours);\r\n\t\tfor(var i in settings.dates){\r\n\t\t\tsettings.parsed.dates[i] = this._parseHours(settings.dates[i]);\r\n\t\t}\r\n\r\n\t\tif(settings.customWeeks) {\r\n\t\t\tvar minCustomRangeStart = null;\r\n\t\t\tvar maxCustomRangeEnd = null;\r\n\t\t\tfor(var i in settings.customWeeks){\r\n\t\t\t\tvar customTime = settings.customWeeks[i];\r\n\r\n\t\t\t\tif(customTime.from && customTime.to){\r\n\t\t\t\t\tvar rangeStart = customTime.from;\r\n\t\t\t\t\tvar rangeEnd = customTime.to;\r\n\t\t\t\t\tif(!minCustomRangeStart || minCustomRangeStart > rangeStart.valueOf()){\r\n\t\t\t\t\t\tminCustomRangeStart = rangeStart.valueOf();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!maxCustomRangeEnd || maxCustomRangeEnd < rangeEnd.valueOf()){\r\n\t\t\t\t\t\tmaxCustomRangeEnd = rangeEnd.valueOf();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tsettings.parsed.customWeeksBoundaries.push({\r\n\t\t\t\t\t\tfrom: rangeStart.valueOf(),\r\n\t\t\t\t\t\tfromReadable: new Date(rangeStart),\r\n\t\t\t\t\t\tto: rangeEnd.valueOf(),\r\n\t\t\t\t\t\ttoReadable: new Date(rangeEnd),\r\n\t\t\t\t\t\tname: i\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tsettings.parsed.haveCustomWeeks = true;\r\n\t\t\t\t\tvar currentWeek = settings.parsed.customWeeks[i] = {\r\n\t\t\t\t\t\tfrom: customTime.from,\r\n\t\t\t\t\t\tto: customTime.to,\r\n\t\t\t\t\t\thours: this._parseHours(customTime.hours),\r\n\t\t\t\t\t\tdates: {}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t// GS-1840. If there are no dates, it should work correctly with the weekdays\r\n\t\t\t\t\tif (customTime.days && !customTime.dates) {\r\n\t\t\t\t\t\tcustomTime.dates = customTime.dates || {};\r\n\t\t\t\t\t\tfor (var i = 0; i < customTime.days.length; i++) {\r\n\t\t\t\t\t\t\tcustomTime.dates[i] = customTime.days[i];\r\n\t\t\t\t\t\t\tif (!(customTime.days[i] instanceof Array)) {\r\n\t\t\t\t\t\t\t\tcustomTime.dates[i] = !!customTime.days[i];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tdelete customTime.days;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor(var d in customTime.dates){\r\n\t\t\t\t\t\tcurrentWeek.dates[d] = this._parseHours(customTime.dates[d]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tsettings.parsed.customWeeksRangeStart = minCustomRangeStart;\r\n\t\t\tsettings.parsed.customWeeksRangeEnd = maxCustomRangeEnd;\r\n\r\n\t\t}\r\n\t},\r\n\r\n\t_tryChangeCalendarSettings: function (payload) {\r\n\t\tvar backup = JSON.stringify(this.getConfig());\r\n\t\tpayload();\r\n\t\tif (!this.hasWorkTime()) {\r\n\t\t//\tthis.$gantt.assert(false, \"Invalid calendar settings, no worktime available\");\r\n\t\t\tthis._setConfig(JSON.parse(backup));\r\n\t\t\tthis._clearCaches();\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\r\n\t},\r\n\r\n\t_arraysEqual: function(a, b){\r\n\t\tif (a === b) return true;\r\n\t\tif (!a || !b) return false;\r\n\t\tif (a.length != b.length) return false;\r\n\r\n\t\tfor (var i = 0; i < a.length; ++i) {\r\n\t\t\tif (a[i] !== b[i]) return false;\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\r\n\t_compareSettings: function (mySettings, thatSettings) {\r\n\t\tif (!this._arraysEqual(mySettings.hours, thatSettings.hours)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar myDays = Object.keys(mySettings.dates);\r\n\t\tvar otherDates = Object.keys(thatSettings.dates);\r\n\t\tmyDays.sort();\r\n\t\totherDates.sort();\r\n\r\n\t\tif (!this._arraysEqual(myDays, otherDates)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tfor(var i = 0; i < myDays.length; i++){\r\n\t\t\tvar timestamp = myDays[i];\r\n\t\t\tvar myHours = mySettings.dates[timestamp];\r\n\t\t\tvar otherHours = mySettings.dates[timestamp];\r\n\r\n\t\t\t// day settings not equal\r\n\t\t\tif(myHours !== otherHours &&\r\n\t\t\t\t// but still can be two arrays with the equivalent hour settings\r\n\t\t\t\t!(Array.isArray(myHours) && Array.isArray(otherHours) && this._arraysEqual(myHours, otherHours))\r\n\t\t\t\t){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\tequals: function (calendar) {\r\n\t\tif(!(calendar instanceof CalendarWorkTimeStrategy)){\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar mySettings = this.getConfig();\r\n\t\tvar thatSettings = calendar.getConfig();\r\n\r\n\t\tif(!this._compareSettings(mySettings, thatSettings)){\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif(mySettings.parsed.haveCustomWeeks && thatSettings.parsed.haveCustomWeeks){\r\n\t\t\tif(mySettings.parsed.customWeeksBoundaries.length != thatSettings.parsed.customWeeksBoundaries.length){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tfor(var i in mySettings.parsed.customWeeks){\r\n\t\t\t\tvar myWeek = mySettings.parsed.customWeeks[i];\r\n\t\t\t\tvar thatWeek = thatSettings.parsed.customWeeks[i];\r\n\t\t\t\tif(!thatWeek){\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!this._compareSettings(myWeek, thatWeek)){\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}else if(mySettings.parse.haveCustomWeeks !== thatSettings.parsed.haveCustomWeeks){\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\tgetWorkHours: function () {\r\n\t\tvar config = this.argumentsHelper.getWorkHoursArguments.apply(this.argumentsHelper, arguments);\r\n\t\treturn this._getWorkHours(config.date, false);\r\n\t},\r\n\t_getWorkHours: function (date, parsed) {\r\n\t\tvar calendar = this.getConfig();\r\n\t\tif(parsed !== false){\r\n\t\t\tcalendar = calendar.parsed;\r\n\t\t}\r\n\r\n\t\tif(!date){\r\n\t\t\treturn calendar.hours;\r\n\t\t}\r\n\r\n\t\tconst dayStartDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());\r\n\r\n\t\tvar dateValue = this._timestamp({date: dayStartDate});\r\n\r\n\t\tif(calendar.haveCustomWeeks){\r\n\t\t\tif(calendar.customWeeksRangeStart <= dateValue && calendar.customWeeksRangeEnd > dateValue){\r\n\t\t\t\tfor(var i = 0; i < calendar.customWeeksBoundaries.length; i++){\r\n\t\t\t\t\tif(calendar.customWeeksBoundaries[i].from <= dateValue && calendar.customWeeksBoundaries[i].to > dateValue){\r\n\t\t\t\t\t\tcalendar = calendar.customWeeks[calendar.customWeeksBoundaries[i].name];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar hours = true;\r\n\r\n\t\tif (calendar.dates[dateValue] !== undefined) {\r\n\t\t\thours = calendar.dates[dateValue];//custom day\r\n\t\t} else if (calendar.dates[date.getDay()] !== undefined) {\r\n\t\t\thours = calendar.dates[date.getDay()];//week day\r\n\t\t}\r\n\t\tif (hours === true) {\r\n\t\t\treturn calendar.hours;\r\n\t\t} else if (hours) {\r\n\t\t\treturn hours;\r\n\t\t}\r\n\t\treturn [];\r\n\t},\r\n\r\n\t_getIntervalTimestamp: function(from, to){\r\n\t\tvar res = {\r\n\t\t\tstart: 0,\r\n\t\t\tend: 0\r\n\t\t};\r\n\r\n\t\tres.start = from.getHours() * 60 * 60 + from.getMinutes() * 60 + from.getSeconds();\r\n\t\tvar endHours = to.getHours();\r\n\t\tif(!endHours && !to.getMinutes() && !to.getSeconds() && from.valueOf() < to.valueOf()){\r\n\t\t\tendHours = 24;\r\n\t\t}\r\n\t\tres.end = endHours * 60 * 60 + to.getMinutes() * 60 + to.getSeconds();\r\n\t\treturn res;\r\n\t},\r\n\r\n\t_parseHours: function(hours) {\r\n\t\tif(Array.isArray(hours)){\r\n\r\n\t\t\tvar timestampRanges = [];// worktime as seconds range\r\n\t\t\thours.forEach(function(hour){\r\n\t\t\t\tif(typeof hour === \"number\"){\r\n\t\t\t\t\ttimestampRanges.push(hour*60*60);\r\n\t\t\t\t}else if(typeof hour === \"string\") {\r\n\t\t\t\t\t// \"12-13\", or \"12:00-13:00\", or \"12:00:00-13:00:00\"\r\n\t\t\t\t\thour.split(\"-\").map(function(time){\r\n\t\t\t\t\t\treturn time.trim();\r\n\t\t\t\t\t}).forEach(function(part){\r\n\t\t\t\t\t\tvar parsed = part.split(\":\").map(function(time){\r\n\t\t\t\t\t\t\treturn time.trim();\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tvar value = parseInt(parsed[0]*60*60);\r\n\t\t\t\t\t\tif(parsed[1]){\r\n\t\t\t\t\t\t\tvalue += parseInt(parsed[1]*60);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(parsed[2]){\r\n\t\t\t\t\t\t\tvalue += parseInt(parsed[2]);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ttimestampRanges.push(value);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tvar timerangeConfig = [];\r\n\t\t\tfor (var i = 0; i < timestampRanges.length; i += 2) {\r\n\t\t\t\tvar start = timestampRanges[i];\r\n\t\t\t\tvar end = timestampRanges[i + 1];\r\n\t\t\t\tvar duration = end - start;\r\n\r\n\t\t\t\ttimerangeConfig.push({\r\n\t\t\t\t\tstart: start,\r\n\t\t\t\t\tend: end,\r\n\t\t\t\t\tstartHour: Math.floor(start / (60*60)),\r\n\t\t\t\t\tstartMinute: Math.floor(start / (60)),\r\n\t\t\t\t\tendHour: Math.ceil(end / (60*60)),\r\n\t\t\t\t\tendMinute: Math.ceil(end / (60)),\r\n\t\t\t\t\tdurationSeconds: duration,\r\n\t\t\t\t\tdurationMinutes: duration/60,\r\n\t\t\t\t\tdurationHours: duration/(60 * 60)\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn timerangeConfig;\r\n\t\t} else {\r\n\t\t\treturn hours;\r\n\t\t}\r\n\t},\r\n\r\n\tsetWorkTime: function (settings) {\r\n\t\treturn this._tryChangeCalendarSettings(utils.bind(function () {\r\n\t\t\tvar hours = settings.hours !== undefined ? settings.hours : true;\r\n\t\t\tvar timestamp = this._timestamp(settings);\r\n\t\t\tvar calendarConfig = this.getConfig();\r\n\t\t\tif (timestamp !== null) {\r\n\t\t\t\tcalendarConfig.dates[timestamp] = hours;\r\n\t\t\t} else if(!settings.customWeeks) {\r\n\t\t\t\tcalendarConfig.hours = hours;\r\n\t\t\t}\r\n\r\n\t\t\tif(settings.customWeeks){\r\n\t\t\t\tif(!calendarConfig.customWeeks){\r\n\t\t\t\t\tcalendarConfig.customWeeks = {};\r\n\t\t\t\t}\r\n\t\t\t\t// GS-1867. allow setWorkTime to exclude dates in the customWeeks range\r\n\t\t\t\tif (typeof settings.customWeeks == \"string\"){\r\n\t\t\t\t\tif (timestamp !== null) {\r\n\t\t\t\t\t\tcalendarConfig.customWeeks[settings.customWeeks].dates[timestamp] = hours;\r\n\t\t\t\t\t} else if(!settings.customWeeks) {\r\n\t\t\t\t\t\tcalendarConfig.customWeeks[settings.customWeeks].hours = hours;\r\n\t\t\t\t\t}\t\t\r\n\t\t\t\t} else if (typeof settings.customWeeks === \"object\"\r\n\t\t\t\t&& settings.customWeeks.constructor === Object){\r\n\t\t\t\t\tfor(var i in settings.customWeeks){\r\n\t\t\t\t\t\tcalendarConfig.customWeeks[i] = settings.customWeeks[i];\r\n\t\t\t\t\t}\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._parseSettings();\r\n\t\t\tthis._clearCaches();\r\n\t\t}, this));\r\n\t},\r\n\r\n\tunsetWorkTime: function (settings) {\r\n\t\treturn this._tryChangeCalendarSettings(utils.bind(function () {\r\n\t\t\tif (!settings) {\r\n\t\t\t\tthis.reset_calendar();\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar timestamp = this._timestamp(settings);\r\n\r\n\t\t\t\tif (timestamp !== null) {\r\n\t\t\t\t\tdelete this.getConfig().dates[timestamp];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// Load updated settings and clear work units cache\r\n\t\t\tthis._parseSettings();\r\n\t\t\tthis._clearCaches();\r\n\t\t}, this));\r\n\t},\r\n\r\n\t_isWorkTime: function (date, unit) {\r\n\t\t// Check if this item has in the cache\r\n\r\n\t\tvar useCache = true;//unit === \"day\"; // use cache only for days. In case of hours/minutes cache size grows too large and the overhead exceeds the gains\r\n\t\tvar isWorkUnit = -1;\r\n\t\tvar dateKey = null;\r\n\r\n\t\tif(useCache){\r\n\t\t\t// use string keys\r\n\t\t\tdateKey = String(date.valueOf());\r\n\t\t\tisWorkUnit = this._workingUnitsCache.getItem(unit, dateKey, date);\r\n\t\t}\r\n\r\n\t\tif (isWorkUnit == -1) {\r\n\t\t\t// calculate if not cached\r\n\t\t\tisWorkUnit = this._checkIfWorkingUnit(date, unit);\r\n\t\t\tif(useCache){\r\n\t\t\t\tthis._workingUnitsCache.setItem(unit, dateKey, isWorkUnit, date);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn isWorkUnit;\r\n\t},\r\n\r\n\tisWorkTime: function () {\r\n\t\tvar config =  this.argumentsHelper.isWorkTimeArguments.apply( this.argumentsHelper, arguments);\r\n\t\treturn this._isWorkTime(config.date, config.unit);\r\n\t},\r\n\r\n\tcalculateDuration: function () {\r\n\t\tvar config =  this.argumentsHelper.getDurationArguments.apply( this.argumentsHelper, arguments);\r\n\r\n\t\tif (!config.unit) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t//return this._calculateDuration(config.start_date, config.end_date, config.unit, config.step);\r\n\r\n\t\tvar self = this;\r\n\t\treturn this._dateDurationCache.getDuration(config.start_date, config.end_date, config.unit, config.step, function(){ \r\n\t\t\treturn self._calculateDuration(config.start_date, config.end_date, config.unit, config.step);\r\n\t\t});\r\n\t},\r\n\r\n\t_calculateDuration: function (from, to, unit, step) {\r\n\t\tvar res = 0;\r\n\r\n\t\tvar sign = 1;\r\n\t\tif(from.valueOf() > to.valueOf()){\r\n\t\t\tvar tmp = to;\r\n\t\t\tto = from;\r\n\t\t\tfrom = tmp;\r\n\t\t\tsign = -1;\r\n\t\t}\r\n\r\n\t\tif (unit == \"hour\" && step == 1) {\r\n\t\t\tres = this._getHoursBetween(from, to, unit, step);\r\n\t\t} else if(unit == \"minute\" && step == 1){\r\n\t\t\t// quick calculation for minutes with 1 minute step\r\n\t\t\tres = this._getMinutesBetween(from, to, unit, step);\r\n\t\t} else {\r\n\t\t\tres = this._getWorkUnitsBetweenGeneric(from, to, unit, step);\r\n\t\t}\r\n\r\n\t\t// getWorkUnits.. returns decimal durations\r\n\t\treturn sign * Math.round(res);\r\n\t},\r\n\thasDuration: function () {\r\n\t\tvar config =  this.argumentsHelper.getDurationArguments.apply( this.argumentsHelper, arguments);\r\n\r\n\t\tvar from = config.start_date,\r\n\t\t\tto = config.end_date,\r\n\t\t\tunit = config.unit,\r\n\t\t\tstep = config.step;\r\n\r\n\t\tif (!unit) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar start = new Date(from),\r\n\t\t\tend = new Date(to);\r\n\t\tstep = step || 1;\r\n\r\n\t\twhile (start.valueOf() < end.valueOf()) {\r\n\t\t\tif (this._isWorkTime(start, unit))\r\n\t\t\t\treturn true;\r\n\t\t\tstart = this._nextDate(start, unit, step);\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\tcalculateEndDate: function () {\r\n\t\tvar config =  this.argumentsHelper.calculateEndDateArguments.apply( this.argumentsHelper, arguments);\r\n\r\n\t\tvar from = config.start_date,\r\n\t\t\tduration = config.duration,\r\n\t\t\tunit = config.unit,\r\n\t\t\tstep = config.step;\r\n\r\n\t\tif (!unit)\r\n\t\t\treturn false;\r\n\r\n\t\tvar mult = (config.duration >= 0) ? 1 : -1;\r\n\t\tduration = Math.abs(duration * 1);\r\n\t//\tvar endDate = this._calculateEndDate(from, duration, unit, step * mult);\r\n\t//\treturn endDate;\r\n\t\tvar self = this;\r\n\t\treturn this._dateDurationCache.getEndDate(from, duration, unit, step * mult, function(){ \r\n\t\t\treturn self._calculateEndDate(from, duration, unit, step * mult);\r\n\t\t} );\r\n\t},\r\n\r\n\t_calculateEndDate: function (from, duration, unit, step) {\r\n\t\tif (!unit)\r\n\t\t\treturn false;\r\n\r\n\t\tif (step == 1 && unit == \"minute\") {\r\n\t\t\treturn this._calculateMinuteEndDate(from, duration, step);\r\n\t\t} else if(step == -1 && unit == \"minute\") {\r\n\t\t\treturn this._subtractMinuteDate(from, duration, step);\r\n\t\t} else if (step == 1 && unit == \"hour\") {\r\n\t\t\treturn this._calculateHourEndDate(from, duration, step);\r\n\t\t} else {\r\n\t\t\tvar interval = this._addInterval(from, duration, unit, step, null);\r\n\t\t\treturn interval.end;\r\n\t\t}\r\n\t},\r\n\r\n\t_addInterval: function (start, duration, unit, step, stopAction) {\r\n\t\tvar added = 0;\r\n\t\tvar current = start;\r\n\t\tvar dstShift = false;\r\n\r\n\t\twhile (added < duration && !(stopAction && stopAction(current))) {\r\n\t\t\tvar next = this._nextDate(current, unit, step);\r\n\r\n\t\t\t// GS-1501. Correct hours after DST change\r\n\t\t\tif (unit == \"day\"){\r\n\t\t\t\tdstShift = dstShift || !current.getHours() && next.getHours();\r\n\r\n\t\t\t\tif (dstShift){\r\n\t\t\t\t\tnext.setHours(0);\r\n\t\t\t\t\tif (next.getHours()){\r\n\t\t\t\t\t// the day when the timezone is changed, try to correct hours next time\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdstShift = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar dateValue = new Date(next.valueOf() + 1);\r\n\t\t\tif (step > 0) {\r\n\t\t\t\tdateValue = new Date(next.valueOf() - 1);\r\n\t\t\t}\r\n\t\t\tvar workTimeCheck = this._isWorkTime(dateValue, unit);\r\n\r\n\t\t\tif (workTimeCheck && !dstShift) {\r\n\t\t\t\tadded++;\r\n\t\t\t}\r\n\t\t\tcurrent = next;\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tend: current,\r\n\t\t\tstart: start,\r\n\t\t\tadded: added\r\n\t\t};\r\n\t},\r\n\r\n\t_addHoursUntilDayEnd: function(from, duration) {\r\n\t\tvar dayEnd = this.$gantt.date.add(this.$gantt.date.day_start(new Date(from)), 1, \"day\");\r\n\t\tvar added = 0;\r\n\t\tvar left = duration;\r\n\r\n\t\tvar range = this._getIntervalTimestamp(from, dayEnd);\r\n\t\tvar worktimes = this._getWorkHours(from);\r\n\t\tfor(var i = 0; i < worktimes.length && added < duration; i++){\r\n\t\t\tvar interval = worktimes[i];\r\n\t\t\tif(range.end >= interval.start && range.start <= interval.end){\r\n\t\t\t\tvar minuteFrom = Math.max(interval.start, range.start);\r\n\t\t\t\tvar minuteTo = Math.min(interval.end, range.end);\r\n\t\t\t\tvar rangeHours = (minuteTo - minuteFrom) / (60 * 60);\r\n\t\t\t\tif(rangeHours > left){\r\n\t\t\t\t\trangeHours = left;\r\n\t\t\t\t\tminuteTo = minuteFrom + (left * 60 * 60);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar addHours = Math.round((minuteTo - minuteFrom) / (60 * 60));\r\n\t\t\t\tadded += addHours;\r\n\t\t\t\tleft -= addHours;\r\n\t\t\t\trange.start = minuteTo;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar intervalEnd = dayEnd;\r\n\t\tif(added === duration){\r\n\t\t\tintervalEnd = new Date(from.getFullYear(), from.getMonth(), from.getDate(), 0, 0, range.start);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tadded: added,\r\n\t\t\tend: intervalEnd\r\n\t\t};\r\n\t},\r\n\r\n\t_calculateHourEndDate: function (from, duration,  step) {\r\n\t\tvar start = new Date(from),\r\n\t\tadded = 0;\r\n\t\tstep = step || 1;\r\n\t\tduration = Math.abs(duration * 1);\r\n\r\n\t\tvar interval = this._addHoursUntilDayEnd(start, duration);\r\n\t\tadded = interval.added;\r\n\t\tstart = interval.end;\r\n\r\n\t\tvar durationLeft = duration - added;\r\n\r\n\t\tif (durationLeft) {\r\n\t\t\tvar current = start;\r\n\t\t\twhile (added < duration) {\r\n\t\t\t\tvar next = this._nextDate(current, \"day\", step);\r\n\t\t\t\t// reset to day start in case DST switch happens in the process\r\n\t\t\t\tnext.setHours(0);\r\n\t\t\t\tnext.setMinutes(0);\r\n\t\t\t\tnext.setSeconds(0);\r\n\r\n\t\t\t\tvar hoursPerDay = 0;\r\n\t\t\t\tif(step > 0){\r\n\t\t\t\t\thoursPerDay = this.getHoursPerDay(new Date(next.valueOf() - 1));\r\n\t\t\t\t}else{\r\n\t\t\t\t\thoursPerDay = this.getHoursPerDay(new Date(next.valueOf() + 1));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (added + hoursPerDay >= duration) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tadded += hoursPerDay;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcurrent = next;\r\n\t\t\t}\r\n\t\t\tstart = current;\r\n\t\t}\r\n\r\n\t\tif (added < duration) {\r\n\t\t\tvar durationLeft = duration - added;\r\n\t\t\tinterval = this._addHoursUntilDayEnd(start, durationLeft);\r\n\t\t\tstart = interval.end;\r\n\t\t}\r\n\r\n\t\treturn start;\r\n\t},\r\n\r\n\t_addMinutesUntilHourEnd: function(from, duration){\r\n\t\tif(from.getMinutes() === 0) {\r\n\t\t\t// already at hour end\r\n\t\t\treturn {\r\n\t\t\t\tadded: 0,\r\n\t\t\t\tend: new Date(from)\r\n\t\t\t};\r\n\t\t}\r\n\t\tvar hourEnd = this.$gantt.date.add(this.$gantt.date.hour_start(new Date(from)), 1, \"hour\");\r\n\t\tvar added = 0;\r\n\t\tvar left = duration;\r\n\r\n\t\tvar range = this._getIntervalTimestamp(from, hourEnd);\r\n\t\tvar worktimes = this._getWorkHours(from);\r\n\t\tfor(var i = 0; i < worktimes.length && added < duration; i++){\r\n\t\t\tvar interval = worktimes[i];\r\n\t\t\tif(range.end >= interval.start && range.start <= interval.end){\r\n\t\t\t\tvar minuteFrom = Math.max(interval.start, range.start);\r\n\t\t\t\tvar minuteTo = Math.min(interval.end, range.end);\r\n\t\t\t\tvar rangeMinutes = (minuteTo - minuteFrom) / 60;\r\n\t\t\t\tif(rangeMinutes > left){\r\n\t\t\t\t\trangeMinutes = left;\r\n\t\t\t\t\tminuteTo = minuteFrom + (left * 60);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// TODO: verify testcase https://dhtmlxsupport.teamwork.com/desk/tickets/9625700/messages\r\n\t\t\t\t/*if (rangeMinutes === 0) {\r\n\t\t\t\t\trangeMinutes = left;\r\n\t\t\t\t\tminuteTo = minuteFrom + (left * 60);\r\n\t\t\t\t}*/\r\n\r\n\t\t\t\tvar addMinutes = Math.round((minuteTo - minuteFrom) / 60);\r\n\t\t\t\tleft -= addMinutes;\r\n\t\t\t\tadded += addMinutes;\r\n\t\t\t\trange.start = minuteTo;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar intervalEnd = hourEnd;\r\n\t\tif(added === duration){\r\n\t\t\tintervalEnd = new Date(from.getFullYear(), from.getMonth(), from.getDate(), 0, 0, range.start);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tadded: added,\r\n\t\t\tend: intervalEnd\r\n\t\t};\r\n\t},\r\n\r\n\t_subtractMinutesUntilHourStart: function(from, duration){\r\n\t\tvar hourStart = this.$gantt.date.hour_start(new Date(from));\r\n\t\tvar added = 0;\r\n\t\tvar left = duration;\r\n\r\n\t\tvar hourStartTimestamp = hourStart.getHours() * 60 * 60 + hourStart.getMinutes() * 60 + hourStart.getSeconds();\r\n\t\tvar initialDateTimestamp = from.getHours() * 60 * 60 + from.getMinutes() * 60 + from.getSeconds();\r\n\r\n\t\tvar worktimes = this._getWorkHours(from);\r\n\t\tfor(var i = worktimes.length - 1; i >= 0 && added < duration; i--){\r\n\t\t\tvar interval = worktimes[i];\r\n\t\t\tif(initialDateTimestamp > interval.start && hourStartTimestamp <= interval.end){\r\n\t\t\t\tvar minuteFrom = Math.min(initialDateTimestamp, interval.end);\r\n\t\t\t\tvar minuteTo = Math.max(hourStartTimestamp, interval.start);\r\n\r\n\t\t\t//\tvar minuteFrom = Math.max(interval.start, currentHour.start);\r\n\t\t\t//\tvar minuteTo = Math.min(interval.end, currentHour.end);\r\n\t\t\t\tvar rangeMinutes = (minuteFrom - minuteTo) / 60;\r\n\t\t\t\tif(rangeMinutes > left){\r\n\t\t\t\t\trangeMinutes = left;\r\n\t\t\t\t\tminuteTo = minuteFrom - (left * 60);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// TODO: verify testcase https://dhtmlxsupport.teamwork.com/desk/tickets/9625700/messages\r\n\t\t\t\t/*if (rangeMinutes === 0) {\r\n\t\t\t\t\trangeMinutes = left;\r\n\t\t\t\t\tminuteTo = minuteFrom - (left * 60);\r\n\t\t\t\t}*/\r\n\r\n\t\t\t\tvar addMinutes = Math.abs(Math.round((minuteFrom - minuteTo) / 60));\r\n\t\t\t\tleft -= addMinutes;\r\n\t\t\t\tadded += addMinutes;\r\n\t\t\t\tinitialDateTimestamp = minuteTo;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar intervalEnd = hourStart;\r\n\t\tif(added === duration){\r\n\t\t\tintervalEnd = new Date(from.getFullYear(), from.getMonth(), from.getDate(), 0, 0, initialDateTimestamp);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tadded: added,\r\n\t\t\tend: intervalEnd\r\n\t\t};\r\n\t},\r\n\r\n\t_subtractMinuteDate: function (from, duration, step) {\r\n\t\t// var start = new Date(from),\r\n\t\t// GS-2683. We should start calculating minutes from the working time\r\n\t\tvar start = this.getClosestWorkTime({ date: from, dir: \"past\", unit: \"minute\" }),\r\n\t\t\tadded = 0;\r\n\t\tstep = step || -1;\r\n\t\tduration = Math.abs(duration * 1);\r\n\t\tduration = Math.round(duration);\r\n\r\n\t\tconst minutePrecision = this._isMinutePrecision(start);\r\n\r\n\t\tlet addedInterval = this._subtractMinutesUntilHourStart(start, duration);\r\n\t\tadded += addedInterval.added;\r\n\r\n\t\tstart = addedInterval.end;\r\n\r\n\t\tvar calculatedDay = 0;\r\n\t\tvar daySchedule = [];\r\n\t\tvar minutesInDay = 0;\r\n\r\n\t\twhile (added < duration) {\r\n\t\t\tvar dayStart = this.$gantt.date.day_start(new Date(start));\r\n\r\n\t\t\tvar iterateFromDayEnd = false;\r\n\t\t\tif(start.valueOf() === dayStart.valueOf()){\r\n\t\t\t\tdayStart = this.$gantt.date.add(dayStart, -1, \"day\");\r\n\t\t\t\titerateFromDayEnd = true;\r\n\t\t\t}\r\n\t\t\t//var dayStartTimestamp = this.$gantt.date.day_start(new Date(start)).valueOf();\r\n\t\t\tvar dayEnd = new Date(dayStart.getFullYear(), dayStart.getMonth(), dayStart.getDate(), 23, 59,59,999).valueOf();\r\n\r\n\t\t\tif(dayEnd !== calculatedDay){\r\n\t\t\t\tdaySchedule = this._getWorkHours(dayStart);\r\n\t\t\t\tminutesInDay = this._getMinutesPerDay(dayStart);\r\n\t\t\t\tcalculatedDay = dayEnd;\r\n\t\t\t}\r\n\r\n\t\t\tvar left = duration - added;\r\n\t\t\tvar timestamp = this._getTimeOfDayStamp(start, iterateFromDayEnd);\r\n\r\n\t\t\tif(!daySchedule.length || !minutesInDay){\r\n\t\t\t\tstart = this.$gantt.date.add(start, -1, \"day\");\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif(daySchedule[daySchedule.length - 1].end <= timestamp){\r\n\t\t\t\tif(left > minutesInDay){\r\n\t\t\t\t\tadded += minutesInDay;\r\n\t\t\t\t\tstart = this.$gantt.date.add(start, -1, \"day\");\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar isWorkHour = false;\r\n\t\t\tvar workInterval = null;\r\n\t\t\tvar prevInterval = null;\r\n\t\t\tfor(var i = daySchedule.length - 1; i >= 0; i--){\r\n\t\t\t\tif(daySchedule[i].start < timestamp - 1 && daySchedule[i].end >= timestamp - 1){\r\n\t\t\t\t\tisWorkHour = true;\r\n\t\t\t\t\tworkInterval = daySchedule[i];\r\n\t\t\t\t\tprevInterval = daySchedule[i-1];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(isWorkHour){\r\n\r\n\t\t\t\t// we're at the end of worktime interval and subtracting more than the duration of the interval\r\n\t\t\t\t// -> subtract the duration of the interval and move to the start of the interval (we're moving from end)\r\n\t\t\t\tif(timestamp === workInterval.end && left >= workInterval.durationMinutes){\r\n\t\t\t\t\tadded += workInterval.durationMinutes;\r\n\t\t\t\t\tstart = this.$gantt.date.add(start, -workInterval.durationMinutes, \"minute\");\r\n\t\t\t\t} // worktime is set in whole hours (no intervals like 9:15-10:00)\r\n\t\t\t\t// the amount we need to subtract lies inside the interval\r\n\t\t\t\telse if(!minutePrecision && left <= (timestamp/60 - workInterval.startMinute)){\r\n\t\t\t\t\tadded += left;\r\n\t\t\t\t\tstart = this.$gantt.date.add(start, -left, \"minute\");\r\n\t\t\t\t}else if (minutePrecision){\r\n\t\t\t\t\t// GS-2129. If the working time is set in minutes, we accumulate the working time in minutes from right to left\r\n\t\t\t\t\t\r\n\t\t\t\t\t// duration we need to subtract lies completely inside the work interval\r\n\t\t\t\t\tif(left <= (timestamp/60 - workInterval.startMinute)){\r\n\t\t\t\t\t\tadded += left;\r\n\t\t\t\t\t\tstart = this.$gantt.date.add(start, -left, \"minute\");\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\t\t// we need to go trough multiple work intervals to subtract needed time\r\n\t\t\t\t\t\tadded += (timestamp/60 - workInterval.startMinute);\r\n\t\t\t\t\t\tif(prevInterval){\r\n\t\t\t\t\t\t\tstart = new Date(start.getFullYear(), start.getMonth(), start.getDate(), 0, 0, prevInterval.end);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tstart = this.$gantt.date.day_start(start);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\r\n\t\t\t\t}else{\r\n\t\t\t\t\tvar minutesInHour = this._getMinutesPerHour(start);\r\n\t\t\t\t\tif(minutesInHour <= left){\r\n\t\t\t\t\t\tadded += minutesInHour;\r\n\t\t\t\t\t\tstart = this._nextDate(start, \"hour\", step);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\taddedInterval = this._subtractMinutesUntilHourStart(start, left);\r\n\t\t\t\t\t\tadded += addedInterval.added;\r\n\t\t\t\t\t\tstart = addedInterval.end;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tif(start.getHours() === 0 && start.getMinutes() === 0 && start.getSeconds() === 0){\r\n\t\t\t\t\tvar prev = this._getClosestWorkTimePast(start, \"hour\");\r\n\t\t\t\t\tif(prev.valueOf() === start.valueOf()){\r\n\t\t\t\t\t\tvar prev = this.$gantt.date.add(start, -1, \"day\");\r\n\t\t\t\t\t\tvar times = this._getWorkHours(prev);\r\n\t\t\t\t\t\tif(times.length){\r\n\t\t\t\t\t\t\tvar lastInterval = times[times.length - 1];\r\n\t\t\t\t\t\t\tprev.setSeconds(lastInterval.durationSeconds);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tstart = prev;\r\n\r\n\t\t\t\t} else{\r\n\t\t\t\t\tstart = this._getClosestWorkTimePast(new Date(start - 1), \"hour\");\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (added < duration) {\r\n\t\t\tvar durationLeft = duration - added;\r\n\t\t\taddedInterval = this._subtractMinutesUntilHourStart(start, durationLeft);\r\n\t\t\tadded += addedInterval.added;\r\n\t\t\tstart = addedInterval.end;\r\n\t\t}\r\n\r\n\t\treturn start;\r\n\t},\r\n\t_calculateMinuteEndDate: function (from, duration, step) {\r\n\t\tvar start = new Date(from),\r\n\t\t\tadded = 0;\r\n\t\tstep = step || 1;\r\n\t\tduration = Math.abs(duration * 1);\r\n\t\tduration = Math.round(duration);\r\n\r\n\t\tvar addedInterval = this._addMinutesUntilHourEnd(start, duration);\r\n\t\tadded += addedInterval.added;\r\n\r\n\t\tstart = addedInterval.end;\r\n\r\n\t\tvar calculatedDay = 0;\r\n\t\tvar daySchedule = [];\r\n\t\tvar minutesInDay = 0;\r\n\r\n\t\tvar minutePrecision = this._isMinutePrecision(start);\r\n\r\n\t\twhile (added < duration) {\r\n\t\t\tvar dayStart = this.$gantt.date.day_start(new Date(start)).valueOf();\r\n\t\t\tif(dayStart !== calculatedDay){\r\n\t\t\t\tdaySchedule = this._getWorkHours(start);\r\n\t\t\t\tminutesInDay = this._getMinutesPerDay(start);\r\n\t\t\t\tcalculatedDay = dayStart;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar left = duration - added;\r\n\t\t\tvar timestamp = this._getTimeOfDayStamp(start);\r\n\r\n\t\t\tif(!daySchedule.length || !minutesInDay){\r\n\t\t\t\tstart = this.$gantt.date.add(this.$gantt.date.day_start(start), 1, \"day\");\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif(daySchedule[0].start >= timestamp){\r\n\t\t\t\tif(left >= minutesInDay){\r\n\t\t\t\t\tadded += minutesInDay;\r\n\t\t\t\t\tif (left == minutesInDay) {\r\n\t\t\t\t\t\tstart = new Date(start.getFullYear(), start.getMonth(), start.getDate(), 0, 0, daySchedule[daySchedule.length - 1].end);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tstart = this.$gantt.date.add(start, 1, \"day\");\r\n\t\t\t\t\t\tstart = this.$gantt.date.day_start(start);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar isWorkHour = false;\r\n\t\t\tvar workInterval = null;\r\n\t\t\tfor(var i = 0; i < daySchedule.length; i++){\r\n\t\t\t\tif(daySchedule[i].start <= timestamp && daySchedule[i].end > timestamp){\r\n\t\t\t\t\tisWorkHour = true;\r\n\t\t\t\t\tworkInterval = daySchedule[i];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(isWorkHour){\r\n\r\n\t\t\t\tif(timestamp === workInterval.start && left >= workInterval.durationMinutes){\r\n\t\t\t\t\tadded += workInterval.durationMinutes;\r\n\t\t\t\t\tstart = this.$gantt.date.add(start, workInterval.durationMinutes, \"minute\");\r\n\t\t\t\t}else if(left <= (workInterval.endMinute - timestamp/60)){\r\n\t\t\t\t\tadded += left;\r\n\t\t\t\t\tstart = this.$gantt.date.add(start, left, \"minute\");\r\n\t\t\t\t}else{\r\n\t\t\t\t\tvar minutesInHour = this._getMinutesPerHour(start);\r\n\t\t\t\t\tif(minutesInHour <= left){\r\n\t\t\t\t\t\tadded += minutesInHour;\r\n\t\t\t\t\t\t// when the working time settings are set in minutes move to the next minutes\r\n\t\t\t\t\t\tif (minutePrecision) {\r\n\t\t\t\t\t\t\tstart = this.$gantt.date.add(start, minutesInHour, \"minute\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tstart = this._nextDate(start, \"hour\", step);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\taddedInterval = this._addMinutesUntilHourEnd(start, left);\r\n\t\t\t\t\t\tadded += addedInterval.added;\r\n\t\t\t\t\t\tstart = addedInterval.end;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tstart = this._getClosestWorkTimeFuture(start, \"hour\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (added < duration) {\r\n\t\t\tvar durationLeft = duration - added;\r\n\t\t\taddedInterval = this._addMinutesUntilHourEnd(start, durationLeft);\r\n\t\t\tadded += addedInterval.added;\r\n\t\t\tstart = addedInterval.end;\r\n\t\t}\r\n\r\n\t\treturn start;\r\n\t},\r\n\r\n\tgetClosestWorkTime: function () {\r\n\t\tvar settings =  this.argumentsHelper.getClosestWorkTimeArguments.apply( this.argumentsHelper, arguments);\r\n\t\treturn this._getClosestWorkTime(settings.date, settings.unit, settings.dir);\r\n\t},\r\n\r\n\t_getClosestWorkTime: function (inputDate, unit, direction) {\r\n\t\tvar result = new Date(inputDate);\r\n\r\n\t\tif (this._isWorkTime(result, unit)) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tresult = this.$gantt.date[unit + '_start'](result);\r\n\r\n\t\tif (direction == 'any' || !direction) {\r\n\t\t\tvar closestFuture = this._getClosestWorkTimeFuture(result, unit);\r\n\t\t\tvar closestPast = this._getClosestWorkTimePast(result, unit);\r\n\t\t\tif (Math.abs(closestFuture - inputDate) <= Math.abs(inputDate - closestPast)) {\r\n\t\t\t\tresult = closestFuture;\r\n\t\t\t} else {\r\n\t\t\t\tresult = closestPast;\r\n\t\t\t}\r\n\t\t} else if (direction == \"past\") {\r\n\t\t\tresult = this._getClosestWorkTimePast(result, unit);\r\n\t\t} else {\r\n\t\t\tresult = this._getClosestWorkTimeFuture(result, unit);\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t_getClosestWorkTimeFuture: function (date, unit) {\r\n\t\treturn this._getClosestWorkTimeGeneric(date, unit, 1);\r\n\t},\r\n\r\n\t_getClosestWorkTimePast: function (date, unit) {\r\n\t\tvar result = this._getClosestWorkTimeGeneric(date, unit, -1);\r\n\t\t// should return the end of the closest work interval\r\n\t\treturn this.$gantt.date.add(result, 1, unit);\r\n\t},\r\n\r\n\t_findClosestTimeInDay: function(date, direction, worktimes) {\r\n\t\tvar start = new Date(date);\r\n\t\tvar resultDate = null;\r\n\t\tvar fromDayEnd = false;\r\n\t\tif(!this._getWorkHours(start).length){\r\n\t\t\tstart = this._getClosestWorkTime(start, \"day\", direction < 0 ? \"past\" : \"future\");\r\n\t\t\tif(direction < 0){\r\n\t\t\t\tstart = new Date(start.valueOf() - 1);\r\n\t\t\t\tfromDayEnd = true;\r\n\t\t\t}\r\n\t\t\tworktimes = this._getWorkHours(start);\r\n\t\t}\r\n\r\n\t\tvar value = this._getTimeOfDayStamp(start);\r\n\t\tif(fromDayEnd){\r\n\t\t\tvalue = this._getTimeOfDayStamp(new Date(start.valueOf() + 1), fromDayEnd);\r\n\t\t}\r\n\t\tif(direction > 0){\r\n\t\t\tfor(var i = 0; i < worktimes.length; i++){\r\n\t\t\t\tif(worktimes[i].start >= value){\r\n\t\t\t\t\tresultDate = new Date(start.getFullYear(), start.getMonth(), start.getDate(), 0, 0, worktimes[i].start);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tfor(var i = worktimes.length - 1; i >= 0; i--){\r\n\t\t\t\tif(worktimes[i].end <= value){\r\n\t\t\t\t\tresultDate = new Date(start.getFullYear(), start.getMonth(), start.getDate(), 0, 0, worktimes[i].end);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}else if(worktimes[i].end > value && worktimes[i].start <= value) {\r\n\t\t\t\t\tresultDate = new Date(start.getFullYear(), start.getMonth(), start.getDate(), 0, 0, value);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn resultDate;\r\n\t},\r\n\t_getClosestWorkMinute: function(date, unit, direction) {\r\n\t\tvar start = new Date(date);\r\n\t\tvar worktimes = this._getWorkHours(start);\r\n\t\tvar resultDate = this._findClosestTimeInDay(start, direction, worktimes);\r\n\t\tif(!resultDate){\r\n\t\t\tif(direction > 0){\r\n\t\t\t\tstart = this.calculateEndDate(start, direction, unit);\r\n\t\t\t\tstart = this.$gantt.date.day_start(start);\r\n\t\t\t}else{\r\n\t\t\t\tstart = this.calculateEndDate(start, direction, \"day\");\r\n\t\t\t\tstart = this.$gantt.date.day_start(start);\r\n\t\t\t\tstart = this.$gantt.date.add(start, 1, \"day\");\r\n\t\t\t\tstart = new Date(start.valueOf() - 1);\r\n\t\t\t}\r\n\t\t\tworktimes = this._getWorkHours(start);\r\n\t\t\tresultDate = this._findClosestTimeInDay(start, direction, worktimes);\r\n\t\t}\r\n\t\tif(direction < 0){\r\n\t\t\t// getClosestWorkTimePast adds one time unit to the result date after this\r\n\t\t\tresultDate = this.$gantt.date.add(resultDate, -1, unit);\r\n\t\t}\r\n\t\treturn resultDate;\r\n\t},\r\n\r\n\t_getClosestWorkTimeGeneric: function (date, unit, increment) {\r\n\t\tif(unit === \"hour\" || unit === \"minute\"){\r\n\t\t\treturn this._getClosestWorkMinute(date, unit, increment);\r\n\t\t}\r\n\r\n\t\tvar unitOrder = this._getUnitOrder(unit),\r\n\t\t\tbiggerTimeUnit = this.units[unitOrder - 1];\r\n\r\n\t\tvar result = date;\r\n\r\n\t\t// be extra sure we won't fall into infinite loop, 3k seems big enough\r\n\t\tvar maximumLoop = 3000,\r\n\t\t\tcount = 0;\r\n\r\n\t\twhile (!this._isWorkTime(result, unit)) {\r\n\t\t\tif (biggerTimeUnit && !this._isWorkTime(result, biggerTimeUnit)) {\r\n\t\t\t\t// if we look for closest work hour and detect a week-end - first find the closest work day,\r\n\t\t\t\t// and continue iterations after that\r\n\t\t\t\tif (increment > 0) {\r\n\t\t\t\t\tresult = this._getClosestWorkTimeFuture(result, biggerTimeUnit);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult = this._getClosestWorkTimePast(result, biggerTimeUnit);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this._isWorkTime(result, unit)) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tcount++;\r\n\t\t\tif (count > maximumLoop) {\r\n\t\t\t\tthis.$gantt.assert(false, \"Invalid working time check\");\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tvar tzOffset = result.getTimezoneOffset();\r\n\t\t\tresult = this.$gantt.date.add(result, increment, unit);\r\n\r\n\t\t\tresult = this.$gantt._correct_dst_change(result, tzOffset, increment, unit);\r\n\t\t\tif (this.$gantt.date[unit + '_start']) {\r\n\t\t\t\tresult = this.$gantt.date[unit + '_start'](result);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/**\r\n\t * Check whether this calendar has working time. Calendar has working time only if there are regular working days of week\r\n\t *\r\n\t */\r\n\thasWorkTime: function () {\r\n\t\tvar worktime = this.getConfig();\r\n\t\tvar dates = worktime.dates;\r\n\r\n\t\tvar daysOfWeek = [0, 1, 2, 3, 4, 5, 6];\r\n\t\tvar exceptions = [];\r\n\t\tfor(var i in worktime.dates){\r\n\t\t\tif(Number(i) > 6){\r\n\t\t\t\texceptions.push(Number(i));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar hasRegularHours = this._checkWorkHours(worktime.hours);\r\n\r\n\t\tvar result = false;\r\n\t\tdaysOfWeek.forEach((function(day){\r\n\t\t\tif(result){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar dayConfig = dates[day];\r\n\t\t\tif(dayConfig === true){\r\n\t\t\t\t// workday uses global hours\r\n\t\t\t\tresult = hasRegularHours;\r\n\t\t\t}else if(Array.isArray(dayConfig)){\r\n\t\t\t\t// workday uses custom hours\r\n\t\t\t\tresult = this._checkWorkHours(dayConfig);\r\n\t\t\t}\r\n\t\t}).bind(this));\r\n\r\n\t\treturn result;\r\n\r\n\t},\r\n\r\n\t_checkWorkHours: function(hoursArray) {\r\n\t\tif (hoursArray.length === 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar result = false;\r\n\t\tfor (var i = 0; i < hoursArray.length; i += 2) {\r\n\t\t\tif (hoursArray[i] !== hoursArray[i + 1]) {\r\n\t\t\t\tresult = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t_isMinutePrecision: function (date) {\r\n\t\tlet minutePrecision = false;\r\n\t\tthis._getWorkHours(date).forEach(function(interval){\r\n\t\t\tif (interval.startMinute % 60 || interval.endMinute % 60){\r\n\t\t\t\tminutePrecision = true;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn minutePrecision;\r\n\t}\r\n};\r\n\r\nexport default CalendarWorkTimeStrategy;","export default {\r\n\tisLegacyResourceCalendarFormat: function(resourceCalendarsProperty){\r\n\t\t// modern format:\r\n\t\t//gantt.config.resource_calendars = {\r\n\t\t//\tresourceId: calendarId,\r\n\t\t//\tresourceId: calendarId,\r\n\t\t//\tresourceId: calendarId\r\n\t\t//\t};\r\n\t\t\r\n\t\t// legacy format:\r\n\t\t// gantt.config.resource_calendars = {\r\n\t\t//\t\"resourceProperty\": {\r\n\t\t//\t\tresourceId: calendarId,\r\n\t\t//\t\tresourceId: calendarId,\r\n\t\t//\t\tresourceId: calendarId\r\n\t\t//\t\t}\r\n\t\t//\t};\r\n\r\n\t\tif(!resourceCalendarsProperty){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tfor(var i in resourceCalendarsProperty){\r\n\t\t\tif(resourceCalendarsProperty[i] && typeof resourceCalendarsProperty[i] === \"object\"){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t},\r\n\tgetResourceProperty: function(config){\r\n\t\tvar resourceCalendarsConfig = config.resource_calendars;\r\n\t\tvar propertyName = config.resource_property;\r\n\t\tif(this.isLegacyResourceCalendarFormat(resourceCalendarsConfig)){\r\n\t\t\tfor(var i in config){\r\n\t\t\t\tpropertyName = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn propertyName;\r\n\t},\r\n\tgetCalendarIdFromLegacyConfig: function(task, config){\r\n\t\tif (config) {\r\n\t\t\tfor (var field in config) {\r\n\t\t\t\tvar resource = config[field];\r\n\t\t\t\tif (task[field]) {\r\n\t\t\t\t\tvar calendarId = resource[task[field]];\r\n\t\t\t\t\tif (calendarId) {\r\n\t\t\t\t\t\treturn calendarId;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n};","export default function() {\r\n\tfunction getResourcesCalendarKey(resourceAssignments){\r\n\t\treturn resourceAssignments.map(function(res){\r\n\t\t\tif(res && res.resource_id){\r\n\t\t\t\treturn res.resource_id;\r\n\t\t\t} else {\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t}).sort().join(\"-\");\r\n\t}\r\n\r\n\tvar dynamicCalendars = {};\r\n\r\n\tfunction mergeResourceCalendars(resourceAssignments, manager){\r\n\t\treturn manager.mergeCalendars(resourceAssignments.map(function(assignment){\r\n\t\t\tvar resourceId = (assignment && assignment.resource_id) ? assignment.resource_id : assignment;\r\n\t\t\treturn manager.getResourceCalendar(resourceId);\r\n\t\t}));\r\n\t}\r\n\tfunction getCalendarIdFromMultipleResources(resourceAssignments, manager){\r\n\t\tvar key = getResourcesCalendarKey(resourceAssignments);\r\n\t\tif(!resourceAssignments.length){\r\n\t\t\treturn null;\r\n\t\t}else if(resourceAssignments.length === 1){\r\n\t\t\treturn manager.getResourceCalendar(key).id;\r\n\t\t}else if (dynamicCalendars[key]){\r\n\t\t\treturn dynamicCalendars[key].id;\r\n\t\t} else {\r\n\t\t\tvar tempCalendar = mergeResourceCalendars(resourceAssignments, manager);\r\n\r\n\t\t\tdynamicCalendars[key] = tempCalendar;\r\n\t\t\treturn manager.addCalendar(tempCalendar);\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\tgetCalendarIdFromMultipleResources: getCalendarIdFromMultipleResources\r\n\t};\r\n};","import * as utils from \"../../utils/utils\";\r\nimport createArgumentsHelper from \"./calendar_arguments_helper\";\r\nimport CalendarMergeHelper from \"./strategy/work_calendar_merger\";\r\nimport CalendarWorkTimeStrategy from \"./strategy/calendar_strategy\";\r\nimport legacyResourceCalendarConfig from \"./legacy_resource_config\";\r\nimport dynamicResourceCalendarsFactory from \"./dynamic_resource_calendars\";\r\n\r\nconst dynamicResourceCalendars = dynamicResourceCalendarsFactory();\r\n\r\nfunction CalendarManager (gantt){\r\n\tthis.$gantt = gantt;\r\n\tthis._calendars = {};\r\n\tthis._legacyConfig = undefined;\r\n\tthis.$gantt.attachEvent(\"onGanttReady\", function(){\r\n\t\tif(this.$gantt.config.resource_calendars){\r\n\t\t\tthis._isLegacyConfig = legacyResourceCalendarConfig.isLegacyResourceCalendarFormat(this.$gantt.config.resource_calendars);\r\n\t\t}\r\n\t}.bind(this));\r\n\r\n\tthis.$gantt.attachEvent(\"onBeforeGanttReady\", function(){\r\n\t\tthis.createDefaultCalendars();\r\n\t}.bind(this));\r\n\tthis.$gantt.attachEvent(\"onBeforeGanttRender\", function(){\r\n\t\tthis.createDefaultCalendars();\r\n\t}.bind(this));\r\n}\r\n\r\nCalendarManager.prototype = {\r\n\t_calendars: {},\r\n\t_convertWorkTimeSettings: function (settings) {\r\n\t\tconst days = settings.days;\r\n\t\t//GS-2864: opportunity to specify specific dates\r\n\t\tif(typeof days === \"object\" && !Array.isArray(days) && days !== null){\r\n\t\t\tconst datesConfig = {};\r\n\t\t\tif(days?.weekdays){\r\n\t\t\t\tfor(let i = 0; i < 7; i++) {\r\n\t\t\t\t\tdatesConfig[i] = days.weekdays[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (days?.dates) {\r\n\t\t\t\tObject.entries(days.dates).forEach(([date, setting]) => {\r\n\t\t\t\t\tdatesConfig[(new Date(date)).valueOf()] = setting;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tObject.entries(datesConfig).forEach(([key, setting]) => {\r\n\t\t\t\tif (!(setting instanceof Array)) {\r\n\t\t\t\t\tdatesConfig[key] = !!setting;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tsettings = {\r\n\t\t\t\t...settings,\r\n\t\t\t\tdates: datesConfig\r\n\t\t\t};\r\n\r\n\t\t} else if (days && !settings.dates) {\r\n\t\t\tsettings.dates = settings.dates || {};\r\n\t\t\tfor (let i = 0; i < days.length; i++) {\r\n\t\t\t\tsettings.dates[i] = days[i];\r\n\t\t\t\tif (!(days[i] instanceof Array)) {\r\n\t\t\t\t\tsettings.dates[i] = !!days[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tdelete settings.days;\r\n\t\treturn settings;\r\n\t},\r\n\tmergeCalendars: function(){\r\n\t\tvar calendars = [];\r\n\t\tvar args = arguments;\r\n\t\tif(Array.isArray(args[0])){\r\n\t\t\tcalendars = args[0].slice();\r\n\t\t}else{\r\n\t\t\tfor(var i = 0; i < arguments.length; i++){\r\n\t\t\t\tcalendars.push(arguments[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar mergeHelper = new CalendarMergeHelper();\r\n\r\n\t\tvar result;\r\n\t\tcalendars.forEach(function(calendar){\r\n\t\t\tif(!result){\r\n\t\t\t\tresult = calendar;\r\n\t\t\t} else{\r\n\t\t\t\tresult = this._createCalendarFromConfig(mergeHelper.merge(result, calendar));\r\n\t\t\t}\r\n\r\n\t\t}.bind(this));\r\n\t\treturn this.createCalendar(result);\r\n\t},\r\n\r\n\t_createCalendarFromConfig: function(config){\r\n\t\tvar apiCore = new CalendarWorkTimeStrategy(this.$gantt, createArgumentsHelper(this.$gantt));\r\n\t\tapiCore.id = String(utils.uid());\r\n\r\n\t\tvar preparedConfig = this._convertWorkTimeSettings(config);\r\n\t\tif(preparedConfig.customWeeks){\r\n\t\t\tfor(var i in preparedConfig.customWeeks){\r\n\t\t\t\tpreparedConfig.customWeeks[i] = this._convertWorkTimeSettings(preparedConfig.customWeeks[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tapiCore._setConfig(preparedConfig);\r\n\r\n\t\treturn apiCore;\r\n\t},\r\n\r\n\tcreateCalendar: function (parentCalendar) {\r\n\t\tvar settings;\r\n\r\n\t\tif (!parentCalendar) {\r\n\t\t\tparentCalendar = {};\r\n\t\t}\r\n\r\n\t\tif (parentCalendar.getConfig){\r\n\t\t\tsettings = utils.copy(parentCalendar.getConfig());\r\n\t\t} else if (parentCalendar.worktime) {\r\n\t\t\tsettings = utils.copy(parentCalendar.worktime);\r\n\t\t} else {\r\n\t\t\tsettings = utils.copy(parentCalendar);\r\n\t\t}\r\n\r\n\t\tvar defaults = utils.copy(this.defaults.fulltime.worktime);\r\n\t\tutils.mixin(settings, defaults);\r\n\r\n\t\treturn this._createCalendarFromConfig(settings);\r\n\t},\r\n\r\n\tgetCalendar: function (id) {\r\n\t\tid = id || \"global\";\r\n\t\tvar calendar = this._calendars[id];\r\n\t\tif(!calendar){\r\n\t\t\tthis.createDefaultCalendars();\r\n\t\t\tcalendar = this._calendars[id];\r\n\t\t}\r\n\r\n\t\treturn calendar;\r\n\t},\r\n\r\n\tgetCalendars: function () {\r\n\t\tvar res = [];\r\n\t\tfor (var i in this._calendars) {\r\n\t\t\tres.push(this.getCalendar(i));\r\n\t\t}\r\n\t\treturn res;\r\n\t},\r\n\r\n\t_getOwnCalendar: function(task){\r\n\t\tvar config = this.$gantt.config;\r\n\t\tif (task[config.calendar_property]) {\r\n\t\t\treturn this.getCalendar(task[config.calendar_property]);\r\n\t\t}\r\n\r\n\t\tif (config.resource_calendars) {\r\n\t\t\tvar calendar;\r\n\t\t\tvar calendarId;\r\n\t\t\tvar resourceProperty;\r\n\t\t\tif(this._legacyConfig === false){\r\n\t\t\t\tresourceProperty = config.resource_property;\r\n\t\t\t}else{\r\n\t\t\t\tresourceProperty = legacyResourceCalendarConfig.getResourceProperty(config);\r\n\t\t\t}\r\n\t\t\t// GS-2821. If no resource is assigned to a task,\r\n\t\t\t// there is no need to check the resource calendar\r\n\t\t\tif(Array.isArray(task[resourceProperty]) && task[resourceProperty].length){\r\n\t\t\t\t// if multiple resources are attached to the task - merge their calendars\r\n\t\t\t\tif(config.dynamic_resource_calendars){\r\n\t\t\t\t\tcalendarId = dynamicResourceCalendars.getCalendarIdFromMultipleResources(task[resourceProperty], this);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcalendar = this.getResourceCalendar(task[resourceProperty]);\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tif(this._legacyConfig === undefined){\r\n\t\t\t\t\tthis._legacyConfig = legacyResourceCalendarConfig.isLegacyResourceCalendarFormat(config.resource_calendars);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(this._legacyConfig){\r\n\t\t\t\t\tvar calendarId = legacyResourceCalendarConfig.getCalendarIdFromLegacyConfig(task, config.resource_calendars);\r\n\t\t\t\t}else if(resourceProperty && task[resourceProperty] && config.resource_calendars[task[resourceProperty]]){\r\n\t\t\t\t\tvar calendar = this.getResourceCalendar(task[resourceProperty]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(calendarId){\r\n\t\t\t\tcalendar = this.getCalendar(calendarId);\r\n\t\t\t}\r\n\r\n\t\t\tif(calendar){\r\n\t\t\t\treturn calendar;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\t/**\r\n\t * Returns calendar assigned to the specified resource.\r\n\t * Returns the global calendar if no custom calendar is associated with the resource.\r\n\t * @param {(string|number|Object)} resource - resource object or resource id\r\n\t * @returns {object} Calendar object\r\n\t */\r\n\tgetResourceCalendar: function(resource) {\r\n\t\tif (resource === null || resource === undefined) {\r\n\t\t\treturn this.getCalendar();\r\n\t\t}\r\n\r\n\t\tvar resourceId = null;\r\n\t\t// if task id is provided\r\n\t\tif((typeof resource === \"number\" || typeof resource === \"string\")){\r\n\t\t\tresourceId = resource;\r\n\t\t}else{\r\n\t\t\tresourceId = resource.id || resource.key;\r\n\t\t}\r\n\r\n\t\tvar config = this.$gantt.config;\r\n\t\tvar calendarsConfig = config.resource_calendars;\r\n\t\tvar calendarId = null;\r\n\r\n\t\t// GS-1714: if resource is specified through array\r\n\t\tif (Array.isArray(resource)){\r\n\t\t\tif (resource.length === 1){\r\n\t\t\t\tif (typeof resource[0] === 'object'){\r\n\t\t\t\t\tresourceId = resource[0].resource_id; // if resource: [\"resource_id: \"6\", value: \"4\", ...\"]\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresourceId = resource[0]; // if resource: [1]\r\n\t\t\t\t}\r\n\t\t\t} \r\n\t\t}\r\n\t\t\r\n\t\tif (calendarsConfig) {\r\n\t\t\tif(this._legacyConfig === undefined){\r\n\t\t\t\tthis._legacyConfig = legacyResourceCalendarConfig.isLegacyResourceCalendarFormat(config.resource_calendars);\r\n\t\t\t}\r\n\r\n\t\t\tif(this._legacyConfig){\r\n\t\t\t\tfor(var field in calendarsConfig){\r\n\t\t\t\t\tif(calendarsConfig[field][resourceId]){\r\n\t\t\t\t\t\tcalendarId = calendarsConfig[field][resourceId];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tvar calendarId = calendarsConfig[resourceId];\r\n\t\t\t}\r\n\r\n\t\t\tif(calendarId){\r\n\t\t\t\treturn this.getCalendar(calendarId);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\treturn this.getCalendar();\r\n\t},\r\n\r\n\t/**\r\n\t * Returns the calendar assigned to a task.\r\n\t * - Returns a calendar assigned via task[gantt.config.calendar_property] if specified.\r\n\t * - Returns a calendar assigned to the task resource if specified.\r\n\t * - Returns the global calendar otherwise.\r\n\t * @param {(string|number|Object)} task - task object or task id\r\n\t * @returns {object} Calendar object\r\n\t */\r\n\tgetTaskCalendar: function (task) {\r\n\t\tvar gantt = this.$gantt;\r\n\t\tvar taskObject;\r\n\t\tif (task === null || task === undefined) {\r\n\t\t\treturn this.getCalendar();\r\n\t\t}\r\n\r\n\t\t// if task id is provided\r\n\t\tif((typeof task === \"number\" || typeof task === \"string\") && gantt.isTaskExists(task)){\r\n\t\t\ttaskObject = gantt.getTask(task);\r\n\t\t}else{\r\n\t\t\ttaskObject = task;\r\n\t\t}\r\n\r\n\t\tif(!taskObject){\r\n\t\t\treturn this.getCalendar();\r\n\t\t}\r\n\r\n\t\tvar calendar = this._getOwnCalendar(taskObject);\r\n\t\tvar groupMode = !!gantt.getState().group_mode;\r\n\r\n\t\tif (!calendar && gantt.config.inherit_calendar && gantt.isTaskExists(taskObject.parent)){\r\n\t\t\t// GS-1579  group mode overrides tree hierarchy, iterate using `.parent` property, instead of using eachParent iterator\r\n\t\t\tvar currentTask = taskObject;\r\n\t\t\twhile(gantt.isTaskExists(currentTask.parent)){\r\n\t\t\t\tcurrentTask = gantt.getTask(currentTask.parent);\r\n\t\t\t\tif(gantt.isSummaryTask(currentTask)){\r\n\t\t\t\t\tcalendar = this._getOwnCalendar(currentTask);\r\n\t\t\t\t\tif(calendar){\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(groupMode && !calendar){\r\n\t\t\t\t// if group mode and inherit_calendars is enabled - preserve previously applied parent calendar\r\n\t\t\t\t// we may need it when groupBy parses grouped data, old parent may be not loaded yet\r\n\t\t\t\tif(task.$effective_calendar){\r\n\t\t\t\t\tcalendar = this.getCalendar(task.$effective_calendar);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn calendar || this.getCalendar();\r\n\t},\r\n\r\n\taddCalendar: function(calendar) { // puts new calendar to Global Storage - gantt.calendarManager._calendars {}\r\n\t\tif (!(this.isCalendar(calendar))) {\r\n\t\t\tvar id = calendar.id;\r\n\t\t\tcalendar = this.createCalendar(calendar);\r\n\t\t\tcalendar.id = id;\r\n\t\t}\r\n\r\n\t\t// validate/check if empty calendar\r\n\t\tif (!calendar._tryChangeCalendarSettings(function () {\r\n\t\t\t})) {\r\n\r\n\t\t\tthis.$gantt.callEvent(\"onCalendarError\", [{message: \"Invalid calendar settings, no worktime available\"}, calendar]);\r\n\t\t\treturn null;\r\n\t\t} else {\r\n\t\t\tvar config = this.$gantt.config;\r\n\r\n\t\t\tcalendar.id = calendar.id || utils.uid();\r\n\t\t\tthis._calendars[calendar.id] = calendar;\r\n\t\t\tif (!config.worktimes)\r\n\t\t\t\tconfig.worktimes = {};\r\n\t\t\tconfig.worktimes[calendar.id] = calendar.getConfig();\r\n\t\t\treturn calendar.id;\r\n\t\t}\r\n\t},\r\n\r\n\tdeleteCalendar: function (calendar) {\r\n\t\tvar config = this.$gantt.config;\r\n\t\tif (!calendar) return false;\r\n\t\tif (this._calendars[calendar]) {\r\n\t\t\tdelete this._calendars[calendar];\r\n\t\t\tif (config.worktimes && config.worktimes[calendar])\r\n\t\t\t\tdelete config.worktimes[calendar];\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t},\r\n\r\n\trestoreConfigCalendars: function (configs) {\r\n\t\tfor (var i in configs) {\r\n\t\t\tif (this._calendars[i])\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tvar settings = configs[i];\r\n\t\t\tvar calendar = this.createCalendar(settings);\r\n\t\t\tcalendar.id = i;\r\n\t\t\tthis.addCalendar(calendar);\r\n\t\t}\r\n\t},\r\n\r\n\tdefaults: {\r\n\t\tglobal: {\r\n\t\t\tid: \"global\",\r\n\t\t\tworktime: {\r\n\t\t\t\thours: [8, 12, 13, 17],\r\n\t\t\t\tdays: [0, 1, 1, 1, 1, 1, 0]\r\n\t\t\t}\r\n\t\t},\r\n\t\tfulltime: {\r\n\t\t\tid: \"fulltime\",\r\n\t\t\tworktime: {\r\n\t\t\t\thours: [0, 24],\r\n\t\t\t\tdays: [1, 1, 1, 1, 1, 1, 1]\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tcreateDefaultCalendars: function () {\r\n\t\tvar config = this.$gantt.config;\r\n\t\tthis.restoreConfigCalendars(this.defaults);\r\n\t\tthis.restoreConfigCalendars(config.worktimes);\r\n\t},\r\n\r\n\tisCalendar: function(possibleCalendar) {\r\n\t\t// because we don't have any way to check without dependency to CalendarWorkTimeStrategy\r\n\t\tvar props = [\r\n\t\t\tpossibleCalendar.isWorkTime,\r\n\t\t\tpossibleCalendar.setWorkTime,\r\n\t\t\tpossibleCalendar.getWorkHours,\r\n\t\t\tpossibleCalendar.unsetWorkTime,\r\n\t\t\tpossibleCalendar.getClosestWorkTime,\r\n\t\t\tpossibleCalendar.calculateDuration,\r\n\t\t\tpossibleCalendar.hasDuration,\r\n\t\t\tpossibleCalendar.calculateEndDate\r\n\t\t];\r\n\t\treturn props.every(function(entry) {\r\n\t\t\treturn entry instanceof Function;\r\n\t\t});\r\n\t}\r\n};\r\n\r\nexport default CalendarManager;","function CalendarDisabledTimeStrategy(gantt, argumentsHelper){\r\n\tthis.argumentsHelper = argumentsHelper;\r\n\tthis.$gantt = gantt;\r\n}\r\n\r\nCalendarDisabledTimeStrategy.prototype = {\r\n\tgetWorkHours: function () {\r\n\t\treturn [0, 24];\r\n\t},\r\n\tsetWorkTime: function () {\r\n\t\treturn true;\r\n\t},\r\n\tunsetWorkTime: function () {\r\n\t\treturn true;\r\n\t},\r\n\tisWorkTime: function () {\r\n\t\treturn true;\r\n\t},\r\n\tgetClosestWorkTime: function (config) {\r\n\t\tvar config = this.argumentsHelper.getClosestWorkTimeArguments.apply(this.argumentsHelper, arguments);\r\n\t\treturn config.date;\r\n\t},\r\n\r\n\tcalculateDuration: function () {\r\n\t\tvar config = this.argumentsHelper.getDurationArguments.apply(this.argumentsHelper, arguments);\r\n\t\tvar from = config.start_date,\r\n\t\t\tto = config.end_date,\r\n\t\t\tunit = config.unit,\r\n\t\t\tstep = config.step;\r\n\r\n\t\treturn this._calculateDuration(from, to, unit, step);\r\n\t},\r\n\t_calculateDuration: function (start, end, unit, step) {\r\n\t\tvar dateHelper = this.$gantt.date;\r\n\t\tvar fixedUnits = {\r\n\t\t\t\"week\": 1000 * 60 * 60 * 24 * 7,\r\n\t\t\t\"day\": 1000 * 60 * 60 * 24,\r\n\t\t\t\"hour\": 1000 * 60 * 60,\r\n\t\t\t\"minute\": 1000 * 60\r\n\t\t};\r\n\r\n\t\tvar res = 0;\r\n\t\tif (fixedUnits[unit]) {\r\n\t\t\tres = Math.round((end - start) / (step * fixedUnits[unit]));\r\n\t\t} else {\r\n\t\t\tvar from = new Date(start),\r\n\t\t\t\tto = new Date(end);\r\n\t\t\twhile (from.valueOf() < to.valueOf()) {\r\n\t\t\t\tres += 1;\r\n\t\t\t\tfrom = dateHelper.add(from, step, unit);\r\n\t\t\t}\r\n\r\n\t\t\tif (from.valueOf() != end.valueOf()) {\r\n\t\t\t\tres += (to - from) / (dateHelper.add(from, step, unit) - from);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn Math.round(res);\r\n\t},\r\n\r\n\thasDuration: function () {\r\n\t\tvar config = this.argumentsHelper.getDurationArguments.apply(this.argumentsHelper, arguments);\r\n\t\tvar from = config.start_date,\r\n\t\t\tto = config.end_date,\r\n\t\t\tunit = config.unit;\r\n\r\n\t\tif (!unit) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tfrom = new Date(from);\r\n\t\tto = new Date(to);\r\n\r\n\t\treturn (from.valueOf() < to.valueOf());\r\n\t},\r\n\r\n\thasWorkTime: function() {\r\n\t\treturn true;\r\n\t},\r\n\r\n\tequals: function(calendar) {\r\n\t\tif(!(calendar instanceof CalendarDisabledTimeStrategy)){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\tcalculateEndDate: function () {\r\n\t\tvar config = this.argumentsHelper.calculateEndDateArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tvar start = config.start_date,\r\n\t\t\tduration = config.duration,\r\n\t\t\tunit = config.unit,\r\n\t\t\tstep = config.step;\r\n\r\n\t\treturn this.$gantt.date.add(start, step * duration, unit);\r\n\t}\r\n};\r\n\r\nexport default CalendarDisabledTimeStrategy;","import createArgumentsHelper from \"./calendar_arguments_helper\";\r\nimport NoWorkTimeCalendar from \"./strategy/no_work_time\";\r\n\r\nfunction TimeCalculator(calendarManager){\r\n\r\n\tthis.$gantt = calendarManager.$gantt;\r\n\tthis.argumentsHelper = createArgumentsHelper(this.$gantt);\r\n\tthis.calendarManager = calendarManager;\r\n\tthis.$disabledCalendar = new NoWorkTimeCalendar(this.$gantt, this.argumentsHelper);\r\n}\r\n\r\nTimeCalculator.prototype = {\r\n\t_getCalendar: function (config) {\r\n\t\tvar calendar;\r\n\t\tif (!this.$gantt.config.work_time) {\r\n\t\t\tcalendar = this.$disabledCalendar;\r\n\t\t} else {\r\n\t\t\tvar manager = this.calendarManager;\r\n\t\t\tif (config.task) {\r\n\t\t\t\tcalendar = manager.getTaskCalendar(config.task);\r\n\t\t\t} else if (config.id) {\r\n\t\t\t\tcalendar = manager.getTaskCalendar(config);\r\n\t\t\t} else if (config.calendar) {\r\n\t\t\t\tcalendar = config.calendar;\r\n\t\t\t}\r\n\t\t\tif (!calendar) {\r\n\t\t\t\tcalendar = manager.getTaskCalendar();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn calendar;\r\n\t},\r\n\r\n\tgetWorkHours: function (config) {\r\n\t\tconfig = this.argumentsHelper.getWorkHoursArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tvar calendar = this._getCalendar(config);\r\n\r\n\t\treturn calendar.getWorkHours(config.date);\r\n\t},\r\n\r\n\tsetWorkTime: function (config, calendar) {\r\n\t\tconfig = this.argumentsHelper.setWorkTimeArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tif (!calendar)\r\n\t\t\tcalendar = this.calendarManager.getCalendar(); // Global\r\n\t\treturn calendar.setWorkTime(config);\r\n\t},\r\n\r\n\tunsetWorkTime: function (config, calendar) {\r\n\t\tconfig = this.argumentsHelper.unsetWorkTimeArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tif (!calendar)\r\n\t\t\tcalendar = this.calendarManager.getCalendar(); // Global\r\n\t\treturn calendar.unsetWorkTime(config);\r\n\t},\r\n\tisWorkTime: function (date, unit, task, calendar) {\r\n\t\tvar config = this.argumentsHelper.isWorkTimeArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tcalendar = this._getCalendar(config);\r\n\t\treturn calendar.isWorkTime(config);\r\n\t},\r\n\tgetClosestWorkTime: function (config) {\r\n\t\tconfig = this.argumentsHelper.getClosestWorkTimeArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tvar calendar = this._getCalendar(config);\r\n\r\n\t\treturn calendar.getClosestWorkTime(config);\r\n\t},\r\n\r\n\tcalculateDuration: function () { // start_date_date, end_date, task\r\n\t\tvar config = this.argumentsHelper.getDurationArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\r\n\t\tvar calendar = this._getCalendar(config);\r\n\t\treturn calendar.calculateDuration(config);\r\n\t},\r\n\thasDuration: function () {\r\n\t\tvar config = this.argumentsHelper.hasDurationArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tvar calendar = this._getCalendar(config);\r\n\r\n\t\treturn calendar.hasDuration(config);\r\n\t},\r\n\tcalculateEndDate: function (config) { // start_date, duration, unit, task\r\n\t\tvar config = this.argumentsHelper.calculateEndDateArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tvar calendar = this._getCalendar(config);\r\n\t\treturn calendar.calculateEndDate(config);\r\n\t}\r\n};\r\n\r\nexport default TimeCalculator;\r\n\r\n","// TODO: rework public api for date methods\r\nimport * as utils from \"../../utils/utils\";\r\n\r\nvar createWorkTimeFacade = function(calendarManager, timeCalculator){\r\n\treturn {\r\n\t\tgetWorkHours: function (date) {\r\n\t\t\treturn timeCalculator.getWorkHours(date);\r\n\t\t},\r\n\r\n\t\tsetWorkTime: function (config) {\r\n\t\t\treturn timeCalculator.setWorkTime(config);\r\n\t\t},\r\n\r\n\t\tunsetWorkTime: function (config) {\r\n\t\t\ttimeCalculator.unsetWorkTime(config);\r\n\t\t},\r\n\r\n\t\tisWorkTime: function (date, unit, task) {\r\n\t\t\treturn timeCalculator.isWorkTime(date, unit, task);\r\n\t\t},\r\n\r\n\t\tgetClosestWorkTime: function (config) {\r\n\t\t\treturn timeCalculator.getClosestWorkTime(config);\r\n\t\t},\r\n\r\n\t\tcalculateDuration: function (start_date, end_date, task) {\r\n\t\t\treturn timeCalculator.calculateDuration(start_date, end_date, task);\r\n\t\t},\r\n\t\t_hasDuration: function (start_date, end_date, task) {\r\n\t\t\treturn timeCalculator.hasDuration(start_date, end_date, task);\r\n\t\t},\r\n\r\n\t\tcalculateEndDate: function (start, duration, unit, task) {\r\n\t\t\treturn timeCalculator.calculateEndDate(start, duration, unit, task);\r\n\t\t},\r\n\r\n\t\tmergeCalendars: utils.bind(calendarManager.mergeCalendars, calendarManager),\r\n\t\tcreateCalendar: utils.bind(calendarManager.createCalendar, calendarManager),\r\n\t\taddCalendar: utils.bind(calendarManager.addCalendar, calendarManager),\r\n\t\tgetCalendar: utils.bind(calendarManager.getCalendar, calendarManager),\r\n\t\tgetCalendars: utils.bind(calendarManager.getCalendars, calendarManager),\r\n\t\tgetResourceCalendar: utils.bind(calendarManager.getResourceCalendar, calendarManager),\r\n\t\tgetTaskCalendar: utils.bind(calendarManager.getTaskCalendar, calendarManager),\r\n\t\tdeleteCalendar: utils.bind(calendarManager.deleteCalendar, calendarManager)\r\n\t};\r\n};\r\n\r\n\r\nexport default { create: createWorkTimeFacade };","import CalendarManager from \"./calendar_manager\";\r\nimport TimeCalculator from \"./time_calculator\";\r\nimport worktimeFacadeFactory from \"../facades/worktime_calendars\";\r\nimport * as utils from \"../../utils/utils\";\r\n\r\nexport default function (gantt) {\r\n\tvar manager = new CalendarManager(gantt),\r\n\ttimeCalculator = new TimeCalculator(manager);\r\n\tvar facade = worktimeFacadeFactory.create(manager, timeCalculator);\r\n\tutils.mixin(gantt, facade);\r\n};\r\n","import * as helpers from \"../utils/helpers\";\r\n\r\nexport default function(gantt) {\r\n\r\n\tgantt.isUnscheduledTask = function (task) {\r\n\t\tgantt.assert(task && task instanceof Object, \"Invalid argument <b>task</b>=\"+task+\" of gantt.isUnscheduledTask. Task object was expected\");\r\n\t\treturn (!!task.unscheduled || !task.start_date);\r\n\t};\r\n\r\n\tgantt._isAllowedUnscheduledTask = function (task) {\r\n\t\treturn !!(task.unscheduled && gantt.config.show_unscheduled);\r\n\t};\r\n\r\n\tgantt._isTaskInTimelineLimits = function(task) {\r\n\t\tvar taskStart = task.start_date ? task.start_date.valueOf() : null;\r\n\t\tvar taskEnd = task.end_date ? task.end_date.valueOf() : null;\r\n\t\treturn !!(taskStart && taskEnd && taskStart <= this._max_date.valueOf() && taskEnd >= this._min_date.valueOf());\r\n\t};\r\n\tgantt.isTaskVisible = function (id) {\r\n\t\tif (!this.isTaskExists(id)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar task = this.getTask(id);\r\n\t\tif (!(this._isAllowedUnscheduledTask(task) || this._isTaskInTimelineLimits(task))) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn !!(this.getGlobalTaskIndex(id) >= 0);\r\n\t};\r\n\r\n\tgantt._getProjectEnd = function() {\r\n\t\tif(gantt.config.project_end){\r\n\t\t\treturn gantt.config.project_end;\r\n\t\t}else{\r\n\t\t\tvar tasks = gantt.getTaskByTime();\r\n\t\t\ttasks = tasks.sort(function (a, b) {\r\n\t\t\t\treturn +a.end_date > +b.end_date ? 1 : -1;\r\n\t\t\t});\r\n\t\t\treturn tasks.length ? tasks[tasks.length - 1].end_date : null;\r\n\t\t}\r\n\t};\r\n\tgantt._getProjectStart = function() {\r\n\t\tif (gantt.config.project_start) {\r\n\t\t\treturn gantt.config.project_start;\r\n\t\t}\r\n\r\n\t\t// use timeline start if project start is not specified\r\n\t\tif (gantt.config.start_date) {\r\n\t\t\treturn gantt.config.start_date;\r\n\t\t}\r\n\t\tif (gantt.getState().min_date) {\r\n\t\t\treturn gantt.getState().min_date;\r\n\t\t}\r\n\r\n\t\t// earliest task start if neither project start nor timeline are specified\r\n\t\tvar tasks = gantt.getTaskByTime();\r\n\t\ttasks = tasks.sort(function (a, b) {\r\n\t\t\treturn +a.start_date > +b.start_date ? 1 : -1;\r\n\t\t});\r\n\t\treturn tasks.length ? tasks[0].start_date : null;\r\n\t};\r\n\r\n\tvar getDefaultTaskDate = function (item, parent_id) {\r\n\t\tvar parentExists = parent_id && parent_id != gantt.config.root_id && gantt.isTaskExists(parent_id);\r\n\t\tvar parent = parentExists ? gantt.getTask(parent_id) : false,\r\n\t\t\tstartDate = null;\r\n\t\tif (parent) {\r\n\t\t\tif(gantt._getAutoSchedulingConfig().schedule_from_end){\r\n\t\t\t\tstartDate = gantt.calculateEndDate({\r\n\t\t\t\t\tstart_date: parent.end_date,\r\n\t\t\t\t\tduration: - gantt.config.duration_step,\r\n\t\t\t\t\ttask:item\r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\tif(!parent.start_date){\r\n\t\t\t\t\treturn getDefaultTaskDate(parent, gantt.getParent(parent));\r\n\t\t\t\t}\r\n\t\t\t\tstartDate = parent.start_date;\r\n\t\t\t}\r\n\r\n\t\t} else if(gantt._getAutoSchedulingConfig().schedule_from_end) {\r\n\t\t\tstartDate = gantt.calculateEndDate({\r\n\t\t\t\tstart_date: gantt._getProjectEnd(),\r\n\t\t\t\tduration: - gantt.config.duration_step,\r\n\t\t\t\ttask:item\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tconst first = gantt.getTaskByIndex(0);\r\n\t\t\tconst minDate = gantt.config.start_date || gantt.getState().min_date;\r\n\r\n\t\t\tif (first){\r\n\t\t\t\tif (first.start_date){\r\n\t\t\t\t\tstartDate = first.start_date;\r\n\t\t\t\t}\r\n\t\t\t\telse if (first.end_date){\r\n\t\t\t\t\tstartDate = gantt.calculateEndDate({\r\n\t\t\t\t\t\tstart_date: first.end_date,\r\n\t\t\t\t\t\tduration: -gantt.config.duration_step,\r\n\t\t\t\t\t\ttask:item\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tstartDate = minDate;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tstartDate = minDate;\r\n\t\t\t}\r\n\t\t}\r\n\t\tgantt.assert(startDate, \"Invalid dates\");\r\n\t\treturn new Date(startDate);\r\n\t};\r\n\r\n\tgantt._set_default_task_timing = function (task) {\r\n\t\ttask.start_date = task.start_date || getDefaultTaskDate(task, gantt.getParent(task));\r\n\t\ttask.duration = task.duration || gantt.config.duration_step;\r\n\t\ttask.end_date = task.end_date || gantt.calculateEndDate(task);\r\n\t};\r\n\r\n\tgantt.createTask = function (item, parent, index) {\r\n\t\titem = item || {};\r\n\r\n\t\tif (!gantt.defined(item.id))\r\n\t\t\titem.id = gantt.uid();\r\n\r\n\t\tif (!item.start_date) {\r\n\t\t\titem.start_date = getDefaultTaskDate(item, parent);\r\n\t\t}\r\n\t\tif (item.text === undefined) {\r\n\t\t\titem.text = gantt.locale.labels.new_task;\r\n\t\t}\r\n\t\tif (item.duration === undefined) {\r\n\t\t\titem.duration = 1;\r\n\t\t}\r\n\r\n\t\tif (this.isTaskExists(parent)) {\r\n\t\t\tthis.setParent(item, parent, true);\r\n\t\t\tvar parentObj = this.getTask(parent);\r\n\t\t\tparentObj.$open = true;\r\n\t\t\t// GS-1583. Save the $open state to the Undo Stack\r\n\t\t\tif (!this.config.details_on_create){\r\n\t\t\t\tthis.callEvent(\"onAfterParentExpand\", [parent, parentObj]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!this.callEvent(\"onTaskCreated\", [item])) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (this.config.details_on_create) {\r\n\t\t\t//GS-761: assert unique ID\r\n\t\t\tif (gantt.isTaskExists(item.id)){\r\n\t\t\t\tvar task = gantt.getTask(item.id);\r\n\t\t\t\tif (task.$index != item.$index) {\r\n\t\t\t\t\t// Someone may try to mistakenly add a task with the same ID, and most likely\r\n\t\t\t\t\t// use the string format for the dates. Gantt shouldn't break in this scenario\r\n\t\t\t\t\tif (item.start_date && typeof item.start_date === \"string\"){\r\n\t\t\t\t\t\titem.start_date = this.date.parseDate(item.start_date, \"parse_date\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (item.end_date && typeof item.end_date === \"string\"){\r\n\t\t\t\t\t\titem.end_date = this.date.parseDate(item.end_date, \"parse_date\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.$data.tasksStore.updateItem(item.id, item);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\titem.$new = true;\r\n\t\t\t\tthis.silent(function(){\r\n\t\t\t\t\tgantt.$data.tasksStore.addItem(item, index);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tthis.selectTask(item.id);\r\n\t\t\tthis.refreshData();\r\n\t\t\tthis.showLightbox(item.id);\r\n\t\t} else {\r\n\t\t\tif (this.addTask(item, parent, index)) {\r\n\t\t\t\tthis.showTask(item.id);\r\n\t\t\t\tthis.selectTask(item.id);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn item.id;\r\n\t};\r\n\r\n\tgantt._update_flags = function (oldid, newid) {\r\n\t\t//  TODO: need a proper way to update all possible flags\r\n\t\tvar store = gantt.$data.tasksStore;\r\n\t\tif (oldid === undefined) {\r\n\t\t\tthis._lightbox_id = null;\r\n\r\n\t\t\tstore.silent(function(){\r\n\t\t\t\tstore.unselect();\r\n\t\t\t});\r\n\t\t\t// GS-1522. If we have multiselect, unselect all previously selected tasks\r\n\t\t\tif (this.getSelectedTasks) {\r\n\t\t\t\tthis._multiselect.reset();\r\n\t\t\t}\r\n\r\n\t\t\tif (this._tasks_dnd && this._tasks_dnd.drag) {\r\n\t\t\t\tthis._tasks_dnd.drag.id = null;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (this._lightbox_id == oldid)\r\n\t\t\t\tthis._lightbox_id = newid;\r\n\r\n\t\t\t// TODO: probably can be removed\r\n\t\t\tif (store.getSelectedId() == oldid) {\r\n\t\t\t\tstore.silent(function(){\r\n\t\t\t\t\tstore.unselect(oldid);\r\n\t\t\t\t\tstore.select(newid);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif (this._tasks_dnd && this._tasks_dnd.drag && this._tasks_dnd.drag.id == oldid) {\r\n\t\t\t\tthis._tasks_dnd.drag.id = newid;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tvar getTaskTimingMode = function (task, force) {\r\n\t\tvar task_type = gantt.getTaskType(task.type);\r\n\r\n\t\tvar state = {\r\n\t\t\ttype: task_type,\r\n\t\t\t$no_start: false,\r\n\t\t\t$no_end: false,\r\n\t\t\tscheduled_summary: false\r\n\t\t};\r\n\r\n\t\tif(task_type === gantt.config.types.project && task.auto_scheduling === false){\r\n\t\t\tstate.scheduled_summary = true;\r\n\t\t}\r\n\r\n\t\tif (!force && task_type == task.$rendered_type) {\r\n\t\t\tstate.$no_start = task.$no_start;\r\n\t\t\tstate.$no_end = task.$no_end;\r\n\t\t\treturn state;\r\n\t\t}\r\n\r\n\t\tif (task_type == gantt.config.types.project) {\r\n\t\t\t//project duration is always defined by children duration\r\n\t\t\tstate.$no_end = state.$no_start = true;\r\n\t\t} else if (task_type != gantt.config.types.milestone) {\r\n\t\t\t//tasks can have fixed duration, children duration(as projects), or one date fixed, and other defined by nested items\r\n\t\t\tstate.$no_end = !(task.end_date || task.duration);\r\n\t\t\tstate.$no_start = !task.start_date;\r\n\r\n\t\t\tif (gantt._isAllowedUnscheduledTask(task)) {\r\n\t\t\t\tstate.$no_end = state.$no_start = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn state;\r\n\t};\r\n\r\n\tgantt._init_task_timing = function (task) {\r\n\t\tvar task_mode = getTaskTimingMode(task, true);\r\n\r\n\t\tvar dirty = task.$rendered_type != task_mode.type;\r\n\r\n\t\tvar task_type = task_mode.type;\r\n\r\n\t\tif (dirty) {\r\n\t\t\ttask.$no_start = task_mode.$no_start;\r\n\t\t\ttask.$no_end = task_mode.$no_end;\r\n\t\t\ttask.$rendered_type = task_mode.type;\r\n\t\t}\r\n\r\n\t\tif (dirty && task_type != this.config.types.milestone) {\r\n\t\t\tif (task_type == this.config.types.project) {\r\n\t\t\t\t//project duration is always defined by children duration\r\n\t\t\t\tthis._set_default_task_timing(task);\r\n\t\t\t\ttask.$calculate_duration = false;// do not recalculate duration below\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (task_type == this.config.types.milestone) {\r\n\t\t\ttask.end_date = task.start_date;\r\n\t\t}\r\n\t\tif (task.start_date && task.end_date && task.$calculate_duration !== false) {\r\n\t\t\ttask.duration = this.calculateDuration(task);\r\n\t\t}\r\n\r\n\t\tif(!task.$calculate_duration){\r\n\t\t\ttask.$calculate_duration = true;\r\n\t\t}\r\n\r\n\t\tif (!task.end_date) {\r\n\t\t\ttask.end_date = task.start_date;\r\n\t\t}\r\n\r\n\t\ttask.duration = task.duration || 0;\r\n\t\t// GS-1145. We should let tasks to have 0 duration if user wants it\r\n\t\tif (this.config.min_duration === 0 && task.duration === 0){\r\n\t\t\ttask.$no_end = false;\r\n\t\t\t//GS-2813: special case for project that has 0 duration with milestone child\r\n\t\t\tif(task.type === gantt.config.types.project && gantt.hasChild(task.id)){\r\n\t\t\t\ttask.$no_end = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// work calendar of task has changed\r\n\t\tvar effectiveCalendar = this.getTaskCalendar(task);\r\n\t\tif(task.$effective_calendar && task.$effective_calendar !== effectiveCalendar.id){\r\n\t\t\tupdateTaskTiming(task);\r\n\t\t\tif(this.config.inherit_calendar && this.isSummaryTask(task)){\r\n\t\t\t\tthis.eachTask(function(child){\r\n\t\t\t\t\tupdateTaskTiming(child);\r\n\t\t\t\t}, task.id);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttask.$effective_calendar = effectiveCalendar.id;\r\n\t};\r\n\r\n\tfunction updateTaskTiming(task) {\r\n\t\ttask.$effective_calendar = gantt.getTaskCalendar(task).id;\r\n\t\ttask.start_date = gantt.getClosestWorkTime({\r\n\t\t\tdir: \"future\",\r\n\t\t\tdate: task.start_date,\r\n\t\t\tunit: gantt.config.duration_unit,\r\n\t\t\ttask: task\r\n\t\t});\r\n\t\ttask.end_date = gantt.calculateEndDate(task);\r\n\t}\r\n\r\n\tgantt.isSummaryTask = function (task) {\r\n\t\tgantt.assert(task && task instanceof Object, \"Invalid argument <b>task</b>=\"+task+\" of gantt.isSummaryTask. Task object was expected\");\r\n\r\n\t\tvar mode = getTaskTimingMode(task);\r\n\r\n\t\treturn !!(mode.$no_end || mode.$no_start);\r\n\t};\r\n\r\n// downward calculation of project duration\r\n\tgantt.resetProjectDates = function (task) {\r\n\t\tvar taskMode = getTaskTimingMode(task);\r\n\t\tif (taskMode.$no_end || taskMode.$no_start) {\r\n\t\t\tvar info = getSubtaskInfo(task.id);\r\n\t\t\tassignProjectDates.call(this, task, taskMode, info.start_date, info.end_date);\r\n\t\t\ttask.$rollup = info.rollup;\r\n\t\t\ttask.$inlineSplit = info.splitItems;\r\n\t\t}\r\n\t};\r\n\r\n\tfunction assignProjectDates(task, taskTiming, from, to) {\r\n\r\n\t\tconst summaryDateFields = {\r\n\t\t\tstart: \"start_date\",\r\n\t\t\tend: \"end_date\"\r\n\t\t};\r\n\t\tconst manuallyScheduledSummaryDateFields = {\r\n\t\t\tstart: \"$auto_start_date\",\r\n\t\t\tend: \"$auto_end_date\"\r\n\t\t};\r\n\r\n\t\tlet dateFields;\r\n\t\tif(task.type === gantt.config.types.project && task.auto_scheduling === false){\r\n\t\t\tdateFields = manuallyScheduledSummaryDateFields;\r\n\t\t}else{\r\n\t\t\tdateFields = summaryDateFields;\r\n\t\t}\r\n\r\n\t\tif (taskTiming.$no_start) {\r\n\t\t\tif (from) {\r\n\t\t\t\ttask[dateFields.start] = new Date(from);\r\n\t\t\t} else {\r\n\t\t\t\ttask[dateFields.start] = getDefaultTaskDate(task, this.getParent(task));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (taskTiming.$no_end) {\r\n\t\t\tif (to) {\r\n\t\t\t\ttask[dateFields.end] = new Date(to);\r\n\t\t\t} else {\r\n\t\t\t\ttask[dateFields.end] = this.calculateEndDate({\r\n\t\t\t\t\tstart_date: task[dateFields.start],\r\n\t\t\t\t\tduration: this.config.duration_step,\r\n\t\t\t\t\ttask: task\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (taskTiming.$no_start || taskTiming.$no_end) {\r\n\t\t\tthis._init_task_timing(task);\r\n\t\t}\r\n\t}\r\n\r\n\tgantt.getSubtaskDuration = function (taskId) {\r\n\t\tvar res = 0,\r\n\t\t\troot = taskId !== undefined ? taskId : gantt.config.root_id;\r\n\r\n\t\tthis.eachTask(function (child) {\r\n\t\t\tif (this.getTaskType(child.type) == gantt.config.types.project || this.isUnscheduledTask(child))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tres += child.duration;\r\n\t\t}, root);\r\n\r\n\t\treturn res;\r\n\t};\r\n\r\n\tfunction getSubtaskInfo (taskId){\r\n\t\tlet min = null;\r\n\t\tlet max = null;\r\n\t\tlet root = taskId !== undefined ? taskId : gantt.config.root_id;\r\n\t\tconst rollup = [];\r\n\t\tconst inlineSplit = [];\r\n\r\n\t\tlet rootTask = null;\r\n\t\tif(gantt.isTaskExists(root)){\r\n\t\t\trootTask = gantt.getTask(root);\r\n\t\t}\r\n\r\n\t\tgantt.eachTask(function (child) {\r\n\t\t\tconst isScheduledSummary = (gantt.getTaskType(child.type) == gantt.config.types.project && (child.auto_scheduling === false));\r\n\t\t\tif ((gantt.getTaskType(child.type) == gantt.config.types.project && !isScheduledSummary) || gantt.isUnscheduledTask(child))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif(child.rollup){\r\n\t\t\t\trollup.push(child.id);\r\n\t\t\t}\r\n\r\n\t\t\tif ((child.start_date && (!child.$no_start || isScheduledSummary)) && (!min || min > child.start_date.valueOf()))\r\n\t\t\t\tmin = child.start_date.valueOf();\r\n\t\t\tif ((child.end_date && (!child.$no_end || isScheduledSummary)) && (!max || max < child.end_date.valueOf()))\r\n\t\t\t\tmax = child.end_date.valueOf();\r\n\r\n\r\n\t\t\tif(rootTask && rootTask.render == \"split\"){\r\n\t\t\t\tif(child.split_placement === \"inline\"){\r\n\t\t\t\t\tinlineSplit.push(child);\r\n\t\t\t\t}else if(child.split_placement !== \"subrow\" && (!rootTask.$open || !gantt.config.open_split_tasks)){\r\n\t\t\t\t\tinlineSplit.push(child);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, root);\r\n\r\n\t\treturn {\r\n\t\t\tstart_date: min ? new Date(min) : null,\r\n\t\t\tend_date: max ? new Date(max) : null,\r\n\t\t\trollup: rollup,\r\n\t\t\tsplitItems: inlineSplit\r\n\t\t};\r\n\t}\r\n\r\n\tgantt.getSubtaskDates = function (task_id) {\r\n\t\tvar info = getSubtaskInfo(task_id);\r\n\t\treturn {\r\n\t\t\tstart_date: info.start_date,\r\n\t\t\tend_date: info.end_date\r\n\t\t};\r\n\t};\r\n\r\n\r\n// upward calculation of project duration\r\n\tgantt._update_parents = function (taskId, silent, updateAll) {\r\n\t\tif (!taskId) return;\r\n\r\n\t\tvar task = this.getTask(taskId);\r\n\t\tif(task.rollup){\r\n\t\t\tupdateAll = true;\r\n\t\t}\r\n\t\tvar pid = this.getParent(task);\r\n\r\n\t\tvar taskTiming = getTaskTimingMode(task);\r\n\r\n\t\tvar has_changed = true;\r\n\t\t// GS-761 the dates check is necessary for adding empty tasks: gantt.addTask({id:\"2\"})\r\n\t\tif (updateAll || (task.start_date && task.end_date && (taskTiming.$no_start || taskTiming.$no_end))) {\r\n\r\n\t\t\tconst startDateField = task.$auto_start_date ? \"$auto_start_date\" : \"start_date\";\r\n\t\t\tconst endDateField = task.$auto_end_date ? \"$auto_end_date\" : \"end_date\";\r\n\r\n\t\t\tvar oldStart = task[startDateField].valueOf(),\r\n\t\t\t\toldEnd = task[endDateField].valueOf();\r\n\r\n\t\t\tgantt.resetProjectDates(task);\r\n\r\n\t\t\t// not refresh parent projects if dates hasn't changed\r\n\t\t\tif (!updateAll && oldStart == task[startDateField].valueOf() && oldEnd == task[endDateField].valueOf()) {\r\n\t\t\t\thas_changed = false;\r\n\t\t\t}\r\n\r\n\t\t\tif (has_changed && !silent) {\r\n\t\t\t\tthis.refreshTask(task.id, true);\r\n\t\t\t}\r\n\r\n\t\t\tif(taskTiming.scheduled_summary){\r\n\t\t\t\thas_changed = true;//recalculate upwards from scheduled summaries\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tif (has_changed && pid && this.isTaskExists(pid)) {\r\n\t\t\tthis._update_parents(pid, silent, updateAll);\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.roundDate = function (config) {\r\n\t\tvar scale = gantt.getScale();\r\n\r\n\t\tif (helpers.isDate(config)) {\r\n\t\t\tconfig = {\r\n\t\t\t\tdate: config,\r\n\t\t\t\tunit: scale ? scale.unit : gantt.config.duration_unit,\r\n\t\t\t\tstep: scale ?  scale.step : gantt.config.duration_step\r\n\t\t\t};\r\n\t\t}\r\n\t\tvar date = config.date,\r\n\t\t\tsteps = config.step,\r\n\t\t\tunit = config.unit;\r\n\r\n\t\tif(!scale){\r\n\t\t\treturn date;\r\n\t\t}\r\n\r\n\t\tvar upper, lower, colIndex;\r\n\t\tif (unit == scale.unit && steps == scale.step &&\r\n\t\t\t+date >= +scale.min_date && +date <= +scale.max_date) {\r\n\t\t\t//find date in time scale config\r\n\t\t\tcolIndex = Math.floor(gantt.columnIndexByDate(date));\r\n\r\n\t\t\tif (!scale.trace_x[colIndex]) {\r\n\t\t\t\tcolIndex -= 1;// end of time scale\r\n\t\t\t\tif(scale.rtl){\r\n\t\t\t\t\tcolIndex = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlower = new Date(scale.trace_x[colIndex]);\r\n\t\t\tupper = gantt.date.add(lower, steps, unit);\r\n\t\t} else {\r\n\t\t\tcolIndex = Math.floor(gantt.columnIndexByDate(date));\r\n\r\n\t\t\tupper = gantt.date[unit + \"_start\"](new Date(scale.min_date));\r\n\t\t\tif (scale.trace_x[colIndex]) {\r\n\t\t\t\tupper = gantt.date[unit + \"_start\"](scale.trace_x[colIndex]);// end of time scale\r\n\t\t\t}\r\n\r\n\t\t\twhile (+upper < +date) {\r\n\t\t\t\tupper = gantt.date[unit + \"_start\"](gantt.date.add(upper, steps, unit));\r\n\r\n\t\t\t\tvar tzOffset = upper.getTimezoneOffset();\r\n\r\n\t\t\t\tupper = gantt._correct_dst_change(upper, tzOffset, upper, unit);\r\n\t\t\t\tif (gantt.date[unit + '_start'])\r\n\t\t\t\t\tupper = gantt.date[unit + '_start'](upper);\r\n\t\t\t}\r\n\r\n\t\t\tlower = gantt.date.add(upper, -1 * steps, unit);\r\n\r\n\t\t}\r\n\t\tif (config.dir && config.dir == 'future')\r\n\t\t\treturn upper;\r\n\t\tif (config.dir && config.dir == 'past')\r\n\t\t\treturn lower;\r\n\r\n\t\tif (Math.abs(date - lower) < Math.abs(upper - date)) {\r\n\t\t\treturn lower;\r\n\t\t} else {\r\n\t\t\treturn upper;\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tgantt.correctTaskWorkTime = function (task) {\r\n\t\tif (gantt.config.work_time && gantt.config.correct_work_time) {\r\n\t\t\tif (!this.isWorkTime(task.start_date, undefined, task)) {\r\n\t\t\t\ttask.start_date = this.getClosestWorkTime({date: task.start_date, dir: 'future', task: task});\r\n\t\t\t\ttask.end_date = this.calculateEndDate(task);\r\n\t\t\t} else if (!this.isWorkTime(new Date(+task.end_date - 1), undefined, task)) {\r\n\t\t\t\ttask.end_date = this.calculateEndDate(task);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.attachEvent(\"onBeforeTaskUpdate\", function (id, task) {\r\n\t\tgantt._init_task_timing(task);\r\n\t\treturn true;\r\n\t});\r\n\tgantt.attachEvent(\"onBeforeTaskAdd\", function (id, task) {\r\n\t\tgantt._init_task_timing(task);\r\n\t\treturn true;\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onAfterTaskMove\", function (id, parent, tindex) {\r\n\t\tgantt._init_task_timing(gantt.getTask(id));\r\n\t\treturn true;\r\n\t});\r\n\r\n};","export default function(gantt) {\r\n\r\n\tgantt.getTaskType = function (type) {\r\n\t\treturn \"task\";\r\n\t};\r\n};","/*\r\n reuse results of functions that can be recalculated during rendering\r\n greatly increases the rendering speed when critical path enabled\r\n Sample - 94_dev/critical_path.html\r\n\r\n */\r\nexport default function(gantt){\r\n\r\ngantt._cached_functions = {\r\n\tcache: {},\r\n\tmode: false,\r\n\tcritical_path_mode: false,\r\n\twrap_methods : function(methods, object){\r\n\t\tif(object._prefetch_originals){\r\n\t\t\tfor(var i in object._prefetch_originals){\r\n\t\t\t\tobject[i] = object._prefetch_originals[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\tobject._prefetch_originals = {};\r\n\t\tfor(var i = 0; i < methods.length; i++)\r\n\t\t\tthis.prefetch(methods[i], object);\r\n\r\n\t},\r\n\tprefetch : function(methodname, host){\r\n\t\tvar original = host[methodname];\r\n\t\tif(original){\r\n\t\t\tvar optimizer = this;\r\n\r\n\t\t\thost._prefetch_originals[methodname] = original;\r\n\t\t\thost[methodname] = function get_prefetched_value(){\r\n\r\n\t\t\t\tvar argumentsArray = new Array(arguments.length);\r\n\t\t\t\tfor (var i = 0, l = arguments.length; i < l; i++) {\r\n\t\t\t\t\targumentsArray[i] = arguments[i];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(optimizer.active){\r\n\t\t\t\t\tvar args = optimizer.get_arguments_hash(Array.prototype.slice.call(argumentsArray));\r\n\t\t\t\t\tif(!optimizer.cache[methodname]){\r\n\t\t\t\t\t\toptimizer.cache[methodname] = {};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar cached_values = optimizer.cache[methodname];\r\n\r\n\t\t\t\t\tif(optimizer.has_cached_value(cached_values, args)){\r\n\t\t\t\t\t\treturn optimizer.get_cached_value(cached_values, args);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tvar value = original.apply(this, argumentsArray);\r\n\t\t\t\t\t\toptimizer.cache_value(cached_values, args, value);\r\n\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn original.apply(this, argumentsArray);\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn original;\r\n\t},\r\n\tcache_value: function(cache, arguments_hash, value){\r\n\t\tif(this.is_date(value))\r\n\t\t\tvalue = new Date(value);\r\n\t\tcache[arguments_hash] = value;\r\n\t},\r\n\thas_cached_value: function(cache, arguments_hash){\r\n\t\treturn cache.hasOwnProperty(arguments_hash);\r\n\t},\r\n\tget_cached_value: function(cache, arguments_hash){\r\n\t\tvar data = cache[arguments_hash];\r\n\r\n\t\t//for cached dates - return copy\r\n\t\tif(this.is_date(data)){\r\n\t\t\tdata = new Date(data);\r\n\t\t}\r\n\t\treturn data;\r\n\t},\r\n\tis_date: function(value){\r\n\t\treturn (value && value.getUTCDate);\r\n\t},\r\n\tget_arguments_hash:function(args){\r\n\t\tvar values = [];\r\n\t\tfor(var i = 0; i < args.length; i++){\r\n\t\t\tvalues.push(this.stringify_argument(args[i]));\r\n\t\t}\r\n\t\treturn \"(\" + values.join(\";\") + \")\";\r\n\t},\r\n\tstringify_argument: function(value){\r\n\t\t//expecting task or link, or any other data entries, dates and primitive values\r\n\t\tvar ret = \"\";\r\n\t\tif(value.id){\r\n\t\t\tret = value.id;\r\n\t\t}else if(this.is_date(value)){\r\n\t\t\tret = value.valueOf();\r\n\t\t}else{\r\n\t\t\tret = value;\r\n\t\t}\r\n\t\treturn ret + \"\";\r\n\t},\r\n\tactivate: function(){\r\n\t\tthis.clear();\r\n\t\tthis.active = true;\r\n\t},\r\n\tdeactivate: function(){\r\n\t\tthis.clear();\r\n\t\tthis.active = false;\r\n\t},\r\n\tclear: function(){\r\n\t\tthis.cache = {};\r\n\t},\r\n\r\n\tsetup: function(gantt){\r\n\t\tvar override_gantt = [];\r\n\r\n\t\tvar gantt_methods  = [\r\n\t\t\t'_isProjectEnd',\r\n\t\t\t'_getProjectEnd',\r\n\t\t\t'_getSlack'\r\n\t\t];\r\n\r\n\r\n\r\n\t\tif(this.mode == 'auto'){\r\n\t\t\tif(gantt.config.highlight_critical_path){\r\n\t\t\t\toverride_gantt = gantt_methods;\r\n\t\t\t}\r\n\t\t}else if(this.mode === true){\r\n\t\t\toverride_gantt = gantt_methods;\r\n\t\t}\r\n\r\n\t\tthis.wrap_methods(override_gantt, gantt);\r\n\r\n\t},\r\n\tupdate_if_changed: function(gantt){\r\n\t\tvar changed = (this.critical_path_mode != gantt.config.highlight_critical_path ||\r\n\t\t\t\t\t\tthis.mode !== gantt.config.optimize_render);\r\n\t\tif(changed){\r\n\t\t\tthis.critical_path_mode = gantt.config.highlight_critical_path;\r\n\t\t\tthis.mode = gantt.config.optimize_render;\r\n\t\t\tthis.setup(gantt);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nfunction activate(){\r\n\tgantt._cached_functions.update_if_changed(gantt);\r\n\tif(!gantt._cached_functions.active){\r\n\t\tgantt._cached_functions.activate();\r\n\t}\r\n\treturn true;\r\n}\r\ngantt.attachEvent(\"onBeforeGanttRender\", activate);\r\ngantt.attachEvent(\"onBeforeDataRender\", activate);\r\ngantt.attachEvent(\"onBeforeSmartRender\",  function(){\r\n\tactivate();\r\n});\r\ngantt.attachEvent(\"onBeforeParse\", activate);\r\ngantt.attachEvent(\"onDataRender\", function(){\r\n\tgantt._cached_functions.deactivate();\r\n});\r\nvar deactivTimeout = null;\r\ngantt.attachEvent(\"onSmartRender\", function(){\r\n\tif(deactivTimeout)\r\n\t\tclearTimeout(deactivTimeout);\r\n\tdeactivTimeout = setTimeout(function(){\r\n\t\tgantt._cached_functions.deactivate();\r\n\t}, 1000);\r\n});\r\n\r\ngantt.attachEvent(\"onBeforeGanttReady\", function(){\r\n\tgantt._cached_functions.update_if_changed(gantt);\r\n\treturn true;\r\n});\r\n\r\n};","function addResizeListener(gantt){\r\n\tvar containerStyles = window.getComputedStyle(gantt.$root);\r\n\tif(containerStyles.getPropertyValue(\"position\") == \"static\"){\r\n\t\tgantt.$root.style.position = \"relative\";\r\n\t}\r\n\r\n\tvar resizeWatcher = document.createElement('iframe');\r\n\tresizeWatcher.className = \"gantt_container_resize_watcher\";\r\n\tresizeWatcher.tabIndex = -1;\r\n\tif(gantt.config.wai_aria_attributes){\r\n\t\tresizeWatcher.setAttribute(\"role\", \"none\");\r\n\t\tresizeWatcher.setAttribute(\"aria-hidden\", true);\r\n\t}\r\n\r\n\tif (gantt.env.isSalesforce){\r\n\t\tgantt.config.container_resize_method = \"timeout\";\r\n\t}\r\n\r\n\t// in some environments (namely, in SalesForce) iframe.contentWindow is not available\r\n\tgantt.$root.appendChild(resizeWatcher);\r\n\tif (resizeWatcher.contentWindow) {\r\n\t\tlistenWindowResize(gantt, resizeWatcher.contentWindow);\r\n\t} else {\r\n\t\t// if so - ditch the iframe and fallback to listening the main window resize\r\n\t\tgantt.$root.removeChild(resizeWatcher);\r\n\t\tlistenWindowResize(gantt, window);\r\n\t}\r\n}\r\n\r\nfunction listenWindowResize(gantt, window){\r\n\tvar resizeTimeout = gantt.config.container_resize_timeout || 20;\r\n\tvar resizeDelay;\r\n\tlet previousSize = getContainerSize(gantt);\r\n\r\n\tif (gantt.config.container_resize_method == \"timeout\"){\r\n\t\tlowlevelResizeWatcher();\r\n\t}\r\n\telse {\r\n\t\ttry {\r\n\t\t\tgantt.event(window, \"resize\", function () {\r\n\t\t\t\tif (gantt.$scrollbarRepaint) {\r\n\t\t\t\t\tgantt.$scrollbarRepaint = null;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// GS-2140. Don't repaint Gantt if it has the same sizes\r\n\t\t\t\t\tlet currentSize = getContainerSize(gantt);\r\n\t\t\t\t\tif (previousSize.x == currentSize.x && previousSize.y == currentSize.y){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpreviousSize = currentSize;\r\n\t\t\t\t\trepaintGantt();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tcatch (e) {\r\n\t\t\tlowlevelResizeWatcher();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction repaintGantt(){\r\n\t\tclearTimeout(resizeDelay);\r\n\t\tresizeDelay = setTimeout(function(){\r\n\t\t\tif(!gantt.$destroyed){\r\n\t\t\t\tgantt.render();\r\n\t\t\t}\r\n\t\t}, resizeTimeout);\r\n\t}\r\n\r\n\tvar previousHeight = gantt.$root.offsetHeight;\r\n\tvar previousWidth = gantt.$root.offsetWidth;\t\r\n\r\n\tfunction lowlevelResizeWatcher(){\r\n\t\tif (gantt.$root.offsetHeight != previousHeight ||\r\n\t\t\t\tgantt.$root.offsetWidth != previousWidth){\r\n\t\t\t\trepaintGantt();\r\n\t\t}\r\n\r\n\t\tpreviousHeight = gantt.$root.offsetHeight;\r\n\t\tpreviousWidth = gantt.$root.offsetWidth;\r\n\r\n\t\tsetTimeout(lowlevelResizeWatcher, resizeTimeout);\r\n\t}\r\n}\r\n\r\nfunction getContainerSize(gantt){\r\n\treturn {\r\n\t\tx: gantt.$root.offsetWidth,\r\n\t\ty: gantt.$root.offsetHeight\r\n\t};\r\n}\r\n\r\nexport default addResizeListener;","/*\r\n \tasserts will be removed in final code, so you can place them anythere\r\n\twithout caring about performance impacts\r\n*/\r\n\r\nexport default function(gantt){\r\n\treturn function assert(check, message){\r\n\t\tif (!check){\r\n\t\t\tif(gantt.config.show_errors && gantt.callEvent(\"onError\",[message]) !== false) {\r\n\t\t\t\tif (gantt.message) {\r\n\t\t\t\t\tgantt.message({type: \"error\", text: message, expire: -1});\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// eslint-disable-next-line\r\n\t\t\t\t\tconsole.log(message);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// eslint-disable-next-line no-debugger\r\n\t\t\t\tdebugger;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n};","import * as domHelpers from \"./ui/utils/dom_helpers\";\r\nimport * as helpers from \"../utils/helpers\";\r\nimport isHeadless from \"../utils/is_headless\";\r\nimport addResizeListener from \"./ui/resize_listener\";\r\nimport calculateScaleRange from \"./gantt_data_range\";\r\nimport assert from \"./common/assert\";\r\n\r\nexport default function(gantt){\r\n\t\r\n\r\n\tgantt.assert = assert(gantt);\r\n\r\n\tfunction isHTMLElement(node){\r\n\t\ttry {\r\n\t\t\tnode.cloneNode(false);\r\n\t\t}\r\n\t\tcatch (e){\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\tvar invalidContainerMessage = \"Invalid value of the first argument of `gantt.init`. Supported values: HTMLElement, String (element id).\" +\r\n\t\"This error means that either invalid object is passed into `gantt.init` or that the element with the specified ID doesn't exist on the page when `gantt.init` is called.\";\r\n\r\n\tfunction validateNode(node){\r\n\t\tif (!node || (typeof node == 'string' && document.getElementById(node))) return true;\r\n\t\tif (isHTMLElement(node)) return true;\r\n\r\n\t\tgantt.assert(false, invalidContainerMessage);\r\n\t\tthrow new Error(invalidContainerMessage);\r\n\t}\r\n\r\n//initial initialization\r\n\tgantt.init = function(node, from, to){\r\n\t\tif (gantt.env.isNode) { \r\n\t\t\tnode = null; // for the nodejs version\r\n\t\t} else {\r\n\t\t\tvalidateNode(node); // for the web version\r\n\t\t}\r\n\r\n\t\tif(from && to){\r\n\t\t\tthis.config.start_date = this._min_date = new Date(from);\r\n\t\t\tthis.config.end_date = this._max_date = new Date(to);\r\n\t\t}\r\n\t\tthis.date.init();\r\n\r\n\t\t//can be called only once\r\n\t\tthis.init = function(node){\r\n\t\t\tif (gantt.env.isNode) { \r\n\t\t\t\tnode = null; // for the nodejs version\r\n\t\t\t} else {\r\n\t\t\t\tvalidateNode(node); // for the web version\r\n\t\t\t}\r\n\r\n\t\t\tif (this.$container && this.$container.parentNode){\r\n\t\t\t\tthis.$container.parentNode.removeChild(this.$container);\r\n\t\t\t\tthis.$container = null;\r\n\t\t\t}\r\n\r\n\t\t\tif(this.$layout){\r\n\t\t\t\tthis.$layout.clear();\r\n\t\t\t}\r\n\t\t\tthis._reinit(node);\r\n\t\t};\r\n\t\tthis._reinit(node);\r\n\t};\r\n\r\n\tgantt._quickRefresh = function(code){\r\n\t\tvar stores = this._getDatastores.call(this);\r\n\t\tfor(var i = 0; i < stores.length; i++){\r\n\t\t\tstores[i]._quick_refresh = true;\r\n\t\t}\r\n\r\n\t\tcode();\r\n\r\n\t\tfor(var i = 0; i < stores.length; i++){\r\n\t\t\tstores[i]._quick_refresh = false;\r\n\t\t}\r\n\t};\r\n\r\n\tvar dropLayout = (function dropLayout(){\r\n\t\tif(this._clearTaskLayers){\r\n\t\t\tthis._clearTaskLayers();\r\n\t\t}\r\n\r\n\t\tif(this._clearLinkLayers){\r\n\t\t\tthis._clearLinkLayers();\r\n\t\t}\r\n\r\n\t\tif(this.$layout){\r\n\t\t\tthis.$layout.destructor();\r\n\t\t\tthis.$layout = null;\r\n\t\t\tthis.$ui.reset();\r\n\t\t}\r\n\t}).bind(gantt);\r\n\r\n\tvar rebuildLayout = (function rebuildLayout(){\r\n\t\tif(isHeadless(gantt)){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.$root.innerHTML = \"\";\r\n\r\n\t\tthis.$root.gantt = this;\r\n\t\tcalculateScaleRange(this);\r\n\t\tthis.config.layout.id = \"main\";\r\n\t\tthis.$layout = this.$ui.createView(\"layout\", this.$root, this.config.layout);\r\n\r\n\t\tthis.$layout.attachEvent(\"onBeforeResize\", function(){\r\n\t\t\tvar storeNames = gantt.$services.getService(\"datastores\");\r\n\t\t\tfor(var i = 0; i < storeNames.length; i++){\r\n\t\t\t\tgantt.getDatastore(storeNames[i]).filter();\r\n\t\t\t\tif (gantt.$data.tasksStore._skipTaskRecalculation){\r\n\t\t\t\t\t// do not repaint items, they will be repainted later in the onStoreUpdate event\r\n\t\t\t\t\tif (gantt.$data.tasksStore._skipTaskRecalculation != \"lightbox\"){\r\n\t\t\t\t\t\tgantt.$data.tasksStore._skipTaskRecalculation = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t} else {\r\n\t\t\t\t\tgantt.getDatastore(storeNames[i]).callEvent(\"onBeforeRefreshAll\", []);\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.$layout.attachEvent(\"onResize\", function(){\r\n\t\t\tgantt._quickRefresh(function(){\r\n\t\t\t\tgantt.refreshData();\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tthis.callEvent(\"onGanttLayoutReady\", []);\r\n\t\tthis.$layout.render();\r\n\r\n\t\tthis.$container = this.$layout.$container.firstChild;\r\n\r\n\t\taddResizeListener(this);\r\n\t}).bind(gantt);\r\n\r\n\tgantt.resetLayout = function(){\r\n\t\tdropLayout();\r\n\t\trebuildLayout();\r\n\t\tthis.render();\r\n\t};\r\n\r\n\tgantt._reinit = function(node){\r\n\t\tthis.callEvent(\"onBeforeGanttReady\", []);\r\n\t\tthis._update_flags();\r\n\r\n\t\tvar config = this.$services.getService(\"templateLoader\");\r\n\t\tconfig.initTemplates(this);\r\n\r\n\t\tdropLayout();\r\n\r\n\t\tthis.$root = null;\r\n\t\tif(node){\r\n\t\t\tthis.$root = domHelpers.toNode(node);\r\n\t\t\trebuildLayout();\r\n\t\t\tthis.$mouseEvents.reset(this.$root);\r\n\t\t\taddMinimalSizes(gantt);\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onTemplatesReady\",[]);\r\n\r\n\t\tthis.callEvent(\"onGanttReady\", []);\r\n\r\n\t\tthis.render();\r\n\t};\r\n\r\n\tfunction addMinimalSizes(gantt) {\r\n\t\tif (gantt.$container && !gantt.config.autosize) {\r\n\t\t\tif (gantt.$root.offsetHeight < 50) {\r\n\t\t\t\t// eslint-disable-next-line no-console\r\n\t\t\t\tconsole.warn(`The Gantt container has a small height, so you cannot see its content. If it is not intended, you need to set the 'height' style rule to the container:\r\nhttps://docs.dhtmlx.com/gantt/faq.html#theganttchartisntrenderedcorrectly`);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgantt.$click={\r\n\t\tbuttons:{\r\n\t\t\t\"edit\": function(id) {\r\n\t\t\t\tif (gantt.isReadonly(gantt.getTask(id))) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tgantt.showLightbox(id);\r\n\t\t\t},\r\n\t\t\t\"delete\": function(id) {\r\n\t\t\t\tvar task = gantt.getTask(id);\r\n\t\t\t\tif (gantt.isReadonly(task)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar question = gantt.locale.labels.confirm_deleting;\r\n\t\t\t\tvar title = gantt.locale.labels.confirm_deleting_title;\r\n\r\n\t\t\t\tgantt._delete_task_confirm({\r\n\t\t\t\t\ttask: task,\r\n\t\t\t\t\tmessage: question,\r\n\t\t\t\t\ttitle: title,\r\n\t\t\t\t\tcallback: function(){\r\n\t\t\t\t\t\tif(!gantt.isTaskExists(id)){\r\n\t\t\t\t\t\t\tgantt.hideLightbox();\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif(task.$new){\r\n\t\t\t\t\t\t\t// GS-2170. Do not recalculate the indexes and dates of other tasks\r\n\t\t\t\t\t\t\t// as they will be recalculated in the `refreshData`\r\n\t\t\t\t\t\t\tgantt.$data.tasksStore._skipTaskRecalculation = \"lightbox\";\r\n\t\t\t\t\t\t\tgantt.silent(function(){\r\n\t\t\t\t\t\t\t\tgantt.deleteTask(id, true);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tgantt.$data.tasksStore._skipTaskRecalculation = false;\r\n\t\t\t\t\t\t\tgantt.refreshData();\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tgantt.$data.tasksStore._skipTaskRecalculation = true;\r\n\t\t\t\t\t\t\tgantt.deleteTask(id);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tgantt.hideLightbox();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n//renders self\r\n\tgantt.render = function(){\r\n\t\tthis.callEvent(\"onBeforeGanttRender\", []);\r\n\r\n\t\tvar visibleDate;\r\n\t\tif(!isHeadless(gantt)){\r\n\t\t\tif (!this.config.sort && this._sort) {\r\n\t\t\t\tthis._sort = undefined;\r\n\t\t\t}\r\n\r\n\t\t\tif(this.$root){\r\n\t\t\t\tif(this.config.rtl){\r\n\t\t\t\t\tthis.$root.classList.add(\"gantt_rtl\");\r\n\t\t\t\t\tthis.$root.firstChild.classList.add(\"gantt_rtl\"); // GS-1499\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.$root.classList.remove(\"gantt_rtl\");\r\n\t\t\t\t\tthis.$root.firstChild.classList.remove(\"gantt_rtl\"); // GS-1499\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar pos = this.getScrollState();\r\n\t\t\tvar posX = pos ? pos.x : 0;\r\n\t\t\tif(this._getHorizontalScrollbar()){\r\n\t\t\t\tvar scrollbar = this._getHorizontalScrollbar();\r\n\t\t\t\tposX = scrollbar.$config.codeScrollLeft || posX || 0;\r\n\t\t\t}\r\n\r\n\r\n\t\t\tvisibleDate = null;\r\n\t\t\tif(posX){\r\n\t\t\t\tvisibleDate = gantt.dateFromPos(posX + this.config.task_scroll_offset);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcalculateScaleRange(this);\r\n\r\n\t\tif(!isHeadless(gantt)){\r\n\t\t\tthis.$layout.$config.autosize = this.config.autosize;\r\n\t\t\tvar preserveScroll = this.config.preserve_scroll;\r\n\t\t\tthis.config.preserve_scroll = false; // prevent scrolling from layout resize, scroll will be called here later on\r\n\t\t\tthis.$layout.resize();\r\n\t\t\tthis.config.preserve_scroll = preserveScroll;\r\n\r\n\t\t\tif(this.config.preserve_scroll && pos){\r\n\t\t\t\t// GS-1640: We need pos.y, otherwise part of the timeline won't be rendered if the scrollbar disappeared\r\n\t\t\t\t// GS-2945: don't need to scroll if the zoom ext was initialized cause it will be scrolled in zoom\r\n\t\t\t\tconst zoom = gantt.ext.zoom._initialized;  \r\n\t\t\t\tif ((posX || pos.y) && !zoom) {\r\n\t\t\t\t\tvar new_pos = gantt.getScrollState();\r\n\t\t\t\t\tvar new_date = gantt.dateFromPos(new_pos.x);\r\n\t\t\t\t\tif(!(+visibleDate == +new_date && new_pos.y == pos.y)){\r\n\t\t\t\t\t\tvar posX = null;\r\n\t\t\t\t\t\tvar posY = null;\r\n\t\t\t\t\t\tif(visibleDate){\r\n\t\t\t\t\t\t\tvar posX = Math.max(gantt.posFromDate(visibleDate) - gantt.config.task_scroll_offset, 0);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(pos.y){\r\n\t\t\t\t\t\t\tposY = pos.y;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tgantt.scrollTo(posX, posY);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// GS-1640: We need to reset the scroll position for the grid if the scrollbar disappeared and\r\n\t\t\t\t// the grid and timeline have different scrollbars\r\n\t\t\t\t// GS-2718: if we have resources and two verticall scrollbars for tasks timeline and resource timeline\r\n\t\t\t\t// we don't get the scroll state of the resource timeline\r\n\t\t\t\tconst scrollbarsInfo = this.$layout.getScrollbarsInfo();\r\n\t\t\t\tscrollbarsInfo.forEach((scroll_info) => {\r\n\t\t\t\t\tconst scroll = gantt.$ui.getView(scroll_info.id);\r\n\t\t\t\t\tconst scrollbarNodeVisible = gantt.utils.dom.isChildOf(scroll.$view, gantt.$container);\r\n\t\t\t\t\tscroll_info.boundViews.forEach((viewName) => {\r\n\t\t\t\t\t\tconst view = gantt.$ui.getView(viewName);\r\n\t\t\t\t\t\tif(scroll_info.y && scroll_info.y != pos.y){\r\n\t\t\t\t\t\t\tif(view && !scrollbarNodeVisible){\r\n\t\t\t\t\t\t\t\tview.scrollTo(undefined, 0);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//GS-2586: take into account the horizontal scroll of the resource timeline\r\n\t\t\t\t\t\tif(scroll_info.x_pos && scroll_info.x_pos != pos.x){\r\n\t\t\t\t\t\t\tif(view && scrollbarNodeVisible){\r\n\t\t\t\t\t\t\t\tview.scrollTo(scroll_info.x_pos, undefined);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t}else{\r\n\t\t\tgantt.refreshData();\r\n\t\t}\r\n\t\tthis.callEvent(\"onGanttRender\", []);\r\n\t};\r\n\r\n\t//TODO: add layout.resize method that wouldn't trigger data repaint\r\n\tgantt.setSizes = gantt.render;\r\n\r\n\r\n\tgantt.getTaskRowNode = function(id) {\r\n\t\tvar els = this.$grid_data.childNodes;\r\n\t\tvar attribute = this.config.task_attribute;\r\n\t\tfor (var i = 0; i < els.length; i++) {\r\n\t\t\tif (els[i].getAttribute) {\r\n\t\t\t\tvar value = els[i].getAttribute(attribute);\r\n\t\t\t\tif (value == id) return els[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n\r\n\tgantt.changeLightboxType = function(type){\r\n\t\tif(this.getLightboxType() == type)\r\n\t\t\treturn true;\r\n\t\tgantt._silent_redraw_lightbox(type);\r\n\t};\r\n\r\n\tgantt._get_link_type = function (from_start, to_start) {\r\n\t\tvar type = null;\r\n\t\tif (from_start && to_start) {\r\n\t\t\ttype = gantt.config.links.start_to_start;\r\n\t\t} else if (!from_start && to_start) {\r\n\t\t\ttype = gantt.config.links.finish_to_start;\r\n\t\t} else if (!from_start && !to_start) {\r\n\t\t\ttype = gantt.config.links.finish_to_finish;\r\n\t\t} else if (from_start && !to_start) {\r\n\t\t\ttype = gantt.config.links.start_to_finish;\r\n\t\t}\r\n\t\treturn type;\r\n\t};\r\n\r\n\tgantt.isLinkAllowed = function (from, to, from_start, to_start) {\r\n\t\tvar link = null;\r\n\t\tif (typeof(from) == \"object\") {\r\n\t\t\tlink = from;\r\n\t\t} else {\r\n\t\t\tlink = {source: from, target: to, type: this._get_link_type(from_start, to_start)};\r\n\t\t}\r\n\r\n\t\tif (!link) return false;\r\n\t\tif (!(link.source && link.target && link.type)) return false;\r\n\t\tif (link.source == link.target) return false;\r\n\r\n\t\tvar res = true;\r\n\t\t//any custom rules\r\n\t\tif (this.checkEvent(\"onLinkValidation\"))\r\n\t\t\tres = this.callEvent(\"onLinkValidation\", [link]);\r\n\r\n\t\treturn res;\r\n\t};\r\n\r\n\r\n\tgantt._correct_dst_change = function(date, prevOffset, step, unit){\r\n\t\tvar time_unit = helpers.getSecondsInUnit(unit) * step;\r\n\t\tif(time_unit > 60*60 && time_unit < 60*60*24){\r\n\t\t\t//correct dst change only if current unit is more than one hour and less than day (days have own checking), e.g. 12h\r\n\t\t\tvar offsetChanged = date.getTimezoneOffset() - prevOffset;\r\n\t\t\tif(offsetChanged){\r\n\t\t\t\tdate = gantt.date.add(date, offsetChanged, \"minute\");\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn date;\r\n\t};\r\n\r\n\tgantt.isSplitTask = function(task){\r\n\t\tgantt.assert(task && task instanceof Object, \"Invalid argument <b>task</b>=\"+task+\" of gantt.isSplitTask. Task object was expected\");\r\n\t\treturn this.$data.tasksStore._isSplitItem(task);\r\n\t};\r\n\r\n\tgantt._is_icon_open_click = function(e) {\r\n\t\tif (!e)\r\n\t\t\treturn false;\r\n\t\tvar target = e.target || e.srcElement;\r\n\t\tif (!(target && target.className))\r\n\t\t\treturn false;\r\n\t\tvar className = domHelpers.getClassName(target);\r\n\t\tif (className.indexOf(\"gantt_tree_icon\") !== -1 && (className.indexOf(\"gantt_close\") !== -1 || className.indexOf(\"gantt_open\") !== -1))\r\n\t\t\treturn true;\r\n\t\treturn false;\r\n\t};\r\n\r\n};","function extend(gantt){\r\n\r\n\tgantt.destructor = function(){\r\n\t\tthis.clearAll();\r\n\t\tthis.callEvent(\"onDestroy\", []);\r\n\r\n\t\tthis._getDatastores().forEach(function(store){\r\n\t\t\tstore.destructor();\r\n\t\t});\r\n\r\n\t\tif(this.$root){\r\n\t\t\tdelete this.$root.gantt;\r\n\t\t}\r\n\r\n\t\tif(this._eventRemoveAll){\r\n\t\t\tthis._eventRemoveAll();\r\n\t\t}\r\n\r\n\t\tif(this.$layout){\r\n\t\t\tthis.$layout.destructor();\r\n\t\t}\r\n\r\n\t\tif(this.resetLightbox){\r\n\t\t\tthis.resetLightbox();\r\n\t\t}\r\n\r\n\t\t// GS-99. Call this here to detach the events\r\n\t\tif (this.ext.inlineEditors && this.ext.inlineEditors.destructor) {\r\n\t\t\tthis.ext.inlineEditors.destructor();\r\n\t\t}\r\n\r\n\t\tif(this._dp && this._dp.destructor){\r\n\t\t\tthis._dp.destructor();\r\n\t\t}\r\n\t\tthis.$services.destructor();\r\n\r\n\t\t// detachAllEvents should be called last, because in components may be attached events\r\n\t\tthis.detachAllEvents();\r\n\r\n\t\tfor(var i in this){\r\n\t\t\tif(i.indexOf(\"$\") === 0){\r\n\t\t\t\tdelete this[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.$destroyed = true;\r\n\t};\r\n}\r\n\r\nexport default extend;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\" \", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \" \", \" \", \" \"],\r\n\t\tmonth_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \" \",\r\n\t\ticon_save: \"\",\r\n\t\ticon_cancel: \"\",\r\n\t\ticon_details: \"\",\r\n\t\ticon_edit: \"\",\r\n\t\ticon_delete: \"\",\r\n\t\tconfirm_closing: \"  ,   \", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"       \",\r\n\t\tsection_description: \"\",\r\n\t\tsection_time: \" \",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"\", \"\", \"\", \"\", \"Ma\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tmonth_short: [\"\", \"\", \"\", \"\", \"Ma\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \" \",\r\n\t\ticon_save: \"\",\r\n\t\ticon_cancel: \"\",\r\n\t\ticon_details: \"\",\r\n\t\ticon_edit: \"\",\r\n\t\ticon_delete: \"\",\r\n\t\tconfirm_closing: \"\", //    , ?\r\n\t\tconfirm_deleting: \"   , ?\",\r\n\t\tsection_description: \"\",\r\n\t\tsection_time: \" \",\r\n\t\tsection_type: \"\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"\",\r\n\t\tcolumn_text: \"\",\r\n\t\tcolumn_start_date: \"\",\r\n\t\tcolumn_duration: \"\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"\",\r\n\t\tconfirm_link_deleting: \" \",\r\n\t\tlink_start: \"()\",\r\n\t\tlink_end: \"()\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"ii\",\r\n\t\thours: \"i\",\r\n\t\tdays: \"\",\r\n\t\tweeks: \"\",\r\n\t\tmonths: \"\",\r\n\t\tyears: \"\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n @Traducido por Vicente Adria Bohigues - vicenteadria@hotmail.com\r\n */\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Gener\", \"Febrer\", \"Mar\", \"Abril\", \"Maig\", \"Juny\", \"Juliol\", \"Agost\", \"Setembre\", \"Octubre\", \"Novembre\", \"Desembre\"],\r\n\t\tmonth_short: [\"Gen\", \"Feb\", \"Mar\", \"Abr\", \"Mai\", \"Jun\", \"Jul\", \"Ago\", \"Set\", \"Oct\", \"Nov\", \"Des\"],\r\n\t\tday_full: [\"Diumenge\", \"Dilluns\", \"Dimarts\", \"Dimecres\", \"Dijous\", \"Divendres\", \"Dissabte\"],\r\n\t\tday_short: [\"Dg\", \"Dl\", \"Dm\", \"Dc\", \"Dj\", \"Dv\", \"Ds\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nova tasca\",\r\n\t\ticon_save: \"Guardar\",\r\n\t\ticon_cancel: \"Cancellar\",\r\n\t\ticon_details: \"Detalls\",\r\n\t\ticon_edit: \"Editar\",\r\n\t\ticon_delete: \"Esborrar\",\r\n\t\tconfirm_closing: \"\", // \"Els seus canvis es perdrn, continuar ?\"\r\n\t\tconfirm_deleting: \"L'esdeveniment s'esborrar definitivament, continuar ?\",\r\n\t\tsection_description: \"Descripci\",\r\n\t\tsection_time: \"Periode de temps\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Cancellar\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\nTranslation by FreezeSoul\r\n\r\nUpdate 26/10/2015:\r\nTranslation of new labels by zwh8800\r\n https://github.com/DHTMLX/gantt/pull/7\r\n\r\n*/\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tmonth_short: [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\"],\r\n\t\tday_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"\",\r\n\t\ticon_save: \"\",\r\n\t\ticon_cancel: \"\",\r\n\t\ticon_details: \"\",\r\n\t\ticon_edit: \"\",\r\n\t\ticon_delete: \"\",\r\n\t\tconfirm_closing: \"!\", // Your changes will be lost, are your sure?\r\n\t\tconfirm_deleting: \"?\",\r\n\t\tsection_description: \"\",\r\n\t\tsection_time: \"\",\r\n\t\tsection_type: \"\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"\",\r\n\t\tcolumn_text: \"\",\r\n\t\tcolumn_start_date: \"\",\r\n\t\tcolumn_duration: \"\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\r\n\t\tlink: \"\",\r\n\t\tconfirm_link_deleting: \"\",\r\n\t\tlink_start: \" ()\",\r\n\t\tlink_end: \" ()\",\r\n\r\n\t\ttype_task: \"\",\r\n\t\ttype_project: \"\",\r\n\t\ttype_milestone: \"\",\r\n\r\n\t\tminutes: \"\",\r\n\t\thours: \"\",\r\n\t\tdays: \"\",\r\n\t\tweeks: \"\",\r\n\t\tmonths: \"\",\r\n\t\tyears: \"\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Leden\", \"nor\", \"Bezen\", \"Duben\", \"Kvten\", \"erven\", \"ervenec\", \"Srpen\", \"Z\", \"jen\", \"Listopad\", \"Prosinec\"],\r\n\t\tmonth_short: [\"Led\", \"n\", \"Be\", \"Dub\", \"Kv\", \"er\", \"ec\", \"Srp\", \"Z\", \"j\", \"List\", \"Pro\"],\r\n\t\tday_full: [\"Nedle\", \"Pondl\", \"ter\", \"Steda\", \"tvrtek\", \"Ptek\", \"Sobota\"],\r\n\t\tday_short: [\"Ne\", \"Po\", \"t\", \"St\", \"t\", \"P\", \"So\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nov prce\",\r\n\t\ticon_save: \"Uloit\",\r\n\t\ticon_cancel: \"Zpt\",\r\n\t\ticon_details: \"Detail\",\r\n\t\ticon_edit: \"Edituj\",\r\n\t\ticon_delete: \"Smazat\",\r\n\t\tconfirm_closing: \"\", // Vae zmny budou ztraceny, opravdu ?\r\n\t\tconfirm_deleting: \"Udlost bude trvale smazna, opravdu?\",\r\n\t\tsection_description: \"Poznmky\",\r\n\t\tsection_time: \"Doba platnosti\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Zpt\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Januar\", \"Februar\", \"Marts\", \"April\", \"Maj\", \"Juni\", \"Juli\", \"August\", \"September\", \"Oktober\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Maj\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Sndag\", \"Mandag\", \"Tirsdag\", \"Onsdag\", \"Torsdag\", \"Fredag\", \"Lrdag\"],\r\n\t\tday_short: [\"Sn\", \"Man\", \"Tir\", \"Ons\", \"Tor\", \"Fre\", \"Lr\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Ny opgave\",\r\n\t\ticon_save: \"Gem\",\r\n\t\ticon_cancel: \"Fortryd\",\r\n\t\ticon_details: \"Detaljer\",\r\n\t\ticon_edit: \"Tilret\",\r\n\t\ticon_delete: \"Slet\",\r\n\t\tconfirm_closing: \"Dine rettelser vil g tabt.. Er dy sikker?\", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"Bigivenheden vil blive slettet permanent. Er du sikker?\",\r\n\t\tsection_description: \"Beskrivelse\",\r\n\t\tsection_time: \"Tidsperiode\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Fortryd\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\" Januar\", \" Februar\", \" Mrz \", \" April\", \" Mai\", \" Juni\", \" Juli\", \" August\", \" September \", \" Oktober\", \" November \", \" Dezember\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mr\", \"Apr\", \"Mai\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dez\"],\r\n\t\tday_full: [\"Sonntag\", \"Montag\", \"Dienstag\", \" Mittwoch\", \" Donnerstag\", \"Freitag\", \"Samstag\"],\r\n\t\tday_short: [\"So\", \"Mo\", \"Di\", \"Mi\", \"Do\", \"Fr\", \"Sa\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Neue Aufgabe\",\r\n\t\ticon_save: \"Speichern\",\r\n\t\ticon_cancel: \"Abbrechen\",\r\n\t\ticon_details: \"Details\",\r\n\t\ticon_edit: \"ndern\",\r\n\t\ticon_delete: \"Lschen\",\r\n\t\tconfirm_closing: \"\", // \"Ihre Vernderungen werden verloren sein, wollen Sie ergnzen? \"\r\n\t\tconfirm_deleting: \"Der Eintrag wird gelscht\",\r\n\t\tsection_description: \"Beschreibung\",\r\n\t\tsection_time: \"Zeitspanne\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"PSP\",\r\n\t\tcolumn_text: \"Task-Namen\",\r\n\t\tcolumn_start_date: \"Startzeit\",\r\n\t\tcolumn_duration: \"Dauer\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"werden gelscht\",\r\n\t\tlink_start: \"(starten)\",\r\n\t\tlink_end: \"(ende)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minuten\",\r\n\t\thours: \"Stunden\",\r\n\t\tdays: \"Tage\",\r\n\t\tweeks: \"Wochen\",\r\n\t\tmonths: \"Monate\",\r\n\t\tyears: \"Jahre\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Abbrechen\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Regel\",\r\n\t\tconstraint_type: \"Regel\",\r\n\t\tconstraint_date: \"Regel - Datum\",\r\n\t\tasap: \"So bald wie mglich\",\r\n\t\talap: \"So spt wie mglich\",\r\n\t\tsnet: \"Beginn nicht vor\",\r\n\t\tsnlt: \"Beginn nicht spter als\",\r\n\t\tfnet: \"Fertigstellung nicht vor\",\r\n\t\tfnlt: \"Fertigstellung nicht spter als\",\r\n\t\tmso: \"Muss beginnen am\",\r\n\t\tmfo: \"Muss fertig sein am\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tmonth_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \" \",\r\n\t\ticon_save: \"\",\r\n\t\ticon_cancel: \"\",\r\n\t\ticon_details: \"\",\r\n\t\ticon_edit: \"\",\r\n\t\ticon_delete: \"\",\r\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"    .   ;\",\r\n\t\tsection_description: \"\",\r\n\t\tsection_time: \" \",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"],\r\n\t\tday_short: [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"New task\",\r\n\t\ticon_save: \"Save\",\r\n\t\ticon_cancel: \"Cancel\",\r\n\t\ticon_details: \"Details\",\r\n\t\ticon_edit: \"Edit\",\r\n\t\ticon_delete: \"Delete\",\r\n\t\tconfirm_closing: \"\",// Your changes will be lost, are you sure?\r\n\t\tconfirm_deleting: \"Task will be deleted permanently, are you sure?\",\r\n\t\tsection_description: \"Description\",\r\n\t\tsection_time: \"Time period\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\r\n\t\t/* grid columns */\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Cancel\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\t\t\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;","/*\r\n @Autor Manuel Fernandez Panzuela - www.mfernandez.es\r\n\r\n Update 30/10/2015:\r\n Translation of new labels by Jorge Macias\r\n https://disqus.com/by/disqus_bTuZk1voC7/\r\n */\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Enero\", \"Febrero\", \"Marzo\", \"Abril\", \"Mayo\", \"Junio\", \"Julio\", \"Agosto\", \"Septiembre\", \"Octubre\", \"Noviembre\", \"Diciembre\"],\r\n\t\tmonth_short: [\"Ene\", \"Feb\", \"Mar\", \"Abr\", \"May\", \"Jun\", \"Jul\", \"Ago\", \"Sep\", \"Oct\", \"Nov\", \"Dic\"],\r\n\t\tday_full: [\"Domingo\", \"Lunes\", \"Martes\", \"Mircoles\", \"Jueves\", \"Viernes\", \"Sbado\"],\r\n\t\tday_short: [\"Dom\", \"Lun\", \"Mar\", \"Mi\", \"Jue\", \"Vie\", \"Sb\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nueva tarea\",\r\n\t\ticon_save: \"Guardar\",\r\n\t\ticon_cancel: \"Cancelar\",\r\n\t\ticon_details: \"Detalles\",\r\n\t\ticon_edit: \"Editar\",\r\n\t\ticon_delete: \"Eliminar\",\r\n\t\tconfirm_closing: \"\", // \"Sus cambios se perdern, continuar ?\"\r\n\t\tconfirm_deleting: \"El evento se borrar definitivamente, continuar?\",\r\n\t\tsection_description: \"Descripcin\",\r\n\t\tsection_time: \"Perodo\",\r\n\t\tsection_type: \"Tipo\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"EDT\",\r\n\t\tcolumn_text: \"Tarea\",\r\n\t\tcolumn_start_date: \"Inicio\",\r\n\t\tcolumn_duration: \"Duracin\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Enlace\",\r\n\t\tconfirm_link_deleting: \"ser borrada\",\r\n\t\tlink_start: \" (inicio)\",\r\n\t\tlink_end: \" (fin)\",\r\n\r\n\t\ttype_task: \"Tarea\",\r\n\t\ttype_project: \"Proyecto\",\r\n\t\ttype_milestone: \"Hito\",\r\n\r\n\r\n\t\tminutes: \"Minutos\",\r\n\t\thours: \"Horas\",\r\n\t\tdays: \"Das\",\r\n\t\tweeks: \"Semanas\",\r\n\t\tmonths: \"Meses\",\r\n\t\tyears: \"Aos\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Cancelar\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n dhtmlxGantt Persian (Farsi, fa_IR) locale by Mohammad Shokri http://slashsbin.com/\r\n */\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\"\r\n\t\t],\r\n\t\tmonth_short: [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\"],\r\n\t\tday_full: [\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\"\r\n\t\t],\r\n\t\tday_short: [\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\",\r\n\t\t\t\"\"\r\n\t\t]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \" \",\r\n\t\ticon_save: \"\",\r\n\t\ticon_cancel: \"\",\r\n\t\ticon_details: \"\",\r\n\t\ticon_edit: \"\",\r\n\t\ticon_delete: \"\",\r\n\t\tconfirm_closing: \"       \",\r\n\t\tconfirm_deleting: \"         \",\r\n\t\tsection_description: \"\",\r\n\t\tsection_time: \" \",\r\n\t\tsection_type: \"\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"\",\r\n\t\tcolumn_start_date: \" \",\r\n\t\tcolumn_duration: \"\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"\",\r\n\t\tconfirm_link_deleting: \"  \",\r\n\t\tlink_start: \" ()\",\r\n\t\tlink_end: \" ()\",\r\n\r\n\t\ttype_task: \"\",\r\n\t\ttype_project: \"\",\r\n\t\ttype_milestone: \"\",\r\n\r\n\t\tminutes: \"\",\r\n\t\thours: \"\",\r\n\t\tdays: \"\",\r\n\t\tweeks: \"\",\r\n\t\tmonths: \"\",\r\n\t\tyears: \"\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"\",\r\n\t\tmessage_cancel: \"\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Tammikuu\", \"Helmikuu\", \"Maaliskuu\", \"Huhtikuu\", \"Toukokuu\", \"Kes&auml;kuu\", \"Hein&auml;kuu\", \"Elokuu\", \"Syyskuu\", \"Lokakuu\", \"Marraskuu\", \"Joulukuu\"],\r\n\t\tmonth_short: [\"Tam\", \"Hel\", \"Maa\", \"Huh\", \"Tou\", \"Kes\", \"Hei\", \"Elo\", \"Syy\", \"Lok\", \"Mar\", \"Jou\"],\r\n\t\tday_full: [\"Sunnuntai\", \"Maanantai\", \"Tiistai\", \"Keskiviikko\", \"Torstai\", \"Perjantai\", \"Lauantai\"],\r\n\t\tday_short: [\"Su\", \"Ma\", \"Ti\", \"Ke\", \"To\", \"Pe\", \"La\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Uusi tehtv\",\r\n\t\ticon_save: \"Tallenna\",\r\n\t\ticon_cancel: \"Peru\",\r\n\t\ticon_details: \"Tiedot\",\r\n\t\ticon_edit: \"Muokkaa\",\r\n\t\ticon_delete: \"Poista\",\r\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"Haluatko varmasti poistaa tapahtuman?\",\r\n\t\tsection_description: \"Kuvaus\",\r\n\t\tsection_time: \"Aikajakso\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Peru\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Janvier\", \"Fvrier\", \"Mars\", \"Avril\", \"Mai\", \"Juin\", \"Juillet\", \"Aot\", \"Septembre\", \"Octobre\", \"Novembre\", \"Dcembre\"],\r\n\t\tmonth_short: [\"Jan\", \"Fv\", \"Mar\", \"Avr\", \"Mai\", \"Juin\", \"Juil\", \"Ao\", \"Sep\", \"Oct\", \"Nov\", \"Dc\"],\r\n\t\tday_full: [\"Dimanche\", \"Lundi\", \"Mardi\", \"Mercredi\", \"Jeudi\", \"Vendredi\", \"Samedi\"],\r\n\t\tday_short: [\"Dim\", \"Lun\", \"Mar\", \"Mer\", \"Jeu\", \"Ven\", \"Sam\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nouvelle tche\",\r\n\t\ticon_save: \"Enregistrer\",\r\n\t\ticon_cancel: \"Annuler\",\r\n\t\ticon_details: \"Dtails\",\r\n\t\ticon_edit: \"Modifier\",\r\n\t\ticon_delete: \"Effacer\",\r\n\t\tconfirm_closing: \"\",// Vos modifications seront perdus, tes-vous sr ?\r\n\t\tconfirm_deleting: \"L'vnement sera effac sans appel, tes-vous sr ?\",\r\n\r\n\t\tsection_description: \"Description\",\r\n\t\tsection_time: \"Priode\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"OTP\",\r\n\t\tcolumn_text: \"Nom de la tche\",\r\n\t\tcolumn_start_date: \"Date initiale\",\r\n\t\tcolumn_duration: \"Dure\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Le lien\",\r\n\t\tconfirm_link_deleting: \"sera supprim\",\r\n\t\tlink_start: \"(dbut)\",\r\n\t\tlink_end: \"(fin)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Heures\",\r\n\t\tdays: \"Jours\",\r\n\t\tweeks: \"Semaines\",\r\n\t\tmonths: \"Mois\",\r\n\t\tyears: \"Annes\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Annuler\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tmonth_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \" \",\r\n\t\ticon_save: \"\",\r\n\t\ticon_cancel: \"\",\r\n\t\ticon_details: \"\",\r\n\t\ticon_edit: \"\",\r\n\t\ticon_delete: \"\",\r\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"  .?\",\r\n\t\tsection_description: \"\",\r\n\t\tsection_time: \"\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n  Translation by Davor\r\n http://docs.dhtmlx.com/gantt/desktop__localization.html#comment-2569116291\r\n */\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Sijeanj\", \"Veljaa\", \"Oujak\", \"Travanj\", \"Svibanj\", \"Lipanj\", \"Srpanj\", \"Kolovoz\", \"Rujan\", \"Listopad\", \"Studeni\", \"Prosinac\"],\r\n\t\tmonth_short: [\"Sij\", \"Velj\", \"Ou\", \"Tra\", \"Svi\", \"Lip\", \"Srp\", \"Kol\", \"Ruj\", \"Lis\", \"Stu\", \"Pro\"],\r\n\t\tday_full: [\"Nedjelja\", \"Ponedjeljak\", \"Utorak\", \"Srijeda\", \"etvrtak\", \"Petak\", \"Subota\"],\r\n\t\tday_short: [\"Ned\", \"Pon\", \"Uto\", \"Sri\", \"et\", \"Pet\", \"Sub\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Novi Zadatak\",\r\n\t\ticon_save: \"Spremi\",\r\n\t\ticon_cancel: \"Odustani\",\r\n\t\ticon_details: \"Detalji\",\r\n\t\ticon_edit: \"Izmjeni\",\r\n\t\ticon_delete: \"Obrii\",\r\n\t\tconfirm_closing: \"\",\r\n\t\tconfirm_deleting: \"Zadatak e biti trajno izbrisan, jeste li sigurni?\",\r\n\t\tsection_description: \"Opis\",\r\n\t\tsection_time: \"Vremenski Period\",\r\n\t\tsection_type: \"Tip\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\r\n\t\t/* grid columns */\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Naziv Zadatka\",\r\n\t\tcolumn_start_date: \"Poetno Vrijeme\",\r\n\t\tcolumn_duration: \"Trajanje\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Poveznica\",\r\n\t\tconfirm_link_deleting: \"e biti izbrisan\",\r\n\t\tlink_start: \" (poetak)\",\r\n\t\tlink_end: \" (kraj)\",\r\n\r\n\t\ttype_task: \"Zadatak\",\r\n\t\ttype_project: \"Projekt\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\t\tminutes: \"Minute\",\r\n\t\thours: \"Sati\",\r\n\t\tdays: \"Dani\",\r\n\t\tweeks: \"Tjedni\",\r\n\t\tmonths: \"Mjeseci\",\r\n\t\tyears: \"Godine\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Odustani\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Janur\", \"Februr\", \"Mrcius\", \"prilis\", \"Mjus\", \"Jnius\", \"Jlius\", \"Augusztus\", \"Szeptember\", \"Oktber\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mr\", \"pr\", \"Mj\", \"Jn\", \"Jl\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Vasrnap\", \"Htf\", \"Kedd\", \"Szerda\", \"Cstrtk\", \"Pntek\", \"szombat\"],\r\n\t\tday_short: [\"Va\", \"H\", \"Ke\", \"Sze\", \"Cs\", \"P\", \"Szo\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"j feladat\",\r\n\t\ticon_save: \"Ments\",\r\n\t\ticon_cancel: \"Mgse\",\r\n\t\ticon_details: \"Rszletek\",\r\n\t\ticon_edit: \"Szerkeszts\",\r\n\t\ticon_delete: \"Trls\",\r\n\t\tconfirm_closing: \"\", // A vltozsok elvesznek, biztosan folytatja? \"\r\n\t\tconfirm_deleting: \"Az esemny trlve lesz, biztosan folytatja?\",\r\n\t\tsection_description: \"Lers\",\r\n\t\tsection_time: \"Idszak\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Mgse\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Januari\", \"Februari\", \"Maret\", \"April\", \"Mei\", \"Juni\", \"Juli\", \"Agustus\", \"September\", \"Oktober\", \"November\", \"Desember\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Mei\", \"Jun\", \"Jul\", \"Ags\", \"Sep\", \"Okt\", \"Nov\", \"Des\"],\r\n\t\tday_full: [\"Minggu\", \"Senin\", \"Selasa\", \"Rabu\", \"Kamis\", \"Jumat\", \"Sabtu\"],\r\n\t\tday_short: [\"Ming\", \"Sen\", \"Sel\", \"Rab\", \"Kam\", \"Jum\", \"Sab\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Tugas baru\",\r\n\t\ticon_save: \"Simpan\",\r\n\t\ticon_cancel: \"Batal\",\r\n\t\ticon_details: \"Detail\",\r\n\t\ticon_edit: \"Edit\",\r\n\t\ticon_delete: \"Hapus\",\r\n\t\tconfirm_closing: \"\", /* Perubahan tidak akan disimpan ? */\r\n\t\tconfirm_deleting: \"Acara akan dihapus\",\r\n\t\tsection_description: \"Keterangan\",\r\n\t\tsection_time: \"Periode\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Batal\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n Update 29/12/2015:\r\n New labels translation by ARCANGELI CLAUDIO\r\n\r\n */\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Gennaio\", \"Febbraio\", \"Marzo\", \"Aprile\", \"Maggio\", \"Giugno\", \"Luglio\", \"Agosto\", \"Settembre\", \"Ottobre\", \"Novembre\", \"Dicembre\"],\r\n\t\tmonth_short: [\"Gen\", \"Feb\", \"Mar\", \"Apr\", \"Mag\", \"Giu\", \"Lug\", \"Ago\", \"Set\", \"Ott\", \"Nov\", \"Dic\"],\r\n\t\tday_full: [\"Domenica\", \"Luned\", \"Marted\", \"Mercoled\", \"Gioved\", \"Venerd\", \"Sabato\"],\r\n\t\tday_short: [\"Dom\", \"Lun\", \"Mar\", \"Mer\", \"Gio\", \"Ven\", \"Sab\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nuovo compito\",\r\n\t\ticon_save: \"Salva\",\r\n\t\ticon_cancel: \"Chiudi\",\r\n\t\ticon_details: \"Dettagli\",\r\n\t\ticon_edit: \"Modifica\",\r\n\t\ticon_delete: \"Elimina\",\r\n\t\tconfirm_closing: \"\",// \"Sei sicuro di confermare la chiusura?\",\r\n\t\tconfirm_deleting: \"Sei sicuro di confermare l'eliminazione?\",\r\n\t\tsection_description: \"Descrizione\",\r\n\t\tsection_time: \"Periodo di tempo\",\r\n\t\tsection_type: \"Tipo\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Nome Attivit\",\r\n\t\tcolumn_start_date: \"Inizio\",\r\n\t\tcolumn_duration: \"Durata\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"sar eliminato\",\r\n\t\tlink_start: \" (inizio)\",\r\n\t\tlink_end: \" (fine)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minuti\",\r\n\t\thours: \"Ore\",\r\n\t\tdays: \"Giorni\",\r\n\t\tweeks: \"Settimane\",\r\n\t\tmonths: \"Mesi\",\r\n\t\tyears: \"Anni\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Chiudi\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n Translation by Genexus Japan Inc.\r\n */\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\"],\r\n\t\tmonth_short: [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\"],\r\n\t\tday_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"\",\r\n\t\ticon_save: \"\",\r\n\t\ticon_cancel: \"\",\r\n\t\ticon_details: \"\",\r\n\t\ticon_edit: \"\",\r\n\t\ticon_delete: \"\",\r\n\t\tconfirm_closing: \"\", // \r\n\t\tconfirm_deleting: \"\",\r\n\t\tsection_description: \"\",\r\n\t\tsection_time: \"\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n\tTranslated by cjkim@dbvalley.com\r\n*/\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\"],\r\n\t\tmonth_short: [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\"],\r\n\t\tday_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \" \",\r\n\t\ticon_save: \"\",\r\n\t\ticon_cancel: \"\",\r\n\t\ticon_details: \" \",\r\n\t\ticon_edit: \"\",\r\n\t\ticon_delete: \"\",\r\n\t\tconfirm_closing: \"\",\r\n\t\tconfirm_deleting: \" ?\",\r\n\t\tsection_description: \"\",\r\n\t\tsection_time: \"\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"\",\r\n\t\tcolumn_start_date: \"\",\r\n\t\tcolumn_duration: \"\",\r\n\t\tcolumn_add: \"\",\r\n\t\tlink: \"\",\r\n\t\tconfirm_link_deleting: \" ?\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\t\ttype_task: \"\",\r\n\t\ttype_project: \"\",\r\n\t\ttype_milestone: \"\",\r\n\t\tminutes: \"\",\r\n\t\thours: \"\",\r\n\t\tdays: \"\",\r\n\t\tweeks: \"\",\r\n\t\tmonths: \"\",\r\n\t\tyears: \"\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","export default class LocaleManager{\r\n\tprivate _locales:{[key:string]: IGanttLocale };\r\n\r\n\tconstructor(config: {[key:string]: IGanttLocale }){\r\n\t\tthis._locales = {};\r\n\t\tfor(const i in config){\r\n\t\t\tthis._locales[i] = config[i];\r\n\t\t}\r\n\t}\r\n\r\n\taddLocale = (name: string, locale: IGanttLocale) => {\r\n\t\tthis._locales[name] = locale;\r\n\t};\r\n\r\n\tgetLocale = (name: string): IGanttLocale => {\r\n\t\treturn this._locales[name];\r\n\t};\r\n}","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Januar\", \"Februar\", \"Mars\", \"April\", \"Mai\", \"Juni\", \"Juli\", \"August\", \"September\", \"Oktober\", \"November\", \"Desember\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Mai\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Des\"],\r\n\t\tday_full: [\"Sndag\", \"Mandag\", \"Tirsdag\", \"Onsdag\", \"Torsdag\", \"Fredag\", \"Lrdag\"],\r\n\t\tday_short: [\"Sn\", \"Mon\", \"Tir\", \"Ons\", \"Tor\", \"Fre\", \"Lr\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Ny oppgave\",\r\n\t\ticon_save: \"Lagre\",\r\n\t\ticon_cancel: \"Avbryt\",\r\n\t\ticon_details: \"Detaljer\",\r\n\t\ticon_edit: \"Rediger\",\r\n\t\ticon_delete: \"Slett\",\r\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"Hendelsen vil bli slettet permanent. Er du sikker?\",\r\n\t\tsection_description: \"Beskrivelse\",\r\n\t\tsection_time: \"Tidsperiode\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Avbryt\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Januari\", \"Februari\", \"Maart\", \"April\", \"Mei\", \"Juni\", \"Juli\", \"Augustus\", \"September\", \"Oktober\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"mrt\", \"Apr\", \"Mei\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Zondag\", \"Maandag\", \"Dinsdag\", \"Woensdag\", \"Donderdag\", \"Vrijdag\", \"Zaterdag\"],\r\n\t\tday_short: [\"Zo\", \"Ma\", \"Di\", \"Wo\", \"Do\", \"Vr\", \"Za\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nieuwe taak\",\r\n\t\ticon_save: \"Opslaan\",\r\n\t\ticon_cancel: \"Annuleren\",\r\n\t\ticon_details: \"Details\",\r\n\t\ticon_edit: \"Bewerken\",\r\n\t\ticon_delete: \"Verwijderen\",\r\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"Item zal permanent worden verwijderd, doorgaan?\",\r\n\t\tsection_description: \"Beschrijving\",\r\n\t\tsection_time: \"Tijd periode\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Taak omschrijving\",\r\n\t\tcolumn_start_date: \"Startdatum\",\r\n\t\tcolumn_duration: \"Duur\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Koppeling\",\r\n\t\tconfirm_link_deleting: \"zal worden verwijderd\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (eind)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"minuten\",\r\n\t\thours: \"uren\",\r\n\t\tdays: \"dagen\",\r\n\t\tweeks: \"weken\",\r\n\t\tmonths: \"maanden\",\r\n\t\tyears: \"jaren\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Annuleren\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Januar\", \"Februar\", \"Mars\", \"April\", \"Mai\", \"Juni\", \"Juli\", \"August\", \"September\", \"Oktober\", \"November\", \"Desember\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Mai\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Des\"],\r\n\t\tday_full: [\"Sndag\", \"Mandag\", \"Tirsdag\", \"Onsdag\", \"Torsdag\", \"Fredag\", \"Lrdag\"],\r\n\t\tday_short: [\"Sn\", \"Man\", \"Tir\", \"Ons\", \"Tor\", \"Fre\", \"Lr\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Ny oppgave\",\r\n\t\ticon_save: \"Lagre\",\r\n\t\ticon_cancel: \"Avbryt\",\r\n\t\ticon_details: \"Detaljer\",\r\n\t\ticon_edit: \"Endre\",\r\n\t\ticon_delete: \"Slett\",\r\n\t\tconfirm_closing: \"Endringer blir ikke lagret, er du sikker?\", // Endringer blir ikke lagret, er du sikker?\r\n\t\tconfirm_deleting: \"Oppfringen vil bli slettet, er du sikker?\",\r\n\t\tsection_description: \"Beskrivelse\",\r\n\t\tsection_time: \"Tidsperiode\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Avbryt\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Stycze\", \"Luty\", \"Marzec\", \"Kwiecie\", \"Maj\", \"Czerwiec\", \"Lipiec\", \"Sierpie\", \"Wrzesie\", \"Padziernik\", \"Listopad\", \"Grudzie\"],\r\n\t\tmonth_short: [\"Sty\", \"Lut\", \"Mar\", \"Kwi\", \"Maj\", \"Cze\", \"Lip\", \"Sie\", \"Wrz\", \"Pa\", \"Lis\", \"Gru\"],\r\n\t\tday_full: [\"Niedziela\", \"Poniedziaek\", \"Wtorek\", \"roda\", \"Czwartek\", \"Pitek\", \"Sobota\"],\r\n\t\tday_short: [\"Nie\", \"Pon\", \"Wto\", \"ro\", \"Czw\", \"Pi\", \"Sob\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nowe zadanie\",\r\n\t\ticon_save: \"Zapisz\",\r\n\t\ticon_cancel: \"Anuluj\",\r\n\t\ticon_details: \"Szczegy\",\r\n\t\ticon_edit: \"Edytuj\",\r\n\t\ticon_delete: \"Usu\",\r\n\t\tconfirm_closing: \"\", // Zmiany zostan usunite, jeste pewien?\r\n\t\tconfirm_deleting: \"Zdarzenie zostanie usunite na zawsze, kontynuowa?\",\r\n\t\tsection_description: \"Opis\",\r\n\t\tsection_time: \"Okres czasu\",\r\n\t\tsection_type: \"Typ\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Nazwa zadania\",\r\n\t\tcolumn_start_date: \"Pocztek\",\r\n\t\tcolumn_duration: \"Czas trwania\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"zostanie usunity\",\r\n\t\tlink_start: \" (pocztek)\",\r\n\t\tlink_end: \" (koniec)\",\r\n\r\n\t\ttype_task: \"Zadanie\",\r\n\t\ttype_project: \"Projekt\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minuty\",\r\n\t\thours: \"Godziny\",\r\n\t\tdays: \"Dni\",\r\n\t\tweeks: \"Tydzie\",\r\n\t\tmonths: \"Miesice\",\r\n\t\tyears: \"Lata\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Anuluj\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n\r\n TRANSLATION BY MATTHEUS PIROVANI RORIZ GONALVES\r\n\r\n mattheusroriz@hotmail.com / mattheus.pirovani@gmail.com /\r\n\r\n www.atrixian.com.br\r\n\r\n\r\n Updated by Jorge Albernaz Martins\r\n\r\n jorgefox@hotmail.com\r\n\r\n www.redfox.inf.br\r\n\r\n JorgeFox\r\n\r\n*/\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Janeiro\", \"Fevereiro\", \"Maro\", \"Abril\", \"Maio\", \"Junho\", \"Julho\", \"Agosto\", \"Setembro\", \"Outubro\", \"Novembro\", \"Dezembro\"],\r\n\t\tmonth_short: [\"Jan\", \"Fev\", \"Mar\", \"Abr\", \"Mai\", \"Jun\", \"Jul\", \"Ago\", \"Set\", \"Out\", \"Nov\", \"Dez\"],\r\n\t\tday_full: [\"Domingo\", \"Segunda\", \"Tera\", \"Quarta\", \"Quinta\", \"Sexta\", \"Sbado\"],\r\n\t\tday_short: [\"Dom\", \"Seg\", \"Ter\", \"Qua\", \"Qui\", \"Sex\", \"Sab\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nova tarefa\",\r\n\t\ticon_save: \"Salvar\",\r\n\t\ticon_cancel: \"Cancelar\",\r\n\t\ticon_details: \"Detalhes\",\r\n\t\ticon_edit: \"Editar\",\r\n\t\ticon_delete: \"Excluir\",\r\n\t\tconfirm_closing: \"\",// Suas alteraes sero perdidas, confirme?\r\n\t\tconfirm_deleting: \"As tarefas sero excluidas permanentemente, confirme?\",\r\n\t\tsection_description: \"Descrio\",\r\n\t\tsection_time: \"Perodo\",\r\n\t\tsection_type: \"Tipo\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"EAP\",\r\n\t\tcolumn_text: \"Nome tarefa\",\r\n\t\tcolumn_start_date: \"Data incio\",\r\n\t\tcolumn_duration: \"Durao\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"Ser excludo!\",\r\n\t\tlink_start: \" (incio)\",\r\n\t\tlink_end: \" (fim)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Projeto\",\r\n\t\ttype_milestone: \"Marco\",\r\n\r\n\r\n\t\tminutes: \"Minutos\",\r\n\t\thours: \"Horas\",\r\n\t\tdays: \"Dias\",\r\n\t\tweeks: \"Semanas\",\r\n\t\tmonths: \"Meses\",\r\n\t\tyears: \"Anos\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Cancelar\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Restrio\",\r\n\t\tconstraint_type: \"Tipo Restrio\",\r\n\t\tconstraint_date: \"Data restrio\",\r\n\t\tasap: \"Mais breve possvel\",\r\n\t\talap: \"Mais tarde possvel\",\r\n\t\tsnet: \"No comear antes de\",\r\n\t\tsnlt: \"No comear depois de\",\r\n\t\tfnet: \"No terminar antes de\",\r\n\t\tfnlt: \"No terminar depois de\",\r\n\t\tmso: \"Precisa comear em\",\r\n\t\tmfo: \"Precisa terminar em\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n\tTraducere de Ovidiu Lixandru: http://www.madball.ro\r\n */\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Ianuarie\", \"Februarie\", \"Martie\", \"Aprilie\", \"Mai\", \"Iunie\", \"Iulie\", \"August\", \"Septembrie\", \"Octombrie\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Ian\", \"Feb\", \"Mar\", \"Apr\", \"Mai\", \"Iun\", \"Iul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Duminica\", \"Luni\", \"Marti\", \"Miercuri\", \"Joi\", \"Vineri\", \"Sambata\"],\r\n\t\tday_short: [\"Du\", \"Lu\", \"Ma\", \"Mi\", \"Jo\", \"Vi\", \"Sa\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Sarcina noua\",\r\n\t\ticon_save: \"Salveaza\",\r\n\t\ticon_cancel: \"Anuleaza\",\r\n\t\ticon_details: \"Detalii\",\r\n\t\ticon_edit: \"Editeaza\",\r\n\t\ticon_delete: \"Sterge\",\r\n\t\tconfirm_closing: \"Schimbarile nu vor fi salvate, esti sigur?\",// Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"Evenimentul va fi sters permanent, esti sigur?\",\r\n\t\tsection_description: \"Descriere\",\r\n\t\tsection_time: \"Interval\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Anuleaza\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"\", \"\", \"\", \"\", \"Ma\", \"\", \"\", \"\", \"\", \"O\", \"\", \"\"],\r\n\t\tmonth_short: [\"\", \"\", \"Ma\", \"A\", \"Ma\", \"\", \"\", \"A\", \"\", \"\", \"\", \"\"],\r\n\t\tday_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \" \",\r\n\t\ticon_save: \"\",\r\n\t\ticon_cancel: \"\",\r\n\t\ticon_details: \"\",\r\n\t\ticon_edit: \"\",\r\n\t\ticon_delete: \"\",\r\n\t\tconfirm_closing: \"\", //    , ?\r\n\t\tconfirm_deleting: \"   , ?\",\r\n\t\tsection_description: \"\",\r\n\t\tsection_time: \" \",\r\n\t\tsection_type: \"\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"\",\r\n\t\tcolumn_text: \"\",\r\n\t\tcolumn_start_date: \"\",\r\n\t\tcolumn_duration: \"\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"\",\r\n\t\tconfirm_link_deleting: \" \",\r\n\t\tlink_start: \" ()\",\r\n\t\tlink_end: \" ()\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"\",\r\n\t\thours: \"\",\r\n\t\tdays: \"\",\r\n\t\tweeks: \"\",\r\n\t\tmonths: \"\",\r\n\t\tyears: \"\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Januar\", \"Februar\", \"Marec\", \"April\", \"Maj\", \"Junij\", \"Julij\", \"Avgust\", \"September\", \"Oktober\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Maj\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Nedelja\", \"Ponedeljek\", \"Torek\", \"Sreda\", \"etrtek\", \"Petek\", \"Sobota\"],\r\n\t\tday_short: [\"Ned\", \"Pon\", \"Tor\", \"Sre\", \"et\", \"Pet\", \"Sob\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nova naloga\",\r\n\t\ticon_save: \"Shrani\",\r\n\t\ticon_cancel: \"Preklii\",\r\n\t\ticon_details: \"Podrobnosti\",\r\n\t\ticon_edit: \"Uredi\",\r\n\t\ticon_delete: \"Izbrii\",\r\n\t\tconfirm_closing: \"\", // Spremembe ne bodo shranjene. elite nadaljevati ?\r\n\t\tconfirm_deleting: \"Dogodek bo izbrisan. elite nadaljevati?\",\r\n\t\tsection_description: \"Opis\",\r\n\t\tsection_time: \"asovni okvir\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Preklii\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Janur\", \"Februr\", \"Marec\", \"Aprl\", \"Mj\", \"Jn\", \"Jl\", \"August\", \"September\", \"Oktber\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Mj\", \"Jn\", \"Jl\", \"Aug\", \"Sept\", \"Okt\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Nedea\", \"Pondelok\", \"Utorok\", \"Streda\", \"tvrtok\", \"Piatok\", \"Sobota\"],\r\n\t\tday_short: [\"Ne\", \"Po\", \"Ut\", \"St\", \"t\", \"Pi\", \"So\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nov loha\",\r\n\t\ticon_save: \"Uloi\",\r\n\t\ticon_cancel: \"Sp\",\r\n\t\ticon_details: \"Detail\",\r\n\t\ticon_edit: \"Edituj\",\r\n\t\ticon_delete: \"Zmaza\",\r\n\t\tconfirm_closing: \"Vae zmeny nebud uloen. Skutone?\", // Vae zmny budou ztraceny, opravdu ?\r\n\t\tconfirm_deleting: \"Udalos bude natrvalo vymazan. Skutone?\",\r\n\t\tsection_description: \"Poznmky\",\r\n\t\tsection_time: \"Doba platnosti\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Sp\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n\tTranslation by Peter Eriksson\r\n */\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Januari\", \"Februari\", \"Mars\", \"April\", \"Maj\", \"Juni\", \"Juli\", \"Augusti\", \"September\", \"Oktober\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Maj\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Sndag\", \"Mndag\", \"Tisdag\", \"Onsdag\", \"Torsdag\", \"Fredag\", \"Lrdag\"],\r\n\t\tday_short: [\"Sn\", \"Mn\", \"Tis\", \"Ons\", \"Tor\", \"Fre\", \"Lr\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Ny uppgift\",\r\n\t\ticon_save: \"Spara\",\r\n\t\ticon_cancel: \"Avbryt\",\r\n\t\ticon_details: \"Detajer\",\r\n\t\ticon_edit: \"ndra\",\r\n\t\ticon_delete: \"Ta bort\",\r\n\t\tconfirm_closing: \"\",\r\n\t\tconfirm_deleting: \"r du sker p att du vill ta bort hndelsen permanent?\",\r\n\t\tsection_description: \"Beskrivning\",\r\n\t\tsection_time: \"Tid\",\r\n\t\tsection_type: \"Typ\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Uppgiftsnamn\",\r\n\t\tcolumn_start_date: \"Starttid\",\r\n\t\tcolumn_duration: \"Varaktighet\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\r\n\t\tlink: \"Lnk\",\r\n\t\tconfirm_link_deleting: \"kommer tas bort\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (slut)\",\r\n\t\ttype_task: \"Uppgift\",\r\n\t\ttype_project: \"Projekt\",\r\n\t\ttype_milestone: \"Milstolpe\",\r\n\r\n\t\tminutes: \"Minuter\",\r\n\t\thours: \"Timmar\",\r\n\t\tdays: \"Dagar\",\r\n\t\tweeks: \"Veckor\",\r\n\t\tmonths: \"Mnader\",\r\n\t\tyears: \"r\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Avbryt\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n * updated by @levkar at https://github.com/DHTMLX/gantt/pull/10\r\n */\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Ocak\", \"ubat\", \"Mart\", \"Nisan\", \"Mays\", \"Haziran\", \"Temmuz\", \"Austos\", \"Eyll\", \"Ekim\", \"Kasm\", \"Aralk\"],\r\n\t\tmonth_short: [\"Oca\", \"ub\", \"Mar\", \"Nis\", \"May\", \"Haz\", \"Tem\", \"Au\", \"Eyl\", \"Eki\", \"Kas\", \"Ara\"],\r\n\t\tday_full: [\"Pazar\", \"Pazartesi\", \"Sal\", \"aramba\", \"Perembe\", \"Cuma\", \"Cumartesi\"],\r\n\t\tday_short: [\"Paz\", \"Pzt\", \"Sal\", \"ar\", \"Per\", \"Cum\", \"Cmt\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Yeni grev\",\r\n\t\ticon_save: \"Kaydet\",\r\n\t\ticon_cancel: \"ptal\",\r\n\t\ticon_details: \"Detaylar\",\r\n\t\ticon_edit: \"Dzenle\",\r\n\t\ticon_delete: \"Sil\",\r\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"Grev silinecek, emin misiniz?\",\r\n\t\tsection_description: \"Aklama\",\r\n\t\tsection_time: \"Zaman Aral\",\r\n\t\tsection_type: \"Tip\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Grev Ad\",\r\n\t\tcolumn_start_date: \"Balang\",\r\n\t\tcolumn_duration: \"Sre\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Balant\",\r\n\t\tconfirm_link_deleting: \"silinecek\",\r\n\t\tlink_start: \" (balang)\",\r\n\t\tlink_end: \" (biti)\",\r\n\r\n\t\ttype_task: \"Grev\",\r\n\t\ttype_project: \"Proje\",\r\n\t\ttype_milestone: \"Kilometreta\",\r\n\r\n\r\n\t\tminutes: \"Dakika\",\r\n\t\thours: \"Saat\",\r\n\t\tdays: \"Gn\",\r\n\t\tweeks: \"Hafta\",\r\n\t\tmonths: \"Ay\",\r\n\t\tyears: \"Yl\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"ptal\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tmonth_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"],\r\n\t\tday_full: [\"\", \"\", \"\", \"\", \"\", \"'\", \"\"],\r\n\t\tday_short: [\"\", \"\", \"\", \"\", \"\", \"\", \"\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \" \",\r\n\t\ticon_save: \"\",\r\n\t\ticon_cancel: \"\",\r\n\t\ticon_details: \"\",\r\n\t\ticon_edit: \"\",\r\n\t\ticon_delete: \"\",\r\n\t\tconfirm_closing: \"\", //   .   ?\r\n\t\tconfirm_deleting: \"  .  ?\",\r\n\t\tsection_description: \"\",\r\n\t\tsection_time: \" \",\r\n\t\tsection_type: \"\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tsection_new_resources: \"Resources\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_add_button: \"Add Assignment\",\r\n\t\tresources_filter_placeholder: \"Search...\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\t\tresources_section_placeholder: \"Nothing assigned yet. Click 'Add Assignment' to assign resources.\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","import ar from \"./locale_ar\";\r\nimport be from \"./locale_be\";\r\nimport ca from \"./locale_ca\";\r\nimport cn from \"./locale_cn\";\r\nimport cs from \"./locale_cs\";\r\nimport da from \"./locale_da\";\r\nimport de from \"./locale_de\";\r\nimport el from \"./locale_el\";\r\nimport en from \"./locale_en\";\r\nimport es from \"./locale_es\";\r\nimport fa from \"./locale_fa\";\r\nimport fi from \"./locale_fi\";\r\nimport fr from \"./locale_fr\";\r\nimport he from \"./locale_he\";\r\nimport hr from \"./locale_hr\";\r\nimport hu from \"./locale_hu\";\r\nimport id from \"./locale_id\";\r\nimport it from \"./locale_it\";\r\nimport jp from \"./locale_jp\";\r\nimport kr from \"./locale_kr\";\r\n\r\nimport LocaleManager from \"./locale_manager\";\r\n\r\nimport nb from \"./locale_nb\";\r\nimport nl from \"./locale_nl\";\r\nimport no from \"./locale_no\";\r\nimport pl from \"./locale_pl\";\r\nimport pt from \"./locale_pt\";\r\nimport ro from \"./locale_ro\";\r\nimport ru from \"./locale_ru\";\r\nimport si from \"./locale_si\";\r\nimport sk from \"./locale_sk\";\r\nimport sv from \"./locale_sv\";\r\nimport tr from \"./locale_tr\";\r\nimport ua from \"./locale_ua\";\r\n\r\nexport default function(){\r\n\treturn new LocaleManager({\r\n\t\ten,\r\n\t\tar,\r\n\t\tbe,\r\n\t\tca,\r\n\t\tcn,\r\n\t\tcs,\r\n\t\tda,\r\n\t\tde,\r\n\t\tel,\r\n\t\tes,\r\n\t\tfa,\r\n\t\tfi,\r\n\t\tfr,\r\n\t\the,\r\n\t\thr,\r\n\t\thu,\r\n\t\tid,\r\n\t\tit,\r\n\t\tjp,\r\n\t\tkr,\r\n\t\tnb,\r\n\t\tnl,\r\n\t\tno,\r\n\t\tpl,\r\n\t\tpt,\r\n\t\tro,\r\n\t\tru,\r\n\t\tsi,\r\n\t\tsk,\r\n\t\tsv,\r\n\t\ttr,\r\n\t\tua\r\n\t});\r\n}","import * as utils from \"../utils/utils\";\r\nimport constants from \"../constants\";\r\nimport ExtensionManager from \"../ext/extension_manager\";\r\n\r\nimport services from \"../core/common/services\";\r\nimport config from \"../core/common/config\";\r\nimport ajax from \"../core/common/ajax\";\r\nimport date from \"../core/common/date\";\r\nimport {remoteEvents} from \"../core/remote/remote_events\";\r\n\r\nimport DnD from \"../core/common/dnd\";\r\nimport templates from \"../core/common/templates\";\r\nimport eventable from \"../utils/eventable\";\r\n\r\nimport StateService from \"../core/common/state\";\r\n\r\nimport Promise from \"../utils/promise\";\r\nimport env from \"../utils/env\";\r\nimport datastoreHooks from \"../core/datastore/datastore_hooks\";\r\nimport DataProcessor from \"../core/dataprocessor\";\r\n\r\nimport plugins from \"../core/plugins\";\r\n\r\nimport grid_column_api from \"../core/grid_column_api\";\r\nimport tasks from \"../core/tasks\";\r\nimport parsing from \"../core/loading/parsing\";\r\nimport work_time from \"../core/worktime/work_time\";\r\nimport data from \"../core/data\";\r\n\r\nimport void_script_second from \"../publish_helpers/void_script_second\";\r\n\r\nimport data_task_types from \"../core/data_task_types\";\r\nimport cached_functions from \"../core/cached_functions\";\r\n\r\nimport gantt_core from \"../core/gantt_core\";\r\nimport destructor from \"../core/destructor\";\r\nimport void_script_third from \"../publish_helpers/void_script_third\";\r\n\r\nimport i18nFactory from \"../locale\";\r\n\r\nfunction DHXGantt(){\r\n\tthis.constants = constants;\r\n\tthis.version = VERSION;\r\n\tthis.license = LICENSE;\r\n\tthis.templates = {};\r\n\tthis.ext = {};\r\n\tthis.keys = {\r\n\t\tedit_save: this.constants.KEY_CODES.ENTER,\r\n\t\tedit_cancel: this.constants.KEY_CODES.ESC\r\n\t};\r\n}\r\n\r\nexport default function(supportedExtensions) {\r\n\t// use a named constructor to make gantt instance discoverable in heap snapshots\r\n\tvar gantt = new DHXGantt();\r\n\r\n\tvar extensionManager = new ExtensionManager(supportedExtensions);\r\n\tvar activePlugins = {};\r\n\tgantt.plugins = function(config){\r\n\t\tfor(var i in config){\r\n\t\t\tif(config[i] && !activePlugins[i]){\r\n\t\t\t\tvar plugin = extensionManager.getExtension(i);\r\n\t\t\t\tif(plugin){\r\n\t\t\t\t\tplugin(gantt);\r\n\t\t\t\t\tactivePlugins[i] = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn activePlugins;\r\n\t};\r\n\r\n\tgantt.$services = services();\r\n\tgantt.config = config();\r\n\tgantt.ajax =  ajax(gantt);\r\n\tgantt.date = date(gantt);\r\n\tgantt.RemoteEvents = remoteEvents;\r\n\r\n\tvar dnd = DnD(gantt);\r\n\tgantt.$services.setService(\"dnd\", function(){return dnd;});\r\n\r\n\tvar templatesLoader = templates(gantt);\r\n\tgantt.$services.setService(\"templateLoader\", function () {\r\n\t\treturn templatesLoader;\r\n\t});\r\n\r\n\teventable(gantt);\r\n\r\n\t\r\n\tvar stateService = new StateService();\r\n\r\n\tstateService.registerProvider(\"global\", function () {\r\n\t\tvar res = {\r\n\t\t\tmin_date: gantt._min_date,\r\n\t\t\tmax_date: gantt._max_date,\r\n\t\t\tselected_task: null\r\n\t\t};\r\n\r\n\t\t// do not throw error if getState called from non-initialized gantt\r\n\t\tif(gantt.$data && gantt.$data.tasksStore){\r\n\t\t\tres.selected_task = gantt.$data.tasksStore.getSelectedId();\r\n\t\t}\r\n\t\treturn res;\r\n\t});\r\n\tgantt.getState = stateService.getState;\r\n\tgantt.$services.setService(\"state\", function () {\r\n\t\treturn stateService;\r\n\t});\r\n\r\n\tutils.mixin(gantt, utils);\r\n\r\n\tgantt.Promise = Promise;\r\n\tgantt.env = env;\r\n\r\n\tdatastoreHooks(gantt);\r\n\r\n\tgantt.dataProcessor = DataProcessor.DEPRECATED_api;\r\n\tgantt.createDataProcessor = DataProcessor.createDataProcessor;\r\n\r\n\tplugins(gantt);\r\n\r\n\tgrid_column_api(gantt);\r\n\ttasks(gantt);\r\n\tparsing(gantt);\r\n\twork_time(gantt);\r\n\tdata(gantt);\r\n\r\n\tvoid_script_second(gantt);\r\n\r\n\tdata_task_types(gantt);\r\n\tcached_functions(gantt);\r\n\r\n\tgantt_core(gantt);\r\n\tdestructor(gantt);\r\n\tvoid_script_third(gantt);\r\n\r\n\tvar i18n = i18nFactory();\r\n\tgantt.i18n = {\r\n\t\taddLocale: i18n.addLocale,\r\n\t\tsetLocale: function(locale){\r\n\t\t\tif(typeof locale === \"string\"){\r\n\t\t\t\tvar localeObject = i18n.getLocale(locale);\r\n\t\t\t\tif(!localeObject){\r\n\t\t\t\t\tlocaleObject = i18n.getLocale(\"en\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgantt.locale = localeObject;\r\n\t\t\t}else if(locale){\r\n\t\t\t\tif(!gantt.locale){\r\n\t\t\t\t\tgantt.locale = locale;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tfor(var i in locale){\r\n\t\t\t\t\t\tif(locale[i] && typeof locale[i] === \"object\"){\r\n\t\t\t\t\t\t\tif(!gantt.locale[i]){\r\n\t\t\t\t\t\t\t\tgantt.locale[i] = {};\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tgantt.mixin(gantt.locale[i], locale[i], true);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tgantt.locale[i] = locale[i];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst labels = gantt.locale.labels;\r\n\t\t\tlabels.gantt_save_btn = labels.gantt_save_btn || labels.icon_save;\r\n\t\t\tlabels.gantt_cancel_btn = labels.gantt_cancel_btn || labels.icon_cancel;\r\n\t\t\tlabels.gantt_delete_btn = labels.gantt_delete_btn || labels.icon_delete;\r\n\t\t},\r\n\t\tgetLocale: i18n.getLocale\r\n\t};\r\n\tgantt.i18n.setLocale(\"en\");\r\n\treturn gantt;\r\n};","import * as utils from \"../../utils/utils\";\r\nimport * as domHelpers from \"./utils/dom_helpers\";\r\n\r\nexport default function(gantt) {\r\n\r\n\tvar boxAttribute = \"data-dhxbox\";\r\n\r\n\tvar _dhx_msg_cfg = null;\r\n\r\n\tfunction callback(config, result) {\r\n\t\tvar usercall = config.callback;\r\n\t\tmodalBox.hide(config.box);\r\n\r\n\t\t_dhx_msg_cfg = config.box = null;\r\n\t\tif (usercall)\r\n\t\t\tusercall(result);\r\n\t}\r\n\r\n\tfunction modal_key(event) {\r\n\t\tif (_dhx_msg_cfg) {\r\n\r\n\t\t\tvar code = event.which || event.keyCode;\r\n\t\t\tvar preventDefault = false;\r\n\r\n\t\t\tif (messageBox.keyboard) {\r\n\t\t\t\tif (code == 13 || code == 32) {\r\n\t\t\t\t\t// default behavior is to confirm/submit popup on space/enter\r\n\t\t\t\t\t// if browser focus is set on button element - do button click instead of default behavior\r\n\t\t\t\t\tvar target = event.target || event.srcElement;\r\n\t\t\t\t\tif (domHelpers.getClassName(target).indexOf(\"gantt_popup_button\") > -1 && target.click) {\r\n\t\t\t\t\t\ttarget.click();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcallback(_dhx_msg_cfg, true);\r\n\t\t\t\t\t\tpreventDefault = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (code == 27) {\r\n\t\t\t\t\tcallback(_dhx_msg_cfg, false);\r\n\t\t\t\t\tpreventDefault = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (preventDefault) {\r\n\t\t\t\tif (event.preventDefault){\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t\treturn !(event.cancelBubble = true);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\tvar eventElement = domHelpers.getRootNode(gantt.$root) || document;\r\n\tgantt.event(eventElement, \"keydown\", modal_key, true);\r\n\r\n\tfunction modality(mode) {\r\n\t\tif (!modality.cover) {\r\n\t\t\tmodality.cover = document.createElement(\"div\");\r\n\t\t\t//necessary for IE only\r\n\t\t\tmodality.cover.onkeydown = modal_key;\r\n\t\t\tmodality.cover.className = \"dhx_modal_cover\";\r\n\t\t\tdocument.body.appendChild(modality.cover);\r\n\t\t}\r\n\r\n\t\tmodality.cover.style.display = mode ? \"inline-block\" : \"none\";\r\n\t}\r\n\r\n\tfunction button(text, className, result) {\r\n\t\tvar buttonAriaAttrs = gantt._waiAria.messageButtonAttrString(text);\r\n\t\tvar name = className.toLowerCase().replace(/ /g, \"_\");\r\n\t\tvar button_css = \"gantt_\" + name + \"_button\";\r\n\t\treturn \"<div \" + buttonAriaAttrs + \" class='gantt_popup_button \" + button_css + \"' data-result='\" + result + \"' result='\" + result + \"' ><div>\" + text + \"</div></div>\";\r\n\t}\r\n\r\n\tfunction info(text) {\r\n\t\tif (!messageBox.area) {\r\n\t\t\tmessageBox.area = document.createElement(\"div\");\r\n\t\t\tmessageBox.area.className = \"gantt_message_area\";\r\n\t\t\tmessageBox.area.style[messageBox.position] = \"5px\";\r\n\t\t}\r\n\t\tif (!domHelpers.isChildOf(messageBox.area, document.body)){\r\n\t\t\tdocument.body.appendChild(messageBox.area);\r\n\t\t}\r\n\r\n\t\tmessageBox.hide(text.id);\r\n\t\tvar message = document.createElement(\"div\");\r\n\t\tmessage.innerHTML = \"<div>\" + text.text + \"</div>\";\r\n\t\tmessage.className = \"gantt-info gantt-\" + text.type;\r\n\t\tmessage.onclick = function () {\r\n\t\t\tmessageBox.hide(text.id);\r\n\t\t\ttext = null;\r\n\t\t};\r\n\r\n\t\tgantt._waiAria.messageInfoAttr(message);\r\n\r\n\t\tif (messageBox.position == \"bottom\" && messageBox.area.firstChild)\r\n\t\t\tmessageBox.area.insertBefore(message, messageBox.area.firstChild);\r\n\t\telse\r\n\t\t\tmessageBox.area.appendChild(message);\r\n\r\n\t\tif (text.expire > 0)\r\n\t\t\tmessageBox.timers[text.id] = window.setTimeout(function () {\r\n\t\t\t\t// GS-1213: We need that when Gantt is destroyed\r\n\t\t\t\tif (messageBox) messageBox.hide(text.id);\r\n\t\t\t}, text.expire);\r\n\r\n\t\tmessageBox.pull[text.id] = message;\r\n\t\tmessage = null;\r\n\r\n\t\treturn text.id;\r\n\t}\r\n\r\n\tfunction getFirstDefined() {\r\n\t\tvar values = [].slice.apply(arguments, [0]);\r\n\r\n\t\tfor (var i = 0; i < values.length; i++) {\r\n\t\t\tif (values[i]) {\r\n\t\t\t\treturn values[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction _boxStructure(config, ok, cancel) {\r\n\t\tvar box = document.createElement(\"div\");\r\n\r\n\t\tvar contentId = utils.uid();\r\n\t\tgantt._waiAria.messageModalAttr(box, contentId);\r\n\r\n\r\n\t\tbox.className = \" gantt_modal_box gantt-\" + config.type;\r\n\t\tbox.setAttribute(boxAttribute, 1);\r\n\r\n\t\tvar inner = '';\r\n\r\n\t\tif (config.width)\r\n\t\t\tbox.style.width = config.width;\r\n\t\tif (config.height)\r\n\t\t\tbox.style.height = config.height;\r\n\t\tif (config.title)\r\n\t\t\tinner += '<div class=\"gantt_popup_title\">' + config.title + '</div>';\r\n\t\tinner += '<div class=\"gantt_popup_text\" id=\"' + contentId + '\"><span>' + (config.content ? '' : config.text) + '</span></div><div  class=\"gantt_popup_controls\">';\r\n\t\tif (ok)\r\n\t\t\tinner += button(getFirstDefined(config.ok, gantt.locale.labels.message_ok, \"OK\"), \"ok\", true);\r\n\t\tif (cancel)\r\n\t\t\tinner += button(getFirstDefined(config.cancel, gantt.locale.labels.message_cancel, \"Cancel\"), \"cancel\", false);\r\n\r\n\t\tif (config.buttons) {\r\n\t\t\tfor (var i = 0; i < config.buttons.length; i++) {\r\n\t\t\t\tvar btn = config.buttons[i];\r\n\t\t\t\tif (typeof btn == \"object\") {\r\n\t\t\t\t\t// Support { label:\"Save\", css:\"main_button\", value:\"save\" }\r\n\t\t\t\t\tvar label = btn.label;\r\n\t\t\t\t\tvar css = btn.css || (\"gantt_\" + btn.label.toLowerCase() + \"_button\");\r\n\t\t\t\t\tvar value = btn.value || i;\r\n\t\t\t\t\tinner += button(label, css, value);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tinner += button(btn, btn, i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tinner += '</div>';\r\n\t\tbox.innerHTML = inner;\r\n\r\n\t\tif (config.content) {\r\n\t\t\tvar node = config.content;\r\n\t\t\tif (typeof node == \"string\")\r\n\t\t\t\tnode = document.getElementById(node);\r\n\t\t\tif (node.style.display == 'none')\r\n\t\t\t\tnode.style.display = \"\";\r\n\t\t\tbox.childNodes[config.title ? 1 : 0].appendChild(node);\r\n\t\t}\r\n\r\n\t\tbox.onclick = function (event) {\r\n\t\t\tvar source = event.target || event.srcElement;\r\n\t\t\tif (!source.className) source = source.parentNode;\r\n\t\t\tif (domHelpers.closest(source, \".gantt_popup_button\")) {\r\n\t\t\t\tvar result = source.getAttribute(\"data-result\");\r\n\t\t\t\tresult = (result == \"true\") || (result == \"false\" ? false : result);\r\n\t\t\t\tcallback(config, result);\r\n\t\t\t}\r\n\t\t};\r\n\t\tconfig.box = box;\r\n\t\tif (ok || cancel)\r\n\t\t\t_dhx_msg_cfg = config;\r\n\r\n\t\treturn box;\r\n\t}\r\n\r\n\tfunction _createBox(config, ok, cancel) {\r\n\t\tvar box = config.tagName ? config : _boxStructure(config, ok, cancel);\r\n\r\n\t\tif (!config.hidden)\r\n\t\t\tmodality(true);\r\n\t\tdocument.body.appendChild(box);\r\n\t\tvar x = Math.abs(Math.floor(((window.innerWidth || document.documentElement.offsetWidth) - box.offsetWidth) / 2));\r\n\t\tvar y = Math.abs(Math.floor(((window.innerHeight || document.documentElement.offsetHeight) - box.offsetHeight) / 2));\r\n\t\tif (config.position == \"top\")\r\n\t\t\tbox.style.top = \"-3px\";\r\n\t\telse\r\n\t\t\tbox.style.top = y + 'px';\r\n\t\tbox.style.left = x + 'px';\r\n\t\t//necessary for IE only\r\n\t\tbox.onkeydown = modal_key;\r\n\r\n\t\tmodalBox.focus(box);\r\n\r\n\t\tif (config.hidden)\r\n\t\t\tmodalBox.hide(box);\r\n\r\n\t\tgantt.callEvent(\"onMessagePopup\", [box]);\r\n\t\treturn box;\r\n\t}\r\n\r\n\tfunction alertPopup(config) {\r\n\t\treturn _createBox(config, true, false);\r\n\t}\r\n\r\n\tfunction confirmPopup(config) {\r\n\t\treturn _createBox(config, true, true);\r\n\t}\r\n\r\n\tfunction boxPopup(config) {\r\n\t\treturn _createBox(config);\r\n\t}\r\n\r\n\tfunction box_params(text, type, callback) {\r\n\t\tif (typeof text != \"object\") {\r\n\t\t\tif (typeof type == \"function\") {\r\n\t\t\t\tcallback = type;\r\n\t\t\t\ttype = \"\";\r\n\t\t\t}\r\n\t\t\ttext = {text: text, type: type, callback: callback};\r\n\t\t}\r\n\t\treturn text;\r\n\t}\r\n\r\n\tfunction params(text, type, expire, id) {\r\n\t\tif (typeof text != \"object\")\r\n\t\t\ttext = {text: text, type: type, expire: expire, id: id};\r\n\t\ttext.id = text.id || utils.uid();\r\n\t\ttext.expire = text.expire || messageBox.expire;\r\n\t\treturn text;\r\n\t}\r\n\r\n\tvar alertBox = function () {\r\n\t\tvar text = box_params.apply(this, arguments);\r\n\t\ttext.type = text.type || \"confirm\";\r\n\t\treturn alertPopup(text);\r\n\t};\r\n\tvar confirmBox = function () {\r\n\t\tvar text = box_params.apply(this, arguments);\r\n\t\ttext.type = text.type || \"alert\";\r\n\t\treturn confirmPopup(text);\r\n\t};\r\n\tvar modalBox = function () {\r\n\t\tvar text = box_params.apply(this, arguments);\r\n\t\ttext.type = text.type || \"alert\";\r\n\t\treturn boxPopup(text);\r\n\t};\r\n\tmodalBox.hide = function (node) {\r\n\t\twhile (node && node.getAttribute && !node.getAttribute(boxAttribute))\r\n\t\t\tnode = node.parentNode;\r\n\t\tif (node) {\r\n\t\t\tnode.parentNode.removeChild(node);\r\n\t\t\tmodality(false);\r\n\r\n\t\t\tgantt.callEvent(\"onAfterMessagePopup\", [node]);\r\n\t\t}\r\n\t};\r\n\r\n\tmodalBox.focus = function (node) {\r\n\t\tsetTimeout(function () {\r\n\t\t\tvar focusable = domHelpers.getFocusableNodes(node);\r\n\t\t\tif (focusable.length) {\r\n\t\t\t\tif (focusable[0].focus) focusable[0].focus();\r\n\t\t\t}\r\n\t\t}, 1);\r\n\t};\r\n\r\n\tvar messageBox = function (text, type, expire, id) {\r\n\t\ttext = params.apply(this, arguments);\r\n\t\ttext.type = text.type || \"info\";\r\n\r\n\t\tvar subtype = text.type.split(\"-\")[0];\r\n\t\tswitch (subtype) {\r\n\t\t\tcase \"alert\":\r\n\t\t\t\treturn alertPopup(text);\r\n\t\t\tcase \"confirm\":\r\n\t\t\t\treturn confirmPopup(text);\r\n\t\t\tcase \"modalbox\":\r\n\t\t\t\treturn boxPopup(text);\r\n\t\t\tdefault:\r\n\t\t\t\treturn info(text);\r\n\t\t}\r\n\t};\r\n\r\n\tmessageBox.seed = (new Date()).valueOf();\r\n\tmessageBox.uid = utils.uid;\r\n\tmessageBox.expire = 4000;\r\n\tmessageBox.keyboard = true;\r\n\tmessageBox.position = \"top\";\r\n\tmessageBox.pull = {};\r\n\tmessageBox.timers = {};\r\n\r\n\tmessageBox.hideAll = function () {\r\n\t\tfor (var key in messageBox.pull)\r\n\t\t\tmessageBox.hide(key);\r\n\t};\r\n\tmessageBox.hide = function (id) {\r\n\t\tvar obj = messageBox.pull[id];\r\n\t\tif (obj && obj.parentNode) {\r\n\t\t\twindow.setTimeout(function () {\r\n\t\t\t\tobj.parentNode.removeChild(obj);\r\n\t\t\t\tobj = null;\r\n\t\t\t}, 2000);\r\n\t\t\tobj.className += \" hidden\";\r\n\r\n\t\t\tif (messageBox.timers[id])\r\n\t\t\t\twindow.clearTimeout(messageBox.timers[id]);\r\n\t\t\tdelete messageBox.pull[id];\r\n\t\t}\r\n\t};\r\n\r\n\tvar popups = [];\r\n\tgantt.attachEvent(\"onMessagePopup\", function(box){\r\n\t\tpopups.push(box);\r\n\t});\r\n\tgantt.attachEvent(\"onAfterMessagePopup\", function(box){\r\n\t\tfor(var i = 0; i < popups.length; i++){\r\n\t\t\tif(popups[i] === box){\r\n\t\t\t\tpopups.splice(i, 1);\r\n\t\t\t\ti--;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onDestroy\", function(){\r\n\t\tif(modality.cover && modality.cover.parentNode){\r\n\t\t\tmodality.cover.parentNode.removeChild(modality.cover);\r\n\t\t}\r\n\r\n\t\tfor(var i = 0; i < popups.length; i++){\r\n\t\t\tif(popups[i].parentNode){\r\n\t\t\t\tpopups[i].parentNode.removeChild(popups[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tpopups = null;\r\n\r\n\t\tif(messageBox.area && messageBox.area.parentNode){\r\n\t\t\tmessageBox.area.parentNode.removeChild(messageBox.area);\r\n\t\t}\r\n\t\tmessageBox = null;\r\n\t});\r\n\r\n\treturn {\r\n\t\talert: alertBox,\r\n\t\tconfirm: confirmBox,\r\n\t\tmessage: messageBox,\r\n\t\tmodalbox: modalBox\r\n\t};\r\n};","import * as utils from \"../../utils/utils\";\r\n\r\nfunction extendSettings (store, parentSettings){\r\n\tvar own = this.$config[store];\r\n\r\n\tif(own){\r\n\t\tif(!own.$extendedConfig){\r\n\t\t\town.$extendedConfig = true;\r\n\t\t\tObject.setPrototypeOf(own, parentSettings);\r\n\t\t}\r\n\t\treturn own;\r\n\t}else{\r\n\t\treturn parentSettings;\r\n\t}\r\n}\r\n\r\nvar configurable = function(parentView){\r\n\tvar parentConfig,\r\n\t\tparentTemplates;\r\n\r\n\treturn {\r\n\t\t$getConfig: function(){\r\n\t\t\tif(!parentConfig){\r\n\t\t\t\tparentConfig = parentView ? parentView.$getConfig() : this.$gantt.config;\r\n\t\t\t}\r\n\t\t\tif(!this.$config.config){\r\n\t\t\t\treturn parentConfig;\r\n\t\t\t}else{\r\n\t\t\t\treturn extendSettings.call(this, \"config\", parentConfig);\r\n\t\t\t}\r\n\t\t},\r\n\t\t$getTemplates: function(){\r\n\t\t\tif(!parentTemplates){\r\n\t\t\t\tparentTemplates = parentView ? parentView.$getTemplates() : this.$gantt.templates;\r\n\t\t\t}\r\n\t\t\tif(!this.$config.templates){\r\n\t\t\t\treturn parentTemplates;\r\n\t\t\t}else{\r\n\t\t\t\treturn extendSettings.call(this, \"templates\", parentTemplates);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n};\r\n\r\nexport default function(obj, parent){\r\n\tutils.mixin(obj, configurable(parent));\r\n};","import * as utils from \"../../utils/utils\";\r\nimport configurable from \"./configurable\";\r\n\r\nvar uiFactory = function createFactory(gantt){\r\n\tvar views = {};\r\n\r\n\tfunction ui(cell, parentView) {\r\n\t\tvar content;\r\n\t\tvar view = \"cell\";\r\n\t\tif (cell.view){\r\n\t\t\tview = \"viewcell\";\r\n\t\t}else if (cell.resizer) {\r\n\t\t\tview = \"resizer\";\r\n\t\t}\r\n\t\telse if (cell.rows || cell.cols) {\r\n\t\t\tview = \"layout\";\r\n\t\t}\r\n\t\telse if (cell.views) {\r\n\t\t\tview = \"multiview\";\r\n\t\t}\r\n\r\n\t\tcontent = createView.call(this, view, null, cell, parentView);\r\n\t\treturn content;\r\n\t}\r\n\t\r\n\tvar createdViews = {};\r\n\r\n\tfunction createView(name, parent, config, parentView) {\r\n\t\tvar creator = views[name];\r\n\r\n\t\tif(!creator || !creator.create)\r\n\t\t\treturn false;\r\n\r\n\t\tif(name == \"resizer\" && !config.mode){\r\n\t\t\tif(parentView.$config.cols){\r\n\t\t\t\tconfig.mode = \"x\";\r\n\t\t\t}else{\r\n\t\t\t\tconfig.mode = \"y\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(name == \"viewcell\" && config.view == \"scrollbar\" && !config.scroll){\r\n\t\t\tif(parentView.$config.cols){\r\n\t\t\t\tconfig.scroll = \"y\";\r\n\t\t\t}else{\r\n\t\t\t\tconfig.scroll = \"x\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar config = utils.copy(config);\r\n\r\n\t\tif(!config.id && !createdViews[config.view]){\r\n\t\t\tconfig.id = config.view;\r\n\t\t}\r\n\r\n\t\tif(config.id && !config.css){\r\n\t\t\tconfig.css = config.id+\"_cell\";\r\n\t\t}\r\n\r\n\t\tvar view = new creator.create(parent, config, this, gantt);\r\n\r\n\t\tif(creator.configure){\r\n\t\t\tcreator.configure(view);\r\n\t\t}\r\n\r\n\t\tconfigurable(view, parentView);\r\n\t\tif(!view.$id){\r\n\t\t\tview.$id = config.id || gantt.uid();\r\n\t\t}\r\n\r\n\t\tif(!view.$parent && typeof parent == \"object\"){\r\n\t\t\tview.$parent = parent;\r\n\t\t}\r\n\t\tif(!view.$config){\r\n\t\t\tview.$config = config;\r\n\t\t}\r\n\r\n\t\tif(createdViews[view.$id]){\r\n\t\t\tview.$id = gantt.uid();\r\n\t\t}\r\n\r\n\t\tcreatedViews[view.$id] = view;\r\n\r\n\t\treturn view;\r\n\t}\r\n\r\n\tfunction reset(){\r\n\t\tcreatedViews = {};\r\n\t}\r\n\r\n\tfunction register(name, viewConstructor, configure){\r\n\t\tviews[name] = {create: viewConstructor, configure: configure};\r\n\t}\r\n\r\n\tfunction getView(id){\r\n\t\treturn createdViews[id];\r\n\t}\r\n\r\n\tvar factory = {\r\n\t\tinitUI:ui,\r\n\t\treset: reset,\r\n\t\tregisterView: register,\r\n\t\tcreateView: createView,\r\n\t\tgetView: getView\r\n\t};\r\n\r\n\treturn factory;\r\n};\r\n\r\nexport default {\r\n\tcreateFactory: uiFactory\r\n};\r\n\r\n","import * as domHelpers from \"./utils/dom_helpers\";\r\n\r\nvar createMouseHandler = (function(domHelpers) {\r\n\treturn function (gantt) {\r\n\t\tvar eventHandlers = {\r\n\t\t\t\"click\": {},\r\n\t\t\t\"doubleclick\": {},\r\n\t\t\t\"contextMenu\": {}\r\n\t\t};\r\n\r\n\t\tfunction addEventTarget(event, className, handler, root) {\r\n\t\t\tif(!eventHandlers[event][className]){\r\n\t\t\t\teventHandlers[event][className] = [];\r\n\t\t\t}\r\n\r\n\t\t\teventHandlers[event][className].push({\r\n\t\t\t\thandler: handler,\r\n\t\t\t\troot: root\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction callHandler(eventName, className, root, args) {\r\n\t\t\tvar handlers = eventHandlers[eventName][className];\r\n\t\t\tif(handlers){\r\n\t\t\t\tfor(var i = 0; i < handlers.length; i++){\r\n\t\t\t\t\tif(!(root || handlers[i].root) || handlers[i].root === root){\r\n\t\t\t\t\t\thandlers[i].handler.apply(this, args);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction onClick(e) {\r\n\t\t\te = e || window.event;\r\n\t\t\tvar id = gantt.locate(e);\r\n\r\n\t\t\tvar handlers = findEventHandlers(e, eventHandlers.click);\r\n\t\t\tvar res = true;\r\n\t\t\tif (id !== null) {\r\n\t\t\t\tres = !gantt.checkEvent(\"onTaskClick\") || gantt.callEvent(\"onTaskClick\", [id, e]);\r\n\t\t\t} else {\r\n\t\t\t\tgantt.callEvent(\"onEmptyClick\", [e]);\r\n\t\t\t}\r\n\r\n\t\t\tif (res) {\r\n\t\t\t\tvar default_action = callEventHandlers(handlers, e, id);\r\n\t\t\t\tif (!default_action)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t// GS-1025: if we don't do that, the dropdown or date select will be closed for unselected tasks\r\n\t\t\t\t// GS-1078: or for the built-in select inline editor\r\n\t\t\t\tswitch(e.target.nodeName) {\r\n\t\t\t\t\tcase \"SELECT\":\r\n\t\t\t\t\tcase 'INPUT':\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//allow task selection when the multiselect plugin is not enabled\r\n\t\t\t\tif (id && gantt.getTask(id) && !gantt._multiselect && gantt.config.select_task) {\r\n\t\t\t\t\tgantt.selectTask(id);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction onContextMenu(e) {\r\n\t\t\te = e || window.event;\r\n\t\t\tvar src = e.target || e.srcElement,\r\n\t\t\t\ttaskId = gantt.locate(src),\r\n\t\t\t\tlinkId = gantt.locate(src, gantt.config.link_attribute);\r\n\r\n\t\t\tvar res = !gantt.checkEvent(\"onContextMenu\") || gantt.callEvent(\"onContextMenu\", [taskId, linkId, e]);\r\n\t\t\tif (!res) {\r\n\t\t\t\tif (e.preventDefault)\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\telse\r\n\t\t\t\t\te.returnValue = false;\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t}\r\n\r\n\t\tfunction findEventHandlers(e, hash){\r\n\t\t\tvar trg = e.target || e.srcElement;\r\n\t\t\tvar handlers = [];\r\n\t\t\twhile (trg) {\r\n\t\t\t\tvar css = domHelpers.getClassName(trg);\r\n\t\t\t\tif (css) {\r\n\t\t\t\t\tcss = css.split(\" \");\r\n\t\t\t\t\tfor (var i = 0; i < css.length; i++) {\r\n\t\t\t\t\t\tif (!css[i]) continue;\r\n\t\t\t\t\t\tif (hash[css[i]]) {\r\n\t\t\t\t\t\t\tvar delegateHandlers = hash[css[i]];\r\n\r\n\t\t\t\t\t\t\tfor(var h = 0; h < delegateHandlers.length; h++){\r\n\t\t\t\t\t\t\t\tif(delegateHandlers[h].root){\r\n\t\t\t\t\t\t\t\t\tif(!domHelpers.isChildOf(trg, delegateHandlers[h].root)){\r\n\t\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\thandlers.push(delegateHandlers[h].handler);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\ttrg = trg.parentNode;\r\n\t\t\t}\r\n\t\t\treturn handlers;\r\n\t\t}\r\n\r\n\t\tfunction callEventHandlers(handlers, e, id){\r\n\t\t\tvar res = true;\r\n\r\n\t\t\tfor(var i = 0; i < handlers.length; i++){\r\n\t\t\t\tvar handlerResult =  handlers[i].call(gantt, e, id, e.target || e.srcElement);\r\n\t\t\t\tres = res && !(typeof handlerResult != \"undefined\" && handlerResult !== true);\r\n\t\t\t}\r\n\r\n\t\t\treturn res;\r\n\t\t}\r\n\r\n\r\n\t\tfunction onDoubleClick(e) {\r\n\t\t\te = e || window.event;\r\n\t\t\tvar id = gantt.locate(e);\r\n\r\n\t\t\tvar handlers = findEventHandlers(e, eventHandlers.doubleclick);\r\n\t\t\t// when doubleclick fired not on task, id === null\r\n\t\t\tvar res = !gantt.checkEvent(\"onTaskDblClick\") || id === null || gantt.callEvent(\"onTaskDblClick\", [id, e]);\r\n\t\t\tif (res) {\r\n\t\t\t\tvar default_action = callEventHandlers(handlers, e, id);\r\n\t\t\t\tif (!default_action)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tif (id !== null && gantt.getTask(id)) {\r\n\t\t\t\t\tif (res && gantt.config.details_on_dblclick && !gantt.isReadonly(id)) {\r\n\t\t\t\t\t\tgantt.showLightbox(id);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction onMouseMove(e) {\r\n\t\t\tif (gantt.checkEvent(\"onMouseMove\")) {\r\n\t\t\t\tvar id = gantt.locate(e);\r\n\t\t\t\tgantt._last_move_event = e;\r\n\t\t\t\tgantt.callEvent(\"onMouseMove\", [id, e]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction detach(eventName, className, handler, root) {\r\n\t\t\tif (eventHandlers[eventName] && eventHandlers[eventName][className]) {\r\n\t\t\t\tvar handlers = eventHandlers[eventName];\r\n\t\t\t\tvar elementHandlers = handlers[className];\r\n\t\t\t\tfor(var i = 0; i < elementHandlers.length; i++){\r\n\t\t\t\t\tif(elementHandlers[i].root == root){\r\n\t\t\t\t\t\telementHandlers.splice(i, 1);\r\n\t\t\t\t\t\ti--;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(!elementHandlers.length){\r\n\t\t\t\t\tdelete handlers[className];\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar domEvents = gantt._createDomEventScope();\r\n\r\n\t\tfunction reset(node){\r\n\r\n\t\t\tdomEvents.detachAll();\r\n\r\n\t\t\tif(node){\r\n\t\t\t\tdomEvents.attach(node, \"click\", onClick);\r\n\t\t\t\tdomEvents.attach(node, \"dblclick\", onDoubleClick);\r\n\t\t\t\tdomEvents.attach(node, \"mousemove\", onMouseMove);\r\n\t\t\t\tdomEvents.attach(node, \"contextmenu\", onContextMenu);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\r\n\t\treturn {\r\n\t\t\treset: reset,\r\n\t\t\tglobal: function(event, classname, handler){\r\n\t\t\t\taddEventTarget(event, classname, handler, null);\r\n\t\t\t},\r\n\t\t\tdelegate: addEventTarget,\r\n\t\t\tdetach: detach,\r\n\t\t\tcallHandler: callHandler,\r\n\t\t\tonDoubleClick: onDoubleClick,\r\n\t\t\tonMouseMove: onMouseMove,\r\n\t\t\tonContextMenu: onContextMenu,\r\n\t\t\tonClick: onClick,\r\n\t\t\tdestructor: function(){\r\n\t\t\t\treset();\r\n\t\t\t\teventHandlers = null;\r\n\t\t\t\tdomEvents = null;\r\n\t\t\t}\r\n\r\n\t\t};\r\n\t};\r\n\r\n})(domHelpers);\r\n\r\n\r\nexport default {\r\n\tinit:createMouseHandler\r\n};","export default function(viewport, box, gantt){\r\n\tif(!box){\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif(box.left > viewport.x_end || box.left + box.width < viewport.x){\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif(box.top > viewport.y_end || box.top + box.height < viewport.y){\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\treturn true;\r\n};","export default function(gantt){\r\n\treturn gantt.config.smart_rendering && gantt._smart_render;\r\n};","export default function(item, view, config){\r\n\treturn {\r\n\t\ttop: view.getItemTop(item.id),\r\n\t\theight: view.getItemHeight(item.id),\r\n\t\tleft: 0,\r\n\t\tright: Infinity\r\n\t};\r\n};","export default function getVisibleTasksRange(gantt, view, config, datastore, viewport){\r\n\tvar buffer = 1;\r\n\tvar start = view.getItemIndexByTopPosition(viewport.y) || 0;\r\n\tvar end = view.getItemIndexByTopPosition(viewport.y_end) || datastore.count();\r\n\tvar indexStart = Math.max(0, start - buffer);\r\n\tvar indexEnd =  Math.min(datastore.count(), end + buffer);\r\n\t// GS-2481 and GS-1715, need to take into account selected task when using keyboard shortcuts and when the inline editor is opened \r\n\tconst extraTasksIds= [];\r\n\tif (gantt.config.keyboard_navigation && gantt.getSelectedId()) {\r\n\t\tlet task = gantt.getTask(gantt.getSelectedId());\r\n\t\t// GS-2661 and GS-2835: The selected task shouldn't be a split child \r\n\t\t// and its parent shouldn't be collapsed\r\n\t\tif(task.$expanded_branch && !task.$split_subtask) {\r\n\t\t\textraTasksIds.push(gantt.getSelectedId());\r\n\t\t}\r\n\t}\r\n\tif (gantt.$ui.getView(\"grid\") && gantt.ext.inlineEditors && gantt.ext.inlineEditors.getState().id) {\r\n\t\tlet inlineEditorId = gantt.ext.inlineEditors.getState().id;\r\n\t\tif (datastore.exists(inlineEditorId)){\r\n\t\t\textraTasksIds.push(inlineEditorId);\r\n\t\t}\r\n\t}\r\n\treturn {\r\n\t\tstart: indexStart,\r\n\t\tend: indexEnd,\r\n\t\tids: extraTasksIds \r\n\t};\r\n};","import genericViewPortChecker from \"./viewport/is_in_viewport\";\r\nimport isLegacyRender from \"./is_legacy_smart_render\";\r\nimport basicGetRectangle from \"./viewport/get_grid_row_rectangle\";\r\nimport basicGetRange from \"./viewport/get_visible_bars_range\";\r\nvar rendererFactory = function(gantt){\r\n\r\n\t//hash of dom elements is needed to redraw single bar/link\r\n\tvar task_area_pulls = {},\r\n\t\ttask_area_renderers = {};\r\n\r\n\tfunction getView(layer){\r\n\t\tvar view = null;\r\n\t\tif (typeof layer.view === \"string\") {\r\n\t\t\tview = gantt.$ui.getView(layer.view);\r\n\t\t} else if (layer.view) {\r\n\t\t\tview = layer.view;\r\n\t\t}\r\n\t\treturn view;\r\n\t}\r\n\r\n\tfunction getRenderer(id, layer, node) {\r\n\t\t\r\n\t\tif (task_area_renderers[id])\r\n\t\t\treturn task_area_renderers[id];\r\n\r\n\t\tif (!layer.renderer)\r\n\t\t\tgantt.assert(false, \"Invalid renderer call\");\r\n\r\n\t\tvar renderMethod = null;\r\n\t\tvar updateMethod = null;\r\n\t\tvar getRectangle = null;\r\n\t\tvar renderCallbackMethod = null;\r\n\t\tvar specializedViewPortChecker = null;\r\n\r\n\t\tif(typeof layer.renderer === \"function\"){\r\n\t\t\trenderMethod = layer.renderer;\r\n\t\t\tgetRectangle = basicGetRectangle;\r\n\t\t}else{\r\n\t\t\trenderMethod = layer.renderer.render;\r\n\t\t\tupdateMethod = layer.renderer.update;\r\n\t\t\trenderCallbackMethod = layer.renderer.onrender;\r\n\t\t\t\r\n\t\t\tif(layer.renderer.isInViewPort){\r\n\t\t\t\tspecializedViewPortChecker = layer.renderer.isInViewPort;\r\n\t\t\t}else{\r\n\t\t\t\tgetRectangle = layer.renderer.getRectangle;\r\n\t\t\t}\r\n\r\n\t\t\tif (!getRectangle && getRectangle !== null) {\r\n\t\t\t\tgetRectangle = basicGetRectangle;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar filter = layer.filter;\r\n\r\n\t\tif (node)\r\n\t\t\tnode.setAttribute(gantt.config.layer_attribute, true);\r\n\r\n\t\ttask_area_renderers[id] = {\r\n\t\t\trender_item: function (item, container, viewPort, layerView, viewConfig) {\r\n\t\t\t\tcontainer = container || node;\r\n\t\t\t\tif (filter) {\r\n\t\t\t\t\tif (!filter(item)) {\r\n\t\t\t\t\t\tthis.remove_item(item.id);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar view = layerView || getView(layer);\r\n\t\t\t\tvar config = viewConfig || (view ? view.$getConfig() : null);\r\n\t\t\t\tvar rendererViewPort = viewPort;\r\n\t\t\t\tif(!rendererViewPort && config && config.smart_rendering){\r\n\t\t\t\t\trendererViewPort = view.getViewPort();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar dom = null;\r\n\t\t\t\tif(!isLegacyRender(gantt) && (getRectangle || specializedViewPortChecker) && rendererViewPort){\r\n\t\t\t\t\tvar isVisible = false;\r\n\t\t\t\t\tif(specializedViewPortChecker){\r\n\t\t\t\t\t\tisVisible = specializedViewPortChecker(item, rendererViewPort, view, config, gantt);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tisVisible = genericViewPortChecker(rendererViewPort, getRectangle(item, view, config, gantt), gantt);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(isVisible){\r\n\t\t\t\t\t\tdom = renderMethod.call(gantt, item, view, config, rendererViewPort);\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdom = renderMethod.call(gantt, item, view, config, rendererViewPort);\r\n\t\t\t\t}\r\n\t\t\t\tthis.append(item, dom, container);\r\n\r\n\t\t\t\tvar useBuffer = container.nodeType == 11;//DocumentFragment\r\n\t\t\t\tif(renderCallbackMethod && !useBuffer && dom) {\r\n\t\t\t\t\trenderCallbackMethod.call(gantt, item, dom, view);\r\n\t\t\t\t} \r\n\t\t\t},\r\n\r\n\t\t\tclear: function (container) {\r\n\t\t\t\t// GS-3018: clear task_bg_render layer data\r\n\t\t\t\tif(layer.renderer && layer.renderer.clear){\r\n\t\t\t\t\tlayer.renderer.clear();\r\n\t\t\t\t}\r\n\t\t\t\tthis.rendered = task_area_pulls[id] = {};\r\n\t\t\t\tif(!layer.append)\r\n\t\t\t\t\tthis.clear_container(container);\r\n\t\t\t},\r\n\t\t\tclear_container: function (container) {\r\n\t\t\t\tcontainer = container || node;\r\n\t\t\t\tif (container){\r\n\t\t\t\t\tcontainer.innerHTML = \"\";\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tget_visible_range: function(datastore){\r\n\t\t\t\tvar view = getView(layer);\r\n\t\t\t\tvar viewport;\r\n\t\t\t\tvar viewConfig = view ? view.$getConfig() : null;\r\n\t\t\t\tif(viewConfig && viewConfig.smart_rendering){\r\n\t\t\t\t\tviewport = view.getViewPort();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar range;\r\n\t\t\t\tif(view && viewport){\r\n\t\t\t\t\tif(typeof layer.renderer === \"function\"){\r\n\t\t\t\t\t\trange = basicGetRange(gantt, view, viewConfig, datastore, viewport);\r\n\t\t\t\t\t}else if(layer.renderer && layer.renderer.getVisibleRange){\r\n\t\t\t\t\t\trange = layer.renderer.getVisibleRange(gantt, view, viewConfig, datastore, viewport);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(!range){\r\n\t\t\t\t\trange = {\r\n\t\t\t\t\t\tstart: 0,\r\n\t\t\t\t\t\tend: datastore.count()\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn range;\r\n\t\t\t},\r\n\t\t\tprepare_data: function(items){\r\n\t\t\t\tif(layer.renderer && layer.renderer.prepareData){\r\n\t\t\t\t\treturn layer.renderer.prepareData(items, gantt, layer);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\trender_items: function (items, container) {\r\n\t\t\t\tcontainer = container || node;\r\n\r\n\t\t\t\tvar buffer = document.createDocumentFragment();\r\n\t\t\t\tthis.clear(container);\r\n\r\n\t\t\t\tvar viewPort = null;\r\n\t\t\t\tvar view = getView(layer);\r\n\t\t\t\tvar viewConfig = view ? view.$getConfig() : null;\r\n\t\t\t\tif(viewConfig && viewConfig.smart_rendering){\r\n\t\t\t\t\tviewPort = view.getViewPort();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (var i = 0, vis = items.length; i < vis; i++) {\r\n\t\t\t\t\tthis.render_item(items[i], buffer, viewPort, view, viewConfig);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontainer.appendChild(buffer, container);\r\n\r\n\t\t\t\tvar itemsSearch = {};\r\n\t\t\t\titems.forEach(function(item){\r\n\t\t\t\t\titemsSearch[item.id] = item;\r\n\t\t\t\t});\r\n\t\t\t\tvar renderedItems = {};\r\n\t\t\t\tif (renderCallbackMethod) {\r\n\t\t\t\t\tvar newElements = {};\r\n\t\t\t\t\tfor(var i in this.rendered) {\r\n\t\t\t\t\t\tif(!renderedItems[i]){\r\n\t\t\t\t\t\t\tnewElements[i] = this.rendered[i];\r\n\t\t\t\t\t\t\trenderCallbackMethod.call(gantt, itemsSearch[i], this.rendered[i], view);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tupdate_items: function (items, container) {\r\n\t\t\t\tvar view = getView(layer);\r\n\t\t\t\tvar viewConfig = view ? view.$getConfig() : null;\r\n\t\t\t\tif(!view || !view.$getConfig().smart_rendering || isLegacyRender(gantt)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!this.rendered){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!(getRectangle || specializedViewPortChecker)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontainer = container || node;\r\n\r\n\t\t\t\tvar buffer = document.createDocumentFragment();\r\n\r\n\t\t\t\tvar viewPort = null;\r\n\t\t\t\tif(view){\r\n\t\t\t\t\tviewPort = view.getViewPort();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar itemsSearch = {};\r\n\t\t\t\titems.forEach(function(item){\r\n\t\t\t\t\titemsSearch[item.id] = item;\r\n\t\t\t\t});\r\n\t\t\t\tvar renderedItems = {};\r\n\r\n\t\t\t\tvar nodesToRemove = {};\r\n\t\t\t\tfor(var i in this.rendered){\r\n\t\t\t\t\tnodesToRemove[i] = true;\r\n\t\t\t\t\trenderedItems[i] = true;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvar renderCalledFor = {};\r\n\t\t\t\tfor (var i = 0, vis = items.length; i < vis; i++) {\r\n\t\t\t\t\tvar item = items[i];\r\n\t\t\t\t\tvar itemNode = this.rendered[item.id];\r\n\t\t\t\t\tnodesToRemove[item.id] = false;\r\n\t\t\t\t\tif (itemNode && itemNode.parentNode) {\r\n\t\t\t\t\t\tvar isVisible = false;\r\n\t\t\t\t\t\tif(specializedViewPortChecker){\r\n\t\t\t\t\t\t\tisVisible = specializedViewPortChecker(item, viewPort, view, viewConfig, gantt);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tisVisible = genericViewPortChecker(viewPort, getRectangle(item, view, viewConfig, gantt), gantt);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (!isVisible) {\r\n\t\t\t\t\t\t\tnodesToRemove[item.id] = true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif(updateMethod){\r\n\t\t\t\t\t\t\t\tupdateMethod.call(gantt, item, itemNode, view, viewConfig, viewPort);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis.restore(item, buffer);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trenderCalledFor[items[i].id] = true;\r\n\t\t\t\t\t\tthis.render_item(items[i], buffer, viewPort, view, viewConfig);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor(var i in nodesToRemove){\r\n\t\t\t\t\tif(nodesToRemove[i]){\r\n\t\t\t\t\t\tthis.hide(i);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(buffer.childNodes.length){\r\n\t\t\t\t\tcontainer.appendChild(buffer, container);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (renderCallbackMethod) {\r\n\t\t\t\t\tvar newElements = {};\r\n\t\t\t\t\tfor(var i in this.rendered) {\r\n\t\t\t\t\t\tif(!renderedItems[i] || renderCalledFor[i]){\r\n\t\t\t\t\t\t\tnewElements[i] = this.rendered[i];\r\n\t\t\t\t\t\t\trenderCallbackMethod.call(gantt, itemsSearch[i], this.rendered[i], view);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tappend: function (item, node, container) {\r\n\t\t\t\tif(!this.rendered){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!node) {\r\n\t\t\t\t\tif (this.rendered[item.id]) {\r\n\t\t\t\t\t\tthis.remove_item(item.id);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.rendered[item.id] && this.rendered[item.id].parentNode) {\r\n\t\t\t\t\tthis.replace_item(item.id, node);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcontainer.appendChild(node);\r\n\t\t\t\t}\r\n\t\t\t\tthis.rendered[item.id] = node;\r\n\t\t\t},\r\n\t\t\treplace_item: function (item_id, newNode) {\r\n\t\t\t\tvar item = this.rendered[item_id];\r\n\t\t\t\tif (item && item.parentNode) {\r\n\t\t\t\t\titem.parentNode.replaceChild(newNode, item);\r\n\r\n\t\t\t\t}\r\n\t\t\t\tthis.rendered[item_id] = newNode;\r\n\t\t\t},\r\n\t\t\tremove_item: function (item_id) {\r\n\t\t\t\tthis.hide(item_id);\r\n\t\t\t\tdelete this.rendered[item_id];\r\n\t\t\t},\r\n\t\t\thide: function (item_id) {\r\n\t\t\t\tvar item = this.rendered[item_id];\r\n\t\t\t\tif (item && item.parentNode) {\r\n\t\t\t\t\titem.parentNode.removeChild(item);\r\n\t\t\t\t}\r\n\t\t\t\tdelete this.rendered[item_id];\r\n\t\t\t},\r\n\t\t\trestore: function (item, container) {\r\n\t\t\t\tvar dom = this.rendered[item.id];\r\n\t\t\t\tif (dom) {\r\n\t\t\t\t\tif (!dom.parentNode) {\r\n\t\t\t\t\t\tthis.append(item, dom, container || node);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.render_item(item, container || node);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tchange_id: function (oldid, newid) {\r\n\t\t\t\tthis.rendered[newid] = this.rendered[oldid];\r\n\t\t\t\tdelete this.rendered[oldid];\r\n\t\t\t},\r\n\t\t\trendered: task_area_pulls[id],\r\n\t\t\tnode: node,\r\n\t\t\tdestructor: function () {\r\n\t\t\t\tthis.clear();\r\n\t\t\t\tdelete task_area_renderers[id];\r\n\t\t\t\tdelete task_area_pulls[id];\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\treturn task_area_renderers[id];\r\n\t}\r\n\r\n\r\n\tfunction clearRenderers() {\r\n\t\tfor (var i in task_area_renderers) {\r\n\t\t\tgetRenderer(i).destructor();\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\tgetRenderer: getRenderer,\r\n\t\tclearRenderers: clearRenderers\r\n\t};\r\n\r\n};\r\n\r\nexport default rendererFactory;","import renderFactoryProvider from \"./render_factory\";\r\nimport * as utils from \"../../../utils/utils\";\r\nimport * as domHelpers from \"../utils/dom_helpers\";\r\nimport isLegacyRender from \"./is_legacy_smart_render\";\r\n\r\nvar layerFactory = function(gantt){\r\n\r\n\tvar renderFactory = renderFactoryProvider(gantt);\r\n\treturn {\r\n\tcreateGroup: function (getContainer, relativeRoot, defaultFilters, initLayer) {\r\n\r\n\t\tvar renderGroup = {\r\n\t\t\ttempCollection: [],\r\n\t\t\trenderers: {},\r\n\t\t\tcontainer: getContainer,\r\n\t\t\tfilters: [],\r\n\t\t\tgetLayers: function () {\r\n\t\t\t\tthis._add();// add pending layers\r\n\r\n\t\t\t\tvar res = [];\r\n\t\t\t\tfor (var i in this.renderers) {\r\n\t\t\t\t\tres.push(this.renderers[i]);\r\n\t\t\t\t}\r\n\t\t\t\treturn res;\r\n\t\t\t},\r\n\t\t\tgetLayer: function (id) {\r\n\t\t\t\treturn this.renderers[id];\r\n\t\t\t},\r\n\t\t\t_add: function (layer) {\r\n\t\t\t\tif (layer) {\r\n\t\t\t\t\tlayer.id = layer.id || utils.uid();\r\n\t\t\t\t\tthis.tempCollection.push(layer);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst container = this.container();\r\n\t\t\t\tconst pending = this.tempCollection;\r\n\t\t\t\tfor (let i = 0; i < pending.length; i++) {\r\n\t\t\t\t\tlayer = pending[i];\r\n\t\t\t\t\t// GS-2803: in case of Salesforce domHelpers.isChildOf check with document.body doesn't work\r\n\t\t\t\t\t// instead we check it with isConnected property\r\n\t\t\t\t\tif (!this.container() && !(layer && layer.container && layer.container.isConnected)) continue;\r\n\r\n\t\t\t\t\tlet node = layer.container,\r\n\t\t\t\t\t\tid = layer.id,\r\n\t\t\t\t\t\ttopmost = layer.topmost;\r\n\t\t\t\t\tif (!node.parentNode) {\r\n\t\t\t\t\t\t//insert on top or below the tasks\r\n\t\t\t\t\t\tif (topmost) {\r\n\t\t\t\t\t\t\tcontainer.appendChild(node);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tlet rel = relativeRoot ? relativeRoot() : container.firstChild;\r\n\t\t\t\t\t\t\t// GS-1274: if we don't add the second check, Gantt stops working if\r\n\t\t\t\t\t\t\t// we add the task layer without the timeline and switch to a layout with the timeline\r\n\t\t\t\t\t\t\tif (rel && rel.parentNode == container)\r\n\t\t\t\t\t\t\t\tcontainer.insertBefore(node, rel);\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tcontainer.appendChild(node);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.renderers[id] = renderFactory.getRenderer(\r\n\t\t\t\t\t\tid,\r\n\t\t\t\t\t\tlayer,\r\n\t\t\t\t\t\tnode\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tif (initLayer) {\r\n\t\t\t\t\t\tinitLayer(layer, gantt);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.tempCollection.splice(i, 1);\r\n\t\t\t\t\ti--;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\taddLayer: function (config) {\r\n\t\t\t\tif(config){\r\n\t\t\t\t\tif(typeof config == \"function\"){\r\n\t\t\t\t\t\tconfig = {renderer: config};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(config.filter === undefined){\r\n\t\t\t\t\t\tconfig.filter = mergeFilters(defaultFilters || []);\r\n\t\t\t\t\t}else if(config.filter instanceof Array){\r\n\t\t\t\t\t\tconfig.filter.push(defaultFilters);\r\n\t\t\t\t\t\tconfig.filter = mergeFilters(config.filter);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(!config.container){\r\n\t\t\t\t\t\tconfig.container = document.createElement(\"div\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tconfig.requestUpdate = function(){\r\n\t\t\t\t\t\tif(gantt.config.smart_rendering && !isLegacyRender(gantt)){\r\n\t\t\t\t\t\t\tif(self.renderers[config.id]){\r\n\t\t\t\t\t\t\t\tself.onUpdateRequest(self.renderers[config.id]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._add(config);\r\n\t\t\t\treturn (config ? config.id : undefined);\r\n\t\t\t},\r\n\t\t\tonUpdateRequest: function(layer){\r\n\r\n\t\t\t},\r\n\r\n\t\t\teachLayer: function(code){\r\n\t\t\t\tfor (var i in this.renderers) {\r\n\t\t\t\t\tcode(this.renderers[i]);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tremoveLayer: function (id) {\r\n\t\t\t\tif(!this.renderers[id])\r\n\t\t\t\t\treturn;\r\n\t\t\t\tthis.renderers[id].destructor();\r\n\t\t\t\tdelete this.renderers[id];\r\n\t\t\t},\r\n\t\t\tclear: function () {\r\n\t\t\t\tfor (var i in this.renderers) {\r\n\t\t\t\t\tthis.renderers[i].destructor();\r\n\t\t\t\t}\r\n\t\t\t\tthis.renderers = {};\r\n\t\t\t}//,\r\n\t\t\t//prepareConfig: prepareConfig\r\n\t\t};\r\n\r\n\t\tgantt.attachEvent(\"onDestroy\", function(){\r\n\t\t\trenderGroup.clear();\r\n\t\t\trenderGroup = null;\r\n\t\t});\r\n\r\n\t\treturn renderGroup;\r\n\t}\r\n};};\r\n\r\n\r\nfunction mergeFilters(filter_methods){\r\n\tif(!(filter_methods instanceof Array)){\r\n\t\tfilter_methods = Array.prototype.slice.call(arguments, 0);\r\n\t}\r\n\r\n\treturn function(obj){\r\n\t\tvar res = true;\r\n\t\tfor(var i = 0, len = filter_methods.length; i < len; i++){\r\n\t\t\tvar filter_method = filter_methods[i];\r\n\t\t\tif(filter_method){\r\n\t\t\t\tres = res && (filter_method(obj.id, obj) !== false);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn res;\r\n\t};\r\n}\r\n\r\n\r\nexport default layerFactory;\r\n","export default function(item, view, config){\r\n\tif(!item.start_date || !item.end_date){\r\n\t\treturn null;\r\n\t}\r\n\tvar padding = 200;\r\n\tvar startCoord = view.posFromDate(item.start_date, view._getPositioningContext ? view._getPositioningContext(item) : null);\r\n\tvar endCoord = view.posFromDate(item.end_date, view._getPositioningContext ? view._getPositioningContext(item) : null);\r\n\tvar left = Math.min(startCoord, endCoord) - padding;\r\n\tvar right = Math.max(startCoord, endCoord) + padding;\r\n\treturn {\r\n\t\ttop: view.getItemTop(item.id),\r\n\t\theight: view.getItemHeight(item.id),\r\n\t\tleft: left,\r\n\t\twidth: right - left\r\n\t};\r\n};","\r\n\r\nimport barRectangle from \"./get_bar_rectangle\";\r\n\r\nexport default function getLinkBox(item, view, config, gantt){\r\n\tif(!gantt.isTaskExists(item.source)){\r\n\t\treturn null;\r\n\t}\r\n\r\n\tif(!gantt.isTaskExists(item.target)){\r\n\t\treturn null;\r\n\t}\r\n\tvar sourceBox = barRectangle(gantt.getTask(item.source), view, gantt);\r\n\tvar targetBox = barRectangle(gantt.getTask(item.target), view, gantt);\r\n\r\n\tif(!sourceBox || !targetBox){\r\n\t\treturn null;\r\n\t}\r\n\r\n\tvar padding = 100;\r\n\tvar left = Math.min(sourceBox.left, targetBox.left) - padding;\r\n\tvar right = Math.max(sourceBox.left + sourceBox.width, targetBox.left + targetBox.width) + padding;\r\n\tvar top = Math.min(sourceBox.top, targetBox.top) - padding;\r\n\tvar bottom = Math.max(sourceBox.top + sourceBox.height, targetBox.top + targetBox.height) + padding;\r\n\r\n\treturn {\r\n\t\ttop: top,\r\n\t\theight: bottom - top,\r\n\t\tbottom,\r\n\t\tleft: left,\r\n\t\twidth: right - left,\r\n\t\tright\r\n\t};\r\n};\r\n","import getLinkRectangle from \"../get_link_rectangle\";\r\n\r\nexport default function(){\r\n\tvar coordinates = [];\r\n\tvar calculated = false;\r\n\r\n\tfunction clearCache(){\r\n\t\tcoordinates = [];\r\n\t\tcalculated = false;\r\n\t}\r\n\r\n\tfunction buildCache(datastore, view, gantt){\r\n\t\tvar config = view.$getConfig();\r\n\t\tvar visibleItems = datastore.getVisibleItems();\r\n\t\t//datastore.eachItem(function(link){\r\n\t\tvisibleItems.forEach(function(link){\r\n\t\t\tvar rec = getLinkRectangle(link, view, config, gantt);\r\n\t\t\tif(!rec){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tcoordinates.push({id: link.id, rec: rec});\r\n\t\t});\r\n\r\n\t\tcoordinates.sort(function(a, b){\r\n\t\t\tif(a.rec.right < b.rec.right){\r\n\t\t\t\treturn -1;\r\n\t\t\t}else {\r\n\t\t\t\treturn 1;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tcalculated = true;\r\n\t}\r\n\r\n\tvar initialized = false;\r\n\tfunction init(datastore){\r\n\t\tif(initialized){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tinitialized = true;\r\n\t\tdatastore.attachEvent(\"onPreFilter\", clearCache);\r\n\t\tdatastore.attachEvent(\"onStoreUpdated\", clearCache);\r\n\t\tdatastore.attachEvent(\"onClearAll\", clearCache);\r\n\t\tdatastore.attachEvent(\"onBeforeStoreUpdate\", clearCache);\r\n\t}\r\n\r\n\treturn function getVisibleLinksRange(gantt, view, config, datastore, viewport){\r\n\t\tinit(datastore);\r\n\t\tif(!calculated){\r\n\t\t\tbuildCache(datastore, view, gantt);\r\n\t\t}\r\n\r\n\t\tvar visibleBoxes = [];\r\n\t\tfor(var i = 0; i < coordinates.length; i++){\r\n\t\t\tvar item = coordinates[i];\r\n\t\t\tvar box = item.rec;\r\n\t\t\tif(box.right < viewport.x){\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(box.left < viewport.x_end && box.right > viewport.x && box.top < viewport.y_end && box.bottom > viewport.y){\r\n\t\t\t\tvisibleBoxes.push(item.id);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn {\r\n\t\t\tids: visibleBoxes\r\n\t\t};\r\n\t};\r\n};","\r\n// optimized checker for links smart rendering\r\n\r\n// first check the vertical position since it's easier to calculate\r\n\r\nexport default function isLinkInViewPort(item, viewport, view, config, gantt){\r\n\tvar source = view.$gantt.getTask(item.source);\r\n\tvar target = view.$gantt.getTask(item.target);\r\n\t// check vertical visibility first since it's a lighter check\r\n\tvar sourceTop = view.getItemTop(source.id);\r\n\tvar sourceHeight = view.getItemHeight(source.id);\r\n\r\n\tvar targetTop = view.getItemTop(target.id);\r\n\tvar targetHeight = view.getItemHeight(target.id);\r\n\r\n\tif(viewport.y > sourceTop + sourceHeight &&\r\n\t\tviewport.y > targetTop + targetHeight){\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif(viewport.y_end < targetTop &&\r\n\t\tviewport.y_end < sourceTop){\r\n\t\treturn false;\r\n\t}\r\n\r\n\tvar padding = 100;\r\n\tvar sourceLeft = view.posFromDate(source.start_date, view._getPositioningContext ? view._getPositioningContext(item) : null);\r\n\tvar sourceRight = view.posFromDate(source.end_date, view._getPositioningContext ? view._getPositioningContext(item) : null);\r\n\tvar targetLeft = view.posFromDate(target.start_date, view._getPositioningContext ? view._getPositioningContext(item) : null);\r\n\tvar targetRight = view.posFromDate(target.end_date, view._getPositioningContext ? view._getPositioningContext(item) : null);\r\n\r\n\tif(sourceLeft > sourceRight){\r\n\t\t// rtl\r\n\t\tvar tmp = sourceRight;\r\n\t\tsourceRight = sourceLeft;\r\n\t\tsourceLeft = tmp;\r\n\t}\r\n\tif(targetLeft > targetRight){\r\n\t\t// rtl\r\n\t\tvar tmp = targetRight;\r\n\t\ttargetRight = targetLeft;\r\n\t\ttargetLeft = tmp;\r\n\t}\r\n\tsourceLeft += -padding; // add buffer for custom elements\r\n\tsourceRight += padding;\r\n\ttargetLeft += -padding; // add buffer for custom elements\r\n\ttargetRight += padding;\r\n\r\n\tif(viewport.x > sourceRight &&\r\n\t\tviewport.x > targetRight){\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif(viewport.x_end < sourceLeft &&\r\n\t\tviewport.x_end < targetLeft){\r\n\t\treturn false;\r\n\t}\r\n\treturn true;\r\n};\r\n","import createLayerFactory from \"./render/layer_engine\";\r\n\r\nimport getVisibleTaskRange from \"./render/viewport/get_visible_bars_range\";\r\nimport getVisibleLinksRangeFactory from \"./render/viewport/factory/get_visible_link_range\";\r\n\r\nimport isLinkInViewport from \"./render/viewport/is_link_in_viewport\";\r\n\r\nfunction initLayer(layer, gantt){\r\n\tif(!layer.view){\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar view = layer.view;\r\n\tif(typeof view === \"string\"){\r\n\t\tview = gantt.$ui.getView(view);\r\n\t}\r\n\r\n\tif(view && view.attachEvent){\r\n\t\tview.attachEvent(\"onScroll\", function(){\r\n\t\t\tvar state = gantt.$services.getService(\"state\");\r\n\t\t\t// don't repaint if we're inside batchUpdate, a complete repaint will be called afterwards\r\n\t\t\tif(!state.getState(\"batchUpdate\").batch_update && !view.$config.$skipSmartRenderOnScroll){\r\n\t\t\t\tif(layer.requestUpdate){\r\n\t\t\t\t\tlayer.requestUpdate();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nvar createLayerEngine = function(gantt){\r\n\tvar factory = createLayerFactory(gantt);\r\n\treturn {\r\n\t\tgetDataRender: function(name){\r\n\t\t\treturn gantt.$services.getService(\"layer:\" + name) || null;\r\n\t\t},\r\n\t\tcreateDataRender: function(config){\r\n\t\t\tvar name = config.name,\r\n\t\t\t\tdefaultContainer = config.defaultContainer,\r\n\t\t\t\tpreviusSiblingContainer = config.defaultContainerSibling;\r\n\r\n\t\t\tvar layers = factory.createGroup(\r\n\t\t\t\tdefaultContainer,\r\n\t\t\t\tpreviusSiblingContainer,\r\n\t\t\t\tfunction(itemId, item){\r\n\t\t\t\t\tif(layers.filters){\r\n\t\t\t\t\t\tfor(var i = 0; i < layers.filters.length; i++){\r\n\t\t\t\t\t\t\tif(layers.filters[i](itemId, item) === false){\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tinitLayer\r\n\t\t\t);\r\n\r\n\t\t\tgantt.$services.setService(\"layer:\" + name, function(){\r\n\t\t\t\treturn layers;\r\n\t\t\t});\r\n\r\n\t\t\tgantt.attachEvent(\"onGanttReady\", function () {\r\n\t\t\t\tlayers.addLayer();// init layers on start\r\n\t\t\t});\r\n\r\n\t\t\treturn layers;\r\n\t\t},\r\n\t\tinit: function(){\r\n\t\t\tvar taskLayers = this.createDataRender({\r\n\t\t\t\tname: \"task\",\r\n\t\t\t\tdefaultContainer: function(){\r\n\t\t\t\t\tif(gantt.$task_data){\r\n\t\t\t\t\t\treturn gantt.$task_data;\r\n\t\t\t\t\t}else if(gantt.$ui.getView(\"timeline\")){\r\n\t\t\t\t\t\treturn gantt.$ui.getView(\"timeline\").$task_data;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tdefaultContainerSibling: function(){\r\n\t\t\t\t\tif(gantt.$task_links){\r\n\t\t\t\t\t\treturn gantt.$task_links;\r\n\t\t\t\t\t}else if(gantt.$ui.getView(\"timeline\")){\r\n\t\t\t\t\t\treturn gantt.$ui.getView(\"timeline\").$task_links;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tfilter: function(item){\r\n\r\n\t\t\t\t}\r\n\t\t\t}, gantt);\r\n\r\n\t\t\tvar linkLayers = this.createDataRender({\r\n\t\t\t\tname: \"link\",\r\n\t\t\t\tdefaultContainer: function(){\r\n\t\t\t\t\tif(gantt.$task_data){\r\n\t\t\t\t\t\treturn gantt.$task_data;\r\n\t\t\t\t\t}else if(gantt.$ui.getView(\"timeline\")){\r\n\t\t\t\t\t\treturn gantt.$ui.getView(\"timeline\").$task_data;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, gantt);\r\n\r\n\t\t\treturn {\r\n\t\t\t\taddTaskLayer: function(config){\r\n\t\t\t\t\tconst rangeFunction = getVisibleTaskRange;\r\n\t\t\t\t\tif(typeof config === \"function\"){\r\n\t\t\t\t\t\tconfig = {\r\n\t\t\t\t\t\t\trenderer: {\r\n\t\t\t\t\t\t\t\trender: config,\r\n\t\t\t\t\t\t\t\tgetVisibleRange: rangeFunction\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tif(config.renderer && !config.renderer.getVisibleRange){\r\n\t\t\t\t\t\t\tconfig.renderer.getVisibleRange = rangeFunction;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconfig.view = \"timeline\";\r\n\r\n\t\t\t\t\treturn taskLayers.addLayer(config);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t_getTaskLayers: function(){\r\n\t\t\t\t\treturn taskLayers.getLayers();\r\n\t\t\t\t},\r\n\t\t\t\tremoveTaskLayer: function(id){\r\n\t\t\t\t\ttaskLayers.removeLayer(id);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t_clearTaskLayers: function(){\r\n\t\t\t\t\ttaskLayers.clear();\r\n\t\t\t\t},\r\n\t\t\t\taddLinkLayer: function(config){\r\n\t\t\t\t\tconst rangeFunction = getVisibleLinksRangeFactory();\r\n\t\t\t\t\tif(typeof config === \"function\"){\r\n\t\t\t\t\t\tconfig = {\r\n\t\t\t\t\t\t\trenderer: {\r\n\t\t\t\t\t\t\t\trender: config,\r\n\t\t\t\t\t\t\t\tgetVisibleRange: rangeFunction\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tif(config.renderer && !config.renderer.getVisibleRange){\r\n\t\t\t\t\t\t\tconfig.renderer.getVisibleRange = rangeFunction;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconfig.view = \"timeline\";\r\n\t\t\t\t\tif(config && config.renderer){\r\n\t\t\t\t\t\tif(!config.renderer.getRectangle && !config.renderer.isInViewPort){\r\n\t\t\t\t\t\t\tconfig.renderer.isInViewPort = isLinkInViewport;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn linkLayers.addLayer(config);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t_getLinkLayers: function(){\r\n\t\t\t\t\treturn linkLayers.getLayers();\r\n\t\t\t\t},\r\n\t\t\t\tremoveLinkLayer: function(id){\r\n\t\t\t\t\tlinkLayers.removeLayer(id);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t_clearLinkLayers: function(){\r\n\t\t\t\t\tlinkLayers.clear();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n};\r\n\r\nexport default createLayerEngine;","import * as utils from \"../../../utils/utils\";\r\nimport eventable from \"../../../utils/eventable\";\r\nimport * as domHelpers from \"../utils/dom_helpers\";\r\n\r\nvar Cell = (function () {\r\n\t\"use strict\";\r\n\r\n\tfunction Cell(parent, config, factory, gantt) {\r\n\t\tif (parent) {\r\n\t\t\tthis.$container = domHelpers.toNode(parent);\r\n\t\t\tthis.$parent = parent;\r\n\t\t}\r\n\t\t// save config\r\n\t\tthis.$config = utils.mixin(config, {\r\n\t\t\theaderHeight: 33\r\n\t\t});\r\n\t\tthis.$gantt = gantt;\r\n\t\tthis.$domEvents = gantt._createDomEventScope();\r\n\t\t// set id\r\n\t\tthis.$id = config.id || \"c\" + utils.uid();\r\n\r\n\t\tthis.$name = \"cell\";\r\n\t\tthis.$factory = factory;\r\n\t\tthis.$externalComponent = null;\r\n\r\n\t\teventable(this);\r\n\r\n\t}\r\n\r\n\tCell.prototype.destructor = function () {\r\n\t\tthis.$parent = this.$container = this.$view = null;\r\n\t\tvar mouse = this.$gantt.$services.getService(\"mouseEvents\");\r\n\t\tmouse.detach(\"click\", \"gantt_header_arrow\", this._headerClickHandler);\r\n\t\tthis.$domEvents.detachAll();\r\n\t\tthis.callEvent(\"onDestroy\", []);\r\n\t\tthis.detachAllEvents();\r\n\t};\r\n\tCell.prototype.cell = function (id) {\r\n\t\treturn null;\r\n\t};\r\n\r\n\tCell.prototype.scrollTo = function(left, top){\r\n\r\n\t\t//GS-333 Add a way to scroll the HTML views:\r\n\t\tvar cell = this.$view;\r\n\t\tif (this.$config.html) cell = this.$view.firstChild;\r\n\r\n\t\tif (left*1 == left){\r\n\t\t\tcell.scrollLeft = left;\r\n\t\t}\r\n\t\tif(top*1 == top){\r\n\t\t\tcell.scrollTop = top;\r\n\t\t}\r\n\t};\r\n\r\n\tCell.prototype.clear = function(){\r\n\t\tthis.getNode().innerHTML = \"\";\r\n\t\tthis.getNode().className = \"gantt_layout_content\";\r\n\t\tthis.getNode().style.padding = \"0\";\r\n\t};\r\n\r\n\tCell.prototype.resize = function (final) {\r\n\t\tif (this.$parent) {\r\n\t\t\treturn this.$parent.resize(final);\r\n\t\t}\r\n\r\n\t\tif(final === false){\r\n\t\t\tthis.$preResize = true;\r\n\t\t}\r\n\r\n\t\tvar topCont = this.$container;\r\n\t\tvar x = topCont.offsetWidth;\r\n\t\tvar y = topCont.offsetHeight;\r\n\t\tvar topSize = this.getSize();\r\n\t\tif (topCont === document.body) {\r\n\t\t\tx = document.body.offsetWidth;\r\n\t\t\ty = document.body.offsetHeight;\r\n\t\t}\r\n\t\tif (x < topSize.minWidth) {\r\n\t\t\tx = topSize.minWidth;\r\n\t\t}\r\n\t\tif (x > topSize.maxWidth) {\r\n\t\t\tx = topSize.maxWidth;\r\n\t\t}\r\n\t\tif (y < topSize.minHeight) {\r\n\t\t\ty = topSize.minHeight;\r\n\t\t}\r\n\t\tif (y > topSize.maxHeight) {\r\n\t\t\ty = topSize.maxHeight;\r\n\t\t}\r\n\t\tthis.setSize(x, y);\r\n\r\n\t\tif(!this.$preResize){\r\n\t\t//\tself.callEvent(\"onResize\", [x, y]);\r\n\t\t}\r\n\t\tthis.$preResize = false;\r\n\t};\r\n\r\n\tCell.prototype.hide = function () {\r\n\t\tthis._hide(true);\r\n\t\tthis.resize();\r\n\t};\r\n\tCell.prototype.show = function (force) {\r\n\t\tthis._hide(false);\r\n\t\tif (force && this.$parent) {\r\n\t\t\tthis.$parent.show();\r\n\t\t}\r\n\t\tthis.resize();\r\n\t};\r\n\tCell.prototype._hide = function (mode) {\r\n\t\tif (mode === true && this.$view.parentNode) {\r\n\t\t\tthis.$view.parentNode.removeChild(this.$view);\r\n\t\t}\r\n\t\telse if (mode === false && !this.$view.parentNode) {\r\n\t\t\tvar index = this.$parent.cellIndex(this.$id);\r\n\t\t\tthis.$parent.moveView(this, index);\r\n\t\t}\r\n\t\tthis.$config.hidden = mode;\r\n\t};\r\n\tCell.prototype.$toHTML = function (content, css) {\r\n\t\tif (content === void 0) { content = \"\"; }\r\n\t\tcss = [(css || \"\"), (this.$config.css || \"\")].join(\" \");\r\n\t\tvar obj = this.$config;\r\n\t\tvar header = \"\";\r\n\t\tif (obj.raw) {\r\n\t\t\tcontent = typeof obj.raw === \"string\" ? obj.raw : \"\";\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (!content) {\r\n\t\t\t\tlet renderedElement = null;\r\n\t\t\t\tif(typeof obj.html === \"function\"){\r\n\t\t\t\t\trenderedElement = obj.html();\r\n\t\t\t\t}else{\r\n\t\t\t\t\trenderedElement = obj.html;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(this.$gantt.config.external_render && this.$gantt.config.external_render.isElement(renderedElement)){\r\n\t\t\t\t\tthis.$externalComponent = renderedElement;\r\n\t\t\t\t\trenderedElement = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontent = \"<div class='gantt_layout_content' \"+(css ? \" class='\"+css+\"' \" : \"\")+\" >\" + (renderedElement || \"\") + \"</div>\";\r\n\t\t\t}\r\n\t\t\tif (obj.header) {\r\n\t\t\t\tvar collapseIcon = obj.canCollapse ? \"<div class='gantt_layout_header_arrow'></div>\" : \"\";\r\n\t\t\t\theader = \"<div class='gantt_layout_header'>\" + collapseIcon + \"<div class='gantt_layout_header_content'>\" + obj.header + \"</div></div>\";\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn \"<div class='gantt_layout_cell \" + css + \"' data-cell-id='\" + this.$id + \"'>\" + header + content + \"</div>\";\r\n\t};\r\n\tCell.prototype.$fill = function (node, parent) {\r\n\t\tthis.$view = node;\r\n\t\tthis.$parent = parent;\r\n\t\tthis.init();\r\n\t};\r\n\tCell.prototype.getNode = function () {\r\n\t\treturn (this.$view.querySelector(\"gantt_layout_cell\") || this.$view);\r\n\t};\r\n\tCell.prototype.init = function () {\r\n\t\t// [NOT-GOOD] code is executed for each component, while it still has only one handler, it is no good\r\n\r\n\t\tvar self = this;\r\n\r\n\t\tthis._headerClickHandler = function(e){\r\n\t\t\tvar cellId = domHelpers.locateAttribute(e, \"data-cell-id\");\r\n\t\t\tif(cellId == self.$id){\r\n\t\t\t\tself.toggle();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar mouse = this.$gantt.$services.getService(\"mouseEvents\");\r\n\t\tmouse.delegate(\"click\", \"gantt_header_arrow\", this._headerClickHandler);\r\n\r\n\t\tthis.callEvent(\"onReady\", []);\r\n\t};\r\n\tCell.prototype.toggle = function () {\r\n\t\tthis.$config.collapsed = !this.$config.collapsed;\r\n\t\tthis.resize();\r\n\t};\r\n\tCell.prototype.getSize = function () {\r\n\t\tvar size = {\r\n\t\t\theight: this.$config.height || 0,\r\n\t\t\twidth: this.$config.width || 0,\r\n\t\t\tgravity: this.$config.gravity || 1,\r\n\t\t\tminHeight: this.$config.minHeight || 0,\r\n\t\t\tminWidth: this.$config.minWidth || 0,\r\n\t\t\tmaxHeight: this.$config.maxHeight || 100000000000,\r\n\t\t\tmaxWidth: this.$config.maxWidth || 100000000000\r\n\t\t};\r\n\t\tif (this.$config.collapsed) {\r\n\t\t\tvar mode = this.$config.mode === \"x\";\r\n\t\t\tsize[mode ? \"width\" : \"height\"] = size[mode ? \"maxWidth\" : \"maxHeight\"] = this.$config.headerHeight;\r\n\t\t}\r\n\t\treturn size;\r\n\t};\r\n\r\n\tCell.prototype.getContentSize = function(){\r\n\r\n\t\tvar width = this.$lastSize.contentX;\r\n\t\tif(width !== width*1){\r\n\t\t\twidth = this.$lastSize.width;\r\n\t\t}\r\n\r\n\t\tvar height = this.$lastSize.contentY;\r\n\t\tif(height !== height*1){\r\n\t\t\theight = this.$lastSize.height;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\twidth: width,\r\n\t\t\theight: height\r\n\t\t};\r\n\t};\r\n\r\n\tCell.prototype._getBorderSizes = function(){\r\n\t\tvar borders = {\r\n\t\t\ttop: 0,\r\n\t\t\tright: 0,\r\n\t\t\tbottom: 0,\r\n\t\t\tleft: 0,\r\n\t\t\thorizontal: 0,\r\n\t\t\tvertical: 0\r\n\t\t};\r\n\t\tif(this._currentBorders){\r\n\t\t\tif(this._currentBorders[this._borders.left]){\r\n\t\t\t\tborders.left = 1;\r\n\t\t\t\tborders.horizontal++;\r\n\t\t\t}\r\n\r\n\t\t\tif(this._currentBorders[this._borders.right]){\r\n\t\t\t\tborders.right = 1;\r\n\t\t\t\tborders.horizontal++;\r\n\t\t\t}\r\n\r\n\t\t\tif(this._currentBorders[this._borders.top]){\r\n\t\t\t\tborders.top = 1;\r\n\t\t\t\tborders.vertical++;\r\n\t\t\t}\r\n\r\n\t\t\tif(this._currentBorders[this._borders.bottom]){\r\n\t\t\t\tborders.bottom = 1;\r\n\t\t\t\tborders.vertical++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn borders;\r\n\r\n\t};\r\n\r\n\tCell.prototype.setSize = function (x, y) {\r\n\t\tthis.$view.style.width = x + \"px\";\r\n\t\tthis.$view.style.height = y + \"px\";\r\n\r\n\t\tvar borders = this._getBorderSizes();\r\n\t\tvar contentY = y - borders.vertical;\r\n\t\tvar contentX = x - borders.horizontal;\r\n\r\n\t\tthis.$lastSize = { x: x, y: y, contentX: contentX, contentY: contentY };\r\n\t\tif (this.$config.header) {\r\n\t\t\tthis._sizeHeader();\r\n\t\t}else{\r\n\t\t\tthis._sizeContent();\r\n\t\t}\r\n\t};\r\n\r\n\tCell.prototype._borders = {\r\n\t\t\"left\":\"gantt_layout_cell_border_left\",\r\n\t\t\"right\":\"gantt_layout_cell_border_right\",\r\n\t\t\"top\":\"gantt_layout_cell_border_top\",\r\n\t\t\"bottom\":\"gantt_layout_cell_border_bottom\"\r\n\t};\r\n\r\n\tCell.prototype._setBorders = function(css, view){\r\n\t\tif(!view) {\r\n\t\t\tview = this;\r\n\t\t}\r\n\t\tvar node = view.$view;\r\n\r\n\t\tfor( var i in this._borders){\r\n\t\t\tdomHelpers.removeClassName(node, this._borders[i]);\r\n\t\t}\r\n\r\n\t\tif(typeof css == \"string\"){\r\n\t\t\tcss = [css];\r\n\t\t}\r\n\r\n\t\tvar cssHash = {};\r\n\r\n\t\tfor(var i = 0; i < css.length; i++){\r\n\t\t\tdomHelpers.addClassName(node, css[i]);\r\n\t\t\tcssHash[css[i]] = true;\r\n\t\t}\r\n\r\n\t\tview._currentBorders = cssHash;\r\n\t};\r\n\r\n\r\n\tCell.prototype._sizeContent = function(){\r\n\t\tvar content = this.$view.childNodes[0];\r\n\t\tif(content && content.className == \"gantt_layout_content\"){\r\n\t\t\tcontent.style.height = this.$lastSize.contentY + \"px\";\r\n\t\t}\r\n\t};\r\n\r\n\tCell.prototype._sizeHeader = function () {\r\n\t\tvar size = this.$lastSize;\r\n\t\tsize.contentY -= this.$config.headerHeight;\r\n\t\tvar header = this.$view.childNodes[0];\r\n\t\tvar content = this.$view.childNodes[1];\r\n\t\tvar xLayout = this.$config.mode === \"x\";\r\n\t\tif (this.$config.collapsed) {\r\n\t\t\tcontent.style.display = \"none\";\r\n\t\t\tif (xLayout) {\r\n\t\t\t\theader.className = \"gantt_layout_header collapsed_x\";\r\n\t\t\t\theader.style.width = size.y + \"px\";\r\n\t\t\t\tvar d = Math.floor(size.y / 2 - size.x / 2);\r\n\t\t\t\theader.style.transform = \"rotate(90deg) translate(\" + d + \"px, \" + d + \"px)\";\r\n\t\t\t\tcontent.style.display = \"none\";\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\theader.className = \"gantt_layout_header collapsed_y\";\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (xLayout) {\r\n\t\t\t\theader.className = \"gantt_layout_header\";\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\theader.className = \"gantt_layout_header vertical\";\r\n\t\t\t}\r\n\t\t\theader.style.width = 'auto';\r\n\t\t\theader.style.transform = '';\r\n\t\t\tcontent.style.display = \"\";\r\n\t\t\tcontent.style.height = size.contentY + \"px\";\r\n\t\t}\r\n\t\theader.style.height = this.$config.headerHeight + \"px\";\r\n\t};\r\n\treturn Cell;\r\n}());\r\n\r\nexport default Cell;\r\n","export default function (d, b) {\r\n\tfor (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n\tfunction __() { this.constructor = d; }\r\n\td.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n};","import __extends from \"../../../utils/extends\";\r\nimport * as domHelpers from \"../utils/dom_helpers\";\r\nimport Cell from \"./cell\";\r\n\r\nvar Layout = (function (_super) {\r\n\t\"use strict\";\r\n\r\n\t__extends(Layout, _super);\r\n\tfunction Layout(parent, config, factory) {\r\n\t\tvar _this = _super.apply(this, arguments) || this;\r\n\r\n\t\tif(parent)\r\n\t\t\t_this.$root = true;\r\n\r\n\t\t_this._parseConfig(config);\r\n\t\t_this.$name = \"layout\";\r\n\t\treturn _this;\r\n\t}\r\n\r\n\tLayout.prototype.destructor = function () {\r\n\t\tif (this.$container && this.$view) {\r\n\t\t\tdomHelpers.removeNode(this.$view);\r\n\t\t}\r\n\r\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\t\t\tvar child = this.$cells[i];\r\n\t\t\tchild.destructor();\r\n\t\t}\r\n\t\tthis.$cells = [];\r\n\r\n\t\t_super.prototype.destructor.call(this);\r\n\t};\r\n\r\n\tLayout.prototype._resizeScrollbars = function(autosize, scrollbars){\r\n\t\tvar scrollChanged = false;\r\n\t\tvar visibleScrollbars = [],\r\n\t\t\thiddenScrollbars = [];\r\n\r\n\t\tconst scrollbarsToHide = [];\r\n\r\n\t\tfunction showScrollbar(scrollbar){\r\n\t\t\tscrollbar.$parent.show();\r\n\t\t\tscrollChanged = true;\r\n\t\t\tvisibleScrollbars.push(scrollbar);\r\n\t\t}\r\n\t\tfunction hideScrollbar(scrollbar){\r\n\t\t\tscrollbar.$parent.hide();\r\n\t\t\tscrollChanged = true;\r\n\t\t\thiddenScrollbars.push(scrollbar);\r\n\t\t}\r\n\r\n\t\tvar scrollbar;\r\n\t\tfor(var i = 0; i < scrollbars.length; i++){\r\n\t\t\tscrollbar = scrollbars[i];\r\n\r\n\t\t\tif(autosize[scrollbar.$config.scroll]) {\r\n\t\t\t\thideScrollbar(scrollbar);\r\n\t\t\t}else if(scrollbar.shouldHide()){\r\n\t\t\t\t//hideScrollbar(scrollbar);\r\n\t\t\t\tscrollbarsToHide.push(scrollbar);\r\n\t\t\t}else if(scrollbar.shouldShow()){\r\n\t\t\t\tshowScrollbar(scrollbar);\r\n\t\t\t}else{\r\n\t\t\t\tif(scrollbar.isVisible()){\r\n\t\t\t\t\tvisibleScrollbars.push(scrollbar);\r\n\t\t\t\t}else{\r\n\t\t\t\t\thiddenScrollbars.push(scrollbar);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar visibleGroups = {};\r\n\t\tfor(var i = 0; i < visibleScrollbars.length; i++){\r\n\t\t\tif(visibleScrollbars[i].$config.group){\r\n\t\t\t\tvisibleGroups[visibleScrollbars[i].$config.group] = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// GS-2220\r\n\t\tscrollbarsToHide.forEach(function(scrollbar){\r\n\t\t\tif(!(scrollbar.$config.group && visibleGroups[scrollbar.$config.group])){\r\n\t\t\t\thideScrollbar(scrollbar);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfor(var i = 0; i < hiddenScrollbars.length; i++){\r\n\t\t\tscrollbar = hiddenScrollbars[i];\r\n\r\n\t\t\tif(scrollbar.$config.group && visibleGroups[scrollbar.$config.group]){\r\n\t\t\t\tshowScrollbar(scrollbar);\r\n\t\t\t\t// GS-707 If the scrollbar was hidden then showed, the container resize shouldn't happen because of that\r\n\t\t\t\tfor(var j = 0; j < visibleScrollbars.length; j++){\r\n\t\t\t\t\tif(visibleScrollbars[j] == scrollbar){\r\n\t\t\t\t\t\tthis.$gantt.$scrollbarRepaint = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn scrollChanged;\r\n\t};\r\n\r\n\tLayout.prototype.getScrollbarsInfo = function(){\r\n\t\tconst scrollbars = this.getCellsByType(\"scroller\");\r\n\t\tconst scrollbarsInfo = [];\r\n\t\tscrollbars.forEach(scrollbar => {\r\n\t\t\tlet obj = {};\r\n\t\t\tconst {visible, direction, size, scrollSize, position} = scrollbar.getScrollState();\r\n\t\t\tlet linkedViews = scrollbar._getLinkedViews();\r\n\t\t\tlet boundViews = linkedViews.map(view => view.$config.id);\r\n\r\n\t\t\tobj.id = scrollbar.$id;\r\n\t\t\tobj.visible = visible;\r\n\t\t\tobj.boundViews = boundViews;\r\n\t\t\tif(direction === \"x\"){\r\n\t\t\t\tobj.x = size;\r\n\t\t\t\tobj.x_inner = scrollSize;\r\n\t\t\t\tobj.x_pos = position || 0;\r\n\t\t\t} else {\r\n\t\t\t\tobj.y = size;\r\n\t\t\t\tobj.y_inner = scrollSize;\r\n\t\t\t\tobj.y_pos = position || 0;\r\n\t\t\t}\r\n\t\t\tscrollbarsInfo.push(obj);\r\n\t\t});\r\n\t\treturn scrollbarsInfo;\r\n\t};\r\n\r\n\tLayout.prototype._syncCellSizes = function(groupName, newSize){\r\n\t\tif(!groupName)\r\n\t\t\treturn;\r\n\r\n\t\tvar groups = {};\r\n\r\n\t\tthis._eachChild(function(cell){\r\n\t\t\tif(cell.$config.group && cell.$name != \"scrollbar\" && cell.$name != \"resizer\"){\r\n\t\t\t\tif(!groups[cell.$config.group]){\r\n\t\t\t\t\tgroups[cell.$config.group] = [];\r\n\t\t\t\t}\r\n\t\t\t\tgroups[cell.$config.group].push(cell);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif(groups[groupName]){\r\n\t\t\tthis._syncGroupSize(groups[groupName], newSize);\r\n\t\t}\r\n\t\treturn groups[groupName];\r\n\t};\r\n\r\n\tLayout.prototype._syncGroupSize = function(cells, newSize){\r\n\t\tif(!cells.length) return;\r\n\r\n\t\tvar property = cells[0].$parent._xLayout ? \"width\" : \"height\";\r\n\t\tvar direction = cells[0].$parent.getNextSibling(cells[0].$id) ? 1 : -1;\r\n\r\n\t\tvar newSizeValue = newSize.value;\r\n\t\tvar isGravity = newSize.isGravity;\r\n\t\tfor(var i = 0; i < cells.length; i++){\r\n\t\t\tvar ownSize = cells[i].getSize();\r\n\r\n\t\t\tvar resizeSibling = direction > 0 ? cells[i].$parent.getNextSibling(cells[i].$id) : cells[i].$parent.getPrevSibling(cells[i].$id);\r\n\t\t\tif(resizeSibling.$name == \"resizer\"){\r\n\t\t\t\tresizeSibling = direction > 0 ? resizeSibling.$parent.getNextSibling(resizeSibling.$id) : resizeSibling.$parent.getPrevSibling(resizeSibling.$id);\r\n\t\t\t}\r\n\t\t\tvar siblingSize = resizeSibling.getSize();\r\n\r\n\t\t\tif(!isGravity) {\r\n\t\t\t\tif(resizeSibling[property]){\r\n\t\t\t\t\tvar totalGravity = ownSize.gravity + siblingSize.gravity;\r\n\t\t\t\t\tvar totalSize = ownSize[property] + siblingSize[property];\r\n\t\t\t\t\tvar k = totalGravity / totalSize;\r\n\t\t\t\t\tcells[i].$config.gravity = k * newSizeValue;\r\n\r\n\t\t\t\t\tresizeSibling.$config[property] = totalSize - newSizeValue;\r\n\t\t\t\t\tresizeSibling.$config.gravity = totalGravity - k * newSizeValue;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tcells[i].$config[property] = newSizeValue;\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tcells[i].$config.gravity = newSizeValue;\r\n\t\t\t}\r\n\r\n\t\t\tvar mainGrid = this.$gantt.$ui.getView(\"grid\");\r\n\t\t\tif(mainGrid && cells[i].$content === mainGrid && !mainGrid.$config.scrollable && !isGravity){\r\n\t\t\t\tthis.$gantt.config.grid_width = newSizeValue;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tLayout.prototype.resize = function(startStage){\r\n\t\tvar mainCall = false;\r\n\t\tif(this.$root && !this._resizeInProgress){\r\n\t\t\tthis.callEvent(\"onBeforeResize\", []);\r\n\t\t\tmainCall = true;\r\n\t\t\tthis._resizeInProgress = true;\r\n\t\t}\r\n\r\n\t\t_super.prototype.resize.call(this, true);\r\n\t\t_super.prototype.resize.call(this, false);\r\n\r\n\t\tif(mainCall){\r\n\r\n\t\t\tvar contentViews = [];\r\n\t\t\tcontentViews = contentViews.concat(this.getCellsByType(\"viewCell\"));\r\n\t\t\tcontentViews = contentViews.concat(this.getCellsByType(\"viewLayout\"));\r\n\t\t\tcontentViews = contentViews.concat(this.getCellsByType(\"hostCell\"));\r\n\r\n\t\t\tvar scrollbars = this.getCellsByType(\"scroller\");\r\n\r\n\t\t\tfor(var i = 0; i < contentViews.length; i++){\r\n\t\t\t\tif(!contentViews[i].$config.hidden)\r\n\t\t\t\t\tcontentViews[i].setContentSize();\r\n\t\t\t}\r\n\r\n\t\t\tvar autosize = this._getAutosizeMode(this.$config.autosize);\r\n\r\n\t/* // possible to rollback set content size when autisize is disabled, not sure if need to\r\n\t\t\tcontentViews.forEach(function(view){\r\n\t\t\t\tconst parent = view.$parent;\r\n\t\t\t\tif(!autosize.x){\r\n\t\t\t\t\tif(parent.$config.$originalWidthStored){\r\n\t\t\t\t\t\tparent.$config.$originalWidthStored = false;\r\n\t\t\t\t\t\tparent.$config.width = parent.$config.$originalWidth;\r\n\t\t\t\t\t\tparent.$config.$originalWidth = undefined;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!autosize.y){\r\n\t\t\t\t\tif(parent.$config.$originalHeightStored){\r\n\t\t\t\t\t\tparent.$config.$originalHeightStored = false;\r\n\t\t\t\t\t\tparent.$config.height = parent.$config.$originalHeight;\r\n\t\t\t\t\t\tparent.$config.$originalHeight = undefined;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});*/\r\n\t\t\t\r\n\t\t\tvar scrollChanged = this._resizeScrollbars(autosize, scrollbars);\r\n\r\n\t\t\tif(this.$config.autosize){\r\n\t\t\t\tthis.autosize(this.$config.autosize);\r\n\t\t\t\tcontentViews.forEach(function(view){\r\n\t\t\t\t\tconst parent = view.$parent;\r\n\t\t\t\t\tconst sizes = parent.getContentSize(autosize);\r\n\t\t\t\t\tif(autosize.x){\r\n\t\t\t\t\t\tif(!parent.$config.$originalWidthStored){\r\n\t\t\t\t\t\t\tparent.$config.$originalWidthStored = true;\r\n\t\t\t\t\t\t\tparent.$config.$originalWidth = parent.$config.width;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tparent.$config.width = sizes.width;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(autosize.y){\r\n\t\t\t\t\t\tif(!parent.$config.$originalHeightStored){\r\n\t\t\t\t\t\t\tparent.$config.$originalHeightStored = true;\r\n\t\t\t\t\t\t\tparent.$config.$originalHeight = parent.$config.height;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tparent.$config.height = sizes.height;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tscrollChanged = true;\r\n\t\t\t}\r\n\r\n\t\t\tif(scrollChanged){\r\n\t\t\t\tthis.resize();\r\n\t\t\t\tfor(var i = 0; i < contentViews.length; i++){\r\n\t\t\t\t\tif(!contentViews[i].$config.hidden)\r\n\t\t\t\t\t\tcontentViews[i].setContentSize();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.callEvent(\"onResize\", []);\r\n\t\t}\r\n\t\tif(mainCall){\r\n\t\t\tthis._resizeInProgress = false;\r\n\t\t}\r\n\t};\r\n\r\n\tLayout.prototype._eachChild = function(code, cell){\r\n\t\tcell = cell || this;\r\n\t\tcode(cell);\r\n\t\tif(cell.$cells){\r\n\t\t\tfor(var i = 0; i < cell.$cells.length; i++){\r\n\t\t\t\tthis._eachChild(code, cell.$cells[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tLayout.prototype.isChild = function(view){\r\n\t\tvar res = false;\r\n\t\tthis._eachChild(function(child){\r\n\t\t\tif(child === view || child.$content === view){\r\n\t\t\t\tres = true;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn res;\r\n\t};\r\n\r\n\tLayout.prototype.getCellsByType = function(type){\r\n\t\tvar res = [];\r\n\t\tif(type === this.$name){\r\n\t\t\tres.push(this);\r\n\t\t}\r\n\r\n\t\tif(this.$content && this.$content.$name == type){\r\n\t\t\tres.push(this.$content);\r\n\t\t}\r\n\r\n\t\tif(this.$cells){\r\n\t\t\tfor(var i = 0; i < this.$cells.length; i++){\r\n\t\t\t\tvar children = Layout.prototype.getCellsByType.call(this.$cells[i], type);\r\n\t\t\t\tif(children.length){\r\n\t\t\t\t\tres.push.apply(res, children);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn res;\r\n\t};\r\n\r\n\tLayout.prototype.getNextSibling = function(cellId){\r\n\t\tvar index = this.cellIndex(cellId);\r\n\t\tif(index >= 0 && this.$cells[index + 1]){\r\n\t\t\treturn this.$cells[index + 1];\r\n\t\t}else{\r\n\t\t\treturn null;\r\n\t\t}\r\n\t};\r\n\r\n\tLayout.prototype.getPrevSibling = function(cellId){\r\n\t\tvar index = this.cellIndex(cellId);\r\n\t\tif(index >= 0 && this.$cells[index - 1]){\r\n\t\t\treturn this.$cells[index - 1];\r\n\t\t}else{\r\n\t\t\treturn null;\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tLayout.prototype.cell = function (id) {\r\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\t\t\tvar child = this.$cells[i];\r\n\t\t\tif (child.$id === id) {\r\n\t\t\t\treturn child;\r\n\t\t\t}\r\n\t\t\tvar sub = child.cell(id);\r\n\t\t\tif (sub) {\r\n\t\t\t\treturn sub;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tLayout.prototype.cellIndex = function (id) {\r\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\t\t\tif (this.$cells[i].$id === id) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t};\r\n\tLayout.prototype.moveView = function (view, ind) {\r\n\t\tif (this.$cells[ind] !== view) {\r\n\t\t\treturn window.alert(\"Not implemented\");\r\n\t\t}\r\n\t\telse {\r\n\t\t\tind += this.$config.header ? 1 : 0;\r\n\t\t\tvar node = this.$view;\r\n\t\t\tif (ind >= node.childNodes.length) {\r\n\t\t\t\tnode.appendChild(view.$view);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tnode.insertBefore(view.$view, node.childNodes[ind]);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tLayout.prototype._parseConfig = function (config) {\r\n\t\tthis.$cells = [];\r\n\t\tthis._xLayout = !config.rows;\r\n\t\tvar cells = config.rows || config.cols || config.views;\r\n\t\tfor (var i = 0; i < cells.length; i++) {\r\n\t\t\tvar cell = cells[i];\r\n\t\t\tcell.mode = this._xLayout ? \"x\" : \"y\";\r\n\t\t\tvar $content = this.$factory.initUI(cell, this);\r\n\t\t\tif(!$content){\r\n\t\t\t\tcells.splice(i, 1);\r\n\t\t\t\ti--;\r\n\t\t\t}else{\r\n\t\t\t\t$content.$parent = this;\r\n\t\t\t\tthis.$cells.push($content);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tLayout.prototype.getCells = function () {\r\n\t\treturn this.$cells;\r\n\t};\r\n\tLayout.prototype.render = function () {\r\n\t\tvar view = domHelpers.insertNode(this.$container, this.$toHTML());\r\n\r\n\t\tthis.$fill(view, null);\r\n\r\n\t\tconst gantt = this.$gantt;\r\n\t\tthis._eachChild((cell) => {\r\n\t\t\tif(cell.$externalComponent){\r\n\t\t\t\tgantt.config.external_render.renderElement(\r\n\t\t\t\t\tcell.$externalComponent, \r\n\t\t\t\t\tcell.$view.querySelector(\".gantt_layout_content\")\r\n\t\t\t\t);\r\n\t\t\t\tcell.$externalComponent = null;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.callEvent(\"onReady\", []);\r\n\t\tthis.resize();\r\n\r\n\t\t// do simple repaint after the first call\r\n\t\tthis.render = this.resize;\r\n\t};\r\n\tLayout.prototype.$fill = function (node, parent) {\r\n\t\tthis.$view = node;\r\n\t\tthis.$parent = parent;\r\n\t\tvar cells = domHelpers.getChildNodes(node, \"gantt_layout_cell\");\r\n\t\tfor (var i = cells.length - 1; i >= 0; i--) {\r\n\t\t\tvar sub = this.$cells[i];\r\n\t\t\tsub.$fill(cells[i], this);\r\n\t\t\t// initially hidden cell\r\n\t\t\tif (sub.$config.hidden) {\r\n\t\t\t\tsub.$view.parentNode.removeChild(sub.$view);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tLayout.prototype.$toHTML = function () {\r\n\t\tvar mode = this._xLayout ? \"x\" : \"y\";\r\n\t\tvar html = [];\r\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\t\t\thtml.push(this.$cells[i].$toHTML());\r\n\t\t}\r\n\t\treturn _super.prototype.$toHTML.call(this, html.join(\"\"), (this.$root ? \"gantt_layout_root \" : \"\") + \"gantt_layout gantt_layout_\" + mode);\r\n\t};\r\n\r\n\tLayout.prototype.getContentSize = function(mode){\r\n\t\tvar contentWidth = 0,\r\n\t\t\tcontentHeight = 0;\r\n\r\n\t\tvar cellSize, cell, borders;\r\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\t\t\tcell = this.$cells[i];\r\n\t\t\tif(cell.$config.hidden)\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tcellSize = cell.getContentSize(mode);\r\n\r\n\t\t\tif(cell.$config.view === \"scrollbar\" && mode[cell.$config.scroll]){\r\n\t\t\t\tcellSize.height = 0;\r\n\t\t\t\tcellSize.width = 0;\r\n\t\t\t}\r\n\r\n\t\t\tif(cell.$config.resizer){\r\n\t\t\t\tif(this._xLayout){\r\n\t\t\t\t\tcellSize.height = 0;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tcellSize.width = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tborders = cell._getBorderSizes();\r\n\r\n\t\t\tif(this._xLayout){\r\n\t\t\t\tcontentWidth += (cellSize.width + borders.horizontal);\r\n\t\t\t\tcontentHeight = Math.max(contentHeight, (cellSize.height + borders.vertical));\r\n\t\t\t}else{\r\n\t\t\t\tcontentWidth = Math.max(contentWidth, cellSize.width + borders.horizontal);\r\n\t\t\t\tcontentHeight += cellSize.height + borders.vertical;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tborders = this._getBorderSizes();\r\n\t\tcontentWidth += borders.horizontal;\r\n\t\tcontentHeight += borders.vertical;\r\n\r\n\t\t// GS-149 & GS-150: By default this code only increases the container sizes, because of that, the cell sizes\r\n\t\t// are also increased. Keep this code here in the case if something goes wrong\r\n\t\t/*\r\n\t\tif(this.$root){\r\n\t\t\tcontentWidth += 1;\r\n\t\t\tcontentHeight += 1;\r\n\t\t}\r\n\t\t*/\r\n\t\treturn {\r\n\t\t\twidth: contentWidth,\r\n\t\t\theight: contentHeight\r\n\t\t};\r\n\t};\r\n\r\n\tLayout.prototype._cleanElSize = function(value){\r\n\t\treturn ((value || \"\").toString().replace(\"px\", \"\") * 1 || 0);\r\n\t};\r\n\tLayout.prototype._getBoxStyles = function(div){\r\n\t\tvar computed = null;\r\n\t\tif(window.getComputedStyle){\r\n\t\t\tcomputed = window.getComputedStyle(div, null);\r\n\t\t}else{\r\n\t\t\t//IE with elem.currentStyle does not calculate sizes from %, so will use the default approach\r\n\t\t\tcomputed = {\r\n\t\t\t\t\"width\":div.clientWidth,\r\n\t\t\t\t\"height\":div.clientHeight\r\n\t\t\t};\r\n\t\t}\r\n\t\tvar properties = [\r\n\t\t\t\"width\",\r\n\t\t\t\"height\",\r\n\r\n\t\t\t\"paddingTop\",\r\n\t\t\t\"paddingBottom\",\r\n\t\t\t\"paddingLeft\",\r\n\t\t\t\"paddingRight\",\r\n\r\n\t\t\t\"borderLeftWidth\",\r\n\t\t\t\"borderRightWidth\",\r\n\t\t\t\"borderTopWidth\",\r\n\t\t\t\"borderBottomWidth\"\r\n\t\t];\r\n\t\tvar styles = {\r\n\t\t\tboxSizing:(computed.boxSizing == \"border-box\")\r\n\t\t};\r\n\r\n\t\tif(computed.MozBoxSizing){\r\n\t\t\tstyles.boxSizing = (computed.MozBoxSizing == \"border-box\");\r\n\t\t}\r\n\t\tfor(var i =0; i < properties.length; i++){\r\n\t\t\tstyles[properties[i]] = computed[properties[i]] ? this._cleanElSize(computed[properties[i]]) : 0;\r\n\t\t}\r\n\r\n\r\n\t\tvar box = {\r\n\t\t\thorPaddings : (styles.paddingLeft + styles.paddingRight + styles.borderLeftWidth + styles.borderRightWidth),\r\n\t\t\tvertPaddings : (styles.paddingTop + styles.paddingBottom + styles.borderTopWidth + styles.borderBottomWidth),\r\n\t\t\tborderBox: styles.boxSizing,\r\n\t\t\tinnerWidth : styles.width,\r\n\t\t\tinnerHeight : styles.height,\r\n\t\t\touterWidth : styles.width,\r\n\t\t\touterHeight : styles.height\r\n\t\t};\r\n\r\n\r\n\t\tif(box.borderBox){\r\n\t\t\tbox.innerWidth -= box.horPaddings;\r\n\t\t\tbox.innerHeight -= box.vertPaddings;\r\n\t\t}else{\r\n\t\t\tbox.outerWidth += box.horPaddings;\r\n\t\t\tbox.outerHeight += box.vertPaddings;\r\n\t\t}\r\n\r\n\t\treturn box;\r\n\t};\r\n\r\n\tLayout.prototype._getAutosizeMode = function(config){\r\n\t\tvar res = {x:false, y:false};\r\n\t\tif(config === \"xy\"){\r\n\t\t\tres.x = res.y = true;\r\n\t\t}else if(config === \"y\" || config === true){\r\n\t\t\tres.y = true;\r\n\t\t}else if(config === \"x\"){\r\n\t\t\tres.x = true;\r\n\t\t}\r\n\t\treturn res;\r\n\t};\r\n\r\n\tLayout.prototype.autosize = function(mode) {\r\n\t\tvar res = this._getAutosizeMode(mode);\r\n\t\tvar boxSizes = this._getBoxStyles(this.$container);\r\n\t\tvar contentSizes = this.getContentSize(mode);\r\n\r\n\t\tvar node = this.$container;\r\n\t\tif(res.x){\r\n\t\t\tif(boxSizes.borderBox){\r\n\t\t\t\tcontentSizes.width += boxSizes.horPaddings;\r\n\t\t\t}\r\n\t\t\tnode.style.width = contentSizes.width + \"px\";\r\n\t\t}\r\n\t\tif(res.y){\r\n\t\t\tif(boxSizes.borderBox){\r\n\t\t\t\tcontentSizes.height += boxSizes.vertPaddings;\r\n\t\t\t}\r\n\t\t\tnode.style.height = contentSizes.height + \"px\";\r\n\t\t}\r\n\t};\r\n\r\n\tLayout.prototype.getSize = function () {\r\n\t\tthis._sizes = [];\r\n\t\tvar width = 0;\r\n\t\tvar minWidth = 0;\r\n\t\tvar maxWidth = 100000000000;\r\n\t\tvar height = 0;\r\n\t\tvar maxHeight = 100000000000;\r\n\t\tvar minHeight = 0;\r\n\r\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\r\n\t\t\tvar size = this._sizes[i] = this.$cells[i].getSize();\r\n\t\t\tif (this.$cells[i].$config.hidden) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (this._xLayout) {\r\n\t\t\t\tif (!size.width && size.minWidth) {\r\n\t\t\t\t\twidth += size.minWidth;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\twidth += size.width;\r\n\t\t\t\t}\r\n\t\t\t\tmaxWidth += size.maxWidth;\r\n\t\t\t\tminWidth += size.minWidth;\r\n\t\t\t\theight = Math.max(height, size.height);\r\n\t\t\t\tmaxHeight = Math.min(maxHeight, size.maxHeight); // min of maxHeight\r\n\t\t\t\tminHeight = Math.max(minHeight, size.minHeight); // max of minHeight\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (!size.height && size.minHeight) {\r\n\t\t\t\t\theight += size.minHeight;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\theight += size.height;\r\n\t\t\t\t}\r\n\t\t\t\tmaxHeight += size.maxHeight;\r\n\t\t\t\tminHeight += size.minHeight;\r\n\t\t\t\twidth = Math.max(width, size.width);\r\n\t\t\t\tmaxWidth = Math.min(maxWidth, size.maxWidth); // min of maxWidth\r\n\t\t\t\tminWidth = Math.max(minWidth, size.minWidth); // max of minWidth\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar self = _super.prototype.getSize.call(this);\r\n\t\t// maxWidth\r\n\t\tif (self.maxWidth >= 100000) {\r\n\t\t\tself.maxWidth = maxWidth;\r\n\t\t}\r\n\t\t// maxHeight\r\n\t\tif (self.maxHeight >= 100000) {\r\n\t\t\tself.maxHeight = maxHeight;\r\n\t\t}\r\n\t\t// minWidth\r\n\t\tself.minWidth = self.minWidth !== self.minWidth ? 0 : self.minWidth;// || self.width || Math.max(minWidth, width);\r\n\t\t// minHeight\r\n\t\tself.minHeight = self.minHeight !== self.minHeight ? 0 : self.minHeight;//self.minHeight || self.height || Math.max(minHeight, height);\r\n\t\t// sizes with paddings and margins\r\n\t\tif (this._xLayout) {\r\n\t\t\tself.minWidth += this.$config.margin * (this.$cells.length) || 0;\r\n\t\t\tself.minWidth += this.$config.padding * 2 || 0;\r\n\t\t\tself.minHeight += (this.$config.padding * 2) || 0;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tself.minHeight += this.$config.margin * (this.$cells.length) || 0;\r\n\t\t\tself.minHeight += (this.$config.padding * 2) || 0;\r\n\t\t}\r\n\t\t\r\n\t\treturn self;\r\n\t};\r\n\t// calc total gravity and free space\r\n\tLayout.prototype._calcFreeSpace = function (s, cell, xLayout) {\r\n\t\tvar min = xLayout ? cell.minWidth : cell.minHeight;\r\n\t\tvar max = xLayout ? cell.maxWidth : cell.maxWidth;\r\n\t\tvar side = s;\r\n\t\tif (!side) {\r\n\t\t\tside = Math.floor(this._free / this._gravity * cell.gravity);\r\n\t\t\tif (side > max) {\r\n\t\t\t\tside = max;\r\n\t\t\t\tthis._free -= side;\r\n\t\t\t\tthis._gravity -= cell.gravity;\r\n\t\t\t}\r\n\t\t\tif (side < min) {\r\n\t\t\t\tside = min;\r\n\t\t\t\tthis._free -= side;\r\n\t\t\t\tthis._gravity -= cell.gravity;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (side > max) {\r\n\t\t\t\tside = max;\r\n\t\t\t}\r\n\t\t\tif (side < min) {\r\n\t\t\t\tside = min;\r\n\t\t\t}\r\n\t\t\tthis._free -= side;\r\n\t\t}\r\n\t\treturn side;\r\n\t};\r\n\tLayout.prototype._calcSize = function (s, size, xLayout) {\r\n\t\tvar side = s;\r\n\t\tvar min = xLayout ? size.minWidth : size.minHeight;\r\n\t\tvar max = xLayout ? size.maxWidth : size.maxHeight;\r\n\t\tif (!side) {\r\n\t\t\tside = Math.floor(this._free / this._gravity * size.gravity);\r\n\t\t}\r\n\t\tif (side > max) {\r\n\t\t\tside = max;\r\n\t\t}\r\n\t\tif (side < min) {\r\n\t\t\tside = min;\r\n\t\t}\r\n\t\treturn side;\r\n\t};\r\n\r\n\tLayout.prototype._configureBorders = function(){\r\n\t\tif(this.$root){\r\n\t\t\tthis._setBorders([\r\n\t\t\t\tthis._borders.left,\r\n\t\t\t\tthis._borders.top,\r\n\t\t\t\tthis._borders.right,\r\n\t\t\t\tthis._borders.bottom\r\n\t\t\t],\r\n\t\t\tthis);\r\n\t\t}\r\n\r\n\t\tvar borderClass = this._xLayout ? this._borders.right : this._borders.bottom;\r\n\r\n\t\tvar cells = this.$cells;\r\n\r\n\t\tvar lastVisibleIndex = cells.length - 1;\r\n\t\tfor(var i = lastVisibleIndex; i >= 0; i--){\r\n\t\t\tif (!cells[i].$config.hidden) {\r\n\t\t\t\tlastVisibleIndex = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (var i = 0; i < cells.length; i++) {\r\n\t\t\tif (cells[i].$config.hidden) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tvar lastCell = i >= lastVisibleIndex;\r\n\t\t\tvar borderColorClass = \"\";\r\n\t\t\tif(!lastCell && cells[i + 1]){\r\n\t\t\t\tif(cells[i + 1].$config.view == \"scrollbar\"){\r\n\t\t\t\t\tif(this._xLayout){\r\n\t\t\t\t\t\tlastCell = true;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tborderColorClass = \"gantt_layout_cell_border_transparent\";\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n\t\t\tthis._setBorders(lastCell ? [] : [borderClass, borderColorClass], cells[i]);\r\n\t\t}\r\n\t};\r\n\r\n\tLayout.prototype._updateCellVisibility = function(){\r\n\t\tvar oldVisibleCells = this._visibleCells || {};\r\n\t\tvar firstCall = !this._visibleCells;\r\n\t\tvar visibleCells = {};\r\n\t\tvar cell = null;\r\n\t\tvar parentVisibility = [];\r\n\t\tfor (var i = 0; i < this._sizes.length; i++) {\r\n\t\t\tcell = this.$cells[i];\r\n\t\t\tif (cell.$config.hide_empty){\r\n\t\t\t\tparentVisibility.push(cell);\r\n\t\t\t}\r\n\r\n\t\t\tif (!firstCall && cell.$config.hidden && oldVisibleCells[cell.$id]) {\r\n\t\t\t\tcell._hide(true);\r\n\t\t\t}else if(!cell.$config.hidden && !oldVisibleCells[cell.$id]){\r\n\t\t\t\tcell._hide(false);\r\n\t\t\t}\r\n\r\n\t\t\tif(!cell.$config.hidden){\r\n\t\t\t\tvisibleCells[cell.$id] = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._visibleCells = visibleCells;\r\n\r\n\t\t// GS-27. A way to hide the whole cell if all its children are hidden\r\n\t\tfor (var i = 0; i < parentVisibility.length; i++) {\r\n\t\t\tvar cell = parentVisibility[i];\r\n\t\t\tvar children = cell.$cells;\r\n\t\t\tvar hideCell = true;\r\n\t\t\tchildren.forEach(function(child){\r\n\t\t\t\tif (!child.$config.hidden && !child.$config.resizer){\r\n\t\t\t\t\thideCell = false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tcell.$config.hidden = hideCell;\r\n\t\t}\r\n\t};\r\n\r\n\tLayout.prototype.setSize = function (x, y) {\r\n\t\tthis._configureBorders();\r\n\t\t_super.prototype.setSize.call(this, x, y);\r\n\t\ty = this.$lastSize.contentY;\r\n\t\tx = this.$lastSize.contentX;\r\n\r\n\t\tvar padding = (this.$config.padding || 0);\r\n\t\tthis.$view.style.padding = padding + \"px\";\r\n\t\tthis._gravity = 0;\r\n\t\tthis._free = this._xLayout ? x : y;\r\n\t\tthis._free -= padding * 2;\r\n\t\t// calc all gravity\r\n\r\n\t\tvar cell,\r\n\t\t\tsize;\r\n\r\n\t\tthis._updateCellVisibility();\r\n\r\n\t\tfor (var i = 0; i < this._sizes.length; i++) {\r\n\t\t\tcell = this.$cells[i];\r\n\r\n\t\t\tif (cell.$config.hidden) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tvar margin = (this.$config.margin || 0);\r\n\t\t\tif(cell.$name == \"resizer\" && !margin){\r\n\t\t\t\tmargin = -1;\r\n\t\t\t}\r\n\r\n\t\t\t// set margins to child cell\r\n\t\t\tvar cellView = cell.$view;\r\n\r\n\t\t\tvar marginSide = this._xLayout ? \"marginRight\" : \"marginBottom\";\r\n\t\t\tif (i !== this.$cells.length - 1) {\r\n\t\t\t\tcellView.style[marginSide] = margin + \"px\";\r\n\t\t\t\tthis._free -= margin; // calc free space without margin\r\n\t\t\t}\r\n\t\t\tsize = this._sizes[i];\r\n\t\t\tif (this._xLayout) {\r\n\t\t\t\tif (!size.width) {\r\n\t\t\t\t\tthis._gravity += size.gravity;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (!size.height) {\r\n\t\t\t\t\tthis._gravity += size.gravity;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (var i = 0; i < this._sizes.length; i++) {\r\n\t\t\tcell = this.$cells[i];\r\n\r\n\t\t\tif (cell.$config.hidden) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tsize = this._sizes[i];\r\n\t\t\tvar width = size.width;\r\n\t\t\tvar height = size.height;\r\n\t\t\tif (this._xLayout) {\r\n\t\t\t\tthis._calcFreeSpace(width, size, true);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._calcFreeSpace(height, size, false);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\t\t\tcell = this.$cells[i];\r\n\r\n\t\t\tif (cell.$config.hidden) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tsize = this._sizes[i];\r\n\t\t\tvar dx = void 0;\r\n\t\t\tvar dy = void 0;\r\n\t\t\tif (this._xLayout) {\r\n\t\t\t\tdx = this._calcSize(size.width, size, true);\r\n\t\t\t\tdy = y - padding * 2; // layout height without paddings\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tdx = x - padding * 2; // layout width without paddings\r\n\t\t\t\tdy = this._calcSize(size.height, size, false);\r\n\t\t\t}\r\n\r\n\t\t\tcell.setSize(dx, dy);\r\n\t\t}\r\n\r\n\t};\r\n\r\n\treturn Layout;\r\n}(Cell));\r\n\r\nexport default Layout;","import __extends from \"../../../utils/extends\";\r\nimport Layout from \"./layout\";\r\nimport Cell from \"./cell\";\r\n\r\nvar ViewLayout = (function (_super) {\r\n\t\"use strict\";\r\n\r\n\t__extends(ViewLayout, _super);\r\n\tfunction ViewLayout(parent, config, factory) {\r\n\t\tvar _this = _super.apply(this, arguments) || this;\r\n\t\tfor (var i = 0; i < _this.$cells.length; i++) {\r\n\t\t\t_this.$cells[i].$config.hidden = (i !== 0);\r\n\t\t}\r\n\t\t_this.$cell = _this.$cells[0];\r\n\t\t_this.$name = \"viewLayout\";\r\n\r\n\t\treturn _this;\r\n\t}\r\n\tViewLayout.prototype.cell = function (id) {\r\n\t\tvar cell = _super.prototype.cell.call(this, id);\r\n\t\tif (!cell.$view) {\r\n\t\t\tthis.$fill(null, this);\r\n\t\t}\r\n\t\treturn cell;\r\n\t};\r\n\tViewLayout.prototype.moveView = function (view) {\r\n\t\tvar body = this.$view;\r\n\t\tif (this.$cell) {\r\n\t\t\tthis.$cell.$config.hidden = true;\r\n\t\t\tbody.removeChild(this.$cell.$view);\r\n\t\t}\r\n\t\tthis.$cell = view;\r\n\t\tbody.appendChild(view.$view);\r\n\t};\r\n\tViewLayout.prototype.setSize = function (x, y) {\r\n\t\tCell.prototype.setSize.call(this, x, y);\r\n\t};\r\n\r\n\tViewLayout.prototype.setContentSize = function(){\r\n\t\tvar size = this.$lastSize;\r\n\t\tthis.$cell.setSize(size.contentX, size.contentY);\r\n\t};\r\n\r\n\tViewLayout.prototype.getSize = function () {\r\n\t\tvar sizes = _super.prototype.getSize.call(this);\r\n\t\tif (this.$cell) {\r\n\t\t\tvar cellSize = this.$cell.getSize();\r\n\t\t\tif (this.$config.byMaxSize) {\r\n\t\t\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\t\t\t\t\tvar otherCell = this.$cells[i].getSize();\r\n\t\t\t\t\tfor (var cell in cellSize) {\r\n\t\t\t\t\t\tcellSize[cell] = Math.max(cellSize[cell], otherCell[cell]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (var size in sizes) {\r\n\t\t\t\tsizes[size] = sizes[size] || cellSize[size];\r\n\t\t\t}\r\n\t\t\tsizes.gravity = Math.max(sizes.gravity, cellSize.gravity);\r\n\t\t}\r\n\t\treturn sizes;\r\n\t};\r\n\treturn ViewLayout;\r\n}(Layout));\r\n\r\nexport default ViewLayout;","import __extends from \"../../../utils/extends\";\r\nimport * as utils from \"../../../utils/utils\";\r\nimport Cell from \"./cell\";\r\n\r\nvar ViewCell = (function (_super) {\r\n\t\"use strict\";\r\n\r\n\t__extends(ViewCell, _super);\r\n\tfunction ViewCell(parent, config, factory) {\r\n\r\n\t\tvar _this = _super.apply(this, arguments) || this;\r\n\r\n\t\tif(config.view){\r\n\t\t\tif(config.id){\r\n\t\t\t\t// pass id to the nested view\r\n\t\t\t\tthis.$id = utils.uid();\r\n\t\t\t}\r\n\t\t\tvar childConfig = utils.copy(config);\r\n\t\t\tdelete childConfig.config;\r\n\t\t\tdelete childConfig.templates;\r\n\r\n\t\t\tthis.$content = this.$factory.createView(config.view, this, childConfig, this);\r\n\t\t\tif(!this.$content)\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t_this.$name = \"viewCell\";\r\n\t\treturn _this;\r\n\t}\r\n\r\n\tViewCell.prototype.destructor = function(){\r\n\t\tthis.clear();\r\n\t\t_super.prototype.destructor.call(this);\r\n\t};\r\n\r\n\tViewCell.prototype.clear = function(){\r\n\r\n\t\tthis.$initialized = false;\r\n\r\n\t\t// call destructor\r\n\t\tif (this.$content){\r\n\t\t\tvar method = this.$content.unload || this.$content.destructor;\r\n\t\t\tif (method){\r\n\t\t\t\tmethod.call(this.$content);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t_super.prototype.clear.call(this);\r\n\r\n\t};\r\n\r\n\tViewCell.prototype.scrollTo = function(left, top){\r\n\r\n\t\tif(this.$content && this.$content.scrollTo){\r\n\t\t\tthis.$content.scrollTo(left, top);\r\n\t\t}else{\r\n\t\t\t_super.prototype.scrollTo.call(this, left, top);\r\n\t\t}\r\n\t};\r\n\r\n\tViewCell.prototype._setContentSize = function(x, y){\r\n\t\tvar borders = this._getBorderSizes();\r\n\t\tif(typeof x === \"number\"){\r\n\t\t\tvar outerX = x + borders.horizontal;\r\n\t\t\tthis.$config.width = outerX;\r\n\t\t}\r\n\t\tif(typeof y === \"number\"){\r\n\t\t\tvar outerY = y + borders.vertical;\r\n\t\t\tthis.$config.height = outerY;\r\n\t\t}\r\n\t};\r\n\r\n\tViewCell.prototype.setSize = function(x, y){\r\n\t\t_super.prototype.setSize.call(this, x, y);\r\n\r\n\t\tif(!this.$preResize && this.$content) {\r\n\t\t\tif (!this.$initialized) {\r\n\t\t\t\tthis.$initialized = true;\r\n\t\t\t\tvar header = this.$view.childNodes[0];\r\n\t\t\t\tvar content = this.$view.childNodes[1];\r\n\t\t\t\tif(!content) content = header;\r\n\r\n\t\t\t\t/*if(this.$content.$config){\r\n\t\t\t\t\tthis.$content.$config.width = this.$lastSize.contentX;\r\n\t\t\t\t\tthis.$content.$config.height = this.$lastSize.contentY;\r\n\t\t\t\t}*/\r\n\t\t\t\tthis.$content.init(content);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tViewCell.prototype.setContentSize = function(){\r\n\t\tif(!this.$preResize && this.$content) {\r\n\t\t\tif (this.$initialized) {\r\n\t\t\t\tthis.$content.setSize(this.$lastSize.contentX, this.$lastSize.contentY);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tViewCell.prototype.getContentSize = function(){\r\n\t\tvar size = _super.prototype.getContentSize.call(this);\r\n\r\n\t\tif(this.$content && this.$initialized){\r\n\t\t\tvar childSize = this.$content.getSize();\r\n\t\t\tsize.width = childSize.contentX === undefined ? childSize.width : childSize.contentX;\r\n\t\t\tsize.height = childSize.contentY === undefined ? childSize.height : childSize.contentY;\r\n\t\t}\r\n\r\n\t\tvar borders = this._getBorderSizes();\r\n\t\tsize.width += borders.horizontal;\r\n\t\tsize.height += borders.vertical;\r\n\r\n\t\treturn size;\r\n\t};\r\n\r\n\treturn ViewCell;\r\n}(Cell));\r\n\r\nexport default ViewCell;","export default null;","import __extends from \"../../../utils/extends\";\r\nimport * as domHelpers from \"../utils/dom_helpers\";\r\nimport * as utils from \"../../../utils/utils\";\r\nimport env from \"../../../utils/env\";\r\nimport Cell from \"./cell\";\r\n\r\nvar ScrollbarCell = (function (_super) {\r\n\t\"use strict\";\r\n\r\n\tvar SCROLL_MODIFIER_KEYS = [\"altKey\", \"shiftKey\", \"metaKey\"]; // it's no way to disable ctrl+wheel\r\n\t__extends(ScrollbarCell, _super);\r\n\tfunction ScrollbarCell(parent, config, factory, gantt) {\r\n\r\n\t\tvar _this = _super.apply(this, arguments) || this;\r\n\t\tthis.$config = utils.mixin(config, {scroll: \"x\"});\r\n\t\t_this._scrollHorizontalHandler = utils.bind(_this._scrollHorizontalHandler, _this);\r\n\t\t_this._scrollVerticalHandler = utils.bind(_this._scrollVerticalHandler, _this);\r\n\t\t_this._outerScrollVerticalHandler = utils.bind(_this._outerScrollVerticalHandler, _this);\r\n\t\t_this._outerScrollHorizontalHandler = utils.bind(_this._outerScrollHorizontalHandler, _this);\r\n\t\t_this._mouseWheelHandler = utils.bind(_this._mouseWheelHandler, _this);\r\n\r\n\t\tthis.$config.hidden = true;\r\n\t\tvar size = gantt.config.scroll_size;\r\n\r\n\t\tif(gantt.env.isIE){\r\n\t\t\t// full element height/width must be bigger than just a browser scrollbar,\r\n\t\t\t// otherwise the scrollbar element won't be scrolled on click\r\n\t\t\tsize += 1;\r\n\t\t}\r\n\r\n\t\tif(this._isHorizontal()){\r\n\t\t\t_this.$config.height = size;\r\n\t\t\t_this.$parent.$config.height = size;\r\n\t\t}else{\r\n\t\t\t_this.$config.width = size;\r\n\t\t\t_this.$parent.$config.width = size;\r\n\t\t}\r\n\r\n\t\tthis.$config.scrollPosition = 0;\r\n\r\n\t\t_this.$name = \"scroller\";\r\n\t\treturn _this;\r\n\t}\r\n\r\n\tScrollbarCell.prototype.init = function(container){\r\n\t\tcontainer.innerHTML = this.$toHTML();\r\n\t\tthis.$view = container.firstChild;\r\n\r\n\t\tif(!this.$view){\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t\tif(this._isVertical()){\r\n\t\t\tthis._initVertical();\r\n\t\t}else{\r\n\t\t\tthis._initHorizontal();\r\n\t\t}\r\n\t\tthis._initMouseWheel();\r\n\t\tthis._initLinkedViews();\r\n\t};\r\n\r\n\tScrollbarCell.prototype.$toHTML = function () {\r\n\t\tvar className = this._isHorizontal() ? \"gantt_hor_scroll\" : \"gantt_ver_scroll\";\r\n\t\treturn \"<div class='gantt_layout_cell \"+className+\"'><div style='\"+(this._isHorizontal() ? \"width:2000px\" : \"height:2000px\")+\"'></div></div>\";\r\n\t};\r\n\r\n\tScrollbarCell.prototype._getRootParent = function(){\r\n\t\tvar parent = this.$parent;\r\n\t\twhile(parent && parent.$parent){\r\n\t\t\tparent = parent.$parent;\r\n\t\t}\r\n\t\tif(parent){\r\n\t\t\treturn parent;\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tfunction eachCell(root, res){\r\n\t\tres.push(root);\r\n\t\tif(root.$cells){\r\n\t\t\tfor(var i = 0; i < root.$cells.length; i++){\r\n\t\t\t\teachCell(root.$cells[i], res);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tScrollbarCell.prototype._eachView = function(){\r\n\t\tvar res = [];\r\n\t\teachCell(this._getRootParent(), res);\r\n\t\treturn res;\r\n\t};\r\n\r\n\tScrollbarCell.prototype._getLinkedViews = function(){\r\n\t\tvar views = this._eachView();\r\n\t\tvar res = [];\r\n\t\tfor(var i = 0; i < views.length; i++){\r\n\t\t\tif(views[i].$config && ((this._isVertical() && views[i].$config.scrollY == this.$id) || (this._isHorizontal() && views[i].$config.scrollX == this.$id)) ){\r\n\t\t\t\tres.push(views[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn res;\r\n\t};\r\n\r\n\r\n\tScrollbarCell.prototype._initHorizontal = function(){\r\n\t\tthis.$scroll_hor = this.$view;\r\n\t\tthis.$domEvents.attach(this.$view, \"scroll\", this._scrollHorizontalHandler);\r\n\r\n\t};\r\n\r\n\tScrollbarCell.prototype._initLinkedViews = function(){\r\n\t\tvar views = this._getLinkedViews();\r\n\t\tvar css = this._isVertical() ?\"gantt_layout_outer_scroll gantt_layout_outer_scroll_vertical\" : \"gantt_layout_outer_scroll gantt_layout_outer_scroll_horizontal\";\r\n\t\tfor(var i = 0; i < views.length; i++){\r\n\t\t\t//views[i].$config.css = [views[i].$config.css || \"\", css].join(\" \");\r\n\t\t\tdomHelpers.addClassName(views[i].$view || views[i].getNode(), css);\r\n\t\t}\r\n\t};\r\n\r\n\tScrollbarCell.prototype._initVertical = function(){\r\n\t\tthis.$scroll_ver = this.$view;\r\n\t\tthis.$domEvents.attach(this.$view, \"scroll\", this._scrollVerticalHandler);\r\n\t};\r\n\r\n\tScrollbarCell.prototype._updateLinkedViews = function(){\r\n\t};\r\n\r\n\tScrollbarCell.prototype._initMouseWheel = function(){\r\n\t\tvar ff = env.isFF;\r\n\t\tif (ff)\r\n\t\t\tthis.$domEvents.attach(this._getRootParent().$view, \"wheel\", this._mouseWheelHandler, {passive: false});\r\n\t\telse\r\n\t\t\tthis.$domEvents.attach(this._getRootParent().$view, \"mousewheel\", this._mouseWheelHandler, {passive: false});\r\n\t};\r\n\r\n\r\n\r\n\r\n\tScrollbarCell.prototype.scrollHorizontally = function(left){\r\n\t\tif(this._scrolling) return;\r\n\t\tthis._scrolling = true;\r\n\r\n\t\tthis.$scroll_hor.scrollLeft = left;\r\n\t\tthis.$config.codeScrollLeft = left;\r\n\t\tleft = this.$scroll_hor.scrollLeft;\r\n\r\n\t\tvar views = this._getLinkedViews();\r\n\t\tfor(var i = 0; i < views.length; i++){\r\n\t\t\tif(views[i].scrollTo){\r\n\t\t\t\tviews[i].scrollTo(left, undefined);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar oldSize = this.$config.scrollPosition;\r\n\t\tthis.$config.scrollPosition = left;\r\n\t\tthis.callEvent(\"onScroll\", [oldSize, left, this.$config.scroll]);\r\n\t\tthis._scrolling = false;\r\n\t};\r\n\tScrollbarCell.prototype.scrollVertically = function(top){\r\n\t\tif(this._scrolling) return;\r\n\t\tthis._scrolling = true;\r\n\r\n\t\tthis.$scroll_ver.scrollTop = top;\r\n\t\ttop = this.$scroll_ver.scrollTop;\r\n\r\n\t\tvar views = this._getLinkedViews();\r\n\r\n\t\tfor(var i = 0; i < views.length; i++){\r\n\t\t\tif(views[i].scrollTo){\r\n\t\t\t\tviews[i].scrollTo(undefined, top);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar oldSize = this.$config.scrollPosition;\r\n\t\tthis.$config.scrollPosition = top;\r\n\t\tthis.callEvent(\"onScroll\", [oldSize, top, this.$config.scroll]);\r\n\t\tthis._scrolling = false;\r\n\t};\r\n\r\n\tScrollbarCell.prototype._isVertical = function(){\r\n\t\treturn this.$config.scroll == \"y\";\r\n\t};\r\n\tScrollbarCell.prototype._isHorizontal = function(){\r\n\t\treturn this.$config.scroll == \"x\";\r\n\t};\r\n\tScrollbarCell.prototype._scrollHorizontalHandler = function (e) {\r\n\t\tif(this._isVertical() || this._scrolling){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//in safari we can catch previous onscroll after setting new value from mouse-wheel event\r\n\t\t//set delay to prevent value drifiting\r\n\t\tif ((new Date()) - ( this._wheel_time || 0 ) < 100) return true;\r\n\t\t//if (this.$gantt._touch_scroll_active) return;\r\n\t\tvar left = this.$scroll_hor.scrollLeft;\r\n\r\n\t\tthis.scrollHorizontally(left);\r\n\r\n\t\tthis._oldLeft = this.$scroll_hor.scrollLeft;\r\n\t};\r\n\tScrollbarCell.prototype._outerScrollHorizontalHandler = function(e){\r\n\t\tif(this._isVertical()){\r\n\t\t\treturn;\r\n\t\t}\r\n\t};\r\n\r\n\tScrollbarCell.prototype.show = function(){\r\n\t\tthis.$parent.show();\r\n\t};\r\n\tScrollbarCell.prototype.hide = function(){\r\n\t\tthis.$parent.hide();\r\n\t};\r\n\r\n\tScrollbarCell.prototype._getScrollSize = function(){\r\n\t\tvar scrollSize = 0;\r\n\t\tvar outerSize = 0;\r\n\t\tvar isHorizontal = this._isHorizontal();\r\n\r\n\t\tvar linked = this._getLinkedViews();\r\n\t\tvar view;\r\n\t\tvar scrollProperty = isHorizontal ? \"scrollWidth\" : \"scrollHeight\",\r\n\t\t\tinnerSizeProperty = isHorizontal ? \"contentX\" : \"contentY\";\r\n\t\tvar outerProperty = isHorizontal ? \"x\" : \"y\";\r\n\t\tvar offset = this._getScrollOffset();\r\n\r\n\t\tfor(var i = 0; i < linked.length; i++){\r\n\t\t\tview = linked[i];\r\n\t\t\tif(!(view && view.$content && view.$content.getSize && !view.$config.hidden)) continue;\r\n\r\n\t\t\tvar sizes = view.$content.getSize();\r\n\t\t\tvar cellScrollSize;\r\n\t\t\tif(sizes.hasOwnProperty(scrollProperty)){\r\n\t\t\t\tcellScrollSize = sizes[scrollProperty];\r\n\t\t\t}else{\r\n\t\t\t\tcellScrollSize = sizes[innerSizeProperty];\r\n\t\t\t}\r\n\r\n\t\t\tif(offset){\r\n\t\t\t\t// precalculated vertical/horizontal offsets of scrollbar to emulate 4.x look\r\n\t\t\t\tif(sizes[innerSizeProperty] > sizes[outerProperty] && sizes[innerSizeProperty] > scrollSize && (cellScrollSize > (sizes[outerProperty] - offset + 2))){\r\n\t\t\t\t\tscrollSize = cellScrollSize + (isHorizontal ? 0 : 2);\r\n\t\t\t\t\touterSize = sizes[outerProperty];\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tvar nonScrollableSize = Math.max(sizes[innerSizeProperty] - cellScrollSize, 0);\r\n\t\t\t\tvar scrollableViewPortSize = Math.max(sizes[outerProperty] - nonScrollableSize, 0);\r\n\t\t\t\tcellScrollSize = cellScrollSize + nonScrollableSize;\r\n\r\n\t\t\t\tif(cellScrollSize > scrollableViewPortSize && (cellScrollSize > scrollSize) ){\r\n\t\t\t\t\t//|| (cellScrollSize === scrollSize && sizes[outerProperty] < outerSize) // same scroll width but smaller scrollable view port\r\n\r\n\t\t\t\t\tscrollSize = cellScrollSize;\r\n\t\t\t\t\touterSize = sizes[outerProperty];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\touterScroll: outerSize,\r\n\t\t\tinnerScroll: scrollSize\r\n\t\t};\r\n\t};\r\n\r\n\tScrollbarCell.prototype.scroll = function(position){\r\n\t\tif(this._isHorizontal()){\r\n\t\t\tthis.scrollHorizontally(position);\r\n\t\t}else{\r\n\t\t\tthis.scrollVertically(position);\r\n\t\t}\r\n\t};\r\n\r\n\tScrollbarCell.prototype.getScrollState = function(){\r\n\t\treturn {\r\n\t\t\tvisible: this.isVisible(),\r\n\t\t\tdirection: this.$config.scroll,\r\n\t\t\tsize: this.$config.outerSize,\r\n\t\t\tscrollSize: this.$config.scrollSize || 0,\r\n\t\t\tposition: this.$config.scrollPosition || 0\r\n\t\t};\r\n\t};\r\n\r\n\tScrollbarCell.prototype.setSize = function(width, height){\r\n\t\t_super.prototype.setSize.apply(this, arguments);\r\n\r\n\t\tvar scrollSizes = this._getScrollSize();\r\n\r\n\t\tvar ownSize = (this._isVertical() ? height : width) - this._getScrollOffset() + (this._isHorizontal() ? 1 : 0);\r\n\r\n\t\tif(scrollSizes.innerScroll && ownSize > scrollSizes.outerScroll){\r\n\t\t\tscrollSizes.innerScroll += (ownSize - scrollSizes.outerScroll);\r\n\t\t}\r\n\t\tthis.$config.scrollSize = scrollSizes.innerScroll;\r\n\r\n\t\tthis.$config.width = width;\r\n\t\tthis.$config.height = height;\r\n\t\tthis._setScrollSize(scrollSizes.innerScroll);\r\n\t};\r\n\r\n\tScrollbarCell.prototype.isVisible = function(){\r\n\t\treturn !!(this.$parent && this.$parent.$view.parentNode);\r\n\t};\r\n\r\n\tScrollbarCell.prototype.shouldShow = function(){\r\n\t\tvar scrollSizes = this._getScrollSize();\r\n\t\tif(!scrollSizes.innerScroll && (this.$parent && this.$parent.$view.parentNode)){\r\n\t\t\treturn false;\r\n\t\t}else if(scrollSizes.innerScroll && !(this.$parent && this.$parent.$view.parentNode)){\r\n\t\t\treturn true;\r\n\t\t}else{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t};\r\n\r\n\tScrollbarCell.prototype.shouldHide = function(){\r\n\t\tvar scrollSizes = this._getScrollSize();\r\n\t\tif(!scrollSizes.innerScroll && (this.$parent && this.$parent.$view.parentNode)){\r\n\t\t\treturn true;\r\n\t\t}else{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tScrollbarCell.prototype.toggleVisibility = function(){\r\n\t\tif(this.shouldHide()){\r\n\t\t\tthis.hide();\r\n\t\t}else if(this.shouldShow()){\r\n\t\t\tthis.show();\r\n\t\t}\r\n\t};\r\n\r\n\tScrollbarCell.prototype._getScaleOffset = function(view){\r\n\t\tvar offset = 0;\r\n\t\tif(view && (view.$config.view == \"timeline\" || view.$config.view == \"grid\")){\r\n\t\t\toffset = view.$content.$getConfig().scale_height;\r\n\t\t}\r\n\t\treturn offset;\r\n\t};\r\n\r\n\tScrollbarCell.prototype._getScrollOffset = function(){\r\n\t\tvar offset = 0;\r\n\t\tif(this._isVertical()){\r\n\t\t\tvar parentLayout = this.$parent.$parent;\r\n\t\t\toffset = Math.max(\r\n\t\t\t\tthis._getScaleOffset(parentLayout.getPrevSibling(this.$parent.$id)),\r\n\t\t\t\tthis._getScaleOffset(parentLayout.getNextSibling(this.$parent.$id))\r\n\t\t\t\t);\r\n\t\t}else{\r\n\t\t\tvar linked = this._getLinkedViews();\r\n\r\n\t\t\tfor (var i = 0; i < linked.length; i++) {\r\n\t\t\t\tvar view = linked[i],\r\n\t\t\t\t\tvparent = view.$parent;\r\n\t\t\t\tvar cells = vparent.$cells;\r\n\r\n\t\t\t\tvar last = cells[cells.length - 1];\r\n\r\n\t\t\t\tif (last && last.$config.view == \"scrollbar\" && last.$config.hidden === false) {\r\n\t\t\t\t\toffset = last.$config.width;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn offset || 0;\r\n\t};\r\n\r\n\tScrollbarCell.prototype._setScrollSize = function(size){\r\n\t\tvar property = this._isHorizontal() ? \"width\" : \"height\";\r\n\t\tvar scrollbar = this._isHorizontal() ? this.$scroll_hor : this.$scroll_ver;\r\n\r\n\t\tvar offset = this._getScrollOffset();\r\n\r\n\t\tvar node = scrollbar.firstChild;\r\n\r\n\t\tif(offset){\r\n\t\t\tif(this._isVertical()){\r\n\r\n\t\t\t\tthis.$config.outerSize = (this.$config.height - offset + 3);\r\n\t\t\t\tscrollbar.style.height = this.$config.outerSize + \"px\";\r\n\t\t\t\tscrollbar.style.top = (offset-1) + \"px\";\r\n\t\t\t\tdomHelpers.addClassName(scrollbar, this.$parent._borders.top);\r\n\t\t\t\tdomHelpers.addClassName(scrollbar.parentNode, \"gantt_task_vscroll\");\r\n\t\t\t}else{\r\n\t\t\t\tthis.$config.outerSize = (this.$config.width - offset + 1);\r\n\t\t\t\tscrollbar.style.width = this.$config.outerSize + \"px\";\r\n\t\t\t\t//domHelpers.addClassName(scrollbar, this.$parent._borders.right);\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tscrollbar.style.top = \"auto\";\r\n\t\t\tdomHelpers.removeClassName(scrollbar, this.$parent._borders.top);\r\n\t\t\tdomHelpers.removeClassName(scrollbar.parentNode, \"gantt_task_vscroll\");\r\n\t\t\tthis.$config.outerSize = this.$config.height;\r\n\t\t}\r\n\r\n\t\tnode.style[property] = size + \"px\";\r\n\t};\r\n\r\n\tScrollbarCell.prototype._scrollVerticalHandler = function (e) {\r\n\t\tif(this._scrollHorizontalHandler() || this._scrolling){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//if (this.$gantt._touch_scroll_active) return;\r\n\t\tvar top = this.$scroll_ver.scrollTop;\r\n\t\tvar prev = this._oldTop;\r\n\t\tif(top == prev) return;\r\n\r\n\t\tthis.scrollVertically(top);\r\n\r\n\t\tthis._oldTop = this.$scroll_ver.scrollTop;\r\n\r\n\t};\r\n\tScrollbarCell.prototype._outerScrollVerticalHandler = function(e){\r\n\t\tif(this._scrollHorizontalHandler()){\r\n\t\t\treturn;\r\n\t\t}\r\n\t};\r\n\r\n\tScrollbarCell.prototype._checkWheelTarget = function(targetNode){\r\n\t\tvar connectedViews = this._getLinkedViews().concat(this);\r\n\r\n\t\tfor(var i = 0; i < connectedViews.length; i++){\r\n\t\t\tvar node = connectedViews[i].$view;\r\n\t\t\tif(domHelpers.isChildOf(targetNode, node)){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t};\r\n\r\n\tScrollbarCell.prototype._mouseWheelHandler = function(e){\r\n\t\tvar target = e.target || e.srcElement;\r\n\r\n\t\tif(!this._checkWheelTarget(target))\r\n\t\t\treturn;\r\n\r\n\t\tthis._wheel_time = new Date();\r\n\r\n\t\tvar res = {};\r\n\r\n\t\tvar wheelSpeed = {x: 1, y: 1};\r\n\t\tvar wheelSpeedConfig = this.$gantt.config.wheel_scroll_sensitivity;\r\n\r\n\t\tif (typeof wheelSpeedConfig == \"number\" && !!wheelSpeedConfig) {\r\n\t\t\twheelSpeed = {x: wheelSpeedConfig, y: wheelSpeedConfig};\r\n\t\t}\r\n\t\telse if (({}).toString.apply(wheelSpeedConfig) == \"[object Object]\") {\r\n\t\t\twheelSpeed = {x: wheelSpeedConfig.x, y: wheelSpeedConfig.y};\r\n\t\t}\r\n\r\n\t\tvar ff = env.isFF;\r\n\t\tvar deltaX = ff ? (e.deltaX) : e.wheelDeltaX;\r\n\t\tvar deltaY = ff ? (e.deltaY) : e.wheelDelta;\r\n\r\n\t\tvar multiplier = -20;\r\n\t\tif (ff) {\r\n\t\t\t// GS-1500. Firefox had many changes during the versions\r\n\t\t\tconst version = parseInt(navigator.userAgent.split(\"Firefox/\")[1]);\r\n\t\t\tif (version <= 87){\r\n\t\t\t\tif (e.deltaMode !== 0) {\r\n\t\t\t\t\tmultiplier = -40;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmultiplier = -10;\r\n\t\t\t\t}\r\n\t\t\t} else if (version <= 90){\r\n\t\t\t\tmultiplier = -3;\r\n\t\t\t} else if (version <= 96){\r\n\t\t\t\tmultiplier = -1.5;\r\n\t\t\t} else {\r\n\t\t\t\tmultiplier = -1;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar wx = ff ? (deltaX * multiplier * wheelSpeed.x) : deltaX * 2 * wheelSpeed.x;\r\n\t\tvar wy = ff ? (deltaY * multiplier * wheelSpeed.y) : deltaY * wheelSpeed.y;\r\n\r\n\t\tvar horizontalScrollModifier = this.$gantt.config.horizontal_scroll_key;\r\n\r\n\t\tif (horizontalScrollModifier !== false) {\r\n\t\t\tif (SCROLL_MODIFIER_KEYS.indexOf(horizontalScrollModifier) >= 0) {\r\n\t\t\t\tif(e[horizontalScrollModifier] && !(e.deltaX || e.wheelDeltaX)){\r\n\t\t\t\t\t// shift+mousewheel for horizontal scroll\r\n\t\t\t\t\twx = wy*2;\r\n\t\t\t\t\twy = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tif (wx && Math.abs(wx) > Math.abs(wy)){\r\n\t\t\tif(this._isVertical()){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(res.x) return true;//no horisontal scroll, must not block scrolling\r\n\t\t\tif(!this.$scroll_hor || !this.$scroll_hor.offsetWidth) return true;\r\n\r\n\t\t\tvar dir  = wx/-40;\r\n\t\t\tvar oldLeft = this._oldLeft;\r\n\t\t\tvar left = oldLeft+dir*30;\r\n\t\t\tthis.scrollHorizontally(left);\r\n\t\t\tthis.$scroll_hor.scrollLeft = left;\r\n\t\t\t// not block scroll if position hasn't changed\r\n\t\t\tif(oldLeft == this.$scroll_hor.scrollLeft){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tthis._oldLeft = this.$scroll_hor.scrollLeft;\r\n\t\t} else {\r\n\t\t\tif(this._isHorizontal()){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(res.y) return true;//no vertical scroll, must not block scrolling\r\n\t\t\tif(!this.$scroll_ver || !this.$scroll_ver.offsetHeight) return true;\r\n\r\n\t\t\tvar dir  = wy/-40;\r\n\t\t\tif (typeof wy == \"undefined\")\r\n\t\t\t\tdir = e.detail;\r\n\r\n\t\t\tvar oldTop = this._oldTop;\r\n\t\t\tvar top = this.$scroll_ver.scrollTop+dir*30;\r\n\r\n\t\t\t//if(!this.$gantt.config.prevent_default_scroll &&\r\n\t\t\t//\t(this.$gantt._cached_scroll_pos && ((this.$gantt._cached_scroll_pos.y == top) || (this.$gantt._cached_scroll_pos.y <= 0 && top <= 0)))) return true;\r\n\r\n\r\n\t\t\tthis.scrollVertically(top);\r\n\t\t\tthis.$scroll_ver.scrollTop = top;\r\n\r\n\t\t\t// not block scroll if position hasn't changed\r\n\t\t\tif(oldTop == this.$scroll_ver.scrollTop){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tthis._oldTop = this.$scroll_ver.scrollTop;\r\n\t\t}\r\n\r\n\t\tif (e.preventDefault)\r\n\t\t\te.preventDefault();\r\n\t\te.cancelBubble=true;\r\n\t\treturn false;\r\n\t};\r\n\r\n\treturn ScrollbarCell;\r\n})(Cell);\r\n\r\nexport default ScrollbarCell;","function createHelper(view){\r\n\tvar cachedRowHeight = -1;\r\n\tvar canUseSimpleCalc = -1;\r\n\treturn {\r\n\t\tresetCache: function(){\r\n\t\t\tcachedRowHeight = -1;\r\n\t\t\tcanUseSimpleCalc = -1;\r\n\t\t},\r\n\t\t_getRowHeight: function(){\r\n\t\t\tif(cachedRowHeight === -1){\r\n\t\t\t\tcachedRowHeight = view.$getConfig().row_height;\r\n\t\t\t}\r\n\t\t\treturn cachedRowHeight;\r\n\t\t},\r\n\t\t_refreshState: function(){\r\n\t\t\tthis.resetCache();\r\n\t\t\tcanUseSimpleCalc = true;\r\n\t\t\tvar store = view.$config.rowStore;\r\n\t\t\tif(!store){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar globalRowHeight = this._getRowHeight();\r\n\t\t\tfor (var i=0; i<store.fullOrder.length; i++) {\r\n\t\t\t\tvar item = store.getItem(store.fullOrder[i]);\r\n\t\t\t\t// GS-1491: ignore the task when it is filtered:\r\n\t\t\t\tif (!item) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif(item.row_height && item.row_height !== globalRowHeight){\r\n\t\t\t\t\tcanUseSimpleCalc = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n\t\t},\r\n\t\tcanUseSimpleCalculation: function(){\r\n\t\t\tif(canUseSimpleCalc === -1){\r\n\t\t\t\tthis._refreshState();\r\n\t\t\t}\r\n\t\t\treturn canUseSimpleCalc;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get top coordinate by row index (order)\r\n\t\t * @param {number} index\r\n\t\t */\r\n\t\tgetRowTop: function(index){\r\n\t\t\tvar store = view.$config.rowStore;\r\n\t\t\tif(!store){\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t\treturn index * this._getRowHeight();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get height of the item by item id\r\n\t\t * @param {*} itemId\r\n\t\t */\r\n\t\tgetItemHeight: function (itemId) {\r\n\t\t\treturn this._getRowHeight();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get total height of items\r\n\t\t */\r\n\t\tgetTotalHeight: function () {\r\n\t\t\tif(view.$config.rowStore){\r\n\t\t\t\tvar store = view.$config.rowStore;\r\n\t\t\t\treturn store.countVisible() * this._getRowHeight();\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get item by top position\r\n\t\t * @param {*} top\r\n\t\t */\r\n\t\tgetItemIndexByTopPosition: function (top) {\r\n\t\t\tif(view.$config.rowStore){\r\n\t\t\t\treturn Math.floor(top / this._getRowHeight());\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default createHelper;","import quickPositionHelperFactory from \"./row_position_fixed_height\";\r\n\r\nfunction createMixin(view){\r\n\tvar getItemTopCache = {};\r\n\tvar getRowTopCache = {};\r\n\tvar getItemHeightCache = null;\r\n\tvar totalHeightCache = -1;\r\n\tvar getItemHeightCacheState = null;\r\n\r\n\tvar quickPosition = quickPositionHelperFactory(view);\r\n\r\n\treturn {\r\n\t\t_resetTopPositionHeight: function(){\r\n\t\t\tgetItemTopCache = {};\r\n\t\t\tgetRowTopCache = {};\r\n\t\t\tquickPosition.resetCache();\r\n\t\t},\r\n\t\t_resetHeight: function(){\r\n\t\t\tvar store = this.$config.rowStore;\r\n\t\t\tvar newState = this.getCacheStateTotalHeight(store);\r\n\t\t\tif(!getItemHeightCacheState){\r\n\t\t\t\tgetItemHeightCacheState = newState;\r\n\t\t\t}else if(this.shouldClearHeightCache(getItemHeightCacheState, newState)){\r\n\t\t\t\tgetItemHeightCacheState = newState;\r\n\t\t\t\tgetItemHeightCache = null;\r\n\t\t\t}\r\n\r\n\t\t\ttotalHeightCache = -1;\r\n\t\t\tquickPosition.resetCache();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get top coordinate by row index (order)\r\n\t\t * @param {number} index\r\n\t\t */\r\n\t\tgetRowTop: function(index){\r\n\t\t\tif(quickPosition.canUseSimpleCalculation()){\r\n\t\t\t\treturn quickPosition.getRowTop(index);\r\n\t\t\t}\r\n\r\n\t\t\tvar store = this.$config.rowStore;\r\n\t\t\tif(!store){\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t\tif(getRowTopCache[index] !== undefined){\r\n\t\t\t\treturn getRowTopCache[index];\r\n\t\t\t}else {\r\n\t\t\t\tvar all = store.getIndexRange();\r\n\t\t\t\tvar top = 0;\r\n\t\t\t\tvar result = 0;\r\n\t\t\t\tfor(var i = 0; i < all.length; i++){\r\n\t\t\t\t\tgetRowTopCache[i] = top;\r\n\t\t\t\t\ttop += this.getItemHeight(all[i].id);\r\n\t\t\t\t\tif(i < index){\r\n\t\t\t\t\t\tresult = top;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get top coordinate by item id\r\n\t\t * @param {*} task_id\r\n\t\t */\r\n\t\tgetItemTop: function (taskId) {\r\n\t\t\tif(this.$config.rowStore){\r\n\t\t\t\tif(getItemTopCache[taskId] !== undefined){\r\n\t\t\t\t\treturn getItemTopCache[taskId];\r\n\t\t\t\t}\r\n\t\t\t\tvar store = this.$config.rowStore;\r\n\t\t\t\tif(!store) return 0;\r\n\r\n\t\t\t\tvar itemIndex = store.getIndexById(taskId);\r\n\r\n\t\t\t\tif (itemIndex === -1 && store.getParent && store.exists(taskId)) {\r\n\t\t\t\t\tvar parentId = store.getParent(taskId);\r\n\t\t\t\t\tif (store.exists(parentId)) {\r\n\t\t\t\t\t\t// if task is not found in list - maybe it's parent is a split task and we should use parents index instead\r\n\t\t\t\t\t\tvar parent = store.getItem(parentId);\r\n\t\t\t\t\t\tif (this.$gantt.isSplitTask(parent)) {\r\n\t\t\t\t\t\t\treturn this.getItemTop(parentId);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tgetItemTopCache[taskId] = this.getRowTop(itemIndex);\r\n\t\t\t\treturn getItemTopCache[taskId];\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get height of the item by item id\r\n\t\t * @param {*} itemId\r\n\t\t */\r\n\t\tgetItemHeight: function (itemId) {\r\n\t\t\tif(quickPosition.canUseSimpleCalculation()){\r\n\t\t\t\treturn quickPosition.getItemHeight(itemId);\r\n\t\t\t}\r\n\r\n\t\t\tif(!getItemHeightCache && this.$config.rowStore){\r\n\t\t\t\tthis._fillHeightCache(this.$config.rowStore);\r\n\t\t\t}\r\n\r\n\t\t\tif(getItemHeightCache[itemId] !== undefined){\r\n\t\t\t\treturn getItemHeightCache[itemId];\r\n\t\t\t}\r\n\r\n\t\t\tvar defaultHeight = this.$getConfig().row_height;\r\n\r\n\t\t\tif(this.$config.rowStore){\r\n\t\t\t\tvar store = this.$config.rowStore;\r\n\t\t\t\tif(!store) return defaultHeight;\r\n\r\n\t\t\t\tvar item = store.getItem(itemId);\r\n\r\n\t\t\t\treturn getItemHeightCache[itemId] = item && item.row_height || defaultHeight;\r\n\t\t\t}else{\r\n\t\t\t\treturn defaultHeight;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_fillHeightCache: function(store){\r\n\t\t\tif(!store){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tgetItemHeightCache = {};\r\n\t\t\tvar defaultHeight = this.$getConfig().row_height;\r\n\t\t\tstore.eachItem(function(item){\r\n\t\t\t\treturn getItemHeightCache[item.id] = item && item.row_height || defaultHeight;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetCacheStateTotalHeight: function(store){\r\n\r\n\t\t\tvar globalHeight = this.$getConfig().row_height;\r\n\t\t\tvar itemHeightCache = {};\r\n\t\t\tvar items = [];\r\n\t\t\tvar sumHeight = 0;\r\n\t\t\tif(store){\r\n\t\t\t\tstore.eachItem(function(item){\r\n\t\t\t\t\titems.push(item);\r\n\t\t\t\t\titemHeightCache[item.id] = item.row_height;\r\n\t\t\t\t\tsumHeight += item.row_height || globalHeight;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\r\n\t\t\treturn {\r\n\t\t\t\tglobalHeight: globalHeight,\r\n\t\t\t\titems: items,\r\n\t\t\t\tcount: items.length,\r\n\t\t\t\tsumHeight: sumHeight\r\n\t\t\t};\r\n\t\t},\r\n\t\tshouldClearHeightCache: function(oldState, newState){\r\n\r\n\t\t\tif(oldState.count != newState.count){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif(oldState.globalHeight != newState.globalHeight){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tif(oldState.sumHeight != newState.sumHeight){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tfor(var i in oldState.items){\r\n\t\t\t\tvar newValue = newState.items[i];\r\n\t\t\t\tif(newValue !== undefined && newValue != oldState.items[i]){\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\t/**\r\n\t\t * Get total height of items\r\n\t\t */\r\n\t\tgetTotalHeight: function () {\r\n\t\t\tif(quickPosition.canUseSimpleCalculation()){\r\n\t\t\t\treturn quickPosition.getTotalHeight();\r\n\t\t\t}\r\n\r\n\t\t\tif(totalHeightCache != -1){\r\n\t\t\t\treturn totalHeightCache;\r\n\t\t\t}\r\n\r\n\t\t\tif(this.$config.rowStore){\r\n\t\t\t\tvar store = this.$config.rowStore;\r\n\t\t\t\tthis._fillHeightCache(store);\r\n\t\t\t\tvar getHeight = this.getItemHeight.bind(this);\r\n\t\t\t\tvar visibleItems = store.getVisibleItems();\r\n\t\t\t\tvar totalHeight = 0;\r\n\r\n\t\t\t\tvisibleItems.forEach(function(item){\r\n\t\t\t\t\ttotalHeight += getHeight(item.id);\r\n\t\t\t\t});\r\n\r\n\t\t\t\ttotalHeightCache = totalHeight;\r\n\t\t\t\treturn totalHeight;\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get item by top position\r\n\t\t * @param {*} top\r\n\t\t */\r\n\t\tgetItemIndexByTopPosition: function (top) {\r\n\t\t\tif(this.$config.rowStore){\r\n\t\t\t\tif(quickPosition.canUseSimpleCalculation()){\r\n\t\t\t\t\treturn quickPosition.getItemIndexByTopPosition(top);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar store = this.$config.rowStore;\r\n\t\t\t\tfor(var i = 0; i < store.countVisible(); i++){\r\n\t\t\t\t\tvar current = this.getRowTop(i);\r\n\t\t\t\t\tvar next = this.getRowTop(i+1);\r\n\t\t\t\t\tif(!next){\r\n\t\t\t\t\t\tvar taskId = store.getIdByIndex(i);\r\n\t\t\t\t\t\tnext = current + this.getItemHeight(taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(top >= current && top < next){\r\n\t\t\t\t\t\treturn i;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// GS-1723: If we iterated all tasks and didn't find the position, the target is below all other tasks\r\n\t\t\t\treturn store.countVisible() + 2;\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default createMixin;","var createStaticBgHelper = function(){\r\n\treturn {\r\n\t\trender: function () { },\r\n\t\tdestroy: function () { }\r\n\t};\r\n};\r\n\r\nexport default {\r\n\tcreate: function(){\r\n\t\treturn createStaticBgHelper();\r\n\t}\r\n};\r\n\r\n","\r\nexport default function(){\r\n\tvar self = this;\r\n\tvar taskFilter = function(){\r\n\t\treturn self.isVisible();\r\n\t};\r\n\r\n\tvar barVisible = function(id, task){\r\n\t\treturn !task.hide_bar;\r\n\t};\r\n\r\n\tconst gantt = this.$gantt;\r\n\r\n\tvar taskLayers = [\r\n\t\t{\r\n\t\t\texpose: true,\r\n\t\t\trenderer: this.$gantt.$ui.layers.taskBar(),\r\n\t\t\tcontainer: this.$task_bars,\r\n\t\t\tfilter: [taskFilter, barVisible]\r\n\t\t}\r\n\t];\r\n\r\n\ttaskLayers.push({\r\n\t\trenderer: this.$gantt.$ui.layers.taskBg(),\r\n\t\tcontainer: this.$task_bg,\r\n\t\tfilter: [\r\n\t\t\t//function(){\r\n\t\t\t//\treturn !self.$getConfig().static_background;\r\n\t\t\t//},\r\n\t\t\ttaskFilter\r\n\t\t]\r\n\t});\r\n\r\n\tvar linkLayers = [\r\n\t\t{\r\n\t\t\texpose: true,\r\n\t\t\trenderer: this.$gantt.$ui.layers.link(),\r\n\t\t\tcontainer: this.$task_links,\r\n\t\t\tfilter: [taskFilter]\r\n\t\t}\r\n\t];\r\n\r\n\treturn {\r\n\t\ttasks: taskLayers,\r\n\t\tlinks: linkLayers\r\n\t};\r\n\r\n};","import ScaleHelper from \"./scales_ignore\";\r\nimport eventable from \"../../../utils/eventable\";\r\nimport * as utils from \"../../../utils/utils\";\r\nimport * as helpers from \"../../../utils/helpers\";\r\nimport topPositionMixin from \"../row_position_mixin\";\r\nimport canvasRender from \"./tasks_canvas_render\";\r\nimport createLayerConfig from \"./timeline_layers\";\r\n\r\nvar Timeline = function(parent, config, factory, gantt){\r\n\tthis.$config = utils.mixin({}, config || {});\r\n\tthis.$scaleHelper = new ScaleHelper(gantt);\r\n\tthis.$gantt = gantt;\r\n\tthis._posFromDateCache = {};\r\n\tthis._posFromWorkTimeCache = {};\r\n\tthis._timelineDragScroll = null;\r\n\tutils.mixin(this, topPositionMixin(this));\r\n\teventable(this);\r\n};\r\n\r\nTimeline.prototype = {\r\n\tinit: function(container) {\r\n\t\tcontainer.innerHTML += \"<div class='gantt_task' style='width:inherit;height:inherit;'></div>\";\r\n\t\tthis.$task = container.childNodes[0];\r\n\r\n\t\tthis.$task.innerHTML = \"<div class='gantt_task_scale'></div><div class='gantt_data_area'></div>\";\r\n\t\tthis.$task_scale = this.$task.childNodes[0];\r\n\r\n\t\tthis.$task_data = this.$task.childNodes[1];\r\n\t\tconst taskBg = \"<div class='gantt_task_bg'></div>\";\r\n\t\tconst links = \"<div class='gantt_links_area'></div>\";\r\n\t\tconst taskBars = \"<div class='gantt_bars_area'></div>\";\r\n\r\n\t\tconst taskConstraints = \"<div class='gantt_task_constraints'></div>\";\r\n\t\tconst taskDeadlines = \"<div class='gantt_task_deadlines'></div>\";\r\n\t\tconst taskBaselines = \"<div class='gantt_task_baselines'></div>\";\r\n\r\n\t\tthis.$task_data.innerHTML = taskBg + taskBaselines + links + taskBars + taskConstraints + taskDeadlines;\r\n\r\n\t\tthis.$task_bg = this.$task_data.childNodes[0];\r\n\t\tthis.$task_baselines = this.$task_data.childNodes[1];\r\n\t\tthis.$task_links = this.$task_data.childNodes[2];\r\n\t\tthis.$task_bars = this.$task_data.childNodes[3];\r\n\t\tthis.$task_constraints = this.$task_data.childNodes[4];\r\n\t\tthis.$task_deadlines = this.$task_data.childNodes[5];\r\n\r\n\t\tthis._tasks = {\r\n\t\t\tcol_width: 0,\r\n\t\t\twidth: [], // width of each column\r\n\t\t\tfull_width: 0, // width of all columns\r\n\t\t\ttrace_x: [],\r\n\t\t\trendered: {}\r\n\t\t};\r\n\r\n\t\tvar config = this.$getConfig();\r\n\t\tvar attr = config[this.$config.bind + \"_attribute\"];\r\n\t\tvar linksAttr = config[this.$config.bindLinks + \"_attribute\"];\r\n\t\tif(!attr && this.$config.bind){\r\n\t\t\tattr = \"data-\" + this.$config.bind + \"-id\";\r\n\t\t}\r\n\t\tif(!linksAttr && this.$config.bindLinks){\r\n\t\t\tlinksAttr = \"data-\" + this.$config.bindLinks + \"-id\";\r\n\t\t}\r\n\t\tthis.$config.item_attribute = attr || null;\r\n\t\tthis.$config.link_attribute = linksAttr || null;\r\n\r\n\t\tvar layers = this._createLayerConfig();\r\n\t\tif(!this.$config.layers){\r\n\t\t\tthis.$config.layers = layers.tasks;\r\n\t\t}\r\n\t\tif(!this.$config.linkLayers){\r\n\t\t\tthis.$config.linkLayers = layers.links;\r\n\t\t}\r\n\r\n\t\tthis._attachLayers(this.$gantt);\r\n\r\n\t\tthis.callEvent(\"onReady\", []);\r\n\t\t//this.refresh();\r\n\t\tif (this.$gantt.ext.dragTimeline) {\r\n\t\t\tthis._timelineDragScroll = this.$gantt.ext.dragTimeline.create();\r\n\t\t\tthis._timelineDragScroll.attach(this);\r\n\t\t}\r\n\t},\r\n\r\n\tsetSize: function(width, height){\r\n\t\tvar config = this.$getConfig();\r\n\r\n\t\tif(width*1 === width){\r\n\t\t\tthis.$config.width = width;\r\n\t\t}\r\n\t\tif(height*1 === height){\r\n\r\n\t\t\tthis.$config.height = height;\r\n\t\t\tvar dataHeight = Math.max(this.$config.height - config.scale_height);\r\n\t\t\tthis.$task_data.style.height = dataHeight + 'px';\r\n\t\t}\r\n\r\n\t\tthis.refresh();\r\n\t\tthis.$task_bg.style.backgroundImage = \"\";\r\n\r\n\t\tif(config.smart_rendering && this.$config.rowStore){\r\n\t\t\tthis.$task_bg.style.height = this.getTotalHeight() +\"px\";\r\n\t\t}else{\r\n\t\t\tthis.$task_bg.style.height = \"\";\r\n\t\t}\r\n\r\n\t\tvar scale = this._tasks;\r\n\t\t//timeline area layers\r\n\t\tvar data_els = this.$task_data.childNodes;\r\n\t\tfor(var i= 0, len = data_els.length; i < len; i++){\r\n\t\t\tvar el = data_els[i];\r\n\t\t\tif(el.hasAttribute(\"data-layer\") && el.style)\r\n\t\t\t\tel.style.width = scale.full_width + \"px\";\r\n\t\t}\r\n\t},\r\n\r\n\tisVisible: function(){\r\n\t\tif(this.$parent && this.$parent.$config){\r\n\t\t\treturn !this.$parent.$config.hidden;\r\n\t\t}else{\r\n\t\t\treturn this.$task.offsetWidth;\r\n\t\t}\r\n\t},\r\n\r\n\tgetSize: function(){\r\n\t\tvar config = this.$getConfig();\r\n\t\tvar store = this.$config.rowStore;\r\n\r\n\t\tvar contentHeight = store ? this.getTotalHeight() : 0,\r\n\t\t\tcontentWidth = this.isVisible() ? this._tasks.full_width : 0;\r\n\r\n\t\treturn {\r\n\t\t\tx: this.isVisible() ? this.$config.width : 0,\r\n\t\t\ty: this.isVisible() ? this.$config.height : 0,\r\n\t\t\tcontentX: this.isVisible() ? contentWidth : 0,\r\n\t\t\tcontentY: this.isVisible() ? (config.scale_height + contentHeight) : 0,\r\n\t\t\tscrollHeight: this.isVisible() ? contentHeight : 0,\r\n\t\t\tscrollWidth: this.isVisible() ? contentWidth : 0\r\n\t\t};\r\n\t},\r\n\r\n\tscrollTo: function(left, top){\r\n\t\tif(!this.isVisible())\r\n\t\t\treturn;\r\n\r\n\t\tvar scrolled = false;\r\n\r\n\t\tthis.$config.scrollTop = this.$config.scrollTop || 0;\r\n\t\tthis.$config.scrollLeft = this.$config.scrollLeft || 0;\r\n\t\tif(top*1 === top){\r\n\t\t\tthis.$config.scrollTop = top;\r\n\t\t\tthis.$task_data.scrollTop = this.$config.scrollTop;\r\n\t\t\tscrolled = true;\r\n\t\t}\r\n\t\tif (left*1 === left){\r\n\t\t\tthis.$task.scrollLeft = left;\r\n\t\t\tthis.$config.scrollLeft = this.$task.scrollLeft;\r\n\t\t\tthis._refreshScales();\r\n\t\t\tscrolled = true;\r\n\t\t}\r\n\r\n\t\tif(scrolled){\r\n\t\t\tthis.callEvent(\"onScroll\", [this.$config.scrollLeft, this.$config.scrollTop]);\r\n\t\t}\r\n\t},\r\n\r\n\t_refreshScales: function _refreshScales() {\r\n\t\tif(!this.isVisible())\r\n\t\t\treturn;\r\n\r\n\t\tvar config = this.$getConfig();\r\n\t\tif (!config.smart_scales) return;\r\n\r\n\t\tvar viewPort = this.getViewPort();\r\n\r\n\t\tvar scales = this._scales;\r\n\t\tthis.$task_scale.innerHTML = this._getScaleChunkHtml(scales, viewPort.x, viewPort.x_end);\r\n\t},\r\n\r\n\tgetViewPort: function(){\r\n\t\tvar scrollLeft = this.$config.scrollLeft || 0;\r\n\t\tvar scrollTop = this.$config.scrollTop || 0;\r\n\t\tvar height = this.$config.height || 0;\r\n\t\tvar width = this.$config.width || 0;\r\n\t\treturn {\r\n\t\t\ty: scrollTop,\r\n\t\t\ty_end: scrollTop + height,\r\n\t\t\tx: scrollLeft,\r\n\t\t\tx_end: scrollLeft + width,\r\n\t\t\theight: height,\r\n\t\t\twidth: width\r\n\t\t};\r\n\t},\r\n\r\n\t_createLayerConfig: createLayerConfig,\r\n\r\n\t_attachLayers: function(gantt){\r\n\t\tthis._taskLayers = [];\r\n\t\tthis._linkLayers = [];\r\n\r\n\t\tvar self = this;\r\n\r\n\t\tvar layers = this.$gantt.$services.getService(\"layers\");\r\n\r\n\t\tif(this.$config.bind){\r\n\r\n\t\t\tthis._bindStore();\r\n\t\t\tvar taskRenderer = layers.getDataRender(this.$config.bind);\r\n\r\n\t\t\tif(!taskRenderer){\r\n\t\t\t\ttaskRenderer = layers.createDataRender({\r\n\t\t\t\t\tname: this.$config.bind,\r\n\t\t\t\t\tdefaultContainer: function(){ return self.$task_data;}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\ttaskRenderer.container = function(){ return self.$task_data;};\r\n\r\n\t\t\tvar taskLayers = this.$config.layers;\r\n\t\t\tfor(var i = 0; taskLayers && i < taskLayers.length; i++){\r\n\t\t\t\tvar layer = taskLayers[i];\r\n\r\n\t\t\t\tif(typeof layer == \"string\"){\r\n\t\t\t\t\tlayer = this.$gantt.$ui.layers[layer]();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(typeof layer == \"function\" || (layer && layer.render && layer.update)){\r\n\t\t\t\t\tlayer = {renderer: layer};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlayer.view = this;\r\n\r\n\t\t\t\tvar bar_layer = taskRenderer.addLayer(layer);\r\n\t\t\t\tthis._taskLayers.push(bar_layer);\r\n\t\t\t\tif(layer.expose){\r\n\t\t\t\t\tthis._taskRenderer = taskRenderer.getLayer(bar_layer);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._initStaticBackgroundRender();\r\n\t\t}\r\n\r\n\t\tif(this.$config.bindLinks){\r\n\t\t\tself.$config.linkStore = self.$gantt.getDatastore(self.$config.bindLinks);\r\n\r\n\t\t\tvar linkRenderer = layers.getDataRender(this.$config.bindLinks);\r\n\r\n\t\t\tif(!linkRenderer){\r\n\t\t\t\tlinkRenderer = layers.createDataRender({\r\n\t\t\t\t\tname: this.$config.bindLinks,\r\n\t\t\t\t\tdefaultContainer: function(){ return self.$task_data;}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tvar linkLayers = this.$config.linkLayers;\r\n\t\t\tfor(var i = 0; linkLayers && i < linkLayers.length; i++){\r\n\r\n\t\t\t\tif(typeof layer == \"string\"){\r\n\t\t\t\t\tlayer = this.$gantt.$ui.layers[layer]();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar layer = linkLayers[i];\r\n\t\t\t\tlayer.view = this;\r\n\t\t\t//\tlayer.getViewPort = getViewPort;\r\n\t\t\t//\tsubscribeSmartRender(layer);\r\n\t\t\t\tvar linkLayer = linkRenderer.addLayer(layer);\r\n\t\t\t\tthis._taskLayers.push(linkLayer);\r\n\t\t\t\tif(linkLayers[i].expose){\r\n\t\t\t\t\tthis._linkRenderer = linkRenderer.getLayer(linkLayer);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_initStaticBackgroundRender: function(){\r\n\t\tvar self = this;\r\n\t\tvar staticRender = canvasRender.create();\r\n\t\tvar store = self.$config.rowStore;\r\n\t\tif(!store) return;\r\n\r\n\t\tthis._staticBgHandler = store.attachEvent(\"onStoreUpdated\", function(id, item, mode){\r\n\t\t\tif(id !== null) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(!self.isVisible())\r\n\t\t\t\treturn;\r\n\t\t\tvar config = self.$getConfig();\r\n\t\t\tif(config.static_background || config.timeline_placeholder) {\r\n\t\t\t\tvar store = self.$gantt.getDatastore(self.$config.bind);\r\n\t\t\t\tvar staticBgContainer = self.$task_bg_static;\r\n\t\t\t\tif(!staticBgContainer){\r\n\t\t\t\t\tstaticBgContainer = document.createElement(\"div\");\r\n\t\t\t\t\tstaticBgContainer.className = \"gantt_task_bg\";\r\n\t\t\t\t\tself.$task_bg_static = staticBgContainer;\r\n\t\t\t\t\tif(self.$task_bg.nextSibling){\r\n\t\t\t\t\t\tself.$task_data.insertBefore(staticBgContainer, self.$task_bg.nextSibling);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tself.$task_data.appendChild(staticBgContainer);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (store) {\r\n\t\t\t\t\tvar staticBackgroundHeight = self.getTotalHeight();\r\n\t\t\t\t\tif (config.timeline_placeholder){\r\n\t\t\t\t\t\tstaticBackgroundHeight = config.timeline_placeholder.height || self.$task_data.offsetHeight || 99999;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tstaticRender.render(staticBgContainer, config, self.getScale(), staticBackgroundHeight, self.getItemHeight(item ? item.id : null));\r\n\t\t\t\t}\r\n\t\t\t}else if(config.static_background){\r\n\t\t\t\tif(self.$task_bg_static && self.$task_bg_static.parentNode){\r\n\t\t\t\t\tself.$task_bg_static.parentNode.removeChild(self.$task_bg_static);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.attachEvent(\"onDestroy\", function () {\r\n\t\t\tstaticRender.destroy();\r\n\t\t});\r\n\t\tthis._initStaticBackgroundRender = function(){};//init once\r\n\t},\r\n\r\n\t_clearLayers: function(gantt){\r\n\t\tvar layers = this.$gantt.$services.getService(\"layers\");\r\n\t\tvar taskRenderer = layers.getDataRender(this.$config.bind);\r\n\t\tvar linkRenderer = layers.getDataRender(this.$config.bindLinks);\r\n\r\n\t\tif (this._taskLayers) {\r\n\t\t\tfor(var i = 0; i < this._taskLayers.length; i++){\r\n\t\t\t\ttaskRenderer.removeLayer(this._taskLayers[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._linkLayers) {\r\n\t\t\tfor(var i = 0; i < this._linkLayers.length; i++){\r\n\t\t\t\tlinkRenderer.removeLayer(this._linkLayers[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._linkLayers = [];\r\n\t\tthis._taskLayers = [];\r\n\t},\r\n\r\n\t_render_tasks_scales: function _render_tasks_scales() {\r\n\t\tvar config = this.$getConfig();\r\n\r\n\t\tvar scales_html = \"\",\r\n\t\t\touter_width = 0,\r\n\t\t\tscale_height = 0;\r\n\r\n\t\tvar state = this.$gantt.getState();\r\n\r\n\t\tif (this.isVisible()) {\r\n\t\t\tvar helpers = this.$scaleHelper;\r\n\t\t\tvar scales = this._getScales();\r\n\t\t\tscale_height = config.scale_height;\r\n\r\n\t\t\tvar availWidth = this.$config.width;\r\n\t\t\tif(config.autosize == \"x\" || config.autosize == \"xy\"){\r\n\t\t\t\tavailWidth = Math.max(config.autosize_min_width, 0);\r\n\t\t\t}\r\n\r\n\t\t\tvar cfgs = helpers.prepareConfigs(scales, config.min_column_width, availWidth, scale_height - 1, state.min_date, state.max_date, config.rtl);\r\n\t\t\tvar cfg = this._tasks = cfgs[cfgs.length - 1];\r\n\t\t\tthis._scales = cfgs;\r\n\t\t\tthis._posFromDateCache = {};\r\n\t\t\tthis._posFromWorkTimeCache = {};\r\n\r\n\t\t\tif(this._tasks.projection && this._tasks.projection?.source === \"fixedHours\"){\r\n\t\t\t\tconst calendarId = \"timescale-projection-calendar\";\r\n\t\t\t\tif(this.$gantt.getCalendar(calendarId)){\r\n\t\t\t\t\tthis.$gantt.deleteCalendar(calendarId);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet {hours} = this._tasks.projection;\r\n\t\t\t\tthis.$gantt.addCalendar({\r\n\t\t\t\t\tid:calendarId, \r\n\t\t\t\t\tworktime: {\r\n\t\t\t\t\t\thours: hours || this.$gantt.getCalendar(\"global\")._worktime.hours.slice(),\r\n\t\t\t\t\t\tdays: [ 1, 1, 1, 1, 1, 1 ,1]\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tscales_html = this._getScaleChunkHtml(cfgs, 0, this.$config.width);\r\n\r\n\t\t\touter_width = cfg.full_width + \"px\";//cfg.full_width + (this._scroll_sizes().y ? scrollSizes.scroll_size : 0) + \"px\";\r\n\t\t\tscale_height += \"px\";\r\n\t\t}\r\n\r\n\t\tthis.$task_scale.style.height = scale_height;\r\n\r\n\t\tthis.$task_data.style.width =\r\n\t\t\tthis.$task_scale.style.width = outer_width;\r\n\r\n\t\tthis.$task_scale.innerHTML = scales_html;\r\n\r\n\t},\r\n\r\n\t_getScaleChunkHtml: function _get_scale_chunk_html (scales, fromPos, toPos) {\r\n\t\tvar templates = this.$gantt.templates;\r\n\t\tvar html = [];\r\n\r\n\t\tvar css = templates.scale_row_class;\r\n\t\tfor (var i = 0; i < scales.length; i++) {\r\n\t\t\tvar cssClass = \"gantt_scale_line\";\r\n\t\t\tvar tplClass = css(scales[i]);\r\n\t\t\tif (tplClass) {\r\n\t\t\t\tcssClass += \" \" + tplClass;\r\n\t\t\t}\r\n\r\n\t\t\thtml.push(\"<div class=\\\"\" + cssClass + \"\\\" style=\\\"height:\" + (scales[i].height) +\r\n\t\t\t\t\"px;position:relative;line-height:\" + (scales[i].height) + \"px\\\">\" + this._prepareScaleHtml(scales[i], fromPos, toPos, i) + \"</div>\");\r\n\t\t}\r\n\r\n\t\treturn html.join(\"\");\r\n\t},\r\n\t_prepareScaleHtml: function _prepare_scale_html(config, fromPos, toPos, index) {\r\n\t\tvar globalConfig = this.$getConfig();\r\n\t\tvar globalTemplates = this.$gantt.templates;\r\n\r\n\t\tvar cells = [];\r\n\t\tvar date = null, css = null;\r\n\r\n\t\tvar content = config.format || config.template || config.date;\r\n\r\n\t\tif(typeof content === \"string\"){\r\n\t\t\tcontent = this.$gantt.date.date_to_str(content);\r\n\t\t}\r\n\r\n\t\tvar startIndex = 0,\r\n\t\t\tendIndex = config.count;\r\n\r\n\t\tif (globalConfig.smart_scales && (!isNaN(fromPos) && !isNaN(toPos))) {\r\n\t\t\tstartIndex = helpers.findBinary(config.left, fromPos);\r\n\t\t\tendIndex = helpers.findBinary(config.left, toPos) + 1;\r\n\t\t}\r\n\r\n\t\tcss = config.css || function () {\r\n\t\t\t};\r\n\t\tif (!config.css && globalConfig.inherit_scale_class) {\r\n\t\t\tcss = globalTemplates.scale_cell_class;\r\n\t\t}\r\n\r\n\t\tfor (var i = startIndex; i < endIndex; i++) {\r\n\t\t\tif (!config.trace_x[i]) break;\r\n\r\n\t\t\tdate = new Date(config.trace_x[i]);\r\n\t\t\tvar value = content.call(this, date),\r\n\t\t\t\twidth = config.width[i],\r\n\t\t\t\theight = config.height,\r\n\t\t\t\tleft = config.left[i],\r\n\t\t\t\tstyle = \"\",\r\n\t\t\t\ttemplate = \"\",\r\n\t\t\t\tcssclass = \"\";\r\n\r\n\t\t\tif (width) {\r\n\t\t\t\tvar position = globalConfig.smart_scales ? (\"position:absolute;left:\" + left + \"px\") : \"\";\r\n\r\n\t\t\t\tstyle = \"width:\" + (width) + \"px;\" + position;\r\n\t\t\t\t// GS-1188: Display the scale value in the viewport for long cells\r\n\t\t\t\tconst viewPort = this.getViewPort();\r\n\t\t\t\tconst floatConfig = (globalConfig.scales[index] || {}).sticky; // for old scale settings\r\n\r\n\t\t\t\tlet labelPosition = '';\r\n\t\t\t\tconst approxLabelWidth = 70;\r\n\t\t\t\t// if sticky config is not specified - sticky labels are enabled for long cells only\r\n\t\t\t\tif ((floatConfig !== false && width > approxLabelWidth) || floatConfig === true) {\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (left < viewPort.x && left + width/2 - approxLabelWidth/2 < viewPort.x){\r\n\t\t\t\t\t\tlabelPosition = ` style='position:absolute;left: ${viewPort.x  - left + 10}px;' `;\r\n\t\t\t\t\t} else if(left + width/2 + approxLabelWidth/2 > viewPort.x_end && width > approxLabelWidth){\r\n\t\t\t\t\t\tlet labelPos = viewPort.x_end - left - 10;\r\n\t\t\t\t\t\tlet translateValue = \"-100%\";\r\n\t\t\t\t\t\tif(labelPos < approxLabelWidth) {\r\n\t\t\t\t\t\t\tlabelPos = approxLabelWidth;\r\n\t\t\t\t\t\t\ttranslateValue = `-${labelPos}px`;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlabelPosition = ` style='position:absolute;left: ${labelPos}px;transform: translate(${translateValue},0);' `;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcssclass = \"gantt_scale_cell\" + (i == config.count - 1 ? \" gantt_last_cell\" : \"\");\r\n\r\n\t\t\t\ttemplate = css.call(this, date);\r\n\t\t\t\tif (template) cssclass += \" \" + template;\r\n\r\n\t\t\t\tvar ariaAttr = this.$gantt._waiAria.getTimelineCellAttr(value);\r\n\t\t\t\tvar cell = `<div class='${cssclass}' ${ariaAttr} style='${style}'><span ${labelPosition}>${value}</span></div>`;\r\n\t\t\t\tcells.push(cell);\r\n\t\t\t} else {\r\n\t\t\t\t//do not render ignored cells\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\treturn cells.join(\"\");\r\n\t},\r\n\t_getPositioningContext: function(task) {\r\n\t\tif(this._tasks.unit === this.$gantt.config.duration_unit){\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tif(this._tasks.unit !== \"day\" && this._tasks.unit !== \"week\"){\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tif(!this._tasks.projection){\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst {source} = this._tasks.projection || {};\r\n\t\tif(source === \"taskCalendar\"){\r\n\r\n\t\t\tif(!task){\r\n\t\t\t\treturn {\r\n\t\t\t\t\tcalendar: this.$gantt.getCalendar(\"global\")\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\tcalendar: this.$gantt.getTaskCalendar(task)\r\n\t\t\t};\r\n\t\t}\r\n\t\tif(source === \"fixedHours\"){\r\n\t\t\treturn {\r\n\t\t\t\tcalendar: this.$gantt.getCalendar(\"timescale-projection-calendar\")\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t},\r\n\r\n\tdateFromPos: function dateFromPos(x, context) {\r\n\t\tvar scale = this._tasks;\r\n\t\tif (x < 0 || x > scale.full_width || !scale.full_width) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar ind = helpers.findBinary(this._tasks.left, x);\r\n\t\tvar summ = this._tasks.left[ind];\r\n\r\n\t\tvar col_width = scale.width[ind] || scale.col_width;\r\n\t\tvar part = 0;\r\n\t\tif (col_width) {\r\n\t\t\tpart = (x - summ) / col_width;\r\n\t\t\tif(scale.rtl){\r\n\t\t\t\tpart = 1 - part;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tconst calendar = (context ? context.calendar : null) || null;\r\n\r\n\t\tvar unit = 0;\r\n\t\tif (part) {\r\n\t\t\tunit = this._getColumnDuration(scale, scale.trace_x[ind]);\r\n\t\t}\r\n\r\n\t\tconst cellStartDate = scale.trace_x[ind];\r\n\r\n\t\tconst absolutePositionDate = new Date(scale.trace_x[ind].valueOf() + Math.round(part * unit));\r\n\r\n\t\tif(!calendar){\r\n\r\n\t\t\treturn absolutePositionDate;\r\n\t\t}\r\n\r\n\t\tconst {start: trimStartSec, end: cellEnd, duration: cellDuration, intervals} = this._getWorkTrimForCell(cellStartDate, calendar);\r\n\r\n\t\tif(cellDuration <= 0){\r\n\t\t\treturn absolutePositionDate;\r\n\t\t}\r\n\r\n\t\tconst secondsInsideTrim = Math.round(part * cellDuration);\r\n\t\tconst mappedTimestampMs = cellStartDate.valueOf() + (trimStartSec + secondsInsideTrim) * 1000;\r\n\r\n\t\treturn new Date(mappedTimestampMs);\r\n\t},\r\n\r\n\tposFromDate: function posFromDate(date, context) {\r\n\t\tif (!this.isVisible())\r\n\t\t\treturn 0;\r\n\r\n\t\tif(!date){\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tif(context && context.calendar){\r\n\t\t\treturn this.posFromWorkTime(date, context);\r\n\t\t}\r\n\r\n\t\tvar dateValue = String(date.valueOf());\r\n\r\n\t\tif(this._posFromDateCache[dateValue] !== undefined){\r\n\t\t\treturn this._posFromDateCache[dateValue];\r\n\t\t}\r\n\t\tvar ind = this.columnIndexByDate(date);\r\n\t\tthis.$gantt.assert(ind >= 0, \"Invalid day index\");\r\n\r\n\t\tvar wholeCells = Math.floor(ind);\r\n\t\tvar partCell = ind % 1;\r\n\r\n\t\tvar pos = this._tasks.left[Math.min(wholeCells, this._tasks.width.length - 1)];\r\n\t\tif (wholeCells == this._tasks.width.length)\r\n\t\t\tpos += this._tasks.width[this._tasks.width.length - 1];\r\n\t\t//for(var i=1; i <= wholeCells; i++)\r\n\t\t//\tpos += gantt._tasks.width[i-1];\r\n\r\n\t\tif (partCell) {\r\n\t\t\tif (wholeCells < this._tasks.width.length) {\r\n\t\t\t\tpos += this._tasks.width[wholeCells] * (partCell % 1);\r\n\t\t\t} else {\r\n\t\t\t\tpos += 1;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar roundPos = Math.round(pos);\r\n\t\tthis._posFromDateCache[dateValue] = roundPos;\r\n\t\treturn Math.round(roundPos);\r\n\t},\r\n\r\n\t_getWorkTrimForCell: function (cellStartDate, calendar) {\r\n\t\tconst cellDurationMs = this._getColumnDuration(this._tasks, cellStartDate);\r\n\t\tconst cellEndDate = new Date(cellStartDate.valueOf() + cellDurationMs);\r\n\r\n\t\tlet earliestWorkSecondInCell = null;\r\n\t\tlet latestWorkSecondInCell = null;\r\n\t\tconst intervalsSinceCellStart = [];\r\n\r\n\t\tfor (let dayDate = new Date(cellStartDate), dayIndex = 0;\r\n\t\t\tdayDate < cellEndDate;\r\n\t\t\tdayDate = this.$gantt.date.add(dayDate, 1, \"day\"), dayIndex++) {\r\n\r\n\t\t\tconst dayIntervals = calendar._getWorkHours(dayDate) || [];\r\n\r\n\t\t\tconst dayStartOffsetSeconds = Math.round((dayDate - cellStartDate) / 1000);\r\n\r\n\t\t\tfor (let i = 0; i < dayIntervals.length; i++) {\r\n\t\t\t\tconst absoluteStartSeconds = dayStartOffsetSeconds + dayIntervals[i].start;\r\n\t\t\t\tconst absoluteEndSeconds   = dayStartOffsetSeconds + dayIntervals[i].end;\r\n\r\n\t\t\t\tintervalsSinceCellStart.push({\r\n\t\t\t\t\tstart: absoluteStartSeconds,\r\n\t\t\t\t\tend: absoluteEndSeconds\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (earliestWorkSecondInCell === null || absoluteStartSeconds < earliestWorkSecondInCell) {\r\n\t\t\t\t\tearliestWorkSecondInCell = absoluteStartSeconds;\r\n\t\t\t\t}\r\n\t\t\t\tif (latestWorkSecondInCell === null || absoluteEndSeconds > latestWorkSecondInCell) {\r\n\t\t\t\t\tlatestWorkSecondInCell = absoluteEndSeconds;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\tearliestWorkSecondInCell === null ||\r\n\t\t\tlatestWorkSecondInCell === null ||\r\n\t\t\tlatestWorkSecondInCell <= earliestWorkSecondInCell\r\n\t\t) {\r\n\t\t\treturn { start: 0, end: 0, duration: 0, intervals: [] };\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tstart: earliestWorkSecondInCell,\r\n\t\t\tend: latestWorkSecondInCell,\r\n\t\t\tduration: latestWorkSecondInCell - earliestWorkSecondInCell,\r\n\t\t\tintervals: intervalsSinceCellStart\r\n\t\t};\r\n\t},\r\n\r\n\tposFromWorkTime: function (date, {calendar}) {\r\n\t\tif (!this.isVisible())\r\n\t\t\treturn 0;\r\n\t\tif (!date) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tif(!calendar){\r\n\t\t\treturn this.posFromDate(date);\r\n\t\t}\r\n\r\n\t\tconst cacheKey = (calendar ? calendar.id : \"\") + String(date.valueOf());\r\n\t\tif (this._posFromWorkTimeCache[cacheKey] !== undefined) {\r\n\t\t\treturn this._posFromWorkTimeCache[cacheKey];\r\n\t\t}\r\n\r\n\t\tconst index = this.columnIndexByDate(date);\r\n\t\tthis.$gantt.assert(index >= 0, \"Invalid day index\");\r\n\r\n\t\tconst dayIndex = Math.floor(index);\t\r\n\t\tconst wholeCells = dayIndex;\r\n\r\n\t\tconst {start: workintervalStart, end: workintervalEnd, duration: cellDuration} = this._getWorkTrimForCell(date, calendar);\r\n\r\n\t\tif(cellDuration === 0){\r\n\t\t\tconst result = this.posFromDate(date);\r\n\t\t//\tthis._posFromWorkTimeCache[cacheKey] = result;\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tconst cellStart = this._tasks.trace_x[dayIndex];\r\n\t\tconst dateOffset = (date - cellStart) / 1000; // in seconds\r\n\r\n\t\tlet fraction = 0;\r\n\t\tif(dateOffset <= workintervalStart){\r\n\t\t\tfraction = 0;\r\n\t\t} else if(dateOffset >= workintervalEnd){\r\n\t\t\tfraction = 1;\r\n\t\t} else {\r\n\t\t\tfraction = (dateOffset - workintervalStart) / cellDuration;\r\n\t\t}\r\n\r\n\t\tif(this._tasks.rtl){\r\n\t\t\tfraction = 1 - fraction;\r\n\t\t}\r\n\r\n\t\tconst posLeft = this._tasks.left[Math.min(wholeCells, this._tasks.width.length - 1)];\r\n\r\n\t\tconst cellWidth = (wholeCells < this._tasks.width.length)\r\n\t\t\t? this._tasks.width[wholeCells]\r\n\t\t\t: this._tasks.width[this._tasks.width.length - 1];\r\n\t\r\n\t\tconst pos = Math.round(posLeft + cellWidth * fraction);\r\n\t//\tthis._posFromWorkTimeCache[cacheKey] = pos;\r\n\r\n\t\treturn pos;\r\n\t},\r\n\r\n\r\n\t_getNextVisibleColumn: function (startIndex, columns, ignores) {\r\n\t\t// iterate columns to the right\r\n\t\tvar date = +columns[startIndex];\r\n\t\tvar visibleDateIndex = startIndex;\r\n\t\twhile (ignores[date]) {\r\n\t\t\tvisibleDateIndex++;\r\n\t\t\tdate = +columns[visibleDateIndex];\r\n\t\t}\r\n\r\n\t\treturn visibleDateIndex;\r\n\t},\r\n\t_getPrevVisibleColumn: function (startIndex, columns, ignores) {\r\n\t\t// iterate columns to the left\r\n\t\tvar date = +columns[startIndex];\r\n\t\tvar visibleDateIndex = startIndex;\r\n\t\twhile (ignores[date]) {\r\n\t\t\tvisibleDateIndex--;\r\n\t\t\tdate = +columns[visibleDateIndex];\r\n\t\t}\r\n\t\treturn visibleDateIndex;\r\n\t},\r\n\t_getClosestVisibleColumn: function (startIndex, columns, ignores) {\r\n\t\tvar visibleDateIndex = this._getNextVisibleColumn(startIndex, columns, ignores);\r\n\t\tif (!columns[visibleDateIndex]) {\r\n\t\t\tvisibleDateIndex =  this._getPrevVisibleColumn(startIndex, columns, ignores);\r\n\t\t}\r\n\t\treturn visibleDateIndex;\r\n\t},\r\n\tcolumnIndexByDate: function columnIndexByDate(date) {\r\n\t\tvar pos = new Date(date).valueOf();\r\n\t\tvar days = this._tasks.trace_x_ascending,\r\n\t\t\tignores = this._tasks.ignore_x;\r\n\r\n\t\tvar state = this.$gantt.getState();\r\n\r\n\t\tif (pos <= state.min_date) {\r\n\t\t\tif(this._tasks.rtl){\r\n\t\t\t\treturn days.length;\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (pos >= state.max_date) {\r\n\t\t\tif(this._tasks.rtl){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn days.length;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar dateIndex = helpers.findBinary(days, pos);\r\n\r\n\t\tvar visibleIndex = this._getClosestVisibleColumn(dateIndex, days, ignores);\r\n\t\tvar visibleDate = days[visibleIndex];\r\n\t\tvar transition = this._tasks.trace_index_transition;\r\n\r\n\t\tif(!visibleDate){\r\n\t\t\tif(transition){\r\n\t\t\t\treturn transition[0];\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar part = ((date - days[visibleIndex]) / this._getColumnDuration(this._tasks, days[visibleIndex]));\r\n\t\tif(transition){\r\n\t\t\treturn transition[visibleIndex] + (1 - part);\r\n\t\t}else{\r\n\t\t\treturn visibleIndex + part;\r\n\t\t}\r\n\t},\r\n\tgetItemPosition:function (task, start_date, end_date) {\r\n\t\tvar xLeft, xRight, width;\r\n\r\n\t\tlet displayStart = start_date || task.start_date || task.$auto_start_date;\r\n\t\tlet displayEnd = end_date || task.end_date || task.$auto_end_date;\r\n\r\n\t\tconst context = this._getPositioningContext(task);\r\n\t\tif(context && context.calendar) {\r\n\r\n\t\t\tif(this._tasks.rtl){\r\n\t\t\t\txRight = this.posFromWorkTime(displayStart, context);\r\n\t\t\t\txLeft = this.posFromWorkTime(displayEnd, context);\r\n\t\t\t}else{\r\n\t\t\t\txLeft = this.posFromWorkTime(displayStart, context);\r\n\t\t\t\txRight = this.posFromWorkTime(displayEnd, context);\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tif(this._tasks.rtl){\r\n\t\t\t\txRight = this.posFromDate(displayStart);\r\n\t\t\t\txLeft = this.posFromDate(displayEnd);\r\n\t\t\t}else{\r\n\t\t\t\txLeft = this.posFromDate(displayStart);\r\n\t\t\t\txRight = this.posFromDate(displayEnd);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\twidth =  Math.max((xRight - xLeft), 0);\r\n\r\n\t\tvar y = this.getItemTop(task.id);\r\n\r\n\t\tvar height = this.getBarHeight(task.id);\r\n\t\tvar rowHeight = this.getItemHeight(task.id);\r\n\t\treturn {\r\n\t\t\tleft: xLeft,\r\n\t\t\ttop: y,\r\n\t\t\theight: height,\r\n\t\t\twidth: width,\r\n\t\t\trowHeight: rowHeight\r\n\t\t};\r\n\t},\r\n\r\n\tgetBarHeight: function(taskId, isMilestoneRender){\r\n\t\tvar config = this.$getConfig();\r\n\r\n\t\tvar task = this.$config.rowStore.getItem(taskId);\r\n\t\t// height of the bar item\r\n\t\tvar height = task.task_height || task.bar_height || config.bar_height || config.task_height;\r\n\t\tvar rowHeight = this.getItemHeight(taskId);\r\n\r\n\t\tif (height == \"full\") {\r\n\t\t\tvar offset = config.bar_height_padding || 3;\r\n\t\t\theight = rowHeight - offset;\r\n\t\t}\r\n\t\t//item height cannot be bigger than row height\r\n\t\theight = Math.min(height, rowHeight);\r\n\t\tif (isMilestoneRender) { // to get correct height for addapting Milestone to the row\r\n\t\t\theight = Math.round(height / Math.sqrt(2));\r\n\t\t}\r\n\t\treturn Math.max(height, 0);\r\n\t},\r\n\r\n\tgetScale: function(){\r\n\t\treturn this._tasks;\r\n\t},\r\n\r\n\t_getScales: function _get_scales() {\r\n\t\tvar config = this.$getConfig();\r\n\t\tvar helpers = this.$scaleHelper;\r\n\t\tvar scales = [helpers.primaryScale(config)].concat(helpers.getAdditionalScales(config));\r\n\r\n\t\thelpers.sortScales(scales);\r\n\t\treturn scales;\r\n\t},\r\n\r\n\t_getColumnDuration: function _get_coll_duration(scale, date) {\r\n\t\treturn this.$gantt.date.add(date, scale.step, scale.unit) - date;\r\n\t},\r\n\t_bindStore: function () {\r\n\t\tif (this.$config.bind){\r\n\t\t\tvar rowStore = this.$gantt.getDatastore(this.$config.bind);\r\n\t\t\tthis.$config.rowStore = rowStore;\r\n\t\t\tif(rowStore && !rowStore._timelineCacheAttached){\r\n\t\t\t\tvar self = this;\r\n\t\t\t\trowStore._timelineCacheAttached = rowStore.attachEvent(\"onBeforeFilter\", function(){\r\n\t\t\t\t\tself._resetTopPositionHeight();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t_unbindStore: function(){\r\n\t\tif (this.$config.bind){\r\n\t\t\tvar rowStore = this.$gantt.getDatastore(this.$config.bind);\r\n\t\t\tif(rowStore && rowStore._timelineCacheAttached){\r\n\t\t\t\trowStore.detachEvent(rowStore._timelineCacheAttached);\r\n\t\t\t\trowStore._timelineCacheAttached = false;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\trefresh: function(){\r\n\t\tthis._bindStore();\r\n\r\n\t\tif(this.$config.bindLinks) {\r\n\t\t\tthis.$config.linkStore = this.$gantt.getDatastore(this.$config.bindLinks);\r\n\t\t}\r\n\r\n\t\tthis._resetTopPositionHeight();\r\n\t\tthis._resetHeight();\r\n\t\tthis._initStaticBackgroundRender();\r\n\t\tthis._render_tasks_scales();\r\n\t},\r\n\r\n\tdestructor: function(){\r\n\t\tvar gantt = this.$gantt;\r\n\t\tthis._clearLayers(gantt);\r\n\t\tthis._unbindStore();\r\n\t\tthis.$task = null;\r\n\t\tthis.$task_scale = null;\r\n\t\tthis.$task_data = null;\r\n\t\tthis.$task_bg = null;\r\n\t\tthis.$task_links = null;\r\n\t\tthis.$task_bars = null;\r\n\r\n\t\tthis.$gantt = null;\r\n\r\n\t\tif(this.$config.rowStore){\r\n\t\t\tthis.$config.rowStore.detachEvent(this._staticBgHandler);\r\n\t\t\tthis.$config.rowStore = null;\r\n\t\t}\r\n\t\tif(this.$config.linkStore){\r\n\t\t\tthis.$config.linkStore = null;\r\n\t\t}\r\n\r\n\t\tif(this._timelineDragScroll) {\r\n\t\t\tthis._timelineDragScroll.destructor();\r\n\t\t\tthis._timelineDragScroll = null;\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onDestroy\", []);\r\n\t\tthis.detachAllEvents();\r\n\r\n\t}\r\n};\r\n\r\nexport default Timeline;","function createResizer(gantt, grid){\r\n\treturn {\r\n\t\tinit: function(){},\r\n\t\tdoOnRender: function(){}\r\n\t};\r\n}\r\n\r\nexport default createResizer;","import * as domHelpers from \"../utils/dom_helpers\";\r\n\r\nfunction createRowResizer(gantt, grid){\r\n\r\n\tvar _task_grid_row_resize = {\r\n\t\trow_before_start: gantt.bind(function (dnd, obj, e) {\r\n\t\t\tvar config = grid.$getConfig();\r\n\t\t\tvar store = grid.$config.rowStore;\r\n\r\n\t\t\tvar el = domHelpers.locateAttribute(e, config.task_grid_row_resizer_attribute);\r\n\t\t\tif (!el) return false;\r\n\r\n\t\t\tvar row_id = this.locate(e, config.task_grid_row_resizer_attribute),\r\n\t\t\t\trow = store.getItem(row_id);\r\n\r\n\t\t\tif (grid.callEvent(\"onBeforeRowResize\", [row]) === false)\r\n\t\t\t\treturn false;\r\n\t\t}, gantt),\r\n\r\n\t\trow_after_start: gantt.bind(function (dnd, obj, e) {\r\n\t\t\tvar config = grid.$getConfig();\r\n\r\n\t\t\tvar row_id = this.locate(e, config.task_grid_row_resizer_attribute);\r\n\t\t\tdnd.config.marker.innerHTML = \"\";\r\n\r\n\t\t\tdnd.config.marker.className += \" gantt_row_grid_resize_area\";\r\n\t\t\tdnd.config.marker.style.width = grid.$grid.offsetWidth + \"px\";\r\n\t\t\tdnd.config.drag_id = row_id;\r\n\r\n\t\t}, gantt),\r\n\r\n\t\trow_drag_move: gantt.bind(function (dnd, obj, e) {\r\n\t\t\tvar store = grid.$config.rowStore;\r\n\t\t\tvar config = grid.$getConfig();\r\n\t\t\tvar dd = dnd.config;\r\n\t\t\tvar id = dd.drag_id,\r\n\t\t\t\titemHeight = grid.getItemHeight(id),\r\n\t\t\t\titemTop = grid.getItemTop(id) - obj.scrollTop;\r\n\t\t\tvar pos = domHelpers.getNodePosition(grid.$grid_data),\r\n\t\t\t\tpointerPosition = parseInt(dd.marker.style.top, 10),\r\n\t\t\t\tmarkerStartPosition = itemTop + pos.y,\r\n\t\t\t\tmarker_height = 0,\r\n\t\t\t\tminPointerPosition = config.min_task_grid_row_height;\r\n\r\n\t\t\tmarker_height = pointerPosition - markerStartPosition;\r\n\t\t\tif(marker_height < minPointerPosition){\r\n\t\t\t\tmarker_height = minPointerPosition;\r\n\t\t\t}\r\n\r\n\t\t\tdd.marker.style.left = pos.x + \"px\";\r\n\t\t\tdd.marker.style.top = markerStartPosition - 1 + \"px\";\r\n\t\t\tdd.marker.style.height = Math.abs(marker_height) + 1 + \"px\";\r\n\r\n\t\t\tdd.marker_height = marker_height;\r\n\t\t\t\r\n\t\t\tgrid.callEvent(\"onRowResize\", [id, store.getItem(id), marker_height + itemHeight]);\r\n\t\t\treturn true;\r\n\t\t}, gantt),\r\n\r\n\t\trow_drag_end: gantt.bind(function (dnd, obj, e) {\r\n\t\t\tvar store = grid.$config.rowStore;\r\n\t\t\tvar dd = dnd.config;\r\n\t\t\tvar id = dd.drag_id,\r\n\t\t\t\titem = store.getItem(id),\r\n\t\t\t\toldItemHeight = grid.getItemHeight(id);\r\n\r\n\t\t\tvar finalHeight = dd.marker_height;\r\n\r\n\t\t\tif (grid.callEvent(\"onBeforeRowResizeEnd\", [id, item, finalHeight]) === false)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (item.row_height == finalHeight)\r\n\t\t\t\treturn;\r\n\r\n\t\t\titem.row_height = finalHeight;\r\n\t\t\t// GS-2275: case for resizing resource grid row and others\r\n\t\t\tstore.updateItem(id);\r\n\t\t\tgrid.callEvent(\"onAfterRowResize\", [id, item, oldItemHeight, finalHeight]);\r\n\r\n\t\t\tthis.render();\r\n\t\t}, gantt)\r\n\t};\r\n\r\n\t// calls the initialization of the D'n'D events for resize elements\r\n\tvar _init_resize = function () {\r\n\r\n\t\tvar DnD = gantt.$services.getService(\"dnd\");\r\n\r\n\t\tvar config = grid.$getConfig();\r\n\r\n\t\tvar dnd = new DnD(grid.$grid_data, {updates_per_second: 60});\r\n\t\tif (gantt.defined(config.dnd_sensitivity))\r\n\t\t\tdnd.config.sensitivity = config.dnd_sensitivity;\r\n\r\n\t\tdnd.attachEvent(\"onBeforeDragStart\", function (obj, e) {\r\n\t\t\treturn _task_grid_row_resize.row_before_start(dnd, obj, e);\r\n\t\t});\r\n\t\tdnd.attachEvent(\"onAfterDragStart\", function (obj, e) {\r\n\t\t\treturn _task_grid_row_resize.row_after_start(dnd, obj, e);\r\n\t\t});\r\n\t\tdnd.attachEvent(\"onDragMove\", function (obj, e) {\r\n\t\t\treturn _task_grid_row_resize.row_drag_move(dnd, obj, e);\r\n\t\t});\r\n\t\tdnd.attachEvent(\"onDragEnd\", function (obj, e) {\r\n\t\t\treturn _task_grid_row_resize.row_drag_end(dnd, obj, e);\r\n\t\t});\r\n\r\n\t};\r\n\r\n\treturn {\r\n\t\tinit: _init_resize\r\n\t};\r\n}\r\n\r\nexport default createRowResizer;","const SENSITIVITY = 20;\r\nconst TIMEOUT = 50;\r\nconst SCROLLSTEP = 10;\r\n\r\nexport default class ScrollableGrid {\r\n\tpublic getCurrentX;\r\n\tprivate $gantt;\r\n\tprivate $grid;\r\n\tprivate _dnd;\r\n\tprivate _scrollView;\r\n\tprivate _scrollOrder: 0 | 1 | -1 = 0;\r\n\r\n\tconstructor(params) {\r\n\t\tconst {gantt, grid, dnd, getCurrentX} = params;\r\n\t\tthis.$gantt = gantt;\r\n\t\tthis.$grid = grid;\r\n\t\tthis._dnd = dnd;\r\n\t\tthis.getCurrentX = getCurrentX;\r\n\t\tthis._scrollView = this.$gantt.$ui.getView(this.$grid.$config.scrollX);\r\n\t\tthis.attachEvents();\r\n\t}\r\n\tattachEvents() {\r\n\t\tif (this.isScrollable()) {\r\n\t\t\tthis._dnd.attachEvent(\"onDragMove\", (obj, e) => {\r\n\t\t\t\tconst gridBoundingRect = this.$grid.$grid.getBoundingClientRect();\r\n\t\t\t\tconst maxLeft = gridBoundingRect.right;\r\n\t\t\t\tconst minLeft = gridBoundingRect.left;\r\n\t\t\t\tconst currentX = this.getCurrentX(e.clientX);\r\n\r\n\t\t\t\tif (currentX >= maxLeft - SENSITIVITY) {\r\n\t\t\t\t\tthis.autoscrollRight();\r\n\t\t\t\t\tthis.autoscrollStart();\r\n\t\t\t\t}\r\n\t\t\t\tif (currentX <= minLeft + SENSITIVITY) {\r\n\t\t\t\t\tthis.autoscrollLeft();\r\n\t\t\t\t\tthis.autoscrollStart();\r\n\t\t\t\t}\r\n\t\t\t\tif (currentX < maxLeft - SENSITIVITY && currentX > minLeft + SENSITIVITY) {\r\n\t\t\t\t\tthis.autoscrollStop();\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t\tthis._dnd.attachEvent(\"onDragEnd\", () => {\r\n\t\t\t\tthis.autoscrollStop();\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\tautoscrollStart() {\r\n\t\tif (this._scrollOrder === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst scrollStep = SCROLLSTEP * this._scrollOrder;\r\n\t\tconst scrollState = this._scrollView.getScrollState();\r\n\t\tthis._scrollView.scrollTo(scrollState.position + scrollStep);\r\n\t\tsetTimeout(() => { this.autoscrollStart(); }, TIMEOUT);\r\n\t}\r\n\tautoscrollRight() {\r\n\t\tthis._scrollOrder = 1;\r\n\t}\r\n\tautoscrollLeft() {\r\n\t\tthis._scrollOrder = -1;\r\n\t}\r\n\tautoscrollStop() {\r\n\t\tthis._scrollOrder = 0;\r\n\t}\r\n\tgetCorrection() {\r\n\t\tif (!this.isScrollable()) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\treturn this._scrollView.getScrollState().position;\r\n\t}\r\n\tisScrollable() {\r\n\t\treturn !!this.$grid.$config.scrollable;\r\n\t}\r\n}","import * as domHelpers from \"../../utils/dom_helpers\";\r\nimport ScrollableGrid from \"./scrollable_grid\";\r\n\r\nconst COLUMN_ID_ATTR_NAME = \"data-column-id\";\r\n\r\nexport class ColumnsGridDnd {\r\n\tprivate $gantt;\r\n\tprivate $grid;\r\n\tprivate _dragX;\r\n\tprivate _dnd;\r\n\tprivate _originAutoscroll;\r\n\tprivate _scrollableGrid: ScrollableGrid;\r\n\tprivate _draggedCell;\r\n\tprivate _targetMarker = null;\r\n\tprivate _gridConfig;\r\n\tconstructor(gantt, grid) {\r\n\t\tthis.$gantt = gantt;\r\n\t\tthis.$grid = grid;\r\n\t}\r\n\tinit() {\r\n\t\tconst DND = this.$gantt.$services.getService(\"dnd\");\r\n\t\tthis._dnd = new DND(this.$grid.$grid_scale, { updates_per_second: 60 });\r\n\t\tthis._scrollableGrid = new ScrollableGrid({\r\n\t\t\tgantt: this.$gantt,\r\n\t\t\tgrid: this.$grid,\r\n\t\t\tdnd: this._dnd,\r\n\t\t\tgetCurrentX: this.calculateCurrentPosition\r\n\t\t});\r\n\t\tthis.attachEvents();\r\n\t}\r\n\tattachEvents() {\r\n\t\tthis._dnd.attachEvent(\"onBeforeDragStart\", (obj, e) => {\r\n\t\t\tthis._draggedCell = this.$gantt.utils.dom.closest(e.target, \".gantt_grid_head_cell\");\r\n\t\t\tif(!this._draggedCell){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst columns = this.$grid.$getConfig().columns;\r\n\t\t\tconst columnName = this._draggedCell.getAttribute(COLUMN_ID_ATTR_NAME);\r\n\t\t\tlet draggedColumn;\r\n\t\t\tlet draggedIndex;\r\n\t\t\tcolumns.map(function(column, index){\r\n\t\t\t\tif(column.name === columnName){\r\n\t\t\t\t\tdraggedColumn = column;\r\n\t\t\t\t\tdraggedIndex = index;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (this.$grid.callEvent(\"onBeforeColumnDragStart\", [{ draggedColumn, draggedIndex}]) === false) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (!this._draggedCell || !draggedColumn) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tthis._gridConfig = this.$grid.$getConfig();\r\n\t\t\tthis._originAutoscroll = this.$gantt.config.autoscroll;\r\n\t\t\tthis.$gantt.config.autoscroll = false;\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tthis._dnd.attachEvent(\"onAfterDragStart\", (obj, e) => {\r\n\t\t\tif (!this._draggedCell) {\r\n\t\t\t\treturn; // GS-1333: don't try to reorder a column when we resize it\r\n\t\t\t}\r\n\t\t\tthis._dnd.config.column = this._draggedCell.getAttribute(COLUMN_ID_ATTR_NAME);\r\n\t\t\tthis._dnd.config.marker.innerHTML = this._draggedCell.outerHTML;\r\n\t\t\tthis._dnd.config.marker.classList.add(\"gantt_column_drag_marker\");\r\n\t\t\tthis._dnd.config.marker.style.height = this._gridConfig.scale_height + \"px\";\r\n\t\t\tthis._dnd.config.marker.style.lineHeight = this._gridConfig.scale_height + \"px\";\r\n\t\t\tthis._draggedCell.classList.add(\"gantt_grid_head_cell_dragged\");\r\n\t\t});\r\n\r\n\t\tthis._dnd.attachEvent(\"onDragMove\", (obj, e) => {\r\n\t\t\tif(!this._draggedCell){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis._dragX = e.clientX;\r\n\t\t\tconst x = this.calculateCurrentPosition(e.clientX);\r\n\t\t\tconst columnIndexes = this.findColumnsIndexes();\r\n\t\t\tthis.setMarkerPosition(x);\r\n\t\t\tthis.drawTargetMarker(columnIndexes);\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tthis._dnd.attachEvent(\"onDragEnd\", () => {\r\n\t\t\tif (!this._draggedCell) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst columnIndexes = this.findColumnsIndexes();\r\n\t\t\tconst targetIndex = columnIndexes.targetIndex;\r\n\t\t\tconst draggedIndex = columnIndexes.draggedIndex;\r\n\t\t\tconst columns = this.$grid.$getConfig().columns;\r\n\r\n\t\t\tconst draggedColumn = columns[draggedIndex];\r\n\t\t\tconst targetColumn = columns[targetIndex];\r\n\t\t\tif (this.$grid.callEvent(\"onColumnDragMove\", [{ draggedColumn, targetColumn, draggedIndex, targetIndex }]) === false) {\r\n\t\t\t\tthis.cleanTargetMarker();\r\n\t\t\t\tthis.$gantt.render();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.$gantt.config.autoscroll = this._originAutoscroll;\r\n\t\t\tthis._draggedCell.classList.remove(\"gantt_grid_head_cell_dragged\");\r\n\t\t\tthis.cleanTargetMarker();\r\n\t\t\tthis.reorderColumns();\r\n\t\t});\r\n\r\n\t}\r\n\treorderColumns() {\r\n\t\tconst { targetIndex, draggedIndex } = this.findColumnsIndexes();\r\n\r\n\t\tconst columns = this.$grid.$getConfig().columns;\r\n\t\tconst draggedColumn = columns[draggedIndex];\r\n\t\tconst targetColumn = columns[targetIndex];\r\n\r\n\t\tif (this.$grid.callEvent(\"onBeforeColumnReorder\", [{ draggedColumn, targetColumn, draggedIndex, targetIndex }]) === false) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (targetIndex === draggedIndex) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcolumns.splice(draggedIndex, 1);\r\n\t\tcolumns.splice(targetIndex, 0, draggedColumn);\r\n\t\tthis.$gantt.render();\r\n\t\tthis.$grid.callEvent(\"onAfterColumnReorder\", [{ draggedColumn, targetColumn, draggedIndex, targetIndex }]);\r\n\t}\r\n\tfindColumnsIndexes() {\r\n\t\tconst draggedId = this._dnd.config.column;\r\n\t\tconst columns = this.$grid.$getConfig().columns;\r\n\t\tlet targetIndex: number;\r\n\t\tlet draggedIndex: number;\r\n\t\tlet xBefore: number;\r\n\t\tlet xAfter: number;\r\n\t\tconst currentColumn = { startX: 0, endX: 0 };\r\n\r\n\t\tlet start = 0;\r\n\t\tlet end = columns.length - 1;\r\n\t\tlet compare = (a, b) => a <= b;\r\n\t\tlet next = (index) => ++index;\r\n\t\tif (this.$gantt.config.rtl) {\r\n\t\t\tstart = columns.length - 1;\r\n\t\t\tend = 0;\r\n\t\t\tcompare = (a, b) => a >= b;\r\n\t\t\tnext = (index) => --index;\r\n\t\t}\r\n\r\n\t\tlet columnRelativePos: number;\r\n\r\n\t\tconst relativeX = this._dragX - this.$grid.$grid.getBoundingClientRect().left + this._scrollableGrid.getCorrection();\r\n\t\tfor (let i = start; compare(i, end); i = next(i)) {\r\n\t\t\tif (targetIndex !== undefined && draggedIndex !== undefined) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif(!columns[i].hide) {\r\n\t\t\t\tcurrentColumn.startX = currentColumn.endX;\r\n\t\t\t\tcurrentColumn.endX += columns[i].width;\r\n\r\n\t\t\t\t// if drop on a column or drop after the last column\r\n\t\t\t\tif (relativeX >= currentColumn.startX && (relativeX <= currentColumn.endX || !compare(next(i), end))) {\r\n\t\t\t\t\ttargetIndex = i;\r\n\t\t\t\t\txBefore = currentColumn.startX;\r\n\t\t\t\t\txAfter = currentColumn.endX;\r\n\t\t\t\t\tcolumnRelativePos = (relativeX - currentColumn.startX) / (currentColumn.endX - currentColumn.startX);\r\n\t\t\t\t}\r\n\t\t\t\tif (draggedId === columns[i].name) {\r\n\t\t\t\t\tdraggedIndex = i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\ttargetIndex,\r\n\t\t\tdraggedIndex,\r\n\t\t\txBefore,\r\n\t\t\txAfter,\r\n\t\t\tcolumnRelativePos\r\n\t\t};\r\n\t}\r\n\tsetMarkerPosition(x: number, y: number = 10) {\r\n\t\tconst { marker } = this._dnd.config;\r\n\t\tconst gridOffset = this._dnd._obj.getBoundingClientRect();\r\n\t\tmarker.style.top = `${gridOffset.y + y}px`;\r\n\t\tmarker.style.left = `${x}px`;\r\n\t}\r\n\tcalculateCurrentPosition = (eventX: number) => {\r\n\t\tconst gridBoundingRect = this.$grid.$grid.getBoundingClientRect();\r\n\t\tconst maxLeft = gridBoundingRect.right;\r\n\t\tconst minLeft = gridBoundingRect.left;\r\n\t\tlet x = eventX;\r\n\t\tif (x > maxLeft) {\r\n\t\t\tx = maxLeft;\r\n\t\t}\r\n\t\tif (x < minLeft) {\r\n\t\t\tx = minLeft;\r\n\t\t}\r\n\t\treturn x;\r\n\t};\r\n\tdrawTargetMarker({ targetIndex, draggedIndex, xBefore, xAfter, columnRelativePos }) {\r\n\t\tif (!this._targetMarker) {\r\n\t\t\tthis._targetMarker = document.createElement(\"div\");\r\n\t\t\tdomHelpers.addClassName(this._targetMarker, \"gantt_grid_target_marker\");\r\n\t\t\tthis._targetMarker.style.display = \"none\";\r\n\t\t\tthis._targetMarker.style.height = `${this._gridConfig.scale_height}px`;\r\n\t\t}\r\n\r\n\t\t// marker can be detached after gantt.render\r\n\t\tif(!this._targetMarker.parentNode){\r\n\t\t\tthis.$grid.$grid_scale.appendChild(this._targetMarker);\r\n\t\t}\r\n\r\n\t\tlet nextPosition: number;\r\n\t\tif (targetIndex > draggedIndex) {\r\n\t\t\tnextPosition = xAfter;\r\n\t\t} else if (targetIndex < draggedIndex) {\r\n\t\t\tnextPosition = xBefore;\r\n\t\t} else {\r\n\t\t\tif(columnRelativePos > 0.5){\r\n\t\t\t\tnextPosition = xAfter;\r\n\t\t\t}else{\r\n\t\t\t\tnextPosition = xBefore;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._targetMarker.style.left = `${nextPosition}px`;\r\n\t\tthis._targetMarker.style.display = \"block\";\r\n\t}\r\n\tcleanTargetMarker() {\r\n\t\tif (this._targetMarker && this._targetMarker.parentNode) {\r\n\t\t\tthis.$grid.$grid_scale.removeChild(this._targetMarker);\r\n\t\t}\r\n\t\tthis._targetMarker = null;\r\n\t}\r\n}","function create(gantt){\r\n\tvar events = [];\r\n\r\n\treturn {\r\n\t\tdelegate:function(event, className, handler, root) {\r\n\t\t\tevents.push([event, className, handler, root]);\r\n\r\n\t\t\tvar helper = gantt.$services.getService(\"mouseEvents\");\r\n\t\t\thelper.delegate(event, className, handler, root);\r\n\t\t},\r\n\t\tdestructor: function(){\r\n\t\t\tvar mouseEvents = gantt.$services.getService(\"mouseEvents\");\r\n\t\t\tfor(var i = 0; i < events.length; i++){\r\n\t\t\t\tvar h = events[i];\r\n\t\t\t\tmouseEvents.detach(h[0], h[1], h[2], h[3]);\r\n\t\t\t}\r\n\t\t\tevents = [];\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default create;","import * as domHelpers from \"../utils/dom_helpers\";\r\nimport * as utils from \"../../../utils/utils\";\r\nimport eventable from \"../../../utils/eventable\";\r\nimport gridResize from \"./grid_resize\";\r\nimport topPositionMixin from \"../row_position_mixin\";\r\nimport rowResize from \"./task_grid_row_resize\";\r\n\r\nimport ColumnDnd from \"../plugins/column_grid_dnd\";\r\n\r\nimport mouseEventContainer from \"../mouse_event_container\";\r\n\r\nvar Grid = function (parent, config, factory, gantt) {\r\n\tthis.$config = utils.mixin({}, config || {});\r\n\tthis.$gantt = gantt;\r\n\tthis.$parent = parent;\r\n\teventable(this);\r\n\tthis.$state = {};\r\n\tutils.mixin(this, topPositionMixin(this));\r\n};\r\n\r\n\r\nGrid.prototype = {\r\n\tinit: function(container) {\r\n\t\tvar gantt = this.$gantt;\r\n\t\tvar gridAriaAttr = gantt._waiAria.gridAttrString();\r\n\t\tvar gridDataAriaAttr = gantt._waiAria.gridDataAttrString();\r\n\t\tvar _ganttConfig = this.$getConfig();\r\n\t\tvar reorderColumns = _ganttConfig.reorder_grid_columns || false;\r\n\t\tif (this.$config.reorder_grid_columns !== undefined) {\r\n\t\t\treorderColumns = this.$config.reorder_grid_columns;\r\n\t\t}\r\n\r\n\r\n\t\tcontainer.innerHTML = \"<div class='gantt_grid' style='height:inherit;width:inherit;' \" + gridAriaAttr + \"></div>\";\r\n\t\tthis.$grid = container.childNodes[0];\r\n\r\n\t\tthis.$grid.innerHTML = \"<div class='gantt_grid_scale' \" +\r\n\t\t\tgantt._waiAria.gridScaleRowAttrString() + \"></div><div class='gantt_grid_data' \" + gridDataAriaAttr + \"></div>\";\r\n\r\n\t\tthis.$grid_scale = this.$grid.childNodes[0];\r\n\t\tthis.$grid_data = this.$grid.childNodes[1];\r\n\r\n\t\tvar attr = _ganttConfig[this.$config.bind + \"_attribute\"];\r\n\t\tif (!attr && this.$config.bind) {\r\n\t\t\tattr = \"data-\" + this.$config.bind + \"-id\";\r\n\t\t}\r\n\t\tthis.$config.item_attribute = attr || null;\r\n\r\n\t\tif (!this.$config.layers) {\r\n\t\t\tvar layers = this._createLayerConfig();\r\n\t\t\tthis.$config.layers = layers;\r\n\t\t}\r\n\r\n\t\tvar resizer = gridResize(gantt, this);\r\n\t\tresizer.init();\r\n\t\tthis._renderHeaderResizers = resizer.doOnRender;\r\n\t\tthis._mouseDelegates = mouseEventContainer(gantt);\r\n\r\n\t\tvar resizerrow = rowResize(gantt, this);\r\n\t\tresizerrow.init();\r\n\r\n\t\tthis._addLayers(this.$gantt);\r\n\t\tthis._initEvents();\r\n\r\n\t\tif (reorderColumns) {\r\n\t\t\tthis._columnDND = new ColumnDnd(gantt, this);\r\n\t\t\tthis._columnDND.init();\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onReady\", []);\r\n\t\t//this.refresh();\r\n\t},\r\n\r\n\t_validateColumnWidth: function (column, property) {\r\n\t\t// user can set {name:\"text\", width:\"200\",...} for some reason,\r\n\t\t// check and convert it to number when possible\r\n\t\tvar value = column[property];\r\n\t\tif (value && value != \"*\") {\r\n\t\t\tvar gantt = this.$gantt;\r\n\t\t\tvar numericWidth = value * 1;\r\n\t\t\tif (isNaN(numericWidth)) {\r\n\t\t\t\tgantt.assert(false, \"Wrong \" + property + \" value of column \" + column.name);\r\n\t\t\t} else {\r\n\t\t\t\tcolumn[property] = numericWidth;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tsetSize: function (width, height) {\r\n\t\tthis.$config.width = this.$state.width = width;\r\n\t\tthis.$config.height = this.$state.height = height;\r\n\r\n\t\t// TODO: maybe inherit and override in a subclass instead of extending here\r\n\r\n\t\tvar columns = this.getGridColumns(),\r\n\t\t\tinnerWidth = 0;\r\n\r\n\t\tvar config = this.$getConfig();\r\n\t\tvar elasticColumns = config.grid_elastic_columns;\r\n\r\n\t\tfor (var i = 0, l = columns.length; i < l; i++) {\r\n\t\t\tthis._validateColumnWidth(columns[i], \"min_width\");\r\n\t\t\tthis._validateColumnWidth(columns[i], \"max_width\");\r\n\t\t\tthis._validateColumnWidth(columns[i], \"width\");\r\n\r\n\t\t\tinnerWidth += columns[i].width * 1;\r\n\t\t}\r\n\r\n\t\tvar outerWidth;\r\n\t\tif (isNaN(innerWidth) || !this.$config.scrollable) {\r\n\t\t\touterWidth = this._setColumnsWidth(width + 1);\r\n\t\t\tinnerWidth = outerWidth;\r\n\t\t}\r\n\r\n\t\tif(this.$config.scrollable && elasticColumns && !isNaN(innerWidth)){\r\n\t\t\t// GS-1352: Allow resizing the grid columns, then the grid width is increased\r\n\t\t\t// or keep the grid width, but don't allow column resize to affect the grid width\r\n\t\t\tlet columnProperty = \"width\";\r\n\t\t\tif (elasticColumns == \"min_width\"){\r\n\t\t\t\tcolumnProperty = \"min_width\";\r\n\t\t\t}\r\n\t\t\tlet newColumnWidth = 0;\r\n\t\t\tcolumns.forEach(function(col){\r\n\t\t\t\tnewColumnWidth += col[columnProperty] || config.min_grid_column_width;\r\n\t\t\t});\r\n\t\t\t//newColumnWidth--; // the total column width shouldn't match the outerWidth // GS-2190 reducing width seems to be not needed\r\n\t\t\tvar columnsWidth = Math.max(newColumnWidth, width);\r\n\t\t\tinnerWidth = this._setColumnsWidth(columnsWidth);\r\n\t\t\touterWidth = width;\r\n\t\t}\r\n\r\n\t\tif (this.$config.scrollable) {\r\n\t\t\tthis.$grid_scale.style.width = innerWidth + \"px\";\r\n\t\t\tthis.$grid_data.style.width = innerWidth + \"px\";\r\n\t\t} else {\r\n\t\t\tthis.$grid_scale.style.width = \"inherit\";\r\n\t\t\tthis.$grid_data.style.width = \"inherit\";\r\n\t\t}\r\n\t\tthis.$config.width -= 1;\r\n\r\n\t\tvar config = this.$getConfig();\r\n\t\tif (outerWidth !== width) {\r\n\t\t\tif(outerWidth !== undefined){\r\n\t\t\t\tconfig.grid_width = outerWidth;\r\n\t\t\t\tthis.$config.width = outerWidth - 1;\r\n\t\t\t}else{\r\n\t\t\t\tif(!isNaN(innerWidth)){\r\n\t\t\t\t\tthis._setColumnsWidth(innerWidth);\r\n\t\t\t\t\tconfig.grid_width = innerWidth;\r\n\t\t\t\t\tthis.$config.width = innerWidth - 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar dataHeight = Math.max(this.$state.height - config.scale_height, 0);\r\n\t\tthis.$grid_data.style.height = dataHeight + \"px\";\r\n\t\tthis.refresh();\r\n\t},\r\n\tgetSize: function () {\r\n\r\n\t\tvar config = this.$getConfig();\r\n\r\n\t\tvar store = this.$config.rowStore;\r\n\r\n\t\tvar contentHeight = store ? this.getTotalHeight() : 0,\r\n\t\t\tcontentWidth = this._getGridWidth();\r\n\r\n\t\tvar size = {\r\n\t\t\tx: this.$state.width,\r\n\t\t\ty: this.$state.height,\r\n\t\t\tcontentX: this.isVisible() ? contentWidth : 0,\r\n\t\t\tcontentY: this.isVisible() ? (config.scale_height + contentHeight) : 0,\r\n\t\t\tscrollHeight: this.isVisible() ? contentHeight : 0,\r\n\t\t\tscrollWidth: this.isVisible() ? contentWidth : 0\r\n\t\t};\r\n\r\n\t\treturn size;\r\n\t},\r\n\r\n\t_bindStore: function () {\r\n\t\tif (this.$config.bind){\r\n\t\t\tvar rowStore = this.$gantt.getDatastore(this.$config.bind);\r\n\t\t\tthis.$config.rowStore = rowStore;\r\n\t\t\tif(rowStore && !rowStore._gridCacheAttached){\r\n\t\t\t\tvar self = this;\r\n\t\t\t\trowStore._gridCacheAttached = rowStore.attachEvent(\"onBeforeFilter\", function(){\r\n\t\t\t\t\tself._resetTopPositionHeight();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t_unbindStore: function(){\r\n\t\tif (this.$config.bind){\r\n\t\t\tvar rowStore = this.$gantt.getDatastore(this.$config.bind);\r\n\t\t\tif(rowStore && rowStore._gridCacheAttached){\r\n\t\t\t\trowStore.detachEvent(rowStore._gridCacheAttached);\r\n\t\t\t\trowStore._gridCacheAttached = false;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\trefresh: function () {\r\n\t\tthis._bindStore();\r\n\r\n\t\tthis._resetTopPositionHeight();\r\n\t\tthis._resetHeight();\r\n\t\tthis._initSmartRenderingPlaceholder();\r\n\r\n\t\tthis._calculateGridWidth();\r\n\t\tthis._renderGridHeader();\r\n\t},\r\n\r\n\tgetViewPort: function(){\r\n\t\tvar scrollLeft = this.$config.scrollLeft || 0;\r\n\t\tvar scrollTop = this.$config.scrollTop || 0;\r\n\t\tvar height = this.$config.height || 0;\r\n\t\tvar width = this.$config.width || 0;\r\n\t\treturn {\r\n\t\t\ty: scrollTop,\r\n\t\t\ty_end: scrollTop + height,\r\n\t\t\tx: scrollLeft,\r\n\t\t\tx_end: scrollLeft + width,\r\n\t\t\theight: height,\r\n\t\t\twidth: width\r\n\t\t};\r\n\t},\r\n\r\n\tscrollTo: function (left, top) {\r\n\t\tif (!this.isVisible())\r\n\t\t\treturn;\r\n\r\n\t\tvar scrolled = false;\r\n\r\n\t\tthis.$config.scrollTop = this.$config.scrollTop || 0;\r\n\t\tthis.$config.scrollLeft = this.$config.scrollLeft || 0;\r\n\r\n\t\tif (left * 1 == left) {\r\n\t\t\tthis.$config.scrollLeft = this.$state.scrollLeft = this.$grid.scrollLeft = left;\r\n\t\t\tscrolled = true;\r\n\t\t}\r\n\r\n\t\t// var config = this.$getConfig();\r\n\t\tif (top * 1 == top) {\r\n\t\t\tthis.$config.scrollTop = this.$state.scrollTop = this.$grid_data.scrollTop = top;\r\n\t\t\tscrolled = true;\r\n\t\t}\r\n\r\n\t\tif(scrolled){\r\n\t\t\tthis.callEvent(\"onScroll\", [this.$config.scrollLeft, this.$config.scrollTop]);\r\n\t\t}\r\n\t},\r\n\r\n\tgetColumnIndex: function (name, excludeHidden) {\r\n\t\tvar columns = this.$getConfig().columns;\r\n\t\tvar hiddenIndexShift = 0;\r\n\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\t// GS-1257. If the cell is hidden, the target column index should be correct\r\n\t\t\tif (excludeHidden && columns[i].hide){\r\n\t\t\t\thiddenIndexShift++;\r\n\t\t\t}\r\n\t\t\tif (columns[i].name == name) {\r\n\t\t\t\treturn i - hiddenIndexShift;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\tgetColumn: function (name) {\r\n\t\tvar index = this.getColumnIndex(name);\r\n\t\tif (index === null) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn this.$getConfig().columns[index];\r\n\t},\r\n\r\n\tgetGridColumns: function () {\r\n\t\tvar config = this.$getConfig();\r\n\t\treturn config.columns.slice();\r\n\t},\r\n\tisVisible: function () {\r\n\t\tif (this.$parent && this.$parent.$config) {\r\n\t\t\treturn !this.$parent.$config.hidden;\r\n\t\t} else {\r\n\t\t\treturn this.$grid.offsetWidth;\r\n\t\t}\r\n\t},\r\n\r\n\t// getItemHeight: function () {\r\n\t// \tvar config = this.$getConfig();\r\n\t// \treturn config.row_height;\r\n\t// },\r\n\r\n\t_createLayerConfig: function () {\r\n\t\tvar gantt = this.$gantt;\r\n\t\tvar self = this;\r\n\t\tvar layers = [\r\n\t\t\t{\r\n\t\t\t\trenderer: gantt.$ui.layers.gridLine(),\r\n\t\t\t\tcontainer: this.$grid_data,\r\n\t\t\t\tfilter: [function () {\r\n\t\t\t\t\treturn self.isVisible();\r\n\t\t\t\t}]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\trenderer: gantt.$ui.layers.gridTaskRowResizer(),\r\n\t\t\t\tcontainer: this.$grid_data,\r\n\t\t\t\tappend: true,\r\n\t\t\t\tfilter: [function () {\r\n\t\t\t\t\treturn gantt.config.resize_rows;\r\n\t\t\t\t}]\r\n\t\t\t}\r\n\t\t];\r\n\t\treturn layers;\r\n\t},\r\n\r\n\t_addLayers: function (gantt) {\r\n\t\tif (!this.$config.bind)\r\n\t\t\treturn;\r\n\r\n\t\tthis._taskLayers = [];\r\n\r\n\t\tvar self = this;\r\n\r\n\t\tvar layers = this.$gantt.$services.getService(\"layers\");\r\n\t\tvar taskRenderer = layers.getDataRender(this.$config.bind);\r\n\r\n\t\tif (!taskRenderer) {\r\n\t\t\ttaskRenderer = layers.createDataRender({\r\n\t\t\t\tname: this.$config.bind,\r\n\t\t\t\tdefaultContainer: function () { return self.$grid_data; }\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tvar taskLayers = this.$config.layers;\r\n\t\tfor (var i = 0; taskLayers && i < taskLayers.length; i++) {\r\n\t\t\tvar layer = taskLayers[i];\r\n\t\t\tlayer.view = this;\r\n\r\n\t\t\tvar bar_layer = taskRenderer.addLayer(layer);\r\n\t\t\tthis._taskLayers.push(bar_layer);\r\n\t\t}\r\n\r\n\t\tthis._bindStore();\r\n\r\n\t\tthis._initSmartRenderingPlaceholder();\r\n\t},\r\n\r\n\t_refreshPlaceholderOnStoreUpdate: function (id) {\r\n\t\tvar config = this.$getConfig(),\r\n\t\t\tstore = this.$config.rowStore;\r\n\r\n\t\tif (!store || id !== null || !this.isVisible() || !config.smart_rendering) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar contentHeight;\r\n\t\tif (this.$config.scrollY) {\r\n\t\t\tvar scroll = this.$gantt.$ui.getView(this.$config.scrollY);\r\n\t\t\tif (scroll)\r\n\t\t\t\tcontentHeight = scroll.getScrollState().scrollSize;\r\n\t\t}\r\n\r\n\t\tif (!contentHeight) {\r\n\t\t\tcontentHeight = store ? this.getTotalHeight() : 0;\r\n\t\t}\r\n\r\n\t\tif (contentHeight) {\r\n\t\t\tif (this.$rowsPlaceholder && this.$rowsPlaceholder.parentNode) {\r\n\t\t\t\tthis.$rowsPlaceholder.parentNode.removeChild(this.$rowsPlaceholder);\r\n\t\t\t}\r\n\r\n\t\t\tvar placeholder = this.$rowsPlaceholder = document.createElement(\"div\");\r\n\t\t\tplaceholder.style.visibility = \"hidden\";\r\n\t\t\tplaceholder.style.height = contentHeight + \"px\";\r\n\t\t\tplaceholder.style.width = \"1px\";\r\n\t\t\tthis.$grid_data.appendChild(placeholder);\r\n\t\t}\r\n\t},\r\n\r\n\t_initSmartRenderingPlaceholder: function () {\r\n\t\tvar store = this.$config.rowStore;\r\n\t\tif (!store) {\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tthis._initSmartRenderingPlaceholder = function () { };\r\n\t\t}\r\n\t\tthis._staticBgHandler = store.attachEvent(\"onStoreUpdated\", utils.bind(this._refreshPlaceholderOnStoreUpdate, this));\r\n\t},\r\n\r\n\t_initEvents: function () {\r\n\t\tvar gantt = this.$gantt;\r\n\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_close\", gantt.bind(function (e, id, trg) {\r\n\t\t\tvar store = this.$config.rowStore;\r\n\t\t\tif (!store) return true;\r\n\r\n\t\t\tvar target = domHelpers.locateAttribute(e, this.$config.item_attribute);\r\n\t\t\tif (target) {\r\n\t\t\t\tstore.close(target.getAttribute(this.$config.item_attribute));\r\n\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}, this), this.$grid);\r\n\r\n\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_open\", gantt.bind(function (e, id, trg) {\r\n\t\t\tvar store = this.$config.rowStore;\r\n\t\t\tif (!store) return true;\r\n\r\n\t\t\tvar target = domHelpers.locateAttribute(e, this.$config.item_attribute);\r\n\t\t\tif (target) {\r\n\t\t\t\tstore.open(target.getAttribute(this.$config.item_attribute));\r\n\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}, this), this.$grid);\r\n\t},\r\n\r\n\t_clearLayers: function (gantt) {\r\n\t\tvar layers = this.$gantt.$services.getService(\"layers\");\r\n\t\tvar taskRenderer = layers.getDataRender(this.$config.bind);\r\n\r\n\t\tif (this._taskLayers) {\r\n\t\t\tfor (var i = 0; i < this._taskLayers.length; i++) {\r\n\t\t\t\ttaskRenderer.removeLayer(this._taskLayers[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._taskLayers = [];\r\n\t},\r\n\r\n\t_getColumnWidth: function (column, config, width) {\r\n\t\tvar min_width = column.min_width || config.min_grid_column_width;\r\n\t\tvar new_width = Math.max(width, min_width || 10);\r\n\t\tif (column.max_width)\r\n\t\t\tnew_width = Math.min(new_width, column.max_width);\r\n\t\treturn new_width;\r\n\t},\r\n\t// set min width only if width < than config.min_grid_column_width\r\n\t_checkGridColumnMinWidthLimits: function (columns, config) {\r\n\t\tfor (var i = 0, l = columns.length; i < l; i++) {\r\n\t\t\tvar width = columns[i].width * 1;\r\n\t\t\tif (!columns[i].min_width && width < config.min_grid_column_width){\r\n\t\t\t\tcolumns[i].min_width = width;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t// return min and max possible grid width according to restricts\r\n\t_getGridWidthLimits: function () {\r\n\t\tvar config = this.$getConfig(),\r\n\t\t\tcolumns = this.getGridColumns(),\r\n\t\t\tmin_limit = 0,\r\n\t\t\tmax_limit = 0;\r\n\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tmin_limit += columns[i].min_width ? columns[i].min_width : config.min_grid_column_width;\r\n\t\t\tif (max_limit !== undefined) {\r\n\t\t\t\tmax_limit = columns[i].max_width ? (max_limit + columns[i].max_width) : undefined;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._checkGridColumnMinWidthLimits(columns, config); // FIX ME: should it be before calculating limits?\r\n\t\treturn [min_limit, max_limit];\r\n\t},\r\n\t// resize columns to get total newWidth, starting from columns[start_index]\r\n\t_setColumnsWidth: function (newWidth, start_index) {\r\n\t\tvar config = this.$getConfig();\r\n\t\tvar columns = this.getGridColumns(),\r\n\t\t\tcolumns_width = 0,\r\n\t\t\tfinal_width = newWidth;\r\n\r\n\t\tstart_index = !window.isNaN(start_index) ? start_index : -1;\r\n\r\n\t\tfor (var i = 0, l = columns.length; i < l; i++) {\r\n\t\t\tcolumns_width += columns[i].width * 1;\r\n\t\t}\r\n\r\n\t\tif (window.isNaN(columns_width)) {\r\n\t\t\tthis._calculateGridWidth();\r\n\t\t\tcolumns_width = 0;\r\n\t\t\tfor (var i = 0, l = columns.length; i < l; i++) {\r\n\t\t\t\tcolumns_width += columns[i].width * 1;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar extra_width = final_width - columns_width;\r\n\r\n\t\tvar start_width = 0;\r\n\t\tfor (var i = 0; i < start_index + 1; i++) {\r\n\t\t\tstart_width += columns[i].width;\r\n\t\t}\r\n\r\n\t\tcolumns_width -= start_width;\r\n\r\n\t\tfor (var i = start_index + 1; i < columns.length; i++) {\r\n\r\n\t\t\tvar col = columns[i];\r\n\t\t\tvar share = Math.round(extra_width * (col.width / columns_width));\r\n\r\n\t\t\t// columns have 2 additional restrict fields - min_width & max_width that are set by user\r\n\t\t\tif (extra_width < 0) {\r\n\t\t\t\tif (col.min_width && col.width + share < col.min_width)\r\n\t\t\t\t\tshare = col.min_width - col.width;\r\n\t\t\t\telse if (!col.min_width && config.min_grid_column_width && col.width + share < config.min_grid_column_width)\r\n\t\t\t\t\tshare = config.min_grid_column_width - col.width;\r\n\t\t\t} else if (col.max_width && col.width + share > col.max_width)\r\n\t\t\t\tshare = col.max_width - col.width;\r\n\r\n\t\t\tcolumns_width -= col.width;\r\n\t\t\tcol.width += share;\r\n\t\t\textra_width -= share;\r\n\r\n\t\t}\r\n\r\n\t\tvar iterator = extra_width > 0 ? 1 : -1;\r\n\t\twhile ((extra_width > 0 && iterator === 1) || (extra_width < 0 && iterator === -1)) {\r\n\t\t\tvar curExtra = extra_width;\r\n\t\t\tfor (i = start_index + 1; i < columns.length; i++) {\r\n\t\t\t\tvar new_width = columns[i].width + iterator;\r\n\r\n\t\t\t\tif (new_width == this._getColumnWidth(columns[i], config, new_width)) {\r\n\t\t\t\t\textra_width -= iterator;\r\n\t\t\t\t\tcolumns[i].width = new_width;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!extra_width)\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif (curExtra == extra_width)\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t// if impossible to resize the right-side columns, resize the start column\r\n\t\tif (extra_width && start_index > -1) {\r\n\t\t\tvar new_width = columns[start_index].width + extra_width;\r\n\t\t\tif (new_width == this._getColumnWidth(columns[start_index], config, new_width))\r\n\t\t\t\tcolumns[start_index].width = new_width;\r\n\t\t}\r\n\r\n\t\t//if (this.callEvent(\"onGridResizeEnd\", [config.grid_width, final_width]) === false)\r\n\t\t//\treturn;\r\n\r\n\t\treturn this._getColsTotalWidth();\r\n\t},\r\n\r\n\t_getColsTotalWidth: function () {\r\n\t\tvar columns = this.getGridColumns();\r\n\t\tvar cols_width = 0;\r\n\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tvar v = parseFloat(columns[i].width);\r\n\t\t\tif (window.isNaN(v)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tcols_width += v;\r\n\t\t}\r\n\t\treturn cols_width;\r\n\t},\r\n\t_calculateGridWidth: function () {\r\n\t\tvar config = this.$getConfig();\r\n\t\tvar columns = this.getGridColumns();\r\n\t\tvar cols_width = 0;\r\n\t\tvar unknown = [];\r\n\t\tvar width = [];\r\n\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tvar v = parseFloat(columns[i].width);\r\n\t\t\tif (window.isNaN(v)) {\r\n\t\t\t\tv = config.min_grid_column_width || 10;\r\n\t\t\t\tunknown.push(i);\r\n\t\t\t}\r\n\t\t\twidth[i] = v;\r\n\t\t\tcols_width += v;\r\n\t\t}\r\n\t\tvar gridWidth = this._getGridWidth() + 1;\r\n\t\tif (config.autofit || unknown.length) {\r\n\t\t\tvar diff = gridWidth - cols_width;\r\n\t\t\t// TODO: logic may be improved for proportional changing of width\r\n\r\n\t\t\t// autofit adjusts columns widths to the outer grid width\r\n\t\t\t// it doesn't makes sense if grid has inner scroll with elastic columns\r\n\t\t\tif (config.autofit && !config.grid_elastic_columns) {\r\n\t\t\t\t// delta must be added for all columns\r\n\t\t\t\tfor (var i = 0; i < width.length; i++) {\r\n\t\t\t\t\tvar delta = Math.round(diff / (width.length - i));\r\n\t\t\t\t\twidth[i] += delta;\r\n\t\t\t\t\tvar new_width = this._getColumnWidth(columns[i], config, width[i]);\r\n\r\n\t\t\t\t\tif (new_width != width[i]) {\r\n\t\t\t\t\t\tdelta = new_width - width[i];\r\n\t\t\t\t\t\twidth[i] = new_width;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdiff -= delta;\r\n\t\t\t\t}\r\n\t\t\t} else if (unknown.length) {\r\n\t\t\t\t// there are several columns with undefined width\r\n\t\t\t\tfor (var i = 0; i < unknown.length; i++) {\r\n\t\t\t\t\tvar delta = Math.round(diff / (unknown.length - i)); // no float values, just integer\r\n\t\t\t\t\tvar index = unknown[i];\r\n\t\t\t\t\twidth[index] += delta;\r\n\t\t\t\t\tvar new_width = this._getColumnWidth(columns[index], config, width[index]);\r\n\t\t\t\t\tif (new_width != width[index]) {\r\n\t\t\t\t\t\tdelta = new_width - width[index];\r\n\t\t\t\t\t\twidth[index] = new_width;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdiff -= delta;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0; i < width.length; i++) {\r\n\t\t\t\tcolumns[i].width = width[i];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar changed = (gridWidth != cols_width);\r\n\t\t\tthis.$config.width = cols_width - 1;\r\n\t\t\tconfig.grid_width = cols_width;\r\n\t\t\tif (changed) {\r\n\t\t\t\tthis.$parent._setContentSize(this.$config.width, null);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t_renderGridHeader: function () {\r\n\t\tvar gantt = this.$gantt;\r\n\t\tvar config = this.$getConfig();\r\n\t\tvar locale = this.$gantt.locale;\r\n\t\tvar templates = this.$gantt.templates;\r\n\r\n\t\tvar columns = this.getGridColumns();\r\n\t\tif (config.rtl) {\r\n\t\t\tcolumns = columns.reverse();\r\n\t\t}\r\n\t\tvar cells = [];\r\n\t\tvar width = 0,\r\n\t\t\tlabels = locale.labels;\r\n\r\n\t\tvar lineHeigth = config.scale_height - 1;\r\n\r\n\t\tconst renderableComponents = {};\r\n\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tvar last = i == columns.length - 1;\r\n\t\t\tvar col = columns[i];\r\n\r\n\t\t\t// ensure columns have non-empty names\r\n\t\t\tif (!col.name) {\r\n\t\t\t\tcol.name = gantt.uid() + \"\";\r\n\t\t\t}\r\n\r\n\t\t\tvar colWidth = col.width * 1;\r\n\r\n\t\t\tvar gridWidth = this._getGridWidth();\r\n\t\t\tif (last && gridWidth > width + colWidth)\r\n\t\t\t\tcol.width = colWidth = gridWidth - width;\r\n\t\t\twidth += colWidth;\r\n\t\t\tvar sort = (gantt._sort && col.name == gantt._sort.name) ? (`<div data-column-id=\"${col.name}\" class=\"gantt_sort gantt_${gantt._sort.direction}\"></div>`) : \"\";\r\n\t\t\tvar cssClass = [\"gantt_grid_head_cell\",\r\n\t\t\t\t(\"gantt_grid_head_\" + col.name),\r\n\t\t\t\t(last ? \"gantt_last_cell\" : \"\"),\r\n\t\t\t\ttemplates.grid_header_class(col.name, col)].join(\" \");\r\n\r\n\t\t\tvar style = \"width:\" + (colWidth - (last ? 1 : 0)) + \"px;\";\r\n\t\t\tvar label = (col.label || labels[\"column_\" + col.name] || labels[col.name]);\r\n\t\t\tif(typeof label === \"function\"){\r\n\t\t\t\tlabel = label.call(gantt, col.name, col);\r\n\t\t\t}\r\n\t\t\tlabel = label || \"\";\r\n\t\t\tlet componentLabel = false;\r\n\t\t\tif(gantt.config.external_render && gantt.config.external_render.isElement(label)){\r\n\t\t\t\tcomponentLabel = true;\r\n\t\t\t\trenderableComponents[col.name] = label;\r\n\t\t\t}\r\n\r\n\t\t\tvar ariaAttrs = gantt._waiAria.gridScaleCellAttrString(col, label);\r\n\r\n\t\t\tvar cell = \"<div class='\" + cssClass + \"' style='\" + style + \"' \" + ariaAttrs + \r\n\t\t\t\t\" data-column-id='\" + col.name + \"' column_id='\" + col.name + \"'\" +\r\n\t\t\t\t\" data-column-name='\" + col.name + \"' data-column-index='\" + i + \"'\" +\r\n\t\t\t\t\">\" + (!componentLabel ? label : \"<div data-component-container></div>\") + sort + \"</div>\";\r\n\t\t\tcells.push(cell);\r\n\t\t}\r\n\t\tthis.$grid_scale.style.height = (config.scale_height) + \"px\";\r\n\t\tthis.$grid_scale.style.lineHeight = lineHeigth + \"px\";\r\n\t\t//this.$grid_scale.style.width = \"inherit\";\r\n\t\tthis.$grid_scale.innerHTML = cells.join(\"\");\r\n\t\tfor(let i in renderableComponents){\r\n\t\t\tgantt.config.external_render.renderElement(renderableComponents[i], this.$grid_scale.querySelector(\"[data-column-id='\" + i + \"'] [data-component-container]\"));\r\n\t\t}\r\n\r\n\t\tif (this._renderHeaderResizers) {\r\n\t\t\tthis._renderHeaderResizers();\r\n\t\t}\r\n\t},\r\n\r\n\t_getGridWidth: function () {\r\n\t\t// TODO: refactor/remove/comment some of _getGridWidth/this.$config.width/this.$state.width, it's not clear what they do\r\n\t\treturn this.$config.width;\r\n\t},\r\n\r\n\tdestructor: function () {\r\n\t\tthis._clearLayers(this.$gantt);\r\n\t\tif (this._mouseDelegates) {\r\n\t\t\tthis._mouseDelegates.destructor();\r\n\t\t\tthis._mouseDelegates = null;\r\n\t\t}\r\n\t\tthis._unbindStore();\r\n\t\tthis.$grid = null;\r\n\t\tthis.$grid_scale = null;\r\n\t\tthis.$grid_data = null;\r\n\t\tthis.$gantt = null;\r\n\t\tif (this.$config.rowStore) {\r\n\t\t\tthis.$config.rowStore.detachEvent(this._staticBgHandler);\r\n\t\t\tthis.$config.rowStore = null;\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onDestroy\", []);\r\n\t\tthis.detachAllEvents();\r\n\t}\r\n};\r\n\r\nexport default Grid;\r\n","import * as helpers from \"../../utils/helpers\";\r\n\r\nfunction clearTaskStoreHandler(self) {\r\n\tif (self._delayRender) {\r\n\t\tself._delayRender.$cancelTimeout();\r\n\t}\r\n\r\n\tif (!self.$gantt) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar tasks = self.$gantt.$data.tasksStore;\r\n\tvar ownStore = self.$config.rowStore;\r\n\r\n\tif (!ownStore){\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar handlerIdProperty = \"_attached_\" + ownStore.$config.name;\r\n\tif (self[handlerIdProperty]) {\r\n\t\ttasks.detachEvent(self[handlerIdProperty]);\r\n\t\tself[handlerIdProperty] = null;\r\n\t}\r\n\r\n\tif (ownStore.$attachedResourceViewHandler) {\r\n\t\townStore.detachEvent(ownStore.$attachedResourceViewHandler);\r\n\t\townStore.$attachedResourceViewHandler = null;\r\n\r\n\t\ttasks.detachEvent(ownStore.$attachedTaskStoreHandler);\r\n\t\townStore.$attachedTaskStoreHandler = null;\r\n\t}\r\n}\r\n\r\nfunction createMixin(_super){\r\n\r\n\tvar initGrid = _super.prototype.init,\r\n\t\tdestroyGrid = _super.prototype.destructor;\r\n\r\n\treturn {\r\n\t\tinit: function() {\r\n\t\t\tinitGrid.apply(this, arguments);\r\n\t\t\tthis._linkToTaskStore();\r\n\t\t},\r\n\r\n\t\tdestructor: function() {\r\n\t\t\tclearTaskStoreHandler(this);\r\n\t\t\tdestroyGrid.apply(this, arguments);\r\n\t\t},\r\n\r\n\t\tpreviousDragId: null,\r\n\t\trelevantResources: null,\r\n\r\n\t\t_linkToTaskStore: function () {\r\n\t\t\tif (this.$config.rowStore && this.$gantt.$data.tasksStore) {\r\n\t\t\t\tvar tasks = this.$gantt.$data.tasksStore;\r\n\t\t\t\tvar ownStore = this.$config.rowStore;\r\n\t\t\t\tclearTaskStoreHandler(this);\r\n\r\n\t\t\t\tvar self = this;\r\n\t\t\t\tvar delayRender = helpers.delay(function() {\r\n\t\t\t\t\tif (self.$gantt.getState().lightbox) {\r\n\t\t\t\t\t\tdelayRender();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst linkedStore = self.$config.rowStore;\r\n\r\n\t\t\t\t\t\t// Repaint only relevant resources for task drag\r\n\t\t\t\t\t\tconst repaintStack = self._getRelevantResources();\r\n\t\t\t\t\t\t// GS-2822: extra check for resource store\r\n\t\t\t\t\t\tif (repaintStack && linkedStore.$config.name === self.$gantt.config.resource_store){\r\n\t\t\t\t\t\t\tif (repaintStack == \"nothing_to_repaint\"){\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlinkedStore._quick_refresh = true;\r\n\t\t\t\t\t\t\tself.relevantResources.forEach(function(id){\r\n\t\t\t\t\t\t\t\tlinkedStore.refresh(id);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tlinkedStore._quick_refresh = false;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// because rowstore could be changed during timeout\r\n\t\t\t\t\t\t\tlinkedStore.refresh();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 300);\r\n\t\t\t\tthis._delayRender = delayRender;\r\n\t\t\t\tvar handlerIdProperty = \"_attached_\" + ownStore.$config.name;\r\n\r\n\t\t\t\tif (!self[handlerIdProperty]) {\r\n\t\t\t\t\tself[handlerIdProperty] = tasks.attachEvent(\"onStoreUpdated\", function(){\r\n\t\t\t\t\t\tif(!delayRender.$pending && !this._skipResourceRepaint){\r\n\t\t\t\t\t\t\t// don't repaint if we update progress\r\n\t\t\t\t\t\t\tconst state = self.$gantt.getState();\r\n\t\t\t\t\t\t\tif (state.drag_mode == \"progress\"){\r\n\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t} else if (state.drag_mode && state.drag_id){\r\n\t\t\t\t\t\t\t\t// we need it here because if you started dragging a task and quickly stopped the drag_id is removed \r\n\t\t\t\t\t\t\t\t// from the state before we record it, so we cannot repaint only the relevant resources\r\n\t\t\t\t\t\t\t\tself.previousDragId = state.drag_id;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tdelayRender();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.$gantt.attachEvent(\"onDestroy\", function() {\r\n\t\t\t\t\t// detach events to don't call delayed tasks\r\n\t\t\t\t\tclearTaskStoreHandler(self);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (!ownStore.$attachedResourceViewHandler) {\r\n\t\t\t\t\townStore.$attachedResourceViewHandler = ownStore.attachEvent(\"onBeforeFilter\", function() {\r\n\t\t\t\t\t\tif (self.$gantt.getState().lightbox) {\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (delayRender.$pending) {\r\n\t\t\t\t\t\t\tdelayRender.$cancelTimeout();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tself._updateNestedTasks();\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\townStore.$attachedTaskStoreHandler = tasks.attachEvent(\"onAfterDelete\", function(){\r\n\t\t\t\t\t\townStore._mark_recompute = true;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_getRelevantResources: function (){\r\n\t\t\t// GS-2199. process_resource_assignments is disabled,\r\n\t\t\t// so we cannot get only the relevant assignment resources\r\n\t\t\tif (!this.$gantt.getTaskAssignments){\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tconst state = this.$gantt.getState();\r\n\t\t\tconst linkedStore = this.$config.rowStore;\r\n\r\n\t\t\tlet resourceIds = [];\r\n\t\t\tif (state.drag_mode && state.drag_id && linkedStore.$config.name === this.$gantt.config.resource_store){\r\n\t\t\t\tif (this.previousDragId == state.drag_id){ // we continue dragging the task\r\n\t\t\t\t\tif (this.relevantResources) {\r\n\t\t\t\t\t\treturn this.relevantResources;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresourceIds = this._getIdsFromAssignments(this.previousDragId);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse { // we started the task drag\r\n\t\t\t\t\tthis.previousDragId = state.drag_id;\r\n\t\t\t\t\tresourceIds = this._getIdsFromAssignments(this.previousDragId);\r\n\t\t\t\t}\r\n\t\t\t} else if (this.previousDragId){ // finished task drag, but the resources are still the same\r\n\t\t\t\tresourceIds = this._getIdsFromAssignments(this.previousDragId);\r\n\t\t\t\tthis.previousDragId = null;\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tif (!resourceIds.length){\r\n\t\t\t\treturn this.relevantResources = \"nothing_to_repaint\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tresourceIds.forEach(function(resourceId){\r\n\t\t\t\t//GS-2598: linkedstore could be a temp assignment store\r\n\t\t\t\tif(linkedStore.eachParent){\r\n\t\t\t\t\tlinkedStore.eachParent(function(parent){\r\n\t\t\t\t\t\tresourceIds.push(parent.id);\r\n\t\t\t\t\t}, resourceId);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn this.relevantResources = [...new Set(resourceIds)];\r\n\t\t},\r\n\r\n\t\t_getIdsFromAssignments: function(id){\r\n\t\t\tconst gantt = this.$gantt;\r\n\t\t\tconst resourceIds = [];\r\n\r\n\t\t\tconst task = gantt.getTask(id);\r\n\t\t\tlet assignments = gantt.getTaskAssignments(id);\r\n\t\t\tassignments.forEach(function(assignment){\r\n\t\t\t\tresourceIds.push(assignment.resource_id);\r\n\t\t\t});\r\n\r\n\t\t\t// get child assignments when dragging project task\r\n\t\t\tif (gantt.isSummaryTask(task) && gantt.config.drag_project) {\r\n\t\t\t\tgantt.eachTask(function(child){\r\n\t\t\t\t\tconst childAssignments = gantt.getTaskAssignments(child.id);\r\n\t\t\t\t\tchildAssignments.forEach(function(assignment){\r\n\t\t\t\t\t\tresourceIds.push(assignment.resource_id);\r\n\t\t\t\t\t});\r\n\t\t\t\t}, id);\r\n\t\t\t}\r\n\r\n\t\t\t// get assignments of other selected tasks\r\n\t\t\tif (gantt.config.drag_multiple && gantt.getSelectedTasks){\r\n\t\t\t\tconst selectedIds = gantt.getSelectedTasks();\r\n\t\t\t\tselectedIds.forEach(function(selectedId){\r\n\t\t\t\t\tconst selectedAssignments = gantt.getTaskAssignments(selectedId);\r\n\t\t\t\t\tselectedAssignments.forEach(function(assignment){\r\n\t\t\t\t\t\tresourceIds.push(assignment.resource_id);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn resourceIds;\r\n\t\t},\r\n\r\n\t\t_updateNestedTasks: function(){\r\n\t\t\tvar gantt = this.$gantt;\r\n\t\t\tvar resourceStore = gantt.getDatastore(gantt.config.resource_store);\r\n\t\t\tif (!resourceStore.$config.fetchTasks) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tresourceStore.silent(function(){\r\n\t\t\t\tvar toAddArray = [];\r\n\t\t\t\tvar toAdd = {};\r\n\t\t\t\tvar toDelete = {};\r\n\r\n\t\t\t\tresourceStore.eachItem(function(resource){\r\n\t\t\t\t\tif (resource.$role == \"task\") {\r\n\t\t\t\t\t\ttoDelete[resource.id] = true;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar assignments = gantt.getResourceAssignments(resource.id);\r\n\t\t\t\t\tvar addedTasks = {};\r\n\r\n\t\t\t\t\t// GS-1505. We need to sort assignments before updating tasks. \r\n\t\t\t\t\t// Iterating them without that will affect the order of featched tasks in the resource store\r\n\t\t\t\t\tassignments.sort(function (a, b) {\r\n\t\t\t\t\t\tconst resourceData = resourceStore.pull;\r\n\t\t\t\t\t\tconst resource1 = resourceData[`${a.task_id}_${a.resource_id}`];\r\n\t\t\t\t\t\tconst resource2 = resourceData[`${b.task_id}_${b.resource_id}`];\r\n\t\t\t\t\t\tif (resource1 && resource2) {\r\n\t\t\t\t\t\t\treturn resource1.$local_index - resource2.$local_index;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tassignments.forEach(function(a) {\r\n\t\t\t\t\t\tif(addedTasks[a.task_id] || !gantt.isTaskExists(a.task_id)){\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\taddedTasks[a.task_id] = true;\r\n\r\n\t\t\t\t\t\tvar task = gantt.getTask(a.task_id);\r\n\t\t\t\t\t\tvar copy;\r\n\t\t\t\t\t\t//GS-2711: deep copy from task\r\n\t\t\t\t\t\tif(resourceStore.$config.copyOnParse){\r\n\t\t\t\t\t\t\tcopy = gantt.copy(task);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcopy = Object.create(task);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tcopy.id = task.id + '_' + resource.id;\r\n\r\n\t\t\t\t\t\tcopy.$task_id = task.id;\r\n\t\t\t\t\t\tcopy.$resource_id = resource.id;\r\n\t\t\t\t\t\tcopy[resourceStore.$parentProperty] = resource.id;\r\n\t\t\t\t\t\tcopy.$role = \"task\";\r\n\t\t\t\t\t\ttoAddArray.push(copy);\r\n\t\t\t\t\t\ttoAdd[copy.id] = true;\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\tfor (var id in toDelete) {\r\n\t\t\t\t\tif (!toAdd[id]) {\r\n\t\t\t\t\t\tresourceStore.removeItem(id);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(toAddArray.length){\r\n\t\t\t\t\tresourceStore.parse(toAddArray);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default createMixin;","import domEventScope from \"../../ui/utils/dom_event_scope\";\r\nimport * as utils from \"../../../utils/utils\";\r\nimport resourceStoreMixin from \"../resource_store_mixin\";\r\nimport Grid from \"./grid\";\r\nimport __extends from \"../../../utils/extends\";\r\n\r\nconst GridRL = (function (_super) {\r\n\r\n\tfunction GridRL(parent, config, factory, gantt) {\r\n\t\treturn _super.apply(this, arguments) || this;\r\n\t}\r\n\r\n\t__extends(GridRL, _super);\r\n\r\n\tutils.mixin(GridRL.prototype, {\r\n\t\tinit: function(container) {\r\n\t\t\tconst gantt = this.$gantt;\r\n\t\t\tconst gridAriaAttr = gantt._waiAria.gridAttrString();\r\n\t\t\tconst gridDataAriaAttr = gantt._waiAria.gridDataAttrString();\r\n\t\t\tconst _ganttConfig = this.$getConfig();\r\n\t\t\t_ganttConfig.row_height = this._getResourceConfig().row_height ? this._getResourceConfig().row_height : gantt.resource_table.row_height ;\r\n\t\t\tlet reorderColumns = _ganttConfig.reorder_grid_columns || false;\r\n\t\t\tif (this.$config.reorder_grid_columns !== undefined) {\r\n\t\t\t\treorderColumns = this.$config.reorder_grid_columns;\r\n\t\t\t}\r\n\r\n\t\t\tif(this.$config.bind === undefined){\r\n\t\t\t\tthis.$config.bind = \"temp_resource_assignment_store\";\r\n\t\t\t\tthis.$config.name = \"resource_grid_lightbox\";\r\n\t\t\t\tthis.$config.$id = \"GridRL\";\r\n\t\t\t}\r\n\r\n\t\t\tcontainer.innerHTML = \"<div class='gantt_grid' style='width:100%;' \" + gridAriaAttr + \"></div>\";\r\n\t\t\tthis.$grid = container.childNodes[0];\r\n\r\n\t\t\tthis.$grid.innerHTML = \"<div class='gantt_grid_scale' \" +\r\n\t\t\t\tgantt._waiAria.gridScaleRowAttrString() + \"></div><div class='gantt_grid_data' \" + gridDataAriaAttr + \"></div>\";\r\n\r\n\t\t\tthis.$grid_scale = this.$grid.childNodes[0];\r\n\t\t\tthis.$grid_data = this.$grid.childNodes[1];\r\n\r\n\t\t\tlet attr = _ganttConfig[this.$config.bind + \"_attribute\"];\r\n\t\t\tif (!attr && this.$config.bind) {\r\n\t\t\t\tattr = \"data-\" + this.$config.bind + \"-id\";\r\n\t\t\t}\r\n\t\t\tthis.$config.item_attribute = attr || null;\r\n\r\n\t\t\tif (!this.$config.layers) {\r\n\t\t\t\tconst layers = this._createLayerConfig();\r\n\t\t\t\tthis.$config.layers = layers;\r\n\t\t\t}\r\n\r\n\t\t\tconst domEvents = domEventScope();\r\n\t\t\tthis.event = domEvents.attach;\r\n\t\t\tthis.eventRemove = domEvents.detach;\r\n\t\t\tthis._eventRemoveAll = domEvents.detachAll;\r\n\t\t\tthis._createDomEventScope = domEvents.extend;\r\n\r\n\t\t\tthis._addLayers(this.$gantt);\r\n\r\n\t\t\tthis._initEvents();\r\n\r\n\t\t\tthis.callEvent(\"onReady\", []);\r\n\r\n\t\t},\r\n\t\tgetColumn: function (name) {\r\n\t\t\tconst index = this.getColumnIndex(name);\r\n\t\t\tif (index === null) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tconst columns = this._getResourceColumns();\r\n\t\t\treturn columns[index] || null;\r\n\t\t},\r\n\t\tgetColumnIndex: function (name, excludeHidden) {\r\n\t\t\tconst columns = this._getResourceColumns();\r\n\t\t\tlet hiddenIndexShift = 0;\r\n\r\n\t\t\tfor (let i = 0; i < columns.length; i++) {\r\n\t\t\t\t// GS-1257. If the cell is hidden, the target column index should be correct\r\n\t\t\t\tif (excludeHidden && columns[i].hide){\r\n\t\t\t\t\thiddenIndexShift++;\r\n\t\t\t\t}\r\n\t\t\t\tif (columns[i].name == name) {\r\n\t\t\t\t\treturn i - hiddenIndexShift;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\tgetGridColumns: function(){\r\n\t\t\tconst columns = this._getResourceColumns();\r\n\t\t\tconst visibleColumns = [];\r\n\t\r\n\t\t\tfor (let i = 0; i < columns.length; i++) {\r\n\t\t\t\tif (!columns[i].hide)\r\n\t\t\t\t\tvisibleColumns.push(columns[i]);\r\n\t\t\t}\r\n\t\r\n\t\t\treturn visibleColumns;\r\n\t\t},\r\n\t\t_createLayerConfig: function () {\r\n\t\t\tconst gantt = this.$gantt;\r\n\t\t\tconst self = this;\r\n\t\t\tconst layers = [\r\n\t\t\t\t{\r\n\t\t\t\t\trenderer: gantt.$ui.layers.gridLine(),\r\n\t\t\t\t\tcontainer: this.$grid_data,\r\n\t\t\t\t\tfilter: [function () {\r\n\t\t\t\t\t\treturn self.isVisible();\r\n\t\t\t\t\t}]\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\trenderer: gantt.$ui.layers.gridTaskRowResizer(),\r\n\t\t\t\t\tcontainer: this.$grid_data,\r\n\t\t\t\t\tappend: true,\r\n\t\t\t\t\tfilter: [function () {\r\n\t\t\t\t\t\treturn gantt.config.resize_rows;\r\n\t\t\t\t\t}]\r\n\t\t\t\t}\r\n\t\t\t];\r\n\t\t\treturn layers;\r\n\t\t},\r\n\t\t_renderGridHeader: function () {\r\n\t\t\tconst gantt = this.$gantt;\r\n\t\t\tconst config = this._getResourceConfig();\r\n\t\t\tconst locale = this.$gantt.locale;\r\n\t\t\tconst templates = this.$getTemplates();\r\n\t\r\n\t\t\tlet columns = this._getResourceColumns();\r\n\t\t\tif (config.rtl) {\r\n\t\t\t\tcolumns = columns.reverse();\r\n\t\t\t}\r\n\t\t\tif(!config.scale_height){\r\n\t\t\t\tconfig.scale_height = gantt.resource_table.scale_height;\r\n\t\t\t}\r\n\t\t\tlet cells = [];\r\n\t\t\tlet width = 0,\r\n\t\t\t\tlabels = locale.labels;\r\n\t\r\n\t\t\t\tlet lineHeigth = config.scale_height - 1;\r\n\t\r\n\t\t\tfor (let i = 0; i < columns.length; i++) {\r\n\t\t\t\tlet last = i == columns.length - 1;\r\n\t\t\t\tlet col = columns[i];\r\n\t\r\n\t\t\t\t// ensure columns have non-empty names\r\n\t\t\t\tif (!col.name) {\r\n\t\t\t\t\tcol.name = gantt.uid() + \"\";\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tlet colWidth = col.width * 1;\r\n\t\r\n\t\t\t\tlet gridWidth = this._getGridWidth();\r\n\t\t\t\tif (last && gridWidth > width + colWidth)\r\n\t\t\t\t\tcol.width = colWidth = gridWidth - width;\r\n\t\t\t\twidth += colWidth;\r\n\t\t\t\tlet sort = (gantt._sort && col.name == gantt._sort.name) ? (`<div data-column-id=\"${col.name}\" class=\"gantt_sort gantt_${gantt._sort.direction}\"></div>`) : \"\";\r\n\t\t\t\tlet cssClass = [\"gantt_grid_head_cell\",\r\n\t\t\t\t\t(\"gantt_grid_head_\" + col.name),\r\n\t\t\t\t\t(last ? \"gantt_last_cell\" : \"\"),\r\n\t\t\t\t\ttemplates.grid_header_class ? templates.grid_header_class(col.name, col) : \"\"].join(\" \");\r\n\t\r\n\t\t\t\tlet style = \"width:\" + (colWidth - (last ? 1 : 0)) + \"px;\";\r\n\t\t\t\tlet label = (col.label || labels[\"column_\" + col.name] || labels[col.name]);\r\n\t\t\t\tlabel = label || \"\";\r\n\t\r\n\t\t\t\tconst ariaAttrs = gantt._waiAria.gridScaleCellAttrString(col, label);\r\n\t\r\n\t\t\t\tconst cell = \"<div class='\" + cssClass + \"' style='\" + style + \"' \" + ariaAttrs + \r\n\t\t\t\t\t\" data-column-id='\" + col.name + \"' column_id='\" + col.name + \"'\" +\r\n\t\t\t\t\t\" data-column-name='\" + col.name + \"' data-column-index='\" + i + \"'\" +\r\n\t\t\t\t\t\">\" + label + sort + \"</div>\";\r\n\t\t\t\tcells.push(cell);\r\n\t\t\t}\r\n\t\t\tthis.$grid_scale.style.height = (config.scale_height) + \"px\";\r\n\t\t\tthis.$grid_scale.style.lineHeight = lineHeigth + \"px\";\r\n\t\t\tthis.$grid_scale.style.width = \"inherit\";\r\n\t\t\tthis.$grid_scale.innerHTML = cells.join(\"\");\r\n\t\t},\r\n\t\tisVisible: function () {\r\n\t\t\tif (this.$parent) {\r\n\t\t\t\treturn !this.$parent.hidden;\r\n\t\t\t} else {\r\n\t\t\t\treturn this.$grid.offsetWidth;\r\n\t\t\t}\r\n\t\t},\r\n\t\t_initEvents: function(){\r\n\t\t},\r\n\t\t_getResourceSection: function(){\r\n\t\t\treturn gantt.getLightboxSection(this.$config.sectionName).section;\r\n\t\t},\r\n\t\t$getTemplates: function() {\r\n\t\t\treturn this._getResourceSection().templates || {};\r\n\t\t},\r\n\t\t_getResourceConfig: function(){\r\n\t\t\treturn this._getResourceSection().config || gantt.resource_table;\r\n\t\t},\r\n\t\t_getResourceColumns: function() {\r\n\t\t\treturn this._getResourceSection().config?.columns || gantt.resource_table.columns;\r\n\t\t},\r\n\t\tdestructor: function () {\r\n\t\t\tif (this._mouseDelegates) {\r\n\t\t\t\tthis._mouseDelegates.destructor();\r\n\t\t\t\tthis._mouseDelegates = null;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._unbindStore();\r\n\t\t\tthis.$grid = null;\r\n\t\t\tthis.$grid_scale = null;\r\n\t\t\tthis.$grid_data = null;\r\n\t\t\tthis._eventRemoveAll();\r\n\t\t\tgantt.ext.inlineEditorsLightbox.destructor();\r\n\t\t\tthis.callEvent(\"onDestroy\", []);\r\n\t\t\tthis.detachAllEvents();\r\n\t\t}\r\n\t\t\r\n\t}, true);\r\n\r\n\tutils.mixin(GridRL.prototype, resourceStoreMixin(GridRL), true);\r\n\r\n\treturn GridRL;\r\n})(Grid);\r\n\r\nexport default GridRL;","export default {\r\n\tinit: function (controller, grid) {\r\n\t\tvar gantt = grid.$gantt;\r\n\r\n\t\tgantt.attachEvent(\"onTaskClick\", function (id, e) {\r\n\t\t\tif (gantt._is_icon_open_click(e))\r\n\t\t\t\treturn true;\r\n\t\t\tvar state = controller.getState();\r\n\t\t\tvar cell = controller.locateCell(e.target);\r\n\r\n\t\t\tif (cell && controller.getEditorConfig(cell.columnName)) {\r\n\t\t\t\tif (controller.isVisible() && state.id == cell.id && state.columnName == cell.columnName) {\r\n\t\t\t\t\t// do nothing if editor is already active in this cell\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcontroller.startEdit(cell.id, cell.columnName);\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\t\t//GS-2598: new resource control click handler\r\n\t\tif(grid.$config.id === \"GridRL\"){\r\n\t\t\tgantt.event(gantt.getLightbox(), \"click\", function (e) {\r\n\t\t\t\tconst domHelpers = gantt.utils.dom;\r\n\t\t\t\tconst state = controller.getState();\r\n\t\t\t\tconst cell = controller.locateCell(e.target);\r\n\t\t\t\t// click on the resource table\r\n\t\t\t\tif (cell && controller.getEditorConfig(cell.columnName)) {\r\n\t\t\t\t\t// validation for unassigned case\r\n\t\t\t\t\tif(cell.columnName == 'duration' || cell.columnName == 'end'){\r\n\t\t\t\t\t\tconst tempAssignmentStore = gantt.getDatastore(\"temp_resource_assignment_store\");\r\n\t\t\t\t\t\tconst assignment = tempAssignmentStore.getItem(cell.id);\r\n\t\t\t\t\t\tif(assignment){\r\n\t\t\t\t\t\t\tif(!assignment.start_date){\r\n\t\t\t\t\t\t\t\tgantt.message({\r\n\t\t\t\t\t\t\t\t\ttype:\"warning\",\r\n\t\t\t\t\t\t\t\t\ttext:\"Specify assignment start date\"\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tcontroller.hide();\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (controller.isVisible() && state.id == cell.id && state.columnName == cell.columnName) {\r\n\t\t\t\t\t// do nothing if editor is already active in this cell\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcontroller.startEdit(cell.id, cell.columnName);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(controller.isChanged()){\r\n\t\t\t\t\t\tcontroller.save();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\t// do nothing if add resource button clicked\r\n\t\t\t\tif(domHelpers.closest(e.target, `.gantt_custom_button.gantt_add_resources`)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// handle assignment deleting\r\n\t\t\t\tif(domHelpers.closest(e.target, `[data-assignment-delete]`)){\r\n\t\t\t\t\tconst assignmentId = e.target.getAttribute(\"data-assignment-delete\");\r\n\t\t\t\t\tgantt.confirm({\r\n\t\t\t\t\t\ttext: \"Resource assignment will be deleted permanently, are you sure?\",\r\n\t\t\t\t\t\tcancel:\"No\",\r\n\t\t\t\t\t\tok:\"Delete\", \r\n\t\t\t\t\t\tcallback: function(result){\r\n\t\t\t\t\t\t\tif(result){\r\n\t\t\t\t\t\t\t\tconst tempAssignmentStore = gantt.getDatastore(\"temp_resource_assignment_store\");\r\n\t\t\t\t\t\t\t\ttempAssignmentStore.removeItem(assignmentId);\r\n\t\t\t\t\t\t\t\t// handle deleting last grid row, \r\n\t\t\t\t\t\t\t\tif (tempAssignmentStore.getItems().length == 0){\r\n\t\t\t\t\t\t\t\t\tconst resourceSection = gantt.getLightboxSection(grid.$config.sectionName);\r\n\t\t\t\t\t\t\t\t\tconst block = gantt.form_blocks[\"resource_selector\"];\r\n\t\t\t\t\t\t\t\t\tconst node = gantt._lightbox_root.querySelector(\"#\" + resourceSection.section.id).nextSibling;\r\n\t\t\t\t\t\t\t\t\tblock.set_value.call(gantt, node, [], {}, resourceSection.section, true);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tgantt.refreshData();\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t//click outside the resource table\r\n\t\t\t\tif(controller.isVisible()) {\r\n\t\t\t\t\tcontroller.save();\r\n\t\t\t\t\tcontroller.hide();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcontroller.hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t// before saving lightbox need to save controller value if its modified\r\n\t\t\t// covering date type inputs\r\n\t\t\tgantt.lightbox_events.gantt_save_btn = function () {\r\n\t\t\t\tcontroller.save();\r\n\t\t\t\tgantt._save_lightbox();\r\n\t\t\t};\r\n\t\t};\r\n\r\n\t\tgantt.attachEvent(\"onEmptyClick\", function () {\r\n\t\t\tif (controller.isVisible() && controller.isChanged()) {\r\n\t\t\t\tcontroller.save();\r\n\t\t\t} else {\r\n\t\t\t\tcontroller.hide();\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onTaskDblClick\", function (id, e) {\r\n\t\t\tvar state = controller.getState();\r\n\t\t\tvar cell = controller.locateCell(e.target);\r\n\t\t\tif (cell && controller.isVisible() && cell.columnName == state.columnName) {\r\n\t\t\t\t//GS-933 probably, we don't need to hide the inline editor because the lightbox cannot be opened if you double-click on an inline editor\r\n\t\t\t\t//remove this code later if people don't complain\r\n\t\t\t\t//controller.hide();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\t},\r\n\r\n\tonShow: function (controller, placeholder, grid) {\r\n\t\tvar gantt = grid.$gantt;\r\n\t\t\r\n\r\n\t\tif(gantt.ext && gantt.ext.keyboardNavigation){\r\n\t\t\tvar keyNav = gantt.ext.keyboardNavigation;\r\n\t\t\tkeyNav.attachEvent(\"onKeyDown\", function(command, e){\r\n\t\t\t\tvar keyboard = gantt.constants.KEY_CODES;\r\n\t\t\t\tvar keyCode = e.keyCode;\r\n\t\t\t\tvar preventKeyNav = false;\r\n\r\n\t\t\t\tswitch (keyCode){\r\n\t\t\t\t\tcase keyboard.SPACE:\r\n\t\t\t\t\t\tif(controller.isVisible()){\r\n\t\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (preventKeyNav){\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t} else{\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tplaceholder.onkeydown = function (e) {\r\n\t\t\te = e || window.event;\r\n\r\n\t\t\tvar keyboard = gantt.constants.KEY_CODES;\r\n\t\t\tif (e.defaultPrevented || (e.shiftKey && e.keyCode != keyboard.TAB)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar shouldPrevent = true;\r\n\t\t\tswitch (e.keyCode) {\r\n\t\t\t\tcase gantt.keys.edit_save:\r\n\t\t\t\t\tcontroller.save();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase gantt.keys.edit_cancel:\r\n\t\t\t\t\tcontroller.hide();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.UP:\r\n\t\t\t\tcase keyboard.DOWN:\r\n\t\t\t\t\tif (controller.isVisible()) {\r\n\t\t\t\t\t\tcontroller.hide();\r\n\t\t\t\t\t\tshouldPrevent = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.TAB:\r\n\t\t\t\t\tif (e.shiftKey) {\r\n\t\t\t\t\t\tcontroller.editPrevCell(true);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcontroller.editNextCell(true);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tshouldPrevent = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (shouldPrevent) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t}\r\n\t\t};\r\n\t\t// GS-2598: update inline editor in the lightbox\r\n\t\tif(grid.$config.id === \"GridRL\"){\r\n\t\t\tplaceholder.onkeyup = function (e) {\r\n\t\t\t\te = e || window.event;\r\n\r\n\t\t\t\tvar keyboard = gantt.constants.KEY_CODES;\r\n\t\t\t\tif (e.defaultPrevented || (e.shiftKey && e.keyCode != keyboard.TAB)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif(gantt._lightbox_id && controller.isChanged()){\r\n\t\t\t\t\tcontroller.save();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tlet timeout;\r\n\t\t\tplaceholder.onwheel = function (e) {\r\n\t\t\t\te = e || window.event;\r\n\t\t\t\tif(gantt._lightbox_id && controller.isChanged()){\r\n\t\t\t\t\tclearTimeout(timeout);\r\n\t\t\t\t\ttimeout=setTimeout(function(){\r\n\t\t\t\t\t\tcontroller.save();\r\n\t\t\t\t\t},100);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t},\r\n\tonHide: function () {\r\n\r\n\t},\r\n\r\n\tdestroy: function () {\r\n\r\n\t}\r\n};\r\n\r\n","export default {\r\n\tinit: function(controller, grid){\r\n\t\tvar self = controller;\r\n\t\tvar gantt = grid.$gantt;\r\n\r\n\t\tvar onBlurDelay = null;\r\n\t\tvar keyNav = gantt.ext.keyboardNavigation;\r\n\t\tkeyNav.attachEvent(\"onBeforeFocus\", function (node) {\r\n\t\t\tvar activeCell = controller.locateCell(node);\r\n\t\t\tclearTimeout(onBlurDelay);\r\n\t\t\tif (activeCell) {\r\n\t\t\t\tvar columnName = activeCell.columnName;\r\n\t\t\t\tvar id = activeCell.id;\r\n\r\n\t\t\t\tvar editorState = self.getState();\r\n\t\t\t\tif(self.isVisible()){\r\n\t\t\t\t\tif(editorState.id == id && editorState.columnName === columnName) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tkeyNav.attachEvent(\"onFocus\", function (node) {\r\n\t\t\tvar activeCell = controller.locateCell(node);\r\n\t\t\tvar state = controller.getState();\r\n\t\t\tclearTimeout(onBlurDelay);\r\n\t\t\tif (activeCell && !(activeCell.id == state.id && activeCell.columnName == state.columnName)) {\r\n\t\t\t\tif(self.isVisible()){\r\n\t\t\t\t\tself.save();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tcontroller.attachEvent(\"onHide\", function(){\r\n\t\t\tclearTimeout(onBlurDelay);\r\n\t\t});\r\n\r\n\t\tkeyNav.attachEvent(\"onBlur\", function () {\r\n\t\t\tonBlurDelay = setTimeout(function(){\r\n\t\t\t\tself.save();\r\n\t\t\t});\r\n\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onTaskDblClick\", function(id,e){\r\n\t\t\t// block lightbox on double click inside editor\r\n\t\t\tvar state = controller.getState();\r\n\t\t\tvar cell = controller.locateCell(e.target);\r\n\t\t\tif(cell && controller.isVisible() && cell.columnName == state.columnName){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onTaskClick\", function (id, e) {\r\n\t\t\tif(gantt._is_icon_open_click(e))\r\n\t\t\t\treturn true;\r\n\r\n\t\t\tvar state = controller.getState();\r\n\t\t\tvar cell = controller.locateCell(e.target);\r\n\r\n\t\t\tif (cell && controller.getEditorConfig(cell.columnName)) {\r\n\t\t\t\tif(controller.isVisible() && state.id == cell.id && state.columnName == cell.columnName){\r\n\t\t\t\t\t// do nothing if editor is already active in this cell\r\n\t\t\t\t}else{\r\n\t\t\t\t\tcontroller.startEdit(cell.id, cell.columnName);\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onEmptyClick\", function () {\r\n\t\t\tself.save();\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tkeyNav.attachEvent(\"onKeyDown\", function(command, e){\r\n\t\t\tvar activeCell = controller.locateCell(e.target);\r\n\t\t\tvar hasEditor = activeCell ? controller.getEditorConfig(activeCell.columnName) : false;\r\n\r\n\t\t\tvar state = controller.getState();\r\n\t\t\tvar keyboard = gantt.constants.KEY_CODES;\r\n\t\t\tvar keyCode = e.keyCode;\r\n\t\t\tvar preventKeyNav = false;\r\n\r\n\t\t\tswitch (keyCode){\r\n\t\t\t\tcase keyboard.ENTER:\r\n\t\t\t\t\tif(controller.isVisible()){\r\n\t\t\t\t\t\tcontroller.save();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}else if(hasEditor && !(e.ctrlKey || e.metaKey || e.shiftKey)){\r\n\t\t\t\t\t\tself.startEdit(activeCell.id, activeCell.columnName);\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.ESC:\r\n\t\t\t\t\tif(controller.isVisible()){\r\n\t\t\t\t\t\tcontroller.hide();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.UP:\r\n\t\t\t\tcase keyboard.DOWN:\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.LEFT:\r\n\t\t\t\tcase keyboard.RIGHT:\r\n\t\t\t\t\tif((hasEditor && controller.isVisible()) || state.editorType === \"date\"){\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.SPACE:\r\n\t\t\t\t\tif(controller.isVisible()){\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(hasEditor && !controller.isVisible()){\r\n\t\t\t\t\t\tself.startEdit(activeCell.id, activeCell.columnName);\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.DELETE:\r\n\t\t\t\t\tif(hasEditor && !controller.isVisible()){\r\n\t\t\t\t\t\tself.startEdit(activeCell.id, activeCell.columnName);\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t} else if(hasEditor && controller.isVisible()){\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.TAB:\r\n\t\t\t\t\tif(controller.isVisible()){\r\n\r\n\t\t\t\t\t\tif(e.shiftKey){\r\n\t\t\t\t\t\t\tcontroller.editPrevCell(true);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tcontroller.editNextCell(true);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar newState = controller.getState();\r\n\t\t\t\t\t\tif(newState.id){\r\n\t\t\t\t\t\t\tkeyNav.focus({type:\"taskCell\", id: newState.id, column:newState.columnName});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tif(controller.isVisible())\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\telse{\r\n\r\n\t\t\t\t\t\t// start editing on character key\r\n\t\t\t\t\t\tif((keyCode >= 48 && keyCode <= 57) || // [0-9]\r\n\t\t\t\t\t\t\t(keyCode > 95 && keyCode < 112) || // numpad\r\n\t\t\t\t\t\t\t(keyCode >= 64 && keyCode <= 91) || // [a-z]\r\n\t\t\t\t\t\t\t(keyCode > 185 && keyCode < 193) || //;=-,etc\r\n\t\t\t\t\t\t\t(keyCode > 218  && keyCode < 223)\r\n\t\t\t\t\t\t){\r\n\t\t\t\t\t\t\tvar modifiers = command.modifiers;\r\n\r\n\t\t\t\t\t\t\tvar anyModifier = modifiers.alt || modifiers.ctrl || modifiers.meta || modifiers.shift;\r\n\t\t\t\t\t\t\tif(modifiers.alt || e.key === \"Meta\"){\r\n\t\t\t\t\t\t\t\t// don't start editing on alt+key or Meta/Cmd key\r\n\t\t\t\t\t\t\t}else if (anyModifier && keyNav.getCommandHandler(command, \"taskCell\")){\r\n\t\t\t\t\t\t\t\t// don't start editing if command already have a keyboard shortcut\r\n\t\t\t\t\t\t\t}else if(hasEditor && !controller.isVisible()){\r\n\t\t\t\t\t\t\t\tself.startEdit(activeCell.id, activeCell.columnName);\r\n\t\t\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (preventKeyNav){\r\n\t\t\t\treturn false;\r\n\t\t\t} else{\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t});\r\n\t},\r\n\tonShow: function(controller, placeholder, grid){},\r\n\tonHide: function(controller, placeholder, grid){\r\n\t\tconst gantt = grid.$gantt;\r\n\t\tif (gantt){\r\n\t\t\tgantt.focus();\r\n\t\t}\r\n\r\n\t},\r\n\tdestroy: function(){}\r\n};\r\n\r\n","import defaultMapping from \"./keyboard_mappings/default\";\r\nimport keyNavMappings from \"./keyboard_mappings/keyboard_navigation\";\r\n\r\nexport default function(gantt){\r\n\r\n\tvar mapping = null;\r\n\r\n\treturn {\r\n\t\tsetMapping: function(map){\r\n\t\t\tmapping = map;\r\n\t\t},\r\n\t\tgetMapping: function(){\r\n\r\n\t\t\tif(mapping){\r\n\t\t\t\treturn mapping;\r\n\t\t\t}else if(gantt.config.keyboard_navigation_cells && gantt.ext.keyboardNavigation){\r\n\t\t\t\treturn keyNavMappings;\r\n\t\t\t}else{\r\n\t\t\t\treturn defaultMapping;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n};\r\n","export default function (gantt) {\r\n\r\n\tvar BaseEditor = function () {\r\n\t};\r\n\r\n\tBaseEditor.prototype = {\r\n\t\tshow: function (id, column, config, placeholder) {\r\n\t\t},\r\n\t\thide: function () {\r\n\t\t},\r\n\t\tset_value: function (value, id, column, node) {\r\n\t\t\tthis.get_input(node).value = value;\r\n\t\t},\r\n\t\tget_value: function (id, column, node) {\r\n\t\t\treturn this.get_input(node).value || \"\";\r\n\t\t},\r\n\t\tis_changed: function (value, id, column, node) {\r\n\t\t\tvar currentValue = this.get_value(id, column, node);\r\n\t\t\tif (currentValue && value && currentValue.valueOf && value.valueOf) {\r\n\t\t\t\treturn currentValue.valueOf() != value.valueOf();\r\n\t\t\t} else {\r\n\t\t\t\treturn currentValue != value;\r\n\t\t\t}\r\n\t\t},\r\n\t\tis_valid: function (value, id, column, node) {\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\t\tsave: function (id, column, node) {\r\n\r\n\t\t},\r\n\t\tget_input: function (node) {\r\n\t\t\treturn node.querySelector(\"input\");\r\n\t\t},\r\n\t\tfocus: function (node) {\r\n\t\t\tvar input = this.get_input(node);\r\n\t\t\tif (!input) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (input.focus) {\r\n\t\t\t\tinput.focus();\r\n\t\t\t}\r\n\r\n\t\t\tif (input.select) {\r\n\t\t\t\tinput.select();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\treturn BaseEditor;\r\n};","import BaseFactory from \"./base\";\r\nimport * as utils from \"../../../../../utils/utils\";\r\nimport __extends from \"../../../../../utils/extends\";\r\n\r\n\r\nexport default function(gantt) {\r\n\r\n\tvar BaseEditor = BaseFactory(gantt);\r\n\r\n\tfunction TextEditor() {\r\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(TextEditor, BaseEditor);\r\n\r\n\tutils.mixin(TextEditor.prototype, {\r\n\t\tshow: function (id, column, config, placeholder) {\r\n\t\t\tvar html = `<div role='cell'><input type='text' name='${column.name}' title='${column.name}'></div>`;\r\n\t\t\tplaceholder.innerHTML = html;\r\n\t\t}\r\n\t}, true);\r\n\r\n\treturn TextEditor;\r\n};","import BaseFactory from \"./base\";\r\nimport * as utils from \"../../../../../utils/utils\";\r\nimport __extends from \"../../../../../utils/extends\";\r\n\r\n\r\nexport default function(gantt) {\r\n\r\n\tvar BaseEditor = BaseFactory(gantt);\r\n\r\n\tfunction NumberEditor() {\r\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(NumberEditor, BaseEditor);\r\n\r\n\tutils.mixin(NumberEditor.prototype, {\r\n\t\tshow: function (id, column, config, placeholder) {\r\n\t\t\tvar min = config.min || 0,\r\n\t\t\t\tmax = config.max || 100;\r\n\r\n\t\t\tvar html = `<div role='cell'><input type='number' min='${min}' max='${max}' name='${column.name}' title='${column.name}'></div>`;\r\n\t\t\tplaceholder.innerHTML = html;\r\n\r\n\t\t\t// GS-1914. Do not allow entering alues beyond min and max via keyboard\r\n\t\t\tplaceholder.oninput = function (e) {\r\n\t\t\t\tif (+e.target.value < min) {\r\n\t\t\t\t\te.target.value = min;\r\n\t\t\t\t}\r\n\t\t\t\tif (+e.target.value > max) {\r\n\t\t\t\t\te.target.value = max;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\tget_value: function (id, column, node) {\r\n\t\t\treturn this.get_input(node).value || \"\";\r\n\t\t},\r\n\t\tis_valid: function (value, id, column, node) {\r\n\t\t\treturn !isNaN(parseInt(value, 10));\r\n\t\t}\r\n\t}, true);\r\n\r\n\treturn NumberEditor;\r\n};","import BaseFactory from \"./base\";\r\nimport * as utils from \"../../../../../utils/utils\";\r\nimport __extends from \"../../../../../utils/extends\";\r\n\r\n\r\nexport default function(gantt) {\r\n\r\n\tvar BaseEditor = BaseFactory(gantt);\r\n\r\n\tfunction SelectEditor() {\r\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(SelectEditor, BaseEditor);\r\n\r\n\tutils.mixin(SelectEditor.prototype, {\r\n\t\tshow: function (id, column, config, placeholder) {\r\n\t\t\tvar html = `<div role='cell'><select name='${column.name}' title='${column.name}'>`;\r\n\t\t\tvar optionsHtml = [],\r\n\t\t\t\toptions = config.options || [];\r\n\r\n\t\t\tfor (var i = 0; i < options.length; i++) {\r\n\t\t\t\toptionsHtml.push(\"<option value='\" + config.options[i].key + \"'>\" + options[i].label + \"</option>\");\r\n\t\t\t}\r\n\r\n\t\t\thtml += optionsHtml.join(\"\") + \"</select></div>\";\r\n\t\t\tplaceholder.innerHTML = html;\r\n\t\t},\r\n\t\tget_input: function (node) {\r\n\t\t\treturn node.querySelector(\"select\");\r\n\t\t}\r\n\t}, true);\r\n\r\n\treturn SelectEditor;\r\n};","import * as utils from \"../../../../../utils/utils\";\r\nimport __extends from \"../../../../../utils/extends\";\r\nimport BaseFactory from \"./base\";\r\n\r\nexport default function (gantt) {\r\n\tvar BaseEditor = BaseFactory(gantt);\r\n\t\r\n\t\r\n\r\n\tvar html5DateFormat = \"%Y-%m-%d\";\r\n\r\n\tvar dateToStr = null;\r\n\tvar strToDate = null;\r\n\r\n\tfunction init() {\r\n\t\tif (!dateToStr) {\r\n\t\t\tdateToStr = gantt.date.date_to_str(html5DateFormat);\r\n\t\t}\r\n\t\tif (!strToDate) {\r\n\t\t\tstrToDate = gantt.date.str_to_date(html5DateFormat);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction DateEditor() {\r\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\r\n\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(DateEditor, BaseEditor);\r\n\r\n\tutils.mixin(DateEditor.prototype, {\r\n\t\tshow: function (id, column, config, placeholder) {\r\n\t\t\tinit();\r\n\t\t\tvar minValue = null;\r\n\t\t\tvar maxValue = null;\r\n\r\n\t\t\tif(typeof config.min === \"function\"){\r\n\t\t\t\tminValue = config.min(id, column);\r\n\t\t\t}else{\r\n\t\t\t\tminValue = config.min;\r\n\t\t\t}\r\n\r\n\t\t\tif(typeof config.max === \"function\"){\r\n\t\t\t\tmaxValue = config.max(id, column);\r\n\t\t\t}else{\r\n\t\t\t\tmaxValue = config.max;\r\n\t\t\t}\r\n\r\n\t\t\tvar minAttr = minValue ? \" min='\" + dateToStr(minValue)+\"' \"  : \"\";\r\n\t\t\tvar maxAttr = maxValue ? \" max='\" + dateToStr(maxValue)+\"' \"  : \"\";\r\n\t\t\tvar html = `<div style='width:140px' role='cell'><input type='date' ${minAttr} ${maxAttr} name='${column.name}' title='${column.name}'></div>`;\r\n\t\t\tplaceholder.innerHTML = html;\r\n\r\n\t\t\t// GS-1914. Do not allow entering alues beyond min and max via keyboard\r\n\t\t\tplaceholder.oninput = function (e) {\r\n\t\t\t\tif (e.target.value && (minValue || maxValue)){\r\n\t\t\t\t\tif (+gantt.date.str_to_date(\"%Y-%m-%d\")(e.target.value) < +minValue) {\r\n\t\t\t\t\t\te.target.value = gantt.date.date_to_str(\"%Y-%m-%d\")(minValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (+gantt.date.str_to_date(\"%Y-%m-%d\")(e.target.value) > +maxValue) {\r\n\t\t\t\t\t\te.target.value = gantt.date.date_to_str(\"%Y-%m-%d\")(maxValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\tset_value: function (value, id, column, node) {\r\n\t\t\tif (value && value.getFullYear) {\r\n\t\t\t\tthis.get_input(node).value = dateToStr(value);\r\n\t\t\t} else {\r\n\t\t\t\tthis.get_input(node).value = value;\r\n\t\t\t}\r\n\t\t},\r\n\t\tis_valid: function (value, id, column, node) {\r\n\t\t\tif (!value || isNaN(value.getTime()))\r\n\t\t\t\treturn false;\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tget_value: function (id, column, node) {\r\n\t\t\tvar parsed;\r\n\t\t\ttry {\r\n\t\t\t\tparsed = strToDate(this.get_input(node).value || \"\");\r\n\t\t\t} catch (e) {\r\n\t\t\t\tparsed = null;// return null will cancel changes\r\n\t\t\t}\r\n\r\n\t\t\treturn parsed;\r\n\t\t}\r\n\t}, true);\r\n\r\n\treturn DateEditor;\r\n};\r\n","import BaseFactory from \"./base\";\r\nimport * as utils from \"../../../../../utils/utils\";\r\nimport __extends from \"../../../../../utils/extends\";\r\n\r\n\r\nexport default function(gantt) {\r\n\r\n\tvar BaseEditor = BaseFactory(gantt);\r\n\r\n\tfunction PredecessorEditor() {\r\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(PredecessorEditor, BaseEditor);\r\n\r\n\tfunction getFormatter(config) {\r\n\t\treturn config.formatter || gantt.ext.formatters.linkFormatter();\r\n\t}\r\n\r\n\tfunction parseInputString(value, config) {\r\n\t\tvar predecessors = (value || \"\").split(config.delimiter || \",\");\r\n\t\tfor (var i = 0; i < predecessors.length; i++) {\r\n\t\t\tvar val = predecessors[i].trim();\r\n\t\t\tif (val) {\r\n\t\t\t\tpredecessors[i] = val;\r\n\t\t\t} else {\r\n\t\t\t\tpredecessors.splice(i, 1);\r\n\t\t\t\ti--;\r\n\t\t\t}\r\n\t\t}\r\n\t\tpredecessors.sort();\r\n\t\treturn predecessors;\r\n\t}\r\n\r\n\tfunction formatPredecessors(task, config, gantt) {\r\n\t\tvar links = task.$target;\r\n\t\tvar labels = [];\r\n\t\tfor (var i = 0; i < links.length; i++) {\r\n\t\t\tvar link = gantt.getLink(links[i]);\r\n\t\t\tlabels.push(getFormatter(config).format(link));\r\n\t\t}\r\n\t\treturn labels.join((config.delimiter || \",\") + \" \");\r\n\t}\r\n\r\n\tfunction getSelectedLinks(taskId, predecessorCodes, config) {\r\n\t\tvar links = [];\r\n\t\t// select only unique codes GS-1439\r\n\t\t[...new Set(predecessorCodes)].forEach(function (code) {\r\n\t\t\tvar link = getFormatter(config).parse(code);\r\n\t\t\tif(link){\r\n\t\t\t\tlink.target = taskId;\r\n\t\t\t\t// GS-1290 A way to preserve the link. Otherwise validation will return false\r\n\t\t\t\t// because the existing link ID is not passed there\r\n\t\t\t\tlink.id = \"predecessor_generated\";\r\n\t\t\t\tif (gantt.isLinkAllowed(link)) {\r\n\t\t\t\t\tlink.id = undefined;\r\n\t\t\t\t\tlinks.push(link);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn links;\r\n\t}\r\n\r\n\tfunction formatLinkKey(link){\r\n\t\treturn link.source + \"_\" + link.target + \"_\" + link.type + \"_\" + (link.lag||0);\r\n\t}\r\n\r\n\tfunction getLinksDiff(task, predecessorCodes, config) {\r\n\t\tvar selectedLinks = getSelectedLinks(task.id, predecessorCodes, config);\r\n\t\tvar existingLinksSearch = {};\r\n\t\ttask.$target.forEach(function (linkId) {\r\n\t\t\tvar link = gantt.getLink(linkId);\r\n\t\t\texistingLinksSearch[formatLinkKey(link)] = link.id;\r\n\t\t});\r\n\r\n\t\tvar linksToAdd = [];\r\n\t\tselectedLinks.forEach(function (link) {\r\n\t\t\tvar linkKey = formatLinkKey(link);\r\n\t\t\tif (!existingLinksSearch[linkKey]) {\r\n\t\t\t\tlinksToAdd.push(link);\r\n\t\t\t} else {\r\n\t\t\t\tdelete existingLinksSearch[linkKey];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar linksToDelete = [];\r\n\t\tfor (var i in existingLinksSearch) {\r\n\t\t\tlinksToDelete.push(existingLinksSearch[i]);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tadd: linksToAdd,\r\n\t\t\tremove: linksToDelete\r\n\t\t};\r\n\t}\r\n\r\n\tutils.mixin(PredecessorEditor.prototype, {\r\n\t\tshow: function (id, column, config, placeholder) {\r\n\t\t\tvar html = `<div role='cell'><input type='text' name='${column.name}' title='${column.name}'></div>`;\r\n\t\t\tplaceholder.innerHTML = html;\r\n\t\t},\r\n\t\thide: function () {\r\n\t\t},\r\n\t\tset_value: function (value, id, column, node) {\r\n\t\t\tthis.get_input(node).value = formatPredecessors(value, column.editor, gantt);\r\n\t\t},\r\n\t\tget_value: function (id, column, node) {\r\n\t\t\treturn parseInputString((this.get_input(node).value || \"\"), column.editor);\r\n\t\t},\r\n\t\tsave: function (id, column, node) {\r\n\t\t\tvar task = gantt.getTask(id);\r\n\r\n\t\t\tvar linksDiff = getLinksDiff(task, this.get_value(id, column, node), column.editor);\r\n\r\n\t\t\tif (linksDiff.add.length || linksDiff.remove.length) {\r\n\t\t\t\tgantt.batchUpdate(function () {\r\n\t\t\t\t\tlinksDiff.add.forEach(function (link) {\r\n\t\t\t\t\t\tgantt.addLink(link);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tlinksDiff.remove.forEach(function (linkId) {\r\n\t\t\t\t\t\tgantt.deleteLink(linkId);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (gantt.autoSchedule)\r\n\t\t\t\t\t\tgantt.autoSchedule();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\tis_changed: function (value, id, column, node) {\r\n\t\t\tvar inputPredecessors = this.get_value(id, column, node);\r\n\t\t\tvar taskPredecessors = parseInputString(formatPredecessors(value, column.editor, gantt), column.editor);\r\n\r\n\t\t\treturn inputPredecessors.join() !== taskPredecessors.join();\r\n\t\t}\r\n\t}, true);\r\n\r\n\treturn PredecessorEditor;\r\n};","import BaseFactory from \"./base\";\r\nimport * as utils from \"../../../../../utils/utils\";\r\nimport __extends from \"../../../../../utils/extends\";\r\n\r\n\r\nexport default function(gantt) {\r\n\r\n\tvar BaseEditor = BaseFactory(gantt);\r\n\r\n\tfunction TextEditor() {\r\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(TextEditor, BaseEditor);\r\n\r\n\tfunction getFormatter(config) {\r\n\t\treturn config.formatter || gantt.ext.formatters.durationFormatter();\r\n\t}\r\n\tutils.mixin(TextEditor.prototype, {\r\n\t\tshow: function (id, column, config, placeholder) {\r\n\t\t\tvar html = `<div role='cell'><input type='text' name='${column.name}' title='${column.name}'></div>`;\r\n\t\t\tplaceholder.innerHTML = html;\r\n\t\t},\r\n\t\tset_value: function (value, id, column, node) {\r\n\t\t\tthis.get_input(node).value = getFormatter(column.editor).format(value);\r\n\t\t},\r\n\t\tget_value: function (id, column, node) {\r\n\t\t\treturn getFormatter(column.editor).parse(this.get_input(node).value || \"\");\r\n\t\t}\r\n\t}, true);\r\n\r\n\treturn TextEditor;\r\n};","export default function (gantt) {\r\n\treturn function processTaskDateProperties(item, mapTo, mode) {\r\n\t\tif (mode == \"keepDates\") {\r\n\t\t\tkeepDatesOnEdit(item, mapTo);\r\n\t\t} else if (mode == \"keepDuration\") {\r\n\t\t\tkeepDurationOnEdit(item, mapTo);\r\n\t\t} else {\r\n\t\t\tdefaultActionOnEdit(item, mapTo);\r\n\t\t}\r\n\t};\r\n\r\n\t// resize task\r\n\t// resize task when start/end/duration changes\r\n\tfunction keepDatesOnEdit(item, mapTo) {\r\n\t\tif (mapTo == \"duration\") {\r\n\t\t\titem.end_date = gantt.calculateEndDate(item);\r\n\t\t} else if (mapTo == \"end_date\" || mapTo == \"start_date\") {\r\n\t\t\titem.duration = gantt.calculateDuration(item);\r\n\t\t}\r\n\t}\r\n\r\n\t// move task(before 6.2)\r\n\t// move task when start/end dates changes\r\n\t// resize task when duration changes\r\n\tfunction keepDurationOnEdit(item, mapTo) {\r\n\t\tif (mapTo == \"end_date\") {\r\n\t\t\titem.start_date = decreaseStartDate(item);\r\n\t\t} else if (mapTo == \"start_date\" || mapTo == \"duration\") {\r\n\t\t\titem.end_date = gantt.calculateEndDate(item);\r\n\t\t}\r\n\t}\r\n\r\n\t// default behavior\r\n\t// move task when start date changes\r\n\t// resize task when end date/duration changes\r\n\tfunction defaultActionOnEdit(item, mapTo) {\r\n\t\tif (gantt._getAutoSchedulingConfig().schedule_from_end){\r\n\t\t\tif (mapTo == \"end_date\" || mapTo == \"duration\") {\r\n\t\t\t\titem.start_date = decreaseStartDate(item);\r\n\t\t\t} else if (mapTo == \"start_date\") {\r\n\t\t\t\titem.duration = gantt.calculateDuration(item);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (mapTo == \"start_date\" || mapTo == \"duration\") {\r\n\t\t\t\titem.end_date = gantt.calculateEndDate(item);\r\n\t\t\t} else if (mapTo == \"end_date\") {\r\n\t\t\t\titem.duration = gantt.calculateDuration(item);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction decreaseStartDate(item){\r\n\t\treturn gantt.calculateEndDate({\r\n\t\t\tstart_date: item.end_date,\r\n\t\t\tduration: -item.duration,\r\n\t\t\ttask: item\r\n\t\t});\r\n\t}\r\n};","import getKeyboardMapping from \"./keyboard_mappings\";\r\nimport textEditorFactory from \"./editors/text\";\r\nimport numberEditorFactory from \"./editors/number\";\r\nimport selectEditorFactory from \"./editors/select\";\r\nimport dateEditorFactory from \"./editors/date\";\r\nimport predecessorEditorFactory from \"./editors/predecessor\";\r\nimport durationEditorFactory from \"./editors/duration\";\r\nimport * as utils from \"../../../../utils/utils\";\r\nimport * as domHelpers from \"../../utils/dom_helpers\";\r\nimport eventable from \"../../../../utils/eventable\";\r\nimport linkedPropertiesProcessor from \"./linked_properties\";\r\n\r\nfunction initConfigs(gantt){\r\n\tgantt.config.editor_types = {\r\n\t\ttext: new (textEditorFactory(gantt))(),\r\n\t\tnumber: new (numberEditorFactory(gantt))(),\r\n\t\tselect: new (selectEditorFactory(gantt))(),\r\n\t\tdate: new (dateEditorFactory(gantt))(),\r\n\t\tpredecessor: new (predecessorEditorFactory(gantt))(),\r\n\t\tduration: new (durationEditorFactory(gantt))()\r\n\t};\r\n}\r\n\r\nfunction create(gantt){\r\n\tvar keyboardMapping = getKeyboardMapping(gantt);\r\n\r\n\tvar eventBus = {};\r\n\teventable(eventBus);\r\n\r\n\tfunction createGridEditors(grid) {\r\n\r\n\t\tfunction _getGridCellFromNode(node){\r\n\t\t\tif(!domHelpers.isChildOf(node, grid.$grid)){\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tvar row = domHelpers.locateAttribute(node, grid.$config.item_attribute);\r\n\t\t\tvar cell = domHelpers.locateAttribute(node, \"data-column-name\");\r\n\t\t\tif(row && cell){\r\n\t\t\t\tvar columnName = cell.getAttribute(\"data-column-name\");\r\n\t\t\t\tvar id = row.getAttribute(grid.$config.item_attribute);\r\n\t\t\t\treturn {\r\n\t\t\t\t\tid: id,\r\n\t\t\t\t\tcolumnName: columnName\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\tfunction _getEditorPosition(itemId, columnName) {\r\n\t\t\tvar config = grid.$getConfig();\r\n\t\t\tvar top = grid.getItemTop(itemId);\r\n\t\t\tvar height = grid.getItemHeight(itemId);\r\n\t\t\tvar cols = grid.getGridColumns();\r\n\t\t\tvar left = 0,\r\n\t\t\t\tright = 0,\r\n\t\t\t\twidth = 0;\r\n\r\n\t\t\tfor (var i = 0; i < cols.length; i++) {\r\n\t\t\t\tif (cols[i].name == columnName) {\r\n\t\t\t\t\twidth = cols[i].width;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (config.rtl) {\r\n\t\t\t\t\tright += cols[i].width;\r\n\t\t\t\t}\telse {\r\n\t\t\t\t\tleft += cols[i].width;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\tif (config.rtl) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttop: top,\r\n\t\t\t\t\tright: right,\r\n\t\t\t\t\theight: height,\r\n\t\t\t\t\twidth: width\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttop: top,\r\n\t\t\t\t\tleft: left,\r\n\t\t\t\t\theight: height,\r\n\t\t\t\t\twidth: width\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction findVisibleIndex(grid, columnName) {\r\n\t\t\tvar columns = grid.getGridColumns();\r\n\t\t\tfor (var i = 0; i < columns.length; i++){\r\n\t\t\t\tif(columns[i].name == columnName){\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tfunction _createPlaceholder(itemId, columnName) {\r\n\t\t\tvar config = grid.$getConfig();\r\n\t\t\tvar pos = _getEditorPosition(itemId, columnName);\r\n\t\t\tvar el = document.createElement(\"div\");\r\n\t\t\tel.className = \"gantt_grid_editor_placeholder\";\r\n\t\t\tel.setAttribute(grid.$config.item_attribute, itemId);\r\n\t\t\tel.setAttribute(grid.$config.bind + \"_id\", itemId);// for backward compatibility\r\n\r\n\t\t\tel.setAttribute(\"data-column-name\", columnName);\r\n\r\n\t\t\tvar visibleIndex = findVisibleIndex(grid, columnName);\r\n\t\t\tel.setAttribute(\"data-column-index\", visibleIndex);\r\n\r\n\t\t\tgantt._waiAria.inlineEditorAttr(el);\r\n\r\n\t\t\tif (config.rtl) {\r\n\t\t\t\tel.style.cssText = [\r\n\t\t\t\t\t\"top:\" + pos.top + \"px\",\r\n\t\t\t\t\t\"right:\" + pos.right + \"px\",\r\n\t\t\t\t\t\"width:\" + pos.width + \"px\",\r\n\t\t\t\t\t\"height:\" + pos.height + \"px\"\r\n\t\t\t\t].join(\";\");\r\n\t\t\t} else {\r\n\t\t\t\tel.style.cssText = [\r\n\t\t\t\t\t\"top:\" + pos.top + \"px\",\r\n\t\t\t\t\t\"left:\" + pos.left + \"px\",\r\n\t\t\t\t\t\"width:\" + pos.width + \"px\",\r\n\t\t\t\t\t\"height:\" + pos.height + \"px\"\r\n\t\t\t\t].join(\";\");\r\n\t\t\t}\r\n\r\n\t\t\treturn el;\r\n\t\t}\r\n\r\n\t\tvar updateTaskDateProperties = linkedPropertiesProcessor(gantt);\r\n\r\n\t\tvar handlers = [];\r\n\t\tvar ganttHandlers = [];\r\n\t\tvar store = null;\r\n\t\tvar controller = {\r\n\t\t\t_itemId: null,\r\n\t\t\t_columnName: null,\r\n\t\t\t_editor: null,\r\n\t\t\t_editorType: null,\r\n\t\t\t_placeholder: null,\r\n\r\n\t\t\tlocateCell: _getGridCellFromNode,\r\n\t\t\tgetEditorConfig: function (columnName) {\r\n\t\t\t\tvar column = grid.getColumn(columnName);\r\n\t\t\t\tif(column){\r\n\t\t\t\t\treturn column.editor;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tinit: function () {\r\n\t\t\t\tvar mapping = keyboardMapping.getMapping();\r\n\t\t\t\tif(mapping.init){\r\n\t\t\t\t\tmapping.init(this, grid);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstore = grid.$gantt.getDatastore(grid.$config.bind);\r\n\t\t\t\tif (!store && gantt.$data.tempAssignmentsStore){\r\n\t\t\t\t\tstore = gantt.$data.tempAssignmentsStore;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar self = this;\r\n\r\n\t\t\t\thandlers.push(store.attachEvent(\"onIdChange\", function(oldId, newId){\r\n\t\t\t\t\tif(self._itemId == oldId){\r\n\t\t\t\t\t\tself._itemId = newId;\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\t\t\t\thandlers.push(store.attachEvent(\"onStoreUpdated\", function(){\r\n\t\t\t\t\tif(grid.$gantt.getState(\"batchUpdate\").batch_update){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(self.isVisible() && !store.isVisible(self._itemId)){\r\n\t\t\t\t\t\tself.hide();\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\r\n\t\t\t\tganttHandlers.push(gantt.attachEvent(\"onDataRender\", function(){\r\n\t\t\t\t\tif(self._editor && self._placeholder && !domHelpers.isChildOf(self._placeholder, gantt.$root)){\r\n\t\t\t\t\t\tgrid.$grid_data.appendChild(self._placeholder);\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\r\n\t\t\t\tthis.init = function(){};\r\n\t\t\t},\r\n\r\n\t\t\tgetState: function(){\r\n\t\t\t\treturn {\r\n\t\t\t\t\teditor: this._editor,\r\n\t\t\t\t\teditorType: this._editorType,\r\n\t\t\t\t\tplaceholder: this._placeholder,\r\n\t\t\t\t\tid: this._itemId,\r\n\t\t\t\t\tcolumnName: this._columnName\r\n\t\t\t\t};\r\n\t\t\t},\r\n\r\n\t\t\tstartEdit: function(itemId, columnName) {\r\n\t\t\t\tif (this.isVisible()) {\r\n\t\t\t\t\tthis.save();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!store.exists(itemId)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar editorState = {id: itemId, columnName: columnName};\r\n\t\t\t\tif (gantt.isReadonly(store.getItem(itemId))) {\r\n\t\t\t\t\tthis.callEvent(\"onEditPrevent\", [editorState]);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.callEvent(\"onBeforeEditStart\", [editorState]) === false) {\r\n\t\t\t\t\tthis.callEvent(\"onEditPrevent\", [editorState]);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst asyncShow = this.show(editorState.id, editorState.columnName);\r\n\t\t\t\tif(asyncShow && asyncShow.then){\r\n\t\t\t\t\tasyncShow.then(function(){\r\n\t\t\t\t\t\tthis.setValue();\r\n\r\n\t\t\t\t\t\tthis.callEvent(\"onEditStart\", [editorState]);\r\n\t\t\t\t\t}.bind(this));\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.setValue();\r\n\t\t\t\t\tthis.callEvent(\"onEditStart\", [editorState]);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tisVisible: function(){\r\n\t\t\t\tif(gantt._lightbox_id){\r\n\t\t\t\t\treturn !!(this._editor && domHelpers.isChildOf(this._placeholder, gantt._lightbox));\r\n\t\t\t\t}\r\n\t\t\t\treturn !!(this._editor && domHelpers.isChildOf(this._placeholder, gantt.$root));\r\n\t\t\t},\r\n\t\t\tshow: function (itemId, columnName) {\r\n\t\t\t\tif (this.isVisible()) {\r\n\t\t\t\t\tthis.save();\r\n\t\t\t\t}\r\n\t\t\t\tvar editorState = {id: itemId, columnName: columnName};\r\n\r\n\t\t\t\tvar column = grid.getColumn(editorState.columnName);\r\n\t\t\t\tvar editorConfig = this.getEditorConfig(column.name);\r\n\t\t\t\tif(!editorConfig)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tvar editor = grid.$getConfig().editor_types[editorConfig.type];\r\n\r\n\t\t\t\tvar placeholder = _createPlaceholder(editorState.id, editorState.columnName);\r\n\t\t\t\tgrid.$grid_data.appendChild(placeholder);\r\n\r\n\t\t\t\tconst onAfterShow = (function(){\r\n\t\t\t\t\tthis._editor = editor;\r\n\t\t\t\t\tthis._placeholder = placeholder;\r\n\t\t\t\t\tthis._itemId = editorState.id;\r\n\t\t\t\t\tthis._columnName = editorState.columnName;\r\n\t\t\t\t\tthis._editorType = editorConfig.type;\r\n\r\n\t\t\t\t\tvar mapping = keyboardMapping.getMapping();\r\n\t\t\t\t\tif(mapping.onShow){\r\n\t\t\t\t\t\tmapping.onShow(this, placeholder, grid);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tplaceholder._onReMount = (function(){\r\n\t\t\t\t\t\tthis.setValue();\r\n\t\t\t\t\t}).bind(this);\r\n\t\t\t\t}).bind(this);\r\n\r\n\t\t\t\tconst editorResult = editor.show(editorState.id, column, editorConfig, placeholder);\r\n\t\t\t\tif(editorResult && editorResult.then){\r\n\t\t\t\t\treturn editorResult.then(() => {\r\n\t\t\t\t\t\tonAfterShow();\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\tonAfterShow();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tsetValue: function () {\r\n\t\t\t\tvar state = this.getState();\r\n\t\t\t\tvar itemId = state.id,\r\n\t\t\t\t\tcolumnName = state.columnName;\r\n\r\n\t\t\t\tvar column = grid.getColumn(columnName);\r\n\t\t\t\tvar item = store.getItem(itemId);\r\n\t\t\t\tvar editorConfig = this.getEditorConfig(columnName);\r\n\t\t\t\tvar value;\r\n\t\t\t\tif(!editorConfig)\r\n\t\t\t\t\treturn;\r\n\t\t\t\t// GS-2598: case for the editors in the lightbox\r\n\t\t\t\tif (gantt._lightbox_id) {\r\n\t\t\t\t\tlet assignment = store.getItem(this._itemId);\r\n\r\n\t\t\t\t\tif (editorConfig.map_to === \"text\") {\r\n\t\t\t\t\t\tlet resource = gantt.getDatastore(gantt.config.resource_store).getItem(assignment.resource_id);\r\n\t\t\t\t\t\tvalue = resource.text;\r\n\t\t\t\t\t} else if (editorConfig.map_to === \"start_date\") {\r\n\t\t\t\t\t\tvalue = (item.start_date === \"\" || item.start_date === null)\r\n\t\t\t\t\t\t\t? gantt.getTask(gantt._lightbox_id).start_date\r\n\t\t\t\t\t\t\t: item.start_date;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvalue = item[editorConfig.map_to];\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue = item[editorConfig.map_to];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (editorConfig.map_to === \"auto\") {\r\n\t\t\t\t\tvalue = store.getItem(itemId);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._editor.set_value(value, itemId, column, this._placeholder);\r\n\t\t\t\tthis.focus();\r\n\t\t\t},\r\n\r\n\t\t\tfocus: function(){\r\n\t\t\t\tthis._editor.focus(this._placeholder);\r\n\t\t\t},\r\n\r\n\t\t\tgetValue: function () {\r\n\t\t\t\tvar column = grid.getColumn(this._columnName);\r\n\t\t\t\treturn this._editor.get_value(this._itemId, column, this._placeholder);\r\n\t\t\t},\r\n\r\n\t\t\t_getItemValue: function() {\r\n\t\t\t\tvar editorConfig = this.getEditorConfig(this._columnName);\r\n\r\n\t\t\t\tif(!editorConfig)\r\n\t\t\t\t\treturn;\r\n\t\t\t\tvar value;\r\n\t\t\t\t// GS-2598: case for the editors in the lightbox\r\n\t\t\t\tif(gantt._lightbox_id){\r\n\t\t\t\t\tlet assignment = store.getItem(this._itemId);\r\n\t\t\t\t\tif (editorConfig.type === \"select\" && editorConfig.map_to !== \"mode\") {\r\n\t\t\t\t\t\tlet resource = gantt.getDatastore(gantt.config.resource_store).getItem(assignment.resource_id);\r\n\t\t\t\t\t\tvalue = resource.id;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvalue = assignment[editorConfig.map_to];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar item = gantt.getTask(this._itemId);\r\n\t\t\t\t\tvalue = item[editorConfig.map_to];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(editorConfig.map_to == \"auto\"){\r\n\t\t\t\t\tvalue = store.getItem(this._itemId);\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t},\r\n\r\n\t\t\tisChanged: function(){\r\n\r\n\t\t\t\tvar column = grid.getColumn(this._columnName);\r\n\r\n\t\t\t\tvar value = this._getItemValue();\r\n\r\n\t\t\t\treturn this._editor.is_changed(value, this._itemId, column, this._placeholder);\r\n\t\t\t},\r\n\r\n\t\t\thide: function () {\r\n\t\t\t\tif(!this._itemId)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tvar itemId = this._itemId,\r\n\t\t\t\t\tcolumnName = this._columnName;\r\n\r\n\t\t\t\tvar mapping = keyboardMapping.getMapping();\r\n\t\t\t\tif(mapping.onHide){\r\n\t\t\t\t\tmapping.onHide(this, this._placeholder, grid);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._itemId = null;\r\n\t\t\t\tthis._columnName = null;\r\n\t\t\t\tthis._editorType = null;\r\n\t\t\t\tif (!this._placeholder) return;\r\n\r\n\t\t\t\tif (this._editor && this._editor.hide) {\r\n\t\t\t\t\tthis._editor.hide(this._placeholder);\r\n\t\t\t\t}\r\n\t\t\t\tthis._editor = null;\r\n\t\t\t\tif (this._placeholder.parentNode) {\r\n\t\t\t\t\tthis._placeholder.parentNode.removeChild(this._placeholder);\r\n\t\t\t\t}\r\n\t\t\t\tthis._placeholder = null;\r\n\r\n\t\t\t\tthis.callEvent(\"onEditEnd\", [{id: itemId, columnName: columnName}]);\r\n\t\t\t},\r\n\t\t\tsave: function () {\r\n\t\t\t\tif(!(this.isVisible() && store.exists(this._itemId) && this.isChanged())) {\r\n\t\t\t\t\tthis.hide();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar itemId = this._itemId,\r\n\t\t\t\t\tcolumnName = this._columnName;\r\n\r\n\t\t\t\tif(!store.exists(itemId)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar item = store.getItem(itemId);\r\n\t\t\t\tvar editorConfig = this.getEditorConfig(columnName);\r\n\t\t\t\tvar editorState = {\r\n\t\t\t\t\tid: itemId,\r\n\t\t\t\t\tcolumnName: columnName,\r\n\t\t\t\t\tnewValue: this.getValue(),\r\n\t\t\t\t\toldValue: this._getItemValue()\r\n\t\t\t\t};\r\n\t\t\t\tif (this.callEvent(\"onBeforeSave\", [editorState]) !== false) {\r\n\t\t\t\t\tif (!this._editor.is_valid || this._editor.is_valid(editorState.newValue, editorState.id, grid.getColumn(columnName), this._placeholder)) {\r\n\t\t\t\t\t\t// GS-2598: set the initial value to the editor\r\n\t\t\t\t\t\tif(gantt._lightbox_id){\r\n\t\t\t\t\t\t\tif (editorState.newValue == \"\"){\r\n\t\t\t\t\t\t\t\teditorState.newValue = editorState.oldValue;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar mapTo = editorConfig.map_to;\r\n\t\t\t\t\t\tvar value = editorState.newValue;\r\n\t\t\t\t\t\tif (mapTo != \"auto\") {\r\n\t\t\t\t\t\t\titem[mapTo] = value;\r\n\t\t\t\t\t\t\tupdateTaskDateProperties(item, mapTo, gantt.config.inline_editors_date_processing);\r\n\r\n\t\t\t\t\t\t\tstore.updateItem(itemId);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._editor.save(itemId, grid.getColumn(columnName), this._placeholder);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.callEvent(\"onSave\", [editorState]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// GS-2598: don't close editor when we working in the lightbox\r\n\t\t\t\tif(!gantt._lightbox_id){\r\n\t\t\t\t\tthis.hide();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t_findEditableCell: function findEditableCell(start, direction){\r\n\t\t\t\tvar nextIndex = start;\r\n\t\t\t\tvar columns = grid.getGridColumns();\r\n\t\t\t\tvar nextColumn = columns[nextIndex];\r\n\r\n\t\t\t\tvar columnName = nextColumn ? nextColumn.name : null;\r\n\t\t\t\tif(columnName){\r\n\t\t\t\t\twhile(columnName && !this.getEditorConfig(columnName)){\r\n\t\t\t\t\t\tcolumnName = this._findEditableCell(start + direction, direction);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn columnName;\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t},\r\n\r\n\t\t\tgetNextCell: function moveCell(dir){\r\n\t\t\t\t// GS-1257. true means to exclude hidden columns\r\n\t\t\t\treturn this._findEditableCell(grid.getColumnIndex(this._columnName, true) + dir, dir);\r\n\t\t\t},\r\n\r\n\t\t\tgetFirstCell: function getFirstCell(){\r\n\t\t\t\treturn this._findEditableCell(0, 1);\r\n\t\t\t},\r\n\r\n\t\t\tgetLastCell: function getLastCell(){\r\n\t\t\t\treturn this._findEditableCell(grid.getGridColumns().length - 1, -1);\r\n\t\t\t},\r\n\r\n\t\t\teditNextCell: function nextCell(canChangeRow){\r\n\t\t\t\tvar cell = this.getNextCell(1);\r\n\t\t\t\tif(cell){\r\n\t\t\t\t\tvar nextColumn = this.getNextCell(1);\r\n\t\t\t\t\tif(nextColumn && this.getEditorConfig(nextColumn)){\r\n\t\t\t\t\t\tthis.startEdit(this._itemId, nextColumn);\r\n\t\t\t\t\t}\r\n\t\t\t\t}else if(canChangeRow && this.moveRow(1)){\r\n\t\t\t\t\tvar task = this.moveRow(1);\r\n\t\t\t\t\tcell = this.getFirstCell();\r\n\t\t\t\t\tif(cell && this.getEditorConfig(cell)){\r\n\t\t\t\t\t\tthis.startEdit(task, cell);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\teditPrevCell: function prevCell(canChangeRow){\r\n\t\t\t\tvar cell = this.getNextCell(-1);\r\n\t\t\t\tif(cell){\r\n\t\t\t\t\tvar nextColumn = this.getNextCell(-1);\r\n\t\t\t\t\tif(nextColumn && this.getEditorConfig(nextColumn)){\r\n\t\t\t\t\t\tthis.startEdit(this._itemId, nextColumn);\r\n\t\t\t\t\t}\r\n\t\t\t\t}else if(canChangeRow && this.moveRow(-1)){\r\n\t\t\t\t\tvar task = this.moveRow(-1);\r\n\t\t\t\t\tcell = this.getLastCell();\r\n\t\t\t\t\tif(cell && this.getEditorConfig(cell)){\r\n\t\t\t\t\t\tthis.startEdit(task, cell);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tmoveRow: function moveRow(dir) {\r\n\t\t\t\tvar moveTask = dir > 0 ? gantt.getNext : gantt.getPrev;\r\n\t\t\t\tmoveTask = gantt.bind(moveTask, gantt);\r\n\r\n\t\t\t\tvar nextItem = moveTask(this._itemId);\r\n\t\t\t\t// skip readonly rows\r\n\t\t\t\twhile (gantt.isTaskExists(nextItem) && gantt.isReadonly(gantt.getTask(nextItem))) {\r\n\t\t\t\t\tnextItem = moveTask(nextItem);\r\n\t\t\t\t}\r\n\t\t\t\treturn nextItem;\r\n\t\t\t},\r\n\r\n\t\t\teditNextRow: function nextRow(skipReadonly){\r\n\t\t\t\tvar id = this.getState().id;\r\n\t\t\t\tif (!gantt.isTaskExists(id)) return;\r\n\r\n\t\t\t\tvar next = null;\r\n\t\t\t\tif (skipReadonly){\r\n\t\t\t\t\tnext = this.moveRow(1);\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tnext = gantt.getNext(id);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (gantt.isTaskExists(next)){\r\n\t\t\t\t\tthis.startEdit(next, this._columnName);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\teditPrevRow: function prevRow(skipReadonly){\r\n\t\t\t\tvar id = this.getState().id;\r\n\t\t\t\tif (!gantt.isTaskExists(id)) return;\r\n\r\n\t\t\t\tvar prev = null;\r\n\t\t\t\tif (skipReadonly){\r\n\t\t\t\t\tprev = this.moveRow(-1);\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tprev = gantt.getPrev(id);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (gantt.isTaskExists(prev)){\r\n\t\t\t\t\tthis.startEdit(prev, this._columnName);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdetachStore: function(){\r\n\t\t\t\thandlers.forEach(function(handlerId){\r\n\t\t\t\t\tstore.detachEvent(handlerId);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tganttHandlers.forEach(function(handlerId){\r\n\t\t\t\t\tgantt.detachEvent(handlerId);\r\n\t\t\t\t});\r\n\t\t\t\thandlers = [];\r\n\t\t\t\tganttHandlers = [];\r\n\r\n\t\t\t\tstore = null;\r\n\t\t\t\tthis.hide();\r\n\t\t\t},\r\n\t\t\tdestructor: function(){\r\n\t\t\t\tthis.detachStore();\r\n\t\t\t\tthis.detachAllEvents();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tutils.mixin(controller, keyboardMapping);\r\n\t\tutils.mixin(controller, eventBus);\r\n\r\n\t\treturn controller;\r\n\t}\r\n\r\n\r\n\tvar inlineEditController = {\r\n\t\tinit: initConfigs,\r\n\t\tcreateEditors: createGridEditors\r\n\t};\r\n\r\n\tutils.mixin(inlineEditController, keyboardMapping);\r\n\tutils.mixin(inlineEditController, eventBus);\r\n\r\n\treturn inlineEditController;\r\n}\r\n\r\n\r\n\r\n\r\nexport default create;","// optimized checker for task bars smart rendering\r\n\r\n// first check the vertical position since it's easier to calculate\r\nexport default function isBarInViewport(item, viewport, view, config, gantt){\r\n\tif(!item.start_date || !item.end_date){\r\n\t\treturn null;\r\n\t}\r\n\r\n\tvar top = view.getItemTop(item.id);\r\n\tvar height = view.getItemHeight(item.id);\r\n\r\n\tif(top > viewport.y_end || top + height < viewport.y){\r\n\t\treturn false;\r\n\t}\r\n\r\n\tvar padding = 200;\r\n\tvar startCoord = view.posFromDate(item.start_date, view._getPositioningContext ? view._getPositioningContext(item) : null);\r\n\tvar endCoord = view.posFromDate(item.end_date, view._getPositioningContext ? view._getPositioningContext(item) : null);\r\n\tvar left = Math.min(startCoord, endCoord) - padding;\r\n\tvar right = Math.max(startCoord, endCoord) + padding;\r\n\r\n\tif(left > viewport.x_end || right < viewport.x){\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn true;\r\n};","function createTaskRenderer(gantt) {\r\n\r\n\tfunction _render_task_element(task, view, config) {\r\n\t\tvar config = view.$getConfig();\r\n\t\tvar painters = config.type_renderers;\r\n\t\tvar renderer = painters[gantt.getTaskType(task.type)],\r\n\t\t\tdefaultRenderer = _task_default_render;\r\n\r\n\t\tif (!renderer) {\r\n\t\t\treturn defaultRenderer.call(gantt, task, view, config);\r\n\t\t}else{\r\n\t\t\treturn renderer.call(gantt, task, function(task){ return defaultRenderer.call(gantt, task, view, config);}, view);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _task_default_render(task, view, config) {\r\n\t\tif (gantt._isAllowedUnscheduledTask(task))\r\n\t\t\treturn;\r\n\r\n\t\tif (!gantt._isTaskInTimelineLimits(task)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar pos = view.getItemPosition(task);\r\n\r\n\t\tvar cfg = config,\r\n\t\t\ttemplates = view.$getTemplates();\r\n\r\n\t\tvar taskType = gantt.getTaskType(task.type);\r\n\t\tvar height = view.getBarHeight(task.id, taskType == cfg.types.milestone);\r\n\r\n\t\tvar controlsMargin = 0;\r\n\t\tif (taskType == cfg.types.milestone) {\r\n\t\t\tcontrolsMargin = (height - pos.height)/2;\r\n\t\t}\r\n\r\n\t\tvar padd = Math.floor((view.getItemHeight(task.id) - height) / 2);\r\n\t\tconst hasBaselines = gantt.config.baselines && task.baselines && task.baselines.length;\r\n\t\tconst baselinesOnDifferentRow = gantt.config.baselines && (gantt.config.baselines.render_mode == \"separateRow\" || gantt.config.baselines.render_mode == \"individualRow\");\r\n\t\tif (hasBaselines && baselinesOnDifferentRow){\r\n\t\t\tif (task.bar_height !== \"full\" && task.bar_height < task.row_height){\r\n\t\t\t\tif (taskType === cfg.types.milestone){\r\n\t\t\t\t\tlet milestoneHeight = view.getBarHeight(task.id, true);\r\n\t\t\t\t\tlet milestoneWidth = Math.sqrt(2 * milestoneHeight * milestoneHeight);\r\n\t\t\t\t\tpadd = Math.floor((milestoneWidth - height) / 2) + 2;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpadd = 2;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t//\tif(task.type == cfg.types.milestone){\r\n\t//\t\tpadd -= 1;\r\n\t//\t}\r\n\t//\tif (taskType == cfg.types.milestone && cfg.link_line_width > 1) {\r\n\t//\t\t//little adjust milestone position, so horisontal corners would match link arrow when thickness of link line is more than 1px\r\n\t//\t\tpadd += 1;\r\n\t//\t}\r\n\r\n\t\tif (taskType == cfg.types.milestone) {\r\n\t\t\tpos.left -= Math.round(height / 2);\r\n\t\t\tpos.width = height;\r\n\t\t}\r\n\r\n\t\tvar div = document.createElement(\"div\");\r\n\r\n\t\tvar width = Math.round(pos.width);\r\n\r\n\t\tif(view.$config.item_attribute) {\r\n\t\t\tdiv.setAttribute(view.$config.item_attribute, task.id);\r\n\t\t\tdiv.setAttribute(view.$config.bind + \"_id\", task.id); // 'task_id'/'resource_id' for backward compatibility\r\n\t\t}\r\n\r\n\t\tif (cfg.show_progress && taskType != cfg.types.milestone) {\r\n\t\t\t_render_task_progress(task, div, width, cfg, templates);\r\n\t\t}\r\n\r\n\t\t//use separate div to display content above progress bar\r\n\t\tvar content = _render_task_content(task, width, templates);\r\n\r\n\t\tdiv.appendChild(content);\r\n\r\n\t\tvar css = _combine_item_class(\"gantt_task_line\",\r\n\t\t\ttemplates.task_class(task.start_date, task.end_date, task),\r\n\t\t\ttask.id,\r\n\t\t\tview);\r\n\t\tif (task.color || task.progressColor || task.textColor) {\r\n\t\t\tcss += \" gantt_task_inline_color\";\r\n\t\t}\r\n\t\tif (pos.width < 20){\r\n\t\t\tcss += \" gantt_thin_task\";\r\n\t\t}\r\n\t\tdiv.className = css;\r\n\r\n\t\tvar styles = [\r\n\t\t\t\"left:\" + pos.left + \"px\",\r\n\t\t\t\"top:\" + (padd + pos.top) + 'px',\r\n\t\t\t\"height:\" + (height) + 'px',\r\n\t\t\t\"line-height:\" + (Math.max(height < 30 ? height - 2 : height, 0)) + 'px',\r\n\t\t\t\"width:\" + width + 'px'\r\n\t\t];\r\n\r\n\t\tdiv.style.cssText = styles.join(\";\");\r\n\t\tif (task.color) {\r\n\t\t\tdiv.style.setProperty(\"--dhx-gantt-task-background\", task.color);\r\n\t\t}\r\n\t\tif (task.textColor) {\r\n\t\t\tdiv.style.setProperty(\"--dhx-gantt-task-color\", task.textColor);\r\n\t\t}\r\n\r\n\t\tif (task.progressColor) {\r\n\t\t\tdiv.style.setProperty(\"--dhx-gantt-task-progress-color\", task.progressColor);\r\n\t\t}\r\n\r\n\t\t\r\n\t\tvar side = _render_leftside_content(task, cfg, templates, controlsMargin);\r\n\t\tif (side) div.appendChild(side);\r\n\r\n\t\tside = _render_rightside_content(task, cfg, templates, controlsMargin);\r\n\t\tif (side) div.appendChild(side);\r\n\r\n\t\tgantt._waiAria.setTaskBarAttr(task, div);\r\n\r\n\t\tvar state = gantt.getState();\r\n\t\tconst taskEditable = !gantt.isReadonly(task);\r\n\t\tconst timelineDrag = gantt.ext.dragTimeline && gantt.ext.dragTimeline._isDragInProgress();\r\n\r\n\t\tif (taskEditable || timelineDrag) {\r\n\t\t\tif (cfg.drag_resize && !gantt.isSummaryTask(task) && taskType != cfg.types.milestone) {\r\n\t\t\t\t_render_pair(div, \"gantt_task_drag\", task, function (css) {\r\n\t\t\t\t\tvar el = document.createElement(\"div\");\r\n\t\t\t\t\tel.className = css;\r\n\t\t\t\t\treturn el;\r\n\t\t\t\t}, cfg);\r\n\t\t\t}\r\n\t\t\tif (cfg.drag_links && cfg.show_links) {\r\n\t\t\t\t_render_pair(div, \"gantt_link_control\", task, function (css) {\r\n\t\t\t\t\tvar outer = document.createElement(\"div\");\r\n\t\t\t\t\touter.className = css;\r\n\t\t\t\t\touter.style.cssText = [\r\n\t\t\t\t\t\t\"height:\" + height + 'px',\r\n\t\t\t\t\t\t\"line-height:\" + height + 'px'\r\n\t\t\t\t\t].join(\";\");\r\n\t\t\t\t\tvar inner = document.createElement(\"div\");\r\n\t\t\t\t\tinner.className = \"gantt_link_point\";\r\n\r\n\t\t\t\t\tvar showLinkPoints = false;\r\n\t\t\t\t\tif(state.link_source_id && cfg.touch){\r\n\t\t\t\t\t\tshowLinkPoints = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tinner.style.display = showLinkPoints ? \"block\" : \"\";\r\n\t\t\t\t\touter.appendChild(inner);\r\n\t\t\t\t\treturn outer;\r\n\t\t\t\t}, cfg, controlsMargin);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn div;\r\n\t}\r\n\r\n\tfunction _render_side_content(task, template, cssClass, marginStyle) {\r\n\t\tif (!template) return null;\r\n\r\n\t\tvar text = template(task.start_date, task.end_date, task);\r\n\t\tif (!text) return null;\r\n\t\tvar content = document.createElement(\"div\");\r\n\t\tcontent.className = \"gantt_side_content \" + cssClass;\r\n\t\tcontent.innerHTML = text;\r\n\t\tif(marginStyle){\r\n\t\t\tcontent.style[marginStyle.type] = Math.abs(marginStyle.value) + \"px\";\r\n\t\t}\r\n\t\treturn content;\r\n\t}\r\n\r\n\tfunction _render_leftside_content(task, cfg, templates, margin) {\r\n\t\tvar css = \"gantt_left \" + _get_link_crossing_css(!cfg.rtl ? true : false, task, cfg);\r\n\t\tvar marginStyle = null;\r\n\t\tif(margin){\r\n\t\t\tmarginStyle = { type: \"marginRight\", value: margin };\r\n\t\t}\r\n\t\treturn _render_side_content(task, templates.leftside_text, css, marginStyle);\r\n\t}\r\n\r\n\tfunction _render_rightside_content(task, cfg, templates, margin) {\r\n\t\tvar css = \"gantt_right \" + _get_link_crossing_css(!cfg.rtl ? false : true, task, cfg);\r\n\t\tvar marginStyle = null;\r\n\t\tif(margin){\r\n\t\t\tmarginStyle = { type: \"marginLeft\", value: margin };\r\n\t\t}\r\n\t\treturn _render_side_content(task, templates.rightside_text, css, marginStyle);\r\n\t}\r\n\r\n\tfunction _get_link_crossing_css(left, task) {\r\n\t\tvar cond = _get_conditions(left);\r\n\r\n\t\tfor (var i in cond) {\r\n\t\t\tvar links = task[i];\r\n\t\t\tfor (var ln = 0; ln < links.length; ln++) {\r\n\t\t\t\tvar link = gantt.getLink(links[ln]);\r\n\r\n\t\t\t\tfor (var tp = 0; tp < cond[i].length; tp++) {\r\n\t\t\t\t\tif (link.type == cond[i][tp]) {\r\n\t\t\t\t\t\treturn \"gantt_link_crossing\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\r\n\tfunction _render_task_content(task, width, templates) {\r\n\t\tvar content = document.createElement(\"div\");\r\n\t\tif (gantt.getTaskType(task.type) != gantt.config.types.milestone){\r\n\t\t\tcontent.innerHTML = templates.task_text(task.start_date, task.end_date, task);\r\n\t\t} else if(gantt.getTaskType(task.type) == gantt.config.types.milestone && width) {\r\n\t\t\tcontent.style.height = content.style.width = width + \"px\";\r\n\t\t}\r\n\t\tcontent.className = \"gantt_task_content\";\r\n\t\t//content.style.width = width + 'px';\r\n\t\treturn content;\r\n\t}\r\n\r\n\tfunction _render_task_progress(task, element, maxWidth, cfg, templates) {\r\n\t\tvar done = task.progress * 1 || 0;\r\n\t\t//GS-2776: borders were removed in v9.0\r\n\t\tmaxWidth = Math.max(maxWidth, 0);\r\n\t\tvar pr = document.createElement(\"div\");\r\n\t\tvar width = Math.round(maxWidth * done);\r\n\r\n\t\twidth = Math.min(maxWidth, width);\r\n\r\n\t\tpr.style.width = width + 'px';\r\n\t\tpr.className = \"gantt_task_progress\";\r\n\t\tpr.innerHTML = templates.progress_text(task.start_date, task.end_date, task);\r\n\r\n\t\tif(cfg.rtl){\r\n\t\t\tpr.style.position = \"absolute\";\r\n\t\t\tpr.style.right = \"0px\";\r\n\t\t}\r\n\r\n\t\tvar wrapper = document.createElement(\"div\");\r\n\t\twrapper.className = \"gantt_task_progress_wrapper\";\r\n\t\twrapper.appendChild(pr);\r\n\t\telement.appendChild(wrapper);\r\n\r\n\t\tconst taskEditable = !gantt.isReadonly(task);\r\n\t\tconst timelineDrag = gantt.ext.dragTimeline && gantt.ext.dragTimeline._isDragInProgress();\r\n\r\n\t\tif (gantt.config.drag_progress && (taskEditable || timelineDrag)) {\r\n\t\t\tvar drag = document.createElement(\"div\");\r\n\r\n\t\t\tvar markerPos = width;\r\n\t\t\tif(cfg.rtl){\r\n\t\t\t\tmarkerPos = maxWidth - width;\r\n\t\t\t}\r\n\r\n\t\t\tdrag.style.left = markerPos + 'px';\r\n\t\t\tdrag.className = \"gantt_task_progress_drag\";\r\n\t\t\tdrag.innerHTML = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"9\" viewBox=\"0 0 12 9\" fill=\"none\">\r\n<path d=\"M5.58397 1.52543C5.78189 1.22856 6.21811 1.22856 6.41602 1.52543L10.5475 7.72265C10.769 8.05493 10.5308 8.5 10.1315 8.5L1.86852 8.5C1.46917 8.5 1.23097 8.05493 1.45249 7.72265L5.58397 1.52543Z\" fill=\"var(--dhx-gantt-progress-handle-background)\" stroke=\"var(--dhx-gantt-progress-handle-border)\"/>\r\n</svg>`;\r\n\t\t\tpr.appendChild(drag);\r\n\t\t\telement.appendChild(drag);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _get_conditions(leftside) {\r\n\t\tif (leftside) {\r\n\t\t\treturn {\r\n\t\t\t\t$source: [\r\n\t\t\t\t\tgantt.config.links.start_to_start\r\n\t\t\t\t],\r\n\t\t\t\t$target: [\r\n\t\t\t\t\tgantt.config.links.start_to_start,\r\n\t\t\t\t\tgantt.config.links.finish_to_start\r\n\t\t\t\t]\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\treturn {\r\n\t\t\t\t$source: [\r\n\t\t\t\t\tgantt.config.links.finish_to_start,\r\n\t\t\t\t\tgantt.config.links.finish_to_finish\r\n\t\t\t\t],\r\n\t\t\t\t$target: [\r\n\t\t\t\t\tgantt.config.links.finish_to_finish\r\n\t\t\t\t]\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _combine_item_class(basic, template, itemId, view) {\r\n\t\tvar cfg = view.$getConfig();\r\n\t\tvar css = [basic];\r\n\t\tif (template)\r\n\t\t\tcss.push(template);\r\n\r\n\t\tvar state = gantt.getState();\r\n\r\n\t\tvar task = gantt.getTask(itemId);\r\n\r\n\t\tif (gantt.getTaskType(task.type) == cfg.types.milestone) {\r\n\t\t\tcss.push(\"gantt_milestone\");\r\n\t\t}else if (gantt.getTaskType(task.type) == cfg.types.project) {\r\n\t\t\tcss.push(\"gantt_project\");\r\n\t\t}\r\n\r\n\t\tcss.push(\"gantt_bar_\" + gantt.getTaskType(task.type));\r\n\r\n\r\n\t\tif (gantt.isSummaryTask(task))\r\n\t\t\tcss.push(\"gantt_dependent_task\");\r\n\r\n\t\tif (gantt.isSplitTask(task) && ((task.$inlineSplit && task.$inlineSplit.length) || ((cfg.open_split_tasks && !task.$open && (task.$inlineSplit && task.$inlineSplit.length)) || !cfg.open_split_tasks))) {\r\n\t\t\tcss.push(\"gantt_split_parent\");\r\n\t\t}\r\n\r\n\t\tif (cfg.select_task && gantt.isSelectedTask(itemId)) {\r\n\t\t\tcss.push(\"gantt_selected\");\r\n\t\t}\r\n\r\n\t\tif (itemId == state.drag_id) {\r\n\t\t\tcss.push(\"gantt_drag_\" + state.drag_mode);\r\n\t\t\tif (state.touch_drag) {\r\n\t\t\t\tcss.push(\"gantt_touch_\" + state.drag_mode);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (state.link_source_id == itemId){\r\n\t\t\tcss.push(\"gantt_link_source\");\r\n\t\t\tif(state.link_from_start) {\r\n\t\t\t\tcss.push(\"gantt_link_from_start\");\r\n\t\t\t}else{\r\n\t\t\t\tcss.push(\"gantt_link_from_end\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (state.link_target_id == itemId)\r\n\t\t\tcss.push(\"gantt_link_target\");\r\n\r\n\r\n\t\tif (cfg.highlight_critical_path && gantt.isCriticalTask) {\r\n\t\t\tif (gantt.isCriticalTask(task))\r\n\t\t\t\tcss.push(\"gantt_critical_task\");\r\n\t\t}\r\n\r\n\t\tif (state.link_landing_area &&\r\n\t\t\t(state.link_target_id && state.link_source_id) &&\r\n\t\t\t(state.link_target_id != state.link_source_id) &&\r\n\t\t\t(state.link_target_id == itemId || state.link_source_id == itemId)) {\r\n\r\n\t\t\tvar from_id = state.link_source_id;\r\n\t\t\tvar from_start = state.link_from_start;\r\n\t\t\tvar to_start = state.link_to_start;\r\n\r\n\t\t\tvar allowDrag = gantt.isLinkAllowed(from_id, itemId, from_start, to_start);\r\n\r\n\t\t\tvar dragClass = \"\";\r\n\t\t\tif (allowDrag) {\r\n\t\t\t\tif (to_start)\r\n\t\t\t\t\tdragClass = \"link_start_allow\";\r\n\t\t\t\telse\r\n\t\t\t\t\tdragClass = \"link_finish_allow\";\r\n\t\t\t} else {\r\n\t\t\t\tif (to_start)\r\n\t\t\t\t\tdragClass = \"link_start_deny\";\r\n\t\t\t\telse\r\n\t\t\t\t\tdragClass = \"link_finish_deny\";\r\n\t\t\t}\r\n\t\t\tcss.push(dragClass);\r\n\t\t}\r\n\t\treturn css.join(\" \");\r\n\t}\r\n\r\n\tfunction _render_pair(parent, css, task, content, config, margin) {\r\n\t\tvar state = gantt.getState();\r\n\t\tvar className, element;\r\n\t\tif (+task.start_date >= +state.min_date) {\r\n\t\t\tclassName = [css, config.rtl ? \"task_right\" : \"task_left\", \"task_start_date\"];\r\n\t\t\telement = content(className.join(\" \"));\r\n\t\t\telement.setAttribute(\"data-bind-property\", \"start_date\");\r\n\t\t\tif(margin){\r\n\t\t\t\telement.style.marginLeft = margin + \"px\";\r\n\t\t\t}\r\n\t\t\tparent.appendChild(element);\r\n\t\t}\r\n\r\n\t\tif (+task.end_date <= +state.max_date){\r\n\t\t\tclassName = [css, config.rtl ? \"task_left\" : \"task_right\", \"task_end_date\"];\r\n\t\t\telement = content(className.join(\" \"));\r\n\t\t\telement.setAttribute(\"data-bind-property\", \"end_date\");\r\n\t\t\tif(margin){\r\n\t\t\t\telement.style.marginRight = margin + \"px\";\r\n\t\t\t}\r\n\t\t\tparent.appendChild(element);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn _render_task_element;\r\n}\r\n\r\nexport default createTaskRenderer;","import isInViewPort from \"./viewport/is_bar_in_viewport\";\r\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\r\nimport createBaseBarRender from \"./task_bar_render\";\r\n\r\nexport default function createTaskRenderer(gantt){\r\n\tvar defaultRender = createBaseBarRender(gantt);\r\n\treturn {\r\n\t\trender: defaultRender,\r\n\t\tupdate: null,\r\n\t\t//getRectangle: getBarRectangle\r\n\t\tisInViewPort: isInViewPort,\r\n\t\tgetVisibleRange: getVisibleRange\r\n\t};\r\n};","export default function () {\r\n  // eslint-disable-next-line no-console\r\n  console.error(\"You are trying to use a Pro feature that is not available in the GPL version.\");\r\n  return {\r\n    render: function (){},\r\n    isInViewPort: function (){},\r\n    getVisibleRange: function (){}\r\n  };\r\n};\r\n","import createBaseBarRender from \"./task_bar_render\";\r\nimport isInViewPort from \"./viewport/is_bar_in_viewport\";\r\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\r\n\r\nfunction createTaskRenderer(gantt){\r\n\tconst defaultRender = createBaseBarRender(gantt);\r\n\r\n\tconst renderedNodes = {};\r\n\r\n\tfunction checkVisibility(child, viewPort, timeline, config, gantt){\r\n\t\tlet isVisible = true;\r\n\t\t// GS-2123. Don't render rollup tasks that are outside the viewport\r\n\t\tif (config.smart_rendering){\r\n\t\t\tisVisible = isInViewPort(child, viewPort, timeline, config, gantt);\r\n\t\t}\r\n\t\treturn isVisible;\r\n\t}\r\n\r\n\tfunction generateChildElement(task, child, timeline, sizes){\r\n\t\tconst childCopy = gantt.copy(gantt.getTask(child.id));\r\n\t\tchildCopy.$rendered_at = task.id;\r\n\t\t// a way to filter rollup tasks:\r\n\t\tconst displayRollup = gantt.callEvent(\"onBeforeRollupTaskDisplay\", [childCopy.id, childCopy, task.id]);\r\n\t\tif (displayRollup === false){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst element = defaultRender(childCopy, timeline);\r\n\t\tif(!element){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst height = timeline.getBarHeight(task.id, child.type == gantt.config.types.milestone);\r\n\t\tconst padding = Math.floor((timeline.getItemHeight(task.id) - height) / 2);\r\n\r\n\t\telement.style.top = (sizes.top + padding) + \"px\";\r\n\t\telement.classList.add(\"gantt_rollup_child\");\r\n\t\telement.setAttribute(\"data-rollup-parent-id\", task.id);\r\n\r\n\t\treturn element;\r\n\t}\r\n\r\n\tfunction getKey(childId, renderParentId){\r\n\t\treturn childId + \"_\" + renderParentId;\r\n\t}\r\n\r\n\r\n\tfunction renderRollupTask(task, timeline, config, viewPort) {\r\n\t\tif (task.rollup !== false && task.$rollup && task.$rollup.length) {\r\n\t\t\tconst el = document.createElement('div'),\r\n\t\t\t\tsizes = gantt.getTaskPosition(task);\r\n\r\n\t\t\t// vertical position is not important for the rollup tasks as long as the parent is rendered\r\n\t\t\tif (viewPort){\r\n\t\t\t\tviewPort.y = 0;\r\n\t\t\t\tviewPort.y_end = gantt.$task_bg.scrollHeight;\r\n\t\t\t}\r\n\r\n\t\t\ttask.$rollup.forEach(function(itemId){\r\n\t\t\t\tif (!gantt.isTaskExists(itemId)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tconst child = gantt.getTask(itemId);\r\n\t\t\t\tlet isVisible = checkVisibility(child, viewPort, timeline, config, gantt);\r\n\t\t\t\tif (!isVisible){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst element = generateChildElement(task, child, timeline, sizes);\r\n\t\t\t\tif (element) {\r\n\t\t\t\t\trenderedNodes[getKey(child.id, task.id)] = element;\r\n\t\t\t\t\tel.appendChild(element);\r\n\t\t\t\t} else{\r\n\t\t\t\t\trenderedNodes[getKey(child.id, task.id)] = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\t\t\treturn el;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction repaintRollupTask(task, itemNode, timeline, config, viewPort) {\r\n\t\tconst el = document.createElement(\"div\"),\r\n\t\tsizes = gantt.getTaskPosition(task);\r\n\r\n\t\t// vertical position is not important for the rollup tasks as long as the parent is rendered\r\n\t\tviewPort.y = 0;\r\n\t\tviewPort.y_end = gantt.$task_bg.scrollHeight;\r\n\r\n\t\ttask.$rollup.forEach(function(itemId){\r\n\t\t\tconst child = gantt.getTask(itemId);\r\n\t\t\tconst rollupKey = getKey(child.id, task.id);\r\n\t\t\tlet isVisible = checkVisibility(child, viewPort, timeline, config, gantt);\r\n\t\t\tif (isVisible !== !!renderedNodes[rollupKey]) {\r\n\r\n\t\t\t\tif (isVisible) {\r\n\t\t\t\t\tconst element = generateChildElement(task, child, timeline, sizes);\r\n\t\t\t\t\trenderedNodes[rollupKey] = element || false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\trenderedNodes[rollupKey] = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!!renderedNodes[rollupKey]) {\r\n\t\t\t\tel.appendChild(renderedNodes[rollupKey]);\r\n\t\t\t}\r\n\t\t\titemNode.innerHTML = \"\";\r\n\t\t\titemNode.appendChild(el);\r\n\t\t});\r\n\t}\r\n\r\n\r\n\r\n\treturn {\r\n\t\trender: renderRollupTask,\r\n\t\tupdate: repaintRollupTask,\r\n\t\t//getRectangle: getBarRectangle\r\n\t\tisInViewPort: isInViewPort,\r\n\t\tgetVisibleRange: getVisibleRange\r\n\t};\r\n}\r\n\r\nexport default createTaskRenderer;","export default function(item, view, config){\r\n\treturn {\r\n\t\ttop: view.getItemTop(item.id),\r\n\t\theight: view.getItemHeight(item.id),\r\n\t\tleft: 0,\r\n\t\tright: Infinity\r\n\t};\r\n};","export default function getVisibleCellsRange(scale, viewport){\r\n\tvar firstCellIndex = 0;\r\n\tvar lastCellIndex = scale.left.length - 1;\r\n\tif(viewport){\r\n\t\tfor(var i = 0; i < scale.left.length; i++){\r\n\t\t\tvar left = scale.left[i];\r\n\t\t\tif(left < viewport.x){\r\n\t\t\t\tfirstCellIndex = i;\r\n\t\t\t}\r\n\t\t\tif(left > viewport.x_end){\r\n\t\t\t\tlastCellIndex = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\tstart: firstCellIndex,\r\n\t\tend: lastCellIndex\r\n\t};\r\n};","import isLegacyRender from \"../is_legacy_smart_render\";\r\n\r\nexport default function isColumnVisible(columnIndex, scale, viewPort, gantt){\r\n\tvar width = scale.width[columnIndex];\r\n\tif(width <= 0){\r\n\t\treturn false;\r\n\t}\r\n\tif(!gantt.config.smart_rendering || isLegacyRender(gantt)){\r\n\t\treturn true;\r\n\t}\r\n\tvar cellLeftCoord = scale.left[columnIndex] - width;\r\n\tvar cellRightCoord = scale.left[columnIndex] + width;\r\n\treturn (cellLeftCoord <= viewPort.x_end && cellRightCoord >= viewPort.x);//do not render skipped columns\r\n};","export default function (items, gantt){\r\n\tvar placeholderConfig = gantt.config.timeline_placeholder;\r\n\titems = items || [];\r\n\tif (placeholderConfig && items.filter(e => e.id === 'timeline_placeholder_task').length === 0){\r\n\t\tvar state = gantt.getState();\r\n\t\tvar lastTaskId = null;\r\n\t\tvar start_date = state.min_date;\r\n\t\tvar end_date = state.max_date;\r\n\t\tif (items.length){\r\n\t\t\tlastTaskId = items[items.length -1].id;\r\n\t\t}\r\n\t\tvar placeholderTask = {\r\n\t\t\tstart_date: start_date, \r\n\t\t\tend_date: end_date, \r\n\t\t\trow_height: placeholderConfig.height || 0,\r\n\t\t\tid: \"timeline_placeholder_task\", \r\n\t\t\tunscheduled: true,\r\n\t\t\tlastTaskId: lastTaskId, \r\n\t\t\tcalendar_id: placeholderConfig.calendar || \"global\",\r\n\t\t\t$source:[], \r\n\t\t\t$target: []\r\n\t\t};\r\n\t\titems.push(placeholderTask);\r\n\t}\r\n};","import getRowRectangle from \"./viewport/get_bg_row_rectangle\";\r\nimport isLegacyRender from \"./is_legacy_smart_render\";\r\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\r\nimport getVisibleCellsRange from \"./viewport/get_visible_cells_range\";\r\nimport isColumnVisible from \"./viewport/is_column_visible\";\r\nimport bgPlaceholder from \"./prerender/task_bg_placeholder\";\r\n\r\nfunction createTaskBgRender(gantt){\r\n\tvar renderedCells = {};\r\n\tvar visibleCells = {};\r\n\r\n\tfunction cleanupCell(itemId) {\r\n\t\tif (renderedCells[itemId]) {\r\n\t\t\tfor (let columnIndex in renderedCells[itemId]) {\r\n\t\t\t\tconst cell = renderedCells[itemId][columnIndex];\r\n\t\t\t\tif (cell && cell.parentNode) {\r\n\t\t\t\t\tcell.parentNode.removeChild(cell);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tdelete renderedCells[itemId];\r\n\t\t}\r\n\t\tif (visibleCells[itemId]) {\r\n\t\t\tdelete visibleCells[itemId];\r\n\t\t}\r\n\t}\r\n\r\n\t// GS-3018: Add cleanup method for all cells\r\n\tfunction cleanupAll() {\r\n\t\tfor (let itemId in renderedCells) {\r\n\t\t\tcleanupCell(itemId);\r\n\t\t}\r\n\t\trenderedCells = {};\r\n\t\tvisibleCells = {};\r\n\t}\r\n\r\n\tfunction isRendered(item, columnIndex){\r\n\t\tif(renderedCells[item.id][columnIndex] && renderedCells[item.id][columnIndex].parentNode){\r\n\t\t\treturn true;\r\n\t\t}else{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction detachRenderedCell(itemId, columnIndex){\r\n\t\tif(renderedCells[itemId] && renderedCells[itemId][columnIndex] &&\r\n\t\t\trenderedCells[itemId][columnIndex].parentNode\r\n\t\t\t){\r\n\t\t\t\trenderedCells[itemId][columnIndex].parentNode.removeChild(renderedCells[itemId][columnIndex]);\r\n\t\t\t}\r\n\t}\r\n\r\n\tfunction getCellClassTemplate(view){\r\n\t\tvar templates = view.$getTemplates();\r\n\t\tvar cssTemplate;\r\n\t\tif (typeof templates.task_cell_class !== \"undefined\") {\r\n\t\t\tcssTemplate = templates.task_cell_class;\r\n\t\t\t// eslint-disable-next-line no-console\r\n\t\t\tvar log = console.warn || console.log;\r\n\t\t\tlog('gantt.templates.task_cell_class template is deprecated and will be removed soon. Please use gantt.templates.timeline_cell_class instead.');\r\n\t\t} else {\r\n\t\t\tcssTemplate = templates.timeline_cell_class;\r\n\t\t}\r\n\t\treturn cssTemplate;\r\n\t}\r\n\tfunction getCellContentTemplate(view){\r\n\t\tvar templates = view.$getTemplates();\r\n\t\tvar contentTemplate = templates.timeline_cell_content;\r\n\t\treturn contentTemplate;\r\n\t}\r\n\r\n\tfunction renderCells(item, node, view, config, viewPort){\r\n\t\tvar cfg = view.getScale();\r\n\t\tvar count = cfg.count;\r\n\t\tvar cssTemplate = getCellClassTemplate(view);\r\n\t\tvar contentTemplate = getCellContentTemplate(view);\r\n\r\n\t\tif (config.show_task_cells) {\r\n\t\t\tif(!renderedCells[item.id]){\r\n\t\t\t\trenderedCells[item.id] = {};\r\n\t\t\t}\r\n\t\t\tif(!visibleCells[item.id]){\r\n\t\t\t\tvisibleCells[item.id] = {};\r\n\t\t\t}\r\n\r\n\t\t\tvar range = getVisibleCellsRange(cfg, viewPort);\r\n\r\n\t\t\tfor(var i in visibleCells[item.id]){\r\n\t\t\t\tvar index = visibleCells[item.id][i];\r\n\r\n\t\t\t\tif(Number(index) < range.start || Number(index) > range.end){\r\n\t\t\t\t\tdetachRenderedCell(item.id, index);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvisibleCells[item.id] = {};\r\n\t\t\t// TODO: do not iterate all cell, only ones in the viewport and once that are already rendered\r\n\t\t\tfor (var columnIndex = range.start; columnIndex <= range.end; columnIndex++) {\r\n\t\t\t\tvar cell = renderOneCell(cfg, columnIndex, item, viewPort, count, cssTemplate, contentTemplate, config);\r\n\t\t\t\tif(!cell && isRendered(item, columnIndex)){\r\n\t\t\t\t\tdetachRenderedCell(item.id, columnIndex);\r\n\t\t\t\t}else if (cell && !cell.parentNode){\r\n\t\t\t\t\tnode.appendChild(cell);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction renderOneCell(scale, columnIndex, item, viewPort, count, cssTemplate, contentTemplate, config){\r\n\t\tvar width = scale.width[columnIndex],\r\n\t\t\tcssclass = \"\";\r\n\r\n\t\tif (isColumnVisible(columnIndex, scale, viewPort, gantt)) {//do not render skipped columns\r\n\r\n\t\t\tvar cssTemplateContent = cssTemplate(item, scale.trace_x[columnIndex]);\r\n\t\t\tvar htmlTemplateContent = \"\";\r\n\t\t\tif (contentTemplate) {// for backward compatibility, contentTemplate was added in 7.2.0+, will be undefined if someone used copy of old config/template object\r\n\t\t\t\thtmlTemplateContent = contentTemplate(item, scale.trace_x[columnIndex]);\r\n\t\t\t}\r\n\r\n\t\t\tif(config.static_background){\r\n\t\t\t\t// if cell render in static background is not allowed, or if it's a blank cell\r\n\t\t\t\tvar customCell = !!(cssTemplateContent || htmlTemplateContent);\r\n\t\t\t\tif(!(config.static_background_cells && customCell)){\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(renderedCells[item.id][columnIndex]){\r\n\t\t\t\tvisibleCells[item.id][columnIndex] = columnIndex;\r\n\t\t\t\treturn renderedCells[item.id][columnIndex];\r\n\t\t\t}\r\n\t\t\tvar cell = document.createElement(\"div\");\r\n\t\t\tcell.style.width = (width) + \"px\";\r\n\r\n\t\t\tcssclass = \"gantt_task_cell\" + (columnIndex == count - 1 ? \" gantt_last_cell\" : \"\");\r\n\t\t\tif (cssTemplateContent) {\r\n\t\t\t\tcssclass += \" \" + cssTemplateContent;\r\n\t\t\t}\r\n\t\t\tcell.className = cssclass;\r\n\r\n\t\t\tif (htmlTemplateContent) {\r\n\t\t\t\tcell.innerHTML = htmlTemplateContent;\r\n\t\t\t}\r\n\r\n\t\t\tcell.style.position = \"absolute\";\r\n\t\t\tcell.style.left = scale.left[columnIndex] + \"px\";\r\n\t\t\trenderedCells[item.id][columnIndex] = cell;\r\n\t\t\tvisibleCells[item.id][columnIndex] = columnIndex;\r\n\r\n\t\t\treturn cell;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tfunction _render_bg_line(item, view, config, viewPort) {\r\n\t\tvar templates = view.$getTemplates();\r\n\t\tvar cfg = view.getScale();\r\n\t\tvar count = cfg.count;\r\n\r\n\t\tif(config.static_background && !config.static_background_cells){\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar row = document.createElement(\"div\");\r\n\r\n\t\tvar cellCssTemplate = getCellClassTemplate(view);\r\n\t\tvar cellHtmlTemplate = getCellContentTemplate(view);\r\n\r\n\t\tvar range;\r\n\r\n\t\tif(!viewPort || !config.smart_rendering || isLegacyRender(gantt)){\r\n\t\t\trange = {\r\n\t\t\t\tstart: 0,\r\n\t\t\t\tend: count - 1\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\trange = getVisibleCellsRange(cfg, viewPort.x);\r\n\t\t}\r\n\t\tif (config.show_task_cells) {\r\n\t\t\trenderedCells[item.id] = {};\r\n\t\t\tvisibleCells[item.id] = {};\r\n\t\t\tfor (var columnIndex = range.start; columnIndex <= range.end; columnIndex++) {\r\n\t\t\t\tvar cell = renderOneCell(cfg, columnIndex, item, viewPort, count, cellCssTemplate, cellHtmlTemplate, config);\r\n\t\t\t\tif(cell){\r\n\t\t\t\t\trow.appendChild(cell);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// GS-291. The odd class should be assigned correctly\r\n\t\tconst store = view.$config.rowStore;\r\n\t\tconst odd = store.getIndexById(item.id) % 2 !== 0;\r\n\r\n\t\tvar cssTemplate = templates.task_row_class(item.start_date, item.end_date, item);\r\n\t\tvar css = \"gantt_task_row\" + (odd ? \" odd\" : \"\") + (cssTemplate ? ' ' + cssTemplate : '');\r\n\r\n\t\tif(store.isSelected(item.id)) {\r\n\t\t\tcss += \" gantt_selected\";\r\n\t\t}\r\n\r\n\t\trow.className = css;\r\n\r\n\t\tif (config.smart_rendering) {\r\n\t\t\trow.style.position = \"absolute\";\r\n\t\t\trow.style.top = view.getItemTop(item.id) + \"px\";\r\n\t\t\trow.style.width = \"100%\";\r\n\t\t}else{\r\n\t\t\trow.style.position = \"relative\";\r\n\t\t}\r\n\t\trow.style.height = (view.getItemHeight(item.id)) + \"px\";\r\n\r\n\t\tif (item.id == \"timeline_placeholder_task\"){\r\n\t\t\tvar placeholderTop = 0;\r\n\t\t\tif (item.lastTaskId){\r\n\t\t\t\tvar lastTaskTop = view.getItemTop(item.lastTaskId);\r\n\t\t\t\tvar lastTaskHeight = view.getItemHeight(item.lastTaskId);\r\n\t\t\t\tplaceholderTop = lastTaskTop + lastTaskHeight;\t\r\n\t\t\t}\r\n\r\n\t\t\tvar maxHeight = item.row_height || view.$task_data.offsetHeight;\r\n\r\n\t\t\tvar placeholderHeight = maxHeight - placeholderTop;\r\n\t\t\t// So that it won't exceed the placeholder timeline height\r\n\t\t\tif (placeholderHeight < 0){\r\n\t\t\t\tplaceholderHeight = 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (config.smart_rendering) {\r\n\t\t\t\trow.style.top = placeholderTop + \"px\";\t\r\n\t\t\t}\r\n\t\t\trow.style.height = placeholderHeight + \"px\";\r\n\t\t}\r\n\r\n\r\n\t\tif(view.$config.item_attribute){\r\n\t\t\trow.setAttribute(view.$config.item_attribute, item.id);\r\n\t\t\trow.setAttribute(view.$config.bind + \"_id\", item.id); // 'task_id'/'resource_id' for backward compatibility\r\n\t\t}\r\n\r\n\t\treturn row;\r\n\t}\r\n\r\n\treturn {\r\n\t\trender: _render_bg_line,\r\n\t\tupdate: renderCells,\r\n\t\tclear: cleanupAll,\r\n\t\tgetRectangle: getRowRectangle,\r\n\t\tgetVisibleRange: getVisibleRange,\r\n\t\tprepareData: bgPlaceholder\r\n\t};\r\n}\r\n\r\nexport default createTaskBgRender;\r\n","import isInViewPort from \"./viewport/is_link_in_viewport\";\r\nimport getVisibleRange from \"./viewport/factory/get_visible_link_range\";\r\nimport { childrenHaveBaselines, getMaxParentHeight } from \"./baseline_helper\";\r\n\r\n\r\nfunction createLinkRender(gantt){\r\n\r\nfunction _render_link_element(link, view, config) {\r\n\tvar source = gantt.getTask(link.source);\r\n\tif(source.hide_bar){\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar target = gantt.getTask(link.target);\r\n\tif(target.hide_bar){\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar pt = path_builder.get_endpoint(link, view, source, target);\r\n\tvar dy = pt.e_y - pt.y;\r\n\tvar dx = pt.e_x - pt.x;\r\n\tif(!dx && !dy){\r\n\t\treturn null;\r\n\t}\r\n\r\n\r\n\tvar dots = path_builder.get_points(link, view, source, target);\r\n\tconst lines = drawer.get_lines(dots, view);\r\n\r\n\tconst shapes = transform_lines_to_shapes(lines.filter(l => l.size > 0), config);\r\n  \r\n\tconst div = render_shapes(shapes, view, link, config);\r\n\r\n\r\n\tvar css = \"gantt_task_link\";\r\n\r\n\tif (link.color) {\r\n\t\tcss += \" gantt_link_inline_color\";\r\n\t}\r\n\tvar cssTemplate = gantt.templates.link_class ? gantt.templates.link_class(link) : \"\";\r\n\tif (cssTemplate) {\r\n\t\tcss += \" \" + cssTemplate;\r\n\t}\r\n\r\n\tif (config.highlight_critical_path && gantt.isCriticalLink) {\r\n\t\tif (gantt.isCriticalLink(link))\r\n\t\t\tcss += \" gantt_critical_link\";\r\n\t}\r\n\r\n\tdiv.className = css;\r\n\r\n\tif(view.$config.link_attribute){\r\n\t\tdiv.setAttribute(view.$config.link_attribute, link.id);\r\n\t\tdiv.setAttribute(\"link_id\", link.id);\r\n\t}\r\n\tif (link.color) {\r\n\t\tdiv.style.setProperty(\"--dhx-gantt-link-background\", link.color);\r\n\t}\r\n\r\n\tgantt._waiAria.linkAttr(link, div);\r\n\r\n\treturn div;\r\n}\r\n\r\n\tfunction render_shapes(shapes, view, link, config) {\r\n\t\tconst container = document.createElement(\"div\");\r\n\r\n\t\tshapes.forEach(shape => {\r\n\t\t\tlet element;\r\n\t\t\tif (shape.type === 'line') {\r\n\t\t\t\telement = drawer.render_line(shape.data, null, view, link.source);\r\n\t\t\t} else if (shape.type === 'corner') {\r\n\t\t\t\telement = drawer.render_corner(shape.data, view);\r\n\t\t\t}else if (shape.type === 'arrow') {\r\n\t\t\t\telement = drawer.render_arrow(shape.data, config);\r\n\t\t\t}\r\n\r\n\t\t\tcontainer.appendChild(element);\r\n\t\t});\r\n\r\n\t\treturn container;\r\n\t}\r\n\r\n\tfunction transform_lines_to_shapes(lines, config) {\r\n\t\tconst radius = config.link_radius || 4;\r\n\t\tconst arrowSize = config.link_arrow_size || 6; // Arrow size from config\r\n\t\tconst shapes = [];\r\n\t\r\n\t\tfor (let i = 0; i < lines.length; i++) {\r\n\t\t\tconst line = lines[i];\r\n\t\t\tconst nextLine = lines[i + 1];\r\n\t\r\n\t\t\tif (!nextLine || config.link_radius <= 1) {\r\n\t\t\t\tshapes.push({ type: 'line', data: line });\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\r\n\t\t\tif (line.direction !== nextLine.direction) {\r\n\t\t\t\tif(line.size < radius || nextLine.size < radius){\r\n\t\t\t\t\tshapes.push({ type: 'line', data: line });\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tline.size -= radius;\r\n\t\t\t\tshapes.push({ type: 'line', data: line });\r\n\t\r\n\t\t\t\tlet cornerX = line.x;\r\n\t\t\t\tlet cornerY = line.y - config.link_line_width / 2;\r\n\t\r\n\t\t\t\tswitch (line.direction) {\r\n\t\t\t\t\tcase 'right':\r\n\t\t\t\t\t\tcornerX += line.size;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'left':\r\n\t\t\t\t\t\tcornerX -= line.size;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'down':\r\n\t\t\t\t\t\tcornerY += line.size;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'up':\r\n\t\t\t\t\t\tcornerY -= line.size;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tconst corner = {\r\n\t\t\t\t\tx: cornerX,\r\n\t\t\t\t\ty: cornerY,\r\n\t\t\t\t\tdirection: { from: line.direction, to: nextLine.direction },\r\n\t\t\t\t\tradius\r\n\t\t\t\t};\r\n\t\t\t\tshapes.push({ type: 'corner', data: corner });\r\n\t\r\n\t\t\t\tswitch (nextLine.direction) {\r\n\t\t\t\t\tcase 'right':\r\n\t\t\t\t\t\tnextLine.x += radius;\r\n\t\t\t\t\t\tnextLine.size -= radius;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'left':\r\n\t\t\t\t\t\tnextLine.x -= radius;\r\n\t\t\t\t\t\tnextLine.size -= radius;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'down':\r\n\t\t\t\t\t\tnextLine.y += radius;\r\n\t\t\t\t\t\tnextLine.size -= radius;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'up':\r\n\t\t\t\t\t\tnextLine.y -= radius;\r\n\t\t\t\t\t\tnextLine.size -= radius;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tshapes.push({ type: 'line', data: line });\r\n\t\t\t}\r\n\t\t}\r\n\t\r\n\t\tconst lastLine = lines[lines.length - 1];\r\n\t\r\n\t\tif (lastLine.direction === 'right' || lastLine.direction === 'left') {\r\n\t\t\tlastLine.size -= arrowSize*3/4; \r\n\t\r\n\t\t\tlet arrowX = lastLine.direction === 'right' ? (lastLine.x + lastLine.size) : lastLine.x - lastLine.size - arrowSize/2;\r\n\t\t\tlet arrowY = lastLine.y - (config.link_line_width / 2) - (arrowSize / 2) + 1;\r\n\t\r\n\t\t\tif(lastLine.direction === 'left'){\r\n\t\t\t\tarrowY -= 1;// left pointing arrows for some reason need adjustments\r\n\t\t\t\tarrowX -= 2;\r\n\t\t\t}else{\r\n\t\t\t\tarrowX -= 1;\r\n\t\t\t}\r\n\t\t\tconst arrow = {\r\n\t\t\t\tx: arrowX,\r\n\t\t\t\ty: arrowY,\r\n\t\t\t\tsize: arrowSize,\r\n\t\t\t\tdirection: lastLine.direction\r\n\t\t\t};\r\n\t\r\n\t\t\tshapes.push({ type: 'line', data: lastLine });\r\n\t\t\tshapes.push({ type: 'arrow', data: arrow });\r\n\t\t} else {\r\n\t\t\tshapes.push({ type: 'line', data: lastLine });\r\n\t\t}\r\n\t\r\n\t\treturn shapes;\r\n\t}\r\n\t\r\n\r\n\r\nvar drawer = {\r\n\tcurrent_pos: null,\r\n\tdirs: {\"left\": 'left', \"right\": 'right', \"up\": 'up', \"down\": 'down'},\r\n\tpath: [],\r\n\tclear: function () {\r\n\t\tthis.current_pos = null;\r\n\t\tthis.path = [];\r\n\t},\r\n\tpoint: function (pos) {\r\n\t\tthis.current_pos = gantt.copy(pos);\r\n\t},\r\n\tget_lines: function (dots) {\r\n\t\tthis.clear();\r\n\t\tthis.point(dots[0]);\r\n\t\tfor (var i = 1; i < dots.length; i++) {\r\n\t\t\tthis.line_to(dots[i]);\r\n\t\t}\r\n\t\treturn this.get_path();\r\n\t},\r\n\tline_to: function (pos) {\r\n\t\tvar next = gantt.copy(pos);\r\n\t\tvar prev = this.current_pos;\r\n\r\n\t\tvar line = this._get_line(prev, next);\r\n\t\tthis.path.push(line);\r\n\t\tthis.current_pos = next;\r\n\t},\r\n\tget_path: function () {\r\n\t\treturn this.path;\r\n\t},\r\n\tget_wrapper_sizes: function (v, view, itemId) {\r\n\t\tvar config = view.$getConfig();\r\n\t\tvar res,\r\n\t\t\twrapper_size = config.link_wrapper_width,\r\n\t\t\ty = v.y - (wrapper_size) / 2;\r\n\t\tswitch (v.direction) {\r\n\t\t\tcase this.dirs.left:\r\n\t\t\t\tres = {\r\n\t\t\t\t\ttop: y,\r\n\t\t\t\t\theight: wrapper_size,\r\n\t\t\t\t\tlineHeight: wrapper_size,\r\n\t\t\t\t\tleft: v.x - v.size - wrapper_size / 2,\r\n\t\t\t\t\twidth: v.size + wrapper_size\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tcase this.dirs.right:\r\n\t\t\t\tres = {\r\n\t\t\t\t\ttop: y,\r\n\t\t\t\t\tlineHeight: wrapper_size,\r\n\t\t\t\t\theight: wrapper_size,\r\n\t\t\t\t\tleft: v.x - wrapper_size / 2,\r\n\t\t\t\t\twidth: v.size + wrapper_size\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tcase this.dirs.up:\r\n\t\t\t\tres = {\r\n\t\t\t\t\ttop: y - v.size,\r\n\t\t\t\t\tlineHeight: v.size + wrapper_size,\r\n\t\t\t\t\theight: v.size + wrapper_size,\r\n\t\t\t\t\tleft: v.x - wrapper_size / 2,\r\n\t\t\t\t\twidth: wrapper_size\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tcase this.dirs.down:\r\n\t\t\t\tres = {\r\n\t\t\t\t\ttop: y /*- wrapper_size/2*/,\r\n\t\t\t\t\tlineHeight: v.size + wrapper_size,\r\n\t\t\t\t\theight: v.size + wrapper_size,\r\n\t\t\t\t\tleft: v.x - wrapper_size / 2,\r\n\t\t\t\t\twidth: wrapper_size\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn res;\r\n\t},\r\n\tget_line_sizes: function (v, view) {\r\n\t\tvar config = view.$getConfig();\r\n\t\tvar res,\r\n\t\t\tline_size = config.link_line_width,\r\n\t\t\twrapper_size = config.link_wrapper_width,\r\n\t\t\tsize = v.size + line_size;\r\n\t\tswitch (v.direction) {\r\n\t\t\tcase this.dirs.left:\r\n\t\t\tcase this.dirs.right:\r\n\t\t\t\tres = {\r\n\t\t\t\t\theight: line_size,\r\n\t\t\t\t\twidth: size,\r\n\t\t\t\t\tmarginTop: (wrapper_size - line_size) / 2,\r\n\t\t\t\t\tmarginLeft: (wrapper_size - line_size) / 2\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tcase this.dirs.up:\r\n\t\t\tcase this.dirs.down:\r\n\t\t\t\tres = {\r\n\t\t\t\t\theight: size,\r\n\t\t\t\t\twidth: line_size,\r\n\t\t\t\t\tmarginTop: (wrapper_size - line_size) / 2,\r\n\t\t\t\t\tmarginLeft: (wrapper_size - line_size) / 2\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\r\n\t\treturn res;\r\n\t},\r\n\trender_line: function (v, end, view, itemId) {\r\n\t\tvar pos = this.get_wrapper_sizes(v, view, itemId);\r\n\t\tvar wrapper = document.createElement(\"div\");\r\n\t\twrapper.style.cssText = [\r\n\t\t\t\"top:\" + pos.top + \"px\",\r\n\t\t\t\"left:\" + pos.left + \"px\",\r\n\t\t\t\"height:\" + pos.height + \"px\",\r\n\t\t\t\"width:\" + pos.width + \"px\"\r\n\t\t].join(';');\r\n\t\twrapper.className = \"gantt_line_wrapper\";\r\n\r\n\t\tvar innerPos = this.get_line_sizes(v, view);\r\n\t\tvar inner = document.createElement(\"div\");\r\n\t\tinner.style.cssText = [\r\n\t\t\t\"height:\" + innerPos.height + \"px\",\r\n\t\t\t\"width:\" + innerPos.width + \"px\",\r\n\t\t\t\"margin-top:\" + innerPos.marginTop + \"px\",\r\n\t\t\t\"margin-left:\" + innerPos.marginLeft + \"px\"\r\n\t\t].join(\";\");\r\n\r\n\t\tinner.className = \"gantt_link_line_\" + v.direction;\r\n\t\twrapper.appendChild(inner);\r\n\r\n\t\treturn wrapper;\r\n\t},\r\n\r\n\trender_corner: function (corner, view) {\r\n\t\tconst radius = corner.radius;\r\n\t\tconst config = view.$getConfig();\r\n\t\tconst lineWidth = config.link_line_width || 2;\r\n\t\tconst cornerDiv = document.createElement(\"div\");\r\n\t\r\n\t\tcornerDiv.classList.add(\"gantt_link_corner\");\r\n\t\tcornerDiv.classList.add(`gantt_link_corner_${corner.direction.from}_${corner.direction.to}`);\r\n\t\r\n\t\tcornerDiv.style.width = `${radius}px`;\r\n\t\tcornerDiv.style.height = `${radius}px`;\r\n\t\r\n\t\tlet borderVertical;\r\n\t\tlet borderHorizontal;\r\n\r\n\t\tif (corner.direction.from === 'right' && corner.direction.to === 'down') {\r\n\t\t\tborderVertical = \"Right\";\r\n\t\t\tborderHorizontal = \"Top\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y}px`;\r\n\t\t} else if (corner.direction.from === 'down' && corner.direction.to === 'right') {\r\n\t\t\tborderVertical = \"Left\";\r\n\t\t\tborderHorizontal = \"Bottom\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y}px`;\r\n\t\t} else if (corner.direction.from === 'right' && corner.direction.to === 'up') {\r\n\t\t\tborderVertical = \"Right\";\r\n\t\t\tborderHorizontal = \"Bottom\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y - radius}px`;\r\n\t\t} else if (corner.direction.from === 'up' && corner.direction.to === 'right') {\r\n\t\t\tborderVertical = \"Left\";\r\n\t\t\tborderHorizontal = \"Top\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y - radius}px`;\r\n\t\t} else if (corner.direction.from === 'left' && corner.direction.to === 'down') {\r\n\t\t\tborderVertical = \"Left\";\r\n\t\t\tborderHorizontal = \"Top\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - radius - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y}px`;\r\n\t\t} else if (corner.direction.from === 'down' && corner.direction.to === 'left') {\r\n\t\t\tborderVertical = \"Right\";\r\n\t\t\tborderHorizontal = \"Bottom\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - radius - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y}px`;\r\n\t\t} else if (corner.direction.from === 'left' && corner.direction.to === 'up') {\r\n\t\t\tborderVertical = \"Left\";\r\n\t\t\tborderHorizontal = \"Bottom\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - radius - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y - radius}px`;\r\n\t\t} else if (corner.direction.from === 'up' && corner.direction.to === 'left') {\r\n\t\t\tborderVertical = \"Right\";\r\n\t\t\tborderHorizontal = \"Top\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - radius - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y - radius}px`;\r\n\t\t}\r\n\r\n\t\tcornerDiv.style[`border${borderHorizontal}Width`] = `${lineWidth}px`;\r\n\t\tcornerDiv.style[`border${borderVertical}Width`] = `${lineWidth}px`;\r\n\t\tcornerDiv.style[`border${borderVertical}Style`] = `solid`;\r\n\t\tcornerDiv.style[`border${borderHorizontal}Style`] = `solid`;\r\n\t\tcornerDiv.style[`border${borderHorizontal}${borderVertical}Radius`] = `${radius}px`;\r\n\r\n\t\r\n\t\treturn cornerDiv;\r\n\t},\r\n\r\n\trender_arrow(arrow, config) {\r\n\t\tvar div = document.createElement(\"div\");\r\n\t\tvar top = arrow.y;\r\n\t\tvar left = arrow.x;\r\n\t\r\n\t\tvar size = config.link_arrow_size;\r\n\t\tdiv.style.setProperty(\"--dhx-gantt-icon-size\", `${size}px`);\r\n\t\r\n\t\tvar className = \"gantt_link_arrow gantt_link_arrow_\" + arrow.direction;\r\n\r\n\t\tdiv.style.top = top + \"px\";\r\n\t\tdiv.style.left = left + 'px';\r\n\t\tdiv.className = className;\r\n\t\r\n\t\treturn div;\r\n\t},\r\n\t\r\n\t_get_line: function (from, to) {\r\n\t\tvar direction = this.get_direction(from, to);\r\n\t\tvar vect = {\r\n\t\t\tx: from.x,\r\n\t\t\ty: from.y,\r\n\t\t\tdirection: this.get_direction(from, to)\r\n\t\t};\r\n\t\tif (direction == this.dirs.left || direction == this.dirs.right) {\r\n\t\t\tvect.size = Math.abs(from.x - to.x);\r\n\t\t} else {\r\n\t\t\tvect.size = Math.abs(from.y - to.y);\r\n\t\t}\r\n\t\treturn vect;\r\n\t},\r\n\tget_direction: function (from, to) {\r\n\t\tvar direction = 0;\r\n\t\tif (to.x < from.x) {\r\n\t\t\tdirection = this.dirs.left;\r\n\t\t} else if (to.x > from.x) {\r\n\t\t\tdirection = this.dirs.right;\r\n\t\t} else if (to.y > from.y) {\r\n\t\t\tdirection = this.dirs.down;\r\n\t\t} else {\r\n\t\t\tdirection = this.dirs.up;\r\n\t\t}\r\n\t\treturn direction;\r\n\t}\r\n\r\n};\r\n\r\nvar path_builder = {\r\n\r\n\tpath: [],\r\n\tclear: function () {\r\n\t\tthis.path = [];\r\n\t},\r\n\tcurrent: function () {\r\n\t\treturn this.path[this.path.length - 1];\r\n\t},\r\n\tpoint: function (next) {\r\n\t\tif (!next)\r\n\t\t\treturn this.current();\r\n\r\n\t\tthis.path.push(gantt.copy(next));\r\n\t\treturn next;\r\n\t},\r\n\tpoint_to: function (direction, diff, point) {\r\n\t\tif (!point)\r\n\t\t\tpoint = gantt.copy(this.point());\r\n\t\telse\r\n\t\t\tpoint = {x: point.x, y: point.y};\r\n\t\tvar dir = drawer.dirs;\r\n\t\tswitch (direction) {\r\n\t\t\tcase (dir.left):\r\n\t\t\t\tpoint.x -= diff;\r\n\t\t\t\tbreak;\r\n\t\t\tcase (dir.right):\r\n\t\t\t\tpoint.x += diff;\r\n\t\t\t\tbreak;\r\n\t\t\tcase (dir.up):\r\n\t\t\t\tpoint.y -= diff;\r\n\t\t\t\tbreak;\r\n\t\t\tcase (dir.down):\r\n\t\t\t\tpoint.y += diff;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn this.point(point);\r\n\t},\r\n\tget_points: function (link, view, source, target) {\r\n\t\tvar pt = this.get_endpoint(link, view, source, target);\r\n\t\tvar xy = gantt.config;\r\n\r\n\t\tvar dy = pt.e_y - pt.y;\r\n\t\tvar dx = pt.e_x - pt.x;\r\n\r\n\t\tvar dir = drawer.dirs;\r\n\r\n\t\tvar rowHeight = view.getItemHeight(link.source);\r\n\r\n\t\tthis.clear();\r\n\t\tthis.point({x: pt.x, y: pt.y});\r\n\r\n\t\tvar shiftX = 2 * xy.link_arrow_size;//just random size for first line\r\n\t\tvar lineType = this.get_line_type(link, view.$getConfig());\r\n\r\n\t\tvar forward = (pt.e_x > pt.x);\r\n\t\tif (lineType.from_start && lineType.to_start) {\r\n\t\t\tthis.point_to(dir.left, shiftX);\r\n\t\t\tif (forward) {\r\n\t\t\t\tthis.point_to(dir.down, dy);\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t} else {\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t\tthis.point_to(dir.down, dy);\r\n\t\t\t}\r\n\t\t\tthis.point_to(dir.right, shiftX);\r\n\r\n\t\t} else if (!lineType.from_start && lineType.to_start) {\r\n\t\t\t// GS-2619. No need to add loops for the split tasks (zero dy means the tasks are on the same line)\r\n\t\t\tif (dy !== 0){\r\n\t\t\t\tforward = (pt.e_x > (pt.x + 2 * shiftX));\r\n\t\t\t}\r\n\t\t\tthis.point_to(dir.right, shiftX);\r\n\t\t\tif (forward) {\r\n\t\t\t\tdx -= shiftX;\r\n\t\t\t\tthis.point_to(dir.down, dy);\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t} else {\r\n\t\t\t\tdx -= 2 * shiftX;\r\n\t\t\t\tvar sign = dy > 0 ? 1 : -1;\r\n\r\n\t\t\t\tthis.point_to(dir.down, sign * (rowHeight / 2));\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t\tthis.point_to(dir.down, sign * ( Math.abs(dy) - (rowHeight / 2)));\r\n\t\t\t\tthis.point_to(dir.right, shiftX);\r\n\t\t\t}\r\n\r\n\t\t} else if (!lineType.from_start && !lineType.to_start) {\r\n\t\t\tthis.point_to(dir.right, shiftX);\r\n\t\t\tif (forward) {\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t\tthis.point_to(dir.down, dy);\r\n\t\t\t} else {\r\n\t\t\t\tthis.point_to(dir.down, dy);\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t}\r\n\t\t\tthis.point_to(dir.left, shiftX);\r\n\t\t} else if (lineType.from_start && !lineType.to_start) {\r\n\t\t\t// GS-2619. No need to add loops for the split tasks (zero dy means the tasks are on the same line)\r\n\t\t\tif (dy !== 0){\r\n\t\t\t\tforward = (pt.e_x > (pt.x - 2 * shiftX));\r\n\t\t\t}\r\n\t\t\tthis.point_to(dir.left, shiftX);\r\n\r\n\t\t\tif (!forward) {\r\n\t\t\t\tdx += shiftX;\r\n\t\t\t\tthis.point_to(dir.down, dy);\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t} else {\r\n\t\t\t\tdx += 2 * shiftX;\r\n\t\t\t\tvar sign = dy > 0 ? 1 : -1;\r\n\t\t\t\tthis.point_to(dir.down, sign * (rowHeight / 2));\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t\tthis.point_to(dir.down, sign * ( Math.abs(dy) - (rowHeight / 2)));\r\n\t\t\t\tthis.point_to(dir.left, shiftX);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn this.path;\r\n\t},\r\n\tget_line_type: function(link, config){\r\n\t\tvar types = config.links;\r\n\t\tvar from_start = false, to_start = false;\r\n\t\tif (link.type == types.start_to_start) {\r\n\t\t\tfrom_start = to_start = true;\r\n\t\t} else if (link.type == types.finish_to_finish) {\r\n\t\t\tfrom_start = to_start = false;\r\n\t\t} else if (link.type == types.finish_to_start) {\r\n\t\t\tfrom_start = false;\r\n\t\t\tto_start = true;\r\n\t\t} else if (link.type == types.start_to_finish) {\r\n\t\t\tfrom_start = true;\r\n\t\t\tto_start = false;\r\n\t\t} else {\r\n\t\t\tgantt.assert(false, \"Invalid link type\");\r\n\t\t}\r\n\r\n\t\tif(config.rtl){\r\n\t\t\tfrom_start = !from_start;\r\n\t\t\tto_start = !to_start;\r\n\t\t}\r\n\r\n\t\treturn {from_start: from_start, to_start: to_start};\r\n\t},\r\n\r\n\tget_endpoint: function (link, view, source, target) {\r\n\t\tvar config = view.$getConfig();\r\n\r\n\t\tvar lineType = this.get_line_type(link, config);\r\n\t\tvar from_start = lineType.from_start,\r\n\t\t\tto_start = lineType.to_start;\r\n\r\n\t\tvar from = getMilestonePosition(source, view, config),\r\n\t\t\tto = getMilestonePosition(target, view, config);\r\n\r\n\t\treturn {\r\n\t\t\tx: from_start ? from.left : (from.left + from.width),\r\n\t\t\te_x: to_start ? to.left : (to.left + to.width),\r\n\t\t\ty: from.top + (from.rowHeight/2) - 1,\r\n\t\t\te_y: to.top + (to.rowHeight/2) - 1\r\n\t\t};\r\n\t}\r\n};\r\n\r\nfunction getMilestonePosition(task, view, config){\r\n\tvar pos = view.getItemPosition(task);\r\n\r\n\t// GS-2270: Link to the split children shouldn't exceed the parent row height\r\n\tlet splitParams = getMaxParentHeight(gantt, view, task);\r\n\tlet maxHeight = splitParams.maxHeight;\r\n\r\n\tlet splitChild = splitParams.splitChild;\r\n\tconst baselinesOnDifferentRow = gantt.config.baselines && (gantt.config.baselines.render_mode == \"separateRow\" || gantt.config.baselines.render_mode == \"individualRow\");\r\n\tconst baselines = baselinesOnDifferentRow && task.baselines && task.baselines.length;\r\n\r\n\tif (splitParams.shrinkHeight){\r\n\t\tpos.rowHeight = maxHeight;\r\n\t}\r\n\r\n\tlet milestoneWidth;\r\n\tlet milestoneTask = gantt.getTaskType(task.type) == config.types.milestone;\r\n\tif(milestoneTask){\r\n\t\tlet milestoneHeight = view.getBarHeight(task.id, true);\r\n\t\tmilestoneWidth = Math.sqrt(2*milestoneHeight*milestoneHeight);\r\n\t\tif (splitParams.shrinkHeight && maxHeight < milestoneHeight){\r\n\t\t\tmilestoneHeight = maxHeight;\r\n\t\t\tmilestoneWidth = maxHeight;\r\n\t\t}\r\n\t\tpos.left -= milestoneWidth / 2;\r\n\t\tpos.width = milestoneWidth;\r\n\t} \r\n\tif (splitChild){\r\n\t\tif (maxHeight >= pos.height) {\r\n\t\t\tconst siblingBaselines = childrenHaveBaselines(gantt, task.parent);\r\n\t\t\tif (baselines || siblingBaselines){\r\n\t\t\t\tif (milestoneTask){\r\n\t\t\t\t\tpos.rowHeight = pos.height + 4;\r\n\t\t\t\t\tpos.left += (pos.width - pos.rowHeight + 4) / 2;\r\n\t\t\t\t\tpos.width = pos.rowHeight - 3;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tpos.rowHeight = pos.height + 6;\r\n\t\t\t\t}\r\n\t\t\t} else if (milestoneTask) {\r\n\t\t\t\tpos.left += (milestoneWidth - pos.height) / 2;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tpos.rowHeight = maxHeight + 2;\r\n\t\t\tif (milestoneTask){\r\n\t\t\t\tpos.left += (pos.width - pos.rowHeight + 4) / 2;\r\n\t\t\t\tpos.width = pos.rowHeight - 3;\r\n\t\t\t}\r\n\t\t}\r\n\t} else if (baselines){\r\n\t\tpos.rowHeight = pos.height + 4;\r\n\t}\r\n\r\n\treturn pos;\r\n}\r\n\r\n\r\nreturn {\r\n\trender: _render_link_element,\r\n\tupdate: null,\r\n\t//getRectangle: getLinkRectangle\r\n\tisInViewPort: isInViewPort,\r\n\tgetVisibleRange: getVisibleRange()\r\n};\r\n}\r\n\r\nexport default createLinkRender;","export default function(item, viewport, view, config, gantt){\r\n    // GS-2481 and GS-1715, don't remove selected task when using keyboard shortcuts and when the inline editor is opened\r\n    if(gantt.$ui.getView(\"grid\") && ((gantt.config.keyboard_navigation && gantt.getSelectedId()) || (gantt.ext.inlineEditors && gantt.ext.inlineEditors.getState().id))) {\r\n\t\t//GS-2661: selected task might be collapsed\r\n\t\tif(!item.$expanded_branch) return false;\r\n\t\treturn true;\r\n\t}\r\n    var top = view.getItemTop(item.id);\r\n\tvar height = view.getItemHeight(item.id);\r\n\r\n\tif(top > viewport.y_end || top + height < viewport.y){\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn true;\r\n};","import * as helpers from \"../../../utils/helpers\";\r\nimport getRowRectangle from \"./viewport/get_grid_row_rectangle\";\r\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\r\nimport isInViewPort from \"./viewport/is_grid_row_in_viewport\";\r\n\r\nfunction createGridLineRender(gantt){\r\n\r\n\tfunction _render_grid_item(item, view, config, viewport) {\r\n\t\tvar columns = view.getGridColumns();\r\n\t\tvar templates = view.$getTemplates();\r\n\r\n\t\tvar store = view.$config.rowStore;\r\n\r\n\t\tvar cells = [];\r\n\t\tvar has_child;\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tvar last = i == columns.length - 1;\r\n\t\t\tvar col = columns[i];\r\n\t\t\tvar cell;\r\n\r\n\t\t\tvar value;\r\n\t\t\tvar textValue;\r\n\t\t\tif (col.name == \"add\") {\r\n\t\t\t\tvar aria = gantt._waiAria.gridAddButtonAttrString(col);\r\n\r\n\t\t\t\tvalue = \"<div \" + aria + \" class='gantt_add'></div>\";\r\n\t\t\t\ttextValue = \"\";\r\n\t\t\t} else {\r\n\t\t\t\tif (col.template)\r\n\t\t\t\t\tvalue = col.template(item);\r\n\t\t\t\telse\r\n\t\t\t\t\tvalue = item[col.name];\r\n\r\n\t\t\t\tif (helpers.isDate(value)){\r\n\t\t\t\t\tvalue = templates.date_grid(value, item, col.name);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (value === null || value === undefined) {\r\n\t\t\t\t\tvalue = \"\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttextValue = value;\r\n\t\t\t\tvalue = \"<div class='gantt_tree_content'>\" + value + \"</div>\";\r\n\t\t\t}\r\n\t\t\tvar css = \"gantt_cell\" + (last ? \" gantt_last_cell\" : \"\");\r\n\r\n\t\t\tvar tree = [];\r\n\t\t\tif (col.tree) {\r\n\t\t\t\tcss += \" gantt_cell_tree\";\r\n\t\t\t\tfor (var j = 0; j < item.$level; j++)\r\n\t\t\t\t\ttree.push(templates.grid_indent(item));\r\n\r\n\t\t\t\thas_child = store.hasChild(item.id) && !(gantt.isSplitTask(item) && !gantt.config.open_split_tasks);\r\n\t\t\t\tif (has_child) {\r\n\t\t\t\t\ttree.push(templates.grid_open(item));\r\n\t\t\t\t\ttree.push(templates.grid_folder(item));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttree.push(templates.grid_blank(item));\r\n\t\t\t\t\ttree.push(templates.grid_file(item));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar style = \"width:\" + (col.width - (last ? 1 : 0)) + \"px;\";\r\n\t\t\tif (this.defined(col.align)){\r\n\t\t\t\tvar flexAlign = {\r\n\t\t\t\t\tright: \"flex-end\",\r\n\t\t\t\t\tleft: \"flex-start\",\r\n\t\t\t\t\tcenter: \"center\"\r\n\t\t\t\t};\r\n\t\t\t\tvar justifyContent = flexAlign[col.align];\r\n\r\n\t\t\t\tstyle += \"text-align:\" + col.align + \";justify-content:\"  + justifyContent + \";\";\r\n\t\t\t}\r\n\r\n\t\t\tvar aria = gantt._waiAria.gridCellAttrString(col, textValue, item);\r\n\r\n\t\t\ttree.push(value);\r\n\t\t\tcell = \"<div class='\" + css + \"' data-column-index='\"+i+\"' data-column-name='\"+col.name+\"' style='\" + style + \"' \" + aria + \">\" + tree.join(\"\") + \"</div>\";\r\n\t\t\tcells.push(cell);\r\n\t\t}\r\n\t\t// GS-291. The odd class should be assigned correctly\r\n\t\tcss = \"\";\r\n\t\tconst storeName = store.$config.name;\r\n\t\tswitch (storeName) {\r\n\t\t\tcase \"task\":\r\n\t\t\t\tcss = gantt.getGlobalTaskIndex(item.id) % 2 === 0 ? \"\" : \" odd\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"resource\":\r\n\t\t\t\tcss = store.visibleOrder.indexOf(item.id) % 2 === 0 ? \"\" : \" odd\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tcss += (item.$transparent) ? \" gantt_transparent\" : \"\";\r\n\r\n\t\tcss += (item.$dataprocessor_class ? \" \" + item.$dataprocessor_class : \"\");\r\n\r\n\t\tif (templates.grid_row_class) {\r\n\t\t\tvar css_template = templates.grid_row_class.call(gantt, item.start_date, item.end_date, item);\r\n\t\t\tif (css_template)\r\n\t\t\t\tcss += \" \" + css_template;\r\n\t\t}\r\n\r\n\t\tif(store.isSelected(item.id)) {\r\n\t\t\tcss += \" gantt_selected\";\r\n\t\t}\r\n\r\n\t\tvar el = document.createElement(\"div\");\r\n\t\tel.className = \"gantt_row\" + css + \" gantt_row_\" + gantt.getTaskType(item.type);\r\n\t\tvar height = view.getItemHeight(item.id);\r\n\t\tel.style.height = height + \"px\";\r\n\t\tel.style.lineHeight = height + \"px\";\r\n\r\n\t\tif(config.smart_rendering){\r\n\t\t\tel.style.position = \"absolute\";\r\n\t\t\tel.style.left = \"0px\";\r\n\t\t\tel.style.top = view.getItemTop(item.id) + \"px\";\r\n\t\t}\r\n\r\n\t\tif(view.$config.item_attribute){\r\n\t\t\tel.setAttribute(view.$config.item_attribute, item.id);\r\n\t\t\tel.setAttribute(view.$config.bind + \"_id\", item.id); // 'task_id'/'resource_id' for backward compatibility\r\n\t\t}\r\n\r\n\t\tgantt._waiAria.taskRowAttr(item, el);\r\n\r\n\t\tel.innerHTML = cells.join(\"\");\r\n\t\treturn el;\r\n\t}\r\n\r\n\tfunction onrender(item, rowNode, view){\r\n\t\tvar columns = view.getGridColumns();\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tvar column = columns[i];\r\n\t\t\tif (column.onrender){\r\n\r\n\t\t\t\t// find cell node for current column\r\n\t\t\t\tvar cellNode = rowNode.querySelector(`[data-column-name=\"${column.name}\"]`);\r\n\t\t\t\tif (cellNode) {\r\n\t\t\t\t\tvar content = column.onrender(item, cellNode);\r\n\t\t\t\t\tif (content && typeof content === \"string\") {\r\n\t\t\t\t\t\tcellNode.innerHTML = content;\r\n\t\t\t\t\t} else if (content && typeof content === \"object\") {\r\n\t\t\t\t\t\t// render object to node using additional functionality\r\n\t\t\t\t\t\tif (gantt.config.external_render){\r\n\t\t\t\t\t\t\tvar adapter = gantt.config.external_render;\r\n\t\t\t\t\t\t\tif (adapter.isElement(content)){\r\n\t\t\t\t\t\t\t\tadapter.renderElement(content, cellNode);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\trender: _render_grid_item,\r\n\t\tupdate: null,\r\n\t\tgetRectangle: getRowRectangle,\r\n\t\tisInViewPort: isInViewPort,\r\n\t\tgetVisibleRange: getVisibleRange,\r\n\t\tonrender: onrender\r\n\t};\r\n}\r\n\r\nexport default createGridLineRender;","import * as helpers from \"../utils/helpers\";\r\n\r\nexport default function createResourceTimelineBuilder(gantt){\r\n\r\n\tlet resourceTaskCache = {};\r\n\r\n\tgantt.$data.tasksStore.attachEvent(\"onStoreUpdated\", function(){\r\n\t\tresourceTaskCache = {};\r\n\t});\r\n\r\n\tfunction getResourceLoad(resource, resourceProperty, scale, timeline){\r\n\t\tconst cacheKey = resource.id + \"_\" + resourceProperty  + \"_\" + scale.unit + \"_\" + scale.step;\r\n\t\tlet res;\r\n\t\tif (!resourceTaskCache[cacheKey]) {\r\n\t\t\tres = resourceTaskCache[cacheKey] = calculateResourceLoad(resource, resourceProperty, scale, timeline);\r\n\r\n\t\t} else {\r\n\t\t\tres = resourceTaskCache[cacheKey];\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\r\n\tfunction calculateResourceLoadFromAssignments(items, scale, assignmentsPassed){\r\n\t\tconst scaleUnit = scale.unit;\r\n\t\tconst scaleStep = scale.step;\r\n\t\tconst timegrid = {};\r\n\r\n\t\tconst precalculatedTimes = {};\r\n\t\tfor (let i = 0; i < items.length; i++) {\r\n\t\t\tconst item = items[i];\r\n\t\t\tlet task = item;\r\n\t\t\tif(assignmentsPassed){\r\n\t\t\t\ttask = gantt.getTask(item.task_id);\r\n\t\t\t}\r\n\t\t\tif (task.unscheduled){\r\n\t\t\t\tcontinue; // do not process assignments for unscheduled tasks\r\n\t\t\t}\r\n\t\t\tlet minDate = (item.start_date || task.start_date);\r\n\t\t\tlet maxDate = (item.end_date || task.end_date);\r\n\t\t\tif(assignmentsPassed){\r\n\t\t\t\tif(item.start_date){\r\n\t\t\t\t\tminDate = new Date(Math.max(item.start_date.valueOf(), task.start_date.valueOf()));\r\n\t\t\t\t}\r\n\t\t\t\tif(item.end_date){\r\n\t\t\t\t\tmaxDate = new Date(Math.min(item.end_date.valueOf(), task.end_date.valueOf()));\r\n\t\t\t\t}\r\n\t\t\t\t// GS-2063: handle case with fixedDates mode\r\n\t\t\t\tif(item.mode && item.mode == \"fixedDates\"){\r\n\t\t\t\t\tminDate = item.start_date;\r\n\t\t\t\t\tmaxDate = item.end_date;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlet firstColumn = helpers.findBinary(scale.trace_x, minDate.valueOf());\r\n\t\t\tlet minScaleDate = new Date(scale.trace_x[firstColumn] || gantt.date[scaleUnit + \"_start\"](new Date(minDate)));\r\n\t\t\t// GS-2307: need to take into account that task could start before the min scale date\r\n\t\t\t// so the task would be added to timegrid\r\n\t\t\tlet currDate = new Date(Math.min(minDate.valueOf(), minScaleDate.valueOf())); \r\n\r\n\t\t\tlet calendar = gantt.config.work_time ? gantt.getTaskCalendar(task) : gantt;\r\n\t\t\tprecalculatedTimes[calendar.id] = {};\r\n\t\t\twhile (currDate < maxDate) {\r\n\t\t\t\tconst cachedTimes = precalculatedTimes[calendar.id];\r\n\r\n\t\t\t\tlet date = currDate;\r\n\t\t\t\tconst timestamp = date.valueOf();\r\n\r\n\t\t\t\tcurrDate = gantt.date.add(currDate, scaleStep, scaleUnit);\r\n\r\n\t\t\t\tif(cachedTimes[timestamp] === false){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!timegrid[timestamp]){\r\n\t\t\t\t\ttimegrid[timestamp] = {tasks: [], assignments: []};\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttimegrid[timestamp].tasks.push(task);\r\n\t\t\t\tif(assignmentsPassed){\r\n\t\t\t\t\ttimegrid[timestamp].assignments.push(item);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn timegrid;\r\n\t}\r\n\r\n\tfunction calculateResourceLoad(resource, resourceProperty, scale, timeline) {\r\n\r\n\t\tlet items;\r\n\t\tlet assignmentsPassed = false;\r\n\t\tlet timegrid = {};\r\n\r\n\t\tif(gantt.config.process_resource_assignments && resourceProperty === gantt.config.resource_property){\r\n\t\t\tif(resource.$role == \"task\"){\r\n\t\t\t\titems = gantt.getResourceAssignments(resource.$resource_id, resource.$task_id);\r\n\t\t\t}else{\r\n\t\t\t\titems = gantt.getResourceAssignments(resource.id);\r\n\t\t\t}\r\n\r\n\t\t\tassignmentsPassed = true;\r\n\t\t}else if(resource.$role == \"task\"){\r\n\t\t\titems = [];\r\n\t\t}else{\r\n\t\t\titems = gantt.getTaskBy(resourceProperty, resource.id);\r\n\t\t}\r\n\r\n\t\ttimegrid = calculateResourceLoadFromAssignments(items, scale, assignmentsPassed);\r\n\t\tconst scaleUnit = scale.unit;\r\n\t\tconst scaleStep = scale.step;\r\n\r\n\t\tconst timetable = [];\r\n\t\tlet start, end, tasks, assignments, cell;\r\n\t\tconst config = timeline.$getConfig();\r\n\r\n\t\tfor(let i = 0; i < scale.trace_x.length; i++){\r\n\t\t\tstart = new Date(scale.trace_x[i]);\r\n\t\t\tend = gantt.date.add(start, scaleStep, scaleUnit);\r\n\t\t\tcell = timegrid[start.valueOf()] || {};\r\n\t\t\ttasks = cell.tasks || [];\r\n\t\t\tassignments = cell.assignments || [];\r\n\t\t\tif(tasks.length || config.resource_render_empty_cells){\r\n\t\t\t\ttimetable.push({\r\n\t\t\t\t\tstart_date: start,\r\n\t\t\t\t\tend_date: end,\r\n\t\t\t\t\ttasks: tasks,\r\n\t\t\t\t\tassignments: assignments\r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\ttimetable.push(null);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn timetable;\r\n\t}\r\n\r\n\r\n\r\n\treturn getResourceLoad;\r\n};","import getRectangle from \"./viewport/get_bg_row_rectangle\";\r\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\r\nimport getVisibleCellsRange from \"./viewport/get_visible_cells_range\";\r\nimport isColumnVisible from \"./viewport/is_column_visible\";\r\nimport resourceTimetable from \"../../resource_timetable_builder\";\r\n\r\nfunction generateRenderResourceLine(gantt){\r\n\tvar getResourceLoad = resourceTimetable(gantt);\r\n\tvar renderedResourceLines = {};\r\n\r\n\tfunction renderResourceLineCell(resource, day, templates, config, timeline){\r\n\t\tvar css = templates.resource_cell_class(day.start_date, day.end_date, resource, day.tasks, day.assignments);\r\n\t\tvar content = templates.resource_cell_value(day.start_date, day.end_date, resource, day.tasks, day.assignments);\r\n\t\tvar height = timeline.getItemHeight(resource.id) - 1;\r\n\r\n\t\tif (css || content){\r\n\t\t\tvar sizes = timeline.getItemPosition(resource, day.start_date, day.end_date);\r\n\t\t\tvar el = document.createElement('div');\r\n\t\t\tel.setAttribute(timeline.$config.item_attribute, resource.id);\r\n\t\t\tel.className = [\"gantt_resource_marker\", css].join(\" \");\r\n\r\n\t\t\tel.style.cssText = [\r\n\t\t\t\t'left:' + sizes.left + 'px',\r\n\t\t\t\t'width:' + sizes.width + 'px',\r\n\t\t\t\t'height:' + (height) + 'px',\r\n\t\t\t\t'line-height:' + (height) + 'px',\r\n\t\t\t\t'top:' + sizes.top + 'px'\r\n\t\t\t].join(\";\");\r\n\r\n\t\t\tif(content)\r\n\t\t\t\tel.innerHTML = content;\r\n\r\n\t\t\treturn el;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tfunction detachRenderedResourceLine(id, index){\r\n\t\tif(renderedResourceLines[id] && renderedResourceLines[id][index] &&\r\n\t\t\trenderedResourceLines[id][index].parentNode\r\n\t\t\t){\r\n\t\t\t\trenderedResourceLines[id][index].parentNode.removeChild(renderedResourceLines[id][index]);\r\n\t\t\t}\r\n\t}\r\n\r\n\tfunction renderResourceLine(resource, timeline, config, viewport) {\r\n\t\tvar templates = timeline.$getTemplates();\r\n\t\tvar scale = timeline.getScale();\r\n\t\tvar timetable = getResourceLoad(resource, config.resource_property, timeline.getScale(), timeline);\r\n\t\tvar smartRendering = !!viewport;//no viewport means smart rendering is disabled\r\n\t\tvar cells = [];\r\n\t\trenderedResourceLines[resource.id] = {};\r\n\r\n\t\tvar range = getVisibleCellsRange(scale, viewport);\r\n\t\tfor (var columnIndex = range.start; columnIndex <= range.end; columnIndex++) {\r\n\r\n\t\t\tvar day = timetable[columnIndex];\r\n\t\t\tif(!day){\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif(smartRendering && !isColumnVisible(columnIndex, scale, viewport, gantt)){\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tvar cell = renderResourceLineCell(resource, day, templates, config, timeline);\r\n\t\t\tif(cell){\r\n\t\t\t\tcells.push(cell);\r\n\t\t\t\trenderedResourceLines[resource.id][columnIndex] = cell;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar row = null;\r\n\t\tif(cells.length){\r\n\t\t\trow = document.createElement(\"div\");\r\n\t\t\tfor(var i = 0; i < cells.length; i++){\r\n\t\t\t\trow.appendChild(cells[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn row;\r\n\t}\r\n\r\n\tfunction updateResourceLine(resource, node, timeline, config, viewport) {\r\n\t\tvar templates = timeline.$getTemplates();\r\n\t\tvar scale = timeline.getScale();\r\n\t\tvar timetable = getResourceLoad(resource, config.resource_property, timeline.getScale(), timeline);\r\n\r\n\t\tvar range = getVisibleCellsRange(scale, viewport);\r\n\r\n\t\tvar checkedColumns = {};\r\n\t\tif(renderedResourceLines && renderedResourceLines[resource.id]){\r\n\t\t\tfor(var i in renderedResourceLines[resource.id]){\r\n\t\t\t\tcheckedColumns[i] = i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (var columnIndex = range.start; columnIndex <= range.end; columnIndex++) {\r\n\t\t\tvar day = timetable[columnIndex];\r\n\t\t\tcheckedColumns[columnIndex] = false;\r\n\t\t\tif(!day){\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif(!isColumnVisible(columnIndex, scale, viewport, gantt)){\r\n\t\t\t\tdetachRenderedResourceLine(resource.id, columnIndex);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif(!renderedResourceLines[resource.id] || !renderedResourceLines[resource.id][columnIndex]){\r\n\t\t\t\tvar cell = renderResourceLineCell(resource, day, templates, config, timeline);\r\n\t\t\t\tif(cell){\r\n\t\t\t\t\tnode.appendChild(cell);\r\n\t\t\t\t\trenderedResourceLines[resource.id][columnIndex] = cell;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if(renderedResourceLines[resource.id] && renderedResourceLines[resource.id][columnIndex] && !renderedResourceLines[resource.id][columnIndex].parentNode){\r\n\t\t\t\tnode.appendChild(renderedResourceLines[resource.id][columnIndex]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor(var i in checkedColumns){\r\n\t\t\tif(checkedColumns[i] !== false){\r\n\t\t\t\tdetachRenderedResourceLine(resource.id, i);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\trender: renderResourceLine,\r\n\t\tupdate: updateResourceLine,\r\n\t\tgetRectangle: getRectangle,\r\n\t\tgetVisibleRange: getVisibleRange\r\n\t};\r\n}\r\n\r\nexport default generateRenderResourceLine;","import getRowRectangle from \"./viewport/get_grid_row_rectangle\";\r\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\r\n\r\nfunction createGridTaskRowResizerRender(gantt){\r\n\r\n\tfunction _render_grid_item(item, view, viewport) {\r\n\r\n\t\tvar config = view.$getConfig();\r\n\t\tvar resize_el = document.createElement(\"div\");\r\n\t\tresize_el.className = \"gantt_task_grid_row_resize_wrap\";\r\n\r\n\t\tresize_el.style.top = (view.getItemTop(item.id) + view.getItemHeight(item.id)) + \"px\";\r\n\r\n\t\tresize_el.innerHTML = \"<div class='gantt_task_grid_row_resize' role='cell'></div>\";\r\n\t\tresize_el.setAttribute(config.task_grid_row_resizer_attribute, item.id);\r\n\r\n\t\tgantt._waiAria.rowResizerAttr(resize_el);\r\n\t\treturn resize_el;\r\n\t}\r\n\r\n\treturn {\r\n\t\trender: _render_grid_item,\r\n\t\tupdate: null,\r\n\t\tgetRectangle: getRowRectangle,\r\n\t\tgetVisibleRange: getVisibleRange\r\n\t};\r\n}\r\n\r\nexport default createGridTaskRowResizerRender;","import * as domHelpers from \"../utils/dom_helpers\";\r\nimport isPlaceholderTask from \"../../../utils/placeholder_task\";\r\n\r\nfunction _init_dnd(gantt, grid) {\r\n\tvar DnD = gantt.$services.getService(\"dnd\");\r\n\r\n\tif(!grid.$config.bind || !gantt.getDatastore(grid.$config.bind)){\r\n\t\treturn;\r\n\t}\r\n\r\n\tfunction locate(e){\r\n\t\treturn domHelpers.locateAttribute(e, grid.$config.item_attribute);\r\n\t}\r\n\r\n\tfunction getStore(){\r\n\t\treturn gantt.getDatastore(grid.$config.bind);\r\n\t}\r\n\r\n\tfunction checkPlaceholderTask(id){\r\n\t\treturn isPlaceholderTask(id, gantt, getStore());\r\n\t}\r\n\r\n\tvar dnd = new DnD(grid.$grid_data, {updates_per_second: 60});\r\n\tif (gantt.defined(grid.$getConfig().dnd_sensitivity))\r\n\t\tdnd.config.sensitivity = grid.$getConfig().dnd_sensitivity;\r\n\r\n\tdnd.attachEvent(\"onBeforeDragStart\", gantt.bind(function (obj, e) {\r\n\t\tvar el = locate(e);\r\n\t\tif (!el) return false;\r\n\t\tif (gantt.hideQuickInfo) gantt.hideQuickInfo();\r\n\r\n\t\tif (domHelpers.closest(e.target, \".gantt_grid_editor_placeholder\")){\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar id = el.getAttribute(grid.$config.item_attribute);\r\n\t\tif (checkPlaceholderTask(id)) return false;\r\n\r\n\t\tvar datastore = getStore();\r\n\r\n\t\tvar task = datastore.getItem(id);\r\n\r\n\t\tif (gantt.isReadonly(task))\r\n\t\t\treturn false;\r\n\r\n\t\tdnd.config.initial_open_state = task.$open;\r\n\t\tif (!gantt.callEvent(\"onRowDragStart\", [id, e.target || e.srcElement, e])) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t}, gantt));\r\n\r\n\tdnd.attachEvent(\"onAfterDragStart\", gantt.bind(function (obj, e) {\r\n\t\tvar el = locate(e);\r\n\t\tdnd.config.marker.innerHTML = el.outerHTML;\r\n\t\tvar element = dnd.config.marker.firstChild;\r\n\t\tif(element){\r\n\t\t\telement.style.position = \"static\";\r\n\t\t}\r\n\r\n\t\tdnd.config.id = el.getAttribute(grid.$config.item_attribute);\r\n\r\n\t\tvar store = getStore();\r\n\r\n\t\tvar task = store.getItem(dnd.config.id);\r\n\t\tdnd.config.index = store.getBranchIndex(dnd.config.id);\r\n\t\tdnd.config.parent = task.parent;\r\n\t\ttask.$open = false;\r\n\t\ttask.$transparent = true;\r\n\t\tthis.refreshData();\r\n\t}, gantt));\r\n\r\n\tdnd.lastTaskOfLevel = function (level) {\r\n\t\tvar last_item = null;\r\n\t\tvar store = getStore();\r\n\t\tvar tasks = store.getItems();\r\n\t\tfor (var i = 0, len = tasks.length; i < len; i++) {\r\n\t\t\tif (tasks[i].$level == level) {\r\n\t\t\t\tlast_item = tasks[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn last_item ? last_item.id : null;\r\n\t};\r\n\tdnd._getGridPos = gantt.bind(function (e) {\r\n\t\tvar pos = domHelpers.getNodePosition(grid.$grid_data);\r\n\t\t// row offset\r\n\t\tvar x = pos.x + grid.$grid.scrollLeft;\r\n\t\tvar y = e.pos.y - 10;\r\n\r\n\t\tvar rowHeight = grid.getItemHeight(dnd.config.id);\r\n\t\t// prevent moving row out of grid_data container\r\n\t\tif (y < pos.y) y = pos.y;\r\n\t\tvar gridHeight = grid.getTotalHeight();\r\n\t\tif (y > pos.y + gridHeight - rowHeight) y = pos.y + gridHeight - rowHeight;\r\n\t\tconst maxBottom = pos.y + pos.height;\r\n\t\tif (y > maxBottom - rowHeight) {\r\n\t\t\ty = maxBottom - rowHeight;\r\n\t\t}\r\n\r\n\t\tpos.x = x;\r\n\t\tpos.y = y;\r\n\t\treturn pos;\r\n\t}, gantt);\r\n\tdnd._getTargetY = gantt.bind(function (e) {\r\n\t\tvar pos = domHelpers.getNodePosition(grid.$grid_data);\r\n\t\tvar scrollPos = grid.$state.scrollTop || 0;\r\n\t\tvar maxBottom = gantt.$grid_data.getBoundingClientRect().height + scrollPos;\r\n\r\n\t\tvar y = e.pageY - pos.y + scrollPos;\r\n\t\tif (y > maxBottom) {\r\n\t\t\ty = maxBottom;\r\n\t\t} else if (y < scrollPos) {\r\n\t\t\ty = scrollPos;\r\n\t\t}\r\n\t\treturn y;\r\n\t}, gantt);\r\n\tdnd._getTaskByY = gantt.bind(function (y, dropIndex) {\r\n\r\n\t\tvar store = getStore();\r\n\r\n\t\ty = y || 0;\r\n\r\n\t\tvar index = grid.getItemIndexByTopPosition(y);\r\n\t\tindex = dropIndex < index ? index - 1 : index;\r\n\r\n\t\tif (index > store.countVisible() - 1)\r\n\t\t\treturn null;\r\n\r\n\t\treturn store.getIdByIndex(index);\r\n\t}, gantt);\r\n\tdnd.attachEvent(\"onDragMove\", gantt.bind(function (obj, e) {\r\n\t\tvar gridDataSizes = gantt.$grid_data.getBoundingClientRect();\r\n\t\tvar maxBottom = gridDataSizes.height + gridDataSizes.y + (grid.$state.scrollTop || 0) + window.scrollY;\r\n\t\tvar dd = dnd.config;\r\n\t\tvar pos = dnd._getGridPos(e);\r\n\r\n\t\tgantt._waiAria.reorderMarkerAttr(dd.marker);\r\n\r\n\t\tvar config = grid.$getConfig(),\r\n\t\t\tstore = getStore();\r\n\r\n\t\t// setting position of row\r\n\t\tif (pos.y < maxBottom) {\r\n\t\t\tdd.marker.style.top = pos.y + \"px\";\r\n\t\t} else {\r\n\t\t\tdd.marker.style.top = maxBottom + \"px\";\r\n\t\t}\r\n\t\tdd.marker.style.left = pos.x + 10 + \"px\";\r\n\t\tconst containerSize = domHelpers.getNodePosition(gantt.$root);\r\n\t\tif (pos.width > containerSize.width){\r\n\t\t\tdd.marker.style.width = containerSize.width - 10 - 2 + \"px\";\r\n\t\t\tdd.marker.style.overflow = \"hidden\";\t\r\n\t\t}\r\n\r\n\t\t// highlight row when mouseover\r\n\t\tvar item = store.getItem(dnd.config.id);\r\n\t\tvar targetY = dnd._getTargetY(e);\r\n\t\tvar el = dnd._getTaskByY(targetY, store.getIndexById(item.id));\r\n\r\n\t\tif (!store.exists(el)) {\r\n\t\t\tel = dnd.lastTaskOfLevel(config.order_branch_free ? item.$level : 0);\r\n\t\t\tif (el == dnd.config.id) {\r\n\t\t\t\tel = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction allowedLevel(next, item) {\r\n\t\t\treturn (!(store.isChildOf(over.id, item.id)) && (next.$level == item.$level || config.order_branch_free));\r\n\t\t}\r\n\r\n\t\tif (store.exists(el)) {\r\n\t\t\tvar over = store.getItem(el);\r\n\r\n\t\t\tvar itemTop = grid.getItemTop(over.id);\r\n\t\t\tvar itemHeight = grid.getItemHeight(over.id);\r\n\t\t\tif (itemTop + itemHeight / 2 < targetY) {\r\n\t\t\t\t//hovering over bottom part of item, check can be drop to bottom\r\n\t\t\t\tvar index = store.getIndexById(over.id);\r\n\t\t\t\tvar nextId = store.getNext(over.id);//adds +1 when hovering over placeholder\r\n\t\t\t\tvar next = store.getItem(nextId);\r\n\t\t\t\tif (checkPlaceholderTask(nextId)){\r\n\t\t\t\t\tvar prevId = store.getPrev(next.id);\r\n\t\t\t\t\tnext = store.getItem(prevId);\r\n\t\t\t\t}\r\n\t\t\t\tif (next) {\r\n\t\t\t\t\tif (next.id != item.id) {\r\n\t\t\t\t\t\tover = next; //there is a valid target\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tif (config.order_branch_free) {\r\n\t\t\t\t\t\t\tif (!(store.isChildOf(item.id, over.id) && store.getChildren(over.id).length == 1))\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tstore.move(item.id, store.getBranchIndex(over.id) + 1, store.getParent(over.id));\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//we at end of the list, check and drop at the end of list\r\n\t\t\t\t\tnextId = store.getIdByIndex(index);\r\n\t\t\t\t\tnext = store.getItem(nextId);\r\n\r\n\t\t\t\t\tif (checkPlaceholderTask(nextId)){\r\n\t\t\t\t\t\tvar prevId = store.getPrev(next.id);\r\n\t\t\t\t\t\tnext = store.getItem(prevId);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (allowedLevel(next, item) && next.id != item.id) {\r\n\t\t\t\t\t\tstore.move(item.id, -1, store.getParent(next.id));\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (config.order_branch_free) {\r\n\t\t\t\tif (over.id != item.id && allowedLevel(over, item) && !checkPlaceholderTask(over.id)) {\r\n\t\t\t\t\tif (!store.hasChild(over.id)) {\r\n\t\t\t\t\t\tover.$open = true;\r\n\t\t\t\t\t\tstore.move(item.id, -1, over.id);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (store.getIndexById(over.id) || itemHeight / 3 < targetY) return;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//if item is on different level, check the one before it\r\n\t\t\tvar index = store.getIndexById(over.id),\r\n\t\t\t\tprevId = store.getIdByIndex(index - 1);\r\n\r\n\t\t\tvar prev = store.getItem(prevId);\r\n\r\n\t\t\tvar shift = 1;\r\n\t\t\twhile ((!prev || prev.id == over.id) && index - shift >= 0) {\r\n\r\n\t\t\t\tprevId = store.getIdByIndex(index - shift);\r\n\t\t\t\tprev = store.getItem(prevId);\r\n\t\t\t\tshift++;\r\n\t\t\t}\r\n\r\n\t\t\tif (item.id == over.id || checkPlaceholderTask(over.id)) return;\r\n\t\t\t//replacing item under cursor\r\n\t\t\tif (allowedLevel(over, item) && item.id != over.id) {\r\n\t\t\t\tstore.move(item.id, 0, 0, over.id);\r\n\r\n\t\t\t} else if (over.$level == item.$level - 1 && !store.getChildren(over.id).length) {\r\n\t\t\t\tstore.move(item.id, 0, over.id);\r\n\r\n\t\t\t} else if (prev && (allowedLevel(prev, item)) && (item.id != prev.id)) {\r\n\t\t\t\tstore.move(item.id, -1, store.getParent(prev.id));\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}, gantt));\r\n\r\n\tdnd.attachEvent(\"onDragEnd\", gantt.bind(function () {\r\n\t\tvar store = getStore();\r\n\t\tvar task = store.getItem(dnd.config.id);\r\n\t\ttask.$transparent = false;\r\n\t\ttask.$open = dnd.config.initial_open_state;\r\n\r\n\t\tif (this.callEvent(\"onBeforeRowDragEnd\", [dnd.config.id, dnd.config.parent, dnd.config.index]) === false) {\r\n\t\t\tstore.move(dnd.config.id, dnd.config.index, dnd.config.parent);\r\n\t\t\ttask.$drop_target = null;\r\n\t\t} else {\r\n\t\t\tthis.callEvent(\"onRowDragEnd\", [dnd.config.id, task.$drop_target]);\r\n\t\t}\r\n\t\tgantt.render();\r\n\t\tthis.refreshData();\r\n\t}, gantt));\r\n}\r\n\r\nexport default {\r\n\tinit: _init_dnd\r\n};","/**\r\n * The state object for order branch drag and drop\r\n */\r\n\r\nimport * as utils from \"../../../../utils/utils\";\r\n\r\nexport default {\r\n\tcreateDropTargetObject: function createDropTargetObject(parent) {\r\n\t\tvar res = {\r\n\t\t\ttargetParent: null,\r\n\t\t\ttargetIndex: 0,\r\n\t\t\ttargetId: null,\r\n\t\t\tchild: false,\r\n\t\t\tnextSibling: false,\r\n\t\t\tprevSibling: false\r\n\t\t};\r\n\r\n\t\tif (parent) {\r\n\t\t\tutils.mixin(res, parent, true);\r\n\t\t}\r\n\t\treturn res;\r\n\t},\r\n\tnextSiblingTarget: function nextSiblingTarget(dndTaskId, targetTaskId, store) {\r\n\t\tvar result = this.createDropTargetObject();\r\n\t\tresult.targetId = targetTaskId;\r\n\t\tresult.nextSibling = true;\r\n\t\tresult.targetParent = store.getParent(result.targetId);\r\n\t\tresult.targetIndex = store.getBranchIndex(result.targetId);\r\n\t\tif(store.getParent(dndTaskId) != result.targetParent || result.targetIndex < store.getBranchIndex(dndTaskId)){\r\n\t\t\tresult.targetIndex += 1;\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\tprevSiblingTarget: function prevSiblingTarget(dndTaskId, targetTaskId, store) {\r\n\t\tvar result = this.createDropTargetObject();\r\n\t\tresult.targetId = targetTaskId;\r\n\t\tresult.prevSibling = true;\r\n\t\tresult.targetParent = store.getParent(result.targetId);\r\n\t\tresult.targetIndex = store.getBranchIndex(result.targetId);\r\n\t\tif(store.getParent(dndTaskId) == result.targetParent && result.targetIndex > store.getBranchIndex(dndTaskId)){\r\n\t\t\tresult.targetIndex -= 1;\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\tfirstChildTarget: function firstChildTarget(dndTaskId, targetTaskId, store) {\r\n\t\tvar result = this.createDropTargetObject();\r\n\t\tresult.targetId = targetTaskId;\r\n\t\tresult.targetParent = result.targetId;\r\n\t\tresult.targetIndex = 0;\r\n\t\tresult.child = true;\r\n\t\treturn result;\r\n\t},\r\n\tlastChildTarget: function lastChildTarget(dndTaskId, targetTaskId, store) {\r\n\t\tvar children = store.getChildren(targetTaskId);\r\n\t\tvar result = this.createDropTargetObject();\r\n\t\tresult.targetId = children[children.length - 1];\r\n\t\tresult.targetParent = targetTaskId;\r\n\t\tresult.targetIndex = children.length;\r\n\t\tresult.nextSibling = true;\r\n\t\treturn result;\r\n\t}\r\n};","/**\r\n * resolve dnd position of the task when gantt.config.order_branch_free = false\r\n */\r\n\r\nimport dropTarget from \"./drop_target\";\r\n\r\nfunction getLast(store){\r\n\tvar current = store.getNext();\r\n\twhile(store.exists(current)){\r\n\r\n\t\tvar next = store.getNext(current);\r\n\t\tif(!store.exists(next)){\r\n\t\t\treturn current;\r\n\t\t}else{\r\n\t\t\tcurrent = next;\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction findClosesTarget(dndTaskId, taskId, allowedLevel, store, up){\r\n\tvar prev = taskId;\r\n\twhile(store.exists(prev)){\r\n\t\tvar targetLevel = store.calculateItemLevel(store.getItem(prev));\r\n\t\tif((targetLevel === allowedLevel || targetLevel === (allowedLevel - 1)) && store.getBranchIndex(prev) > -1){\r\n\t\t\tbreak;\r\n\t\t}else {\r\n\t\t\tprev = up ? store.getPrev(prev) : store.getNext(prev);\r\n\t\t}\r\n\t}\r\n\r\n\tif(store.exists(prev)){\r\n\t\tif(store.calculateItemLevel(store.getItem(prev)) === allowedLevel){\r\n\t\t\treturn up ? dropTarget.nextSiblingTarget(dndTaskId, prev, store) : dropTarget.prevSiblingTarget(dndTaskId, prev, store);\r\n\t\t}else{\r\n\t\t\treturn dropTarget.firstChildTarget(dndTaskId, prev, store);\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction findTargetAbove(dndTaskId, taskId, allowedLevel, store){\r\n\treturn findClosesTarget(dndTaskId, taskId, allowedLevel, store, true);\r\n}\r\nfunction findTargetBelow(dndTaskId, taskId, allowedLevel, store){\r\n\treturn findClosesTarget(dndTaskId, taskId, allowedLevel, store, false);\r\n}\r\n\r\nexport default function getSameLevelDropPosition(dndTaskId, targetTaskId, relTargetPos, eventTop, store, level){\r\n\tvar result;\r\n\tif(targetTaskId !== store.$getRootId()){\r\n\t\tvar targetTask = store.getItem(targetTaskId);\r\n\t\tvar targetLevel = store.calculateItemLevel(targetTask);\r\n\t\tif(targetLevel === level){\r\n\t\t\tvar prevSibling = store.getPrevSibling(targetTaskId);\r\n\t\t\tif(relTargetPos < 0.5 && !prevSibling){\r\n\t\t\t\tresult = dropTarget.prevSiblingTarget(dndTaskId, targetTaskId, store);\r\n\t\t\t}else{\r\n\t\t\t\tif(relTargetPos < 0.5){\r\n\t\t\t\t\ttargetTaskId = prevSibling;\r\n\t\t\t\t}\r\n\t\t\t\tresult = dropTarget.nextSiblingTarget(dndTaskId, targetTaskId, store);\r\n\t\t\t}\r\n\t\t}else if(targetLevel > level){\r\n\t\t\tstore.eachParent(function(parent){\r\n\t\t\t\tif(store.calculateItemLevel(parent) === level){\r\n\t\t\t\t\ttargetTaskId = parent.id;\r\n\t\t\t\t}\r\n\t\t\t}, targetTask); \r\n\t\t\tresult = findTargetAbove(dndTaskId, targetTaskId, level, store);\r\n\t\t}else{\r\n\t\t\tvar targetAbove = findTargetAbove(dndTaskId, targetTaskId, level, store);\r\n\t\t\tvar targetBelow = findTargetBelow(dndTaskId, targetTaskId, level, store);\r\n\t\t\tresult = (relTargetPos < 0.5) ? targetAbove : targetBelow;\r\n\t\t}\r\n\t}else{\r\n\t\tvar rootId = store.$getRootId();\r\n\t\tvar rootLevel = store.getChildren(rootId);\r\n\t\tresult = dropTarget.createDropTargetObject();\r\n\t\tif(rootLevel.length && eventTop >= 0){\r\n\t\t\tresult = findTargetAbove(dndTaskId, getLast(store), level, store);\r\n\t\t}else{\r\n\t\t\tresult = findTargetBelow(dndTaskId, rootId, level, store);\r\n\t\t}\r\n\t}\r\n\r\n\treturn result;\r\n};\r\n","/**\r\n * resolve dnd position of the task when gantt.config.order_branch_free = true\r\n */\r\n\r\nimport dropTarget from \"./drop_target\";\r\n\r\nexport default function getMultiLevelDropPosition(dndTaskId, targetTaskId, relTargetPos, eventTop, store){\r\n\tvar result;\r\n\r\n\tif(targetTaskId !== store.$getRootId()){\r\n\t\tif(relTargetPos < 0.25){\r\n\t\t\tresult = dropTarget.prevSiblingTarget(dndTaskId, targetTaskId, store);\r\n\t\t}else if(relTargetPos > 0.60 && !(store.hasChild(targetTaskId) && store.getItem(targetTaskId).$open)){\r\n\t\t\tresult = dropTarget.nextSiblingTarget(dndTaskId, targetTaskId, store);\r\n\t\t}else {\r\n\t\t\tresult = dropTarget.firstChildTarget(dndTaskId, targetTaskId, store);\r\n\t\t}\r\n\t}else{\r\n\t\tvar rootId = store.$getRootId();\r\n\t\tif(store.hasChild(rootId) && eventTop >= 0){\r\n\t\t\tresult = dropTarget.lastChildTarget(dndTaskId, rootId, store);\r\n\t\t}else{\r\n\t\t\tresult = dropTarget.firstChildTarget(dndTaskId, rootId, store);\r\n\t\t}\r\n\t}\r\n\r\n\treturn result;\r\n};","import * as domHelpers from \"../../utils/dom_helpers\";\r\n\r\n/**\r\n * methods for highlighting current drag and drop position\r\n */\r\n\r\nfunction highlightPosition(target, root, grid){\r\n\tvar markerPos = getTaskMarkerPosition(target, grid);\r\n\t// setting position of row\r\n\troot.marker.style.left = markerPos.x + 9 + \"px\";\r\n\troot.marker.style.width = markerPos.width + \"px\";\r\n\troot.marker.style.overflow = \"hidden\";\r\n\tvar markerLine = root.markerLine;\r\n\tif(!markerLine){\r\n\t\tmarkerLine = document.createElement(\"div\");\r\n\t\tmarkerLine.className = \"gantt_drag_marker gantt_grid_dnd_marker\";\r\n\t\tmarkerLine.innerHTML = \"<div class='gantt_grid_dnd_marker_line'></div>\";\r\n\t\tmarkerLine.style.pointerEvents = \"none\";\r\n\t}\r\n\r\n\tif(target.child){\r\n\t\thighlightFolder(target, markerLine, grid);\r\n\t}else{\r\n\t\thighlightRow(target, markerLine, grid);\r\n\t}\r\n\r\n\tif(!root.markerLine){\r\n\t\tdocument.body.appendChild(markerLine);\r\n\t\troot.markerLine = markerLine;\r\n\t}\r\n}\r\n\r\nfunction removeLineHighlight(root){\r\n\tif(root.markerLine && root.markerLine.parentNode){\r\n\t\troot.markerLine.parentNode.removeChild(root.markerLine);\r\n\t}\r\n\troot.markerLine = null;\r\n}\r\n\r\nfunction highlightRow(target, markerLine, grid){\r\n\tvar linePos = getLineMarkerPosition(target, grid);\r\n\tvar maxBottom = grid.$grid_data.getBoundingClientRect().bottom + window.scrollY;\r\n\r\n\tmarkerLine.innerHTML = \"<div class='gantt_grid_dnd_marker_line'></div>\";\r\n\tmarkerLine.style.left = linePos.x + \"px\";\r\n\tmarkerLine.style.height = \"4px\";\r\n\r\n\tvar markerLineTop = linePos.y - 2;\r\n\tmarkerLine.style.top = markerLineTop + \"px\";\r\n\tmarkerLine.style.width = linePos.width + \"px\";\r\n\r\n\tif (markerLineTop > maxBottom) {\r\n\t\tmarkerLine.style.top = maxBottom + 'px';\r\n\t}\r\n\r\n\treturn markerLine;\r\n}\r\nfunction highlightFolder(target, markerFolder, grid){\r\n\tvar id = target.targetParent;\r\n\tvar pos = gridToPageCoordinates({x: 0, y: grid.getItemTop(id)}, grid);\r\n\tvar maxBottom = grid.$grid_data.getBoundingClientRect().bottom + window.scrollY;\r\n\r\n\tlet folderHighlightWidth = setWidthWithinContainer(grid.$gantt, grid.$grid_data.offsetWidth);\t\r\n\r\n\tmarkerFolder.innerHTML = \"<div class='gantt_grid_dnd_marker_folder'></div>\";\r\n\tmarkerFolder.style.width = folderHighlightWidth + \"px\";\r\n\tmarkerFolder.style.top = pos.y + \"px\";\r\n\tmarkerFolder.style.left = pos.x  + \"px\";\r\n\tmarkerFolder.style.height = grid.getItemHeight(id) + \"px\";\r\n\tif (pos.y > maxBottom) {\r\n\t\tmarkerFolder.style.top = maxBottom + 'px';\r\n\t}\r\n\r\n\treturn markerFolder;\r\n}\r\n\r\nfunction getLineMarkerPosition(target, grid){\r\n\tvar store = grid.$config.rowStore;\r\n\tvar pos = {x:0, y:0};\r\n\tvar indentNode = grid.$grid_data.querySelector(\".gantt_tree_indent\");\r\n\tvar indent = 15;\r\n\tvar level = 0;\r\n\tif(indentNode){\r\n\t\tindent = indentNode.offsetWidth;\r\n\t}\r\n\tvar iconWidth = 40;\r\n\tif(target.targetId !== store.$getRootId()){\r\n\t\tvar itemTop = grid.getItemTop(target.targetId);\r\n\t\tvar itemHeight = grid.getItemHeight(target.targetId);\r\n\t\tlevel = store.exists(target.targetId) ? store.calculateItemLevel(store.getItem(target.targetId)) : 0;\r\n\r\n\t\tif(target.prevSibling){\r\n\t\t\tpos.y = itemTop;\r\n\t\t}else if(target.nextSibling){\r\n\t\t\tvar childCount = 0;\r\n\t\t\tstore.eachItem(function(child){\r\n\t\t\t\tif(store.getIndexById(child.id) !== -1)\r\n\t\t\t\t\tchildCount++;\r\n\t\t\t}, target.targetId);\r\n\r\n\t\t\tpos.y = itemTop + itemHeight + childCount*itemHeight;\r\n\t\t}else {\r\n\t\t\tpos.y = itemTop + itemHeight;\r\n\t\t\tlevel += 1;\r\n\t\t}\r\n\t}\r\n\tpos.x = iconWidth + level * indent;\r\n\tpos.width = setWidthWithinContainer(grid.$gantt, Math.max(grid.$grid_data.offsetWidth - pos.x, 0), pos.x);\r\n\treturn gridToPageCoordinates(pos, grid);\r\n}\r\n\r\nfunction gridToPageCoordinates(pos, grid){\r\n\tvar gridPos = domHelpers.getNodePosition(grid.$grid_data);\r\n\tpos.x += gridPos.x + grid.$grid.scrollLeft;\r\n\tpos.y += gridPos.y - grid.$grid_data.scrollTop;\r\n\treturn pos;\r\n}\r\n\r\nfunction getTaskMarkerPosition(e, grid) {\r\n\tvar pos = domHelpers.getNodePosition(grid.$grid_data);\r\n\tvar ePos = domHelpers.getRelativeEventPosition(e, grid.$grid_data);\r\n\t// row offset\r\n\tvar x = pos.x + grid.$grid.scrollLeft;\r\n\tvar y = ePos.y - 10;\r\n\r\n\tvar rowHeight = grid.getItemHeight(e.targetId);\r\n\t// prevent moving row out of grid_data container\r\n\tif (y < pos.y) y = pos.y;\r\n\tvar gridHeight = grid.getTotalHeight();\r\n\tif (y > pos.y + gridHeight - rowHeight) y = pos.y + gridHeight - rowHeight;\r\n\r\n\tpos.x = x;\r\n\tpos.y = y;\r\n\tpos.width = setWidthWithinContainer(grid.$gantt, pos.width, 9);\r\n\treturn pos;\r\n}\r\n\r\nfunction setWidthWithinContainer(gantt, width, offset = 0){\r\n\tconst containerSize = domHelpers.getNodePosition(gantt.$root);\r\n\tif (width > containerSize.width){\r\n\t\twidth = containerSize.width - offset - 2;\r\n\t}\r\n\treturn width;\r\n}\r\n\r\nexport default {\r\n\tremoveLineHighlight: removeLineHighlight,\r\n\thighlightPosition: highlightPosition\r\n};\r\n","import * as domHelpers from \"../utils/dom_helpers\";\r\nimport dropTarget from \"./tasks_grid_dnd_marker_helpers/drop_target\";\r\nimport getLockedLevelTarget from \"./tasks_grid_dnd_marker_helpers/locked_level\";\r\nimport getMultiLevelTarget from \"./tasks_grid_dnd_marker_helpers/multi_level\";\r\nimport higlighter from \"./tasks_grid_dnd_marker_helpers/highlight\";\r\nimport isPlaceholderTask from \"../../../utils/placeholder_task\";\r\n\r\nfunction _init_dnd(gantt, grid) {\r\n\tvar DnD = gantt.$services.getService(\"dnd\");\r\n\r\n\tif(!grid.$config.bind || !gantt.getDatastore(grid.$config.bind)){\r\n\t\treturn;\r\n\t}\r\n\r\n\tfunction locate(e){\r\n\t\treturn domHelpers.locateAttribute(e, grid.$config.item_attribute);\r\n\t}\r\n\r\n\tfunction getStore(){\r\n\t\treturn gantt.getDatastore(grid.$config.bind);\r\n\t}\r\n\r\n\tfunction checkPlaceholderTask(id){\r\n\t\treturn isPlaceholderTask(id, gantt, getStore());\r\n\t}\r\n\r\n\tvar dnd = new DnD(grid.$grid_data, {updates_per_second: 60});\r\n\tif (gantt.defined(grid.$getConfig().dnd_sensitivity))\r\n\t\tdnd.config.sensitivity = grid.$getConfig().dnd_sensitivity;\r\n\r\n\tdnd.attachEvent(\"onBeforeDragStart\", gantt.bind(function (obj, e) {\r\n\t\tvar el = locate(e);\r\n\t\tif (!el) return false;\r\n\t\tif (gantt.hideQuickInfo) gantt.hideQuickInfo();\r\n\t\tif (domHelpers.closest(e.target, \".gantt_grid_editor_placeholder\")){\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar id = el.getAttribute(grid.$config.item_attribute);\r\n\t\tvar datastore = grid.$config.rowStore;\r\n\t\tvar task = datastore.getItem(id);\r\n\r\n\t\tif (gantt.isReadonly(task) || checkPlaceholderTask(id))\r\n\t\t\treturn false;\r\n\r\n\t\tdnd.config.initial_open_state = task.$open;\r\n\t\tif (!gantt.callEvent(\"onRowDragStart\", [id, e.target || e.srcElement, e])) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t}, gantt));\r\n\r\n\tdnd.attachEvent(\"onAfterDragStart\", gantt.bind(function (obj, e) {\r\n\t\tvar el = locate(e);\r\n\r\n\t\tdnd.config.marker.innerHTML = el.outerHTML;\r\n\t\tvar element = dnd.config.marker.firstChild;\r\n\t\tif(element){\r\n\t\t\tdnd.config.marker.style.opacity = 0.4;\r\n\t\t\telement.style.position = \"static\";\r\n\t\t\telement.style.pointerEvents = \"none\";\r\n\t\t}\r\n\r\n\t\tdnd.config.id = el.getAttribute(grid.$config.item_attribute);\r\n\r\n\t\tvar store = grid.$config.rowStore;\r\n\r\n\t\tvar task = store.getItem(dnd.config.id);\r\n\t\tdnd.config.level = store.calculateItemLevel(task);\r\n\t\tdnd.config.drop_target = dropTarget.createDropTargetObject({\r\n\t\t\ttargetParent: store.getParent(task.id),\r\n\t\t\ttargetIndex: store.getBranchIndex(task.id),\r\n\t\t\ttargetId: task.id,\r\n\t\t\tnextSibling: true\r\n\t\t});\r\n\r\n\t\ttask.$open = false;\r\n\t\ttask.$transparent = true;\r\n\t\tthis.refreshData();\r\n\t}, gantt));\r\n\r\n\tfunction getTargetTaskId(e){\r\n\t\tvar y = domHelpers.getRelativeEventPosition(e, grid.$grid_data).y;\r\n\t\tvar store = grid.$config.rowStore;\r\n\r\n\t\tif (!document.doctype){\r\n\t\t\ty += window.scrollY;\r\n\t\t}\r\n\t\ty = y || 0;\r\n\r\n\t\t// limits for the marker according to the layout layer\r\n\t\tvar scrollPos = grid.$state.scrollTop || 0;\r\n\t\tvar maxBottom = gantt.$grid_data.getBoundingClientRect().height + scrollPos + window.scrollY;\r\n\t\tvar minTop = scrollPos;\r\n\r\n\t\tvar firstVisibleTaskIndex = grid.getItemIndexByTopPosition(grid.$state.scrollTop);\r\n\t\tif (!store.exists(firstVisibleTaskIndex)){\r\n\t\t\tfirstVisibleTaskIndex = store.countVisible() - 1;\r\n\t\t}\r\n\t\tif (firstVisibleTaskIndex < 0) {\r\n\t\t\treturn store.$getRootId();\r\n\t\t}\r\n\r\n\t\tvar firstVisibleTaskId = store.getIdByIndex(firstVisibleTaskIndex);\r\n\r\n\t\tvar firstVisibleTaskPos = grid.$state.scrollTop / grid.getItemHeight(firstVisibleTaskId);\r\n\t\tvar hiddenTaskPart = firstVisibleTaskPos - Math.floor(firstVisibleTaskPos);\r\n\t\tif (hiddenTaskPart > 0.1 && hiddenTaskPart < 0.9) {\r\n\t\t\tmaxBottom = maxBottom - grid.getItemHeight(firstVisibleTaskId) * hiddenTaskPart;\r\n\t\t\tminTop = minTop + grid.getItemHeight(firstVisibleTaskId) * (1 - hiddenTaskPart);\r\n\t\t}\r\n\r\n\t\t// GS-715. The placeholder task row shouldn't be draggable below the Gantt container\r\n\t\tconst gridPosition = domHelpers.getNodePosition(grid.$grid_data);\r\n\t\tconst gridBottom = gridPosition.y + gridPosition.height;\r\n\t\tconst placeholderRowHeight = dnd.config.marker.offsetHeight;\r\n\t\tif (y + placeholderRowHeight + window.scrollY >= maxBottom){\r\n\t\t\tdnd.config.marker.style.top = gridBottom - placeholderRowHeight\t+ \"px\";\r\n\t\t}\r\n\r\n\t\tif (y >= maxBottom) {\r\n\t\t\ty = maxBottom;\r\n\t\t} else if (y <= minTop) {\r\n\t\t\ty = minTop;\r\n\t\t\tdnd.config.marker.style.top = gridPosition.y + \"px\";\r\n\t\t}\r\n\r\n\t\tvar index = grid.getItemIndexByTopPosition(y);\r\n\r\n\t\tif (index > store.countVisible() - 1 || index < 0) {\r\n\t\t\treturn store.$getRootId();\r\n\t\t}\r\n\r\n\t\tvar targetId = store.getIdByIndex(index);\r\n\t\tif (checkPlaceholderTask(targetId)) {\r\n\t\t\treturn store.getPrevSibling(targetId);\r\n\t\t}\r\n\r\n\t\treturn store.getIdByIndex(index);\r\n\t}\r\n\r\n\tfunction getDropPosition(e){\r\n\t\tvar targetTaskId = getTargetTaskId(e);\r\n\t\tvar relTargetPos = null;\r\n\t\tvar store = grid.$config.rowStore;\r\n\t\tvar config = grid.$getConfig();\r\n\t\tvar lockLevel = !config.order_branch_free;\r\n\r\n\t\tvar eventTop = domHelpers.getRelativeEventPosition(e, grid.$grid_data).y;\r\n\t\tif (!document.doctype){\r\n\t\t\teventTop += window.scrollY;\r\n\t\t}\r\n\r\n\t\tif(targetTaskId !== store.$getRootId()) {\r\n\t\t\tvar rowTop = grid.getItemTop(targetTaskId);\r\n\t\t\tvar rowHeight = grid.getItemHeight(targetTaskId);\r\n\t\t\trelTargetPos = (eventTop - rowTop) / rowHeight;\r\n\t\t}\r\n\r\n\t\tvar result;\r\n\t\tif(!lockLevel){\r\n\t\t\tresult = getMultiLevelTarget(dnd.config.id, targetTaskId, relTargetPos, eventTop, store);\r\n\t\t}else{\r\n\t\t\tresult = getLockedLevelTarget(dnd.config.id, targetTaskId, relTargetPos, eventTop, store, dnd.config.level);\r\n\t\t\tif(result && result.targetParent && checkPlaceholderTask(result.targetParent)){\r\n\t\t\t\ttargetTaskId = store.getPrevSibling(result.targetParent);\r\n\t\t\t\tresult = getLockedLevelTarget(dnd.config.id, targetTaskId, relTargetPos, eventTop, store, dnd.config.level);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tdnd.attachEvent(\"onDragMove\", gantt.bind(function (obj, e) {\r\n\t\tvar target = getDropPosition(e);\r\n\r\n\t\tif(!target ||\r\n\t\t\tgantt.callEvent(\"onBeforeRowDragMove\", [dnd.config.id, target.targetParent, target.targetIndex]) === false){\r\n\t\t\t\ttarget = dropTarget.createDropTargetObject(dnd.config.drop_target);\r\n\t\t\t}\r\n\r\n\t\thiglighter.highlightPosition(target, dnd.config, grid);\r\n\t\tdnd.config.drop_target = target;\r\n\t\tgantt._waiAria.reorderMarkerAttr(dnd.config.marker);\r\n\r\n\t\tthis.callEvent(\"onRowDragMove\", [dnd.config.id, target.targetParent, target.targetIndex]);\r\n\t\treturn true;\r\n\t}, gantt));\r\n\r\n\tdnd.attachEvent(\"onDragEnd\", gantt.bind(function () {\r\n\t\tvar store = grid.$config.rowStore;\r\n\t\tvar task = store.getItem(dnd.config.id);\r\n\r\n\t\thiglighter.removeLineHighlight(dnd.config);\r\n\r\n\t\ttask.$transparent = false;\r\n\t\ttask.$open = dnd.config.initial_open_state;\r\n\t\tvar target = dnd.config.drop_target;\r\n\r\n\t\tif (this.callEvent(\"onBeforeRowDragEnd\", [dnd.config.id, target.targetParent, target.targetIndex]) === false) {\r\n\t\t\ttask.$drop_target = null;\r\n\t\t} else {\r\n\t\t\tstore.move(dnd.config.id, target.targetIndex, target.targetParent);\r\n\t\t\tgantt.render();\r\n\t\t\tthis.callEvent(\"onRowDragEnd\", [dnd.config.id, target.targetParent, target.targetIndex]);\r\n\t\t}\r\n\t\tstore.refresh(task.id);\r\n\t}, gantt));\r\n}\r\n\r\nexport default {\r\n\tinit: _init_dnd\r\n};","import * as utils from \"../../../utils/utils\";\r\nimport rowDnd from \"./tasks_grid_dnd\";\r\nimport rowDndMarker from \"./tasks_grid_dnd_marker\";\r\nimport mouseEventContainer from \"../mouse_event_container\";\r\n\r\nvar initializer = (function(){\r\n\treturn function(gantt){\r\n\t\treturn {\r\n\t\t\tonCreated: function (grid) {\r\n\t\t\t\tgrid.$config = utils.mixin(grid.$config, {\r\n\t\t\t\t\tbind: \"task\"\r\n\t\t\t\t});\r\n\t\t\t\tif(grid.$config.id == \"grid\") {\r\n\t\t\t\t\tthis.extendGantt(grid);\r\n\t\t\t\t\tgantt.ext.inlineEditors = gantt.ext._inlineEditors.createEditors(grid);\r\n\t\t\t\t\tgantt.ext.inlineEditors.init();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._mouseDelegates = mouseEventContainer(gantt);\r\n\t\t\t},\r\n\t\t\tonInitialized: function (grid) {\r\n\t\t\t\tvar config = grid.$getConfig();\r\n\t\t\t\tif (config.order_branch) {\r\n\t\t\t\t\tif(config.order_branch == \"marker\"){\r\n\t\t\t\t\t\trowDndMarker.init(grid.$gantt, grid);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\trowDnd.init(grid.$gantt, grid);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.initEvents(grid, gantt);\r\n\t\t\t\tif(grid.$config.id == \"grid\") {\r\n\t\t\t\t\tthis.extendDom(grid);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonDestroyed: function (grid) {\r\n\t\t\t\tif(grid.$config.id == \"grid\") {\r\n\t\t\t\t\t// GS-1288. We need to only detach the store and its events without detaching the\r\n\t\t\t\t\t// inline editor's events. Otherwise, we won't be able to access them\r\n\t\t\t\t\tgantt.ext.inlineEditors.detachStore();\r\n\t\t\t\t}\r\n\t\t\t\tthis.clearEvents(grid, gantt);\r\n\t\t\t},\r\n\r\n\t\t\tinitEvents: function (grid, gantt) {\r\n\t\t\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_row\", gantt.bind(function (e, id, trg) {\r\n\t\t\t\t\tconst config = grid.$getConfig();\r\n\t\t\t\t\tif (id !== null) {\r\n\t\t\t\t\t\tconst task = this.getTask(id);\r\n\t\t\t\t\t\tif (config.scroll_on_click) {\r\n\t\t\t\t\t\t\tconst notOpenIcon = !gantt._is_icon_open_click(e);\r\n\t\t\t\t\t\t\tconst visibleTimeline = gantt.$ui.getView(\"timeline\");\r\n\t\t\t\t\t\t\t// don't need to scroll to the date when the timeline is not visible\r\n\t\t\t\t\t\t\t// or when we click on the open/close icon\r\n\t\t\t\t\t\t\tif (notOpenIcon && visibleTimeline){\r\n\t\t\t\t\t\t\t\tthis.showDate(task.start_date);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tgantt.callEvent(\"onTaskRowClick\", [id, trg]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, gantt), grid.$grid);\r\n\r\n\t\t\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_grid_head_cell\", gantt.bind(function (e, id, trg) {\r\n\t\t\t\t\tvar column = trg.getAttribute(\"data-column-id\");\r\n\r\n\t\t\t\t\tif (!gantt.callEvent(\"onGridHeaderClick\", [column, e]))\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tvar config = grid.$getConfig();\r\n\r\n\t\t\t\t\tif (column == \"add\") {\r\n\t\t\t\t\t\tvar mouseEvents = gantt.$services.getService(\"mouseEvents\");\r\n\t\t\t\t\t\tmouseEvents.callHandler(\"click\", \"gantt_add\", grid.$grid, [e, config.root_id]);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (config.sort && column) { // GS-929: if there is no column name, we cannot sort the column\r\n\t\t\t\t\t\tvar sorting_method = column,\r\n\t\t\t\t\t\t\tconf;\r\n\r\n\t\t\t\t\t\tfor (var i = 0; i < config.columns.length; i++) {\r\n\t\t\t\t\t\t\tif (config.columns[i].name == column) {\r\n\t\t\t\t\t\t\t\tconf = config.columns[i];\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (conf && conf.sort !== undefined && conf.sort !== true) {\r\n\t\t\t\t\t\t\tsorting_method = conf.sort;\r\n\r\n\t\t\t\t\t\t\tif (!sorting_method) { // column sort property 'false', no sorting\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar sort = (this._sort && this._sort.direction && this._sort.name == column) ? this._sort.direction : \"desc\";\r\n\t\t\t\t\t\t// invert sort direction\r\n\t\t\t\t\t\tsort = (sort == \"desc\") ? \"asc\" : \"desc\";\r\n\t\t\t\t\t\tthis._sort = {\r\n\t\t\t\t\t\t\tname: column,\r\n\t\t\t\t\t\t\tdirection: sort\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis.sort(sorting_method, sort == \"desc\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}, gantt), grid.$grid);\r\n\r\n\t\t\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_add\", gantt.bind(function (e, id, trg) {\r\n\t\t\t\t\tvar config = grid.$getConfig();\r\n\t\t\t\t\tif (config.readonly) return;\r\n\r\n\t\t\t\t\tvar item = {};\r\n\t\t\t\t\tthis.createTask(item, id ? id : gantt.config.root_id);\r\n\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}, gantt), grid.$grid);\r\n\r\n\t\t\t},\r\n\r\n\t\t\tclearEvents: function(grid, gantt){\r\n\t\t\t\tthis._mouseDelegates.destructor();\r\n\t\t\t\tthis._mouseDelegates = null;\r\n\t\t\t},\r\n\r\n\t\t\textendDom: function(grid){\r\n\t\t\t\tgantt.$grid = grid.$grid;\r\n\t\t\t\tgantt.$grid_scale = grid.$grid_scale;\r\n\t\t\t\tgantt.$grid_data = grid.$grid_data;\r\n\t\t\t},\r\n\t\t\textendGantt: function(grid){\r\n\t\t\t\tgantt.getGridColumns = gantt.bind(grid.getGridColumns, grid);\r\n\r\n\t\t\t\tgrid.attachEvent(\"onColumnResizeStart\", function(){\r\n\t\t\t\t\treturn gantt.callEvent(\"onColumnResizeStart\", arguments);\r\n\t\t\t\t});\r\n\t\t\t\tgrid.attachEvent(\"onColumnResize\", function(){\r\n\t\t\t\t\treturn gantt.callEvent(\"onColumnResize\", arguments);\r\n\t\t\t\t});\r\n\t\t\t\tgrid.attachEvent(\"onColumnResizeEnd\", function(){\r\n\t\t\t\t\treturn gantt.callEvent(\"onColumnResizeEnd\", arguments);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tgrid.attachEvent(\"onColumnResizeComplete\", function(columns, totalWidth){\r\n\t\t\t\t\tgantt.config.grid_width = totalWidth;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tgrid.attachEvent(\"onBeforeRowResize\", function(){\r\n\t\t\t\t\treturn gantt.callEvent(\"onBeforeRowResize\", arguments);\r\n\t\t\t\t});\r\n\t\t\t\tgrid.attachEvent(\"onRowResize\", function(){\r\n\t\t\t\t\treturn gantt.callEvent(\"onRowResize\", arguments);\r\n\t\t\t\t});\r\n\t\t\t\tgrid.attachEvent(\"onBeforeRowResizeEnd\", function(){\r\n\t\t\t\t\treturn gantt.callEvent(\"onBeforeRowResizeEnd\", arguments);\r\n\t\t\t\t});\r\n\t\t\t\tgrid.attachEvent(\"onAfterRowResize\", function(){\r\n\t\t\t\t\treturn gantt.callEvent(\"onAfterRowResize\", arguments);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n})();\r\n\r\nexport default initializer;","import * as domHelpers from \"../utils/dom_helpers\";\r\nimport * as utils from \"../../../utils/utils\";\r\nimport timeout from \"../../../utils/timeout\";\r\nimport * as helpers from \"../../../utils/helpers\";\r\n\r\nfunction createTaskDND(timeline, gantt) {\r\n\tvar services = gantt.$services;\r\n\treturn {\r\n\t\tdrag: null,\r\n\t\tdragMultiple: {},\r\n\t\t_events: {\r\n\t\t\tbefore_start: {},\r\n\t\t\tbefore_finish: {},\r\n\t\t\tafter_finish: {}\r\n\t\t},\r\n\t\t_handlers: {},\r\n\t\tinit: function() {\r\n\t\t\tthis._domEvents = gantt._createDomEventScope();\r\n\t\t\tthis.clear_drag_state();\r\n\t\t\tvar drag = gantt.config.drag_mode;\r\n\t\t\tthis.set_actions();\r\n\r\n\t\t\tvar stateService = services.getService(\"state\");\r\n\t\t\tstateService.registerProvider(\"tasksDnd\", utils.bind(function() {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdrag_id : this.drag ? this.drag.id : undefined,\r\n\t\t\t\t\tdrag_mode : this.drag ? this.drag.mode : undefined,\r\n\t\t\t\t\tdrag_from_start : this.drag ? this.drag.left : undefined\r\n\t\t\t\t};\r\n\t\t\t}, this));\r\n\r\n\t\t\tvar evs = {\r\n\t\t\t\t\"before_start\": \"onBeforeTaskDrag\",\r\n\t\t\t\t\"before_finish\": \"onBeforeTaskChanged\",\r\n\t\t\t\t\"after_finish\": \"onAfterTaskDrag\"\r\n\t\t\t};\r\n\t\t\t//for now, all drag operations will trigger the same events\r\n\t\t\tfor (var stage in this._events) {\r\n\t\t\t\tfor (var mode in drag) {\r\n\t\t\t\t\tthis._events[stage][mode] = evs[stage];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._handlers[drag.move] = this._move;\r\n\t\t\tthis._handlers[drag.resize] = this._resize;\r\n\t\t\tthis._handlers[drag.progress] = this._resize_progress;\r\n\t\t},\r\n\t\tset_actions: function() {\r\n\t\t\tvar data = timeline.$task_data;\r\n\t\t\tthis._domEvents.attach(data, \"mousemove\", gantt.bind(function(e) {\r\n\t\t\t\tthis.on_mouse_move(e);\r\n\t\t\t}, this));\r\n\t\t\tthis._domEvents.attach(data, \"mousedown\", gantt.bind(function(e) {\r\n\t\t\t\tthis.on_mouse_down(e);\r\n\t\t\t}, this));\r\n\t\t\tthis._domEvents.attach(document.body, \"mouseup\", gantt.bind(function(e) {\r\n\t\t\t\tthis.on_mouse_up(e);\r\n\t\t\t}, this));\r\n\t\t},\r\n\r\n\t\t_getPositioningContext: function(task) {\r\n\t\t\tif(timeline._getPositioningContext) {\r\n\t\t\t\treturn timeline._getPositioningContext(task);\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\r\n\t\tclear_drag_state: function() {\r\n\t\t\tthis.drag = {\r\n\t\t\t\tid: null,\r\n\t\t\t\tmode: null,\r\n\t\t\t\tpos: null,\r\n\t\t\t\tstart_x: null,\r\n\t\t\t\tstart_y: null,\r\n\t\t\t\tobj: null,\r\n\t\t\t\tleft: null\r\n\t\t\t};\r\n\t\t\tthis.dragMultiple = {};\r\n\t\t},\r\n\t\t_resize: function(task, shift, drag) {\r\n\t\t\tvar cfg = timeline.$getConfig();\r\n\t\t\tvar coords_x = this._drag_task_coords(task, drag);\r\n\t\t\tif (drag.left) {\r\n\t\t\t\ttask.start_date = gantt.dateFromPos(coords_x.start + shift, this._getPositioningContext(task));\r\n\t\t\t\tif (!task.start_date) {\r\n\t\t\t\t\ttask.start_date = new Date(gantt.getState().min_date);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\ttask.end_date = gantt.dateFromPos(coords_x.end + shift, this._getPositioningContext(task));\r\n\t\t\t\tif (!task.end_date) {\r\n\t\t\t\t\ttask.end_date = new Date(gantt.getState().max_date);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar minDurationInUnits = this._calculateMinDuration(cfg.min_duration, cfg.duration_unit);\r\n\t\t\tif (task.end_date - task.start_date < cfg.min_duration) {\r\n\t\t\t\tif (drag.left)\r\n\t\t\t\t\ttask.start_date = gantt.calculateEndDate(task.end_date, -minDurationInUnits, cfg.duration_unit, task);\r\n\t\t\t\telse\r\n\t\t\t\t\ttask.end_date = gantt.calculateEndDate(task.start_date, minDurationInUnits, cfg.duration_unit, task);\r\n\t\t\t}\r\n\t\t\tgantt._init_task_timing(task);\r\n\t\t},\r\n\t\t_calculateMinDuration: function(duration, unit) {\r\n\t\t\tvar inMs = {\r\n\t\t\t\t\"minute\": 60000,\r\n\t\t\t\t\"hour\": 3600000,\r\n\t\t\t\t\"day\": 86400000,\r\n\t\t\t\t\"week\": 604800000,\r\n\t\t\t\t\"month\": 2419200000,\r\n\t\t\t\t\"year\": 31356000000\r\n\t\t\t};\r\n\t\t\treturn Math.ceil(duration / inMs[unit]);\r\n\t\t},\r\n\t\t_resize_progress: function(task, shift, drag) {\r\n\t\t\tvar coords_x = this._drag_task_coords(task, drag);\r\n\r\n\t\t\tvar config = timeline.$getConfig();\r\n\t\t\tvar diffValue = !config.rtl ? (drag.pos.x - coords_x.start) : (coords_x.start - drag.pos.x);\r\n\r\n\t\t\tvar diff = Math.max(0, diffValue);\r\n\t\t\ttask.progress = Math.min(1, diff / Math.abs(coords_x.end - coords_x.start));\r\n\t\t},\r\n\t\t_find_max_shift: function(dragItems, shift) {\r\n\t\t\tvar correctShift;\r\n\t\t\tfor (var i in dragItems) {\r\n\t\t\t\tvar drag = dragItems[i];\r\n\t\t\t\tvar task = gantt.getTask(drag.id);\r\n\t\t\t\tif (task.unscheduled){\r\n\t\t\t\t\t// GS-1674. There is no need to check the tasks that are ignored by projects\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar coords_x = this._drag_task_coords(task, drag);\r\n\t\t\t\tvar minX = gantt.posFromDate(new Date(gantt.getState().min_date), this._getPositioningContext(task));\r\n\t\t\t\tvar maxX = gantt.posFromDate(new Date(gantt.getState().max_date), this._getPositioningContext(task));\r\n\r\n\t\t\t\tif (coords_x.end + shift > maxX) {\r\n\t\t\t\t\tvar maxShift = maxX - coords_x.end;\r\n\t\t\t\t\tif (maxShift < correctShift || correctShift === undefined) {\r\n\t\t\t\t\t\tcorrectShift = maxShift;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (coords_x.start + shift < minX) {\r\n\t\t\t\t\tvar minShift = minX - coords_x.start;\r\n\t\t\t\t\tif (minShift > correctShift || correctShift === undefined) {\r\n\t\t\t\t\t\tcorrectShift = minShift;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn correctShift;\r\n\t\t},\r\n\t\t_move: function(task, shift, drag, multipleDragShift) {\r\n\t\t\tvar coords_x = this._drag_task_coords(task, drag);\r\n\t\t\tvar new_start = null,\r\n\t\t\tnew_end = null;\r\n\t\t\t// GS-454: If we drag multiple tasks, rely on the dates instead of timeline coordinates\r\n\t\t\tif (multipleDragShift){\r\n\t\t\t\tnew_start = new Date(+drag.obj.start_date + multipleDragShift),\r\n\t\t\t\tnew_end = new Date(+drag.obj.end_date + multipleDragShift);\r\n\t\t\t} else {\r\n\t\t\t\tnew_start = gantt.dateFromPos(coords_x.start + shift, this._getPositioningContext(task)),\r\n\t\t\t\tnew_end = gantt.dateFromPos(coords_x.end + shift, this._getPositioningContext(task));\r\n\t\t\t}\r\n\t\t\tif (!new_start) {\r\n\t\t\t\ttask.start_date = new Date(gantt.getState().min_date);\r\n\t\t\t\ttask.end_date = gantt.dateFromPos(gantt.posFromDate(task.start_date) + (coords_x.end - coords_x.start), this._getPositioningContext(task));\r\n\t\t\t} else if (!new_end) {\r\n\t\t\t\ttask.end_date = new Date(gantt.getState().max_date);\r\n\t\t\t\ttask.start_date = gantt.dateFromPos(gantt.posFromDate(task.end_date) - (coords_x.end - coords_x.start), this._getPositioningContext(task));\r\n\t\t\t} else {\r\n\t\t\t\ttask.start_date = new_start;\r\n\t\t\t\ttask.end_date = new_end;\r\n\t\t\t}\r\n\t\t},\r\n\t\t_drag_task_coords: function(t, drag) {\r\n\t\t\tvar start = drag.obj_s_x = drag.obj_s_x || gantt.posFromDate(t.start_date, this._getPositioningContext(t));\r\n\t\t\tvar end = drag.obj_e_x = drag.obj_e_x || gantt.posFromDate(t.end_date, this._getPositioningContext(t));\r\n\t\t\treturn {\r\n\t\t\t\tstart: start,\r\n\t\t\t\tend: end\r\n\t\t\t};\r\n\t\t},\r\n\t\t_mouse_position_change: function(oldPos, newPos) {\r\n\t\t\tvar dx = oldPos.x - newPos.x,\r\n\t\t\t\tdy = oldPos.y - newPos.y;\r\n\t\t\treturn Math.sqrt(dx * dx + dy * dy);\r\n\t\t},\r\n\t\t_is_number: function(n) {\r\n\t\t\treturn !isNaN(parseFloat(n)) && isFinite(n);\r\n\t\t},\r\n\r\n\t\ton_mouse_move: function(e) {\r\n\t\t\tif (this.drag.start_drag) {\r\n\t\t\t\tvar pos = domHelpers.getRelativeEventPosition(e, gantt.$task_data);\r\n\r\n\t\t\t\tvar sX = this.drag.start_drag.start_x,\r\n\t\t\t\t\tsY = this.drag.start_drag.start_y;\r\n\r\n\t\t\t\tif ((Date.now() - this.drag.timestamp > 50) ||\r\n\t\t\t\t\t(this._is_number(sX) && this._is_number(sY) && this._mouse_position_change({\r\n\t\t\t\t\t\tx: sX,\r\n\t\t\t\t\t\ty: sY\r\n\t\t\t\t\t}, pos) > 20)) {\r\n\t\t\t\t\tthis._start_dnd(e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar drag = this.drag;\r\n\r\n\t\t\tif (drag.mode) {\r\n\t\t\t\tif (!timeout(this, 40))//limit update frequency\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tthis._update_on_move(e);\r\n\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_update_item_on_move: function(shift, id, mode, drag, e, multipleDragShift) {\r\n\t\t\tvar task = gantt.getTask(id);\r\n\t\t\tvar original = gantt.mixin({}, task);\r\n\t\t\tvar copy = gantt.mixin({}, task);\r\n\t\t\tthis._handlers[mode].apply(this, [copy, shift, drag, multipleDragShift]);\r\n\t\t\tgantt.mixin(task, copy, true);\r\n\t\t\t//gantt._update_parents(drag.id, true);\r\n\t\t\tgantt.callEvent(\"onTaskDrag\", [task.id, mode, copy, original, e]);\r\n\t\t\tgantt.mixin(task, copy, true);\r\n\t\t\tgantt.refreshTask(id);\r\n\t\t},\r\n\r\n\t\t_update_on_move: function(e) {\r\n\t\t\tvar drag = this.drag;\r\n\t\t\tvar config = timeline.$getConfig();\r\n\t\t\tif (drag.mode) {\r\n\t\t\t\tvar pos = domHelpers.getRelativeEventPosition(e, timeline.$task_data);\r\n\t\t\t\tif (drag.pos && drag.pos.x == pos.x)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tdrag.pos = pos;\r\n\r\n\t\t\t\tconst task = gantt.getTask(drag.id);\r\n\r\n\t\t\t\tvar curr_date = gantt.dateFromPos(pos.x, this._getPositioningContext(task));\r\n\t\t\t\tif (!curr_date || isNaN(curr_date.getTime()))\r\n\t\t\t\t\treturn;\r\n\r\n\r\n\t\t\t\tvar shift = pos.x - drag.start_x;\r\n\t\t\t\t\r\n\t\t\t\tif (this._handlers[drag.mode]) {\r\n\t\t\t\t\tif (drag.mode === config.drag_mode.move) {\r\n\t\t\t\t\t\tvar dragHash = {};\r\n\r\n\t\t\t\t\t\tif (this._isMultiselect()) {\r\n\t\t\t\t\t\t\tvar selectedTasksIds = gantt.getSelectedTasks();\r\n\t\t\t\t\t\t\tif (selectedTasksIds.indexOf(drag.id) >= 0) {\r\n\t\t\t\t\t\t\t\tdragHash = this.dragMultiple;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar dragProject = false;\r\n\t\t\t\t\t\tif (gantt.isSummaryTask(task) && gantt.config.drag_project) {\r\n\t\t\t\t\t\t\tvar initialDrag = {};\r\n\t\t\t\t\t\t\tinitialDrag[drag.id] = utils.copy(drag);\r\n\t\t\t\t\t\t\tdragProject = true;\r\n\t\t\t\t\t\t\tdragHash = utils.mixin(initialDrag, this.dragMultiple);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar maxShift = this._find_max_shift(dragHash, shift);\r\n\t\t\t\t\t\tif (maxShift !== undefined) {\r\n\t\t\t\t\t\t\tshift = maxShift;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis._update_item_on_move(shift, drag.id, drag.mode, drag, e);\r\n\r\n\t\t\t\t\t\tlet multipleDragShift;\r\n\t\t\t\t\t\tif (maxShift === undefined) {\r\n\t\t\t\t\t\t\t// GS-2593. If the timeline is repainted during the drag (infinite scale scenario)\r\n\t\t\t\t\t\t\t// we need to update the initial drag position to correctly update\r\n\t\t\t\t\t\t\t// the position of other dragged tasks\r\n\t\t\t\t\t\t\tconst newStartPos = gantt.posFromDate(drag.obj.start_date, this._getPositioningContext(drag.obj));\r\n\t\t\t\t\t\t\tconst newEndPos = gantt.posFromDate(drag.obj.end_date, this._getPositioningContext(drag.obj));\r\n\t\t\t\t\t\t\t// calculate the offset only when the drag started\r\n\t\t\t\t\t\t\tif (drag.handle_offset === undefined){\r\n\t\t\t\t\t\t\t\tconst width = newEndPos - newStartPos;\r\n\t\t\t\t\t\t\t\tconst dragPos = drag.start_x - newStartPos;\r\n\t\t\t\t\t\t\t\tdrag.handle_offset = dragPos / width;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconst newWidth = Math.abs(newEndPos - newStartPos);\r\n\t\t\t\t\t\t\tlet dragX = newStartPos + newWidth * drag.handle_offset;\r\n\r\n\t\t\t\t\t\t\t// GS-454: Calculate the date shift in milliseconds instead of pixels\r\n\t\t\t\t\t\t\tconst shiftDate = gantt.dateFromPos(dragX, this._getPositioningContext(drag.obj));\r\n\t\t\t\t\t\t\tmultipleDragShift = curr_date - shiftDate;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor (var i in dragHash) {\r\n\t\t\t\t\t\t\tvar childDrag = dragHash[i];\r\n\t\t\t\t\t\t\tif(dragProject && childDrag.id != drag.id){\r\n\t\t\t\t\t\t\t\tgantt._bulk_dnd = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis._update_item_on_move(shift, childDrag.id, childDrag.mode, childDrag, e, multipleDragShift);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tgantt._bulk_dnd = false;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// for resize and progress\r\n\t\t\t\t\t\tthis._update_item_on_move(shift, drag.id, drag.mode, drag, e);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgantt._update_parents(drag.id);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\ton_mouse_down: function(e, src) {\r\n\t\t\t// on Mac we do not get onmouseup event when clicking right mouse button leaving us in dnd state\r\n\t\t\t// let's ignore right mouse button then\r\n\t\t\tif (e.button == 2 && e.button !== undefined)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tvar config = timeline.$getConfig();\r\n\t\t\tvar id = gantt.locate(e);\r\n\t\t\tvar task = null;\r\n\t\t\tif (gantt.isTaskExists(id)) {\r\n\t\t\t\ttask = gantt.getTask(id);\r\n\t\t\t}\r\n\r\n\t\t\tif (gantt.isReadonly(task) || this.drag.mode) return;\r\n\r\n\t\t\tthis.clear_drag_state();\r\n\r\n\t\t\tsrc = src || (e.target || e.srcElement);\r\n\r\n\t\t\tvar className = domHelpers.getClassName(src);\r\n\t\t\tvar drag = this._get_drag_mode(className, src);\r\n\r\n\t\t\tif (!className || !drag) {\r\n\t\t\t\tif (src.parentNode)\r\n\t\t\t\t\treturn this.on_mouse_down(e, src.parentNode);\r\n\t\t\t\telse\r\n\t\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (!drag) {\r\n\t\t\t\tif (gantt.checkEvent(\"onMouseDown\") && gantt.callEvent(\"onMouseDown\", [className.split(\" \")[0]])) {\r\n\t\t\t\t\tif (src.parentNode)\r\n\t\t\t\t\t\treturn this.on_mouse_down(e, src.parentNode);\r\n\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (drag.mode && drag.mode != config.drag_mode.ignore && config[\"drag_\" + drag.mode]) {\r\n\t\t\t\t\tid = gantt.locate(src);\r\n\t\t\t\t\ttask = gantt.copy(gantt.getTask(id) || {});\r\n\r\n\t\t\t\t\tif (gantt.isReadonly(task)) {\r\n\t\t\t\t\t\tthis.clear_drag_state();\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ((gantt.isSummaryTask(task) && !(task.auto_scheduling === false) && !config.drag_project) && drag.mode != config.drag_mode.progress) {//only progress drag is allowed for tasks with flexible duration\r\n\t\t\t\t\t\tthis.clear_drag_state();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdrag.id = id;\r\n\t\t\t\t\tvar pos = domHelpers.getRelativeEventPosition(e, gantt.$task_data);\r\n\r\n\t\t\t\t\tdrag.start_x = pos.x;\r\n\t\t\t\t\tdrag.start_y = pos.y;\r\n\t\t\t\t\tdrag.obj = task;\r\n\t\t\t\t\tthis.drag.start_drag = drag;\r\n\t\t\t\t\tthis.drag.timestamp = Date.now();\r\n\r\n\t\t\t\t} else\r\n\t\t\t\t\tthis.clear_drag_state();\r\n\t\t\t}\r\n\t\t},\r\n\t\t_fix_dnd_scale_time: function(task, drag) {\r\n\t\t\tvar config = timeline.$getConfig();\r\n\t\t\tvar unit = gantt.getScale().unit,\r\n\t\t\t\tstep = gantt.getScale().step;\r\n\t\t\tif (!config.round_dnd_dates) {\r\n\t\t\t\tunit = 'minute';\r\n\t\t\t\tstep = config.time_step;\r\n\t\t\t}\r\n\r\n\t\t\tfunction fixStart(task) {\r\n\t\t\t\tif (!gantt.config.correct_work_time)\r\n\t\t\t\t\treturn;\r\n\t\t\t\tvar config = timeline.$getConfig();\r\n\t\t\t\tif (!gantt.isWorkTime(task.start_date, undefined, task))\r\n\t\t\t\t\ttask.start_date = gantt.calculateEndDate({\r\n\t\t\t\t\t\tstart_date: task.start_date,\r\n\t\t\t\t\t\tduration: -1,\r\n\t\t\t\t\t\tunit: config.duration_unit,\r\n\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfunction fixEnd(task) {\r\n\t\t\t\tif (!gantt.config.correct_work_time)\r\n\t\t\t\t\treturn;\r\n\t\t\t\tvar config = timeline.$getConfig();\r\n\t\t\t\tif (!gantt.isWorkTime(new Date(task.end_date - 1), undefined, task))\r\n\t\t\t\t\ttask.end_date = gantt.calculateEndDate({\r\n\t\t\t\t\t\tstart_date: task.end_date,\r\n\t\t\t\t\t\tduration: 1,\r\n\t\t\t\t\t\tunit: config.duration_unit,\r\n\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tconst dndContext = timeline._getPositioningContext(task);\r\n\r\n\t\t\tif (drag.mode == config.drag_mode.resize) {\r\n\t\t\t\tif (drag.left) {\r\n\t\t\t\t\ttask.start_date = gantt.roundDate({date: task.start_date, unit: unit, step: step});\r\n\t\r\n\t\t\t\t\tif(dndContext && dndContext.calendar){\r\n\t\t\t\t\t\ttask.start_date = dndContext.calendar.getClosestWorkTime({date: task.start_date, dir:\"future\"});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfixStart(task);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttask.end_date = gantt.roundDate({date: task.end_date, unit: unit, step: step});\r\n\t\t\t\t\tif(dndContext && dndContext.calendar){\r\n\t\t\t\t\t\ttask.end_date = dndContext.calendar.getClosestWorkTime({date: task.end_date});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfixEnd(task);\r\n\t\t\t\t}\r\n\t\t\t} else if (drag.mode == config.drag_mode.move) {\r\n\t\t\t\ttask.start_date = gantt.roundDate({date: task.start_date, unit: unit, step: step});\r\n\t\t\t\t\r\n\t\t\t\tif(dndContext && dndContext.calendar){\r\n\t\t\t\t\ttask.start_date = dndContext.calendar.getClosestWorkTime({date: task.start_date, dir:\"future\"});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfixStart(task);\r\n\t\t\t\ttask.end_date = gantt.calculateEndDate(task);\r\n\t\t\t}\r\n\t\t},\r\n\t\t_fix_working_times: function(task, drag) {\r\n\t\t\tvar config = timeline.$getConfig();\r\n\t\t\tvar drag = drag || {mode: config.drag_mode.move};\r\n\r\n\t\t\tif (drag.mode == config.drag_mode.resize) {\r\n\t\t\t\tif (drag.left) {\r\n\t\t\t\t\ttask.start_date = gantt.getClosestWorkTime({date: task.start_date, dir: 'future', task: task});\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttask.end_date = gantt.getClosestWorkTime({date: task.end_date, dir: 'past', task: task});\r\n\t\t\t\t}\r\n\t\t\t} else if (drag.mode == config.drag_mode.move) {\r\n\t\t\t\tgantt.correctTaskWorkTime(task);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_finalize_mouse_up: function(taskId, config, drag, e) {\r\n\t\t\tvar task = gantt.getTask(taskId);\r\n\r\n\t\t\tif (config.work_time && config.correct_work_time) {\r\n\t\t\t\tthis._fix_working_times(task, drag);\r\n\t\t\t}\r\n\r\n\t\t\tthis._fix_dnd_scale_time(task, drag);\r\n\r\n\t\t\tif (!this._fireEvent(\"before_finish\", drag.mode, [taskId, drag.mode, gantt.copy(drag.obj), e])) {\r\n\t\t\t\t//drag.obj._dhx_changed = false;\r\n\t\t\t\tthis.clear_drag_state();\r\n\t\t\t\tif (taskId == drag.id) {\r\n\t\t\t\t\tdrag.obj._dhx_changed = false;\r\n\t\t\t\t\tgantt.mixin(task, drag.obj, true);\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tgantt.refreshTask(task.id);\r\n\t\t\t\t// GS-2013. Repaint parent projects when the drag is cancelled\r\n\t\t\t\tif (task.$level > 100){\r\n\t\t\t\t\t// When there are too many tasks to repaint, it is better to repaint Gantt\r\n\t\t\t\t\tlet shouldRepaint = false;\r\n\t\t\t\t\tgantt.eachParent(function(parent){\r\n\t\t\t\t\t\tif (!shouldRepaint && parent.type === gantt.config.types.project) {\r\n\t\t\t\t\t\t\tconst initialDates = {start_date: parent.start_date, end_date: parent.end_date};\r\n\t\t\t\t\t\t\tgantt.resetProjectDates(parent);\r\n\t\t\t\t\t\t\tif (+initialDates.start_date !== +parent.start_date || +initialDates.end_date !== +parent.end_date){\r\n\t\t\t\t\t\t\t\tshouldRepaint = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},task.id);\r\n\t\t\t\t\tif (shouldRepaint){\r\n\t\t\t\t\t\tgantt.refreshData();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// If there are not so many parents especially if there are split tasks,\r\n\t\t\t\t\t// it is better to repaint individual tasks\r\n\t\t\t\t\tgantt.eachParent(function(parent){\r\n\t\t\t\t\t\tif (parent.type === gantt.config.types.project) {\r\n\t\t\t\t\t\t\tconst initialDates = {start_date: parent.start_date, end_date: parent.end_date};\r\n\t\t\t\t\t\t\tgantt.resetProjectDates(parent);\r\n\t\t\t\t\t\t\tif (+initialDates.start_date !== +parent.start_date || +initialDates.end_date !== +parent.end_date){\r\n\t\t\t\t\t\t\t\tgantt.refreshTask(parent.id);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},task.id);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar drag_id = taskId;\r\n\r\n\t\t\t\tgantt._init_task_timing(task);\r\n\r\n\t\t\t\tthis.clear_drag_state();\r\n\t\t\t\tgantt.updateTask(task.id);\r\n\t\t\t\tthis._fireEvent(\"after_finish\", drag.mode, [drag_id, drag.mode, e]);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\ton_mouse_up: function(e) {\r\n\r\n\t\t\tvar drag = this.drag;\r\n\t\t\tif (drag.mode && drag.id) {\r\n\t\t\t\tvar config = timeline.$getConfig();\r\n\t\t\t\t//drop\r\n\t\t\t\tvar task = gantt.getTask(drag.id);\r\n\t\t\t\tvar dragMultiple = this.dragMultiple;\r\n\r\n\t\t\t\tvar finalizingBulkMove = false;\r\n\t\t\t\tvar moveCount = 0;\r\n\t\t\t\tif (drag.mode === config.drag_mode.move) {\r\n\t\t\t\t\tif ((gantt.isSummaryTask(task) && config.drag_project) || (this._isMultiselect())) {\r\n\t\t\t\t\t\tfinalizingBulkMove = true;\r\n\t\t\t\t\t\tmoveCount = Object.keys(dragMultiple).length;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar doFinalize = function doFinalize(){\r\n\t\t\t\t\tif(finalizingBulkMove){\r\n\t\t\t\t\t\tfor (var i in dragMultiple) {\r\n\t\t\t\t\t\t\t// GS-1057: Don't call drag events for the dragged task as they will be called later\r\n\t\t\t\t\t\t\tif (dragMultiple[i].id != drag.id){\r\n\t\t\t\t\t\t\t\tthis._finalize_mouse_up(dragMultiple[i].id, config, dragMultiple[i], e);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._finalize_mouse_up(drag.id, config, drag, e);\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(finalizingBulkMove && moveCount > 10){// 10 - arbitrary threshold for bulk dnd at which we start doing complete repaint to refresh\r\n\t\t\t\t\tgantt.batchUpdate(function(){\r\n\t\t\t\t\t\tdoFinalize.call(this);\r\n\t\t\t\t\t}.bind(this));\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdoFinalize.call(this);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\tthis.clear_drag_state();\r\n\t\t},\r\n\t\t_get_drag_mode: function(className, el) {\r\n\t\t\tvar config = timeline.$getConfig();\r\n\t\t\tvar modes = config.drag_mode;\r\n\t\t\tvar classes = (className || \"\").split(\" \");\r\n\t\t\tvar classname = classes[0];\r\n\t\t\tvar drag = {mode: null, left: null};\r\n\t\t\tswitch (classname) {\r\n\t\t\t\tcase \"gantt_task_line\":\r\n\t\t\t\tcase \"gantt_task_content\":\r\n\t\t\t\t\tdrag.mode = modes.move;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"gantt_task_drag\":\r\n\t\t\t\t\tdrag.mode = modes.resize;\r\n\r\n\t\t\t\t\tvar dragProperty = el.getAttribute(\"data-bind-property\");\r\n\r\n\t\t\t\t\tif (dragProperty == \"start_date\") {\r\n\t\t\t\t\t\tdrag.left = true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdrag.left = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"gantt_task_progress_drag\":\r\n\t\t\t\t\tdrag.mode = modes.progress;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"gantt_link_control\":\r\n\t\t\t\tcase \"gantt_link_point\":\r\n\t\t\t\t\tdrag.mode = modes.ignore;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tdrag = null;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\treturn drag;\r\n\r\n\t\t},\r\n\r\n\t\t_start_dnd: function(e) {\r\n\t\t\tvar drag = this.drag = this.drag.start_drag;\r\n\t\t\tdelete drag.start_drag;\r\n\r\n\t\t\tvar cfg = timeline.$getConfig();\r\n\t\t\tvar id = drag.id;\r\n\r\n\t\t\tif (!cfg[\"drag_\" + drag.mode] || !gantt.callEvent(\"onBeforeDrag\", [id, drag.mode, e]) || !this._fireEvent(\"before_start\", drag.mode, [id, drag.mode, e])) {\r\n\t\t\t\tthis.clear_drag_state();\r\n\t\t\t} else {\r\n\t\t\t\tdelete drag.start_drag;\r\n\t\t\t\tvar task = gantt.getTask(id);\r\n\t\t\t\tif (gantt.isReadonly(task)){\r\n\t\t\t\t\tthis.clear_drag_state();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (this._isMultiselect()) {\r\n\t\t\t\t\t// for don't move selected tasks when drag unselected task\r\n\t\t\t\t\tvar selectedTasksIds = gantt.getSelectedTasks();\r\n\t\t\t\t\tif (selectedTasksIds.indexOf(drag.id) >= 0) {\r\n\t\t\t\t\t\thelpers.forEach(selectedTasksIds, gantt.bind(function(taskId) {\r\n\t\t\t\t\t\t\tvar selectedTask = gantt.getTask(taskId);\r\n\t\t\t\t\t\t\tif (gantt.isSummaryTask(selectedTask) && gantt.config.drag_project && drag.mode == cfg.drag_mode.move) {\r\n\t\t\t\t\t\t\t\tthis._addSubtasksToDragMultiple(selectedTask.id);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis.dragMultiple[taskId] = gantt.mixin({\r\n\t\t\t\t\t\t\t\tid: selectedTask.id,\r\n\t\t\t\t\t\t\t\tobj: gantt.copy(selectedTask)\r\n\t\t\t\t\t\t\t}, this.drag);\r\n\t\t\t\t\t\t}, this));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// for move unselected summary\r\n\t\t\t\tif (gantt.isSummaryTask(task) && gantt.config.drag_project && drag.mode == cfg.drag_mode.move) {\r\n\t\t\t\t\tthis._addSubtasksToDragMultiple(task.id);\r\n\t\t\t\t}\r\n\t\t\t\tgantt.callEvent(\"onTaskDragStart\", []);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\t_fireEvent: function(stage, mode, params) {\r\n\t\t\tgantt.assert(this._events[stage], \"Invalid stage:{\" + stage + \"}\");\r\n\r\n\t\t\tvar trigger = this._events[stage][mode];\r\n\r\n\t\t\tgantt.assert(trigger, \"Unknown after drop mode:{\" + mode + \"}\");\r\n\t\t\tgantt.assert(params, \"Invalid event arguments\");\r\n\r\n\r\n\t\t\tif (!gantt.checkEvent(trigger))\r\n\t\t\t\treturn true;\r\n\r\n\t\t\treturn gantt.callEvent(trigger, params);\r\n\t\t},\r\n\r\n\t\tround_task_dates: function(task) {\r\n\t\t\tvar drag_state = this.drag;\r\n\t\t\tvar config = timeline.$getConfig();\r\n\t\t\tif (!drag_state) {\r\n\t\t\t\tdrag_state = {mode: config.drag_mode.move};\r\n\t\t\t}\r\n\t\t\tthis._fix_dnd_scale_time(task, drag_state);\r\n\t\t},\r\n\t\tdestructor: function() {\r\n\t\t\tthis._domEvents.detachAll();\r\n\t\t},\r\n\t\t_isMultiselect: function() {\r\n\t\t\treturn gantt.config.drag_multiple && !!(gantt.getSelectedTasks && gantt.getSelectedTasks().length > 0);\r\n\t\t},\r\n\t\t_addSubtasksToDragMultiple: function(summaryId) {\r\n\t\t\tgantt.eachTask(function(child) {\r\n\t\t\t\tthis.dragMultiple[child.id] = gantt.mixin({\r\n\t\t\t\t\tid: child.id,\r\n\t\t\t\t\tobj: gantt.copy(child)\r\n\t\t\t\t}, this.drag);\r\n\t\t\t}, summaryId, this);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction initTaskDND() {\r\n\tvar _tasks_dnd;\r\n\treturn {\r\n\t\textend: function(timeline) {\r\n\t\t\ttimeline.roundTaskDates = function(task) {\r\n\t\t\t\t_tasks_dnd.round_task_dates(task);\r\n\t\t\t};\r\n\r\n\t\t},\r\n\t\tinit: function(timeline, gantt) {\r\n\t\t\t_tasks_dnd = createTaskDND(timeline, gantt);\r\n\t\t\t// TODO: entry point for touch handlers, move touch to timeline\r\n\t\t\ttimeline._tasks_dnd = _tasks_dnd;\r\n\t\t\treturn _tasks_dnd.init(gantt);\r\n\t\t},\r\n\t\tdestructor: function() {\r\n\t\t\tif (_tasks_dnd) {\r\n\t\t\t\t_tasks_dnd.destructor();\r\n\t\t\t\t_tasks_dnd = null;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default {\r\n\tcreateTaskDND: initTaskDND\r\n};","import * as domHelpers from \"../utils/dom_helpers\";\r\n\r\nvar initLinksDND = function(timeline, gantt) {\r\n\tvar _link_landing,\r\n\t\t_link_target_task,\r\n\t\t_link_target_task_start,\r\n\t\t_link_source_task,\r\n\t\t_link_source_task_start,\r\n\t\tmarkerDefaultOffset = 10,\r\n\t\tscrollDefaultSize = 18;\r\n\r\n\tfunction getDndState(){\r\n\t\treturn {\r\n\t\t\tlink_source_id : _link_source_task,\r\n\t\t\tlink_target_id : _link_target_task,\r\n\t\t\tlink_from_start : _link_source_task_start,\r\n\t\t\tlink_to_start : _link_target_task_start,\r\n\t\t\tlink_landing_area : _link_landing\r\n\t\t};\r\n\t}\r\n\r\n\tvar services = gantt.$services;\r\n\r\n\tvar state = services.getService(\"state\");\r\n\tvar DnD = services.getService(\"dnd\");\r\n\r\n\tstate.registerProvider(\"linksDnD\", getDndState);\r\n\r\n\tvar start_marker = \"task_start_date\",\r\n\t\tend_marker = \"task_end_date\",\r\n\t\tlink_edge_marker = \"gantt_link_point\",\r\n\t\tlink_landing_hover_area = \"gantt_link_control\";\r\n\r\n\tvar dnd = new DnD(timeline.$task_bars, {\r\n\t\tsensitivity : 0,\r\n\t\tupdates_per_second : 60,\r\n\t\tmousemoveContainer: gantt.$root,\r\n\t\tselector: \".\" + link_edge_marker,\r\n\t\tpreventDefault: true\r\n\t});\r\n\r\n\tdnd.attachEvent(\"onBeforeDragStart\", gantt.bind(function(obj,e) {\r\n\t\tvar target = (e.target||e.srcElement);\r\n\t\tresetDndState();\r\n\t\tif(gantt.getState(\"tasksDnd\").drag_id)\r\n\t\t\treturn false;\r\n\r\n\t\tif(domHelpers.locateClassName(target, link_edge_marker)){\r\n\t\t\tif(domHelpers.locateClassName(target, start_marker))\r\n\t\t\t\t_link_source_task_start = true;\r\n\r\n\t\t\tvar sid = gantt.locate(e);\r\n\t\t\t_link_source_task = sid;\r\n\r\n\t\t\tvar t = gantt.getTask(sid);\r\n\t\t\tif(gantt.isReadonly(t)){\r\n\t\t\t\tresetDndState();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tthis._dir_start = {\r\n\t\t\t\tx: dnd.config.original_element_sizes.x + dnd.config.original_element_sizes.width/2,\r\n\t\t\t\ty: dnd.config.original_element_sizes.y + dnd.config.original_element_sizes.height/2\r\n\t\t\t};\r\n\r\n\t\t\treturn true;\r\n\t\t}else{\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t}, this));\r\n\r\n\tdnd.attachEvent(\"onAfterDragStart\", gantt.bind(function(obj,e) {\r\n\t\tif(gantt.config.touch) {\r\n\t\t\tgantt.refreshData();\r\n\t\t}\r\n\t\tupdateMarkedHtml(dnd.config.marker);\r\n\t}, this));\r\n\r\n\tfunction getVieportSize(){\r\n\t\tvar root = gantt.$root;\r\n\t\treturn { right: root.offsetWidth, bottom: root.offsetHeight };\r\n\t}\r\n\tfunction getMarkerSize (marker){\r\n\t\tvar width = 0, height = 0;\r\n\t\tif(marker){\r\n\t\t\twidth = marker.offsetWidth || 0;\r\n\t\t\theight = marker.offsetHeight || 0;\r\n\t\t}\r\n\t\treturn { width: width, height: height };\r\n\t}\r\n\r\n\tfunction getPosition(e, marker){\r\n\t\tvar oldPos = dnd.getPosition(e);\r\n\r\n\t\tvar markerSize = getMarkerSize(marker);\r\n\t\tvar viewportSize = getVieportSize();\r\n\r\n\t\tvar offsetX = gantt.config.tooltip_offset_x || markerDefaultOffset;\r\n\t\tvar offsetY = gantt.config.tooltip_offset_y || markerDefaultOffset;\r\n\r\n\t\tvar scrollSize = gantt.config.scroll_size || scrollDefaultSize;\r\n\r\n\t\t// GS-1315: Add offset if there are elements above Gantt\r\n\t\tvar ganttOffsetY = gantt.$container.getBoundingClientRect().y + window.scrollY;\r\n\r\n\t\tvar position = {\r\n\t\t\ty: oldPos.y + offsetY,\r\n\t\t\tx: oldPos.x + offsetX,\r\n\t\t\tbottom: oldPos.y + markerSize.height + offsetY + scrollSize,\r\n\t\t\tright: oldPos.x + markerSize.width + offsetX + scrollSize\r\n\t\t};\r\n\r\n\t\tif(position.bottom > viewportSize.bottom + ganttOffsetY){\r\n\t\t\tposition.y = viewportSize.bottom + ganttOffsetY - markerSize.height - offsetY;\r\n\t\t}\r\n\r\n\t\tif(position.right > viewportSize.right){\r\n\t\t\tposition.x = viewportSize.right - markerSize.width - offsetX;\r\n\t\t}\r\n\t\treturn position;\r\n\t}\r\n\r\n\tdnd.attachEvent(\"onDragMove\", gantt.bind(function(obj,e, actualTarget) {\r\n\t\tvar dd = dnd.config;\r\n\t\tvar pos = getPosition(e, dd.marker);\r\n\t\tadvanceMarker(dd.marker, pos);\r\n\t\tvar landing = !!domHelpers.locateClassName(e, link_landing_hover_area);\r\n\r\n\t\tvar prevTarget = _link_target_task;\r\n\t\tvar prevLanding = _link_landing;\r\n\t\tvar prevToStart = _link_target_task_start;\r\n\r\n\t\tlet to_start = true;\r\n\t\tlet targ;\r\n\t\tif (e.target.shadowRoot && actualTarget){\r\n\t\t\ttarg = actualTarget;\r\n\t\t} else {\r\n\t\t\ttarg = gantt.locate(e);\r\n\t\t}\r\n\r\n\t\t// can drag and drop link to another gantt on the page, such links are not supported\r\n\t\tvar eventTarget = domHelpers.getTargetNode(e);\r\n\r\n\t\tvar sameGantt = domHelpers.isChildOf(eventTarget, gantt.$root);\r\n\t\tif(!sameGantt){\r\n\t\t\tlanding = false;\r\n\t\t\ttarg = null;\r\n\t\t}\r\n\r\n\t\tif(landing){\r\n\t\t\t//refreshTask\r\n\t\t\tto_start = !domHelpers.locateClassName(e, end_marker);\r\n\t\t\tlanding = !!targ;\r\n\t\t}\r\n\r\n\t\t_link_target_task = targ;\r\n\t\t_link_landing = landing;\r\n\t\t_link_target_task_start = to_start;\r\n\r\n\t\tif(landing){\r\n\r\n\t\t\tvar node = domHelpers.locateClassName(e, link_landing_hover_area);\r\n\t\t\r\n\t\t\tconst point = node.querySelector(`.${link_edge_marker}`);\r\n\t\t\tif(point){\r\n\t\t\t\tconst absCoords = domHelpers.getRelativeNodePosition(point, timeline.$task_bg);\r\n\t\t\t\tthis._dir_end = {\r\n\t\t\t\t\tx: absCoords.x + point.offsetWidth/2,\r\n\t\t\t\t\ty: absCoords.y + point.offsetHeight/2\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t}else{\r\n\t\t\tthis._dir_end = domHelpers.getRelativeEventPosition(e, timeline.$task_data);\r\n\t\t\tif(gantt.env.isEdge){ // to fix margin collapsing\r\n\t\t\t\tthis._dir_end.y += window.scrollY;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar targetChanged = !(prevLanding == landing && prevTarget == targ && prevToStart == to_start);\r\n\t\tif(targetChanged){\r\n\t\t\tif(prevTarget)\r\n\t\t\t\tgantt.refreshTask(prevTarget, false);\r\n\t\t\tif(targ)\r\n\t\t\t\tgantt.refreshTask(targ, false);\r\n\t\t}\r\n\r\n\t\tif(targetChanged){\r\n\t\t\tupdateMarkedHtml(dd.marker);\r\n\t\t}\r\n\r\n\t\tshowDirectingLine(this._dir_start.x, this._dir_start.y, this._dir_end.x, this._dir_end.y);\r\n\r\n\t\treturn true;\r\n\t}, this));\r\n\r\n\r\n\tdnd.attachEvent(\"onDragEnd\", gantt.bind(function() {\r\n\t\tvar drag = getDndState();\r\n\r\n\t\tif(drag.link_source_id && drag.link_target_id && drag.link_source_id != drag.link_target_id){\r\n\t\t\tvar type = gantt._get_link_type(drag.link_from_start, drag.link_to_start);\r\n\r\n\t\t\tvar link = {source : drag.link_source_id, target: drag.link_target_id, type:type};\r\n\t\t\tif(link.type && gantt.isLinkAllowed(link)) {\r\n\t\t\t\tif(gantt.callEvent(\"onLinkCreated\", [link])){\r\n\t\t\t\t\tgantt.addLink(link);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tresetDndState();\r\n\r\n\t\tif(gantt.config.touch) {\r\n\t\t\tgantt.refreshData();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (drag.link_source_id)\r\n\t\t\t\tgantt.refreshTask(drag.link_source_id, false);\r\n\t\t\tif (drag.link_target_id)\r\n\t\t\t\tgantt.refreshTask(drag.link_target_id, false);\r\n\t\t}\r\n\t\tremoveDirectionLine();\r\n\t}, this));\r\n\r\n\tfunction updateMarkedHtml(marker){\r\n\t\tvar link = getDndState();\r\n\r\n\t\tvar css = [\"gantt_link_tooltip\"];\r\n\t\tif(link.link_source_id && link.link_target_id){\r\n\t\t\tif(gantt.isLinkAllowed(link.link_source_id, link.link_target_id, link.link_from_start, link.link_to_start)){\r\n\t\t\t\tcss.push(\"gantt_allowed_link\");\r\n\t\t\t}else{\r\n\t\t\t\tcss.push(\"gantt_invalid_link\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar className = gantt.templates.drag_link_class(link.link_source_id, link.link_from_start, link.link_target_id, link.link_to_start);\r\n\t\tif(className)\r\n\t\t\tcss.push(className);\r\n\r\n\t\tvar html = \"<div class='\"+className+ \"'>\" +\r\n\t\t\tgantt.templates.drag_link(link.link_source_id, link.link_from_start, link.link_target_id, link.link_to_start) +\r\n\t\t\t\"</div>\";\r\n\t\tmarker.innerHTML = html;\r\n\t}\r\n\r\n\tfunction advanceMarker(marker, pos){\r\n\t\tmarker.style.left = pos.x + \"px\";\r\n\t\tmarker.style.top = pos.y + \"px\";\r\n\t}\r\n\r\n\tfunction resetDndState(){\r\n\t\t_link_source_task =\r\n\t\t\t_link_source_task_start =\r\n\t\t\t\t_link_target_task = null;\r\n\t\t_link_target_task_start = true;\r\n\t}\r\n\tfunction showDirectingLine(s_x, s_y, e_x, e_y){\r\n\t\tvar div = getDirectionLine();\r\n\r\n\t\tvar link = getDndState();\r\n\r\n\t\tvar css = [\"gantt_link_direction\"];\r\n\t\tif(gantt.templates.link_direction_class){\r\n\t\t\tcss.push(gantt.templates.link_direction_class(link.link_source_id, link.link_from_start, link.link_target_id, link.link_to_start));\r\n\t\t}\r\n\r\n\t\tvar dist =Math.sqrt( (Math.pow(e_x - s_x, 2)) + (Math.pow(e_y - s_y, 2)) );\r\n\t\tdist = Math.max(0, dist - 3);\r\n\t\tif(!dist)\r\n\t\t\treturn;\r\n\r\n\t\tdiv.className = css.join(\" \");\r\n\t\tvar tan = (e_y - s_y)/(e_x - s_x),\r\n\t\t\tangle = Math.atan(tan);\r\n\r\n\t\tif(coordinateCircleQuarter(s_x, e_x, s_y, e_y) == 2){\r\n\t\t\tangle += Math.PI;\r\n\t\t}else if(coordinateCircleQuarter(s_x, e_x, s_y, e_y) == 3){\r\n\t\t\tangle -= Math.PI;\r\n\t\t}\r\n\r\n\r\n\r\n\t\tvar sin = Math.sin(angle),\r\n\t\t\tcos = Math.cos(angle),\r\n\t\t\ttop = Math.round(s_y),\r\n\t\t\tleft = Math.round(s_x);\r\n\r\n\r\n\t\tvar style = [\r\n\t\t\t\"-webkit-transform: rotate(\"+angle+\"rad)\",\r\n\t\t\t\"-moz-transform: rotate(\"+angle+\"rad)\",\r\n\t\t\t\"-ms-transform: rotate(\"+angle+\"rad)\",\r\n\t\t\t\"-o-transform: rotate(\"+angle+\"rad)\",\r\n\t\t\t\"transform: rotate(\"+angle+\"rad)\",\r\n\t\t\t\"width:\" + Math.round(dist) + \"px\"\r\n\t\t];\r\n\r\n\t\tif(window.navigator.userAgent.indexOf(\"MSIE 8.0\") != -1){\r\n\t\t\t//ms-filter breaks styles in ie9, so add it only for 8th\r\n\t\t\tstyle.push(\"-ms-filter: \\\"\" + ieTransform(sin, cos) + \"\\\"\");\r\n\r\n\t\t\tvar shiftLeft = Math.abs(Math.round(s_x - e_x)),\r\n\t\t\t\tshiftTop = Math.abs(Math.round(e_y - s_y));\r\n\t\t\t//fix rotation axis\r\n\t\t\tswitch(coordinateCircleQuarter(s_x, e_x, s_y, e_y)){\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\ttop -= shiftTop;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tleft -= shiftLeft;\r\n\t\t\t\t\ttop -= shiftTop;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tleft -= shiftLeft;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tstyle.push(\"top:\" +  top + \"px\");\r\n\t\tstyle.push(\"left:\" +  left + \"px\");\r\n\r\n\t\tdiv.style.cssText = style.join(\";\");\r\n\t}\r\n\r\n\tfunction ieTransform(sin, cos){\r\n\t\treturn \"progid:DXImageTransform.Microsoft.Matrix(\"+\r\n\t\t\t\"M11 = \"+cos+\",\"+\r\n\t\t\t\"M12 = -\"+sin+\",\"+\r\n\t\t\t\"M21 = \"+sin+\",\"+\r\n\t\t\t\"M22 = \"+cos+\",\"+\r\n\t\t\t\"SizingMethod = 'auto expand'\"+\r\n\t\t\")\";\r\n\t}\r\n\tfunction coordinateCircleQuarter(sX, eX, sY, eY){\r\n\t\tif(eX >= sX){\r\n\t\t\tif(eY <= sY){\r\n\t\t\t\treturn 1;\r\n\t\t\t}else{\r\n\t\t\t\treturn 4;\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tif(eY <= sY){\r\n\t\t\t\treturn 2;\r\n\t\t\t}else{\r\n\t\t\t\treturn 3;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\tfunction getDirectionLine(){\r\n\t\tif(!dnd._direction || !dnd._direction.parentNode){\r\n\t\t\tdnd._direction = document.createElement(\"div\");\r\n\t\t\ttimeline.$task_links.appendChild(dnd._direction);\r\n\t\t}\r\n\t\treturn dnd._direction;\r\n\t}\r\n\tfunction removeDirectionLine(){\r\n\t\tif(dnd._direction){\r\n\t\t\tif (dnd._direction.parentNode)\t//the event line can be detached because of data refresh\r\n\t\t\t\tdnd._direction.parentNode.removeChild(dnd._direction);\r\n\r\n\t\t\tdnd._direction = null;\r\n\t\t}\r\n\t}\r\n\tgantt.attachEvent(\"onGanttRender\", gantt.bind(function() {\r\n\t\tif(dnd._direction){\r\n\t\t\tshowDirectingLine(this._dir_start.x, this._dir_start.y, this._dir_end.x, this._dir_end.y);\r\n\t\t}\r\n\t}, this));\r\n};\r\n\r\nexport default {\r\n\tcreateLinkDND: function(){\r\n\t\treturn {\r\n\t\t\tinit: initLinksDND\r\n\t\t};\r\n\t}\r\n};","import * as utils from \"../../../utils/utils\";\r\nimport taskDnD from \"./tasks_dnd\";\r\nimport linkDnD from \"./links_dnd\";\r\nimport * as domHelpers from \"../utils/dom_helpers\";\r\nimport MouseDelegates from \"../mouse_event_container\";\r\n\r\nvar initializer = (function(){\r\n\treturn function(gantt){\r\n\t\tvar services = gantt.$services;\r\n\t\treturn {\r\n\t\t\tonCreated: function (timeline) {\r\n\t\t\t\tvar config = timeline.$config;\r\n\t\t\t\tconfig.bind = utils.defined(config.bind) ? config.bind : \"task\";\r\n\t\t\t\tconfig.bindLinks = utils.defined(config.bindLinks) ? config.bindLinks : \"link\";\r\n\r\n\t\t\t\ttimeline._linksDnD = linkDnD.createLinkDND();\r\n\t\t\t\ttimeline._tasksDnD = taskDnD.createTaskDND();\r\n\t\t\t\ttimeline._tasksDnD.extend(timeline);\r\n\r\n\t\t\t\tthis._mouseDelegates = MouseDelegates(gantt);\r\n\t\t\t},\r\n\t\t\tonInitialized: function (timeline) {\r\n\t\t\t\tthis._attachDomEvents(gantt);\r\n\r\n\t\t\t\tthis._attachStateProvider(gantt, timeline);\r\n\r\n\t\t\t\ttimeline._tasksDnD.init(timeline, gantt);\r\n\t\t\t\ttimeline._linksDnD.init(timeline, gantt);\r\n\r\n\t\t\t\tif(timeline.$config.id == \"timeline\"){\r\n\t\t\t\t\tthis.extendDom(timeline);\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\t\t\tonDestroyed: function (timeline) {\r\n\t\t\t\tthis._clearDomEvents(gantt);\r\n\t\t\t\tthis._clearStateProvider(gantt);\r\n\t\t\t\tif (timeline._tasksDnD) {\r\n\t\t\t\t\ttimeline._tasksDnD.destructor();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\textendDom: function(timeline){\r\n\t\t\t\tgantt.$task = timeline.$task;\r\n\t\t\t\tgantt.$task_scale = timeline.$task_scale;\r\n\t\t\t\tgantt.$task_data = timeline.$task_data;\r\n\t\t\t\tgantt.$task_bg = timeline.$task_bg;\r\n\t\t\t\tgantt.$task_links = timeline.$task_links;\r\n\t\t\t\tgantt.$task_bars = timeline.$task_bars;\r\n\t\t\t},\r\n\r\n\t\t\t_clearDomEvents: function(){\r\n\t\t\t\tthis._mouseDelegates.destructor();\r\n\t\t\t\tthis._mouseDelegates = null;\r\n\t\t\t},\r\n\r\n\t\t\t_attachDomEvents: function(gantt){\r\n\t\t\t\tfunction _delete_link_handler(id, e) {\r\n\t\t\t\t\tif (id && this.callEvent(\"onLinkDblClick\", [id, e])) {\r\n\r\n\t\t\t\t\t\tvar link = this.getLink(id);\r\n\t\t\t\t\t\tif (this.isReadonly(link)) return;\r\n\r\n\t\t\t\t\t\tvar title = \"\";\r\n\t\t\t\t\t\tvar question = this.locale.labels.link + \" \" + this.templates.link_description(this.getLink(id)) + \" \" + this.locale.labels.confirm_link_deleting;\r\n\r\n\t\t\t\t\t\twindow.setTimeout(function () {\r\n\t\t\t\t\t\t\tgantt._delete_link_confirm({\r\n\t\t\t\t\t\t\t\tlink: link,\r\n\t\t\t\t\t\t\t\tmessage: question,\r\n\t\t\t\t\t\t\t\ttitle: title,\r\n\t\t\t\t\t\t\t\tcallback: function () {\r\n\t\t\t\t\t\t\t\t\tgantt.deleteLink(id);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}, (this.config.touch ? 300 : 1));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_task_link\", gantt.bind(function (e, trg) {\r\n\t\t\t\t\tvar id = this.locate(e, this.config.link_attribute);\r\n\t\t\t\t\tif (id) {\r\n\t\t\t\t\t\tthis.callEvent(\"onLinkClick\", [id, e]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, gantt), this.$task);\r\n\r\n\t\t\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_scale_cell\", gantt.bind(function (e, trg) {\r\n\t\t\t\t\tvar pos = domHelpers.getRelativeEventPosition(e, gantt.$task_data);\r\n\t\t\t\t\tvar date = gantt.dateFromPos(pos.x);\r\n\t\t\t\t\tvar coll = Math.floor(gantt.columnIndexByDate(date));\r\n\r\n\t\t\t\t\tvar coll_date = gantt.getScale().trace_x[coll];\r\n\r\n\t\t\t\t\tgantt.callEvent(\"onScaleClick\", [e, coll_date]);\r\n\t\t\t\t}, gantt), this.$task);\r\n\r\n\t\t\t\tthis._mouseDelegates.delegate(\"doubleclick\", \"gantt_task_link\", gantt.bind(function (e, id, trg) {\r\n\t\t\t\t\tvar id = this.locate(e, gantt.config.link_attribute);\r\n\t\t\t\t\t_delete_link_handler.call(this, id, e);\r\n\t\t\t\t}, gantt), this.$task);\r\n\r\n\t\t\t\tthis._mouseDelegates.delegate(\"doubleclick\", \"gantt_link_point\", gantt.bind(function (e, id, trg) {\r\n\t\t\t\t\tvar id = this.locate(e),\r\n\t\t\t\t\t\ttask = this.getTask(id);\r\n\r\n\t\t\t\t\tvar link = null;\r\n\t\t\t\t\tif (trg.parentNode && domHelpers.getClassName(trg.parentNode)) {\r\n\t\t\t\t\t\tif (domHelpers.getClassName(trg.parentNode).indexOf(\"_left\") > -1) {\r\n\t\t\t\t\t\t\tlink = task.$target[0];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tlink = task.$source[0];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (link)\r\n\t\t\t\t\t\t_delete_link_handler.call(this, link, e);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}, gantt), this.$task);\r\n\t\t\t},\r\n\r\n\t\t\t_attachStateProvider: function(gantt, timeline){\r\n\t\t\t\tvar self = timeline;\r\n\t\t\t\tvar state = services.getService(\"state\");\r\n\t\t\t\tstate.registerProvider(\"tasksTimeline\", function(){\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tscale_unit: self._tasks ? self._tasks.unit : undefined,\r\n\t\t\t\t\t\tscale_step:  self._tasks ? self._tasks.step  : undefined\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\t_clearStateProvider: function(){\r\n\t\t\t\tvar state = services.getService(\"state\");\r\n\t\t\t\tstate.unregisterProvider(\"tasksTimeline\");\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\r\n})();\r\n\r\nexport default initializer;","import * as domHelpers from \"./utils/dom_helpers\";\r\n\r\nvar initializer = (function() {\r\n\treturn function (gantt) {\r\n\t\treturn {\r\n\r\n\t\t\tgetVerticalScrollbar: function(){\r\n\t\t\t\treturn gantt.$ui.getView(\"scrollVer\");\r\n\t\t\t},\r\n\t\t\tgetHorizontalScrollbar: function(){\r\n\t\t\t\treturn gantt.$ui.getView(\"scrollHor\");\r\n\t\t\t},\r\n\r\n\t\t\t_legacyGridResizerClass: function(layout){\r\n\t\t\t\tvar resizers = layout.getCellsByType(\"resizer\");\r\n\t\t\t\tfor(var i = 0; i < resizers.length; i++){\r\n\t\t\t\t\tvar r = resizers[i];\r\n\t\t\t\t\tvar gridResizer = false;\r\n\r\n\t\t\t\t\tvar prev = r.$parent.getPrevSibling(r.$id);\r\n\t\t\t\t\tif(prev && prev.$config && prev.$config.id === \"grid\"){\r\n\t\t\t\t\t\tgridResizer= true;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tvar next = r.$parent.getNextSibling(r.$id);\r\n\t\t\t\t\t\tif(next && next.$config && next.$config.id === \"grid\"){\r\n\t\t\t\t\t\t\tgridResizer= true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(gridResizer){\r\n\t\t\t\t\t\tr.$config.css = (r.$config.css ? r.$config.css + \" \" : \"\") + \"gantt_grid_resize_wrap\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tonCreated: function(layout) {\r\n\t\t\t\tvar first = true;\r\n\r\n\t\t\t\tthis._legacyGridResizerClass(layout);\r\n\r\n\t\t\t\tlayout.attachEvent(\"onBeforeResize\", function() {\r\n\t\t\t\t\tvar mainTimeline = gantt.$ui.getView(\"timeline\");\r\n\t\t\t\t\tif (mainTimeline)\r\n\t\t\t\t\t\tmainTimeline.$config.hidden = mainTimeline.$parent.$config.hidden = !gantt.config.show_chart;\r\n\r\n\t\t\t\t\tvar mainGrid = gantt.$ui.getView(\"grid\");\r\n\r\n\t\t\t\t\tif(!mainGrid)\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tvar colsWidth = mainGrid._getColsTotalWidth();\r\n\t\t\t\t\tvar hideGrid = !gantt.config.show_grid || !gantt.config.grid_width || colsWidth === 0;\r\n\t\t\t\t\tif (first && !hideGrid && colsWidth !== false){\r\n\t\t\t\t\t\t\tgantt.config.grid_width = colsWidth;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmainGrid.$config.hidden = mainGrid.$parent.$config.hidden = hideGrid;\r\n\r\n\t\t\t\t\tif (!mainGrid.$config.hidden) {\r\n\t\t\t\t\t\t/* restrict grid width due to min_width, max_width, min_grid_column_width */\r\n\t\t\t\t\t\tvar grid_limits = mainGrid._getGridWidthLimits();\r\n\t\t\t\t\t\tif (grid_limits[0] && gantt.config.grid_width < grid_limits[0])\r\n\t\t\t\t\t\t\tgantt.config.grid_width = grid_limits[0];\r\n\t\t\t\t\t\tif (grid_limits[1] && gantt.config.grid_width > grid_limits[1])\r\n\t\t\t\t\t\t\tgantt.config.grid_width = grid_limits[1];\r\n\t\t\t\t\t\tif (mainTimeline && gantt.config.show_chart){\r\n\r\n\t\t\t\t\t\t\tmainGrid.$config.width = gantt.config.grid_width - 1;\r\n\r\n\t\t\t\t\t\t\t// GS-1314: Don't let the non-scrollable grid to be larger than the container with the correct width\r\n\t\t\t\t\t\t\tif (!mainGrid.$config.scrollable && mainGrid.$config.scrollY && gantt.$root.offsetWidth){\r\n\t\t\t\t\t\t\t\tvar ganttContainerWidth = mainGrid.$gantt.$layout.$container.offsetWidth;\r\n\t\t\t\t\t\t\t\tvar verticalScrollbar = gantt.$ui.getView(mainGrid.$config.scrollY);\r\n\t\t\t\t\t\t\t\tvar verticalScrollbarWidth = verticalScrollbar.$config.width;\r\n\r\n\t\t\t\t\t\t\t\t// GS-2488: to prevent grid from occupying the whole gantt container(timeline will be disabled) \r\n\t\t\t\t\t\t\t\t// need to leave min width for timeline\r\n\t\t\t\t\t\t\t\tvar gridOverflow = ganttContainerWidth - (mainGrid.$config.width + verticalScrollbarWidth) - 4;\r\n\t\t\t\t\t\t\t\tif (gridOverflow < 0){\r\n\t\t\t\t\t\t\t\t\tmainGrid.$config.width += gridOverflow;\r\n\t\t\t\t\t\t\t\t\tgantt.config.grid_width += gridOverflow;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (!first) {\r\n\t\t\t\t\t\t\t\tif (mainTimeline && !domHelpers.isChildOf(mainTimeline.$task, layout.$view)) {\r\n\t\t\t\t\t\t\t\t\t// timeline is being displayed after being not visible, reset grid with from full screen\r\n\t\t\t\t\t\t\t\t\tif (!mainGrid.$config.original_grid_width) {\r\n\t\t\t\t\t\t\t\t\t\tvar skinSettings = gantt.skins[gantt.skin];\r\n\t\t\t\t\t\t\t\t\t\tif(skinSettings && skinSettings.config && skinSettings.config.grid_width){\r\n\t\t\t\t\t\t\t\t\t\t\tmainGrid.$config.original_grid_width =  skinSettings.config.grid_width;\r\n\t\t\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t\t\tmainGrid.$config.original_grid_width = 0;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tgantt.config.grid_width = mainGrid.$config.original_grid_width;\r\n\t\t\t\t\t\t\t\t\tmainGrid.$parent.$config.width = gantt.config.grid_width;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tmainGrid.$parent._setContentSize(mainGrid.$config.width, null);\r\n\t\t\t\t\t\t\t\t\tgantt.$layout._syncCellSizes(mainGrid.$parent.$config.group, {value: gantt.config.grid_width, isGravity: false});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tmainGrid.$parent.$config.width = gantt.config.grid_width;\r\n\t\t\t\t\t\t\t\tif (mainGrid.$parent.$config.group) {\r\n\t\t\t\t\t\t\t\t\tgantt.$layout._syncCellSizes(mainGrid.$parent.$config.group, {value: mainGrid.$parent.$config.width, isGravity: false});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (mainTimeline && domHelpers.isChildOf(mainTimeline.$task, layout.$view)) {\r\n\t\t\t\t\t\t\t\t// hiding timeline, remember grid with to restore it when timeline is displayed again\r\n\t\t\t\t\t\t\t\tmainGrid.$config.original_grid_width = gantt.config.grid_width;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (!first) {\r\n\t\t\t\t\t\t\t\tmainGrid.$parent.$config.width = 0;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfirst = false;\r\n\t\t\t\t});\r\n\t\t\t\tthis._initScrollStateEvents(layout);\r\n\t\t\t},\r\n\r\n\t\t\t_initScrollStateEvents: function(layout) {\r\n\t\t\t\tgantt._getVerticalScrollbar = this.getVerticalScrollbar;\r\n\t\t\t\tgantt._getHorizontalScrollbar = this.getHorizontalScrollbar;\r\n\r\n\t\t\t\tvar vertical = this.getVerticalScrollbar();\r\n\t\t\t\tvar horizontal = this.getHorizontalScrollbar();\r\n\t\t\t\tif (vertical) {\r\n\t\t\t\t\tvertical.attachEvent(\"onScroll\", function(oldPos, newPos, dir){\r\n\t\t\t\t\t\tvar scrollState = gantt.getScrollState();\r\n\t\t\t\t\t\tgantt.callEvent(\"onGanttScroll\", [scrollState.x, oldPos, scrollState.x, newPos]);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tif (horizontal) {\r\n\t\t\t\t\thorizontal.attachEvent(\"onScroll\", function(oldPos, newPos, dir){\r\n\t\t\t\t\t\tvar scrollState = gantt.getScrollState();\r\n\t\t\t\t\t\tgantt.callEvent(\"onGanttScroll\", [oldPos, scrollState.y, newPos, scrollState.y]);\r\n\r\n\t\t\t\t\t\t// if the grid doesn't fit the width, scroll the row container\r\n\t\t\t\t\t\tvar grid = gantt.$ui.getView(\"grid\");\r\n\t\t\t\t\t\tif (grid && grid.$grid_data && !grid.$config.scrollable){\r\n\t\t\t\t\t\t\tgrid.$grid_data.style.left = grid.$grid.scrollLeft + \"px\";\r\n\t\t\t\t\t\t\tgrid.$grid_data.scrollLeft = grid.$grid.scrollLeft;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlayout.attachEvent(\"onResize\", function(){\r\n\t\t\t\t\tif (vertical && !gantt.$scroll_ver){\r\n\t\t\t\t\t\tgantt.$scroll_ver = vertical.$scroll_ver;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (horizontal && !gantt.$scroll_hor){\r\n\t\t\t\t\t\tgantt.$scroll_hor = horizontal.$scroll_hor;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\t_findGridResizer: function(layout, grid){\r\n\t\t\t\tvar resizers = layout.getCellsByType(\"resizer\");\r\n\r\n\t\t\t\tvar gridFirst = true;\r\n\t\t\t\tvar gridResizer;\r\n\t\t\t\tfor(var i = 0; i < resizers.length; i++){\r\n\t\t\t\t\tvar res = resizers[i];\r\n\t\t\t\t\tres._getSiblings();\r\n\t\t\t\t\tvar prev = res._behind;\r\n\t\t\t\t\tvar next = res._front;\r\n\t\t\t\t\tif(prev && prev.$content === grid || (prev.isChild && prev.isChild(grid))){\r\n\t\t\t\t\t\tgridResizer = res;\r\n\t\t\t\t\t\tgridFirst = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}else if(next && next.$content === grid || (next.isChild && next.isChild(grid))){\r\n\t\t\t\t\t\tgridResizer = res;\r\n\t\t\t\t\t\tgridFirst = false;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn {\r\n\t\t\t\t\tresizer: gridResizer,\r\n\t\t\t\t\tgridFirst: gridFirst\r\n\t\t\t\t};\r\n\t\t\t},\r\n\r\n\t\t\tonInitialized: function (layout) {\r\n\t\t\t\tvar grid = gantt.$ui.getView(\"grid\");\r\n\r\n\t\t\t\tvar resizeInfo = this._findGridResizer(layout, grid);\r\n\r\n\t\t\t\t// expose grid resize events\r\n\t\t\t\tif(resizeInfo.resizer){\r\n\t\t\t\t\tvar gridFirst = resizeInfo.gridFirst,\r\n\t\t\t\t\t\tnext = resizeInfo.resizer;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tif(next.$config.mode !== \"x\"){\r\n\t\t\t\t\t\treturn;// track only horizontal resize\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar initialWidth;\r\n\t\t\t\t\tnext.attachEvent(\"onResizeStart\", function(prevCellWidth, nextCellWidth){\r\n\r\n\t\t\t\t\t\tvar grid = gantt.$ui.getView(\"grid\");\r\n\t\t\t\t\t\tvar viewCell = grid ? grid.$parent : null;\r\n\t\t\t\t\t\tif(viewCell){\r\n\t\t\t\t\t\t\tvar limits = grid._getGridWidthLimits();\r\n\r\n\t\t\t\t\t\t\t// min grid width is defined by min widths of its columns, unless grid has horizontal scroll\r\n\t\t\t\t\t\t\tif(!grid.$config.scrollable)\r\n\t\t\t\t\t\t\t\tviewCell.$config.minWidth = limits[0];\r\n\r\n\t\t\t\t\t\t\tviewCell.$config.maxWidth = limits[1];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tinitialWidth = gridFirst ? prevCellWidth : nextCellWidth;\r\n\t\t\t\t\t\treturn gantt.callEvent(\"onGridResizeStart\", [initialWidth]);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tnext.attachEvent(\"onResize\", function(newBehindSize, newFrontSize){\r\n\t\t\t\t\t\tvar newSize = gridFirst ? newBehindSize : newFrontSize;\r\n\t\t\t\t\t\treturn gantt.callEvent(\"onGridResize\", [initialWidth, newSize]);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tnext.attachEvent(\"onResizeEnd\", function(oldBackSize, oldFrontSize, newBackSize, newFrontSize){\r\n\r\n\t\t\t\t\t\tvar oldSize = gridFirst ? oldBackSize : oldFrontSize;\r\n\t\t\t\t\t\tvar newSize = gridFirst ? newBackSize : newFrontSize;\r\n\t\t\t\t\t\tvar grid = gantt.$ui.getView(\"grid\");\r\n\t\t\t\t\t\tvar viewCell = grid ? grid.$parent : null;\r\n\t\t\t\t\t\tif(viewCell){\r\n\t\t\t\t\t\t\tviewCell.$config.minWidth = undefined;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar res = gantt.callEvent(\"onGridResizeEnd\", [oldSize, newSize]);\r\n\t\t\t\t\t\tif(res && newSize !== 0){// new size may be numeric zero when cell size is defined by 'gravity', actual size will be calculated by layout later\r\n\t\t\t\t\t\t\tgantt.config.grid_width = newSize;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn res;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\t\t\tonDestroyed: function (timeline) {\r\n\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t};\r\n})();\r\n\r\nexport default initializer;","import uiFactory from \"./ui_factory\";\r\nimport mouseEvents from \"./mouse\";\r\nimport createLayers from \"./gantt_layers\";\r\nimport Cell from \"./layout/cell\";\r\nimport Layout from \"./layout/layout\";\r\nimport ViewLayout from \"./layout/view_layout\";\r\nimport ViewCell from \"./layout/view_cell\";\r\nimport Resizer from \"./layout/resizer_cell\";\r\nimport Scrollbar from \"./layout/scrollbar_cell\";\r\nimport Timeline from \"./timeline/timeline\";\r\nimport Grid from \"./grid/grid\";\r\nimport ResourceGrid from \"./grid/resource_grid\";\r\nimport ResourceGridLightbox from \"./grid/resource_grid_lightbox\";\r\nimport ResourceTimeline from \"./timeline/resource_timeline\";\r\nimport ResourceHistogram from \"./timeline/resource_histogram\";\r\n\r\n\r\nimport gridEditorsFactory from \"./grid/editors/controller\";\r\n\r\nimport renderTaskBar from \"./render/task_bar_smart_render\";\r\nimport renderTimedProjectBar from \"./render/task_project_smart_render\";\r\nimport renderSplitTaskBar from \"./render/task_split_render\";\r\nimport renderRollupTaskBar from \"./render/task_rollup_render\";\r\nimport renderTaskBg from \"./render/task_bg_render\";\r\nimport renderLink from \"./render/link_render\";\r\nimport gridRenderer from \"./render/task_grid_line_render\";\r\nimport resourceMatrixRenderer from \"./render/resource_matrix_render\";\r\nimport resourceHistogramRenderer from \"./render/resource_histogram_render\";\r\nimport gridTaskRowResizerRenderer from \"./render/task_grid_row_resize_render\";\r\nimport renderConstraints from \"./render/task_constraints_render\";\r\nimport renderDeadline from \"./render/task_deadline_render\";\r\nimport renderBaselines from \"./render/task_baselines_render\";\r\nimport mainGridInitializer from \"./grid/main_grid_initializer\";\r\nimport mainTimelineInitializer from \"./timeline/main_timeline_initializer\";\r\nimport mainLayoutInitializer from \"./main_layout_initializer\";\r\n\r\nfunction initUI(gantt){\r\n\tfunction attachInitializer(view, initializer){\r\n\t\tvar ext = initializer(gantt);\r\n\t\tif(ext.onCreated)\r\n\t\t\text.onCreated(view);\r\n\t\tview.attachEvent(\"onReady\", function(){\r\n\t\t\tif(ext.onInitialized)\r\n\t\t\t\text.onInitialized(view);\r\n\t\t});\r\n\t\tview.attachEvent(\"onDestroy\", function(){\r\n\t\t\tif(ext.onDestroyed)\r\n\t\t\t\text.onDestroyed(view);\r\n\t\t});\r\n\t}\r\n\r\n\tvar factory = uiFactory.createFactory(gantt);\r\n\tfactory.registerView(\"cell\", Cell);\r\n\tfactory.registerView(\"resizer\", Resizer);\r\n\tfactory.registerView(\"scrollbar\", Scrollbar);\r\n\tfactory.registerView(\"layout\", Layout, function(view){\r\n\t\tvar id = view.$config ? view.$config.id : null;\r\n\t\tif(id === \"main\"){\r\n\t\t\tattachInitializer(view, mainLayoutInitializer);\r\n\t\t}\r\n\t});\r\n\tfactory.registerView(\"viewcell\", ViewCell);\r\n\tfactory.registerView(\"multiview\", ViewLayout);\r\n\tfactory.registerView(\"timeline\", Timeline, function(view){\r\n\t\tvar id = view.$config ? view.$config.id : null;\r\n\t\tif(id === \"timeline\" || view.$config.bind == \"task\"){\r\n\t\t\tattachInitializer(view, mainTimelineInitializer);\r\n\t\t}\r\n\t});\r\n\tfactory.registerView(\"grid\", Grid, function(view){\r\n\t\tvar id = view.$config ? view.$config.id : null;\r\n\t\tif(id === \"grid\" || view.$config.bind == \"task\"){\r\n\t\t\tattachInitializer(view, mainGridInitializer);\r\n\t\t}\r\n\t});\r\n\r\n\tfactory.registerView(\"resourceGrid\", ResourceGrid);\r\n\tfactory.registerView(\"GridRL\", ResourceGridLightbox);\r\n\tfactory.registerView(\"resourceTimeline\", ResourceTimeline);\r\n\tfactory.registerView(\"resourceHistogram\", ResourceHistogram);\r\n\r\n\tvar layersEngine = createLayers(gantt);\r\n\r\n\tvar inlineEditors = gridEditorsFactory(gantt);\r\n\r\n\tgantt.ext.inlineEditors = inlineEditors;\r\n\tgantt.ext._inlineEditors = inlineEditors;\r\n\tinlineEditors.init(gantt);\r\n\r\n\treturn {\r\n\t\tfactory:factory,\r\n\t\tmouseEvents: mouseEvents.init(gantt),\r\n\t\tlayersApi: layersEngine.init(),\r\n\t\trender:{\r\n\t\t\tgridLine: function(){\r\n\t\t\t\treturn gridRenderer(gantt);\r\n\t\t\t},\r\n\t\t\ttaskBg: function(){\r\n\t\t\t\treturn renderTaskBg(gantt);\r\n\t\t\t},\r\n\t\t\ttaskBar: function(){\r\n\t\t\t\treturn renderTaskBar(gantt);\r\n\t\t\t},\r\n\t\t\ttimedProjectBar: function(){\r\n\t\t\t\treturn renderTimedProjectBar(gantt);\r\n\t\t\t},\r\n\t\t\ttaskRollupBar: function() {\r\n\t\t\t\treturn renderRollupTaskBar(gantt);\r\n\t\t\t},\r\n\t\t\ttaskSplitBar: function(){\r\n\t\t\t\treturn renderSplitTaskBar(gantt);\r\n\t\t\t},\r\n\t\t\ttaskConstraints: function(){\r\n\t\t\t\treturn renderConstraints(gantt);\r\n\t\t\t},\r\n\t\t\ttaskDeadline: function(){\r\n\t\t\t\treturn renderDeadline(gantt);\r\n\t\t\t},\r\n\t\t\ttaskBaselines: function(){\r\n\t\t\t\treturn renderBaselines(gantt);\r\n\t\t\t},\r\n\t\t\tlink: function(){\r\n\t\t\t\treturn renderLink(gantt);\r\n\t\t\t},\r\n\t\t\tresourceRow: function(){\r\n\t\t\t\treturn resourceMatrixRenderer(gantt);\r\n\t\t\t},\r\n\t\t\tresourceHistogram: function(){\r\n\t\t\t\treturn resourceHistogramRenderer(gantt);\r\n\t\t\t},\r\n\t\t\tgridTaskRowResizer: function(){\r\n\t\t\t\treturn gridTaskRowResizerRenderer(gantt);\r\n\t\t\t}\r\n\t\t},\r\n\t\tlayersService: {\r\n\t\t\tgetDataRender: function(name){\r\n\t\t\t\treturn layersEngine.getDataRender(name, gantt);\r\n\t\t\t},\r\n\t\t\tcreateDataRender: function(config){\r\n\t\t\t\treturn layersEngine.createDataRender(config, gantt);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default {\r\n\tinit: initUI\r\n};","function createLayoutFacade(){\r\n\r\n\tfunction getTimeline(gantt){\r\n\t\treturn gantt.$ui.getView(\"timeline\");\r\n\t}\r\n\r\n\tfunction getGrid(gantt){\r\n\t\treturn gantt.$ui.getView(\"grid\");\r\n\t}\r\n\r\n\tfunction getBaseCell(gantt){\r\n\t\tvar timeline = getTimeline(gantt);\r\n\t\tif (timeline && !timeline.$config.hidden){\r\n\t\t\treturn timeline;\r\n\t\t} else{\r\n\t\t\tvar grid = getGrid(gantt);\r\n\t\t\tif (grid && !grid.$config.hidden){\r\n\t\t\t\treturn grid;\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getVerticalScrollbar(gantt){\r\n\t\tvar baseCell = null;\r\n\t\t// GS-1150: if we reorder or resize something in the grid, we should obtain the grid container\r\n\t\tvar gridDrag = false;\r\n\t\tvar gridMarkers = [\r\n\t\t\t\".gantt_drag_marker.gantt_grid_resize_area\",\r\n\t\t\t\".gantt_drag_marker .gantt_row.gantt_row_task\",\r\n\t\t\t\".gantt_drag_marker.gantt_grid_dnd_marker\"\r\n\t\t];\r\n\t\tgridMarkers.forEach(function (selector) {\r\n\t\t\tgridDrag = gridDrag || !!document.querySelector(selector);\r\n\t\t});\r\n\t\tif (gridDrag){\r\n\t\t\tbaseCell = getGrid(gantt);\r\n\t\t} else{\r\n\t\t\tbaseCell = getBaseCell(gantt);\r\n\t\t}\r\n\r\n\t\t// GS-1827. If there is no grid and timeline, there is no scrollbar for them\r\n\t\tif (!baseCell){\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar verticalScrollbar = getAttachedScrollbar(gantt, baseCell, \"scrollY\");\r\n\t\treturn verticalScrollbar;\r\n\t}\r\n\r\n\tfunction getHorizontalScrollbar(gantt){\r\n\t\tvar baseCell = getBaseCell(gantt);\r\n\t\tif (!baseCell || baseCell.id == \"grid\"){\r\n\t\t\treturn null; // if the timeline is not displayed, do not return the scrollbar\r\n\t\t}\r\n\t\tvar horizontalScrollbar = getAttachedScrollbar(gantt, baseCell, \"scrollX\");\r\n\t\treturn horizontalScrollbar;\r\n\t}\r\n\r\n\tfunction getAttachedScrollbar(gantt, cell, type){\r\n\t\tvar attachedScrollbar = cell.$config[type];\r\n\t\tvar scrollbarView = gantt.$ui.getView(attachedScrollbar);\r\n\t\treturn scrollbarView;\r\n\t}\r\n\r\n\tvar DEFAULT_VALUE = \"DEFAULT_VALUE\";\r\n\r\n\tfunction tryCall(getView, method, args, fallback){\r\n\t\tvar view = getView(this);\r\n\t\tif (!(view && view.isVisible())) {\r\n\t\t\tif(fallback){\r\n\t\t\t\treturn fallback();\r\n\t\t\t}else{\r\n\t\t\t\treturn DEFAULT_VALUE;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn view[method].apply(view, args);\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\r\n\t\tgetColumnIndex: function(name) {\r\n\t\t\tvar res = tryCall.call(this, getGrid, \"getColumnIndex\", [name]);\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdateFromPos: function(x) {\r\n\t\t\tvar res = tryCall.call(this, getTimeline, \"dateFromPos\", Array.prototype.slice.call(arguments));\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn this.getState().min_date;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tposFromDate: function(date) {\r\n\t\t\tvar res = tryCall.call(this, getTimeline, \"posFromDate\", Array.prototype.slice.call(arguments));\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetRowTop: function(index) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar res = tryCall.call(self, getTimeline, \"getRowTop\", [index],\r\n\t\t\t\tfunction(){ return tryCall.call(self, getGrid, \"getRowTop\", [index]);}\r\n\t\t\t\t);\r\n\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetTaskTop: function(id) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar res = tryCall.call(self, getTimeline, \"getItemTop\", [id],\r\n\t\t\t\tfunction(){ return tryCall.call(self, getGrid, \"getItemTop\", [id]);}\r\n\t\t\t);\r\n\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\tgetTaskPosition: function(task, start_date, end_date) {\r\n\t\t\tvar res = tryCall.call(this, getTimeline, \"getItemPosition\", [task, start_date, end_date]);\r\n\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\tvar top = this.getTaskTop(task.id);\r\n\t\t\t\tvar height = this.getTaskBarHeight(task.id);\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tleft: 0,\r\n\t\t\t\t\ttop: top,\r\n\t\t\t\t\theight: height,\r\n\t\t\t\t\twidth: 0\r\n\t\t\t\t};\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetTaskBarHeight: function(taskId, isMilestoneRender) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar res = tryCall.call(self, getTimeline, \"getBarHeight\", [taskId, isMilestoneRender],\r\n\t\t\t\tfunction(){ return tryCall.call(self, getGrid, \"getItemHeight\", [taskId]);}\r\n\t\t\t);\r\n\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetTaskHeight: function(taskId) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar res = tryCall.call(self, getTimeline, \"getItemHeight\", [taskId],\r\n\t\t\t\tfunction(){ return tryCall.call(self, getGrid, \"getItemHeight\", [taskId]);}\r\n\t\t\t);\r\n\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\tcolumnIndexByDate: function(date) {\r\n\t\t\tvar res = tryCall.call(this, getTimeline, \"columnIndexByDate\", [date]);\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\troundTaskDates: function() {\r\n\t\t\ttryCall.call(this, getTimeline, \"roundTaskDates\", []);\r\n\t\t},\r\n\r\n\t\tgetScale: function() {\r\n\t\t\tvar res = tryCall.call(this, getTimeline, \"getScale\", []);\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn null;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetTaskNode: function(id) {\r\n\t\t\tvar timeline = getTimeline(this);\r\n\t\t\tif (!timeline || !timeline.isVisible()) {\r\n\t\t\t\treturn null;\r\n\t\t\t} else {\r\n\t\t\t\tvar node = timeline._taskRenderer.rendered[id];\r\n\t\t\t\tif(!node){\r\n\t\t\t\t\tvar domAttr = timeline.$config.item_attribute;\r\n\t\t\t\t\tnode = timeline.$task_bars.querySelector(\"[\" +domAttr+ \"='\"+id+\"']\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn node || null;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\tgetLinkNode: function(id) {\r\n\t\t\tvar timeline = getTimeline(this);\r\n\t\t\tif (!timeline.isVisible()) {\r\n\t\t\t\treturn null;\r\n\t\t\t} else {\r\n\t\t\t\treturn timeline._linkRenderer.rendered[id];\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tscrollTo: function(left, top){\r\n\t\t\tvar vertical = getVerticalScrollbar(this);\r\n\t\t\tvar horizontal = getHorizontalScrollbar(this);\r\n\r\n\t\t\tvar oldH = {position: 0},\r\n\t\t\t\toldV = {position: 0};\r\n\r\n\t\t\tif(vertical){\r\n\t\t\t\toldV = vertical.getScrollState();\r\n\t\t\t}\r\n\t\t\tif(horizontal){\r\n\t\t\t\toldH = horizontal.getScrollState();\r\n\t\t\t}\r\n\r\n\t\t\tvar scrollHorizontal = (horizontal && left*1 == left);\r\n\t\t\tvar scrollVertical = (vertical && top*1 == top);\r\n\t\t\tvar scrollBoth = scrollHorizontal && scrollVertical;\r\n\r\n\t\t\tif(scrollBoth){\r\n\t\t\t\t// some views will be scrolled both horizontally and vertically and smart rendering can be called twice\r\n\t\t\t\t// set flag in order not to invoke smart rendering at the horizontal scroll stage\r\n\t\t\t\t// so it will repaint only once when the scroll is completed\r\n\t\t\t\tvar verticalViews = vertical._getLinkedViews();\r\n\t\t\t\tvar horizontalViews = horizontal._getLinkedViews();\r\n\r\n\t\t\t\tvar commonViews = [];\r\n\t\t\t\tfor(var i = 0; i < verticalViews.length; i++){\r\n\t\t\t\t\tfor(var j = 0; j < horizontalViews.length; j++){\r\n\r\n\t\t\t\t\t\tif(verticalViews[i].$config.id && horizontalViews[j].$config.id && verticalViews[i].$config.id === horizontalViews[j].$config.id){\r\n\t\t\t\t\t\t\tcommonViews.push(verticalViews[i].$config.id);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (scrollHorizontal){\r\n\t\t\t\tif(commonViews){\r\n\t\t\t\t\tcommonViews.forEach((function(viewId){\r\n\t\t\t\t\t\tthis.$ui.getView(viewId).$config.$skipSmartRenderOnScroll = true;\r\n\t\t\t\t\t}).bind(this));\r\n\t\t\t\t}\r\n\r\n\t\t\t\thorizontal.scroll(left);\r\n\t\t\t\tif(commonViews){\r\n\t\t\t\t\tcommonViews.forEach((function(viewId){\r\n\t\t\t\t\t\tthis.$ui.getView(viewId).$config.$skipSmartRenderOnScroll = false;\r\n\t\t\t\t\t}).bind(this));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(scrollVertical){\r\n\t\t\t\tvertical.scroll(top);\r\n\t\t\t}\r\n\r\n\t\t\tvar newV = {position: 0},\r\n\t\t\t\tnewH = {position: 0};\r\n\t\t\tif(vertical){\r\n\t\t\t\tnewV = vertical.getScrollState();\r\n\t\t\t}\r\n\t\t\tif(horizontal){\r\n\t\t\t\tnewH = horizontal.getScrollState();\r\n\t\t\t}\r\n\r\n\t\t\tthis.callEvent(\"onGanttScroll\", [oldH.position, oldV.position, newH.position, newV.position]);\r\n\t\t},\r\n\r\n\t\tshowDate: function(date){\r\n\t\t\tvar date_x = this.posFromDate(date);\r\n\t\t\tvar scroll_to = Math.max(date_x - this.config.task_scroll_offset, 0);\r\n\t\t\tthis.scrollTo(scroll_to);\r\n\t\t},\r\n\t\tshowTask: function(id) {\r\n\t\t\tvar pos = this.getTaskPosition(this.getTask(id));\r\n\r\n\t\t\t// GS-1261: we need to show the start_date even in the RTL mode\r\n\t\t\tvar leftPos = pos.left;\r\n\t\t\tif (this.config.rtl) leftPos = pos.left + pos.width;\r\n\r\n\t\t\tvar left = Math.max(leftPos - this.config.task_scroll_offset, 0);\r\n\r\n\t\t\tvar dataHeight = this._scroll_state().y;\r\n\t\t\tvar top;\r\n\t\t\tif(!dataHeight){\r\n\t\t\t\ttop = pos.top;\r\n\t\t\t}else{\r\n\t\t\t\ttop = pos.top - (dataHeight - this.getTaskBarHeight(id))/2;\r\n\t\t\t}\r\n\r\n\t\t\tthis.scrollTo(left, top);\r\n\t\t\t// GS-1150: if the grid and timeline have different scrollbars, we need to scroll thegrid to show the task\r\n\t\t\tvar gridCell = getGrid(this);\r\n\t\t\tvar timelineCell = getTimeline(this);\r\n\t\t\tif (gridCell && timelineCell && gridCell.$config.scrollY != timelineCell.$config.scrollY){\r\n\t\t\t\tvar gridScrollbar = getAttachedScrollbar(this, gridCell, \"scrollY\");\r\n\t\t\t\tgridScrollbar.scrollTo(null, top);\r\n\t\t\t}\r\n\t\t},\r\n\t\t_scroll_state: function(){\r\n\t\t\tvar result = {\r\n\t\t\t\tx: false,\r\n\t\t\t\ty: false,\r\n\t\t\t\tx_pos: 0,\r\n\t\t\t\ty_pos: 0,\r\n\t\t\t\tscroll_size: this.config.scroll_size + 1,//1px for inner content\r\n\t\t\t\tx_inner: 0,\r\n\t\t\t\ty_inner: 0\r\n\t\t\t};\r\n\r\n\t\t\tvar scrollVer = getVerticalScrollbar(this),\r\n\t\t\t\tscrollHor = getHorizontalScrollbar(this);\r\n\t\t\tif(scrollHor){\r\n\t\t\t\tvar horState = scrollHor.getScrollState();\r\n\t\t\t\tif(horState.visible){\r\n\t\t\t\t\tresult.x = horState.size;\r\n\t\t\t\t\tresult.x_inner = horState.scrollSize;\r\n\t\t\t\t}\r\n\t\t\t\tresult.x_pos = horState.position || 0;\r\n\t\t\t}\r\n\r\n\t\t\tif(scrollVer){\r\n\t\t\t\tvar verState = scrollVer.getScrollState();\r\n\t\t\t\tif(verState.visible){\r\n\t\t\t\t\tresult.y = verState.size;\r\n\r\n\t\t\t\t\tresult.y_inner = verState.scrollSize;\r\n\t\t\t\t}\r\n\t\t\t\tresult.y_pos = verState.position || 0;\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\tgetScrollState: function(){\r\n\t\t\tvar state = this._scroll_state();\r\n\t\t\treturn { x:state.x_pos, y:state.y_pos, inner_width:state.x, inner_height:state.y, width: state.x_inner, height: state.y_inner };\r\n\t\t},\r\n\r\n\t\tgetLayoutView: function(cellName){\r\n\t\t\treturn this.$ui.getView(cellName);\r\n\t\t},\r\n\r\n\t\tscrollLayoutCell: function(cellName, left, top){\r\n\t\t\tconst cell = this.$ui.getView(cellName);\r\n\t\t\tif (!cell){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (left !== null){\r\n\t\t\t\tconst horizontalScroll = this.$ui.getView(cell.$config.scrollX);\r\n\t\t\t\tif (horizontalScroll){\r\n\t\t\t\t\thorizontalScroll.scrollTo(left, null);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (top !== null){\r\n\t\t\t\tconst verticalScroll = this.$ui.getView(cell.$config.scrollY);\r\n\t\t\t\tif (verticalScroll){\r\n\t\t\t\t\tverticalScroll.scrollTo(null, top);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t};\r\n\r\n}\r\n\r\nexport default createLayoutFacade;","export default function(gantt) {\r\n\tdelete gantt.addTaskLayer;\r\n\tdelete gantt.addLinkLayer;\r\n};","function _configure(col, data, force) {\r\n\tfor (var key in data)\r\n\t\tif (typeof col[key] == \"undefined\" || force)\r\n\t\t\tcol[key] = data[key];\r\n}\r\n\r\nfunction _get_skin(force, gantt) {\r\n\r\n\tconst styles = getComputedStyle(gantt.$root);\r\n\tconst themeVar = styles.getPropertyValue(\"--dhx-gantt-theme\");\r\n\tlet isCssVarTheme = !!themeVar;\r\n\tlet themeName;\r\n\r\n\t\r\n\tif(isCssVarTheme){\r\n\t\tthemeName = themeVar;\r\n\t}else{\r\n\t\tvar skin = gantt.skin;\r\n\t\tthemeName = skin;\r\n\t\tif (!skin || force) {\r\n\t\t\tvar links = document.getElementsByTagName(\"link\");\r\n\t\t\tfor (var i = 0; i < links.length; i++) {\r\n\t\t\t\tvar res = links[i].href.match(\"dhtmlxgantt_([a-z_]+).css\");\r\n\t\t\t\tif (res) {\r\n\t\t\t\t\tif (gantt.skins[res[1]] || !skin) {\r\n\t\t\t\t\t\tthemeName = res[1];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tgantt._theme_info = {\r\n\t\ttheme: themeName,\r\n\t\tcssVarTheme: isCssVarTheme\r\n\t};\r\n\r\n\r\n\r\n\tgantt.skin = themeName || \"terrace\";\r\n\tvar skinset = gantt.skins[gantt.skin] || gantt.skins[\"terrace\"];\r\n\r\n\t//apply skin related settings\r\n\t_configure(gantt.config, skinset.config, force);\r\n\r\n\tif(!isCssVarTheme){\r\n\t\tgantt.config.link_radius = 1;\r\n\t}\r\n\r\n\tvar config = gantt.getGridColumns();\r\n\tif (config[1] && !gantt.defined(config[1].width))\r\n\t\tconfig[1].width = skinset._second_column_width;\r\n\tif (config[2] && !gantt.defined(config[2].width))\r\n\t\tconfig[2].width = skinset._third_column_width;\r\n\t\r\n\tfor (var i=0; i<config.length; i++) {\r\n\t\tvar column = config[i];\r\n\t\tif (column.name == \"add\") {\r\n\t\t\tif(!column.width){\r\n\t\t\t\tcolumn.width = 44;\r\n\t\t\t}\r\n\t\t\tif (!(gantt.defined(column.min_width) && gantt.defined(column.max_width))) {\r\n\t\t\t\tcolumn.min_width = column.min_width || column.width;\r\n\t\t\t\tcolumn.max_width = column.max_width || column.width;\r\n\t\t\t}\r\n\t\t\tif (column.min_width)\r\n\t\t\t\tcolumn.min_width = +column.min_width;\r\n\t\t\tif (column.max_width)\r\n\t\t\t\tcolumn.max_width = +column.max_width;\r\n\t\t\tif (column.width) {\r\n\t\t\t\tcolumn.width = +column.width;\r\n\t\t\t\tcolumn.width = (column.min_width && column.min_width > column.width) ? column.min_width : column.width;\r\n\t\t\t\tcolumn.width = (column.max_width && column.max_width < column.width) ? column.max_width : column.width;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (skinset.config.task_height){\r\n\t\tgantt.config.task_height = skinset.config.task_height || \"full\";\r\n\t}\r\n\tif (skinset.config.bar_height){\r\n\t\tgantt.config.bar_height = skinset.config.bar_height || \"full\";\r\n\t}\r\n\r\n\tif (skinset._lightbox_template)\r\n\t\tgantt._lightbox_template = skinset._lightbox_template;\r\n\r\n\tif (skinset._redefine_lightbox_buttons) {\r\n\t\tgantt.config.buttons_right = skinset._redefine_lightbox_buttons[\"buttons_right\"];\r\n\t\tgantt.config.buttons_left = skinset._redefine_lightbox_buttons[\"buttons_left\"];\r\n\t}\r\n\r\n\r\n\tgantt.resetLightbox();\r\n}\r\n\r\n\r\n\r\nexport default function(gantt) {\r\n\t\r\n\tif(!gantt.resetSkin){\r\n\t\tgantt.resetSkin = function () {\r\n\t\t\tthis.skin = \"\";\r\n\t\t\t_get_skin(true, this);\r\n\t\t};\r\n\t\tgantt.skins = {};\r\n\r\n\t\tgantt.attachEvent(\"onGanttLayoutReady\", function(){\r\n\t\t\t_get_skin(false, this);\r\n\t\t\tmonitorThemeChange();\r\n\t\t});\r\n\t}\r\n\r\n\tgantt._addThemeClass = function(){\r\n\t\tdocument.documentElement.setAttribute(\"data-gantt-theme\", gantt.skin);\r\n\t};\r\n\r\n\tgantt.setSkin = function(value){\r\n\t\tconst skinChanged = this.skin !== value;\r\n\t\tthis.skin = value;\r\n\t\tgantt._addThemeClass();\r\n\t\tmonitorThemeChange();\r\n\t\tif(gantt.$root){\r\n\t\t\t_get_skin(skinChanged ? false : true, gantt);\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t\t\r\n\t\t//\r\n\t};\r\n\r\n\r\n\tlet monitorIntervalId = null;\r\n\tfunction monitorThemeChange(){\r\n\t\tconst container = gantt.$root;\r\n\t\t\r\n\t\tif(monitorIntervalId){\r\n\t\t\tclearInterval(monitorIntervalId);\r\n\t\t}\r\n\t\t\r\n\t\tif(container){\r\n\t\t\tmonitorIntervalId = setInterval(() => {\r\n\t\t\t\tconst csstheme = getComputedStyle(container).getPropertyValue('--dhx-gantt-theme');\r\n\t\t\t\tif(csstheme && csstheme !== gantt.skin){\r\n\t\t\t\t\tgantt.setSkin(csstheme);\r\n\t\t\t\t}\r\n\r\n\t\t\t}, 100);\r\n\t\t}\r\n\t}\r\n\tgantt.attachEvent(\"onDestroy\", function(){\r\n\t\tclearInterval(monitorIntervalId);\r\n\t});\r\n};","export default function(gantt) {\r\ngantt.skins.skyblue = {\r\n\tconfig:{\r\n\t\tgrid_width:370,\r\n\t\trow_height: 27,\r\n\t\tbar_height_padding:4,\r\n\t\tscale_height: 27,\r\n\t\tlink_line_width:1,\r\n\t\tlink_arrow_size:8,\r\n\t\tlink_radius:2,\r\n\t\tlightbox_additional_height:75\r\n\t},\r\n\t_second_column_width:95,\r\n\t_third_column_width:80\r\n};\r\n\r\n};","export default function(gantt) {\r\ngantt.skins.meadow = {\r\n\tconfig:{\r\n\t\tgrid_width:380,\r\n\t\trow_height: 27,\r\n\t\tscale_height: 30,\r\n\t\tlink_line_width:2,\r\n\t\tlink_arrow_size:10,\r\n\t\tbar_height_padding:4,\r\n\t\tlightbox_additional_height:72\r\n\t},\r\n\t_second_column_width:95,\r\n\t_third_column_width:80\r\n};\r\n\r\n};","export default function(gantt) {\r\ngantt.skins.terrace = {\r\n\tconfig:{\r\n\t\tgrid_width:390,\r\n\t\trow_height: 36,\r\n\t\tscale_height: 36,\r\n\t\tlink_line_width:2,\r\n\t\tlink_arrow_size:12,\r\n\t\tbar_height_padding:9,\r\n\t\tlightbox_additional_height:75\r\n\t},\r\n\t_second_column_width:100,\r\n\t_third_column_width:70\t\t\r\n};\r\n\r\n};","export default function(gantt) {\r\n\tgantt.skins.broadway = {\r\n\t\tconfig: {\r\n\t\t\tgrid_width: 390,\r\n\t\t\trow_height: 35,\r\n\t\t\tscale_height: 35,\r\n\t\t\tlink_line_width: 1,\r\n\t\t\tlink_arrow_size: 9,\r\n\t\t\tbar_height_padding:4,\r\n\t\t\tlightbox_additional_height: 86\r\n\t\t},\r\n\t\t_second_column_width: 100,\r\n\t\t_third_column_width: 80,\r\n\r\n\t\t_lightbox_template: \"<div class='gantt_cal_ltitle'><span class='gantt_mark'>&nbsp;</span><span class='gantt_time'></span><span class='gantt_title'></span><div class='gantt_cancel_btn'></div></div><div class='gantt_cal_larea'></div>\",\r\n\t\t_config_buttons_left: {},\r\n\t\t_config_buttons_right: {\r\n\t\t\t\"gantt_delete_btn\": \"icon_delete\",\r\n\t\t\t\"gantt_save_btn\": \"icon_save\"\r\n\t\t}\r\n\t};\r\n};","export default function(gantt) {\r\n\tgantt.skins.material = {\r\n\t\tconfig: {\r\n\t\t\tgrid_width: 411,\r\n\t\t\trow_height: 34,\r\n\t\t\tscale_height: 36,\r\n\t\t\tlink_line_width: 2,\r\n\t\t\tlink_arrow_size: 12,\r\n\t\t\tbar_height_padding:9,\r\n\t\t\tlightbox_additional_height: 80\r\n\t\t},\r\n\t\t_second_column_width: 110,\r\n\t\t_third_column_width: 75,\r\n\t\t_redefine_lightbox_buttons: {\r\n\t\t\t\"buttons_left\": [\"dhx_delete_btn\"],\r\n\t\t\t\"buttons_right\": [\"dhx_cancel_btn\", \"dhx_save_btn\"]\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.attachEvent(\"onAfterTaskDrag\", function (id) {\r\n\t\tvar t = gantt.getTaskNode(id);\r\n\t\tif (t) {\r\n\t\t\tt.className += \" gantt_drag_animation\";\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tvar indx = t.className.indexOf(\" gantt_drag_animation\");\r\n\t\t\t\tif (indx > -1) {\r\n\t\t\t\t\tt.className = t.className.slice(0, indx);\r\n\t\t\t\t}\r\n\t\t\t}, 200);\r\n\t\t}\r\n\t});\r\n\r\n};","export default function(gantt) {\r\ngantt.skins.dark = {\r\n\tconfig:{\r\n\t\tgrid_width:390,\r\n\t\trow_height: 36,\r\n\t\tscale_height: 36,\r\n\t\tlink_line_width:2,\r\n\t\tlink_arrow_size:12,\r\n\t\tbar_height_padding:9,\r\n\t\tlightbox_additional_height:75\r\n\t},\r\n\t_second_column_width:100,\r\n\t_third_column_width:70\t\t\r\n};\r\n\r\n};","export default function(gantt) {\r\ngantt.skins[\"contrast_black\"] = {\r\n\tconfig:{\r\n\t\tgrid_width:390,\r\n\t\trow_height: 35,\r\n\t\tscale_height: 35,\r\n\t\tlink_line_width:2,\r\n\t\tlink_arrow_size:12,\r\n\t\tlightbox_additional_height:75\r\n\t},\r\n\t_second_column_width:100,\r\n\t_third_column_width:80\r\n};\r\n\r\n};","export default function(gantt) {\r\ngantt.skins[\"contrast_white\"] = {\r\n\tconfig:{\r\n\t\tgrid_width:390,\r\n\t\trow_height: 35,\r\n\t\tscale_height: 35,\r\n\t\tlink_line_width:2,\r\n\t\tlink_arrow_size:12,\r\n\t\tlightbox_additional_height:75\r\n\t},\r\n\t_second_column_width:100,\r\n\t_third_column_width:80\r\n};\r\n\r\n};","import * as domHelpers from \"../utils/dom_helpers\";\r\nimport isHeadless from \"../../../utils/is_headless\";\r\n\r\nexport default function(gantt){\r\n\r\n\tvar scrollRange = 50,\r\n\t\tscrollStep = 30,\r\n\t\tscrollDelay = 10,\r\n\t\tscrollSpeed = 50;\r\n\r\n\tvar interval = null,\r\n\t\tisMove = false,\r\n\t\tdelayTimeout = null,\r\n\t\tstartPos = {\r\n\t\t\tstarted: false\r\n\t\t},\r\n\t\teventPos = {};\r\n\r\n\r\n\tfunction isDisplayed(element){\r\n\t\treturn element &&\r\n\t\t\tdomHelpers.isChildOf(element, gantt.$root) &&\r\n\t\t\telement.offsetHeight;\r\n\t}\r\n\r\n\tfunction getAutoscrollContainer(){\r\n\t\tvar element;\r\n\t\tif(isDisplayed(gantt.$task)){\r\n\t\t\telement = gantt.$task;\r\n\t\t}else if(isDisplayed(gantt.$grid)){\r\n\t\t\telement = gantt.$grid;\r\n\t\t}else{\r\n\t\t\telement = gantt.$root;\r\n\t\t}\r\n\r\n\t\treturn element;\r\n\t}\r\n\r\n\tfunction isScrollState() {\r\n\t\tvar dragMarker = !!document.querySelector(\".gantt_drag_marker\");\r\n\t\tvar isResize = !!document.querySelector(\".gantt_drag_marker.gantt_grid_resize_area\")\r\n\t\t\t|| !!document.querySelector(\".gantt_drag_marker.gantt_row_grid_resize_area\") ;\r\n\t\tvar isLink = !!document.querySelector(\".gantt_link_direction\");\r\n\t\tvar state = gantt.getState();\r\n\t\tvar isClickDrag = state.autoscroll;\r\n\t\tisMove = dragMarker && !isResize && !isLink;\r\n\r\n\t\treturn !((!state.drag_mode && !dragMarker) || isResize) || isClickDrag;\r\n\t}\r\n\r\n\tfunction defineDelayTimeout(state) {\r\n\t\tif (delayTimeout) {\r\n\t\t\tclearTimeout(delayTimeout);\r\n\t\t\tdelayTimeout = null;\r\n\t\t}\r\n\t\tif (state) {\r\n\t\t\tvar speed = gantt.config.autoscroll_speed;\r\n\t\t\tif (speed && speed < 10) // limit speed value to 10\r\n\t\t\t\tspeed = 10;\r\n\r\n\t\t\tdelayTimeout = setTimeout(function() {\r\n\t\t\t\tinterval = setInterval(tick, speed || scrollSpeed);\r\n\t\t\t}, gantt.config.autoscroll_delay || scrollDelay);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction defineScrollInterval(state) {\r\n\t\tif (state) {\r\n\t\t\tdefineDelayTimeout(true);\r\n\t\t\tif (!startPos.started) {\r\n\t\t\t\tstartPos.x = eventPos.x;\r\n\t\t\t\tstartPos.y = eventPos.y;\r\n\t\t\t\tstartPos.started = true;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (interval) {\r\n\t\t\t\tclearInterval(interval);\r\n\t\t\t\tinterval = null;\r\n\t\t\t}\r\n\t\t\tdefineDelayTimeout(false);\r\n\t\t\tstartPos.started = false;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction autoscrollInterval(event) {\r\n\t\tvar isScroll = isScrollState();\r\n\r\n\t\tif ((interval || delayTimeout) && !isScroll) {\r\n\t\t\tdefineScrollInterval(false);\r\n\t\t}\r\n\r\n\t\tif (!gantt.config.autoscroll || !isScroll) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\teventPos = {\r\n\t\t\tx: event.clientX,\r\n\t\t\ty: event.clientY\r\n\t\t};\r\n\r\n\t\t// if it is a mobile device, we need to detect the touch event coords\r\n\t\tif (event.type == \"touchmove\"){\r\n\t\t\teventPos.x = event.targetTouches[0].clientX;\r\n\t\t\teventPos.y = event.targetTouches[0].clientY;\r\n\t\t}\r\n\r\n\t\tif (!interval && isScroll) {\r\n\t\t\tdefineScrollInterval(true);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction tick() {\r\n\r\n\t\tif (!isScrollState()) {\r\n\t\t\tdefineScrollInterval(false);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar container = getAutoscrollContainer();\r\n\t\tif(!container){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// GS-1150: if we reorder or resize something in the grid, we should obtain the grid container\r\n\t\tvar gridDrag = false;\r\n\t\tvar gridMarkers = [\r\n\t\t\t\".gantt_drag_marker.gantt_grid_resize_area\",\r\n\t\t\t\".gantt_drag_marker .gantt_row.gantt_row_task\",\r\n\t\t\t\".gantt_drag_marker.gantt_grid_dnd_marker\"\r\n\t\t];\r\n\t\tgridMarkers.forEach(function (selector) {\r\n\t\t\tgridDrag = gridDrag || !!document.querySelector(selector);\r\n\t\t});\r\n\t\tif (gridDrag){\r\n\t\t\tcontainer = gantt.$grid;\r\n\t\t}\r\n\r\n\t\tvar box = domHelpers.getNodePosition(container);\r\n\r\n\t\tvar posX = eventPos.x - box.x;\r\n\t\tvar posY = eventPos.y - box.y + window.scrollY; // GS-1315: window.scrollY here and below for the elements above Gantt\r\n\r\n\t\tvar scrollLeft = isMove ? 0 : need_scroll(posX, box.width, startPos.x - box.x);\r\n\t\tvar scrollTop = need_scroll(posY, box.height, startPos.y - box.y + window.scrollY);\r\n\r\n\t\tvar scrollState = gantt.getScrollState();\r\n\r\n\t\tvar currentScrollTop = scrollState.y,\r\n\t\t\tscrollOuterHeight = scrollState.inner_height,\r\n\t\t\tscrollInnerHeight = scrollState.height,\r\n\t\t\tcurrentScrollLeft = scrollState.x,\r\n\t\t\tscrollOuterWidth = scrollState.inner_width,\r\n\t\t\tscrollInnerWidth = scrollState.width;\r\n\r\n\t\t// do scrolling only if we have scrollable area to do so\r\n\t\tif (scrollTop && !scrollOuterHeight) {\r\n\t\t\tscrollTop = 0;\r\n\t\t} else if (scrollTop < 0 && !currentScrollTop) {\r\n\t\t\tscrollTop = 0;\r\n\t\t} else if (scrollTop > 0 && currentScrollTop + scrollOuterHeight >= scrollInnerHeight + 2) {\r\n\t\t\tscrollTop = 0;\r\n\t\t}\r\n\r\n\t\tif (scrollLeft && !scrollOuterWidth) {\r\n\t\t\tscrollLeft = 0;\r\n\t\t} else if (scrollLeft < 0 && !currentScrollLeft) {\r\n\t\t\tscrollLeft = 0;\r\n\t\t} else if (scrollLeft > 0 && currentScrollLeft + scrollOuterWidth >= scrollInnerWidth) {\r\n\t\t\tscrollLeft = 0;\r\n\t\t}\r\n\r\n\t\tvar step = gantt.config.autoscroll_step;\r\n\r\n\t\tif (step && step < 2) // limit step value to 2\r\n\t\t\tstep = 2;\r\n\r\n\t\tscrollLeft = scrollLeft * (step || scrollStep);\r\n\t\tscrollTop = scrollTop * (step || scrollStep);\r\n\r\n\t\tif (scrollLeft || scrollTop) {\r\n\t\t\tscroll(scrollLeft, scrollTop);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction need_scroll(pos, boxSize, startCoord) {\r\n\t\tif ((pos - scrollRange < 0) && (pos < startCoord))\r\n\t\t\treturn -1;\r\n\t\telse if ((pos > boxSize - scrollRange) && (pos > startCoord))\r\n\t\t\treturn 1;\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tfunction scroll(left, top) {\r\n\t\tvar scrollState = gantt.getScrollState();\r\n\r\n\t\tvar scrollLeft = null,\r\n\t\t\tscrollTop = null;\r\n\r\n\t\tif (left) {\r\n\t\t\tscrollLeft = scrollState.x + left;\r\n\t\t\tscrollLeft = Math.min(scrollState.width, scrollLeft);\r\n\t\t\tscrollLeft = Math.max(0, scrollLeft);\r\n\t\t}\r\n\r\n\t\tif (top) {\r\n\t\t\tscrollTop = scrollState.y + top;\r\n\t\t\tscrollTop = Math.min(scrollState.height, scrollTop);\r\n\t\t\tscrollTop = Math.max(0, scrollTop);\r\n\t\t}\r\n\r\n\t\tgantt.scrollTo(scrollLeft, scrollTop);\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onGanttReady\", function() {\r\n\t\tif(!isHeadless(gantt)){\r\n\t\t\tvar eventElement = domHelpers.getRootNode(gantt.$root) || document.body;\r\n\t\t\tgantt.eventRemove(eventElement, \"mousemove\", autoscrollInterval);\r\n\t\t\tgantt.event(eventElement, \"mousemove\", autoscrollInterval);\r\n\r\n\t\t\tgantt.eventRemove(eventElement, \"touchmove\", autoscrollInterval);\r\n\t\t\tgantt.event(eventElement, \"touchmove\", autoscrollInterval);\r\n\r\n\t\t\tgantt.eventRemove(eventElement, \"pointermove\", autoscrollInterval);\r\n\t\t\tgantt.event(eventElement, \"pointermove\", autoscrollInterval);\r\n\t\t}\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onDestroy\", function(){\r\n\t\tdefineScrollInterval(false);\r\n\t});\r\n\r\n};","if (typeof window !== \"undefined\" && window.jQuery){\r\n\r\n\t(function( $ ){\r\n\r\n\t\tvar methods = [];\r\n\t\t$.fn.dhx_gantt = function(config){\r\n\t\t\tconfig = config || {};\r\n\t\t\tif (typeof(config) === 'string') {\r\n\t\t\t\tif (methods[config] ) {\r\n\t\t\t\t\treturn methods[config].apply(this, []);\r\n\t\t\t\t}else {\r\n\t\t\t\t\t$.error('Method ' +  config + ' does not exist on jQuery.dhx_gantt');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar views = [];\r\n\t\t\t\tthis.each(function() {\r\n\t\t\t\t\tif (this && this.getAttribute){\r\n\t\t\t\t\t\tif (!this.gantt && !(window.gantt.$root == this)){\r\n\r\n\t\t\t\t\t\t\tvar newgantt = (window.gantt.$container && window.Gantt) ? window.Gantt.getGanttInstance():window.gantt;\r\n\t\t\t\t\t\t\tfor (var key in config)\r\n\t\t\t\t\t\t\t\tif (key!=\"data\")\r\n\t\t\t\t\t\t\t\t\tnewgantt.config[key] = config[key];\r\n\r\n\t\t\t\t\t\t\tnewgantt.init(this);\r\n\t\t\t\t\t\t\tif (config.data)\r\n\t\t\t\t\t\t\t\tnewgantt.parse(config.data);\r\n\r\n\t\t\t\t\t\t\tviews.push(newgantt);\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tviews.push(typeof this.gantt == \"object\" ? this.gantt : window.gantt);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\r\n\t\t\t\tif (views.length === 1) return views[0];\r\n\t\t\t\treturn views;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t})(window.jQuery);\r\n\r\n}\r\n\r\n\r\nexport default null;","if (typeof window !== \"undefined\" && window.dhtmlx){\r\n\r\n\tif (!window.dhtmlx.attaches)\r\n\twindow.dhtmlx.attaches = {};\r\n\r\n\twindow.dhtmlx.attaches.attachGantt=function(start, end, gantt){\r\n\t\tvar obj = document.createElement(\"DIV\");\r\n\r\n\t\tgantt = gantt || window.gantt;\r\n\r\n\t\tobj.id = \"gantt_\"+ gantt.uid();\r\n\t\tobj.style.width = \"100%\";\r\n\t\tobj.style.height = \"100%\";\r\n\t\tobj.cmp = \"grid\";\r\n\r\n\t\tdocument.body.appendChild(obj);\r\n\t\tthis.attachObject(obj.id);\r\n\t\tthis.dataType = \"gantt\";\r\n\t\tthis.dataObj = gantt;\r\n\r\n\t\tvar that = this.vs[this.av];\r\n\t\tthat.grid = gantt;\r\n\r\n\t\tgantt.init(obj.id, start, end);\r\n\t\tobj.firstChild.style.border = \"none\";\r\n\r\n\t\tthat.gridId = obj.id;\r\n\t\tthat.gridObj = obj;\r\n\r\n\t\tvar method_name=\"_viewRestore\";\r\n\t\treturn this.vs[this[method_name]()].grid;\r\n\t};\r\n\r\n}\r\nif (typeof window !== \"undefined\" && typeof(window.dhtmlXCellObject) != \"undefined\") {\r\n\r\n\twindow.dhtmlXCellObject.prototype.attachGantt=function(start, end, gantt){\r\n\t\tgantt = gantt || window.gantt;\r\n\r\n\t\tvar obj = document.createElement(\"DIV\");\r\n\t\tobj.id = \"gantt_\"+gantt.uid();\r\n\t\tobj.style.width = \"100%\";\r\n\t\tobj.style.height = \"100%\";\r\n\t\tobj.cmp = \"grid\";\r\n\r\n\t\tdocument.body.appendChild(obj);\r\n\t\tthis.attachObject(obj.id);\r\n\r\n\t\tthis.dataType = \"gantt\";\r\n\t\tthis.dataObj = gantt;\r\n\r\n\t\tgantt.init(obj.id, start, end);\r\n\t\tobj.firstChild.style.border = \"none\";\r\n\r\n\t\tobj = null;\r\n\t\tthis.callEvent(\"_onContentAttach\",[]);\r\n\r\n\t\treturn this.dataObj;\r\n\t};\r\n}\r\n\r\nexport default null;","import env from \"../../../utils/env\";\r\nimport eventable from \"../../../utils/eventable\";\r\nimport { IScale, TModifierKeys } from \"../../common/config\";\r\n\r\ninterface ITimelineZoomConfig {\r\n\thandler?: (e: Event) => {};\r\n\tstartDate?: Date;\r\n\tendDate?: Date;\r\n\tlevels: IZoomLevel[];\r\n\tactiveLevelIndex?: number;\r\n\twidthStep?: number;\r\n\tminColumnWidth?: number;\r\n\tmaxColumnWidth?: number;\r\n\tuseKey?: \"ctrlKey\" | \"altKey\" | \"shiftKey\";\r\n\ttrigger?: \"wheel\" | null | undefined;\r\n\telement?: Element | (() => Element);\r\n}\r\n\r\nconst USE_KEY = [\"ctrlKey\", \"altKey\", \"shiftKey\", \"metaKey\"];\r\n\r\ninterface IZoomLevel {\r\n\tname?: string;\r\n\tscale_height?: number;\r\n\tmin_column_width: number;\r\n\tscales: IScale[];\r\n}\r\n\r\nconst _defaultScales = [\r\n\t[\r\n\t\t{\r\n\t\t\tunit: \"month\",\r\n\t\t\tdate: \"%M\",\r\n\t\t\tstep: 1\r\n\t\t},\r\n\t\t{\r\n\t\t\tunit: \"day\",\r\n\t\t\tdate: \"%d\",\r\n\t\t\tstep: 1\r\n\t\t}\r\n\t],\r\n\t[\r\n\t\t{\r\n\t\t\tunit: \"day\",\r\n\t\t\tdate: \"%d %M\",\r\n\t\t\tstep: 1\r\n\t\t}\r\n\t],\r\n\t[\r\n\t\t{\r\n\t\t\tunit: \"day\",\r\n\t\t\tdate: \"%d %M\",\r\n\t\t\tstep: 1\r\n\t\t},\r\n\t\t{\r\n\t\t\tunit: \"hour\",\r\n\t\t\tdate: \"%H:00\",\r\n\t\t\tstep: 8\r\n\t\t}\r\n\t],\r\n\t[\r\n\t\t{\r\n\t\t\tunit: \"day\",\r\n\t\t\tdate: \"%d %M\",\r\n\t\t\tstep: 1\r\n\t\t},\r\n\t\t{\r\n\t\t\tunit: \"hour\",\r\n\t\t\tdate: \"%H:00\",\r\n\t\t\tstep: 1\r\n\t\t}\r\n\t]\r\n];\r\n\r\nexport default class TimelineZoom {\r\n\tpublic attachEvent: (eventName: string, handler: () => void) => string;\r\n\tpublic callEvent: (eventName: string, args: any[]) => any;\r\n\tpublic detachEvent: (eventName: string) => any;\r\n\tprotected _initialStartDate: Date;\r\n\tprotected _initialEndDate: Date;\r\n\tprotected _activeLevelIndex: number;\r\n\tprotected _levels: IZoomLevel[];\r\n\tprotected _handler: (e: any) => void;\r\n\tprotected $gantt;\r\n\tprotected _widthStep: number;\r\n\tprotected _minColumnWidth: number;\r\n\tprotected _maxColumnWidth: number;\r\n\tprotected _useKey: TModifierKeys;\r\n\tprotected _visibleDate: Date;\r\n\tprotected _initialized: boolean;\r\n\tprotected _domEvents: any;\r\n\r\n\tconstructor(gantt) {\r\n\t\tthis.$gantt = gantt;\r\n\t\tthis._domEvents = this.$gantt._createDomEventScope();\r\n\t}\r\n\r\n\tpublic init(config: ITimelineZoomConfig) {\r\n\t\t// GS-1354 and GS-1318. If we check the headless mode using the function,\r\n\t\t// it will return false when Gantt is not initialized, but we may want to do it later\r\n\t\tif(this.$gantt.env.isNode){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._initialStartDate = config.startDate;\r\n\t\tthis._initialEndDate = config.endDate;\r\n\t\tthis._activeLevelIndex = config.activeLevelIndex ? config.activeLevelIndex : 0;\r\n\t\tthis._levels = this._mapScales(config.levels || _defaultScales);\r\n\t\tthis._handler = config.handler || this._defaultHandler;\r\n\t\tthis._minColumnWidth = config.minColumnWidth || 60;\r\n\t\tthis._maxColumnWidth = config.maxColumnWidth || 240;\r\n\t\tthis._widthStep = config.widthStep || 3/8 * config.minColumnWidth;\r\n\t\tthis._useKey = config.useKey;\r\n\r\n\t\tif(!this._initialized){\r\n\t\t\teventable(this);\r\n\t\t\tthis.$gantt.attachEvent(\"onGanttScroll\", () => {\r\n\t\t\t\tthis._getVisibleDate();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis._domEvents.detachAll();\r\n\r\n\t\tif(config.trigger === \"wheel\"){\r\n\t\t\tif(this.$gantt.$root){\r\n\t\t\t\tthis._attachWheelEvent(config);\r\n\t\t\t}else{\r\n\t\t\t\t// GS-1322. This way the handler works for the init and resetLayout methods\r\n\t\t\t\tthis.$gantt.attachEvent(\"onGanttLayoutReady\", () => {\r\n\t\t\t\t\tthis.$gantt.attachEvent(\"onGanttRender\", () => {\r\n\t\t\t\t\t\tthis._attachWheelEvent(config);\r\n\t\t\t\t\t}, {once: true});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._initialized = true;\r\n\t\tthis.setLevel(this._activeLevelIndex);\r\n\t}\r\n\r\n\tpublic zoomIn = () => {\r\n\t\tconst index = this.getCurrentLevel() - 1;\r\n\t\tif(index < 0){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.setLevel(index);\r\n\t};\r\n\r\n\tpublic zoomOut = () => {\r\n\t\tconst index = this.getCurrentLevel() + 1;\r\n\t\tif(index > this._levels.length - 1){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.setLevel(index);\r\n\t};\r\n\r\n\tpublic getCurrentLevel = () => {\r\n\t\treturn this._activeLevelIndex;\r\n\t};\r\n\r\n\tpublic getLevels = () => {\r\n\t\treturn this._levels;\r\n\t};\r\n\r\n\tpublic setLevel = (level: number|string) => {\r\n\t\tconst zoomLevel = this._getZoomIndexByName(level);\r\n\r\n\t\tif(zoomLevel === -1){\r\n\t\t\tthis.$gantt.assert(zoomLevel !== -1, \"Invalid zoom level for gantt.ext.zoom.setLevel. \" + level + \" is not an expected value.\");\r\n\t\t}\r\n\t\tthis._setLevel(zoomLevel, 0);\r\n\t};\r\n\r\n\tprotected _getZoomIndexByName = (levelName: number|string) => {\r\n\t\tlet zoomLevel:number = -1;\r\n\t\tif(typeof levelName === \"string\"){\r\n\t\t\tif(!isNaN(Number(levelName)) &&  this._levels[Number(levelName)]){\r\n\t\t\t\tzoomLevel = Number(levelName);\r\n\t\t\t}else{\r\n\t\t\t\tfor(let i = 0; i < this._levels.length; i++){\r\n\t\t\t\t\tif(this._levels[i].name === levelName){\r\n\t\t\t\t\t\tzoomLevel = i;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tzoomLevel = levelName;\r\n\t\t}\r\n\t\treturn zoomLevel;\r\n\t};\r\n\r\n\tprotected _mapScales(levels: IScale[][] | any): IZoomLevel[]{\r\n\t\treturn levels.map((l) => {\r\n\t\t\tif(Array.isArray(l)){\r\n\t\t\t\treturn {\r\n\t\t\t\t\tscales: l\r\n\t\t\t\t};\r\n\t\t\t}else{\r\n\t\t\t\treturn l;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected _getVisibleDate = () => {\r\n\t\t// GS-1450. Don't try to get the visible date if there is no timeline\r\n\t\tif (!this.$gantt.$task){\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tconst scrollPos = this.$gantt.getScrollState().x;\r\n\t\tconst viewPort = this.$gantt.$task.offsetWidth;\r\n\t\tthis._visibleDate = this.$gantt.dateFromPos(scrollPos + viewPort/2);\r\n\t};\r\n\r\n\tprotected _setLevel = (level: number, cursorOffset: number) => {\r\n\t\tthis._activeLevelIndex = level;\r\n\r\n\t\tconst gantt = this.$gantt;\r\n\t\tconst nextConfig = gantt.copy(this._levels[this._activeLevelIndex]);\r\n\t\tconst chartConfig = gantt.copy(nextConfig);\r\n\t\tdelete chartConfig.name;\r\n\r\n\t\tgantt.mixin(gantt.config, chartConfig, true);\r\n\r\n\t\t// GS-1148: Change scales for the resource views\r\n\t\tconst resourceViews = [\r\n\t\t\t\"resourceTimeline\",\r\n\t\t\t\"resourceHistogram\"\r\n\t\t];\r\n\r\n\t\tresourceViews.forEach(function(name){\r\n\t\t\tconst resourceView = gantt.$ui.getView(name);\r\n\t\t\tif (resourceView){\r\n\t\t\t\tconst resourceConfig = resourceView.$getConfig();\r\n\t\t\t\tif (!resourceConfig.fixed_scales){\r\n\t\t\t\t\tgantt.mixin(resourceConfig, chartConfig, true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst isRendered = !!gantt.$root && !!gantt.$task;\r\n\r\n\t\tif(isRendered){\r\n\t\t\tif(cursorOffset){\r\n\t\t\t\tconst cursorDate = this.$gantt.dateFromPos(cursorOffset + this.$gantt.getScrollState().x);\r\n\t\t\t\tthis.$gantt.render();\r\n\t\t\t\tconst newPosition = this.$gantt.posFromDate(cursorDate);\r\n\t\t\t\tthis.$gantt.scrollTo(newPosition - cursorOffset);\r\n\t\t\t}else{\r\n\t\t\t\tconst viewPort = this.$gantt.$task.offsetWidth;\r\n\t\t\t\tif(!this._visibleDate){\r\n\t\t\t\t\tthis._getVisibleDate();\r\n\t\t\t\t}\r\n\t\t\t\tconst middleDate = this._visibleDate;\r\n\t\t\t\tthis.$gantt.render();\r\n\t\t\t\tconst newPosition = this.$gantt.posFromDate(middleDate);\r\n\t\t\t\tthis.$gantt.scrollTo(newPosition - viewPort/2);\r\n\t\t\t}\r\n\r\n\t\t\tthis.callEvent(\"onAfterZoom\", [this._activeLevelIndex, nextConfig]);\r\n\t\t}\r\n\t};\r\n\r\n\tprivate _attachWheelEvent = (config) => {\r\n\t\tconst event = env.isFF ? \"wheel\" : \"mousewheel\";\r\n\t\tlet el: Element;\r\n\t\tif(typeof config.element === \"function\"){\r\n\t\t\tel = config.element();\r\n\t\t}else{\r\n\t\t\tel = config.element as Element;\r\n\t\t}\r\n\t\tif (!el){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._domEvents.attach(el, event, this.$gantt.bind(function(e) {\r\n\t\t\tif (this._useKey) {\r\n\t\t\t\tif (USE_KEY.indexOf(this._useKey) < 0) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tif (!e[this._useKey]) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (typeof this._handler === \"function\") {\r\n\t\t\t\tthis._handler.apply(this, [e]);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}, this), {passive: false});\r\n\t};\r\n\r\n\tprivate _defaultHandler = (e: any):void => {\r\n\t\tconst timelineOffset = this.$gantt.$task.getBoundingClientRect().x;\r\n\t\tconst cursorOffset = e.clientX - timelineOffset;\r\n\t\tconst wheelY = this.$gantt.env.isFF ? (e.deltaY*-40) : e.wheelDelta;\r\n\t\tlet wheelUp = false;\r\n\t\tif (wheelY > 0) {\r\n\t\t\twheelUp = true;\r\n\t\t}\r\n\t\te.preventDefault();\r\n\t\te.stopPropagation();\r\n\t\tthis._setScaleSettings(wheelUp, cursorOffset);\r\n\t};\r\n\r\n\tprivate _setScaleSettings(wheelUp: boolean, cursorOffset: number) {\r\n\t\tif (wheelUp) {\r\n\t\t\tthis._stepUp(cursorOffset);\r\n\t\t} else {\r\n\t\t\tthis._stepDown(cursorOffset);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _setScaleDates = () => {\r\n\t\tif(this._initialStartDate && this._initialEndDate){\r\n\t\t\tthis.$gantt.config.start_date = this._initialStartDate;\r\n\t\t\tthis.$gantt.config.end_date = this._initialEndDate;\r\n\t\t}\r\n\t};\r\n\r\n\tprivate _stepUp(cursorOffset) {\r\n\t\tif (this._activeLevelIndex >= this._levels.length - 1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet nextLevel = this._activeLevelIndex;\r\n\t\tthis._setScaleDates();\r\n\r\n\t\tif(this._widthStep){\r\n\t\t\tlet newColumnWidth = this.$gantt.config.min_column_width + this._widthStep;\r\n\t\t\tif (newColumnWidth > this._maxColumnWidth) {\r\n\t\t\t\tnewColumnWidth = this._minColumnWidth;\r\n\t\t\t\tnextLevel++;\r\n\t\t\t}\r\n\r\n\t\t\tthis.$gantt.config.min_column_width = newColumnWidth;\r\n\t\t}else{\r\n\t\t\tnextLevel++;\r\n\t\t}\r\n\t\tthis._setLevel(nextLevel, cursorOffset);\r\n\t}\r\n\tprivate _stepDown(cursorOffset) {\r\n\t\tif (this._activeLevelIndex < 1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet nextLevel = this._activeLevelIndex;\r\n\t\tthis._setScaleDates();\r\n\r\n\t\tif(this._widthStep){\r\n\t\t\tlet newColumnWidth = this.$gantt.config.min_column_width - this._widthStep;\r\n\t\t\tif (newColumnWidth < this._minColumnWidth) {\r\n\t\t\t\tnewColumnWidth = this._maxColumnWidth;\r\n\t\t\t\tnextLevel--;\r\n\t\t\t}\r\n\t\t\tthis.$gantt.config.min_column_width = newColumnWidth;\r\n\t\t}else{\r\n\t\t\tnextLevel--;\r\n\t\t}\r\n\t\tthis._setLevel(nextLevel, cursorOffset);\r\n\t}\r\n}","import autoscroll from \"./autoscroll\";\r\nimport jquery_hooks from \"./jquery_hooks\";\r\nimport dhtmlx_hooks from \"./dhtmlx_hooks\";\r\nimport TimelineZoom from \"./timeline_zoom\";\r\n\r\n\r\nexport default function(gantt){\r\n\tif(!gantt.ext){\r\n\t\tgantt.ext = {};\r\n\t}\r\n\r\n\tvar modules = [\r\n\t\tautoscroll,\r\n\t\tjquery_hooks,\r\n\t\tdhtmlx_hooks\r\n\t];\r\n\r\n\tfor(var i = 0; i < modules.length; i++){\r\n\t\tif(modules[i])\r\n\t\t\tmodules[i](gantt);\r\n\t}\r\n\r\n\tgantt.ext.zoom = new TimelineZoom(gantt);\r\n};","export default function(gantt) {\r\n\r\n\tgantt.config.touch_drag = 75; //nearly immediate dnd\r\n\tgantt.config.touch = true;\r\n\tgantt.config.touch_feedback = true;\r\n\tgantt.config.touch_feedback_duration = 1;\r\n\tgantt._prevent_touch_scroll = false;\r\n\r\n\r\n\tgantt._touch_feedback = function () {\r\n\t\tif (gantt.config.touch_feedback) {\r\n\t\t\tif (navigator.vibrate)\r\n\t\t\t\tnavigator.vibrate(gantt.config.touch_feedback_duration);\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\t\tif (gantt.$container)\t{\r\n\t\t\taddTouchEvents();\r\n\t\t}\r\n\t});\r\n\tgantt.attachEvent(\"onGanttLayoutReady\", function(){\r\n\t\tif (gantt.$container)\t{\r\n\t\t\t\tgantt.attachEvent(\"onGanttRender\", addTouchEvents, {once: true});\r\n\t\t}\r\n\t});\r\n\r\n\tfunction addTouchEvents(){\r\n\t\tif (gantt.config.touch != \"force\")\r\n\t\t\tgantt.config.touch = gantt.config.touch &&\r\n\t\t\t\t((navigator.userAgent.indexOf(\"Mobile\") != -1) ||\r\n\t\t\t\t\t(navigator.userAgent.indexOf(\"iPad\") != -1) ||\r\n\t\t\t\t\t(navigator.userAgent.indexOf(\"Android\") != -1) ||\r\n\t\t\t\t\t(navigator.userAgent.indexOf(\"Touch\") != -1)) ||\r\n\t\t\t\t\t((navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1));\r\n\r\n\t\tif (gantt.config.touch) {\r\n\t\t\t// IE doesn't support touch events. In other cases, a user may connect\r\n\t\t\t// a touch device at any time, so it should work in the forced touch mode\r\n\t\t\tconst touchEventsSupported = !gantt.env.isIE || !!window.navigator.maxTouchPoints;\r\n\r\n\t\t\tif (touchEventsSupported) {\r\n\t\t\t\tgantt._touch_events([\"touchmove\", \"touchstart\", \"touchend\"], function (ev) {\r\n\t\t\t\t\tif (ev.touches && ev.touches.length > 1) return null;\r\n\t\t\t\t\tif (ev.touches[0])\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\ttarget: ev.target,\r\n\t\t\t\t\t\t\tpageX: ev.touches[0].pageX,\r\n\t\t\t\t\t\t\tpageY: ev.touches[0].pageY,\r\n\t\t\t\t\t\t\tclientX: ev.touches[0].clientX,\r\n\t\t\t\t\t\t\tclientY: ev.touches[0].clientY\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\treturn ev;\r\n\t\t\t\t}, function (ev) {\r\n\t\t\t\t\treturn ev.defaultPrevented;\r\n\t\t\t\t});\r\n\t\t\t} else if (window.PointerEvent) {\r\n\t\t\t\tgantt._touch_events([\"pointermove\", \"pointerdown\", \"pointerup\"], function (ev) {\r\n\t\t\t\t\tif (ev.pointerType == \"mouse\") return null;\r\n\t\t\t\t\treturn ev;\r\n\t\t\t\t}, function (ev) {\r\n\t\t\t\t\treturn (!ev || (ev.pointerType == \"mouse\" ));\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tfunction findTargetView(event){\r\n\t\tvar allViews = gantt.$layout.getCellsByType(\"viewCell\");\r\n\r\n\t\tfor(var i = 0; i < allViews.length; i++){\r\n\t\t\tvar box = allViews[i].$view.getBoundingClientRect();\r\n\t\t\tif(event.clientX >= box.left && event.clientX <= box.right &&\r\n\t\t\t\tevent.clientY <= box.bottom && event.clientY >= box.top){\r\n\t\t\t\t\treturn allViews[i];\r\n\t\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getScrollState(view){\r\n\t\tvar scrollX = view.$config.scrollX ? gantt.$ui.getView(view.$config.scrollX) : null;\r\n\t\tvar scrollY = view.$config.scrollY ? gantt.$ui.getView(view.$config.scrollY) : null;\r\n\r\n\t\tvar scrollState = {x: null, y: null};\r\n\t\tif(scrollX){\r\n\t\t\tvar state = scrollX.getScrollState();\r\n\t\t\tif(state.visible){\r\n\t\t\t\tscrollState.x = scrollX.$view.scrollLeft;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(scrollY){\r\n\t\t\tvar state = scrollY.getScrollState();\r\n\t\t\tif(state.visible){\r\n\t\t\t\tscrollState.y = scrollY.$view.scrollTop;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn scrollState;\r\n\t}\r\n\r\n\tfunction scrollView(view, left, top){\r\n\t\tvar scrollX = view.$config.scrollX ? gantt.$ui.getView(view.$config.scrollX) : null;\r\n\t\tvar scrollY = view.$config.scrollY ? gantt.$ui.getView(view.$config.scrollY) : null;\r\n\r\n\t\tif(scrollX){\r\n\t\t\tscrollX.scrollTo(left, null);\r\n\t\t}\r\n\t\tif(scrollY){\r\n\t\t\tscrollY.scrollTo(null, top);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getTaskDND(){\r\n\t\tvar tasksDnD;\r\n\t\tif(gantt.$ui.getView(\"timeline\")){\r\n\t\t\ttasksDnD = gantt.$ui.getView(\"timeline\")._tasks_dnd;\r\n\t\t}\r\n\t\treturn tasksDnD;\r\n\t}\r\n\r\n\tvar touchHandlers = [];\r\n\r\n//we can't use native scrolling, as we need to sync momentum between different parts\r\n//so we will block native scroll and use the custom one\r\n//in future we can add custom momentum\r\n\tgantt._touch_events = function (names, accessor, ignore) {\r\n\t\t//webkit on android need to be handled separately\r\n\t\tvar dblclicktime = 0;\r\n\t\tvar actionMode = false;\r\n\t\tvar scrollMode = false;\r\n\t\tvar actionStart = null;\r\n\t\tvar previousActionStart = null;\r\n\t\tvar scrollState;\r\n\t\tvar longTapTimer = null;\r\n\t\tvar currentDndId = null;\r\n\t\tvar dndNodes = [];\r\n\t\tvar targetView = null;\r\n\t\tlet multiTouchEvents = {};\r\n\r\n\t\tfor(var i = 0; i < touchHandlers.length; i++){\r\n\t\t\tgantt.eventRemove(touchHandlers[i][0], touchHandlers[i][1], touchHandlers[i][2]);\r\n\t\t}\r\n\t\ttouchHandlers = [];\r\n\r\n\t\t//touch move\r\n\t\ttouchHandlers.push([gantt.$container, names[0], function (e) {\r\n\t\t\tvar tasksDnD = getTaskDND();\r\n\r\n\t\t\t\tif (ignore(e)) return;\r\n\r\n\t\t\t\t//ignore common and scrolling moves\r\n\t\t\t\tif (!actionMode) return;\r\n\r\n\t\t\t\tif (longTapTimer) clearTimeout(longTapTimer);\r\n\r\n\t\t\t\tvar source = accessor(e);\r\n\t\t\t\tif (tasksDnD && (tasksDnD.drag.id || tasksDnD.drag.start_drag)) {\r\n\t\t\t\t\ttasksDnD.on_mouse_move(source);\r\n\t\t\t\t\tif (e.preventDefault)\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.cancelBubble = true;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tif (!gantt._prevent_touch_scroll) {\r\n\t\t\t\t\tif (source && actionStart) {\r\n\t\t\t\t\t\tvar dx = actionStart.pageX - source.pageX;\r\n\t\t\t\t\t\tvar dy = actionStart.pageY - source.pageY;\r\n\t\t\t\t\t\tif (!scrollMode && (Math.abs(dx) > 5 || Math.abs(dy) > 5)) {\r\n\t\t\t\t\t\t\tscrollMode = true;\r\n\t\t\t\t\t\t\t//gantt._touch_scroll_active = scroll_mode = true;\r\n\t\t\t\t\t\t\tdblclicktime = 0;\r\n\r\n\t\t\t\t\t\t\tif(targetView){\r\n\t\t\t\t\t\t\t\tscrollState = getScrollState(targetView);\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\tscrollState = gantt.getScrollState();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (scrollMode) {\r\n\r\n\t\t\t\t\t\t\tvar newScrollState;\r\n\t\t\t\t\t\t\tvar scrollX = scrollState.x + dx;\r\n\t\t\t\t\t\t\tvar scrollY = scrollState.y + dy;\r\n\t\t\t\t\t\t\tif(targetView){\r\n\t\t\t\t\t\t\t\tscrollView(targetView, scrollX, scrollY);\r\n\t\t\t\t\t\t\t\tnewScrollState = getScrollState(targetView);\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\tgantt.scrollTo(scrollX, scrollY);\r\n\t\t\t\t\t\t\t\tnewScrollState = gantt.getScrollState();\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif ((scrollState.x != newScrollState.x && dy > 2 * dx) ||\r\n\t\t\t\t\t\t\t\t(scrollState.y != newScrollState.y && dx > 2 * dy )) {\r\n\t\t\t\t\t\t\t\treturn block_action(e);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn block_action(e);\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}]);\r\n\r\n\t\t// prevent page drag on touch move\r\n\t\ttry{\r\n\t\t\tdocument.addEventListener('touchmove', function(e) {\r\n\t\t\t\tif (gantt._touch_drag) {\r\n\t\t\t\t\tblock_action(e);\r\n\t\t\t\t}\r\n\t\t\t}, { passive: false });\r\n\t\t}\r\n\t\tcatch(e){\r\n\t\t\t// eslint-disable-next-line no-console\r\n\t\t\tconsole.warn(\"Cannot prevent touch event for the page drag\");\r\n\t\t}\r\n\r\n\t\t//block touch context menu in IE10\r\n\t\ttouchHandlers.push([this.$container, \"contextmenu\", function (e) {\r\n\t\t\tif (actionMode)\r\n\t\t\t\treturn block_action(e);\r\n\t\t}]);\r\n\r\n\t\t//touch start\r\n\t\ttouchHandlers.push([this.$container, names[1], function (e) {\r\n\t\t\tmultiTouchEvents = e.touches.length;\r\n\t\t\t// block pull-to-refresh\r\n\t\t\tif(document && document.body){\r\n\t\t\t\tdocument.body.classList.add(\"gantt_touch_active\");\r\n\t\t\t}\r\n\r\n\t\t\tif (ignore(e)) return;\r\n\t\t\tif (e.touches && e.touches.length > 1) {\r\n\t\t\t\tactionMode = false;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tactionStart = accessor(e);\r\n\t\t\ttargetView = findTargetView(actionStart);\r\n\t\t\tif (!gantt._locate_css(actionStart, \"gantt_hor_scroll\") && !gantt._locate_css(actionStart, \"gantt_ver_scroll\")) {\r\n\t\t\t\tactionMode = true;\r\n\t\t\t}\r\n\t\t\tvar tasksDnD = getTaskDND();\r\n\r\n\t\t\t//long tap\r\n\t\t\tlongTapTimer = setTimeout(function () {\r\n\t\t\t\tvar taskId = gantt.locate(actionStart);\r\n\t\t\t\tif (tasksDnD && (taskId && !gantt._locate_css(actionStart, \"gantt_link_control\") && !gantt._locate_css(actionStart, \"gantt_grid_data\"))) {\r\n\t\t\t\t\ttasksDnD.on_mouse_down(actionStart);\r\n\r\n\t\t\t\t\tif (tasksDnD.drag && tasksDnD.drag.start_drag) {\r\n\t\t\t\t\t\t// we need that as touch events break if the target node is removed from the DOM\r\n\t\t\t\t\t\tcloneTaskRendered(taskId);\r\n\t\t\t\t\t\ttasksDnD._start_dnd(actionStart);\r\n\t\t\t\t\t\tgantt._touch_drag = true;\r\n\r\n\t\t\t\t\t\tgantt.refreshTask(taskId);\r\n\r\n\t\t\t\t\t\tgantt._touch_feedback();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlongTapTimer = null;\r\n\t\t\t}, gantt.config.touch_drag);\r\n\t\t}]);\r\n\r\n\t\t//touch end\r\n\t\ttouchHandlers.push([this.$container, names[2], function (e) {\r\n\t\t\tif(document && document.body){\r\n\t\t\t\tdocument.body.classList.remove(\"gantt_touch_active\");\r\n\t\t\t}\r\n\t\t\tif (ignore(e)) return;\r\n\t\t\tif (longTapTimer) clearTimeout(longTapTimer);\r\n\t\t\tgantt._touch_drag = false;\r\n\t\t\tactionMode = false;\r\n\t\t\tvar source = accessor(e);\r\n\r\n\t\t\tvar tasksDnD = getTaskDND();\r\n\r\n\t\t\tif(tasksDnD)\r\n\t\t\t\ttasksDnD.on_mouse_up(source);\r\n\r\n\t\t\tif (currentDndId && gantt.isTaskExists(currentDndId)) {\r\n\t\t\t\tgantt.refreshTask(currentDndId);\r\n\t\t\t\tif(dndNodes.length){\r\n\t\t\t\t\tdndNodes.forEach(function(node){\r\n\t\t\t\t\t\tif(node.parentNode){\r\n\t\t\t\t\t\t\tnode.parentNode.removeChild(node);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tgantt._touch_feedback();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//gantt._touch_scroll_active = action_mode = scroll_mode = false;\r\n\t\t\tactionMode = scrollMode = false;\r\n\t\t\tdndNodes = [];\r\n\t\t\tcurrentDndId = null;\r\n\r\n\t\t\t//dbl-tap handling\r\n\t\t\tif (actionStart && dblclicktime) {\r\n\t\t\t\tvar now = new Date();\r\n\t\t\t\t// doubletap shouldn't happen with multitouch\r\n\t\t\t\tconst noMultitouch = multiTouchEvents <= 1;\r\n\t\t\t\t// double click events shouldn't fire when we quickly tap on different nodes\r\n\t\t\t\tconst sameTarget = previousActionStart && previousActionStart.target.innerHTML == actionStart.target.innerHTML;\r\n\t\t\t\tif ((now - dblclicktime) < 500 && noMultitouch && sameTarget) {\r\n\r\n\t\t\t\t\tvar mouseEvents = gantt.$services.getService(\"mouseEvents\");\r\n\t\t\t\t\tmouseEvents.onDoubleClick(actionStart);\r\n\t\t\t\t\tblock_action(e);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdblclicktime = now;\r\n\t\t\t\t\tpreviousActionStart = actionStart;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tdblclicktime = new Date();\r\n\t\t\t}\r\n\t\t}]);\r\n\r\n\t\tfor(var i = 0; i < touchHandlers.length; i++){\r\n\t\t\tgantt.event(touchHandlers[i][0], touchHandlers[i][1], touchHandlers[i][2]);\r\n\t\t}\r\n\r\n\t\t//common helper, prevents event\r\n\t\tfunction block_action(e) {\r\n\t\t\tif (e && e.preventDefault && e.cancelable){\r\n\t\t\t\te.preventDefault();\r\n\t\t\t}\r\n\t\t\te.cancelBubble = true;\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tfunction cloneTaskRendered(taskId) {\r\n\t\t\tconst renders = gantt._getTaskLayers();\r\n\t\t\tlet task = gantt.getTask(taskId);\r\n\t\t\tif (task) {\r\n\t\t\t\tlet visible = gantt.isTaskVisible(taskId);\r\n\t\t\t\tif (visible){\r\n\t\t\t\t\tcurrentDndId = taskId;\r\n\t\t\t\t\tfor (let i = 0; i < renders.length; i++) {\r\n\t\t\t\t\t\ttask = renders[i].rendered[taskId];\r\n\t\t\t\t\t\tif (task && task.getAttribute(gantt.config.task_attribute) && task.getAttribute(gantt.config.task_attribute) == taskId) {\r\n\t\t\t\t\t\t\tconst copy = task.cloneNode(true);\r\n\t\t\t\t\t\t\tdndNodes.push(task);\r\n\t\t\t\t\t\t\trenders[i].rendered[taskId] = copy;\r\n\t\t\t\t\t\t\ttask.style.display = \"none\";\r\n\t\t\t\t\t\t\tcopy.className += \" gantt_drag_move \";\r\n\t\t\t\t\t\t\ttask.parentNode.appendChild(copy);\r\n\t\t\t\t\t\t\t//return copy;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (task.$split_subtask){\r\n\t\t\t\t\tlet renderedParent = task.$rendered_parent;\r\n\t\t\t\t\tvisible = gantt.isTaskVisible(renderedParent);\r\n\t\t\t\t\tif (!visible){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcurrentDndId = taskId;\r\n\t\t\t\t\tfor (let i = 0; i < renders.length; i++) {\r\n\t\t\t\t\t\tconst parent = renders[i].rendered[renderedParent];\r\n\t\t\t\t\t\tlet taskNode;\r\n\t\t\t\t\t\tif (parent && parent.childNodes){\r\n\t\t\t\t\t\t\ttaskNode = parent.querySelector(`[${gantt.config.task_attribute}=\"${task.id}\"]`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (taskNode) {\r\n\t\t\t\t\t\t\t// move the child node to a different parent as the task bar will be repainted\r\n\t\t\t\t\t\t\t// and the initial node will be lost\r\n\t\t\t\t\t\t\tconst copy = taskNode.cloneNode(true);\r\n\t\t\t\t\t\t\ttaskNode.parentNode.appendChild(copy);\r\n\r\n\t\t\t\t\t\t\tgantt.$task_bars.appendChild(taskNode);\r\n\t\t\t\t\t\t\ttaskNode.style.display = \"none\";\r\n\r\n\t\t\t\t\t\t\t// don't add the node as rendered otherwise it will be lost:\r\n\t\t\t\t\t\t\t// renders[i].rendered[taskId] = taskNode;\r\n\t\t\t\t\t\t\t// instead, add it to dndNodes as its elements will be removed after drag\r\n\t\t\t\t\t\t\tdndNodes.push(taskNode);\r\n\r\n\t\t\t\t\t\t\ttaskNode = null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n};","function dummy() {\r\n\t// eslint-disable-next-line\r\n\tconsole.log(\"Method is not implemented.\"); \r\n}\r\nfunction BaseControl() {\r\n}\r\n\r\n// base methods will be runned in gantt context\r\nBaseControl.prototype.render = dummy; // arguments: sns\r\nBaseControl.prototype.set_value = dummy; // arguments: node, value, ev, sns(config)\r\nBaseControl.prototype.get_value = dummy; // arguments node, ev, sns(config)\r\nBaseControl.prototype.focus = dummy; // arguments: node\r\n\r\nexport default function(gantt) { // we could send current instance of gantt to module\r\n\treturn BaseControl;\r\n};","import __extends from \"../../../../utils/extends\";\r\n\r\nimport Super from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tconst _super = Super(gantt);\r\n\r\n\tfunction TemplateControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this; \r\n\t\treturn self; \r\n\t}\r\n\r\n\t__extends(TemplateControl, _super);\r\n\r\n\r\n\tTemplateControl.prototype.render = function(sns) {\r\n\t\tlet height = sns.height ? `${sns.height}px` : '';\r\n\t\treturn `<div class='gantt_cal_ltext gantt_cal_template gantt_section_${sns.name}' ${height ? `style='height:${height};'` : ''}></div>`;\r\n\t};\r\n\r\n\tTemplateControl.prototype.set_value = function(node, value) {\r\n\t\tnode.innerHTML = value || \"\";\r\n\t};\r\n\r\n\tTemplateControl.prototype.get_value = function(node) {\r\n\t\treturn node.innerHTML || \"\";\r\n\t};\r\n\r\n\tTemplateControl.prototype.focus = function() {};\r\n\r\n\treturn TemplateControl;\r\n};","import __extends from \"../../../../utils/extends\";\r\n\r\nimport Super from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tconst _super = Super(gantt);\r\n\r\n\tfunction TextareaControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this;\r\n\r\n\t\treturn self; \r\n\t}\r\n\r\n\t__extends(TextareaControl, _super);\r\n\r\n\tTextareaControl.prototype.render = function(sns) {\r\n\t\tconst height = (sns.height || \"130\") + \"px\";\r\n\t\tconst placeholder = sns.placeholder ? `placeholder='${sns.placeholder}'` : \"\";\r\n\t\treturn `<div class='gantt_cal_ltext gantt_section_${sns.name}' style='height:${height};' ${placeholder}><textarea></textarea></div>`;\r\n\t};\r\n\r\n\tTextareaControl.prototype.set_value = function(node, value) {\r\n\t\tgantt.form_blocks.textarea._get_input(node).value = value || \"\";\r\n\t};\r\n\r\n\tTextareaControl.prototype.get_value = function(node) {\r\n\t\treturn gantt.form_blocks.textarea._get_input(node).value;\r\n\t};\r\n\r\n\tTextareaControl.prototype.focus = function(node) {\r\n\t\tvar a = gantt.form_blocks.textarea._get_input(node);\r\n\t\tgantt._focus(a, true);\r\n\t};\r\n\r\n\tTextareaControl.prototype._get_input = function(node) {\r\n\t\treturn node.querySelector(\"textarea\");\r\n\t};\r\n\r\n\treturn TextareaControl;\r\n};","import __extends from \"../../../../utils/extends\";\r\n\r\nimport Super from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tconst _super = Super(gantt);\r\n\r\n\tfunction TimeControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this;\r\n\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(TimeControl, _super);\r\n\r\n\tTimeControl.prototype.render = function (sns) {\r\n\t\tvar time = gantt.form_blocks.getTimePicker.call(this, sns);\r\n\t\tlet sectionClassName = \"gantt_section_time\";\r\n\t\tif (sns.name !== \"time\"){\r\n\t\t\tsectionClassName += \" gantt_section_\" + sns.name;\r\n\t\t}\r\n\t\tvar html = \"<div style='padding-top:0px;font-size:inherit;text-align:center;' class='\" + sectionClassName + \"'>\";\r\n\t\thtml += time;\r\n\r\n\t\tif (sns.single_date) {\r\n\t\t\ttime = gantt.form_blocks.getTimePicker.call(this, sns, true);\r\n\t\t\thtml += \"<span></span>\";\r\n\t\t} else {\r\n\t\t\thtml += \"<span class='gantt_section_time_spacer'> &nbsp;&ndash;&nbsp; </span>\";\r\n\t\t}\r\n\r\n\t\thtml += time;\r\n\t\thtml += \"</div>\";\r\n\t\treturn html;\r\n\t};\r\n\r\n\tTimeControl.prototype.set_value = function (node, value, ev, config) {\r\n\t\tvar cfg = config;\r\n\t\tvar s = node.getElementsByTagName(\"select\");\r\n\t\tvar map = config._time_format_order;\r\n\r\n\t\tif (cfg.auto_end_date) {\r\n\t\t\tvar _update_lightbox_select = function () {\r\n\t\t\t\tstart_date = new Date(s[map[2]].value, s[map[1]].value, s[map[0]].value, 0, 0);\r\n\t\t\t\tend_date = gantt.calculateEndDate({ start_date: start_date, duration: 1, task: ev });\r\n\t\t\t\tgantt.form_blocks._fill_lightbox_select(s, map.size, end_date, map, cfg);\r\n\t\t\t};\r\n\t\t\tfor (var i = 0; i < 4; i++) {\r\n\t\t\t\ts[i].onchange = _update_lightbox_select;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar mapping = gantt._resolve_default_mapping(config);\r\n\r\n\t\tif (typeof (mapping) === \"string\") mapping = { start_date: mapping };\r\n\r\n\t\tvar start_date = ev[mapping.start_date] || new Date();\r\n\t\tvar end_date = ev[mapping.end_date] || gantt.calculateEndDate({\r\n\t\t\tstart_date: start_date,\r\n\t\t\tduration: 1,\r\n\t\t\ttask: ev\r\n\t\t});\r\n\r\n\t\tgantt.form_blocks._fill_lightbox_select(s, 0, start_date, map, cfg);\r\n\t\tgantt.form_blocks._fill_lightbox_select(s, map.size, end_date, map, cfg);\r\n\t};\r\n\r\n\tTimeControl.prototype.get_value = function (node, ev, config) {\r\n\t\tvar selects = node.getElementsByTagName(\"select\");\r\n\t\tvar startDate;\r\n\t\tvar map = config._time_format_order;\r\n\t\tfunction _getEndDate(selects, map, startDate) {\r\n\t\t\tvar endDate = gantt.form_blocks.getTimePickerValue(selects, config, map.size);\r\n\t\t\t// GS-1010: We need to add a way to obtain exact end_date for validation\r\n\t\t\tif (endDate <= startDate) {  // when end date seems wrong\r\n\t\t\t\tif (config.autofix_end !== false || config.single_date) { // auto correct it in two cases - when the auto correction is not disabled, or when we have 'single date' control and the user don't have the UI to specify the end date\r\n\t\t\t\t\treturn gantt.date.add(startDate, gantt._get_timepicker_step(), \"minute\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn endDate;\r\n\t\t}\r\n\r\n\t\tstartDate = gantt.form_blocks.getTimePickerValue(selects, config);\r\n\r\n\t\tif (typeof gantt._resolve_default_mapping(config) === \"string\") {\r\n\t\t\treturn startDate;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tstart_date: startDate,\r\n\t\t\tend_date: _getEndDate(selects, map, startDate)\r\n\t\t};\r\n\t};\r\n\r\n\tTimeControl.prototype.focus = function (node) {\r\n\t\tgantt._focus(node.getElementsByTagName(\"select\")[0]);\r\n\t};\r\n\r\n\treturn TimeControl;\r\n};","import * as helpers from \"../../../utils/helpers\";\r\n\r\nvar htmlHelpers = {\r\n\tgetHtmlSelect: function(options, attributes, value) {\r\n\t\tvar innerHTML = \"\";\r\n\t\tvar _this = this;\r\n\r\n\t\toptions = options || [];\r\n\t\t\r\n\t\thelpers.forEach(options, function(entry) {\r\n\t\t\tvar _attributes = [{ key: \"value\", value: entry.key }];\r\n\r\n\t\t\tif (value == entry.key) {\r\n\t\t\t\t_attributes[_attributes.length] = { key: \"selected\", value: \"selected\" };\r\n\t\t\t}\r\n\t\t\tif (entry.attributes) {\r\n\t\t\t\t_attributes = _attributes.concat(entry.attributes);\r\n\t\t\t}\r\n\t\t\tinnerHTML += _this.getHtmlOption({ innerHTML: entry.label }, _attributes);\r\n\t\t});\r\n\r\n\t\treturn _getHtmlContainer(\"select\", { innerHTML: innerHTML }, attributes);\r\n\t},\r\n\tgetHtmlOption: function(options, attributes) { return _getHtmlContainer(\"option\", options, attributes); },\r\n\tgetHtmlButton: function(options, attributes) { return _getHtmlContainer(\"button\", options, attributes); },\r\n\tgetHtmlDiv: function(options, attributes) { return _getHtmlContainer(\"div\", options, attributes); },\r\n\tgetHtmlLabel: function(options, attributes) { return _getHtmlContainer(\"label\", options, attributes); },\r\n\tgetHtmlInput: function(attributes) {\r\n\t\treturn \"<input\" + _getHtmlAttributes(attributes || []) + \">\";\r\n\t}\r\n};\r\n\r\nfunction _getHtmlContainer(tag, options, attributes) {\r\n\tvar html;\r\n\r\n\toptions = options || [];\r\n\t\r\n\thtml = \"<\" + tag + _getHtmlAttributes(attributes || []) + \">\" + (options.innerHTML || \"\") + \"</\" + tag +\">\";\r\n\treturn html;\r\n\r\n}\r\n\r\nfunction _getHtmlAttributes(attributes) {\r\n\tvar html = \"\";\r\n\r\n\thelpers.forEach(attributes, function(entry) {\r\n\t\thtml += \" \" + entry.key + \"='\" + entry.value + \"'\";\r\n\t});\r\n\treturn html;\r\n}\r\n\r\nexport default htmlHelpers;","import __extends from \"../../../../utils/extends\";\r\nimport htmlHelpers from \"../../utils/html_helpers\";\r\n\r\nimport Super from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tconst _super = Super(gantt);\r\n\r\n\tfunction SelectControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this;\r\n\t\r\n\t\treturn self; \r\n\t}\r\n\t\r\n\t__extends(SelectControl, _super);\r\n\t\r\n\tSelectControl.prototype.render = function(sns) {\r\n\t\tconst height = sns.height ? `height:${sns.height}px;` : '';\r\n\t\tlet html = `<div class='gantt_cal_ltext gantt_section_${sns.name}' ${height ? `style='${height}'` : ''}>`;\r\n\r\n\t\thtml += htmlHelpers.getHtmlSelect(sns.options, [{ key: \"style\", value: \"width:100%;\" }, { key: \"title\", value: sns.name }]);\r\n\t\thtml += \"</div>\";\r\n\t\treturn html;\r\n\t};\r\n\r\n\tSelectControl.prototype.set_value = function(node, value, ev, sns) {\r\n\t\tvar select = node.firstChild;\r\n\t\tif (!select._dhx_onchange && sns.onchange) {\r\n\t\t\tselect.onchange = sns.onchange;\r\n\t\t\tselect._dhx_onchange = true;\r\n\t\t}\r\n\t\tif (typeof value === \"undefined\")\r\n\t\t\tvalue = (select.options[0] || {}).value;\r\n\t\tselect.value = value || \"\";\r\n\t};\r\n\t\r\n\tSelectControl.prototype.get_value = function(node) {\r\n\t\treturn node.firstChild.value;\r\n\t};\r\n\t\r\n\tSelectControl.prototype.focus = function(node) {\r\n\t\tvar a = node.firstChild;\r\n\t\tgantt._focus(a, true);\r\n\t};\r\n\t\r\n\treturn SelectControl;\r\n};","import * as helpers from \"../../../../utils/helpers\";\r\nimport __extends from \"../../../../utils/extends\";\r\nimport BaseConstrutor from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tvar _super = BaseConstrutor(gantt);\r\n\r\n\tfunction CheckboxControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this;\r\n\r\n\t\treturn self; \r\n\t}\r\n\r\n\t__extends(CheckboxControl, _super);\r\n\r\n\tCheckboxControl.prototype.render = function(sns) {\r\n\t\tconst height = sns.height ? `height:${sns.height}px;` : '';\r\n\t\tlet html = `<div class='gantt_cal_ltext gantt_cal_lcheckbox gantt_section_${sns.name}' ${height ? `style='${height}'` : ''}>`;\r\n\r\n\t\tif (sns.options && sns.options.length) {\r\n\t\t\tfor (var i = 0; i < sns.options.length; i++) {\r\n\t\t\t\thtml += \"<label><input type='checkbox' value='\" + sns.options[i].key + \"' name='\" + sns.name + \"'>\" + sns.options[i].label + \"</label>\";\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tsns.single_value = true;\r\n\t\t\thtml += \"<label><input type='checkbox' name='\" + sns.name + \"'></label>\";\r\n\t\t}\r\n\t\thtml += \"</div>\";\r\n\t\treturn html;\r\n\t};\r\n\r\n\tCheckboxControl.prototype.set_value = function(node, value, ev, sns) {\r\n\t\tvar checkboxes = Array.prototype.slice.call(node.querySelectorAll(\"input[type=checkbox]\"));\r\n\r\n\t\tif (!node._dhx_onchange && sns.onchange) {\r\n\t\t\tnode.onchange = sns.onchange;\r\n\t\t\tnode._dhx_onchange = true;\r\n\t\t}\r\n\r\n\t\tif(sns.single_value){\r\n\t\t\tvar box = checkboxes[0];\r\n\t\t\tbox.checked = !!value;\r\n\t\t}else{\r\n\t\t\thelpers.forEach(checkboxes, function(entry) {\r\n\t\t\t\tentry.checked = value ? value.indexOf(entry.value) >= 0 : false;\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tCheckboxControl.prototype.get_value = function(node, task, sns) {\r\n\t\tif(sns.single_value){\r\n\t\t\tvar box = node.querySelector(\"input[type=checkbox]\");\r\n\t\t\treturn box.checked;\r\n\t\t}else{\r\n\t\t\treturn helpers.arrayMap(Array.prototype.slice.call(node.querySelectorAll(\"input[type=checkbox]:checked\")), function(entry) {\r\n\t\t\t\treturn entry.value;\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tCheckboxControl.prototype.focus = function(node) {\r\n\t\tgantt._focus(node.querySelector(\"input[type=checkbox]\"));\r\n\t};\r\n\r\n\treturn CheckboxControl;\r\n};","import __extends from \"../../../../utils/extends\";\r\nimport Super from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tconst _super = Super(gantt);\r\n\r\n\tfunction RadioControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this;\r\n\r\n\t\treturn self; \r\n\t}\r\n\r\n\t__extends(RadioControl, _super);\r\n\r\n\tRadioControl.prototype.render = function(sns) {\r\n\t\tconst height = sns.height ? `${sns.height}px` : '';\r\n\t\tlet html = `<div class='gantt_cal_ltext gantt_cal_lradio gantt_section_${sns.name}' ${height ? `style='height:${height};'` : ''}>`;\r\n\r\n\t\tif (sns.options && sns.options.length) {\r\n\t\t\tfor (var i = 0; i < sns.options.length; i++) {\r\n\t\t\t\thtml += \"<label><input type='radio' value='\" + sns.options[i].key + \"' name='\" + sns.name + \"'>\" + sns.options[i].label + \"</label>\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\thtml += \"</div>\";\r\n\t\treturn html;\r\n\t};\r\n\r\n\tRadioControl.prototype.set_value = function(node, value, ev, sns) {\r\n\t\tvar radio;\r\n\r\n\t\tif (!sns.options || !sns.options.length) return;\r\n\r\n\t\tradio = node.querySelector(\"input[type=radio][value='\" + value + \"']\") ||\r\n\t\t\t\tnode.querySelector(\"input[type=radio][value='\" + sns.default_value + \"']\");\r\n\r\n\t\tif (!radio) return;\r\n\r\n\t\tif (!node._dhx_onchange && sns.onchange) {\r\n\t\t\tnode.onchange = sns.onchange;\r\n\t\t\tnode._dhx_onchange = true;\r\n\t\t}\r\n\r\n\t\tradio.checked = true;\r\n\t};\r\n\r\n\tRadioControl.prototype.get_value = function(node, ev) {\r\n\t\tvar result = node.querySelector(\"input[type=radio]:checked\");\r\n\r\n\t\treturn result ? result.value : \"\";\r\n\t};\r\n\r\n\tRadioControl.prototype.focus = function(node) {\r\n\t\tgantt._focus(node.querySelector(\"input[type=radio]\"));\r\n\t};\r\n\r\n\treturn RadioControl;\r\n};","import __extends from \"../../../../utils/extends\";\r\n\r\nimport DurationFormatterNumeric from  \"../../../common/duration_formatter_numeric\";\r\nimport BaseConstrutor from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tvar _super = BaseConstrutor(gantt);\r\n\r\n\tfunction DurationControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this; \r\n\r\n\t\treturn self; \r\n\t}\r\n\r\n\tfunction getFormatter(config) {\r\n\t\treturn config.formatter || new DurationFormatterNumeric();\r\n\t}\r\n\r\n\t__extends(DurationControl, _super);\r\n\r\n\tDurationControl.prototype.render = function(sns) {\r\n\t\tvar time = \"<div class='gantt_time_selects'>\" + gantt.form_blocks.getTimePicker.call(this, sns) + \"</div>\";\r\n\t\tvar label = \" \"+ gantt.locale.labels[gantt.config.duration_unit + \"s\"] +\" \";\r\n\t\tvar singleDate = sns.single_date ? \" style='display:none'\" : \"\";\r\n\t\tvar readonly = sns.readonly ? \" disabled='disabled'\" : \"\";\r\n\t\tvar ariaAttr = gantt._waiAria.lightboxDurationInputAttrString(sns);\r\n\r\n\t\tvar durationInputClass = \"gantt_duration_value\";\r\n\t\tif(sns.formatter) {\r\n\t\t\tlabel = \"\";\r\n\t\t\tdurationInputClass += \" gantt_duration_value_formatted\" ;\r\n\t\t}\r\n\r\n\t\tvar duration = \"<div class='gantt_duration' \" + singleDate + \">\" +\r\n\t\t\"<div class='gantt_duration_inputs'>\" +\r\n\t\t\t\"<input type='button' class='gantt_duration_dec' value=''\" + readonly + \">\" +\r\n\t\t\t\"<input type='text' value='5days' class='\"+durationInputClass+\"'\" + readonly + \" \" + ariaAttr + \">\" +\r\n\t\t\t\"<input type='button' class='gantt_duration_inc' value='+'\" + readonly + \">\"+\r\n\t\t\t\"</div>\" +\r\n\t\t\t\"<div class='gantt_duration_end_date'>\"+label+\"<span></span></div>\" +\r\n\t\t\t\"</div>\" +\r\n\t\t\t\"</div>\";\r\n\t\tlet sectionClassName = \"gantt_section_time gantt_section_duration\";\r\n\t\tif (sns.name !== \"time\"){\r\n\t\t\tsectionClassName += \" gantt_section_\" + sns.name;\r\n\t\t}\t\r\n\t\tvar html = \"<div style='padding-top:0px;font-size:inherit;' class='\" + sectionClassName + \"'>\" + time + \" \" + duration + \"</div>\";\r\n\t\treturn html;\r\n\t};\r\n\r\n\tDurationControl.prototype.set_value = function(node, value, ev, config) {\r\n\t\tvar s = node.getElementsByTagName(\"select\");\r\n\t\tvar inps = node.getElementsByTagName(\"input\");\r\n\t\tvar duration = inps[1];\r\n\t\tvar btns = [inps[0], inps[2]];\r\n\t\tvar endspan = node.getElementsByTagName(\"span\")[0];\r\n\t\tvar map = config._time_format_order;\r\n\t\tvar mapping;\r\n\t\tvar start_date;\r\n\t\tvar end_date;\r\n\t\tvar duration_val;\r\n\r\n\t\tfunction _calc_date() {\r\n\t\t\tvar start_date = _getStartDate.call(gantt, node, config);\r\n\t\t\tvar duration = _getDuration.call(gantt, node, config);\r\n\t\t\tvar end_date = gantt.calculateEndDate({start_date: start_date, duration: duration, task: ev});\r\n\r\n\t\t\tvar template = gantt.templates.task_end_date || gantt.templates.task_date;\r\n\t\t\tendspan.innerHTML = template(end_date);\r\n\t\t}\r\n\r\n\t\tfunction _change_duration(step) {\r\n\t\t\tvar value = duration.value;\r\n\r\n\t\t\tvalue = getFormatter(config).parse(value);\r\n\t\t\tif (window.isNaN(value))\r\n\t\t\t\tvalue = 0;\r\n\t\t\tvalue += step;\r\n\t\t\tif (value < 1) value = 1;\r\n\t\t\tduration.value = getFormatter(config).format(value);\r\n\t\t\t_calc_date();\r\n\t\t}\r\n\r\n\t\tbtns[0].onclick = gantt.bind(function() {\r\n\t\t\t_change_duration(-1 * gantt.config.duration_step);\r\n\t\t}, this);\r\n\t\tbtns[1].onclick = gantt.bind(function() {\r\n\t\t\t_change_duration(1 * gantt.config.duration_step);\r\n\t\t}, this);\r\n\t\ts[0].onchange = _calc_date;\r\n\t\ts[1].onchange = _calc_date;\r\n\t\ts[2].onchange = _calc_date;\r\n\t\tif (s[3]) s[3].onchange = _calc_date;\r\n\r\n\t\tduration.onkeydown = gantt.bind(function(e) {\r\n\t\t\tvar code; \r\n\r\n\t\t\te = e || window.event;\r\n\t\t\tcode = (e.charCode || e.keyCode || e.which);\r\n\t\t\t\r\n\t\t\tif (code == gantt.constants.KEY_CODES.DOWN) {\r\n\t\t\t\t_change_duration(-1 * gantt.config.duration_step);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (code == gantt.constants.KEY_CODES.UP) {\r\n\t\t\t\t_change_duration(1 * gantt.config.duration_step);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\twindow.setTimeout(_calc_date, 1);\r\n\t\t}, this);\r\n\r\n\t\tduration.onchange = gantt.bind(_calc_date, this);\r\n\r\n\t\tmapping = gantt._resolve_default_mapping(config);\r\n\t\tif (typeof(mapping) === \"string\") mapping = {start_date: mapping};\r\n\r\n\t\tstart_date = ev[mapping.start_date] || new Date();\r\n\t\tend_date = ev[mapping.end_date] || gantt.calculateEndDate({\r\n\t\t\tstart_date: start_date,\r\n\t\t\tduration: 1,\r\n\t\t\ttask: ev\r\n\t\t});\r\n\t\tduration_val = Math.round(ev[mapping.duration]) || gantt.calculateDuration({\r\n\t\t\tstart_date: start_date,\r\n\t\t\tend_date: end_date,\r\n\t\t\ttask: ev\r\n\t\t});\r\n\t\tduration_val = getFormatter(config).format(duration_val);\r\n\r\n\t\tgantt.form_blocks._fill_lightbox_select(s, 0, start_date, map, config);\r\n\t\tduration.value = duration_val;\r\n\t\t_calc_date();\r\n\t};\r\n\r\n\tDurationControl.prototype.get_value = function(node, ev, config) {\r\n\t\tvar startDate = _getStartDate(node, config);\r\n\t\tvar duration = _getDuration(node, config);\r\n\t\tvar endDate = gantt.calculateEndDate({start_date: startDate, duration: duration, task: ev});\r\n\r\n\t\tif (typeof gantt._resolve_default_mapping(config) == \"string\") {\r\n\t\t\treturn startDate;\r\n\t\t}\r\n\t\t//GS-3144: consider scale-projection\r\n\t\tif(gantt.getScale().projection && gantt.getCalendar(\"timescale-projection-calendar\")){\r\n\t\t\tconst projectionCalendar = gantt.getCalendar(\"timescale-projection-calendar\");\r\n\t\t\tstartDate = projectionCalendar.getClosestWorkTime({ \r\n\t\t\t\tdate: startDate, \r\n\t\t\t\tunit: gantt.config.duration_unit,\r\n\t\t\t\tdir: \"future\" \r\n\t\t\t});\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tstart_date: startDate,\r\n\t\t\tend_date: endDate,\r\n\t\t\tduration: duration\r\n\t\t};\r\n\t};\r\n\r\n\tDurationControl.prototype.focus = function(node) {\r\n\t\tgantt._focus(node.getElementsByTagName(\"select\")[0]);\r\n\t};\r\n\r\n\r\n\tfunction _getStartDate(node, config) {\r\n\t\tvar s = node.getElementsByTagName(\"select\");\r\n\t\tvar map = config._time_format_order;\r\n\t\tvar hours = 0;\r\n\t\tvar minutes = 0;\r\n\r\n\t\tif (gantt.defined(map[3])) {\r\n\t\t\tvar input = s[map[3]];\r\n\t\t\tvar time = parseInt(input.value, 10);\r\n\t\t\tif (isNaN(time) && input.hasAttribute(\"data-value\")) {\r\n\t\t\t\ttime = parseInt(input.getAttribute(\"data-value\"), 10);\r\n\t\t\t}\r\n\r\n\t\t\thours = Math.floor(time / 60);\r\n\t\t\tminutes = time % 60;\r\n\t\t}\r\n\t\treturn new Date(s[map[2]].value, s[map[1]].value, s[map[0]].value, hours, minutes);\r\n\t}\r\n\r\n\tfunction _getDuration(node, config) {\r\n\t\tvar duration = node.getElementsByTagName(\"input\")[1];\r\n\r\n\t\tduration = getFormatter(config).parse(duration.value);\r\n\t\tif (!duration || window.isNaN(duration)) duration = 1;\r\n\t\tif (duration < 0) duration *= -1;\r\n\t\treturn duration;\r\n\t}\r\n\r\n\treturn DurationControl; \r\n};","import __extends from \"../../../../utils/extends\";\r\nimport SelectControl from \"./select_control\";\r\nexport default function(gantt) {\r\n\tvar _super = SelectControl(gantt);\r\n\r\n\tfunction ParentControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this; \r\n\r\n\t\treturn self; \r\n\t}\r\n\r\n\t__extends(ParentControl, _super);\r\n\r\n\r\n\tParentControl.prototype.render = function(sns) {\r\n\t\treturn _display(sns, false);\r\n\t};\r\n\r\n\tParentControl.prototype.set_value = function(node, value, ev, config) {\r\n\t\t// GS-1051. If the value is `0`, the set_value function in the select control won't select \r\n\t\t// the first child because (0 || '') = '';\r\n\t\tif (value === 0) value = \"0\";\r\n\r\n\t\t// GS-1374. Usually, the ID is not specified,\r\n\t\t// we need to add it to keep the options and exclude the current task\r\n\t\tif (!ev.id && gantt.getState().lightbox) {\r\n\t\t\tev.id = gantt.getLightboxValues().id;\r\n\t\t}\r\n\r\n\t\tvar tmpDom = document.createElement(\"div\");\r\n\t\ttmpDom.innerHTML = _display(config, ev.id);\r\n\t\tvar newOptions = tmpDom.removeChild(tmpDom.firstChild);\r\n\t\tnode.onselect = null;\r\n\t\tnode.parentNode.replaceChild(newOptions, node);\r\n\r\n\t\treturn gantt.form_blocks.select.set_value.apply(gantt, [newOptions, value, ev, config]);\r\n\t};\r\n\r\n\tfunction _display(config, item_id) {\r\n\t\tvar tasks = [],\r\n\t\t\toptions = [];\r\n\t\tif (item_id) {\r\n\t\t\ttasks = gantt.getTaskByTime();\r\n\t\t\tif (config.allow_root) {\r\n\t\t\t\ttasks.unshift({id: gantt.config.root_id, text: config.root_label || \"\"});\r\n\t\t\t}\r\n\t\t\ttasks = _filter(tasks, config, item_id);\r\n\t\t\tif (config.sort) {\r\n\t\t\t\ttasks.sort(config.sort);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar text = config.template || gantt.templates.task_text;\r\n\t\tfor (var i = 0; i < tasks.length; i++) {\r\n\t\t\tvar label = text.apply(gantt, [tasks[i].start_date, tasks[i].end_date, tasks[i]]);\r\n\t\t\tif (label === undefined) {\r\n\t\t\t\tlabel = \"\";\r\n\t\t\t}\r\n\t\t\toptions.push({\r\n\t\t\t\tkey: tasks[i].id,\r\n\t\t\t\tlabel: label\r\n\t\t\t});\r\n\t\t}\r\n\t\tconfig.options = options;\r\n\t\tconfig.map_to = config.map_to || \"parent\";\r\n\t\treturn gantt.form_blocks.select.render.apply(this, arguments);\r\n\t}\r\n\r\n\tfunction _filter(options, config, item_id) {\r\n\t\tvar filter = config.filter || function() {\r\n\t\t\treturn true;\r\n\t\t};\r\n\r\n\t\toptions = options.slice(0);\r\n\r\n\t\tfor (var i = 0; i < options.length; i++) {\r\n\t\t\tvar task = options[i];\r\n\t\t\tif (task.id == item_id || gantt.isChildOf(task.id, item_id) || filter(task.id, task) === false) {\r\n\t\t\t\toptions.splice(i, 1);\r\n\t\t\t\ti--;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn options;\r\n\t}\r\n\treturn ParentControl;\r\n};","import __extends from \"../../../../utils/extends\";\r\nimport htmlHelpers from \"../../utils/html_helpers\";\r\nimport BaseConstrutor from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tvar _super = BaseConstrutor(gantt);\r\n\r\n\tfunction ConstraintControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this;\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(ConstraintControl, _super);\r\n\r\n\tfunction isNonTimedConstraint(value) {\r\n\t\tif (!value || value === gantt.config.constraint_types.ASAP || value === gantt.config.constraint_types.ALAP) {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction toggleTimeSelect(timeSelects, typeValue) {\r\n\t\tvar isNonTimed = isNonTimedConstraint(typeValue);\r\n\t\tfor (var i = 0; i < timeSelects.length; i++) {\r\n\t\t\ttimeSelects[i].disabled = isNonTimed;\r\n\t\t}\r\n\t}\r\n\r\n\tConstraintControl.prototype.render = function (sns) {\r\n\t\tconst height = sns.height ? `height:${sns.height}px;` : '';\r\n\t\tlet html = `<div class='gantt_cal_ltext gantt_section_${sns.name}' ${height ? `style='${height}'` : ''}>`;\r\n\r\n\t\tvar options = [];\r\n\t\tfor (var i in gantt.config.constraint_types) {\r\n\t\t\toptions.push({ key: gantt.config.constraint_types[i], label: gantt.locale.labels[gantt.config.constraint_types[i]] });\r\n\t\t}\r\n\r\n\t\tsns.options = sns.options || options;\r\n\r\n\t\thtml += \"<span data-constraint-type-select>\" + htmlHelpers.getHtmlSelect(sns.options, [{ key: \"data-type\", value: \"constraint-type\" }]) + \"</span>\";\r\n\r\n\t\tvar timeLabel = gantt.locale.labels[\"constraint_date\"] || \"Constraint date\";\r\n\t\thtml += \"<label data-constraint-time-select>\" + timeLabel + \": \" + gantt.form_blocks.getTimePicker.call(this, sns) + \"</label>\";\r\n\r\n\t\thtml += \"</div>\";\r\n\t\treturn html;\r\n\t};\r\n\r\n\tConstraintControl.prototype.set_value = function (node, value, task, config) {\r\n\t\tvar typeSelect = node.querySelector(\"[data-constraint-type-select] select\");\r\n\t\tvar timeSelects = node.querySelectorAll(\"[data-constraint-time-select] select\");\r\n\t\tvar map = config._time_format_order;\r\n\r\n\t\tvar mapping = gantt._resolve_default_mapping(config);\r\n\r\n\t\tif (!typeSelect._eventsInitialized) {\r\n\t\t\ttypeSelect.addEventListener(\"change\", function (e) {\r\n\t\t\t\ttoggleTimeSelect(timeSelects, e.target.value);\r\n\t\t\t});\r\n\t\t\ttypeSelect._eventsInitialized = true;\r\n\t\t}\r\n\r\n\t\tvar constraintDate = task[mapping.constraint_date] || new Date();\r\n\t\tgantt.form_blocks._fill_lightbox_select(timeSelects, 0, constraintDate, map, config);\r\n\r\n\t\tvar constraintType = task[mapping.constraint_type] || gantt.getConstraintType(task);\r\n\t\ttypeSelect.value = constraintType;\r\n\t\ttoggleTimeSelect(timeSelects, constraintType);\r\n\t};\r\n\r\n\tConstraintControl.prototype.get_value = function (node, task, config) {\r\n\t\tvar typeSelect = node.querySelector(\"[data-constraint-type-select] select\");\r\n\t\tvar timeSelects = node.querySelectorAll(\"[data-constraint-time-select] select\");\r\n\r\n\t\tvar constraintType = typeSelect.value;\r\n\t\tvar constraintDate = null;\r\n\t\tif (!isNonTimedConstraint(constraintType)) {\r\n\t\t\tconstraintDate = gantt.form_blocks.getTimePickerValue(timeSelects, config);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tconstraint_type: constraintType,\r\n\t\t\tconstraint_date: constraintDate\r\n\t\t};\r\n\t};\r\n\r\n\tConstraintControl.prototype.focus = function (node) {\r\n\t\tgantt._focus(node.querySelector(\"select\"));\r\n\t};\r\n\r\n\treturn ConstraintControl;\r\n};","import __extends from \"../../../../utils/extends\";\r\n\r\nimport Super from \"./select_control\";\r\n\r\nexport default function(gantt) {\r\n\tconst _super = Super(gantt);\r\n\r\n\tfunction TypeselectControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this;\r\n\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(TypeselectControl, _super);\r\n\r\n\tTypeselectControl.prototype.render = function(sns) {\r\n\t\tvar types = gantt.config.types,\r\n\t\t\tlocale = gantt.locale.labels,\r\n\t\t\toptions = [];\r\n\r\n\t\tvar filter = sns.filter || function (typeKey, typeValue) {\r\n\t\t\tif (!types.placeholder || typeValue !== types.placeholder) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t};\r\n\t\tfor (var i in types) {\r\n\t\t\tif (!filter(i, types[i]) === false) {\r\n\t\t\t\toptions.push({ key: types[i], label: locale[\"type_\" + i] });\r\n\t\t\t}\r\n\t\t}\r\n\t\tsns.options = options;\r\n\r\n\t\tvar oldOnChange = sns.onchange;\r\n\t\tsns.onchange = function () {\r\n\t\t\tgantt._lightbox_current_type = this.value;\r\n\t\t\tgantt.changeLightboxType(this.value);\r\n\t\t\tif (typeof oldOnChange == 'function') {\r\n\t\t\t\toldOnChange.apply(this, arguments);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\treturn _super.prototype.render.apply(this, arguments);\r\n\t};\r\n\r\n\treturn TypeselectControl;\r\n};\r\n","\r\nimport __extends from \"../../../../utils/extends\";\r\nimport DurationFormatterNumeric from \"../../../common/duration_formatter_numeric\";\r\nimport BaseConstrutor from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tvar _super = BaseConstrutor(gantt);\r\n\r\n\tfunction DurationControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this; \r\n\r\n\t\treturn self; \r\n\t}\r\n\r\n\tfunction getFormatter(config) {\r\n\t\treturn config.formatter || new DurationFormatterNumeric();\r\n\t}\r\n\r\n\tfunction _generateBaselineRow (node, baseline, task, config){\r\n\t\tconst time = \"<div class='gantt_time_selects'>\" + gantt.form_blocks.getTimePicker.call(gantt, config) + \"</div>\";\r\n\t\tlet durationLabel = \" \"+ gantt.locale.labels[gantt.config.duration_unit + \"s\"] +\" \";\r\n\t\tconst singleDate = config.single_date ? \" style='display:none'\" : \"\";\r\n\t\tconst readonly = config.readonly ? \" disabled='disabled'\" : \"\";\r\n\t\tconst ariaAttr = gantt._waiAria.lightboxDurationInputAttrString(config);\r\n\t\tconst deleteLabel = gantt.locale.labels.baselines_remove_button;\r\n\r\n\t\tlet durationInputClass = \"gantt_duration_value\";\r\n\t\tif(config.formatter) {\r\n\t\t\tdurationLabel = \"\";\r\n\t\t\tdurationInputClass += \" gantt_duration_value_formatted\";\r\n\t\t}\r\n\r\n\t\tconst durationEl = \"<div class='gantt_duration' \" + singleDate + \">\" +\r\n\t\t\"<div class='gantt_duration_inputs'>\" +\r\n\t\t\t\"<input type='button' class='gantt_duration_dec' value='-'\" + readonly + \">\" +\r\n\t\t\t\"<input type='text' value='5days' class='\"+durationInputClass+\"'\" + readonly + \" \" + ariaAttr + \">\" +\r\n\t\t\t\"<input type='button' class='gantt_duration_inc' value='+'\" + readonly + \">\"+\r\n\t\t\t\"</div>\" +\r\n\t\t\t\"<div class='gantt_duration_end_date'>\"+durationLabel+\"<span></span></div>\" +\r\n\t\t\t\"</div>\" +\r\n\t\t\t\"</div>\";\r\n\r\n\t\tconst deleteButton = `<div><div class='baseline_delete_button gantt_custom_button dhx_gantt_icon dhx_gantt_icon_delete' aria-label='${deleteLabel}'></div></div>`;\r\n\r\n\t\tconst baselineRow = document.createElement(\"div\");\r\n\t\tbaselineRow.className = \"gantt_section_time gantt_section_duration\";\r\n\t\tbaselineRow.setAttribute(\"data-baseline-id\", baseline.id);\r\n\t\tbaselineRow.innerHTML = time + durationEl + deleteButton + \"<br>\";\r\n\t\tnode.appendChild(baselineRow);\r\n\r\n\t\tvar s = baselineRow.getElementsByTagName(\"select\");\r\n\t\tvar inps = baselineRow.getElementsByTagName(\"input\");\r\n\t\tvar duration = inps[1];\r\n\t\tvar btns = [inps[0], inps[2]];\r\n\t\tvar endspan = baselineRow.getElementsByTagName(\"span\")[0];\r\n\t\tvar map = config._time_format_order;\r\n\t\tvar mapping;\r\n\t\tvar start_date;\r\n\t\tvar end_date;\r\n\t\tvar duration_val;\r\n\r\n\t\tconst deleteEl = baselineRow.querySelector(\".baseline_delete_button\");\r\n\t\tdeleteEl.onclick = function(e){\r\n\t\t\tconst section = baselineRow.parentNode;\r\n\t\t\tbaselineRow.innerHTML = \"\";\r\n\t\t\tbaselineRow.remove();\r\n\t\t\tif (section.innerHTML === \"\"){\r\n\t\t\t\tsection.innerHTML = gantt.locale.labels.baselines_section_placeholder;\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\r\n\t\tfunction _calc_date() {\r\n\t\t\tvar start_date = _getStartDate.call(gantt, baselineRow, config);\r\n\t\t\tvar duration = _getDuration.call(gantt, baselineRow, config);\r\n\t\t\tvar end_date = gantt.calculateEndDate({start_date: start_date, duration: duration, task: task});\r\n\r\n\t\t\tvar template = gantt.templates.task_end_date || gantt.templates.task_date;\r\n\t\t\tendspan.innerHTML = template(end_date);\r\n\t\t}\r\n\r\n\t\tfunction _change_duration(step) {\r\n\t\t\tvar value = duration.value;\r\n\r\n\t\t\tvalue = getFormatter(config).parse(value);\r\n\t\t\tif (window.isNaN(value))\r\n\t\t\t\tvalue = 0;\r\n\t\t\tvalue += step;\r\n\t\t\tif (value < 1) value = 1;\r\n\t\t\tduration.value = getFormatter(config).format(value);\r\n\t\t\t_calc_date();\r\n\t\t}\r\n\r\n\t\tbtns[0].onclick = gantt.bind(function() {\r\n\t\t\t_change_duration(-1 * gantt.config.duration_step);\r\n\t\t}, gantt);\r\n\t\tbtns[1].onclick = gantt.bind(function() {\r\n\t\t\t_change_duration(1 * gantt.config.duration_step);\r\n\t\t}, gantt);\r\n\t\ts[0].onchange = _calc_date;\r\n\t\ts[1].onchange = _calc_date;\r\n\t\ts[2].onchange = _calc_date;\r\n\t\tif (s[3]) s[3].onchange = _calc_date;\r\n\r\n\t\tduration.onkeydown = gantt.bind(function(e) {\r\n\t\t\tvar code; \r\n\r\n\t\t\te = e || window.event;\r\n\t\t\tcode = (e.charCode || e.keyCode || e.which);\r\n\t\t\t\r\n\t\t\tif (code == gantt.constants.KEY_CODES.DOWN) {\r\n\t\t\t\t_change_duration(-1 * gantt.config.duration_step);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (code == gantt.constants.KEY_CODES.UP) {\r\n\t\t\t\t_change_duration(1 * gantt.config.duration_step);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\twindow.setTimeout(_calc_date, 1);\r\n\t\t}, gantt);\r\n\r\n\t\tduration.onchange = gantt.bind(_calc_date, gantt);\r\n\r\n\t\tmapping = gantt._resolve_default_mapping(config);\r\n\t\tif (typeof(mapping) === \"string\") mapping = {start_date: mapping};\r\n\r\n\t\tstart_date = baseline.start_date || new Date();\r\n\t\tend_date = baseline.end_date || gantt.calculateEndDate({\r\n\t\t\tstart_date: start_date,\r\n\t\t\tduration: 1,\r\n\t\t\ttask\r\n\t\t});\r\n\t\tduration_val = gantt.calculateDuration({\r\n\t\t\tstart_date: start_date,\r\n\t\t\tend_date: end_date,\r\n\t\t\ttask\r\n\t\t});\r\n\t\tduration_val = getFormatter(config).format(duration_val);\r\n\r\n\t\tgantt.form_blocks._fill_lightbox_select(s, 0, start_date, map, config);\r\n\t\tduration.value = duration_val;\r\n\t\t_calc_date();\r\n\t}\r\n\r\n\t__extends(DurationControl, _super);\r\n\r\n\tDurationControl.prototype.render = function(sns) {\r\n\t\tconst baselineSection = `<div style='height: ${sns.height || 110}px; font-size:inherit;' class='gantt_section_baselines'></div>`;\r\n\t\treturn baselineSection;\r\n\t};\r\n\r\n\tDurationControl.prototype.set_value = function(node, value, task, config) {\r\n\t\tif (task.baselines){\r\n\t\t\tnode.innerHTML = \"\";\r\n\r\n\t\t\ttask.baselines.forEach((baseline)=>{\r\n\t\t\t\t_generateBaselineRow(node, baseline, task, config);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tnode.innerHTML = gantt.locale.labels.baselines_section_placeholder;\r\n\t\t}\t\t\r\n\r\n\t};\r\n\r\n\tDurationControl.prototype.get_value = function(node, task, config) {\r\n\t\tconst baselines = [];\r\n\t\tconst baselineRows = node.querySelectorAll(`[data-baseline-id]`);\r\n\t\tbaselineRows.forEach((baselineNode)=>{\r\n\t\t\tconst baselineId = baselineNode.dataset.baselineId;\r\n\t\t\tconst baselineStore = gantt.getDatastore(\"baselines\");\r\n\t\t\tlet baseline = baselineStore.getItem(baselineId);\r\n\t\t\tlet updatedBaseline;\r\n\t\t\tif (baseline){\r\n\t\t\t\tupdatedBaseline = gantt.copy(baseline);\r\n\t\t\t} else {\r\n\t\t\t\tupdatedBaseline = {\r\n\t\t\t\t\tid: gantt.uid(),\r\n\t\t\t\t\ttask_id: task.id,\r\n\t\t\t\t\ttext: \"Baseline 1\"\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tupdatedBaseline.start_date = _getStartDate(baselineNode, config);\r\n\t\t\tupdatedBaseline.duration = _getDuration(baselineNode, config);\r\n\t\t\tupdatedBaseline.end_date = gantt.calculateEndDate({start_date: updatedBaseline.start_date, duration: updatedBaseline.duration, task});\r\n\r\n\t\t\tbaselines.push(updatedBaseline);\r\n\t\t});\r\n\r\n\t\treturn baselines;\r\n\t};\r\n\r\n\tDurationControl.prototype.button_click = function (index, el, section, container) {\r\n\t\tif (gantt.callEvent(\"onSectionButton\", [gantt._lightbox_id, section]) === false) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (el.closest(\".gantt_custom_button.gantt_remove_baselines\")){\r\n\t\t\tcontainer.innerHTML = gantt.locale.labels.baselines_section_placeholder;\r\n\t\t}\r\n\t\tif (el.closest(\".gantt_custom_button.gantt_add_baselines\")){\r\n\t\t\tif (container.innerHTML == gantt.locale.labels.baselines_section_placeholder){\r\n\t\t\t\tcontainer.innerHTML = \"\";\r\n\t\t\t}\r\n\t\t\tconst task = gantt.getTask(gantt._lightbox_id);\r\n\t\t\tconst baseline = {\r\n\t\t\t\tid: gantt.uid(),\r\n\t\t\t\ttask_id: task.id,\r\n\t\t\t\ttext: \"Baseline 1\",\r\n\t\t\t\tstart_date: task.start_date,\r\n\t\t\t\tend_date: task.end_date\r\n\t\t\t};\r\n\t\t\tconst config = gantt._get_typed_lightbox_config()[index];\r\n\t\t\t_generateBaselineRow(container, baseline, task, config);\r\n\t\t}\r\n\t};\r\n\r\n\tDurationControl.prototype.focus = function(node) {\r\n\t\tgantt._focus(node.getElementsByTagName(\"select\")[0]);\r\n\t};\r\n\r\n\r\n\tfunction _getStartDate(node, config) {\r\n\t\tvar s = node.getElementsByTagName(\"select\");\r\n\t\tvar map = config._time_format_order;\r\n\t\tvar hours = 0;\r\n\t\tvar minutes = 0;\r\n\r\n\t\tif (gantt.defined(map[3])) {\r\n\t\t\tvar input = s[map[3]];\r\n\t\t\tvar time = parseInt(input.value, 10);\r\n\t\t\tif (isNaN(time) && input.hasAttribute(\"data-value\")) {\r\n\t\t\t\ttime = parseInt(input.getAttribute(\"data-value\"), 10);\r\n\t\t\t}\r\n\r\n\t\t\thours = Math.floor(time / 60);\r\n\t\t\tminutes = time % 60;\r\n\t\t}\r\n\t\treturn new Date(s[map[2]].value, s[map[1]].value, s[map[0]].value, hours, minutes);\r\n\t}\r\n\r\n\tfunction _getDuration(node, config) {\r\n\t\tvar duration = node.getElementsByTagName(\"input\")[1];\r\n\r\n\t\tduration = getFormatter(config).parse(duration.value);\r\n\t\tif (!duration || window.isNaN(duration)) duration = 1;\r\n\t\tif (duration < 0) duration *= -1;\r\n\t\treturn duration;\r\n\t}\r\n\r\n\treturn DurationControl; \r\n};","\r\nimport * as helpers from \"../../../../utils/helpers\";\r\nimport __extends from \"../../../../utils/extends\";\r\nimport Super from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tconst _super = Super(gantt);\r\n\r\n\tconst localCache = {\r\n\t\tresources: {},\r\n\t\tresourcesValues: {},\r\n\t\tfilter: {},\r\n\t\teventsInitialized: {},\r\n\t\tgridID: null,\r\n\t\tresource_filter_value: null,\r\n\t\tinitialValues: [],\r\n\t\tnewValues: []\r\n\t};\r\n\r\n\tconst selectResEditor = { type: \"select\", map_to: \"resource_id\" , options: gantt.serverList(\"resourceOptions\")};\r\n\tconst numberEditor = { type: \"number\", map_to: \"value\", min: 0, max: 100 };\r\n\r\n\tconst dateToStr = gantt.date.date_to_str(\"%d-%m-%Y\");\r\n\r\n\tgantt.resource_table = {\r\n\t\tscale_height: 35,\r\n\t\trow_height: 35,\r\n\t\tcolumns: [\r\n\t\t\t{\r\n\t\t\t\tname: \"resource\", label: \"Resource\", align: \"center\", width: 80, editor: selectResEditor, template: function (assignment) {\r\n\t\t\t\t\tlet defaultValue = \"Unassigned\";\r\n\t\t\t\t\tconst resource = gantt.getDatastore(gantt.config.resource_store).getItem(assignment.resource_id);\r\n\t\t\t\t\treturn resource ? resource.text : defaultValue;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tname: \"hours/Day\", label: \"Hours/Day\", align: \"center\", width: 70, editor: numberEditor, template: function (assignment) {\r\n\t\t\t\t\treturn assignment.value ? +assignment.value : ``;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tname: \"start\", label: \"Start\", align: \"center\", width: 100, template: function (assignment) {\r\n\t\t\t\t\treturn assignment.start_date ? dateToStr(assignment.start_date) : ``;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tname: \"end\", label: \"End\", align: \"center\", width: 100, template: function (assignment) {\r\n\t\t\t\t\treturn assignment.end_date ? dateToStr(assignment.end_date) : ``;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tname: \"duration\", label: \"Duration\", align: \"center\", width: 80, template: function (assignment) {\r\n\t\t\t\t\tif (assignment.duration) {\r\n\t\t\t\t\t\treturn `${assignment.duration} day${assignment.duration == 1 ? '' : 's'}`;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn ``;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tname: \"delete\", label: \"Delete\", align: \"center\", width: 80, template: function (assignment) {\r\n\t\t\t\t\treturn `<div data-assignment-id='${assignment.id}' data-assignment-delete='${assignment.id}' class='dhx_gantt_icon dhx_gantt_icon_delete'></div>`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t],\r\n\t\tresource_default_assignment: {\r\n\t\t\tduration: null,\r\n\t\t\tvalue: 8,\r\n\t\t\tstart_date: null,\r\n\t\t\tend_date: null,\r\n\t\t\tmode: \"default\"\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.attachEvent(\"onAfterLightbox\", _clearCached);\r\n\r\n\tfunction newResourcesControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this;\r\n\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(newResourcesControl, _super);\r\n\r\n\tfunction _generateResourceInputSection(index, name) {\r\n\t\tconst resourceFilterPlaceholder = gantt.locale.labels.resources_filter_placeholder || \"Search...\";\r\n\t\tconst html = `<div class='gantt_resource_selector_filter_wrapper gantt_cal_lsection' data-section-name='${name}'>\r\n\t\t\t\t\t\t<div class='gantt_cal_ltext gantt_resources_filter'>\r\n\t\t\t\t\t\t\t<label class=\"dhx_gantt_icon dhx_gantt_icon_search\">\r\n\t\t\t\t\t\t\t\t<input type='text' class='gantt_resources_filter_input' placeholder='${resourceFilterPlaceholder}' tab-index=\"-1\"> \r\n\t\t\t\t\t\t\t<label>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div role='button' aria-label='Add Assignment' class='gantt_custom_button gantt_add_resources' data-index='${index}'><div class='gantt_custom_button_add_resources gantt_add'></div><div class='gantt_custom_button_label'>${gantt.locale.labels.resources_add_button}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>`;\r\n\t\treturn html;\r\n\t}\r\n\r\n\r\n\tfunction _generateResourceTable(node, assignments, task, sns) {\r\n\t\t// destroy grid if it exists\r\n\t\tif(gantt.$ui.getView(\"GridRL\") && !localCache.gridID){\r\n\t\t\tgantt.$ui.getView(\"GridRL\").destructor();\r\n\t\t}\r\n\r\n\t\tif (!localCache.gridID) {\r\n\t\t\t// temp store for assignments in the lightbox\r\n\t\t\tconst resourceTable = document.createElement(\"div\");\r\n\t\t\tresourceTable.classList.add(\"gantt_resource_selector_grid\");\r\n\t\t\tconst tempAssignmentStore = gantt.createDatastore({\r\n\t\t\t\tname: \"temp_resource_assignment_store\",\r\n\t\t\t\tinitItem: function (item) {\r\n\t\t\t\t\tif (!item.id) {\r\n\t\t\t\t\t\titem.id = gantt.uid();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn item;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tgantt.$data.tempAssignmentsStore = tempAssignmentStore; // link to gantt\r\n\t\t\tconst gridConfig = {...gantt.config.layout, id: \"GridRL\", sectionName: sns.name };\r\n\t\t\tconst grid = gantt.$ui.createView(\"GridRL\", gantt.$root, gridConfig);  // creating grid\r\n\t\t\tgrid.init(resourceTable); // init grid\r\n\t\t\tconst width = gantt._lightbox.offsetWidth - (gantt.config.wide_form ? 150 : 0); \r\n\t\t\tgrid.setSize(width, \"auto\"); // set width and height of the grid\r\n\t\t\tgantt.ext.inlineEditorsLightbox = gantt.ext._inlineEditors.createEditors(grid); //attach inline editors\r\n\t\t\tgantt.ext.inlineEditorsLightbox.init();\r\n\t\t\tlocalCache.gridID = grid.$id;\r\n\t\t\tnode.appendChild(resourceTable);\r\n\t\t\tconst resourceAssignmentsStore = gantt.getDatastore(gantt.config.resource_assignment_store);  // main store\r\n\t\t\tconst searchItems = [];\r\n\t\t\tresourceAssignmentsStore.eachItem(function(item){\r\n\t\t\t\tif(item.task_id && item.task_id == task.id){\r\n\t\t\t\t\tsearchItems.push(item);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tconst clonedAssignments = structuredClone(searchItems); // clone\r\n\t\t\ttempAssignmentStore.parse(clonedAssignments); // add all assignments from main to temp\r\n\t\t}\r\n\r\n\t\tgantt.$data.tempAssignmentsStore.attachEvent(\"onFilterItem\", function(id, assignment) {\r\n\t\t\tif (assignment.task_id == task.id){\r\n\t\t\t\tif (!localCache.resource_filter_value) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet resource = gantt.getDatastore(gantt.config.resource_store).getItem(assignment.resource_id);\r\n\t\t\t\t\tif (resource.text.toLowerCase().indexOf(localCache.resource_filter_value) > -1) return true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t});\r\n\t\tgantt.refreshData();\r\n\t}\r\n\r\n\tfunction _generateAssignmentDefaultRow(sectionName) {\r\n\t\tlet resource_id;\r\n\t\tconst task = gantt.getTask(gantt._lightbox_id);\r\n\t\tconst assignments = gantt.getTaskAssignments(task.id);\r\n\t\tif(assignments.length){\r\n\t\t\tresource_id = assignments[0].resource_id;\r\n\t\t} else {\r\n\t\t\tconst resources = gantt.serverList(\"resourceOptions\");\r\n\t\t\tif(resources.length){\r\n\t\t\t\tresource_id = resources[0].id;\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(`There is no any resources in resource store, please check your data:\r\n\t\t\t\t\thttps://docs.dhtmlx.com/gantt/desktop__resource_management.html#assigningresources`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst tempAssignmentStore = gantt.getDatastore(\"temp_resource_assignment_store\");\r\n\t\tconst lightboxSection = gantt.getLightboxSection(sectionName).section;\r\n\t\tconst resourceConfig = lightboxSection.config ?? gantt.resource_table;\r\n\t\tconst config = resourceConfig.resource_default_assignment ?? gantt.resource_table.resource_default_assignment;\r\n\r\n\t\ttempAssignmentStore.addItem({\r\n\t\t\tresource_id,\r\n\t\t\ttask_id: task.id,\r\n\t\t\tduration: config.duration ?? gantt.calculateDuration(task),\r\n\t\t\tvalue: config.value,\r\n\t\t\tstart_date: config.start_date ?? task.start_date,\r\n\t\t\tend_date: config.end_date ?? task.end_date,\r\n\t\t\tmode: config.mode\r\n\t\t});\r\n\t\tgantt.refreshData();\r\n\t}\r\n\r\n\tfunction _setFocus(container){\r\n\t\tconst resourceRows = container.querySelectorAll(\".gantt_row.gantt_row_task\");\r\n\t\tif(resourceRows){\r\n\t\t\tconst lastRow = resourceRows[resourceRows.length -1];\r\n\t\t\tconst resourceCell = lastRow.querySelector(\".gantt_cell\");\r\n\t\t\tif(resourceCell){\r\n\t\t\t\tconst {id, columnName} = gantt.ext.inlineEditorsLightbox.locateCell(resourceCell);\r\n\t\t\t\tif(id && columnName){\r\n\t\t\t\t\tgantt.ext.inlineEditorsLightbox.startEdit(id, columnName);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tnewResourcesControl.prototype.render = function(sns) {\r\n\t\tif(!sns.options){\r\n\t\t\tsns.options = gantt.serverList(\"resourceOptions\");\r\n\t\t}\r\n\r\n\t\tif(!sns.map_to || sns.map_to == \"resource_selector\" || sns.map_to == \"auto\"){\r\n\t\t\tsns.map_to = gantt.config.resource_property;\r\n\t\t}\r\n\r\n\t\tlet html;\r\n\t\t// if set fixed height for this element, then resize of lightbox will be calculated improperly\r\n\t\thtml = `<div${!isNaN(sns.height) ? \" style='height:auto;'\" : \"\"} class='gantt_section_${sns.name}' data-section-name='${sns.name}'>`;\r\n\t\thtml += _generateResourceInputSection(sns.index, sns.name);\r\n\t\thtml += `</div>`;\r\n\t\thtml += `<div class=\"resources_section_placeholder\" style='display:none;'>${gantt.locale.labels.resources_section_placeholder}</div>`;\r\n\t\treturn html;\r\n\t};\r\n\r\n\tnewResourcesControl.prototype.button_click = function (index, el, section, container) {\r\n\t\tconst sectionName = section.getAttribute(\"data-section-name\") || container.getAttribute(\"data-section-name\");\r\n\t\tconst firstAddBtn = document.querySelector(\"[data-resource-selector-section]\");\r\n\t\tconst placeholder = document.querySelector(\".resources_section_placeholder\");\r\n\t\tconst resourceSection = document.querySelector(`.gantt_section_${sectionName} .gantt_resource_selector_filter_wrapper`);\r\n\t\tconst resourceGrid = document.querySelector(`.gantt_section_${sectionName} .gantt_grid`);\r\n\t\tfirstAddBtn.style.display = \"none\";\r\n\r\n\t\tif (gantt.callEvent(\"onSectionButton\", [gantt._lightbox_id, section]) === false) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (el.closest(\".gantt_custom_button.gantt_add_resources\")){\r\n\t\t\tplaceholder.style.display = \"none\";\r\n\t\t\tconst tempAssignmentStore = gantt.getDatastore(\"temp_resource_assignment_store\");\r\n\r\n\t\t\tif(tempAssignmentStore && tempAssignmentStore.getItems().length == 0){\r\n\t\t\t\tresourceSection.style.display = \"flex\";\r\n\t\t\t\tresourceGrid.style.display = \"block\";\r\n\t\t\t}\r\n\r\n\t\t\t_generateAssignmentDefaultRow(sectionName);\r\n\t\t\t_setFocus(container);\r\n\t\t}\r\n\t};\r\n\r\n\tfunction setInitialValues(task){\r\n\t\tlocalCache.initialValues = [];\r\n\t\tlocalCache.newValues = [];\r\n\t\tconst assignmentStore = gantt.$data.assignmentsStore;\r\n\t\tconst storeAssignments = assignmentStore.find(function (a) {\r\n\t\t\treturn a.task_id == task.id;\r\n\t\t});\r\n\t\tfor (let i = 0; i < storeAssignments.length; i++) {\r\n\t\t\tlocalCache.initialValues[i] = { resource_id: storeAssignments[i].resource_id, value: storeAssignments[i].value, id: storeAssignments[i].id };\r\n\t\t}\r\n\t}\r\n\r\n\tnewResourcesControl.prototype.set_value = function(node, assignments, task, sns, initialized) {\r\n\t\tlet firstAddBtn = document.querySelector(\"[data-resource-selector-section]\");\r\n\t\tlet placeholder = document.querySelector(\".resources_section_placeholder\");\r\n\t\tsetInitialValues(task);\r\n\t\tif(!initialized){\r\n\t\t\t\t_generateResourceTable(node, assignments, task, sns);\r\n\t\t\t\t_setFilterCache(node, sns);\r\n\t\t\t\t_initEvents(node, assignments, sns, this);\r\n\t\t\t\tfirstAddBtn.style.display = \"none\";\r\n\t\t\t\tlet resourceGrid = document.querySelector(`.gantt_section_${sns.name} .gantt_grid`);\r\n\t\t\t\tlet resourceSection = document.querySelector(`.gantt_section_${sns.name} .gantt_resource_selector_filter_wrapper`);\r\n\t\t\t\tresourceGrid.style.display = \"none\";\r\n\t\t\t\tresourceSection.style.display = \"none\";\r\n\t\t}\r\n\t\tconst tempAssignmentStore = gantt.getDatastore(\"temp_resource_assignment_store\");\r\n\t\tif(tempAssignmentStore) {\r\n\t\t\tlet resourceSection = document.querySelector(`.gantt_section_${sns.name} .gantt_resource_selector_filter_wrapper`);\r\n\t\t\tlet resourceGrid = document.querySelector(`.gantt_section_${sns.name} .gantt_grid`);\r\n\r\n\t\t\tif(tempAssignmentStore.getItems().length == 0){\r\n\t\t\t\tif(firstAddBtn.style.display == \"none\"){\r\n\t\t\t\t\tfirstAddBtn.style.display = \"flex\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tresourceSection.style.display = \"none\";\r\n\t\t\t\tresourceGrid.style.display = \"none\";\r\n\t\t\t\tplaceholder.style.display = \"block\";\r\n\t\t\t} else {\r\n\t\t\t\tresourceSection.style.display = \"flex\";\r\n\t\t\t\tresourceGrid.style.display = \"block\";\r\n\t\t\t\tplaceholder.style.display = \"none\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tgantt._center_lightbox(gantt.getLightbox());\r\n\t};\r\n\r\n\tnewResourcesControl.prototype.get_value = function(node, task, sns, type) {\r\n\t\tconst tempAssignmentStore = gantt.getDatastore(\"temp_resource_assignment_store\");\r\n\t\tconst storeAssignments = tempAssignmentStore.find(function (a) {\r\n\t\t\treturn a.task_id == task.id;\r\n\t\t});\r\n\t\tfor (let i = 0; i < storeAssignments.length; i++) {\r\n\t\t\tlocalCache.newValues[i] = { \r\n\t\t\t\tresource_id: storeAssignments[i].resource_id.toString(), \r\n\t\t\t\tvalue: storeAssignments[i].value, \r\n\t\t\t\tid: storeAssignments[i].id, \r\n\t\t\t\tstart_date: storeAssignments[i].start_date,\r\n\t\t\t\tend_date: storeAssignments[i].end_date,\r\n\t\t\t\tduration: storeAssignments[i].duration,\r\n\t\t\t\tmode: storeAssignments[i].mode,\r\n\t\t\t\tdelay: storeAssignments[i].delay\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (type == \"save\"){\r\n\t\t\treturn localCache.newValues;\r\n\t\t} else {\r\n\t\t\treturn localCache.initialValues;\r\n\t\t}\r\n\t};\r\n\r\n\tfunction getVisibleResources(task, options){\r\n\t\tlet visibleResources = [];\r\n\t\tconst tempAssignmentStore = gantt.getDatastore(\"temp_resource_assignment_store\");\r\n\t\tconst currentAssignments = tempAssignmentStore.find(function (a) {\r\n\t\t\treturn a.task_id == task.id;\r\n\t\t});\r\n\t\tfor (let i = 0; i < currentAssignments.length; i++) {\r\n\t\t\tlet resource = gantt.getDatastore(gantt.config.resource_store).getItem(currentAssignments[i].resource_id);\r\n\t\t\tif(resource){\r\n\t\t\t\tvisibleResources.push(resource);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn visibleResources;\r\n\t}\r\n\r\n\tfunction _getValue(el) {\r\n\t\treturn el.value.trim();\r\n\t}\r\n\r\n\tfunction _initEvents(node, ev, sns, context) {\r\n\t\tif (localCache.eventsInitialized[sns.id]) return;\r\n\r\n\t\tvar _applyFilter = function(e) {\r\n\t\t\t_saveValues(sns, node);\r\n\t\t\tvar resultSns;\r\n\t\t\tvar query;\r\n\t\t\tvar input;\r\n\t\t\tvar filterCache = _getFilterCache(sns);\r\n\t\t\tinput = filterCache.input;\r\n\r\n\t\t\tquery = _getValue(input);\r\n\t\t\tlocalCache.resource_filter_value = query.toLowerCase();\r\n\t\t\tfilterCache.filterApplied = !!query;\r\n\t\t\tif (gantt.getState().lightbox) {\r\n\t\t\t\tev = gantt.getLightboxValues();\r\n\t\t\t}\r\n\t\t\tresultSns = _getSnsToHideUnsetted(sns, ev, query);\r\n\t\t\tvar value = ev[sns.map_to];\r\n\t\t\tcontext.form_blocks.resource_selector.set_value(node, value, ev, resultSns);\r\n\t\t};\r\n\r\n\t\tfunction _saveValues(sns, domElement) {\r\n\t\t\tvar selector = _getInputElementSelector();\r\n\t\t\tvar inputs = domElement.querySelectorAll(selector);\r\n\r\n\t\t\tlocalCache.resourcesValues[sns.id] = localCache.resourcesValues[sns.id] || {};\r\n\r\n\t\t\tfor (var i = 0; i < inputs.length; i++) {\r\n\t\t\t\tvar key = inputs[i].getAttribute(\"data-item-id\");\r\n\t\t\t\tvar originalAssignmentId = inputs[i].getAttribute(\"data-assignment-id\");\r\n\t\t\t\tif (!inputs[i].disabled) {\r\n\t\t\t\t\tlocalCache.resourcesValues[sns.id][key] = {value: inputs[i].value, id: originalAssignmentId};\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdelete localCache.resourcesValues[sns.id][key];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t_applyFilter = helpers.throttle(_applyFilter, 100);\r\n\r\n\t\t_getFilterCache(sns).container.addEventListener(\"keyup\", _applyFilter);\r\n\t\t_getFilterCache(sns).container.addEventListener(\"input\", _applyFilter, true);\r\n\t\t_getFilterCache(sns).container.addEventListener(\"change\", _applyFilter, true);\r\n\t\tlocalCache.eventsInitialized[sns.id] = true;\r\n\t}\r\n\r\n\tfunction _getSnsToHideUnsetted(controlConfig, task, query, hideUnsetted) {\r\n\t\tvar comparison;\r\n\t\tvar resultConfig = gantt.copy(controlConfig);\r\n\r\n\t\tif (query === \"\") {// show all\r\n\t\t\tresultConfig.resources = [];\r\n\t\t\tlet resourceIds = localCache.newValues.map(obj => {\r\n\t\t\t\treturn obj.resource_id;\r\n\t\t\t});\r\n\t\t\tif(resourceIds && resourceIds.length > 0){\r\n\t\t\t\tfor (let i = 0; i < resourceIds.length; i++) {\r\n\t\t\t\t\tlet resource = gantt.getDatastore(gantt.config.resource_store).getItem(resourceIds[i]);\r\n\t\t\t\t\tif(resource){\r\n\t\t\t\t\t\tresultConfig.resources.push(resource);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn resultConfig;\r\n\t\t}\r\n\r\n\t\tcomparison = function(entry) {// show matching labels only\r\n\t\t\tif (entry.text.toLowerCase().indexOf(query.toLowerCase()) >= 0) {\r\n\t\t\t\treturn entry;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tresultConfig.resources = getVisibleResources(task, controlConfig.options);\r\n\t\tresultConfig.resources = helpers.arrayFilter(resultConfig.resources, comparison);\r\n\t\treturn resultConfig;\r\n\t}\r\n\r\n\tfunction _getInputElementSelector(isChecked) {\r\n\t\tif(isChecked === undefined){\r\n\t\t\treturn \".gantt_resource_amount_input\";\r\n\t\t}else{\r\n\t\t\treturn \"[data-checked='\"+(isChecked ? \"true\" : \"false\") + \"'] .gantt_resource_amount_input\";\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _setFilterCache(node, sns) {\r\n\t\tif (!localCache.filter[sns.id]) {\r\n\t\t\tvar container = node.querySelector(\".gantt_resources_filter\");\r\n\t\t\tvar input = container.querySelector(\".gantt_resources_filter_input\");\r\n\r\n\t\t\tlocalCache.filter[sns.id] = {\r\n\t\t\t\tcontainer: container,\r\n\t\t\t\tinput: input,\r\n\t\t\t\tfilterApplied: false\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn localCache.filter[sns.id];\r\n\t}\r\n\r\n\tfunction _getFilterCache(sns) {\r\n\t\treturn localCache.filter[sns.id];\r\n\t}\r\n\r\n\tfunction _clearCached() {\r\n\t\tfor (var key in localCache.filter) {\r\n\t\t\tlocalCache.filter[key].input.value = \"\";\r\n\t\t\tlocalCache.filter[key].filterApplied = false;\r\n\t\t}\r\n\t\tlocalCache.resourcesValues = {};\r\n\t\tlocalCache.eventsInitialized = {};\r\n\t\tlocalCache.resource_filter_value = null;\r\n\t\tlocalCache.gridID = null;\r\n\t\tlocalCache.initialValues = [];\r\n\t\tlocalCache.newValues = [];\r\n\t}\r\n\r\n\treturn newResourcesControl;\r\n};","import TemplateControlConstructor from \"./controls/template_control\";\r\nimport TextareaControlConstructor from \"./controls/textarea_control\";\r\nimport TimeControlConstructor from \"./controls/time_control\";\r\nimport SelectControlConstructor from \"./controls/select_control\";\r\nimport CheckboxControlConstructor from \"./controls/checkbox_control\";\r\nimport RadioControlConstructor from \"./controls/radio_control\";\r\nimport DurationControlConstructor from \"./controls/duration_control\";\r\nimport ParentControlConstructor from \"./controls/parent_control\";\r\nimport ResourcesControlConstructor from \"./controls/resources_control\";\r\nimport ConstraintControlConstructor from \"./controls/constraint_control\";\r\nimport TypeselectControlConstructor from \"./controls/typeselect_control\";\r\nimport BaselineControlConstructor from \"./controls/baseline_control\";\r\nimport NewResourcesControlConstructor from \"./controls/resource_selector_control\";\r\n\r\nimport * as domHelpers from \"../utils/dom_helpers\";\r\nimport * as helpers from \"../../../utils/helpers\";\r\n\t\r\n\r\nexport default function (gantt) {\r\n\r\n\r\n\tvar TemplateControl = TemplateControlConstructor(gantt);\r\n\tvar TextareaControl = TextareaControlConstructor(gantt);\r\n\tvar TimeControl = TimeControlConstructor(gantt);\r\n\tvar SelectControl = SelectControlConstructor(gantt);\r\n\tvar CheckboxControl = CheckboxControlConstructor(gantt);\r\n\tvar RadioControl = RadioControlConstructor(gantt);\r\n\tvar DurationControl = DurationControlConstructor(gantt);\r\n\tvar ParentControl = ParentControlConstructor(gantt);\r\n\tvar ResourcesControl = ResourcesControlConstructor(gantt);\r\n\tvar ConstraintControl = ConstraintControlConstructor(gantt);\r\n\tvar TypeselectControl = TypeselectControlConstructor(gantt);\r\n\tvar BaselineControl = BaselineControlConstructor(gantt);\r\n\tvar NewResourcesControl = NewResourcesControlConstructor(gantt);\r\n\r\n\tgantt._lightbox_methods = {};\r\n\tgantt._lightbox_template = \"<div class='gantt_cal_ltitle'><span class='gantt_mark'>&nbsp;</span><span class='gantt_time'></span><span class='gantt_title'></span></div><div class='gantt_cal_larea'></div>\";\r\n\tgantt._lightbox_template = `<div class='gantt_cal_ltitle'><div class=\"dhx_cal_ltitle_descr\"><span class='gantt_mark'>&nbsp;</span><span class='gantt_time'></span><span class='dhx_title'></span>\r\n</div>\r\n<div class=\"gantt_cal_ltitle_controls\">\r\n\t<a class=\"gantt_cal_ltitle_close_btn dhx_gantt_icon dhx_gantt_icon_close\"></a>\r\n\r\n</div></div><div class='gantt_cal_larea'></div>`;\r\n\r\n\t// GS-1952. Attaching the lightbox to the BODY element is not considered secure.\r\n\t// Attach it to Gantt container for Salesforce and other secure environments\r\n\tgantt._lightbox_root = gantt.$root;\r\n\tfunction setParentNode() {\r\n\t\tconst cspEnvironment = gantt.config.csp === true;\r\n\t\tif (cspEnvironment || gantt.env.isSalesforce) {\r\n\t\t\tgantt._lightbox_root = gantt.$root;\r\n\t\t} else {\r\n\t\t\tgantt._lightbox_root = document.body;\r\n\t\t}\r\n\t}\r\n\r\n\t//TODO: gantt._lightbox_id is changed from data.js and accessed from autoscheduling, check if it can be removed from gantt object\r\n\tvar state = gantt.$services.getService(\"state\");\r\n\tstate.registerProvider(\"lightbox\", function () {\r\n\t\treturn {\r\n\t\t\tlightbox: gantt._lightbox_id\r\n\t\t};\r\n\t});\r\n\r\n\tgantt.showLightbox = function (id) {\r\n\t\tvar task = this.getTask(id);\r\n\t\tif (!this.callEvent(\"onBeforeLightbox\", [id])) {\r\n\t\t\tif(gantt.isTaskExists(id) && gantt.getTask(id).$new){\r\n\t\t\t\t//GS-2340 if 'onBeforeLightbox' returns 'false' need update the order in datastore\r\n\t\t\t\tthis.$data.tasksStore._updateOrder();\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar box = this.getLightbox(this.getTaskType(task.type));\r\n\r\n\t\tthis.showCover(box);\r\n\t\tthis._fill_lightbox(id, box);\r\n\t\tthis._setLbPosition(box);\r\n\t\tthis._waiAria.lightboxVisibleAttr(box);\r\n\r\n\t\tthis.callEvent(\"onLightbox\", [id]);\r\n\t};\r\n\r\n\tfunction _is_chart_visible(gantt) {\r\n\t\tvar timeline = gantt.$ui.getView(\"timeline\");\r\n\t\tif (timeline && timeline.isVisible()) {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tgantt._get_timepicker_step = function () {\r\n\t\tif (this.config.round_dnd_dates) {\r\n\t\t\tvar step;\r\n\t\t\tif (_is_chart_visible(this)) {\r\n\t\t\t\tvar scale = gantt.getScale();\r\n\t\t\t\tstep = (helpers.getSecondsInUnit(scale.unit) * scale.step) / 60;//timepicker step is measured in minutes\r\n\t\t\t}\r\n\r\n\t\t\tif (!step || step >= 60 * 24) {\r\n\t\t\t\tstep = this.config.time_step;\r\n\t\t\t}\r\n\t\t\treturn step;\r\n\t\t}\r\n\t\treturn this.config.time_step;\r\n\t};\r\n\tgantt.getLabel = function (property, key) {\r\n\t\tvar sections = this._get_typed_lightbox_config();\r\n\t\tfor (var i = 0; i < sections.length; i++) {\r\n\t\t\tif (sections[i].map_to == property) {\r\n\t\t\t\tvar options = sections[i].options;\r\n\t\t\t\tfor (var j = 0; j < options.length; j++) {\r\n\t\t\t\t\tif (options[j].key == key) {\r\n\t\t\t\t\t\treturn options[j].label;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn \"\";\r\n\t};\r\n\r\n\tgantt.updateCollection = function (list_name, collection) {\r\n\t\tcollection = collection.slice(0);\r\n\t\tvar list = gantt.serverList(list_name);\r\n\t\tif (!list) return false;\r\n\t\tlist.splice(0, list.length);\r\n\t\tlist.push.apply(list, collection || []);\r\n\t\tgantt.resetLightbox();\r\n\t};\r\n\tgantt.getLightboxType = function () {\r\n\t\treturn this.getTaskType(this._lightbox_type);\r\n\t};\r\n\tgantt.getLightbox = function (type) {\r\n\t\tvar lightboxDiv;\r\n\t\tvar fullWidth;\r\n\t\tvar html;\r\n\t\tvar sns;\r\n\t\tvar ds;\r\n\t\tvar classNames = \"\";\r\n\t\tsetParentNode();\r\n\r\n\t\tif (type === undefined)\r\n\t\t\ttype = this.getLightboxType();\r\n\r\n\t\tif (!this._lightbox || this.getLightboxType() != this.getTaskType(type)) {\r\n\t\t\tthis._lightbox_type = this.getTaskType(type);\r\n\t\t\tlightboxDiv = document.createElement(\"div\");\r\n\t\t\tclassNames = \"gantt_cal_light\";\r\n\t\t\tfullWidth = this._is_lightbox_timepicker();\r\n\r\n\t\t\tif (gantt.config.wide_form)\r\n\t\t\t\tclassNames += \" gantt_cal_light_wide\";\r\n\r\n\t\t\tif (fullWidth) {\r\n\t\t\t\tclassNames += \" gantt_cal_light_full\";\r\n\t\t\t}\r\n\r\n\t\t\tlightboxDiv.className = classNames;\r\n\r\n\t\t\tlightboxDiv.style.visibility = \"hidden\";\r\n\t\t\thtml = this._lightbox_template;\r\n\t\t\thtml += \"<div class='gantt_cal_lcontrols'>\";\r\n\t\t\thtml += getHtmlButtons(this.config.buttons_left);\r\n\t\t\thtml += \"<div class='gantt_cal_lcontrols_push_right'></div>\";\r\n\t\t\thtml += getHtmlButtons(this.config.buttons_right, true);\r\n\t\t\thtml += \"</div>\";\r\n\r\n\t\t\tlightboxDiv.innerHTML = html;\r\n\r\n\t\t\tgantt._waiAria.lightboxAttr(lightboxDiv);\r\n\r\n\t\t\tif (gantt.config.drag_lightbox) {\r\n\t\t\t\tlightboxDiv.firstChild.onmousedown = gantt._ready_to_dnd;\r\n\t\t\t\tlightboxDiv.firstChild.addEventListener('touchstart', function(e){\r\n\t\t\t\t\tgantt._ready_to_dnd(e.touches[0]);\r\n\t\t\t\t});\r\n\t\t\t\tlightboxDiv.firstChild.onselectstart = function () {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t};\r\n\t\t\t\tlightboxDiv.firstChild.style.cursor = \"pointer\";\r\n\t\t\t\tgantt._init_dnd_events();\r\n\t\t\t}\r\n\r\n\t\t\t// GS-1428: If there is lightbox node, we need to remove it from the DOM\r\n\t\t\tif (this._lightbox){\r\n\t\t\t\tthis.resetLightbox();\r\n\t\t\t}\r\n\t\t\tshow_cover();\r\n\t\t\tthis._cover.insertBefore(lightboxDiv, this._cover.firstChild);\r\n\t\t\tthis._lightbox = lightboxDiv;\r\n\r\n\t\t\tsns = this._get_typed_lightbox_config(type);\r\n\t\t\thtml = this._render_sections(sns);\r\n\r\n\t\t\tds = lightboxDiv.querySelector(\"div.gantt_cal_larea\");\r\n\t\t\t\r\n\t\t\t//GS-1131. If gantt_cal_larea is displayed, Firefox renders buttons incorrectly;\r\n\t\t\tvar backup_overflow = ds.style.overflow;\r\n\t\t\tds.style.overflow = 'hidden';\r\n\r\n\t\t\tds.innerHTML = html;\r\n\r\n\t\t\t\r\n\r\n\t\t\tbindLabelsToInputs(sns);\r\n\r\n\t\t\tds.style.overflow = backup_overflow;\r\n\r\n\t\t\tthis._init_lightbox_events(this);\r\n\t\t\tlightboxDiv.style.display = \"none\";\r\n\t\t\tlightboxDiv.style.visibility = \"visible\";\r\n\t\t}\r\n\t\treturn this._lightbox;\r\n\t};\r\n\r\n\tgantt._render_sections = function (sns) {\r\n\t\tvar html = \"\";\r\n\t\tfor (var i = 0; i < sns.length; i++) {\r\n\t\t\tvar block = this.form_blocks[sns[i].type];\r\n\t\t\tif (!block) continue; //ignore incorrect blocks\r\n\t\t\tsns[i].id = \"area_\" + this.uid();\r\n\r\n\t\t\tvar display = sns[i].hidden ? \" style='display:none'\" : \"\";\r\n\t\t\tvar button = \"\";\r\n\t\t\tif (sns[i].button) {\r\n\t\t\t\tbutton = \"<div class='gantt_custom_button' data-index='\" + i + \"'><div class='gantt_custom_button_\" + sns[i].button + \"'></div><div class='gantt_custom_button_label'>\" + this.locale.labels[\"button_\" + sns[i].button] + \"</div></div>\";\r\n\t\t\t}\r\n\t\t\tif (sns[i].type == \"baselines\") {\r\n\t\t\t\tbutton = \"<div class='gantt_custom_button gantt_remove_baselines' data-index='\" + i + \"'><div class='gantt_custom_button_delete_baselines'></div><div class='gantt_custom_button_label'>\" + this.locale.labels.baselines_remove_all_button + \"</div></div>\" +\r\n\t\t\t\t\"<div class='gantt_custom_button gantt_add_baselines' data-index='\" + i + \"'><div class='gantt_custom_button_add_baseline'></div><div class='gantt_custom_button_label'>\" + this.locale.labels.baselines_add_button + \"</div></div>\";\r\n\t\t\t}\r\n\t\t\tif (sns[i].type == \"resource_selector\") {\r\n\t\t\t\tsns[i].index = i;\r\n\t\t\t\tbutton = `<div class='gantt_custom_button gantt_add_resources' data-index='${i}' data-resource-selector-section='${i}' data-section-name='${sns.name}'><div class='gantt_custom_button_add_resources gantt_add'></div><div class='gantt_custom_button_label'>${this.locale.labels.resources_add_button}</div></div>`;\r\n\t\t\t}\r\n\t\t\tif (this.config.wide_form) {\r\n\t\t\t\thtml += \"<div class='gantt_wrap_section' \" + display + \">\";\r\n\t\t\t}\r\n\t\t\thtml += \"<div id='\" + sns[i].id + \"' class='gantt_cal_lsection'><label>\" + button + (sns[i].label || this.locale.labels[\"section_\" + sns[i].name]||sns[i].name) + \"</label></div>\" + block.render.call(this, sns[i]);\r\n\t\t\thtml += \"</div>\";\r\n\t\t}\r\n\t\treturn html;\r\n\t};\r\n\r\n\tgantt._center_lightbox = function(box){\r\n\t\tgantt._setLbPosition(box);\r\n\t};\r\n\tgantt._setLbPosition = function(box) {\r\n\t\tif(!box){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst rootElement = gantt._lightbox_root || gantt.$root;\r\n\t\tbox.style.top = Math.max(rootElement.offsetHeight / 2 - box.offsetHeight/2, 0) + \"px\";\r\n\t\tbox.style.left = Math.max(rootElement.offsetWidth / 2 - box.offsetWidth/2, 0) + \"px\";\r\n\t};\r\n\r\n\tgantt.showCover = function (box) {\r\n\t\tif (box){\r\n\t\t\tbox.style.display=\"block\";\r\n\t\r\n\t\t\tthis._setLbPosition(box);\r\n\t\t}\r\n\t\tshow_cover();\r\n\t\tthis._cover.style.display = \"\";\r\n\t};\r\n\tconst show_cover=function(){\r\n\t\tif(gantt._cover) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\tgantt._cover=document.createElement(\"div\");\r\n\t\tgantt._cover.className=\"gantt_cal_cover\";\r\n\t\tgantt._cover.style.display = \"none\";\r\n\t\r\n\t\tgantt.event(gantt._cover, \"mousemove\", gantt._move_while_dnd);\r\n\t\tgantt.event(gantt._cover, \"mouseup\", gantt._finish_dnd);\r\n\t\r\n\t\tconst rootElement = gantt._lightbox_root || gantt.$root;\r\n\t\trootElement.appendChild(gantt._cover);\r\n\t};\r\n\r\n\tgantt._init_lightbox_events = function () {\r\n\t\tgantt.lightbox_events = {};\r\n\r\n\r\n\t\tgantt.lightbox_events.gantt_save_btn = function () {\r\n\t\t\tgantt._save_lightbox();\r\n\t\t};\r\n\r\n\r\n\t\tgantt.lightbox_events.gantt_delete_btn = function () {\r\n\t\t\tgantt._lightbox_current_type = null;\r\n\t\t\tif (!gantt.callEvent(\"onLightboxDelete\", [gantt._lightbox_id]))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (gantt.isTaskExists(gantt._lightbox_id)) {\r\n\t\t\t\tgantt.$click.buttons[\"delete\"](gantt._lightbox_id);\r\n\t\t\t} else {\r\n\t\t\t\tgantt.hideLightbox();\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\r\n\t\tgantt.lightbox_events.gantt_cancel_btn = function () {\r\n\t\t\tgantt._cancel_lightbox();\r\n\t\t};\r\n\r\n\r\n\t\tgantt.lightbox_events[\"default\"] = function (e, src) {\r\n\t\t\tif (src.getAttribute(\"data-dhx-button\")) {\r\n\t\t\t\tgantt.callEvent(\"onLightboxButton\", [src.className, src, e]);\r\n\t\t\t} else {\r\n\t\t\t\tvar index, block, sec;\r\n\r\n\t\t\t\tvar className = domHelpers.getClassName(src);\r\n\t\t\t\tif (className.indexOf(\"gantt_custom_button\") != -1) {\r\n\t\t\t\t\tif (className.indexOf(\"gantt_custom_button_\") != -1) {\r\n\t\t\t\t\t\tindex = src.parentNode.getAttribute(\"data-index\");\r\n\t\t\t\t\t\tsec = src;\r\n\t\t\t\t\t\twhile (sec && domHelpers.getClassName(sec).indexOf(\"gantt_cal_lsection\") == -1) {\r\n\t\t\t\t\t\t\tsec = sec.parentNode;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tindex = src.getAttribute(\"data-index\");\r\n\t\t\t\t\t\tsec = src.closest(\".gantt_cal_lsection\");\r\n\t\t\t\t\t\tsrc = src.firstChild;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar sections = gantt._get_typed_lightbox_config();\r\n\r\n\t\t\t\tif (index) {\r\n\t\t\t\t\tindex = index * 1;\r\n\t\t\t\t\tblock = gantt.form_blocks[sections[index * 1].type];\r\n\t\t\t\t\tblock.button_click(index, src, sec, sec.nextSibling);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\tthis.event(gantt.getLightbox(), \"click\", function (e) {\r\n\t\t\tif(e.target.closest(\".gantt_cal_ltitle_close_btn\")){\r\n\t\t\t\tgantt._cancel_lightbox();\r\n\t\t\t}\r\n\t\t\tvar src = domHelpers.getTargetNode(e);\r\n\r\n\t\t\tvar className = domHelpers.getClassName(src);\r\n\t\t\tif (!className) {\r\n\t\t\t\tsrc = src.previousSibling;\r\n\t\t\t\tclassName = domHelpers.getClassName(src);\r\n\t\t\t}\r\n\t\t\tif (src && className && className.indexOf(\"gantt_btn_set\") === 0) {\r\n\t\t\t\tsrc = src.firstChild;\r\n\t\t\t\tclassName = domHelpers.getClassName(src);\r\n\t\t\t}\r\n\t\t\tif (src && className) {\r\n\t\t\t\tvar func = gantt.defined(gantt.lightbox_events[src.className]) ? gantt.lightbox_events[src.className] : gantt.lightbox_events[\"default\"];\r\n\t\t\t\treturn func(e, src);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tgantt.getLightbox().onkeydown = function (e) {\r\n\t\t\tvar event = e || window.event;\r\n\t\t\tvar target = e.target || e.srcElement;\r\n\t\t\tvar buttonTarget = domHelpers.getClassName(target).indexOf(\"gantt_btn_set\") > -1;\r\n\r\n\t\t\tswitch ((e || event).keyCode) {\r\n\t\t\t\tcase gantt.constants.KEY_CODES.SPACE: {\r\n\t\t\t\t\tif ((e || event).shiftKey) return;\r\n\t\t\t\t\tif (buttonTarget && target.click) {\r\n\t\t\t\t\t\ttarget.click();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tcase gantt.keys.edit_save:\r\n\t\t\t\t\tif ((e || event).shiftKey) return;\r\n\t\t\t\t\tif (buttonTarget && target.click) {\r\n\t\t\t\t\t\ttarget.click();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tgantt._save_lightbox();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase gantt.keys.edit_cancel:\r\n\t\t\t\t\tgantt._cancel_lightbox();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\r\n\tgantt._cancel_lightbox = function () {\r\n\t\tvar task = this.getLightboxValues(\"cancel\");\r\n\t\tgantt._lightbox_current_type = null;\r\n\t\tthis.callEvent(\"onLightboxCancel\", [this._lightbox_id, task.$new]);\r\n\t\tif (gantt.isTaskExists(task.id) && task.$new) {\r\n\t\t\tthis.silent(function () {\r\n\t\t\t\tgantt.$data.tasksStore.removeItem(task.id);\r\n\t\t\t\tgantt._update_flags(task.id, null);\r\n\t\t\t});\r\n\t\t\tthis.refreshData();\r\n\t\t}\r\n\r\n\t\tthis.hideLightbox();\r\n\t};\r\n\r\n\tgantt._save_lightbox = function () {\r\n\t\tvar task = this.getLightboxValues(\"save\");\r\n\t\tgantt._lightbox_current_type = null;\r\n\t\tif (!this.callEvent(\"onLightboxSave\", [this._lightbox_id, task, !!task.$new]))\r\n\t\t\treturn;\r\n\r\n\t\t// GS-2170. Do not recalculate the indexes and dates of other tasks\r\n\t\t// as they will be recalculated in the `refreshData`\r\n\t\tgantt.$data.tasksStore._skipTaskRecalculation = \"lightbox\";\r\n\t\tif (task.$new) {\r\n\t\t\tdelete task.$new;\r\n\t\t\tthis.addTask(task, task.parent, this.getTaskIndex(task.id));\r\n\t\t} else if (this.isTaskExists(task.id)) {\r\n\t\t\tthis.mixin(this.getTask(task.id), task, true);\r\n\t\t\tthis.refreshTask(task.id);\r\n\t\t\tthis.updateTask(task.id);\r\n\t\t}\r\n\t\tgantt.$data.tasksStore._skipTaskRecalculation = false;\r\n\t\tthis.refreshData();\r\n\r\n\t\t// TODO: do we need any blockable events here to prevent closing lightbox?\r\n\t\tthis.hideLightbox();\r\n\t};\r\n\r\n\tgantt._resolve_default_mapping = function (section) {\r\n\t\tvar mapping = section.map_to;\r\n\t\tvar time_controls = { \"time\": true, \"time_optional\": true, \"duration\": true, \"duration_optional\": true };\r\n\t\tif (time_controls[section.type]) {\r\n\t\t\tif (section.map_to == \"auto\") {\r\n\t\t\t\tmapping = { start_date: \"start_date\", end_date: \"end_date\", duration: \"duration\" };\r\n\t\t\t} else if (typeof (section.map_to) === \"string\") {\r\n\t\t\t\tmapping = { start_date: section.map_to };\r\n\t\t\t}\r\n\t\t} else if (section.type === \"constraint\") {\r\n\t\t\tif (!section.map_to || typeof (section.map_to) === \"string\") {\r\n\t\t\t\tmapping = { constraint_type: \"constraint_type\", constraint_date: \"constraint_date\" };\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn mapping;\r\n\t};\r\n\r\n\tgantt.getLightboxValues = function (type) {\r\n\t\tlet task = {};\r\n\r\n\t\tif (gantt.isTaskExists(this._lightbox_id)) {\r\n\t\t\ttask = this.mixin({}, this.getTask(this._lightbox_id));\r\n\t\t}\r\n\r\n\t\tconst sns = this._get_typed_lightbox_config();\r\n\t\t// GS-2370: if there is a resource with its calendar\r\n\t\t// need to place time section at the end\r\n\t\tconst sortedSns = [...sns].sort((a, b) => {\r\n\t\t\tif (a.name === \"time\") return 1;\r\n\t\t\tif (b.name === \"time\") return -1;\r\n\t\t\treturn 0;\r\n\t\t});\r\n\t\tfor (let i = 0; i < sortedSns.length; i++) {\r\n\t\t\tlet node = gantt._lightbox_root.querySelector(\"#\" + sortedSns[i].id);\r\n\t\t\tnode = (node ? node.nextSibling : node);\r\n\t\t\tlet block = this.form_blocks[sortedSns[i].type];\r\n\t\t\tif (!block) continue;\r\n\t\t\tlet res = block.get_value.call(this, node, task, sortedSns[i], type);\r\n\t\t\tlet map_to = gantt._resolve_default_mapping(sortedSns[i]);\r\n\t\t\tif (typeof map_to == \"string\" && map_to != \"auto\") {\r\n\t\t\t\ttask[map_to] = res;\r\n\t\t\t} else if (typeof map_to == \"object\") {\r\n\t\t\t\tfor (let property in map_to) {\r\n\t\t\t\t\tif (map_to[property])\r\n\t\t\t\t\t\ttask[map_to[property]] = res[property];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// GS-1282 We need to preserve the task type even if the lightbox doesn't have the typeselect section\r\n\t\t// GS-2460 set the current type from selector\r\n\t\tif (gantt._lightbox_current_type) {\r\n\t\t\ttask.type = gantt._lightbox_current_type;\r\n\t\t}\r\n\r\n\t\treturn task;\r\n\t};\r\n\r\n\r\n\tgantt.hideLightbox = function () {\r\n\t\tvar box = this.getLightbox();\r\n\t\tif (box) box.style.display = \"none\";\r\n\r\n\t\tthis._waiAria.lightboxHiddenAttr(box);\r\n\t\tthis._lightbox_id = null;\r\n\r\n\t\tthis.hideCover(box);\r\n\t\tthis.resetLightbox();\r\n\t\tthis.callEvent(\"onAfterLightbox\", []);\r\n\t};\r\n\tgantt.hideCover = function (box) {\r\n\t\tif(box){\r\n\t\t\tbox.style.display = \"none\";\r\n\t\t}\r\n\t\tif (this._cover)\r\n\t\t\tthis._cover.parentNode.removeChild(this._cover);\r\n\t\tthis._cover = null;\r\n\t};\r\n\r\n\tgantt.resetLightbox = function () {\r\n\t\tif (gantt._lightbox && !gantt._custom_lightbox)\r\n\t\t\tgantt._lightbox.remove();\r\n\t\tgantt._lightbox = null;\r\n\t};\r\n\tgantt._set_lightbox_values = function (data, box) {\r\n\t\tvar task = data;\r\n\t\tvar s = box.getElementsByTagName(\"span\");\r\n\t\tvar lightboxHeader = [];\r\n\t\tif (gantt.templates.lightbox_header) {\r\n\t\t\tlightboxHeader.push(\"\");\r\n\t\t\tlightboxHeader.push(gantt.templates.lightbox_header(task.start_date, task.end_date, task));\r\n\t\t\ts[1].innerHTML = \"\";\r\n\t\t\ts[2].innerHTML = gantt.templates.lightbox_header(task.start_date, task.end_date, task);\r\n\t\t} else {\r\n\t\t\tlightboxHeader.push(this.templates.task_time(task.start_date, task.end_date, task));\r\n\t\t\tlightboxHeader.push(String(this.templates.task_text(task.start_date, task.end_date, task) || \"\").substr(0, 70)); //IE6 fix\r\n\t\t\ts[1].innerHTML = this.templates.task_time(task.start_date, task.end_date, task);\r\n\t\t\ts[2].innerHTML = String(this.templates.task_text(task.start_date, task.end_date, task) || \"\").substr(0, 70); //IE6 fix\r\n\t\t}\r\n\t\ts[1].innerHTML = lightboxHeader[0];\r\n\t\ts[2].innerHTML = lightboxHeader[1];\r\n\r\n\t\tgantt._waiAria.lightboxHeader(box, lightboxHeader.join(\" \"));\r\n\r\n\t\tvar sns = this._get_typed_lightbox_config(this.getLightboxType());\r\n\t\tfor (var i = 0; i < sns.length; i++) {\r\n\t\t\tvar section = sns[i];\r\n\r\n\t\t\tif (!this.form_blocks[section.type]) {\r\n\t\t\t\tcontinue;//skip incorrect sections, same check is done during rendering\r\n\t\t\t}\r\n\r\n\r\n\t\t\tvar node = gantt._lightbox_root.querySelector(\"#\" + section.id).nextSibling;\r\n\t\t\tvar block = this.form_blocks[section.type];\r\n\t\t\tvar map_to = gantt._resolve_default_mapping(sns[i]);\r\n\t\t\tvar value = this.defined(task[map_to]) ? task[map_to] : section.default_value;\r\n\t\t\tblock.set_value.call(gantt, node, value, task, section);\r\n\r\n\t\t\tif (section.focus)\r\n\t\t\t\tblock.focus.call(gantt, node);\r\n\t\t}\r\n\t\tif (gantt.isTaskExists(data.id)){\r\n\t\t\tgantt._lightbox_id = data.id;\r\n\t\t}\r\n\t};\r\n\tgantt._fill_lightbox = function (id, box) {\r\n\t\tvar task = this.getTask(id);\r\n\t\tthis._set_lightbox_values(task, box);\r\n\t};\r\n\r\n\r\n\tgantt.getLightboxSection = function (name) {\r\n\t\tvar config = this._get_typed_lightbox_config();\r\n\t\tvar i = 0;\r\n\t\tfor (i; i < config.length; i++)\r\n\t\t\tif (config[i].name == name)\r\n\t\t\t\tbreak;\r\n\t\tvar section = config[i];\r\n\t\tif (!section)\r\n\t\t\treturn null;\r\n\r\n\t\tif (!this._lightbox)\r\n\t\t\tthis.getLightbox();\r\n\t\tvar header = gantt._lightbox_root.querySelector(\"#\" + section.id);\r\n\t\tvar node = header.nextSibling;\r\n\r\n\t\tvar result = {\r\n\t\t\tsection: section,\r\n\t\t\theader: header,\r\n\t\t\tnode: node,\r\n\t\t\tgetValue: function (ev) {\r\n\t\t\t\treturn gantt.form_blocks[section.type].get_value.call(gantt, node, (ev || {}), section);\r\n\t\t\t},\r\n\t\t\tsetValue: function (value, ev) {\r\n\t\t\t\treturn gantt.form_blocks[section.type].set_value.call(gantt, node, value, (ev || {}), section);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar handler = this._lightbox_methods[\"get_\" + section.type + \"_control\"];\r\n\t\treturn handler ? handler(result) : result;\r\n\t};\r\n\r\n\tgantt._lightbox_methods.get_template_control = function (result) {\r\n\t\tresult.control = result.node;\r\n\t\treturn result;\r\n\t};\r\n\tgantt._lightbox_methods.get_select_control = function (result) {\r\n\t\tresult.control = result.node.getElementsByTagName(\"select\")[0];\r\n\t\treturn result;\r\n\t};\r\n\tgantt._lightbox_methods.get_textarea_control = function (result) {\r\n\t\tresult.control = result.node.getElementsByTagName(\"textarea\")[0];\r\n\t\treturn result;\r\n\t};\r\n\tgantt._lightbox_methods.get_time_control = function (result) {\r\n\t\tresult.control = result.node.getElementsByTagName(\"select\"); // array\r\n\t\treturn result;\r\n\t};\r\n\r\n\r\n\tgantt._init_dnd_events = function () {\r\n\t\tvar eventElement = gantt._lightbox_root;\r\n\t\tthis.event(eventElement, \"mousemove\", gantt._move_while_dnd);\r\n\t\tthis.event(eventElement, \"mouseup\", gantt._finish_dnd);\r\n\t\tthis.event(eventElement, \"touchmove\", function (e){\r\n\t\t\tgantt._move_while_dnd(e.touches[0]);\r\n\t\t});\r\n\t\tthis.event(eventElement, \"touchend\", function (e){\r\n\t\t\tgantt._finish_dnd(e.touches[0]);\r\n\t\t});\r\n\t\t// GS-1952: In Salesforce environment, the lightbox is attached to the Gantt container. \r\n\t\t// So when Gantt is reinitialized, the events are no longer attached to the Gantt container.\r\n\t\t// gantt._init_dnd_events = function () {\r\n\t\t// };\r\n\t};\r\n\tgantt._move_while_dnd = function (event) {\r\n\t\tif (gantt._dnd_start_lb) {\r\n\t\t\tif (!document.gantt_unselectable) {\r\n\t\t\t\tgantt._lightbox_root.className += \" gantt_unselectable\";\r\n\t\t\t\tdocument.gantt_unselectable = true;\r\n\t\t\t}\r\n\t\t\tvar lb = gantt.getLightbox();\r\n\t\t\tvar now = [event.pageX, event.pageY];\r\n\t\t\tlb.style.top = gantt._lb_start[1] + now[1] - gantt._dnd_start_lb[1] + \"px\";\r\n\t\t\tlb.style.left = gantt._lb_start[0] + now[0] - gantt._dnd_start_lb[0] + \"px\";\r\n\t\t}\r\n\t};\r\n\tgantt._ready_to_dnd = function (event) {\r\n\t\tvar lb = gantt.getLightbox();\r\n\t\tgantt._lb_start = [lb.offsetLeft, lb.offsetTop];\r\n\t\tgantt._dnd_start_lb = [event.pageX, event.pageY];\r\n\t};\r\n\tgantt._finish_dnd = function () {\r\n\t\tif (gantt._lb_start) {\r\n\t\t\tgantt._lb_start = gantt._dnd_start_lb = false;\r\n\t\t\tgantt._lightbox_root.className = gantt._lightbox_root.className.replace(\" gantt_unselectable\", \"\");\r\n\t\t\tdocument.gantt_unselectable = false;\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tgantt._focus = function (node, select) {\r\n\t\tif (node && node.focus) {\r\n\t\t\tif (gantt.config.touch) {\r\n\t\t\t\t//do not focus editor, to prevent auto-zoom\r\n\t\t\t} else {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (select && node.select) node.select();\r\n\t\t\t\t\tnode.focus();\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\t// silent errors\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tgantt.form_blocks = {\r\n\t\tgetTimePicker: function (sns, hidden) {\r\n\t\t\tvar html = \"\";\r\n\t\t\tvar cfg = this.config;\r\n\t\t\tvar i;\r\n\t\t\tvar options;\r\n\t\t\tvar ariaAttrs;\r\n\t\t\tvar readonly;\r\n\t\t\tvar display;\r\n\t\t\tvar settings = {\r\n\t\t\t\tfirst: 0,\r\n\t\t\t\tlast: 24 * 60,\r\n\t\t\t\tdate: this.date.date_part(new Date(gantt._min_date.valueOf())),\r\n\t\t\t\ttimeFormat: getTimeFormat(sns)\r\n\t\t\t};\r\n\r\n\t\t\t// map: default order => real one\r\n\t\t\tsns._time_format_order = { size: 0 };\r\n\r\n\t\t\tif (gantt.config.limit_time_select) {\r\n\t\t\t\tsettings.first = 60 * cfg.first_hour;\r\n\t\t\t\tsettings.last = 60 * cfg.last_hour + 1;\r\n\t\t\t\tsettings.date.setHours(cfg.first_hour);\r\n\t\t\t}\r\n\r\n\t\t\tfor (i = 0; i < settings.timeFormat.length; i++) {\r\n\t\t\t\t// adding spaces between selects\r\n\t\t\t\tif (i > 0) {\r\n\t\t\t\t\thtml += \" \";\r\n\t\t\t\t}\r\n\r\n\t\t\t\toptions = getHtmlTimePickerOptions(sns, i, settings);\r\n\r\n\t\t\t\tif (options) {\r\n\t\t\t\t\tariaAttrs = gantt._waiAria.lightboxSelectAttrString(settings.timeFormat[i]);\r\n\t\t\t\t\treadonly = sns.readonly ? \"disabled='disabled'\" : \"\";\r\n\t\t\t\t\tdisplay = hidden ? \" style='display:none' \" : \"\";\r\n\t\t\t\t\thtml += \"<select \" + readonly + display + ariaAttrs + \">\" + options + \"</select>\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn html;\r\n\t\t},\r\n\t\tgetTimePickerValue: function (selects, config, offset) {\r\n\t\t\tvar map = config._time_format_order;\r\n\t\t\tvar needSetTime = gantt.defined(map[3]);\r\n\r\n\t\t\tvar time;\r\n\t\t\tvar hours = 0;\r\n\t\t\tvar minutes = 0;\r\n\r\n\t\t\tvar mapOffset = offset || 0;\r\n\r\n\t\t\tif (needSetTime) {\r\n\t\t\t\ttime = parseInt(selects[map[3] + mapOffset].value, 10);\r\n\t\t\t\thours = Math.floor(time / 60);\r\n\t\t\t\tminutes = time % 60;\r\n\t\t\t}\r\n\t\t\treturn new Date(selects[map[2] + mapOffset].value, selects[map[1] + mapOffset].value, selects[map[0] + mapOffset].value, hours, minutes);\r\n\t\t},\r\n\r\n\t\t_fill_lightbox_select: function (s, i, d, map) {\r\n\t\t\ts[i + map[0]].value = d.getDate();\r\n\t\t\ts[i + map[1]].value = d.getMonth();\r\n\t\t\ts[i + map[2]].value = d.getFullYear();\r\n\t\t\tif (gantt.defined(map[3])) {\r\n\t\t\t\tvar v = d.getHours() * 60 + d.getMinutes();\r\n\t\t\t\tv = Math.round(v / gantt._get_timepicker_step()) * gantt._get_timepicker_step();\r\n\t\t\t\tvar input = s[i + map[3]];\r\n\t\t\t\tinput.value = v;\r\n\t\t\t\t//in case option not shown\r\n\t\t\t\tinput.setAttribute(\"data-value\", v);\r\n\t\t\t}\r\n\t\t},\r\n\t\ttemplate: new TemplateControl(),\r\n\t\ttextarea: new TextareaControl(),\r\n\t\tselect: new SelectControl(),\r\n\t\ttime: new TimeControl(),\r\n\t\tduration: new DurationControl(),\r\n\t\tparent: new ParentControl(),\r\n\t\tradio: new RadioControl(),\r\n\t\tcheckbox: new CheckboxControl(),\r\n\t\tresources: new ResourcesControl(),\r\n\t\tconstraint: new ConstraintControl(),\r\n\t\tbaselines: new BaselineControl(),\r\n\t\ttypeselect: new TypeselectControl(),\r\n\t\tresource_selector: new NewResourcesControl()\r\n\t};\r\n\r\n\tgantt._is_lightbox_timepicker = function () {\r\n\t\tvar s = this._get_typed_lightbox_config();\r\n\t\tfor (var i = 0; i < s.length; i++)\r\n\t\t\tif (s[i].name == \"time\" && s[i].type == \"time\")\r\n\t\t\t\treturn true;\r\n\t\treturn false;\r\n\t};\r\n\r\n\tgantt._delete_task_confirm = function ({task, message, title, callback, ok}){\r\n\t\tgantt._simple_confirm(message, title, callback, ok);\r\n\t};\r\n\tgantt._delete_link_confirm = function({link, message, title, callback, ok}){\r\n\t\tgantt._simple_confirm(message, title, callback, ok);\r\n\t};\r\n\r\n\tgantt._simple_confirm = function (message, title, callback, ok) {\r\n\t\tif (!message)\r\n\t\t\treturn callback();\r\n\t\tvar opts = { text: message };\r\n\t\tif (title)\r\n\t\t\topts.title = title;\r\n\t\tif (ok) {\r\n\t\t\topts.ok = ok;\r\n\t\t}\r\n\t\tif (callback) {\r\n\t\t\topts.callback = function (result) {\r\n\t\t\t\tif (result)\r\n\t\t\t\t\tcallback();\r\n\t\t\t};\r\n\t\t}\r\n\t\tgantt.confirm(opts);\r\n\t};\r\n\r\n\tfunction _get_type_name(type_value) {\r\n\t\tfor (var i in this.config.types) {\r\n\t\t\tif (this.config.types[i] == type_value) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn \"task\";\r\n\t}\r\n\r\n\tgantt._get_typed_lightbox_config = function (type) {\r\n\t\tif (type === undefined) {\r\n\t\t\ttype = this.getLightboxType();\r\n\t\t}\r\n\r\n\t\tvar field = _get_type_name.call(this, type);\r\n\r\n\t\tif (gantt.config.lightbox[field + \"_sections\"]) {\r\n\t\t\treturn gantt.config.lightbox[field + \"_sections\"];\r\n\t\t} else {\r\n\t\t\treturn gantt.config.lightbox.sections;\r\n\t\t}\r\n\t};\r\n\r\n\tgantt._silent_redraw_lightbox = function (type) {\r\n\t\tvar oldType = this.getLightboxType();\r\n\r\n\t\tif (this.getState().lightbox) {\r\n\t\t\tvar taskId = this.getState().lightbox;\r\n\t\t\tvar formData = this.getLightboxValues(),\r\n\t\t\t\ttask = this.copy(this.getTask(taskId));\r\n\r\n\t\t\tthis.resetLightbox();\r\n\r\n\t\t\tvar updTask = this.mixin(task, formData, true);\r\n\t\t\tvar box = this.getLightbox(type ? type : undefined);\r\n\t\t\tthis._set_lightbox_values(updTask, box);\r\n\t\t\tthis.showCover(box);\r\n\t\t} else {\r\n\t\t\tthis.resetLightbox();\r\n\t\t\tthis.getLightbox(type ? type : undefined);\r\n\t\t}\r\n\t\tthis.callEvent(\"onLightboxChange\", [oldType, this.getLightboxType()]);\r\n\t};\r\n\r\n\tfunction bindLabelsToInputs(sns) {\r\n\t\tvar section;\r\n\t\tvar label;\r\n\t\tvar labelBlock;\r\n\t\tvar inputBlock;\r\n\t\tvar input;\r\n\t\tvar i;\r\n\r\n\t\tfor (i = 0; i < sns.length; i++) {\r\n\t\t\tsection = sns[i];\r\n\t\t\tlabelBlock = gantt._lightbox_root.querySelector(\"#\" + section.id);\r\n\r\n\t\t\tif (!section.id || !labelBlock) continue;\r\n\r\n\t\t\tlabel = labelBlock.querySelector(\"label\");\r\n\t\t\tinputBlock = labelBlock.nextSibling;\r\n\r\n\t\t\tif (!inputBlock) continue;\r\n\r\n\t\t\tinput = inputBlock.querySelector(\"input, select, textarea\");\r\n\t\t\tif (input) {\r\n\t\t\t\tinput.id = input.id || \"input_\" + gantt.uid();\r\n\t\t\t\tsection.inputId = input.id;\r\n\t\t\t\tlabel.setAttribute(\"for\", section.inputId);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getHtmlButtons(buttons, floatRight) {\r\n\t\tvar button;\r\n\t\tvar ariaAttr;\r\n\t\tvar html = \"\";\r\n\t\tvar i;\r\n\r\n\t\tfor (i = 0; i < buttons.length; i++) {\r\n\t\t\t// needed to migrate from 'dhx_something' to 'gantt_something' naming in a lightbox\r\n\t\t\tbutton = gantt.config._migrate_buttons[buttons[i]] ? gantt.config._migrate_buttons[buttons[i]] : buttons[i];\r\n\r\n\t\t\tariaAttr = gantt._waiAria.lightboxButtonAttrString(button);\r\n\t\t\thtml += \"<div \" + ariaAttr + \" class='gantt_btn_set gantt_left_btn_set \" + button + \"_set'\" + \"><div dhx_button='1' data-dhx-button='1' class='\" + button + \"'></div><div>\" + gantt.locale.labels[button] + \"</div></div>\";\r\n\t\t}\r\n\t\treturn html;\r\n\t}\r\n\r\n\tfunction getTimeFormat(sns) {\r\n\t\tvar scale;\r\n\t\tvar unit;\r\n\t\tvar result;\r\n\r\n\t\tif (sns.time_format) return sns.time_format;\r\n\r\n\t\t// default order\r\n\t\tresult = [\"%d\", \"%m\", \"%Y\"];\r\n\t\tscale = gantt.getScale();\r\n\t\tunit = scale ? scale.unit : gantt.config.duration_unit;\r\n\t\tif (helpers.getSecondsInUnit(unit) < helpers.getSecondsInUnit(\"day\")) {\r\n\t\t\tresult.push(\"%H:%i\");\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfunction getHtmlTimePickerOptions(sns, index, settings) {\r\n\t\tvar range;\r\n\t\tvar offset;\r\n\t\tvar start_year;\r\n\t\tvar end_year;\r\n\t\tvar i;\r\n\t\tvar time;\r\n\t\tvar diff;\r\n\t\tvar tdate;\r\n\t\tvar html = \"\";\r\n\r\n\t\tswitch (settings.timeFormat[index]) {\r\n\t\t\tcase \"%Y\":\r\n\t\t\t\tsns._time_format_order[2] = index;\r\n\t\t\t\tsns._time_format_order.size++;\r\n\t\t\t\t//year\r\n\r\n\t\t\t\tif (sns.year_range) {\r\n\t\t\t\t\tif (!isNaN(sns.year_range)) {\r\n\t\t\t\t\t\trange = sns.year_range;\r\n\t\t\t\t\t} else if (sns.year_range.push) {\r\n\t\t\t\t\t\t// if\r\n\t\t\t\t\t\tstart_year = sns.year_range[0];\r\n\t\t\t\t\t\tend_year = sns.year_range[1];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\trange = range || 10;\r\n\t\t\t\toffset = offset || Math.floor(range / 2);\r\n\t\t\t\tstart_year = start_year || settings.date.getFullYear() - offset;\r\n\t\t\t\tend_year = end_year || gantt.getState().max_date.getFullYear() + offset;\r\n\r\n\t\t\t\tfor (i = start_year; i <= end_year; i++)\r\n\t\t\t\t\thtml += \"<option value='\" + (i) + \"'>\" + (i) + \"</option>\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%m\":\r\n\t\t\t\tsns._time_format_order[1] = index;\r\n\t\t\t\tsns._time_format_order.size++;\r\n\t\t\t\t//month\r\n\t\t\t\tfor (i = 0; i < 12; i++)\r\n\t\t\t\t\thtml += \"<option value='\" + i + \"'>\" + gantt.locale.date.month_full[i] + \"</option>\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%d\":\r\n\t\t\t\tsns._time_format_order[0] = index;\r\n\t\t\t\tsns._time_format_order.size++;\r\n\t\t\t\t//days\r\n\t\t\t\tfor (i = 1; i < 32; i++)\r\n\t\t\t\t\thtml += \"<option value='\" + i + \"'>\" + i + \"</option>\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%H:%i\":\r\n\t\t\t\t//  var last = 24*60, first = 0;\r\n\t\t\t\tsns._time_format_order[3] = index;\r\n\t\t\t\tsns._time_format_order.size++;\r\n\t\t\t\t//hours\r\n\t\t\t\ti = settings.first;\r\n\t\t\t\ttdate = settings.date.getDate();\r\n\t\t\t\tsns._time_values = [];\r\n\r\n\t\t\t\twhile (i < settings.last) {\r\n\t\t\t\t\ttime = gantt.templates.time_picker(settings.date);\r\n\t\t\t\t\thtml += \"<option value='\" + i + \"'>\" + time + \"</option>\";\r\n\t\t\t\t\tsns._time_values.push(i);\r\n\t\t\t\t\tsettings.date.setTime(settings.date.valueOf() + gantt._get_timepicker_step() * 60 * 1000);\r\n\t\t\t\t\tdiff = (settings.date.getDate() != tdate) ? 1 : 0; // moved or not to the next day\r\n\t\t\t\t\ti = diff * 24 * 60 + settings.date.getHours() * 60 + settings.date.getMinutes();\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn html;\r\n\t}\r\n};","export default function(gantt) {\r\n\r\n\tgantt._extend_to_optional = function (lightbox_block) {\r\n\r\n\t\tvar duration = lightbox_block;\r\n\t\tvar optional_time = {\r\n\t\t\trender: duration.render,\r\n\t\t\tfocus: duration.focus,\r\n\t\t\tset_value: function (node, value, task, section) {\r\n\t\t\t\tvar mapping = gantt._resolve_default_mapping(section);\r\n\t\t\t\tif (!task[mapping.start_date] || (mapping.start_date == \"start_date\" && this._isAllowedUnscheduledTask(task))) {\r\n\t\t\t\t\toptional_time.disable(node, section);\r\n\t\t\t\t\tvar val = {};\r\n\r\n\t\t\t\t\tfor (var i in mapping) {\r\n\t\t\t\t\t\t//take default values from the time control from task start/end dates\r\n\t\t\t\t\t\tval[mapping[i]] = task[i];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn duration.set_value.call(gantt, node, value, val, section);//set default value\r\n\t\t\t\t} else {\r\n\t\t\t\t\toptional_time.enable(node, section);\r\n\t\t\t\t\treturn duration.set_value.call(gantt, node, value, task, section);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tget_value: function (node, task, section) {\r\n\t\t\t\tif (section.disabled) {\r\n\t\t\t\t\treturn {start_date: null};\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn duration.get_value.call(gantt, node, task, section);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tupdate_block: function (node, section) {\r\n\t\t\t\tgantt.callEvent(\"onSectionToggle\", [gantt._lightbox_id, section]);\r\n\t\t\t\tnode.style.display = section.disabled ? \"none\" : \"\";\r\n\r\n\t\t\t\tif (section.button) {\r\n\t\t\t\t\tvar button = node.previousSibling.querySelector(\".gantt_custom_button_label\"),\r\n\t\t\t\t\t\tlabels = gantt.locale.labels;\r\n\r\n\t\t\t\t\tvar button_text = section.disabled ? labels[section.name + \"_enable_button\"] : labels[section.name + \"_disable_button\"];\r\n\r\n\t\t\t\t\tbutton.innerHTML = button_text;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdisable: function (node, section) {\r\n\t\t\t\tsection.disabled = true;\r\n\t\t\t\toptional_time.update_block(node, section);\r\n\r\n\t\t\t},\r\n\t\t\tenable: function (node, section) {\r\n\t\t\t\tsection.disabled = false;\r\n\t\t\t\toptional_time.update_block(node, section);\r\n\t\t\t},\r\n\t\t\tbutton_click: function (index, el, section, container) {\r\n\t\t\t\tif (gantt.callEvent(\"onSectionButton\", [gantt._lightbox_id, section]) === false) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar config = gantt._get_typed_lightbox_config()[index];\r\n\t\t\t\tif (config.disabled) {\r\n\t\t\t\t\toptional_time.enable(container, config);\r\n\t\t\t\t} else {\r\n\t\t\t\t\toptional_time.disable(container, config);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\treturn optional_time;\r\n\t};\r\n\r\n\tgantt.form_blocks.duration_optional = gantt._extend_to_optional(gantt.form_blocks.duration);\r\n\tgantt.form_blocks.time_optional = gantt._extend_to_optional(gantt.form_blocks.time);\r\n\r\n};","export default function(gantt){\r\n\tvar htmlTags = new RegExp(\"<(?:.|\\n)*?>\", \"gm\");\r\n\tvar extraSpaces = new RegExp(\" +\", \"gm\");\r\n\r\n\tfunction stripHTMLLite(htmlText){\r\n\t\treturn (htmlText + \"\")\r\n\t\t\t.replace(htmlTags, \" \").\r\n\t\t\treplace(extraSpaces, \" \");\r\n\t}\r\n\r\n\tvar singleQuotes = new RegExp(\"'\", \"gm\");\r\n\tfunction escapeQuotes(text){\r\n\t\treturn (text + \"\").replace(singleQuotes, \"&#39;\");\r\n\t}\r\n\r\n\tgantt._waiAria = {\r\n\t\tgetAttributeString: function(attr){\r\n\t\t\tvar attributes = [\" \"];\r\n\t\t\tfor(var i in attr){\r\n\t\t\t\tvar text = escapeQuotes(stripHTMLLite(attr[i]));\r\n\t\t\t\tattributes.push(i + \"='\" + text + \"'\");\r\n\t\t\t}\r\n\t\t\tattributes.push(\" \");\r\n\t\t\treturn attributes.join(\" \");\r\n\r\n\t\t},\r\n\r\n\t\tgetTimelineCellAttr:function(dateString){\r\n\r\n\t\t\treturn gantt._waiAria.getAttributeString({\"aria-label\": dateString});\r\n\t\t},\r\n\r\n\t\t_taskCommonAttr: function(task, div){\r\n\r\n\t\t\tif(!(task.start_date && task.end_date))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tdiv.setAttribute(\"aria-label\", stripHTMLLite(gantt.templates.tooltip_text(task.start_date, task.end_date, task)));\r\n\r\n\t\t\tif(task.$dataprocessor_class){\r\n\t\t\t\tdiv.setAttribute(\"aria-busy\", true);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\tsetTaskBarAttr: function(task, div){\r\n\t\t\tthis._taskCommonAttr(task, div);\r\n\r\n\t\t\t// task bars are complex elements that should be treated as a single element\r\n\t\t\tdiv.setAttribute(\"role\", \"img\");\r\n\r\n\t\t\tif(!gantt.isReadonly(task) && gantt.config.drag_move){\r\n\t\t\t\tif(task.id != gantt.getState(\"tasksDnd\").drag_id){\r\n\t\t\t\t\tdiv.setAttribute(\"aria-grabbed\", false);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdiv.setAttribute(\"aria-grabbed\", true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\ttaskRowAttr: function(task, div){\r\n\r\n\t\t\tthis._taskCommonAttr(task, div);\r\n\r\n\t\t\tif(!gantt.isReadonly(task) && gantt.config.order_branch){\r\n\t\t\t\tdiv.setAttribute(\"aria-grabbed\", false);\r\n\t\t\t}\r\n\r\n\t\t\tdiv.setAttribute(\"role\", \"row\");\r\n\t\t\t// selected attribute should be added only to the grid  because\r\n\t\t\t// other parts don't have the keyboard navigation\r\n\t\t\tdiv.setAttribute(\"aria-selected\", gantt.isSelectedTask(task.id) ? \"true\" : \"false\");\r\n\r\n\t\t\t// allowed values start from 1, set 1 for non-tree datastores\r\n\t\t\tdiv.setAttribute(\"aria-level\", task.$level + 1 || 1);\r\n\r\n\t\t\tif(gantt.hasChild(task.id)){\r\n\t\t\t\tdiv.setAttribute(\"aria-expanded\", task.$open ? \"true\" : \"false\");\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tlinkAttr: function(link, div){\r\n\r\n\t\t\tvar linkTypes = gantt.config.links;\r\n\r\n\t\t\tvar toStart = link.type == linkTypes.finish_to_start || link.type == linkTypes.start_to_start;\r\n\t\t\tvar fromStart = link.type == linkTypes.start_to_start || link.type == linkTypes.start_to_finish;\r\n\r\n\t\t\tvar content = gantt.locale.labels.link + \" \" +  gantt.templates.drag_link(link.source, fromStart, link.target, toStart);\r\n\r\n\t\t\t// links are complex elements that should be treated as a single element\r\n\t\t\tdiv.setAttribute(\"role\", \"img\");\r\n\r\n\t\t\tdiv.setAttribute(\"aria-label\", stripHTMLLite(content));\r\n\t\t},\r\n\r\n\t\tgridSeparatorAttr: function(div){\r\n\t\t\t// the only valid role for the grid header\r\n\t\t\tdiv.setAttribute(\"role\", \"columnheader\");\r\n\t\t},\r\n\t\trowResizerAttr: function(div){\r\n\t\t\t// the only valid role for the grid header\r\n\t\t\tdiv.setAttribute(\"role\", \"row\");\r\n\t\t},\r\n\r\n\t\tlightboxHiddenAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"aria-hidden\", \"true\");\r\n\t\t},\r\n\r\n\t\tlightboxVisibleAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"aria-hidden\", \"false\");\r\n\t\t},\r\n\r\n\t\tlightboxAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"role\", \"dialog\");\r\n\t\t\tdiv.setAttribute(\"aria-hidden\", \"true\");\r\n\t\t\tdiv.firstChild.setAttribute(\"role\", \"heading\");\r\n\t\t\tdiv.firstChild.setAttribute(\"aria-level\", \"1\");\r\n\t\t},\r\n\r\n\t\tlightboxButtonAttrString:function(buttonName){\r\n\t\t\treturn this.getAttributeString({\"role\":\"button\", \"aria-label\":gantt.locale.labels[buttonName], \"tabindex\":\"0\"});\r\n\t\t},\r\n\r\n\t\tlightboxHeader: function(div, headerText){\r\n\t\t\tdiv.setAttribute(\"aria-label\", headerText);\r\n\t\t},\r\n\r\n\t\tlightboxSelectAttrString: function(time_option){\r\n\t\t\tvar label = \"\";\r\n\r\n\t\t\tswitch (time_option) {\r\n\t\t\t\tcase \"%Y\":\r\n\t\t\t\t\tlabel = gantt.locale.labels.years;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%m\":\r\n\t\t\t\t\tlabel = gantt.locale.labels.months;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%d\":\r\n\t\t\t\t\tlabel = gantt.locale.labels.days;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%H:%i\":\r\n\t\t\t\t\tlabel = gantt.locale.labels.hours + gantt.locale.labels.minutes;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\treturn gantt._waiAria.getAttributeString({\"aria-label\": label});\r\n\t\t},\r\n\r\n\t\tlightboxDurationInputAttrString: function(section){\r\n\t\t\treturn this.getAttributeString({\r\n\t\t\t\t\"aria-label\": gantt.locale.labels.column_duration,\r\n\t\t\t\t\"aria-valuemin\": \"0\",\r\n\t\t\t\t\"role\": \"spinbutton\"\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tinlineEditorAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"role\", \"row\");\r\n\t\t},\r\n\r\n\t\tgridAttrString: function(){\r\n\t\t\treturn [\" role='treegrid'\", gantt.config.multiselect ? \"aria-multiselectable='true'\" : \"aria-multiselectable='false'\", \" \"].join(\" \");\r\n\t\t},\r\n\r\n\r\n\t\tgridScaleRowAttrString: function(){\r\n\t\t\treturn \"role='row'\";\r\n\t\t},\r\n\r\n\t\tgridScaleCellAttrString: function(column, label){\r\n\t\t\tvar attrs = \"\";\r\n\t\t\tif(column.name == \"add\"){\r\n\t\t\t\t// a more precise role is button, but it is not valid for the grid header\r\n\t\t\t\tattrs = this.getAttributeString({\"role\":\"columnheader\", \"aria-label\": gantt.locale.labels.new_task});\r\n\t\t\t}else{\r\n\r\n\t\t\t\tvar attributes = {\r\n\t\t\t\t\t\"role\":\"columnheader\",\r\n\t\t\t\t\t\"aria-label\": gantt.config.external_render && gantt.config.external_render.isElement(label) ? \"\" : label\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(gantt._sort && gantt._sort.name == column.name){\r\n\t\t\t\t\tif(gantt._sort.direction == \"asc\"){\r\n\t\t\t\t\t\tattributes[\"aria-sort\"] = \"ascending\";\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tattributes[\"aria-sort\"] = \"descending\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tattrs = this.getAttributeString(attributes);\r\n\t\t\t}\r\n\t\t\treturn attrs;\r\n\t\t},\r\n\r\n\t\tgridDataAttrString: function(){\r\n\t\t\treturn \"role='rowgroup'\";\r\n\t\t},\r\n\r\n\t\treorderMarkerAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"role\", \"grid\");\r\n\t\t\tdiv.firstChild.removeAttribute(\"aria-level\");\r\n\t\t\tdiv.firstChild.setAttribute(\"aria-grabbed\", \"true\");\r\n\t\t},\r\n\r\n\t\tgridCellAttrString: function(column, textValue, task){\r\n\t\t\tvar attributes = {\"role\":\"gridcell\", \"aria-label\": textValue};\r\n\t\t\tif(!column.editor || gantt.isReadonly(task)){\r\n\t\t\t\tattributes[\"aria-readonly\"] = true;\r\n\t\t\t}\r\n\r\n\t\t\treturn this.getAttributeString(attributes);\r\n\t\t},\r\n\r\n\t\tgridAddButtonAttrString: function(column){\r\n\t\t\treturn this.getAttributeString({\"role\":\"button\", \"aria-label\": gantt.locale.labels.new_task});\r\n\t\t},\r\n\r\n\t\tmessageButtonAttrString: function(buttonLabel){\r\n\t\t\treturn \"tabindex='0' role='button' aria-label='\"+buttonLabel+\"'\";\r\n\t\t},\r\n\r\n\t\tmessageInfoAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"role\", \"alert\");\r\n\t\t\t//div.setAttribute(\"tabindex\", \"-1\");\r\n\t\t},\r\n\r\n\t\tmessageModalAttr: function(div, uid){\r\n\t\t\tdiv.setAttribute(\"role\", \"dialog\");\r\n\t\t\tif(uid){\r\n\t\t\t\tdiv.setAttribute(\"aria-labelledby\", uid);\r\n\t\t\t}\r\n\r\n\t\t//\tdiv.setAttribute(\"tabindex\", \"-1\");\r\n\t\t},\r\n\r\n\t\tquickInfoAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"role\", \"dialog\");\r\n\t\t},\r\n\r\n\t\tquickInfoHeaderAttrString: function(){\r\n\t\t\treturn \" role='heading' aria-level='1' \";\r\n\t\t},\r\n\r\n\t\tquickInfoHeader: function(div, header){\r\n\t\t\tdiv.setAttribute(\"aria-label\", header);\r\n\t\t},\r\n\r\n\t\tquickInfoButtonAttrString: function(label){\r\n\t\t\treturn gantt._waiAria.getAttributeString({\"role\":\"button\", \"aria-label\":label, \"tabindex\":\"0\"});\r\n\t\t},\r\n\r\n\t\ttooltipAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"role\", \"tooltip\");\r\n\t\t},\r\n\r\n\t\ttooltipVisibleAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"aria-hidden\", \"false\");\r\n\t\t},\r\n\r\n\t\ttooltipHiddenAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"aria-hidden\", \"true\");\r\n\t\t}\r\n\t};\r\n\r\n\tfunction isDisabled(){\r\n\t\treturn !gantt.config.wai_aria_attributes;\r\n\t}\r\n\r\n\tfor(var i in gantt._waiAria){\r\n\t\tgantt._waiAria[i] = (function(payload){\r\n\t\t\treturn function(){\r\n\t\t\t\tif(isDisabled()){\r\n\t\t\t\t\treturn \"\";\r\n\t\t\t\t}\r\n\t\t\t\treturn payload.apply(this, arguments);\r\n\t\t\t};\r\n\t\t})(gantt._waiAria[i]);\r\n\t}\r\n\r\n\r\n};","import * as utils from \"../utils/utils\";\r\nimport env from \"../utils/env\";\r\nimport isHeadless from \"../utils/is_headless\";\r\nimport * as domHelpers from \"./ui/utils/dom_helpers\";\r\nimport * as codeHelpers from \"../utils/helpers\";\r\nimport domEventScope from \"./ui/utils/dom_event_scope\";\r\nimport messages from \"./ui/message\";\r\nimport ui from \"./ui/index\";\r\nimport createLayoutFacade from \"./facades/layout\";\r\nimport taskLayers from \"./data_task_layers\";\r\n\r\nimport skin from \"./ui/skin\";\r\nimport skyblue from \"../css/skins/skyblue\";\r\nimport meadow from \"../css/skins/meadow\";\r\nimport terrace from \"../css/skins/terrace\";\r\nimport broadway from \"../css/skins/broadway\";\r\nimport material from \"../css/skins/material\";\r\nimport dark from \"../css/skins/dark\";\r\nimport contrast_black from \"../css/skins/contrast_black\";\r\nimport contrast_white from \"../css/skins/contrast_white\";\r\nimport plugins from \"./ui/plugins\";\r\nimport touch from \"./ui/touch\";\r\nimport lightbox from \"./ui/lightbox\";\r\nimport lightbox_optional_time from \"./ui/lightbox/lightbox_optional_time\";\r\nimport wai_aria from \"./ui/wai_aria\";\r\n\r\n\r\nexport default function(gantt) {\r\n\r\n\tif(!env.isNode){\r\n\r\n\t\tgantt.utils = {\r\n\t\t\tarrayFind: codeHelpers.arrayFind,\r\n\t\t\tdom: domHelpers\r\n\t\t};\r\n\r\n\t\tvar domEvents = domEventScope();\r\n\t\tgantt.event = domEvents.attach;\r\n\t\tgantt.eventRemove = domEvents.detach;\r\n\t\tgantt._eventRemoveAll = domEvents.detachAll;\r\n\t\tgantt._createDomEventScope = domEvents.extend;\r\n\r\n\t\tutils.mixin(gantt, messages(gantt));\r\n\t\tvar uiApi = ui.init(gantt);\r\n\t\tgantt.$ui = uiApi.factory;\r\n\t\tgantt.$ui.layers = uiApi.render;\r\n\t\tgantt.$mouseEvents = uiApi.mouseEvents;\r\n\t\tgantt.$services.setService(\"mouseEvents\", function () {\r\n\t\t\treturn gantt.$mouseEvents;\r\n\t\t});\r\n\t\tgantt.mixin(gantt, uiApi.layersApi);\r\n\r\n\t\ttaskLayers(gantt);\r\n\r\n\t\tgantt.$services.setService(\"layers\", function () {\r\n\t\t\treturn uiApi.layersService;\r\n\t\t});\r\n\r\n\t\tgantt.mixin(gantt, createLayoutFacade());\r\n\t\tskin(gantt);\r\n\t\tskyblue(gantt);\r\n\t\tdark(gantt);\r\n\t\tmeadow(gantt);\r\n\t\tterrace(gantt);\r\n\t\tbroadway(gantt);\r\n\t\tmaterial(gantt);\r\n\t\tcontrast_black(gantt);\r\n\t\tcontrast_white(gantt);\r\n\t\tplugins(gantt);\r\n\t\ttouch(gantt);\r\n\t\tlightbox(gantt);\r\n\t\tlightbox_optional_time(gantt);\r\n\t\twai_aria(gantt);\r\n\r\n\t\tgantt.locate = function(e) {\r\n\t\t\tvar trg = domHelpers.getTargetNode(e);\r\n\r\n\t\t\t// ignore empty rows/cells of the timeline\r\n\t\t\tif(domHelpers.closest(trg, \".gantt_task_row\")){\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tvar targetAttribute = arguments[1] || this.config.task_attribute;\r\n\r\n\t\t\tvar node = domHelpers.locateAttribute(trg, targetAttribute);\r\n\t\t\tif(node){\r\n\t\t\t\treturn node.getAttribute(targetAttribute);\r\n\t\t\t}else{\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tgantt._locate_css = function(e, classname, strict){\r\n\t\t\treturn domHelpers.locateClassName(e, classname, strict);\r\n\t\t};\r\n\r\n\t\tgantt._locateHTML = function(e, attribute) {\r\n\t\t\treturn domHelpers.locateAttribute(e, attribute || this.config.task_attribute);\r\n\t\t};\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onParse\", function(){\r\n\t\tif(!isHeadless(gantt)){\r\n\t\t\tgantt.attachEvent(\"onGanttRender\", function(){\r\n\t\t\t\tif(gantt.config.initial_scroll){\r\n\t\t\t\t\tvar firstTask = gantt.getTaskByIndex(0);\r\n\t\t\t\t\tvar id = firstTask ? firstTask.id : gantt.config.root_id;\r\n\t\t\t\t\t// GS-1450. Don't scroll to the task if there is no timeline\r\n\t\t\t\t\tif(gantt.isTaskExists(id) && gantt.$task && gantt.utils.dom.isChildOf(gantt.$task, gantt.$container)){\r\n\t\t\t\t\t\tgantt.showTask(id);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, {once: true});\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onBeforeGanttReady\", function(){\r\n\t\tif (!this.config.scroll_size)\r\n\t\t\tthis.config.scroll_size = domHelpers.getScrollSize() || 15;\r\n\r\n\t\tif(!isHeadless(gantt)){\r\n\t\t\t// detach listeners before clearing old DOM, possible IE errors when accessing detached nodes\r\n\t\t\tthis._eventRemoveAll();\r\n\t\t\tthis.$mouseEvents.reset();\r\n\r\n\t\t\tthis.resetLightbox();\r\n\t\t}\r\n\r\n\t});\r\n\r\n\t// GS-1261: scroll the views to the right side when RTL is enabled\r\n\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\t\tif(!isHeadless(gantt) && gantt.config.rtl){\r\n\t\t\tgantt.$layout.getCellsByType(\"viewCell\").forEach(function(cell){ \r\n\t\t\t\tvar attachedScrollbar = cell.$config.scrollX;\r\n\t\t\t\tif (!attachedScrollbar) return;\r\n\r\n\t\t\t\tvar scrollbar = gantt.$ui.getView(attachedScrollbar);\r\n\t\t\t\tif (scrollbar) scrollbar.scrollTo(scrollbar.$config.scrollSize,0);\r\n\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\t// GS-1649: check if extensions are connected via files\r\n\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\t\tif(!isHeadless(gantt)){\r\n\r\n\t\t\tvar activePlugins = gantt.plugins();\r\n\r\n\t\t\tvar availablePlugins = {\r\n\t\t\t\tauto_scheduling: gantt.autoSchedule,\r\n\t\t\t\tclick_drag: gantt.ext.clickDrag,\r\n\t\t\t\tcritical_path: gantt.isCriticalTask,\r\n\t\t\t\tdrag_timeline: gantt.ext.dragTimeline,\r\n\t\t\t\texport_api: gantt.exportToPDF,\r\n\t\t\t\tfullscreen: gantt.ext.fullscreen,\r\n\t\t\t\tgrouping: gantt.groupBy,\r\n\t\t\t\tkeyboard_navigation: gantt.ext.keyboardNavigation,\r\n\t\t\t\tmarker: gantt.addMarker,\r\n\t\t\t\tmultiselect: gantt.eachSelectedTask,\r\n\t\t\t\toverlay: gantt.ext.overlay,\r\n\t\t\t\tquick_info: gantt.templates.quick_info_content,\r\n\t\t\t\ttooltip: gantt.ext.tooltips,\r\n\t\t\t\tundo: gantt.undo\r\n\t\t\t};\r\n\r\n\t\t\tfor (let plugin in availablePlugins){\r\n\t\t\t\tif (availablePlugins[plugin] && !activePlugins[plugin]){\r\n\t\t\t\t\t// eslint-disable-next-line no-console\r\n\t\t\t\t\tconsole.warn(`You connected the '${plugin}' extension via an obsolete file. \r\nTo fix it, you need to remove the obsolete file and connect the extension via the plugins method: https://docs.dhtmlx.com/gantt/api__gantt_plugins.html`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n};","export default function(gantt) {\r\n\tgantt.load = function (url, type, callback) {\r\n\t\tthis._load_url = url;\r\n\t\tthis.assert(arguments.length, \"Invalid load arguments\");\r\n\r\n\t\tvar tp = 'json', cl = null;\r\n\t\tif (arguments.length >= 3) {\r\n\t\t\ttp = type;\r\n\t\t\tcl = callback;\r\n\t\t} else {\r\n\t\t\tif (typeof arguments[1] == \"string\")\r\n\t\t\t\ttp = arguments[1];\r\n\t\t\telse if (typeof arguments[1] == \"function\")\r\n\t\t\t\tcl = arguments[1];\r\n\t\t}\r\n\r\n\t\tthis._load_type = tp;\r\n\r\n\t\tthis.callEvent(\"onLoadStart\", [url, tp]);\r\n\r\n\t\treturn this.ajax.get(url, gantt.bind(function (l) {\r\n\t\t\tthis.on_load(l, tp);\r\n\t\t\tthis.callEvent(\"onLoadEnd\", [url, tp]);\r\n\t\t\tif (typeof cl == \"function\")\r\n\t\t\t\tcl.call(this);\r\n\t\t}, this));\r\n\t};\r\n};","import \"../css/dhtmlxgantt.less\";\r\n\r\nimport factory from \"./make_instance_common\";\r\nimport ui from \"../core/ui_core\";\r\nimport ajaxLoading from \"../core/loading/ajax_loading\";\r\nimport dynamicLoading from \"../core/loading/dynamic_loading\";\r\n\r\nexport default function(supportedExtensions) {\r\n\tvar gantt = factory(supportedExtensions);\r\n\r\n\tif(!gantt.env.isNode){\r\n\t\tui(gantt);\r\n\t\tajaxLoading(gantt);\r\n\t\tdynamicLoading(gantt);\r\n\t}\r\n\r\n\treturn gantt;\r\n};","import extensions from \"./ext/extensions_gpl\";\r\nimport base from \"./factory/make_instance_web\";\r\nimport scope from \"./utils/global\";\r\nconst gantt = (scope as any).gantt = base(extensions);\r\n\r\nexport default gantt;\r\nexport { gantt };"],"names":["getNodePosition","elem","top","left","right","bottom","getBoundingClientRect","box","body","document","docElem","documentElement","parentNode","scrollTop","window","pageYOffset","scrollLeft","pageXOffset","clientTop","clientLeft","offsetWidth","offsetHeight","parseInt","offsetTop","offsetLeft","offsetParent","y","Math","round","x","width","height","isVisible","node","display","visibility","getComputedStyle","style","currentStyle","hasNonNegativeTabIndex","isNaN","getAttribute","hasHref","canHaveHref","a","area","nodeName","loLowerCase","isEnabled","canDisable","input","select","textarea","button","object","toLowerCase","hasAttribute","getFocusableNodes","root","nodes","querySelectorAll","join","nodesArray","Array","prototype","slice","call","i","length","$position","sort","b","tabIndex","isValid","splice","getScrollSize","div","createElement","cssText","appendChild","clientWidth","removeChild","max","getClassName","className","baseVal","indexOf","_trimString","addClassName","removeClassName","name","split","regEx","RegExp","replace","hasClass","element","classList","contains","test","toNode","getElementById","querySelector","_slave","insertNode","newone","innerHTML","child","firstChild","removeNode","getChildNodes","css","ch","childNodes","len","out","obj","push","getTargetNode","e","trg","tagName","event","target","srcElement","shadowRoot","composedPath","locateAttribute","attribute","host","str","func","String","trim","this","apply","locateClassName","classname","strict","undefined","ind","charAt","getRelativeEventPosition","ev","d","clientX","clientY","touches","getRelativeNodePosition","parent","childPos","parentPos","isChildOf","closest","selector","matches","msMatchesSelector","webkitMatchesSelector","el","method","parentElement","nodeType","console","error","getClosestSizedElement","isShadowDomSupported","head","createShadowRoot","attachShadow","getActiveElement","activeElement","getSelection","focusNode","getRootNode","ShadowRoot","hasShadowParent","globalScope","global","scope","EventsManager$1","EventsManager","gantt","_mouseDown","_touchStarts","_touchActive","_longTapTimer","_gantt","_domEvents","_createDomEventScope","selectedRegion","useKey","ignore","_target","getViewPort","_originPosition","_restoreOriginPosition","position","state","$services","getService","registerProvider","result","autoscroll","scheduledDndCoordinates","startDragAndDrop","setStart","copy","setPosition","setEnd","attach","startDrag","eventElement","domHelpers.getRootNode","$root","stopDrag","dragMove","setTimeout","getTouchEvent","config","touch_drag","clearTimeout","filterTargets","getFilterTargets","utils","dom","preventDefault","touchEvent","changedTouches","_getCoordinates","coordinates","dragEnd","dragTimeline","ext","clickDrag","dragTimelineUseKey","drag_timeline","abs","relative","render","detachAll","unregisterProvider","destructor","detach","viewPort","viewPortBounds","absolute","EventHost","_silent_mode","listeners","_silentStart","_silentEnd","createEventStorage","handlers","index","eventStorage","combinedResult","handlerResult","arguments","addEvent","handler","settings","handlerId","id","once","originalHandler","removeEvent","clear","makeEventable","eventHost","attachEvent","eventName","thisObject","bind","innerId","attachAll","callback","callEvent","eventArguments","handlerName","concat","checkEvent","detachEvent","list","eventId","detachAllEvents","units","second","minute","hour","day","week","month","quarter","year","getSecondsInUnit","unit","forEach","arr","workArray","arrayMap","map","resArray","arrayFind","find","arrayIncludes","item","includes","isArray","pop","isDate","getFullYear","getMonth","getDate","isValidDate","getTime","arrayFilter","filter","throttle","timeout","wait","delay","timer","$cancelTimeout","$pending","args","$execute","isEventable","replaceValidZeroId","rootId","checkZeroId","findBinary","array","low","high","prev","floor","SelectedRegion","view","_el","defaultRender","start","end","min","_singleRow","pos","_getTaskPositionByTop","_startPoint","_view","_viewPort","add","_callback","_endPoint","draw","eventable","singleRow","_useRequestAnimationFrame","useRequestAnimationFrame","requestAnimationFrame","getElement","startPoint","_startDate","dateFromPos","endPoint","_endDate","_positionPoint","positionPoint","getState","max_date","valueOf","tasksByTime","getTaskByTime","tasksByIndex","_getTasksByTop","startValue","endValue","startIndex","endIndex","task","getTaskByIndex","getItemIndexByTopPosition","getItemHeight","itemTop","getItemTop","dataHeight","getTotalHeight","row_height","getTaskCount","click_drag","defaultConfig","setClickDrag","$task_data","timeline","$ui","getView","$container","_dragInProgress","_calculateDirectionVector","traceSteps","_trace","dots","vectors","resultVector","vector","magnitude","sqrt","angleDegrees","atan2","PI","_applyDndReadyStyles","_timeline","$task","_clearDndReadyStyles","remove","_getScrollPosition","$config","scrollX","getScrollState","scrollY","_countNewScrollPosition","coords","shiftX","shiftY","_scrollState","_setScrollPosition","scrollLayoutCell","$id","_stopDrag","_originalReadonly","readonly","_originAutoscroll","_startDrag","_isDragInProgress","enabled","clickDragUseKey","scrollPosition","create","plainObjectConstructor","constructor","toString","isCustomType","constructorString","isExternalType","$$typeof","helpers.isDate","Date","helpers.isArray","Object","hasOwnProperty","mixin","source","force","f","defined","seed","uid","functor","capture","addEventListener","eventRemove","removeEventListener","ScaleHelper","dateHelper","date","getSum","sizes","from","to","summ","setSumWidth","sum_width","scale","parts","oldWidth","diff","adjustSize","full_width","splitSize","count","full","share","sortScales","scales","cellSize","step","_prepareScaleObject","format","template","date_to_str","projection","column_width","primaryScale","scaleConfig","templates","scale_cell_class","getAdditionalScales","prepareConfigs","min_coll_width","container_width","scale_height","minDate","maxDate","rtl","heights","configs","main_scale","cfg","initScaleConfig","processIgnores","display_count","initColSizes","limitVisibleRange","unshift","alineScaleColumns","reverseScale","setPosSettings","reverse","trace_x","indexes","trace_indexes","trace_index_transition","_ignore_time_config","skip_off_time","skip","probe","isWorkTime","ignore_x","min_col_width","line_height","cont_width","column_count","fixedMode","baseCellWidth","col_width","ignores","days","min_date","utils.mixin","eachColumn","trace_x_ascending","iterateScales","lower_scale","upper_scale","upper_dates","lower_dates","prevUpper","up","target_index","upper_start","upper_end","lower_start","lower_end","targetWidth","actualWidth","curr","tzOffset","getTimezoneOffset","_correct_dst_change","dates","last","lastDate","outDate","shared","ScaleIgnoreHelper","helper","ignore_time","ignored_colls","export_api","_apiUrl","type","previousDateRage","start_date","end_date","str_to_date","date_format","data","_serializeHtml","_serializeAll","_fixColumns","columns","raw","_preparePDFConfigRaw","_prepareConfigPDF","version","_sendToExport","_pdfExportRouter","_serializePlain","tasks","scroll","smartRendering","smart_rendering","visual","convert","eachTask","_eachTaskTimed","title","_serializeTimeline","_serializeGrid","rawDates","_serializeScales","scrollTo","worktime","_getWorktimeSettings","formData","File","FormData","append","_sendImportAjaxExcel","_sendImportAjaxMSP","importFromMSProject","skip_circular_links","oldXmlFormat","xml_format","oldFormatDate","format_date","oldXmlDate","xml_date","oldDateFormat","exportServiceDateFormat","_customProjectProperties","_customTaskProperties","_clearRecLinks","_exportConfig","$custom_data","custom","exportToMSProject","label","locale","labels","url","pack","cb","ajax","post","base","$template","server","store","JSON","stringify","sheet","xhr","XMLHttpRequest","onreadystatechange","readyState","status","onload","fail","info","parse","responseText","open","setRequestHeader","send","encodeURIComponent","loader","xdoc","xmlDoc","_xdr","col","editor","editor_types","skin","_serializableGanttConfig","_markColumns","_ajaxToExport","form","_createHiddenForm","action","value","submit","_hidden_export_form","t","constraint_date","deadline","key","formatDate","_color_box","_color_hash","color","_getColor","backgroundColor","parsedRanges","minutes","range","startMinute","endMinute","defaultWorkTimes","hours","time","work_time","wTime","_working_time_helper","get_calendar","worktimes","parsed","_getMinutesWorktimeSettings","code","master","root_id","branch","getChildren","_pull","hasChild","_originalCopyObject","json","_copyObject","text","task_text","_copyObjectBase","serializeTask","rgb","match","toISOstring","_copyObjectColumns","_copyObjectPlainExcel","original_start_date","original_end_date","calculateEndDate","duration","_generatedScales","_generateScales","scaleHelper","getSubScales","scalesConfig","min_column_width","helpers.findBinary","_copyObjectTable","startDate","endDate","getDayIndex","columnIndexByDate","allScales","$start","_getDayIndex","$end","getScale","hiddenCells","scaleCellsWidth","$level","$type","$rendered_type","tmps","$text","$left","leftside_text","$right","rightside_text","getTaskNode","targetNode","$color","cellCss","task_class","styles","_getStyles","ct","val","date_grid","$open","smartScales","smart_scales","html","_copyObjectAll","_exportSerialize","_copyObjectPlainICal","links","show_chart","availWidth","autosize","autosize_min_width","_getScales","minWidth","$scaleHelper","_getRaw","custom_dataset","serialize","children","childBar","_copyObjectColors","$split_subtask","split_bars","skippedTasks","j","sibling","overlap","cover","taskStore","getDatastore","filteredIds","visibleOrder","filteredDataset","cellColors","timeline_cell_class","task_cell_class","steps","getTask","Infinity","row","scaleCell","scaleCell_class","scaleCss","exportMode","cols","ccount","hide","header","tree","xmlFormat","_lvl","_setLevel","link","isTaskExists","_makeLinksSameLevel","skippedLinks","_clearCircDependencies","keys","_clearLinksSameLevel","_clearLevel","usedTasks","prevLink","sources","$_source","_onCircDependencyFind","targets","curLink","targetTask","_source","targetLvl","linkT","sourceParent","targetParent","$_target","project","projectName","projectDates","getSubtaskDates","start_end","autoSchedulingConfig","_getAutoSchedulingConfig","manual","res","durationUnit","projectProperties","taskProperties","resourceProperties","exportToPDF","exportToPNG","exportToICal","exportToExcel","exportToJSON","importFromExcel","importFromPrimaveraP6","exportToPrimaveraP6","fullscreen","isExpanded","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","isFullscreenAvailable","fullscreenEnabled","webkitFullscreenEnabled","mozFullScreenEnabled","msFullscreenEnabled","backupBodyPadding","overflow","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","backupElementSizes","zIndex","modified","backupPositioning","resetParentPositioning","positions","originalPositioning","restoreParentPositioning","record","setFullScreenSizes","getFullscreenElement","updateSizes","restoreSizes","addDOMEvents","onFullScreenChange","expandGantt","isBodyExpanded","cantFullscreen","warning","log","requestArguments","webkitRequestFullscreen","Element","ALLOW_KEYBOARD_INPUT","requestFullscreen","msRequestFullscreen","mozRequestFullScreen","collapse","requestExitFullscreen","msExitFullscreen","mozCancelFullScreen","webkitExitFullscreen","exitFullscreen","expand","keyboard_shortcuts","$keyboardNavigation","shortcuts","createCommand","modifiers","shift","alt","ctrl","meta","keyCode","shortcut","commands","expr","getExpressions","words","getWords","command","commandKeys","specialKeys","charCodeAt","getCommandFromEvent","domEvent","shiftKey","altKey","ctrlKey","metaKey","which","printableKey","fromCharCode","getHashFromEvent","getHash","junctionChar","term","combinationChar","backspace","tab","enter","esc","space","down","home","pageup","pagedown","delete","insert","plus","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","eventhandler","EventHandler","_handlers","findHandler","hash","doAction","eventFacade","facade","returnValue","unbind","bindAll","initKeys","trap_modal_focus","domHelpers.getFocusableNodes","trapFocus","focusable","currentFocus","domHelpers.getActiveElement","currentIndex","lastItem","focus","firstItem","gantt_node","GanttNode","_compose","blur","scrollHorizontal","dir","posFromDate","scrollVertical","undo","redo","nav_node","KeyNavNode","fallback","moveTo","dispatcher","setActiveNode","compareTo","canStringifyThis","canStringifyThat","getNode","setAttribute","$eventAttached","header_cell","HeaderCell","show_grid","getVisibleTaskCount","getGridColumns","TaskRow","visibleColumns","fromDomElement","cellElement","domHelpers.locateClassName","previousSibling","$grid_scale","cells","taskRow","rootLevel","keyboard_navigation_cells","TaskCell","click","isReadonly","createTask","taskId","task_row","getTaskIndex","globalIndex","getGlobalTaskIndex","splitItem","parentId","getParent","nextIndex","locate","isTaskVisible","$grid","task_attribute","replaceAll","keptFocus","getTaskPosition","getTaskHeight","viewWidth","inner_width","viewHeight","$grid_data","inner_height","visibleTimeline","scroll_on_click","task_scroll_offset","scrollGrid","grid","scrollPositionX","scrollPositionY","attachedScrollbarHorizontal","scrollable","scrollbarHorizontal","attachedScrollbarVertical","scrollbarVertical","nextElement","prevTask","getPrev","nextTask","getNext","close","prevId","getPrevSibling","moveTask","updateTask","isSelectedTask","selectTask","unselectTask","$click","buttons","showLightbox","task_cell","columnIndex","domHelpers.locateAttribute","show_tasks_outside_timescale","modals","modalsStack","isModal","afterPopup","$destroyed","startModal","endModal","isTopModal","currentTarget","traceLightbox","getLightbox","saveFocus","restoreFocus","focusElement","core","isActive","activeNode","globalNode","enable","getActiveNode","disable","getDefaultNode","setDefaultNode","inputs","focusGlobalNode","blurNode","focusChanged","keyDownHandler","defaultPrevented","ganttNode","_timeout","awaitsFocus","clearDelay","keyboard_navigation","setupKeyNav","p","isTaskFocused","isInlineEditorCell","isNoKeyboardNavigationElement","isLightboxElement","focusHandler","$preventDefault","reFocusActiveNode","outsideGantt","domHelpers.isChildOf","localName","domElement","mousedownHandler","removeAttribute","getTaskNodeConstructor","domHelpers.closest","locateTask","visibleGrid","taskBar","gridLeft","gridRight","nodePosition","nodeHidden","rightPosition","positionX","column","onReady","$data","tasksStore","currentNode","gridDataTopScroll","gridDataBottomScroll","_smart_render","updateRender","_redrawTasks","renderers","items","focusedItemVisible","createdTaskId","keepFocusOnNewTask","types","placeholder","nodeConstructor","placeholder_task","focusOnCreate","oldId","newId","interval","setInterval","clearInterval","getScopeName","getScope","mode","scopes","headerCell","taskCell","findVisibleColumnIndex","columnName","keyNavFacade","addShortcut","scopeObject","getShortcutHandler","getCommandHandler","removeShortcut","keyboardNavigation","marker","_markers","createDatastore","initItem","show_markers","render_marker","marker_class","markerHeight","getRowTop","timeline_placeholder","scrollHeight","content","external_render","isElement","renderElement","initMarkerArea","$marker_area","markerArea","renderMarkers","layers","markerRenderer","createDataRender","defaultContainer","addLayer","getMarker","getItem","addMarker","addItem","deleteMarker","exists","removeItem","updateMarker","refresh","_getMarkers","getItems","multiselect","multiselect_one_level","_multiselect","_selected","_one_level","_active","_first_selected_when_shift","getDefaultSelected","selected","getSelected","setFirstSelected","getFirstSelected","updateState","active","select_task","reset","setLastSelected","silent","unselect","getLastSelected","getSelectedId","afterSelect","toggle","isSelected","forSelected","isSameLevel","calculateTaskLevel","_quickRefresh","refreshTask","doSelection","_is_icon_open_click","target_ev","defaultLast","isLast","multiSelect","singleSelection","controller","inlineEditors","cell","locateCell","inline_editors_multiselect_open","getEditorConfig","startEdit","blockSelection","first_indx","target_indx","last_indx","tmp","old_selectTask","old_unselectTask","toggleTaskSelection","getSelectedTasks","eachSelectedTask","getLastSelectedTask","old_isSelected","new_id","task_id","oldSelectedId","oldSelectedTask","newSelectedTask","differentTreeLevel","QuickInfo","show","_showForTask","_showAtCoordinates","forced","qi","_quickInfoBox","_quickInfoBoxId","_quickInfoTask","quick_info_detached","setContainer","container","_container","setContent","defaultContent","quickinfo_buttons","_createQuickInfoElement","titleBox","titleContent","titleDate","main","controls","_waiAria","quickInfoHeader","ariaAttr","quickInfoButtonAttrString","_qiButtonClickHandler","_qiKeyPressHandler","_qi_button_click","_appendAtCoordinates","show_quick_info","offset","_getContainer","_get_event_counter_part","xViewport","yViewport","_init_quick_info","_prepare_quick_info_classname","_fill_quick_data","_show_quick_info","domEv","getTaskRowNode","dx","dy","quickInfoAttr","quickInfoHeaderAttrString","_quickInfoReadonly","taskType","getTaskType","quick_info_class","allowedButtons","isEditor","icon_delete","icon_edit","quick_info_title","quick_info_date","quick_info_content","popupHeight","scrolls","screenWidth","relativePopupTop","relativePopupBottom","mask","$layout","quick_info","quickInfo","substr","details","task_time","addButton","collapseButton","expandButton","showQuickInfo","events","hidingFunction","hideQuickInfo","quickInfoClick","clearQuickInfo","createScope","utils.event","utils.eventRemove","eventScope","staticArray","extend","Tooltip","_tooltipNode","tooltipAttr","_root","_isLikeMouseEvent","_calculateTooltipPosition","tooltipVisibleAttr","tooltipHiddenAttr","viewport","_getViewPortSize","tooltipNode","tooltip","offsetX","tooltip_offset_x","offsetY","tooltip_offset_y","mouse","domHelpers.getRelativeEventPosition","containerPos","domHelpers.getNodePosition","_getViewPort","TooltipManager","_listeners","domEventsScope","_initDelayedFunctions","hideTooltip","delayHide","watchableTarget","eventTarget","domHelpers.getTargetNode","doOnMouseEnter","onmouseenter","onmousemove","onmouseleave","listener","cloneDomEvent","clone","createEvent","delayShow","helpers.delay","tooltip_timeout","tooltip_hide_timeout","tooltipManager","tooltips","tooltipFor","touch","touch_tooltip","targetTaskId","tooltip_text","isLinkCreate","link_source_id","noTrack","onBeforeUndo","onBeforeRedo","batchActions","Monitor","_batchAction","_batchMode","_ignore","_ignoreMoveEvents","_initialTasks","_initialLinks","_nestedTasks","_nestedLinks","_undo","_attachEvents","overwrite","undo_types","_storeTask","_storeLink","isMoveEventsIgnored","newValue","stopIgnore","stopBatchAction","logAction","_storeTaskCommand","update","$local_index","_storeEntityCommand","getInitialTask","move","entity","childrenLinks","_storeLinkCommand","taskIds","linkIds","_getLinks","setInitialTask","uniqueLinks","setInitialLink","$index","setInitialTaskObject","clearInitialTasks","getLink","deleteCacheCooldown","saveInitialAll","clearInitialLinks","getLinks","getMoveObjectByTaskId","startIgnore","startBatchAction","clearUndoStack","clearRedoStack","onTaskAdded","onTaskUpdated","onTaskDeleted","onLinkAdded","onLinkUpdated","onLinkDeleted","onTaskMoved","toggleIgnoreMoveEvents","nested","setNestedTasks","datastore","tindex","dragId","projectDrag","drag_id","isSummaryTask","drag_project","plugins","selectedIds","multipleDrag","onBeforeEditStartId","onEditStart","tempAssignmentsStore","_lightbox_id","updateConfigs","undoEnabled","old","actionType","entityType","_storeCommand","getInitialLink","$source","$target","linkId","MAX_UNDO_STEPS","Undo","maxSteps","redoEnabled","invert","revert","oldValue","inverseCommands","assert","_undoStack","_redoStack","getUndoStack","stack","undo_steps","undo_actions","_pop","_reorderCommands","_applyAction","_push","weights","any","actionWeights","weightA","weightB","entities","actions","methods","get","isExists","batchUpdate","getMethod","check","prop","internalProperty","startsWith","whitelist","copyProperty","monitor","setUndoStack","getRedoStack","setRedoStack","saveState","getInitialState","isEqualIds","first","updTask","changeTaskCommandId","updLink","oldTaskId","newTaskId","changeLinkCommandId","updateTasksIds","entry","updateLinksIds","extensions","constants","KEY_CODES","UP","DOWN","LEFT","RIGHT","SPACE","ENTER","DELETE","ESC","TAB","ExtensionsManager","addExtension","_extensions","getExtension","services","register","getter","dropService","servicesEnum","setService","service","layout","rows","resizer","finish_to_start","start_to_start","finish_to_finish","start_to_finish","milestone","auto_types","duration_unit","correct_work_time","cascade_delete","autoscroll_speed","deepcopy_on_parse","show_links","show_task_cells","static_background","static_background_cells","branch_loading","branch_loading_property","show_loading","min_duration","start_on_monday","server_utc","show_progress","fit_tasks","preserve_scroll","container_resize_timeout","deadlines","drag_links","drag_progress","drag_resize","drag_move","drag_mode","resize","progress","round_dnd_dates","link_wrapper_width","link_arrow_size","autofit","align","scale_offset_minimal","inherit_scale_class","time_step","duration_step","task_date","time_picker","link_attribute","layer_attribute","buttons_left","_migrate_buttons","dhx_save_btn","dhx_cancel_btn","dhx_delete_btn","buttons_right","lightbox","sections","map_to","project_sections","milestone_sections","single_date","drag_lightbox","details_on_create","details_on_dblclick","initial_scroll","order_branch","order_branch_free","task_height","bar_height","bar_height_padding","min_grid_column_width","grid_resizer_column_attribute","keep_grid_width","grid_resize","grid_elastic_columns","show_unscheduled","resize_rows","task_grid_row_resizer_attribute","min_task_grid_row_height","readonly_property","editable_property","calendar_property","resource_calendars","dynamic_resource_calendars","inherit_calendar","type_renderers","open_tree_initially","optimize_render","prevent_default_scroll","show_errors","wai_aria_attributes","horizontal_scroll_key","drag_multiple","csp","auto_scheduling","isWindowAwailable","nav","navigator","userAgent","env","isIE","isOpera","isChrome","isSafari","isFF","isIPad","search","isEdge","isNode","isSalesforce","serialized","createConfig","Error","async","headers","cache","DOMParser","parseFromString","ActiveXObject","loadXML","xmltop","tagname","xml","responseXML","getElementsByTagName","xpath","xpathExp","docObj","selectNodes","ownerDocument","evaluate","XPathResult","ANY_TYPE","iterateNext","query","_call","onLoad","getSync","put","postData","del","postSync","Promise","resolve","reject","isQt","errorStatus","filePath","noCache","toUpperCase","urlSeparator","dateToStr","utc","dateToStrFn","Function","to_fixed","getISOWeek","getWeek","strToDate","splt","strToDateFn","dateString","fastVersion","getUTCDate","getUTCMonth","getUTCFullYear","day_short","getUTCDay","getDay","day_full","month_short","month_full","getUTCHours","getHours","getUTCMinutes","getMinutes","getUTCSeconds","getSeconds","getUTCISOWeek","set","temp","month_short_hash","month_full_hash","UTC","cspVersion","canUseCsp","cspAutoCheck","useCsp","init","s","date_part","setHours","hour_start","setTime","time_part","week_start","month_start","setDate","quarter_start","m","res_month","setMonth","year_start","day_start","setMinutes","minute_start","setSeconds","getMilliseconds","setMilliseconds","_add_days","modifiedDate","inc","originalDate","incCondition","getHoursCondition","getDateCondition","worktimeCalculation","ndate","setYear","add_quarter","num","cspCompliantVersion","_getWeekNumber","isoWeek","nday","first_thursday","year_number","ordinal_date","week_number","convert_to_utc","parseDate","parse_date","token","_url","_token","_mode","_seed","_queue","api","_events","Accept","credentials","fetch","then","websocket","_wrapper","connect","_socket","onclose","n","location","protocol","o","r","WebSocket","onmessage","fire","onError","_send","_resubscribe","_uid","onCall","catch","onResponse","remoteEvents","remote","remote_client.Client","req","_ready","load","back","_remote","ready","on","checkTimeout","updPerSecond","_on_timeout","ceil","DnD","copyDomEvent","pageX","pageY","_obj","_settings","inputMethods","getInputMethods","_drag_start_timer","utils.bind","clearDragTimer","lastDown","eventParams","passive","accessor","timeStamp","original_target","original_element_sizes","domHelpers.getClosestSizedElement","actualTarget","dragStart","traceDragEvents","inputMethod","mousemove","dragScroll","limited_mousemove","started","utils.defined","updates_per_second","dndActive","cancelable","mousemoveContainer","mouseup","checkPositionChange","diff_x","diff_y","distance","pow","sensitivity","initDnDMarker","backupEventTarget","getEvent","cloneNode","backup_element","touchEventsSupported","maxTouchPoints","elementFromPoint","PointerEvent","pointerType","getPosition","_prevent_touch_scroll","_touch_drag","_touch_feedback","targetTouches","rootNode","insideShadowDOM","getOwnPropertyDescriptor","regTemplates","initTemplate","initial","template_name","initTemplates","c","progress_text","grid_header_class","task_end_date","grid_row_class","task_row_class","timeline_cell_content","scale_row_class","grid_indent","grid_folder","grid_file","grid_open","grid_blank","isUnscheduledTask","task_unscheduled_time","grid_date_format","link_class","link_description","drag_link","from_start","to_start","link_start","link_end","drag_link_class","allowed","isLinkAllowed","tooltip_date_format","baseline_text","baseline","StateService","stateProviders","provider","internal","Promise$1","createTasksDatastoreFacade","updateItem","addTask","utils.uid","setParent","parentObj","deleteTask","countVisible","getBranchIndex","getIndexById","eachItem","eachParent","startTask","changeTaskId","oldid","newid","changeId","calculateItemLevel","new_pid","getSiblings","getNextSibling","getIdByIndex","sid","field","desc","createLinksStoreFacade","getLinkCount","linksStore","isLinkExists","addLink","updateLink","deleteLink","changeLinkId","$powerArray","$create","$removeAt","$remove","$find","$insertAt","$each","$map","$filter","isPlaceholderTask","DataStore","pull","$initItem","powerArray","fullOrder","_skip_refresh","_filterRule","_searchVisibleOrder","_indexRangeCache","_getItemsCache","_attachDataChange","_parseInner","loaded","copyOnParse","utils.copy","isSilent","_updateOrder","_removeItemInner","_addItemInner","order","data_size","getVisibleItems","getIndexRange","sync_link","_changeIdInner","_moveInner","sindex","clearAll","alreadySilent","arraysEqual","arr1","arr2","quick","skipFilter","_quick_refresh","_mark_recompute","oldOrder","rule","filteredOrder","placeholderIds","_ganttConfig","cacheKey","ret","_getNullIfUndefined","getFirst","getLast","SplitTasksHelper","_datastore","isSplitItem","isSubrowSplitItem","split_placement","isDefaultSplitItem","isInlineSplitItem","TreeDataStore","_branches","_splitTaskHelper","loadedItem","existingItem","$parentProperty","parentProperty","$getRootId","$openInitially","openInitially","_eachItemMainRangeCache","getConfig","splitParents","splitItems","taskOpenState","taskVisibility","haveSplitItems","_isSplitItem","_isDefaultItem","_isInlineChildItem","canOpenSplitTasks","open_split_tasks","_isSplitChildItem","$expanded_branch","_buildTree","_add_branch","parentIndex","targetIndex","_move_branch","$rendered_parent","_replace_branch_child","_traverseBranches","itemId","source_pid","tbranch","siblings","tid","childId","pid","nextSibling","level","_setParentInner","_eachItemCached","_eachItemIterate","startId","itemsStack","useCache","buildCache","startItem","parentsHash","added_already","old_parent","new_parent","old_id","newbranch","criteria","original_criteria","els","renderedParent","actualParent","_skipTaskRecalculation","createDataStoreSelectMixin","selectedId","deleteItem","subItem","isHeadless","storeRenderCreator","itemRepainter","renderItem","renderer","renders","getLayers","render_item","renderItems","allData","loadedRanges","layer","layerData","get_visible_range","ids","prepare_data","render_items","updateItems","update_items","extraDataArr","getDataRender","onUpdateRequest","skipRepaint","batch_update","refreshId","change_id","datastoreRender","bindDataStore","getDatastores","storeNames","createDatastoreFacade","$StoreType","self","createDatastoreSelect","servicePrefix","storeAccessName","storeList","_getDatastores","refreshData","scrollState","stores","scrollbarsInfo","getScrollbarsInfo","scroll_info","scrollbarNodeVisible","$view","boundViews","viewName","refresh_links","refreshLinks","refreshLink","_bulk_dnd","hasSplitParent","isSplitTask","_update_flags","userdata","_clear_data","oldSelectId","_skipResourceRepaint","createFacade","createTasksFacade","createLinksFacade","facadeFactory","resolveConfigRange","start_interval","_scale_range_unit","PrimaryScaleHelper","_init_tasks_range","onlyProjectTasks","extendRangeForDates","constraint_type","apply_constraints","constraint_types","ASAP","ALAP","baselines","_min_date","_max_date","_adjust_scales","old_min","old_max","updateTasksRange","copyLinkIdsArray","targetHash","copyLinkIds","getSubtreeLinks","getSubtreeTasks","treeHelper","initDataStores","_init_task","_init_link","taskLinks","existingLink","sourceMatch","targetMatch","typeMatch","resetProjectDates","_isAllowedUnscheduledTask","changedTask","rollup","_update_parents","$drop_target","oldState","calculateScaleRange","newState","sync_links","sync_link_delete","checkLinkedTaskVisibility","sourceVisible","targetVisible","deletedLinks","mapEvents","onItemLoading","onBeforeAdd","onAfterAdd","onBeforeUpdate","onAfterUpdate","onBeforeDelete","onAfterDelete","onIdChange","onBeforeItemMove","onAfterItemMove","onFilterItem","onItemOpen","onItemClose","onBeforeSelect","onAfterSelect","onAfterUnselect","sourceTask","noDuplicateIds","Number","conf","mapFrom","mapTo","sourceEvent","targetEvent","_set_default_task_timing","_init_task_timing","correctTaskWorkTime","originalTask","DataProcessorEvents","dp","$gantt","$dp","_dataProcessorHandlers","cascadeDelete","clientSideDelete","getTaskLinks","_links","setGanttMode","setUpdated","_sendTaskOrder","deleteAfterConfirmation","needDbDelete","needCascadeDelete","dpMode","updateMode","setUpdateMode","cascade","storeItem","sendAllData","_tSend","_waitMode","itemLinks","_dp","_tMode","_serverProcessor","_ganttMode","substring","serverProcessor","pluralizedMode","insertCallback","upd","_xmlNodeToJSON","isExist","updateCallback","objData","property","deleteCallback","assignmentsStore","handleResourceCRUD","handleResourceAssignmentCRUD","handleBaselineCRUD","updated","updatedRows","clientOnly","getUserData","_in_progress","resources","dataprocessor_assignments","resource_assignment_store","insertedTasks","pendingAssignments","putAssignmentToQueue","insertResourceAssignment","assignment","dataprocessor_resources","resourcesStore","resource_store","insertResource","resource","dataprocessor_baselines","baselineStore","helpers.forEach","extendGantt","setUserData","_change_id","_row_style","rowId","$dataprocessor_class","_delete_task","setDp","SimpleStorage","_storage","getStoredItem","createDataProcessor","router","tMode","DataProcessor","setTransactionMode","DataProcessor$1","serverProcessorURL","action_param","autoUpdate","_headers","_payload","_postDelim","_routerParametersFormat","_invalid","messages","inserted","deleted","invalid","invalid_cell","enableUTFencoding","total","payload","_serializeAsJson","_router","_utf","escape","dnd","findRow","existing","set_invalid","is_invalid","markRow","sendData","_methods","editStop","pendingUpdateModes","modes","knownModes","checkBeforeUpdate","_beforeSendData","_getRowData","_serializeAsJSON","serialize_one","security_key","pref","valid","_forEachUpdatedRow","_sendData","_getAllData","pattern","_uActions","btag","ganttMode","correct","originalSid","that","_xml","getGanttMode","reqUrl","tag","processCallback","afterUpdateCallback","finalizeUpdate","cleanUpdate","atag","_initialized","_dp_init","_setDefaultTransactionMode","delete_confirmation","dataProcessorEvents","user","_user","_needUpdate","_updateBusy","afterAutoUpdate","fullSync","loadUpdate","xml_node","getUpdates","vers","_getXmlNodeValue","updates","dataToSend","processedData","_cleanupArgumentsBeforeSend","_cleanupItemBeforeSend","updatedItem","output","taskState","taskAction","getActionByState","_onResolvedCreateUpdate","actionPromise","errorMsgStart","errorMsgEnd","queryParams","afterUpdate","dhxVersion","urlParams","_applyPayload","preprocessedData","nodeValue","hasOne","traversedObjects","_prepareDate","helpers.arrayIncludes","_prepareArray","_prepareObject","rawItem","processedItem","dataItem","_prepareDataItem","DEPRECATED_api","DataProcessor.DataProcessor","DataProcessor.createDataProcessor","createMethod","disableMethod","methodName","dummyMethod","restoreMethod","disableMethods","methodsHash","restoreMethods","batchUpdatePayload","noRedraw","call_dp","dp_mode","resetProjects","createWbs","_needRecalc","_isRecalcNeeded","_isGroupSort","_getWBSCode","_calcWBS","$virtual","$wbs","_setWBSCode","getWBSCode","getByWBSCode","_isFirst","_prevSibling","_getPrevNonPlaceholderSibling","_increaseWBS","_parent","siblingiId","_wbs","prevSibling","currentId","wbs","getTaskByWBSCode","resetCache","createResourceMethods","resourceTaskCache","singleResourceCacheBuilt","getTaskBy","propertyName","propertyValue","typeFilter","filterResourceTasks","getResourceTasks","falsyValuePrefix","random","resourceHashFunction","getCacheKey","resourceIds","matchingResources","resourceId","resourceValue","resource_id","selectAssignments","resource_property","owners","getResourceAssignments","assignments","createHelper","resourcePlugin","renderEditableLabel","editable","$task_id","$resource_id","renderSummaryLabel","sum","reduce","editableResourceCellTemplate","$role","editableResourceCellClass","capacity","getSummaryResourceAssignments","childResource","initEditableDiagram","resource_render_empty_cells","timeoutId","makeEditable","cancelAnimationFrame","contentEditable","ganttViews","getCellsByType","$content","currentFocusIndex","setNextFocus","focusableElementsAfterRender","dom_helpers.getFocusableNodes","handleAssignmentEdit","strValue","innerText","assignmentId","assignmentStore","nextChunk","calculateDuration","updateTaskAssignments","editedElem","focusableElements","focusableElementsAfterUpdate","targetAfterUpdate","editable_resource_diagram","fetchTasks","lightbox_resources","selectResourceControlOptions","lightboxOptions","resourceStoreConfig","initItems","storeType","$resourcesStore","lightboxOptionsFnc","options","filteredResources","updateCollection","histogram_cell_class","histogram_cell_label","histogram_cell_allocated","histogram_cell_capacity","defaultResourceCellClass","defaultResourceCellTemplate","resource_cell_value","resource_cell_class","resource_assignments","resourceAssignmentsProperty","process_resource_assignments","resourceAssignmentFormats","auto","singleValue","valueArray","resourceValueArray","assignmentsArray","resourceAssignmentFormat","assignmentModes","fixedDates","fixedDuration","default","initAssignmentFields","initDelay","timing","_assignmentTimeFromTask","resourceAssignmentsStore","_makeAssignmentsFromTask","resourceAssignments","detectFormat","usedIds","defaultMode","_updateTaskBack","_assignAssignments","_loadAssignmentsFromTask","diffAssignments","taskValues","assignmentsStoreValues","inBoth","inTaskNotInStore","inStoreNotInTask","taskOwner","ownerId","foundOwnerAssignment","taskSearch","storeSearch","processedIds","inTask","inStore","assignmentHasChanged","ignoreFields","updateAssignment","_syncAssignments","storeAssignments","tasksAssignments","_syncOnTaskUpdate","_syncOnTaskDelete","idsSearch","taskResources","totalAssignments","needUpdate","needUpdateFor","undoBatchCancel","assignmentsHash","getTaskAssignments","taskAssignmentsCache","unscheduled","deleteIds","resourceAssignmentsCache","resourceTaskAssignmentsCache","searchTaskId","resourceTaskCacheKey","getTaskResources","uniqueResources","addPlaceholder","callIfEnabled","silenceDataProcessor","dataProcessor","_silencedPlaceholder","insertPlaceholder","placeholders","new_task","afterEdit","newTask","isPlaceholderLink","auto_task_types","checkTaskType","changedTypes","targetType","getTaskTypeToUpdate","$needsUpdate","getUpdatedTypes","applyChanges","updateParentTypes","group_mode","delTaskParent","updateTaskType","allTypes","hasChildren","isParsingDone","updateAfterRemoveChild","originalRowDndParent","originalMoveTaskParent","DurationFormatterNumeric","canParse","LinkFormatterSimple","_linkReg","linkPart","exec","_findSource","lag","pred","reqTemplate","formatters","durationFormatter","DurationFormatter","linkFormatter","LinkFormatter","empty_state_screen","show_empty_state","emptyStateElement","placeholderTextElement","empty_state_text_link","empty_state_text_description","placeholderImageElement","placeholderContainer","clickEvents","domHelpers","gridPlaceholder","detachAddTaskEvents","getContainer","emptyStateElementNode","isGanttEmpty","wrapper","marginTop","oldNodes","attachAddTaskEvent","renderContent","hasBaselinesBelow","baselinesOnDifferentRow","render_mode","childrenHaveBaselines","hasBaselines","isSplitParent","getMaxParentHeight","heightLimit","maxHeight","shrinkHeight","splitChild","parentSizes","getItemPosition","parentHeight","rowHeight","initBaselineFields","_syncBaselines","shouldRepaint","iteratedBaselines","taskBaselines","existingBaselines","getTaskBaselines","exisingBaseline","_adjustSplitParentHeight","adjustTaskHeightForBaselines","_deleteOrphanBaselines","maxParentHeight","childHeight","baselineSize","margins","baselineAmount","subrowHeight","timelineView","getLayoutView","getBarHeight","_increaseSplitParentHeight","subtasks","subtaskId","subtask","subtaskHeight","_addBaselinesToTask","newBaseline","existingBaseline","baselinesRenderedBelow","repaint","RemoteEvents","Client","createHandlers","updateQueue","updateTimeout","UPDATE_DELAY","remoteUpdates","message","processUpdate","processQueue","handleAddTask","handleUpdateTask","handleDeleteTask","handleAddLink","handleUpdateLink","handleDeleteLink","taskData","warn","initTask","existingTask","remoteTask","lightbox_id","linkData","assign","liveUpdates","auto_scheduling_config","getDefaultAutoSchedulingConfig","gap_behavior","descendant_links","schedule_on_parse","move_projects","use_progress","schedule_from_end","project_constraint","show_constraints","getAutoSchedulingConfig","schedulingConfig","move_asap_tasks","auto_scheduling_compatibility","auto_scheduling_strict","auto_scheduling_descendant_links","auto_scheduling_initial","auto_scheduling_move_projects","auto_scheduling_use_progress","auto_scheduling_project_constraint","plugins$1","modules","new_task_placeholder","remote_events","grid_column_api","getGridColumn","parsing","on_load","resp","responseURL","_process_loading","attachAssignmentsToTasks","assignmentsByTasks","collections","_load_collections","getTasksByTime","collections_loaded","collection","serverList","option","option_key","$ignore","jsonParseError","dhx_security","serializeLink","_copyLink","rawLinks","baselineCopy","xmlParseError","attrs_only","attributes","_getCollections","opts","itms","itm","attrs","k","attr","_getXML","toptag","getXMLTopNode","skey","evs","oldxml","startdate","est","enddate","predecessortasks","IsWorkTimeArgument","calendar","ClosestWorkTimeArgument","CalculateEndDateArgument","GetDurationArgument","calendarArgumentsHelper","getWorkHoursArguments","helpers.isValidDate","setWorkTimeArguments","unsetWorkTimeArguments","isWorkTimeArguments","processedConfig","getClosestWorkTimeArguments","arg","_getStartEndConfig","param","argumentType","getDurationArguments","hasDurationArguments","calculateEndDateArguments","WorkTimeCalendarMerger","_getIntervals","hoursArray","_toHoursArray","intervalsArray","toFixed","formatHHMM","secondsValue","minutePart","_intersectHourRanges","baseArray","overridesArray","current","_mergeAdjacentIntervals","_mergeHoursConfig","firstHours","secondHours","merge","firstCalendar","secondCalendar","firstConfig","secondConfig","customWeeks","mergedSettings","processCalendar","config1","config2","date1","date2","hours2","WorkUnitsMapCache","timestamp","_cache","has","unitCache","subCache","rawValue","yearCache","Map","WorkUnitsObjectCache","LargerUnitsCache","getMinutesPerWeek","weekStart","_weekCache","_calendar","minutesPerWeek","getHoursPerDay","getMinutesPerMonth","monthStart","_monthCache","minutesPerMonth","nextMonth","createCacheObject","DateDurationCache","stepCache","durations","endDates","compute","_getCacheObject","startDateTimestamp","_endDateCacheKey","resultTimestamp","_durationCacheKey","endDateTimestamp","CalendarWorkTimeStrategy","argumentsHelper","_workingUnitsCache","_largeUnitsCache","_dateDurationCache","_worktime","_cached_timestamps","_cached_timestamps_count","_clearCaches","_getUnitOrder","_resetTimestampCache","_timestamp","_checkIfWorkingUnit","hasDuration","_is_work_day","_getWorkHours","_is_work_hour","startHour","endHour","_getTimeOfDayStamp","dayEnd","_is_work_minute","checkTime","_nextDate","_getWorkUnitsBetweenGeneric","next","stepStart","stepEnd","checkFirst","checkLast","isLastStep","_isWorkTime","unitOrder","biggerTimeUnit","_getClosestWorkTimeFuture","_getMinutesPerHour","hourStart","hourEnd","_getMinutesPerDay","durationMinutes","durationHours","_getWorkUnitsForRange","getUnitsPerDay","_getMinutesBetweenSingleDay","_getIntervalTimestamp","minuteFrom","minuteTo","_getMinutesBetween","firstDayStart","firstDayEnd","lastDayStart","lastDayEnd","startPart","endPart","rangePart","_getHoursBetween","_setConfig","_parseSettings","haveCustomWeeks","customWeeksRangeStart","customWeeksRangeEnd","customWeeksBoundaries","_parseHours","minCustomRangeStart","maxCustomRangeEnd","customTime","rangeStart","rangeEnd","fromReadable","toReadable","currentWeek","_tryChangeCalendarSettings","backup","hasWorkTime","_arraysEqual","_compareSettings","mySettings","thatSettings","myDays","otherDates","myHours","otherHours","equals","myWeek","thatWeek","getWorkHours","dayStartDate","dateValue","endHours","timestampRanges","part","timerangeConfig","durationSeconds","setWorkTime","calendarConfig","unsetWorkTime","reset_calendar","isWorkUnit","dateKey","setItem","getDuration","_calculateDuration","sign","mult","getEndDate","_calculateEndDate","_calculateMinuteEndDate","_subtractMinuteDate","_calculateHourEndDate","_addInterval","stopAction","added","dstShift","workTimeCheck","_addHoursUntilDayEnd","rangeHours","addHours","intervalEnd","durationLeft","hoursPerDay","_addMinutesUntilHourEnd","rangeMinutes","addMinutes","_subtractMinutesUntilHourStart","hourStartTimestamp","initialDateTimestamp","getClosestWorkTime","minutePrecision","_isMinutePrecision","addedInterval","calculatedDay","daySchedule","minutesInDay","dayStart","iterateFromDayEnd","isWorkHour","workInterval","prevInterval","minutesInHour","_getClosestWorkTimePast","times","lastInterval","_getClosestWorkTime","inputDate","direction","closestFuture","closestPast","_getClosestWorkTimeGeneric","_findClosestTimeInDay","resultDate","fromDayEnd","_getClosestWorkMinute","increment","maximumLoop","daysOfWeek","hasRegularHours","_checkWorkHours","dayConfig","legacyResourceCalendarConfig","isLegacyResourceCalendarFormat","resourceCalendarsProperty","getResourceProperty","resourceCalendarsConfig","getCalendarIdFromLegacyConfig","calendarId","dynamicResourceCalendarsFactory","getResourcesCalendarKey","dynamicCalendars","mergeResourceCalendars","manager","mergeCalendars","getResourceCalendar","getCalendarIdFromMultipleResources","tempCalendar","addCalendar","dynamicResourceCalendars","CalendarManager","_calendars","_legacyConfig","_isLegacyConfig","createDefaultCalendars","_convertWorkTimeSettings","datesConfig","weekdays","entries","setting","calendars","mergeHelper","CalendarMergeHelper","_createCalendarFromConfig","createCalendar","apiCore","createArgumentsHelper","preparedConfig","parentCalendar","defaults","fulltime","getCalendar","getCalendars","_getOwnCalendar","resourceProperty","calendarsConfig","getTaskCalendar","taskObject","groupMode","currentTask","$effective_calendar","isCalendar","deleteCalendar","restoreConfigCalendars","possibleCalendar","props","every","CalendarDisabledTimeStrategy","fixedUnits","TimeCalculator","calendarManager","$disabledCalendar","NoWorkTimeCalendar","_getCalendar","createWorkTimeFacade","timeCalculator","_hasDuration","worktimeFacadeFactory","_isTaskInTimelineLimits","taskStart","taskEnd","_getProjectEnd","project_end","_getProjectStart","project_start","getDefaultTaskDate","parent_id","parentExists","$new","showTask","_tasks_dnd","drag","getTaskTimingMode","task_type","$no_start","$no_end","scheduled_summary","task_mode","dirty","$calculate_duration","effectiveCalendar","updateTaskTiming","taskMode","getSubtaskInfo","assignProjectDates","$rollup","$inlineSplit","taskTiming","summaryDateFields","manuallyScheduledSummaryDateFields","dateFields","getSubtaskDuration","inlineSplit","rootTask","isScheduledSummary","updateAll","has_changed","startDateField","$auto_start_date","endDateField","$auto_end_date","oldStart","oldEnd","roundDate","upper","lower","colIndex","data_task_types","cached_functions","_cached_functions","critical_path_mode","wrap_methods","_prefetch_originals","prefetch","methodname","original","optimizer","get_prefetched_value","argumentsArray","l","get_arguments_hash","cached_values","has_cached_value","get_cached_value","cache_value","arguments_hash","is_date","values","stringify_argument","activate","deactivate","setup","override_gantt","gantt_methods","highlight_critical_path","update_if_changed","changed","deactivTimeout","addResizeListener","containerStyles","getPropertyValue","resizeWatcher","container_resize_method","contentWindow","listenWindowResize","resizeTimeout","resizeDelay","previousSize","getContainerSize","lowlevelResizeWatcher","$scrollbarRepaint","currentSize","repaintGantt","previousHeight","previousWidth","expire","gantt_core","isHTMLElement","invalidContainerMessage","validateNode","_reinit","dropLayout","_clearTaskLayers","_clearLinkLayers","rebuildLayout","createView","resetLayout","domHelpers.toNode","$mouseEvents","addMinimalSizes","edit","question","confirm_deleting","confirm_deleting_title","_delete_task_confirm","hideLightbox","visibleDate","_sort","posX","_getHorizontalScrollbar","scrollbar","codeScrollLeft","preserveScroll","zoom","new_pos","new_date","posY","x_pos","setSizes","changeLightboxType","getLightboxType","_silent_redraw_lightbox","_get_link_type","prevOffset","time_unit","helpers.getSecondsInUnit","offsetChanged","domHelpers.getClassName","_eventRemoveAll","resetLightbox","icon_save","icon_cancel","icon_details","confirm_closing","section_description","section_time","section_type","section_deadline","section_baselines","section_new_resources","column_wbs","column_text","column_start_date","column_duration","column_add","confirm_link_deleting","type_task","type_project","type_milestone","weeks","months","years","message_ok","message_cancel","section_constraint","asap","alap","snet","snlt","fnet","fnlt","mso","mfo","resources_add_button","resources_filter_placeholder","resources_filter_label","resources_section_placeholder","baselines_section_placeholder","baselines_add_button","baselines_remove_button","baselines_remove_all_button","deadline_enable_button","deadline_disable_button","LocaleManager","addLocale","_locales","getLocale","i18nFactory","en","ar","be","ca","cn","cs","da","de","es","fa","fi","fr","he","hr","hu","it","jp","kr","nb","nl","no","pl","pt","ro","ru","si","sk","sv","tr","ua","DHXGantt","license","edit_save","edit_cancel","factory","supportedExtensions","extensionManager","ExtensionManager","activePlugins","plugin","templatesLoader","stateService","selected_task","datastoreHooks","i18n","setLocale","localeObject","gantt_save_btn","gantt_cancel_btn","gantt_delete_btn","boxAttribute","_dhx_msg_cfg","usercall","modalBox","modal_key","messageBox","keyboard","cancelBubble","modality","onkeydown","buttonAriaAttrs","messageButtonAttrString","button_css","onclick","messageInfoAttr","insertBefore","timers","getFirstDefined","_boxStructure","ok","cancel","contentId","messageModalAttr","inner","btn","_createBox","hidden","innerWidth","innerHeight","alertPopup","confirmPopup","boxPopup","box_params","params","alertBox","confirmBox","subtype","hideAll","popups","alert","confirm","modalbox","extendSettings","parentSettings","own","$extendedConfig","setPrototypeOf","configurable","parentView","parentConfig","parentTemplates","$getConfig","$getTemplates","configurable$1","uiFactory","createFactory","views","ui","createdViews","creator","configure","$parent","viewConstructor","initUI","registerView","uiFactory$1","createMouseHandler","eventHandlers","doubleclick","contextMenu","addEventTarget","callHandler","onClick","findEventHandlers","default_action","callEventHandlers","onContextMenu","src","delegateHandlers","h","onDoubleClick","onMouseMove","_last_move_event","elementHandlers","domEvents","delegate","mouseEvents","genericViewPortChecker","x_end","y_end","isLegacyRender","getRowRectangle","getVisibleTasksRange","buffer","indexStart","indexEnd","extraTasksIds","inlineEditorId","rendererFactory","task_area_pulls","task_area_renderers","getRenderer","renderMethod","updateMethod","getRectangle","renderCallbackMethod","specializedViewPortChecker","basicGetRectangle","onrender","isInViewPort","layerView","viewConfig","remove_item","rendererViewPort","useBuffer","rendered","clear_container","basicGetRange","getVisibleRange","prepareData","createDocumentFragment","vis","itemsSearch","renderedItems","newElements","nodesToRemove","renderCalledFor","itemNode","restore","replace_item","item_id","newNode","replaceChild","clearRenderers","layerFactory","renderFactory","renderFactoryProvider","createGroup","relativeRoot","defaultFilters","initLayer","renderGroup","tempCollection","filters","_add","getLayer","pending","isConnected","topmost","rel","mergeFilters","requestUpdate","eachLayer","removeLayer","filter_methods","filter_method","barRectangle","startCoord","_getPositioningContext","endCoord","getLinkBox","sourceBox","targetBox","calculated","clearCache","visibleItems","rec","getLinkRectangle","initialized","getVisibleLinksRange","visibleBoxes","isLinkInViewPort","sourceTop","sourceHeight","targetTop","targetHeight","sourceLeft","sourceRight","targetLeft","targetRight","$skipSmartRenderOnScroll","createLayerEngine","createLayerFactory","previusSiblingContainer","defaultContainerSibling","taskLayers","$task_links","linkLayers","addTaskLayer","rangeFunction","getVisibleTaskRange","_getTaskLayers","removeTaskLayer","addLinkLayer","getVisibleLinksRangeFactory","isLinkInViewport","_getLinkLayers","removeLinkLayer","Cell","headerHeight","$domEvents","$name","$factory","$externalComponent","_headerClickHandler","final","$preResize","topCont","topSize","getSize","maxWidth","minHeight","setSize","_hide","cellIndex","moveView","$toHTML","renderedElement","collapseIcon","canCollapse","$fill","cellId","collapsed","size","gravity","getContentSize","$lastSize","contentX","contentY","_getBorderSizes","borders","horizontal","vertical","_currentBorders","_borders","_sizeHeader","_sizeContent","_setBorders","domHelpers.removeClassName","cssHash","domHelpers.addClassName","xLayout","transform","__extends","__","Layout","_super","_this","_parseConfig","domHelpers.removeNode","$cells","_resizeScrollbars","scrollbars","scrollChanged","visibleScrollbars","hiddenScrollbars","scrollbarsToHide","showScrollbar","hideScrollbar","shouldHide","shouldShow","visibleGroups","group","visible","scrollSize","linkedViews","_getLinkedViews","x_inner","y_inner","y_pos","_syncCellSizes","groupName","newSize","groups","_eachChild","_syncGroupSize","_xLayout","newSizeValue","isGravity","ownSize","resizeSibling","siblingSize","totalGravity","totalSize","mainGrid","grid_width","startStage","mainCall","_resizeInProgress","contentViews","setContentSize","_getAutosizeMode","$originalWidthStored","$originalWidth","$originalHeightStored","$originalHeight","isChild","sub","getCells","domHelpers.insertNode","domHelpers.getChildNodes","contentWidth","contentHeight","_cleanElSize","_getBoxStyles","computed","clientHeight","properties","boxSizing","MozBoxSizing","horPaddings","borderLeftWidth","borderRightWidth","vertPaddings","borderTopWidth","borderBottomWidth","borderBox","outerWidth","outerHeight","boxSizes","contentSizes","_sizes","margin","_calcFreeSpace","side","_free","_gravity","_calcSize","_configureBorders","borderClass","lastVisibleIndex","lastCell","borderColorClass","_updateCellVisibility","oldVisibleCells","_visibleCells","firstCall","visibleCells","parentVisibility","hide_empty","hideCell","cellView","marginSide","ViewLayout","$cell","byMaxSize","otherCell","ViewCell","childConfig","$initialized","unload","_setContentSize","outerX","outerY","childSize","Resizer","ScrollbarCell","SCROLL_MODIFIER_KEYS","_scrollHorizontalHandler","_scrollVerticalHandler","_outerScrollVerticalHandler","_outerScrollHorizontalHandler","_mouseWheelHandler","scroll_size","_isHorizontal","_isVertical","_initVertical","_initHorizontal","_initMouseWheel","_initLinkedViews","_getRootParent","eachCell","_eachView","$scroll_hor","$scroll_ver","_updateLinkedViews","ff","scrollHorizontally","_scrolling","oldSize","scrollVertically","_wheel_time","_oldLeft","_getScrollSize","outerSize","isHorizontal","linked","scrollProperty","innerSizeProperty","outerProperty","_getScrollOffset","cellScrollSize","nonScrollableSize","scrollableViewPortSize","outerScroll","innerScroll","scrollSizes","_setScrollSize","toggleVisibility","_getScaleOffset","parentLayout","vparent","_oldTop","_checkWheelTarget","connectedViews","wheelSpeed","wheelSpeedConfig","wheel_scroll_sensitivity","deltaX","wheelDeltaX","deltaY","wheelDelta","multiplier","deltaMode","wx","wy","horizontalScrollModifier","oldLeft","detail","oldTop","cachedRowHeight","canUseSimpleCalc","_getRowHeight","_refreshState","rowStore","globalRowHeight","canUseSimpleCalculation","createMixin","getItemTopCache","getRowTopCache","getItemHeightCache","totalHeightCache","getItemHeightCacheState","quickPosition","quickPositionHelperFactory","_resetTopPositionHeight","_resetHeight","getCacheStateTotalHeight","shouldClearHeightCache","all","itemIndex","_fillHeightCache","defaultHeight","globalHeight","itemHeightCache","sumHeight","getHeight","totalHeight","createStaticBgHelper","destroy","canvasRender","createLayerConfig","taskFilter","barVisible","hide_bar","expose","$task_bars","taskBg","$task_bg","Timeline","_posFromDateCache","_posFromWorkTimeCache","_timelineDragScroll","topPositionMixin","$task_scale","taskBars","taskConstraints","taskDeadlines","$task_baselines","$task_constraints","$task_deadlines","_tasks","linksAttr","bindLinks","item_attribute","_createLayerConfig","_attachLayers","backgroundImage","data_els","scrollWidth","scrolled","_refreshScales","_scales","_getScaleChunkHtml","_taskLayers","_linkLayers","_bindStore","taskRenderer","bar_layer","_taskRenderer","_initStaticBackgroundRender","linkStore","linkRenderer","linkLayer","_linkRenderer","staticRender","_staticBgHandler","staticBgContainer","$task_bg_static","staticBackgroundHeight","_clearLayers","_render_tasks_scales","scales_html","outer_width","helpers","cfgs","_get_scale_chunk_html","fromPos","toPos","cssClass","tplClass","_prepareScaleHtml","_prepare_scale_html","globalConfig","globalTemplates","cssclass","floatConfig","sticky","labelPosition","approxLabelWidth","labelPos","translateValue","getTimelineCellAttr","context","_getColumnDuration","cellStartDate","absolutePositionDate","trimStartSec","cellEnd","cellDuration","intervals","_getWorkTrimForCell","secondsInsideTrim","mappedTimestampMs","posFromWorkTime","wholeCells","partCell","roundPos","cellDurationMs","cellEndDate","earliestWorkSecondInCell","latestWorkSecondInCell","intervalsSinceCellStart","dayDate","dayIndex","dayIntervals","dayStartOffsetSeconds","absoluteStartSeconds","absoluteEndSeconds","workintervalStart","workintervalEnd","cellStart","dateOffset","fraction","posLeft","cellWidth","_getNextVisibleColumn","visibleDateIndex","_getPrevVisibleColumn","_getClosestVisibleColumn","dateIndex","visibleIndex","transition","xLeft","xRight","displayStart","displayEnd","isMilestoneRender","_get_scales","_get_coll_duration","_timelineCacheAttached","_unbindStore","createResizer","doOnRender","createRowResizer","_task_grid_row_resize","row_before_start","row_id","row_after_start","row_drag_move","dd","itemHeight","pointerPosition","markerStartPosition","marker_height","minPointerPosition","row_drag_end","oldItemHeight","finalHeight","_init_resize","dnd_sensitivity","SENSITIVITY","TIMEOUT","SCROLLSTEP","ScrollableGrid","_scrollOrder","getCurrentX","_dnd","_scrollView","attachEvents","isScrollable","gridBoundingRect","maxLeft","minLeft","currentX","autoscrollRight","autoscrollStart","autoscrollLeft","autoscrollStop","scrollStep","COLUMN_ID_ATTR_NAME","ColumnsGridDnd","_targetMarker","calculateCurrentPosition","eventX","DND","_scrollableGrid","_draggedCell","draggedColumn","draggedIndex","_gridConfig","outerHTML","lineHeight","_dragX","columnIndexes","findColumnsIndexes","setMarkerPosition","drawTargetMarker","targetColumn","cleanTargetMarker","reorderColumns","draggedId","xBefore","xAfter","currentColumn","startX","endX","compare","columnRelativePos","relativeX","getCorrection","gridOffset","nextPosition","Grid","$state","gridAriaAttr","gridAttrString","gridDataAriaAttr","gridDataAttrString","reorder_grid_columns","gridScaleRowAttrString","gridResize","_renderHeaderResizers","_mouseDelegates","mouseEventContainer","resizerrow","rowResize","_addLayers","_initEvents","_columnDND","ColumnDnd","_validateColumnWidth","numericWidth","elasticColumns","_setColumnsWidth","columnProperty","newColumnWidth","columnsWidth","_getGridWidth","_gridCacheAttached","_initSmartRenderingPlaceholder","_calculateGridWidth","_renderGridHeader","getColumnIndex","excludeHidden","hiddenIndexShift","getColumn","gridLine","gridTaskRowResizer","_refreshPlaceholderOnStoreUpdate","$rowsPlaceholder","_getColumnWidth","min_width","new_width","max_width","_checkGridColumnMinWidthLimits","_getGridWidthLimits","min_limit","max_limit","newWidth","start_index","columns_width","final_width","extra_width","start_width","iterator","curExtra","_getColsTotalWidth","cols_width","v","parseFloat","unknown","gridWidth","delta","lineHeigth","renderableComponents","colWidth","componentLabel","ariaAttrs","gridScaleCellAttrString","clearTaskStoreHandler","_delayRender","ownStore","handlerIdProperty","$attachedResourceViewHandler","$attachedTaskStoreHandler","initGrid","destroyGrid","_linkToTaskStore","previousDragId","relevantResources","delayRender","linkedStore","repaintStack","_getRelevantResources","_updateNestedTasks","_getIdsFromAssignments","Set","childAssignments","selectedAssignments","resourceStore","toAddArray","toAdd","toDelete","addedTasks","resourceData","resource1","resource2","GridRL","_getResourceConfig","resource_table","domEventScope","_getResourceColumns","_getResourceSection","getLightboxSection","sectionName","section","inlineEditorsLightbox","resourceStoreMixin","defaultMapping","tempAssignmentStore","isChanged","save","resourceSection","block","form_blocks","_lightbox_root","set_value","lightbox_events","_save_lightbox","onShow","keyNav","preventKeyNav","shouldPrevent","editPrevCell","editNextCell","onkeyup","onwheel","onHide","keyNavMappings","onBlurDelay","activeCell","editorState","hasEditor","editorType","anyModifier","getKeyboardMapping","mapping","setMapping","getMapping","BaseFactory","BaseEditor","get_input","get_value","is_changed","currentValue","is_valid","textEditorFactory","TextEditor","numberEditorFactory","NumberEditor","oninput","selectEditorFactory","SelectEditor","optionsHtml","dateEditorFactory","html5DateFormat","DateEditor","minValue","maxValue","minAttr","maxAttr","predecessorEditorFactory","PredecessorEditor","getFormatter","formatter","parseInputString","predecessors","delimiter","formatPredecessors","getSelectedLinks","predecessorCodes","formatLinkKey","getLinksDiff","selectedLinks","existingLinksSearch","linksToAdd","linkKey","linksToDelete","linksDiff","autoSchedule","inputPredecessors","taskPredecessors","durationEditorFactory","linkedPropertiesProcessor","processTaskDateProperties","keepDatesOnEdit","keepDurationOnEdit","defaultActionOnEdit","decreaseStartDate","initConfigs","number","predecessor","keyboardMapping","eventBus","createGridEditors","_getGridCellFromNode","_getEditorPosition","findVisibleIndex","_createPlaceholder","inlineEditorAttr","updateTaskDateProperties","ganttHandlers","_itemId","_columnName","_editor","_editorType","_placeholder","asyncShow","setValue","_lightbox","editorConfig","onAfterShow","_onReMount","editorResult","getValue","_getItemValue","inline_editors_date_processing","_findEditableCell","findEditableCell","nextColumn","getNextCell","moveCell","getFirstCell","getLastCell","nextCell","canChangeRow","moveRow","prevCell","nextItem","editNextRow","nextRow","skipReadonly","editPrevRow","prevRow","detachStore","inlineEditController","createEditors","isBarInViewport","createTaskRenderer","_render_task_element","painters","defaultRenderer","_task_default_render","controlsMargin","padd","milestoneHeight","milestoneWidth","_render_task_progress","_render_task_content","_combine_item_class","progressColor","textColor","setProperty","_render_leftside_content","_render_rightside_content","setTaskBarAttr","taskEditable","timelineDrag","_render_pair","outer","showLinkPoints","_render_side_content","marginStyle","_get_link_crossing_css","cond","_get_conditions","ln","tp","done","pr","markerPos","leftside","basic","link_from_start","link_target_id","isCriticalTask","link_landing_area","from_id","link_to_start","allowDrag","dragClass","marginLeft","marginRight","createBaseBarRender","resourceHistogramRenderer","renderedNodes","checkVisibility","generateChildElement","childCopy","$rendered_at","displayRollup","getKey","renderParentId","renderRollupTask","repaintRollupTask","rollupKey","getVisibleCellsRange","firstCellIndex","lastCellIndex","isColumnVisible","cellLeftCoord","cellRightCoord","bgPlaceholder","placeholderConfig","lastTaskId","placeholderTask","calendar_id","createTaskBgRender","renderedCells","cleanupCell","cleanupAll","isRendered","detachRenderedCell","getCellClassTemplate","cssTemplate","getCellContentTemplate","contentTemplate","renderCells","renderOneCell","cssTemplateContent","htmlTemplateContent","customCell","_render_bg_line","cellCssTemplate","cellHtmlTemplate","odd","placeholderTop","lastTaskTop","lastTaskHeight","placeholderHeight","createLinkRender","_render_link_element","path_builder","get_endpoint","e_y","e_x","get_points","lines","drawer","get_lines","shapes","transform_lines_to_shapes","render_shapes","isCriticalLink","linkAttr","shape","render_line","render_corner","render_arrow","radius","link_radius","arrowSize","line","nextLine","cornerX","cornerY","link_line_width","corner","lastLine","arrowX","arrowY","arrow","current_pos","dirs","path","point","line_to","get_path","_get_line","get_wrapper_sizes","wrapper_size","get_line_sizes","line_size","innerPos","lineWidth","cornerDiv","borderVertical","borderHorizontal","get_direction","vect","point_to","xy","lineType","get_line_type","forward","getMilestonePosition","splitParams","milestoneTask","siblingBaselines","createGridLineRender","_render_grid_item","has_child","textValue","aria","gridAddButtonAttrString","flexAlign","center","justifyContent","gridCellAttrString","storeName","css_template","taskRowAttr","rowNode","cellNode","adapter","createResourceTimelineBuilder","getResourceLoad","calculateResourceLoad","calculateResourceLoadFromAssignments","assignmentsPassed","scaleUnit","scaleStep","timegrid","precalculatedTimes","firstColumn","minScaleDate","currDate","cachedTimes","timetable","generateRenderResourceLine","resourceTimetable","renderedResourceLines","renderResourceLineCell","detachRenderedResourceLine","renderResourceLine","updateResourceLine","checkedColumns","createGridTaskRowResizerRender","resize_el","rowResizerAttr","_init_dnd","getStore","checkPlaceholderTask","initial_open_state","$transparent","lastTaskOfLevel","last_item","_getGridPos","gridHeight","maxBottom","_getTargetY","scrollPos","_getTaskByY","dropIndex","gridDataSizes","reorderMarkerAttr","containerSize","targetY","allowedLevel","over","nextId","rowDnd","dropTarget","createDropTargetObject","targetId","nextSiblingTarget","dndTaskId","prevSiblingTarget","firstChildTarget","lastChildTarget","findClosesTarget","targetLevel","findTargetAbove","findTargetBelow","getSameLevelDropPosition","relTargetPos","eventTop","targetAbove","targetBelow","getMultiLevelDropPosition","highlightPosition","getTaskMarkerPosition","markerLine","pointerEvents","highlightFolder","highlightRow","removeLineHighlight","linePos","getLineMarkerPosition","markerLineTop","markerFolder","gridToPageCoordinates","folderHighlightWidth","setWidthWithinContainer","indentNode","indent","iconWidth","childCount","gridPos","ePos","higlighter","opacity","drop_target","getTargetTaskId","doctype","minTop","firstVisibleTaskIndex","firstVisibleTaskId","firstVisibleTaskPos","hiddenTaskPart","gridPosition","gridBottom","placeholderRowHeight","getDropPosition","lockLevel","rowTop","getMultiLevelTarget","getLockedLevelTarget","rowDndMarker","initializer","onCreated","_inlineEditors","onInitialized","initEvents","extendDom","onDestroyed","clearEvents","notOpenIcon","showDate","sorting_method","totalWidth","createTaskDND","dragMultiple","before_start","before_finish","after_finish","clear_drag_state","set_actions","drag_from_start","stage","_move","_resize","_resize_progress","on_mouse_move","on_mouse_down","on_mouse_up","start_x","start_y","coords_x","_drag_task_coords","minDurationInUnits","_calculateMinDuration","inMs","diffValue","_find_max_shift","dragItems","correctShift","minX","maxX","maxShift","minShift","multipleDragShift","new_start","new_end","obj_s_x","obj_e_x","_mouse_position_change","oldPos","newPos","_is_number","isFinite","start_drag","sX","sY","now","_start_dnd","_update_on_move","_update_item_on_move","curr_date","dragHash","_isMultiselect","selectedTasksIds","dragProject","initialDrag","newStartPos","newEndPos","handle_offset","dragPos","dragX","shiftDate","childDrag","_get_drag_mode","_fix_dnd_scale_time","fixStart","fixEnd","dndContext","_fix_working_times","_finalize_mouse_up","_fireEvent","_dhx_changed","initialDates","finalizingBulkMove","moveCount","doFinalize","classes","dragProperty","selectedTask","_addSubtasksToDragMultiple","trigger","round_task_dates","drag_state","summaryId","initTaskDND","roundTaskDates","taskDnD","initLinksDND","_link_landing","_link_target_task","_link_target_task_start","_link_source_task","_link_source_task_start","markerDefaultOffset","scrollDefaultSize","getDndState","start_marker","end_marker","link_edge_marker","link_landing_hover_area","resetDndState","_dir_start","updateMarkedHtml","getVieportSize","getMarkerSize","markerSize","viewportSize","ganttOffsetY","advanceMarker","landing","prevTarget","prevLanding","prevToStart","targ","sameGantt","absCoords","domHelpers.getRelativeNodePosition","_dir_end","targetChanged","showDirectingLine","removeDirectionLine","s_x","s_y","getDirectionLine","link_direction_class","dist","tan","angle","atan","coordinateCircleQuarter","sin","cos","ieTransform","shiftLeft","shiftTop","eX","eY","_direction","linkDnD","createLinkDND","_linksDnD","_tasksDnD","MouseDelegates","_attachDomEvents","_attachStateProvider","_clearDomEvents","_clearStateProvider","_delete_link_handler","_delete_link_confirm","coll","coll_date","scale_unit","scale_step","getVerticalScrollbar","getHorizontalScrollbar","_legacyGridResizerClass","resizers","gridResizer","mainTimeline","colsWidth","hideGrid","grid_limits","ganttContainerWidth","verticalScrollbar","verticalScrollbarWidth","gridOverflow","original_grid_width","skinSettings","skins","_initScrollStateEvents","_getVerticalScrollbar","_findGridResizer","gridFirst","_getSiblings","_behind","_front","resizeInfo","initialWidth","prevCellWidth","nextCellWidth","viewCell","limits","newBehindSize","newFrontSize","oldBackSize","oldFrontSize","newBackSize","attachInitializer","Scrollbar","mainLayoutInitializer","mainTimelineInitializer","mainGridInitializer","ResourceGrid","ResourceGridLightbox","ResourceTimeline","ResourceHistogram","layersEngine","createLayers","gridEditorsFactory","layersApi","gridRenderer","renderTaskBg","renderTaskBar","timedProjectBar","renderTimedProjectBar","taskRollupBar","renderRollupTaskBar","taskSplitBar","renderSplitTaskBar","renderConstraints","taskDeadline","renderDeadline","renderBaselines","renderLink","resourceRow","resourceMatrixRenderer","resourceHistogram","gridTaskRowResizerRenderer","layersService","ui$1","createLayoutFacade","getTimeline","getGrid","getBaseCell","baseCell","gridDrag","gridMarkers","getAttachedScrollbar","horizontalScrollbar","attachedScrollbar","scrollbarView","DEFAULT_VALUE","tryCall","getTaskTop","getTaskBarHeight","domAttr","getLinkNode","oldH","oldV","scrollBoth","verticalViews","horizontalViews","commonViews","viewId","newV","newH","date_x","scroll_to","leftPos","_scroll_state","gridCell","timelineCell","gridScrollbar","scrollVer","scrollHor","horState","verState","cellName","horizontalScroll","verticalScroll","_configure","_get_skin","themeVar","isCssVarTheme","themeName","href","_theme_info","theme","cssVarTheme","skinset","_second_column_width","_third_column_width","_lightbox_template","_redefine_lightbox_buttons","resetSkin","monitorThemeChange","_addThemeClass","setSkin","skinChanged","monitorIntervalId","csstheme","skyblue","lightbox_additional_height","meadow","terrace","broadway","_config_buttons_left","_config_buttons_right","material","indx","dark","contrast_black","contrast_white","scrollRange","scrollDelay","scrollSpeed","isMove","delayTimeout","startPos","eventPos","isDisplayed","getAutoscrollContainer","isScrollState","dragMarker","isResize","isLink","isClickDrag","defineDelayTimeout","speed","tick","autoscroll_delay","defineScrollInterval","autoscrollInterval","isScroll","need_scroll","currentScrollTop","scrollOuterHeight","scrollInnerHeight","currentScrollLeft","scrollOuterWidth","scrollInnerWidth","autoscroll_step","boxSize","jQuery","$","fn","dhx_gantt","each","newgantt","Gantt","getGanttInstance","jquery_hooks","dhtmlx","attaches","attachGantt","cmp","attachObject","dataType","dataObj","vs","av","border","gridId","gridObj","method_name","dhtmlXCellObject","dhtmlx_hooks","USE_KEY","_defaultScales","TimelineZoom","zoomIn","getCurrentLevel","setLevel","zoomOut","_levels","_activeLevelIndex","getLevels","zoomLevel","_getZoomIndexByName","levelName","_getVisibleDate","_visibleDate","cursorOffset","nextConfig","chartConfig","resourceViews","resourceView","resourceConfig","fixed_scales","cursorDate","newPosition","middleDate","_attachWheelEvent","_useKey","_handler","_defaultHandler","timelineOffset","wheelY","wheelUp","stopPropagation","_setScaleSettings","_setScaleDates","_initialStartDate","_initialEndDate","activeLevelIndex","_mapScales","levels","_minColumnWidth","minColumnWidth","_maxColumnWidth","maxColumnWidth","_widthStep","widthStep","_stepUp","_stepDown","nextLevel","touch_feedback","touch_feedback_duration","vibrate","addTouchEvents","platform","_touch_events","findTargetView","allViews","scrollView","getTaskDND","tasksDnD","touchHandlers","names","dblclicktime","actionMode","scrollMode","actionStart","previousActionStart","longTapTimer","currentDndId","dndNodes","targetView","multiTouchEvents","newScrollState","block_action","_locate_css","cloneTaskRendered","noMultitouch","sameTarget","taskNode","dummy","BaseControl","Super","TemplateControlConstructor","TemplateControl","sns","TextareaControlConstructor","TextareaControl","_get_input","_focus","TimeControlConstructor","TimeControl","getTimePicker","sectionClassName","_time_format_order","auto_end_date","_update_lightbox_select","_fill_lightbox_select","onchange","_resolve_default_mapping","selects","_getEndDate","getTimePickerValue","autofix_end","_get_timepicker_step","htmlHelpers","getHtmlSelect","_attributes","getHtmlOption","_getHtmlContainer","getHtmlButton","getHtmlDiv","getHtmlLabel","getHtmlInput","_getHtmlAttributes","ResourcesControlConstructor","SelectControl","_dhx_onchange","CheckboxControlConstructor","BaseConstrutor","CheckboxControl","single_value","checkboxes","checked","helpers.arrayMap","RadioControlConstructor","RadioControl","radio","default_value","DurationControlConstructor","DurationControl","singleDate","lightboxDurationInputAttrString","durationInputClass","inps","btns","endspan","duration_val","_calc_date","_getStartDate","_getDuration","_change_duration","charCode","projectionCalendar","ParentControlConstructor","ParentControl","_display","getLightboxValues","tmpDom","newOptions","onselect","allow_root","root_label","_filter","ConstraintControlConstructor","ConstraintControl","isNonTimedConstraint","toggleTimeSelect","timeSelects","typeValue","isNonTimed","disabled","timeLabel","typeSelect","_eventsInitialized","constraintDate","constraintType","getConstraintType","TypeselectControlConstructor","TypeselectControl","typeKey","oldOnChange","_lightbox_current_type","BaselineControlConstructor","_generateBaselineRow","durationLabel","deleteLabel","durationEl","deleteButton","baselineRow","deleteEl","baselineSection","baselineRows","baselineNode","baselineId","dataset","updatedBaseline","button_click","_get_typed_lightbox_config","NewResourcesControlConstructor","localCache","resourcesValues","eventsInitialized","gridID","resource_filter_value","initialValues","newValues","selectResEditor","numberEditor","defaultValue","resource_default_assignment","_clearCached","newResourcesControl","_generateResourceInputSection","resourceFilterPlaceholder","_generateResourceTable","resourceTable","gridConfig","wide_form","searchItems","clonedAssignments","structuredClone","_generateAssignmentDefaultRow","lightboxSection","_setFocus","resourceRows","lastRow","resourceCell","firstAddBtn","resourceGrid","setInitialValues","_setFilterCache","_center_lightbox","getVisibleResources","visibleResources","currentAssignments","_getValue","_applyFilter","_saveValues","resultSns","filterCache","_getFilterCache","filterApplied","_getSnsToHideUnsetted","resource_selector","_getInputElementSelector","originalAssignmentId","helpers.throttle","controlConfig","hideUnsetted","comparison","resultConfig","helpers.arrayFilter","isChecked","SelectControlConstructor","ResourcesControl","BaselineControl","NewResourcesControl","_lightbox_methods","setParentNode","cspEnvironment","showCover","_fill_lightbox","_setLbPosition","lightboxVisibleAttr","_is_chart_visible","getLabel","list_name","_lightbox_type","lightboxDiv","fullWidth","ds","classNames","_is_lightbox_timepicker","getHtmlButtons","lightboxAttr","onmousedown","_ready_to_dnd","onselectstart","cursor","_init_dnd_events","show_cover","_cover","_render_sections","backup_overflow","bindLabelsToInputs","_init_lightbox_events","rootElement","_move_while_dnd","_finish_dnd","_cancel_lightbox","sec","buttonTarget","time_controls","time_optional","duration_optional","sortedSns","lightboxHiddenAttr","hideCover","_custom_lightbox","_set_lightbox_values","lightboxHeader","lightbox_header","get_template_control","control","get_select_control","get_textarea_control","get_time_control","_dnd_start_lb","gantt_unselectable","lb","_lb_start","timeFormat","getTimeFormat","limit_time_select","first_hour","last_hour","getHtmlTimePickerOptions","lightboxSelectAttrString","needSetTime","mapOffset","checkbox","constraint","typeselect","_simple_confirm","_get_type_name","type_value","oldType","labelBlock","inputBlock","inputId","floatRight","lightboxButtonAttrString","time_format","start_year","end_year","tdate","year_range","_time_values","lightbox_optional_time","_extend_to_optional","lightbox_block","optional_time","update_block","button_text","wai_aria","htmlTags","extraSpaces","stripHTMLLite","htmlText","singleQuotes","escapeQuotes","getAttributeString","_taskCommonAttr","linkTypes","toStart","fromStart","gridSeparatorAttr","buttonName","role","tabindex","headerText","time_option","buttonLabel","isDisabled","uiApi","targetAttribute","_locateHTML","firstTask","domHelpers.getScrollSize","availablePlugins","critical_path","grouping","groupBy","overlay","ajaxLoading","_load_url","cl","_load_type"],"mappings":"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","x_google_ignoreList":[47]}