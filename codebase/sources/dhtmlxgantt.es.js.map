{"version":3,"file":"dhtmlxgantt.es.js","sources":["../../sources/core/ui/utils/dom_helpers.js","../../sources/utils/global.js","../../sources/ext/click_drag/eventsManager.ts","../../sources/utils/eventable.js","../../sources/utils/helpers.js","../../sources/ext/click_drag/selectedRegion.ts","../../sources/ext/click_drag/index.ts","../../sources/ext/drag_timeline/eventsManager.ts","../../sources/ext/drag_timeline/index.ts","../../sources/ext/export_api/index.ts","../../sources/ext/fullscreen/index.ts","../../sources/ext/keyboard_navigation/common/keyboard_shortcuts.js","../../sources/ext/keyboard_navigation/common/eventhandler.js","../../sources/ext/keyboard_navigation/common/trap_modal_focus.js","../../sources/ext/keyboard_navigation/elements/gantt_node.js","../../sources/ext/keyboard_navigation/elements/nav_node.js","../../sources/ext/keyboard_navigation/elements/header_cell.js","../../sources/ext/keyboard_navigation/elements/task_row.js","../../sources/ext/keyboard_navigation/elements/task_cell.js","../../sources/ext/keyboard_navigation/modals.js","../../sources/ext/keyboard_navigation/core.js","../../sources/ext/keyboard_navigation.js","../../sources/ext/marker.js","../../sources/ext/multiselect.js","../../sources/ext/quick_info/quickInfo.ts","../../sources/ext/quick_info/index.ts","../../sources/utils/utils.js","../../sources/core/ui/utils/dom_event_scope.js","../../sources/ext/tooltip/tooltip.ts","../../sources/ext/tooltip/tooltipManager.ts","../../sources/ext/tooltip/index.ts","../../sources/ext/undo/monitor.ts","../../sources/ext/undo/undo.ts","../../sources/ext/undo/index.ts","../../sources/ext/extensions_gpl.ts","../../sources/constants/index.js","../../sources/ext/extension_manager.ts","../../sources/core/common/services.js","../../sources/core/common/config.ts","../../sources/utils/env.js","../../sources/core/common/serialize.ts","../../sources/core/common/ajax.js","../../sources/core/common/date_parsers/fast_version.ts","../../sources/core/common/date_parsers/csp_compliant_version.ts","../../sources/core/common/date.js","../../node_modules/remote-client/dist/remote.es6.js","../../sources/core/remote/remote_events.js","../../sources/utils/timeout.js","../../sources/core/common/dnd.js","../../sources/core/common/templates.js","../../sources/core/common/state.js","../../sources/utils/promise.js","../../sources/core/facades/datastore_tasks.js","../../sources/core/facades/datastore_links.js","../../sources/core/datastore/power_array.js","../../sources/utils/placeholder_task.js","../../sources/core/datastore/datastore.js","../../sources/core/datastore/treedatastore.js","../../sources/core/datastore/select.js","../../sources/utils/is_headless.js","../../sources/core/datastore/datastore_render.js","../../sources/core/facades/datastore.js","../../sources/core/ui/timeline/scales.js","../../sources/core/gantt_data_range.js","../../sources/utils/task_tree_helpers.js","../../sources/core/datastore/datastore_hooks.js","../../sources/core/dataprocessor/data_processor_events.ts","../../sources/core/dataprocessor/extend_gantt.ts","../../sources/core/dataprocessor/simple_storage.ts","../../sources/core/dataprocessor/data_processor.ts","../../sources/core/dataprocessor/index.js","../../sources/core/plugins/batch_update.js","../../sources/core/plugins/wbs.js","../../sources/core/plugins/resources.js","../../sources/core/plugins/resource_assignments.js","../../sources/core/plugins/new_task_placeholder.js","../../sources/core/plugins/auto_task_types.js","../../sources/core/common/duration_formatter_numeric.ts","../../sources/core/common/link_formatter_simple.ts","../../sources/core/plugins/formatters.js","../../sources/core/plugins/empty_state_screen.ts","../../sources/core/ui/render/baseline_helper.js","../../sources/core/plugins/baselines.js","../../sources/core/plugins/index.js","../../sources/core/grid_column_api.gpl.js","../../sources/core/tasks.js","../../sources/core/loading/parsing.js","../../sources/core/worktime/calendar_arguments_helper.js","../../sources/core/worktime/strategy/work_calendar_merger.js","../../sources/core/worktime/strategy/work_unit_cache/workunit_map_cache.ts","../../sources/core/worktime/strategy/work_unit_cache/workunit_object_cache.ts","../../sources/core/worktime/strategy/work_unit_cache/larger_units_helper.ts","../../sources/core/worktime/strategy/work_unit_cache/index.ts","../../sources/core/worktime/strategy/work_unit_cache/date_duration_cache.ts","../../sources/core/worktime/strategy/calendar_strategy.js","../../sources/core/worktime/legacy_resource_config.js","../../sources/core/worktime/dynamic_resource_calendars.js","../../sources/core/worktime/calendar_manager.js","../../sources/core/worktime/strategy/no_work_time.js","../../sources/core/worktime/time_calculator.js","../../sources/core/facades/worktime_calendars.js","../../sources/core/worktime/work_time.js","../../sources/core/data.js","../../sources/core/data_task_types.gpl.js","../../sources/core/cached_functions.js","../../sources/core/ui/resize_listener.js","../../sources/core/common/assert.js","../../sources/core/gantt_core.js","../../sources/core/destructor.js","../../sources/locale/locale_ar.ts","../../sources/locale/locale_be.ts","../../sources/locale/locale_ca.ts","../../sources/locale/locale_cn.ts","../../sources/locale/locale_cs.ts","../../sources/locale/locale_da.ts","../../sources/locale/locale_de.ts","../../sources/locale/locale_el.ts","../../sources/locale/locale_en.ts","../../sources/locale/locale_es.ts","../../sources/locale/locale_fa.ts","../../sources/locale/locale_fi.ts","../../sources/locale/locale_fr.ts","../../sources/locale/locale_he.ts","../../sources/locale/locale_hr.ts","../../sources/locale/locale_hu.ts","../../sources/locale/locale_id.ts","../../sources/locale/locale_it.ts","../../sources/locale/locale_jp.ts","../../sources/locale/locale_kr.ts","../../sources/locale/locale_manager.ts","../../sources/locale/locale_nb.ts","../../sources/locale/locale_nl.ts","../../sources/locale/locale_no.ts","../../sources/locale/locale_pl.ts","../../sources/locale/locale_pt.ts","../../sources/locale/locale_ro.ts","../../sources/locale/locale_ru.ts","../../sources/locale/locale_si.ts","../../sources/locale/locale_sk.ts","../../sources/locale/locale_sv.ts","../../sources/locale/locale_tr.ts","../../sources/locale/locale_ua.ts","../../sources/locale/index.ts","../../sources/factory/make_instance_common.js","../../sources/core/ui/message.js","../../sources/core/ui/configurable.js","../../sources/core/ui/ui_factory.js","../../sources/core/ui/mouse.js","../../sources/core/ui/render/viewport/is_in_viewport.js","../../sources/core/ui/render/is_legacy_smart_render.js","../../sources/core/ui/render/viewport/get_grid_row_rectangle.js","../../sources/core/ui/render/viewport/get_visible_bars_range.js","../../sources/core/ui/render/render_factory.js","../../sources/core/ui/render/layer_engine.js","../../sources/core/ui/render/viewport/get_bar_rectangle.js","../../sources/core/ui/render/viewport/get_link_rectangle.js","../../sources/core/ui/render/viewport/factory/get_visible_link_range.js","../../sources/core/ui/render/viewport/is_link_in_viewport.js","../../sources/core/ui/gantt_layers.js","../../sources/core/ui/layout/cell.js","../../sources/utils/extends.js","../../sources/core/ui/layout/layout.js","../../sources/core/ui/layout/view_layout.js","../../sources/core/ui/layout/view_cell.js","../../sources/core/ui/layout/resizer_cell.gpl.js","../../sources/core/ui/layout/scrollbar_cell.js","../../sources/core/ui/row_position_fixed_height.js","../../sources/core/ui/row_position_mixin.js","../../sources/core/ui/timeline/tasks_canvas_render.gpl.js","../../sources/core/ui/timeline/timeline_layers_gpl.js","../../sources/core/ui/timeline/timeline.js","../../sources/core/ui/grid/grid_resize.gpl.js","../../sources/core/ui/grid/task_grid_row_resize.js","../../sources/core/ui/plugins/column_grid_dnd/scrollable_grid.ts","../../sources/core/ui/plugins/column_grid_dnd/column_grid_dnd.ts","../../sources/core/ui/mouse_event_container.js","../../sources/core/ui/grid/grid.js","../../sources/core/ui/grid/editors/keyboard_mappings/default.js","../../sources/core/ui/grid/editors/keyboard_mappings/keyboard_navigation.js","../../sources/core/ui/grid/editors/keyboard_mappings.js","../../sources/core/ui/grid/editors/editors/base.js","../../sources/core/ui/grid/editors/editors/text.js","../../sources/core/ui/grid/editors/editors/number.js","../../sources/core/ui/grid/editors/editors/select.js","../../sources/core/ui/grid/editors/editors/date.js","../../sources/core/ui/grid/editors/editors/predecessor.js","../../sources/core/ui/grid/editors/editors/duration.js","../../sources/core/ui/grid/editors/linked_properties.js","../../sources/core/ui/grid/editors/controller.js","../../sources/core/ui/render/viewport/is_bar_in_viewport.js","../../sources/core/ui/render/task_bar_render.js","../../sources/core/ui/render/task_bar_smart_render.js","../../sources/core/ui/render/dummy_layer.js","../../sources/core/ui/render/task_rollup_render.js","../../sources/core/ui/render/viewport/get_bg_row_rectangle.js","../../sources/core/ui/render/viewport/get_visible_cells_range.js","../../sources/core/ui/render/viewport/is_column_visible.js","../../sources/core/ui/render/prerender/task_bg_placeholder.js","../../sources/core/ui/render/task_bg_render.js","../../sources/core/ui/render/link_render.js","../../sources/core/ui/render/viewport/is_grid_row_in_viewport.js","../../sources/core/ui/render/task_grid_line_render.js","../../sources/core/resource_timetable_builder.js","../../sources/core/ui/render/resource_matrix_render.js","../../sources/core/ui/render/task_grid_row_resize_render.js","../../sources/core/ui/grid/tasks_grid_dnd.js","../../sources/core/ui/grid/tasks_grid_dnd_marker_helpers/drop_target.js","../../sources/core/ui/grid/tasks_grid_dnd_marker_helpers/locked_level.js","../../sources/core/ui/grid/tasks_grid_dnd_marker_helpers/multi_level.js","../../sources/core/ui/grid/tasks_grid_dnd_marker_helpers/highlight.js","../../sources/core/ui/grid/tasks_grid_dnd_marker.js","../../sources/core/ui/grid/main_grid_initializer.js","../../sources/core/ui/timeline/tasks_dnd.js","../../sources/core/ui/timeline/links_dnd.js","../../sources/core/ui/timeline/main_timeline_initializer.js","../../sources/core/ui/main_layout_initializer.js","../../sources/core/ui/index.js","../../sources/core/facades/layout.js","../../sources/core/data_task_layers.gpl.js","../../sources/core/ui/skin.js","../../sources/css/skins/skyblue.js","../../sources/css/skins/meadow.js","../../sources/css/skins/terrace.js","../../sources/css/skins/broadway.js","../../sources/css/skins/material.js","../../sources/css/skins/dark.js","../../sources/css/skins/contrast_black.js","../../sources/css/skins/contrast_white.js","../../sources/core/ui/plugins/autoscroll.js","../../sources/core/ui/plugins/jquery_hooks.js","../../sources/core/ui/plugins/dhtmlx_hooks.js","../../sources/core/ui/plugins/timeline_zoom.ts","../../sources/core/ui/plugins/index.js","../../sources/core/ui/touch.js","../../sources/core/ui/lightbox/controls/base_control.js","../../sources/core/ui/lightbox/controls/template_control.js","../../sources/core/ui/lightbox/controls/textarea_control.js","../../sources/core/ui/lightbox/controls/time_control.js","../../sources/core/ui/utils/html_helpers.js","../../sources/core/ui/lightbox/controls/select_control.js","../../sources/core/ui/lightbox/controls/checkbox_control.js","../../sources/core/ui/lightbox/controls/radio_control.js","../../sources/core/ui/lightbox/controls/duration_control.js","../../sources/core/ui/lightbox/controls/parent_control.js","../../sources/core/ui/lightbox/controls/constraint_control.js","../../sources/core/ui/lightbox/controls/typeselect_control.js","../../sources/core/ui/lightbox/controls/baseline_control.js","../../sources/core/ui/lightbox/index.js","../../sources/core/ui/lightbox/lightbox_optional_time.js","../../sources/core/ui/wai_aria.js","../../sources/core/ui_core.js","../../sources/core/loading/ajax_loading.js","../../sources/factory/make_instance_web.js","../../sources/dhtmlxgantt.gpl.ts"],"sourcesContent":["//returns position of html element on the page\r\nfunction getNodePosition(elem) {\r\n\tvar top=0, left=0, right=0, bottom=0;\r\n\tif (elem.getBoundingClientRect) { //HTML5 method\r\n\t\tvar box = elem.getBoundingClientRect();\r\n\t\tvar body = document.body;\r\n\t\tvar docElem = (document.documentElement ||\r\n\t\t\tdocument.body.parentNode ||\r\n\t\t\tdocument.body);\r\n\r\n\t\tvar scrollTop = window.pageYOffset || docElem.scrollTop || body.scrollTop;\r\n\t\tvar scrollLeft = window.pageXOffset || docElem.scrollLeft || body.scrollLeft;\r\n\t\tvar clientTop = docElem.clientTop || body.clientTop || 0;\r\n\t\tvar clientLeft = docElem.clientLeft || body.clientLeft || 0;\r\n\t\ttop  = box.top +  scrollTop - clientTop;\r\n\t\tleft = box.left + scrollLeft - clientLeft;\r\n\r\n\t\tright = document.body.offsetWidth - box.right;\r\n\t\tbottom = document.body.offsetHeight - box.bottom;\r\n\t} else { //fallback to naive approach\r\n\t\twhile(elem) {\r\n\t\t\ttop = top + parseInt(elem.offsetTop,10);\r\n\t\t\tleft = left + parseInt(elem.offsetLeft,10);\r\n\t\t\telem = elem.offsetParent;\r\n\t\t}\r\n\r\n\t\tright = document.body.offsetWidth - elem.offsetWidth - left;\r\n\t\tbottom = document.body.offsetHeight - elem.offsetHeight - top;\r\n\t}\r\n\treturn { y: Math.round(top), x: Math.round(left), width:elem.offsetWidth, height:elem.offsetHeight, right: Math.round(right), bottom: Math.round(bottom) };\r\n}\r\n\r\nfunction isVisible(node){\r\n\tvar display = false,\r\n\t\tvisibility = false;\r\n\tif(window.getComputedStyle){\r\n\t\tvar style = window.getComputedStyle(node, null);\r\n\t\tdisplay = style[\"display\"];\r\n\t\tvisibility = style[\"visibility\"];\r\n\t}else if(node.currentStyle){\r\n\t\tdisplay = node.currentStyle[\"display\"];\r\n\t\tvisibility = node.currentStyle[\"visibility\"];\r\n\t}\r\n\treturn (display != \"none\" && visibility != \"hidden\");\r\n}\r\n\r\nfunction hasNonNegativeTabIndex(node){\r\n\treturn !isNaN(node.getAttribute(\"tabindex\")) && (node.getAttribute(\"tabindex\")*1 >= 0);\r\n}\r\n\r\nfunction hasHref(node){\r\n\tvar canHaveHref = {\"a\": true, \"area\": true};\r\n\tif(canHaveHref[node.nodeName.loLowerCase()]){\r\n\t\treturn !!node.getAttribute(\"href\");\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nfunction isEnabled(node){\r\n\tvar canDisable = {\"input\":true, \"select\":true, \"textarea\":true, \"button\":true, \"object\":true};\r\n\tif(canDisable[node.nodeName.toLowerCase()]){\r\n\t\treturn !node.hasAttribute(\"disabled\");\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n\r\nfunction getFocusableNodes(root){\r\n\tvar nodes = root.querySelectorAll([\r\n\t\t\"a[href]\",\r\n\t\t\"area[href]\",\r\n\t\t\"input\",\r\n\t\t\"select\",\r\n\t\t\"textarea\",\r\n\t\t\"button\",\r\n\t\t\"iframe\",\r\n\t\t\"object\",\r\n\t\t\"embed\",\r\n\t\t\"[tabindex]\",\r\n\t\t\"[contenteditable]\"\r\n\t].join(\", \"));\r\n\r\n\tvar nodesArray = Array.prototype.slice.call(nodes, 0);\r\n\t\r\n\tfor(var i = 0; i < nodesArray.length; i++){\r\n\t\tnodesArray[i].$position = i;\r\n\t\t// we remember original nodes order, \r\n\t\t// so when we sort them by tabindex we ensure order of nodes with same tabindex is preserved, \r\n\t\t// since some browsers do unstable sort\r\n\t}\r\n\t\r\n\t// use tabindex to sort focusable nodes\r\n\tnodesArray.sort(function(a, b) {\r\n\t\tif(a.tabIndex === 0 && b.tabIndex !== 0){\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\tif(a.tabIndex !== 0 && b.tabIndex === 0){\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\t\r\n\t\tif (a.tabIndex === b.tabIndex){\r\n\t\t\t// ensure we do stable sort\r\n\t\t\treturn a.$position - b.$position;\r\n\t\t}\r\n\t\tif (a.tabIndex < b.tabIndex) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\treturn 1;\r\n\t});\r\n\t\r\n\tfor(var i = 0; i < nodesArray.length; i++){\r\n\t\tvar node = nodesArray[i];\r\n\t\tvar isValid = (hasNonNegativeTabIndex(node)  || isEnabled(node) || hasHref(node)) && isVisible(node);\r\n\t\tif(!isValid){\r\n\t\t\tnodesArray.splice(i, 1);\r\n\t\t\ti--;\r\n\t\t}\r\n\t}\r\n\treturn nodesArray;\r\n}\r\n\r\nfunction getScrollSize(){\r\n\tvar div = document.createElement(\"div\");\r\n\tdiv.style.cssText=\"visibility:hidden;position:absolute;left:-1000px;width:100px;padding:0px;margin:0px;height:110px;min-height:100px;overflow-y:scroll;\";\r\n\r\n\tdocument.body.appendChild(div);\r\n\tvar width = div.offsetWidth-div.clientWidth;\r\n\tdocument.body.removeChild(div);\r\n\r\n\treturn Math.max(width, 15);\r\n}\r\n\r\nfunction getClassName(node){\r\n\tif(!node) return \"\";\r\n\r\n\tvar className = node.className || \"\";\r\n\tif(className.baseVal)//'className' exist but not a string - IE svg element in DOM\r\n\t\tclassName = className.baseVal;\r\n\r\n\tif(!className.indexOf)\r\n\t\tclassName = \"\";\r\n\r\n\treturn _trimString(className);\r\n}\r\n\r\nfunction addClassName(node, className){\r\n\tif (className && node.className.indexOf(className) === -1) {\r\n\t\tnode.className += \" \" + className;\r\n\t}\r\n}\r\n\r\nfunction removeClassName(node, name) {\r\n\tname = name.split(\" \");\r\n\tfor (var i = 0; i < name.length; i++) {\r\n\t\tvar regEx = new RegExp(\"\\\\s?\\\\b\" + name[i] + \"\\\\b(?![-_.])\", \"\");\r\n\t\tnode.className = node.className.replace(regEx, \"\");\r\n\t}\r\n}\r\n\r\nfunction hasClass(element, className){\r\n\tif ('classList' in element) {\r\n\t\treturn element.classList.contains(className);\r\n\t} else { \r\n\t\treturn new RegExp(\"\\\\b\" + className + \"\\\\b\").test(element.className);\r\n\t}\r\n}\r\n\r\nfunction toNode(node) {\r\n\tif (typeof node === \"string\") {\r\n\t\treturn (document.getElementById(node) || document.querySelector(node) || document.body);\r\n\t}\r\n\treturn node || document.body;\r\n}\r\n\r\nvar _slave;\r\nfunction insertNode(node, newone) {\r\n\tif(!_slave){\r\n\t\t_slave = document.createElement(\"div\");\r\n\t}\r\n\t_slave.innerHTML = newone;\r\n\tvar child = _slave.firstChild;\r\n\tnode.appendChild(child);\r\n\treturn child;\r\n}\r\n\r\nfunction removeNode(node) {\r\n\tif (node && node.parentNode) {\r\n\t\tnode.parentNode.removeChild(node);\r\n\t}\r\n}\r\n\r\nfunction getChildNodes(node, css) {\r\n\tvar ch = node.childNodes;\r\n\tvar len = ch.length;\r\n\tvar out = [];\r\n\tfor (var i = 0; i < len; i++) {\r\n\t\tvar obj = ch[i];\r\n\t\tif (obj.className && obj.className.indexOf(css) !== -1) {\r\n\t\t\tout.push(obj);\r\n\t\t}\r\n\t}\r\n\treturn out;\r\n}\r\n\r\nfunction getTargetNode(e) {\r\n\tvar trg;\r\n\tif (e.tagName)\r\n\t\ttrg = e;\r\n\telse {\r\n\t\te = e || window.event;\r\n\t\ttrg = e.target || e.srcElement;\r\n\t\tif (trg.shadowRoot && e.composedPath) {\r\n\t\t\ttrg = e.composedPath()[0];\r\n\t\t}\r\n\t}\r\n\treturn trg;\r\n}\r\n\r\nfunction locateAttribute(e, attribute) {\r\n\tif(!attribute) return;\r\n\r\n\tvar trg = getTargetNode(e);\r\n\r\n\twhile (trg){\r\n\t\tif (trg.getAttribute){\t//text nodes has not getAttribute\r\n\t\t\tvar test = trg.getAttribute(attribute);\r\n\t\t\tif (test) return trg;\r\n\t\t}\r\n\t\ttrg=trg.parentNode;\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction _trimString(str){\r\n\tvar func = String.prototype.trim || function(){ return this.replace(/^\\s+|\\s+$/g, \"\"); };\r\n\treturn func.apply(str);\r\n}\r\n\r\nfunction locateClassName(e, classname, strict){\r\n\tvar trg = getTargetNode(e);\r\n\tvar css = \"\";\r\n\r\n\tif(strict === undefined)\r\n\t\tstrict = true;\r\n\r\n\twhile (trg){\r\n\t\tcss = getClassName(trg);\r\n\t\tif(css){\r\n\t\t\tvar ind = css.indexOf(classname);\r\n\t\t\tif (ind >= 0){\r\n\t\t\t\tif (!strict)\r\n\t\t\t\t\treturn trg;\r\n\r\n\t\t\t\t//check that we have exact match\r\n\t\t\t\tvar left = (ind === 0) || (!_trimString(css.charAt(ind - 1)));\r\n\t\t\t\tvar right = ((ind + classname.length >= css.length)) || (!_trimString(css.charAt(ind + classname.length)));\r\n\r\n\t\t\t\tif (left && right)\r\n\t\t\t\t\treturn trg;\r\n\t\t\t}\r\n\t\t}\r\n\t\ttrg=trg.parentNode;\r\n\t}\r\n\treturn null;\r\n}\r\n\r\n/*\r\nevent position relatively to DOM element\r\n */\r\nfunction getRelativeEventPosition(ev, node){\r\n\tvar d = document.documentElement;\r\n\tvar box = getNodePosition(node);\r\n\r\n\treturn {\r\n\t\tx: ev.clientX + d.scrollLeft - d.clientLeft - box.x + node.scrollLeft,\r\n\t\ty: ev.clientY + d.scrollTop - d.clientTop - box.y + node.scrollTop\r\n\t};\r\n}\r\n\r\nfunction getRelativeNodePosition(child, parent){\r\n\tconst childPos = getNodePosition(child);\r\n\tconst parentPos = getNodePosition(parent);\r\n\treturn {\r\n\t\tx: childPos.x - parentPos.x,\r\n\t\ty: childPos.y - parentPos.y\r\n\t};\r\n}\r\n\r\nfunction isChildOf(child, parent){\r\n\tif(!child || !parent){\r\n\t\treturn false;\r\n\t}\r\n\r\n\twhile(child && child != parent) {\r\n\t\tchild = child.parentNode;\r\n\t}\r\n\r\n\treturn child === parent;\r\n}\r\n\r\nfunction closest(element, selector){\r\n\tif(element.closest){\r\n\t\treturn element.closest(selector);\r\n\t}else if(element.matches || element.msMatchesSelector || element.webkitMatchesSelector){\r\n\t\tvar el = element;\r\n\t\tif (!document.documentElement.contains(el)) return null;\r\n\t\tdo {\r\n\t\t\tvar method = el.matches || el.msMatchesSelector || el.webkitMatchesSelector;\r\n\r\n\t\t\tif (method.call(el, selector)) return el;\r\n\t\t\tel = el.parentElement || el.parentNode;\r\n\t\t} while (el !== null && el.nodeType === 1); \r\n\t\treturn null;\r\n\t}else{\r\n\t\t// eslint-disable-next-line no-console\r\n\t\tconsole.error(\"Your browser is not supported\");\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nfunction getClosestSizedElement(element) {\r\n\twhile (element) {\r\n\t\tif (element.offsetWidth > 0 && element.offsetHeight > 0) {\r\n\t\t\treturn element;\r\n\t\t}\r\n\t\telement = element.parentElement;\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction isShadowDomSupported() {\r\n\treturn document.head.createShadowRoot || document.head.attachShadow;\r\n}\r\n\r\n/**\r\n * Returns element that has the browser focus, or null if no element has focus.\r\n * Works with shadow DOM, so it's prefereed to use this function instead of document.activeElement directly.\r\n * @returns HTMLElement\r\n */\r\nfunction getActiveElement(){\r\n\tvar activeElement = document.activeElement;\r\n\tif (activeElement.shadowRoot) {\r\n\t\tactiveElement = activeElement.shadowRoot.activeElement;\r\n\t}\r\n\tif (activeElement === document.body && document.getSelection) {\r\n\t\tactiveElement = document.getSelection().focusNode || document.body;\r\n\t}\r\n\r\n\treturn activeElement;\r\n}\r\n\r\n/**\r\n * Returns document.body or the host node of the ShadowRoot, if the element is attached to ShadowDom\r\n * @param {HTMLElement} element \r\n * @returns HTMLElement\r\n */\r\nfunction getRootNode(element) {\r\n\tif (!element) {\r\n\t\treturn document.body;\r\n\t}\r\n\tif (!isShadowDomSupported()) {\r\n\t\treturn document.body;\r\n\t}\r\n\twhile (element.parentNode && (element = element.parentNode)) {\r\n\t\tif (element instanceof ShadowRoot) {\r\n\t\t\treturn element.host;\r\n\t\t}\r\n\t}\r\n\treturn document.body;\r\n}\r\n\r\nfunction hasShadowParent(element) {\r\n\treturn !!getRootNode(element);\r\n}\r\n\r\nexport {\r\n\tgetNodePosition,\r\n\tgetFocusableNodes,\r\n\tgetScrollSize,\r\n\tgetClassName,\r\n\taddClassName,\r\n\tremoveClassName,\r\n\tinsertNode,\r\n\tremoveNode,\r\n\tgetChildNodes,\r\n\ttoNode,\r\n\tlocateClassName,\r\n\tlocateAttribute,\r\n\tgetTargetNode,\r\n\tgetRelativeEventPosition,\r\n\tisChildOf,\r\n\thasClass,\r\n\tclosest,\r\n\tgetRootNode,\r\n\thasShadowParent,\r\n\tisShadowDomSupported,\r\n\tgetActiveElement,\r\n\tgetRelativeNodePosition,\r\n\tgetClosestSizedElement\r\n};","\r\n/* eslint-disable no-restricted-globals */\r\nvar globalScope;\r\nif(typeof window !== \"undefined\"){\r\n\tglobalScope = window;\r\n}else{\r\n\tglobalScope = global;\r\n}\r\n/* eslint-enable no-restricted-globals */\r\n\r\nexport default globalScope;","import * as domHelpers from \"../../core/ui/utils/dom_helpers\";\r\nimport global from \"../../utils/global\";\r\nimport { SelectedRegion } from \"./selectedRegion\";\r\n\r\nexport class EventsManager {\r\n\tprivate _mouseDown: boolean = false;\r\n\tprivate _domEvents: any;\r\n\tprivate _originPosition: string;\r\n\tprivate _gantt: any;\r\n\tprivate _restoreOriginPosition: () => void;\r\n\tconstructor(gantt: any) {\r\n\t\tthis._gantt = gantt;\r\n\t\tthis._domEvents = gantt._createDomEventScope();\r\n\t}\r\n\r\n\tattach(selectedRegion: SelectedRegion, useKey?: \"shiftKey\" | \"ctrlKey\" | \"altKey\", ignore?: any): void {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst _target = selectedRegion.getViewPort();\r\n\t\tthis._originPosition = global.getComputedStyle(_target).display;\r\n\t\tthis._restoreOriginPosition = () => {\r\n\t\t\t_target.style.position = this._originPosition;\r\n\t\t};\r\n\t\tif (this._originPosition === \"static\") {\r\n\t\t\t_target.style.position = \"relative\";\r\n\t\t}\r\n\t\tconst state = gantt.$services.getService(\"state\");\r\n\t\tstate.registerProvider(\"clickDrag\", () => {\r\n\t\t\tconst result = { autoscroll: false };\r\n\t\t\treturn result;\r\n\t\t});\r\n\r\n\r\n\t\tlet scheduledDndCoordinates = null;\r\n\t\tconst startDragAndDrop = () => {\r\n\t\t\tif (!scheduledDndCoordinates) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis._mouseDown = true;\r\n\t\t\tselectedRegion.setStart(gantt.copy(scheduledDndCoordinates));\r\n\t\t\tselectedRegion.setPosition(gantt.copy(scheduledDndCoordinates));\r\n\t\t\tselectedRegion.setEnd(gantt.copy(scheduledDndCoordinates));\r\n\t\t\tscheduledDndCoordinates = null;\r\n\t\t};\r\n\r\n\t\tthis._domEvents.attach(_target, \"mousedown\", (event) => {\r\n\t\t\tscheduledDndCoordinates = null;\r\n\t\t\tlet filterTargets = \".gantt_task_line, .gantt_task_link\";\r\n\t\t\tif (ignore !== undefined) {\r\n\t\t\t\tif (ignore instanceof Array) {\r\n\t\t\t\t\tfilterTargets = ignore.join(\", \");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfilterTargets = ignore;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (filterTargets) {\r\n\t\t\t\tif (gantt.utils.dom.closest(event.target, filterTargets)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tstate.registerProvider(\"clickDrag\", () => {\r\n\t\t\t\tconst result = { autoscroll: this._mouseDown };\r\n\t\t\t\treturn result;\r\n\t\t\t});\r\n\r\n\t\t\tif (useKey && event[useKey] !== true) { return; }\r\n\t\t\tscheduledDndCoordinates = this._getCoordinates(event, selectedRegion);\r\n\t\t});\r\n\t\tconst eventElement = domHelpers.getRootNode(gantt.$root) || document.body;\r\n\t\tthis._domEvents.attach(eventElement, \"mouseup\", (event) => {\r\n\t\t\tscheduledDndCoordinates = null;\r\n\t\t\tif (useKey && event[useKey] !== true) { return; }\r\n\t\t\tif (this._mouseDown === true) {\r\n\t\t\t\tthis._mouseDown = false;\r\n\t\t\t\tconst coordinates = this._getCoordinates(event, selectedRegion);\r\n\t\t\t\tselectedRegion.dragEnd(coordinates);\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis._domEvents.attach(_target, \"mousemove\", (event) => {\r\n\t\t\tif (useKey && event[useKey] !== true) { return; }\r\n\t\t\t// GS-854. If we don't have useKey for the click_drag extension,\r\n\t\t\t// check the drag_timeline to not simultaneously use both extensions\r\n\t\t\tconst dragTimeline = this._gantt.ext.clickDrag;\r\n\t\t\tconst dragTimelineUseKey = (this._gantt.config.drag_timeline || {}).useKey;\r\n\t\t\tif (dragTimeline && dragTimelineUseKey) {\r\n\t\t\t\tif (!useKey && event[dragTimelineUseKey]) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet coordinates = null;\r\n\t\t\tif(!this._mouseDown && scheduledDndCoordinates){\r\n\t\t\t\tcoordinates = this._getCoordinates(event, selectedRegion);\r\n\t\t\t\tif(Math.abs(scheduledDndCoordinates.relative.left - coordinates.relative.left) > 5){\r\n\t\t\t\t\t// add small threshold not to start dnd on simple click\r\n\t\t\t\t\tstartDragAndDrop();\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (this._mouseDown === true) {\r\n\t\t\t\tcoordinates = this._getCoordinates(event, selectedRegion);\r\n\t\t\t\tselectedRegion.setEnd(coordinates);\r\n\t\t\t\tselectedRegion.render();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tdetach(): void {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis._domEvents.detachAll();\r\n\t\tif(this._restoreOriginPosition){\r\n\t\t\tthis._restoreOriginPosition();\r\n\t\t}\r\n\r\n\t\tconst state = gantt.$services.getService(\"state\");\r\n\t\tstate.unregisterProvider(\"clickDrag\");\r\n\t}\r\n\r\n\tdestructor(): void {\r\n\t\tthis.detach();\r\n\t}\r\n\r\n\tprivate _getCoordinates(event: MouseEvent, selectedRegion: SelectedRegion) {\r\n\t\tconst viewPort = selectedRegion.getViewPort();\r\n\t\tconst viewPortBounds = viewPort.getBoundingClientRect();\r\n\t\tconst { clientX, clientY } = event;\r\n\t\tconst result = {\r\n\t\t\tabsolute: {\r\n\t\t\t\tleft: clientX,\r\n\t\t\t\ttop: clientY\r\n\t\t\t},\r\n\t\t\trelative: {\r\n\t\t\t\tleft: clientX - viewPortBounds.left + viewPort.scrollLeft,\r\n\t\t\t\ttop: clientY - viewPortBounds.top + viewPort.scrollTop\r\n\t\t\t}\r\n\t\t};\r\n\t\treturn result;\r\n\t}\r\n}","var EventHost = function(){\r\n\tthis._silent_mode = false;\r\n\tthis.listeners = {};\r\n};\r\n\r\nEventHost.prototype = {\r\n\t_silentStart: function() {\r\n\t\tthis._silent_mode = true;\r\n\t},\r\n\t_silentEnd: function() {\r\n\t\tthis._silent_mode = false;\r\n\t}\r\n};\r\n\r\nvar\tcreateEventStorage = function(obj) {\r\n\tvar handlers = {};\r\n\tvar index = 0;\r\n\tvar eventStorage = function(){\r\n\t\tvar combinedResult = true;\r\n\t\tfor(var i in handlers){\r\n\t\t\tvar handlerResult = handlers[i].apply(obj, arguments);\r\n\t\t\tcombinedResult=combinedResult && handlerResult;\r\n\t\t}\r\n\t\treturn combinedResult;\r\n\t};\r\n\teventStorage.addEvent=function(handler, settings){\r\n\t\tif (typeof (handler) == \"function\"){\r\n\t\t\tvar handlerId;\r\n\t\t\tif(settings && settings.id){\r\n\t\t\t\thandlerId = settings.id;\r\n\t\t\t}else{\r\n\t\t\t\thandlerId = index;\r\n\t\t\t\tindex++;\r\n\t\t\t}\r\n\r\n\t\t\tif(settings && settings.once){\r\n\t\t\t\tvar originalHandler = handler;\r\n\t\t\t\thandler = function(){\r\n\t\t\t\t\toriginalHandler();\r\n\t\t\t\t\teventStorage.removeEvent(handlerId);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\thandlers[handlerId] = handler;\r\n\t\t\treturn handlerId;\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n\teventStorage.removeEvent=function(id){\r\n\t\tdelete handlers[id];\r\n\t};\r\n\r\n\teventStorage.clear = function(){\r\n\t\thandlers = {};\r\n\t};\r\n\r\n\treturn eventStorage;\r\n};\r\n\r\nfunction makeEventable(obj){\r\n\r\n\tvar eventHost = new EventHost();\r\n\tobj.attachEvent=function(eventName, handler, settings){\r\n\t\teventName = 'ev_'+eventName.toLowerCase();\r\n\t\tif (!eventHost.listeners[eventName]){\r\n\t\t\teventHost.listeners[eventName] = createEventStorage(this);\r\n\t\t}\r\n\r\n\t\tif(settings && settings.thisObject){\r\n\t\t\thandler = handler.bind(settings.thisObject);\r\n\t\t}\r\n\r\n\t\tvar innerId = eventHost.listeners[eventName].addEvent(handler, settings);\r\n\r\n\t\tvar handlerId = (eventName+':'+innerId); //return ID (ev_eventname:1)\r\n\t\tif(settings && settings.id){\r\n\t\t\thandlerId = settings.id;\r\n\t\t}\r\n\t\treturn handlerId;\r\n\t};\r\n\r\n\tobj.attachAll = function(callback){\r\n\t\tthis.attachEvent('listen_all', callback);\r\n\t};\r\n\r\n\tobj.callEvent=function(name, eventArguments){\r\n\t\tif (eventHost._silent_mode) return true;\r\n\r\n\t\tvar handlerName = 'ev_'+name.toLowerCase();\r\n\r\n\t\tvar listeners = eventHost.listeners;\r\n\t\tif (listeners['ev_listen_all']){\r\n\t\t\tlisteners['ev_listen_all'].apply(this, [name].concat(eventArguments));\r\n\t\t}\r\n\r\n\t\tif (listeners[handlerName])\r\n\t\t\treturn listeners[handlerName].apply(this, eventArguments);\r\n\t\treturn true;\r\n\t};\r\n\r\n\tobj.checkEvent=function(name){\r\n\t\tvar listeners = eventHost.listeners;\r\n\t\treturn (!!listeners['ev_'+name.toLowerCase()]);\r\n\t};\r\n\r\n\tobj.detachEvent=function(id){\r\n\t\tif (id){\r\n\t\t\tvar listeners = eventHost.listeners;\r\n\t\t\tfor(var i in listeners){\r\n\t\t\t\tlisteners[i].removeEvent(id); //remove event\r\n\t\t\t}\r\n\r\n\t\t\tvar list = id.split(':');//get EventName and ID\r\n\t\t\tvar listeners = eventHost.listeners;\r\n\t\t\tif(list.length === 2){\r\n\t\t\t\tvar eventName = list[0];\r\n\t\t\t\tvar eventId = list[1];\r\n\t\t\t\tif(listeners[eventName]){\r\n\t\t\t\t\tlisteners[eventName].removeEvent(eventId); //remove event\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tobj.detachAllEvents = function(){\r\n\t\tfor (var name in eventHost.listeners) {\r\n\t\t\teventHost.listeners[name].clear();\r\n\t\t}\r\n\t};\r\n\r\n}\r\n\r\nexport default makeEventable;","var units = {\r\n\t\"second\": 1,\r\n\t\"minute\": 60,\r\n\t\"hour\": 60 * 60,\r\n\t\"day\": 60 * 60 * 24,\r\n\t\"week\": 60 * 60 * 24 * 7,\r\n\t\"month\": 60 * 60 * 24 * 30,\r\n\t\"quarter\": 60 * 60 * 24 * 30 * 3,\r\n\t\"year\": 60 * 60 * 24 * 365\r\n};\r\nfunction getSecondsInUnit(unit){\r\n\treturn units[unit] || units.hour;\r\n}\r\n\r\nfunction forEach(arr, callback) {\r\n\tif (arr.forEach) {\r\n\t\tarr.forEach(callback);\r\n\t} else {\r\n\t\tvar workArray = arr.slice();\r\n\t\tfor (var i = 0; i < workArray.length; i++) {\r\n\t\t\tcallback(workArray[i], i);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction arrayMap(arr, callback) {\r\n\tif (arr.map) {\r\n\t\treturn arr.map(callback);\r\n\t} else {\r\n\t\tvar workArray = arr.slice();\r\n\t\tvar resArray = [];\r\n\r\n\t\tfor (var i = 0; i < workArray.length; i++) {\r\n\t\t\tresArray.push(callback(workArray[i], i));\r\n\t\t}\r\n\t\treturn resArray;\r\n\t}\r\n}\r\n\r\n\r\nfunction arrayFind(arr, callback) {\r\n\tif (arr.find) {\r\n\t\treturn arr.find(callback);\r\n\t} else {\r\n\t\tfor (var i = 0; i < arr.length; i++) {\r\n\t\t\tif (callback(arr[i], i)) {\r\n\t\t\t\treturn arr[i];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction arrayIncludes(arr, item) {\r\n\tif(arr.includes){\r\n\t\treturn arr.includes(item);\r\n\t}else{\r\n\t\tfor (var i = 0; i < arr.length; i++) {\r\n\t\t\tif (arr[i] === item) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\n// iframe-safe array type check instead of using instanceof\r\nfunction isArray(obj){\r\n\tif(Array.isArray){\r\n\t\treturn Array.isArray(obj);\r\n\t}else{\r\n\t\t// close enough\r\n\t\treturn (obj && obj.length !== undefined && obj.pop && obj.push);\r\n\t}\r\n}\r\n\r\n// non-primitive string object, e.g. new String(\"abc\")\r\nfunction isStringObject(obj){\r\n\treturn obj && typeof obj === \"object\"\r\n\t\t&& Function.prototype.toString.call(obj.constructor) === \"function String() { [native code] }\";\r\n}\r\n\r\n// non-primitive number object, e.g. new Number(5)\r\nfunction isNumberObject(obj){\r\n\treturn obj && typeof obj === \"object\"\r\n\t\t&& Function.prototype.toString.call(obj.constructor) === \"function Number() { [native code] }\";\r\n}\r\n\r\n// non-primitive number object, e.g. new Boolean(true)\r\nfunction isBooleanObject(obj){\r\n\treturn obj && typeof obj === \"object\"\r\n\t\t&& Function.prototype.toString.call(obj.constructor) === \"function Boolean() { [native code] }\";\r\n}\r\n\r\nfunction isDate(obj) {\r\n\tif (obj && typeof obj === \"object\") {\r\n\t\treturn !!(obj.getFullYear && obj.getMonth && obj.getDate);\r\n\t} else {\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nfunction isValidDate(obj){\r\n\treturn isDate(obj) && !isNaN(obj.getTime());\r\n}\r\n\r\nfunction arrayFilter(arr, callback) {\r\n\tvar result = [];\r\n\r\n\tif (arr.filter) {\r\n\t\treturn arr.filter(callback);\r\n\t} else {\r\n\t\tfor (var i = 0; i < arr.length; i++) {\r\n\t\t\tif (callback(arr[i], i)) {\r\n\t\t\t\tresult[result.length] = arr[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n}\r\n\r\nfunction hashToArray(hash) {\r\n\tvar result = [];\r\n\r\n\tfor (var key in hash) {\r\n\t\tif (hash.hasOwnProperty(key)) {\r\n\t\t\tresult.push(hash[key]);\r\n\t\t}\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nfunction arraySome(arr, callback) {\r\n\tif (arr.length === 0) return false;\r\n\r\n\tfor (var i = 0; i < arr.length; i++) {\r\n\t\tif (callback(arr[i], i, arr)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nfunction arrayDifference(arr, callback) {\r\n\treturn arrayFilter(arr, function(item, i) {\r\n\t\treturn !callback(item, i);\r\n\t});\r\n}\r\n\r\nfunction throttle (callback, timeout) {\r\n\tvar wait = false;\r\n\r\n\treturn function () {\r\n\t\tif (!wait) {\r\n\t\t\tcallback.apply(null, arguments);\r\n\t\t\twait = true;\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\twait = false;\r\n\t\t\t}, timeout);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction delay (callback, timeout){\r\n\tvar timer;\r\n\r\n\tvar result = function() {\r\n\t\tresult.$cancelTimeout();\r\n\t\tresult.$pending = true;\r\n\t\tvar args = Array.prototype.slice.call(arguments);\r\n\t\ttimer = setTimeout(function(){\r\n\t\t\tcallback.apply(this, args);\r\n\t\t\tresult.$pending = false;\r\n\t\t}, timeout);\r\n\t};\r\n\r\n\tresult.$pending = false;\r\n\tresult.$cancelTimeout = function(){\r\n\t\tclearTimeout(timer);\r\n\t\tresult.$pending = false;\r\n\t};\r\n\tresult.$execute = function(){\r\n\t\tvar args = Array.prototype.slice.call(arguments);\r\n\t\tcallback.apply(this, args);\r\n\t\tresult.$cancelTimeout();\r\n\t};\r\n\r\n\treturn result;\r\n}\r\n\r\nfunction sortArrayOfHash(arr, field, desc) {\r\n\tvar compare = function(a, b) {\r\n\t\treturn a < b;\r\n\t};\r\n\r\n\tarr.sort(function(a, b) {\r\n\t\tif (a[field] === b[field]) return 0;\r\n\r\n\t\treturn desc ? compare(a[field], b[field]) : compare(b[field], a[field]);\r\n\t});\r\n}\r\n\r\nfunction objectKeys(obj) {\r\n\tif (Object.keys) {\r\n\t\treturn Object.keys(obj);\r\n\t}\r\n\tvar result = [];\r\n\tvar key;\r\n\tfor (key in obj) {\r\n\t\tif (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n\t\t\tresult.push(key);\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}\r\n\r\nfunction isEventable(obj) {\r\n\treturn obj.attachEvent && obj.detachEvent;\r\n}\r\n\r\n//GS-1090: A task should be able to have the id = 0\r\nfunction replaceValidZeroId(id, rootId) {\r\n\tif (checkZeroId(id) && !checkZeroId(rootId)){\r\n\t\tid = \"0\";\r\n\t}\r\n\treturn id;\r\n}\r\n\r\nfunction checkZeroId(id) {\r\n\tif (id === 0){\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nfunction findBinary(array, target) {\r\n\t// modified binary search, target value not exactly match array elements, looking for closest one\r\n\r\n\tvar low = 0, high = array.length - 1, i, item, prev;\r\n\twhile (low <= high) {\r\n\r\n\t\ti = Math.floor((low + high) / 2);\r\n\t\titem = +array[i];\r\n\t\tprev = +array[i - 1];\r\n\t\tif (item < target) {\r\n\t\t\tlow = i + 1;\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif (item > target) {\r\n\t\t\tif (!(!isNaN(prev) && prev < target)) {\r\n\t\t\t\thigh = i - 1;\r\n\t\t\t\tcontinue;\r\n\t\t\t} else {\r\n\t\t\t\t// if target is between 'i' and 'i-1' return 'i - 1'\r\n\t\t\t\treturn i - 1;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\twhile (+array[i] == +array[i + 1]) i++;\r\n\r\n\t\treturn i;\r\n\t}\r\n\treturn array.length - 1;\r\n}\r\n\r\nexport {\r\n\tgetSecondsInUnit,\r\n\tforEach,\r\n\tarrayMap,\r\n\tarrayIncludes,\r\n\tarrayFind,\r\n\tarrayFilter,\r\n\tarrayDifference,\r\n\tarraySome,\r\n\thashToArray,\r\n\tsortArrayOfHash,\r\n\tthrottle,\r\n\tisArray,\r\n\tisDate,\r\n\tisValidDate,\r\n\tisStringObject,\r\n\tisNumberObject,\r\n\tisBooleanObject,\r\n\tdelay,\r\n\tobjectKeys,\r\n\tisEventable,\r\n\treplaceValidZeroId,\r\n\tcheckZeroId,\r\n\tfindBinary\r\n};","import eventable from \"../../utils/eventable\";\r\nimport { isEventable } from \"../../utils/helpers\";\r\n\r\nexport interface ISelectedRegionConfig {\r\n\tclassName?: string;\r\n\trender?: (startPoint: IPoint, endPoint: IPoint) => HTMLElement;\r\n\tviewPort?: HTMLElement;\r\n\tuseRequestAnimationFrame: boolean;\r\n\tcallback?: (startPoint: IPoint, endPoint: IPoint, startDate: Date, endDate: Date, tasksByDate: any[], tasksByIndex: any[]) => void;\r\n\tsingleRow: boolean;\r\n}\r\n\r\ninterface ICoordinates {\r\n\tleft: number;\r\n\ttop: number;\r\n}\r\n\r\nexport interface IPoint {\r\n\tabsolute: ICoordinates;\r\n\trelative: ICoordinates;\r\n}\r\n\r\nexport class SelectedRegion {\r\n\trender: () => void;\r\n\tprivate _viewPort: HTMLElement & eventable;\r\n\tprivate _el: HTMLElement = document.createElement(\"div\");\r\n\tprivate _callback: (startPoint: IPoint, endPoint: IPoint, startDate: Date, endDate: Date, tasksByDate: any[], tasksByIndex: any[]) => void;\r\n\tprivate _startPoint: IPoint;\r\n\tprivate _endPoint: IPoint;\r\n\tprivate _positionPoint: IPoint;\r\n\tprivate _useRequestAnimationFrame: boolean;\r\n\tprivate _startDate: Date;\r\n\tprivate _endDate: Date;\r\n\tprivate _singleRow: boolean;\r\n\tprivate _gantt: any;\r\n\tprivate _view: any;\r\n\r\n\tconstructor(config: ISelectedRegionConfig, gantt: any, view: any) {\r\n\t\tthis._gantt = gantt;\r\n\t\tthis._view = view;\r\n\t\tthis._viewPort = config.viewPort;\r\n\t\tthis._el.classList.add(config.className);\r\n\t\tif (typeof config.callback === \"function\") {\r\n\t\t\tthis._callback = config.callback;\r\n\t\t}\r\n\r\n\t\tthis.render = () => {\r\n\t\t\tlet node;\r\n\t\t\tif(config.render){\r\n\t\t\t\tnode = config.render(this._startPoint, this._endPoint);\r\n\t\t\t}else{\r\n\t\t\t\tnode = this.defaultRender(this._startPoint, this._endPoint);\r\n\t\t\t}\r\n\r\n\t\t\tif(node !== this._el){\r\n\t\t\t\tif(this._el && this._el.parentNode){\r\n\t\t\t\t\tthis._el.parentNode.removeChild(this._el);\r\n\t\t\t\t}\r\n\t\t\t\tthis._el = node;\r\n\t\t\t}\r\n\r\n\t\t\tif (config.className !== \"\") {\r\n\t\t\t\tthis._el.classList.add(config.className);\r\n\t\t\t}\r\n\t\t\tthis.draw();\r\n\t\t};\r\n\r\n\t\tif (!isEventable(this._viewPort)) {\r\n\t\t\teventable(this._viewPort);\r\n\t\t}\r\n\t\tthis._singleRow = config.singleRow;\r\n\t\tthis._useRequestAnimationFrame = config.useRequestAnimationFrame;\r\n\t}\r\n\r\n\tdefaultRender = (start: IPoint, end: IPoint) => {\r\n\t\tif(!this._el){\r\n\t\t\tthis._el = document.createElement(\"div\");\r\n\t\t}\r\n\t\tconst node = this._el;\r\n\t\t// const gantt = this._gantt;\r\n\r\n\t\tconst top = Math.min(start.relative.top, end.relative.top);\r\n\t\tconst bottom = Math.max(start.relative.top, end.relative.top);\r\n\t\tconst left = Math.min(start.relative.left, end.relative.left);\r\n\t\tconst right = Math.max(start.relative.left, end.relative.left);\r\n\r\n\t\tif (this._singleRow) {\r\n\t\t\tconst pos = this._getTaskPositionByTop(this._startPoint.relative.top);\r\n\t\t\tnode.style.height = pos.height + \"px\";\r\n\t\t\tnode.style.top = pos.top + \"px\";\r\n\t\t} else {\r\n\t\t\tnode.style.height = Math.abs(bottom - top) + \"px\";\r\n\t\t\tnode.style.top = top + \"px\";\r\n\t\t}\r\n\t\tnode.style.width = Math.abs(right - left) + \"px\";\r\n\t\tnode.style.left = left + \"px\";\r\n\t\treturn node;\r\n\t};\r\n\r\n\tdraw() {\r\n\t\tif (this._useRequestAnimationFrame) {\r\n\t\t\treturn requestAnimationFrame(() => {\r\n\t\t\t\tthis._viewPort.appendChild(this.getElement());\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tthis._viewPort.appendChild(this.getElement());\r\n\t\t}\r\n\t}\r\n\r\n\tclear() {\r\n\t\tif (this._useRequestAnimationFrame) {\r\n\t\t\treturn requestAnimationFrame(() => {\r\n\t\t\t\tif (!this._el.parentNode) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis._viewPort.removeChild(this._el);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tif (!this._el.parentNode) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis._viewPort.removeChild(this._el);\r\n\t\t}\r\n\t}\r\n\r\n\tgetElement() {\r\n\t\treturn this._el;\r\n\t}\r\n\r\n\tgetViewPort() {\r\n\t\treturn this._viewPort;\r\n\t}\r\n\r\n\tsetStart(startPoint: IPoint) {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis._startPoint = startPoint;\r\n\t\tthis._startDate = gantt.dateFromPos(this._startPoint.relative.left);\r\n\t\tthis._viewPort.callEvent(\"onBeforeDrag\", [this._startPoint]);\r\n\t}\r\n\r\n\tsetEnd(endPoint: IPoint) {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis._endPoint = endPoint;\r\n\t\tif (this._singleRow) {\r\n\t\t\tconst pos = this._getTaskPositionByTop(this._startPoint.relative.top);\r\n\t\t\tthis._endPoint.relative.top = pos.top;\r\n\t\t}\r\n\t\tthis._endDate = gantt.dateFromPos(this._endPoint.relative.left);\r\n\t\tif (this._startPoint.relative.left > this._endPoint.relative.left) {\r\n\t\t\tthis._positionPoint = {\r\n\t\t\t\trelative: { left: this._endPoint.relative.left, top: this._positionPoint.relative.top },\r\n\t\t\t\tabsolute: { left: this._endPoint.absolute.left, top: this._positionPoint.absolute.top }\r\n\t\t\t};\r\n\t\t}\r\n\t\tif (this._startPoint.relative.top > this._endPoint.relative.top) {\r\n\t\t\tthis._positionPoint = {\r\n\t\t\t\trelative: { left: this._positionPoint.relative.left, top: this._endPoint.relative.top },\r\n\t\t\t\tabsolute: { left: this._positionPoint.absolute.left, top: this._endPoint.absolute.top }\r\n\t\t\t};\r\n\t\t}\r\n\r\n\r\n\t\tthis._viewPort.callEvent(\"onDrag\", [this._startPoint, this._endPoint]);\r\n\t}\r\n\r\n\tsetPosition(positionPoint: IPoint) {\r\n\t\tthis._positionPoint = positionPoint;\r\n\t}\r\n\r\n\tdragEnd(endPoint: IPoint) {\r\n\t\tconst gantt = this._gantt;\r\n\t\tif(endPoint.relative.left < 0){\r\n\t\t\tendPoint.relative.left = 0;\r\n\t\t}\r\n\t\tthis._viewPort.callEvent(\"onBeforeDragEnd\", [this._startPoint, endPoint]);\r\n\t\tthis.setEnd(endPoint);\r\n\t\t// GS-1422. The endDate can be null if we drag the mouse outside the Gantt container\r\n\t\tthis._endDate = this._endDate || gantt.getState().max_date;\r\n\r\n\t\tif (this._startDate.valueOf() > this._endDate.valueOf()) {\r\n\t\t\t[ this._startDate, this._endDate ] = [ this._endDate, this._startDate ];\r\n\t\t}\r\n\t\tthis.clear();\r\n\t\tconst tasksByTime = gantt.getTaskByTime(this._startDate, this._endDate);\r\n\t\tconst tasksByIndex = this._getTasksByTop(this._startPoint.relative.top, this._endPoint.relative.top);\r\n\r\n\t\tthis._viewPort.callEvent(\"onDragEnd\", [this._startPoint, this._endPoint]);\r\n\t\tif (this._callback) {\r\n\t\t\tthis._callback(this._startPoint, this._endPoint, this._startDate, this._endDate, tasksByTime, tasksByIndex);\r\n\t\t}\r\n\t}\r\n\r\n\tgetInBounds() {\r\n\t\treturn this._singleRow;\r\n\t}\r\n\r\n\tprivate _getTasksByTop(start: number, end:number) {\r\n\t\tconst gantt = this._gantt;\r\n\t\tlet startValue = start;\r\n\t\tlet endValue = end;\r\n\t\tif (start > end) {\r\n\t\t\tstartValue = end;\r\n\t\t\tendValue = start;\r\n\t\t}\r\n\t\tconst startIndex = this._getTaskPositionByTop(startValue).index;\r\n\t\tconst endIndex = this._getTaskPositionByTop(endValue).index;\r\n\t\tconst result = [];\r\n\t\tfor (let i = startIndex; i <= endIndex; i++) {\r\n\t\t\tconst task = gantt.getTaskByIndex(i);\r\n\t\t\tif (task) {\r\n\t\t\t\tresult.push(gantt.getTaskByIndex(i));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprivate _getTaskPositionByTop(top: number){\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst view = this._view;\r\n\t\tconst index = view.getItemIndexByTopPosition(top);\r\n\t\tconst task = gantt.getTaskByIndex(index);\r\n\t\tif(task){\r\n\t\t\tconst height = view.getItemHeight(task.id);\r\n\t\t\tconst itemTop = view.getItemTop(task.id);\r\n\t\t\treturn {\r\n\t\t\t\ttop: itemTop || 0,\r\n\t\t\t\theight: height || 0,\r\n\t\t\t\tindex\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tconst dataHeight = view.getTotalHeight();\r\n\t\t\treturn {\r\n\t\t\t\ttop: top > dataHeight ? dataHeight : 0,\r\n\t\t\t\theight: gantt.config.row_height,\r\n\t\t\t\tindex: top > dataHeight ? gantt.getTaskCount() : 0\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n}","import { EventsManager } from \"./eventsManager\";\r\nimport { ISelectedRegionConfig, SelectedRegion } from \"./selectedRegion\";\r\n\r\nexport default function(gantt: any){\r\n\tif (!gantt.ext) {\r\n\t\tgantt.ext = {};\r\n\t}\r\n\r\n\tconst defaultConfig: ISelectedRegionConfig = {\r\n\t\tclassName: \"gantt_click_drag_rect\",\r\n\t\tuseRequestAnimationFrame: true,\r\n\t\tcallback: undefined,\r\n\t\tsingleRow: false\r\n\t};\r\n\r\n\tfunction setClickDrag(){\r\n\t\tconst config: ISelectedRegionConfig = { viewPort: gantt.$task_data, ...defaultConfig };\r\n\t\tif (gantt.ext.clickDrag){\r\n\t\t\tgantt.ext.clickDrag.destructor();\r\n\t\t}\r\n\t\tgantt.ext.clickDrag = new EventsManager(gantt);\r\n\t\tconst clickDrag = gantt.config.click_drag;\r\n\t\tconfig.render = clickDrag.render || defaultConfig.render;\r\n\t\tconfig.className = clickDrag.className || defaultConfig.className;\r\n\t\tconfig.callback = clickDrag.callback || defaultConfig.callback;\r\n\t\tconfig.viewPort = clickDrag.viewPort || gantt.$task_data;\r\n\t\tconfig.useRequestAnimationFrame = clickDrag.useRequestAnimationFrame === undefined ?\r\n\t\t\tdefaultConfig.useRequestAnimationFrame : clickDrag.useRequestAnimationFrame;\r\n\r\n\t\tconfig.singleRow = clickDrag.singleRow === undefined ? defaultConfig.singleRow : clickDrag.singleRow;\r\n\t\tconst timeline = gantt.$ui.getView(\"timeline\");\r\n\t\tconst selectedRegion = new SelectedRegion(config, gantt, timeline);\r\n\t\tgantt.ext.clickDrag.attach(selectedRegion, clickDrag.useKey, clickDrag.ignore);\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onGanttReady\", () => {\r\n\t\tif (gantt.config.click_drag){\r\n\t\t\tsetClickDrag();\r\n\t\t}\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onGanttLayoutReady\", function(){\r\n\t\tif (gantt.$container && gantt.config.click_drag){\r\n\t\t\tgantt.attachEvent(\"onGanttRender\", function(){\r\n\t\t\t\tsetClickDrag();\r\n\t\t\t}, {once:true});\r\n\t\t}\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onDestroy\", () => {\r\n\t\tif (gantt.ext.clickDrag){\r\n\t\t\tgantt.ext.clickDrag.destructor();\r\n\t\t}\r\n\t});\r\n\r\n}","interface IPoint {\r\n\tx: number;\r\n\ty: number;\r\n}\r\n\r\nlet _dragInProgress: boolean = false;\r\n\r\nexport class EventsManager {\r\n\tstatic create(gantt: any) {\r\n\t\treturn new EventsManager(gantt);\r\n\t}\r\n\tstatic _isDragInProgress() {\r\n\t\treturn _dragInProgress;\r\n\t}\r\n\tprivate _mouseDown: boolean = false;\r\n\tprivate _startPoint: IPoint;\r\n\tprivate _scrollState: IPoint;\r\n\tprivate _originAutoscroll: boolean;\r\n\tprivate _domEvents: any;\r\n\tprivate _timeline: any;\r\n\tprivate _gantt: any;\r\n\tprivate _trace: IPoint[];\r\n\tprivate _originalReadonly: boolean;\r\n\r\n\tconstructor(gantt: any) {\r\n\t\tthis._gantt = gantt;\r\n\t\tthis._domEvents = gantt._createDomEventScope();\r\n\t\tthis._trace = [];\r\n\t}\r\n\r\n\tdestructor() {\r\n\t\tthis._domEvents.detachAll();\r\n\t}\r\n\r\n\tattach(timeline: any): void {\r\n\t\tthis._timeline = timeline;\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis._domEvents.attach(timeline.$task, \"mousedown\", (event) => {\r\n\t\t\tif (!gantt.config.drag_timeline) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst { useKey,ignore, enabled } = gantt.config.drag_timeline;\r\n\t\t\tif(enabled === false) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet filterTargets = \".gantt_task_line, .gantt_task_link\";\r\n\t\t\tif(ignore !== undefined) {\r\n\t\t\t\tif(ignore instanceof Array){\r\n\t\t\t\t\tfilterTargets = ignore.join(\", \");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfilterTargets = ignore;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (filterTargets) {\r\n\t\t\t\tif (gantt.utils.dom.closest(event.target, filterTargets)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (useKey && event[useKey] !== true) { return; }\r\n\r\n\t\t\tthis._startDrag(event);\r\n\t\t});\r\n\r\n\t\tthis._domEvents.attach(document, \"keydown\", (event) => {\r\n\t\t\tif (!gantt.config.drag_timeline) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst { useKey } = gantt.config.drag_timeline;\r\n\t\t\tif (useKey && event[useKey] === true) {\r\n\t\t\t\tthis._applyDndReadyStyles();\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis._domEvents.attach(document, \"keyup\", (event) => {\r\n\t\t\tif (!gantt.config.drag_timeline) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst { useKey } = gantt.config.drag_timeline;\r\n\t\t\tif (useKey && event[useKey] === false) {\r\n\t\t\t\tthis._clearDndReadyStyles();\r\n\t\t\t\tthis._stopDrag(event);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis._domEvents.attach(document, \"mouseup\", (event) => {\r\n\t\t\tthis._stopDrag(event);\r\n\t\t});\r\n\t\tthis._domEvents.attach(gantt.$root, \"mouseup\", (event) => {\r\n\t\t\tthis._stopDrag(event);\r\n\t\t});\r\n\t\tthis._domEvents.attach(document, \"mouseleave\", (event) => {\r\n\t\t\tthis._stopDrag(event);\r\n\t\t});\r\n\t\tthis._domEvents.attach(gantt.$root, \"mouseleave\", (event) => {\r\n\t\t\tthis._stopDrag(event);\r\n\t\t});\r\n\r\n\t\tthis._domEvents.attach(gantt.$root, \"mousemove\", (event) => {\r\n\t\t\tif (!gantt.config.drag_timeline) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst { useKey } = gantt.config.drag_timeline;\r\n\t\t\tif (useKey && event[useKey] !== true) { return; }\r\n\t\t\t// GS-854. If we don't have useKey for the drag_timeline extension,\r\n\t\t\t// check the click_drag to not simultaneously use both extensions\r\n\t\t\tconst clickDrag = this._gantt.ext.clickDrag;\r\n\t\t\tconst clickDragUseKey = (this._gantt.config.click_drag || {}).useKey;\r\n\t\t\tif (clickDrag && clickDragUseKey) {\r\n\t\t\t\tif (!useKey && event[clickDragUseKey]) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this._mouseDown === true) {\r\n\t\t\t\tthis._trace.push({ x: event.clientX, y: event.clientY });\r\n\t\t\t\tconst scrollPosition: IPoint = this._countNewScrollPosition({ x: event.clientX, y: event.clientY });\r\n\t\t\t\tthis._setScrollPosition(timeline, scrollPosition);\r\n\t\t\t\tthis._scrollState = scrollPosition;\r\n\t\t\t\tthis._startPoint = { x: event.clientX, y: event.clientY };\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprivate _calculateDirectionVector = () => {\r\n\t\tconst traceSteps = 10;\r\n\t\tif(this._trace.length >= traceSteps) {\r\n\t\t\tconst dots = this._trace.slice(this._trace.length - traceSteps);\r\n\r\n\t\t\tconst vectors = [];\r\n\t\t\tfor(let i = 1; i < dots.length; i++) {\r\n\t\t\t\tvectors.push({\r\n\t\t\t\t\tx: dots[i].x - dots[i - 1].x,\r\n\t\t\t\t\ty: dots[i].y - dots[i - 1].y\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tconst resultVector = {x:0, y:0};\r\n\r\n\t\t\tvectors.forEach((vector) => {\r\n\t\t\t\tresultVector.x += vector.x;\r\n\t\t\t\tresultVector.y += vector.y;\r\n\t\t\t});\r\n\r\n\t\t\tconst magnitude = Math.sqrt(resultVector.x*resultVector.x + resultVector.y*resultVector.y);\r\n\t\t\tconst angleDegrees = Math.atan2(Math.abs(resultVector.y), Math.abs(resultVector.x)) * 180 / Math.PI;\r\n\r\n\t\t\treturn {\r\n\t\t\t\tmagnitude,\r\n\t\t\t\tangleDegrees\r\n\t\t\t};\r\n\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n\r\n\tprivate _applyDndReadyStyles = (): void => {\r\n\t\tthis._timeline.$task.classList.add(\"gantt_timeline_move_available\");\r\n\t};\r\n\r\n\tprivate _clearDndReadyStyles = (): void => {\r\n\t\tthis._timeline.$task.classList.remove(\"gantt_timeline_move_available\");\r\n\t};\r\n\r\n\tprivate _getScrollPosition = (timeline: any): IPoint => {\r\n\t\tconst gantt = this._gantt;\r\n\t\treturn {\r\n\t\t\tx: gantt.$ui.getView(timeline.$config.scrollX).getScrollState().position,\r\n\t\t\ty: gantt.$ui.getView(timeline.$config.scrollY).getScrollState().position\r\n\t\t};\r\n\t};\r\n\tprivate _countNewScrollPosition = (coords: IPoint): IPoint => {\r\n\t\tconst vector = this._calculateDirectionVector();\r\n\t\tlet shiftX = this._startPoint.x - coords.x;\r\n\t\tlet shiftY = this._startPoint.y - coords.y;\r\n\t\tif(vector){\r\n\t\t\tif(vector.angleDegrees < 15){\r\n\t\t\t\tshiftY = 0;\r\n\t\t\t} else if(vector.angleDegrees > 75){\r\n\t\t\t\tshiftX = 0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst result = {\r\n\t\t\tx: this._scrollState.x + shiftX,\r\n\t\t\ty: this._scrollState.y + shiftY\r\n\t\t};\r\n\t\treturn result;\r\n\t};\r\n\tprivate _setScrollPosition = (timeline: any, coords: IPoint): void => {\r\n\t\tconst gantt = this._gantt;\r\n\t\trequestAnimationFrame(() => {\r\n\t\t\tgantt.scrollLayoutCell(timeline.$id, coords.x, coords.y);\r\n\t\t});\r\n\t};\r\n\tprivate _stopDrag = (event: Event): void => {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis._trace = [];\r\n\t\tgantt.$root.classList.remove(\"gantt_noselect\");\r\n\r\n\t\t// We need to set the readonly mode because with the key modifiers, \r\n\t\t// users may expect to start dragging the timeline on the task and link coordinates\r\n\t\tif(this._originalReadonly !== undefined){\r\n\t\t\tgantt.config.readonly = this._originalReadonly;\r\n\t\t\tif(this._mouseDown && gantt.config.drag_timeline && gantt.config.drag_timeline.render){\r\n\t\t\t\tgantt.render();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(this._originAutoscroll !== undefined){\r\n\t\t\tgantt.config.autoscroll = this._originAutoscroll;\r\n\t\t}\r\n\r\n\t\tif(gantt.config.drag_timeline){\r\n\t\t\tconst { useKey } = gantt.config.drag_timeline;\r\n\t\t\tif (useKey && event[useKey] !== true) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._mouseDown = false;\r\n\t\t_dragInProgress = false;\r\n\t};\r\n\r\n\tprivate _startDrag = (event: any) : void => {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis._originAutoscroll = gantt.config.autoscroll;\r\n\t\tgantt.config.autoscroll = false;\r\n\t\t_dragInProgress = true;\r\n\r\n\t\tgantt.$root.classList.add(\"gantt_noselect\");\r\n\t\tthis._originalReadonly = gantt.config.readonly;\r\n\t\tgantt.config.readonly = true;\r\n\r\n\t\tif(gantt.config.drag_timeline && gantt.config.drag_timeline.render){\r\n\t\t\tgantt.render();\r\n\t\t}\r\n\r\n\t\tthis._trace = [];\r\n\t\tthis._mouseDown = true;\r\n\t\tconst { x, y } = this._getScrollPosition(this._timeline);\r\n\t\tthis._scrollState = { x, y };\r\n\t\tthis._startPoint = { x: event.clientX, y: event.clientY };\r\n\t\tthis._trace.push(this._startPoint);\r\n\t};\r\n}","import { EventsManager } from \"./eventsManager\";\r\nexport default function(gantt: any){\r\n\tif (!gantt.ext){\r\n\t\tgantt.ext = {};\r\n\t}\r\n\r\n\tgantt.ext.dragTimeline = {\r\n\t\tcreate: () => EventsManager.create(gantt),\r\n\t\t_isDragInProgress: () => EventsManager._isDragInProgress\r\n\t};\r\n\r\n\tgantt.config.drag_timeline = {\r\n\t\tenabled: true,\r\n\t\trender: false\r\n\t};\r\n}","/* eslint-disable */\r\n\r\nexport default function(gantt: any) {\r\n\r\n\tgantt.ext = gantt.ext || {};\r\n\r\n\tgantt.ext.export_api = gantt.ext.export_api || {\r\n\r\n\t\t_apiUrl: \"https://export.dhtmlx.com/gantt\",\r\n\r\n\t\t_preparePDFConfigRaw(config, type){\r\n\t\t\tlet previousDateRage:any = null;\r\n\t\t\tif (config.start && config.end){\r\n\t\t\t\tpreviousDateRage = {\r\n\t\t\t\t\tstart_date: gantt.config.start_date,\r\n\t\t\t\t\tend_date: gantt.config.end_date,\r\n\t\t\t\t};\r\n\t\t\t\tgantt.config.start_date = gantt.date.str_to_date(gantt.config.date_format)(config.start);\r\n\t\t\t\tgantt.config.end_date = gantt.date.str_to_date(gantt.config.date_format)(config.end);\r\n\t\t\t}\r\n\r\n\t\t\tconfig = gantt.mixin(config, {\r\n\t\t\t\tname: \"gantt.\" + type, data: gantt.ext.export_api._serializeHtml()\r\n\t\t\t});\r\n\r\n\t\t\tif (previousDateRage){\r\n\t\t\t\tgantt.config.start_date = previousDateRage.start_date;\r\n\t\t\t\tgantt.config.end_date = previousDateRage.end_date;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_prepareConfigPDF(config, type){\r\n\t\t\tconfig = gantt.mixin((config || {}), {\r\n\t\t\t\tname: \"gantt.\" + type,\r\n\t\t\t\tdata: gantt.ext.export_api._serializeAll(),\r\n\t\t\t\tconfig: gantt.config\r\n\t\t\t});\r\n\t\t\tgantt.ext.export_api._fixColumns(config.config.columns);\r\n\t\t\treturn config;\r\n\t\t},\r\n\r\n\t\t_pdfExportRouter(config, type){\r\n\t\t\tif (config && config.raw) {\r\n\t\t\t\tgantt.ext.export_api._preparePDFConfigRaw(config, type);\r\n\t\t\t} else {\r\n\t\t\t\tconfig = gantt.ext.export_api._prepareConfigPDF(config, type);\r\n\t\t\t}\r\n\t\t\tconfig.version = gantt.version;\r\n\t\t\tgantt.ext.export_api._sendToExport(config, type);\r\n\t\t},\r\n\r\n\t\texportToPDF(config) {\r\n\t\t\tgantt.ext.export_api._pdfExportRouter(config, \"pdf\");\r\n\t\t},\r\n\r\n\t\texportToPNG(config) {\r\n\t\t\tgantt.ext.export_api._pdfExportRouter(config, \"png\");\r\n\t\t},\r\n\r\n\r\n\t\texportToICal(config) {\r\n\t\t\tconfig = gantt.mixin((config || {}), {\r\n\t\t\t\tname: \"gantt.ical\",\r\n\t\t\t\tdata: gantt.ext.export_api._serializePlain().data,\r\n\t\t\t\tversion: gantt.version\r\n\t\t\t});\r\n\t\t\tgantt.ext.export_api._sendToExport(config, \"ical\");\r\n\t\t},\r\n\r\n\t\texportToExcel(config) {\r\n\t\t\tconfig = config || {};\r\n\r\n\t\t\tlet tasks;\r\n\t\t\tlet dates;\r\n\t\t\tlet state;\r\n\t\t\tlet scroll;\r\n\t\t\t// GS-2124, we need to get all task nodes to correctly obtain the colors\r\n\t\t\tconst smartRendering = gantt.config.smart_rendering;\r\n\t\t\tif (config.visual === \"base-colors\"){\r\n\t\t\t\tgantt.config.smart_rendering = false;\r\n\t\t\t}\r\n\r\n\t\t\tif (config.start || config.end) {\r\n\t\t\t\tstate = gantt.getState();\r\n\t\t\t\tdates = [gantt.config.start_date, gantt.config.end_date];\r\n\t\t\t\tscroll = gantt.getScrollState();\r\n\t\t\t\tconst convert = gantt.date.str_to_date(gantt.config.date_format);\r\n\t\t\t\ttasks = gantt.eachTask;\r\n\r\n\t\t\t\tif (config.start){\r\n\t\t\t\t\tgantt.config.start_date = convert(config.start);\r\n\t\t\t\t}\r\n\t\t\t\tif (config.end){\r\n\t\t\t\t\tgantt.config.end_date = convert(config.end);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgantt.render();\r\n\t\t\t\tgantt.config.smart_rendering = smartRendering;\r\n\r\n\t\t\t\tgantt.eachTask = gantt.ext.export_api._eachTaskTimed(gantt.config.start_date, gantt.config.end_date);\r\n\t\t\t} else if (config.visual === \"base-colors\"){\r\n\t\t\t\tgantt.render();\r\n\t\t\t\tgantt.config.smart_rendering = smartRendering;\r\n\t\t\t}\r\n\r\n\t\t\tgantt._no_progress_colors = config.visual === \"base-colors\";\r\n\r\n\t\t\tconfig = gantt.mixin(config, {\r\n\t\t\t\tname: \"gantt.xlsx\",\r\n\t\t\t\ttitle: \"Tasks\",\r\n\t\t\t\tdata: gantt.ext.export_api._serializeTimeline(config).data,\r\n\t\t\t\tcolumns: gantt.ext.export_api._serializeGrid({ rawDates: true }),\r\n\t\t\t\tversion: gantt.version\r\n\t\t\t});\r\n\r\n\t\t\tif (config.visual){\r\n\t\t\t\tconfig.scales = gantt.ext.export_api._serializeScales(config);\r\n\t\t\t}\r\n\r\n\t\t\tgantt.ext.export_api._sendToExport(config, \"excel\");\r\n\r\n\t\t\tif (config.start || config.end) {\r\n\t\t\t\tgantt.config.start_date = state.min_date;\r\n\t\t\t\tgantt.config.end_date = state.max_date;\r\n\t\t\t\tgantt.eachTask = tasks;\r\n\r\n\t\t\t\tgantt.render();\r\n\t\t\t\tgantt.scrollTo(scroll.x, scroll.y);\r\n\r\n\t\t\t\tgantt.config.start_date = dates[0];\r\n\t\t\t\tgantt.config.end_date = dates[1];\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\texportToJSON(config) {\r\n\t\t\tconfig = gantt.mixin((config || {}), {\r\n\t\t\t\tname: \"gantt.json\",\r\n\t\t\t\tdata: gantt.ext.export_api._serializeAll(),\r\n\t\t\t\tconfig: gantt.config,\r\n\t\t\t\tcolumns: gantt.ext.export_api._serializeGrid(),\r\n\t\t\t\tworktime: gantt.ext.export_api._getWorktimeSettings(),\r\n\t\t\t\tversion: gantt.version\r\n\t\t\t});\r\n\t\t\tgantt.ext.export_api._sendToExport(config, \"json\");\r\n\t\t},\r\n\r\n\r\n\t\timportFromExcel(config) {\r\n\t\t\ttry {\r\n\t\t\t\tconst formData = config.data;\r\n\t\t\t\tif (formData instanceof File) {\r\n\t\t\t\t\tconst data = new FormData();\r\n\t\t\t\t\tdata.append(\"file\", formData);\r\n\t\t\t\t\tconfig.data = data;\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {}\r\n\t\t\tgantt.ext.export_api._sendImportAjaxExcel(config);\r\n\t\t},\r\n\r\n\t\timportFromMSProject(config) {\r\n\t\t\tconst formData = config.data;\r\n\t\t\ttry {\r\n\t\t\t\tif (formData  instanceof File) {\r\n\t\t\t\t\tconst data = new FormData();\r\n\t\t\t\t\tdata.append(\"file\", formData);\r\n\t\t\t\t\tconfig.data = data;\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {}\r\n\t\t\tgantt.ext.export_api._sendImportAjaxMSP(config);\r\n\t\t},\r\n\r\n\t\timportFromPrimaveraP6(config) {\r\n\t\t\tconfig.type = \"primaveraP6-parse\";\r\n\t\t\treturn gantt.importFromMSProject(config);\r\n\t\t},\r\n\r\n\t\texportToMSProject(config) {\r\n\t\t\tconfig = config || {};\r\n\t\t\tconfig.skip_circular_links = config.skip_circular_links === undefined ? true : !!config.skip_circular_links;\r\n\r\n\t\t\tconst oldXmlFormat = gantt.templates.xml_format;\r\n\t\t\tconst oldFormatDate = gantt.templates.format_date;\r\n\t\t\tconst oldXmlDate = gantt.config.xml_date;\r\n\t\t\tconst oldDateFormat = gantt.config.date_format;\r\n\r\n\t\t\tconst exportServiceDateFormat = \"%d-%m-%Y %H:%i:%s\";\r\n\r\n\t\t\tgantt.config.xml_date = exportServiceDateFormat;\r\n\t\t\tgantt.config.date_format = exportServiceDateFormat;\r\n\t\t\tgantt.templates.xml_format = gantt.date.date_to_str(exportServiceDateFormat);\r\n\t\t\tgantt.templates.format_date = gantt.date.date_to_str(exportServiceDateFormat);\r\n\t\t\tconst data = gantt.ext.export_api._serializeAll();\r\n\r\n\t\t\tgantt.ext.export_api._customProjectProperties(data, config);\r\n\r\n\t\t\tgantt.ext.export_api._customTaskProperties(data, config);\r\n\r\n\t\t\tif (config.skip_circular_links) {\r\n\t\t\t\tgantt.ext.export_api._clearRecLinks(data);\r\n\t\t\t}\r\n\r\n\t\t\tconfig = gantt.ext.export_api._exportConfig(data, config);\r\n\r\n\t\t\tgantt.ext.export_api._sendToExport(config, config.type || \"msproject\");\r\n\t\t\tgantt.config.xml_date = oldXmlDate;\r\n\t\t\tgantt.config.date_format = oldDateFormat;\r\n\t\t\tgantt.templates.xml_format = oldXmlFormat;\r\n\t\t\tgantt.templates.format_date = oldFormatDate;\r\n\r\n\t\t\tgantt.config.$custom_data = null;\r\n\t\t\tgantt.config.custom = null;\r\n\t\t},\r\n\r\n\t\texportToPrimaveraP6(config) {\r\n\t\t\tconfig = config || {};\r\n\t\t\tconfig.type = \"primaveraP6\";\r\n\t\t\treturn gantt.exportToMSProject(config);\r\n\t\t},\r\n\r\n\t\t_fixColumns(columns) {\r\n\t\t\tfor (let i = 0; i < columns.length; i++) {\r\n\t\t\t\tcolumns[i].label = columns[i].label || gantt.locale.labels[\"column_\" + columns[i].name];\r\n\t\t\t\tif (typeof columns[i].width === \"string\") {\r\n\t\t\t\t\tcolumns[i].width = columns[i].width * 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_xdr(url, pack, cb) {\r\n\t\t\tgantt.ajax.post(url, pack, cb);\r\n\t\t},\r\n\r\n\t\t_markColumns(base) {\r\n\t\t\tconst columns = base.config.columns;\r\n\t\t\tif (columns){\r\n\t\t\t\tfor (let i = 0; i < columns.length; i++) {\r\n\t\t\t\t\tif (columns[i].template){\r\n\t\t\t\t\t\tcolumns[i].$template = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\t_sendImportAjaxExcel(config) {\r\n\t\t\tconst url = config.server || gantt.ext.export_api._apiUrl;\r\n\t\t\tconst store = config.store || 0;\r\n\t\t\tconst formData = config.data;\r\n\t\t\tconst callback = config.callback;\r\n\r\n\t\t\tformData.append(\"type\", \"excel-parse\");\r\n\t\t\tformData.append(\"data\", JSON.stringify({\r\n\t\t\t\tsheet: config.sheet || 0\r\n\t\t\t}));\r\n\r\n\t\t\tif (store){\r\n\t\t\t\tformData.append(\"store\", store);\r\n\t\t\t}\r\n\r\n\t\t\tconst xhr = new XMLHttpRequest();\r\n\t\t\txhr.onreadystatechange = function(e) {\r\n\t\t\t\tif (xhr.readyState === 4 && xhr.status === 0) {// network error\r\n\t\t\t\t\tif (callback) {\r\n\t\t\t\t\t\tcallback(null);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\txhr.onload = function() {\r\n\t\t\t\tconst fail = xhr.status > 400;\r\n\t\t\t\tlet info = null;\r\n\r\n\t\t\t\tif (!fail) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tinfo = JSON.parse(xhr.responseText);\r\n\t\t\t\t\t} catch (e) { }\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (callback) {\r\n\t\t\t\t\tcallback(info);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\txhr.open(\"POST\", url, true);\r\n\t\t\txhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\r\n\t\t\txhr.send(formData);\r\n\t\t},\r\n\r\n\r\n\t\t_ajaxToExport(data, type, callback) {\r\n\t\t\tdelete data.callback;\r\n\r\n\t\t\tconst url = data.server || gantt.ext.export_api._apiUrl;\r\n\t\t\tconst pack = \"type=\" + type + \"&store=1&data=\" + encodeURIComponent(JSON.stringify(data));\r\n\r\n\t\t\tconst cb = function(loader) {\r\n\t\t\t\tconst xdoc = loader.xmlDoc || loader;\r\n\t\t\t\tconst fail = xdoc.status > 400;\r\n\t\t\t\tlet info = null;\r\n\r\n\t\t\t\tif (!fail) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tinfo = JSON.parse(xdoc.responseText);\r\n\t\t\t\t\t} catch (e) { }\r\n\t\t\t\t}\r\n\t\t\t\tcallback(info);\r\n\t\t\t};\r\n\r\n\t\t\tgantt.ext.export_api._xdr(url, pack, cb);\r\n\t\t},\r\n\t\t_serializableGanttConfig(config) {\r\n\t\t\tconst result = gantt.mixin({}, config);\r\n\r\n\t\t\tif (result.columns) {\r\n\t\t\t\tresult.columns = result.columns.map(function(col) {\r\n\t\t\t\t\tconst copy = gantt.mixin({}, col);\r\n\t\t\t\t\tdelete copy.editor;\r\n\t\t\t\t\treturn copy;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tdelete result.editor_types;\r\n\t\t\treturn result;\r\n\t\t},\r\n\r\n\t\t_sendToExport(data, type) {\r\n\t\t\tconst convert = gantt.date.date_to_str(gantt.config.date_format || gantt.config.xml_date);\r\n\t\t\tif(!data.skin){\r\n\t\t\t\tdata.skin = gantt.skin;\r\n\t\t\t}\r\n\t\t\tif (data.config) {\r\n\t\t\t\tdata.config = gantt.copy(gantt.ext.export_api._serializableGanttConfig(data.config));\r\n\t\t\t\tgantt.ext.export_api._markColumns(data, type);\r\n\r\n\t\t\t\tif (data.config.start_date && data.config.end_date) {\r\n\t\t\t\t\tif (data.config.start_date instanceof Date) {\r\n\t\t\t\t\t\tdata.config.start_date = convert(data.config.start_date);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (data.config.end_date instanceof Date) {\r\n\t\t\t\t\t\tdata.config.end_date = convert(data.config.end_date);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (data.callback) {\r\n\t\t\t\treturn gantt.ext.export_api._ajaxToExport(data, type, data.callback);\r\n\t\t\t}\r\n\r\n\t\t\tconst form = gantt.ext.export_api._createHiddenForm();\r\n\t\t\tform.firstChild.action = data.server || gantt.ext.export_api._apiUrl;\r\n\t\t\tform.firstChild.childNodes[0].value = JSON.stringify(data);\r\n\t\t\tform.firstChild.childNodes[1].value = type;\r\n\t\t\tform.firstChild.submit();\r\n\t\t},\r\n\r\n\t\t_createHiddenForm() {\r\n\t\t\tif (!gantt.ext.export_api._hidden_export_form) {\r\n\t\t\t\tconst t = gantt.ext.export_api._hidden_export_form = document.createElement(\"div\");\r\n\t\t\t\tt.style.display = \"none\";\r\n\t\t\t\tt.innerHTML = \"<form method='POST' target='_blank'><textarea name='data' style='width:0px; height:0px;' readonly='true'></textarea><input type='hidden' name='type' value=''></form>\";\r\n\t\t\t\tdocument.body.appendChild(t);\r\n\t\t\t}\r\n\t\t\treturn gantt.ext.export_api._hidden_export_form;\r\n\t\t},\r\n\r\n\r\n\t\t_copyObjectBase(obj) {\r\n\t\t\tconst copy = {\r\n\t\t\t\tstart_date: undefined,\r\n\t\t\t\tend_date: undefined,\r\n\t\t\t\tconstraint_date: undefined,\r\n\t\t\t\tdeadline: undefined\r\n\t\t\t};\r\n\t\t\tfor (const key in obj) {\r\n\t\t\t\tif (key.charAt(0) === \"$\" || key === \"baselines\"){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tcopy[key] = obj[key];\r\n\t\t\t}\r\n\t\t\tconst formatDate = gantt.templates.xml_format || gantt.templates.format_date;\r\n\r\n\t\t\tcopy.start_date = formatDate(copy.start_date);\r\n\t\t\tif (copy.end_date){\r\n\t\t\t\tcopy.end_date = formatDate(copy.end_date);\r\n\t\t\t}\r\n\t\t\tif (copy.constraint_date){\r\n\t\t\t\tcopy.constraint_date = formatDate(copy.constraint_date);\r\n\t\t\t}\r\n\t\t\tif (copy.deadline){\r\n\t\t\t\tcopy.deadline = formatDate(copy.deadline);\r\n\t\t\t}\r\n\r\n\t\t\treturn copy;\r\n\t\t},\r\n\r\n\r\n\t\t_color_box: null,\r\n\t\t_color_hash: {},\r\n\r\n\t\t_getStyles(css) {\r\n\t\t\tif (!gantt.ext.export_api._color_box) {\r\n\t\t\t\tgantt.ext.export_api._color_box = document.createElement(\"DIV\");\r\n\t\t\t\tgantt.ext.export_api._color_box.style.cssText = \"position:absolute; display:none;\";\r\n\t\t\t\tdocument.body.appendChild(gantt.ext.export_api._color_box);\r\n\t\t\t}\r\n\t\t\tif (gantt.ext.export_api._color_hash[css]){\r\n\t\t\t\treturn gantt.ext.export_api._color_hash[css];\r\n\t\t\t}\r\n\r\n\t\t\tgantt.ext.export_api._color_box.className = css;\r\n\t\t\tconst color = gantt.ext.export_api._getColor(gantt.ext.export_api._color_box, \"color\");\r\n\t\t\tconst backgroundColor = gantt.ext.export_api._getColor(gantt.ext.export_api._color_box, \"backgroundColor\");\r\n\t\t\treturn (gantt.ext.export_api._color_hash[css] = color + \";\" + backgroundColor);\r\n\t\t},\r\n\r\n\r\n\t\t_getMinutesWorktimeSettings(parsedRanges) {\r\n\t\t\tconst minutes:any = [];\r\n\t\t\tparsedRanges.forEach(function(range) {\r\n\t\t\t\tminutes.push(range.startMinute);\r\n\t\t\t\tminutes.push(range.endMinute);\r\n\t\t\t});\r\n\t\t\treturn minutes;\r\n\t\t},\r\n\r\n\t\t_getWorktimeSettings() {\r\n\r\n\t\t\tconst defaultWorkTimes = {\r\n\t\t\t\thours: [0, 24],\r\n\t\t\t\tminutes: null,\r\n\t\t\t\tdates: { 0: true, 1: true, 2: true, 3: true, 4: true, 5: true, 6: true }\r\n\t\t\t};\r\n\r\n\t\t\tlet time;\r\n\t\t\tif (!gantt.config.work_time) {\r\n\t\t\t\ttime = defaultWorkTimes;\r\n\t\t\t} else {\r\n\t\t\t\tconst wTime = gantt._working_time_helper;\r\n\t\t\t\tif (wTime && wTime.get_calendar) {\r\n\t\t\t\t\ttime = wTime.get_calendar();\r\n\t\t\t\t} else if (wTime) {\r\n\t\t\t\t\ttime = {\r\n\t\t\t\t\t\thours: wTime.hours,\r\n\t\t\t\t\t\tminutes: null,\r\n\t\t\t\t\t\tdates: wTime.dates\r\n\t\t\t\t\t};\r\n\t\t\t\t} else if (gantt.config.worktimes && gantt.config.worktimes.global) {\r\n\t\t\t\t\tconst settings = gantt.config.worktimes.global;\r\n\r\n\t\t\t\t\tif (settings.parsed) {\r\n\t\t\t\t\t\tconst minutes = gantt.ext.export_api._getMinutesWorktimeSettings(settings.parsed.hours);\r\n\t\t\t\t\t\ttime = {\r\n\t\t\t\t\t\t\thours: null,\r\n\t\t\t\t\t\t\tminutes,\r\n\t\t\t\t\t\t\tdates: {}\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tfor (const i in settings.parsed.dates) {\r\n\t\t\t\t\t\t\tif (Array.isArray(settings.parsed.dates[i])) {\r\n\t\t\t\t\t\t\t\ttime.dates[i] = gantt.ext.export_api._getMinutesWorktimeSettings(settings.parsed.dates[i]);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttime.dates[i] = settings.parsed.dates[i];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttime = {\r\n\t\t\t\t\t\t\thours: settings.hours,\r\n\t\t\t\t\t\t\tminutes: null,\r\n\t\t\t\t\t\t\tdates: settings.dates\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttime = defaultWorkTimes;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn time;\r\n\t\t},\r\n\r\n\r\n\t\t_eachTaskTimed(start, end) {\r\n\t\t\treturn function(code, parent, master) {\r\n\t\t\t\tparent = parent || gantt.config.root_id;\r\n\t\t\t\tmaster = master || gantt;\r\n\r\n\t\t\t\tconst branch = gantt.getChildren(parent);\r\n\t\t\t\tif (branch){\r\n\t\t\t\t\tfor (let i = 0; i < branch.length; i++) {\r\n\t\t\t\t\t\tconst item = gantt._pull[branch[i]];\r\n\t\t\t\t\t\tif ((!start || item.end_date > start) && (!end || item.start_date < end)){\r\n\t\t\t\t\t\t\tcode.call(master, item);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (gantt.hasChild(item.id)){\r\n\t\t\t\t\t\t\tgantt.eachTask(code, item.id, master);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\r\n\r\n\t\t// patch broken json serialization in gantt 2.1\r\n\t\t_originalCopyObject: gantt.json._copyObject,\r\n\r\n\r\n\t\t_copyObjectPlain(obj) {\r\n\t\t\tconst text = gantt.templates.task_text(obj.start_date, obj.end_date, obj);\r\n\r\n\t\t\tconst copy = gantt.ext.export_api._copyObjectBase(obj);\r\n\t\t\tcopy.text = text || copy.text;\r\n\r\n\t\t\treturn copy;\r\n\t\t},\r\n\r\n\t\t_getColor(node, style) {\r\n\t\t\tconst value = node.currentStyle ? node.currentStyle[style] : getComputedStyle(node, null)[style];\r\n\t\t\tconst rgb = value.replace(/\\s/g, \"\").match(/^rgba?\\((\\d+),(\\d+),(\\d+)/i);\r\n\t\t\treturn ((rgb && rgb.length === 4) ?\r\n\t\t\t\t(\"0\" + parseInt(rgb[1], 10).toString(16)).slice(-2) +\r\n\t\t\t\t(\"0\" + parseInt(rgb[2], 10).toString(16)).slice(-2) +\r\n\t\t\t\t(\"0\" + parseInt(rgb[3], 10).toString(16)).slice(-2) : value).replace(\"#\", \"\");\r\n\t\t},\r\n\r\n\r\n\t\t// excel serialization\r\n\t\t_copyObjectTable(obj) {\r\n\t\t\t// Excel interprets UTC time as local time in every timezone, send local time instead of actual UTC time.\r\n\t\t\t// https://github.com/SheetJS/js-xlsx/issues/126#issuecomment-60531614\r\n\t\t\tconst toISOstring = gantt.date.date_to_str(\"%Y-%m-%dT%H:%i:%s.000Z\");\r\n\r\n\t\t\tconst copy = gantt.ext.export_api._copyObjectColumns(obj, gantt.ext.export_api._copyObjectPlain(obj));\r\n\t\t\tif (copy.start_date){\r\n\t\t\t\tcopy.start_date = toISOstring(obj.start_date);\r\n\t\t\t}\r\n\t\t\tif (copy.end_date){\r\n\t\t\t\tcopy.end_date = toISOstring(obj.end_date);\r\n\t\t\t}\r\n\r\n\t\t\t// private gantt._day_index_by_date was replaced by public gantt.columnIndexByDate in gantt 5.0\r\n\t\t\tconst getDayIndex = gantt._day_index_by_date ? gantt._day_index_by_date : gantt.columnIndexByDate;\r\n\r\n\t\t\tcopy.$start = getDayIndex.call(gantt, obj.start_date);\r\n\t\t\tcopy.$end = getDayIndex.call(gantt, obj.end_date);\r\n\r\n\t\t\t// GS-2100. Correct bar position considering hidden cells\r\n\t\t\tlet hiddenCells = 0;\r\n\t\t\tconst scaleCellsWidth = gantt.getScale().width;\r\n\t\t\tif (scaleCellsWidth.indexOf(0) > -1) {\r\n\t\t\t\tlet i = 0;\r\n\t\t\t\tfor (i; i < copy.$start; i++) {\r\n\t\t\t\t\tif (!scaleCellsWidth[i]) {\r\n\t\t\t\t\t\thiddenCells++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcopy.$start -= hiddenCells;\r\n\r\n\t\t\t\tfor (i; i < copy.$end; i++) {\r\n\t\t\t\t\tif (!scaleCellsWidth[i]) {\r\n\t\t\t\t\t\thiddenCells++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcopy.$end -= hiddenCells;\r\n\t\t\t}\r\n\r\n\t\t\tcopy.$level = obj.$level;\r\n\t\t\tcopy.$type = obj.$rendered_type;\r\n\r\n\t\t\tconst tmps = gantt.templates;\r\n\t\t\tcopy.$text = tmps.task_text(obj.start, obj.end_date, obj);\r\n\t\t\tcopy.$left = tmps.leftside_text ? tmps.leftside_text(obj.start, obj.end_date, obj) : \"\";\r\n\t\t\tcopy.$right = tmps.rightside_text ? tmps.rightside_text(obj.start, obj.end_date, obj) : \"\";\r\n\r\n\t\t\treturn copy;\r\n\t\t},\r\n\r\n\t\t_copyObjectColors(obj) {\r\n\t\t\tconst copy = gantt.ext.export_api._copyObjectTable(obj);\r\n\r\n\t\t\tconst node = gantt.getTaskNode(obj.id);\r\n\t\t\tif (node && node.firstChild) {\r\n\t\t\t\tlet color = gantt.ext.export_api._getColor((gantt._no_progress_colors ? node : node.firstChild), \"backgroundColor\");\r\n\t\t\t\tif (color === \"363636\"){\r\n\t\t\t\t\tcolor = gantt.ext.export_api._getColor(node, \"backgroundColor\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcopy.$color = color;\r\n\t\t\t} else if (obj.color){\r\n\t\t\t\tcopy.$color = obj.color;\r\n\t\t\t}\r\n\r\n\t\t\treturn copy;\r\n\t\t},\r\n\r\n\t\t_copyObjectColumns(obj, copy) {\r\n\t\t\tfor (let i = 0; i < gantt.config.columns.length; i++) {\r\n\t\t\t\tconst ct = gantt.config.columns[i].template;\r\n\t\t\t\tif (ct) {\r\n\t\t\t\t\tlet val = ct(obj);\r\n\t\t\t\t\tif (val instanceof Date){\r\n\t\t\t\t\t\tval = gantt.templates.date_grid(val, obj);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcopy[\"_\" + i] = val;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn copy;\r\n\t\t},\r\n\r\n\t\t_copyObjectAll(obj) {\r\n\t\t\tconst copy = gantt.ext.export_api._copyObjectBase(obj);\r\n\r\n\t\t\tconst templates = [\r\n\t\t\t\t\"leftside_text\",\r\n\t\t\t\t\"rightside_text\",\r\n\t\t\t\t\"task_text\",\r\n\t\t\t\t\"progress_text\",\r\n\t\t\t\t\"task_class\"\r\n\t\t\t];\r\n\r\n\t\t\t// serialize all text templates\r\n\t\t\tfor (let i = 0; i < templates.length; i++) {\r\n\t\t\t\tconst template = gantt.templates[templates[i]];\r\n\t\t\t\tif (template){\r\n\t\t\t\t\tcopy[\"$\" + i] = template(obj.start_date, obj.end_date, obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tgantt.ext.export_api._copyObjectColumns(obj, copy);\r\n\t\t\tcopy.open = obj.$open;\r\n\t\t\treturn copy;\r\n\t\t},\r\n\r\n\r\n\t\t_serializeHtml() {\r\n\t\t\tconst smartScales = gantt.config.smart_scales;\r\n\t\t\tconst smartRendering = gantt.config.smart_rendering;\r\n\t\t\tif (smartScales || smartRendering) {\r\n\t\t\t\tgantt.config.smart_rendering = false;\r\n\t\t\t\tgantt.config.smart_scales = false;\r\n\t\t\t\tgantt.render();\r\n\t\t\t}\r\n\r\n\t\t\tconst html = gantt.$container.parentNode.innerHTML;\r\n\r\n\t\t\tif (smartScales || smartRendering) {\r\n\t\t\t\tgantt.config.smart_scales = smartScales;\r\n\t\t\t\tgantt.config.smart_rendering = smartRendering;\r\n\t\t\t\tgantt.render();\r\n\t\t\t}\r\n\r\n\t\t\treturn html;\r\n\t\t},\r\n\r\n\t\t_serializeAll() {\r\n\t\t\tgantt.json._copyObject = gantt.ext.export_api._copyObjectAll;\r\n\t\t\tconst data = gantt.ext.export_api._exportSerialize();\r\n\t\t\tgantt.json._copyObject = gantt.ext.export_api._originalCopyObject;\r\n\t\t\treturn data;\r\n\t\t},\r\n\r\n\t\t_serializePlain() {\r\n\t\t\tconst oldXmlFormat = gantt.templates.xml_format;\r\n\t\t\tconst oldFormatDate = gantt.templates.format_date;\r\n\t\t\tgantt.templates.xml_format = gantt.date.date_to_str(\"%Y%m%dT%H%i%s\", true);\r\n\t\t\tgantt.templates.format_date = gantt.date.date_to_str(\"%Y%m%dT%H%i%s\", true);\r\n\t\t\tgantt.json._copyObject = gantt.ext.export_api._copyObjectPlain;\r\n\r\n\t\t\tconst data = gantt.ext.export_api._exportSerialize();\r\n\r\n\t\t\tgantt.templates.xml_format = oldXmlFormat;\r\n\t\t\tgantt.templates.format_date = oldFormatDate;\r\n\t\t\tgantt.json._copyObject = gantt.ext.export_api._originalCopyObject;\r\n\r\n\t\t\tdelete data.links;\r\n\t\t\treturn data;\r\n\t\t},\r\n\r\n\t\t_getRaw() {\r\n\t\t\t// support Gantt < 5.0\r\n\t\t\tif (gantt._scale_helpers) {\r\n\t\t\t\tconst scales = gantt._get_scales();\r\n\t\t\t\tconst\tminWidth = gantt.config.min_column_width;\r\n\t\t\t\tconst\tautosizeMinWidth = gantt._get_resize_options().x ? Math.max(gantt.config.autosize_min_width, 0) : gantt.config.$task.offsetWidth;\r\n\t\t\t\tconst\theight = gantt.config.config.scale_height - 1;\r\n\t\t\t\treturn gantt._scale_helpers.prepareConfigs(scales, minWidth, autosizeMinWidth, height);\r\n\t\t\t} else { // Gantt >= 5.0\r\n\t\t\t\tconst timeline = gantt.$ui.getView(\"timeline\");\r\n\t\t\t\tif (timeline) {\r\n\t\t\t\t\tlet availWidth = timeline.$config.width;\r\n\t\t\t\t\tif (gantt.config.autosize === \"x\" || gantt.config.autosize === \"xy\") {\r\n\t\t\t\t\t\tavailWidth = Math.max(gantt.config.autosize_min_width, 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst state = gantt.getState();\r\n\t\t\t\t\tconst\tscales = timeline._getScales();\r\n\t\t\t\t\tconst\tminWidth = gantt.config.min_column_width;\r\n\t\t\t\t\tconst\theight = gantt.config.scale_height - 1;\r\n\t\t\t\t\tconst\trtl = gantt.config.rtl;\r\n\t\t\t\t\treturn timeline.$scaleHelper.prepareConfigs(scales, minWidth, availWidth, height, state.min_date, state.max_date, rtl);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_serializeTimeline(config) {\r\n\t\t\tgantt.json._copyObject = config.visual ? gantt.ext.export_api._copyObjectColors : gantt.ext.export_api._copyObjectTable;\r\n\t\t\tconst data = gantt.ext.export_api._exportSerialize();\r\n\t\t\tgantt.json._copyObject = gantt.ext.export_api._originalCopyObject;\r\n\r\n\t\t\tdelete data.links;\r\n\r\n\t\t\tif (config.cellColors) {\r\n\t\t\t\tconst css = gantt.templates.timeline_cell_class || gantt.templates.task_cell_class;\r\n\t\t\t\tif (css) {\r\n\t\t\t\t\tconst raw = gantt.ext.export_api._getRaw();\r\n\t\t\t\t\tlet steps = raw[0].trace_x;\r\n\t\t\t\t\tfor (let i = 1; i < raw.length; i++){\r\n\t\t\t\t\t\tif (raw[i].trace_x.length > steps.length){\r\n\t\t\t\t\t\t\tsteps = raw[i].trace_x;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (let i = 0; i < data.data.length; i++) {\r\n\t\t\t\t\t\tdata.data[i].styles = [];\r\n\t\t\t\t\t\tconst task = gantt.getTask(data.data[i].id);\r\n\t\t\t\t\t\tfor (let j = 0; j < steps.length; j++) {\r\n\t\t\t\t\t\t\tconst date = steps[j];\r\n\t\t\t\t\t\t\tconst cellCss = css(task, date);\r\n\t\t\t\t\t\t\tif (cellCss){\r\n\t\t\t\t\t\t\t\tdata.data[i].styles.push({ index: j, styles: gantt.ext.export_api._getStyles(cellCss) });\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn data;\r\n\t\t},\r\n\r\n\t\t_serializeScales(config) {\r\n\t\t\tconst scales:any = [];\r\n\t\t\tconst raw = gantt.ext.export_api._getRaw();\r\n\r\n\t\t\tlet min = Infinity;\r\n\t\t\tlet max = 0;\r\n\t\t\tfor (let i = 0; i < raw.length; i++) {\r\n\t\t\t\tmin = Math.min(min, raw[i].col_width);\r\n\t\t\t}\r\n\r\n\t\t\tfor (let i = 0; i < raw.length; i++) {\r\n\t\t\t\tlet start = 0;\r\n\t\t\t\tlet end = 0;\r\n\t\t\t\tconst row:any = [];\r\n\r\n\t\t\t\tscales.push(row);\r\n\t\t\t\tconst step = raw[i];\r\n\t\t\t\tmax = Math.max(max, step.trace_x.length);\r\n\t\t\t\tconst template = step.format || step.template || (step.date ? gantt.date.date_to_str(step.date) : gantt.config.date_scale);\r\n\r\n\t\t\t\tfor (let j = 0; j < step.trace_x.length; j++) {\r\n\t\t\t\t\tconst date = step.trace_x[j];\r\n\t\t\t\t\tend = start + Math.round(step.width[j] / min);\r\n\r\n\t\t\t\t\tconst scaleCell = { text: template(date), start, end, styles: \"\" };\r\n\r\n\t\t\t\t\tif (config.cellColors) {\r\n\t\t\t\t\t\tconst css = step.css || gantt.templates.scaleCell_class;\r\n\t\t\t\t\t\tif (css) {\r\n\t\t\t\t\t\t\tconst scaleCss = css(date);\r\n\t\t\t\t\t\t\tif (scaleCss){\r\n\t\t\t\t\t\t\t\tscaleCell.styles = gantt.ext.export_api._getStyles(scaleCss);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\trow.push(scaleCell);\r\n\t\t\t\t\tstart = end;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn { width: max, height: scales.length, data: scales };\r\n\t\t},\r\n\r\n\t\t_serializeGrid(config) {\r\n\t\t\tgantt.exportMode = true;\r\n\r\n\t\t\tconst columns:any = [];\r\n\t\t\tconst cols = gantt.config.columns;\r\n\r\n\t\t\tlet ccount = 0;\r\n\t\t\tfor (let i = 0; i < cols.length; i++) {\r\n\t\t\t\tif (cols[i].name === \"add\" || cols[i].name === \"buttons\") {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcolumns[ccount] = {\r\n\t\t\t\t\tid: ((cols[i].template) ? (\"_\" + i) : cols[i].name),\r\n\t\t\t\t\theader: cols[i].label || gantt.locale.labels[\"column_\" + cols[i].name],\r\n\t\t\t\t\twidth: (cols[i].width ? Math.floor(cols[i].width / 4) : \"\"),\r\n\t\t\t\t\ttree: cols[i].tree || false\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (cols[i].name === \"duration\"){\r\n\t\t\t\t\tcolumns[ccount].type = \"number\";\r\n\t\t\t\t}\r\n\t\t\t\tif (cols[i].name === \"start_date\" || cols[i].name === \"end_date\") {\r\n\t\t\t\t\tcolumns[ccount].type = \"date\";\r\n\t\t\t\t\tif (config && config.rawDates){\r\n\t\t\t\t\t\tcolumns[ccount].id = cols[i].name;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tccount++;\r\n\t\t\t}\r\n\r\n\t\t\tgantt.exportMode = false;\r\n\t\t\treturn columns;\r\n\t\t},\r\n\r\n\t\t_exportSerialize() {\r\n\t\t\tgantt.exportMode = true;\r\n\r\n\t\t\tconst xmlFormat = gantt.templates.xml_format;\r\n\t\t\tconst formatDate = gantt.templates.format_date;\r\n\r\n\t\t\t// use configuration date format for serialization so date could be parsed on the export\r\n\t\t\t// required when custom format date function is defined\r\n\t\t\tgantt.templates.xml_format =\r\n\t\t\t\tgantt.templates.format_date =\r\n\t\t\t\tgantt.date.date_to_str(gantt.config.date_format || gantt.config.xml_date);\r\n\r\n\t\t\tconst data = gantt.serialize();\r\n\r\n\t\t\tgantt.templates.xml_format = xmlFormat;\r\n\t\t\tgantt.templates.format_date = formatDate;\r\n\t\t\tgantt.exportMode = false;\r\n\t\t\treturn data;\r\n\t\t},\r\n\r\n\r\n\t\t_setLevel(data) {\r\n\t\t\tfor (let i = 0; i < data.length; i++) {\r\n\t\t\t\t// tslint:disable-next-line triple-equals\r\n\t\t\t\tif (data[i].parent == 0) {\r\n\t\t\t\t\tdata[i]._lvl = 1;\r\n\t\t\t\t}\r\n\t\t\t\tfor (let j = i + 1; j < data.length; j++) {\r\n\t\t\t\t\t// tslint:disable-next-line triple-equals\r\n\t\t\t\t\tif (data[i].id == data[j].parent) {\r\n\t\t\t\t\t\tdata[j]._lvl = data[i]._lvl + 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_clearLevel(data) {\r\n\t\t\tfor (let i = 0; i < data.length; i++) {\r\n\t\t\t\tdelete data[i]._lvl;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_clearRecLinks(data) {\r\n\t\t\tgantt.ext.export_api._setLevel(data.data);\r\n\t\t\tconst tasks = {};\r\n\t\t\tfor (let i = 0; i < data.data.length; i++) {\r\n\t\t\t\ttasks[data.data[i].id] = data.data[i];\r\n\t\t\t}\r\n\r\n\t\t\tconst links = {};\r\n\r\n\t\t\tfor (let i = 0; i < data.links.length; i++) {\r\n\t\t\t\tconst link = data.links[i];\r\n\t\t\t\tif (gantt.isTaskExists(link.source) && gantt.isTaskExists(link.target) &&\r\n\t\t\t\t\ttasks[link.source] && tasks[link.target]) {\r\n\t\t\t\t\tlinks[link.id] = link;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (const j in links) {\r\n\t\t\t\tgantt.ext.export_api._makeLinksSameLevel(links[j], tasks);\r\n\t\t\t}\r\n\r\n\t\t\tconst skippedLinks = {};\r\n\t\t\tfor (const j in tasks) {\r\n\t\t\t\tgantt.ext.export_api._clearCircDependencies(tasks[j], links, tasks, {}, skippedLinks, null);\r\n\t\t\t}\r\n\r\n\t\t\tif (Object.keys(links)) {\r\n\t\t\t\tgantt.ext.export_api._clearLinksSameLevel(links, tasks);\r\n\t\t\t}\r\n\r\n\t\t\tfor (let i = 0; i < data.links.length; i++) {\r\n\t\t\t\tif (!links[data.links[i].id]) {\r\n\t\t\t\t\tdata.links.splice(i, 1);\r\n\t\t\t\t\ti--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tgantt.ext.export_api._clearLevel(data.data);\r\n\t\t},\r\n\r\n\t\t_clearCircDependencies(task, links, tasks, usedTasks, skippedLinks, prevLink) {\r\n\t\t\tconst sources = task.$_source;\r\n\t\t\tif (!sources) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (usedTasks[task.id]) {\r\n\t\t\t\tgantt.ext.export_api._onCircDependencyFind(prevLink, links, usedTasks, skippedLinks);\r\n\t\t\t}\r\n\r\n\t\t\tusedTasks[task.id] = true;\r\n\r\n\t\t\tconst targets = {};\r\n\r\n\t\t\tfor (let i = 0; i < sources.length; i++) {\r\n\t\t\t\tif (skippedLinks[sources[i]]) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tconst curLink = links[sources[i]];\r\n\t\t\t\tconst targetTask = tasks[curLink._target];\r\n\t\t\t\tif (targets[targetTask.id]) { // two link from one task to another\r\n\t\t\t\t\tgantt.ext.export_api._onCircDependencyFind(curLink, links, usedTasks, skippedLinks);\r\n\t\t\t\t}\r\n\t\t\t\ttargets[targetTask.id] = true;\r\n\t\t\t\tgantt.ext.export_api._clearCircDependencies(targetTask, links, tasks, usedTasks, skippedLinks, curLink);\r\n\t\t\t}\r\n\t\t\tusedTasks[task.id] = false;\r\n\t\t},\r\n\r\n\t\t_onCircDependencyFind(link, links, usedTasks, skippedLinks) {\r\n\t\t\tif (link) {\r\n\t\t\t\tif (gantt.callEvent(\"onExportCircularDependency\", [link.id, link])) {\r\n\t\t\t\t\tdelete links[link.id];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdelete usedTasks[link._source];\r\n\t\t\t\tdelete usedTasks[link._target];\r\n\t\t\t\tskippedLinks[link.id] = true;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_makeLinksSameLevel(link, tasks) {\r\n\t\t\tlet task;\r\n\t\t\tlet targetLvl;\r\n\t\t\tconst linkT = {\r\n\t\t\t\ttarget: tasks[link.target],\r\n\t\t\t\tsource: tasks[link.source]\r\n\t\t\t};\r\n\t\t\t// tslint:disable-next-line triple-equals\r\n\t\t\tif (linkT.target._lvl != linkT.source._lvl) {\r\n\t\t\t\tif (linkT.target._lvl < linkT.source._lvl) {\r\n\t\t\t\t\ttask = \"source\";\r\n\t\t\t\t\ttargetLvl = linkT.target._lvl;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttask = \"target\";\r\n\t\t\t\t\ttargetLvl = linkT.source._lvl;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdo {\r\n\t\t\t\t\tconst parent = tasks[linkT[task].parent];\r\n\t\t\t\t\tif (!parent) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlinkT[task] = parent;\r\n\t\t\t\t} while (linkT[task]._lvl < targetLvl);\r\n\r\n\t\t\t\tlet sourceParent = tasks[linkT.source.parent];\r\n\t\t\t\tlet\ttargetParent = tasks[linkT.target.parent];\r\n\t\t\t\t// tslint:disable-next-line triple-equals\r\n\t\t\t\twhile (sourceParent && targetParent && sourceParent.id != targetParent.id) {\r\n\t\t\t\t\tlinkT.source = sourceParent;\r\n\t\t\t\t\tlinkT.target = targetParent;\r\n\t\t\t\t\tsourceParent = tasks[linkT.source.parent];\r\n\t\t\t\t\ttargetParent = tasks[linkT.target.parent];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlink._target = linkT.target.id;\r\n\t\t\tlink._source = linkT.source.id;\r\n\r\n\t\t\tif (!linkT.target.$_target){\r\n\t\t\t\tlinkT.target.$_target = [];\r\n\t\t\t}\r\n\t\t\tlinkT.target.$_target.push(link.id);\r\n\r\n\t\t\tif (!linkT.source.$_source){\r\n\t\t\t\tlinkT.source.$_source = [];\r\n\t\t\t}\r\n\t\t\tlinkT.source.$_source.push(link.id);\r\n\t\t},\r\n\r\n\t\t_clearLinksSameLevel(links, tasks) {\r\n\t\t\tfor (const link in links) {\r\n\t\t\t\tdelete links[link]._target;\r\n\t\t\t\tdelete links[link]._source;\r\n\t\t\t}\r\n\r\n\t\t\tfor (const task in tasks) {\r\n\t\t\t\tdelete tasks[task].$_source;\r\n\t\t\t\tdelete tasks[task].$_target;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\t_customProjectProperties(data, config) {\r\n\t\t\tif (config && config.project) {\r\n\t\t\t\tfor (const i in config.project) {\r\n\t\t\t\t\tif (!gantt.config.$custom_data){\r\n\t\t\t\t\t\tgantt.config.$custom_data = {};\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgantt.config.$custom_data[i] = typeof config.project[i] === \"function\" ? config.project[i](gantt.config) : config.project[i];\r\n\t\t\t\t}\r\n\t\t\t\tdelete config.project;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_customTaskProperties(data, config) {\r\n\t\t\tif (config && config.tasks) {\r\n\t\t\t\tdata.data.forEach(function(el) {\r\n\t\t\t\t\tfor (const i in config.tasks) {\r\n\t\t\t\t\t\tif (!el.$custom_data){\r\n\t\t\t\t\t\t\tel.$custom_data = {};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tel.$custom_data[i] = typeof config.tasks[i] === \"function\" ? config.tasks[i](el, gantt.config) : config.tasks[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tdelete config.tasks;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_exportConfig(data, config) {\r\n\t\t\tconst projectName = config.name || \"gantt.xml\";\r\n\t\t\tdelete config.name;\r\n\r\n\t\t\tgantt.config.custom = config;\r\n\r\n\t\t\tconst time = gantt.ext.export_api._getWorktimeSettings();\r\n\r\n\t\t\tconst projectDates = gantt.getSubtaskDates();\r\n\t\t\tif (projectDates.start_date && projectDates.end_date) {\r\n\t\t\t\tconst formatDate = gantt.templates.format_date || gantt.templates.xml_format;\r\n\t\t\t\tgantt.config.start_end = {\r\n\t\t\t\t\tstart_date: formatDate(projectDates.start_date),\r\n\t\t\t\t\tend_date: formatDate(projectDates.end_date)\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tconst manual = config.auto_scheduling === undefined ? false : !!config.auto_scheduling;\r\n\r\n\t\t\tconst res = {\r\n\t\t\t\tcallback: config.callback || null,\r\n\t\t\t\tconfig: gantt.config,\r\n\t\t\t\tdata,\r\n\t\t\t\tmanual,\r\n\t\t\t\tname: projectName,\r\n\t\t\t\tworktime: time\r\n\t\t\t};\r\n\t\t\tfor (const i in config) {\r\n\t\t\t\tres[i] = config[i];\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t},\r\n\r\n\r\n\t\t_sendImportAjaxMSP(config) {\r\n\t\t\tconst url = config.server || gantt.ext.export_api._apiUrl;\r\n\t\t\tconst store = config.store || 0;\r\n\t\t\tconst formData = config.data;\r\n\t\t\tconst callback = config.callback;\r\n\r\n\t\t\tconst settings = {\r\n\t\t\t\tdurationUnit: config.durationUnit || undefined,\r\n\t\t\t\tprojectProperties: config.projectProperties || undefined,\r\n\t\t\t\ttaskProperties: config.taskProperties || undefined\r\n\t\t\t};\r\n\r\n\t\t\tformData.append(\"type\", config.type || \"msproject-parse\");\r\n\t\t\tformData.append(\"data\", JSON.stringify(settings));\r\n\r\n\t\t\tif (store){\r\n\t\t\t\tformData.append(\"store\", store);\r\n\t\t\t}\r\n\r\n\t\t\tconst xhr = new XMLHttpRequest();\r\n\t\t\txhr.onreadystatechange = function(e) {\r\n\t\t\t\tif (xhr.readyState === 4 && xhr.status === 0) {// network error\r\n\t\t\t\t\tif (callback) {\r\n\t\t\t\t\t\tcallback(null);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\txhr.onload = function(){\r\n\t\t\t\tconst fail = xhr.status > 400;\r\n\t\t\t\tlet info = null;\r\n\r\n\t\t\t\tif (!fail) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tinfo = JSON.parse(xhr.responseText);\r\n\t\t\t\t\t} catch (e) { }\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (callback) {\r\n\t\t\t\t\tcallback(info);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\txhr.open(\"POST\", url, true);\r\n\t\t\txhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\r\n\t\t\txhr.send(formData);\r\n\t\t}\r\n\r\n\t};\r\n\r\n\r\n\tgantt.exportToPDF = gantt.ext.export_api.exportToPDF;\r\n\tgantt.exportToPNG = gantt.ext.export_api.exportToPNG;\r\n\tgantt.exportToICal = gantt.ext.export_api.exportToICal;\r\n\tgantt.exportToExcel = gantt.ext.export_api.exportToExcel;\r\n\tgantt.exportToJSON = gantt.ext.export_api.exportToJSON;\r\n\tgantt.importFromExcel = gantt.ext.export_api.importFromExcel;\r\n\tgantt.importFromMSProject = gantt.ext.export_api.importFromMSProject;\r\n\tgantt.exportToMSProject = gantt.ext.export_api.exportToMSProject;\r\n\tgantt.importFromPrimaveraP6 = gantt.ext.export_api.importFromPrimaveraP6;\r\n\tgantt.exportToPrimaveraP6 = gantt.ext.export_api.exportToPrimaveraP6;\r\n\r\n\r\n\treturn gantt.ext.export_api;\r\n}\r\n","export default function(gantt: any){\r\n\r\ninterface IBody extends HTMLElement {\r\n\tmsRequestFullscreen?: () => void;\r\n\tmozRequestFullScreen?: () => void;\r\n\twebkitRequestFullscreen?: (ALLOW_KEYBOARD_INPUT: any) => void;\r\n}\r\n\r\n\r\ninterface IConsole extends Console {\r\n\twarning?: (str: string) => void;\r\n}\r\n\r\ninterface IDocument extends Document {\r\n\tfullscreenElement: Element;\r\n\tmozFullScreenElement?: Element;\r\n\twebkitFullscreenElement?: Element;\r\n\tmsFullscreenElement?: Element;\r\n\twebkitFullscreenEnabled?: boolean;\r\n\tmozFullScreenEnabled?: boolean;\r\n\tmsFullscreenEnabled?: boolean;\r\n\tmsExitFullscreen?: () => void;\r\n\tmozCancelFullScreen?: () => void;\r\n\twebkitExitFullscreen?: () => void;\r\n}\r\n\r\ninterface IElement extends Element {\r\n\tALLOW_KEYBOARD_INPUT?: boolean;\r\n}\r\n\r\ninterface IElementSizes extends ISizes {\r\n\tmodified: boolean;\r\n}\r\n\r\ninterface ISizes {\r\n\twidth: null | string;\r\n\theight: null | string;\r\n\ttop: null | string;\r\n\tleft: null | string;\r\n\tposition: null | string;\r\n\tzIndex: null | number;\r\n}\r\n\r\nfunction isExpanded() {\r\n\tconst element = ((document as IDocument).fullscreenElement ||\r\n\t\t(document as IDocument).mozFullScreenElement ||\r\n\t\t(document as IDocument).webkitFullscreenElement ||\r\n\t\t(document as IDocument).msFullscreenElement);\r\n\treturn !!(element && element === document.body);\r\n}\r\n\r\nfunction isFullscreenAvailable() {\r\n\ttry {\r\n\t\treturn (document as IDocument).fullscreenEnabled ||\r\n\t\t\t(document as IDocument).webkitFullscreenEnabled ||\r\n\t\t\t(document as IDocument).mozFullScreenEnabled ||\r\n\t\t\t(document as IDocument).msFullscreenEnabled;\r\n\t} catch (e) {\r\n\t\t// eslint-disable-next-line no-console\r\n\t\tconsole.error(\"Fullscreen is not available:\", e); \r\n\t}\r\n}\r\n\r\nconst state = gantt.$services.getService(\"state\");\r\nstate.registerProvider(\"fullscreen\", () => {\r\n\tif (isFullscreenAvailable()){\r\n\t\treturn { fullscreen: isExpanded() };\r\n\t} else {\r\n\t\treturn undefined;\r\n\t}\r\n});\r\n\r\nlet backupBodyPadding = {\r\n\toverflow: null,\r\n\tpadding: null,\r\n\tpaddingTop: null,\r\n\tpaddingRight: null,\r\n\tpaddingBottom: null,\r\n\tpaddingLeft: null\r\n};\r\n\r\nconst backupElementSizes: IElementSizes = {\r\n\twidth: null,\r\n\theight: null,\r\n\ttop: null,\r\n\tleft: null,\r\n\tposition: null,\r\n\tzIndex: null,\r\n\tmodified: false\r\n};\r\n\r\nlet backupPositioning = null;\r\nfunction resetParentPositioning(root){\r\n\tlet parent = root.parentNode;\r\n\tconst positions = [];\r\n\twhile(parent && parent.style){\r\n\t\tpositions.push({\r\n\t\t\telement: parent,\r\n\t\t\toriginalPositioning: parent.style.position\r\n\t\t});\r\n\t\tparent.style.position = \"static\";\r\n\t\tparent = parent.parentNode;\r\n\t}\r\n\treturn positions;\r\n}\r\n\r\nfunction restoreParentPositioning(positions: any[]){\r\n\tpositions.forEach(record => {\r\n\t\trecord.element.style.position = record.originalPositioning;\r\n\t});\r\n}\r\n\r\n// expand gantt root element to fullscreen automatically\r\nfunction setFullScreenSizes() {\r\n\tconst root = gantt.ext.fullscreen.getFullscreenElement();\r\n\tconst body = document.body;\r\n\tupdateSizes(root.style, backupElementSizes);\r\n\tbackupBodyPadding = {\r\n\t\toverflow: body.style.overflow,\r\n\t\tpadding: body.style.padding ? body.style.padding : null,\r\n\t\tpaddingTop: body.style.paddingTop ? body.style.paddingTop : null,\r\n\t\tpaddingRight: body.style.paddingRight ? body.style.paddingRight : null,\r\n\t\tpaddingBottom: body.style.paddingBottom ? body.style.paddingBottom : null,\r\n\t\tpaddingLeft: body.style.paddingLeft ? body.style.paddingLeft : null\r\n\t};\r\n\r\n\tif (body.style.padding) {\r\n\t\tbody.style.padding = \"0\";\r\n\t}\r\n\tif (body.style.paddingTop) {\r\n\t\tbody.style.paddingTop = \"0\";\r\n\t}\r\n\tif (body.style.paddingRight) {\r\n\t\tbody.style.paddingRight = \"0\";\r\n\t}\r\n\tif (body.style.paddingBottom) {\r\n\t\tbody.style.paddingBottom = \"0\";\r\n\t}\r\n\tif (body.style.paddingLeft) {\r\n\t\tbody.style.paddingLeft = \"0\";\r\n\t}\r\n\r\n\tbody.style.overflow = \"hidden\";\r\n\r\n\troot.style.width = \"100vw\";\r\n\troot.style.height = \"100vh\";\r\n\troot.style.top = \"0px\";\r\n\troot.style.left = \"0px\";\r\n\troot.style.position = \"absolute\";\r\n\troot.style.zIndex = 1;\r\n\tbackupElementSizes.modified = true;\r\n\tbackupPositioning = resetParentPositioning(root);\r\n}\r\n\r\nfunction restoreSizes() {\r\n\tconst root = gantt.ext.fullscreen.getFullscreenElement();\r\n\tconst body = document.body;\r\n\tif (backupElementSizes.modified) {\r\n\t\tif (backupBodyPadding.padding) {\r\n\t\t\tbody.style.padding = backupBodyPadding.padding;\r\n\t\t}\r\n\t\tif (backupBodyPadding.paddingTop) {\r\n\t\t\tbody.style.paddingTop = backupBodyPadding.paddingTop;\r\n\t\t}\r\n\t\tif (backupBodyPadding.paddingRight) {\r\n\t\t\tbody.style.paddingRight = backupBodyPadding.paddingRight;\r\n\t\t}\r\n\t\tif (backupBodyPadding.paddingBottom) {\r\n\t\t\tbody.style.paddingBottom = backupBodyPadding.paddingBottom;\r\n\t\t}\r\n\t\tif (backupBodyPadding.paddingLeft) {\r\n\t\t\tbody.style.paddingLeft = backupBodyPadding.paddingLeft;\r\n\t\t}\r\n\r\n\t\tbody.style.overflow = backupBodyPadding.overflow;\r\n\t\tbackupBodyPadding = {\r\n\t\t\toverflow: null,\r\n\t\t\tpadding: null,\r\n\t\t\tpaddingTop: null,\r\n\t\t\tpaddingRight: null,\r\n\t\t\tpaddingBottom: null,\r\n\t\t\tpaddingLeft: null\r\n\t\t};\r\n\t\tupdateSizes(backupElementSizes, root.style);\r\n\t\tbackupElementSizes.modified = false;\r\n\t}\r\n\trestoreParentPositioning(backupPositioning);\r\n\tbackupPositioning = null;\r\n}\r\n\r\nfunction updateSizes(source: ISizes, target: ISizes) {\r\n\ttarget.width = source.width;\r\n\ttarget.height = source.height;\r\n\ttarget.top = source.top;\r\n\ttarget.left = source.left;\r\n\ttarget.position = source.position;\r\n\ttarget.zIndex = source.zIndex;\r\n}\r\n\r\nfunction addDOMEvents() {\r\n\tgantt.event(document, \"webkitfullscreenchange\", onFullScreenChange);\r\n\tgantt.event(document, \"mozfullscreenchange\", onFullScreenChange);\r\n\tgantt.event(document, \"MSFullscreenChange\", onFullScreenChange);\r\n\t// For IE on Win 10\r\n\tgantt.event(document, \"fullscreenChange\", onFullScreenChange);\r\n\tgantt.event(document, \"fullscreenchange\", onFullScreenChange);\r\n}\r\n\r\nlet expandGantt = false;\r\nfunction onFullScreenChange() {\r\n\tif (!gantt.$container) {\r\n\t\t// do nothing if gantt is not yet initialized\r\n\t\treturn;\r\n\t}\r\n\tlet event: \"onExpand\" | \"onCollapse\";\r\n\tconst isBodyExpanded = isExpanded();\r\n\r\n\tif (isBodyExpanded) {\r\n\t\tif (expandGantt) {\r\n\t\t\tevent = \"onExpand\";\r\n\t\t\tsetFullScreenSizes();\r\n\t\t}\r\n\t} else if (expandGantt) {\r\n\t\texpandGantt = false;\r\n\t\tevent = \"onCollapse\";\r\n\t\trestoreSizes();\r\n\t}\r\n\tsetTimeout(() => {\r\n\t\tgantt.render();\r\n\t});\r\n\tsetTimeout(() => {\r\n\t\tgantt.callEvent(event, [gantt.ext.fullscreen.getFullscreenElement()]);\r\n\t});\r\n}\r\n\r\nfunction cantFullscreen() {\r\n\tif (!gantt.$container) { // check is gantt initialized or not\r\n\t\treturn true;\r\n\t}\r\n\tif (!gantt.ext.fullscreen.getFullscreenElement()) {\r\n\t\treturn true;\r\n\t}\r\n\tif (!isFullscreenAvailable()) {\r\n\t\t// eslint-disable-next-line no-console\r\n\t\tconst method = (console as IConsole).warning || console.log;\r\n\t\tmethod(\"The `fullscreen` feature not being allowed, or full-screen mode not being supported\");\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\ngantt.ext.fullscreen = {\r\n\texpand(): void {\r\n\t\tif (cantFullscreen()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (isExpanded()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!gantt.callEvent(\"onBeforeExpand\", [this.getFullscreenElement()])) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\texpandGantt = true;\r\n\r\n\t\t// we switch body to fullscreen and then expand fullscreen element to viewport\r\n\t\t// we do it to correct display common elements: lightboxes, tooltip etc.\r\n\t\tconst element = document.body as IBody;\r\n\t\tconst requestArguments = element.webkitRequestFullscreen ?\r\n\t\t\t[(Element as unknown as IElement).ALLOW_KEYBOARD_INPUT] : [];\r\n\r\n\t\tconst requestFullscreen = element.msRequestFullscreen ||\r\n\t\t\telement.mozRequestFullScreen ||\r\n\t\t\telement.webkitRequestFullscreen ||\r\n\t\t\telement.requestFullscreen;\r\n\r\n\t\tif (requestFullscreen) {\r\n\t\t\trequestFullscreen.apply(element, requestArguments);\r\n\t\t}\r\n\t},\r\n\tcollapse(): void {\r\n\t\tif (cantFullscreen()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!isExpanded()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!gantt.callEvent(\"onBeforeCollapse\", [this.getFullscreenElement()])) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst requestExitFullscreen = (document as IDocument).msExitFullscreen ||\r\n\t\t\t(document as IDocument).mozCancelFullScreen ||\r\n\t\t\t(document as IDocument).webkitExitFullscreen ||\r\n\t\t\t(document as IDocument).exitFullscreen;\r\n\r\n\t\tif (requestExitFullscreen) {\r\n\t\t\trequestExitFullscreen.apply(document);\r\n\t\t}\r\n\t},\r\n\ttoggle(): void {\r\n\t\tif (cantFullscreen()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!isExpanded()) {\r\n\t\t\tthis.expand();\r\n\t\t} else {\r\n\t\t\tthis.collapse();\r\n\t\t}\r\n\r\n\t},\r\n\tgetFullscreenElement(): HTMLElement {\r\n\t\treturn gantt.$root;\r\n\t}\r\n};\r\n\r\ngantt.expand = function() {\r\n\tgantt.ext.fullscreen.expand();\r\n};\r\n\r\ngantt.collapse = function(){\r\n\tgantt.ext.fullscreen.collapse();\r\n};\r\n\r\ngantt.attachEvent(\"onGanttReady\", addDOMEvents);\r\n\r\n}","export default function(gantt) {\r\n\r\n\tgantt.$keyboardNavigation.shortcuts = {\r\n\t\tcreateCommand: function () {\r\n\t\t\treturn {\r\n\t\t\t\tmodifiers: {\r\n\t\t\t\t\t\"shift\": false,\r\n\t\t\t\t\t\"alt\": false,\r\n\t\t\t\t\t\"ctrl\": false,\r\n\t\t\t\t\t\"meta\": false\r\n\t\t\t\t},\r\n\t\t\t\tkeyCode: null\r\n\t\t\t};\r\n\t\t},\r\n\t\tparse: function (shortcut) {\r\n\t\t\tvar commands = [];\r\n\r\n\t\t\tvar expr = this.getExpressions(this.trim(shortcut));\r\n\t\t\tfor (var i = 0; i < expr.length; i++) {\r\n\t\t\t\tvar words = this.getWords(expr[i]);\r\n\r\n\t\t\t\tvar command = this.createCommand();\r\n\r\n\t\t\t\tfor (var j = 0; j < words.length; j++) {\r\n\t\t\t\t\tif (this.commandKeys[words[j]]) {\r\n\t\t\t\t\t\tcommand.modifiers[words[j]] = true;\r\n\t\t\t\t\t} else if (this.specialKeys[words[j]]) {\r\n\t\t\t\t\t\tcommand.keyCode = this.specialKeys[words[j]];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcommand.keyCode = words[j].charCodeAt(0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcommands.push(command);\r\n\t\t\t}\r\n\t\t\treturn commands;\r\n\t\t},\r\n\r\n\t\tgetCommandFromEvent: function (domEvent) {\r\n\t\t\tvar command = this.createCommand();\r\n\t\t\tcommand.modifiers.shift = !!domEvent.shiftKey;\r\n\t\t\tcommand.modifiers.alt = !!domEvent.altKey;\r\n\t\t\tcommand.modifiers.ctrl = !!domEvent.ctrlKey;\r\n\t\t\tcommand.modifiers.meta = !!domEvent.metaKey;\r\n\t\t\tcommand.keyCode = domEvent.which || domEvent.keyCode;\r\n\r\n\t\t\tif(command.keyCode >= 96 && command.keyCode <= 105){\r\n\t\t\t\t// numpad keys 96-105 -> 48-57\r\n\t\t\t\tcommand.keyCode -= 48;//convert numpad  number code to regular number code\r\n\t\t\t}\r\n\r\n\t\t\tvar printableKey = String.fromCharCode(command.keyCode);\r\n\t\t\tif (printableKey) {\r\n\t\t\t\tcommand.keyCode = printableKey.toLowerCase().charCodeAt(0);\r\n\t\t\t}\r\n\t\t\treturn command;\r\n\t\t},\r\n\r\n\t\tgetHashFromEvent: function (domEvent) {\r\n\t\t\treturn this.getHash(this.getCommandFromEvent(domEvent));\r\n\t\t},\r\n\r\n\t\tgetHash: function (command) {\r\n\t\t\tvar parts = [];\r\n\t\t\tfor (var i in command.modifiers) {\r\n\t\t\t\tif (command.modifiers[i]) {\r\n\t\t\t\t\tparts.push(i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tparts.push(command.keyCode);\r\n\r\n\t\t\treturn parts.join(this.junctionChar);\r\n\t\t},\r\n\r\n\t\tgetExpressions: function (shortcut) {\r\n\t\t\treturn shortcut.split(this.junctionChar);\r\n\t\t},\r\n\t\tgetWords: function (term) {\r\n\t\t\treturn term.split(this.combinationChar);\r\n\t\t},\r\n\t\ttrim: function (shortcut) {\r\n\t\t\treturn shortcut.replace(/\\s/g, \"\");\r\n\t\t},\r\n\t\tjunctionChar: \",\",\r\n\t\tcombinationChar: \"+\",\r\n\t\tcommandKeys: {\r\n\t\t\t\"shift\": 16,\r\n\t\t\t\"alt\": 18,\r\n\t\t\t\"ctrl\": 17,\r\n\t\t\t\"meta\": true\r\n\t\t},\r\n\t\tspecialKeys: {\r\n\t\t\t\"backspace\": 8,\r\n\t\t\t\"tab\": 9,\r\n\t\t\t\"enter\": 13,\r\n\t\t\t\"esc\": 27,\r\n\t\t\t\"space\": 32,\r\n\t\t\t\"up\": 38,\r\n\t\t\t\"down\": 40,\r\n\t\t\t\"left\": 37,\r\n\t\t\t\"right\": 39,\r\n\t\t\t\"home\": 36,\r\n\t\t\t\"end\": 35,\r\n\t\t\t\"pageup\": 33,\r\n\t\t\t\"pagedown\": 34,\r\n\t\t\t\"delete\": 46,\r\n\t\t\t\"insert\": 45,\r\n\t\t\t\"plus\": 107,\r\n\t\t\t\"f1\": 112,\r\n\t\t\t\"f2\": 113,\r\n\t\t\t\"f3\": 114,\r\n\t\t\t\"f4\": 115,\r\n\t\t\t\"f5\": 116,\r\n\t\t\t\"f6\": 117,\r\n\t\t\t\"f7\": 118,\r\n\t\t\t\"f8\": 119,\r\n\t\t\t\"f9\": 120,\r\n\t\t\t\"f10\": 121,\r\n\t\t\t\"f11\": 122,\r\n\t\t\t\"f12\": 123\r\n\t\t}\r\n\t};\r\n};","export default function(gantt) {\r\n\r\n\tgantt.$keyboardNavigation.EventHandler = {\r\n\t\t_handlers: null,\r\n\t\tfindHandler: function (command) {\r\n\t\t\tif (!this._handlers) this._handlers = {};\r\n\t\t\tvar shortcuts = gantt.$keyboardNavigation.shortcuts;\r\n\t\t\tvar hash = shortcuts.getHash(command);\r\n\r\n\t\t\treturn this._handlers[hash];\r\n\t\t},\r\n\r\n\t\tdoAction: function (command, e) {\r\n\t\t\tvar handler = this.findHandler(command);\r\n\t\t\tif (handler) {\r\n\t\t\t\tvar eventFacade = gantt.$keyboardNavigation.facade;\r\n\r\n\t\t\t\tif(eventFacade.callEvent(\"onBeforeAction\", [command, e]) === false){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\thandler.call(this, e);\r\n\r\n\t\t\t\tif (e.preventDefault) e.preventDefault();\r\n\t\t\t\telse e.returnValue = false;\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\tbind: function (shortcut, handler) {\r\n\t\t\tif (!this._handlers) this._handlers = {};\r\n\r\n\t\t\tvar shortcuts = gantt.$keyboardNavigation.shortcuts;\r\n\r\n\t\t\tvar commands = shortcuts.parse(shortcut);\r\n\t\t\tfor (var i = 0; i < commands.length; i++) {\r\n\t\t\t\tthis._handlers[shortcuts.getHash(commands[i])] = handler;\r\n\t\t\t}\r\n\t\t},\r\n\t\tunbind: function (shortcut) {\r\n\t\t\tvar shortcuts = gantt.$keyboardNavigation.shortcuts;\r\n\r\n\t\t\tvar commands = shortcuts.parse(shortcut);\r\n\t\t\tfor (var i = 0; i < commands.length; i++) {\r\n\t\t\t\tif (this._handlers[shortcuts.getHash(commands[i])]) {\r\n\t\t\t\t\tdelete this._handlers[shortcuts.getHash(commands[i])];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tbindAll: function (map) {\r\n\t\t\tfor (var i in map) {\r\n\t\t\t\tthis.bind(i, map[i]);\r\n\t\t\t}\r\n\t\t},\r\n\t\tinitKeys: function () {\r\n\t\t\tif (!this._handlers)\r\n\t\t\t\tthis._handlers = {};\r\n\t\t\tif (this.keys) {\r\n\t\t\t\tthis.bindAll(this.keys);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n};","import * as domHelpers from \"../../../core/ui/utils/dom_helpers\";\r\n\r\nexport default function(gantt) {\r\n\r\n\t(function () {\r\n\t\t\r\n\t\tgantt.$keyboardNavigation.getFocusableNodes = domHelpers.getFocusableNodes;\r\n\r\n\t\tgantt.$keyboardNavigation.trapFocus = function trapFocus(root, e) {\r\n\t\t\tif (e.keyCode != 9) return false;\r\n\r\n\t\t\tvar focusable = gantt.$keyboardNavigation.getFocusableNodes(root);\r\n\t\t\tvar currentFocus = domHelpers.getActiveElement();\r\n\t\t\tvar currentIndex = -1;\r\n\t\t\tfor (var i = 0; i < focusable.length; i++) {\r\n\t\t\t\tif (focusable[i] == currentFocus) {\r\n\t\t\t\t\tcurrentIndex = i;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (e.shiftKey) {\r\n\t\t\t\t// back tab\r\n\t\t\t\tif (currentIndex <= 0) {\r\n\t\t\t\t\t// go to the last element if we focused on the first\r\n\t\t\t\t\tvar lastItem = focusable[focusable.length - 1];\r\n\t\t\t\t\tif (lastItem) {\r\n\t\t\t\t\t\tlastItem.focus();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\t\t\t\t// forward tab\r\n\t\t\t\tif (currentIndex >= focusable.length - 1) {\r\n\t\t\t\t\t// forward tab from last element should go back to the first element\r\n\t\t\t\t\tvar firstItem = focusable[0];\r\n\t\t\t\t\tif (firstItem) {\r\n\t\t\t\t\t\tfirstItem.focus();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t};\r\n\t})();\r\n\r\n};","export default function(gantt) {\r\n\r\n\tgantt.$keyboardNavigation.GanttNode = function () {\r\n\t};\r\n\r\n\tgantt.$keyboardNavigation.GanttNode.prototype = gantt._compose(\r\n\t\tgantt.$keyboardNavigation.EventHandler,\r\n\t\t{\r\n\r\n\t\t\tfocus: function () {\r\n\t\t\t\tgantt.focus();\r\n\t\t\t},\r\n\r\n\t\t\tblur: function () {\r\n\r\n\t\t\t},\r\n\r\n\t\t\tisEnabled: function () {\r\n\t\t\t\treturn gantt.$container.hasAttribute(\"tabindex\");\r\n\t\t\t},\r\n\r\n\t\t\tscrollHorizontal: function scrollHorizontal(dir) {\r\n\t\t\t\tvar date = gantt.dateFromPos(gantt.getScrollState().x);\r\n\t\t\t\tvar scale = gantt.getScale();\r\n\t\t\t\tvar step = dir < 0 ? -scale.step : scale.step;\r\n\t\t\t\tdate = gantt.date.add(date, step, scale.unit);\r\n\t\t\t\tgantt.scrollTo(gantt.posFromDate(date));\r\n\t\t\t},\r\n\r\n\t\t\tscrollVertical: function scrollVertical(dir) {\r\n\t\t\t\tvar top = gantt.getScrollState().y;\r\n\t\t\t\tvar step = gantt.config.row_height;\r\n\t\t\t\tgantt.scrollTo(null, top + (dir < 0 ? -1 : 1) * step);\r\n\t\t\t},\r\n\r\n\t\t\tkeys: {\r\n\t\t\t\t\"alt+left\": function (e) {\r\n\t\t\t\t\tthis.scrollHorizontal(-1);\r\n\t\t\t\t},\r\n\t\t\t\t\"alt+right\": function (e) {\r\n\t\t\t\t\tthis.scrollHorizontal(1);\r\n\t\t\t\t},\r\n\t\t\t\t\"alt+up\": function (e) {\r\n\t\t\t\t\tthis.scrollVertical(-1);\r\n\t\t\t\t},\r\n\t\t\t\t\"alt+down\": function (e) {\r\n\t\t\t\t\tthis.scrollVertical(1);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// undo\r\n\t\t\t\t\"ctrl+z\": function () {\r\n\t\t\t\t\tif (gantt.undo) gantt.undo();\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// redo\r\n\t\t\t\t\"ctrl+r\": function () {\r\n\t\t\t\t\tif (gantt.redo) gantt.redo();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\r\n\tgantt.$keyboardNavigation.GanttNode.prototype.bindAll(gantt.$keyboardNavigation.GanttNode.prototype.keys);\r\n\r\n};","export default function(gantt) {\r\n\r\n\tgantt.$keyboardNavigation.KeyNavNode = function () {\r\n\t};\r\n\r\n\tgantt.$keyboardNavigation.KeyNavNode.prototype = gantt._compose(\r\n\t\tgantt.$keyboardNavigation.EventHandler,\r\n\t\t{\r\n\t\t\tisValid: function () {\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t\tfallback: function () {\r\n\t\t\t\treturn null;\r\n\t\t\t},\r\n\r\n\t\t\tmoveTo: function (element) {\r\n\t\t\t\tgantt.$keyboardNavigation.dispatcher.setActiveNode(element);\r\n\t\t\t},\r\n\r\n\t\t\tcompareTo: function (b) {\r\n\t\t\t\t// good enough comparison of two random objects\r\n\t\t\t\tif (!b) return false;\r\n\t\t\t\tfor (var i in this) {\r\n\t\t\t\t\tif (!!this[i] != !!b[i]) return false;\r\n\r\n\t\t\t\t\tvar canStringifyThis = !!(this[i] && this[i].toString);\r\n\t\t\t\t\tvar canStringifyThat = !!(b[i] && b[i].toString);\r\n\t\t\t\t\tif (canStringifyThat != canStringifyThis) return false;\r\n\t\t\t\t\tif (!(canStringifyThat && canStringifyThis)) {\r\n\t\t\t\t\t\tif (b[i] != this[i]) return false;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (b[i].toString() != this[i].toString())\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\r\n\t\t\tgetNode: function () {\r\n\t\t\t},\r\n\t\t\tfocus: function () {\r\n\t\t\t\tvar node = this.getNode();\r\n\t\t\t\tif(!node)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tvar eventFacade = gantt.$keyboardNavigation.facade;\r\n\r\n\t\t\t\tif(eventFacade.callEvent(\"onBeforeFocus\", [node]) === false){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (node) {\r\n\t\t\t\t\tnode.setAttribute(\"tabindex\", \"-1\");\r\n\t\t\t\t\tif(!node.$eventAttached){\r\n\t\t\t\t\t\tnode.$eventAttached = true;\r\n\t\t\t\t\t\tgantt.event(node, \"focus\",function(e){\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}, false);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//node.className += \" gantt_focused\";\r\n\t\t\t\t\tif (gantt.utils.dom.isChildOf(document.activeElement, node)){\r\n\t\t\t\t\t\tnode = document.activeElement;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (node.focus) node.focus();\r\n\r\n\t\t\t\t\teventFacade.callEvent(\"onFocus\", [this.getNode()]);\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\t\t\tblur: function () {\r\n\t\t\t\tvar node = this.getNode();\r\n\t\t\t\tif (node) {\r\n\t\t\t\t\tvar eventFacade = gantt.$keyboardNavigation.facade;\r\n\t\t\t\t\teventFacade.callEvent(\"onBlur\", [node]);\r\n\t\t\t\t\tnode.setAttribute(\"tabindex\", \"-1\");\r\n\t\t\t\t\t//node.className = (node.className || \"\").replace(/ ?gantt_focused/g, \"\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\r\n};","import * as domHelpers from \"../../../core/ui/utils/dom_helpers\";\r\n\r\nexport default function(gantt) {\r\n\r\n\tgantt.$keyboardNavigation.HeaderCell = function (index) {\r\n\t\tthis.index = index || 0;\r\n\t};\r\n\r\n\tgantt.$keyboardNavigation.HeaderCell.prototype = gantt._compose(\r\n\t\tgantt.$keyboardNavigation.KeyNavNode,\r\n\t\t{\r\n\t\t\t_handlers: null,\r\n\r\n\t\t\tisValid: function () {\r\n\t\t\t\tif (!gantt.config.show_grid) {\r\n\t\t\t\t\tif (gantt.getVisibleTaskCount())\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\treturn !!gantt.getGridColumns()[this.index] || !gantt.getVisibleTaskCount();\r\n\t\t\t},\r\n\t\t\tfallback: function () {\r\n\t\t\t\tif (!gantt.config.show_grid) {\r\n\t\t\t\t\tif (gantt.getVisibleTaskCount()) {\r\n\t\t\t\t\t\treturn new gantt.$keyboardNavigation.TaskRow();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t\tvar visibleColumns = gantt.getGridColumns();\r\n\t\t\t\tvar index = this.index;\r\n\t\t\t\twhile (index >= 0) {\r\n\t\t\t\t\tif (visibleColumns[index])\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tindex--;\r\n\t\t\t\t}\r\n\t\t\t\tif (visibleColumns[index]) {\r\n\t\t\t\t\treturn new gantt.$keyboardNavigation.HeaderCell(index);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tfromDomElement: function(el){\r\n\t\t\t\tvar cellElement = domHelpers.locateClassName(el, \"gantt_grid_head_cell\");\r\n\t\t\t\tif(cellElement){\r\n\t\t\t\t\tvar index = 0;\r\n\t\t\t\t\twhile(cellElement && cellElement.previousSibling){\r\n\t\t\t\t\t\tcellElement = cellElement.previousSibling;\r\n\t\t\t\t\t\tindex += 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn new gantt.$keyboardNavigation.HeaderCell(index);\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tgetNode: function () {\r\n\t\t\t\tconst scale = gantt.$grid_scale;\r\n\t\t\t\tif (!scale){\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t\tconst cells = scale.childNodes;\r\n\t\t\t\treturn cells[this.index];\r\n\t\t\t},\r\n\r\n\r\n\t\t\tkeys: {\r\n\r\n\t\t\t\t\"left\": function () {\r\n\t\t\t\t\tif (this.index > 0) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.HeaderCell(this.index - 1));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"right\": function () {\r\n\t\t\t\t\tvar columns = gantt.getGridColumns();\r\n\t\t\t\t\tif (this.index < columns.length - 1) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.HeaderCell(this.index + 1));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"down\": function () {\r\n\t\t\t\t\tvar taskRow;\r\n\t\t\t\t\tvar rootLevel = gantt.getChildren(gantt.config.root_id);\r\n\t\t\t\t\tif (gantt.isTaskExists(rootLevel[0])) {\r\n\t\t\t\t\t\ttaskRow = rootLevel[0];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (taskRow) {\r\n\t\t\t\t\t\tif (gantt.config.keyboard_navigation_cells) {\r\n\t\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(taskRow, this.index));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskRow(taskRow));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\t\"end\": function () {\r\n\t\t\t\t\tvar columns = gantt.getGridColumns();\r\n\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.HeaderCell(columns.length - 1));\r\n\t\t\t\t},\r\n\t\t\t\t\"home\": function () {\r\n\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.HeaderCell(0));\r\n\t\t\t\t},\r\n\r\n\r\n\t\t\t\t// press header button\r\n\t\t\t\t\"enter, space\": function () {\r\n\t\t\t\t\tvar node = domHelpers.getActiveElement();\r\n\t\t\t\t\tnode.click();\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// add new task\r\n\t\t\t\t\"ctrl+enter\": function () {\r\n\t\t\t\t\tif (gantt.isReadonly(this)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgantt.createTask({}, this.taskId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\r\n\tgantt.$keyboardNavigation.HeaderCell.prototype.bindAll(gantt.$keyboardNavigation.HeaderCell.prototype.keys);\r\n\r\n};","export default function(gantt) {\r\n\r\n\tgantt.$keyboardNavigation.TaskRow = function (taskId) {\r\n\t\tif (!taskId) {\r\n\t\t\tvar rootLevel = gantt.getChildren(gantt.config.root_id);\r\n\t\t\tif (rootLevel[0]) {\r\n\t\t\t\ttaskId = rootLevel[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.taskId = taskId;\r\n\t\tif (gantt.isTaskExists(this.taskId)) {\r\n\t\t\tthis.index = gantt.getTaskIndex(this.taskId);\r\n\t\t\tthis.globalIndex = gantt.getGlobalTaskIndex(this.taskId);\r\n\t\t\tthis.splitItem = !!gantt.getTask(this.taskId).$split_subtask;\r\n\t\t\tthis.parentId = gantt.getParent(this.taskId);\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.$keyboardNavigation.TaskRow.prototype = gantt._compose(\r\n\t\tgantt.$keyboardNavigation.KeyNavNode,\r\n\t\t{\r\n\t\t\t_handlers: null,\r\n\t\t\tisValid: function () {\r\n\t\t\t\treturn gantt.isTaskExists(this.taskId) && (gantt.getTaskIndex(this.taskId) > -1);\r\n\t\t\t},\r\n\t\t\tfallback: function () {\r\n\t\t\t\tif (!gantt.getVisibleTaskCount()) {\r\n\t\t\t\t\tvar header = new gantt.$keyboardNavigation.HeaderCell();\r\n\t\t\t\t\tif (!header.isValid()) return null;\r\n\t\t\t\t\telse return header;\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tif(!this.splitItem){\r\n\t\t\t\t\t\tvar nextIndex = -1;\r\n\t\t\t\t\t\t// GS-1393. When Gantt tries to restore the focus, it should rely on the global index\r\n\t\t\t\t\t\tif (gantt.getTaskByIndex(this.globalIndex - 1)) {\r\n\t\t\t\t\t\t\tnextIndex = this.globalIndex - 1;\r\n\t\t\t\t\t\t} else if (gantt.getTaskByIndex(this.globalIndex + 1)) {\r\n\t\t\t\t\t\t\tnextIndex = this.globalIndex + 1;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar globalIndex = this.globalIndex;\r\n\t\t\t\t\t\t\twhile (globalIndex >= 0) {\r\n\t\t\t\t\t\t\t\tif (gantt.getTaskByIndex(globalIndex)) {\r\n\t\t\t\t\t\t\t\t\tnextIndex = globalIndex;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tglobalIndex--;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (nextIndex > -1) {\r\n\t\t\t\t\t\t\treturn new gantt.$keyboardNavigation.TaskRow(gantt.getTaskByIndex(nextIndex).id);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\t\treturn new gantt.$keyboardNavigation.TaskRow(this.parentId);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tfromDomElement: function(el){\r\n\t\t\t\tif(gantt.config.keyboard_navigation_cells){\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar taskId = gantt.locate(el);\r\n\t\t\t\tif(gantt.isTaskExists(taskId)){\r\n\t\t\t\t\treturn new gantt.$keyboardNavigation.TaskRow(taskId);\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tgetNode: function () {\r\n\t\t\t\tif (gantt.isTaskExists(this.taskId) && gantt.isTaskVisible(this.taskId)) {\r\n\t\t\t\t\tif (gantt.config.show_grid) {\r\n\t\t\t\t\t\treturn gantt.$grid.querySelector(`.gantt_row[${gantt.config.task_attribute}=\"${String(this.taskId).replaceAll('\"', '\\\\\"')}\"]`);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn gantt.getTaskNode(this.taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tfocus: function (keptFocus) {\r\n\t\t\t\tif(!keptFocus) {\r\n\t\t\t\t\tconst pos = gantt.getTaskPosition(gantt.getTask(this.taskId));\r\n\t\t\t\t\tconst height = gantt.getTaskHeight(this.taskId);\r\n\t\t\t\t\tconst scroll = gantt.getScrollState();\r\n\r\n\t\t\t\t\tlet viewWidth;\r\n\t\t\t\t\tif(gantt.$task){\r\n\t\t\t\t\t\tviewWidth = gantt.$task.offsetWidth;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tviewWidth = scroll.inner_width;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet viewHeight;\r\n\t\t\t\t\tif(gantt.$grid_data || gantt.$task_data){\r\n\t\t\t\t\t\tviewHeight = (gantt.$grid_data || gantt.$task_data).offsetHeight;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tviewHeight = scroll.inner_height;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst visibleTimeline = gantt.config.show_chart && gantt.$ui.getView(\"timeline\");\r\n\r\n\t\t\t\t\tif (pos.top < scroll.y || pos.top + height > (scroll.y + viewHeight)) {\r\n\t\t\t\t\t\t// GS-2346: additional scrolling to be sure that the task will be in the required range\r\n\t\t\t\t\t\tgantt.scrollTo(null, pos.top - 20);\r\n\t\t\t\t\t} else if (gantt.config.scroll_on_click && visibleTimeline) {\r\n\t\t\t\t\t\t// horizontal scroll activated\r\n\t\t\t\t\t\tif (pos.left > (scroll.x + viewWidth)) { // scroll forward to the start of the task\r\n\t\t\t\t\t\t\tgantt.scrollTo(pos.left - gantt.config.task_scroll_offset);\r\n\t\t\t\t\t\t} else if (pos.left + pos.width < scroll.x) {  // scroll back to the end of the task\r\n\t\t\t\t\t\t\tgantt.scrollTo(pos.left + pos.width - gantt.config.task_scroll_offset);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgantt.$keyboardNavigation.KeyNavNode.prototype.focus.apply(this, [keptFocus]);\r\n\r\n\t\t\t\t// GS-152 if there are scrollbars with custom names, change their scroll position\r\n\t\t\t\tscrollGrid();\r\n\r\n\t\t\t\tfunction scrollGrid() {\r\n\t\t\t\t\tvar grid = gantt.$ui.getView(\"grid\");\r\n\t\t\t\t\tif (!grid || !grid.$grid_data){\r\n\t\t\t\t\t\t// GS-1805. Don't try to focus the row that doesn't exist\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar scrollPositionX = parseInt(grid.$grid.scrollLeft);\r\n\t\t\t\t\tvar scrollPositionY = parseInt(grid.$grid_data.scrollTop);\r\n\r\n\t\t\t\t\tvar attachedScrollbarHorizontal = grid.$config.scrollX;\r\n\r\n\t\t\t\t\tif (attachedScrollbarHorizontal && grid.$config.scrollable) {\r\n\t\t\t\t\t\tvar scrollbarHorizontal = gantt.$ui.getView(attachedScrollbarHorizontal);\r\n\t\t\t\t\t\tif (scrollbarHorizontal) {\r\n\t\t\t\t\t\t\tscrollbarHorizontal.scrollTo(scrollPositionX, scrollPositionY);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar attachedScrollbarVertical = grid.$config.scrollY;\r\n\r\n\t\t\t\t\tif (attachedScrollbarVertical) {\r\n\t\t\t\t\t\tvar scrollbarVertical = gantt.$ui.getView(attachedScrollbarVertical);\r\n\t\t\t\t\t\tif (scrollbarVertical) {\r\n\t\t\t\t\t\t\tscrollbarVertical.scrollTo(scrollPositionX, scrollPositionY);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\r\n\t\t\tkeys: {\r\n\t\t\t\t\"pagedown\": function () {\r\n\t\t\t\t\tif (gantt.getVisibleTaskCount()) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskRow(gantt.getTaskByIndex(gantt.getVisibleTaskCount() - 1).id));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"pageup\": function () {\r\n\t\t\t\t\tif (gantt.getVisibleTaskCount()) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskRow(gantt.getTaskByIndex(0).id));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"up\": function () {\r\n\t\t\t\t\tvar nextElement = null;\r\n\t\t\t\t\tvar prevTask = gantt.getPrev(this.taskId);\r\n\t\t\t\t\tif (!gantt.isTaskExists(prevTask)) {\r\n\t\t\t\t\t\tnextElement = new gantt.$keyboardNavigation.HeaderCell();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnextElement = new gantt.$keyboardNavigation.TaskRow(prevTask);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.moveTo(nextElement);\r\n\t\t\t\t},\r\n\t\t\t\t\"down\": function () {\r\n\t\t\t\t\tvar nextTask = gantt.getNext(this.taskId);\r\n\t\t\t\t\tif (gantt.isTaskExists(nextTask)) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskRow(nextTask));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\t\"shift+down\": function(){\r\n\t\t\t\t\tif(gantt.hasChild(this.taskId) && !gantt.getTask(this.taskId).$open){\r\n\t\t\t\t\t\tgantt.open(this.taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"shift+up\": function(){\r\n\t\t\t\t\tif(gantt.hasChild(this.taskId) && gantt.getTask(this.taskId).$open){\r\n\t\t\t\t\t\tgantt.close(this.taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"shift+right\": function() {\r\n\t\t\t\t\tif (gantt.isReadonly(this)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar prevId = gantt.getPrevSibling(this.taskId);\r\n\t\t\t\t\tif(gantt.isTaskExists(prevId) && !gantt.isChildOf(this.taskId, prevId)){\r\n\t\t\t\t\t\tvar parent = gantt.getTask(prevId);\r\n\t\t\t\t\t\tparent.$open = true;\r\n\t\t\t\t\t\tvar result = gantt.moveTask(this.taskId, -1, prevId);\r\n\t\t\t\t\t\tif(result !== false)\r\n\t\t\t\t\t\t\tgantt.updateTask(this.taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"shift+left\": function() {\r\n\t\t\t\t\tif (gantt.isReadonly(this)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar parent = gantt.getParent(this.taskId);\r\n\t\t\t\t\tif(gantt.isTaskExists(parent)){\r\n\t\t\t\t\t\tvar result =  gantt.moveTask(this.taskId, gantt.getTaskIndex(parent) + 1, gantt.getParent(parent));\r\n\t\t\t\t\t\tif(result !== false)\r\n\t\t\t\t\t\t\tgantt.updateTask(this.taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// select\r\n\t\t\t\t\"space\": function (e) {\r\n\t\t\t\t\tif (!gantt.isSelectedTask(this.taskId)) {\r\n\t\t\t\t\t\tgantt.selectTask(this.taskId);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tgantt.unselectTask(this.taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// collapse\r\n\t\t\t\t\"ctrl+left\": function (e) {\r\n\t\t\t\t\tgantt.close(this.taskId);\r\n\t\t\t\t},\r\n\t\t\t\t// expand\r\n\t\t\t\t\"ctrl+right\": function (e) {\r\n\t\t\t\t\tgantt.open(this.taskId);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// delete task\r\n\t\t\t\t\"delete\": function (e) {\r\n\t\t\t\t\tif (gantt.isReadonly(this)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgantt.$click.buttons[\"delete\"](this.taskId);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// open lightbox\r\n\t\t\t\t\"enter\": function () {\r\n\t\t\t\t\tif (gantt.isReadonly(this)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgantt.showLightbox(this.taskId);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t// add subtask\r\n\t\t\t\t\"ctrl+enter\": function () {\r\n\t\t\t\t\tif (gantt.isReadonly(this)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgantt.createTask({}, this.taskId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\tgantt.$keyboardNavigation.TaskRow.prototype.bindAll(gantt.$keyboardNavigation.TaskRow.prototype.keys);\r\n\r\n};","import * as domHelpers from \"../../../core/ui/utils/dom_helpers\";\r\nimport {replaceValidZeroId} from \"../../../utils/helpers\";\r\n\r\nexport default function(gantt) {\r\n\r\n\r\n\tgantt.$keyboardNavigation.TaskCell = function (taskId, index) {\r\n\t\ttaskId = replaceValidZeroId(taskId, gantt.config.root_id);\r\n\t\tif (!taskId) {\r\n\t\t\tvar rootLevel = gantt.getChildren(gantt.config.root_id);\r\n\t\t\tif (rootLevel[0]) {\r\n\t\t\t\ttaskId = rootLevel[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.taskId = taskId;\r\n\t\tthis.columnIndex = index || 0;\r\n\t\t// provided task may not exist, in this case node will be detectes as invalid\r\n\t\tif (gantt.isTaskExists(this.taskId)) {\r\n\t\t\tthis.index = gantt.getTaskIndex(this.taskId);\r\n\t\t\tthis.globalIndex = gantt.getGlobalTaskIndex(this.taskId);\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.$keyboardNavigation.TaskCell.prototype = gantt._compose(\r\n\t\tgantt.$keyboardNavigation.TaskRow,\r\n\t\t{\r\n\t\t\t_handlers: null,\r\n\t\t\tisValid: function () {\r\n\r\n\t\t\t\treturn gantt.$keyboardNavigation.TaskRow.prototype.isValid.call(this) && !!gantt.getGridColumns()[this.columnIndex];\r\n\t\t\t},\r\n\t\t\tfallback: function () {\r\n\r\n\t\t\t\tvar node = gantt.$keyboardNavigation.TaskRow.prototype.fallback.call(this);\r\n\t\t\t\tvar result = node;\r\n\t\t\t\tif (node instanceof gantt.$keyboardNavigation.TaskRow) {\r\n\t\t\t\t\tvar visibleColumns = gantt.getGridColumns();\r\n\t\t\t\t\tvar index = this.columnIndex;\r\n\t\t\t\t\twhile (index >= 0) {\r\n\t\t\t\t\t\tif (visibleColumns[index])\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tindex--;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (visibleColumns[index]) {\r\n\t\t\t\t\t\tresult = new gantt.$keyboardNavigation.TaskCell(node.taskId, index);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn result;\r\n\t\t\t},\r\n\r\n\t\t\tfromDomElement: function(el){\r\n\t\t\t\tif(!gantt.config.keyboard_navigation_cells){\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar taskId = gantt.locate(el);\r\n\t\t\t\tif(gantt.isTaskExists(taskId)){\r\n\t\t\t\t\tvar index = 0;\r\n\t\t\t\t\tvar cellElement = domHelpers.locateAttribute(el, \"data-column-index\");\r\n\r\n\t\t\t\t\tif(cellElement){\r\n\t\t\t\t\t\tindex = cellElement.getAttribute(\"data-column-index\")*1;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn new gantt.$keyboardNavigation.TaskCell(taskId, index);\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tgetNode: function () {\r\n\t\t\t\tif (gantt.isTaskExists(this.taskId) && (gantt.isTaskVisible(this.taskId) || gantt.config.show_tasks_outside_timescale)) {\r\n\t\t\t\t\tif (gantt.config.show_grid && gantt.$grid) {\r\n\t\t\t\t\t\tvar row = gantt.$grid.querySelector(\".gantt_row[\" + gantt.config.task_attribute + \"='\" + this.taskId + \"']\");\r\n\t\t\t\t\t\tif(!row)\r\n\t\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t\treturn row.querySelector(\"[data-column-index='\"+this.columnIndex+\"']\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn gantt.getTaskNode(this.taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tkeys: {\r\n\t\t\t\t\"up\": function () {\r\n\r\n\t\t\t\t\tvar nextElement = null;\r\n\t\t\t\t\tvar prevTask = gantt.getPrev(this.taskId);\r\n\t\t\t\t\tif (!gantt.isTaskExists(prevTask)) {\r\n\t\t\t\t\t\tnextElement = new gantt.$keyboardNavigation.HeaderCell(this.columnIndex);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnextElement = new gantt.$keyboardNavigation.TaskCell(prevTask, this.columnIndex);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.moveTo(nextElement);\r\n\t\t\t\t},\r\n\t\t\t\t\"down\": function () {\r\n\t\t\t\t\tvar nextTask = gantt.getNext(this.taskId);\r\n\t\t\t\t\tif (gantt.isTaskExists(nextTask)) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(nextTask, this.columnIndex));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"left\": function () {\r\n\t\t\t\t\tif (this.columnIndex > 0) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(this.taskId, this.columnIndex - 1));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"right\": function () {\r\n\t\t\t\t\tvar columns = gantt.getGridColumns();\r\n\t\t\t\t\tif (this.columnIndex < columns.length - 1) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(this.taskId, this.columnIndex + 1));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\r\n\t\t\t\t\"end\": function () {\r\n\t\t\t\t\tvar columns = gantt.getGridColumns();\r\n\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(this.taskId, columns.length - 1));\r\n\t\t\t\t},\r\n\t\t\t\t\"home\": function () {\r\n\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(this.taskId, 0));\r\n\t\t\t\t},\r\n\t\t\t\t\"pagedown\": function () {\r\n\t\t\t\t\tif (gantt.getVisibleTaskCount()) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(gantt.getTaskByIndex(gantt.getVisibleTaskCount() - 1).id, this.columnIndex));\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"pageup\": function () {\r\n\t\t\t\t\tif (gantt.getVisibleTaskCount()) {\r\n\t\t\t\t\t\tthis.moveTo(new gantt.$keyboardNavigation.TaskCell(gantt.getTaskByIndex(0).id, this.columnIndex));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\r\n\r\n\tgantt.$keyboardNavigation.TaskCell.prototype.bindAll(gantt.$keyboardNavigation.TaskRow.prototype.keys);\r\n\tgantt.$keyboardNavigation.TaskCell.prototype.bindAll(gantt.$keyboardNavigation.TaskCell.prototype.keys);\r\n\r\n};","export default function(gantt) {\r\n\r\n\t(function () {\r\n\t\tvar modalsStack = [];\r\n\r\n\t\tfunction isModal() {\r\n\t\t\treturn !!modalsStack.length;\r\n\t\t}\r\n\r\n\t\tfunction afterPopup(box) {\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tif (!isModal()){\r\n\t\t\t\t\tif(!gantt.$destroyed){\r\n\t\t\t\t\t\tgantt.focus();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, 1);\r\n\t\t}\r\n\r\n\t\tfunction startModal(box) {\r\n\t\t\tgantt.eventRemove(box, \"keydown\", trapFocus);\r\n\t\t\tgantt.event(box, \"keydown\", trapFocus);\r\n\t\t\tmodalsStack.push(box);\r\n\t\t\t//gantt.$keyboardNavigation.dispatcher.disable();\r\n\t\t}\r\n\r\n\t\tfunction endModal() {\r\n\t\t\tvar box = modalsStack.pop();\r\n\t\t\tif (box) {\r\n\t\t\t\tgantt.eventRemove(box, \"keydown\", trapFocus);\r\n\t\t\t}\r\n\t\t\tafterPopup(box);\r\n\r\n\t\t}\r\n\r\n\r\n\t\tfunction isTopModal(box) {\r\n\t\t\treturn box == modalsStack[modalsStack.length - 1];\r\n\t\t}\r\n\r\n\t\tfunction trapFocus(event) {\r\n\t\t\tvar target = event.currentTarget;\r\n\t\t\tif (!isTopModal(target)) return;\r\n\r\n\t\t\tgantt.$keyboardNavigation.trapFocus(target, event);\r\n\t\t}\r\n\r\n\t\tfunction traceLightbox() {\r\n\t\t\tstartModal(gantt.getLightbox());\r\n\t\t}\r\n\r\n\t\tgantt.attachEvent(\"onLightbox\", traceLightbox);\r\n\t\tgantt.attachEvent(\"onAfterLightbox\", endModal);\r\n\t\tgantt.attachEvent(\"onLightboxChange\", function () {\r\n\t\t\tendModal();\r\n\t\t\ttraceLightbox();\r\n\t\t});\r\n\r\n\r\n\t\tgantt.attachEvent(\"onAfterQuickInfo\", function () {\r\n\t\t\tafterPopup();\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onMessagePopup\", function (box) {\r\n\t\t\tsaveFocus();\r\n\t\t\tstartModal(box);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterMessagePopup\", function () {\r\n\t\t\tendModal();\r\n\t\t\trestoreFocus();\r\n\t\t});\r\n\r\n\t\tvar focusElement = null;\r\n\r\n\t\tfunction saveFocus() {\r\n\t\t\tfocusElement = gantt.utils.dom.getActiveElement();\r\n\t\t}\r\n\r\n\t\tfunction restoreFocus() {\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tif (focusElement) {\r\n\t\t\t\t\tfocusElement.focus();\r\n\t\t\t\t\tfocusElement = null;\r\n\t\t\t\t}\r\n\t\t\t}, 1);\r\n\t\t}\r\n\r\n\t\tgantt.$keyboardNavigation.isModal = isModal;\r\n\r\n\r\n\t})();\r\n\r\n};","export default function(gantt) {\r\n\r\n\tgantt.$keyboardNavigation.dispatcher = {\r\n\t\tisActive: false,\r\n\t\tactiveNode: null,\r\n\t\tglobalNode: new gantt.$keyboardNavigation.GanttNode(),\r\n\r\n\t\tenable: function () {\r\n\t\t\tthis.isActive = true;\r\n\t\t\tthis.setActiveNode(this.getActiveNode());\r\n\t\t},\r\n\r\n\t\tdisable: function () {\r\n\t\t\tthis.isActive = false;\r\n\t\t},\r\n\r\n\t\tisEnabled: function () {\r\n\t\t\treturn !!this.isActive;\r\n\t\t},\r\n\r\n\t\tgetDefaultNode: function () {\r\n\t\t\tvar node;\r\n\t\t\tif (gantt.config.keyboard_navigation_cells) {\r\n\t\t\t\tnode = new gantt.$keyboardNavigation.TaskCell();\r\n\t\t\t} else {\r\n\t\t\t\tnode = new gantt.$keyboardNavigation.TaskRow();\r\n\t\t\t}\r\n\r\n\t\t\tif (!node.isValid()) {\r\n\t\t\t\tnode = node.fallback();\r\n\t\t\t}\r\n\t\t\treturn node;\r\n\t\t},\r\n\r\n\t\tsetDefaultNode: function () {\r\n\t\t\tthis.setActiveNode(this.getDefaultNode());\r\n\t\t},\r\n\r\n\t\tgetActiveNode: function () {\r\n\t\t\tvar node = this.activeNode;\r\n\t\t\tif (node && !node.isValid()) {\r\n\t\t\t\tnode = node.fallback();\r\n\t\t\t}\r\n\t\t\treturn node;\r\n\t\t},\r\n\r\n\t\tfromDomElement: function(e){\r\n\t\t\tvar inputs = [\r\n\t\t\t\tgantt.$keyboardNavigation.TaskRow,\r\n\t\t\t\tgantt.$keyboardNavigation.TaskCell,\r\n\t\t\t\tgantt.$keyboardNavigation.HeaderCell\r\n\t\t\t];\r\n\t\t\tfor(var i = 0; i < inputs.length; i++){\r\n\t\t\t\tif(inputs[i].prototype.fromDomElement){\r\n\t\t\t\t\tvar node = inputs[i].prototype.fromDomElement(e);\r\n\t\t\t\t\tif(node) return node;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\r\n\t\tfocusGlobalNode: function () {\r\n\t\t\tthis.blurNode(this.globalNode);\r\n\t\t\tthis.focusNode(this.globalNode);\r\n\t\t},\r\n\r\n\t\tsetActiveNode: function (el) {\r\n\t\t\t//console.trace()\r\n\t\t\tvar focusChanged = true;\r\n\t\t\tif (this.activeNode) {\r\n\t\t\t\tif (this.activeNode.compareTo(el)) {\r\n\t\t\t\t\tfocusChanged = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.isEnabled()) {\r\n\t\t\t\tif(focusChanged)\r\n\t\t\t\t\tthis.blurNode(this.activeNode);\r\n\r\n\t\t\t\tthis.activeNode = el;\r\n\t\t\t\tthis.focusNode(this.activeNode, !focusChanged);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tfocusNode: function (el, keptFocus) {\r\n\t\t\tif (el && el.focus) {\r\n\t\t\t\tel.focus(keptFocus);\r\n\t\t\t}\r\n\t\t},\r\n\t\tblurNode: function (el) {\r\n\t\t\tif (el && el.blur) {\r\n\t\t\t\tel.blur();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tkeyDownHandler: function (e) {\r\n\r\n\t\t\tif (gantt.$keyboardNavigation.isModal())\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (!this.isEnabled())\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif(e.defaultPrevented){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar ganttNode = this.globalNode;\r\n\r\n\t\t\tvar command = gantt.$keyboardNavigation.shortcuts.getCommandFromEvent(e);\r\n\r\n\t\t\tvar activeElement = this.getActiveNode();\r\n\t\t\tvar eventFacade = gantt.$keyboardNavigation.facade;\r\n\t\t\tif(eventFacade.callEvent(\"onKeyDown\", [command, e]) === false){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (!activeElement) {\r\n\t\t\t\tthis.setDefaultNode();\r\n\t\t\t} else if (activeElement.findHandler(command)) {\r\n\t\t\t\tactiveElement.doAction(command, e);\r\n\t\t\t} else if (ganttNode.findHandler(command)) {\r\n\t\t\t\tganttNode.doAction(command, e);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\t_timeout: null,\r\n\t\tawaitsFocus: function(){\r\n\t\t\treturn this._timeout !== null;\r\n\t\t},\r\n\t\tdelay: function(callback, delay){\r\n\r\n\t\t\tclearTimeout(this._timeout);\r\n\t\t\tthis._timeout = setTimeout(gantt.bind(function(){\r\n\t\t\t\tthis._timeout = null;\r\n\t\t\t\tcallback();\r\n\t\t\t}, this)  , delay || 1);\r\n\r\n\t\t},\r\n\t\tclearDelay: function(){\r\n\t\t\tclearTimeout(this._timeout);\r\n\t\t}\r\n\t};\r\n\r\n};","import eventable from \"../utils/eventable\";\r\nimport * as domHelpers from \"../core/ui/utils/dom_helpers\";\r\n\r\nimport keyboard_shortcuts from \"./keyboard_navigation/common/keyboard_shortcuts\";\r\nimport eventhandler from \"./keyboard_navigation/common/eventhandler\";\r\nimport trap_modal_focus from \"./keyboard_navigation/common/trap_modal_focus\";\r\nimport gantt_node from \"./keyboard_navigation/elements/gantt_node\";\r\nimport nav_node from \"./keyboard_navigation/elements/nav_node\";\r\nimport header_cell from \"./keyboard_navigation/elements/header_cell\";\r\nimport task_row from \"./keyboard_navigation/elements/task_row\";\r\nimport task_cell from \"./keyboard_navigation/elements/task_cell\";\r\nimport modals from \"./keyboard_navigation/modals\";\r\nimport core from \"./keyboard_navigation/core\";\r\n\r\n\r\n\r\nexport default function(gantt){\r\n\tfunction setupKeyNav(gantt){\r\n\t\tgantt.config.keyboard_navigation = true;\r\n\t\tgantt.config.keyboard_navigation_cells = false;\r\n\r\n\t\tgantt.$keyboardNavigation = {};\r\n\r\n\t\tgantt._compose = function(){\r\n\t\t\tvar parts = Array.prototype.slice.call(arguments, 0);\r\n\t\t\tvar res = {};\r\n\t\t\tfor(var i = 0; i < parts.length; i++){\r\n\t\t\t\tvar obj = parts[i];\r\n\t\t\t\tif(typeof obj == \"function\"){\r\n\t\t\t\t\tobj = new obj();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor(var p in obj){\r\n\t\t\t\t\tres[p] = obj[p];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t};\r\n\r\n\t\tkeyboard_shortcuts(gantt);\r\n\t\teventhandler(gantt);\r\n\t\ttrap_modal_focus(gantt);\r\n\t\tgantt_node(gantt);\r\n\t\tnav_node(gantt);\r\n\t\theader_cell(gantt);\r\n\t\ttask_row(gantt);\r\n\t\ttask_cell(gantt);\r\n\t\tmodals(gantt);\r\n\t\tcore(gantt);\r\n\r\n\r\n\t\t(function(){\r\n\t\t\tvar dispatcher = gantt.$keyboardNavigation.dispatcher;\r\n\r\n\t\t\tdispatcher.isTaskFocused = function(id){\r\n\t\t\t\tvar node = dispatcher.activeNode;\r\n\t\t\t\tif(node instanceof gantt.$keyboardNavigation.TaskRow || node instanceof gantt.$keyboardNavigation.TaskCell) {\r\n\t\t\t\t\tif (node.taskId == id) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t};\r\n\r\n\t\t\tvar keyDownHandler = function(e){\r\n\t\t\t\tif(!gantt.config.keyboard_navigation) return;\r\n\t\t\t\t// GS-734 & GS-1078: we don't need keyboard navigation inside inline editors\r\n\t\t\t\tif(!gantt.config.keyboard_navigation_cells && isInlineEditorCell(e)) return;\r\n\r\n\t\t\t\tif (isNoKeyboardNavigationElement(e) || isLightboxElement(e)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn dispatcher.keyDownHandler(e);\r\n\t\t\t};\r\n\r\n\t\t\tvar focusHandler = function(e){\r\n\t\t\t\tif(dispatcher.$preventDefault){\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tgantt.$container.blur();\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t// do nothing if key-nav focus is already planned\r\n\t\t\t\t} else if (!dispatcher.awaitsFocus()) {\r\n\t\t\t\t\t// otherwise - re-focus key-nav element on gantt focus\r\n\t\t\t\t\tdispatcher.focusGlobalNode();\r\n\t\t\t\t}\r\n\r\n\t\t\t};\r\n\r\n\t\t\tvar reFocusActiveNode = function(){\r\n\t\t\t\tif(!dispatcher.isEnabled())\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tconst outsideGantt = !domHelpers.isChildOf(document.activeElement, gantt.$container) && document.activeElement.localName != \"body\";\r\n\t\t\t\tvar activeNode = dispatcher.getActiveNode();\r\n\t\t\t\tif(!activeNode || outsideGantt)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tvar domElement = activeNode.getNode();\r\n\t\t\t\tvar top, left;\r\n\t\t\t\tif(domElement && domElement.parentNode){\r\n\t\t\t\t\ttop = domElement.parentNode.scrollTop;\r\n\t\t\t\t\tleft = domElement.parentNode.scrollLeft;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tactiveNode.focus(true);\r\n\r\n\t\t\t\tif(domElement && domElement.parentNode){\r\n\t\t\t\t\tdomElement.parentNode.scrollTop = top;\r\n\t\t\t\t\tdomElement.parentNode.scrollLeft = left;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\r\n\t\t\tgantt.attachEvent(\"onDataRender\", function(){\r\n\t\t\t\tif(!gantt.config.keyboard_navigation) return;\r\n\t\t\t\treFocusActiveNode();\r\n\t\t\t});\r\n\r\n\t\t\tgantt.attachEvent(\"onGanttRender\", function(){\r\n\t\t\t\t//GS-2230: in case if `getGanttInstance` created without container\r\n\t\t\t\tif(!gantt.$root) return;\r\n\t\t\t\tgantt.eventRemove(gantt.$root, \"keydown\", keyDownHandler);\r\n\t\t\t\tgantt.eventRemove(gantt.$container, \"focus\", focusHandler);\r\n\t\t\t\tgantt.eventRemove(gantt.$container, \"mousedown\", mousedownHandler);\r\n\r\n\t\t\t\tif(gantt.config.keyboard_navigation){\r\n\r\n\t\t\t\t\tgantt.event(gantt.$root, \"keydown\", keyDownHandler);\r\n\t\t\t\t\tgantt.event(gantt.$container, \"focus\", focusHandler);\r\n\t\t\t\t\tgantt.event(gantt.$container, \"mousedown\", mousedownHandler);\r\n\t\t\t\t\tgantt.$container.setAttribute(\"tabindex\", \"0\");\r\n\r\n\t\t\t\t}else{\r\n\t\t\t\t\tgantt.$container.removeAttribute(\"tabindex\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tfunction getTaskNodeConstructor(){\r\n\t\t\t\tif (gantt.config.keyboard_navigation_cells) {\r\n\t\t\t\t\treturn gantt.$keyboardNavigation.TaskCell;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn gantt.$keyboardNavigation.TaskRow;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction isInlineEditorCell(e){\r\n\t\t\t\treturn !!domHelpers.closest(e.target, \".gantt_grid_editor_placeholder\");\r\n\t\t\t}\r\n\t\t\t// GS-1445. Cancel keyboard navigation within custom elements\r\n\t\t\tfunction isNoKeyboardNavigationElement(e){\r\n\t\t\t\treturn !!domHelpers.closest(e.target, \".no_keyboard_navigation\");\r\n\t\t\t}\r\n\t\t\tfunction isLightboxElement(e){\r\n\t\t\t\treturn !!domHelpers.closest(e.target, \".gantt_cal_light\");\r\n\t\t\t}\r\n\r\n\t\t\tfunction mousedownHandler(e){\r\n\t\t\t\tif(!gantt.config.keyboard_navigation) return true;\r\n\t\t\t\t// GS-734 & GS-1078: we don't need keyboard navigation inside inline editors\r\n\t\t\t\tif(!gantt.config.keyboard_navigation_cells && isInlineEditorCell(e)) return true;\r\n\r\n\t\t\t\tif (isNoKeyboardNavigationElement(e)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar focusNode;\r\n\t\t\t\tvar locateTask = dispatcher.fromDomElement(e);\r\n\t\t\t\tif(locateTask){\r\n\t\t\t\t\t//var node = getTaskNodeConstructor();\r\n\t\t\t\t\tif(dispatcher.activeNode instanceof gantt.$keyboardNavigation.TaskCell && domHelpers.isChildOf(e.target, gantt.$task)){\r\n\t\t\t\t\t\tlocateTask = new gantt.$keyboardNavigation.TaskCell(locateTask.taskId, dispatcher.activeNode.columnIndex);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfocusNode = locateTask;\r\n\t\t\t\t\t// GS-1541 and GS-1542. If you click on the task row element (possible with custom styles)\r\n\t\t\t\t\t// or the task bar element, there is no information about the target grid cell,\r\n\t\t\t\t\t// so we need to set focus on the first visible cell\r\n\t\t\t\t\tconst visibleGrid = gantt.config.show_grid && gantt.$ui.getView(\"grid\");\r\n\t\t\t\t\tif(visibleGrid && gantt.config.keyboard_navigation_cells){\r\n\t\t\t\t\t\tconst taskRow = e.target.classList.contains(\"gantt_row\");\r\n\t\t\t\t\t\tconst taskBar = e.target.closest(\".gantt_task_line\");\r\n\r\n\t\t\t\t\t\tconst gridLeft = gantt.utils.dom.getNodePosition(gantt.$grid).x;\r\n\t\t\t\t\t\tconst gridRight = gridLeft + gantt.$grid.offsetWidth;\r\n\t\t\t\t\t\tconst nodePosition = gantt.utils.dom.getNodePosition(document.activeElement).x;\r\n\t\t\t\t\t\tconst nodeHidden = nodePosition < gridLeft || gridRight < nodePosition;\r\n\r\n\t\t\t\t\t\tif (taskRow || (taskBar && nodeHidden)){\r\n\t\t\t\t\t\t\tlet scrollPosition = gantt.$grid.scrollLeft;\r\n\t\t\t\t\t\t\tconst rightPosition = scrollPosition + gantt.$grid.offsetWidth;\r\n\t\t\t\t\t\t\tlet positionX = 0;\r\n\t\t\t\t\t\t\tif (taskRow){\r\n\t\t\t\t\t\t\t\tscrollPosition = gantt.utils.dom.getRelativeEventPosition(e, gantt.$grid).x;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tfor (let i = 0; i < gantt.config.columns.length; i++) {\r\n\t\t\t\t\t\t\t\tconst column = gantt.config.columns[i];\r\n\t\t\t\t\t\t\t\tif (column.hide){\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tpositionX += column.width;\r\n\t\t\t\t\t\t\t\tif (scrollPosition < positionX){\r\n\t\t\t\t\t\t\t\t\tif (rightPosition < positionX){\r\n\t\t\t\t\t\t\t\t\t\tpositionX -= column.width;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tfocusNode.columnIndex = i;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (focusNode) {\r\n\t\t\t\t\tif (!dispatcher.isEnabled()) {\r\n\t\t\t\t\t\tdispatcher.activeNode = focusNode;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdispatcher.delay(function () {\r\n\t\t\t\t\t\t\tdispatcher.setActiveNode(focusNode);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// empty click should drop focus from gantt, insert of reselecting default node\r\n\t\t\t\t\tdispatcher.$preventDefault = true;\r\n\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\tdispatcher.$preventDefault = false;\r\n\t\t\t\t\t}, 300);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar onReady = gantt.attachEvent(\"onGanttReady\", function(){\r\n\t\t\t\t// restore focus on repainted tasks\r\n\t\t\t\tgantt.detachEvent(onReady);\r\n\r\n\t\t\t\tgantt.$data.tasksStore.attachEvent(\"onStoreUpdated\", function(id){\r\n\t\t\t\t\tif (gantt.config.keyboard_navigation && dispatcher.isEnabled()) {\r\n\t\t\t\t\t\tconst currentNode = dispatcher.getActiveNode();\r\n\t\t\t\t\t\tconst grid = gantt.$ui.getView(\"grid\");\r\n\t\t\t\t\t\tif (!grid || !grid.$grid_data){\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst top = grid.getItemTop(id);\r\n\t\t\t\t\t\tconst gridDataTopScroll = grid.$grid_data.scrollTop;\r\n\t\t\t\t\t\tconst gridDataBottomScroll = gridDataTopScroll + grid.$grid_data.getBoundingClientRect().height;\r\n\t\t\t\t\t\tif(currentNode && currentNode.taskId == id){\r\n\t\t\t\t\t\t\t// GS-2539: Don't refocus the node if it is selected and outside the visible range in the grid\r\n\t\t\t\t\t\t\tif(gridDataTopScroll <= top && gridDataBottomScroll >= top){\r\n\t\t\t\t\t\t\t\treFocusActiveNode();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(gantt._smart_render){\r\n\t\t\t\t\tvar updateRender = gantt._smart_render._redrawTasks;\r\n\t\t\t\t\tgantt._smart_render._redrawTasks = function(renderers, items){\r\n\t\t\t\t\t\tif(gantt.config.keyboard_navigation && dispatcher.isEnabled()){\r\n\t\t\t\t\t\t\tvar currentNode = dispatcher.getActiveNode();\r\n\t\t\t\t\t\t\tif(currentNode && currentNode.taskId !== undefined){\r\n\t\t\t\t\t\t\t\tvar focusedItemVisible = false;\r\n\t\t\t\t\t\t\t\tfor(var i = 0; i < items.length; i++){\r\n\t\t\t\t\t\t\t\t\tif(items[i].id == currentNode.taskId && items[i].start_date){\r\n\t\t\t\t\t\t\t\t\t\tfocusedItemVisible = true;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif(!focusedItemVisible){\r\n\t\t\t\t\t\t\t\t\titems.push(gantt.getTask(currentNode.taskId));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar res = updateRender.apply(this, arguments);\r\n\r\n\t\t\t\t\t\treturn res;\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\r\n\t\t\tlet createdTaskId = null;\r\n\t\t\tlet keepFocusOnNewTask = false;\r\n\t\t\tgantt.attachEvent(\"onTaskCreated\", function (task) {\r\n\t\t\t\tcreatedTaskId = task.id;\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\r\n\t\t\tgantt.attachEvent(\"onAfterTaskAdd\", function(id,item){\r\n\t\t\t\tif(!gantt.config.keyboard_navigation) return true;\r\n\t\t\t\tif(dispatcher.isEnabled()){\r\n\r\n\t\t\t\t\t// GS-1394. After adding a new task, the focus shouldn't change to the placeholder task\r\n\t\t\t\t\tif (id == createdTaskId) {\r\n\t\t\t\t\t\tkeepFocusOnNewTask = true;\r\n\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\tkeepFocusOnNewTask = false;\r\n\t\t\t\t\t\t\tcreatedTaskId = null;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (keepFocusOnNewTask && item.type == gantt.config.types.placeholder) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar columnIndex = 0;\r\n\t\t\t\t\tvar node = dispatcher.activeNode;\r\n\t\t\t\t\tif(node instanceof gantt.$keyboardNavigation.TaskCell){\r\n\t\t\t\t\t\tcolumnIndex = node.columnIndex;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar nodeConstructor = getTaskNodeConstructor();\r\n\r\n\t\t\t\t\tif (item.type == gantt.config.types.placeholder && gantt.config.placeholder_task.focusOnCreate === false) {\r\n\t\t\t\t\t\t// do not focus on the placeholder task\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdispatcher.setActiveNode(new nodeConstructor(id, columnIndex));\r\n\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tgantt.attachEvent(\"onTaskIdChange\", function(oldId, newId){\r\n\t\t\t\tif(!gantt.config.keyboard_navigation) return true;\r\n\r\n\t\t\t\tvar node = dispatcher.activeNode;\r\n\t\t\t\tif(dispatcher.isTaskFocused(oldId)){\r\n\t\t\t\t\tnode.taskId = newId;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\r\n\t\t\tvar interval = setInterval(function(){\r\n\t\t\t\tif(!gantt.config.keyboard_navigation) return;\r\n\t\t\t\tif(!dispatcher.isEnabled()){\r\n\t\t\t\t\tdispatcher.enable();\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}, 500);\r\n\r\n\t\t\tgantt.attachEvent(\"onDestroy\", function(){\r\n\t\t\t\tclearInterval(interval);\r\n\t\t\t});\r\n\r\n\t\t\tfunction getScopeName(obj){\r\n\t\t\t\tif(obj instanceof gantt.$keyboardNavigation.GanttNode){\r\n\t\t\t\t\treturn \"gantt\";\r\n\t\t\t\t}else if(obj instanceof gantt.$keyboardNavigation.HeaderCell){\r\n\t\t\t\t\treturn \"headerCell\";\r\n\t\t\t\t}else if(obj instanceof gantt.$keyboardNavigation.TaskRow){\r\n\t\t\t\t\treturn \"taskRow\";\r\n\t\t\t\t}else if(obj instanceof gantt.$keyboardNavigation.TaskCell){\r\n\t\t\t\t\treturn \"taskCell\";\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tfunction getScope(mode){\r\n\t\t\t\tvar scopes = {\r\n\t\t\t\t\t\"gantt\":gantt.$keyboardNavigation.GanttNode,\r\n\t\t\t\t\t\"headerCell\": gantt.$keyboardNavigation.HeaderCell,\r\n\t\t\t\t\t\"taskRow\": gantt.$keyboardNavigation.TaskRow,\r\n\t\t\t\t\t\"taskCell\": gantt.$keyboardNavigation.TaskCell\r\n\t\t\t\t};\r\n\r\n\t\t\t\treturn scopes[mode] || scopes.gantt;\r\n\t\t\t}\r\n\r\n\t\t\tfunction findVisibleColumnIndex(columnName) {\r\n\t\t\t\tvar columns = gantt.getGridColumns();\r\n\t\t\t\tfor (var i = 0; i < columns.length; i++){\r\n\t\t\t\t\tif(columns[i].name == columnName){\r\n\t\t\t\t\t\treturn i;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\r\n\t\t\tvar keyNavFacade = {};\r\n\t\t\teventable(keyNavFacade);\r\n\t\t\tgantt.mixin(keyNavFacade, {\r\n\t\t\t\taddShortcut: function(shortcut, handler, scope){\r\n\t\t\t\t\tvar scopeObject = getScope(scope);\r\n\t\t\t\t\tif(scopeObject){\r\n\t\t\t\t\t\tscopeObject.prototype.bind(shortcut, handler);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tgetShortcutHandler: function(shortcut, scope){\r\n\t\t\t\t\tvar commands = gantt.$keyboardNavigation.shortcuts.parse(shortcut);\r\n\t\t\t\t\tif(commands.length){\r\n\t\t\t\t\t\treturn keyNavFacade.getCommandHandler(commands[0], scope);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tgetCommandHandler: function(command, scope){\r\n\t\t\t\t\tvar scopeObject = getScope(scope);\r\n\t\t\t\t\tif(scopeObject){\r\n\t\t\t\t\t\tif(command){\r\n\t\t\t\t\t\t\treturn scopeObject.prototype.findHandler(command);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tremoveShortcut: function(shortcut, scope){\r\n\t\t\t\t\tvar scopeObject = getScope(scope);\r\n\t\t\t\t\tif(scopeObject){\r\n\t\t\t\t\t\tscopeObject.prototype.unbind(shortcut);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tfocus: function(config){\r\n\t\t\t\t\tvar type = config ? config.type : null;\r\n\t\t\t\t\tvar constructor = getScope(type);\r\n\t\t\t\t\tvar node;\r\n\t\t\t\t\tswitch (type){\r\n\t\t\t\t\t\tcase \"taskCell\":\r\n\t\t\t\t\t\t\tnode = new constructor(config.id, findVisibleColumnIndex(config.column));\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"taskRow\":\r\n\t\t\t\t\t\t\tnode = new constructor(config.id);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"headerCell\":\r\n\t\t\t\t\t\t\tnode = new constructor(findVisibleColumnIndex(config.column));\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdispatcher.delay(function(){\r\n\t\t\t\t\t\tif(node){\r\n\t\t\t\t\t\t\tdispatcher.setActiveNode(node);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tdispatcher.enable();\r\n\t\t\t\t\t\t\tif(!dispatcher.getActiveNode()){\r\n\r\n\t\t\t\t\t\t\t\tdispatcher.setDefaultNode();\r\n\t\t\t\t\t\t\t}else{\r\n\r\n\t\t\t\t\t\t\t\tif(!dispatcher.awaitsFocus()){\r\n\t\t\t\t\t\t\t\t\tdispatcher.enable();\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\r\n\t\t\t\tgetActiveNode: function(){\r\n\t\t\t\t\tif(dispatcher.isEnabled()){\r\n\t\t\t\t\t\tvar node = dispatcher.getActiveNode();\r\n\t\t\t\t\t\tvar scope = getScopeName(node);\r\n\t\t\t\t\t\tvar columns = gantt.getGridColumns();\r\n\t\t\t\t\t\tswitch (scope){\r\n\t\t\t\t\t\t\tcase \"taskCell\":\r\n\t\t\t\t\t\t\t\treturn {type:\"taskCell\", id:node.taskId, column:columns[node.columnIndex].name};\r\n\t\t\t\t\t\t\tcase \"taskRow\":\r\n\t\t\t\t\t\t\t\treturn {type:\"taskRow\", id:node.taskId};\r\n\t\t\t\t\t\t\tcase \"headerCell\":\r\n\t\t\t\t\t\t\t\treturn {type:\"headerCell\", column:columns[node.index].name};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tgantt.$keyboardNavigation.facade = keyNavFacade;\r\n\r\n\t\t\tgantt.ext.keyboardNavigation = keyNavFacade;\r\n\t\t\tgantt.focus = function(){\r\n\t\t\t\tkeyNavFacade.focus();\r\n\t\t\t};\r\n\t\t\tgantt.addShortcut = keyNavFacade.addShortcut;\r\n\t\t\tgantt.getShortcutHandler = keyNavFacade.getShortcutHandler;\r\n\t\t\tgantt.removeShortcut = keyNavFacade.removeShortcut;\r\n\t\t})();\r\n\r\n\r\n\t}\r\n\r\n\tsetupKeyNav(gantt);\r\n\r\n\r\n\r\n};","\r\nexport default function(gantt){\r\n\r\nif(!gantt._markers) {\r\n\tgantt._markers = gantt.createDatastore({\r\n\t\tname: \"marker\",\r\n\t\tinitItem: function (marker) {\r\n\t\t\tmarker.id = marker.id || gantt.uid();\r\n\t\t\treturn marker;\r\n\t\t}\r\n\t});\r\n}\r\n\r\ngantt.config.show_markers = true;\r\n\r\nfunction render_marker(marker){\r\n\tif(!gantt.config.show_markers)\r\n\t\treturn false;\r\n\r\n\tif(!marker.start_date)\r\n\t\treturn false;\r\n\r\n\tvar state = gantt.getState();\r\n\tif(+marker.start_date > +state.max_date)\r\n\t\treturn;\r\n\tif((!marker.end_date || +marker.end_date < +state.min_date) && +marker.start_date < +state.min_date)\r\n\t\treturn;\r\n\r\n\tvar div = document.createElement(\"div\");\r\n\r\n\tdiv.setAttribute(\"data-marker-id\", marker.id);\r\n\r\n\tvar css = \"gantt_marker\";\r\n\tif(gantt.templates.marker_class)\r\n\t\tcss += \" \" + gantt.templates.marker_class(marker);\r\n\r\n\tif(marker.css){\r\n\t\tcss += \" \" + marker.css;\r\n\t}\r\n\r\n\tif(gantt.templates.marker_class)\r\n\t\tcss += \" \" + gantt.templates.marker_class(marker);\r\n\r\n\tif(marker.title){\r\n\t\tdiv.title = marker.title;\r\n\t}\r\n\tdiv.className = css;\r\n\r\n\tvar start = gantt.posFromDate(marker.start_date);\r\n\tdiv.style.left = start + \"px\";\r\n\tlet markerHeight = Math.max(gantt.getRowTop(gantt.getVisibleTaskCount()), 0) + \"px\";\r\n\tif (gantt.config.timeline_placeholder && gantt.$task_data){\r\n\t\tmarkerHeight = gantt.$task_data.scrollHeight + \"px\";\r\n\t}\r\n\tdiv.style.height = markerHeight;\r\n\tif(marker.end_date){\r\n\t\tvar end = gantt.posFromDate(marker.end_date);\r\n\t\tdiv.style.width = Math.max((end - start), 0) + \"px\";\r\n\r\n\t}\r\n\r\n\tif(marker.text){\r\n\t\tdiv.innerHTML = \"<div class='gantt_marker_content' >\" + marker.text + \"</div>\";\r\n\t}\r\n\r\n\treturn div;\r\n}\r\n\r\nfunction initMarkerArea(){\r\n\t// GS-481. Reset $marker_area if there is no timeline\r\n\tif(!gantt.$task_data || !gantt.$root.contains(gantt.$task_data)){\r\n\t\tgantt.$marker_area = null;\r\n\t\treturn;\r\n\t}\r\n\r\n\t// GS-2084. Don't add $marker_area when it already exists\r\n\tif(gantt.$marker_area && gantt.$task_data.contains(gantt.$marker_area)){\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar markerArea = document.createElement(\"div\");\r\n\tmarkerArea.className = \"gantt_marker_area\";\r\n\tgantt.$task_data.appendChild(markerArea);\r\n\tgantt.$marker_area = markerArea;\r\n}\r\n\r\ngantt.attachEvent(\"onBeforeGanttRender\", function(){\r\n\tif(!gantt.$marker_area)\r\n\t\tinitMarkerArea();\r\n});\r\n\r\ngantt.attachEvent(\"onDataRender\", function(){\r\n\tif(!gantt.$marker_area){\r\n\t\tinitMarkerArea();\r\n\t\tgantt.renderMarkers();\r\n\t}\r\n});\r\n\r\ngantt.attachEvent(\"onGanttLayoutReady\", function(){\r\n\t// GS-1304 - markers should attach when layout is initialized, both on gantt.init and gantt.resetLayout\r\n\t// wait for \"onBeforeGanttRender\", so all layout elements will be in DOM\r\n\tgantt.attachEvent(\"onBeforeGanttRender\", function(){\r\n\t\t// GS-882. If markers are rendered in the onDataRender handler, \r\n\t\t// they are not attached to the layer, so we need to remove the DOM elements\r\n\t\tif (gantt.$marker_area) {\r\n\t\t\tgantt.$marker_area.innerHTML = \"\";\r\n\t\t}\r\n\t\tinitMarkerArea();\r\n\r\n\t\tvar layers = gantt.$services.getService(\"layers\");\r\n\t\tvar markerRenderer = layers.createDataRender({\r\n\t\t\tname: \"marker\",\r\n\t\t\tdefaultContainer: function(){ return gantt.$marker_area;}\r\n\t\t});\r\n\t\tmarkerRenderer.addLayer(render_marker);\r\n\t}, {once: true});\r\n});\r\n\r\ngantt.getMarker = function(id){\r\n\tif(!this._markers) return null;\r\n\r\n\treturn this._markers.getItem(id);\r\n};\r\n\r\ngantt.addMarker = function(marker){\r\n\treturn this._markers.addItem(marker);\r\n};\r\n\r\ngantt.deleteMarker = function(id){\r\n\tif(!this._markers.exists(id))\r\n\t\treturn false;\r\n\r\n\tthis._markers.removeItem(id);\r\n\treturn true;\r\n};\r\ngantt.updateMarker = function(id){\r\n\tthis._markers.refresh(id);\r\n};\r\n\r\ngantt._getMarkers = function(){\r\n\treturn this._markers.getItems();\r\n};\r\n\r\ngantt.renderMarkers = function () {\r\n\tthis._markers.refresh();\r\n};\r\n\r\n};","import {replaceValidZeroId} from \"../utils/helpers\";\r\n\r\nexport default function(gantt){\r\n\r\ngantt.config.multiselect = true;\r\ngantt.config.multiselect_one_level = false;\r\n\r\ngantt._multiselect = {\r\n\t_selected: {},\r\n\t_one_level: false,\r\n\t_active: true,\r\n\t_first_selected_when_shift: null,\r\n\tgetDefaultSelected: function() {\r\n\t\tvar selected = this.getSelected();\r\n\t\treturn selected.length ? selected[selected.length - 1] : null;\r\n\t},\r\n\tsetFirstSelected: function(id) {\r\n\t\tthis._first_selected_when_shift = id;\r\n\t},\r\n\tgetFirstSelected: function() {\r\n\t\treturn this._first_selected_when_shift;\r\n\t},\r\n\tisActive: function() {\r\n\t\tthis.updateState();\r\n\t\treturn this._active;\r\n\t},\r\n\tupdateState: function() {\r\n\t\tthis._one_level = gantt.config.multiselect_one_level;\r\n\t\tvar active = this._active;\r\n\t\tthis._active = gantt.config.select_task;\r\n\t\tif (this._active != active) {\r\n\t\t\tthis.reset();\r\n\t\t}\r\n\t},\r\n\treset: function () {\r\n\t\tthis._selected = {};\r\n\t},\r\n\tsetLastSelected: function (id) {\r\n\t\tgantt.$data.tasksStore.silent(function(){\r\n\t\t\tvar store = gantt.$data.tasksStore;\r\n\t\t\tif (id)\r\n\t\t\t\tstore.select(id+\"\");\r\n\t\t\telse\r\n\t\t\t\tstore.unselect(null);\r\n\t\t});\r\n\t},\r\n\tgetLastSelected: function () {\r\n\t\tvar last = gantt.$data.tasksStore.getSelectedId();\r\n\t\tif (last && gantt.isTaskExists(last))\r\n\t\t\treturn last;\r\n\t\treturn null;\r\n\t},\r\n\tselect: function (id, e) {\r\n\t\tif (id && gantt.callEvent(\"onBeforeTaskMultiSelect\", [id, true, e]) && gantt.callEvent(\"onBeforeTaskSelected\", [id])) {\r\n\t\t\tthis._selected[id] = true;\r\n\t\t\tthis.setLastSelected(id);\r\n\t\t\tthis.afterSelect(id);\r\n\t\t\tgantt.callEvent(\"onTaskMultiSelect\", [id, true, e]);\r\n\t\t\tgantt.callEvent(\"onTaskSelected\", [id]);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\ttoggle: function (id, e) {\r\n\t\tif (this._selected[id]) {\r\n\t\t\tthis.unselect(id, e);\r\n\t\t} else {\r\n\t\t\tthis.select(id, e);\r\n\t\t}\r\n\t},\r\n\tunselect: function (id, e) {\r\n\t\tif (id && gantt.callEvent(\"onBeforeTaskMultiSelect\", [id, false, e])) {\r\n\t\t\tthis._selected[id] = false;\r\n\t\t\tif (this.getLastSelected() == id)\r\n\t\t\t\tthis.setLastSelected(this.getDefaultSelected());\r\n\t\t\tthis.afterSelect(id);\r\n\t\t\tgantt.callEvent(\"onTaskMultiSelect\", [id, false, e]);\r\n\t\t\tgantt.callEvent(\"onTaskUnselected\", [id]);\r\n\t\t}\r\n\t},\r\n\tisSelected: function (id) {\r\n\t\treturn !!(gantt.isTaskExists(id) && this._selected[id]);\r\n\t},\r\n\tgetSelected: function () {\r\n\t\tvar res = [];\r\n\t\tfor (var i in this._selected) {\r\n\t\t\tif (this._selected[i] && gantt.isTaskExists(i)) {\r\n\t\t\t\tres.push(i);\r\n\t\t\t} else {\r\n\t\t\t\tthis._selected[i] = false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tres.sort(function(a, b) {\r\n\t\t\treturn gantt.getGlobalTaskIndex(a) > gantt.getGlobalTaskIndex(b) ? 1 : -1;\r\n\t\t});\r\n\t\treturn res;\r\n\t},\r\n\tforSelected: function (callback) {\r\n\t\tvar selected = this.getSelected();\r\n\t\tfor (var i = 0; i < selected.length; i++) {\r\n\t\t\tcallback(selected[i]);\r\n\t\t}\r\n\t},\r\n\tisSameLevel: function(id) {\r\n\t\tif (!this._one_level)\r\n\t\t\treturn true;\r\n\t\tvar last = this.getLastSelected();\r\n\t\tif (!last)\r\n\t\t\treturn true;\r\n\t\tif (!(gantt.isTaskExists(last) && gantt.isTaskExists(id)))\r\n\t\t\treturn true;\r\n\t\treturn !!(gantt.calculateTaskLevel(gantt.getTask(last)) == gantt.calculateTaskLevel(gantt.getTask(id)));\r\n\t},\r\n\tafterSelect: function(id) {\r\n\t\tif (gantt.isTaskExists(id)){\r\n\t\t\t// FIXME: quick workaround to prevent re-filtering inside refresh on multiselect\r\n\t\t\tgantt._quickRefresh(function(){\r\n\t\t\t\tgantt.refreshTask(id);\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\tdoSelection: function(e) {\r\n\t\tif (!this.isActive())\r\n\t\t\treturn false;\r\n\r\n\t\t// deny selection when click on 'expand' or 'collapse' icons\r\n\t\tif (gantt._is_icon_open_click(e))\r\n\t\t\treturn false;\r\n\r\n\t\tvar target_ev = gantt.locate(e);\r\n\t\tif (!target_ev)\r\n\t\t\treturn false;\r\n\r\n\t\tif (!gantt.callEvent(\"onBeforeMultiSelect\", [e]))\r\n\t\t\treturn false;\r\n\r\n\t\tvar selected = this.getSelected();\r\n\t\tvar defaultLast = this.getFirstSelected();\r\n\t\tvar isLast = false;\r\n\t\tvar last = this.getLastSelected();\r\n\t\tvar multiSelect = gantt.config.multiselect;\r\n\r\n\r\n\t\tvar singleSelection = (function () {\r\n\t\t\t// GS-719: If the multiselect extension is added we still need a way\r\n\t\t\t// to open the inline editors after clicking on the cells in the grid\r\n\t\t\tconst controller = gantt.ext.inlineEditors;\r\n\t\t\tif(controller && controller.getState){\r\n\t\t\t\tconst state = controller.getState();\r\n\t\t\t\tconst cell = controller.locateCell(e.target);\r\n\r\n\t\t\t\tif (gantt.config.inline_editors_multiselect_open && cell && controller.getEditorConfig(cell.columnName)) {\r\n\t\t\t\t\tif (controller.isVisible() && state.id == cell.id && state.columnName == cell.columnName) {\r\n\t\t\t\t\t\t// do nothing if editor is already active in this cell\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcontroller.startEdit(cell.id, cell.columnName);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.setFirstSelected(target_ev);\r\n\r\n\t\t\tif (!this.isSelected(target_ev)) {\r\n\t\t\t\tthis.select(target_ev, e);\r\n\t\t\t}\r\n\t\t\tselected = this.getSelected();\r\n\t\t\tfor (var i = 0; i < selected.length; i++) {\r\n\t\t\t\tif (selected[i] !== target_ev) {\r\n\t\t\t\t\tthis.unselect(selected[i], e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}).bind(this);\r\n\r\n\t\tvar blockSelection = (function(){\r\n\t\t\tif (!last)\r\n\t\t\t\tlast = target_ev;\r\n\t\t\telse if (target_ev) {\r\n\t\t\t\tvar first_indx = gantt.getGlobalTaskIndex(this.getFirstSelected());\r\n\t\t\t\tvar target_indx = gantt.getGlobalTaskIndex(target_ev);\r\n\t\t\t\tvar last_indx = gantt.getGlobalTaskIndex(last);\r\n\t\t\t\t// GS-1969: if the selected tasks are collapsed, need to remove them\r\n\t\t\t\tif(first_indx == -1 || last_indx == -1){\r\n\t\t\t\t\tfirst_indx = target_indx;\r\n\t\t\t\t\tthis.reset();\r\n\t\t\t\t}\r\n\t\t\t\t// clear prev selection\r\n\t\t\t\tvar tmp = last;\r\n\t\t\t\twhile (gantt.getGlobalTaskIndex(tmp) !== first_indx) {\r\n\t\t\t\t\tthis.unselect(tmp, e);\r\n\t\t\t\t\ttmp = (first_indx > last_indx) ? gantt.getNext(tmp) : gantt.getPrev(tmp);\r\n\t\t\t\t}\r\n\t\t\t\ttmp = target_ev;\r\n\t\t\t\twhile (gantt.getGlobalTaskIndex(tmp) !== first_indx) {\r\n\t\t\t\t\tif (this.select(tmp, e) && !isLast) {\r\n\t\t\t\t\t\tisLast = true;\r\n\t\t\t\t\t\tdefaultLast = tmp;\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttmp = (first_indx > target_indx) ? gantt.getNext(tmp) : gantt.getPrev(tmp);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}).bind(this);\r\n\r\n\r\n\t\tif (multiSelect && (e.ctrlKey || e.metaKey)) {\r\n\t\t\tif (!this.isSelected(target_ev))\r\n\t\t\t\tthis.setFirstSelected(target_ev);\r\n\r\n\t\t\tif (target_ev) {\r\n\t\t\t\tthis.toggle(target_ev, e);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\telse if (multiSelect && e.shiftKey) {\r\n\t\t\tif (!gantt.isTaskExists(this.getFirstSelected()) || this.getFirstSelected() === null) {\r\n\t\t\t\tthis.setFirstSelected(target_ev);\r\n\t\t\t}\r\n\r\n\t\t\tif (selected.length) { // select a group of tasks\r\n\t\t\t\tblockSelection();\r\n\t\t\t}\r\n\t\t\telse { // select a task when no task is selected and Shift is pressed\r\n\t\t\t\tsingleSelection();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\telse { // no key press or no multiple selection on the mouse click\r\n\t\t\tsingleSelection();\r\n\t\t}\r\n\r\n\r\n\t\tif (this.isSelected(target_ev)) {\r\n\t\t\tthis.setLastSelected(target_ev);\r\n\t\t} else if (defaultLast) {\r\n\t\t\tif (target_ev == last)\r\n\t\t\t\tthis.setLastSelected(e.shiftKey ? defaultLast : this.getDefaultSelected());\r\n\t\t} else {\r\n\t\t\tthis.setLastSelected(null);\r\n\t\t}\r\n\r\n\t\tif (!this.getSelected().length)\r\n\t\t\tthis.setLastSelected(null);\r\n\r\n\t\tif (!this.getLastSelected() || !this.isSelected(this.getFirstSelected()))\r\n\t\t\tthis.setFirstSelected(this.getLastSelected());\r\n\r\n\t\treturn true;\r\n\t}\r\n};\r\n\r\n(function(){\r\n\tvar old_selectTask = gantt.selectTask;\r\n\tgantt.selectTask = function(id) {\r\n\t\tid = replaceValidZeroId(id, this.config.root_id);\r\n\t\tif (!id)\r\n\t\t\treturn false;\r\n\t\tvar multiselect = gantt._multiselect;\r\n\t\tvar res = id;\r\n\t\tif (multiselect.isActive()) {\r\n\t\t\tif (multiselect.select(id, null)) {\r\n\t\t\t\tmultiselect.setLastSelected(id);\r\n\t\t\t}\r\n\t\t\tmultiselect.setFirstSelected(multiselect.getLastSelected());\r\n\t\t} else {\r\n\t\t\tres = old_selectTask.call(this, id);\r\n\t\t}\r\n\t\treturn res;\r\n\t};\r\n\r\n\tvar old_unselectTask = gantt.unselectTask;\r\n\tgantt.unselectTask = function(id) {\r\n\t\tvar multiselect = gantt._multiselect;\r\n\t\tvar isActive = multiselect.isActive();\r\n\t\tid = id || multiselect.getLastSelected();\r\n\t\tif(id && isActive) {\r\n\t\t\tmultiselect.unselect(id, null);\r\n\t\t\tif (id == multiselect.getLastSelected())\r\n\t\t\t\tmultiselect.setLastSelected(null);\r\n\t\t\tgantt.refreshTask(id);\r\n\t\t\tmultiselect.setFirstSelected(multiselect.getLastSelected());\r\n\t\t}\r\n\t\tvar res = id;\r\n\t\tif (!isActive)\r\n\t\t\tres = old_unselectTask.call(this, id);\r\n\t\treturn res;\r\n\t};\r\n\r\n\tgantt.toggleTaskSelection = function(id) {\r\n\t\tvar multiselect = gantt._multiselect;\r\n\t\tif (id && multiselect.isActive()) {\r\n\t\t\tmultiselect.toggle(id);\r\n\t\t\tmultiselect.setFirstSelected(multiselect.getLastSelected());\r\n\t\t}\r\n\t};\r\n\tgantt.getSelectedTasks = function() {\r\n\t\tvar multiselect = gantt._multiselect;\r\n\t\tmultiselect.isActive();\r\n\t\treturn multiselect.getSelected();\r\n\t};\r\n\tgantt.eachSelectedTask = function(callback){\r\n\t\treturn this._multiselect.forSelected(callback);\r\n\t};\r\n\tgantt.isSelectedTask = function(id){\r\n\t\treturn this._multiselect.isSelected(id);\r\n\t};\r\n\tgantt.getLastSelectedTask = function(){\r\n\t\treturn this._multiselect.getLastSelected();\r\n\t};\r\n\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\t\tvar old_isSelected = gantt.$data.tasksStore.isSelected;\r\n\t\tgantt.$data.tasksStore.isSelected = function(id){\r\n\t\t\tif (gantt._multiselect.isActive()) {\r\n\t\t\t\treturn gantt._multiselect.isSelected(id);\r\n\t\t\t}\r\n\t\t\treturn old_isSelected.call(this, id);\r\n\t\t};\r\n\t});\r\n})();\r\n\r\ngantt.attachEvent(\"onTaskIdChange\", function (id, new_id) {\r\n\tvar multiselect = gantt._multiselect;\r\n\tif (!multiselect.isActive())\r\n\t\treturn true;\r\n\tif (gantt.isSelectedTask(id)) {\r\n\t\tmultiselect.unselect(id, null);\r\n\t\tmultiselect.select(new_id, null);\r\n\t}\r\n});\r\n\r\ngantt.attachEvent(\"onAfterTaskDelete\", function (id, item) {\r\n\tvar multiselect = gantt._multiselect;\r\n\tif (!multiselect.isActive())\r\n\t\treturn true;\r\n\r\n\tif (multiselect._selected[id]) {\r\n\t\t// GS-1057: don't unselect the task here because the task is already unselected \r\n\t\t// it was in the select.js file before it was deleted\r\n\t\t// multiselect.unselect(id, null);\r\n\t\tmultiselect._selected[id] = false;\r\n\t\tmultiselect.setLastSelected(multiselect.getDefaultSelected());\r\n\t}\r\n\r\n\tmultiselect.forSelected(function (task_id) {\r\n\t\tif (!gantt.isTaskExists(task_id))\r\n\t\t\tmultiselect.unselect(task_id, null);\r\n\t});\r\n});\r\n\r\ngantt.attachEvent(\"onBeforeTaskMultiSelect\", function(id, state, e){\r\n\tconst multiselect = gantt._multiselect;\r\n\tif (state && multiselect.isActive()) {\r\n\t\t//GS-1321: prevent unselecting task\r\n\t\tlet oldSelectedId = gantt.getSelectedId();\r\n\t\tlet oldSelectedTask = null;\r\n\t\tif (oldSelectedId) {\r\n\t\t\toldSelectedTask = gantt.getTask(oldSelectedId);\r\n\t\t}\r\n\t\tlet newSelectedTask = gantt.getTask(id);\r\n\t\tlet differentTreeLevel = false;\r\n\t\tif (oldSelectedTask && oldSelectedTask.$level != newSelectedTask.$level){\r\n\t\t\tdifferentTreeLevel = true;\r\n\t\t}\r\n\r\n\t\tif (gantt.config.multiselect_one_level && differentTreeLevel && !e.ctrlKey && !e.shiftKey) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif (multiselect._one_level) {\r\n\t\t\treturn multiselect.isSameLevel(id);\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n});\r\n\r\ngantt.attachEvent(\"onTaskClick\", function(id, e) {\r\n\tif (gantt._multiselect.doSelection(e))\r\n\t\tgantt.callEvent(\"onMultiSelect\", [e]);\r\n\treturn true;\r\n});\r\n\r\n};","\r\ninterface IQuickInfoContainer{\r\n\tparent: HTMLElement;\r\n\txViewport: HTMLElement;\r\n\tyViewport: HTMLElement;\r\n}\r\n\r\nexport class QuickInfo {\r\n\tprivate _quickInfoTask: TaskID;\r\n\tprivate _quickInfoBoxId: number | string;\r\n\tprivate _quickInfoBox: HTMLElement;\r\n\tprivate _quickInfoReadonly: boolean | null;\r\n\tprivate _container: HTMLElement;\r\n\tprivate _gantt: any;\r\n\r\n\tconstructor(gantt: any) {\r\n\t\tthis._gantt = gantt;\r\n\t}\r\n\r\n\t// show at coordinates:\r\n\t// show(x: number, y: number)\r\n\t// show for a task:\r\n\t// show(id: TaskID)\r\n\tshow : {\r\n\t\t(x: number, y: number) : void;\r\n\t\t(id: TaskID) : void;\r\n\t} = (id: TaskID | number, y? : number) : void => {\r\n\t\tif (y === undefined) {\r\n\t\t\tthis._showForTask(id);\r\n\t\t} else {\r\n\t\t\tthis._showAtCoordinates(id as number, y);\r\n\t\t}\r\n\t};\r\n\r\n\thide = (forced?: boolean) : any => {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst qi = this._quickInfoBox;\r\n\t\tthis._quickInfoBoxId = 0;\r\n\t\tconst taskId = this._quickInfoTask;\r\n\t\tthis._quickInfoTask = null;\r\n\r\n\t\tif (qi && qi.parentNode){\r\n\r\n\t\t\tif (gantt.config.quick_info_detached) {\r\n\t\t\t\tgantt.callEvent(\"onAfterQuickInfo\", [taskId]);\r\n\t\t\t\treturn qi.parentNode.removeChild(qi);\r\n\t\t\t}\r\n\r\n\t\t\tqi.className += \" gantt_qi_hidden\";\r\n\t\t\tif (qi.style.right === \"auto\"){\r\n\t\t\t\tqi.style.left = \"-350px\";\r\n\t\t\t} else {\r\n\t\t\t\tqi.style.right = \"-350px\";\r\n\t\t\t}\r\n\r\n\t\t\tif (forced) {\r\n\t\t\t\tqi.style.left = qi.style.right = \"\";\r\n\t\t\t\tqi.parentNode.removeChild(qi);\r\n\t\t\t}\r\n\t\t\tgantt.callEvent(\"onAfterQuickInfo\", [taskId]);\r\n\t\t}\r\n\t};\r\n\r\n\tgetNode = (): HTMLElement => {\r\n\t\tif(this._quickInfoBox) {\r\n\t\t\treturn this._quickInfoBox;\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n\r\n\tsetContainer = (container: string|HTMLElement): void => {\r\n\t\tif(container){\r\n\t\t\tthis._container = typeof container === \"string\" ? document.getElementById(container) : container;\r\n\t\t}\r\n\t};\r\n\r\n\tsetContent = (content?: IQuickInfoContent) => {\r\n\t\tconst gantt = this._gantt;\r\n\r\n\t\tconst defaultContent = {\r\n\t\t\ttaskId: null,\r\n\t\t\theader: {\r\n\t\t\t\ttitle: \"\",\r\n\t\t\t\tdate: \"\"\r\n\t\t\t},\r\n\t\t\tcontent: \"\",\r\n\t\t\tbuttons: gantt.config.quickinfo_buttons\r\n\t\t};\r\n\r\n\t\tif(!content){\r\n\t\t\tcontent = defaultContent;\r\n\t\t}\r\n\r\n\t\tif(!content.taskId){\r\n\t\t\tcontent.taskId = defaultContent.taskId;\r\n\t\t}\r\n\r\n\t\tif(!content.header){\r\n\t\t\tcontent.header = defaultContent.header;\r\n\t\t}\r\n\r\n\t\tif(!content.header.title){\r\n\t\t\tcontent.header.title = defaultContent.header.title;\r\n\t\t}\r\n\t\tif(!content.header.date){\r\n\t\t\tcontent.header.date = defaultContent.header.date;\r\n\t\t}\r\n\t\tif(!content.content){\r\n\t\t\tcontent.content = defaultContent.content;\r\n\t\t}\r\n\t\tif(!content.buttons){\r\n\t\t\tcontent.buttons = defaultContent.buttons;\r\n\t\t}\r\n\r\n\r\n\t\tlet qi = this.getNode();\r\n\t\tif(!qi){\r\n\t\t\tqi = this._createQuickInfoElement();\r\n\t\t}\r\n\r\n\t\tif(content.taskId){\r\n\t\t\tthis._quickInfoBoxId = content.taskId;\r\n\t\t}\r\n\r\n\t\tconst titleBox = qi.querySelector(\".gantt_cal_qi_title\") as HTMLElement;\r\n\t\tconst titleContent = titleBox.querySelector(\".gantt_cal_qi_tcontent\");\r\n\t\tconst titleDate = titleBox.querySelector(\".gantt_cal_qi_tdate\");\r\n\t\tconst main = qi.querySelector(\".gantt_cal_qi_content\");\r\n\t\tconst controls = qi.querySelector(\".gantt_cal_qi_controls\") as HTMLElement;\r\n\r\n\t\tgantt._waiAria.quickInfoHeader(qi, [content.header.title, content.header.date].join(\" \"));\r\n\r\n\t\ttitleContent.innerHTML = content.header.title;\r\n\t\ttitleDate.innerHTML = content.header.date;\r\n\r\n\t\tif(!content.header.title && !content.header.date){\r\n\t\t\ttitleBox.style.display = \"none\";\r\n\t\t}else{\r\n\t\t\ttitleBox.style.display = \"\";\r\n\t\t}\r\n\t\tmain.innerHTML = content.content;\r\n\r\n\t\tconst buttons = content.buttons;\r\n\t\tif(!buttons.length){\r\n\t\t\tcontrols.style.display = \"none\";\r\n\t\t}else{\r\n\t\t\tcontrols.style.display = \"\";\r\n\t\t}\r\n\t\tlet html = \"\";\r\n\t\tfor (let i = 0; i < buttons.length; i++){\r\n\r\n\t\t\tconst ariaAttr = gantt._waiAria.quickInfoButtonAttrString(gantt.locale.labels[buttons[i]]);\r\n\r\n\t\t\thtml += `<div class=\"gantt_qi_big_icon ${buttons[i]} dhx_gantt_${buttons[i]}\" title=\"${gantt.locale.labels[buttons[i]]}\" ${ariaAttr}>\r\n            <div class='dhx_menu_icon dhx_gantt_icon ${buttons[i]} gantt_menu_icon dhx_gantt_${buttons[i]}'></div>\r\n            <div>${gantt.locale.labels[buttons[i]]}</div>\r\n         </div>`;\r\n\t\t}\r\n\t\tcontrols.innerHTML = html;\r\n\r\n\t\tgantt.eventRemove(qi, \"click\", this._qiButtonClickHandler);\r\n\t\tgantt.eventRemove(qi, \"keypress\", this._qiKeyPressHandler);\r\n\r\n\t\tgantt.event(qi, \"click\", this._qiButtonClickHandler);\r\n\t\tgantt.event(qi, \"keypress\", this._qiKeyPressHandler);\r\n\t};\r\n\r\n\tprivate _qiButtonClickHandler = (ev) => {\r\n\t\tthis._qi_button_click(ev.target);\r\n\t};\r\n\r\n\tprivate _qiKeyPressHandler = (e) => {\r\n\r\n\t\tconst code = e.which;\r\n\t\tif (code === 13 || code === 32){\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis._qi_button_click(e.target);\r\n\t\t\t},1);\r\n\t\t}\r\n\t};\r\n\r\n\tprivate _showAtCoordinates(x: number, y: number) : void {\r\n\t\tthis.hide(true);\r\n\t\tthis._quickInfoBoxId = 0;\r\n\t\tthis._quickInfoTask = null;\r\n\t\tif(!this._quickInfoBox){\r\n\t\t\tthis._createQuickInfoElement();\r\n\t\t\tthis.setContent();\r\n\t\t}\r\n\r\n\t\tthis._appendAtCoordinates(x, y);\r\n\t\tthis._gantt.callEvent(\"onQuickInfo\", [null]);\r\n\t}\r\n\r\n\tprivate _showForTask(id: TaskID) : void {\r\n\t\tconst gantt = this._gantt;\r\n\t\tif ((\r\n\t\t\tid === this._quickInfoBoxId &&\r\n\t\t\tgantt.utils.dom.isChildOf(this._quickInfoBox, document.body)\r\n\t\t) || !gantt.config.show_quick_info) {\r\n\t\t\t// not show if the quick info is already displayed for this task, or if it shouldn't be displayed\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.hide(true);\r\n\t\tconst offset = 6; // offset TASK <> QI-BOX in 'px'\r\n\t\tconst container = this._getContainer();\r\n\t\tconst pos = this._get_event_counter_part(id, offset, container.xViewport, container.yViewport);\r\n\r\n\t\tif (pos){\r\n\t\t\tthis._quickInfoBox = this._init_quick_info(id);\r\n\t\t\tthis._quickInfoTask = id;\r\n\t\t\tthis._quickInfoBox.className = this._prepare_quick_info_classname(id);\r\n\r\n\t\t\tthis._fill_quick_data(id);\r\n\t\t\tthis._show_quick_info(pos, offset);\r\n\t\t\tgantt.callEvent(\"onQuickInfo\", [id]);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _get_event_counter_part(id: TaskID, offset: number, xViewport: HTMLElement, yViewport: HTMLElement) : any {\r\n\t\tconst gantt = this._gantt;\r\n\t\tlet domEv = gantt.getTaskNode(id);\r\n\t\tif (!domEv) {\r\n\t\t\tdomEv = gantt.getTaskRowNode(id);\r\n\t\t\tif (!domEv) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet left = 0;\r\n\t\tconst top = offset + domEv.offsetTop + domEv.offsetHeight;\r\n\r\n\t\tlet node = domEv;\r\n\r\n\t\tif (gantt.utils.dom.isChildOf(node, xViewport)) {\r\n\t\t\twhile (node && node !== xViewport){\r\n\t\t\t\tleft += node.offsetLeft;\r\n\t\t\t\tnode = node.offsetParent;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst scroll = gantt.getScrollState();\r\n\r\n\t\tif(node){\r\n\t\t\tconst dx = (left + domEv.offsetWidth/2) - scroll.x > (xViewport.offsetWidth/2) ? 1 : 0;\r\n\t\t\tconst dy = (top + domEv.offsetHeight/2) - scroll.y > (yViewport.offsetHeight/2) ? 1 : 0;\r\n\r\n\t\t\treturn { left, top, dx, dy, width:domEv.offsetWidth, height:domEv.offsetHeight };\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprivate _createQuickInfoElement() : HTMLElement {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst qi = document.createElement(\"div\");\r\n\t\tqi.className += \"gantt_cal_quick_info\";\r\n\t\tgantt._waiAria.quickInfoAttr(qi);\r\n\r\n\t\t// title\r\n\t\tconst ariaAttr = gantt._waiAria.quickInfoHeaderAttrString();\r\n\t\tvar html = `\r\n\t\t<div class=\"gantt_cal_qi_tcontrols\">\r\n\t\t\t<a class=\"gantt_cal_qi_close_btn dhx_gantt_icon dhx_gantt_icon_close\"></a>\r\n\t\t</div>\r\n\t\t<div class=\"gantt_cal_qi_title\" ${ariaAttr}>\r\n\t\t\t\t\r\n\t\t\t\t<div class=\"gantt_cal_qi_tcontent\"></div>\r\n\t\t\t\t<div class=\"gantt_cal_qi_tdate\"></div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"gantt_cal_qi_content\"></div>`;\r\n\r\n\t\t//buttons\r\n\t\thtml += \"<div class=\\\"gantt_cal_qi_controls\\\">\";\r\n\r\n\t\thtml += \"</div>\";\r\n\r\n\t\tqi.innerHTML = html;\r\n\r\n\r\n\t\tif (gantt.config.quick_info_detached) {\r\n\t\t\tconst container = this._getContainer();\r\n\t\t\tgantt.event(container.parent, \"scroll\", () => { this.hide(); });\r\n\t\t}\r\n\r\n\t\tthis._quickInfoBox = qi;\r\n\t\treturn qi;\r\n\t}\r\n\r\n\tprivate _init_quick_info(id: TaskID) : HTMLElement {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst task = gantt.getTask(id);\r\n\t\t\r\n\r\n\t\tif(typeof this._quickInfoReadonly === \"boolean\"){\r\n\t\t\tif(gantt.isReadonly(task) !== this._quickInfoReadonly){\r\n\t\t\t\tthis.hide(true);\r\n\t\t\t\tthis._quickInfoBox = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._quickInfoReadonly = gantt.isReadonly(task);\r\n\r\n\t\tif (!this._quickInfoBox){\r\n\t\t\tthis._quickInfoBox = this._createQuickInfoElement();\r\n\t\t}\r\n\r\n\t\treturn this._quickInfoBox;\r\n\t}\r\n\r\n\tprivate _prepare_quick_info_classname(id: TaskID) : string {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst task = gantt.getTask(id);\r\n\t\tconst taskType = gantt.getTaskType(task);\r\n\r\n\t\tlet css = `gantt_cal_quick_info gantt_${taskType}`;\r\n\t\tconst template = gantt.templates.quick_info_class(task.start_date, task.end_date, task);\r\n\r\n\t\tif(template){\r\n\t\t\tcss += \" \" + template;\r\n\t\t}\r\n\t\treturn css;\r\n\t}\r\n\r\n\tprivate _fill_quick_data(id: TaskID) : void {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst ev = gantt.getTask(id);\r\n\r\n\t\tthis._quickInfoBoxId = id;\r\n\r\n\t\tlet allowedButtons = [];\r\n\t\tif (this._quickInfoReadonly){\r\n\t\t\tconst buttons = gantt.config.quickinfo_buttons;\r\n\t\t\tconst isEditor = {icon_delete: true, icon_edit: true};\r\n\t\t\tfor (let i = 0; i < buttons.length; i++){\r\n\t\t\t\tif(this._quickInfoReadonly && isEditor[buttons[i]]){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tallowedButtons.push(buttons[i]);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tallowedButtons = gantt.config.quickinfo_buttons;\r\n\t\t}\r\n\r\n\t\tthis.setContent({\r\n\t\t\theader: {\r\n\t\t\t\ttitle: gantt.templates.quick_info_title(ev.start_date, ev.end_date, ev),\r\n\t\t\t\tdate: gantt.templates.quick_info_date(ev.start_date, ev.end_date, ev)\r\n\t\t\t},\r\n\t\t\tcontent: gantt.templates.quick_info_content(ev.start_date, ev.end_date, ev),\r\n\t\t\tbuttons: allowedButtons\r\n\t\t});\r\n\t}\r\n\r\n\tprivate _appendAtCoordinates(x: number, y: number): void {\r\n\t\tconst qi = this._quickInfoBox;\r\n\t\tconst container = this._getContainer();\r\n\t\tif (!qi.parentNode ||\r\n\t\t\tqi.parentNode.nodeName.toLowerCase() === \"#document-fragment\"){ // IE8\r\n\t\t\tcontainer.parent.appendChild(qi);\r\n\t\t}\r\n\r\n\t\tqi.style.left = x + \"px\";\r\n\t\tqi.style.top = y + \"px\";\r\n\t}\r\n\r\n\tprivate _show_quick_info(pos: any, offset: number) : void {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst qi = this._quickInfoBox;\r\n\t\tif (gantt.config.quick_info_detached) {\r\n\t\t\tconst container = this._getContainer();\r\n\t\t\tif (!qi.parentNode ||\r\n\t\t\t\tqi.parentNode.nodeName.toLowerCase() === \"#document-fragment\"){ // IE8\r\n\t\t\t\tcontainer.parent.appendChild(qi);\r\n\t\t\t}\r\n\t\t\tconst width = qi.offsetWidth;\r\n\t\t\tconst popupHeight = qi.offsetHeight;\r\n\r\n\t\t\tconst scrolls = gantt.getScrollState();\r\n\t\t\tconst xViewport = container.xViewport;\r\n\t\t\tconst yViewport = container.yViewport;\r\n\t\t\tconst screenWidth = xViewport.offsetWidth + scrolls.x - width;\r\n\r\n\t\t\tconst relativePopupTop = pos.top - scrolls.y;\r\n\t\t\tconst relativePopupBottom = relativePopupTop + popupHeight;\r\n\r\n\t\t\tlet top = pos.top;\r\n\t\t\tif(relativePopupBottom > yViewport.offsetHeight / 2){\r\n\t\t\t\ttop = pos.top - (popupHeight + pos.height + 2*offset);\r\n\t\t\t\tif(top < scrolls.y && relativePopupBottom <= yViewport.offsetHeight){\r\n\t\t\t\t\ttop = pos.top;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (top < scrolls.y) {\r\n\t\t\t\ttop = scrolls.y;\r\n\t\t\t}\r\n\r\n\t\t\tconst x = Math.min(Math.max(scrolls.x, pos.left - pos.dx*(width - pos.width)), screenWidth);\r\n\t\t\tconst y = top;\r\n\r\n\t\t\tthis._appendAtCoordinates(x, y);\r\n\t\t} else {\r\n\t\t\tqi.style.top = 20 + \"px\";\r\n\t\t\tif (pos.dx === 1){\r\n\t\t\t\tqi.style.right = \"auto\";\r\n\t\t\t\tqi.style.left = \"-300px\";\r\n\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tqi.style.left = \"10px\";\r\n\t\t\t\t},1);\r\n\t\t\t} else {\r\n\t\t\t\tqi.style.left = \"auto\";\r\n\t\t\t\tqi.style.right = \"-300px\";\r\n\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tqi.style.right = \"10px\";\r\n\t\t\t\t},1);\r\n\t\t\t}\r\n\t\t\tqi.className += \" gantt_qi_\"+(pos.dx === 1 ? \"left\" : \"right\");\r\n\t\t\tgantt.$root.appendChild(qi);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _qi_button_click(node: any) : void {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst box = this._quickInfoBox;\r\n\t\tif (!node || node === box){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(node.closest(\".gantt_cal_qi_close_btn\")){\r\n\t\t\tthis.hide();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst mask = node.className;\r\n\t\tif (mask.indexOf(\"_icon\") !== -1){\r\n\t\t\tconst id = this._quickInfoBoxId;\r\n\t\t\tgantt.$click.buttons[mask.split(\" \")[1].replace(\"icon_\",\"\")](id);\r\n\t\t} else {\r\n\t\t\tthis._qi_button_click(node.parentNode);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _getContainer(): IQuickInfoContainer{\r\n\t\tconst gantt = this._gantt;\r\n\t\tlet container = this._container ? this._container : gantt.$task_data;\r\n\t\tif (container && container.offsetHeight && container.offsetWidth) {\r\n\t\t\treturn {\r\n\t\t\t\tparent: container,\r\n\t\t\t\txViewport: gantt.$task,\r\n\t\t\t\tyViewport: gantt.$task_data\r\n\t\t\t};\r\n\t\t}\r\n\t\tcontainer = this._container ? this._container : gantt.$grid_data;\r\n\t\tif (container && container.offsetHeight && container.offsetWidth) {\r\n\t\t\treturn {\r\n\t\t\t\tparent: container,\r\n\t\t\t\txViewport: gantt.$grid,\r\n\t\t\t\tyViewport: gantt.$grid_data\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tparent: this._container ? this._container : gantt.$layout,\r\n\t\t\txViewport: gantt.$layout,\r\n\t\t\tyViewport: gantt.$layout\r\n\t\t};\r\n\t}\r\n}\r\n","import { QuickInfo } from \"./quickInfo\";\r\n\r\nexport default function(gantt: any){\r\n\r\nif (!gantt.ext) {\r\n\tgantt.ext = {};\r\n}\r\ngantt.ext.quickInfo = new QuickInfo(gantt);\r\n\r\ngantt.config.quickinfo_buttons = [\"icon_edit\", \"icon_delete\"];\r\ngantt.config.quick_info_detached = true;\r\ngantt.config.show_quick_info = true;\r\n\r\ngantt.templates.quick_info_title = function(start, end, ev){ return ev.text.substr(0,50); };\r\ngantt.templates.quick_info_content = function(start, end, ev){ return ev.details || ev.text; };\r\ngantt.templates.quick_info_date = function(start, end, ev){\r\n\treturn gantt.templates.task_time(start, end, ev);\r\n};\r\ngantt.templates.quick_info_class = function(start, end, task){ return \"\"; };\r\n\r\ngantt.attachEvent(\"onTaskClick\", function(id,e){\r\n\t// GS-1460 Don't show Quick Info when clicking on the \"+\" button\r\n\tif (!gantt.utils.dom.closest(e.target, \".gantt_add\")){\r\n\t\tsetTimeout(function() {\r\n\t\t\tgantt.ext.quickInfo.show(id);\r\n\t\t}, 0);\r\n\t}\r\n\r\n\treturn true;\r\n});\r\n\r\nconst events = [\"onViewChange\", \"onLightbox\", \"onBeforeTaskDelete\", \"onBeforeDrag\"];\r\nconst hidingFunction = function(){\r\n\tgantt.ext.quickInfo.hide();\r\n\treturn true;\r\n};\r\nfor (let i=0; i<events.length; i++){\r\n\tgantt.attachEvent(events[i], hidingFunction);\r\n}\r\n// GS-957: We don't want to hide QuickInfo when we click on it.\r\ngantt.attachEvent(\"onEmptyClick\", function(e){\r\n\tlet hideQuickInfo = true;\r\n\tconst parent = document.querySelector(\".gantt_cal_quick_info\");\r\n\tif (parent){\r\n\t\tconst quickInfoClick = gantt.utils.dom.isChildOf(e.target, parent);\r\n\t\tif (quickInfoClick){\r\n\t\t\thideQuickInfo = false;\r\n\t\t}\r\n\t}\r\n\tif (hideQuickInfo){\r\n\t\thidingFunction();\r\n\t}\r\n});\r\nfunction clearQuickInfo() {\r\n\tgantt.ext.quickInfo.hide();\r\n\tgantt.ext.quickInfo._quickInfoBox = null;\r\n\treturn true;\r\n}\r\ngantt.attachEvent(\"onGanttReady\", clearQuickInfo);\r\ngantt.attachEvent(\"onDestroy\", clearQuickInfo);\r\n\r\n// eslint-disable-next-line no-restricted-globals\r\ngantt.event(window, \"keydown\", function(e){\r\n\tif (e.keyCode === 27){\r\n\t\tgantt.ext.quickInfo.hide();\r\n\t}\r\n});\r\n\r\ngantt.showQuickInfo = function(){\r\n\tgantt.ext.quickInfo.show.apply(gantt.ext.quickInfo, arguments);\r\n};\r\ngantt.hideQuickInfo = function(){\r\n\tgantt.ext.quickInfo.hide.apply(gantt.ext.quickInfo, arguments);\r\n};\r\n\r\n}","import * as helpers from \"./helpers\";\r\n\r\nvar plainObjectConstructor = ({}).constructor.toString();\r\nfunction isCustomType(object){\r\n\tvar constructorString = object.constructor.toString();\r\n\r\n\treturn constructorString !== plainObjectConstructor;\r\n}\r\n\r\nfunction copy(object) {\r\n\tvar i, result; // iterator, types array, result\r\n\r\n\tif (object && typeof object == \"object\") {\r\n\r\n\t\tswitch (true){\r\n\t\t\tcase (helpers.isDate(object)):\r\n\t\t\t\tresult = new Date(object);\r\n\t\t\t\tbreak;\r\n\t\t\tcase (helpers.isArray(object)):\r\n\t\t\t\tresult = new Array(object.length);\r\n\t\t\t\tfor(i = 0; i < object.length; i++){\r\n\t\t\t\t\tresult[i] = copy(object[i]);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t/*\t\tcase (helpers.isStringObject(object)):\r\n\t\t\t\tresult = new String(object);\r\n\t\t\t\tbreak;\r\n\t\t\tcase (helpers.isNumberObject(object)):\r\n\t\t\t\tresult = new Number(object);\r\n\t\t\t\tbreak;\r\n\t\t\tcase (helpers.isBooleanObject(object)):\r\n\t\t\t\tresult = new Boolean(object);\r\n\t\t\t\tbreak;*/\r\n\t\t\tdefault:\r\n\t\t\t\tif(isCustomType(object)){\r\n\t\t\t\t\tresult = Object.create(object);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tresult = {};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (i in object) {\r\n\t\t\t\t\tif (Object.prototype.hasOwnProperty.apply(object, [i]))\r\n\t\t\t\t\t\tresult[i] = copy(object[i]);\r\n\t\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\treturn result || object;\r\n}\r\n\r\nfunction mixin (target, source, force){\r\n\tfor (var f in source)\r\n\t\tif (((target[f] === undefined) || force)) target[f]=source[f];\r\n\treturn target;\r\n}\r\n\r\nfunction defined(obj) {\r\n\treturn typeof(obj) != \"undefined\";\r\n}\r\n\r\nvar seed;\r\nfunction uid() {\r\n\tif (!seed)\r\n\t\tseed = (new Date()).valueOf();\r\n\r\n\tseed++;\r\n\treturn seed;\r\n}\r\n\r\n//creates function with specified \"this\" pointer\r\nfunction bind(functor, object){\r\n\tif(functor.bind)\r\n\t\treturn functor.bind(object);\r\n\telse\r\n\t\treturn function(){ return functor.apply(object,arguments); };\r\n}\r\n\r\nfunction event(el, event, handler, capture){\r\n\tif (el.addEventListener)\r\n\t\tel.addEventListener(event, handler, capture === undefined ? false : capture);\r\n\r\n\telse if (el.attachEvent)\r\n\t\tel.attachEvent(\"on\"+event, handler);\r\n}\r\n\r\nfunction eventRemove(el, event, handler, capture){\r\n\tif (el.removeEventListener)\r\n\t\tel.removeEventListener(event, handler, capture === undefined ? false : capture);\r\n\r\n\telse if (el.detachEvent)\r\n\t\tel.detachEvent(\"on\"+event, handler);\r\n}\r\n\r\nexport {\r\n\tcopy,\r\n\tdefined,\r\n\tmixin,\r\n\tuid,\r\n\tbind,\r\n\tevent,\r\n\teventRemove\r\n};","import * as utils from \"../../../utils/utils\";\r\n\r\nfunction createScope(addEvent, removeEvent) {\r\n\taddEvent = addEvent || utils.event;\r\n\tremoveEvent = removeEvent || utils.eventRemove;\r\n\r\n\tvar handlers = [];\r\n\r\n\tvar eventScope = {\r\n\t\tattach: function(el, event, callback, capture){\r\n\t\t\thandlers.push({element: el, event:event, callback: callback, capture: capture});\r\n\t\t\taddEvent(el, event, callback, capture);\r\n\t\t},\r\n\t\tdetach: function(el, event, callback, capture){\r\n\t\t\tremoveEvent(el, event, callback, capture);\r\n\t\t\tfor(var i = 0; i < handlers.length; i++){\r\n\t\t\t\tvar handler = handlers[i];\r\n\t\t\t\tif (handler.element === el && handler.event === event && handler.callback === callback && handler.capture === capture) {\r\n\t\t\t\t\thandlers.splice(i, 1);\r\n\t\t\t\t\ti--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tdetachAll: function () {\r\n\t\t\tvar staticArray = handlers.slice();\r\n\t\t\t// original handlers array can be spliced on every iteration\r\n\t\t\tfor (var i = 0; i < staticArray.length; i++){\r\n\t\t\t\tvar handler = staticArray[i];\r\n\t\t\t\teventScope.detach(handler.element, handler.event, handler.callback, handler.capture);\r\n\t\t\t\teventScope.detach(handler.element, handler.event, handler.callback, undefined);\r\n\t\t\t\teventScope.detach(handler.element, handler.event, handler.callback, false);\r\n\t\t\t\teventScope.detach(handler.element, handler.event, handler.callback, true);\r\n\t\t\t}\r\n\t\t\thandlers.splice(0, handlers.length);\r\n\t\t},\r\n\t\textend: function(){\r\n\t\t\treturn createScope(this.event, this.eventRemove);\r\n\t\t}\r\n\t};\r\n\r\n\treturn eventScope;\r\n}\r\n\r\nexport default createScope;","import * as domHelpers from \"../../core/ui/utils/dom_helpers\";\r\n\r\n/* eslint-disable no-restricted-globals */\r\n\r\ninterface IViewPosition{\r\n\ttop: number;\r\n\tleft: number;\r\n}\r\n\r\ninterface IViewBox extends IViewPosition{\r\n\twidth: number;\r\n\theight: number;\r\n\tbottom: number;\r\n\tright: number;\r\n}\r\n\r\nexport class Tooltip {\r\n\tprivate _root: HTMLElement;\r\n\tprivate _tooltipNode: HTMLElement;\r\n\tprivate _gantt: any;\r\n\r\n\tconstructor(gantt: any){\r\n\t\tthis._gantt = gantt;\r\n\t}\r\n\r\n\tgetNode() : HTMLElement {\r\n\t\tconst gantt = this._gantt;\r\n\t\tif (!this._tooltipNode){\r\n\t\t\tthis._tooltipNode = document.createElement(\"div\");\r\n\t\t\tthis._tooltipNode.className = \"gantt_tooltip\";\r\n\t\t\tgantt._waiAria.tooltipAttr(this._tooltipNode);\r\n\t\t}\r\n\t\treturn this._tooltipNode;\r\n\t}\r\n\r\n\tsetViewport(node: HTMLElement):Tooltip{\r\n\t\tthis._root = node;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tshow(left: number, top: number): Tooltip;\r\n\tshow(event: MouseEvent): Tooltip;\r\n\tshow(left: number | MouseEvent, top?: number): Tooltip {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst container = document.body;\r\n\t\tconst node = this.getNode();\r\n\r\n\t\tif(!domHelpers.isChildOf(node, container)){\r\n\t\t\tthis.hide();\r\n\t\t\t// GS-2463. Don't put the node beyond the body coordinates\r\n\t\t\t// as it may trigger the resize event\r\n\t\t\tnode.style.top = node.style.top || \"0px\";\r\n\t\t\tnode.style.left = node.style.left || \"0px\";\r\n\t\t\tcontainer.appendChild(node);\r\n\t\t}\r\n\r\n\t\tif (this._isLikeMouseEvent(left)) {\r\n\t\t\tconst position = this._calculateTooltipPosition(left as MouseEvent);\r\n\t\t\ttop = position.top;\r\n\t\t\tleft = position.left;\r\n\t\t}\r\n\r\n\t\tnode.style.top = top + \"px\";\r\n\t\tnode.style.left = left + \"px\";\r\n\r\n\t\tgantt._waiAria.tooltipVisibleAttr(node);\r\n\t\treturn this;\r\n\t}\r\n\thide() : Tooltip{\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst node = this.getNode();\r\n\t\tif(node && node.parentNode){\r\n\t\t\tnode.parentNode.removeChild(node);\r\n\t\t}\r\n\t\tgantt._waiAria.tooltipHiddenAttr(node);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetContent(html: string) : Tooltip{\r\n\t\tconst node = this.getNode();\r\n\t\tnode.innerHTML = html;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t// it is for salesforce, because it proxies event to it own events\r\n\tprivate _isLikeMouseEvent(event: any): boolean {\r\n\t\tif (!event || typeof event !== \"object\") {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn \"clientX\" in event && \"clientY\" in event;\r\n\t}\r\n\r\n\tprivate _getViewPort() : HTMLElement {\r\n\t\treturn this._root || document.body;\r\n\t}\r\n\r\n\r\n\tprivate _calculateTooltipPosition(event: MouseEvent): IViewPosition{\r\n\t\tconst gantt = this._gantt;\r\n\t\t// top/left coordinates inside the viewport by mouse position\r\n\t\tconst viewport =  this._getViewPortSize();\r\n\t\tconst tooltipNode = this.getNode();\r\n\t\tconst tooltip: IViewBox = {\r\n\t\t\ttop:0,\r\n\t\t\tleft: 0,\r\n\t\t\twidth: tooltipNode.offsetWidth,\r\n\t\t\theight: tooltipNode.offsetHeight,\r\n\t\t\tbottom: 0,\r\n\t\t\tright: 0\r\n\t\t};\r\n\r\n\t\tconst offsetX = gantt.config.tooltip_offset_x;\r\n\t\tconst offsetY = gantt.config.tooltip_offset_y;\r\n\r\n\t\tconst container = document.body;\r\n\t\tconst mouse = domHelpers.getRelativeEventPosition(event, container);\r\n\t\tconst containerPos = domHelpers.getNodePosition(container);\r\n\t\tmouse.y += containerPos.y; // to fix margin collapsing\r\n\r\n\t\ttooltip.top = mouse.y;\r\n\t\ttooltip.left = mouse.x;\r\n\t\ttooltip.top += offsetY;\r\n\t\ttooltip.left += offsetX;\r\n\t\ttooltip.bottom = tooltip.top + tooltip.height;\r\n\t\ttooltip.right = tooltip.left + tooltip.width;\r\n\r\n\t\tconst scrollTop = window.scrollY + container.scrollTop; // to fix margin collapsing\r\n\t\t// edge cases when the tooltip element can be partially hidden by edges of the viewport\r\n\t\tif(tooltip.top < viewport.top - scrollTop){\r\n\t\t\ttooltip.top = viewport.top;\r\n\t\t\ttooltip.bottom = tooltip.top + tooltip.height;\r\n\t\t}else if(tooltip.bottom > viewport.bottom){\r\n\t\t\ttooltip.bottom = viewport.bottom;\r\n\t\t\ttooltip.top = tooltip.bottom - tooltip.height;\r\n\t\t}\r\n\r\n\t\tif(tooltip.left < viewport.left){\r\n\t\t\ttooltip.left = viewport.left;\r\n\t\t\ttooltip.right = viewport.left + tooltip.width;\r\n\t\t}else if(tooltip.right > viewport.right){\r\n\t\t\ttooltip.right = viewport.right;\r\n\t\t\ttooltip.left = tooltip.right - tooltip.width;\r\n\t\t}\r\n\r\n\t\tif(mouse.x >= tooltip.left && mouse.x <= tooltip.right) {\r\n\t\t\ttooltip.left = mouse.x - tooltip.width - offsetX;\r\n\t\t\ttooltip.right = tooltip.left + tooltip.width;\r\n\t\t}\r\n\r\n\t\tif(mouse.y >= tooltip.top && mouse.y <= tooltip.bottom) {\r\n\t\t\ttooltip.top = mouse.y - tooltip.height - offsetY;\r\n\t\t\ttooltip.bottom = tooltip.top + tooltip.height;\r\n\t\t}\r\n\r\n\t\treturn tooltip;\r\n\t}\r\n\r\n\tprivate _getViewPortSize() : IViewBox {\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst container = this._getViewPort();\r\n\t\tlet viewport = container;\r\n\t\tlet scrollTop = window.scrollY + document.body.scrollTop;\r\n\t\tlet scrollLeft = window.scrollX + document.body.scrollLeft;\r\n\t\tlet pos;\r\n\t\t// support for the initial tooltip mode where the tooltip element was attached to the data area of gantt\r\n\t\tif(container === gantt.$task_data){\r\n\t\t\tviewport = gantt.$task;\r\n\t\t\tscrollTop = 0;\r\n\t\t\tscrollLeft = 0;\r\n\t\t\tpos = domHelpers.getNodePosition(gantt.$task);\r\n\t\t}else{\r\n\t\t\tpos = domHelpers.getNodePosition(viewport);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tleft:pos.x + scrollLeft,\r\n\t\t\ttop: pos.y + scrollTop,\r\n\t\t\twidth: pos.width,\r\n\t\t\theight: pos.height,\r\n\t\t\tbottom: pos.y + pos.height + scrollTop,\r\n\t\t\tright: pos.x + pos.width + scrollLeft\r\n\t\t};\r\n\t}\r\n}\r\n","import domEventsScope from \"../../core/ui/utils/dom_event_scope\";\r\nimport * as domHelpers from \"../../core/ui/utils/dom_helpers\";\r\nimport * as helpers from \"../../utils/helpers\";\r\nimport { Tooltip } from \"./tooltip\";\r\n\r\ninterface ITrackerTarget {\r\n\tselector: string;\r\n\tonmouseenter: (event: MouseEvent, node: HTMLElement) => void;\r\n\tonmousemove: (event: MouseEvent, node: HTMLElement) => void;\r\n\tonmouseleave: (event: MouseEvent, node: HTMLElement) => void;\r\n\tglobal: boolean;\r\n}\r\n\r\ninterface ITooltipConfig {\r\n\tselector: string;\r\n\thtml: (event: MouseEvent, node: HTMLElement) => string;\r\n\tglobal: boolean;\r\n}\r\n\r\nexport class TooltipManager{\r\n\ttooltip: Tooltip;\r\n\tprotected _domEvents: any;\r\n\tprivate _listeners: object = {};\r\n\tprivate _gantt: any;\r\n\tprivate delayShow: any;\r\n\tprivate delayHide: any;\r\n\r\n\tconstructor(gantt: any) {\r\n\t\tthis.tooltip = new Tooltip(gantt);\r\n\t\tthis._gantt = gantt;\r\n\t\tthis._domEvents = domEventsScope();\r\n\t\tthis._initDelayedFunctions();\r\n\t}\r\n\r\n\tdestructor(): void{\r\n\t\tthis.tooltip.hide();\r\n\t\tthis._domEvents.detachAll();\r\n\t}\r\n\thideTooltip(): void{\r\n\t\tthis.delayHide();\r\n\t}\r\n\tattach(config: ITrackerTarget): void {\r\n\t\tlet root = document.body;\r\n\t\tconst gantt = this._gantt;\r\n\t\tif(!config.global){\r\n\t\t\troot = gantt.$root;\r\n\t\t}\r\n\r\n\t\tlet watchableTarget = null;\r\n\t\tconst handler = (event) => {\r\n\t\t\tconst eventTarget = domHelpers.getTargetNode(event);\r\n\t\t\tconst targetNode = domHelpers.closest(eventTarget, config.selector);\r\n\t\t\tif(domHelpers.isChildOf(eventTarget, this.tooltip.getNode())){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst doOnMouseEnter = () => {\r\n\t\t\t\twatchableTarget = targetNode;\r\n\t\t\t\tconfig.onmouseenter(event, targetNode);\r\n\t\t\t};\r\n\r\n\t\t\tif(watchableTarget){\r\n\t\t\t\tif(targetNode && targetNode === watchableTarget){\r\n\t\t\t\t\tconfig.onmousemove(event, targetNode);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tconfig.onmouseleave(event, watchableTarget);\r\n\t\t\t\t\twatchableTarget = null;\r\n\r\n\t\t\t\t\tif(targetNode && targetNode !== watchableTarget){\r\n\t\t\t\t\t\tdoOnMouseEnter();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tif(targetNode){\r\n\t\t\t\t\tdoOnMouseEnter();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.detach(config.selector);\r\n\t\tthis._domEvents.attach(root, \"mousemove\", handler);\r\n\t\tthis._listeners[config.selector] = {\r\n\t\t\tnode: root,\r\n\t\t\thandler\r\n\t\t};\r\n\t}\r\n\r\n\tdetach(selector: string): void {\r\n\t\tconst listener = this._listeners[selector];\r\n\t\tif(listener){\r\n\t\t\tthis._domEvents.detach(listener.node, \"mousemove\", listener.handler);\r\n\t\t}\r\n\t}\r\n\r\n\ttooltipFor(config: ITooltipConfig): void {\r\n\t\tconst cloneDomEvent = (event: MouseEvent) => {\r\n\t\t\tlet clone = event;\r\n\t\t\t// making events survive timeout in ie\r\n\t\t\t// tslint:disable-next-line no-string-literal\r\n\t\t\tif(document[\"createEventObject\"] && !document.createEvent){\r\n\t\t\t\t// tslint:disable-next-line no-string-literal\r\n\t\t\t\tclone = document[\"createEventObject\"](event);\r\n\t\t\t}\r\n\t\t\treturn clone;\r\n\t\t};\r\n\t\tthis._initDelayedFunctions();\r\n\t\tthis.attach({\r\n\t\t\tselector: config.selector,\r\n\t\t\tglobal: config.global,\r\n\t\t\tonmouseenter:(event: MouseEvent, node: HTMLElement) => {\r\n\t\t\t\tconst html = config.html(event, node);\r\n\t\t\t\tif(html){\r\n\t\t\t\t\tthis.delayShow(cloneDomEvent(event), html);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonmousemove:(event: MouseEvent, node: HTMLElement) => {\r\n\t\t\t\tconst html = config.html(event, node);\r\n\t\t\t\tif(html){\r\n\t\t\t\t\tthis.delayShow(cloneDomEvent(event), html);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.delayShow.$cancelTimeout();\r\n\t\t\t\t\tthis.delayHide();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonmouseleave:() => {\r\n\t\t\t\tthis.delayShow.$cancelTimeout();\r\n\t\t\t\tthis.delayHide();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprivate _initDelayedFunctions(){\r\n\t\tconst gantt = this._gantt;\r\n\t\t// reset delayed functions in order to apply current values of tooltip_timeout\r\n\t\tif(this.delayShow){\r\n\t\t\tthis.delayShow.$cancelTimeout();\r\n\t\t}\r\n\t\tif(this.delayHide){\r\n\t\t\tthis.delayHide.$cancelTimeout();\r\n\t\t}\r\n\t\tthis.tooltip.hide();\r\n\r\n\t\tthis.delayShow = helpers.delay((event: MouseEvent, html: string) => {\r\n\t\t\tif(gantt.callEvent(\"onBeforeTooltip\", [event]) === false) {\r\n\t\t\t\tthis.tooltip.hide();\r\n\t\t\t} else {\r\n\t\t\t\tthis.tooltip.setContent(html);\r\n\t\t\t\tthis.tooltip.show(event);\r\n\t\t\t}\r\n\t\t}, gantt.config.tooltip_timeout || 1);\r\n\r\n\t\tthis.delayHide = helpers.delay(() => {\r\n\t\t\tthis.delayShow.$cancelTimeout();\r\n\t\t\tthis.tooltip.hide();\r\n\t\t}, gantt.config.tooltip_hide_timeout || 1);\r\n\t}\r\n\r\n}","import {TooltipManager} from \"./tooltipManager\";\r\n\r\nexport default function(gantt: any){\r\n\r\ngantt.config.tooltip_timeout = 30;\r\ngantt.config.tooltip_offset_y = 20;\r\ngantt.config.tooltip_offset_x = 10;\r\ngantt.config.tooltip_hide_timeout = 30;\r\n\r\n\r\n\r\nconst tooltipManager = new TooltipManager(gantt);\r\n\r\ngantt.ext.tooltips = tooltipManager;\r\n\r\ngantt.attachEvent(\"onGanttReady\", function(){\r\n\t//GS-2230: in case if `getGanttInstance` created without container\r\n\tif(!gantt.$root) return;\r\n\ttooltipManager.tooltipFor({\r\n\t\tselector: \"[\"+gantt.config.task_attribute+\"]:not(.gantt_task_row)\",\r\n\t\thtml: (event: MouseEvent) => {\r\n\t\t\tif (gantt.config.touch && !gantt.config.touch_tooltip) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst targetTaskId = gantt.locate(event);\r\n\t\t\tif(gantt.isTaskExists(targetTaskId)){\r\n\t\t\t\tconst task = gantt.getTask(targetTaskId);\r\n\t\t\t\treturn gantt.templates.tooltip_text(task.start_date, task.end_date, task);\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\tglobal: false\r\n\t});\r\n});\r\n\r\ngantt.attachEvent(\"onDestroy\", function() {\r\n\ttooltipManager.destructor();\r\n});\r\n\r\ngantt.attachEvent(\"onLightbox\", function() {\r\n\ttooltipManager.hideTooltip();\r\n});\r\nconst isLinkCreate = () => {\r\n\tconst state = gantt.getState();\r\n\treturn !!state.link_source_id;\r\n};\r\ngantt.attachEvent(\"onBeforeTooltip\", function() {\r\n\tif (isLinkCreate()){\r\n\t\treturn false;\r\n\t}\r\n});\r\n\r\ngantt.attachEvent(\"onGanttScroll\", function(){\r\n\ttooltipManager.hideTooltip();\r\n});\r\n\r\n}","import { IInlineEditState, IMonitor, IUndo, IUndoCommand, TActionType, TEntityType, TUndoValue } from \"./types\";\r\n\r\nconst noTrack = {\r\n\tonBeforeUndo: \"onAfterUndo\",\r\n\tonBeforeRedo: \"onAfterRedo\"\r\n};\r\n\r\nconst batchActions = [\r\n\t\"onTaskDragStart\",\r\n\t\"onAfterTaskUpdate\",\r\n\t\"onAfterParentExpand\",\r\n\t\"onAfterTaskDelete\",\r\n\t\"onBeforeBatchUpdate\"\r\n];\r\n\r\nexport class Monitor implements IMonitor {\r\n\tprivate _batchAction = null;\r\n\tprivate _batchMode = false;\r\n\tprivate _ignore = false;\r\n\tprivate _ignoreMoveEvents = false;\r\n\tprivate _initialTasks = {};\r\n\tprivate _initialLinks = {};\r\n\tprivate _nestedTasks =  {};\r\n\tprivate _nestedLinks = {};\r\n\tprivate _timeout;\r\n\tprivate _gantt: any;\r\n\tprivate _undo: IUndo;\r\n\r\n\tconstructor(undo: IUndo, gantt: any) {\r\n\t\tthis._undo = undo;\r\n\t\tthis._gantt = gantt;\r\n\t\tthis._attachEvents();\r\n\t}\r\n\r\n\tstore(id: TaskID | LinkID, type: TEntityType, overwrite: boolean = false) {\r\n\t\tif (type === this._gantt.config.undo_types.task) {\r\n\t\t\treturn this._storeTask(id, overwrite);\r\n\t\t}\r\n\t\tif (type === this._gantt.config.undo_types.link) {\r\n\t\t\treturn this._storeLink(id, overwrite);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tisMoveEventsIgnored() {\r\n\t\treturn this._ignoreMoveEvents;\r\n\t}\r\n\ttoggleIgnoreMoveEvents(newValue?: boolean) {\r\n\t\tthis._ignoreMoveEvents = newValue || false;\r\n\t}\r\n\tstartIgnore() {\r\n\t\tthis._ignore = true;\r\n\t}\r\n\tstopIgnore() {\r\n\t\tthis._ignore = false;\r\n\t}\r\n\tstartBatchAction() {\r\n\t\t// try catching updates made from event handlers using timeout\r\n\t\tif (!this._timeout){\r\n\t\t\tthis._timeout = setTimeout(() => {\r\n\t\t\t\tthis.stopBatchAction();\r\n\t\t\t\tthis._timeout = null;\r\n\t\t\t}, 10);\r\n\t\t}\r\n\r\n\r\n\t\tif (this._ignore || this._batchMode) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._batchMode = true;\r\n\t\tthis._batchAction = this._undo.action.create();\r\n\t}\r\n\tstopBatchAction() {\r\n\t\tif (this._ignore) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst undo = this._undo;\r\n\t\tif (this._batchAction) {\r\n\t\t\tundo.logAction(this._batchAction);\r\n\t\t}\r\n\t\tthis._batchMode = false;\r\n\t\tthis._batchAction = null;\r\n\t}\r\n\tonTaskAdded(task: ITask) {\r\n\t\tif (!this._ignore) {\r\n\t\t\tthis._storeTaskCommand(task, this._undo.command.type.add);\r\n\t\t}\r\n\t}\r\n\tonTaskUpdated(task: ITask) {\r\n\t\tif (!this._ignore) {\r\n\t\t\tthis._storeTaskCommand(task, this._undo.command.type.update);\r\n\t\t}\r\n\t}\r\n\tonTaskMoved(task: ITask) {\r\n\t\tif (!this._ignore) {\r\n\t\t\t(task as any).$local_index = this._gantt.getTaskIndex(task.id);\r\n\t\t\tthis._storeEntityCommand(\r\n\t\t\t\ttask,\r\n\t\t\t\tthis.getInitialTask(task.id),\r\n\t\t\t\tthis._undo.command.type.move,\r\n\t\t\t\tthis._undo.command.entity.task\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\tonTaskDeleted(task: ITask) {\r\n\t\tif (!this._ignore) {\r\n\t\t\tthis._storeTaskCommand(task, this._undo.command.type.remove);\r\n\t\t\tif (this._nestedTasks[task.id]) {\r\n\t\t\t\tconst children = this._nestedTasks[task.id];\r\n\t\t\t\tfor (let i = 0; i < children.length; i++) {\r\n\t\t\t\t\tthis._storeTaskCommand(children[i], this._undo.command.type.remove);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this._nestedLinks[task.id]) {\r\n\t\t\t\tconst childrenLinks = this._nestedLinks[task.id];\r\n\t\t\t\tfor (let i = 0; i < childrenLinks.length; i++) {\r\n\t\t\t\t\tthis._storeLinkCommand(childrenLinks[i], this._undo.command.type.remove);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tonLinkAdded(link: ILink) {\r\n\t\tif (!this._ignore) {\r\n\t\t\tthis._storeLinkCommand(link, this._undo.command.type.add);\r\n\t\t}\r\n\t}\r\n\tonLinkUpdated(link: ILink) {\r\n\t\tif (!this._ignore) {\r\n\t\t\tthis._storeLinkCommand(link, this._undo.command.type.update);\r\n\t\t}\r\n\t}\r\n\tonLinkDeleted(link: ILink) {\r\n\t\tif (!this._ignore) {\r\n\t\t\tthis._storeLinkCommand(link, this._undo.command.type.remove);\r\n\t\t}\r\n\t}\r\n\tsetNestedTasks(id: TaskID, taskIds: TaskID[]) {\r\n\t\tconst gantt = this._gantt;\r\n\t\tlet task = null;\r\n\t\tconst tasks = [];\r\n\t\tlet\tlinkIds = this._getLinks(gantt.getTask(id));\r\n\r\n\t\tfor (let i = 0; i < taskIds.length; i++) {\r\n\t\t\ttask = this.setInitialTask(taskIds[i]);\r\n\t\t\tlinkIds = linkIds.concat(this._getLinks(task));\r\n\t\t\ttasks.push(task);\r\n\t\t}\r\n\r\n\t\tconst uniqueLinks = {};\r\n\t\tfor (let i = 0; i < linkIds.length; i++) {\r\n\t\t\tuniqueLinks[linkIds[i]] = true;\r\n\t\t}\r\n\t\tconst links = [];\r\n\t\tfor (const i in uniqueLinks) {\r\n\t\t\tlinks.push(this.setInitialLink(i));\r\n\t\t}\r\n\t\tthis._nestedTasks[id] = tasks;\r\n\t\tthis._nestedLinks[id] = links;\r\n\t}\r\n\tsetInitialTask(id: TaskID, overwrite?: boolean) {\r\n\t\tconst gantt = this._gantt;\r\n\t\tif (overwrite || (!this._initialTasks[id] || !this._batchMode)) {\r\n\t\t\tconst task = gantt.copy(gantt.getTask(id));\r\n\t\t\ttask.$index = gantt.getGlobalTaskIndex(id);\r\n\t\t\ttask.$local_index = gantt.getTaskIndex(id);\r\n\t\t\tthis.setInitialTaskObject(id, task);\r\n\t\t}\r\n\t\treturn this._initialTasks[id];\r\n\t}\r\n\tgetInitialTask(id: TaskID) {\r\n\t\treturn this._initialTasks[id];\r\n\t}\r\n\tclearInitialTasks() {\r\n\t\tthis._initialTasks = {};\r\n\t}\r\n\tsetInitialTaskObject(id: TaskID, object: ITask) {\r\n\t\tthis._initialTasks[id] = object;\r\n\t}\r\n\tsetInitialLink(id: LinkID, overwrite?: boolean) {\r\n\t\tif (!this._initialLinks[id] || !this._batchMode) {\r\n\t\t\tthis._initialLinks[id] = this._gantt.copy(this._gantt.getLink(id));\r\n\t\t}\r\n\t\treturn this._initialLinks[id];\r\n\t}\r\n\tgetInitialLink(id: LinkID) {\r\n\t\treturn this._initialLinks[id];\r\n\t}\r\n\tclearInitialLinks() {\r\n\t\tthis._initialLinks = {};\r\n\t}\r\n\tprivate _attachEvents() {\r\n\t\tlet deleteCacheCooldown = null;\r\n\t\tconst gantt = this._gantt;\r\n\r\n\t\tconst saveInitialAll = () => {\r\n\t\t\tif (!deleteCacheCooldown) {\r\n\t\t\t\tdeleteCacheCooldown = setTimeout(() => {\r\n\t\t\t\t\tdeleteCacheCooldown = null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.clearInitialTasks();\r\n\t\t\t\tgantt.eachTask((task: ITask) => {\r\n\t\t\t\t\tthis.setInitialTask(task.id);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.clearInitialLinks();\r\n\t\t\t\tgantt.getLinks().forEach((link: ILink) => {\r\n\t\t\t\t\tthis.setInitialLink(link.id);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t\tconst getMoveObjectByTaskId = (id: TaskID) => {\r\n\t\t\treturn gantt.copy(gantt.getTask(id));\r\n\t\t};\r\n\r\n\t\tfor (const i in noTrack) {\r\n\t\t\tgantt.attachEvent(i, () => {\r\n\t\t\t\tthis.startIgnore();\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t\tgantt.attachEvent(noTrack[i], () => {\r\n\t\t\t\tthis.stopIgnore();\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfor (let i  = 0; i < batchActions.length; i++) {\r\n\t\t\tgantt.attachEvent(batchActions[i], () => {\r\n\t\t\t\tthis.startBatchAction();\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tgantt.attachEvent(\"onParse\", () => {\r\n\t\t\tthis._undo.clearUndoStack();\r\n\t\t\tthis._undo.clearRedoStack();\r\n\t\t\tsaveInitialAll();\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterTaskAdd\", (id: TaskID, task: ITask) => {\r\n\t\t\tthis.setInitialTask(id, true);\r\n\t\t\tthis.onTaskAdded(task);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterTaskUpdate\", (id: TaskID, task: ITask) => {\r\n\t\t\tthis.onTaskUpdated(task);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterParentExpand\", (id: TaskID, task: ITask) => {\r\n\t\t\tthis.onTaskUpdated(task);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterTaskDelete\", (id: TaskID, task: ITask) => {\r\n\t\t\tthis.onTaskDeleted(task);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterLinkAdd\", (id: LinkID, link: ILink) => {\r\n\t\t\tthis.setInitialLink(id, true);\r\n\t\t\tthis.onLinkAdded(link);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterLinkUpdate\", (id: LinkID, link: ILink) => {\r\n\t\t\tthis.onLinkUpdated(link);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onAfterLinkDelete\", (id: LinkID, link: ILink) => {\r\n\t\t\tthis.onLinkDeleted(link);\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onRowDragEnd\", (id: TaskID, target: TaskID) => {\r\n\t\t\tthis.onTaskMoved(getMoveObjectByTaskId(id));\r\n\t\t\tthis.toggleIgnoreMoveEvents();\r\n\t\t\treturn true;\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onBeforeTaskDelete\", (id: TaskID) => {\r\n\t\t\tthis.store(id, gantt.config.undo_types.task);\r\n\t\t\tconst nested = [];\r\n\r\n\t\t\t// remember task indexes in case their being deleted in a loop, so they could be restored in the correct order\r\n\t\t\tsaveInitialAll();\r\n\r\n\t\t\tgantt.eachTask((task: ITask) => {\r\n\t\t\t\tnested.push(task.id);\r\n\t\t\t}, id);\r\n\t\t\tthis.setNestedTasks(id, nested);\r\n\t\t\treturn true;\r\n\t\t});\r\n\t\tconst datastore = gantt.getDatastore(\"task\");\r\n\r\n\t\tdatastore.attachEvent(\"onBeforeItemMove\", (id: TaskID, parent: TaskID, tindex: number) => {\r\n\t\t\tif (!this.isMoveEventsIgnored()) {\r\n\t\t\t\tsaveInitialAll();\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tdatastore.attachEvent(\"onAfterItemMove\", (id: TaskID, parent: TaskID, tindex: number) => {\r\n\t\t\tif (!this.isMoveEventsIgnored()) {\r\n\t\t\t\tthis.onTaskMoved(getMoveObjectByTaskId(id));\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onRowDragStart\", (id: TaskID, target: TaskID, e: Event) => {\r\n\t\t\tthis.toggleIgnoreMoveEvents(true);\r\n\t\t\tsaveInitialAll();\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tlet dragId = null;\r\n\t\tlet projectDrag = false;\r\n\t\tgantt.attachEvent(\"onBeforeTaskDrag\", (taskId: TaskID) => {\r\n\t\t\tdragId = gantt.getState().drag_id;\r\n\t\t\tif (dragId === taskId){\r\n\t\t\t\tconst task = gantt.getTask(taskId);\r\n\t\t\t\tif (gantt.isSummaryTask(task) && gantt.config.drag_project){\r\n\t\t\t\t\tprojectDrag = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// GS-99. Store the initial task dates before multiple drag\r\n\t\t\tif (gantt.plugins().multiselect){\r\n\t\t\t\tconst selectedIds = gantt.getSelectedTasks();\r\n\t\t\t\tif (selectedIds.length > 1){\r\n\t\t\t\t\tselectedIds.forEach((id)=>{\r\n\t\t\t\t\t\tthis.store(id, gantt.config.undo_types.task, true);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this.store(taskId, gantt.config.undo_types.task);\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onAfterTaskDrag\", (taskId: TaskID) => {\r\n\t\t\t// if we drag multiple tasks and other tasks move to another date after that,\r\n\t\t\t// auto-scheduling/correct work time should occur in anoher command.\r\n\t\t\t// otherwise, when we undo the changes, the task constraint is not restored correctly\r\n\t\t\tconst multipleDrag = projectDrag || (gantt.plugins().multiselect && gantt.getSelectedTasks().length > 1);\r\n\t\t\tif (multipleDrag && dragId === taskId){\r\n\t\t\t\tprojectDrag = false;\r\n\t\t\t\tdragId = null;\r\n\t\t\t\tthis.stopBatchAction();\r\n\t\t\t}\r\n\t\t\t// GS-99. When dragging multiple tasks, we need to store the initial tasks\r\n\t\t\tthis.store(taskId, gantt.config.undo_types.task, true);\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onLightbox\", (taskId: TaskID) => this.store(taskId, gantt.config.undo_types.task));\r\n\r\n\t\tgantt.attachEvent(\"onBeforeTaskAutoSchedule\", (task: ITask) => {\r\n\t\t\tthis.store(task.id, gantt.config.undo_types.task, true);\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tif (gantt.ext.inlineEditors) {\r\n\t\t\t// remove the onGanttLayoutReady wrapper when GS-1288 is merged\r\n\t\t\tlet onBeforeEditStartId = null;\r\n\t\t\tlet onEditStart = null;\r\n\t\t\tgantt.attachEvent(\"onGanttLayoutReady\", () => {\r\n\t\t\t\tif (onBeforeEditStartId) {\r\n\t\t\t\t\tgantt.ext.inlineEditors.detachEvent(onBeforeEditStartId);\r\n\t\t\t\t}\r\n\t\t\t\tif (onEditStart) {\r\n\t\t\t\t\tgantt.ext.inlineEditors.detachEvent(onEditStart);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tonEditStart = gantt.ext.inlineEditors.attachEvent(\"onEditStart\", (state: IInlineEditState) => {\r\n\t\t\t\t\tthis.store(state.id, gantt.config.undo_types.task);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// GS-99. If another inline editor is opened and we open a new inline editor,\r\n\t\t\t\t// we shouldn't use the batchAction\r\n\t\t\t\tonBeforeEditStartId = gantt.ext.inlineEditors.attachEvent(\"onBeforeEditStart\", (state: IInlineEditState) => {\r\n\t\t\t\t\tthis.stopBatchAction();\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _storeCommand(command: IUndoCommand) {\r\n\t\tconst undo = this._undo;\r\n\t\tundo.updateConfigs();\r\n\r\n\t\tif (!undo.undoEnabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this._batchMode) {\r\n\t\t\tthis._batchAction.commands.push(command);\r\n\t\t} else {\r\n\t\t\tconst action = undo.action.create([command]);\r\n\t\t\tundo.logAction(action);\r\n\t\t}\r\n\t}\r\n\tprivate _storeEntityCommand(obj: TUndoValue, old: TUndoValue, actionType: TActionType, entityType: TEntityType) {\r\n\t\tconst undo = this._undo;\r\n\t\tconst command = undo.command.create(obj, old, actionType, entityType);\r\n\t\tthis._storeCommand(command);\r\n\t}\r\n\tprivate _storeTaskCommand(obj: ITask, type: TActionType) {\r\n\t\tif(this._gantt.isTaskExists(obj.id)){\r\n\t\t\t(obj as any).$local_index = this._gantt.getTaskIndex(obj.id);\r\n\t\t}\r\n\r\n\t\tthis._storeEntityCommand(obj, this.getInitialTask(obj.id), type, this._undo.command.entity.task);\r\n\t}\r\n\tprivate _storeLinkCommand(obj: ILink, type: TActionType) {\r\n\t\tthis._storeEntityCommand(obj, this.getInitialLink(obj.id), type, this._undo.command.entity.link);\r\n\t}\r\n\tprivate _getLinks(task: ITask) {\r\n\t\treturn task.$source.concat(task.$target);\r\n\t}\r\n\tprivate _storeTask(taskId: TaskID, overwrite: boolean = false) {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis.setInitialTask(taskId, overwrite);\r\n\t\tgantt.eachTask((child: ITask) => {\r\n\t\t\tthis.setInitialTask(child.id);\r\n\t\t}, taskId);\r\n\t\treturn true;\r\n\t}\r\n\tprivate _storeLink(linkId: LinkID, overwrite: boolean = false) {\r\n\t\tthis.setInitialLink(linkId, overwrite);\r\n\t\treturn true;\r\n\t}\r\n}","import { IUndo, IUndoCommand, IUndoCommands, IUndoPropAction, IUndoPropCommand, TActionType, TEntityType, TUndoStack, TUndoValue } from \"./types\";\r\n\r\nconst MAX_UNDO_STEPS = 100;\r\n\r\nexport class Undo implements IUndo {\r\n\r\n\tmaxSteps = MAX_UNDO_STEPS;\r\n\tundoEnabled = true;\r\n\tredoEnabled = true;\r\n\taction: IUndoPropAction = {\r\n\t\tcreate: (commands?: IUndoCommand[]): IUndoCommands => {\r\n\t\t\treturn { commands: (commands ? commands.slice() : []) };\r\n\t\t},\r\n\t\tinvert: (action: IUndoCommands): IUndoCommands => {\r\n\t\t\tconst gantt = this._gantt;\r\n\t\t\tconst revert = gantt.copy(action);\r\n\t\t\tconst commands = this.command;\r\n\t\t\tfor (let i = 0; i < action.commands.length; i++) {\r\n\t\t\t\tconst command = revert.commands[i] = commands.invert(revert.commands[i]);\r\n\t\t\t\tif (command.type === commands.type.update || command.type === commands.type.move) {\r\n\t\t\t\t\t[command.value, command.oldValue] = [command.oldValue, command.value];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn revert as IUndoCommands;\r\n\t\t}\r\n\t};\r\n\tcommand: IUndoPropCommand = {\r\n\t\t// entities that require different processing for undoing-redoing changes (gantt.config.undo_types)\r\n\t\tentity: null,\r\n\r\n\t\t// types of traced actions (gantt.config.undo_actions)\r\n\t\ttype: null,\r\n\r\n\t\tcreate: (value: TUndoValue, oldValue: TUndoValue, type: TActionType, entity: TEntityType): IUndoCommand => {\r\n\t\t\tconst gantt = this._gantt;\r\n\t\t\treturn {\r\n\t\t\t\tentity,\r\n\t\t\t\ttype,\r\n\t\t\t\tvalue: gantt.copy(value),\r\n\t\t\t\toldValue: gantt.copy(oldValue || value)\r\n\t\t\t};\r\n\t\t},\r\n\t\tinvert: (command: IUndoCommand): IUndoCommand => {\r\n\t\t\tconst gantt = this._gantt;\r\n\t\t\tconst revert = gantt.copy(command);\r\n\t\t\trevert.type = this.command.inverseCommands(command.type);\r\n\t\t\treturn revert;\r\n\t\t},\r\n\t\tinverseCommands: (command: TActionType): TActionType => {\r\n\t\t\tconst gantt = this._gantt;\r\n\t\t\tconst types = this.command.type;\r\n\t\t\tswitch (command) {\r\n\t\t\t\tcase types.update:\r\n\t\t\t\t\treturn types.update;\r\n\t\t\t\tcase types.remove:\r\n\t\t\t\t\treturn types.add;\r\n\t\t\t\tcase types.add:\r\n\t\t\t\t\treturn types.remove;\r\n\t\t\t\tcase types.move:\r\n\t\t\t\t\treturn types.move;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tgantt.assert(false, \"Invalid command \"+ command);\r\n\t\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tprivate _undoStack = [];\r\n\tprivate _redoStack = [];\r\n\tprivate _gantt: any;\r\n\r\n\tconstructor(gantt: any){\r\n\t\tthis._gantt = gantt;\r\n\t}\r\n\tgetUndoStack() {\r\n\t\treturn this._undoStack;\r\n\t}\r\n\tsetUndoStack(stack: []) {\r\n\t\tthis._undoStack = stack;\r\n\t}\r\n\r\n\tgetRedoStack() {\r\n\t\treturn this._redoStack;\r\n\t}\r\n\tsetRedoStack(stack: []) {\r\n\t\tthis._redoStack = stack;\r\n\t}\r\n\r\n\tclearUndoStack() {\r\n\t\tthis._undoStack = [];\r\n\t}\r\n\r\n\tclearRedoStack() {\r\n\t\tthis._redoStack = [];\r\n\t}\r\n\r\n\tupdateConfigs() {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis.maxSteps = gantt.config.undo_steps || MAX_UNDO_STEPS;\r\n\t\tthis.command.entity = gantt.config.undo_types;\r\n\t\tthis.command.type = gantt.config.undo_actions;\r\n\t\tthis.undoEnabled = !!gantt.config.undo;\r\n\t\tthis.redoEnabled = !!gantt.config.redo; // GS-873, Redo should work even when the `gantt.config.undo` is disabled.\r\n\t}\r\n\r\n\tundo() {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis.updateConfigs();\r\n\t\tif (!this.undoEnabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst action = this._pop(this._undoStack);\r\n\t\tif (action) {\r\n\t\t\tthis._reorderCommands(action);\r\n\t\t}\r\n\t\tif (gantt.callEvent(\"onBeforeUndo\", [action]) !== false) {\r\n\t\t\tif (action) {\r\n\t\t\t\tthis._applyAction(this.action.invert(action));\r\n\t\t\t\tthis._push(this._redoStack, gantt.copy(action));\r\n\t\t\t\tgantt.callEvent(\"onAfterUndo\", [action]);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tgantt.callEvent(\"onAfterUndo\", [null]);\r\n\t}\r\n\r\n\tredo() {\r\n\t\tconst gantt = this._gantt;\r\n\t\tthis.updateConfigs();\r\n\t\tif (!this.redoEnabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst action = this._pop(this._redoStack);\r\n\t\tif (action) {\r\n\t\t\tthis._reorderCommands(action);\r\n\t\t}\r\n\r\n\t\tif (gantt.callEvent(\"onBeforeRedo\", [action]) !== false) {\r\n\t\t\tif (action) {\r\n\t\t\t\tthis._applyAction(action);\r\n\t\t\t\tthis._push(this._undoStack, gantt.copy(action));\r\n\t\t\t\tgantt.callEvent(\"onAfterRedo\", [action]);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tgantt.callEvent(\"onAfterRedo\", [null]);\r\n\t}\r\n\r\n\t// storeUndo:\r\n\tlogAction(action: IUndoCommands) {\r\n\t\tthis._push(this._undoStack, action);\r\n\t\tthis._redoStack = [];\r\n\t}\r\n\r\n\tprivate _push(stack: TUndoStack, action: IUndoCommands): IUndoCommands {\r\n\t\tconst gantt = this._gantt;\r\n\t\tif (!action.commands.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst event = stack === this._undoStack ? \"onBeforeUndoStack\" : \"onBeforeRedoStack\";\r\n\t\tif (gantt.callEvent(event, [action]) === false){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// commands can be removed from event handler\r\n\t\tif (!action.commands.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tstack.push(action);\r\n\t\twhile (stack.length > this.maxSteps) {\r\n\t\t\tstack.shift();\r\n\t\t}\r\n\t\treturn action;\r\n\t}\r\n\r\n\tprivate _pop(stack: TUndoStack): IUndoCommands {\r\n\t\treturn stack.pop();\r\n\t}\r\n\r\n\tprivate _reorderCommands(action) {\r\n\t\t// firstly process tasks and only then links\r\n\t\t// in order to ensure links are added not earlier than their tasks\r\n\t\t// firstly to 'move' actions and only then updates\r\n\t\tconst weights = { any: 0, link:1, task:2 };\r\n\t\tconst actionWeights = { move: 1, any:0 };\r\n\t\taction.commands.sort(function(a, b) {\r\n\t\t\tif (a.entity === \"task\" && b.entity === \"task\") {\r\n\t\t\t\tif (a.type !== b.type) {\r\n\t\t\t\t\treturn (actionWeights[b.type] || 0) - (actionWeights[a.type] || 0);\r\n\t\t\t\t} else if (a.type === \"move\" && a.oldValue && b.oldValue && b.oldValue.parent === a.oldValue.parent) {\r\n\t\t\t\t\treturn a.oldValue.$index - b.oldValue.$index;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst weightA = weights[a.entity] || weights.any;\r\n\t\t\t\tconst weightB = weights[b.entity] || weights.any;\r\n\t\t\t\treturn weightB - weightA;\r\n\t\t\t}\r\n\r\n\t\t});\r\n\t}\r\n\r\n\tprivate _applyAction(action: IUndoCommands) {\r\n\t\tlet command = null;\r\n\t\tconst entities = this.command.entity;\r\n\t\tconst actions = this.command.type;\r\n\t\tconst gantt = this._gantt;\r\n\t\tconst methods = {};\r\n\t\tmethods[entities.task] = {\r\n\t\t\tadd: \"addTask\",\r\n\t\t\tget: \"getTask\",\r\n\t\t\tupdate: \"updateTask\",\r\n\t\t\tremove: \"deleteTask\",\r\n\t\t\tmove: \"moveTask\",\r\n\t\t\tisExists: \"isTaskExists\"\r\n\t\t};\r\n\t\tmethods[entities.link] = {\r\n\t\t\tadd: \"addLink\",\r\n\t\t\tget: \"getLink\",\r\n\t\t\tupdate: \"updateLink\",\r\n\t\t\tremove: \"deleteLink\",\r\n\t\t\tisExists: \"isLinkExists\"\r\n\t\t};\r\n\r\n\t\tgantt.batchUpdate(function() {\r\n\t\t\t// it is logical to undo actions from the last one to the first one\r\n\t\t\t// but we have to do it from the first one because the order\r\n\t\t\t// of tasks ($index and $local_index) depends on the existing tasks\r\n\t\t\tfor (let i = 0; i < action.commands.length; i++) {\r\n\t\t\t\tcommand = action.commands[i];\r\n\t\t\t\tconst method = methods[command.entity][command.type];\r\n\t\t\t\tconst getMethod = methods[command.entity].get;\r\n\t\t\t\tconst check = methods[command.entity].isExists;\r\n\r\n\t\t\t\tif (command.type === actions.add) {\r\n\t\t\t\t\tgantt[method](command.oldValue, command.oldValue.parent, command.oldValue.$local_index);\r\n\t\t\t\t} else if (command.type === actions.remove) {\r\n\t\t\t\t\tif (gantt[check](command.value.id)) {\r\n\t\t\t\t\t\tgantt[method](command.value.id);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command.type === actions.update) {\r\n\t\t\t\t\tconst item = gantt[getMethod](command.value.id);\r\n\t\t\t\t\tfor(const prop in command.value){\r\n\t\t\t\t\t\tconst internalProperty = prop.startsWith(\"$\") || prop.startsWith(\"_\");\r\n\t\t\t\t\t\tconst whitelist = [\"$open\"];\r\n\t\t\t\t\t\tlet copyProperty = !internalProperty;\r\n\t\t\t\t\t\tif (whitelist.indexOf(prop) > -1){\r\n\t\t\t\t\t\t\tcopyProperty = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(copyProperty){\r\n\t\t\t\t\t\t\titem[prop] = command.value[prop];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tgantt[method](command.value.id);\r\n\t\t\t\t} else if (command.type === actions.move) {\r\n\t\t\t\t\tgantt[method](command.value.id, command.value.$local_index, command.value.parent);\r\n\t\t\t\t\t// GS-680: We should send the changes to the server after we undo vertical reorder\r\n\t\t\t\t\tgantt.callEvent(\"onRowDragEnd\", [command.value.id]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}","import { Monitor } from \"./monitor\";\r\nimport { IMonitor, IUndoCommand, TEntityType, TUndoStack } from \"./types\";\r\nimport { Undo } from \"./undo\";\r\n\r\nexport default function(gantt: any){\r\n\r\nconst _undo = new Undo(gantt);\r\nconst monitor: IMonitor = new Monitor(_undo, gantt);\r\n\r\ngantt.config.undo = true;\r\ngantt.config.redo = true;\r\n\r\n/**\r\n * entities that require different processing for undoing-redoing changes\r\n * @type {{link: string, task: string}}\r\n */\r\ngantt.config.undo_types = {\r\n\tlink: \"link\",\r\n\ttask: \"task\"\r\n};\r\n\r\n/**\r\n * types of traced actions\r\n * @type {{update: string, remove: string, add: string}}\r\n */\r\ngantt.config.undo_actions = {\r\n\tupdate: \"update\",\r\n\tremove: \"remove\", // remove item from datastore\r\n\tadd: \"add\",\r\n\tmove: \"move\" // move task in grid\r\n};\r\n\r\nif (!gantt.ext) {\r\n\tgantt.ext = {};\r\n}\r\n\r\ngantt.ext.undo = {\r\n\tundo: () => _undo.undo(),\r\n\tredo: () => _undo.redo(),\r\n\tgetUndoStack: () => _undo.getUndoStack(),\r\n\tsetUndoStack: (stack:[]) => _undo.setUndoStack(stack),\r\n\tgetRedoStack: () => _undo.getRedoStack(),\r\n\tsetRedoStack: (stack:[]) => _undo.setRedoStack(stack),\r\n\tclearUndoStack: () => _undo.clearUndoStack(),\r\n\tclearRedoStack: () => _undo.clearRedoStack(),\r\n\tsaveState: (id: TaskID | LinkID, type: TEntityType) => monitor.store(id, type, true),\r\n\tgetInitialState: (id: TaskID | LinkID, type: TEntityType) => {\r\n\t\tif(type === gantt.config.undo_types.link){\r\n\t\t\treturn monitor.getInitialLink(id);\r\n\t\t}else{\r\n\t\t\treturn monitor.getInitialTask(id);\r\n\t\t}\r\n\t}\r\n};\r\n\r\ngantt.undo = gantt.ext.undo.undo;\r\ngantt.redo = gantt.ext.undo.redo;\r\ngantt.getUndoStack = gantt.ext.undo.getUndoStack;\r\ngantt.getRedoStack = gantt.ext.undo.getRedoStack;\r\ngantt.clearUndoStack = gantt.ext.undo.clearUndoStack;\r\ngantt.clearRedoStack = gantt.ext.undo.clearRedoStack;\r\n\r\nfunction isEqualIds(first: TaskID, second: TaskID){\r\n\treturn String(first) === String(second);\r\n};\r\n\r\nfunction updTask(task: ITask, oldId: TaskID, newId: TaskID) {\r\n\tif (!task) { return; }\r\n\r\n\tif (isEqualIds(task.id, oldId)) {\r\n\t\ttask.id = newId;\r\n\t}\r\n\r\n\tif (isEqualIds(task.parent, oldId)) {\r\n\t\ttask.parent = newId;\r\n\t}\r\n}\r\n\r\nfunction changeTaskCommandId(command: IUndoCommand, oldId: TaskID, newId: TaskID) {\r\n\tupdTask(command.value, oldId, newId);\r\n\tupdTask(command.oldValue, oldId, newId);\r\n}\r\n\r\nfunction updLink(link: ILink, oldTaskId: TaskID, newTaskId: TaskID) {\r\n\tif (!link) { return; }\r\n\tif (isEqualIds(link.source, oldTaskId)) {\r\n\t\tlink.source = newTaskId;\r\n\t}\r\n\tif (isEqualIds(link.target, oldTaskId)) {\r\n\t\tlink.target = newTaskId;\r\n\t}\r\n}\r\n\r\nfunction changeLinkCommandId(command: IUndoCommand, oldId: LinkID, newId: LinkID) {\r\n\tupdLink(command.value, oldId, newId);\r\n\tupdLink(command.oldValue, oldId, newId);\r\n}\r\n\r\nfunction updateTasksIds(log: TUndoStack, oldId: TaskID, newId: TaskID) {\r\n\tconst undo = _undo;\r\n\r\n\tfor (let i = 0; i < log.length; i++) {\r\n\t\tconst entry = log[i];\r\n\t\tfor (let j = 0; j < entry.commands.length; j++) {\r\n\t\t\tif (entry.commands[j].entity === undo.command.entity.task) {\r\n\t\t\t\tchangeTaskCommandId(entry.commands[j], oldId, newId);\r\n\t\t\t} else if (entry.commands[j].entity === undo.command.entity.link) {\r\n\t\t\t\tchangeLinkCommandId(entry.commands[j], oldId, newId);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction updateLinksIds(log: TUndoStack, oldId: LinkID, newId: LinkID) {\r\n\tconst undo = _undo;\r\n\r\n\tfor (let i = 0; i < log.length; i++) {\r\n\t\tconst entry = log[i];\r\n\t\tfor (let j = 0; j < entry.commands.length; j++) {\r\n\t\t\tconst command = entry.commands[j];\r\n\t\t\tif (command.entity === undo.command.entity.link) {\r\n\t\t\t\tif (command.value && command.value.id === oldId) {\r\n\t\t\t\t\tcommand.value.id = newId;\r\n\t\t\t\t}\r\n\t\t\t\tif (command.oldValue && command.oldValue.id === oldId) {\r\n\t\t\t\t\tcommand.oldValue.id = newId;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\ngantt.attachEvent(\"onTaskIdChange\", (oldId: TaskID, newId: TaskID) => {\r\n\tconst undo = _undo;\r\n\tupdateTasksIds(undo.getUndoStack(), oldId, newId);\r\n\tupdateTasksIds(undo.getRedoStack(), oldId, newId);\r\n});\r\n\r\ngantt.attachEvent(\"onLinkIdChange\", (oldId: LinkID, newId: LinkID) => {\r\n\tconst undo = _undo;\r\n\tupdateLinksIds(undo.getUndoStack(), oldId, newId);\r\n\tupdateLinksIds(undo.getRedoStack(), oldId, newId);\r\n});\r\n\r\ngantt.attachEvent(\"onGanttReady\", () => {\r\n\t_undo.updateConfigs();\r\n});\r\n\r\n}","\r\nimport click_drag from \"./click_drag\";\r\nimport drag_timeline from \"./drag_timeline\";\r\nimport export_api from \"./export_api\";\r\nimport fullscreen from \"./fullscreen\";\r\nimport keyboard_navigation from \"./keyboard_navigation\";\r\nimport marker from \"./marker\";\r\nimport multiselect from \"./multiselect\";\r\nimport quick_info from \"./quick_info\";\r\nimport tooltip from \"./tooltip\";\r\nimport undo from \"./undo\";\r\n\r\nexport default {\r\n\tclick_drag,\r\n\tdrag_timeline,\r\n\tfullscreen,\r\n\tkeyboard_navigation,\r\n\tquick_info,\r\n\ttooltip,\r\n\tundo,\r\n\tmarker,\r\n\tmultiselect,\r\n\texport_api\r\n};","export default {\r\n\tKEY_CODES: {\r\n\t\tUP: 38,\r\n\t\tDOWN: 40,\r\n\t\tLEFT: 37,\r\n\t\tRIGHT: 39,\r\n\t\tSPACE: 32,\r\n\t\tENTER: 13,\r\n\t\tDELETE: 46,\r\n\t\tESC: 27,\r\n\t\tTAB: 9\r\n\t}\r\n};","export default class ExtensionsManager{\r\n\tprivate _extensions:{[key:string]: GanttPlugin };\r\n\r\n\tconstructor(config: {[key:string]: GanttPlugin }){\r\n\t\tthis._extensions = {};\r\n\t\tfor(const i in config){\r\n\t\t\tthis._extensions[i] = config[i];\r\n\t\t}\r\n\t}\r\n\r\n\taddExtension = (name: string, ext: GanttPlugin) => {\r\n\t\tthis._extensions[name] = ext;\r\n\t};\r\n\r\n\tgetExtension = (name: string): GanttPlugin => {\r\n\t\treturn this._extensions[name];\r\n\t};\r\n}","export default function(){\r\n\tvar services = {};\r\n\tfunction register (name, getter){\r\n\t\tservices[name] = getter;\r\n\t}\r\n\r\n\tfunction getService(name){\r\n\t\tif(!services[name]){\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn services[name]();\r\n\t}\r\n\r\n\tfunction dropService(name) {\r\n\t\tif (services[name]) {\r\n\t\t\tdelete services[name];\r\n\t\t}\r\n\t}\r\n\r\n\tvar servicesEnum = {};\r\n\r\n\treturn {\r\n\t\tservices: servicesEnum,\r\n\t\tsetService: register,\r\n\t\tgetService: getService,\r\n\t\tdropService: dropService,\r\n\t\tdestructor: function(){\r\n\t\t\tfor(var i in services){\r\n\t\t\t\tif(services[i]){\r\n\t\t\t\t\tvar service = services[i];\r\n\t\t\t\t\tif(service && service.destructor){\r\n\t\t\t\t\t\tservice.destructor();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tservices = null;\r\n\t\t}\r\n\t};\r\n};\r\n","type DurationUnits = \"minute\" | \"hour\" | \"day\" | \"week\" | \"month\" | \"year\";\r\ntype Align = \"left\" | \"center\" | \"right\";\r\ntype SectionType = \"textarea\"\r\n\t\t\t\t\t| \"time\"\r\n\t\t\t\t\t| \"duration\"\r\n\t\t\t\t\t| \"select\"\r\n\t\t\t\t\t| \"typeselect\"\r\n\t\t\t\t\t| \"parent\"\r\n\t\t\t\t\t| \"template\"\r\n\t\t\t\t\t| \"checkbox\"\r\n\t\t\t\t\t| \"radio\"\r\n\t\t\t\t\t| \"resources\"\r\n\t\t\t\t\t| \"constraint\";\r\n\r\ntype LightboxSection = Array<ILightboxSection\r\n\t| ILightboxTimeAndDurationSection\r\n\t| ILightboxInputControl\r\n\t| ILightboxSelectControl\r\n\t| ILightboxParentControl\r\n\t| ILightboxTypeselectControl>;\r\n\r\ntype LayoutView = \"grid\"\r\n\t| \"timeline\"\r\n\t| \"resizer\"\r\n\t| \"scrollbar\"\r\n\t| \"resourceGrid\"\r\n\t| \"resourceTimeline\";\r\n\r\ninterface IColumnItem {\r\n\tname: string;\r\n\tlabel?: string;\r\n\ttree?: boolean;\r\n\talign?: Align;\r\n\thide?: boolean;\r\n\tmax_width?: number;\r\n\tmin_width?: number;\r\n\tresize?: boolean;\r\n\ttemplate?: (obj: any) => string;\r\n\twidth?: number | \"*\";\r\n}\r\n\r\nexport type TModifierKeys = \"metaKey\" | \"ctrlKey\" | \"altKey\" | \"shiftKey\" | false | undefined;\r\n\r\nexport interface IScale {\r\n\tcss?: () => string;\r\n\tdate?: string;\r\n\tstep: number;\r\n\ttemplate?: (date: Date) => string;\r\n\tunit: DurationUnits;\r\n}\r\n\r\ninterface ILightboxSection {\r\n\tname: string;\r\n\tmap_to: string;\r\n\ttype: SectionType;\r\n\theight?: number;\r\n\tfocus?: boolean;\r\n}\r\n\r\ninterface ILightboxTimeAndDurationSection extends ILightboxSection {\r\n\treadonly: boolean;\r\n\tyear_range: number[] | number;\r\n\tsingle_date: boolean;\r\n\ttime_format: string;\r\n}\r\n\r\ninterface ILightboxInputControl extends ILightboxSection {\r\n\tdefault_value?: any;\r\n\toptions?: Array<{key: string, label: string}>;\r\n}\r\n\r\ninterface ILightboxSelectControl extends ILightboxInputControl {\r\n\tonchange: () => boolean | undefined;\r\n}\r\n\r\ninterface ILightboxParentControl extends ILightboxSection {\r\n\tallow_root: boolean;\r\n\troot_label: string;\r\n\tsort?: (a: any, b: any) => -1 | 0 | 1;\r\n\tfilter?: (task: string | number | object) => boolean;\r\n\ttemplate?: (start: Date, end: Date, ev: object) => string;\r\n}\r\n\r\ninterface ILightboxTypeselectControl extends ILightboxSection {\r\n\tfilter?: (typeName: string) => boolean;\r\n}\r\n\r\n\r\ninterface ILayoutScrollbar {\r\n\tview: \"scrollbar\";\r\n\tscroll?: \"x\" | \"y\";\r\n\tid: string;\r\n\theight?: number;\r\n\twidth?: number;\r\n}\r\n\r\ninterface ILayoutView {\r\n\tview: LayoutView;\r\n\tid?: string;\r\n\tscrollX?: string;\r\n\tscrollY?: string;\r\n\tconfig?: object;\r\n}\r\n\r\ninterface ILayoutGrid extends ILayoutView {\r\n\tview: \"grid\";\r\n\tbind?: string;\r\n}\r\n\r\ninterface ILayoutTimeline extends ILayoutView {\r\n\tview: \"timeline\";\r\n\tbindLinks?: string;\r\n\tlayers?: any[];\r\n}\r\n\r\ninterface ILayoutResizer {\r\n\tview?: undefined;\r\n\tresizer: boolean;\r\n\twidth: number;\r\n}\r\n\r\ninterface ILayoutResourceGrid extends ILayoutView {\r\n\tview: \"resourceGrid\";\r\n\twidth: number;\r\n\tgroup: \"string\";\r\n}\r\n\r\ninterface ILayoutResourceTimeline extends ILayoutView {\r\n\tview: \"resourceTimeline\";\r\n\twidth: number;\r\n\tgroup: \"string\";\r\n}\r\n\r\ninterface ILayoutHtml {\r\n\thtml: string;\r\n\tcss: string;\r\n\twidth: number;\r\n}\r\n\r\ntype LayoutRow = ILayoutGrid\r\n\t| ILayoutTimeline\r\n\t| ILayoutResizer\r\n\t| ILayoutResourceGrid\r\n\t| ILayoutResourceTimeline\r\n\t| ILayoutHtml\r\n\t| ILayoutScrollbar\r\n\t| { cols: LayoutCol[] };\r\n\r\ntype LayoutCol = ILayoutGrid\r\n\t| ILayoutTimeline\r\n\t| ILayoutResizer\r\n\t| ILayoutResourceGrid\r\n\t| ILayoutResourceTimeline\r\n\t| ILayoutHtml\r\n\t| ILayoutScrollbar\r\n\t| { rows: LayoutRow[] };\r\n\r\ninterface ILayout {\r\n\tcss: string;\r\n\trows?: LayoutRow[];\r\n\tcols?: LayoutCol[];\r\n}\r\n\r\ntype TCsp = boolean | \"auto\";\r\n\r\ninterface IResourceConfig {\r\n\tdataprocessor_assignments?: boolean;\r\n\tdataprocessor_resources?: boolean;\r\n\teditable_resource_diagram?: boolean;\r\n\tresource_store?: {\r\n\t\ttype?: \"treeDataStore\"|\"dataStore\"|string;\r\n\t\tfetchTasks?: boolean;\r\n\t\tinitItem?: (item: any) => any;\r\n\t};\r\n\tlightbox_resources?: (resources: any[]) => any[];\r\n\r\n}\r\n\r\ninterface IGanttConfig {\r\n\tlayout: ILayout;\r\n\tlinks: {\r\n\t\tfinish_to_start: \"0\";\r\n\t\tstart_to_start: \"1\";\r\n\t\tfinish_to_finish: \"2\";\r\n\t\tstart_to_finish: \"3\";\r\n\t};\r\n\ttypes: {\r\n\t\ttask: string;\r\n\t\tproject: string;\r\n\t\tmilestone: string;\r\n\t};\r\n\tauto_types: boolean;\r\n\tduration_unit: DurationUnits;\r\n\twork_time: boolean;\r\n\tcorrect_work_time: boolean;\r\n\tdeadlines: boolean;\r\n\tskip_off_time: boolean;\r\n\tcascade_delete: boolean;\r\n\tautosize: boolean | string;\r\n\tautoscroll: boolean;\r\n\tshow_links: boolean;\r\n\tshow_task_cells: boolean;\r\n\tautosize_min_width: number;\r\n\tautoscroll_speed: number;\r\n\tdeepcopy_on_parse: boolean;\r\n\tstatic_background: boolean;\r\n\tstatic_background_cells: boolean;\r\n\tbranch_loading: boolean;\r\n\tbranch_loading_property: string;\r\n\tshow_loading: boolean;\r\n\tshow_chart: boolean;\r\n\tshow_grid: boolean;\r\n\tmin_duration: number;\r\n\tdate_format: string; // use instead xml_date\r\n\txml_date?: string; // deprecated\r\n\tstart_on_monday: boolean;\r\n\tserver_utc: boolean;\r\n\tshow_progress: boolean;\r\n\tfit_tasks: boolean;\r\n\tselect_task: boolean;\r\n\tscroll_on_click: boolean;\r\n\tsmart_rendering: boolean;\r\n\tpreserve_scroll: boolean;\r\n\treadonly: boolean;\r\n\tcontainer_resize_timeout: number;\r\n\r\n\t/*grid */\r\n\tdate_grid: string;\r\n\r\n\tdrag_links: boolean;\r\n\tdrag_progress: boolean;\r\n\tdrag_resize: boolean;\r\n\tdrag_project: boolean;\r\n\tdrag_move: boolean;\r\n\tdrag_mode: {\r\n\t\tresize: \"resize\",\r\n\t\tprogress: \"progress\",\r\n\t\tmove: \"move\",\r\n\t\tignore: \"ignore\"\r\n\t};\r\n\tround_dnd_dates: boolean;\r\n\tlink_wrapper_width: number;\r\n\troot_id: string | number;\r\n\r\n\tlink_arrow_size:number;\r\n\r\n\tautofit: boolean;\r\n\tcolumns: IColumnItem[];\r\n\r\n\t/* scale*/\r\n\t/* it will be deprecated */\r\n\tdate_scale?: string;\r\n\tstep?: number;\r\n\tscale_unit?: DurationUnits;\r\n\tsubscales?: IScale[];\r\n\t/* it will be deprecated end */\r\n\r\n\tscales: IScale[];\r\n\r\n\tscale_offset_minimal: boolean;\r\n\r\n\tinherit_scale_class: boolean;\r\n\r\n\r\n\ttime_step: number;\r\n\tduration_step: number;\r\n\r\n\r\n\ttask_date: string;\r\n\ttime_picker: string;\r\n\ttask_attribute: string;\r\n\tlink_attribute: string;\r\n\tlayer_attribute: string;\r\n\tbuttons_left: string[];\r\n\t_migrate_buttons: {\r\n\t\tdhx_save_btn: \"gantt_save_btn\",\r\n\t\tdhx_cancel_btn: \"gantt_cancel_btn\",\r\n\t\tdhx_delete_btn: \"gantt_delete_btn\"\r\n\t};\r\n\r\n\tbuttons_right: string[];\r\n\r\n\r\n\tlightbox: {\r\n\t\tsections?: LightboxSection,\r\n\t\tproject_sections?: LightboxSection,\r\n\t\tmilestone_sections?: LightboxSection\r\n\t};\r\n\tdrag_lightbox: boolean;\r\n\tsort: boolean;\r\n\tdetails_on_create: boolean;\r\n\tdetails_on_dblclick: boolean;\r\n\tinitial_scroll: boolean;\r\n\ttask_scroll_offset: number;\r\n\r\n\torder_branch: boolean;\r\n\torder_branch_free: boolean;\r\n\r\n\t// task_height is deprecated, use 'bar_height` instead\r\n\ttask_height: number | \"full\" | undefined;\r\n\tbar_height: number | \"full\";\r\n\tmin_column_width: number;\r\n\tbar_height_padding: number,\r\n\trow_height: number,\r\n\r\n\t// min width for grid column (when resizing)\r\n\tmin_grid_column_width: number;\r\n\t// name of the attribute with column index for resize element\r\n\tgrid_resizer_column_attribute: string;\r\n\t// name of the attribute with column index for resize element\r\n\t// grid_resizer_attribute: string; // usage of this parameter is not found\r\n\r\n\t// grid width can be increased after the column has been resized\r\n\tkeep_grid_width: boolean;\r\n\r\n\t// grid width can be adjusted\r\n\tgrid_resize: boolean;\r\n\tgrid_elastic_columns: boolean;\r\n\tshow_tasks_outside_timescale: boolean;\r\n\tshow_unscheduled: boolean;\r\n\treadonly_property: string;\r\n\teditable_property: string;\r\n\tcalendar_property: string;\r\n\tresource_calendars: object;\r\n\tdynamic_resource_calendars: boolean;\r\n\tinherit_calendar: boolean;\r\n\ttype_renderers: object;\r\n\r\n\tresize_rows: boolean;\r\n\t// name of the attribute with row index for resize element\r\n\ttask_grid_row_resizer_attribute: string;\r\n\t// min height for row (when resizing)\r\n\tmin_task_grid_row_height: number;\r\n\r\n\topen_tree_initially: boolean;\r\n\toptimize_render: boolean;\r\n\tprevent_default_scroll: boolean;\r\n\tshow_errors: boolean;\r\n\twai_aria_attributes: boolean;\r\n\tsmart_scales: boolean;\r\n\trtl: boolean;\r\n\tplaceholder_task: boolean | object;\r\n\thorizontal_scroll_key: TModifierKeys;\r\n\tdrag_timeline: {\r\n\t\tuseKey: TModifierKeys;\r\n\t\tignore: string;\r\n\t\trender?: boolean;\r\n\t};\r\n\tdrag_multiple: boolean;\r\n\tcsp: TCsp;\r\n\r\n\tresources?: IResourceConfig;\r\n}\r\n\r\nexport default () => {\r\n\tconst result: IGanttConfig = {\r\n\t\tlayout: {\r\n\t\t\tcss: \"gantt_container\",\r\n\t\t\trows: [\r\n\t\t\t\t{\r\n\t\t\t\t\tcols: [\r\n\t\t\t\t\t\t{view: \"grid\", scrollX: \"scrollHor\", scrollY: \"scrollVer\"},\r\n\t\t\t\t\t\t{resizer: true, width: 1},\r\n\t\t\t\t\t\t{view: \"timeline\", scrollX: \"scrollHor\", scrollY: \"scrollVer\"},\r\n\t\t\t\t\t\t{view: \"scrollbar\", id: \"scrollVer\"}\r\n\t\t\t\t\t]\r\n\t\t\t\t},\r\n\t\t\t\t{view: \"scrollbar\", id: \"scrollHor\", height: 20}\r\n\t\t\t]\r\n\t\t},\r\n\t\tlinks: {\r\n\t\t\tfinish_to_start: \"0\",\r\n\t\t\tstart_to_start: \"1\",\r\n\t\t\tfinish_to_finish: \"2\",\r\n\t\t\tstart_to_finish: \"3\"\r\n\t\t},\r\n\t\ttypes: {\r\n\t\t\ttask: \"task\",\r\n\t\t\tproject: \"project\",\r\n\t\t\tmilestone: \"milestone\"\r\n\t\t},\r\n\t\tauto_types: false,\r\n\t\tduration_unit: \"day\",\r\n\t\twork_time: false,\r\n\t\tcorrect_work_time: false,\r\n\t\tskip_off_time: false,\r\n\r\n\t\tcascade_delete: true,\r\n\r\n\t\tautosize: false,\r\n\t\tautosize_min_width: 0,\r\n\t\tautoscroll: true,\r\n\t\tautoscroll_speed: 30,\r\n\t\tdeepcopy_on_parse: false,\r\n\t\tshow_links: true,\r\n\t\tshow_task_cells: true,\r\n\t\t// replace backgroung of the task area with a canvas img\r\n\t\tstatic_background: false,\r\n\t\tstatic_background_cells: true,\r\n\t\tbranch_loading: false,\r\n\t\tbranch_loading_property: \"$has_child\",\r\n\t\tshow_loading: false,\r\n\t\tshow_chart: true,\r\n\t\tshow_grid: true,\r\n\t\tmin_duration: 60 * 60 * 1000,\r\n\t\tdate_format: \"%d-%m-%Y %H:%i\", // use instead xml_date\r\n\t\txml_date: undefined, // \"%d-%m-%Y %H:%i\", // deprecated\r\n\t\tstart_on_monday: true,\r\n\t\tserver_utc: false,\r\n\t\tshow_progress: true,\r\n\t\tfit_tasks: false,\r\n\t\tselect_task: true,\r\n\t\tscroll_on_click: true,\r\n\t\tsmart_rendering: true,\r\n\t\tpreserve_scroll: true,\r\n\t\treadonly: false,\r\n\t\tcontainer_resize_timeout: 20,\r\n\t\tdeadlines: true,\r\n\r\n\t\t/*grid */\r\n\t\tdate_grid: \"%Y-%m-%d\",\r\n\r\n\t\tdrag_links: true,\r\n\t\tdrag_progress: true,\r\n\t\tdrag_resize: true,\r\n\t\tdrag_project: false,\r\n\t\tdrag_move: true,\r\n\t\tdrag_mode: {\r\n\t\t\tresize: \"resize\",\r\n\t\t\tprogress: \"progress\",\r\n\t\t\tmove: \"move\",\r\n\t\t\tignore: \"ignore\"\r\n\t\t},\r\n\t\tround_dnd_dates: true,\r\n\t\tlink_wrapper_width: 20,\r\n\t\tlink_arrow_size:12,\r\n\t\troot_id: 0,\r\n\r\n\t\tautofit: false, // grid column automatic fit grid_width config\r\n\t\tcolumns: [\r\n\t\t\t{name: \"text\", tree: true, width: \"*\", resize: true},\r\n\t\t\t{name: \"start_date\", align: \"center\", resize: true},\r\n\t\t\t{name: \"duration\", align: \"center\"},\r\n\t\t\t{name: \"add\", width: 44}\r\n\t\t],\r\n\r\n\t\t/*scale*/\r\n\r\n\t\tscale_offset_minimal: true,\r\n\t\tinherit_scale_class: false,\r\n\r\n\t\tscales: [\r\n\t\t\t{\r\n\t\t\t\tunit: \"day\",\r\n\t\t\t\tstep: 1,\r\n\t\t\t\tdate: \"%d %M\"\r\n\t\t\t}\r\n\t\t],\r\n// \t\tdate_scale: \"%d %M\",\r\n\r\n\t\ttime_step: 60,\r\n\t\tduration_step: 1,\r\n\t\ttask_date: \"%d %F %Y\",\r\n\t\ttime_picker: \"%H:%i\",\r\n\t\ttask_attribute: \"data-task-id\",\r\n\t\tlink_attribute: \"data-link-id\",\r\n\t\tlayer_attribute: \"data-layer\",\r\n\t\tbuttons_left: [\r\n\t\t\t\"gantt_save_btn\",\r\n\t\t\t\"gantt_cancel_btn\"\r\n\t\t],\r\n\t\t_migrate_buttons: {\r\n\t\t\tdhx_save_btn: \"gantt_save_btn\",\r\n\t\t\tdhx_cancel_btn: \"gantt_cancel_btn\",\r\n\t\t\tdhx_delete_btn: \"gantt_delete_btn\"\r\n\t\t},\r\n\t\tbuttons_right: [\r\n\t\t\t\"gantt_delete_btn\"\r\n\t\t],\r\n\t\tlightbox: {\r\n\t\t\tsections: [\r\n\t\t\t\t{name: \"description\", height: 70, map_to: \"text\", type: \"textarea\", focus: true},\r\n\t\t\t\t{name: \"time\", type: \"duration\", map_to: \"auto\"}\r\n\t\t\t],\r\n\t\t\tproject_sections: [\r\n\t\t\t\t{name: \"description\", height: 70, map_to: \"text\", type: \"textarea\", focus: true},\r\n\t\t\t\t{name: \"type\", type: \"typeselect\", map_to: \"type\"},\r\n\t\t\t\t{name: \"time\", type: \"duration\", readonly: true, map_to: \"auto\"}\r\n\t\t\t],\r\n\t\t\tmilestone_sections: [\r\n\t\t\t\t{name: \"description\", height: 70, map_to: \"text\", type: \"textarea\", focus: true},\r\n\t\t\t\t{name: \"type\", type: \"typeselect\", map_to: \"type\"},\r\n\t\t\t\t{name: \"time\", type: \"duration\", single_date: true, map_to: \"auto\"}\r\n\t\t\t]\r\n\t\t},\r\n\t\tdrag_lightbox: true,\r\n\t\tsort: false,\r\n\t\tdetails_on_create: true,\r\n\t\tdetails_on_dblclick: true,\r\n\t\tinitial_scroll: true,\r\n\t\ttask_scroll_offset: 100,\r\n\r\n\t\torder_branch: false,\r\n\t\torder_branch_free: false,\r\n\r\n\t\t// task height is deprecated, use 'bar_height' instead\r\n\t\ttask_height: undefined,// number px of 'full' for row height\r\n\t\tbar_height: \"full\",\r\n\t\tbar_height_padding:9,\r\n\t\tmin_column_width: 70,\r\n\r\n\t\t// min width for grid column (when resizing)\r\n\t\tmin_grid_column_width: 70,\r\n\t\t// name of the attribute with column index for resize element\r\n\t\tgrid_resizer_column_attribute: \"data-column-index\",\r\n\t\t// name of the attribute with column index for resize element\r\n\t\t// grid_resizer_attribute: \"grid_resizer\", // - usage of this parameter is not found in code\r\n\r\n\t\t// grid width can be increased after the column has been resized\r\n\t\tkeep_grid_width: false,\r\n\r\n\t\t// grid width can be adjusted\r\n\t\tgrid_resize: false,\r\n\t\tgrid_elastic_columns: false,\r\n\t\tshow_tasks_outside_timescale: false,\r\n\t\tshow_unscheduled: true,\r\n\r\n\t\tresize_rows: false,\r\n\t\t// name of the attribute with row index for resize element\r\n\t\ttask_grid_row_resizer_attribute: \"data-row-index\",\r\n\t\t// min height for row (when resizing)\r\n\t\tmin_task_grid_row_height: 30,\r\n\t\trow_height: 36,\r\n\r\n\t\t//\r\n\t\treadonly_property: \"readonly\",\r\n\t\teditable_property: \"editable\",\r\n\t\tcalendar_property: \"calendar_id\",\r\n\t\tresource_calendars: {},\r\n\t\tdynamic_resource_calendars: false,\r\n\t\tinherit_calendar: false,\r\n\t\ttype_renderers: {},\r\n\r\n\t\topen_tree_initially: false,\r\n\t\toptimize_render: true,\r\n\t\tprevent_default_scroll: false,\r\n\t\tshow_errors: true,\r\n\t\twai_aria_attributes: true,\r\n\t\tsmart_scales: true,\r\n\t\trtl:false,\r\n\t\tplaceholder_task: false,\r\n\t\thorizontal_scroll_key: \"shiftKey\",\r\n\t\tdrag_timeline: {\r\n\t\t\tuseKey: undefined,\r\n\t\t\tignore: \".gantt_task_line, .gantt_task_link\",\r\n\t\t\trender: false\r\n\t\t},\r\n\t\tdrag_multiple: true,\r\n\t\tcsp: \"auto\"\r\n\t};\r\n\treturn result;\r\n};\r\n","/* eslint-disable no-restricted-globals */\r\nvar isWindowAwailable = typeof window !== \"undefined\";\r\n\r\n/* eslint-enable no-restricted-globals */\r\n\r\nexport default {\r\n\tisIE: isWindowAwailable && (navigator.userAgent.indexOf(\"MSIE\") >= 0 || navigator.userAgent.indexOf(\"Trident\") >= 0),\r\n\tisIE6: isWindowAwailable && (!XMLHttpRequest && navigator.userAgent.indexOf(\"MSIE\") >= 0),\r\n\tisIE7: isWindowAwailable && (navigator.userAgent.indexOf(\"MSIE 7.0\") >= 0 && navigator.userAgent.indexOf(\"Trident\") < 0),\r\n\tisIE8: isWindowAwailable && (navigator.userAgent.indexOf(\"MSIE 8.0\") >= 0 && navigator.userAgent.indexOf(\"Trident\") >= 0),\r\n\tisOpera: isWindowAwailable && (navigator.userAgent.indexOf(\"Opera\") >= 0),\r\n\tisChrome: isWindowAwailable && (navigator.userAgent.indexOf(\"Chrome\") >= 0),\r\n\tisKHTML: isWindowAwailable && (navigator.userAgent.indexOf(\"Safari\") >= 0 || navigator.userAgent.indexOf(\"Konqueror\") >= 0),\r\n\tisFF: isWindowAwailable && (navigator.userAgent.indexOf(\"Firefox\") >= 0),\r\n\tisIPad: isWindowAwailable && (navigator.userAgent.search(/iPad/gi) >= 0),\r\n\tisEdge: isWindowAwailable && (navigator.userAgent.indexOf(\"Edge\")!=-1),\r\n\tisNode: (!isWindowAwailable || typeof navigator == \"undefined\" || (typeof PRODUCTION !== \"undefined\" && PRODUCTION === \"test\"))\r\n};\r\n","export default function serialize(data: object | string) {\r\n\tif (typeof data === \"string\" || typeof data === \"number\") {\r\n\t\treturn data;\r\n\t}\r\n\r\n\tlet result = \"\";\r\n\r\n\tfor (const key in data) {\r\n\t\tlet serialized = \"\";\r\n\t\tif (data.hasOwnProperty(key)) {\r\n\t\t\tif (typeof data[key] === \"string\") {\r\n\t\t\t\tserialized = encodeURIComponent(data[key]);\r\n\t\t\t} else if (typeof data[key] === \"number\") {\r\n\t\t\t\tserialized = String(data[key]);\r\n\t\t\t} else {\r\n\t\t\t\tserialized = encodeURIComponent(JSON.stringify(data[key]));\r\n\t\t\t}\r\n\t\t\tserialized = key + \"=\" + serialized;\r\n\r\n\t\t\tif (result.length) {\r\n\t\t\t\tserialized = \"&\" + serialized;\r\n\t\t\t}\r\n\t\t\tresult += serialized;\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}\r\n","import env from \"../../utils/env\";\r\nimport global from \"../../utils/global\";\r\nimport serialize from \"./serialize\";\r\n\r\nfunction createConfig(method, args) {\r\n\tvar result = {\r\n\t\tmethod: method\r\n\t};\r\n\r\n\tif (args.length === 0) {\r\n\t\tthrow new Error(\"Arguments list of query is wrong.\");\r\n\t}\r\n\tif (args.length === 1) {\r\n\t\tif (typeof args[0] === \"string\") {\r\n\t\t\tresult.url = args[0];\r\n\t\t\tresult.async = true;\r\n\t\t} else {\r\n\t\t\tresult.url = args[0].url;\r\n\t\t\tresult.async = (args[0].async || true);\r\n\t\t\tresult.callback = args[0].callback;\r\n\t\t\tresult.headers = args[0].headers;\r\n\t\t}\r\n\t\tif (method === \"POST\" || \"PUT\") {\r\n\t\t\tif (args[0].data) {\r\n\t\t\t\tif (typeof args[0].data !== \"string\") {\r\n\t\t\t\t\tresult.data = serialize(args[0].data);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult.data = args[0].data;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tresult.data = \"\";\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tresult.url = args[0];\r\n\tswitch(method) {\r\n\t\tcase \"GET\":\r\n\t\tcase \"DELETE\":\r\n\t\t\tresult.callback = args[1];\r\n\t\t\tresult.headers = args[2];\r\n\t\tbreak;\r\n\t\tcase \"POST\":\r\n\t\tcase \"PUT\":\r\n\t\t\tif (args[1]) {\r\n\t\t\t\tif (typeof args[1] !== \"string\") {\r\n\t\t\t\t\tresult.data = serialize(args[1]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult.data = args[1];\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tresult.data = \"\";\r\n\t\t\t}\r\n\t\t\tresult.callback = args[2];\r\n\t\t\tresult.headers = args[3];\r\n\t\tbreak;\r\n\t}\r\n\treturn result;\r\n}\r\n\r\nexport default function(gantt) {\r\n\treturn {\r\n\r\n\t\t// if false - dhxr param will added to prevent caching on client side (default),\r\n\t\t// if true - do not add extra params\r\n\t\tcache: true,\r\n\r\n\t\t// default method for load/loadStruct, post/get allowed\r\n\t\t// get - since 4.1.1, this should fix 412 error for macos safari\r\n\t\tmethod: \"get\",\r\n\r\n\t\tparse: function(data) {\r\n\t\t\tif (typeof data !== \"string\") return data;\r\n\r\n\t\t\tvar obj;\r\n\t\t\tdata = data.replace(/^[\\s]+/,\"\");\r\n\t\t\tif (typeof DOMParser !== \"undefined\" && !env.isIE) { // ff,ie9\r\n\t\t\t\tobj = (new DOMParser()).parseFromString(data, \"text/xml\");\r\n\t\t\t} else if (typeof global.ActiveXObject !== \"undefined\") {\r\n\t\t\t\tobj = new global.ActiveXObject(\"Microsoft.XMLDOM\");\r\n\t\t\t\tobj.async = \"false\";\r\n\t\t\t\tobj.loadXML(data);\r\n\t\t\t}\r\n\t\t\treturn obj;\r\n\t\t},\r\n\t\txmltop: function(tagname, xhr, obj) {\r\n\t\t\tif (typeof xhr.status == \"undefined\" || xhr.status < 400) {\r\n\t\t\t\tvar xml = (!xhr.responseXML) ? this.parse(xhr.responseText || xhr) : (xhr.responseXML || xhr);\r\n\t\t\t\tif (xml && xml.documentElement !== null && !xml.getElementsByTagName(\"parsererror\").length) {\r\n\t\t\t\t\treturn xml.getElementsByTagName(tagname)[0];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (obj !== -1) gantt.callEvent(\"onLoadXMLError\",[\"Incorrect XML\", arguments[1], obj]);\r\n\t\t\treturn document.createElement(\"DIV\");\r\n\t\t},\r\n\t\txpath: function(xpathExp, docObj) {\r\n\t\t\tif (!docObj.nodeName) docObj = docObj.responseXML || docObj;\r\n\t\t\tif (env.isIE) {\r\n\t\t\t\treturn docObj.selectNodes(xpathExp)||[];\r\n\t\t\t} else {\r\n\t\t\t\tvar rows = [];\r\n\t\t\t\tvar first;\r\n\t\t\t\tvar col = (docObj.ownerDocument||docObj).evaluate(xpathExp, docObj, null, XPathResult.ANY_TYPE, null);\r\n\r\n\t\t\t\twhile (true){\r\n\t\t\t\t\tfirst = col.iterateNext();\r\n\t\t\t\t\tif(first){\r\n\t\t\t\t\t\trows.push(first);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn rows;\r\n\t\t\t}\r\n\t\t},\r\n\t\tquery: function(config) {\r\n\t\t\treturn this._call(\r\n\t\t\t\t(config.method || \"GET\"),\r\n\t\t\t\tconfig.url,\r\n\t\t\t\tconfig.data || \"\",\r\n\t\t\t\t(config.async || true),\r\n\t\t\t\tconfig.callback,\r\n\t\t\t\tconfig.headers\r\n\t\t\t);\r\n\t\t},\r\n\t\tget: function(url, onLoad, headers) {\r\n\t\t\tvar config = createConfig(\"GET\", arguments);\r\n\t\t\treturn this.query(config);\r\n\t\t},\r\n\t\tgetSync: function(url, headers) {\r\n\t\t\tvar config = createConfig(\"GET\", arguments);\r\n\t\t\tconfig.async = false;\r\n\t\t\treturn this.query(config);\r\n\t\t},\r\n\t\tput: function(url, postData, onLoad, headers) {\r\n\t\t\tvar config = createConfig(\"PUT\", arguments);\r\n\t\t\treturn this.query(config);\r\n\t\t},\r\n\t\tdel: function(url, onLoad, headers) {\r\n\t\t\t/**\r\n\t\t\t * https://tools.ietf.org/html/rfc7231#section-4.3.5\r\n\t\t\t * A payload within a DELETE request message has no defined semantics;\r\n\t\t\t * sending a payload body on a DELETE request might cause some existing\r\n\t\t\t * implementations to reject the request.\r\n\t\t\t */\r\n\t\t\tvar config = createConfig(\"DELETE\", arguments);\r\n\t\t\treturn this.query(config);\r\n\t\t},\r\n\t\tpost: function(url, postData, onLoad, headers) {\r\n\t\t\tif (arguments.length == 1) {\r\n\t\t\t\tpostData = \"\";\r\n\t\t\t} else if (arguments.length == 2 && typeof(postData) == \"function\") {\r\n\t\t\t\tonLoad = postData;\r\n\t\t\t\tpostData = \"\";\r\n\t\t\t}\r\n\t\t\tvar config = createConfig(\"POST\", arguments);\r\n\t\t\treturn this.query(config);\r\n\t\t},\r\n\t\tpostSync: function(url, postData, headers) {\r\n\t\t\tpostData = (postData === null ? \"\" : String(postData));\r\n\r\n\t\t\tvar config = createConfig(\"POST\", arguments);\r\n\t\t\tconfig.async = false;\r\n\t\t\treturn this.query(config);\r\n\t\t},\r\n\t\t_call: function(method, url, postData, async, onLoad, headers) {\r\n\t\t\treturn new gantt.Promise(function(resolve, reject) {\r\n\t\t\t\tvar t = (typeof XMLHttpRequest !== undefined ? new XMLHttpRequest() : new global.ActiveXObject(\"Microsoft.XMLHTTP\"));\r\n\t\t\t\tvar isQt = (navigator.userAgent.match(/AppleWebKit/) !== null && navigator.userAgent.match(/Qt/) !== null && navigator.userAgent.match(/Safari/) !== null);\r\n\r\n\t\t\t\tif (!!async) {\r\n\t\t\t\t\tt.onreadystatechange = function() {\r\n\t\t\t\t\t\tif ((t.readyState == 4) || (isQt && t.readyState == 3)) { // what for long response and status 404?\r\n\t\t\t\t\t\t\tif (t.status != 200 || t.responseText === \"\")\r\n\t\t\t\t\t\t\t\tif (!gantt.callEvent(\"onAjaxError\", [t])) return;\r\n\r\n\t\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\t\tif (typeof(onLoad) == \"function\") {\r\n\t\t\t\t\t\t\t\t\tonLoad.apply(global, [{xmlDoc:t, filePath:url}]); // dhtmlx-compat, response.xmlDoc.responseXML/responseText\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tresolve(t);\r\n\t\t\t\t\t\t\t\tif (typeof(onLoad) == \"function\") {\r\n\t\t\t\t\t\t\t\t\tonLoad = null;\r\n\t\t\t\t\t\t\t\t\tt = null;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}, 0);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvar noCache = !this || !this.cache;\r\n\t\t\t\tif (method == \"GET\" && noCache) {\r\n\t\t\t\t\turl += (url.indexOf(\"?\")>=0?\"&\":\"?\")+\"dhxr\"+new Date().getTime()+\"=1\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tt.open(method, url, async);\r\n\r\n\t\t\t\tif (headers){\r\n\t\t\t\t\tfor (var key in headers)\r\n\t\t\t\t\t\tt.setRequestHeader(key, headers[key]);\r\n\t\t\t\t} else if (method.toUpperCase() == \"POST\" || method == \"PUT\" || method == \"DELETE\") {\r\n\t\t\t\t\tt.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\r\n\t\t\t\t} else if (method == \"GET\") {\r\n\t\t\t\t\tpostData = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tt.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\r\n\r\n\t\t\t\tt.send(postData);\r\n\r\n\t\t\t\tif (!async) return {xmlDoc:t, filePath:url}; // dhtmlx-compat, response.xmlDoc.responseXML/responseText\r\n\t\t\t});\r\n\t\t},\r\n\t\turlSeparator: function(str){\r\n\t\t\tif (str.indexOf(\"?\") != -1)\r\n\t\t\t\treturn \"&\";\r\n\t\t\telse\r\n\t\t\t\treturn \"?\";\r\n\t\t}\r\n\t};\r\n};\r\n","const dateToStr = (format: string, utc: boolean, gantt) => {\r\n\tformat = format.replace(/%[a-zA-Z]/g, (a) => {\r\n\t\tswitch (a) {\r\n\t\t\tcase \"%d\":\r\n\t\t\t\treturn `\"+to_fixed(date.get${utc?\"UTC\":\"\"}Date())+\"`;\r\n\t\t\tcase \"%m\":\r\n\t\t\t\treturn `\"+to_fixed((date.get${utc?\"UTC\":\"\"}Month()+1))+\"`;\r\n\t\t\tcase \"%j\":\r\n\t\t\t\treturn `\"+date.get${utc?\"UTC\":\"\"}Date()+\"`;\r\n\t\t\tcase \"%n\":\r\n\t\t\t\treturn `\"+(date.get${utc?\"UTC\":\"\"}Month()+1)+\"`;\r\n\t\t\tcase \"%y\":\r\n\t\t\t\treturn `\"+to_fixed(date.get${utc?\"UTC\":\"\"}FullYear()%100)+\"`;\r\n\t\t\tcase \"%Y\":\r\n\t\t\t\treturn `\"+date.get${utc?\"UTC\":\"\"}FullYear()+\"`;\r\n\t\t\tcase \"%D\":\r\n\t\t\t\treturn `\"+locale.date.day_short[date.get${utc?\"UTC\":\"\"}Day()]+\"`;\r\n\t\t\tcase \"%l\":\r\n\t\t\t\treturn `\"+locale.date.day_full[date.get${utc?\"UTC\":\"\"}Day()]+\"`;\r\n\t\t\tcase \"%M\":\r\n\t\t\t\treturn `\"+locale.date.month_short[date.get${utc?\"UTC\":\"\"}Month()]+\"`;\r\n\t\t\tcase \"%F\":\r\n\t\t\t\treturn `\"+locale.date.month_full[date.get${utc?\"UTC\":\"\"}Month()]+\"`;\r\n\t\t\tcase \"%h\":\r\n\t\t\t\treturn `\"+to_fixed((date.get${utc?\"UTC\":\"\"}Hours()+11)%12+1)+\"`;\r\n\t\t\tcase \"%g\":\r\n\t\t\t\treturn `\"+((date.get${utc?\"UTC\":\"\"}Hours()+11)%12+1)+\"`;\r\n\t\t\tcase \"%G\":\r\n\t\t\t\treturn `\"+date.get${utc?\"UTC\":\"\"}Hours()+\"`;\r\n\t\t\tcase \"%H\":\r\n\t\t\t\treturn `\"+to_fixed(date.get${utc?\"UTC\":\"\"}Hours())+\"`;\r\n\t\t\tcase \"%i\":\r\n\t\t\t\treturn `\"+to_fixed(date.get${utc?\"UTC\":\"\"}Minutes())+\"`;\r\n\t\t\tcase \"%a\":\r\n\t\t\t\treturn `\"+(date.get${utc?\"UTC\":\"\"}Hours()>11?\"pm\":\"am\")+\"`;\r\n\t\t\tcase \"%A\":\r\n\t\t\t\treturn `\"+(date.get${utc?\"UTC\":\"\"}Hours()>11?\"PM\":\"AM\")+\"`;\r\n\t\t\tcase \"%s\":\r\n\t\t\t\treturn `\"+to_fixed(date.get${utc?\"UTC\":\"\"}Seconds())+\"`;\r\n\t\t\tcase \"%W\":\r\n\t\t\t\treturn `\"+to_fixed(getISOWeek(date))+\"`;\r\n\t\t\tcase \"%w\":\r\n\t\t\t\treturn `\"+to_fixed(getWeek(date))+\"`;\r\n\t\t\tdefault:\r\n\t\t\t\treturn a;\r\n\t\t}\r\n\t});\r\n\r\n\t// tslint:disable-next-line: function-constructor\r\n\tconst dateToStrFn = new Function(\"date\", \"to_fixed\", \"locale\", \"getISOWeek\", \"getWeek\", `return \"${format}\";`);\r\n\r\n\treturn (date: Date) => {\r\n\t\treturn dateToStrFn(date, gantt.date.to_fixed, gantt.locale, gantt.date.getISOWeek, gantt.date.getWeek);\r\n\t};\r\n};\r\n\r\n\r\nconst strToDate = (format: string, utc: boolean, gantt:any) => {\r\n\tlet splt = \"var temp=date.match(/[a-zA-Z]+|[0-9]+/g);\";\r\n\tconst mask = format.match(/%[a-zA-Z]/g);\r\n\tfor (let i = 0; i < mask.length; i++) {\r\n\t\tswitch (mask[i]) {\r\n\t\t\tcase \"%j\":\r\n\t\t\tcase \"%d\":\r\n\t\t\t\tsplt += `set[2]=temp[${i}]||1;`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%n\":\r\n\t\t\tcase \"%m\":\r\n\t\t\t\tsplt += `set[1]=(temp[${i}]||1)-1;`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%y\":\r\n\t\t\t\tsplt += `set[0]=temp[${i}]*1+(temp[${i}]>50?1900:2000);`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%g\":\r\n\t\t\tcase \"%G\":\r\n\t\t\tcase \"%h\":\r\n\t\t\tcase \"%H\":\r\n\t\t\t\tsplt += `set[3]=temp[${i}]||0;`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%i\":\r\n\t\t\t\tsplt += `set[4]=temp[${i}]||0;`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%Y\":\r\n\t\t\t\tsplt += `set[0]=temp[${i}]||0;`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%a\":\r\n\t\t\tcase \"%A\":\r\n\t\t\t\tsplt += `set[3]=set[3]%12+((temp[${i}]||'').toLowerCase()=='am'?0:12);`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%s\":\r\n\t\t\t\tsplt += `set[5]=temp[${i}]||0;`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%M\":\r\n\t\t\t\tsplt += `set[1]=locale.date.month_short_hash[temp[${i}]]||0;`;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%F\":\r\n\t\t\t\tsplt += `set[1]=locale.date.month_full_hash[temp[${i}]]||0;`;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tlet code = \"set[0],set[1],set[2],set[3],set[4],set[5]\";\r\n\tif (utc) { code = ` Date.UTC(${code})`; }\r\n\t// tslint:disable-next-line: function-constructor\r\n\tconst strToDateFn = new Function(\"date\", \"locale\", `var set=[0,0,1,0,0,0]; ${splt} return new Date(${code});`);\r\n\r\n\treturn (dateString) => {\r\n\t\treturn strToDateFn(dateString, gantt.locale);\r\n\t};\r\n};\r\n\r\nconst fastVersion = {\r\n\tdate_to_str: dateToStr,\r\n\tstr_to_date: strToDate\r\n};\r\n\r\nexport default fastVersion;","const dateToStr = (format: string, utc: boolean, gantt) => {\r\n\treturn (date) => {\r\n\t\treturn format.replace(/%[a-zA-Z]/g, (a) => {\r\n\t\t\tswitch (a) {\r\n\t\t\t\tcase \"%d\": return utc ? gantt.date.to_fixed(date.getUTCDate()) : gantt.date.to_fixed(date.getDate());\r\n\t\t\t\tcase \"%m\": return utc ? gantt.date.to_fixed((date.getUTCMonth() + 1)) : gantt.date.to_fixed((date.getMonth() + 1));\r\n\t\t\t\tcase \"%j\": return utc ? date.getUTCDate() : date.getDate();\r\n\t\t\t\tcase \"%n\": return utc ? (date.getUTCMonth() + 1) : (date.getMonth() + 1);\r\n\t\t\t\tcase \"%y\": return utc ? gantt.date.to_fixed(date.getUTCFullYear() % 100) : gantt.date.to_fixed(date.getFullYear() % 100);\r\n\t\t\t\tcase \"%Y\": return utc ? date.getUTCFullYear() : date.getFullYear();\r\n\t\t\t\tcase \"%D\": return utc ? gantt.locale.date.day_short[date.getUTCDay()] : gantt.locale.date.day_short[date.getDay()];\r\n\t\t\t\tcase \"%l\": return utc ? gantt.locale.date.day_full[date.getUTCDay()] : gantt.locale.date.day_full[date.getDay()];\r\n\t\t\t\tcase \"%M\": return utc ? gantt.locale.date.month_short[date.getUTCMonth()] : gantt.locale.date.month_short[date.getMonth()];\r\n\t\t\t\tcase \"%F\": return utc ? gantt.locale.date.month_full[date.getUTCMonth()] : gantt.locale.date.month_full[date.getMonth()];\r\n\t\t\t\tcase \"%h\": return utc ? gantt.date.to_fixed((date.getUTCHours() + 11) % 12 + 1) : gantt.date.to_fixed((date.getHours() + 11) % 12 + 1);\r\n\t\t\t\tcase \"%g\": return utc ? ((date.getUTCHours() + 11) % 12 + 1) : ((date.getHours() + 11) % 12 + 1);\r\n\t\t\t\tcase \"%G\": return utc ? date.getUTCHours() : date.getHours();\r\n\t\t\t\tcase \"%H\": return utc ? gantt.date.to_fixed(date.getUTCHours()) : gantt.date.to_fixed(date.getHours());\r\n\t\t\t\tcase \"%i\": return utc ? gantt.date.to_fixed(date.getUTCMinutes()) : gantt.date.to_fixed(date.getMinutes());\r\n\t\t\t\tcase \"%a\": return utc ? (date.getUTCHours() > 11 ? \"pm\" : \"am\") : (date.getHours() > 11 ? \"pm\" : \"am\");\r\n\t\t\t\tcase \"%A\": return utc ? (date.getUTCHours() > 11 ? \"PM\" : \"AM\") : (date.getHours() > 11 ? \"PM\" : \"AM\");\r\n\t\t\t\tcase \"%s\": return utc ? gantt.date.to_fixed(date.getUTCSeconds()) : gantt.date.to_fixed(date.getSeconds());\r\n\t\t\t\tcase \"%W\": return utc ? gantt.date.to_fixed(gantt.date.getUTCISOWeek(date)) : gantt.date.to_fixed(gantt.date.getISOWeek(date));\r\n\t\t\t\tdefault: return a;\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n};\r\nconst strToDate = (format: string, utc: boolean, gantt:any) => {\r\n\treturn (date: string) => {\r\n\t\tconst set: Array<string|number> = [0, 0, 1, 0, 0, 0];\r\n\t\tconst temp = date.match(/[a-zA-Z]+|[0-9]+/g);\r\n\t\tconst mask = format.match(/%[a-zA-Z]/g);\r\n\r\n\t\tfor (let i = 0; i < mask.length; i++) {\r\n\t\t\tswitch (mask[i]) {\r\n\t\t\t\tcase \"%j\":\r\n\t\t\t\tcase \"%d\":\r\n\t\t\t\t\tset[2] = temp[i] as unknown as number || 1;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%n\":\r\n\t\t\t\tcase \"%m\":\r\n\t\t\t\t\tset[1] = (temp[i] as unknown as number || 1) - 1;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%y\":\r\n\t\t\t\t\tset[0] = temp[i] as unknown as number * 1 + ((temp[i] as unknown as number) > 50 ? 1900 : 2000);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%g\":\r\n\t\t\t\tcase \"%G\":\r\n\t\t\t\tcase \"%h\":\r\n\t\t\t\tcase \"%H\":\r\n\t\t\t\t\tset[3] = temp[i] as unknown as number || 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%i\":\r\n\t\t\t\t\tset[4] = temp[i] as unknown as number || 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%Y\":\r\n\t\t\t\t\tset[0] = temp[i] as unknown as number || 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%a\":\r\n\t\t\t\tcase \"%A\":\r\n\t\t\t\t\tset[3] = set[3] as number % 12 + ((temp[i] || \"\").toLowerCase() === \"am\" ? 0 : 12);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%s\":\r\n\t\t\t\t\tset[5] = temp[i] || 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%M\":\r\n\t\t\t\t\tset[1] = gantt.locale.date.month_short_hash[temp[i]] || 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%F\":\r\n\t\t\t\t\tset[1] = gantt.locale.date.month_full_hash[temp[i]] || 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (utc) {\r\n\t\t\treturn new Date(Date.UTC(\r\n\t\t\t\tset[0] as number,\r\n\t\t\t\tset[1] as number,\r\n\t\t\t\tset[2] as number,\r\n\t\t\t\tset[3] as number,\r\n\t\t\t\tset[4] as number,\r\n\t\t\t\tset[5] as number\r\n\t\t\t));\r\n\t\t}\r\n\t\treturn new Date(\r\n\t\t\tset[0] as number,\r\n\t\t\tset[1] as number,\r\n\t\t\tset[2] as number,\r\n\t\t\tset[3] as number,\r\n\t\t\tset[4] as number,\r\n\t\t\tset[5] as number\r\n\t\t);\r\n\t};\r\n\r\n};\r\n\r\n\r\nconst cspVersion = {\r\n\tdate_to_str: dateToStr,\r\n\tstr_to_date: strToDate\r\n};\r\n\r\nexport default cspVersion;","/*\r\n %d - the day as a number with a leading zero ( 01 to 31 );\r\n %j - the day as a number without a leading zero ( 1 to 31 );\r\n %D - the day as an abbreviation ( Sun to Sat );\r\n %l - the day as a full name ( Sunday to Saturday );\r\n %W - the ISO-8601 week number of the year. Weeks start on Monday; 1)\r\n %m - the month as a number without a leading zero ( 1 to 12 );\r\n %n - the month as a number with a leading zero ( 01 to 12);\r\n %M - the month as an abbreviation ( Jan to Dec );\r\n %F - the month as a full name ( January to December );\r\n %y - the year as a two-digit number ( 00 to 99 );\r\n %Y - the year as a four-digit number ( 1900–9999 );\r\n %h - the hour based on the 12-hour clock ( 00 to 11 );\r\n %H - the hour based on the 24-hour clock ( 00 to 23 );\r\n %i - the minute as a number with a leading zero ( 00 to 59 );\r\n %s - the second as a number without a leading zero ( 00 to 59 ); 2)\r\n %a - displays am (for times from midnight until noon) and pm (for times from noon until midnight);\r\n %A - displays AM (for times from midnight until noon) and PM (for times from noon until midnight).\r\n*/\r\n\r\nimport fastVersion from \"./date_parsers/fast_version\";\r\nimport cspCompliantVersion from \"./date_parsers/csp_compliant_version\";\r\n\r\nexport default function(gantt) {\r\n\tvar canUseCsp = null;\r\n\tfunction cspAutoCheck() {\r\n\t\ttry {\r\n\t\t\tnew Function(\"canUseCsp = false;\");\r\n\t\t} catch(e) {\r\n\t\t\tcanUseCsp = true;\r\n\t\t}\r\n\t}\r\n\tfunction useCsp() {\r\n\t\tvar result = false;\r\n\t\tif (gantt.config.csp === \"auto\") {\r\n\t\t\tif(canUseCsp === null) {\r\n\t\t\t\tcspAutoCheck();\r\n\t\t\t}\r\n\t\t\tresult = canUseCsp;\r\n\t\t} else {\r\n\t\t\tresult = gantt.config.csp;\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tvar dateHelper = {\r\n\t\tinit: function () {\r\n\t\t\tvar locale = gantt.locale;\r\n\r\n\t\t\tvar s = locale.date.month_short;\r\n\t\t\tvar t = locale.date.month_short_hash = {};\r\n\t\t\tfor (var i = 0; i < s.length; i++)\r\n\t\t\t\tt[s[i]] = i;\r\n\r\n\t\t\tvar s = locale.date.month_full;\r\n\t\t\tvar t = locale.date.month_full_hash = {};\r\n\t\t\tfor (var i = 0; i < s.length; i++)\r\n\t\t\t\tt[s[i]] = i;\r\n\t\t},\r\n\t\tdate_part: function (date) {\r\n\t\t\tvar old = new Date(date);\r\n\t\t\tdate.setHours(0);\r\n\t\t\tthis.hour_start(date);\r\n\t\t\tif (date.getHours() && //shift to yesterday on dst\r\n\t\t\t\t(date.getDate() < old.getDate() || date.getMonth() < old.getMonth() || date.getFullYear() < old.getFullYear()))\r\n\t\t\t\tdate.setTime(date.getTime() + 60 * 60 * 1000 * (24 - date.getHours()));\r\n\t\t\treturn date;\r\n\t\t},\r\n\t\ttime_part: function (date) {\r\n\t\t\treturn (date.valueOf() / 1000 - date.getTimezoneOffset() * 60) % 86400;\r\n\t\t},\r\n\t\tweek_start: function (date) {\r\n\t\t\tvar shift = date.getDay();\r\n\t\t\tif (gantt.config.start_on_monday) {\r\n\t\t\t\tif (shift === 0) shift = 6;\r\n\t\t\t\telse shift--;\r\n\t\t\t}\r\n\t\t\treturn this.date_part(this.add(date, -1 * shift, \"day\"));\r\n\t\t},\r\n\t\tmonth_start: function (date) {\r\n\t\t\tdate.setDate(1);\r\n\t\t\treturn this.date_part(date);\r\n\t\t},\r\n\t\tquarter_start: function (date) {\r\n\t\t\tthis.month_start(date);\r\n\t\t\tvar m = date.getMonth(),\r\n\t\t\t\tres_month;\r\n\r\n\t\t\tif (m >= 9) {\r\n\t\t\t\tres_month = 9;\r\n\t\t\t} else if (m >= 6) {\r\n\t\t\t\tres_month = 6;\r\n\t\t\t} else if (m >= 3) {\r\n\t\t\t\tres_month = 3;\r\n\t\t\t} else {\r\n\t\t\t\tres_month = 0;\r\n\t\t\t}\r\n\r\n\t\t\tdate.setMonth(res_month);\r\n\t\t\treturn date;\r\n\t\t},\r\n\t\tyear_start: function (date) {\r\n\t\t\tdate.setMonth(0);\r\n\t\t\treturn this.month_start(date);\r\n\t\t},\r\n\t\tday_start: function (date) {\r\n\t\t\treturn this.date_part(date);\r\n\t\t},\r\n\t\thour_start: function (date) {\r\n\t\t\tif (date.getMinutes())\r\n\t\t\t\tdate.setMinutes(0);\r\n\t\t\tthis.minute_start(date);\r\n\r\n\t\t\treturn date;\r\n\t\t},\r\n\t\tminute_start: function (date) {\r\n\t\t\tif (date.getSeconds())\r\n\t\t\t\tdate.setSeconds(0);\r\n\t\t\tif (date.getMilliseconds())\r\n\t\t\t\tdate.setMilliseconds(0);\r\n\t\t\treturn date;\r\n\t\t},\r\n\t\t_add_days: function (modifiedDate, inc, originalDate) {\r\n\r\n\t\t\tmodifiedDate.setDate(modifiedDate.getDate() + inc);\r\n\t\t\tvar incCondition = inc >= 0;\r\n\t\t\tvar getHoursCondition = !originalDate.getHours() && modifiedDate.getHours(); //shift to yesterday on dst\r\n\t\t\tvar getDateCondition = (modifiedDate.getDate() <= originalDate.getDate() || modifiedDate.getMonth() < originalDate.getMonth() || modifiedDate.getFullYear() < originalDate.getFullYear());\r\n\t\t\tif (incCondition && getHoursCondition && getDateCondition){\r\n\t\t\t\tmodifiedDate.setTime(modifiedDate.getTime() + 60 * 60 * 1000 * (24 - modifiedDate.getHours()));\r\n\t\t\t}\r\n\t\t\tvar worktimeCalculation = inc > 1;\r\n\t\t\tif (worktimeCalculation && getHoursCondition){\r\n\t\t\t\t// try to shift the modified Date to 00:00\r\n\t\t\t\tmodifiedDate.setHours(0);\r\n\t\t\t}\r\n\t\t\treturn modifiedDate;\r\n\t\t},\r\n\r\n\t\tadd: function (date, inc, mode) {\r\n\t\t\t/*jsl:ignore*/\r\n\t\t\tvar ndate = new Date(date.valueOf());\r\n\t\t\tswitch (mode) {\r\n\t\t\t\tcase \"day\":\r\n\t\t\t\t\tndate = this._add_days(ndate, inc, date);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"week\":\r\n\t\t\t\t\tndate = this._add_days(ndate, inc * 7, date);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"month\":\r\n\t\t\t\t\tndate.setMonth(ndate.getMonth() + inc);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"year\":\r\n\t\t\t\t\tndate.setYear(ndate.getFullYear() + inc);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"hour\":\r\n\t\t\t\t\t/*\r\n\t\t\t\t\t\tadding hours/minutes via setHour(getHour() + inc) gives weird result when\r\n\t\t\t\t\t\tadding one hour to the time before switch to a Daylight Saving time\r\n\r\n\t\t\t\t\t\texample: //Sun Mar 30 2014 01:00:00 GMT+0100 (W. Europe Standard Time)\r\n\t\t\t\t\t\tnew Date(2014, 02, 30, 1).setHours(2)\r\n\t\t\t\t\t\t>>Sun Mar 30 2014 01:00:00 GMT+0100 (W. Europe Standard Time)\r\n\r\n\t\t\t\t\t\tsetTime seems working as expected\r\n\t\t\t\t\t */\r\n\t\t\t\t\tndate.setTime(ndate.getTime() + inc * 60 * 60 * 1000);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"minute\":\r\n\r\n\t\t\t\t\tndate.setTime(ndate.getTime() + inc * 60 * 1000);\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn this[\"add_\" + mode](date, inc, mode);\r\n\t\t\t}\r\n\t\t\treturn ndate;\r\n\t\t\t/*jsl:end*/\r\n\t\t},\r\n\t\tadd_quarter: function (date, inc) {\r\n\t\t\treturn this.add(date, inc * 3, \"month\");\r\n\t\t},\r\n\r\n\t\tto_fixed: function (num) {\r\n\t\t\tif (num < 10) return \"0\" + num;\r\n\t\t\treturn num;\r\n\t\t},\r\n\t\tcopy: function (date) {\r\n\t\t\treturn new Date(date.valueOf());\r\n\t\t},\r\n\t\tdate_to_str: function (format, utc) {\r\n\t\t\tvar result = fastVersion;\r\n\t\t\tif (useCsp()) {\r\n\t\t\t\tresult = cspCompliantVersion;\r\n\t\t\t}\r\n\t\t\treturn result.date_to_str(format, utc, gantt);\r\n\t\t},\r\n\t\tstr_to_date: function (format, utc) {\r\n\t\t\tvar result = fastVersion;\r\n\t\t\tif (useCsp()) {\r\n\t\t\t\tresult = cspCompliantVersion;\r\n\t\t\t}\r\n\t\t\treturn result.str_to_date(format, utc, gantt);\r\n\t\t},\r\n\t\tgetISOWeek: function (ndate) {\r\n\t\t\treturn gantt.date._getWeekNumber(ndate, true);\r\n\t\t},\r\n\t\t_getWeekNumber: function(ndate, isoWeek){\r\n\t\t\tif (!ndate) return false;\r\n\t\t\tvar nday = ndate.getDay();\r\n\t\t\tif(isoWeek){\r\n\t\t\t\tif (nday === 0) {\r\n\t\t\t\t\tnday = 7;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar first_thursday = new Date(ndate.valueOf());\r\n\t\t\tfirst_thursday.setDate(ndate.getDate() + (4 - nday));\r\n\t\t\tvar year_number = first_thursday.getFullYear(); // year of the first Thursday\r\n\t\t\tvar ordinal_date = Math.round((first_thursday.getTime() - new Date(year_number, 0, 1).getTime()) / 86400000); //ordinal date of the first Thursday - 1 (so not really ordinal date)\r\n\t\t\tvar week_number = 1 + Math.floor(ordinal_date / 7);\r\n\t\t\treturn week_number;\r\n\t\t},\r\n\r\n\t\tgetWeek: function(ndate){\r\n\t\t\treturn gantt.date._getWeekNumber(ndate, gantt.config.start_on_monday);\r\n\t\t},\r\n\t\tgetUTCISOWeek: function (ndate) {\r\n\t\t\treturn gantt.date.getISOWeek(ndate);\r\n\t\t},\r\n\t\tconvert_to_utc: function (date) {\r\n\t\t\treturn new Date(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds());\r\n\t\t},\r\n\t\tparseDate: function (date, format) {\r\n\t\t\t// raw date may be of type string, number (timestamp) or something else\r\n\t\t\t// do not check for instanceof Date explicitly, since we may swap native date with different date implementation at some point\r\n\t\t\tif (date && !date.getFullYear) {\r\n\t\t\t\tif (typeof(format) !== \"function\") {\r\n\t\t\t\t\tif (typeof(format) === \"string\") {\r\n\t\t\t\t\t\tif (format === \"parse_date\" || format === \"xml_date\") {\r\n\t\t\t\t\t\t\tformat = gantt.defined(gantt.templates.xml_date) ? gantt.templates.xml_date : gantt.templates.parse_date;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tformat = gantt.defined(gantt.templates[format]) ? gantt.templates[format] : gantt.date.str_to_date(format);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tformat = gantt.defined(gantt.templates.xml_date) ? gantt.templates.xml_date : gantt.templates.parse_date;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (date) {\r\n\t\t\t\t\tdate = format(date);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdate = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn date;\r\n\t\t}\r\n\t};\r\n\treturn dateHelper;\r\n};","class t{constructor(t){const{url:e,token:s}=t;this._url=e,this._token=s,this._mode=1,this._seed=1,this._queue=[],this.data={},this.api={},this._events={}}headers(){return{Accept:\"application/json\",\"Content-Type\":\"application/json\",\"Remote-Token\":this._token}}fetch(t,e){const s={credentials:\"include\",headers:this.headers()};return e&&(s.method=\"POST\",s.body=e),fetch(t,s).then(t=>t.json())}load(t){return t&&(this._url=t),this.fetch(this._url).then(t=>this.parse(t))}parse(t){const{key:e,websocket:s}=t;e&&(this._token=t.key);for(const e in t.data)this.data[e]=t.data[e];for(const e in t.api){const s=this.api[e]={},i=t.api[e];for(const t in i)s[t]=this._wrapper(e+\".\"+t)}return s&&this.connect(),this}connect(){const t=this._socket;t&&(this._socket=null,t.onclose=function(){},t.close()),this._mode=2,this._socket=function(t,e,s,i){let n=e;\"/\"===n[0]&&(n=document.location.protocol+\"//\"+document.location.host+e);n=n.replace(/^http(s|):/,\"ws$1:\");const o=-1!=n.indexOf(\"?\")?\"&\":\"?\";n=`${n}${o}token=${s}&ws=1`;const r=new WebSocket(n);return r.onclose=()=>setTimeout(()=>t.connect(),2e3),r.onmessage=e=>{const s=JSON.parse(e.data);switch(s.action){case\"result\":t.result(s.body,[]);break;case\"event\":t.fire(s.body.name,s.body.value);break;case\"start\":i();break;default:t.onError(s.data)}},r}(this,this._url,this._token,()=>(this._mode=3,this._send(),this._resubscribe(),this))}_wrapper(t){return function(){const e=[].slice.call(arguments);let s=null;const i=new Promise((i,n)=>{s={data:{id:this._uid(),name:t,args:e},status:1,resolve:i,reject:n},this._queue.push(s)});return this.onCall(s,i),3===this._mode?this._send(s):setTimeout(()=>this._send(),1),i}.bind(this)}_uid(){return(this._seed++).toString()}_send(t){if(2==this._mode)return void setTimeout(()=>this._send(),100);const e=t?[t]:this._queue.filter(t=>1===t.status);if(!e.length)return;const s=e.map(t=>(t.status=2,t.data));3!==this._mode?this.fetch(this._url,JSON.stringify(s)).catch(t=>this.onError(t)).then(t=>this.result(t,s)):this._socket.send(JSON.stringify({action:\"call\",body:s}))}result(t,e){const s={};if(t)for(let e=0;e<t.length;e++)s[t[e].id]=t[e];else for(let t=0;t<e.length;t++)s[e[t].id]={id:e[t].id,error:\"Network Error\",data:null};for(let t=this._queue.length-1;t>=0;t--){const e=this._queue[t],i=s[e.data.id];i&&(this.onResponse(e,i),i.error?e.reject(i.error):e.resolve(i.data),this._queue.splice(t,1))}}on(t,e){const s=this._uid();let i=this._events[t];const n=!!i;return n||(i=this._events[t]=[]),i.push({id:s,handler:e}),n||3!=this._mode||this._socket.send(JSON.stringify({action:\"subscribe\",name:t})),{name:t,id:s}}_resubscribe(){if(3==this._mode)for(const t in this._events)this._socket.send(JSON.stringify({action:\"subscribe\",name:t}))}detach(t){if(!t){if(3==this._mode)for(const t in this._events)this._socket.send(JSON.stringify({action:\"unsubscribe\",key:t}));return void(this._events={})}const{id:e,name:s}=t,i=this._events[s];if(i){const t=i.filter(t=>t.id!=e);t.length?this._events[s]=t:(delete this._events[s],3==this._mode&&this._socket.send(JSON.stringify({action:\"unsubscribe\",name:s})))}}fire(t,e){const s=this._events[t];if(s)for(let t=0;t<s.length;t++)s[t].handler(e)}onError(t){return null}onCall(t,e){}onResponse(t,e){}}export{t as Client};\n//# sourceMappingURL=remote.es6.js.map\n","import * as remote_client from \"remote-client\";\r\nexport const remoteEvents = function(url, token) {\r\n    const remote = new remote_client.Client({\r\n      url,\r\n      token\r\n    });\r\n\r\n    // temporary patch, as we do not want credentials\r\n    remote.fetch = function (url, body) {\r\n      const req = {\r\n        headers: this.headers()\r\n      };\r\n      if (body) {\r\n        req.method = \"POST\";\r\n        req.body = body;\r\n      }\r\n\r\n      return fetch(url, req).then((res) => res.json());\r\n    };\r\n\r\n    this._ready = remote.load().then((back) => (this._remote = back));\r\n\r\n    function ready() {\r\n      return this._ready;\r\n    }\r\n  \r\n    function on(name, handler) {\r\n      this.ready().then((back) => {\r\n        if (typeof name === \"string\") back.on(name, handler);\r\n        else {\r\n          for (const key in name) {\r\n            back.on(key, name[key]);\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    this.ready = ready;\r\n    this.on = on;\r\n  };\r\n\r\n","function checkTimeout(host, updPerSecond){\r\n\tif (!updPerSecond)\r\n\t\treturn true;\r\n\t\r\n\tif (host._on_timeout)\r\n\t\treturn false;\r\n\t\r\n\tvar timeout = Math.ceil(1000/updPerSecond);\r\n\tif (timeout < 2) return true;\r\n\r\n\tsetTimeout(function(){\r\n\t\tdelete host._on_timeout;\r\n\t}, timeout);\r\n\r\n\thost._on_timeout = true;\r\n\treturn true;\r\n}\r\n\r\nexport default checkTimeout;","import eventable from \"../../utils/eventable\";\r\nimport * as utils from \"../../utils/utils\";\r\nimport timeout from \"../../utils/timeout\";\r\nimport global from \"../../utils/global\";\r\nimport * as domHelpers from \"../ui/utils/dom_helpers\";\r\n\r\nexport default function(gantt){\r\n\r\n\tfunction copyDomEvent(e){\r\n\t\treturn {\r\n\t\t\ttarget: e.target || e.srcElement,\r\n\t\t\tpageX: e.pageX,\r\n\t\t\tpageY: e.pageY,\r\n\t\t\tclientX: e.clientX,\r\n\t\t\tclientY: e.clientY,\r\n\t\t\tmetaKey: e.metaKey,\r\n\t\t\tshiftKey: e.shiftKey,\r\n\t\t\tctrlKey: e.ctrlKey,\r\n\t\t\taltKey: e.altKey\r\n\t\t};\r\n\t}\r\n\r\n\tfunction DnD(obj, config) {\r\n\t\tthis._obj = obj;\r\n\t\tthis._settings = config || {};\r\n\t\teventable(this);\r\n\r\n\t\tvar inputMethods = this.getInputMethods();\r\n\r\n\t\tthis._drag_start_timer = null;\r\n\t\tgantt.attachEvent(\"onGanttScroll\", utils.bind(function (left, top) {\r\n\t\t\tthis.clearDragTimer();\r\n\t\t}, this));\r\n\r\n\t\tvar lastDown = 0;\r\n\t\tvar eventParams = {passive: false};\r\n\t\tfor(var i = 0; i < inputMethods.length; i++){\r\n\t\t\t(utils.bind(function(input){\r\n\r\n\t\t\t\tgantt.event(obj, input.down, utils.bind(function (e) {\r\n\t\t\t\t\tif(!input.accessor(e)){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (typeof e.button !== 'undefined' && e.button !== 0) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(config.preventDefault && config.selector && domHelpers.closest(e.target, config.selector)){\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (gantt.config.touch && e.timeStamp && e.timeStamp - lastDown < 300) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis._settings.original_target = copyDomEvent(e);\r\n\r\n\t\t\t\t\tthis._settings.original_element_sizes = {\r\n\t\t\t\t\t\t...domHelpers.getRelativeEventPosition(e, domHelpers.getClosestSizedElement(obj)), \r\n\t\t\t\t\t\twidth: e.target.offsetWidth,\r\n\t\t\t\t\t\theight: e.target.offsetHeight\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tif (gantt.config.touch) {\r\n\t\t\t\t\t\tthis.clearDragTimer();\r\n\t\t\t\t\t\tthis._drag_start_timer = setTimeout(utils.bind(function () {\r\n\t\t\t\t\t\t\tif(gantt.getState().lightbox){\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis.dragStart(obj, e, input);\r\n\t\t\t\t\t\t}, this), gantt.config.touch_drag);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis.dragStart(obj, e, input);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, this), eventParams);\r\n\t\t\t\tvar eventElement = document.body;\r\n\t\t\t\tgantt.event(eventElement, input.up, utils.bind(function (e) {\r\n\t\t\t\t\tif(!input.accessor(e)){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.clearDragTimer();\r\n\t\t\t\t}, this), eventParams);\r\n\r\n\t\t\t}, this))(inputMethods[i]);\r\n\t\t}\r\n\t}\r\n\r\n\tDnD.prototype = {\r\n\t\ttraceDragEvents: function (domElement, inputMethod) {\r\n\t\t\tvar mousemove = utils.bind(function (e) {\r\n\t\t\t\treturn this.dragMove(domElement, e, inputMethod.accessor);\r\n\t\t\t}, this);\r\n\t\t\tutils.bind(function (e) {\r\n\t\t\t\treturn this.dragScroll(domElement, e);\r\n\t\t\t}, this);\r\n\r\n\t\t\tvar limited_mousemove = utils.bind(function (e) {\r\n\t\t\t\tif (this.config.started && utils.defined(this.config.updates_per_second)) {\r\n\t\t\t\t\tif (!timeout(this, this.config.updates_per_second))\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar dndActive = mousemove(e);\r\n\r\n\t\t\t\tif (dndActive) {\r\n\t\t\t\t\ttry{\r\n\t\t\t\t\t\tif (e && e.preventDefault && e.cancelable){//e.cancelable condition - because navigator.vibrate is blocked by Chrome\r\n\t\t\t\t\t\t\te.preventDefault();//Cancel default action on DND\r\n\t\t\t\t\t\t} //Cancel default action on DND\r\n\t\t\t\t\t}catch (e){\r\n\t\t\t\t\t\t// just suppress the exception, nothing needed to be done here\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//e.cancelBubble = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn dndActive;\r\n\t\t\t}, this);\r\n\t\t\tvar eventElement = domHelpers.getRootNode(gantt.$root);\r\n\t\t\tvar mousemoveContainer = this.config.mousemoveContainer || domHelpers.getRootNode(gantt.$root);\r\n\r\n\t\t\tvar eventParams = {passive: false};\r\n\t\t\tvar mouseup = utils.bind(function (e) {\r\n\t\t\t\tgantt.eventRemove(mousemoveContainer, inputMethod.move, limited_mousemove);\r\n\t\t\t\tgantt.eventRemove(eventElement, inputMethod.up, mouseup, eventParams);\r\n\t\t\t\treturn this.dragEnd(domElement);\r\n\t\t\t}, this);\r\n\r\n\t\t\tgantt.event(mousemoveContainer, inputMethod.move, limited_mousemove, eventParams);\r\n\t\t\tgantt.event(eventElement, inputMethod.up, mouseup, eventParams);\r\n\t\t},\r\n\t\tcheckPositionChange: function (pos) {\r\n\t\t\tvar diff_x = pos.x - this.config.pos.x;\r\n\t\t\tvar diff_y = pos.y - this.config.pos.y;\r\n\t\t\tvar distance = Math.sqrt(Math.pow(Math.abs(diff_x), 2) + Math.pow(Math.abs(diff_y), 2));\r\n\r\n\t\t\tif (distance > this.config.sensitivity) {\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t},\r\n\t\tinitDnDMarker: function () {\r\n\t\t\t// create dnd placeholder and put it in dom\r\n\t\t\tvar marker = this.config.marker = document.createElement(\"div\");\r\n\t\t\tmarker.className = \"gantt_drag_marker\";\r\n\t\t\t// GS-1333: don't show any message when we resize grid columns\r\n\t\t\tmarker.innerHTML = \"\";\r\n\t\t\tdocument.body.appendChild(marker);\r\n\t\t},\r\n\t\tbackupEventTarget: function (domEvent, getEvent) {\r\n\t\t\tif (!gantt.config.touch) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// keep original event target in DOM in order to keep dnd on touchmove event\r\n\t\t\tvar e = getEvent(domEvent);\r\n\r\n\t\t\tvar el = e.target || e.srcElement;\r\n\t\t\tvar copy = el.cloneNode(true);\r\n\t\t\t//this.config.target.target = copy;\r\n\t\t\tthis.config.original_target = copyDomEvent(e);\r\n\t\t\tthis.config.original_target.target = copy;\r\n\t\t\tthis.config.backup_element = el;\r\n\t\t\tel.parentNode.appendChild(copy);\r\n\r\n\t\t\tel.style.display = \"none\";\r\n\t\t\tvar mousemoveContainer = this.config.mousemoveContainer || document.body;\r\n\t\t\tmousemoveContainer.appendChild(el);\r\n\t\t},\r\n\t\tgetInputMethods: function () {\r\n\t\t\t// bind actions to browser events\r\n\t\t\tvar inputMethods = [];\r\n\r\n\t\t\tinputMethods.push({\r\n\t\t\t\t\"move\": \"mousemove\",\r\n\t\t\t\t\"down\": \"mousedown\",\r\n\t\t\t\t\"up\": \"mouseup\",\r\n\t\t\t\t\"accessor\": function (e) {\r\n\t\t\t\t\treturn e;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (gantt.config.touch) {\r\n\r\n\t\t\t\tvar touchEventsSupported = true;\r\n\t\t\t\ttry{\r\n\t\t\t\t\tdocument.createEvent(\"TouchEvent\");\r\n\t\t\t\t}catch (e){\r\n\t\t\t\t\ttouchEventsSupported = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(touchEventsSupported){\r\n\t\t\t\t\tinputMethods.push({\r\n\t\t\t\t\t\t\"move\": \"touchmove\",\r\n\t\t\t\t\t\t\"down\": \"touchstart\",\r\n\t\t\t\t\t\t\"up\": \"touchend\",\r\n\t\t\t\t\t\t\"accessor\": function (ev) {\r\n\t\t\t\t\t\t\tif (ev.touches && ev.touches.length > 1) return null;\r\n\t\t\t\t\t\t\tif (ev.touches[0])\r\n\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\ttarget: document.elementFromPoint(ev.touches[0].clientX, ev.touches[0].clientY),\r\n\t\t\t\t\t\t\t\t\tpageX: ev.touches[0].pageX,\r\n\t\t\t\t\t\t\t\t\tpageY: ev.touches[0].pageY,\r\n\t\t\t\t\t\t\t\t\tclientX: ev.touches[0].clientX,\r\n\t\t\t\t\t\t\t\t\tclientY: ev.touches[0].clientY\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\treturn ev;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}else if(global.navigator.pointerEnabled){\r\n\t\t\t\t\tinputMethods.push({\r\n\t\t\t\t\t\t\"move\": \"pointermove\",\r\n\t\t\t\t\t\t\"down\": \"pointerdown\",\r\n\t\t\t\t\t\t\"up\": \"pointerup\",\r\n\t\t\t\t\t\t\"accessor\": function (ev) {\r\n\t\t\t\t\t\t\tif (ev.pointerType == \"mouse\") return null;\r\n\t\t\t\t\t\t\treturn ev;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}else if (global.navigator.msPointerEnabled){\r\n\t\t\t\t\tinputMethods.push({\r\n\t\t\t\t\t\t\"move\": \"MSPointerMove\",\r\n\t\t\t\t\t\t\"down\": \"MSPointerDown\",\r\n\t\t\t\t\t\t\"up\": \"MSPointerUp\",\r\n\t\t\t\t\t\t\"accessor\": function (ev) {\r\n\t\t\t\t\t\t\tif (ev.pointerType == ev.MSPOINTER_TYPE_MOUSE) return null;\r\n\t\t\t\t\t\t\treturn ev;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn inputMethods;\r\n\t\t},\r\n\t\tclearDragTimer: function () {\r\n\t\t\tif (this._drag_start_timer) {\r\n\t\t\t\tclearTimeout(this._drag_start_timer);\r\n\t\t\t\tthis._drag_start_timer = null;\r\n\t\t\t}\r\n\t\t},\r\n\t\tdragStart: function (obj, e, inputMethod) {\r\n\t\t\tif (this.config && this.config.started) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.config = {\r\n\t\t\t\tobj: obj,\r\n\t\t\t\tmarker: null,\r\n\t\t\t\tstarted: false,\r\n\t\t\t\tpos: this.getPosition(e),\r\n\t\t\t\tsensitivity: 4\r\n\t\t\t};\r\n\t\t\tif (this._settings)\r\n\t\t\t\tutils.mixin(this.config, this._settings, true);\r\n\r\n\r\n\t\t\tthis.traceDragEvents(obj, inputMethod);\r\n\r\n\t\t\tgantt._prevent_touch_scroll = true;\r\n\t\t\tdocument.body.classList.add(\"gantt_noselect\");\r\n\r\n\t\t\tif (gantt.config.touch) {\r\n\t\t\t\tthis.dragMove(obj, e, inputMethod.accessor);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tdragMove: function (obj, e, getEvent) {\r\n\t\t\tvar source = getEvent(e);\r\n\t\t\tif (!source) return false;\r\n\r\n\t\t\tif (!this.config.marker && !this.config.started) {\r\n\t\t\t\tvar pos = this.getPosition(source);\r\n\r\n\t\t\t\tif (gantt.config.touch || this.checkPositionChange(pos)) {\r\n\t\t\t\t\t// real drag starts here,\r\n\t\t\t\t\t// when user moves mouse at first time after onmousedown\r\n\t\t\t\t\tthis.config.started = true;\r\n\t\t\t\t\tthis.config.ignore = false;\r\n\t\t\t\t\tgantt._touch_drag = true;\r\n\t\t\t\t\tif (this.callEvent(\"onBeforeDragStart\", [obj, this.config.original_target]) === false) {\r\n\t\t\t\t\t\tthis.config.ignore = true;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.backupEventTarget(e, getEvent);\r\n\t\t\t\t\tthis.initDnDMarker();\r\n\t\t\t\t\tgantt._touch_feedback();\r\n\t\t\t\t\tthis.callEvent(\"onAfterDragStart\", [obj, this.config.original_target]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.config.ignore = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!this.config.ignore) {\r\n\t\t\t\t// GS-1279 Gantt crashes on Mobile Firefox after starting to create a link and moving finger outisde the page.\r\n\t\t\t\tif (e.targetTouches && !source.target) return;\r\n\t\t\t\t\r\n\t\t\t\tsource.pos = this.getPosition(source);\r\n\t\t\t\tthis.config.marker.style.left = source.pos.x + \"px\";\r\n\t\t\t\tthis.config.marker.style.top = source.pos.y + \"px\";\r\n\t\t\t\tthis.callEvent(\"onDragMove\", [obj, source]);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\tdragEnd: function (obj) {\r\n\t\t\tvar target = this.config.backup_element;\r\n\t\t\tif (target && target.parentNode) {\r\n\t\t\t\ttarget.parentNode.removeChild(target);\r\n\t\t\t}\r\n\t\t\tgantt._prevent_touch_scroll = false;\r\n\t\t\tif (this.config.marker) {\r\n\t\t\t\tthis.config.marker.parentNode.removeChild(this.config.marker);\r\n\t\t\t\tthis.config.marker = null;\r\n\r\n\t\t\t\tthis.callEvent(\"onDragEnd\", []);\r\n\t\t\t}\r\n\t\t\tthis.config.started = false;\r\n\t\t\tgantt._touch_drag = false;\r\n\t\t\tdocument.body.classList.remove(\"gantt_noselect\");\r\n\t\t},\r\n\r\n\t\tgetPosition: function (e) {\r\n\t\t\tvar x = 0, y = 0;\r\n\t\t\tif (e.pageX || e.pageY) {\r\n\t\t\t\tx = e.pageX;\r\n\t\t\t\ty = e.pageY;\r\n\t\t\t} else if (e.clientX || e.clientY) {\r\n\t\t\t\tx = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;\r\n\t\t\t\ty = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;\r\n\t\t\t}\r\n\t\t\treturn {x: x, y: y};\r\n\t\t}\r\n\t};\r\n\r\n\treturn DnD;\r\n};\r\n","export default function(gantt) {\r\n\r\n\tvar regTemplates = {};\r\n\r\n\tfunction initTemplate(name, initial, template_name) {\r\n\t\ttemplate_name = template_name || name;\r\n\t\tvar config = gantt.config,\r\n\t\t\ttemplates = gantt.templates;\r\n\r\n\t\tif (gantt.config[name] && regTemplates[template_name] != config[name]) {\r\n\t\t\tif (!(initial && templates[template_name])) {\r\n\t\t\t\ttemplates[template_name] = gantt.date.date_to_str(config[name]);\r\n\t\t\t\tregTemplates[template_name] = config[name];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction initTemplates() {\r\n\t\tvar date = gantt.date;\r\n\r\n\t\t//build configuration based templates\r\n\t\tvar d = date.date_to_str;\r\n\t\tvar c = gantt.config;\r\n\t\tvar format_date = d(c.xml_date || c.date_format, c.server_utc);\r\n\t\tvar parse_date = date.str_to_date(c.xml_date || c.date_format, c.server_utc);\r\n\r\n\t\tinitTemplate(\"date_scale\", true, undefined, gantt.config, gantt.templates);\r\n\t\tinitTemplate(\"date_grid\", true, \"grid_date_format\", gantt.config, gantt.templates);\r\n\t\tinitTemplate(\"task_date\", true, undefined, gantt.config, gantt.templates);\r\n\r\n\t\tgantt.mixin(gantt.templates, {\r\n\t\t\txml_format: undefined, // deprecated\r\n\t\t\tformat_date: format_date,\r\n\r\n\t\t\txml_date: undefined, // deprecated\r\n\t\t\tparse_date: parse_date,\r\n\r\n\t\t\tprogress_text: function (start, end, task) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\tgrid_header_class: function (column, config) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\r\n\t\t\ttask_text: function (start, end, task) {\r\n\t\t\t\treturn task.text;\r\n\t\t\t},\r\n\t\t\ttask_class: function (start, end, task) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\ttask_end_date: function (date) {\r\n\t\t\t\treturn gantt.templates.task_date(date);\r\n\t\t\t},\r\n\t\t\tgrid_row_class: function (start, end, task) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\ttask_row_class: function (start, end, task) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\ttimeline_cell_class: function (item, date) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\ttimeline_cell_content: function (item, date) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\tscale_cell_class: function (date) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\tscale_row_class: function (date) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\r\n\t\t\tgrid_indent: function (item) {\r\n\t\t\t\treturn \"<div class='gantt_tree_indent'></div>\";\r\n\t\t\t},\r\n\t\t\tgrid_folder: function (item) {\r\n\t\t\t\treturn \"<div class='gantt_tree_icon gantt_folder_\" + (item.$open ? \"open\" : \"closed\") + \"'></div>\";\r\n\t\t\t},\r\n\t\t\tgrid_file: function (item) {\r\n\t\t\t\treturn \"<div class='gantt_tree_icon gantt_file'></div>\";\r\n\t\t\t},\r\n\t\t\tgrid_open: function (item) {\r\n\t\t\t\treturn \"<div class='gantt_tree_icon gantt_\" + (item.$open ? \"close\" : \"open\") + \"'></div>\";\r\n\t\t\t},\r\n\t\t\tgrid_blank: function (item) {\r\n\t\t\t\treturn \"<div class='gantt_tree_icon gantt_blank'></div>\";\r\n\t\t\t},\r\n\t\t\tdate_grid: function (date, item, column) {\r\n\t\t\t\tif (item && gantt.isUnscheduledTask(item) && gantt.config.show_unscheduled) {\r\n\t\t\t\t\treturn gantt.templates.task_unscheduled_time(item);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn gantt.templates.grid_date_format(date, column);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\ttask_time: function (start, end, ev) {\r\n\t\t\t\tif (gantt.isUnscheduledTask(ev) && gantt.config.show_unscheduled) {\r\n\t\t\t\t\treturn gantt.templates.task_unscheduled_time(ev);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn gantt.templates.task_date(start) + \" - \" + gantt.templates.task_end_date(end);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\ttask_unscheduled_time: function (task) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\r\n\t\t\ttime_picker: d(c.time_picker),\r\n\t\t\tlink_class: function (link) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t},\r\n\t\t\tlink_description: function (link) {\r\n\t\t\t\tvar from = gantt.getTask(link.source),\r\n\t\t\t\t\tto = gantt.getTask(link.target);\r\n\r\n\t\t\t\treturn \"<b>\" + from.text + \"</b> &ndash;  <b>\" + to.text + \"</b>\";\r\n\t\t\t},\r\n\r\n\t\t\tdrag_link: function (from, from_start, to, to_start) {\r\n\t\t\t\tfrom = gantt.getTask(from);\r\n\t\t\t\tvar labels = gantt.locale.labels;\r\n\r\n\t\t\t\tvar text = \"<b>\" + from.text + \"</b> \" + (from_start ? labels.link_start : labels.link_end) + \"<br/>\";\r\n\t\t\t\tif (to) {\r\n\t\t\t\t\tto = gantt.getTask(to);\r\n\t\t\t\t\ttext += \"<b> \" + to.text + \"</b> \" + (to_start ? labels.link_start : labels.link_end) + \"<br/>\";\r\n\t\t\t\t}\r\n\t\t\t\treturn text;\r\n\t\t\t},\r\n\t\t\tdrag_link_class: function (from, from_start, to, to_start) {\r\n\t\t\t\tvar add = \"\";\r\n\r\n\t\t\t\tif (from && to) {\r\n\t\t\t\t\tvar allowed = gantt.isLinkAllowed(from, to, from_start, to_start);\r\n\t\t\t\t\tadd = \" \" + (allowed ? \"gantt_link_allow\" : \"gantt_link_deny\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn \"gantt_link_tooltip\" + add;\r\n\t\t\t},\r\n\r\n\t\t\t/* used for aria-labels of bar elements and for tooltip.js */\r\n\t\t\ttooltip_date_format: date.date_to_str(\"%Y-%m-%d\"),\r\n\t\t\ttooltip_text: function (start, end, event) {\r\n\t\t\t\treturn `<div>Task: ${event.text}</div>\r\n\t\t\t\t<div>Start date: ${gantt.templates.tooltip_date_format(start)}</div>\r\n\t\t\t\t<div>End date: ${gantt.templates.tooltip_date_format(end)}</div>`;\r\n\t\t\t},\r\n\t\t\tbaseline_text: function (task, baseline, index) {\r\n\t\t\t\treturn \"\";\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\treturn {\r\n\t\tinitTemplates: initTemplates,\r\n\t\tinitTemplate: initTemplate\r\n\t};\r\n\r\n};","import * as utils from \"../../utils/utils\";\r\n\r\nvar StateService = (function(){\r\n\tvar stateProviders = {};\r\n\r\n\tfunction getState(name){\r\n\t\tvar provider = stateProviders[name];\r\n\t\tif(provider){\r\n\t\t\treturn stateProviders[name].method();\r\n\t\t}else{\r\n\t\t\tvar res = {};\r\n\t\t\tfor(var i in stateProviders){\r\n\t\t\t\tif(!stateProviders[i].internal)\r\n\t\t\t\t\tutils.mixin(res, stateProviders[i].method(), true);\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction registerProvider(name, provider, internal){\r\n\t\tstateProviders[name] = { method: provider, internal: internal};\r\n\t}\r\n\r\n\tfunction unregisterProvider(name){\r\n\t\tdelete stateProviders[name];\r\n\t}\r\n\r\n\treturn {\r\n\t\tgetState: getState,\r\n\t\tregisterProvider: registerProvider,\r\n\t\tunregisterProvider: unregisterProvider\r\n\t};\r\n});\r\n\r\nexport default StateService;\r\n\r\n","// eslint-disable-next-line no-restricted-globals\r\nexport default Promise;","import * as utils from \"../../utils/utils\";\r\nimport {replaceValidZeroId} from \"../../utils/helpers\";\r\n\r\nvar createTasksDatastoreFacade = function(){\r\n\treturn {\r\n\tgetTask: function (id) {\r\n\t\tid = replaceValidZeroId(id, this.config.root_id);\r\n\t\tthis.assert(id, \"Invalid argument for gantt.getTask\");\r\n\t\tvar task = this.$data.tasksStore.getItem(id);\r\n\t\tthis.assert(task, \"Task not found id=\" + id);\r\n\t\treturn task;\r\n\t},\r\n\tgetTaskByTime: function (from, to) {\r\n\t\tvar p = this.$data.tasksStore.getItems();\r\n\r\n\t\tvar res = [];\r\n\r\n\t\tif (!(from || to)) {\r\n\t\t\tres = p;\r\n\t\t} else {\r\n\t\t\tfrom = +from || -Infinity;\r\n\t\t\tto = +to || Infinity;\r\n\t\t\tfor (var t = 0; t < p.length; t++){\r\n\t\t\t\tvar task = p[t];\r\n\t\t\t\tif (+task.start_date < to && +task.end_date > from)\r\n\t\t\t\t\tres.push(task);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn res;\r\n\t},\r\n\tisTaskExists: function (id) {\r\n\t\tif(!this.$data || !this.$data.tasksStore){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn this.$data.tasksStore.exists(id);\r\n\t},\r\n\tupdateTask: function (id, item) {\r\n\t\tif (!utils.defined(item)) item = this.getTask(id);\r\n\t\tthis.$data.tasksStore.updateItem(id, item);\r\n\t\tif(this.isTaskExists(id))\r\n\t\t\tthis.refreshTask(id);\r\n\t},\r\n\taddTask: function (item, parent, index) {\r\n\t\tif (!utils.defined(item.id))\r\n\t\t\titem.id = utils.uid();\r\n\r\n\t\t//GS-761: assert unique ID\r\n\t\tif (this.isTaskExists(item.id)){\r\n\t\t\tvar task = this.getTask(item.id);\r\n\t\t\tif (task.$index != item.$index) {\r\n\t\t\t\t// Someone may try to mistakenly add a task with the same ID, and most likely\r\n\t\t\t\t// use the string format for the dates. Gantt shouldn't break in this scenario\r\n\t\t\t\tif (item.start_date && typeof item.start_date === \"string\"){\r\n\t\t\t\t\titem.start_date = this.date.parseDate(item.start_date, \"parse_date\");\r\n\t\t\t\t}\r\n\t\t\t\tif (item.end_date && typeof item.end_date === \"string\"){\r\n\t\t\t\t\titem.end_date = this.date.parseDate(item.end_date, \"parse_date\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn this.$data.tasksStore.updateItem(item.id, item);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tif (!utils.defined(parent)) parent = this.getParent(item) || 0;\r\n\t\tif (!this.isTaskExists(parent)) parent = this.config.root_id;\r\n\t\tthis.setParent(item, parent);\r\n\r\n\t\t// GS-1583. Save the $open state to the Undo Stack\r\n\t\tif (this.getState().lightbox && this.isTaskExists(parent)) {\r\n\t\t\tvar parentObj = this.getTask(parent);\r\n\t\t\tthis.callEvent(\"onAfterParentExpand\", [parent, parentObj]);\r\n\t\t}\r\n\t\treturn this.$data.tasksStore.addItem(item, index, parent);\r\n\t},\r\n\tdeleteTask: function (id) {\r\n\t\tid = replaceValidZeroId(id, this.config.root_id);\r\n\t\treturn this.$data.tasksStore.removeItem(id);\r\n\t},\r\n\tgetTaskCount: function () {\r\n\t\treturn this.$data.tasksStore.count();\r\n\t},\r\n\tgetVisibleTaskCount: function () {\r\n\t\treturn this.$data.tasksStore.countVisible();\r\n\t},\r\n\tgetTaskIndex: function (id) {\r\n\t\treturn this.$data.tasksStore.getBranchIndex(id);\r\n\t},\r\n\tgetGlobalTaskIndex: function (id) {\r\n\t\tid = replaceValidZeroId(id, this.config.root_id);\r\n\t\tthis.assert(id, \"Invalid argument\");\r\n\t\treturn this.$data.tasksStore.getIndexById(id);\r\n\t},\r\n\teachTask: function (code, parent, master) {\r\n\t\treturn this.$data.tasksStore.eachItem(utils.bind(code, master||this), parent);\r\n\t},\r\n\teachParent: function (callback, startTask, master) {\r\n\t\treturn this.$data.tasksStore.eachParent(utils.bind(callback, master || this), startTask);\r\n\t},\r\n\tchangeTaskId: function (oldid, newid) {\r\n\t\tthis.$data.tasksStore.changeId(oldid, newid);\r\n\t\tvar task = this.$data.tasksStore.getItem(newid);\r\n\r\n\t\tvar links = [];\r\n\r\n\t\tif (task.$source) {\r\n\t\t\tlinks = links.concat(task.$source);\r\n\t\t}\r\n\t\tif (task.$target) {\r\n\t\t\tlinks = links.concat(task.$target);\r\n\t\t}\r\n\r\n\t\tfor (var i = 0; i < links.length; i++) {\r\n\t\t\tvar link = this.getLink(links[i]);\r\n\t\t\tif (link.source == oldid) {\r\n\t\t\t\tlink.source = newid;\r\n\t\t\t}\r\n\t\t\tif (link.target == oldid) {\r\n\t\t\t\tlink.target = newid;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tcalculateTaskLevel: function (item) {\r\n\t\treturn this.$data.tasksStore.calculateItemLevel(item);\r\n\t},\r\n\tgetNext: function (id) {\r\n\t\treturn this.$data.tasksStore.getNext(id);\r\n\t},\r\n\tgetPrev: function (id) {\r\n\t\treturn this.$data.tasksStore.getPrev(id);\r\n\t},\r\n\tgetParent: function (id) {\r\n\t\treturn this.$data.tasksStore.getParent(id);\r\n\t},\r\n\tsetParent: function (task, new_pid, silent) {\r\n\t\treturn this.$data.tasksStore.setParent(task, new_pid, silent);\r\n\t},\r\n\tgetSiblings: function (id) {\r\n\t\treturn this.$data.tasksStore.getSiblings(id).slice();\r\n\t},\r\n\tgetNextSibling: function (id) {\r\n\t\treturn this.$data.tasksStore.getNextSibling(id);\r\n\t},\r\n\tgetPrevSibling: function (id) {\r\n\t\treturn this.$data.tasksStore.getPrevSibling(id);\r\n\t},\r\n\tgetTaskByIndex: function(index){\r\n\t\tvar id = this.$data.tasksStore.getIdByIndex(index);\r\n\t\tif(this.isTaskExists(id)){\r\n\t\t\treturn this.getTask(id);\r\n\t\t}else{\r\n\t\t\treturn null;\r\n\t\t}\r\n\t},\r\n\tgetChildren: function (id) {\r\n\t\tif(!this.hasChild(id)){\r\n\t\t\treturn [];\r\n\t\t}else{\r\n\t\t\treturn this.$data.tasksStore.getChildren(id).slice();\r\n\t\t}\r\n\t},\r\n\thasChild: function (id) {\r\n\t\treturn this.$data.tasksStore.hasChild(id);\r\n\t},\r\n\topen: function (id) {\r\n\t\tthis.$data.tasksStore.open(id);\r\n\t},\r\n\tclose: function (id) {\r\n\t\tthis.$data.tasksStore.close(id);\r\n\t},\r\n\tmoveTask: function (sid, tindex, parent) {\r\n\t\tparent = replaceValidZeroId(parent, this.config.root_id);\r\n\t\treturn this.$data.tasksStore.move.apply(this.$data.tasksStore, arguments);\r\n\t},\r\n\tsort: function(field, desc, parent, silent) {\r\n\t\tvar render = !silent;//4th argument to cancel redraw after sorting\r\n\r\n\t\tthis.$data.tasksStore.sort(field, desc, parent);\r\n\t\tthis.callEvent(\"onAfterSort\", [field, desc, parent]);\r\n\r\n\t\tif (render) {\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t}\r\n};\r\n};\r\n\r\nexport default createTasksDatastoreFacade;\r\n\r\n\r\n","import * as utils from \"../../utils/utils\";\r\n\r\n\r\nvar createLinksStoreFacade = function(){\r\n\treturn {\r\n\tgetLinkCount: function () {\r\n\t\treturn this.$data.linksStore.count();\r\n\t},\r\n\r\n\tgetLink : function (id) {\r\n\t\treturn this.$data.linksStore.getItem(id);\r\n\t},\r\n\r\n\tgetLinks : function () {\r\n\t\treturn this.$data.linksStore.getItems();\r\n\t},\r\n\r\n\tisLinkExists : function (id) {\r\n\t\treturn this.$data.linksStore.exists(id);\r\n\t},\r\n\r\n\taddLink : function (link) {\r\n\t\tconst newLink = this.$data.linksStore.addItem(link);\r\n\t\t// GS-1222. Update fullOrder otherwise the link won't appear after render\r\n\t\tif (this.$data.linksStore.isSilent()){\r\n\t\t\tthis.$data.linksStore.fullOrder.push(newLink);\r\n\t\t}\r\n\t\treturn newLink;\r\n\t},\r\n\r\n\tupdateLink : function (id, data) {\r\n\t\tif (!utils.defined(data))\r\n\t\t\tdata = this.getLink(id);\r\n\t\tthis.$data.linksStore.updateItem(id, data);\r\n\t},\r\n\r\n\tdeleteLink : function (id) {\r\n\t\treturn this.$data.linksStore.removeItem(id);\r\n\t},\r\n\r\n\tchangeLinkId : function (oldid, newid) {\r\n\t\treturn this.$data.linksStore.changeId(oldid, newid);\r\n\t}\r\n};\r\n};\r\n\r\nexport default createLinksStoreFacade;","import * as utils from \"../../utils/utils\";\r\n\r\nvar $powerArray  = {\r\n\t$create: function(array){\r\n\t\treturn utils.mixin(array || [], this);\r\n\t},\r\n\t//remove element at specified position\r\n\t$removeAt:function(pos,len){\r\n\t\tif (pos>=0) this.splice(pos,(len||1));\r\n\t},\r\n\t//find element in collection and remove it\r\n\t$remove:function(value){\r\n\t\tthis.$removeAt(this.$find(value));\r\n\t},\r\n\t//add element to collection at specific position\r\n\t$insertAt:function(data,pos){\r\n\t\tif (!pos && pos!==0) \t//add to the end by default\r\n\t\t\tthis.push(data);\r\n\t\telse {\r\n\t\t\tvar b = this.splice(pos,(this.length-pos));\r\n\t\t\tthis[pos] = data;\r\n\t\t\tthis.push.apply(this,b); //reconstruct array without loosing this pointer\r\n\t\t}\r\n\t},\r\n\t//return index of element, -1 if it doesn't exists\r\n\t$find:function(data){\r\n\t\tfor (var i=0; i<this.length; i++)\r\n\t\t\tif (data==this[i]) return i;\r\n\t\treturn -1;\r\n\t},\r\n\t//execute some method for each element of array\r\n\t$each:function(functor,master){\r\n\t\tfor (var i=0; i < this.length; i++)\r\n\t\t\tfunctor.call((master||this),this[i]);\r\n\t},\r\n\t//create new array from source, by using results of functor\r\n\t$map:function(functor,master){\r\n\t\tfor (var i=0; i < this.length; i++)\r\n\t\t\tthis[i]=functor.call((master||this),this[i]);\r\n\t\treturn this;\r\n\t},\r\n\t$filter:function(functor, master){\r\n\t\tfor (var i=0; i < this.length; i++)\r\n\t\t\tif (!functor.call((master||this),this[i])){\r\n\t\t\t\tthis.splice(i,1);\r\n\t\t\t\ti--;\r\n\t\t\t}\r\n\t\treturn this;\r\n\t}\r\n};\r\n\r\nexport default $powerArray;","/**\r\n * Check the over task or draggble task is placeholder task\r\n */\r\n\r\nexport default function isPlaceholderTask(id, gantt, store, config) {\r\n\t// return false;\r\n\tvar config = gantt ? gantt.config : config;\r\n\tif (config && config.placeholder_task) {\r\n\t\tif (store.exists(id)){\r\n\t\t\tvar item = store.getItem(id);\r\n\t\t\treturn item.type === config.types.placeholder;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n};","import powerArray from \"./power_array\";\r\nimport * as utils from \"../../utils/utils\";\r\nimport eventable from \"../../utils/eventable\";\r\nimport isPlaceholderTask from \"../../utils/placeholder_task\";\r\n\r\nvar DataStore = function(config){\r\n\tthis.pull = {};\r\n\tthis.$initItem = config.initItem;\r\n\tthis.visibleOrder = powerArray.$create();\r\n\tthis.fullOrder = powerArray.$create();\r\n\tthis._skip_refresh = false;\r\n\tthis._filterRule = null;\r\n\tthis._searchVisibleOrder = {};\r\n\tthis._indexRangeCache = {};\r\n\tthis._getItemsCache = null;\r\n\tthis.$config = config;\r\n\teventable(this);\r\n\r\n\tthis._attachDataChange(function(){\r\n\t\tthis._indexRangeCache = {};\r\n\t\tthis._getItemsCache = null;\r\n\t\treturn true;\r\n\t});\r\n\treturn this;\r\n};\r\nDataStore.prototype = {\r\n\r\n\t_attachDataChange: function(callback){\r\n\t\tthis.attachEvent(\"onClearAll\", callback);\r\n\t\tthis.attachEvent(\"onBeforeParse\", callback);\r\n\t\tthis.attachEvent(\"onBeforeUpdate\", callback);\r\n\t\tthis.attachEvent(\"onBeforeDelete\", callback);\r\n\t\tthis.attachEvent(\"onBeforeAdd\", callback);\r\n\t\tthis.attachEvent(\"onParse\", callback);\r\n\t\tthis.attachEvent(\"onBeforeFilter\", callback);\r\n\t},\r\n\t_parseInner: function(data){\r\n\t\tvar item = null,\r\n\t\t\tloaded = [];\r\n\t\tfor(var i = 0, len = data.length; i< len; i++){\r\n\t\t\titem = data[i];\r\n\t\t\tif(this.$initItem){\r\n\t\t\t\tif(this.$config.copyOnParse()){\r\n\t\t\t\t\titem = utils.copy(item);\r\n\t\t\t\t}\r\n\t\t\t\titem = this.$initItem(item);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(this.callEvent(\"onItemLoading\", [item])){\r\n\t\t\t\tif (!this.pull.hasOwnProperty(item.id)) {\r\n\t\t\t\t\tthis.fullOrder.push(item.id);\r\n\t\t\t\t}\r\n\t\t\t\tloaded.push(item);\r\n\t\t\t\tthis.pull[item.id] = item;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn loaded;\r\n\t},\r\n\tparse: function(data){\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tthis.callEvent(\"onBeforeParse\", [data]);\r\n\t\t}\r\n\t\tvar loaded = this._parseInner(data);\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tthis.refresh();\r\n\t\t\tthis.callEvent(\"onParse\", [loaded]);\r\n\t\t}\r\n\t},\r\n\tgetItem: function(id){\r\n\t\treturn this.pull[id];\r\n\t},\r\n\r\n\t_updateOrder: function(code){\r\n\t\tcode.call(this.visibleOrder);\r\n\t\tcode.call(this.fullOrder);\r\n\t},\r\n\tupdateItem: function(id, item){\r\n\t\tif (!utils.defined(item)) item = this.getItem(id);\r\n\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tif (this.callEvent(\"onBeforeUpdate\", [item.id, item]) === false) return false;\r\n\t\t}\r\n\t\t// This is how it worked before updating the properties:\r\n\t\t// this.pull[id]=item;\r\n\t\tutils.mixin(this.pull[id],item, true);\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tthis.callEvent(\"onAfterUpdate\", [item.id, item]);\r\n\t\t\tthis.callEvent(\"onStoreUpdated\", [item.id, item, \"update\"]);\r\n\t\t}\r\n\t},\r\n\r\n\t_removeItemInner: function(id){\r\n\t\t//clear from collections\r\n\t\t//this.visibleOrder.$remove(id);\r\n\t\tthis._updateOrder(function(){ this.$remove(id);});\r\n\t\tdelete this.pull[id];\r\n\t},\r\n\r\n\tremoveItem: function(id){\r\n\t\t//utils.assert(this.exists(id), \"Not existing ID in remove command\"+id);\r\n\r\n\t\tvar obj = this.getItem(id);\t//save for later event\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tif (this.callEvent(\"onBeforeDelete\", [obj.id, obj]) === false) return false;\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onAfterDeleteConfirmed\", [obj.id, obj]);\r\n\t\tthis._removeItemInner(id);\r\n\t\t\r\n\t\tif (this.isSilent()) {\r\n\t\t\tthis.callEvent(\"onAfterSilentDelete\", [obj.id, obj]);\r\n\t\t}\r\n\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tthis.filter();\r\n\t\t\tthis.callEvent(\"onAfterDelete\", [obj.id, obj]);\r\n\t\t\t//repaint signal\r\n\t\t\tthis.callEvent(\"onStoreUpdated\", [obj.id, obj, \"delete\"]);\r\n\t\t}\r\n\t},\r\n\r\n\t_addItemInner: function(item, index){\r\n\t\t//in case of treetable order is sent as 3rd parameter\r\n\t\t//var order = index;\r\n\r\n\t\tif(this.exists(item.id)){\r\n\t\t\tthis.silent(function(){this.updateItem(item.id, item);});\r\n\t\t}else{\r\n\t\t\tvar order = this.visibleOrder;\r\n\r\n\t\t\t//by default item is added to the end of the list\r\n\t\t\tvar data_size = order.length;\r\n\r\n\t\t\tif (!utils.defined(index) || index < 0)\r\n\t\t\t\tindex = data_size;\r\n\t\t\t//check to prevent too big indexes\r\n\t\t\tif (index > data_size){\r\n\t\t\t\t//dhx.log(\"Warning\",\"DataStore:add\",\"Index of out of bounds\");\r\n\t\t\t\tindex = Math.min(order.length,index);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\t//gantt.assert(!this.exists(id), \"Not unique ID\");\r\n\r\n\t\tthis.pull[item.id]=item;\r\n\t\tthis._updateOrder(function(){\r\n\t\t\tif(this.$find(item.id) === -1)\r\n\t\t\t\tthis.$insertAt(item.id,index);\r\n\t\t});\r\n\t\tthis.filter();\r\n\t\t//order.$insertAt(item.id,index);\r\n\t},\r\n\r\n\r\n\tisVisible: function(id){\r\n\t\treturn this.visibleOrder.$find(id) > -1;\r\n\t},\r\n\tgetVisibleItems: function(){\r\n\t\treturn this.getIndexRange();\r\n\t},\r\n\r\n\taddItem: function(item, index){\r\n\t\tif (!utils.defined(item.id))\r\n\t\t\titem.id = utils.uid();\r\n\r\n\t\tif(this.$initItem){\r\n\t\t\titem = this.$initItem(item);\r\n\t\t}\r\n\r\n\t\tif (!this.isSilent()){\r\n\t\t\tif (this.callEvent(\"onBeforeAdd\", [item.id, item]) === false) return false;\r\n\t\t}\r\n\r\n\r\n\t\tthis._addItemInner(item, index);\r\n\r\n\t\tif (!this.isSilent()){\r\n\t\t\tthis.callEvent(\"onAfterAdd\",[item.id, item]);\r\n\t\t\t//repaint signal\r\n\t\t\tthis.callEvent(\"onStoreUpdated\",[item.id,item,\"add\"]);\r\n\t\t}\r\n\t\treturn item.id;\r\n\t},\r\n\r\n\t_changeIdInner: function(oldId, newId){\r\n\t\tif(this.pull[oldId])\r\n\t\t\tthis.pull[newId] = this.pull[oldId];\r\n\r\n\t\tvar visibleOrder = this._searchVisibleOrder[oldId];\r\n\t\tthis.pull[newId].id = newId;\r\n\t\tthis._updateOrder(function(){\r\n\t\t\tthis[this.$find(oldId)] = newId;\r\n\t\t});\r\n\t\tthis._searchVisibleOrder[newId] = visibleOrder;\r\n\t\tdelete this._searchVisibleOrder[oldId];\r\n\r\n\t\t//this.visibleOrder[this.visibleOrder.$find(oldId)]=newId;\r\n\t\tdelete this.pull[oldId];\r\n\t},\r\n\tchangeId: function(oldId, newId){\r\n\t\tthis._changeIdInner(oldId, newId);\r\n\r\n\t\tthis.callEvent(\"onIdChange\", [oldId, newId]);\r\n\r\n\t},\r\n\texists: function(id){\r\n\t\treturn !!(this.pull[id]);\r\n\t},\r\n\r\n\t_moveInner: function(sindex, tindex){\r\n\t\tvar id = this.getIdByIndex(sindex);\r\n\r\n\t\tthis._updateOrder(function(){\r\n\t\t\tthis.$removeAt(sindex);\r\n\t\t\tthis.$insertAt(id,Math.min(this.length, tindex));\r\n\t\t});\r\n\t\t//this.visibleOrder.$removeAt(sindex);\t//remove at old position\r\n\t\t//if (sindex<tindex) tindex--;\t//correct shift, caused by element removing\r\n\t\t//this.visibleOrder.$insertAt(id,Math.min(this.visibleOrder.length, tindex));\t//insert at new position\r\n\t},\r\n\r\n\tmove: function(sindex, tindex){\r\n\t\t//gantt.assert(sindex>=0 && tindex>=0, \"DataStore::move\",\"Incorrect indexes\");\r\n\r\n\t\tvar id = this.getIdByIndex(sindex);\r\n\t\tvar obj = this.getItem(id);\r\n\t\tthis._moveInner(sindex, tindex);\r\n\r\n\t\tif (!this.isSilent()) {\r\n\t\t\t//repaint signal\r\n\t\t\tthis.callEvent(\"onStoreUpdated\", [obj.id, obj, \"move\"]);\r\n\t\t}\r\n\t},\r\n\tclearAll: function(){\r\n\t\tif(this.$destroyed){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// GS-956 We need to unselect the resource as its ID is cached\r\n\t\tthis.silent(function(){\r\n\t\t\tthis.unselect();\r\n\t\t});\r\n\t\tthis.pull = {};\r\n\t\tthis.visibleOrder = powerArray.$create();\r\n\t\tthis.fullOrder = powerArray.$create();\r\n\t\tif (this.isSilent()) return;\r\n\t\tthis.callEvent(\"onClearAll\",[]);\r\n\t\tthis.refresh();\r\n\t},\r\n\r\n\tsilent:function(code, master){\r\n\t\tvar alreadySilent = false;\r\n\t\tif(this.isSilent()) {\r\n\t\t\talreadySilent = true;\r\n\t\t}\r\n\t\tthis._skip_refresh = true;\r\n\t\tcode.call(master||this);\r\n\t\t\r\n\t\tif (!alreadySilent) {\r\n\t\t\tthis._skip_refresh = false;\r\n\t\t}\r\n\t},\r\n\tisSilent: function(){\r\n\t\treturn !!this._skip_refresh;\r\n\t},\r\n\r\n\tarraysEqual: function (arr1, arr2) {\r\n\t\tif(arr1.length !== arr2.length)\r\n\t\t\treturn false;\r\n\t\tfor(var i = 0; i < arr1.length; i++) {\r\n\t\t\tif(arr1[i] !== arr2[i])\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\trefresh: function(id, quick){\r\n\t\tif (this.isSilent()) return;\r\n\r\n\t\tvar item;\r\n\t\tif(id){\r\n\t\t\titem = this.getItem(id);\r\n\t\t}\r\n\r\n\t\tvar args;\r\n\t\tif (id){\r\n\t\t\targs = [id, item, \"paint\"];\r\n\t\t}else{\r\n\t\t\targs = [null,null,null];\r\n\t\t}\r\n\r\n\t\tif(this.callEvent(\"onBeforeStoreUpdate\", args) === false){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar skipFilter = this._quick_refresh && !this._mark_recompute;\r\n\t\tthis._mark_recompute = false;\r\n\t\tif(id){\r\n\t\t\t// if item changes visible order (e.g. expand-collapse branch) - do a complete repaint\r\n\t\t\tif(!quick && !skipFilter){\r\n\t\t\t\tvar oldOrder = this.visibleOrder;\r\n\t\t\t\tthis.filter();\r\n\t\t\t\tif(!this.arraysEqual(oldOrder, this.visibleOrder)){\r\n\t\t\t\t\tid = undefined;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}else if(!skipFilter){\r\n\t\t\tthis.filter();\r\n\t\t}\r\n\r\n\t\tif (id){\r\n\t\t\targs = [id, item, \"paint\"];\r\n\t\t}else{\r\n\t\t\targs = [null,null,null];\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onStoreUpdated\",args);\r\n\t},\r\n\r\n\tcount: function(){\r\n\t\treturn this.fullOrder.length;\r\n\t},\r\n\tcountVisible: function(){\r\n\t\treturn this.visibleOrder.length;\r\n\t},\r\n\r\n\tsort: function(sort){},\r\n\r\n\tserialize: function(){},\r\n\r\n\teachItem: function(code){\r\n\t\tfor (var i=0; i<this.fullOrder.length; i++) {\r\n\t\t\tvar item = this.getItem(this.fullOrder[i]);\r\n\t\t\tcode.call(this, item);\r\n\t\t}\r\n\t},\r\n\r\n\tfind: function(filter) {\r\n\t\tvar result = [];\r\n\t\tthis.eachItem(function(item) {\r\n\t\t\tif(filter(item)){\r\n\t\t\t\tresult.push(item);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t},\r\n\r\n\tfilter: function(rule){\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tthis.callEvent(\"onBeforeFilter\", []);\r\n\t\t}\r\n\t\tthis.callEvent(\"onPreFilter\", []);\r\n\t\tvar filteredOrder = powerArray.$create();\r\n\t\tvar placeholderIds = [];\r\n\t\tthis.eachItem(function(item){\r\n\t\t\tif(this.callEvent(\"onFilterItem\", [item.id, item])){\r\n\t\t\t\tif(isPlaceholderTask(item.id, null, this, this._ganttConfig)){\r\n\t\t\t\t\tplaceholderIds.push(item.id);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfilteredOrder.push(item.id);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfor(var i = 0; i < placeholderIds.length; i++){\r\n\t\t\tfilteredOrder.push(placeholderIds[i]);\r\n\t\t}\r\n\r\n\t\tthis.visibleOrder = filteredOrder;\r\n\t\tthis._searchVisibleOrder = {};\r\n\t\tfor(var i = 0; i < this.visibleOrder.length; i++){\r\n\t\t\tthis._searchVisibleOrder[this.visibleOrder[i]] = i;\r\n\t\t}\r\n\t\tif (!this.isSilent()) {\r\n\t\t\tthis.callEvent(\"onFilter\", []);\r\n\t\t}\r\n\t},\r\n\r\n\tgetIndexRange: function(from, to){\r\n\t\tvar max = Math.min((to||Infinity),this.countVisible()-1);\r\n\t\tvar min = from||0;\r\n\r\n\t\tvar cacheKey = min + '-' + max;\r\n\t\tif(this._indexRangeCache[cacheKey]){\r\n\t\t\treturn this._indexRangeCache[cacheKey].slice();\r\n\t\t}\r\n\r\n\t\tvar ret= [];\r\n\t\tfor (var i=min; i <= max; i++)\r\n\t\t\tret.push(this.getItem(this.visibleOrder[i]));\r\n\r\n\t\tthis._indexRangeCache[cacheKey] = ret.slice();\r\n\t\treturn ret;\r\n\t},\r\n\tgetItems: function(){\r\n\t\tif(this._getItemsCache){\r\n\t\t\treturn this._getItemsCache.slice();\r\n\t\t}\r\n\r\n\t\tvar res = [];\r\n\t\tfor(var i in this.pull){\r\n\t\t\tres.push(this.pull[i]);\r\n\t\t}\r\n\t\tthis._getItemsCache = res.slice();\r\n\r\n\t\treturn res;\r\n\t},\r\n\r\n\tgetIdByIndex: function(index){\r\n\t\treturn this.visibleOrder[index];\r\n\t},\r\n\tgetIndexById: function(id){\r\n\t\tvar res = this._searchVisibleOrder[id];\r\n\t\tif(res === undefined){\r\n\t\t\tres = -1;\r\n\t\t}\r\n\t\treturn res;\r\n\t},\r\n\t_getNullIfUndefined: function(value){\r\n\t\tif(value === undefined){\r\n\t\t\treturn null;\r\n\t\t}else{\r\n\t\t\treturn value;\r\n\t\t}\r\n\t},\r\n\tgetFirst: function(){\r\n\t\treturn this._getNullIfUndefined(this.visibleOrder[0]);\r\n\t},\r\n\tgetLast: function(){\r\n\t\treturn this._getNullIfUndefined(this.visibleOrder[this.visibleOrder.length-1]);\r\n\t},\r\n\tgetNext: function(id){\r\n\t\treturn this._getNullIfUndefined(this.visibleOrder[this.getIndexById(id) + 1]);\r\n\t},\r\n\tgetPrev: function(id){\r\n\t\treturn this._getNullIfUndefined(this.visibleOrder[this.getIndexById(id) - 1]);\r\n\t},\r\n\tdestructor: function(){\r\n\t\tthis.callEvent(\"onDestroy\", []);\r\n\t\tthis.detachAllEvents();\r\n\t\tthis.$destroyed = true;\r\n\t\tthis.pull = null;\r\n\t\tthis.$initItem = null;\r\n\t\tthis.visibleOrder = null;\r\n\t\tthis.fullOrder = null;\r\n\t\tthis._skip_refresh = null;\r\n\t\tthis._filterRule = null;\r\n\t\tthis._searchVisibleOrder = null;\r\n\t\tthis._indexRangeCache = {};\r\n\t}\r\n};\r\n\r\nexport default DataStore;","import powerArray from \"./power_array\";\r\nimport * as utils from \"../../utils/utils\";\r\nimport * as helpers from \"../../utils/helpers\";\r\nimport DataStore from \"./datastore\";\r\nimport isPlaceholderTask from \"../../utils/placeholder_task\";\r\nimport {replaceValidZeroId} from \"../../utils/helpers\";\r\n\r\nvar TreeDataStore = function(config){\r\n\tDataStore.apply(this, [config]);\r\n\tthis._branches = {};\r\n\r\n\tthis.pull = {};\r\n\t//GS-761 Update existing item instead of adding it to the new position\r\n\tthis.$initItem = function (item){\r\n\t\tvar loadedItem = item;\r\n\t\tif(config.initItem){\r\n\t\t\tloadedItem = config.initItem(loadedItem);\r\n\t\t}\r\n\t\tvar existingItem = this.getItem(item.id);\r\n\t\tif(existingItem && !isEqualIds(existingItem.parent,loadedItem.parent)){\r\n\t\t\tthis.move(loadedItem.id, loadedItem.$index || -1, loadedItem.parent || this._ganttConfig.root_id);\r\n\t\t}\r\n\t\treturn loadedItem;\r\n\t};\r\n\tthis.$parentProperty = config.parentProperty || \"parent\";\r\n\r\n\tif(typeof config.rootId !== \"function\"){\r\n\t\tthis.$getRootId = (function(val){\r\n\t\t\treturn function(){return val;};\r\n\t\t})(config.rootId || 0);\r\n\t}else{\r\n\t\tthis.$getRootId = config.rootId;\r\n\t}\r\n\r\n\t// TODO: replace with live reference to gantt config\r\n\tthis.$openInitially = config.openInitially;\r\n\r\n\tthis.visibleOrder = powerArray.$create();\r\n\tthis.fullOrder = powerArray.$create();\r\n\tthis._searchVisibleOrder = {};\r\n\tthis._indexRangeCache = {};\r\n\tthis._eachItemMainRangeCache = null;\r\n\tthis._getItemsCache = null;\r\n\tthis._skip_refresh = false;\r\n\r\n\tthis._ganttConfig = null;\r\n\tif(config.getConfig){\r\n\t\tthis._ganttConfig = config.getConfig();\r\n\t}\r\n\r\n\tvar splitParents = {};\r\n\tvar splitItems = {};\r\n\r\n\tvar taskOpenState = {};\r\n\tvar taskVisibility = {};\r\n\tvar haveSplitItems = false;\r\n\r\n\tthis._attachDataChange(function(){\r\n\t\tthis._indexRangeCache = {};\r\n\t\tthis._eachItemMainRangeCache = null;\r\n\t\tthis._getItemsCache = null;\r\n\t\treturn true;\r\n\t});\r\n\r\n\tthis.attachEvent(\"onPreFilter\", function(){\r\n\t\tthis._indexRangeCache = {};\r\n\t\tthis._eachItemMainRangeCache = null;\r\n\r\n\t\tsplitParents = {};\r\n\t\tsplitItems = {};\r\n\t\ttaskOpenState = {};\r\n\t\ttaskVisibility = {};\r\n\t\thaveSplitItems = false;\r\n\r\n\t\tthis.eachItem(function(item){\r\n\t\t\tvar parent = this.getParent(item.id);\r\n\t\t\tif(item.$open && taskOpenState[parent] !== false){\r\n\t\t\t\ttaskOpenState[item.id] = true;\r\n\t\t\t}else{\r\n\t\t\t\ttaskOpenState[item.id] = false;\r\n\t\t\t}\r\n\r\n\t\t\tif(this._isSplitItem(item)){\r\n\t\t\t\thaveSplitItems = true;\r\n\t\t\t\tsplitParents[item.id] = true;\r\n\t\t\t\tsplitItems[item.id] = true;\r\n\t\t\t}\r\n\r\n\r\n\t\t\tif(haveSplitItems && splitItems[parent]){\r\n\t\t\t\tsplitItems[item.id] = true;\r\n\t\t\t}\r\n\r\n\r\n\t\t\tif(taskOpenState[parent] || taskOpenState[parent] === undefined){\r\n\t\t\t\ttaskVisibility[item.id] = true;\r\n\t\t\t}else{\r\n\t\t\t\ttaskVisibility[item.id] = false;\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\tthis.attachEvent(\"onFilterItem\", function(id, item){\r\n\r\n\t\tvar canOpenSplitTasks = false;\r\n\t\tif(this._ganttConfig){\r\n\t\t\tvar canOpenSplitTasks = this._ganttConfig.open_split_tasks;\r\n\t\t}\r\n\r\n\t\tvar open = taskVisibility[item.id];\r\n\r\n\t\tif(haveSplitItems){\r\n\t\t\tif(open && splitItems[item.id] && !splitParents[item.id]){\r\n\t\t\t\topen = !!canOpenSplitTasks;\r\n\t\t\t}\r\n\r\n\t\t\tif(splitItems[item.id] && !splitParents[item.id]){\r\n\t\t\t\titem.$split_subtask = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\titem.$expanded_branch = !!taskVisibility[item.id];\r\n\r\n\t\treturn !!open;\r\n\t});\r\n\r\n\tthis.attachEvent(\"onFilter\", function(){\r\n\t\tsplitParents = {};\r\n\t\tsplitItems = {};\r\n\r\n\t\ttaskOpenState = {};\r\n\t\ttaskVisibility = {};\r\n\t});\r\n\r\n\treturn this;\r\n};\r\n\r\nTreeDataStore.prototype = utils.mixin({\r\n\r\n\t\t_buildTree: function(data){\r\n\t\t\tvar item = null;\r\n\t\t\tvar rootId = this.$getRootId();\r\n\t\t\tfor (var i = 0, len = data.length; i < len; i++){\r\n\t\t\t\titem = data[i];\r\n\t\t\t\tthis.setParent(item, replaceValidZeroId(this.getParent(item), rootId) || rootId);\r\n\t\t\t}\r\n\r\n\t\t\t// calculating $level for each item\r\n\t\t\tfor (var i = 0, len = data.length; i < len; i++){\r\n\t\t\t\titem = data[i];\r\n\t\t\t\tthis._add_branch(item);\r\n\t\t\t\titem.$level = this.calculateItemLevel(item);\r\n\t\t\t\titem.$local_index = this.getBranchIndex(item.id);\r\n\r\n\t\t\t\tif (!utils.defined(item.$open)) {\r\n\t\t\t\t\titem.$open = utils.defined(item.open) ? item.open : this.$openInitially();\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\tthis._updateOrder();\r\n\t\t},\r\n\t\t_isSplitItem: function(item){\r\n\t\t\treturn (item.render == \"split\" && this.hasChild(item.id));\r\n\t\t},\r\n\t\tparse: function(data){\r\n\t\t\tif (!this._skip_refresh) {\r\n\t\t\t\tthis.callEvent(\"onBeforeParse\", [data]);\r\n\t\t\t}\r\n\t\t\tvar loaded = this._parseInner(data);\r\n\t\t\tthis._buildTree(loaded);\r\n\t\t\tthis.filter();\r\n\t\t\tif (!this._skip_refresh) {\r\n\t\t\t\tthis.callEvent(\"onParse\", [loaded]);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_addItemInner: function(item, index){\r\n\r\n\t\t\tvar parent = this.getParent(item);\r\n\r\n\t\t\tif(!utils.defined(parent)){\r\n\t\t\t\tparent = this.$getRootId();\r\n\t\t\t\tthis.setParent(item, parent);\r\n\t\t\t}\r\n\r\n\t\t\tvar parentIndex = this.getIndexById(parent);\r\n\t\t\tvar targetIndex = parentIndex + Math.min(Math.max(index, 0), this.visibleOrder.length);\r\n\r\n\t\t\tif(targetIndex*1 !== targetIndex){\r\n\t\t\t\ttargetIndex = undefined;\r\n\t\t\t}\r\n\t\t\tDataStore.prototype._addItemInner.call(this, item, targetIndex);\r\n\t\t\tthis.setParent(item, parent);\r\n\r\n\t\t\tif(item.hasOwnProperty(\"$rendered_parent\")){\r\n\t\t\t\tthis._move_branch(item, item.$rendered_parent);\r\n\t\t\t}\r\n\t\t\tthis._add_branch(item, index);\r\n\t\t},\r\n\t\t_changeIdInner: function(oldId, newId){\r\n\t\t\tvar children = this.getChildren(oldId);\r\n\t\t\tvar visibleOrder = this._searchVisibleOrder[oldId];\r\n\r\n\t\t\tDataStore.prototype._changeIdInner.call(this, oldId, newId);\r\n\r\n\t\t\tvar parent = this.getParent(newId);\r\n\r\n\t\t\tthis._replace_branch_child(parent, oldId, newId);\r\n\r\n\t\t\tif(this._branches[oldId]){\r\n\t\t\t\tthis._branches[newId] = this._branches[oldId];\r\n\t\t\t}\r\n\t\t\tfor(var i = 0; i < children.length; i++){\r\n\t\t\t\tvar child = this.getItem(children[i]);\r\n\t\t\t\tchild[this.$parentProperty] = newId;\r\n\t\t\t\tchild.$rendered_parent = newId;\r\n\t\t\t}\r\n\r\n\t\t\tthis._searchVisibleOrder[newId] = visibleOrder;\r\n\t\t\tdelete this._branches[oldId];\r\n\t\t},\r\n\r\n\t\t_traverseBranches: function(code, parent){\r\n\t\t\tif (!utils.defined(parent)) {\r\n\t\t\t\tparent = this.$getRootId();\r\n\t\t\t}\r\n\t\t\tvar branch = this._branches[parent];\r\n\t\t\tif (branch) {\r\n\t\t\t\tfor (var i = 0; i < branch.length; i++) {\r\n\t\t\t\t\tvar itemId = branch[i];\r\n\t\t\t\t\tcode.call(this, itemId);\r\n\t\t\t\t\tif (this._branches[itemId])\r\n\t\t\t\t\t\tthis._traverseBranches(code, itemId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_updateOrder: function(code){\r\n\r\n\t\t\tthis.fullOrder = powerArray.$create();\r\n\t\t\tthis._traverseBranches(function(taskId){\r\n\t\t\t\tthis.fullOrder.push(taskId);\r\n\t\t\t});\r\n\r\n\t\t\tif(code)\r\n\t\t\t\tDataStore.prototype._updateOrder.call(this, code);\r\n\t\t},\r\n\r\n\t\t_removeItemInner: function(id){\r\n\r\n\t\t\tvar items = [];\r\n\t\t\tthis.eachItem(function(child){\r\n\t\t\t\titems.push(child);\r\n\t\t\t}, id);\r\n\r\n\t\t\titems.push(this.getItem(id));\r\n\r\n\t\t\tfor(var i = 0; i < items.length; i++){\r\n\r\n\t\t\t\tthis._move_branch(items[i], this.getParent(items[i]), null);\r\n\t\t\t\tDataStore.prototype._removeItemInner.call(this, items[i].id);\r\n\t\t\t\tthis._move_branch(items[i], this.getParent(items[i]), null);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tmove: function(sid, tindex, parent){\r\n\t\t\t//target id as 4th parameter\r\n\t\t\tvar id = arguments[3];\r\n\t\t\tvar config = this._ganttConfig || {};\r\n\t\t\tvar root_id = config.root_id || 0;\r\n\t\t\tid = replaceValidZeroId(id, root_id);\r\n\t\t\tif (id) {\r\n\t\t\t\tif (id === sid) return;\r\n\r\n\t\t\t\tparent = this.getParent(id);\r\n\t\t\t\ttindex = this.getBranchIndex(id);\r\n\t\t\t}\r\n\t\t\tif(isEqualIds(sid, parent)){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (!utils.defined(parent)) {\r\n\t\t\t\tparent = this.$getRootId();\r\n\t\t\t}\r\n\t\t\tvar source = this.getItem(sid);\r\n\t\t\tvar source_pid = this.getParent(source.id);\r\n\r\n\t\t\tvar tbranch = this.getChildren(parent);\r\n\r\n\t\t\tif (tindex == -1)\r\n\t\t\t\ttindex = tbranch.length + 1;\r\n\t\t\tif (isEqualIds(source_pid, parent)) {\r\n\t\t\t\tvar sindex = this.getBranchIndex(sid);\r\n\t\t\t\tif (sindex == tindex) return;\r\n\t\t\t}\r\n\r\n\t\t\tif(this.callEvent(\"onBeforeItemMove\", [sid, parent, tindex]) === false)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\tvar placeholderIds = [];\r\n\t\t\tfor(var i = 0; i < tbranch.length; i++){\r\n\t\t\t\tif (isPlaceholderTask(tbranch[i], null, this, this._ganttConfig)){\r\n\t\t\t\t\tplaceholderIds.push(tbranch[i]);\r\n\t\t\t\t\ttbranch.splice(i, 1);\r\n\t\t\t\t\ti--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._replace_branch_child(source_pid, sid);\r\n\t\t\ttbranch = this.getChildren(parent);\r\n\r\n\t\t\tvar tid = tbranch[tindex];\r\n\t\t\ttid = replaceValidZeroId(tid, root_id);\r\n\t\t\tif (!tid) //adding as last element\r\n\t\t\t\ttbranch.push(sid);\r\n\t\t\telse\r\n\t\t\t\ttbranch = tbranch.slice(0, tindex).concat([ sid ]).concat(tbranch.slice(tindex));\r\n\r\n\t\t\tif (placeholderIds.length){\r\n\t\t\t\ttbranch = tbranch.concat(placeholderIds);\r\n\t\t\t}\r\n\t\t\t// GS-2423 to return initial parent to the task before it will be moved\r\n\t\t\tif (!isEqualIds(source.$rendered_parent, source_pid) && !isEqualIds(source_pid, parent)){\r\n\t\t\t\tsource.$rendered_parent = source_pid;\r\n\t\t\t}\r\n\t\t\tthis.setParent(source, parent);\r\n\t\t\tthis._branches[parent] = tbranch;\r\n\r\n\t\t\tvar diff = this.calculateItemLevel(source) - source.$level;\r\n\t\t\tsource.$level += diff;\r\n\t\t\tthis.eachItem(function(item){\r\n\t\t\t\titem.$level += diff;\r\n\t\t\t}, source.id, this);\r\n\r\n\r\n\t\t\tthis._moveInner(this.getIndexById(sid), this.getIndexById(parent) + tindex);\r\n\r\n\t\t\tthis.callEvent(\"onAfterItemMove\", [sid, parent, tindex]);\r\n\t\t\tthis.refresh();\r\n\t\t},\r\n\r\n\t\tgetBranchIndex: function(id){\r\n\t\t\tvar branch = this.getChildren(this.getParent(id));\r\n\t\t\tlet index = branch.indexOf(id + \"\");\r\n\t\t\tif (index == -1){\r\n\t\t\t\tindex = branch.indexOf(+id);\r\n\t\t\t}\r\n\t\t\treturn index;\r\n\t\t},\r\n\t\thasChild: function(id){\r\n\t\t\tvar branch = this._branches[id];\r\n\t\t\treturn branch && branch.length;\r\n\t\t},\r\n\t\tgetChildren: function(id){\r\n\t\t\tvar branch = this._branches[id];\r\n\t\t\treturn branch ? branch : powerArray.$create();\r\n\t\t},\r\n\r\n\t\tisChildOf: function(childId, parentId){\r\n\t\t\tif (!this.exists(childId))\r\n\t\t\t\treturn false;\r\n\t\t\tif (parentId === this.$getRootId())\r\n\t\t\t\treturn true;\r\n\r\n\t\t\tif (!this.hasChild(parentId))\r\n\t\t\t\treturn false;\r\n\r\n\t\t\tvar item = this.getItem(childId);\r\n\t\t\tvar pid = this.getParent(childId);\r\n\r\n\t\t\tvar parent = this.getItem(parentId);\r\n\t\t\tif(parent.$level >= item.$level){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\twhile (item && this.exists(pid)) {\r\n\t\t\t\titem = this.getItem(pid);\r\n\r\n\t\t\t\tif (item && isEqualIds(item.id, parentId))\r\n\t\t\t\t\treturn true;\r\n\t\t\t\tpid = this.getParent(item);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\tgetSiblings: function(id){\r\n\t\t\tif(!this.exists(id)){\r\n\t\t\t\treturn powerArray.$create();\r\n\t\t\t}\r\n\t\t\tvar parent = this.getParent(id);\r\n\t\t\treturn this.getChildren(parent);\r\n\r\n\t\t},\r\n\t\tgetNextSibling: function(id){\r\n\t\t\tvar siblings = this.getSiblings(id);\r\n\t\t\tfor(var i= 0, len = siblings.length; i < len; i++){\r\n\t\t\t\tif(isEqualIds(siblings[i], id)){\r\n\t\t\t\t\tvar nextSibling = siblings[i+1];\r\n\t\t\t\t\tif (nextSibling === 0 && i > 0){\r\n\t\t\t\t\t\tnextSibling = \"0\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn nextSibling || null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\tgetPrevSibling: function(id){\r\n\t\t\tvar siblings = this.getSiblings(id);\r\n\t\t\tfor(var i= 0, len = siblings.length; i < len; i++){\r\n\t\t\t\tif(isEqualIds(siblings[i], id)){\r\n\t\t\t\t\tvar previousSibling = siblings[i-1];\r\n\t\t\t\t\tif (previousSibling === 0 && i > 0){\r\n\t\t\t\t\t\tpreviousSibling = \"0\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn previousSibling || null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\t\tgetParent: function(id){\r\n\t\t\tvar item = null;\r\n\t\t\tif(id.id !== undefined){\r\n\t\t\t\titem = id;\r\n\t\t\t}else{\r\n\t\t\t\titem = this.getItem(id);\r\n\t\t\t}\r\n\r\n\t\t\tvar parent;\r\n\t\t\tif(item){\r\n\t\t\t\tparent = item[this.$parentProperty];\r\n\t\t\t}else{\r\n\t\t\t\tparent = this.$getRootId();\r\n\t\t\t}\r\n\t\t\treturn parent;\r\n\r\n\t\t},\r\n\r\n\t\tclearAll: function(){\r\n\t\t\tthis._branches = {};\r\n\t\t\tDataStore.prototype.clearAll.call(this);\r\n\t\t},\r\n\r\n\t\tcalculateItemLevel: function(item){\r\n\t\t\tvar level = 0;\r\n\t\t\tthis.eachParent(function(){\r\n\t\t\t\tlevel++;\r\n\t\t\t}, item);\r\n\t\t\treturn level;\r\n\t\t},\r\n\r\n\t\t_setParentInner: function(item, new_pid, silent){\r\n\t\t\tif(!silent){\r\n\t\t\t\tif(item.hasOwnProperty(\"$rendered_parent\")){\r\n\t\t\t\t\tthis._move_branch(item, item.$rendered_parent, new_pid);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis._move_branch(item, item[this.$parentProperty], new_pid);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetParent: function(item, new_pid, silent){\r\n\t\t\tthis._setParentInner(item, new_pid, silent);\r\n\r\n\t\t\titem[this.$parentProperty] = new_pid;\r\n\t\t},\r\n\r\n\t\t_eachItemCached: function(code, cache){\r\n\t\t\tfor(var i = 0, len = cache.length; i < len; i++){\r\n\t\t\t\tcode.call(this, cache[i]);\r\n\t\t\t}\r\n\t\t},\r\n\t\t_eachItemIterate: function(code, startId, cache){\r\n\t\t\tvar itemsStack = this.getChildren(startId);\r\n\t\t\tif(itemsStack.length){\r\n\t\t\t\titemsStack = itemsStack.slice().reverse();\r\n\t\t\t}\r\n\t\t\twhile(itemsStack.length){\r\n\t\t\t\tvar itemId = itemsStack.pop();\r\n\t\t\t\tvar item = this.getItem(itemId);\r\n\t\t\t\tcode.call(this, item);\r\n\t\t\t\tif(cache){\r\n\t\t\t\t\tcache.push(item);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(this.hasChild(item.id)){\r\n\t\t\t\t\tvar children = this.getChildren(item.id);\r\n\t\t\t\t\tvar len = children.length;\r\n\t\t\t\t\tfor(var i = len - 1; i >= 0; i--){\r\n\t\t\t\t\t\titemsStack.push(children[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\teachItem: function(code, parent){\r\n\t\t\tvar rootId = this.$getRootId();\r\n\t\t\tif (!utils.defined(parent)) {\r\n\t\t\t\tparent = rootId;\r\n\t\t\t}\r\n\t\t\tvar startId = replaceValidZeroId(parent, rootId) || rootId;\r\n\r\n\t\t\tvar useCache = false;\r\n\t\t\tvar buildCache = false;\r\n\t\t\tvar cache = null;\r\n\t\t\tif(startId === rootId){\r\n\t\t\t\tif(this._eachItemMainRangeCache){\r\n\t\t\t\t\tuseCache = true;\r\n\t\t\t\t\tcache = this._eachItemMainRangeCache;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tbuildCache = true;\r\n\t\t\t\t\tcache = this._eachItemMainRangeCache = [];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(useCache){\r\n\t\t\t\tthis._eachItemCached(code, cache);\r\n\t\t\t}else{\r\n\t\t\t\tthis._eachItemIterate(code, startId, buildCache ? cache : null);\r\n\t\t\t}\r\n\t\t},\r\n\t\teachParent: function(code, startItem) {\r\n\t\t\tvar parentsHash = {};\r\n\t\t\tvar item = startItem;\r\n\t\t\tvar parent = this.getParent(item);\r\n\r\n\t\t\twhile (this.exists(parent)) {\r\n\t\t\t\tif (parentsHash[parent]) {\r\n\t\t\t\t\tthrow new Error(\"Invalid tasks tree. Cyclic reference has been detected on task \" + parent);\r\n\t\t\t\t}\r\n\t\t\t\tparentsHash[parent] = true;\r\n\t\t\t\titem = this.getItem(parent);\r\n\t\t\t\tcode.call(this, item);\r\n\t\t\t\tparent = this.getParent(item);\r\n\t\t\t}\r\n\t\t},\r\n\t\t_add_branch: function(item, index, parent){\r\n\t\t\tvar pid = parent === undefined ? this.getParent(item) : parent;\r\n\t\t\tif (!this.hasChild(pid))\r\n\t\t\t\tthis._branches[pid] = powerArray.$create();\r\n\t\t\tvar branch = this.getChildren(pid);\r\n\t\t\tvar added_already = branch.indexOf(item.id + \"\") > -1 || branch.indexOf(+item.id) > -1;\r\n\t\t\tif(!added_already){\r\n\t\t\t\tif(index*1 == index){\r\n\r\n\t\t\t\t\tbranch.splice(index, 0, item.id);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tbranch.push(item.id);\r\n\t\t\t\t}\r\n\r\n\t\t\t\titem.$rendered_parent = pid;\r\n\t\t\t}\r\n\t\t},\r\n\t\t_move_branch: function(item, old_parent, new_parent){\r\n\t\t\tthis._eachItemMainRangeCache = null;\r\n\t\t\t//this.setParent(item, new_parent);\r\n\t\t\t//this._sync_parent(task);\r\n\t\t\tthis._replace_branch_child(old_parent, item.id);\r\n\t\t\tif(this.exists(new_parent) || isEqualIds(new_parent, this.$getRootId())){\r\n\r\n\t\t\t\tthis._add_branch(item, undefined, new_parent);\r\n\t\t\t}else{\r\n\t\t\t\tdelete this._branches[item.id];\r\n\t\t\t}\r\n\t\t\titem.$level =  this.calculateItemLevel(item);\r\n\t\t\tthis.eachItem(function(child){\r\n\t\t\t\tchild.$level = this.calculateItemLevel(child);\r\n\t\t\t}, item.id);\r\n\t\t},\r\n\r\n\t\t_replace_branch_child: function(node, old_id, new_id){\r\n\t\t\tvar branch = this.getChildren(node);\r\n\t\t\tif (branch && node !== undefined){\r\n\t\t\t\tvar newbranch = powerArray.$create();\r\n\r\n\t\t\t\tlet index = branch.indexOf(old_id + \"\");\r\n\t\t\t\tif (index == -1 && !isNaN(+old_id)){\r\n\t\t\t\t\tindex = branch.indexOf(+old_id);\r\n\t\t\t\t} \r\n\r\n\t\t\t\tif (index > -1){\r\n\t\t\t\t\tif (new_id){\r\n\t\t\t\t\t\tbranch.splice(index, 1, new_id);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbranch.splice(index, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tnewbranch = branch;\r\n\r\n\t\t\t\tthis._branches[node] = newbranch;\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\tsort: function(field, desc, parent){\r\n\t\t\tif (!this.exists(parent)) {\r\n\t\t\t\tparent = this.$getRootId();\r\n\t\t\t}\r\n\r\n\t\t\tif (!field) field = \"order\";\r\n\t\t\tvar criteria = (typeof(field) == \"string\") ? (function(a, b) {\r\n\t\t\t\tif (a[field] == b[field] ||\r\n\t\t\t\t\t(helpers.isDate(a[field]) && helpers.isDate(b[field]) && a[field].valueOf() == b[field].valueOf()))\r\n\t\t\t\t{\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar result = a[field] > b[field];\r\n\t\t\t\treturn result ? 1 : -1;\r\n\t\t\t}) : field;\r\n\r\n\t\t\tif (desc) {\r\n\t\t\t\tvar original_criteria = criteria;\r\n\t\t\t\tcriteria = function (a, b) {\r\n\t\t\t\t\treturn original_criteria(b, a);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tvar els = this.getChildren(parent);\r\n\r\n\t\t\tif (els){\r\n\t\t\t\tvar temp = [];\r\n\t\t\t\tfor (var i = els.length - 1; i >= 0; i--)\r\n\t\t\t\t\ttemp[i] = this.getItem(els[i]);\r\n\r\n\t\t\t\ttemp.sort(criteria);\r\n\r\n\t\t\t\tfor (var i = 0; i < temp.length; i++) {\r\n\t\t\t\t\tels[i] = temp[i].id;\r\n\t\t\t\t\tthis.sort(field, desc, els[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tfilter: function(rule){\r\n\t\t\tfor(let i in this.pull){\r\n\t\t\t\tconst renderedParent = this.pull[i].$rendered_parent;\r\n\t\t\t\tconst actualParent = this.getParent(this.pull[i]);\r\n\t\t\t\t//GS-2339: could be different types of the ids\r\n\t\t\t\tif(!isEqualIds(renderedParent,actualParent)){\r\n\t\t\t\t\tthis._move_branch(this.pull[i], renderedParent, actualParent);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn DataStore.prototype.filter.apply(this, arguments);\r\n\t\t},\r\n\r\n\t\topen: function(id){\r\n\t\t\tif(this.exists(id)){\r\n\t\t\t\tthis.getItem(id).$open = true;\r\n\t\t\t\t// GS-2170. Do not recalculate the indexes and dates as they will be recalculated later\r\n\t\t\t\tthis._skipTaskRecalculation = true;\r\n\t\t\t\tthis.callEvent(\"onItemOpen\", [id]);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tclose: function(id){\r\n\t\t\tif(this.exists(id)){\r\n\t\t\t\tthis.getItem(id).$open = false;\r\n\t\t\t\t// GS-2170. Do not recalculate the indexes and dates as they will be recalculated later\r\n\t\t\t\tthis._skipTaskRecalculation = true;\r\n\t\t\t\tthis.callEvent(\"onItemClose\", [id]);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdestructor: function(){\r\n\t\t\tDataStore.prototype.destructor.call(this);\r\n\t\t\tthis._branches = null;\r\n\t\t\tthis._indexRangeCache = {};\r\n\t\t\tthis._eachItemMainRangeCache = null;\r\n\t\t}\r\n\t},\r\n\tDataStore.prototype\r\n);\r\n\r\nfunction isEqualIds(first, second){\r\n\treturn String(first) === String(second);\r\n};\r\n\r\nexport default TreeDataStore;","function createDataStoreSelectMixin(store){\r\n\tvar selectedId = null;\r\n\r\n\tvar deleteItem = store._removeItemInner;\r\n\t\r\n\tfunction unselect(id){\r\n\t\tselectedId = null;\r\n\t\tthis.callEvent(\"onAfterUnselect\", [id]);\r\n\t}\r\n\r\n\tstore._removeItemInner = function(id){\r\n\t\tif(selectedId == id){\r\n\t\t\tunselect.call(this, id);\r\n\t\t}\r\n\r\n\t\tif(selectedId && this.eachItem){\r\n\t\t\tthis.eachItem(function(subItem){\r\n\t\t\t\tif(subItem.id == selectedId){\r\n\t\t\t\t\tunselect.call(this, subItem.id);\r\n\t\t\t\t}\r\n\t\t\t}, id);\r\n\t\t}\r\n\r\n\t\treturn deleteItem.apply(this, arguments);\r\n\t};\r\n\r\n\tstore.attachEvent(\"onIdChange\", function(oldId, newId) {\r\n\t\tif (store.getSelectedId() == oldId) {\r\n\t\t\tstore.silent(function () {\r\n\t\t\t\tstore.unselect(oldId);\r\n\t\t\t\tstore.select(newId);\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\treturn {\r\n\t\tselect: function(id){\r\n\t\t\tif (id){\r\n\r\n\t\t\t\tif(selectedId == id)\r\n\t\t\t\t\treturn selectedId;\r\n\r\n\t\t\t\tif(!this._skip_refresh) {\r\n\t\t\t\t\tif (!this.callEvent(\"onBeforeSelect\", [id])) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.unselect();\r\n\r\n\t\t\t\tselectedId = id;\r\n\r\n\t\t\t\tif(!this._skip_refresh) {\r\n\t\t\t\t\tthis.refresh(id);\r\n\t\t\t\t\tthis.callEvent(\"onAfterSelect\", [id]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn selectedId;\r\n\t\t},\r\n\t\tgetSelectedId: function(){\r\n\t\t\treturn selectedId;\r\n\t\t},\r\n\t\tisSelected: function(id){\r\n\t\t\treturn id == selectedId;\r\n\t\t},\r\n\t\tunselect: function(id){\r\n\t\t\tvar id = id || selectedId;\r\n\t\t\tif(!id)\r\n\t\t\t\treturn;\r\n\t\t\tselectedId = null;\r\n\t\t\tif(!this._skip_refresh){\r\n\t\t\t\tthis.refresh(id);\r\n\t\t\t\tunselect.call(this, id);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default createDataStoreSelectMixin;","import env from \"./env\";\r\n\r\nexport default function(gantt){\r\n\treturn env.isNode || !gantt.$root;\r\n};","import isHeadless from \"../../utils/is_headless\";\r\n\r\nconst storeRenderCreator = function(name, gantt){\r\n\r\n\tconst store = gantt.getDatastore(name);\r\n\r\n\tconst itemRepainter = {\r\n\t\trenderItem: function(id, renderer){\r\n\r\n\t\t\tconst renders = renderer.getLayers();\r\n\r\n\t\t\tconst item = store.getItem(id);\r\n\t\t\tif(item && store.isVisible(id)) {\r\n\t\t\t\tfor (let i = 0; i < renders.length; i++)\r\n\t\t\t\t\trenders[i].render_item(item);\r\n\t\t\t}\r\n\t\t},\r\n\t\trenderItems: function(renderer){\r\n\t\t\tconst renderers = renderer.getLayers();\r\n\t\t\tfor (let i = 0; i < renderers.length; i++) {\r\n\t\t\t\trenderers[i].clear();\r\n\t\t\t}\r\n\r\n\t\t\tlet allData = null;\r\n\r\n\t\t\tconst loadedRanges = {};\r\n\t\t\tfor (let i = 0; i < renderers.length; i++) {\r\n\t\t\t\tconst layer = renderers[i];\r\n\t\t\t\tlet layerData;\r\n\t\t\t\tif(layer.get_visible_range){\r\n\r\n\t\t\t\t\tvar range = layer.get_visible_range(store);\r\n\t\t\t\t\tif(range.start !== undefined && range.end !== undefined){\r\n\t\t\t\t\t\tvar key = range.start + \" - \" + range.end;\r\n\t\t\t\t\t\tif(loadedRanges[key]){\r\n\t\t\t\t\t\t\tlayerData = loadedRanges[key];\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tlayerData = store.getIndexRange(range.start, range.end);\r\n\t\t\t\t\t\t\tloadedRanges[key] = layerData;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else if(range.ids !== undefined){\r\n\t\t\t\t\t\tlayerData = range.ids.map(function(id){\r\n\t\t\t\t\t\t\treturn store.getItem(id);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tthrow new Error(\"Invalid range returned from 'getVisibleRange' of the layer\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif(!allData){\r\n\t\t\t\t\t\tallData = store.getVisibleItems();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlayerData = allData;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (layer.prepare_data) {\r\n\t\t\t\t\t// GS-1605. Highlight timeline cells below tasks and in an empty chart\r\n\t\t\t\t\tlayer.prepare_data(layerData);\r\n\t\t\t\t}\r\n\r\n\t\t\t\trenderers[i].render_items(layerData);\r\n\t\t\t}\r\n\t\t},\r\n\t\tupdateItems: function(layer) {\r\n\t\t\tif(layer.update_items){\r\n\t\t\t\tlet data = [];\r\n\t\t\t\tif(layer.get_visible_range){\r\n\r\n\t\t\t\t\tvar range = layer.get_visible_range(store);\r\n\t\t\t\t\tif(range.start !== undefined && range.end !== undefined){\r\n\t\t\t\t\t\tdata = store.getIndexRange(range.start, range.end);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(range.ids !== undefined){\r\n\t\t\t\t\t\tlet extraDataArr = range.ids.map(function(id){\r\n\t\t\t\t\t\t\treturn store.getItem(id);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t// GS-2502: range.ids might not exist in other datastores\r\n\t\t\t\t\t\tif(extraDataArr.length > 0){\r\n\t\t\t\t\t\t\textraDataArr = extraDataArr.filter(element => element !== undefined);\r\n\t\t\t\t\t\t\tdata = data.concat(extraDataArr);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif((range.start == undefined || range.end == undefined) && range.ids == undefined)  {\r\n\t\t\t\t\t\tthrow new Error(\"Invalid range returned from 'getVisibleRange' of the layer\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdata = store.getVisibleItems();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (layer.prepare_data) {\r\n\t\t\t\t\t// GS-1605. Highlight timeline cells below tasks and in an empty chart\r\n\t\t\t\t\tlayer.prepare_data(data, layer);\r\n\t\t\t\t}\r\n\t\t\t\tlayer.update_items(data);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tstore.attachEvent(\"onStoreUpdated\", function(id, item, action){\r\n\t\tif(isHeadless(gantt)){\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tconst renderer = gantt.$services.getService(\"layers\").getDataRender(name);\r\n\t\tif(renderer){\r\n\t\t\trenderer.onUpdateRequest = function(layer){\r\n\t\t\t\titemRepainter.updateItems(layer);\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n\r\n\tfunction skipRepaint(gantt){\r\n\t\tconst state = gantt.$services.getService(\"state\");\r\n\t\tif(state.getState(\"batchUpdate\").batch_update){\r\n\t\t\treturn true;\r\n\t\t}else{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tstore.attachEvent(\"onStoreUpdated\", function(id, item, action){\r\n\t\tif(skipRepaint(gantt)){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!id || action == \"move\" || action == \"delete\"){\r\n\t\t\tstore.callEvent(\"onBeforeRefreshAll\", []);\r\n\t\t\tstore.callEvent(\"onAfterRefreshAll\", []);\r\n\t\t}else{\r\n\t\t\tstore.callEvent(\"onBeforeRefreshItem\", [item.id]);\r\n\t\t\tstore.callEvent(\"onAfterRefreshItem\", [item.id]);\r\n\t\t}\r\n\t});\r\n\r\n\tstore.attachEvent(\"onAfterRefreshAll\", function(){\r\n\t\tif(isHeadless(gantt)){\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tconst renderer = gantt.$services.getService(\"layers\").getDataRender(name);\r\n\t\tif(renderer && !skipRepaint(gantt)){\r\n\t\t\titemRepainter.renderItems(renderer);\r\n\t\t}\r\n\t});\r\n\tstore.attachEvent(\"onAfterRefreshItem\", function(id){\r\n\t\tif(isHeadless(gantt)){\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tconst renderer = gantt.$services.getService(\"layers\").getDataRender(name);\r\n\t\tif(renderer){\r\n\t\t\titemRepainter.renderItem(id, renderer);\r\n\t\t}\r\n\t});\r\n\r\n\t// TODO: probably can be done more in a more efficient way\r\n\tstore.attachEvent(\"onItemOpen\", function(){\r\n\t\tif(isHeadless(gantt)){\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tgantt.render();\r\n\t});\r\n\r\n\tstore.attachEvent(\"onItemClose\", function(){\r\n\t\tif(isHeadless(gantt)){\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tgantt.render();\r\n\t});\r\n\r\n\tfunction refreshId(renders, oldId, newId, item) {\r\n\t\tfor (let i = 0; i < renders.length; i++) {\r\n\t\t\trenders[i].change_id(oldId, newId);\r\n\t\t}\r\n\t}\r\n\r\n\tstore.attachEvent(\"onIdChange\", function(oldId, newId){\r\n\t\tif(isHeadless(gantt)){\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// in case of linked datastores (tasks <-> links), id change should recalculate something in linked datastore before any repaint\r\n\t\t// use onBeforeIdChange for this hook.\r\n\t\t// TODO: use something more reasonable instead\r\n\t\tstore.callEvent(\"onBeforeIdChange\", [oldId, newId]);\r\n\r\n\t\tif(skipRepaint(gantt)){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!store.isSilent()){\r\n\t\t\tconst renderer = gantt.$services.getService(\"layers\").getDataRender(name);\r\n\t\t\tif(renderer){ // missing check for renderer GS-1814\r\n\t\t\t\trefreshId(renderer.getLayers(), oldId, newId, store.getItem(newId));\r\n\t\t\t\titemRepainter.renderItem(newId, renderer);\r\n\t\t\t}else{\r\n\t\t\t\t// GS-1814 repaint ui to apply new id when the datastore don't have own renderer\r\n\t\t\t\tgantt.render();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n};\r\n\r\nexport default {\r\n\tbindDataStore: storeRenderCreator\r\n};","import * as utils from \"../../utils/utils\";\r\nimport createTasksFacade from \"./datastore_tasks\";\r\nimport createLinksFacade from \"./datastore_links\";\r\nimport DataStore from \"../datastore/datastore\";\r\nimport TreeDataStore from \"../datastore/treedatastore\";\r\nimport createDatastoreSelect from \"../datastore/select\";\r\nimport datastoreRender from \"../datastore/datastore_render\";\r\nimport isHeadless from \"../../utils/is_headless\";\r\nimport {replaceValidZeroId} from \"../../utils/helpers\";\r\n\r\nfunction getDatastores(){\r\n\tvar storeNames = this.$services.getService(\"datastores\");\r\n\tvar res = [];\r\n\tfor(var i = 0; i < storeNames.length; i++){\r\n\t\tvar store = this.getDatastore(storeNames[i]);\r\n\t\tif(!store.$destroyed){\r\n\t\t\tres.push(store);\r\n\t\t}\r\n\t}\r\n\treturn res;\r\n}\r\n\r\nvar createDatastoreFacade = function(){\r\n\treturn {\r\n\tcreateDatastore: function(config){\r\n\r\n\t\tvar $StoreType = (config.type || \"\").toLowerCase() == \"treedatastore\" ? TreeDataStore : DataStore;\r\n\r\n\t\tif (config) {\r\n\t\t\tvar self = this;\r\n\t\t\tconfig.openInitially = function(){ return self.config.open_tree_initially; };\r\n\t\t\tconfig.copyOnParse = function(){ return self.config.deepcopy_on_parse; };\r\n\t\t}\r\n\r\n\t\tvar store = new $StoreType(config);\r\n\t\tthis.mixin(store, createDatastoreSelect(store));\r\n\r\n\t\tif (config.name) {\r\n\t\t\tvar servicePrefix = \"datastore:\";\r\n\t\t\tvar storeAccessName = servicePrefix + config.name;\r\n\r\n\t\t\tstore.attachEvent(\"onDestroy\", function(){\r\n\t\t\t\tthis.$services.dropService(storeAccessName);\r\n\t\t\t\tvar storeList = this.$services.getService(\"datastores\");\r\n\t\t\t\tfor(var i = 0; i < storeList.length; i++){\r\n\t\t\t\t\tif(storeList[i] === config.name){\r\n\t\t\t\t\t\tstoreList.splice(i, 1);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}.bind(this));\r\n\r\n\t\t\tthis.$services.dropService(storeAccessName);\r\n\t\t\tthis.$services.setService(storeAccessName, function() { return store; } );\r\n\r\n\t\t\tvar storeList = this.$services.getService(\"datastores\");\r\n\t\t\tif (!storeList) {\r\n\t\t\t\tstoreList = [];\r\n\t\t\t\tthis.$services.setService(\"datastores\", function() { return storeList; });\r\n\t\t\t\tstoreList.push(config.name);\r\n\t\t\t} else if (storeList.indexOf(config.name) < 0) {\r\n\t\t\t\tstoreList.push(config.name);\r\n\t\t\t}\r\n\r\n\t\t\tdatastoreRender.bindDataStore(config.name, this);\r\n\r\n\t\t}\r\n\r\n\t\treturn store;\r\n\t},\r\n\tgetDatastore: function(name){\r\n\t\treturn this.$services.getService(\"datastore:\" + name);\r\n\t},\r\n\t_getDatastores: getDatastores,\r\n\r\n\trefreshData: function () {\r\n\t\tvar scrollState;\r\n\t\tif(!isHeadless(this)){\r\n\t\t\tscrollState = this.getScrollState();\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onBeforeDataRender\", []);\r\n\r\n\t\tvar stores = getDatastores.call(this);\r\n\t\tfor(var i = 0; i < stores.length; i++){\r\n\t\t\tstores[i].refresh();\r\n\t\t}\r\n\r\n\t\tif(this.config.preserve_scroll && !isHeadless(this) && (scrollState.x || scrollState.y)){\r\n\t\t\tthis.scrollTo(scrollState.x, scrollState.y);\r\n\t\t}\r\n\t\tthis.callEvent(\"onDataRender\", []);\r\n\r\n\t},\r\n\r\n\tisChildOf: function(childId, parentId){\r\n\t\treturn this.$data.tasksStore.isChildOf(childId, parentId);\r\n\t},\r\n\r\n\trefreshTask: function (taskId, refresh_links) {\r\n\t\tvar task = this.getTask(taskId);\r\n\t\tvar self = this;\r\n\t\tfunction refreshLinks(){\r\n\t\t\tif (refresh_links !== undefined && !refresh_links)\r\n\t\t\t\treturn;\r\n\t\t\tfor (var i = 0; i < task.$source.length; i++) {\r\n\t\t\t\tself.refreshLink(task.$source[i]);\r\n\t\t\t}\r\n\t\t\tfor (var i = 0; i < task.$target.length; i++) {\r\n\t\t\t\tself.refreshLink(task.$target[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (task && this.isTaskVisible(taskId)) {\r\n\t\t\tthis.$data.tasksStore.refresh(taskId, !!this.getState(\"tasksDnd\").drag_id || refresh_links === false);// do quick refresh during drag and drop\r\n\t\t\trefreshLinks();\r\n\t\t}else if(this.isTaskExists(taskId) && this.isTaskExists(this.getParent(taskId)) && !this._bulk_dnd){\r\n\t\t\tthis.refreshTask(this.getParent(taskId));\r\n\r\n\t\t\tvar hasSplitParent = false;\r\n\t\t\tthis.eachParent(function(parent){\r\n\t\t\t\tif(hasSplitParent || this.isSplitTask(parent)){\r\n\t\t\t\t\thasSplitParent = true;\r\n\t\t\t\t}\r\n\t\t\t}, taskId);\r\n\t\t\tif(hasSplitParent){\r\n\t\t\t\trefreshLinks();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t},\r\n\trefreshLink: function (linkId) {\r\n\t\tthis.$data.linksStore.refresh(linkId, !!this.getState(\"tasksDnd\").drag_id);// do quick refresh during drag and drop\r\n\t},\r\n\r\n\tsilent: function(code){\r\n\t\tvar gantt = this;\r\n\t\tgantt.$data.tasksStore.silent(function(){\r\n\t\t\tgantt.$data.linksStore.silent(function(){\r\n\t\t\t\tcode();\r\n\t\t\t});\r\n\t\t});\r\n\t},\r\n\r\n\tclearAll: function () {\r\n\t\tvar stores = getDatastores.call(this);\r\n\t\t\r\n\t\t// clear all stores without invoking clearAll event\r\n\t\t// in order to prevent calling handlers when only some stores are cleared\r\n\t\tfor(var i = 0; i < stores.length; i++){\r\n\t\t\tstores[i].silent(function(){\r\n\t\t\t\tstores[i].clearAll();\t\r\n\t\t\t});\r\n\t\t}\r\n\t\t// run clearAll again to invoke events\r\n\t\tfor(var i = 0; i < stores.length; i++){\r\n\t\t\tstores[i].clearAll();\t\r\n\t\t}\r\n\r\n\t\tthis._update_flags();\r\n\t\tthis.userdata = {};\r\n\t\tthis.callEvent(\"onClear\", []);\r\n\t\tthis.render();\r\n\t},\r\n\t_clear_data: function () {\r\n\t\tthis.$data.tasksStore.clearAll();\r\n\t\tthis.$data.linksStore.clearAll();\r\n\t\tthis._update_flags();\r\n\t\tthis.userdata = {};\r\n\t},\r\n\r\n\tselectTask: function(id){\r\n\t\tvar store = this.$data.tasksStore;\r\n\t\tif(!this.config.select_task)\r\n\t\t\treturn false;\r\n\t\tid = replaceValidZeroId(id, this.config.root_id);\r\n\t\tif (id){\r\n\t\t\tlet oldSelectId = this.getSelectedId();\r\n\t\t\t// Don't repaint the resource panel as the data didn't change\r\n\t\t\tstore._skipResourceRepaint = true;\r\n\t\t\tstore.select(id);\r\n\t\t\tstore._skipResourceRepaint = false;\r\n\t\t\t// GS-730. Split task is not included in the tree, \r\n\t\t\t// so the datastore renderer will think that the task is not visible\r\n\t\t\tif (oldSelectId && store.pull[oldSelectId].$split_subtask && oldSelectId != id) {\r\n\t\t\t\tthis.refreshTask(oldSelectId);\r\n\t\t\t}\r\n\t\t\tif (store.pull[id].$split_subtask && oldSelectId != id) {// GS-1850. Do not repaint split task after double click\r\n\t\t\t\tthis.refreshTask(id);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn store.getSelectedId();\r\n\t},\r\n\tunselectTask: function(id){\r\n\t\tvar store = this.$data.tasksStore;\r\n\t\tstore.unselect(id);\r\n\t\t// GS-730. Split task is not included in the tree, \r\n\t\t// so the datastore renderer will think that the task is not visible\r\n\t\tif (id && store.pull[id].$split_subtask) {\r\n\t\t\tthis.refreshTask(id);\r\n\t\t}\r\n\t},\r\n\tisSelectedTask: function(id){\r\n\t\treturn this.$data.tasksStore.isSelected(id);\r\n\t},\r\n\tgetSelectedId: function() {\r\n\t\treturn this.$data.tasksStore.getSelectedId();\r\n\t}\r\n};\r\n};\r\n\r\nfunction createFacade(){\r\n\tvar res = utils.mixin({}, createDatastoreFacade());\r\n\tutils.mixin(res, createTasksFacade());\r\n\tutils.mixin(res, createLinksFacade());\r\n\treturn res;\r\n}\r\n\r\n\r\n\r\n\r\nexport default {create: createFacade};","import * as utils from \"../../../utils/utils\";\r\n\r\nfunction ScaleHelper(gantt){\r\n\tvar dateHelper = gantt.date;\r\n\tvar services = gantt.$services;\r\n\r\n\treturn {\r\n\t\tgetSum: function (sizes, from, to) {\r\n\t\t\tif (to === undefined)\r\n\t\t\t\tto = sizes.length - 1;\r\n\t\t\tif (from === undefined)\r\n\t\t\t\tfrom = 0;\r\n\r\n\t\t\tvar summ = 0;\r\n\t\t\tfor (var i = from; i <= to; i++)\r\n\t\t\t\tsumm += sizes[i];\r\n\r\n\t\t\treturn summ;\r\n\t\t},\r\n\t\tsetSumWidth: function (sum_width, scale, from, to) {\r\n\t\t\tvar parts = scale.width;\r\n\r\n\t\t\tif (to === undefined)\r\n\t\t\t\tto = parts.length - 1;\r\n\t\t\tif (from === undefined)\r\n\t\t\t\tfrom = 0;\r\n\t\t\tvar length = to - from + 1;\r\n\r\n\t\t\tif (from > parts.length - 1 || length <= 0 || to > parts.length - 1)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tvar oldWidth = this.getSum(parts, from, to);\r\n\r\n\t\t\tvar diff = sum_width - oldWidth;\r\n\r\n\t\t\tthis.adjustSize(diff, parts, from, to);\r\n\t\t\tthis.adjustSize(-diff, parts, to + 1);\r\n\r\n\t\t\tscale.full_width = this.getSum(parts);\r\n\t\t},\r\n\t\tsplitSize: function (width, count) {\r\n\t\t\tvar arr = [];\r\n\t\t\tfor (var i = 0; i < count; i++) arr[i] = 0;\r\n\r\n\t\t\tthis.adjustSize(width, arr);\r\n\t\t\treturn arr;\r\n\r\n\t\t},\r\n\t\tadjustSize: function (width, parts, from, to) {\r\n\t\t\tif (!from)\r\n\t\t\t\tfrom = 0;\r\n\t\t\tif (to === undefined)\r\n\t\t\t\tto = parts.length - 1;\r\n\r\n\t\t\tvar length = to - from + 1;\r\n\r\n\t\t\tvar full = this.getSum(parts, from, to);\r\n\r\n\t\t\tfor (var i = from; i <= to; i++) {\r\n\t\t\t\tvar share = Math.floor(width * (full ? (parts[i] / full) : (1 / length)));\r\n\r\n\t\t\t\tfull -= parts[i];\r\n\t\t\t\twidth -= share;\r\n\t\t\t\tlength--;\r\n\r\n\t\t\t\tparts[i] += share;\r\n\t\t\t}\r\n\t\t\tparts[parts.length - 1] += width;\r\n\t\t},\r\n\t\tsortScales: function (scales) {\r\n\t\t\tfunction cellSize(unit, step) {\r\n\t\t\t\tvar d = new Date(1970, 0, 1);\r\n\t\t\t\treturn dateHelper.add(d, step, unit) - d;\r\n\t\t\t}\r\n\r\n\t\t\tscales.sort(function (a, b) {\r\n\t\t\t\tif (cellSize(a.unit, a.step) < cellSize(b.unit, b.step)) {\r\n\t\t\t\t\treturn 1;\r\n\t\t\t\t} else if (cellSize(a.unit, a.step) > cellSize(b.unit, b.step)) {\r\n\t\t\t\t\treturn -1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tfor (var i = 0; i < scales.length; i++) {\r\n\t\t\t\tscales[i].index = i;\r\n\t\t\t}\r\n\t\t},\r\n\t\t_isLegacyMode: function(config){\r\n\t\t\tvar scaleConfig = config || gantt.config;\r\n\t\t\treturn scaleConfig.scale_unit || scaleConfig.date_scale || scaleConfig.subscales;\r\n\t\t},\r\n\t\t_prepareScaleObject: function(scale){\r\n\t\t\tvar format = scale.format;\r\n\t\t\tif(!format){\r\n\t\t\t\tformat = scale.template || scale.date || \"%d %M\";\r\n\t\t\t}\r\n\r\n\t\t\tif(typeof format === \"string\"){\r\n\t\t\t\tformat = gantt.date.date_to_str(format);\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\tunit: scale.unit || \"day\",\r\n\t\t\t\tstep: scale.step || 1,\r\n\t\t\t\tformat: format,\r\n\t\t\t\tcss: scale.css\r\n\t\t\t};\r\n\t\t},\r\n\t\tprimaryScale: function(config) {\r\n\t\t\tvar templates = services.getService(\"templateLoader\");\r\n\t\t\tvar legacyMode = this._isLegacyMode(config);\r\n\r\n\t\t\tvar scaleConfig = config || gantt.config;\r\n\r\n\t\t\tvar result;\r\n\t\t\tif(legacyMode){\r\n\t\t\t\ttemplates.initTemplate(\"date_scale\", undefined, undefined, scaleConfig, gantt.config.templates);\r\n\t\t\t\tresult = {\r\n\t\t\t\t\tunit: gantt.config.scale_unit,\r\n\t\t\t\t\tstep: gantt.config.step,\r\n\t\t\t\t\ttemplate: gantt.templates.date_scale,\r\n\t\t\t\t\tdate: gantt.config.date_scale,\r\n\t\t\t\t\tcss: gantt.templates.scale_cell_class\r\n\t\t\t\t};\r\n\t\t\t}else{\r\n\t\t\t\tvar primaryScale = scaleConfig.scales[0];\r\n\t\t\t\tresult = {\r\n\t\t\t\t\tunit: primaryScale.unit,\r\n\t\t\t\t\tstep: primaryScale.step,\r\n\t\t\t\t\ttemplate: primaryScale.template,\r\n\t\t\t\t\tformat: primaryScale.format,\r\n\t\t\t\t\tdate: primaryScale.date,\r\n\t\t\t\t\tcss: primaryScale.css || gantt.templates.scale_cell_class\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\treturn this._prepareScaleObject(result);\r\n\t\t},\r\n\t\tgetSubScales: function(config) {\r\n\t\t\tvar legacyMode = this._isLegacyMode(config);\r\n\t\t\tvar scaleConfig = config || gantt.config;\r\n\t\t\tvar scales;\r\n\t\t\tif(legacyMode){\r\n\t\t\t\tlet docLink = \"https://docs.dhtmlx.com/gantt/migrating.html#:~:text=%3D%20false%3B-,Time%20scale%20settings,-Configuration%20of%20time\";\r\n\t\t\t\tif (gantt.env.isFF){\r\n\t\t\t\t\tdocLink = \"https://docs.dhtmlx.com/gantt/migrating.html#6162\";\r\n\t\t\t\t}\r\n\t\t\t\t// eslint-disable-next-line no-console\r\n\t\t\t\tconsole.warn(`You are using the obsolete scale configuration.\r\nIt will stop working in the future versions.\r\nPlease migrate the configuration to the newer version:\r\n${docLink}`);\r\n\t\t\t\tscales = scaleConfig.subscales || [];\r\n\t\t\t}else{\r\n\t\t\t\tscales = scaleConfig.scales.slice(1);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn scales.map(function(scale){\r\n\t\t\t\treturn this._prepareScaleObject(scale);\r\n\t\t\t}.bind(this));\r\n\t\t},\r\n\r\n\t\tprepareConfigs: function (scales, min_coll_width, container_width, scale_height, minDate, maxDate, rtl) {\r\n\t\t\tvar heights = this.splitSize(scale_height, scales.length);\r\n\t\t\tvar full_width = container_width;\r\n\r\n\t\t\tvar configs = [];\r\n\t\t\tfor (var i = scales.length - 1; i >= 0; i--) {\r\n\t\t\t\tvar main_scale = (i == scales.length - 1);\r\n\t\t\t\tvar cfg = this.initScaleConfig(scales[i], minDate, maxDate);\r\n\t\t\t\tif (main_scale) {\r\n\t\t\t\t\tthis.processIgnores(cfg);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.initColSizes(cfg, min_coll_width, full_width, heights[i]);\r\n\t\t\t\tthis.limitVisibleRange(cfg);\r\n\r\n\t\t\t\tif (main_scale) {\r\n\t\t\t\t\tfull_width = cfg.full_width;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconfigs.unshift(cfg);\r\n\t\t\t}\r\n\r\n\r\n\t\t\tfor (var i = 0; i < configs.length - 1; i++) {\r\n\t\t\t\tthis.alineScaleColumns(configs[configs.length - 1], configs[i]);\r\n\t\t\t}\r\n\t\t\tfor (var i = 0; i < configs.length; i++) {\r\n\r\n\t\t\t\tif(rtl){\r\n\t\t\t\t\tthis.reverseScale(configs[i]);\r\n\t\t\t\t}\r\n\t\t\t\tthis.setPosSettings(configs[i]);\r\n\t\t\t}\r\n\t\t\treturn configs;\r\n\r\n\t\t},\r\n\r\n\t\treverseScale: function(scale){\r\n\t\t\tscale.width = scale.width.reverse();\r\n\t\t\tscale.trace_x = scale.trace_x.reverse();\r\n\r\n\t\t\tvar indexes = scale.trace_indexes;\r\n\t\t\tscale.trace_indexes = {};\r\n\t\t\tscale.trace_index_transition = {};\r\n\t\t\tscale.rtl = true;\r\n\t\t\tfor(var i = 0; i < scale.trace_x.length; i++){\r\n\t\t\t\tscale.trace_indexes[scale.trace_x[i].valueOf()] = i;\r\n\t\t\t\tscale.trace_index_transition[indexes[scale.trace_x[i].valueOf()]] = i;\r\n\t\t\t}\r\n\t\t\treturn scale;\r\n\t\t},\r\n\r\n\t\tsetPosSettings: function (config) {\r\n\t\t\tfor (var i = 0, len = config.trace_x.length; i < len; i++) {\r\n\t\t\t\tconfig.left.push((config.width[i - 1] || 0) + (config.left[i - 1] || 0));\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_ignore_time_config: function (date, scale) {\r\n\r\n\t\t\tif (gantt.config.skip_off_time) {\r\n\t\t\t\tvar skip = true;\r\n\t\t\t\tvar probe = date;\r\n\r\n\t\t\t\t// check dates in case custom scale unit, e.g. {unit: \"month\", step: 3}\r\n\t\t\t\tfor (var i = 0; i < scale.step; i++) {\r\n\t\t\t\t\tif (i) {\r\n\t\t\t\t\t\tprobe = dateHelper.add(date, i, scale.unit);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tskip = skip && !this.isWorkTime(probe, scale.unit);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn skip;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\t//defined in an extension\r\n\t\tprocessIgnores: function (config) {\r\n\t\t\tconfig.ignore_x = {};\r\n\t\t\tconfig.display_count = config.count;\r\n\t\t},\r\n\t\tinitColSizes: function (config, min_col_width, full_width, line_height) {\r\n\t\t\tvar cont_width = full_width;\r\n\r\n\t\t\tconfig.height = line_height;\r\n\r\n\t\t\tvar column_count = config.display_count === undefined ? config.count : config.display_count;\r\n\r\n\t\t\tif (!column_count)\r\n\t\t\t\tcolumn_count = 1;\r\n\r\n\t\t\tconfig.col_width = Math.floor(cont_width / column_count);\r\n\r\n\t\t\tif (min_col_width) {\r\n\t\t\t\tif (config.col_width < min_col_width) {\r\n\t\t\t\t\tconfig.col_width = min_col_width;\r\n\t\t\t\t\tcont_width = config.col_width * column_count;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconfig.width = [];\r\n\t\t\tvar ignores = config.ignore_x || {};\r\n\t\t\tfor (var i = 0; i < config.trace_x.length; i++) {\r\n\t\t\t\tif (ignores[config.trace_x[i].valueOf()] || (config.display_count == config.count)) {\r\n\t\t\t\t\tconfig.width[i] = 0;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// width of month columns should be proportional month duration\r\n\t\t\t\t\tvar width = 1;\r\n\t\t\t\t\tif (config.unit == \"month\") {\r\n\t\t\t\t\t\tvar days = Math.round((dateHelper.add(config.trace_x[i], config.step, config.unit) - config.trace_x[i]) / (1000 * 60 * 60 * 24));\r\n\t\t\t\t\t\twidth = days;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconfig.width[i] = width;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.adjustSize(cont_width - this.getSum(config.width)/* 1 width per column from the code above */, config.width);\r\n\t\t\tconfig.full_width = this.getSum(config.width);\r\n\t\t},\r\n\t\tinitScaleConfig: function (config, min_date, max_date) {\r\n\t\t\tvar cfg = utils.mixin({\r\n\t\t\t\tcount: 0,\r\n\t\t\t\tcol_width: 0,\r\n\t\t\t\tfull_width: 0,\r\n\t\t\t\theight: 0,\r\n\t\t\t\twidth: [],\r\n\t\t\t\tleft: [],\r\n\t\t\t\ttrace_x: [],\r\n\t\t\t\ttrace_indexes: {},\r\n\t\t\t\tmin_date: new Date(min_date),\r\n\t\t\t\tmax_date: new Date(max_date)\r\n\t\t\t}, config);\r\n\r\n\t\t\tthis.eachColumn(config.unit, config.step, min_date, max_date, function (date) {\r\n\t\t\t\tcfg.count++;\r\n\t\t\t\tcfg.trace_x.push(new Date(date));\r\n\t\t\t\tcfg.trace_indexes[date.valueOf()] = cfg.trace_x.length - 1;\r\n\t\t\t});\r\n\r\n\t\t\tcfg.trace_x_ascending = cfg.trace_x.slice();\r\n\t\t\treturn cfg;\r\n\t\t},\r\n\t\titerateScales: function (lower_scale, upper_scale, from, to, callback) {\r\n\t\t\tvar upper_dates = upper_scale.trace_x;\r\n\t\t\tvar lower_dates = lower_scale.trace_x;\r\n\r\n\t\t\tvar prev = from || 0;\r\n\t\t\tvar end = to || (lower_dates.length - 1);\r\n\t\t\tvar prevUpper = 0;\r\n\r\n\r\n\t\t\tfor (var up = 1; up < upper_dates.length; up++) {\r\n\t\t\t\tvar target_index = (lower_scale.trace_indexes[+upper_dates[up]]);\r\n\t\t\t\tif (target_index !== undefined && target_index <= end) {\r\n\t\t\t\t\tif (callback) {\r\n\t\t\t\t\t\tcallback.apply(this, [prevUpper, up, prev, target_index]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tprev = target_index;\r\n\t\t\t\t\tprevUpper = up;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\talineScaleColumns: function (lower_scale, upper_scale, from, to) {\r\n\t\t\tthis.iterateScales(lower_scale, upper_scale, from, to, function (upper_start, upper_end, lower_start, lower_end) {\r\n\t\t\t\tvar targetWidth = this.getSum(lower_scale.width, lower_start, lower_end - 1);\r\n\t\t\t\tvar actualWidth = this.getSum(upper_scale.width, upper_start, upper_end - 1);\r\n\t\t\t\tif (actualWidth != targetWidth) {\r\n\t\t\t\t\tthis.setSumWidth(targetWidth, upper_scale, upper_start, upper_end - 1);\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\teachColumn: function (unit, step, min_date, max_date, callback) {\r\n\t\t\tvar start = new Date(min_date),\r\n\t\t\t\tend = new Date(max_date);\r\n\t\t\tif (dateHelper[unit + \"_start\"]) {\r\n\t\t\t\tstart = dateHelper[unit + \"_start\"](start);\r\n\t\t\t}\r\n\r\n\t\t\tvar curr = new Date(start);\r\n\t\t\tif (+curr >= +end) {\r\n\t\t\t\tend = dateHelper.add(curr, step, unit);\r\n\t\t\t}\r\n\t\t\twhile (+curr < +end) {\r\n\t\t\t\tcallback.call(this, new Date(curr));\r\n\t\t\t\tvar tzOffset = curr.getTimezoneOffset();\r\n\t\t\t\tcurr = dateHelper.add(curr, step, unit);\r\n\t\t\t\tcurr = gantt._correct_dst_change(curr, tzOffset, step, unit);\r\n\t\t\t\tif (dateHelper[unit + '_start'])\r\n\t\t\t\t\tcurr = dateHelper[unit + \"_start\"](curr);\r\n\t\t\t}\r\n\t\t},\r\n\t\tlimitVisibleRange: function (cfg) {\r\n\t\t\tvar dates = cfg.trace_x;\r\n\r\n\t\t\tvar left = 0, right = cfg.width.length - 1;\r\n\t\t\tvar diff = 0;\r\n\t\t\tif (+dates[0] < +cfg.min_date && left != right) {\r\n\t\t\t\tvar width = Math.floor(cfg.width[0] * ((dates[1] - cfg.min_date) / (dates[1] - dates[0])));\r\n\t\t\t\tdiff += cfg.width[0] - width;\r\n\t\t\t\tcfg.width[0] = width;\r\n\r\n\t\t\t\tdates[0] = new Date(cfg.min_date);\r\n\t\t\t}\r\n\r\n\t\t\tvar last = dates.length - 1;\r\n\t\t\tvar lastDate = dates[last];\r\n\t\t\tvar outDate = dateHelper.add(lastDate, cfg.step, cfg.unit);\r\n\t\t\tif (+outDate > +cfg.max_date && last > 0) {\r\n\t\t\t\tvar width = cfg.width[last] - Math.floor(cfg.width[last] * ((outDate - cfg.max_date) / (outDate - lastDate)));\r\n\t\t\t\tdiff += cfg.width[last] - width;\r\n\t\t\t\tcfg.width[last] = width;\r\n\t\t\t}\r\n\r\n\t\t\tif (diff) {\r\n\t\t\t\tvar full = this.getSum(cfg.width);\r\n\t\t\t\tvar shared = 0;\r\n\t\t\t\tfor (var i = 0; i < cfg.width.length; i++) {\r\n\t\t\t\t\tvar share = Math.floor(diff * (cfg.width[i] / full));\r\n\t\t\t\t\tcfg.width[i] += share;\r\n\t\t\t\t\tshared += share;\r\n\t\t\t\t}\r\n\t\t\t\tthis.adjustSize(diff - shared, cfg.width);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default ScaleHelper;\r\n","import ScaleHelper from \"./ui/timeline/scales_ignore\";\r\nimport PrimaryScaleHelper from \"./ui/timeline/scales\";\r\n\r\nfunction resolveConfigRange(unit, gantt){\r\n\tvar range = {\r\n\t\tstart_date:null,\r\n\t\tend_date:null\r\n\t};\r\n\r\n\tif (gantt.config.start_date && gantt.config.end_date) {\r\n\t\trange.start_date = gantt.date[unit + \"_start\"](new Date(gantt.config.start_date));\r\n\r\n\t\tvar end = new Date(gantt.config.end_date);\r\n\t\tvar start_interval = gantt.date[unit + \"_start\"](new Date(end));\r\n\t\tif (+end != +start_interval) {\r\n\t\t\tend = gantt.date.add(start_interval, 1, unit);\r\n\t\t} else {\r\n\t\t\tend = start_interval;\r\n\t\t}\r\n\r\n\t\trange.end_date = end;\r\n\t}\r\n\treturn range;\r\n}\r\n\r\nfunction _scale_range_unit(gantt) {\r\n\tvar primaryScale = (new PrimaryScaleHelper(gantt)).primaryScale();\r\n\tvar unit = primaryScale.unit;\r\n\tvar step = primaryScale.step;\r\n\tif (gantt.config.scale_offset_minimal) {\r\n\r\n\t\tvar helper = new ScaleHelper(gantt);\r\n\t\tvar scales = [helper.primaryScale()].concat(helper.getSubScales());\r\n\r\n\t\thelper.sortScales(scales);\r\n\t\tunit = scales[scales.length - 1].unit;\r\n\t\tstep = scales[scales.length - 1].step || 1;\r\n\t}\r\n\treturn { unit:unit, step:step };\r\n}\r\n\r\nfunction _init_tasks_range(gantt) {\r\n\tvar cfg = _scale_range_unit(gantt);\r\n\tvar unit = cfg.unit,\r\n\t\tstep = cfg.step;\r\n\tvar range = resolveConfigRange(unit, gantt);\r\n\r\n\t// GS-1544: Show correct date range if we have tasks or only projects\r\n\tif(!(range.start_date && range.end_date)){\r\n\t\tvar onlyProjectTasks = true;\r\n\t\tvar tasks = gantt.getTaskByTime();\r\n\t\tfor (var i = 0; i < tasks.length; i++) {\r\n\t\t\tvar task = tasks[i];\r\n\t\t\tif (task.type !== gantt.config.types.project){\r\n\t\t\t\tonlyProjectTasks = false;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (tasks.length && onlyProjectTasks){\r\n\t\t\tvar start_date = tasks[0].start_date;\r\n\t\t\tvar end_date = gantt.date.add(start_date, 1, gantt.config.duration_unit);\r\n\t\t\trange = {\r\n\t\t\t\tstart_date: new Date(start_date),\r\n\t\t\t\tend_date: new Date(end_date)\r\n\t\t\t};\r\n\t\t} else{\r\n\t\t\trange = gantt.getSubtaskDates();\r\n\t\t}\r\n\r\n\t\tif(!range.start_date || !range.end_date){\r\n\t\t\trange = {\r\n\t\t\t\tstart_date: new Date(),\r\n\t\t\t\tend_date: new Date()\r\n\t\t\t};\r\n\t\t}\r\n\t\t// extend the displayed date range including the constraints, deadlines and baselines\r\n\t\tgantt.eachTask(function(task){\r\n\t\t\tif (gantt.config.deadlines && task.deadline){\r\n\t\t\t\textendRangeForDates(range, task.deadline, task.deadline);\r\n\t\t\t}\r\n\t\t\tif (task.constraint_date && task.constraint_type){\r\n\t\t\t\tif (gantt.config.constraint_types && task.constraint_type !== gantt.config.constraint_types.ASAP && task.constraint_type !== gantt.config.constraint_types.ALAP){\r\n\t\t\t\t\textendRangeForDates(range, task.constraint_date, task.constraint_date);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (gantt.config.baselines && task.baselines){\r\n\t\t\t\ttask.baselines.forEach(function(baseline){\r\n\t\t\t\t\textendRangeForDates(range, baseline.start_date, baseline.end_date);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\trange.start_date = gantt.date[unit + \"_start\"](range.start_date);\r\n\t\trange.start_date = gantt.calculateEndDate({\r\n\t\t\tstart_date: gantt.date[unit + \"_start\"](range.start_date),\r\n\t\t\tduration: -1,\r\n\t\t\tunit: unit,\r\n\t\t\tstep:step\r\n\t\t});//one free column before first task\r\n\r\n\t\trange.end_date = gantt.date[unit + \"_start\"](range.end_date);\r\n\t\trange.end_date = gantt.calculateEndDate({start_date: range.end_date, duration: 2, unit: unit, step:step});//one free column after last task\r\n\t}\r\n\r\n\tgantt._min_date = range.start_date;\r\n\tgantt._max_date = range.end_date;\r\n}\r\n\r\nfunction extendRangeForDates(range, start_date, end_date){\r\n\tif (start_date < range.start_date){\r\n\t\trange.start_date = new Date(start_date);\r\n\t}\r\n\tif (end_date > range.end_date){\r\n\t\trange.end_date = new Date(end_date);\r\n\t}\r\n}\r\n\r\nfunction _adjust_scales(gantt) {\r\n\tif (gantt.config.fit_tasks) {\r\n\t\tvar old_min = +gantt._min_date,\r\n\t\t\told_max = +gantt._max_date;\r\n\t\t//this._init_tasks_range();\r\n\t\tif (+gantt._min_date != old_min || +gantt._max_date != old_max) {\r\n\t\t\tgantt.render();\r\n\r\n\t\t\tgantt.callEvent(\"onScaleAdjusted\", []);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nexport default function updateTasksRange(gantt){\r\n\t_init_tasks_range(gantt);\r\n\t_adjust_scales(gantt);\r\n};\r\n","function copyLinkIdsArray(gantt, linkIds, targetHash){\r\n\tfor(var i = 0; i < linkIds.length; i++) {\r\n\t\tif(gantt.isLinkExists(linkIds[i])){\r\n\t\t\ttargetHash[linkIds[i]] = gantt.getLink(linkIds[i]);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction copyLinkIds(gantt, task, targetHash){\r\n\tcopyLinkIdsArray(gantt, task.$source, targetHash);\r\n\tcopyLinkIdsArray(gantt, task.$target, targetHash);\r\n}\r\n\r\nfunction getSubtreeLinks(gantt, rootId){\r\n\tvar res = {};\r\n\r\n\tif(gantt.isTaskExists(rootId)){\r\n\t\tcopyLinkIds(gantt, gantt.getTask(rootId), res);\r\n\t}\r\n\r\n\tgantt.eachTask(function(child){\r\n\t\tcopyLinkIds(gantt, child, res);\r\n\t}, rootId);\r\n\r\n\treturn res;\r\n}\r\n\r\nfunction getSubtreeTasks(gantt, rootId){\r\n\tvar res = {};\r\n\r\n\tgantt.eachTask(function(child){\r\n\t\tres[child.id] = child;\r\n\t}, rootId);\r\n\r\n\treturn res;\r\n}\r\n\r\nexport default {\r\n\tgetSubtreeLinks: getSubtreeLinks,\r\n\tgetSubtreeTasks: getSubtreeTasks\r\n};","import * as utils from \"../../utils/utils\";\r\nimport facadeFactory from \"./../facades/datastore\";\r\nimport calculateScaleRange from \"../gantt_data_range\";\r\nimport isPlaceholderTask from \"../../utils/placeholder_task\";\r\n\r\nimport treeHelper from \"../../utils/task_tree_helpers\";\r\n\r\nfunction initDataStores(gantt){\r\n\r\n\tvar facade = facadeFactory.create();\r\n\tutils.mixin(gantt, facade);\r\n\tvar tasksStore = gantt.createDatastore({\r\n\t\tname: \"task\",\r\n\t\ttype: \"treeDatastore\",\r\n\t\trootId: function() { return gantt.config.root_id; },\r\n\t\tinitItem: utils.bind(_init_task, gantt),\r\n\t\tgetConfig: function() { return gantt.config; }\r\n\t});\r\n\r\n\tvar linksStore = gantt.createDatastore({\r\n\t\tname: \"link\",\r\n\t\tinitItem: utils.bind(_init_link, gantt)\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onDestroy\", function(){\r\n\t\ttasksStore.destructor();\r\n\t\tlinksStore.destructor();\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onLinkValidation\", function(link){\r\n\t\tif(gantt.isLinkExists(link.id) || link.id === \"predecessor_generated\"){\r\n\t\t\t// link was already added into gantt\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar source = gantt.getTask(link.source);\r\n\t\tvar taskLinks = source.$source;\r\n\t\tfor (var i = 0; i < taskLinks.length; i++) {\r\n\t\t\tvar existingLink = gantt.getLink(taskLinks[i]);\r\n\r\n\t\t\tvar sourceMatch = link.source == existingLink.source;\r\n\t\t\tvar targetMatch = link.target == existingLink.target;\r\n\t\t\tvar typeMatch = link.type == existingLink.type;\r\n\r\n\t\t\t// prevent creating duplicated links from the UI\r\n\t\t\tif (sourceMatch && targetMatch && typeMatch) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t});\r\n\r\n\ttasksStore.attachEvent(\"onBeforeRefreshAll\", function(){\r\n\r\n\t\t// GS-2170 do not recalculate indexes and dates as the event will be called later in the onStoreUpdate event\r\n\t\tif (tasksStore._skipTaskRecalculation){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar order = tasksStore.getVisibleItems();\r\n\r\n\t\tfor(var i=0; i < order.length; i++){\r\n\t\t\tvar item = order[i];\r\n\t\t\titem.$index = i;\r\n\t\t\titem.$local_index = gantt.getTaskIndex(item.id);\r\n\t\t\tgantt.resetProjectDates(item);\r\n\t\t}\r\n\r\n\t});\r\n\r\n\ttasksStore.attachEvent(\"onFilterItem\", function(id, task) {\r\n\t\tif (gantt.config.show_tasks_outside_timescale) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tvar min = null, max = null;\r\n\t\tif (gantt.config.start_date && gantt.config.end_date) {\r\n\t\t\tif (gantt._isAllowedUnscheduledTask(task)) return true;\r\n\t\t\tmin = gantt.config.start_date.valueOf();\r\n\t\t\tmax = gantt.config.end_date.valueOf();\r\n\r\n\t\t\tif (+task.start_date > max || +task.end_date < +min)\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t});\r\n\r\n\ttasksStore.attachEvent(\"onIdChange\", function(oldId, newId){\r\n\t\tgantt._update_flags(oldId, newId);\r\n\r\n\t\tvar changedTask = gantt.getTask(newId);\r\n\t\tif(!tasksStore.isSilent()){\r\n\t\t\tif(changedTask.$split_subtask || changedTask.rollup){\r\n\t\t\t\tgantt.eachParent(function(parent){\r\n\t\t\t\t\tgantt.refreshTask(parent.id);\r\n\t\t\t\t}, newId);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\ttasksStore.attachEvent(\"onAfterUpdate\", function(id){\r\n\t\tgantt._update_parents(id);\r\n\t\tif(gantt.getState(\"batchUpdate\").batch_update){\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tvar task = tasksStore.getItem(id);\r\n\t\tif (!task.$source) task.$source = [];\r\n\t\tfor (var i = 0; i < task.$source.length; i++) {\r\n\t\t\tlinksStore.refresh(task.$source[i]);\r\n\t\t}\r\n\t\tif (!task.$target) task.$target = [];\r\n\t\tfor (var i = 0; i < task.$target.length; i++) {\r\n\t\t\tlinksStore.refresh(task.$target[i]);\r\n\t\t}\r\n\t});\r\n\r\n\ttasksStore.attachEvent(\"onBeforeItemMove\", function(sid, parent, tindex){\r\n\t\t// GS-125. Don't allow users to move the placeholder task\r\n\t\tif (isPlaceholderTask(sid, gantt, tasksStore)){\r\n\t\t\t//eslint-disable-next-line\r\n\t\t\tconsole.log(\"The placeholder task cannot be moved to another position.\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t});\r\n\r\n\ttasksStore.attachEvent(\"onAfterItemMove\", function(sid, parent, tindex){\r\n\t\tvar source = gantt.getTask(sid);\r\n\r\n\t\tif(this.getNextSibling(sid) !== null){\r\n\t\t\tsource.$drop_target = this.getNextSibling(sid);\r\n\t\t} else if(this.getPrevSibling(sid) !== null){\r\n\t\t\tsource.$drop_target = \"next:\" + this.getPrevSibling(sid);\r\n\t\t}else{\r\n\t\t\tsource.$drop_target = \"next:null\";\r\n\t\t}\r\n\r\n\t});\r\n\r\n\ttasksStore.attachEvent(\"onStoreUpdated\", function(id, item, action){\r\n\t\tif(action == \"delete\"){\r\n\t\t\tgantt._update_flags(id, null);\r\n\t\t}\r\n\r\n\t\tvar state = gantt.$services.getService(\"state\");\r\n\t\tif(state.getState(\"batchUpdate\").batch_update){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(gantt.config.fit_tasks && action !== \"paint\"){\r\n\t\t\tvar oldState = gantt.getState();\r\n\t\t\tcalculateScaleRange(gantt);\r\n\t\t\tvar newState = gantt.getState();\r\n\r\n\t\t\t//this._init_tasks_range();\r\n\t\t\tif (+oldState.min_date != +newState.min_date || +oldState.max_date != +newState.max_date) {\r\n\t\t\t\tgantt.render();\r\n\r\n\t\t\t\tgantt.callEvent(\"onScaleAdjusted\", []);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif(action == \"add\" || action == \"move\" || action == \"delete\"){\r\n\t\t\tif(gantt.$layout){\r\n\t\t\t\t// GS-2170. Do not recalculate the indexes and dates of other tasks in the\r\n\t\t\t\t// onBeforeResize layout event, but do it later. If lightbox is opened, it will\r\n\t\t\t\t// trigger the refreshData, so the indexes and dates will be recalculated there\r\n\t\t\t\tif (this.$config.name == \"task\" && (action == \"add\" || action == \"delete\")){\r\n\t\t\t\t\tif (this._skipTaskRecalculation != \"lightbox\"){\r\n\t\t\t\t\t\tthis._skipTaskRecalculation = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tgantt.$layout.resize();\r\n\t\t\t}\r\n\r\n\t\t}else if(!id){\r\n\t\t\tlinksStore.refresh();\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tlinksStore.attachEvent(\"onAfterAdd\", function(id, link){\r\n\t\tsync_link(link);\r\n\t});\r\n\tlinksStore.attachEvent(\"onAfterUpdate\", function(id, link){\r\n\t\tsync_links();\r\n\t});\r\n\tlinksStore.attachEvent(\"onAfterDelete\", function(id, link){\r\n\t\tsync_link_delete(link);\r\n\t});\r\n\tlinksStore.attachEvent(\"onAfterSilentDelete\", function(id, link){\r\n\t\tsync_link_delete(link);\r\n\t});\r\n\tlinksStore.attachEvent(\"onBeforeIdChange\", function(oldId, newId){\r\n\t\tsync_link_delete(gantt.mixin({id:oldId}, gantt.$data.linksStore.getItem(newId)));\r\n\t\tsync_link(gantt.$data.linksStore.getItem(newId));\r\n\t});\r\n\r\n\tfunction checkLinkedTaskVisibility(taskId){\r\n\t\tvar isVisible = gantt.isTaskVisible(taskId);\r\n\t\tif(!isVisible && gantt.isTaskExists(taskId)){\r\n\t\t\tvar parent = gantt.getParent(taskId);\r\n\t\t\tif(gantt.isTaskExists(parent) && gantt.isTaskVisible(parent)){\r\n\t\t\t\tparent = gantt.getTask(parent);\r\n\t\t\t\tif(gantt.isSplitTask(parent)){\r\n\t\t\t\t\tisVisible = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn isVisible;\r\n\t}\r\n\r\n\tlinksStore.attachEvent(\"onFilterItem\", function(id, link){\r\n\t\tif (!gantt.config.show_links) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar sourceVisible = checkLinkedTaskVisibility(link.source);\r\n\t\tvar targetVisible = checkLinkedTaskVisibility(link.target);\r\n\r\n\t\tif (!(sourceVisible && targetVisible) ||\r\n\t\t\tgantt._isAllowedUnscheduledTask(gantt.getTask(link.source)) || gantt._isAllowedUnscheduledTask(gantt.getTask(link.target)))\r\n\t\t\treturn false;\r\n\r\n\t\treturn gantt.callEvent(\"onBeforeLinkDisplay\", [id, link]);\r\n\t});\r\n\r\n\r\n\t(function(){\r\n\t\t// delete all connected links after task is deleted\r\n\t\tvar deletedLinks = {};\r\n\r\n\t\tgantt.attachEvent(\"onBeforeTaskDelete\", function(id, item){\r\n\t\t\tdeletedLinks[id] = treeHelper.getSubtreeLinks(gantt, id);\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onAfterTaskDelete\", function(id, item) {\r\n\t\t\tif(deletedLinks[id]){\r\n\t\t\t\tgantt.$data.linksStore.silent(function(){\r\n\t\t\t\t\tfor(var i in deletedLinks[id]){\r\n\t\t\t\t\t\tif (gantt.isLinkExists(i)){\r\n\t\t\t\t\t\t\tgantt.$data.linksStore.removeItem(i);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsync_link_delete(deletedLinks[id][i]);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdeletedLinks[id] = null;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t})();\r\n\r\n\tgantt.attachEvent(\"onAfterLinkDelete\", function(id, link) {\r\n\t\t// GS-1786. Repaint tasks only if they are loaded\r\n\t\tif(gantt.isTaskExists(link.source)){\r\n\t\t\tgantt.refreshTask(link.source);\r\n\t\t}\r\n\t\tif(gantt.isTaskExists(link.target)){\r\n\t\t\tgantt.refreshTask(link.target);\r\n\t\t}\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onParse\", sync_links);\r\n\r\n\tmapEvents({\r\n\t\tsource: linksStore,\r\n\t\ttarget: gantt,\r\n\t\tevents:{\r\n\t\t\t\"onItemLoading\":\"onLinkLoading\",\r\n\t\t\t\"onBeforeAdd\":\"onBeforeLinkAdd\",\r\n\t\t\t\"onAfterAdd\":\"onAfterLinkAdd\",\r\n\t\t\t\"onBeforeUpdate\":\"onBeforeLinkUpdate\",\r\n\t\t\t\"onAfterUpdate\":\"onAfterLinkUpdate\",\r\n\t\t\t\"onBeforeDelete\":\"onBeforeLinkDelete\",\r\n\t\t\t\"onAfterDelete\":\"onAfterLinkDelete\",\r\n\t\t\t\"onIdChange\":\"onLinkIdChange\"\r\n\t\t}\r\n\t});\r\n\r\n\tmapEvents({\r\n\t\tsource: tasksStore,\r\n\t\ttarget: gantt,\r\n\t\tevents:{\r\n\t\t\t\"onItemLoading\":\"onTaskLoading\",\r\n\t\t\t\"onBeforeAdd\":\"onBeforeTaskAdd\",\r\n\t\t\t\"onAfterAdd\":\"onAfterTaskAdd\",\r\n\t\t\t\"onBeforeUpdate\":\"onBeforeTaskUpdate\",\r\n\t\t\t\"onAfterUpdate\":\"onAfterTaskUpdate\",\r\n\t\t\t\"onBeforeDelete\":\"onBeforeTaskDelete\",\r\n\t\t\t\"onAfterDelete\":\"onAfterTaskDelete\",\r\n\t\t\t\"onIdChange\":\"onTaskIdChange\",\r\n\t\t\t\"onBeforeItemMove\":\"onBeforeTaskMove\",\r\n\t\t\t\"onAfterItemMove\":\"onAfterTaskMove\",\r\n\t\t\t\"onFilterItem\":\"onBeforeTaskDisplay\",\r\n\t\t\t\"onItemOpen\":\"onTaskOpened\",\r\n\t\t\t\"onItemClose\":\"onTaskClosed\",\r\n\t\t\t\"onBeforeSelect\":\"onBeforeTaskSelected\",\r\n\t\t\t\"onAfterSelect\":\"onTaskSelected\",\r\n\t\t\t\"onAfterUnselect\":\"onTaskUnselected\"\r\n\t\t}\r\n\t});\r\n\r\n\tgantt.$data = {\r\n\t\ttasksStore: tasksStore,\r\n\t\tlinksStore: linksStore\r\n\t};\r\n\r\n\tfunction sync_link(link){\r\n\t\tif(gantt.isTaskExists(link.source)){\r\n\t\t\tvar sourceTask = gantt.getTask(link.source);\r\n\t\t\tsourceTask.$source = sourceTask.$source || [];\r\n\t\t\tsourceTask.$source.push(link.id);\r\n\t\t}\r\n\t\tif(gantt.isTaskExists(link.target)){\r\n\t\t\tvar targetTask = gantt.getTask(link.target);\r\n\t\t\ttargetTask.$target = targetTask.$target || [];\r\n\t\t\ttargetTask.$target.push(link.id);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction sync_link_delete(link){\r\n\t\tif(gantt.isTaskExists(link.source)){\r\n\t\t\tvar sourceTask = gantt.getTask(link.source);\r\n\t\t\tfor(var i = 0; i < sourceTask.$source.length; i++){\r\n\t\t\t\tif(sourceTask.$source[i] == link.id){\r\n\t\t\t\t\tsourceTask.$source.splice(i, 1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(gantt.isTaskExists(link.target)){\r\n\t\t\tvar targetTask = gantt.getTask(link.target);\r\n\t\t\tfor(var i = 0; i < targetTask.$target.length; i++){\r\n\t\t\t\tif(targetTask.$target[i] == link.id){\r\n\t\t\t\t\ttargetTask.$target.splice(i, 1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction sync_links() {\r\n\t\tvar task = null;\r\n\t\tvar tasks = gantt.$data.tasksStore.getItems();\r\n\r\n\t\tfor(var i = 0, len = tasks.length; i < len; i++){\r\n\t\t\ttask = tasks[i];\r\n\t\t\ttask.$source = [];\r\n\t\t\ttask.$target = [];\r\n\t\t}\r\n\r\n\t\tvar links = gantt.$data.linksStore.getItems();\r\n\t\tfor (var i = 0, len = links.length; i < len; i++) {\r\n\r\n\t\t\tvar link = links[i];\r\n\t\t\tsync_link(link);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction mapEvents(conf){\r\n\t\tvar mapFrom = conf.source;\r\n\t\tvar mapTo = conf.target;\r\n\t\tfor(var i in conf.events){\r\n\t\t\t(function(sourceEvent, targetEvent){\r\n\t\t\t\tmapFrom.attachEvent(sourceEvent, function(){\r\n\t\t\t\t\treturn mapTo.callEvent(targetEvent, Array.prototype.slice.call(arguments));\r\n\t\t\t\t}, targetEvent);\r\n\t\t\t})(i, conf.events[i]);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _init_task(task) {\r\n\t\tif (!this.defined(task.id))\r\n\t\t\ttask.id = this.uid();\r\n\r\n\t\tif (task.start_date)\r\n\t\t\ttask.start_date = gantt.date.parseDate(task.start_date, \"parse_date\");\r\n\t\tif (task.end_date)\r\n\t\t\ttask.end_date = gantt.date.parseDate(task.end_date, \"parse_date\");\r\n\r\n\r\n\t\tvar duration = null;\r\n\t\tif (task.duration || task.duration === 0) {\r\n\t\t\ttask.duration = duration = task.duration * 1;\r\n\t\t}\r\n\r\n\t\tif (duration) {\r\n\t\t\tif (task.start_date && !task.end_date) {\r\n\t\t\t\ttask.end_date = this.calculateEndDate(task);\r\n\t\t\t} else if (!task.start_date && task.end_date) {\r\n\t\t\t\ttask.start_date = this.calculateEndDate({\r\n\t\t\t\t\tstart_date: task.end_date,\r\n\t\t\t\t\tduration: -task.duration,\r\n\t\t\t\t\ttask: task\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t//task.$calculate_duration = false;\r\n\t\t}\r\n\r\n\t\tif (gantt.config.deadlines !== false && task.deadline){\r\n\t\t\ttask.deadline = gantt.date.parseDate(task.deadline, \"parse_date\");\r\n\t\t}\r\n\r\n\t\ttask.progress = Number(task.progress) || 0;\r\n\r\n\t\tif (this._isAllowedUnscheduledTask(task)) {\r\n\t\t\tthis._set_default_task_timing(task);\r\n\t\t}\r\n\t\tthis._init_task_timing(task);\r\n\t\tif (task.start_date && task.end_date)\r\n\t\t\tthis.correctTaskWorkTime(task);\r\n\r\n\t\ttask.$source = [];\r\n\t\ttask.$target = [];\r\n\r\n\t\tvar originalTask = this.$data.tasksStore.getItem(task.id);\r\n\t\tif (originalTask && !utils.defined(task.open)) {\r\n\t\t\t// if a task with the same id is already in the gantt and the new object doesn't specify the `open` state -\r\n\t\t\t// restore the `open` state we already have in the chart\r\n\t\t\ttask.$open = originalTask.$open;\r\n\t\t}\r\n\r\n\t\tif (task.parent === undefined) {\r\n\t\t\ttask.parent = this.config.root_id;\r\n\t\t}\r\n\t\tif(task.open){\r\n\t\t\ttask.$open = true;\r\n\t\t}\r\n\t\treturn task;\r\n\t}\r\n\r\n\tfunction _init_link(link) {\r\n\t\tif (!this.defined(link.id))\r\n\t\t\tlink.id = this.uid();\r\n\t\treturn link;\r\n\t}\r\n}\r\n\r\n\r\nexport default initDataStores;\r\n","import * as helpers from \"../../utils/helpers\";\r\nimport treeHelper from \"../../utils/task_tree_helpers\";\r\n\r\n\r\nexport default class DataProcessorEvents {\r\n\tprotected _dataProcessorHandlers: any[];\r\n\tprotected $gantt: any;\r\n\tprotected $dp: any;\r\n\r\n\tconstructor(gantt: any, dp: any) {\r\n\t\tthis.$gantt = gantt;\r\n\t\tthis.$dp = dp;\r\n\t\tthis._dataProcessorHandlers = [];\r\n\t}\r\n\r\n\tattach() {\r\n\t\tconst dp = this.$dp;\r\n\t\tconst gantt = this.$gantt;\r\n\t\tconst cascadeDelete = {};\r\n\r\n\t\tconst clientSideDelete = (id) => {\r\n\t\t\treturn this.clientSideDelete(id, dp, gantt);\r\n\t\t};\r\n\r\n\t\tfunction getTaskLinks(task) {\r\n\t\t\tlet _links = [];\r\n\r\n\t\t\tif (task.$source) {\r\n\t\t\t\t_links = _links.concat(task.$source);\r\n\t\t\t}\r\n\t\t\tif (task.$target) {\r\n\t\t\t\t_links = _links.concat(task.$target);\r\n\t\t\t}\r\n\r\n\t\t\treturn _links;\r\n\t\t}\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterTaskAdd\", function(id, item) { // tslint:disable-line\r\n\t\t\tif (gantt.isTaskExists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"tasks\");\r\n\t\t\t\tdp.setUpdated(id, true, \"inserted\");\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterTaskUpdate\", function(id, item) { // tslint:disable-line\r\n\t\t\tif (gantt.isTaskExists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"tasks\");\r\n\t\t\t\tdp.setUpdated(id, true);\r\n\r\n\t\t\t\t// gantt can be destroyed/reinitialized after dp.setUpdated\r\n\t\t\t\tif(gantt._sendTaskOrder){\r\n\t\t\t\t\tgantt._sendTaskOrder(id, item);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onBeforeTaskDelete\", function(id, item) { // tslint:disable-line\r\n\t\t\tif (gantt.config.cascade_delete) {\r\n\t\t\t\tcascadeDelete[id] = {\r\n\t\t\t\t\ttasks: treeHelper.getSubtreeTasks(gantt, id),\r\n\t\t\t\t\tlinks: treeHelper.getSubtreeLinks(gantt, id)\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\t// GS-631. Keep the deleted item in Gantt until we receive the successful response from the server\r\n\t\t\tif (dp.deleteAfterConfirmation) {\r\n\t\t\t\tdp.setGanttMode(\"tasks\");\r\n\t\t\t\tdp.setUpdated(id, true, \"deleted\");\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}));\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterTaskDelete\", function(id, item) { // tslint:disable-line\r\n\t\t\tdp.setGanttMode(\"tasks\");\r\n\r\n\t\t\t// not send delete request if item is not inserted into the db - just remove it from the client\r\n\t\t\tconst needDbDelete = !clientSideDelete(id);\r\n\t\t\tconst needCascadeDelete = gantt.config.cascade_delete && cascadeDelete[id];\r\n\t\t\tif (!needDbDelete && !needCascadeDelete) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (needCascadeDelete) {\r\n\t\t\t\tconst dpMode = dp.updateMode;\r\n\t\t\t\tdp.setUpdateMode(\"off\");\r\n\r\n\t\t\t\tconst cascade = cascadeDelete[id];\r\n\t\t\t\tfor (const i in cascade.tasks) {\r\n\t\t\t\t\tif (!clientSideDelete(i)) {\r\n\t\t\t\t\t\tdp.storeItem(cascade.tasks[i]);\r\n\t\t\t\t\t\tdp.setUpdated(i, true, \"deleted\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tdp.setGanttMode(\"links\");\r\n\t\t\t\tfor (const i in cascade.links) {\r\n\t\t\t\t\tif (!clientSideDelete(i)) {\r\n\t\t\t\t\t\tdp.storeItem(cascade.links[i]);\r\n\t\t\t\t\t\tdp.setUpdated(i, true, \"deleted\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcascadeDelete[id] = null;\r\n\r\n\t\t\t\tif (dpMode !== \"off\") {\r\n\t\t\t\t\tdp.sendAllData();\r\n\t\t\t\t}\r\n\t\t\t\tdp.setGanttMode(\"tasks\");\r\n\t\t\t\tdp.setUpdateMode(dpMode);\r\n\t\t\t}\r\n\r\n\t\t\tif (needDbDelete){\r\n\t\t\t\tdp.storeItem(item);\r\n\t\t\t\tif (!dp.deleteAfterConfirmation){\r\n\t\t\t\t\tdp.setUpdated(id, true, \"deleted\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n\t\t\tif (dp.updateMode !== \"off\" && !dp._tSend) {\r\n\t\t\t\tdp.sendAllData();\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterLinkUpdate\", function(id, item) { // tslint:disable-line\r\n\t\t\tif (gantt.isLinkExists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"links\");\r\n\t\t\t\tdp.setUpdated(id, true);\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterLinkAdd\", function(id, item) { // tslint:disable-line\r\n\t\t\tif (gantt.isLinkExists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"links\");\r\n\t\t\t\tdp.setUpdated(id, true,\"inserted\");\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onAfterLinkDelete\", function(id, item) { // tslint:disable-line\r\n\t\t\tdp.setGanttMode(\"links\");\r\n\r\n\t\t\tconst needDbDelete = !clientSideDelete(id);\r\n\t\t\tif (!needDbDelete) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdp.storeItem(item);\r\n\t\t\tdp.setUpdated(id, true,\"deleted\");\r\n\t\t}));\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onRowDragEnd\", function(id, target) { // tslint:disable-line\r\n\t\t\tgantt._sendTaskOrder(id, gantt.getTask(id));\r\n\t\t}));\r\n\r\n\t\tlet tasks = null;\r\n\t\tlet links = null;\r\n\r\n\t\tthis._dataProcessorHandlers.push(gantt.attachEvent(\"onTaskIdChange\", function(oldId, newId) { // tslint:disable-line\r\n\t\t\tif (!dp._waitMode) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst children = gantt.getChildren(newId);\r\n\t\t\tif (children.length) {\r\n\t\t\t\ttasks = tasks || {};\r\n\r\n\t\t\t\tfor (let i = 0; i < children.length; i++) {\r\n\t\t\t\t\tconst ch = this.getTask(children[i]);\r\n\t\t\t\t\ttasks[ch.id] = ch;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst item = this.getTask(newId);\r\n\t\t\tconst itemLinks = getTaskLinks(item);\r\n\r\n\t\t\tif (itemLinks.length) {\r\n\t\t\t\tlinks = links || {};\r\n\r\n\t\t\t\tfor (let i = 0; i < itemLinks.length; i++) {\r\n\t\t\t\t\tconst link = this.getLink(itemLinks[i]);\r\n\t\t\t\t\tlinks[link.id] = link;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tdp.attachEvent(\"onAfterUpdateFinish\", function() {\r\n\t\t\tif (tasks || links) {\r\n\t\t\t\tgantt.batchUpdate(function() {\r\n\t\t\t\t\tfor (const id in tasks) {\r\n\t\t\t\t\t\tgantt.updateTask(tasks[id].id);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (const id in links) {\r\n\t\t\t\t\t\tgantt.updateLink(links[id].id);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttasks = null;\r\n\t\t\t\t\tlinks = null;\r\n\t\t\t\t});\r\n\t\t\t\tif (tasks) {\r\n\t\t\t\t\tgantt._dp.setGanttMode(\"tasks\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tgantt._dp.setGanttMode(\"links\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tdp.attachEvent(\"onBeforeDataSending\", function() {\r\n\t\t\tif (this._tMode === \"CUSTOM\") {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tlet url = this._serverProcessor;\r\n\t\t\tif (this._tMode === \"REST-JSON\" || this._tMode === \"REST\") {\r\n\t\t\t\tconst mode = this._ganttMode;\r\n\r\n\t\t\t\turl = url.substring(0, url.indexOf(\"?\") > -1 ? url.indexOf(\"?\") : url.length);\r\n\t\t\t\t// editing=true&\r\n\t\t\t\tthis.serverProcessor = url + (url.slice(-1) === \"/\" ? \"\" : \"/\") + mode;\r\n\t\t\t} else {\r\n\t\t\t\tconst pluralizedMode = this._ganttMode + \"s\";\r\n\t\t\t\tthis.serverProcessor = url + gantt.ajax.urlSeparator(url) + \"gantt_mode=\" + pluralizedMode;\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tdp.attachEvent(\"insertCallback\", function insertCallback(upd, id, parent, mode) { // tslint:disable-line\r\n\t\t\tconst data = upd.data || gantt.xml._xmlNodeToJSON(upd.firstChild);\r\n\t\t\tconst methods = {\r\n\t\t\t\tadd: gantt.addTask,\r\n\t\t\t\tisExist: gantt.isTaskExists\r\n\t\t\t};\r\n\t\t\tif (mode === \"links\") {\r\n\t\t\t\tmethods.add = gantt.addLink;\r\n\t\t\t\tmethods.isExist = gantt.isLinkExists;\r\n\t\t\t}\r\n\t\t\tif (methods.isExist.call(gantt, id)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdata.id = id;\r\n\t\t\tmethods.add.call(gantt, data);\r\n\t\t});\r\n\r\n\t\tdp.attachEvent(\"updateCallback\", function updateCallback(upd, id) {\r\n\t\t\tconst data = upd.data || gantt.xml._xmlNodeToJSON(upd.firstChild);\r\n\t\t\tif (!gantt.isTaskExists(id)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst objData = gantt.getTask(id);\r\n\t\t\tfor (const key in data) {\r\n\t\t\t\tlet property = data[key];\r\n\t\t\t\tswitch (key) {\r\n\t\t\t\t\tcase \"id\":\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\tcase \"start_date\":\r\n\t\t\t\t\tcase \"end_date\":\r\n\t\t\t\t\t\tproperty = gantt.defined(gantt.templates.xml_date) ? gantt.templates.xml_date(property) : gantt.templates.parse_date(property);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"duration\":\r\n\t\t\t\t\t\tobjData.end_date = gantt.calculateEndDate({start_date: objData.start_date, duration: property, task:objData});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tobjData[key] = property;\r\n\t\t\t}\r\n\t\t\tgantt.updateTask(id);\r\n\t\t\tgantt.refreshData();\r\n\t\t});\r\n\t\tdp.attachEvent(\"deleteCallback\", function deleteCallback(upd, id, parent, mode) { // tslint:disable-line\r\n\t\t\tconst methods = {\r\n\t\t\t\tdelete: gantt.deleteTask,\r\n\t\t\t\tisExist: gantt.isTaskExists\r\n\t\t\t};\r\n\t\t\tif (mode === \"links\") {\r\n\t\t\t\tmethods.delete = gantt.deleteLink;\r\n\t\t\t\tmethods.isExist = gantt.isLinkExists;\r\n\t\t\t} else if(mode === \"assignment\") {\r\n\t\t\t\tmethods.delete = function(val) {\r\n\t\t\t\t\tgantt.$data.assignmentsStore.remove(val);\r\n\t\t\t\t};\r\n\t\t\t\tmethods.isExist = function(val){\r\n\t\t\t\t\treturn gantt.$data.assignmentsStore.exists(val);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif (methods.isExist.call(gantt, id)) {\r\n\t\t\t\tmethods.delete.call(gantt, id);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.handleResourceCRUD(dp, gantt);\r\n\t\tthis.handleResourceAssignmentCRUD(dp, gantt);\r\n\t\tthis.handleBaselineCRUD(dp, gantt);\r\n\t}\r\n\r\n\tclientSideDelete(id, dp, gantt){\r\n\t\tconst updated = dp.updatedRows.slice();\r\n\t\tlet clientOnly = false;\r\n\r\n\t\tif(gantt.getUserData(id, \"!nativeeditor_status\", dp._ganttMode) === \"true_deleted\"){\r\n\t\t\tclientOnly = true;\r\n\t\t\tdp.setUpdated(id,false);\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < updated.length && !dp._in_progress[id]; i++) {\r\n\t\t\tif (updated[i] === id) {\r\n\t\t\t\tif (gantt.getUserData(id, \"!nativeeditor_status\", dp._ganttMode) === \"inserted\") {\r\n\t\t\t\t\tclientOnly = true;\r\n\t\t\t\t}\r\n\t\t\t\tdp.setUpdated(id,false);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn clientOnly;\r\n\t}\r\n\r\n\thandleResourceAssignmentCRUD(dp, gantt){\r\n\t\tif(!gantt.config.resources || gantt.config.resources.dataprocessor_assignments !== true){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst assignmentsStore = gantt.getDatastore(gantt.config.resource_assignment_store);\r\n\t\tconst insertedTasks = {};\r\n\t\tconst pendingAssignments = {};\r\n\r\n\t\tgantt.attachEvent(\"onBeforeTaskAdd\", function(id, task){\r\n\t\t\tinsertedTasks[id] = true;\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tfunction putAssignmentToQueue(item){\r\n\t\t\tpendingAssignments[item.id] = item;\r\n\t\t\tinsertedTasks[item.task_id] = true;\r\n\t\t}\r\n\r\n\t\tfunction insertResourceAssignment(assignment){\r\n\t\t\tconst id = assignment.id;\r\n\t\t\tif (assignmentsStore.exists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"assignment\");\r\n\t\t\t\tdp.setUpdated(id, true,\"inserted\");\r\n\t\t\t}\r\n\t\t\tdelete pendingAssignments[id];\r\n\t\t}\r\n\r\n\t\tgantt.attachEvent(\"onTaskIdChange\", function(id, newId){\r\n\t\t\tdelete insertedTasks[id];\r\n\t\t});\r\n\r\n\t\tassignmentsStore.attachEvent(\"onAfterAdd\", (id, item) => {\r\n\t\t\tif(insertedTasks[item.task_id]){\r\n\t\t\t\t// inserting assignment of new task\r\n\t\t\t\t// task is not saved yet, need to wait till it gets permanent id and save assigmnents after that\r\n\t\t\t\tputAssignmentToQueue(item);\r\n\t\t\t}else{\r\n\t\t\t\tinsertResourceAssignment(item);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tassignmentsStore.attachEvent(\"onAfterUpdate\", (id, item) => {\r\n\t\t\tif (assignmentsStore.exists(id)) {\r\n\t\t\t\tif(pendingAssignments[id]){\r\n\t\t\t\t\tinsertResourceAssignment(item);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdp.setGanttMode(\"assignment\");\r\n\t\t\t\t\tdp.setUpdated(id, true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tassignmentsStore.attachEvent(\"onAfterDelete\", (id, item) => {\r\n\t\t\tdp.setGanttMode(\"assignment\");\r\n\r\n\t\t\tconst needDbDelete = !this.clientSideDelete(id, dp, gantt);\r\n\t\t\tif (!needDbDelete) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdp.storeItem(item);\r\n\t\t\tdp.setUpdated(id, true,\"deleted\");\r\n\t\t});\r\n\r\n\t}\r\n\r\n\thandleResourceCRUD(dp, gantt){\r\n\t\tif(!gantt.config.resources || gantt.config.resources.dataprocessor_resources !== true){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst resourcesStore = gantt.getDatastore(gantt.config.resource_store);\r\n\r\n\t\tfunction insertResource(resource){\r\n\t\t\tconst id = resource.id;\r\n\t\t\tif (resourcesStore.exists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"resource\");\r\n\t\t\t\tdp.setUpdated(id, true,\"inserted\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tresourcesStore.attachEvent(\"onAfterAdd\", (id, item) => {\r\n\t\t\tinsertResource(item);\r\n\t\t});\r\n\r\n\t\tresourcesStore.attachEvent(\"onAfterUpdate\", (id, item) => {\r\n\t\t\tif (resourcesStore.exists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"resource\");\r\n\t\t\t\tdp.setUpdated(id, true);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tresourcesStore.attachEvent(\"onAfterDelete\", (id, item) => {\r\n\t\t\tdp.setGanttMode(\"resource\");\r\n\r\n\t\t\tconst needDbDelete = !this.clientSideDelete(id, dp, gantt);\r\n\t\t\tif (!needDbDelete) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdp.storeItem(item);\r\n\t\t\tdp.setUpdated(id, true,\"deleted\");\r\n\t\t});\r\n\r\n\t}\r\n\r\n\thandleBaselineCRUD(dp, gantt){\r\n\t\tif(!gantt.config.baselines || gantt.config.baselines.dataprocessor_baselines !== true){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst baselineStore = gantt.getDatastore(gantt.config.baselines.datastore);\r\n\r\n\t\tfunction insertResource(resource){\r\n\t\t\tconst id = resource.id;\r\n\t\t\tif (baselineStore.exists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"baseline\");\r\n\t\t\t\tdp.setUpdated(id, true,\"inserted\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tbaselineStore.attachEvent(\"onAfterAdd\", (id, item) => {\r\n\t\t\tinsertResource(item);\r\n\t\t});\r\n\r\n\t\tbaselineStore.attachEvent(\"onAfterUpdate\", (id, item) => {\r\n\t\t\tif (baselineStore.exists(id)) {\r\n\t\t\t\tdp.setGanttMode(\"baseline\");\r\n\t\t\t\tdp.setUpdated(id, true);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tbaselineStore.attachEvent(\"onAfterDelete\", (id, item) => {\r\n\t\t\tdp.setGanttMode(\"baseline\");\r\n\r\n\t\t\tconst needDbDelete = !this.clientSideDelete(id, dp, gantt);\r\n\t\t\tif (!needDbDelete) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdp.storeItem(item);\r\n\t\t\tdp.setUpdated(id, true,\"deleted\");\r\n\t\t});\r\n\t}\r\n\r\n\tdetach() {\r\n\t\thelpers.forEach(this._dataProcessorHandlers, (e) => {\r\n\t\t\tthis.$gantt.detachEvent(e);\r\n\t\t});\r\n\t\tthis._dataProcessorHandlers = [];\r\n\t}\r\n}\r\n","\r\nexport default function extendGantt(gantt: any, dp: any) {\r\n\tgantt.getUserData = function(id, name, store) {\r\n\t\tif (!this.userdata) {\r\n\t\t\tthis.userdata = {};\r\n\t\t}\r\n\t\tthis.userdata[store] = this.userdata[store] || {};\r\n\t\tif (this.userdata[store][id] && this.userdata[store][id][name]) {\r\n\t\t\treturn this.userdata[store][id][name];\r\n\t\t}\r\n\t\treturn \"\";\r\n\t};\r\n\tgantt.setUserData = function(id, name, value, store) {\r\n\t\tif (!this.userdata) {\r\n\t\t\tthis.userdata = {};\r\n\t\t}\r\n\t\tthis.userdata[store] = this.userdata[store] || {};\r\n\t\tthis.userdata[store][id] = this.userdata[store][id] || {};\r\n\t\tthis.userdata[store][id][name] = value;\r\n\t};\r\n\r\n\tgantt._change_id = function(oldId, newId) {\r\n\t\tswitch (this._dp._ganttMode) {\r\n\t\t\tcase \"task\":\r\n\t\t\t\tthis.changeTaskId(oldId, newId);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"link\":\r\n\t\t\t\tthis.changeLinkId(oldId, newId);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"assignment\":\r\n\t\t\t\tthis.$data.assignmentsStore.changeId(oldId, newId);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"resource\":\r\n\t\t\t\tthis.$data.resourcesStore.changeId(oldId, newId);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"baseline\":\r\n\t\t\t\tthis.$data.baselineStore.changeId(oldId, newId);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(`Invalid mode of the dataProcessor after database id is received: ${this._dp._ganttMode}, new id: ${newId}`);\r\n\t\t}\r\n\t};\r\n\r\n\tgantt._row_style = function(rowId, classname){\r\n\t\tif (this._dp._ganttMode !== \"task\") {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!gantt.isTaskExists(rowId)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst task = gantt.getTask(rowId);\r\n\t\ttask.$dataprocessor_class = classname;\r\n\t\tgantt.refreshTask(rowId);\r\n\t};\r\n\r\n\t// fake method for dataprocessor\r\n\tgantt._delete_task = function(rowId, node) {}; // tslint:disable-line\r\n\r\n\tgantt._sendTaskOrder = function(id, item){\r\n\t\tif (item.$drop_target) {\r\n\t\t\tthis._dp.setGanttMode(\"task\");\r\n\t\t\tthis.getTask(id).target = item.$drop_target;\r\n\t\t\tthis._dp.setUpdated(id, true,\"order\");\r\n\t\t\tdelete this.getTask(id).$drop_target;\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.setDp = function() {\r\n\t\tthis._dp = dp;\r\n\t};\r\n\r\n\tgantt.setDp();\r\n}","import * as utils from \"../../utils/utils\";\r\n\r\nexport default class SimpleStorage {\r\n\tpublic static create = () : SimpleStorage => {\r\n\t\treturn new SimpleStorage();\r\n\t};\r\n\r\n\tprotected _storage: { [id: string]: any; };\r\n\r\n\tprotected constructor() {\r\n\t\tthis._storage = {};\r\n\t}\r\n\r\n\tpublic clear = (): void => {\r\n\t\tthis._storage = {};\r\n\t};\r\n\r\n\tpublic storeItem = (item: any): void => {\r\n\t\tthis._storage[item.id] = utils.copy(item);\r\n\t};\r\n\r\n\tpublic getStoredItem = (id: string): any => {\r\n\t\treturn this._storage[id] || null;\r\n\t};\r\n}","import eventable from \"../../utils/eventable\";\r\nimport * as helpers from \"../../utils/helpers\";\r\nimport * as utils from \"../../utils/utils\";\r\nimport DataProcessorEvents from \"./data_processor_events\";\r\nimport extendGantt from \"./extend_gantt\";\r\nimport SimpleStorage from \"./simple_storage\";\r\nimport global from \"../../utils/global\";\r\n\r\nexport interface DataProcessor { // tslint:disable-line\r\n\t$gantt: any;\r\n\tdetachAllEvents: any;\r\n\tattachEvent: any;\r\n\tcallEvent: any;\r\n\r\n\tserverProcessor: string;\r\n\taction_param: string;\r\n\tupdatedRows: any[];\r\n\tautoUpdate: boolean;\r\n\tupdateMode: string;\r\n\tmessages: any[];\r\n\tstyles: object;\r\n\tdnd: any;\r\n\tdeleteAfterConfirmation?: any;\r\n}\r\n\r\nexport function createDataProcessor(config: any) {\r\n\tlet router;\r\n\tlet tMode;\r\n\tlet headers;\r\n\tif (config instanceof Function) {\r\n\t\trouter = config;\r\n\t} else if (config.hasOwnProperty(\"router\")) {\r\n\t\trouter = config.router;\r\n\t} else if (config.hasOwnProperty(\"assignment\") || config.hasOwnProperty(\"baseline\") || config.hasOwnProperty(\"link\") || config.hasOwnProperty(\"task\")) {\r\n\t\trouter = config;\r\n\t} else if(config.hasOwnProperty(\"headers\")){\r\n\t\t// GS-2312 for custom headers\r\n\t\theaders = config.headers;\r\n\t}\r\n\tif (router) {\r\n\t\ttMode = \"CUSTOM\";\r\n\t} else {\r\n\t\ttMode = config.mode || \"REST-JSON\";\r\n\t}\r\n\tconst gantt = this; // tslint:disable-line\r\n\tconst dp = new DataProcessor(config.url);\r\n\r\n\r\n\tdp.init(gantt);\r\n\tdp.setTransactionMode({\r\n\t\tmode: tMode,\r\n\t\trouter,\r\n\t\theaders\r\n\t}, config.batchUpdate);\r\n\tif(config.deleteAfterConfirmation){\r\n\t\tdp.deleteAfterConfirmation = config.deleteAfterConfirmation;\r\n\t}\r\n\treturn dp;\r\n}\r\n\r\nexport class DataProcessor {\r\n\tpublic modes: object;\r\n\tpublic serverProcessor: string;\r\n\tpublic action_param: string; // tslint:disable-line\r\n\tpublic updatedRows: any[];\r\n\tpublic autoUpdate: boolean;\r\n\tpublic updateMode: string;\r\n\tpublic messages: any[];\r\n\tpublic styles: object;\r\n\tpublic dnd: any;\r\n\r\n\tprotected _tMode: string;\r\n\tprotected _headers: any;\r\n\tprotected _payload: any;\r\n\tprotected _postDelim: string;\r\n\tprotected _waitMode: number;\r\n\tprotected _in_progress: object; // tslint:disable-line\r\n\tprotected _invalid: object;\r\n\tprotected _storage: SimpleStorage;\r\n\tprotected _tSend: boolean;\r\n\tprotected _serializeAsJson: boolean;\r\n\tprotected _router: any;\r\n\tprotected _utf: boolean;\r\n\tprotected _methods: any[];\r\n\tprotected _user: any;\r\n\tprotected _uActions: object;\r\n\tprotected _needUpdate: boolean;\r\n\tprotected _ganttMode: \"task\"|\"link\";\r\n\tprotected _routerParametersFormat: \"parameters\"|\"object\";\r\n\r\n\tprotected _silent_mode: any; // tslint:disable-line\r\n\tprotected _updateBusy: any;\r\n\tprotected _serverProcessor: any;\r\n\tprotected _initialized: boolean;\r\n\r\n\tconstructor(serverProcessorURL?) {\r\n\t\tthis.serverProcessor = serverProcessorURL;\r\n\t\tthis.action_param = \"!nativeeditor_status\";\r\n\r\n\t\tthis.updatedRows = []; // ids of updated rows\r\n\r\n\t\tthis.autoUpdate = true;\r\n\t\tthis.updateMode = \"cell\";\r\n\t\tthis._headers = null;\r\n\t\tthis._payload = null;\r\n\t\tthis._postDelim = \"_\";\r\n\t\tthis._routerParametersFormat = \"parameters\";\r\n\r\n\t\tthis._waitMode = 0;\r\n\t\tthis._in_progress = {}; // ?\r\n\t\tthis._storage = SimpleStorage.create();\r\n\t\tthis._invalid = {};\r\n\t\tthis.messages = [];\r\n\r\n\t\tthis.styles = {\r\n\t\t\tupdated: \"font-weight:bold;\",\r\n\t\t\tinserted: \"font-weight:bold;\",\r\n\t\t\tdeleted: \"text-decoration : line-through;\",\r\n\t\t\tinvalid: \"background-color:FFE0E0;\",\r\n\t\t\tinvalid_cell: \"border-bottom:2px solid red;\",\r\n\t\t\terror: \"color:red;\",\r\n\t\t\tclear: \"font-weight:normal;text-decoration:none;\"\r\n\t\t};\r\n\t\tthis.enableUTFencoding(true);\r\n\t\teventable(this);\r\n\t}\r\n\r\n\tsetTransactionMode(mode:any, total?:any) {\r\n\t\tif (typeof mode === \"object\") {\r\n\t\t\tthis._tMode = mode.mode || this._tMode;\r\n\r\n\t\t\tif (utils.defined(mode.headers)) {\r\n\t\t\t\tthis._headers = mode.headers;\r\n\t\t\t}\r\n\r\n\t\t\tif (utils.defined(mode.payload)) {\r\n\t\t\t\tthis._payload = mode.payload;\r\n\t\t\t}\r\n\t\t\tthis._tSend = !!total;\r\n\t\t} else {\r\n\t\t\tthis._tMode = mode;\r\n\t\t\tthis._tSend = total;\r\n\t\t}\r\n\r\n\t\tif (this._tMode === \"REST\") {\r\n\t\t\tthis._tSend = false;\r\n\t\t}\r\n\r\n\t\tif (this._tMode === \"JSON\" || this._tMode === \"REST-JSON\") {\r\n\t\t\tthis._tSend = false;\r\n\t\t\tthis._serializeAsJson = true;\r\n\t\t\tthis._headers = this._headers || {};\r\n\t\t\tthis._headers[\"Content-Type\"] = \"application/json\";\r\n\t\t}else{\r\n\t\t\tif(this._headers && !this._headers[\"Content-Type\"]){\r\n\t\t\t\tthis._headers[\"Content-Type\"] = \"application/x-www-form-urlencoded\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._tMode === \"CUSTOM\") {\r\n\t\t\tthis._tSend = false;\r\n\t\t\tthis._router = mode.router;\r\n\t\t}\r\n\t}\r\n\r\n\tescape(data:any) {\r\n\t\tif (this._utf) {\r\n\t\t\treturn encodeURIComponent(data);\r\n\t\t} else {\r\n\t\t\treturn escape(data);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: allows to set escaping mode\r\n\t * @param: true - utf based escaping, simple - use current page encoding\r\n\t * @type: public\r\n\t */\r\n\tenableUTFencoding(mode:boolean) {\r\n\t\tthis._utf = !!mode;\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: get state of updating\r\n\t * @returns:   true - all in sync with server, false - some items not updated yet.\r\n\t * @type: public\r\n\t */\r\n\tgetSyncState() {\r\n\t\treturn !this.updatedRows.length;\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: set if rows should be send to server automatically\r\n\t * @param: mode - \"row\" - based on row selection changed, \"cell\" - based on cell editing finished, \"off\" - manual data sending\r\n\t * @type: public\r\n\t */\r\n\tsetUpdateMode(mode: string, dnd: any) {\r\n\t\tthis.autoUpdate = (mode === \"cell\");\r\n\t\tthis.updateMode = mode;\r\n\t\tthis.dnd = dnd;\r\n\t}\r\n\r\n\tignore(code: any, master: any) {\r\n\t\tthis._silent_mode = true;\r\n\t\tcode.call(master || global);\r\n\t\tthis._silent_mode = false;\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: mark row as updated/normal. check mandatory fields, initiate autoupdate (if turned on)\r\n\t * @param: rowId - id of row to set update-status for\r\n\t * @param: state - true for \"updated\", false for \"not updated\"\r\n\t * @param: mode - update mode name\r\n\t * @type: public\r\n\t */\r\n\tsetUpdated(rowId:number|string, state: boolean, mode?: string) {\r\n\t\tif (this._silent_mode) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst ind = this.findRow(rowId);\r\n\r\n\t\tmode = mode || \"updated\";\r\n\t\tconst existing = this.$gantt.getUserData(rowId, this.action_param, this._ganttMode);\r\n\t\tif (existing && mode === \"updated\") {\r\n\t\t\tmode = existing;\r\n\t\t}\r\n\t\tif (state) {\r\n\t\t\tthis.set_invalid(rowId, false); // clear previous error flag\r\n\t\t\tthis.updatedRows[ind] = rowId;\r\n\t\t\tthis.$gantt.setUserData(rowId, this.action_param, mode, this._ganttMode);\r\n\t\t\tif (this._in_progress[rowId]) {\r\n\t\t\t\tthis._in_progress[rowId] = \"wait\";\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (!this.is_invalid(rowId)) {\r\n\t\t\t\tthis.updatedRows.splice(ind, 1);\r\n\t\t\t\tthis.$gantt.setUserData(rowId, this.action_param, \"\", this._ganttMode);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.markRow(rowId, state, mode);\r\n\t\tif (state && this.autoUpdate) {\r\n\t\t\tthis.sendData(rowId);\r\n\t\t}\r\n\t}\r\n\r\n\tmarkRow(id: number | string, state: boolean, mode: string) {\r\n\t\tlet str = \"\";\r\n\t\tconst invalid = this.is_invalid(id);\r\n\t\tif (invalid) {\r\n\t\t\tstr = this.styles[invalid];\r\n\t\t\tstate = true;\r\n\t\t}\r\n\t\tif (this.callEvent(\"onRowMark\", [id, state, mode, invalid])) {\r\n\t\t\t// default logic\r\n\t\t\tstr = this.styles[state ? mode : \"clear\"] + \" \" + str;\r\n\r\n\t\t\tthis.$gantt[this._methods[0]](id, str);\r\n\r\n\t\t\tif (invalid && invalid.details) {\r\n\t\t\t\tstr += this.styles[invalid + \"_cell\"];\r\n\t\t\t\tfor (let i = 0; i < invalid.details.length; i++) {\r\n\t\t\t\t\tif (invalid.details[i]) {\r\n\t\t\t\t\t\tthis.$gantt[this._methods[1]](id, i, str);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetActionByState(state: string):string {\r\n\t\tif (state === \"inserted\") {\r\n\t\t\treturn \"create\";\r\n\t\t}\r\n\r\n\t\tif (state === \"updated\") {\r\n\t\t\treturn \"update\";\r\n\t\t}\r\n\r\n\t\tif (state === \"deleted\") {\r\n\t\t\treturn \"delete\";\r\n\t\t}\r\n\r\n\t\t// reorder\r\n\t\treturn \"update\";\r\n\t}\r\n\r\n\tgetState(id: number | string) {\r\n\t\treturn this.$gantt.getUserData(id, this.action_param, this._ganttMode);\r\n\t}\r\n\r\n\tis_invalid(id: number | string) {\r\n\t\treturn this._invalid[id];\r\n\t}\r\n\r\n\tset_invalid(id: number | string, mode: any, details?) {\r\n\t\tif (details) {\r\n\t\t\tmode = {\r\n\t\t\t\tvalue: mode,\r\n\t\t\t\tdetails,\r\n\t\t\t\ttoString: function() { // tslint:disable-line\r\n\t\t\t\t\treturn this.value.toString();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t\tthis._invalid[id] = mode;\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: check mandatory fields and verify values of cells, initiate update (if specified). Can be redefined in order to provide custom validation\r\n\t * @param: rowId - id of row to set update-status for\r\n\t * @type: public\r\n\t */\r\n\t// tslint:disable-next-line\r\n\tcheckBeforeUpdate(rowId: number | string) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: send row(s) values to server\r\n\t * @param: rowId - id of row which data to send. If not specified, then all \"updated\" rows will be send\r\n\t * @type: public\r\n\t */\r\n\tsendData(rowId?: any) {\r\n\t\tif (this.$gantt.editStop) {\r\n\t\t\tthis.$gantt.editStop();\r\n\t\t}\r\n\r\n\t\tif (typeof rowId === \"undefined\" || this._tSend) {\r\n\r\n\t\t\tconst pendingUpdateModes = [];\r\n\t\t\tif(this.modes){\r\n\t\t\t\tconst knownModes = [\"task\", \"link\", \"assignment\", \"baseline\"];\r\n\t\t\t\tknownModes.forEach((mode) => {\r\n\t\t\t\t\tif(this.modes[mode] && this.modes[mode].updatedRows.length){\r\n\t\t\t\t\t\tpendingUpdateModes.push(mode);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (pendingUpdateModes.length){\r\n\t\t\t\tfor(let i = 0; i < pendingUpdateModes.length; i++){\r\n\t\t\t\t\tthis.setGanttMode(pendingUpdateModes[i]);\r\n\t\t\t\t\tthis.sendAllData();\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t} else {\r\n\t\t\t\treturn this.sendAllData();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._in_progress[rowId]) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tthis.messages = [];\r\n\t\tif (!this.checkBeforeUpdate(rowId) && this.callEvent(\"onValidationError\", [rowId, this.messages])) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tthis._beforeSendData(this._getRowData(rowId), rowId);\r\n\t}\r\n\r\n\tserialize(data: any, id: any) {\r\n\t\tif (this._serializeAsJson) {\r\n\t\t\treturn  this._serializeAsJSON(data);\r\n\t\t}\r\n\r\n\t\tif (typeof data === \"string\") {\r\n\t\t\treturn data;\r\n\t\t}\r\n\t\tif (typeof id !== \"undefined\") {\r\n\t\t\treturn this.serialize_one(data, \"\");\r\n\t\t} else {\r\n\t\t\tconst stack = [];\r\n\t\t\tconst keys = [];\r\n\t\t\tfor (const key in data) {\r\n\t\t\t\tif (data.hasOwnProperty(key)) {\r\n\t\t\t\t\tstack.push(this.serialize_one(data[key], key + this._postDelim));\r\n\t\t\t\t\tkeys.push(key);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tstack.push(\"ids=\" + this.escape(keys.join(\",\")));\r\n\t\t\tif (this.$gantt.security_key) {\r\n\t\t\t\tstack.push(\"dhx_security=\" + this.$gantt.security_key);\r\n\t\t\t}\r\n\t\t\treturn stack.join(\"&\");\r\n\t\t}\r\n\t}\r\n\r\n\tserialize_one(data: any, pref: string) {\r\n\t\tif (typeof data === \"string\") {\r\n\t\t\treturn data;\r\n\t\t}\r\n\t\tconst stack = [];\r\n\t\tlet serialized = \"\";\r\n\t\tfor (const key in data)\r\n\t\t\tif (data.hasOwnProperty(key)) {\r\n\t\t\t\tif ((key === \"id\" ||\r\n\t\t\t\t\tkey == this.action_param) && // tslint:disable-line\r\n\t\t\t\t\tthis._tMode === \"REST\") {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (typeof data[key] === \"string\" || typeof data[key] === \"number\") {\r\n\t\t\t\t\tserialized = String(data[key]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tserialized = JSON.stringify(data[key]);\r\n\t\t\t\t}\r\n\t\t\t\tstack.push(this.escape((pref || \"\") + key) + \"=\" + this.escape(serialized));\r\n\t\t\t}\r\n\t\treturn stack.join(\"&\");\r\n\t}\r\n\r\n\tsendAllData() {\r\n\t\tif (!this.updatedRows.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.messages = [];\r\n\t\tlet valid: any = true;\r\n\r\n\t\tthis._forEachUpdatedRow(function(rowId) {\r\n\t\t\tvalid = valid && this.checkBeforeUpdate(rowId);\r\n\t\t});\r\n\r\n\t\tif (!valid && !this.callEvent(\"onValidationError\", [\"\", this.messages])) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (this._tSend) {\r\n\t\t\tthis._sendData(this._getAllData());\r\n\t\t} else {\r\n\t\t\t// this.updatedRows can be spliced from onBeforeUpdate via dp.setUpdated false\r\n\t\t\t// use an iterator instead of for(var i = 0; i < this.updatedRows; i++) then\r\n\t\t\tthis._forEachUpdatedRow(function(rowId) {\r\n\t\t\t\tif (!this._in_progress[rowId]) {\r\n\t\t\t\t\tif (this.is_invalid(rowId)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._beforeSendData(this._getRowData(rowId), rowId);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tfindRow(pattern: any) {\r\n\t\tlet i = 0;\r\n\t\tfor (i = 0; i < this.updatedRows.length; i++) {\r\n\t\t\tif (pattern == this.updatedRows[i]) { // tslint:disable-line\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn i;\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: define custom actions\r\n\t * @param: name - name of action, same as value of action attribute\r\n\t * @param: handler - custom function, which receives a XMl response content for action\r\n\t * @type: private\r\n\t */\r\n\tdefineAction(name: string, handler: any) {\r\n\t\tif (!this._uActions) {\r\n\t\t\tthis._uActions = {};\r\n\t\t}\r\n\t\tthis._uActions[name] = handler;\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: used in combination with setOnBeforeUpdateHandler to create custom client-server transport system\r\n\t * @param: sid - id of item before update\r\n\t * @param: tid - id of item after up0ate\r\n\t * @param: action - action name\r\n\t * @type: public\r\n\t * @topic: 0\r\n\t */\r\n\tafterUpdateCallback(sid: number | string, tid: number | string, action: string, btag: any, ganttMode: string) {\r\n\t\tif(!this.$gantt){\r\n\t\t\t// destructor has been called before the callback\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.setGanttMode(ganttMode);\r\n\r\n\t\tconst marker = sid;\r\n\t\tconst correct = (action !== \"error\" && action !== \"invalid\");\r\n\t\tif (!correct) {\r\n\t\t\tthis.set_invalid(sid, action);\r\n\t\t}\r\n\t\tif ((this._uActions) && (this._uActions[action]) && (!this._uActions[action](btag))) {\r\n\t\t\treturn (delete this._in_progress[marker]);\r\n\t\t}\r\n\r\n\t\tif (this._in_progress[marker] !== \"wait\") {\r\n\t\t\tthis.setUpdated(sid, false);\r\n\t\t}\r\n\r\n\t\tconst originalSid = sid;\r\n\r\n\t\tswitch (action) {\r\n\t\t\tcase \"inserted\":\r\n\t\t\tcase \"insert\":\r\n\t\t\t\tif (tid != sid) { // tslint:disable-line\r\n\t\t\t\t\tthis.setUpdated(sid, false);\r\n\t\t\t\t\tthis.$gantt[this._methods[2]](sid, tid);\r\n\t\t\t\t\tsid = tid;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"delete\":\r\n\t\t\tcase \"deleted\":\r\n\t\t\t\tif(!this.deleteAfterConfirmation || this._ganttMode !== \"task\"){\r\n\t\t\t\t\tthis.$gantt.setUserData(sid, this.action_param, \"true_deleted\", this._ganttMode);\r\n\t\t\t\t\tthis.$gantt[this._methods[3]](sid);\r\n\t\t\t\t\tdelete this._in_progress[marker];\r\n\t\t\t\t\treturn this.callEvent(\"onAfterUpdate\", [sid, action, tid, btag]);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif (this._ganttMode === \"task\" && this.$gantt.isTaskExists(sid)) {\r\n\t\t\t\t\t\tthis.$gantt.setUserData(sid, this.action_param, \"true_deleted\", this._ganttMode);\r\n\t\t\t\t\t\tconst task = this.$gantt.getTask(sid);\r\n\t\t\t\t\t\tthis.$gantt.silent(() => {\r\n\t\t\t\t\t\t\tthis.$gantt.deleteTask(sid);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tthis.$gantt.callEvent(\"onAfterTaskDelete\", [sid, task]);\r\n\t\t\t\t\t\tthis.$gantt.render();\r\n\t\t\t\t\t\tdelete this._in_progress[marker];\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn this.callEvent(\"onAfterUpdate\", [sid, action, tid, btag]);\r\n\t\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (this._in_progress[marker] !== \"wait\") {\r\n\t\t\tif (correct) {\r\n\t\t\t\tthis.$gantt.setUserData(sid, this.action_param, \"\", this._ganttMode);\r\n\t\t\t}\r\n\t\t\tdelete this._in_progress[marker];\r\n\t\t} else {\r\n\t\t\tdelete this._in_progress[marker];\r\n\t\t\tthis.setUpdated(tid, true, this.$gantt.getUserData(sid, this.action_param, this._ganttMode));\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onAfterUpdate\", [originalSid, action, tid, btag]);\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: response from server\r\n\t * @param: xml - XMLLoader object with response XML\r\n\t * @type: private\r\n\t */\r\n\tafterUpdate(that: any, xml: any, id?:any) {\r\n\t\tlet _xml;\r\n\t\tif (arguments.length === 3) {\r\n\t\t\t_xml = arguments[1];\r\n\t\t} else {\r\n\t\t\t// old dataprocessor\r\n\t\t\t_xml = arguments[4];\r\n\t\t}\r\n\t\tlet mode = this.getGanttMode();\r\n\t\tconst reqUrl = _xml.filePath || _xml.url;\r\n\r\n\t\tif (this._tMode !== \"REST\" && this._tMode !== \"REST-JSON\") {\r\n\t\t\tif (reqUrl.indexOf(\"gantt_mode=links\") !== -1) {\r\n\t\t\t\tmode = \"link\";\r\n\t\t\t} else if (reqUrl.indexOf(\"gantt_mode=assignments\") !== -1) {\r\n\t\t\t\tmode = \"assignment\";\r\n\t\t\t} else if (reqUrl.indexOf(\"gantt_mode=baselines\") !== -1) {\r\n\t\t\t\tmode = \"baseline\";\r\n\t\t\t} else {\r\n\t\t\t\tmode = \"task\";\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (reqUrl.indexOf(\"/link\") >= 0) {\r\n\t\t\t\tmode = \"link\";\r\n\t\t\t} else if(reqUrl.indexOf(\"/assignment\") >= 0){\r\n\t\t\t\tmode = \"assignment\";\r\n\t\t\t} else if(reqUrl.indexOf(\"/baseline\") >= 0){\r\n\t\t\t\tmode = \"baseline\";\r\n\t\t\t} else {\r\n\t\t\t\tmode = \"task\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.setGanttMode(mode);\r\n\r\n\t\tconst ajax = this.$gantt.ajax;\r\n\t\t// try to use json first\r\n\t\tlet tag;\r\n\r\n\t\ttry {\r\n\t\t\ttag = JSON.parse(xml.xmlDoc.responseText);\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\t} catch (e) {\r\n\r\n\t\t\t// empty response also can be processed by json handler\r\n\t\t\tif (!xml.xmlDoc.responseText.length) {\r\n\t\t\t\ttag = {};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst processCallback = (itemId: any) => {\r\n\t\t\tconst action = tag.action || this.getState(itemId) || \"updated\";\r\n\t\t\tconst sid = tag.sid || itemId[0];\r\n\t\t\tconst tid = tag.tid || itemId[0];\r\n\t\t\tthat.afterUpdateCallback(sid, tid, action, tag, mode);\r\n\t\t};\r\n\t\tif (tag) {\r\n\t\t\t// GS-753. When multiple tasks are updated, unhighlight all of them\r\n\t\t\tif (Array.isArray(id) && id.length > 1) {\r\n\t\t\t\tid.forEach((taskId) => processCallback(taskId));\r\n\t\t\t} else {\r\n\t\t\t\tprocessCallback(id);\r\n\t\t\t}\r\n\t\t\tthat.finalizeUpdate();\r\n\t\t\tthis.setGanttMode(mode);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// xml response\r\n\t\tconst top = ajax.xmltop(\"data\", xml.xmlDoc); // fix incorrect content type in IE\r\n\t\tif (!top) {\r\n\t\t\treturn this.cleanUpdate(id);\r\n\t\t}\r\n\t\tconst atag = ajax.xpath(\"//data/action\", top);\r\n\t\tif (!atag.length) {\r\n\t\t\treturn this.cleanUpdate(id);\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < atag.length; i++) {\r\n\t\t\tconst btag = atag[i];\r\n\t\t\tconst action = btag.getAttribute(\"type\");\r\n\t\t\tconst sid = btag.getAttribute(\"sid\");\r\n\t\t\tconst tid = btag.getAttribute(\"tid\");\r\n\r\n\t\t\tthat.afterUpdateCallback(sid, tid, action, btag, mode);\r\n\t\t}\r\n\t\tthat.finalizeUpdate();\r\n\t}\r\n\r\n\tcleanUpdate(id: any[]) {\r\n\t\tif (id) {\r\n\t\t\tfor (let i = 0; i < id.length; i++) {\r\n\t\t\t\tdelete this._in_progress[id[i]];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfinalizeUpdate() {\r\n\t\tif (this._waitMode) {\r\n\t\t\tthis._waitMode--;\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onAfterUpdateFinish\", []);\r\n\t\tif (!this.updatedRows.length) {\r\n\t\t\tthis.callEvent(\"onFullSync\", []);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @desc: initializes data-processor\r\n\t * @param: gantt - dhtmlxGantt object to attach this data-processor to\r\n\t * @type: public\r\n\t */\r\n\tinit(gantt: any) {\r\n\t\tif (this._initialized) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.$gantt = gantt;\r\n\t\tif (this.$gantt._dp_init) {\r\n\t\t\tthis.$gantt._dp_init(this);\r\n\t\t}\r\n\r\n\t\tthis._setDefaultTransactionMode();\r\n\r\n\t\tthis.styles = {\r\n\t\t\tupdated:\"gantt_updated\",\r\n\t\t\torder:\"gantt_updated\",\r\n\t\t\tinserted:\"gantt_inserted\",\r\n\t\t\tdeleted:\"gantt_deleted\",\r\n\t\t\tdelete_confirmation:\"gantt_deleted\",\r\n\t\t\tinvalid:\"gantt_invalid\",\r\n\t\t\terror:\"gantt_error\",\r\n\t\t\tclear:\"\"\r\n\t\t};\r\n\r\n\t\tthis._methods=[\"_row_style\",\"setCellTextStyle\",\"_change_id\",\"_delete_task\"];\r\n\t\textendGantt(this.$gantt, this);\r\n\t\tconst dataProcessorEvents = new DataProcessorEvents(this.$gantt, this);\r\n\t\tdataProcessorEvents.attach();\r\n\t\tthis.attachEvent(\"onDestroy\", function() {\r\n\t\t\tdelete this.setGanttMode;\r\n\t\t\tdelete this._getRowData;\r\n\r\n\t\t\tdelete this.$gantt._dp;\r\n\t\t\tdelete this.$gantt._change_id;\r\n\t\t\tdelete this.$gantt._row_style;\r\n\t\t\tdelete this.$gantt._delete_task;\r\n\t\t\tdelete this.$gantt._sendTaskOrder;\r\n\t\t\tdelete this.$gantt;\r\n\r\n\t\t\tdataProcessorEvents.detach();\r\n\t\t});\r\n\t\tthis.$gantt.callEvent(\"onDataProcessorReady\", [this]);\r\n\t\tthis._initialized = true;\r\n\t}\r\n\r\n\tsetOnAfterUpdate(handler) {\r\n\t\tthis.attachEvent(\"onAfterUpdate\", handler);\r\n\t}\r\n\r\n\tsetOnBeforeUpdateHandler(handler) {\r\n\t\tthis.attachEvent(\"onBeforeDataSending\", handler);\r\n\t}\r\n\r\n\t/* starts autoupdate mode\r\n\t\t@param interval time interval for sending update requests\r\n\t*/\r\n\tsetAutoUpdate(interval, user) {\r\n\t\tinterval = interval || 2000;\r\n\r\n\t\tthis._user = user || (new Date()).valueOf();\r\n\t\tthis._needUpdate = false;\r\n\r\n\t\tthis._updateBusy = false;\r\n\r\n\t\tthis.attachEvent(\"onAfterUpdate\", this.afterAutoUpdate); // arguments sid, action, tid, xml_node;\r\n\r\n\t\tthis.attachEvent(\"onFullSync\", this.fullSync);\r\n\r\n\t\tsetInterval(() => {\r\n\t\t\tthis.loadUpdate();\r\n\t\t}, interval);\r\n\t}\r\n\r\n\t/* process updating request response\r\n\t\tif status == collision version is deprecated\r\n\t\tset flag for autoupdating immediately\r\n\t*/\r\n\tafterAutoUpdate(sid, action, tid, xml_node) { // tslint:disable-line\r\n\t\tif (action === \"collision\") {\r\n\t\t\tthis._needUpdate = true;\r\n\t\t\treturn false;\r\n\t\t} else {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\t/* callback function for onFillSync event\r\n\t\tcall update function if it's need\r\n\t*/\r\n\tfullSync() {\r\n\t\tif (this._needUpdate) {\r\n\t\t\tthis._needUpdate = false;\r\n\t\t\tthis.loadUpdate();\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/* sends query to the server and call callback function\r\n\t*/\r\n\tgetUpdates(url, callback) {\r\n\t\tconst ajax = this.$gantt.ajax;\r\n\t\tif (this._updateBusy) {\r\n\t\t\treturn false;\r\n\t\t} else {\r\n\t\t\tthis._updateBusy = true;\r\n\t\t}\r\n\r\n\t\tajax.get(url, callback);\r\n\r\n\t}\r\n\r\n\t/* loads updates and processes them\r\n\t*/\r\n\tloadUpdate() {\r\n\t\tconst ajax = this.$gantt.ajax;\r\n\t\tconst version = this.$gantt.getUserData(0, \"version\", this._ganttMode);\r\n\t\tlet url = this.serverProcessor + ajax.urlSeparator(this.serverProcessor) + [\"dhx_user=\" + this._user, \"dhx_version=\" + version].join(\"&\");\r\n\t\turl = url.replace(\"editing=true&\", \"\");\r\n\t\tthis.getUpdates(url, (xml) => {\r\n\t\t\tconst vers = ajax.xpath(\"//userdata\", xml);\r\n\t\t\tthis.$gantt.setUserData(0, \"version\", this._getXmlNodeValue(vers[0]), this._ganttMode);\r\n\r\n\t\t\tconst updates = ajax.xpath(\"//update\", xml);\r\n\t\t\tif (updates.length) {\r\n\t\t\t\tthis._silent_mode = true;\r\n\r\n\t\t\t\tfor (let i = 0; i < updates.length; i++) {\r\n\t\t\t\t\tconst status = updates[i].getAttribute(\"status\");\r\n\t\t\t\t\tconst id = updates[i].getAttribute(\"id\");\r\n\t\t\t\t\tconst parent = updates[i].getAttribute(\"parent\");\r\n\t\t\t\t\tswitch (status) {\r\n\t\t\t\t\t\tcase \"inserted\":\r\n\t\t\t\t\t\t\tthis.callEvent(\"insertCallback\", [updates[i], id, parent]);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"updated\":\r\n\t\t\t\t\t\t\tthis.callEvent(\"updateCallback\", [updates[i], id, parent]);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"deleted\":\r\n\t\t\t\t\t\t\tthis.callEvent(\"deleteCallback\", [updates[i], id, parent]);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._silent_mode = false;\r\n\t\t\t}\r\n\r\n\t\t\tthis._updateBusy = false;\r\n\t\t});\r\n\t}\r\n\r\n\tdestructor() {\r\n\t\tthis.callEvent(\"onDestroy\", []);\r\n\t\tthis.detachAllEvents();\r\n\r\n\t\tthis.updatedRows = [];\r\n\t\tthis._in_progress = {}; // ?\r\n\t\tthis._invalid = {};\r\n\t\tthis._storage.clear();\r\n\t\tthis._storage = null;\r\n\t\tthis._headers = null;\r\n\t\tthis._payload = null;\r\n\t\tdelete this._initialized;\r\n\t}\r\n\r\n\tsetGanttMode(mode) {\r\n\t\tif (mode === \"tasks\") {\r\n\t\t\tmode = \"task\";\r\n\t\t} else if (mode === \"links\") {\r\n\t\t\tmode = \"link\";\r\n\t\t}\r\n\r\n\t\tconst modes = this.modes || {};\r\n\t\tconst ganttMode = this.getGanttMode();\r\n\t\tif (ganttMode) {\r\n\t\t\tmodes[ganttMode] = {\r\n\t\t\t\t_in_progress : this._in_progress,\r\n\t\t\t\t_invalid: this._invalid,\r\n\t\t\t\t_storage: this._storage,\r\n\t\t\t\tupdatedRows : this.updatedRows\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tlet newState = modes[mode];\r\n\t\tif (!newState) {\r\n\t\t\tnewState = modes[mode] = {\r\n\t\t\t\t_in_progress : {},\r\n\t\t\t\t_invalid : {},\r\n\t\t\t\t_storage : SimpleStorage.create(),\r\n\t\t\t\tupdatedRows : []\r\n\t\t\t};\r\n\t\t}\r\n\t\tthis._in_progress = newState._in_progress;\r\n\t\tthis._invalid = newState._invalid;\r\n\t\tthis._storage = newState._storage;\r\n\t\tthis.updatedRows = newState.updatedRows;\r\n\t\tthis.modes = modes;\r\n\t\tthis._ganttMode = mode;\r\n\t}\r\n\tgetGanttMode():string {\r\n\t\treturn this._ganttMode;\r\n\t}\r\n\r\n\tstoreItem(item) {\r\n\t\tthis._storage.storeItem(item);\r\n\t}\r\n\r\n\turl(url: string) {\r\n\t\tthis.serverProcessor = this._serverProcessor = url;\r\n\t}\r\n\r\n\tprotected _beforeSendData(data: any, rowId: any) {\r\n\t\tif (!this.callEvent(\"onBeforeUpdate\", [rowId, this.getState(rowId), data])) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tthis._sendData(data, rowId);\r\n\t}\r\n\r\n\tprotected _serializeAsJSON(data: any) {\r\n\t\tif (typeof data === \"string\") {\r\n\t\t\treturn data;\r\n\t\t}\r\n\r\n\t\tconst copy = utils.copy(data);\r\n\t\tif (this._tMode === \"REST-JSON\") {\r\n\t\t\tdelete copy.id;\r\n\t\t\tdelete copy[this.action_param];\r\n\t\t}\r\n\r\n\t\treturn JSON.stringify(copy);\r\n\t}\r\n\r\n\tprotected _applyPayload(url: string) {\r\n\t\tconst ajax = this.$gantt.ajax;\r\n\t\tif (this._payload) {\r\n\t\t\tfor (const key in this._payload) {\r\n\t\t\t\turl = url + ajax.urlSeparator(url) + this.escape(key) + \"=\" + this.escape(this._payload[key]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn url;\r\n\t}\r\n\r\n\t// GET/POST/JSON modes of the dataProcessor didn't send the whole data items in 'delete' requests\r\n\t// clear extra info from the data in order not to change the request format\r\n\tprotected _cleanupArgumentsBeforeSend(dataToSend: any) {\r\n\t\tlet processedData;\r\n\t\tif(dataToSend[this.action_param] === undefined){// hash of updated items, and not an individual item\r\n\t\t\tprocessedData = {};\r\n\t\t\tfor(const i in dataToSend) {\r\n\t\t\t\tprocessedData[i] = this._cleanupArgumentsBeforeSend(dataToSend[i]);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tprocessedData = this._cleanupItemBeforeSend(dataToSend);\r\n\t\t}\r\n\t\treturn processedData;\r\n\t}\r\n\tprotected _cleanupItemBeforeSend(updatedItem: any) {\r\n\t\tlet output = null;\r\n\t\tif(updatedItem){\r\n\t\t\tif(updatedItem[this.action_param] === \"deleted\"){\r\n\t\t\t\toutput = {};\r\n\t\t\t\toutput.id = updatedItem.id;\r\n\t\t\t\toutput[this.action_param] = updatedItem[this.action_param];\r\n\t\t\t}else{\r\n\t\t\t\toutput = updatedItem;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn output;\r\n\t}\r\n\r\n\tprotected _sendData(dataToSend: any, rowId?: any) {\r\n\t\tif (!dataToSend) {\r\n\t\t\treturn; // nothing to send\r\n\t\t}\r\n\t\tif (!this.callEvent(\"onBeforeDataSending\", rowId ? [rowId, this.getState(rowId), dataToSend] : [null, null, dataToSend])) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (rowId) {\r\n\t\t\tthis._in_progress[rowId] = (new Date()).valueOf();\r\n\t\t}\r\n\r\n\t\tconst ajax = this.$gantt.ajax;\r\n\r\n\t\tif (this._tMode === \"CUSTOM\") {\r\n\t\t\tconst taskState = this.getState(rowId);\r\n\t\t\tconst taskAction = this.getActionByState(taskState);\r\n\t\t\tconst ganttMode = this.getGanttMode();\r\n\t\t\tconst _onResolvedCreateUpdate = (tag) => {\r\n\t\t\t\tlet action = taskState || \"updated\";\r\n\t\t\t\tlet sid = rowId;\r\n\t\t\t\tlet tid = rowId;\r\n\r\n\t\t\t\tif (tag) {\r\n\t\t\t\t\taction = tag.action || taskState;\r\n\t\t\t\t\tsid = tag.sid || sid;\r\n\t\t\t\t\ttid = tag.id || tag.tid || tid;\r\n\t\t\t\t}\r\n\t\t\t\tthis.afterUpdateCallback(sid, tid, action, tag, ganttMode);\r\n\t\t\t};\r\n\r\n\t\t\tlet actionPromise;\r\n\t\t\tif (this._router instanceof Function) {\r\n\t\t\t\tif(this._routerParametersFormat === \"object\"){\r\n\t\t\t\t\tconst obj = {\r\n\t\t\t\t\t\tentity: ganttMode,\r\n\t\t\t\t\t\taction: taskAction,\r\n\t\t\t\t\t\tdata: dataToSend,\r\n\t\t\t\t\t\tid: rowId\r\n\t\t\t\t\t};\r\n\t\t\t\t\tactionPromise = this._router(obj);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tactionPromise = this._router(ganttMode, taskAction, dataToSend, rowId);\r\n\t\t\t\t}\r\n\t\t\t} else if (this._router[ganttMode] instanceof Function) {\r\n\t\t\t\tactionPromise = this._router[ganttMode](taskAction, dataToSend, rowId);\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconst errorMsgStart = \"Incorrect configuration of gantt.createDataProcessor\";\r\n\t\t\t\tconst errorMsgEnd = `\r\nYou need to either add missing properties to the dataProcessor router object or to use a router function.\r\nSee https://docs.dhtmlx.com/gantt/desktop__server_side.html#customrouting and https://docs.dhtmlx.com/gantt/api__gantt_createdataprocessor.html for details.`;\r\n\r\n\t\t\t\tif(!this._router[ganttMode]){\r\n\t\t\t\t\tthrow new Error(`${errorMsgStart}: router for the **${ganttMode}** entity is not defined. ${errorMsgEnd}`);\r\n\t\t\t\t}\r\n\t\t\t\tswitch (taskState) {\r\n\t\t\t\t\tcase \"inserted\":\r\n\t\t\t\t\t\tif(!this._router[ganttMode].create){\r\n\t\t\t\t\t\t\tthrow new Error(`${errorMsgStart}: **create** action for the **${ganttMode}** entity is not defined. ${errorMsgEnd}`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tactionPromise = this._router[ganttMode].create(dataToSend);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"deleted\":\r\n\t\t\t\t\t\tif(!this._router[ganttMode].delete){\r\n\t\t\t\t\t\t\tthrow new Error(`${errorMsgStart}: **delete** action for the **${ganttMode}** entity is not defined. ${errorMsgEnd}`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tactionPromise = this._router[ganttMode].delete(rowId);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tif(!this._router[ganttMode].update){\r\n\t\t\t\t\t\t\tthrow new Error(`${errorMsgStart}: **update**\" action for the **${ganttMode}** entity is not defined. ${errorMsgEnd}`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tactionPromise = this._router[ganttMode].update(dataToSend, rowId);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(actionPromise){\r\n\t\t\t\t// neither promise nor {tid: newId} response object\r\n\t\t\t\tif(!actionPromise.then &&\r\n\t\t\t\t\t(actionPromise.id === undefined && actionPromise.tid === undefined && actionPromise.action === undefined)){\r\n\t\t\t\t\tthrow new Error(\"Incorrect router return value. A Promise or a response object is expected\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(actionPromise.then){\r\n\t\t\t\t\tactionPromise.then(_onResolvedCreateUpdate).catch((error) => {\r\n\t\t\t\t\t\tif(error && error.action){\r\n\t\t\t\t\t\t\t_onResolvedCreateUpdate(error);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t_onResolvedCreateUpdate({ action: \"error\", value: error});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\t// custom method may return a response object in case of sync action\r\n\t\t\t\t\t_onResolvedCreateUpdate(actionPromise);\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\t_onResolvedCreateUpdate(null);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet queryParams: any;\r\n\t\tqueryParams = {\r\n\t\t\tcallback: (xml) => {\r\n\t\t\t\tconst ids = [];\r\n\r\n\t\t\t\tif (rowId) {\r\n\t\t\t\t\tids.push(rowId);\r\n\t\t\t\t} else if (dataToSend) {\r\n\t\t\t\t\tfor (const key in dataToSend) {\r\n\t\t\t\t\t\tids.push(key);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn this.afterUpdate(this, xml, ids);\r\n\t\t\t},\r\n\t\t\theaders: this._headers\r\n\t\t};\r\n\r\n\t\tconst dhxVersion = \"dhx_version=\" + this.$gantt.getUserData(0, \"version\", this._ganttMode);\r\n\t\tconst urlParams = this.serverProcessor + (this._user ? (ajax.urlSeparator(this.serverProcessor) + [\"dhx_user=\" + this._user, dhxVersion].join(\"&\")) : \"\");\r\n\t\tlet url: any = this._applyPayload(urlParams);\r\n\t\tlet data;\r\n\r\n\t\tswitch (this._tMode) {\r\n\t\t\tcase \"GET\":\r\n\t\t\t\tdata = this._cleanupArgumentsBeforeSend(dataToSend);\r\n\t\t\t\tqueryParams.url = url + ajax.urlSeparator(url) + this.serialize(data, rowId);\r\n\t\t\t\tqueryParams.method = \"GET\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"POST\":\r\n\t\t\t\tdata = this._cleanupArgumentsBeforeSend(dataToSend);\r\n\t\t\t\tqueryParams.url = url;\r\n\t\t\t\tqueryParams.method = \"POST\";\r\n\t\t\t\tqueryParams.data = this.serialize(data, rowId);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"JSON\":\r\n\t\t\t\tdata = {};\r\n\t\t\t\tconst preprocessedData = this._cleanupItemBeforeSend(dataToSend);\r\n\t\t\t\tfor (const key in preprocessedData) {\r\n\t\t\t\t\tif (key === this.action_param || key === \"id\" || key === \"gr_id\") {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdata[key] = preprocessedData[key];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tqueryParams.url = url;\r\n\t\t\t\tqueryParams.method = \"POST\";\r\n\t\t\t\tqueryParams.data = JSON.stringify({\r\n\t\t\t\t\tid: rowId,\r\n\t\t\t\t\taction: dataToSend[this.action_param],\r\n\t\t\t\t\tdata\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"REST\":\r\n\t\t\tcase \"REST-JSON\":\r\n\t\t\t\turl = urlParams.replace(/(&|\\?)editing=true/, \"\");\r\n\t\t\t\tdata = \"\";\r\n\r\n\t\t\t\tswitch (this.getState(rowId)) {\r\n\t\t\t\t\tcase \"inserted\":\r\n\t\t\t\t\t\tqueryParams.method = \"POST\";\r\n\t\t\t\t\t\tqueryParams.data = this.serialize(dataToSend, rowId);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"deleted\":\r\n\t\t\t\t\t\tqueryParams.method = \"DELETE\";\r\n\t\t\t\t\t\turl = url + (url.slice(-1) === \"/\" ? \"\" : \"/\") + rowId;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tqueryParams.method = \"PUT\";\r\n\t\t\t\t\t\tqueryParams.data = this.serialize(dataToSend, rowId);\r\n\t\t\t\t\t\turl = url + (url.slice(-1) === \"/\" ? \"\" : \"/\") + rowId;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tqueryParams.url = this._applyPayload(url);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tthis._waitMode++;\r\n\t\treturn ajax.query(queryParams);\r\n\t}\r\n\r\n\tprotected _forEachUpdatedRow(code: any) {\r\n\t\tconst updatedRows = this.updatedRows.slice();\r\n\t\tfor (let i = 0; i < updatedRows.length; i++) {\r\n\t\t\tconst rowId = updatedRows[i];\r\n\t\t\tif (this.$gantt.getUserData(rowId, this.action_param, this._ganttMode)) {\r\n\t\t\t\tcode.call(this, rowId);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _setDefaultTransactionMode() {\r\n\t\tif (this.serverProcessor) {\r\n\t\t\tthis.setTransactionMode(\"POST\", true);\r\n\t\t\tthis.serverProcessor += (this.serverProcessor.indexOf(\"?\") !== -1 ? \"&\" : \"?\") + \"editing=true\";\r\n\t\t\tthis._serverProcessor = this.serverProcessor;\r\n\t\t}\r\n\t}\r\n\r\n\t/* returns xml node value\r\n\t\t@param node\r\n\t\t\txml node\r\n\t*/\r\n\tprotected _getXmlNodeValue(node) {\r\n\t\tif (node.firstChild) {\r\n\t\t\treturn node.firstChild.nodeValue;\r\n\t\t}\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tprotected _getAllData() {\r\n\t\tconst out = {};\r\n\t\tlet hasOne = false;\r\n\r\n\t\tthis._forEachUpdatedRow(function(id) {\r\n\t\t\tif (this._in_progress[id] || this.is_invalid(id)){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst row = this._getRowData(id);\r\n\t\t\tif (!this.callEvent(\"onBeforeUpdate\", [id, this.getState(id), row])) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tout[id] = row;\r\n\t\t\thasOne = true;\r\n\t\t\tthis._in_progress[id] = (new Date()).valueOf();\r\n\t\t});\r\n\r\n\t\treturn hasOne ? out : null;\r\n\t}\r\n\r\n\tprotected _prepareDate(value: Date) : string {\r\n\t\treturn this.$gantt.defined(this.$gantt.templates.xml_format) ? this.$gantt.templates.xml_format(value) : this.$gantt.templates.format_date(value);\r\n\t}\r\n\r\n\tprotected _prepareArray(value: any[], traversedObjects: object[]) : any[] {\r\n\t\ttraversedObjects.push(value);\r\n\r\n\t\treturn value.map((item) => {\r\n\t\t\tif(helpers.isDate(item)){\r\n\t\t\t\treturn this._prepareDate(item);\r\n\t\t\t} else if (Array.isArray(item) && !helpers.arrayIncludes(traversedObjects, item)){\r\n\t\t\t\treturn this._prepareArray(item, traversedObjects);\r\n\t\t\t} else if (item && typeof item === \"object\" && !helpers.arrayIncludes(traversedObjects, item)) {\r\n\t\t\t\treturn this._prepareObject(item, traversedObjects);\r\n\t\t\t} else {\r\n\t\t\t\treturn item;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected _prepareObject(rawItem: any, traversedObjects: object[]) : any {\r\n\t\tconst processedItem = {};\r\n\t\ttraversedObjects.push(rawItem);\r\n\r\n\t\tfor (const key in rawItem) {\r\n\t\t\tif (key.substr(0, 1) === \"$\") {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tconst value = rawItem[key];\r\n\t\t\tif (helpers.isDate(value)) {\r\n\t\t\t\tprocessedItem[key] = this._prepareDate(value);\r\n\t\t\t} else if(value === null) {\r\n\t\t\t\tprocessedItem[key] = \"\";\r\n\t\t\t} else if (Array.isArray(value) && !helpers.arrayIncludes(traversedObjects, value)){\r\n\t\t\t\tprocessedItem[key] = this._prepareArray(value, traversedObjects);\r\n\t\t\t} else if (value && typeof value === \"object\" && !helpers.arrayIncludes(traversedObjects, value)) {\r\n\t\t\t\tprocessedItem[key] = this._prepareObject(value, traversedObjects);\r\n\t\t\t} else {\r\n\t\t\t\tprocessedItem[key] = value;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn processedItem;\r\n\t}\r\n\r\n\tprotected _prepareDataItem(rawItem: any): any {\r\n\t\tconst processedItem = this._prepareObject(rawItem, []);\r\n\r\n\t\tprocessedItem[this.action_param] = this.$gantt.getUserData(rawItem.id, this.action_param, this._ganttMode);\r\n\t\treturn processedItem;\r\n\t}\r\n\r\n\tprotected getStoredItem(id){\r\n\t\treturn this._storage.getStoredItem(id);\r\n\t}\r\n\r\n\tprotected _getRowData(id) {\r\n\t\tlet dataItem;\r\n\t\tconst gantt = this.$gantt;\r\n\t\tif (this.getGanttMode() === \"task\") {\r\n\t\t\tif(gantt.isTaskExists(id)){\r\n\t\t\t\tdataItem =this.$gantt.getTask(id);\r\n\t\t\t}\r\n\t\t} else if (this.getGanttMode() === \"assignment\") {\r\n\t\t\tif(this.$gantt.$data.assignmentsStore.exists(id)){\r\n\t\t\t\tdataItem =this.$gantt.$data.assignmentsStore.getItem(id);\r\n\t\t\t}\r\n\t\t} else if (this.getGanttMode() === \"baseline\") {\r\n\t\t\tif(this.$gantt.$data.baselineStore.exists(id)){\r\n\t\t\t\tdataItem =this.$gantt.$data.baselineStore.getItem(id);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(gantt.isLinkExists(id)){\r\n\t\t\t\tdataItem =this.$gantt.getLink(id);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!dataItem) {\r\n\t\t\tdataItem = this.getStoredItem(id);\r\n\t\t}\r\n\r\n\t\tif (!dataItem) {\r\n\t\t\tdataItem = { id };\r\n\t\t}\r\n\r\n\t\treturn this._prepareDataItem(dataItem);\r\n\t}\r\n}","import * as DataProcessor from \"./data_processor\";\r\nexport default {\r\n\tDEPRECATED_api: function(server) {\r\n\t\treturn new (DataProcessor.DataProcessor)(server);\r\n\t},\r\n\tcreateDataProcessor: DataProcessor.createDataProcessor\r\n};","import global from \"../../utils/global\";\r\n\r\nfunction createMethod(gantt){\r\n\tvar methods = {};\r\n\tvar isActive = false;\r\n\tfunction disableMethod(methodName, dummyMethod){\r\n\t\tdummyMethod = typeof dummyMethod == \"function\" ? dummyMethod : function(){};\r\n\r\n\t\tif(!methods[methodName]){\r\n\t\t\tmethods[methodName] = this[methodName];\r\n\t\t\tthis[methodName] = dummyMethod;\r\n\t\t}\r\n\t}\r\n\tfunction restoreMethod(methodName){\r\n\t\tif(methods[methodName]){\r\n\t\t\tthis[methodName] = methods[methodName];\r\n\t\t\tmethods[methodName] = null;\r\n\t\t}\r\n\t}\r\n\tfunction disableMethods(methodsHash){\r\n\t\tfor(var i in methodsHash){\r\n\t\t\tdisableMethod.call(this, i, methodsHash[i]);\r\n\t\t}\r\n\t}\r\n\tfunction restoreMethods(){\r\n\t\tfor(var i in methods){\r\n\t\t\trestoreMethod.call(this, i);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction batchUpdatePayload(callback){\r\n\t\ttry{\r\n\t\t\tcallback();\r\n\t\t}catch(e){\r\n\t\t\tglobal.console.error(e);\r\n\t\t}\r\n\t}\r\n\r\n\tvar state = gantt.$services.getService(\"state\");\r\n\tstate.registerProvider(\"batchUpdate\", function(){\r\n\t\treturn {\r\n\t\t\tbatch_update: isActive\r\n\t\t};\r\n\t}, false);\r\n\r\n\treturn function batchUpdate(callback, noRedraw) {\r\n\t\tif(isActive){\r\n\t\t\t// batch mode is already active\r\n\t\t\tbatchUpdatePayload(callback);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar call_dp = (this._dp && this._dp.updateMode != \"off\");\r\n\t\tvar dp_mode;\r\n\t\tif (call_dp){\r\n\t\t\tdp_mode = this._dp.updateMode;\r\n\t\t\tthis._dp.setUpdateMode(\"off\");\r\n\t\t}\r\n\r\n\t\t// temporary disable some methods while updating multiple tasks\r\n\t\tvar resetProjects = {};\r\n\t\tvar methods = {\r\n\t\t\t\"render\":true,\r\n\t\t\t\"refreshData\":true,\r\n\t\t\t\"refreshTask\":true,\r\n\t\t\t\"refreshLink\":true,\r\n\t\t\t\"resetProjectDates\":function(task){\r\n\t\t\t\tresetProjects[task.id] = task;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tdisableMethods.call(this, methods);\r\n\r\n\t\tisActive = true;\r\n\t\tthis.callEvent(\"onBeforeBatchUpdate\", []);\r\n\r\n\t\tbatchUpdatePayload(callback);\r\n\r\n\t\tthis.callEvent(\"onAfterBatchUpdate\", []);\r\n\r\n\t\trestoreMethods.call(this);\r\n\r\n\t\t// do required updates after changes applied\r\n\t\tfor(var i in resetProjects){\r\n\t\t\tthis.resetProjectDates(resetProjects[i]);\r\n\t\t}\r\n\r\n\t\tisActive = false;\r\n\r\n\t\tif(!noRedraw){\r\n\t\t\tthis.render();\r\n\t\t}\r\n\r\n\t\tif (call_dp) {\r\n\t\t\tthis._dp.setUpdateMode(dp_mode);\r\n\t\t\tthis._dp.setGanttMode(\"task\");\r\n\t\t\tthis._dp.sendData();\r\n\t\t\tthis._dp.setGanttMode(\"link\");\r\n\t\t\tthis._dp.sendData();\r\n\t\t}\r\n\t};\r\n\r\n\r\n\r\n}\r\n\r\nexport default function(gantt){\r\n\tgantt.batchUpdate = createMethod(gantt);\r\n};","const createWbs = (function(gantt){\r\n\treturn {\r\n\t_needRecalc: true,\r\n\treset: function(){\r\n\t\tthis._needRecalc = true;\r\n\t},\r\n\t_isRecalcNeeded: function(){\r\n\t\treturn (!this._isGroupSort() && this._needRecalc);\r\n\t},\r\n\t_isGroupSort: function() {\r\n\t\treturn !!(gantt.getState().group_mode);\r\n\t},\r\n\t_getWBSCode: function(task) {\r\n\t\tif(!task) return \"\";\r\n\r\n\t\tif(this._isRecalcNeeded()){\r\n\t\t\tthis._calcWBS();\r\n\t\t}\r\n\r\n\t\tif(task.$virtual) return \"\";\r\n\t\tif(this._isGroupSort()) return task.$wbs || \"\";\r\n\r\n\t\tif(!task.$wbs) {\r\n\t\t\tthis.reset();\r\n\t\t\tthis._calcWBS();\r\n\t\t}\r\n\t\treturn task.$wbs;\r\n\t},\r\n\t_setWBSCode: function(task, value) {\r\n\t\ttask.$wbs = value;\r\n\t},\r\n\tgetWBSCode: function(task) {\r\n\t\treturn this._getWBSCode(task);\r\n\t},\r\n\tgetByWBSCode: function(code){\r\n\t\tlet parts = code.split(\".\");\r\n\t\tlet currentNode = gantt.config.root_id;\r\n\t\tfor(let i = 0; i < parts.length; i++){\r\n\t\t\tconst children = gantt.getChildren(currentNode);\r\n\t\t\tlet index = parts[i]*1 - 1;\r\n\t\t\tif(gantt.isTaskExists(children[index])){\r\n\t\t\t\tcurrentNode = children[index];\r\n\t\t\t}else{\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(gantt.isTaskExists(currentNode)){\r\n\t\t\treturn gantt.getTask(currentNode);\r\n\t\t}else{\r\n\t\t\treturn null;\r\n\t\t}\r\n\t},\r\n\t_calcWBS: function() {\r\n\t\tif(!this._isRecalcNeeded()) return;\r\n\r\n\t\tlet _isFirst = true;\r\n\t\tgantt.eachTask(function(ch) {\r\n\t\t\tif(ch.type == gantt.config.types.placeholder) return;\r\n\t\t\tif(_isFirst) {\r\n\t\t\t\t_isFirst = false;\r\n\t\t\t\tthis._setWBSCode(ch, \"1\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst _prevSibling = this._getPrevNonPlaceholderSibling(ch.id);\r\n\t\t\tif (_prevSibling !== null) {\r\n\t\t\t\tthis._increaseWBS(ch, _prevSibling);\r\n\t\t\t} else {\r\n\t\t\t\tlet _parent = gantt.getParent(ch.id);\r\n\t\t\t\tthis._setWBSCode(ch, gantt.getTask(_parent).$wbs + \".1\");\r\n\t\t\t}\r\n\t\t}, gantt.config.root_id, this);\r\n\r\n\t\tthis._needRecalc = false;\r\n\t},\r\n\t_increaseWBS: function(task, siblingiId){\r\n\t\tlet _wbs = gantt.getTask(siblingiId).$wbs;\r\n\t\tif(_wbs) {\r\n\t\t\t_wbs = _wbs.split(\".\");\r\n\t\t\t_wbs[_wbs.length-1]++;\r\n\t\t\tthis._setWBSCode(task, _wbs.join(\".\"));\r\n\t\t}\r\n\t},\r\n\t_getPrevNonPlaceholderSibling: function(childId) {\r\n\t\tlet prevSibling;\r\n\t\tlet currentId = childId;\r\n\t\tdo {\r\n\t\t\tprevSibling = gantt.getPrevSibling(currentId);\r\n\t\t\tcurrentId = prevSibling;\r\n\t\t} while (prevSibling !== null && gantt.getTask(prevSibling).type == gantt.config.types.placeholder);\r\n\t\treturn prevSibling;\r\n   }\r\n};\r\n});\r\n\r\nexport default function(gantt){\r\n\tconst wbs = createWbs(gantt);\r\n\tgantt.getWBSCode = function getWBSCode(task) {\r\n\t\treturn wbs.getWBSCode(task);\r\n\t};\r\n\r\n\tgantt.getTaskByWBSCode = function(code) {\r\n\t\treturn wbs.getByWBSCode(code);\r\n\t};\r\n\r\n\tfunction resetCache(){\r\n\t\twbs.reset();\r\n\t\treturn true;\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onAfterTaskMove\", resetCache);\r\n\tgantt.attachEvent(\"onBeforeParse\", resetCache);\r\n\tgantt.attachEvent(\"onAfterTaskDelete\", resetCache);\r\n\tgantt.attachEvent(\"onAfterTaskAdd\", resetCache);\r\n\tgantt.attachEvent(\"onAfterSort\", resetCache);\r\n\r\n};\r\n","import * as helpers from \"../../utils/helpers\";\r\nimport * as dom_helpers from \"../ui/utils/dom_helpers\";\r\nfunction createResourceMethods(gantt){\r\n\r\n\tvar resourceTaskCache = {};\r\n\tvar singleResourceCacheBuilt = false;\r\n\r\n\tgantt.$data.tasksStore.attachEvent(\"onStoreUpdated\", function(){\r\n\t\tresourceTaskCache = {};\r\n\t\tsingleResourceCacheBuilt = false;\r\n\t});\r\n\tgantt.attachEvent(\"onBeforeGanttRender\", function(){\r\n\t\tresourceTaskCache = {};\r\n\t});\r\n\r\n\tfunction getTaskBy(propertyName, propertyValue, typeFilter) {\r\n\t\tif (typeof propertyName == \"function\") {\r\n\t\t\treturn filterResourceTasks(propertyName);\r\n\t\t} else {\r\n\t\t\tif (helpers.isArray(propertyValue)) {\r\n\t\t\t\treturn getResourceTasks(propertyName, propertyValue, typeFilter);\r\n\t\t\t} else {\r\n\t\t\t\treturn getResourceTasks(propertyName, [propertyValue], typeFilter);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction filterResourceTasks(filter) {\r\n\t\tvar res = [];\r\n\t\tgantt.eachTask(function (task) {\r\n\t\t\tif (filter(task)) {\r\n\t\t\t\tres.push(task);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn res;\r\n\t}\r\n\r\n\tvar falsyValuePrefix = String(Math.random());\r\n\tfunction resourceHashFunction(value){\r\n\t\tif (value === null){\r\n\t\t\treturn falsyValuePrefix + String(value);\r\n\t\t}\r\n\t\treturn String(value);\r\n\t}\r\n\r\n\tfunction getCacheKey(resourceIds, property, typeFilter) {\r\n\t\tif (Array.isArray(resourceIds)) {\r\n\t\t\treturn resourceIds.map(function (value) {\r\n\t\t\t\treturn resourceHashFunction(value);\r\n\t\t\t}).join(\"_\") + `_${property}_${typeFilter}`;\r\n\t\t} else {\r\n\t\t\treturn resourceHashFunction(resourceIds) + `_${property}_${typeFilter}`;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getResourceTasks(property, resourceIds, typeFilter) {\r\n\t\tvar res;\r\n\t\tvar cacheKey = getCacheKey(resourceIds, property, JSON.stringify(typeFilter));\r\n\t\tvar matchingResources = {};\r\n\t\thelpers.forEach(resourceIds, function(resourceId) {\r\n\t\t\tmatchingResources[resourceHashFunction(resourceId)] = true;\r\n\t\t});\r\n\r\n\t\tif (!resourceTaskCache[cacheKey]) {\r\n\t\t\tres = resourceTaskCache[cacheKey] = [];\r\n\t\t\tgantt.eachTask(function (task) {\r\n\t\t\t\tif (typeFilter) {\r\n\t\t\t\t\tif (!typeFilter[gantt.getTaskType(task)]) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (task.type == gantt.config.types.project) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (property in task) {\r\n\t\t\t\t\tvar resourceValue;\r\n\t\t\t\t\tif (!helpers.isArray(task[property])) {\r\n\t\t\t\t\t\tresourceValue = [task[property]];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresourceValue = task[property];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\thelpers.forEach(resourceValue, function(value) {\r\n\t\t\t\t\t\tvar resourceValue = (value && value.resource_id) ? value.resource_id : value;\r\n\r\n\t\t\t\t\t\tif (matchingResources[resourceHashFunction(resourceValue)]) {\r\n\t\t\t\t\t\t\tres.push(task);\r\n\t\t\t\t\t\t}else if(!singleResourceCacheBuilt){\r\n\r\n\t\t\t\t\t\t\tvar key = getCacheKey(value, property);\r\n\t\t\t\t\t\t\tif(!resourceTaskCache[key]){\r\n\t\t\t\t\t\t\t\tresourceTaskCache[key] = [];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tresourceTaskCache[key].push(task);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tsingleResourceCacheBuilt = true;\r\n\t\t} else {\r\n\t\t\tres = resourceTaskCache[cacheKey];\r\n\t\t}\r\n\r\n\t\treturn res;\r\n\t}\r\n\r\n\tfunction selectAssignments(resourceId, taskId, result){\r\n\t\tvar property = gantt.config.resource_property;\r\n\t\tvar owners = [];\r\n\t\tif (gantt.getDatastore(\"task\").exists(taskId)) {\r\n\t\t\tvar task = gantt.getTask(taskId);\r\n\t\t\towners = task[property] || [];\r\n\t\t}\r\n\r\n\t\tif (!Array.isArray(owners)) {\r\n\t\t\towners = [owners];\r\n\t\t}\r\n\t\tfor (var i = 0; i < owners.length; i++) {\r\n\t\t\tif (owners[i].resource_id == resourceId) {\r\n\t\t\t\tresult.push({task_id: task.id, resource_id:owners[i].resource_id, value:owners[i].value});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getResourceAssignments(resourceId, taskId){\r\n\t\t// resource assignment as an independent module:\r\n\t\t// {taskId:, resourceId, value}\r\n\t\t// TODO: probably should add a separate datastore for these\r\n\t\tvar assignments = [];\r\n\t\tvar property = gantt.config.resource_property;\r\n\t\tif(taskId !== undefined){\r\n\t\t\tselectAssignments(resourceId, taskId, assignments);\r\n\t\t}else{\r\n\t\t\tvar tasks = gantt.getTaskBy(property, resourceId);\r\n\t\t\ttasks.forEach(function(task){\r\n\t\t\t\tselectAssignments(resourceId, task.id, assignments);\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn assignments;\r\n\t}\r\n\r\n\treturn {\r\n\t\tgetTaskBy: getTaskBy,\r\n\t\tgetResourceAssignments: getResourceAssignments\r\n\t};\r\n}\r\n\r\nfunction createHelper(gantt){\r\n\tconst resourcePlugin = {\r\n\t\trenderEditableLabel: function(start_date, end_date, resource, tasks, assignments){\r\n\t\t\tconst editable = gantt.config.readonly ? \"\" : \"contenteditable\";\r\n\t\t\tif(start_date < resource.end_date && end_date > resource.start_date){\r\n\t\t\t\tfor(let i = 0; i < assignments.length; i++){\r\n\t\t\t\t\tconst a = assignments[i];\r\n\t\t\t\t\t\treturn \"<div \"+editable+\" data-assignment-cell data-assignment-id='\"+a.id+\"'\"+\r\n\t\t\t\t\t\t\" data-row-id='\"+resource.id+\"'\"+\r\n\t\t\t\t\t\t\" data-task='\"+resource.$task_id+\"'\"+\r\n\t\t\t\t\t\t\" data-start-date='\"+gantt.templates.format_date(start_date)+\"'\"+\r\n\t\t\t\t\t\t\" data-end-date='\"+gantt.templates.format_date(end_date)+\"'>\" + a.value + \"</div>\";\r\n\t\t\t\t}\r\n\t\t\t\treturn \"<div \"+editable+\" data-assignment-cell data-empty \"+ \r\n\t\t\t\t\t\t\" data-row-id='\"+resource.id+\"'\"+\r\n\t\t\t\t\t\t\" data-resource-id='\"+resource.$resource_id+\"'\"+\r\n\t\t\t\t\t\t\" data-task='\"+resource.$task_id+\"'\"+\r\n\t\t\t\t\t\t\" data-start-date='\"+gantt.templates.format_date(start_date)+\"'\"+\r\n\t\t\t\t\t\t\"'  data-end-date='\"+gantt.templates.format_date(end_date)+\"'>-</div>\";\r\n\t\t\t}\r\n\t\t\treturn \"\";\r\n\t\t},\r\n\t\trenderSummaryLabel: function(start_date, end_date, resource, tasks, assignments){\r\n\t\t\tlet sum = assignments.reduce(function(total, assignment){ \r\n\t\t\t\treturn total + Number(assignment.value);\r\n\t\t\t}, 0);\r\n\r\n\t\t\tif(sum % 1){\r\n\t\t\t\tsum = Math.round(sum * 10)/10;\r\n\t\t\t}\r\n\r\n\t\t\tif(sum){\r\n\t\t\t\treturn \"<div>\" + sum + \"</div>\";\r\n\t\t\t}\r\n\t\t\treturn \"\";\r\n\t\t},\r\n\t\teditableResourceCellTemplate: function(start_date, end_date, resource, tasks, assignments){\r\n\t\t\tif(resource.$role === \"task\"){\r\n\t\t\t\treturn resourcePlugin.renderEditableLabel(start_date, end_date, resource, tasks, assignments);\r\n\t\t\t}else{\r\n\t\t\t\treturn resourcePlugin.renderSummaryLabel(start_date, end_date, resource, tasks, assignments);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\t\r\n\t\teditableResourceCellClass: function(start_date, end_date, resource, tasks, assignments){\r\n\t\t\tconst css = [];\r\n\t\t\tcss.push(\"resource_marker\");\r\n\r\n\t\t\tif(resource.$role === \"task\"){\r\n\t\t\t\tcss.push(\"task_cell\");\r\n\t\t\t}else{\r\n\t\t\t\tcss.push(\"resource_cell\");\r\n\t\t\t}\r\n\r\n\t\t\tconst sum = assignments.reduce(function(total, assignment){ \r\n\t\t\t\treturn total + Number(assignment.value);\r\n\t\t\t}, 0);\r\n\r\n\t\t\tlet capacity = Number(resource.capacity);\r\n\t\t\tif(isNaN(capacity)){\r\n\t\t\t\tcapacity = 8;\r\n\t\t\t}\r\n\t\t\tif (sum <= capacity) {\r\n\t\t\t\tcss.push(\"workday_ok\");\r\n\t\t\t} else {\r\n\t\t\t\tcss.push(\"workday_over\");\r\n\t\t\t}\r\n\t\t\treturn css.join(\" \");\r\n\t\t},\r\n\t\tgetSummaryResourceAssignments: function getResourceAssignments(resourceId) {\r\n\t\t\tlet assignments;\r\n\t\t\tconst store = gantt.getDatastore(gantt.config.resource_store);\r\n\t\t\tconst resource = store.getItem(resourceId);\r\n\r\n\t\t\tif(resource.$role === \"task\"){\r\n\t\t\t\tassignments = gantt.getResourceAssignments(resource.$resource_id, resource.$task_id);\r\n\t\t\t}else{\r\n\t\t\t\tassignments = gantt.getResourceAssignments(resourceId);\r\n\t\t\t\tif(store.eachItem){\r\n\t\t\t\t\tstore.eachItem(function(childResource){\r\n\t\t\t\t\t\tif(childResource.$role !== \"task\"){\r\n\t\t\t\t\t\t\tassignments = assignments.concat(gantt.getResourceAssignments(childResource.id));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, resourceId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn assignments;\r\n\t\t},\r\n\t\t\r\n\t\tinitEditableDiagram: function(){\r\n\t\t\tgantt.config.resource_render_empty_cells = true;\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t(function(){\r\n\t\t\t\t/// salesforce locker workaround\r\n\t\t\t\t// SF removes 'contenteditable' attribute from cells\r\n\t\t\t\t// restore it on render\r\n\t\t\t\tlet timeoutId = null;\r\n\t\t\t\tfunction makeEditable() {\r\n\t\t\t\t\tif (timeoutId) {\r\n\t\t\t\t\t\tcancelAnimationFrame(timeoutId);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttimeoutId = requestAnimationFrame(function () {\r\n\t\t\t\t\t\tif (gantt.$container){\r\n\t\t\t\t\t\t\tvar cells = Array.prototype.slice.call(gantt.$container.querySelectorAll(\".resourceTimeline_cell [data-assignment-cell]\"));\r\n\t\t\t\t\t\t\tcells.forEach(function (cell) {\r\n\t\t\t\t\t\t\t\tcell.contentEditable = true;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\t\t\t\t\tgantt.getDatastore(gantt.config.resource_assignment_store).attachEvent(\"onStoreUpdated\", makeEditable);\r\n\t\t\t\t\tgantt.getDatastore(gantt.config.resource_store).attachEvent(\"onStoreUpdated\", makeEditable);\r\n\t\t\t\t}, {once: true});\r\n\t\t\t\tgantt.attachEvent(\"onGanttLayoutReady\", function(){\r\n\t\t\t\t\tconst ganttViews = gantt.$layout.getCellsByType(\"viewCell\");\r\n\t\t\t\t\tganttViews.forEach(function(view){\r\n\t\t\t\t\t\tif(view.$config && view.$config.view === \"resourceTimeline\" && view.$content){\r\n\t\t\t\t\t\t\tview.$content.attachEvent(\"onScroll\", makeEditable);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t})();\r\n\t\t\t//GS-2766: need to restore focus after updating assignments\r\n\t\t\tlet currentFocusIndex = null;\r\n\t\t\tfunction setNextFocus(){\r\n\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\tconst focusableElementsAfterRender = dom_helpers.getFocusableNodes(gantt.$container);\r\n\t\t\t\t\tif(currentFocusIndex > -1){\r\n\t\t\t\t\t\tfocusableElementsAfterRender[currentFocusIndex +1].focus();\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 300);\r\n\t\t\t};\r\n\r\n\t\t\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\t\t\t\tlet assignmentEditInProcess = false;\r\n\t\t\t\tgantt.event(gantt.$container, \"keypress\", function(e){\r\n\t\t\t\t\tvar target = e.target.closest(\".resourceTimeline_cell [data-assignment-cell]\");\r\n\t\t\t\t\tif(target){\r\n\t\t\t\t\t\tif (e.keyCode === 13 || e.keyCode === 27) {\r\n\t\t\t\t\t\t\ttarget.blur();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tgantt.event(gantt.$container, \"keydown\", function(event){\r\n\t\t\t\t\tif (event.key === \"Tab\") {\r\n\t\t\t\t\t\tconst focusableElements = dom_helpers.getFocusableNodes(gantt.$container);\r\n\t\t\t\t\t\tcurrentFocusIndex = focusableElements.indexOf(document.activeElement);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tgantt.event(gantt.$container, \"focusout\", function(e){\r\n\t\t\t\t\tif (assignmentEditInProcess){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tassignmentEditInProcess = true;\r\n\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\tassignmentEditInProcess = false;\r\n\t\t\t\t\t}, 300);\r\n\t\t\t\t\tvar target = e.target.closest(\".resourceTimeline_cell [data-assignment-cell]\");\r\n\t\t\t\t\tif(target){\r\n\t\t\t\t\t\tvar strValue = (target.innerText || \"\").trim();\r\n\t\t\t\t\t\tif(strValue == \"-\"){\r\n\t\t\t\t\t\t\tstrValue = \"0\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar value = Number(strValue);\r\n\t\t\t\t\t\tvar rowId = target.getAttribute(\"data-row-id\");\r\n\t\t\t\t\t\tvar assignmentId = target.getAttribute(\"data-assignment-id\");\r\n\t\t\t\t\t\tvar taskId = target.getAttribute(\"data-task\");\r\n\t\t\t\t\t\tvar resourceId = target.getAttribute(\"data-resource-id\");\r\n\t\t\t\t\t\tvar startDate = gantt.templates.parse_date(target.getAttribute(\"data-start-date\"));\r\n\t\t\t\t\t\tvar endDate = gantt.templates.parse_date(target.getAttribute(\"data-end-date\"));\r\n\r\n\t\t\t\t\t\tvar assignmentStore = gantt.getDatastore(gantt.config.resource_assignment_store);\r\n\t\t\t\t\t\tif(isNaN(value)){\r\n\t\t\t\t\t\t\tgantt.getDatastore(gantt.config.resource_store).refresh(rowId);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tvar task = gantt.getTask(taskId);\r\n\t\t\t\t\t\t\t// GS-2141. Track the changes by the Undo extension\r\n\t\t\t\t\t\t\tif (gantt.plugins().undo){\r\n\t\t\t\t\t\t\t\tgantt.ext.undo.saveState(taskId, \"task\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(assignmentId){\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar assignment = assignmentStore.getItem(assignmentId);\r\n\t\t\t\t\t\t\t\tif(value === assignment.value){\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif(assignment.start_date.valueOf() === startDate.valueOf() && assignment.end_date.valueOf() === endDate.valueOf()){\r\n\t\t\t\t\t\t\t\t\tassignment.value = value;\r\n\t\t\t\t\t\t\t\t\tif(!value){\r\n\t\t\t\t\t\t\t\t\t\tassignmentStore.removeItem(assignment.id);\r\n\t\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t\tassignmentStore.updateItem(assignment.id);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tif(assignment.end_date.valueOf() > endDate.valueOf()){\r\n\t\t\t\t\t\t\t\t\t\tvar nextChunk = gantt.copy(assignment);\r\n\t\t\t\t\t\t\t\t\t\tnextChunk.id = gantt.uid();\r\n\t\t\t\t\t\t\t\t\t\tnextChunk.start_date = endDate;\r\n\t\t\t\t\t\t\t\t\t\tnextChunk.duration = gantt.calculateDuration({\r\n\t\t\t\t\t\t\t\t\t\t\tstart_date: nextChunk.start_date,\r\n\t\t\t\t\t\t\t\t\t\t\tend_date: nextChunk.end_date,\r\n\t\t\t\t\t\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\tnextChunk.delay = gantt.calculateDuration({\r\n\t\t\t\t\t\t\t\t\t\t\tstart_date: task.start_date,\r\n\t\t\t\t\t\t\t\t\t\t\tend_date: nextChunk.start_date,\r\n\t\t\t\t\t\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\tnextChunk.mode = assignment.mode || \"default\";\r\n\t\t\t\t\t\t\t\t\t\tif(nextChunk.duration !== 0){\r\n\t\t\t\t\t\t\t\t\t\t\tassignmentStore.addItem(nextChunk);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif(assignment.start_date.valueOf() < startDate.valueOf()){\r\n\t\t\t\t\t\t\t\t\t\tassignment.end_date = startDate;\r\n\t\t\t\t\t\t\t\t\t\tassignment.duration = gantt.calculateDuration({\r\n\t\t\t\t\t\t\t\t\t\t\tstart_date: assignment.start_date,\r\n\t\t\t\t\t\t\t\t\t\t\tend_date: assignment.end_date,\r\n\t\t\t\t\t\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\tassignment.mode = \"fixedDuration\";\r\n\r\n\t\t\t\t\t\t\t\t\t\tif(assignment.duration === 0){\r\n\t\t\t\t\t\t\t\t\t\t\tassignmentStore.removeItem(assignment.id);\r\n\t\t\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t\t\tassignmentStore.updateItem(assignment.id);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t\tassignmentStore.removeItem(assignment.id);\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif(value){\r\n\t\t\t\t\t\t\t\t\t\tassignmentStore.addItem({\r\n\t\t\t\t\t\t\t\t\t\t\ttask_id: assignment.task_id,\r\n\t\t\t\t\t\t\t\t\t\t\tresource_id: assignment.resource_id,\r\n\t\t\t\t\t\t\t\t\t\t\tvalue: value,\r\n\t\t\t\t\t\t\t\t\t\t\tstart_date: startDate,\r\n\t\t\t\t\t\t\t\t\t\t\tend_date: endDate,\r\n\t\t\t\t\t\t\t\t\t\t\tduration: gantt.calculateDuration({\r\n\t\t\t\t\t\t\t\t\t\t\t\tstart_date: startDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\tend_date: endDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\t\t\t\tdelay: gantt.calculateDuration({\r\n\t\t\t\t\t\t\t\t\t\t\t\tstart_date: task.start_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\tend_date: startDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\t\t\t\tmode: \"fixedDuration\"\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tgantt.updateTaskAssignments(task.id);\r\n\t\t\t\t\t\t\t\tgantt.updateTask(task.id);\r\n\t\t\t\t\t\t\t\tsetNextFocus();\r\n\r\n\t\t\t\t\t\t\t}else if(value){\r\n\t\t\t\t\t\t\t\tvar assignment = {\r\n\t\t\t\t\t\t\t\t\ttask_id: taskId,\r\n\t\t\t\t\t\t\t\t\tresource_id: resourceId,\r\n\t\t\t\t\t\t\t\t\tvalue: value,\r\n\t\t\t\t\t\t\t\t\tstart_date: startDate,\r\n\t\t\t\t\t\t\t\t\tend_date: endDate,\r\n\t\t\t\t\t\t\t\t\tduration: gantt.calculateDuration({\r\n\t\t\t\t\t\t\t\t\t\tstart_date: startDate,\r\n\t\t\t\t\t\t\t\t\t\tend_date: endDate,\r\n\t\t\t\t\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\t\tdelay: gantt.calculateDuration({\r\n\t\t\t\t\t\t\t\t\t\tstart_date: task.start_date,\r\n\t\t\t\t\t\t\t\t\t\tend_date: startDate,\r\n\t\t\t\t\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\t\tmode: \"fixedDuration\"\r\n\t\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t\t\tassignmentStore.addItem(assignment);\r\n\t\t\t\t\t\t\t\tgantt.updateTaskAssignments(task.id);\r\n\t\t\t\t\t\t\t\tgantt.updateTask(task.id);\r\n\t\t\t\t\t\t\t\tsetNextFocus();\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}, {once: true});\r\n\t\t}\r\n\t};\r\n\treturn resourcePlugin;\r\n}\r\n\r\nexport default function(gantt){\r\n\tvar methods = createResourceMethods(gantt);\r\n\t\r\n\tgantt.ext.resources = createHelper(gantt);\r\n\r\n\tgantt.config.resources = {\r\n\t\tdataprocessor_assignments: false,\r\n\t\tdataprocessor_resources: false,\r\n\t\teditable_resource_diagram: false,\r\n\t\tresource_store: {\r\n\t\t\ttype: \"treeDataStore\",\r\n\t\t\tfetchTasks: false,\r\n\t\t\tinitItem: function(item) {\r\n\t\t\t\titem.parent = item.parent || gantt.config.root_id;\r\n\t\t\t\titem[gantt.config.resource_property] = item.parent;\r\n\t\t\t\titem.open = true;\r\n\t\t\t\treturn item;\r\n\t\t\t}\r\n\t\t},\r\n\t\tlightbox_resources: function selectResourceControlOptions(resources){\r\n\t\t\tconst lightboxOptions = [];\r\n\t\t\tconst store = gantt.getDatastore(gantt.config.resource_store);\r\n\t\t\tresources.forEach(function(res) {\r\n\t\t\t\tif (!store.hasChild(res.id)) {\r\n\t\t\t\t\tconst copy = gantt.copy(res);\r\n\t\t\t\t\tcopy.key = res.id;\r\n\t\t\t\t\tcopy.label = res.text;\r\n\t\t\t\t\tlightboxOptions.push(copy);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn lightboxOptions;\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.attachEvent(\"onBeforeGanttReady\", function(){\r\n\t\tif(gantt.getDatastore(gantt.config.resource_store)){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst resourceStoreConfig = gantt.config.resources ? gantt.config.resources.resource_store : undefined;\r\n\t\tlet fetchTasks = resourceStoreConfig ? resourceStoreConfig.fetchTasks : undefined;\r\n\t\tif(gantt.config.resources && gantt.config.resources.editable_resource_diagram){\r\n\t\t\tfetchTasks = true;\r\n\t\t}\r\n\r\n\t\tlet initItems = function(item) {\r\n\t\t\titem.parent = item.parent || gantt.config.root_id;\r\n\t\t\titem[gantt.config.resource_property] = item.parent;\r\n\t\t\titem.open = true;\r\n\t\t\treturn item;\r\n\t\t};\r\n\r\n\t\tif(resourceStoreConfig && resourceStoreConfig.initItem){\r\n\t\t\tinitItems = resourceStoreConfig.initItem;\r\n\t\t}\r\n\r\n\t\tconst storeType = resourceStoreConfig && resourceStoreConfig.type ? resourceStoreConfig.type : \"treeDatastore\";\r\n\r\n\t\tgantt.$resourcesStore = gantt.createDatastore({\r\n\t\t\tname: gantt.config.resource_store,\r\n\t\t\ttype: storeType,\r\n\t\t\tfetchTasks: fetchTasks !== undefined ? fetchTasks : false,\r\n\t\t\tinitItem: initItems\r\n\t\t});\r\n\r\n\t\tgantt.$data.resourcesStore = gantt.$resourcesStore;\r\n\r\n\t\tgantt.$resourcesStore.attachEvent(\"onParse\", function() {\r\n\t\t\tfunction selectResourceControlOptions(resources){\r\n\t\t\t\tconst lightboxOptions = [];\r\n\t\t\t\tresources.forEach(function(res) {\r\n\t\t\t\t\tconst copy = gantt.copy(res);\r\n\t\t\t\t\tcopy.key = res.id;\r\n\t\t\t\t\tcopy.label = res.text;\r\n\t\t\t\t\tlightboxOptions.push(copy);\r\n\t\t\t\t});\r\n\t\t\t\treturn lightboxOptions;\r\n\t\t\t}\r\n\r\n\t\t\tlet lightboxOptionsFnc = selectResourceControlOptions;\r\n\t\t\tlet options;\r\n\t\t\tif(gantt.config.resources && gantt.config.resources.lightbox_resources){\r\n\t\t\t\tlightboxOptionsFnc = gantt.config.resources.lightbox_resources;\r\n\t\t\t}\r\n\t\t\tif(gantt.config.resources && gantt.config.resources.editable_resource_diagram){\r\n\t\t\t\t// GS-2604: case for the next parsed resources\r\n\t\t\t\t// to filter only resources with assignments\r\n\t\t\t\tconst resources = gantt.$resourcesStore.getItems();\r\n\t\t\t\tconst filteredResources = resources.filter(resource => {\r\n\t\t\t\t\tlet assignments = gantt.getResourceAssignments(resource.id);\r\n\t\t\t\t\tif(!gantt.$resourcesStore.hasChild(resource.id) || (assignments && assignments.length)){\r\n\t\t\t\t\t\tif(resource.$resource_id && resource.$task_id){\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\toptions = lightboxOptionsFnc(filteredResources);\r\n\t\t\t} else {\r\n\t\t\t\toptions = lightboxOptionsFnc(gantt.$resourcesStore.getItems());\r\n\t\t\t}\r\n\t\t\tgantt.updateCollection(\"resourceOptions\", options);\r\n\t\t});\r\n\t});\r\n\r\n\tgantt.getTaskBy = methods.getTaskBy;\r\n\tgantt.getResourceAssignments = methods.getResourceAssignments;\r\n\tgantt.config.resource_property = \"owner_id\";\r\n\tgantt.config.resource_store = \"resource\";\r\n\tgantt.config.resource_render_empty_cells = false;\r\n\r\n\t/**\r\n\t * these are placeholder functions that should be redefined by the user\r\n\t*/\r\n\tgantt.templates.histogram_cell_class = function(start_date, end_date, resource, tasks, assignments) {};\r\n\tgantt.templates.histogram_cell_label = function(start_date, end_date, resource, tasks, assignments) {\r\n\t\treturn tasks.length + \"/3\";\r\n\t};\r\n\tgantt.templates.histogram_cell_allocated = function(start_date, end_date, resource, tasks, assignments) {\r\n\t\treturn tasks.length / 3;\r\n\t};\r\n\tgantt.templates.histogram_cell_capacity = function(start_date, end_date, resource, tasks, assignments) {\r\n\t\treturn 0;\r\n\t};\r\n\r\n\r\n\tconst defaultResourceCellClass = function(start, end, resource, tasks, assignments) {\r\n\t\tvar css = \"\";\r\n\t\tif (tasks.length <= 1) {\r\n\t\t\tcss = \"gantt_resource_marker_ok\";\r\n\t\t} else {\r\n\t\t\tcss = \"gantt_resource_marker_overtime\";\r\n\t\t}\r\n\t\treturn css;\r\n\t};\r\n\r\n\tconst defaultResourceCellTemplate = function(start, end, resource, tasks, assignments) {\r\n\t\treturn tasks.length * 8;\r\n\t};\r\n\r\n\tgantt.templates.resource_cell_value = defaultResourceCellTemplate;\r\n\tgantt.templates.resource_cell_class = defaultResourceCellClass;\r\n\r\n\t//editable_resource_diagram\r\n\tgantt.attachEvent(\"onBeforeGanttReady\", function(){\r\n\t\tif(gantt.config.resources && gantt.config.resources.editable_resource_diagram){\r\n\r\n\t\t\tgantt.config.resource_render_empty_cells = true;\r\n\t\t\tif(gantt.templates.resource_cell_value === defaultResourceCellTemplate){\r\n\t\t\t\tgantt.templates.resource_cell_value = gantt.ext.resources.editableResourceCellTemplate;\r\n\t\t\t}\r\n\t\t\tif(gantt.templates.resource_cell_class === defaultResourceCellClass){\r\n\t\t\t\tgantt.templates.resource_cell_class = gantt.ext.resources.editableResourceCellClass;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tgantt.ext.resources.initEditableDiagram(gantt);\r\n\t\t}\r\n\t});\r\n};\r\n\r\n\r\n","export default function (gantt) {\r\n\tvar resourceAssignmentsProperty = \"$resourceAssignments\";\r\n\tgantt.config.resource_assignment_store = \"resourceAssignments\";\r\n\tgantt.config.process_resource_assignments = true;\r\n\r\n\tvar resourceAssignmentFormats = {\r\n\t\tauto: \"auto\",\r\n\t\tsingleValue: \"singleValue\",\r\n\t\tvalueArray: \"valueArray\",\r\n\t\tresourceValueArray: \"resourceValueArray\",\r\n\t\tassignmentsArray: \"assignmentsArray\"\r\n\t};\r\n\tvar resourceAssignmentFormat = resourceAssignmentFormats.auto;//\"primitiveSingle\";//\"primitive\";//\"object\"|\"assignment\"\r\n\r\n\tvar assignmentModes = {\r\n\t\tfixedDates: \"fixedDates\",\r\n\t\tfixedDuration: \"fixedDuration\",\r\n\t\tdefault: \"default\"\r\n\t};\r\n\r\n\r\n\tfunction initAssignmentFields(item, task){\r\n\t\tif (item.start_date) {\r\n\t\t\titem.start_date = gantt.date.parseDate(item.start_date, \"parse_date\");\r\n\t\t} else {\r\n\t\t\titem.start_date = null;\r\n\t\t}\r\n\r\n\t\tif (item.end_date) {\r\n\t\t\titem.end_date = gantt.date.parseDate(item.end_date, \"parse_date\");\r\n\t\t} else {\r\n\t\t\titem.end_date = null;\r\n\t\t}\r\n\r\n\t\tvar delay = Number(item.delay);\r\n\t\tvar initDelay = false;\r\n\t\tif (!isNaN(delay)) {\r\n\t\t\titem.delay = delay;\r\n\t\t} else {\r\n\t\t\titem.delay = 0;\r\n\t\t\tinitDelay = true;\r\n\t\t}\r\n\r\n\t\tif (!gantt.defined(item.value)) {\r\n\t\t\titem.value = null;\r\n\t\t}\r\n\r\n\t\tif (!item.task_id || !item.resource_id) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\titem.mode = item.mode || assignmentModes.default;\r\n\r\n\t\tif(item.mode === assignmentModes.fixedDuration){\r\n\t\t\tif(isNaN(Number(item.duration))){\r\n\t\t\t\ttask = task || gantt.getTask(item.task_id);\r\n\t\t\t\titem.duration = gantt.calculateDuration({\r\n\t\t\t\t\tstart_date: item.start_date,\r\n\t\t\t\t\tend_date: item.end_date,\r\n\t\t\t\t\tid: task\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif(initDelay){\r\n\t\t\t\ttask = task || gantt.getTask(item.task_id);\r\n\t\t\t\titem.delay = gantt.calculateDuration({\r\n\t\t\t\t\tstart_date: task.start_date,\r\n\t\t\t\t\tend_date: item.start_date,\r\n\t\t\t\t\tid: task\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (item.mode !== assignmentModes.fixedDates && (task || gantt.isTaskExists(item.task_id))) {\r\n\t\t\ttask = task || gantt.getTask(item.task_id);\r\n\t\t\tvar timing = _assignmentTimeFromTask(item, task);\r\n\t\t\titem.start_date = timing.start_date;\r\n\t\t\titem.end_date = timing.end_date;\r\n\t\t\titem.duration = timing.duration;\r\n\t\t}\r\n\t}\r\n\t// gantt init\r\n\tvar resourceAssignmentsStore = gantt.createDatastore({\r\n\t\tname: gantt.config.resource_assignment_store,\r\n\t\tinitItem: function (item) {\r\n\t\t\tif (!item.id) {\r\n\t\t\t\titem.id = gantt.uid();\r\n\t\t\t}\r\n\r\n\t\t\tinitAssignmentFields(item);\r\n\r\n\t\t\treturn item;\r\n\t\t}\r\n\t});\r\n\t\r\n\tgantt.$data.assignmentsStore = resourceAssignmentsStore;\r\n\r\n\tfunction _assignmentTimeFromTask(assignment, task) {\r\n\r\n\t\tif (assignment.mode === assignmentModes.fixedDates) {\r\n\t\t\treturn {\r\n\t\t\t\tstart_date: assignment.start_date,\r\n\t\t\t\tend_date: assignment.end_date,\r\n\t\t\t\tduration: assignment.duration\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tvar start = assignment.delay ? gantt.calculateEndDate({\r\n\t\t\t\tstart_date: task.start_date,\r\n\t\t\t\tduration: assignment.delay,\r\n\t\t\t\ttask: task\r\n\t\t\t}) : new Date(task.start_date);\r\n\r\n\t\t\tvar end;\r\n\t\t\tvar duration;\r\n\t\t\tif (assignment.mode === assignmentModes.fixedDuration) {\r\n\t\t\t\tend = gantt.calculateEndDate({\r\n\t\t\t\t\tstart_date: start,\r\n\t\t\t\t\tduration: assignment.duration,\r\n\t\t\t\t\ttask: task\r\n\t\t\t\t});\r\n\t\t\t\tduration = assignment.duration;\r\n\t\t\t} else {\r\n\t\t\t\tend = new Date(task.end_date);\r\n\t\t\t\tduration = task.duration - assignment.delay;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tstart_date: start,\r\n\t\t\tend_date: end,\r\n\t\t\tduration: duration\r\n\t\t};\r\n\t}\r\n\r\n\t// data loading\r\n\r\n\tfunction _makeAssignmentsFromTask(task) {\r\n\t\tconst property = gantt.config.resource_property;\r\n\t\tlet assignments = task[property];\r\n\t\tconst resourceAssignments = [];\r\n\t\tlet detectFormat = resourceAssignmentFormat === resourceAssignmentFormats.auto;\r\n\r\n\t\tif (gantt.defined(assignments) && assignments) {\r\n\t\t\tif (!Array.isArray(assignments)) {\r\n\t\t\t\tassignments = [assignments];\r\n\t\t\t\tif (detectFormat) {\r\n\t\t\t\t\tresourceAssignmentFormat = resourceAssignmentFormats.singleValue;\r\n\t\t\t\t\tdetectFormat = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst usedIds = {};\r\n\t\t\tassignments.forEach(function (res) {\r\n\t\t\t\tif (!res.resource_id) { // when resource is a string/number\r\n\t\t\t\t\tres = { resource_id: res };\r\n\t\t\t\t\tif (detectFormat) {\r\n\t\t\t\t\t\tresourceAssignmentFormat = resourceAssignmentFormats.valueArray;\r\n\t\t\t\t\t\tdetectFormat = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//\tisSimpleArray = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (detectFormat) {\r\n\t\t\t\t\tif (res.id && res.resource_id) {\r\n\t\t\t\t\t\tresourceAssignmentFormat = resourceAssignmentFormats.assignmentsArray;\r\n\t\t\t\t\t\tdetectFormat = false;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresourceAssignmentFormat = resourceAssignmentFormats.resourceValueArray;\r\n\t\t\t\t\t\tdetectFormat = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet defaultMode = assignmentModes.default;\r\n\t\t\t\tif(!res.mode){\r\n\t\t\t\t\tif((res.start_date && res.end_date) || (res.start_date && res.duration)){\r\n\t\t\t\t\t\tdefaultMode = assignmentModes.fixedDuration;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet id;\r\n\t\t\t\tif(!res.id && res.$id && !usedIds[res.$id]){\r\n\t\t\t\t\tid = res.$id;\r\n\t\t\t\t} else if(res.id && !usedIds[res.id]){\r\n\t\t\t\t\tid = res.id;\r\n\t\t\t\t} else{\r\n\t\t\t\t\tid = gantt.uid();\r\n\t\t\t\t}\r\n\t\t\t\tusedIds[id] = true;\r\n\r\n\t\t\t\tconst assignment = {\r\n\t\t\t\t\tid: id,\r\n\t\t\t\t\tstart_date: res.start_date,\r\n\t\t\t\t\tduration: res.duration,\r\n\t\t\t\t\tend_date: res.end_date,\r\n\t\t\t\t\tdelay: res.delay,\r\n\t\t\t\t\ttask_id: task.id,\r\n\t\t\t\t\tresource_id: res.resource_id,\r\n\t\t\t\t\tvalue: res.value,\r\n\t\t\t\t\tmode: res.mode || defaultMode\r\n\t\t\t\t};\r\n\t\t\t\t// GS-2490: to add custom properties to assignment\r\n\t\t\t\t// need to exclude $id which incfluences on render \r\n\t\t\t\tObject.keys(res).forEach(key => {\r\n\t\t\t\t\tif(key != \"$id\") {\r\n\t\t\t\t\t\tassignment[key] = res[key];\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(!(assignment.start_date && assignment.start_date.getMonth \r\n\t\t\t\t\t&& assignment.end_date && assignment.end_date.getMonth && typeof assignment.duration === \"number\")){\r\n\t\t\t\t\tinitAssignmentFields(assignment, task);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tresourceAssignments.push(assignment);\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn resourceAssignments;\r\n\t}\r\n\r\n\tfunction _updateTaskBack(taskId) {\r\n\t\t// GS-1493. In some cases, the resource assignment store has the tasks that no longer exist\r\n\t\tif (!gantt.isTaskExists(taskId)){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar task = gantt.getTask(taskId);\r\n\t\tvar assignments = gantt.getTaskAssignments(task.id);\r\n\t\t_assignAssignments(task, assignments);\r\n\t}\r\n\r\n\tfunction _assignAssignments(task, assignments){\r\n\t\tassignments.sort(function(a, b){\r\n\t\t\tif(a.start_date && b.start_date && a.start_date.valueOf() != b.start_date.valueOf()){\r\n\t\t\t\treturn a.start_date - b.start_date;\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (resourceAssignmentFormat == resourceAssignmentFormats.assignmentsArray) {\r\n\t\t\ttask[gantt.config.resource_property] = assignments;\r\n\t\t} else if (resourceAssignmentFormat == resourceAssignmentFormats.resourceValueArray) {\r\n\t\t\ttask[gantt.config.resource_property] = assignments.map(function (a) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t$id: a.id,\r\n\t\t\t\t\tstart_date: a.start_date,\r\n\t\t\t\t\tduration: a.duration,\r\n\t\t\t\t\tend_date: a.end_date,\r\n\t\t\t\t\tdelay: a.delay,\r\n\t\t\t\t\tresource_id: a.resource_id,\r\n\t\t\t\t\tvalue: a.value,\r\n\t\t\t\t\tmode: a.mode\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\ttask[resourceAssignmentsProperty] = assignments;\r\n\t}\r\n\r\n\tfunction _loadAssignmentsFromTask(task) {\r\n\t\tvar assignments = _makeAssignmentsFromTask(task);\r\n\t\tvar taskAssignments = [];\r\n\t\tassignments.forEach(function (a) {\r\n\t\t\ta.id = a.id || gantt.uid();\r\n\t\t\t//var newId = resourceAssignmentsStore.addItem(a);\r\n\t\t\ttaskAssignments.push(a);\r\n\t\t});\r\n\r\n\t\treturn assignments;\r\n\t}\r\n\r\n\tfunction diffAssignments(taskValues, assignmentsStoreValues) {\r\n\t\tvar result = {\r\n\t\t\tinBoth: [],\r\n\t\t\tinTaskNotInStore: [],\r\n\t\t\tinStoreNotInTask: []\r\n\t\t};\r\n\r\n\t\tif (resourceAssignmentFormat == resourceAssignmentFormats.singleValue) {\r\n\t\t\tvar taskOwner = taskValues[0];\r\n\t\t\tvar ownerId = taskOwner ? taskOwner.resource_id : null;\r\n\t\t\tvar foundOwnerAssignment = false;\r\n\t\t\tassignmentsStoreValues.forEach(function (a) {\r\n\t\t\t\tif (a.resource_id != ownerId) {\r\n\t\t\t\t\tresult.inStoreNotInTask.push(a);\r\n\t\t\t\t} else if (a.resource_id == ownerId) {\r\n\t\t\t\t\tresult.inBoth.push({ store: a, task: taskOwner });\r\n\t\t\t\t\tfoundOwnerAssignment = true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (!foundOwnerAssignment && taskOwner) {\r\n\t\t\t\tresult.inTaskNotInStore.push(taskOwner);\r\n\t\t\t}\r\n\r\n\r\n\t\t} else if (resourceAssignmentFormat == resourceAssignmentFormats.valueArray){\r\n\r\n\t\t\tvar taskSearch = {};\r\n\t\t\tvar storeSearch = {};\r\n\t\t\tvar processedIds = {};\r\n\t\t\ttaskValues.forEach(function (a) {\r\n\t\t\t\ttaskSearch[a.resource_id] = a;\r\n\t\t\t});\r\n\t\t\tassignmentsStoreValues.forEach(function (a) {\r\n\t\t\t\tstoreSearch[a.resource_id] = a;\r\n\t\t\t});\r\n\t\t\ttaskValues.concat(assignmentsStoreValues).forEach(function (a) {\r\n\t\t\t\tif (processedIds[a.resource_id]) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tprocessedIds[a.resource_id] = true;\r\n\t\t\t\tvar inTask = taskSearch[a.resource_id];\r\n\t\t\t\tvar inStore = storeSearch[a.resource_id];\r\n\r\n\t\t\t\tif (inTask && inStore) {\r\n\t\t\t\t\tresult.inBoth.push({ store: inStore, task: inTask });\r\n\t\t\t\t} else if (inTask && !inStore) {\r\n\t\t\t\t\tresult.inTaskNotInStore.push(inTask);\r\n\t\t\t\t} else if (!inTask && inStore) {\r\n\t\t\t\t\tresult.inStoreNotInTask.push(inStore);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else if ((resourceAssignmentFormat == resourceAssignmentFormats.assignmentsArray)\r\n\t\t\t|| (resourceAssignmentFormat == resourceAssignmentFormats.resourceValueArray)) {\r\n\t\t\tvar taskSearch = {};\r\n\t\t\tvar storeSearch = {};\r\n\t\t\tvar processedIds = {};\r\n\t\t\ttaskValues.forEach(function (a) {\r\n\t\t\t\ttaskSearch[a.id || a.$id] = a;\r\n\t\t\t});\r\n\t\t\tassignmentsStoreValues.forEach(function (a) {\r\n\t\t\t\tstoreSearch[a.id] = a;\r\n\t\t\t});\r\n\t\t\ttaskValues.concat(assignmentsStoreValues).forEach(function (a) {\r\n\t\t\t\tvar id = a.id || a.$id;\r\n\t\t\t\tif (processedIds[id]) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tprocessedIds[id] = true;\r\n\t\t\t\tvar inTask = taskSearch[id];\r\n\t\t\t\tvar inStore = storeSearch[id];\r\n\r\n\t\t\t\tif (inTask && inStore) {\r\n\t\t\t\t\tresult.inBoth.push({ store: inStore, task: inTask });\r\n\t\t\t\t} else if (inTask && !inStore) {\r\n\t\t\t\t\tresult.inTaskNotInStore.push(inTask);\r\n\t\t\t\t} else if (!inTask && inStore) {\r\n\t\t\t\t\tresult.inStoreNotInTask.push(inStore);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfunction assignmentHasChanged(source, target) {\r\n\t\tvar ignoreFields = {\r\n\t\t\tid: true\r\n\t\t};\r\n\r\n\t\tfor (var i in source) {\r\n\t\t\tif (!ignoreFields[i]) {\r\n\t\t\t\tif (String(source[i]) !== String(target[i])) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tfunction updateAssignment(source, target) {\r\n\t\tvar ignoreFields = {\r\n\t\t\tid: true\r\n\t\t};\r\n\r\n\t\tfor (var i in source) {\r\n\t\t\tif (!ignoreFields[i]) {\r\n\t\t\t\ttarget[i] = source[i];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _syncAssignments(task, storeAssignments){\r\n\t\tvar tasksAssignments = _makeAssignmentsFromTask(task);\r\n\r\n\t\tvar diff = diffAssignments(tasksAssignments, storeAssignments);\r\n\t\tdiff.inStoreNotInTask.forEach(function (a) {\r\n\t\t\tresourceAssignmentsStore.removeItem(a.id);\r\n\t\t});\r\n\t\tdiff.inTaskNotInStore.forEach(function (a) {\r\n\t\t\tresourceAssignmentsStore.addItem(a);\r\n\t\t});\r\n\r\n\t\tdiff.inBoth.forEach(function (a) {\r\n\t\t\tif (assignmentHasChanged(a.task, a.store)) {\r\n\t\t\t\tupdateAssignment(a.task, a.store);\r\n\t\t\t\tresourceAssignmentsStore.updateItem(a.store.id);\r\n\t\t\t} else {\r\n\t\t\t\tif (a.task.start_date && a.task.end_date && a.task.mode !== assignmentModes.fixedDates) {\r\n\t\t\t\t\tvar timing = _assignmentTimeFromTask(a.store, task);\r\n\t\t\t\t\tif (a.store.start_date.valueOf() != timing.start_date.valueOf() || a.store.end_date.valueOf() != timing.end_date.valueOf()) {\r\n\t\t\t\t\t\ta.store.start_date = timing.start_date;\r\n\t\t\t\t\t\ta.store.end_date = timing.end_date;\r\n\t\t\t\t\t\ta.store.duration = timing.duration;\r\n\t\t\t\t\t\tresourceAssignmentsStore.updateItem(a.store.id);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t_updateTaskBack(task.id);\r\n\t}\r\n\r\n\tfunction _syncOnTaskUpdate(task) {\r\n\t\tvar storeAssignments = task[resourceAssignmentsProperty] || resourceAssignmentsStore.find(function (a) {\r\n\t\t\treturn a.task_id == task.id;\r\n\t\t});\r\n\r\n\t\t_syncAssignments(task, storeAssignments);\r\n\t}\r\n\r\n\tfunction _syncOnTaskDelete(ids) {\r\n\t\tvar idsSearch = {};\r\n\t\tids.forEach(function (id) {\r\n\t\t\tidsSearch[id] = true;\r\n\t\t});\r\n\t\tvar taskResources = resourceAssignmentsStore.find(function (a) {\r\n\t\t\treturn idsSearch[a.task_id];\r\n\t\t});\r\n\t\ttaskResources.forEach(function (a) {\r\n\t\t\tresourceAssignmentsStore.removeItem(a.id);\r\n\t\t});\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\r\n\t\tif (gantt.config.process_resource_assignments) {\r\n\t\t\tgantt.attachEvent(\"onParse\", function () {\r\n\t\t\t\tgantt.silent(function () {\r\n\t\t\t\t\tresourceAssignmentsStore.clearAll();\r\n\t\t\t\t\tvar totalAssignments = [];\r\n\t\t\t\t\tgantt.eachTask(function (task) {\r\n\t\t\t\t\t\tif (task.type === gantt.config.types.project) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar assignments = _loadAssignmentsFromTask(task);\r\n\t\t\t\t\t\t_assignAssignments(task, assignments);\r\n\r\n\t\t\t\t\t\tassignments.forEach(function (a) {\r\n\t\t\t\t\t\t\ttotalAssignments.push(a);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\tresourceAssignmentsStore.parse(totalAssignments);\r\n\t\t\t\t});\r\n\r\n\t\t\t});\r\n\r\n\t\t\tvar batchUpdate = false;\r\n\t\t\tvar needUpdate = false;\r\n\t\t\tvar needUpdateFor = {};\r\n\t\t\tvar undoBatchCancel = false;\r\n\t\t\tgantt.attachEvent(\"onBeforeBatchUpdate\", function(){\r\n\t\t\t\tbatchUpdate = true;\r\n\t\t\t});\r\n\t\t\tgantt.attachEvent(\"onAfterBatchUpdate\", function(){\r\n\t\t\t\t\r\n\t\t\t\tif(needUpdate){\r\n\t\t\t\t\tvar assignmentsHash = {};\r\n\t\t\t\t\tfor(var i in needUpdateFor){\r\n\t\t\t\t\t\tassignmentsHash[i] = gantt.getTaskAssignments(needUpdateFor[i].id);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// GS-2546. If we add a task that has the data in the old format,\r\n\t\t\t\t\t// we need to reset the cache as the assignment will be added\r\n\t\t\t\t\t// to the assignment store, but the cache won't have the changes\r\n\t\t\t\t\tif (gantt.config.process_resource_assignments && resourceAssignmentFormat === \"resourceValueArray\"){\r\n\t\t\t\t\t\ttaskAssignmentsCache = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor(var i in needUpdateFor){\r\n\t\t\t\t\t\t_syncAssignments(needUpdateFor[i], assignmentsHash[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tneedUpdate = false;\r\n\t\t\t\tbatchUpdate = false;\r\n\t\t\t\tneedUpdateFor = {};\r\n\t\t\t});\r\n\r\n\t\t\tgantt.attachEvent(\"onTaskCreated\", function (item) {\r\n\t\t\t\tvar assignments = _loadAssignmentsFromTask(item);\r\n\t\t\t\tresourceAssignmentsStore.parse(assignments);\r\n\t\t\t\t_assignAssignments(item, assignments);\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t\tgantt.attachEvent(\"onAfterTaskUpdate\", function (id, item) {\r\n\t\t\t\tif(batchUpdate){\r\n\t\t\t\t\tneedUpdate = true;\r\n\t\t\t\t\tneedUpdateFor[id] = item;\r\n\t\t\t\t}else if (!item.unscheduled){\r\n\t\t\t\t\t_syncOnTaskUpdate(item);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tgantt.attachEvent(\"onAfterTaskAdd\", function (id, item) {\r\n\t\t\t\tif(batchUpdate){\r\n\t\t\t\t\tneedUpdate = true;\r\n\t\t\t\t\tneedUpdateFor[id] = item;\r\n\t\t\t\t}else{\r\n\t\t\t\t\t_syncOnTaskUpdate(item);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t/*\tgantt.attachEvent(\"onRowDragMove\", function (id) {\r\n\t\t\t\t_syncOnTaskUpdate(gantt.getTask(id));\r\n\t\t\t});*/\r\n\t\t\tgantt.attachEvent(\"onRowDragEnd\", function (id) {\r\n\t\t\t\t_syncOnTaskUpdate(gantt.getTask(id));\r\n\t\t\t});\r\n\t\t\tgantt.$data.tasksStore.attachEvent(\"onAfterDeleteConfirmed\", function (id, item) {\r\n\t\t\t\tvar deleteIds = [id];\r\n\t\t\t\tgantt.eachTask(function (task) {\r\n\t\t\t\t\tdeleteIds.push(task.id);\r\n\t\t\t\t}, id);\r\n\t\t\t\t_syncOnTaskDelete(deleteIds);\r\n\t\t\t});\r\n\t\t\tgantt.$data.tasksStore.attachEvent(\"onClearAll\", function () {\r\n\t\t\t\tresourceAssignmentsCache = null;\r\n\t\t\t\tresourceTaskAssignmentsCache = null;\r\n\t\t\t\ttaskAssignmentsCache = null;\r\n\t\t\t\tresourceAssignmentsStore.clearAll();\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t\tgantt.attachEvent(\"onTaskIdChange\", function (id, new_id) {\r\n\t\t\t\tvar taskResources = resourceAssignmentsStore.find(function (a) {\r\n\t\t\t\t\treturn a.task_id == id;\r\n\t\t\t\t});\r\n\t\t\t\ttaskResources.forEach(function (a) {\r\n\t\t\t\t\ta.task_id = new_id;\r\n\t\t\t\t\tresourceAssignmentsStore.updateItem(a.id);\r\n\t\t\t\t});\r\n\t\t\t\t_updateTaskBack(new_id);\r\n\t\t\t\t//any custom logic here\r\n\t\t\t});\r\n\t\t\t// GS-2144. When we Undo something, the cache should be reset\r\n\t\t\t// during the `onStoreUpdated` event to properly update the assignments\r\n\t\t\tgantt.attachEvent(\"onBeforeUndo\", function (action) {\r\n\t\t\t\tundoBatchCancel = true;\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t\tgantt.attachEvent(\"onAfterUndo\", function (action) {\r\n\t\t\t\tundoBatchCancel = true;\r\n\t\t\t});\r\n\r\n\r\n\t\t\tvar resourceAssignmentsCache = null;\r\n\t\t\tvar resourceTaskAssignmentsCache = null;\r\n\t\t\tvar taskAssignmentsCache = null;\r\n\r\n\t\t\tresourceAssignmentsStore.attachEvent(\"onStoreUpdated\", function resetCache(){\r\n\t\t\t\tif(batchUpdate && !undoBatchCancel){\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\tresourceAssignmentsCache = null;\r\n\t\t\t\tresourceTaskAssignmentsCache = null;\r\n\t\t\t\ttaskAssignmentsCache = null;\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\r\n\t\t\tgantt.getResourceAssignments = function (resourceId, taskId) {\r\n\t\t\t\tvar searchTaskId = gantt.defined(taskId) && taskId !== null;\r\n\r\n\t\t\t\tif(resourceAssignmentsCache === null){\r\n\t\t\t\t\tresourceAssignmentsCache = {};\r\n\t\t\t\t\tresourceTaskAssignmentsCache = {};\r\n\r\n\t\t\t\t\tresourceAssignmentsStore.eachItem(function (a) {\r\n\t\t\t\t\t\tif(!resourceAssignmentsCache[a.resource_id]){\r\n\t\t\t\t\t\t\tresourceAssignmentsCache[a.resource_id] = [];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tresourceAssignmentsCache[a.resource_id].push(a);\r\n\r\n\t\t\t\t\t\tvar resourceTaskCacheKey = a.resource_id + \"-\" + a.task_id;\r\n\t\t\t\t\t\tif(!resourceTaskAssignmentsCache[resourceTaskCacheKey]){\r\n\t\t\t\t\t\t\tresourceTaskAssignmentsCache[resourceTaskCacheKey] = [];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tresourceTaskAssignmentsCache[resourceTaskCacheKey].push(a);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tif(searchTaskId){\r\n\t\t\t\t\treturn (resourceTaskAssignmentsCache[resourceId + \"-\" + taskId] || []).slice();\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturn (resourceAssignmentsCache[resourceId] || []).slice();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t\r\n\t\t\tgantt.getTaskAssignments = function (taskId) {\r\n\t\t\t\tif(taskAssignmentsCache === null){\r\n\t\t\t\t\tvar result = [];\r\n\t\t\t\t\ttaskAssignmentsCache = {};\r\n\t\t\t\t\tresourceAssignmentsStore.eachItem(function (a) {\r\n\t\t\t\t\t\tif(!taskAssignmentsCache[a.task_id]){\r\n\t\t\t\t\t\t\ttaskAssignmentsCache[a.task_id] = [];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttaskAssignmentsCache[a.task_id].push(a);\r\n\t\t\t\t\t\tif (a.task_id == taskId) {\r\n\t\t\t\t\t\t\tresult.push(a);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn (taskAssignmentsCache[taskId] || []).slice();\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tgantt.getTaskResources = function (taskId) {\r\n\t\t\t\tconst store = gantt.getDatastore(\"resource\");\r\n\t\t\t\tconst assignments = gantt.getTaskAssignments(taskId);\r\n\t\r\n\t\t\t\tconst uniqueResources = {};\r\n\t\t\t\tassignments.forEach(function(a){\r\n\t\t\t\t\tif(!uniqueResources[a.resource_id]){\r\n\t\t\t\t\t\tuniqueResources[a.resource_id] = a.resource_id;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tconst resources = [];\r\n\t\t\t\tfor(const i in uniqueResources){\r\n\t\t\t\t\tconst res = store.getItem(uniqueResources[i]);\r\n\t\t\t\t\tif(res){\r\n\t\t\t\t\t\tresources.push(res);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn resources;\r\n\t\t\t};\r\n\r\n\t\t\tgantt.updateTaskAssignments = _updateTaskBack;\r\n\t\t}\r\n\t}, {once: true});\r\n};","export default function addPlaceholder(gantt){\r\n\tfunction isEnabled(){\r\n\t\treturn gantt.config.placeholder_task;\r\n\t}\r\n\r\n\tfunction callIfEnabled(callback){\r\n\t\treturn function(){\r\n\t\t\tif(!isEnabled()){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn callback.apply(this, arguments);\r\n\t\t};\r\n\t}\r\n\r\n\tfunction silenceDataProcessor(dataProcessor){\r\n\t\tif(dataProcessor && !dataProcessor._silencedPlaceholder){\r\n\t\t\tdataProcessor._silencedPlaceholder = true;\r\n\t\t\tdataProcessor.attachEvent(\"onBeforeUpdate\", callIfEnabled(function(id, state, data){\r\n\t\t\t\tif(data.type == gantt.config.types.placeholder){\r\n\t\t\t\t\tdataProcessor.setUpdated(id, false);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}));\r\n\t\t}\r\n\t}\r\n\r\n\tfunction insertPlaceholder(){\r\n\t\tvar placeholders = gantt.getTaskBy(\"type\", gantt.config.types.placeholder);\r\n\t\tif(!placeholders.length || !gantt.isTaskExists(placeholders[0].id)){\r\n\t\t\tvar placeholder = {\r\n\t\t\t\tunscheduled: true,\r\n\t\t\t\ttype: gantt.config.types.placeholder,\r\n\t\t\t\tduration:0,\r\n\t\t\t\ttext: gantt.locale.labels.new_task\r\n\t\t\t};\r\n\t\t\tif(gantt.callEvent(\"onTaskCreated\", [placeholder]) === false){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tgantt.addTask(placeholder);\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n\r\n\tfunction afterEdit(id){\r\n\t\tvar item = gantt.getTask(id);\r\n\t\tif(item.type == gantt.config.types.placeholder) {\r\n\t\t\tif(item.start_date && item.end_date && item.unscheduled){\r\n\t\t\t\titem.unscheduled = false;\r\n\t\t\t}\r\n\r\n\t\t\tgantt.batchUpdate(function(){\r\n\t\t\t\tvar newTask = gantt.copy(item);\r\n\t\t\t\tgantt.silent(function(){\r\n\t\t\t\t\tgantt.deleteTask(item.id);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tdelete newTask[\"!nativeeditor_status\"];\r\n\t\t\t\tnewTask.type = gantt.config.types.task;\r\n\t\t\t\tnewTask.id = gantt.uid();\r\n\t\t\t\tgantt.addTask(newTask);\r\n\r\n\t\t\t\t//insertPlaceholder();\r\n\t\t\t});\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tgantt.config.types.placeholder = \"placeholder\";\r\n\tgantt.attachEvent(\"onDataProcessorReady\", callIfEnabled(silenceDataProcessor));\r\n\r\n\tvar ready = false;\r\n\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\t\tif(ready){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tready = true;\r\n\t\tgantt.attachEvent(\"onAfterTaskUpdate\", callIfEnabled(afterEdit));\r\n\t\tgantt.attachEvent(\"onAfterTaskAdd\", callIfEnabled(function(id, task){\r\n\t\t\tif(task.type != gantt.config.types.placeholder){\r\n\t\t\t\tvar placeholders = gantt.getTaskBy(\"type\", gantt.config.types.placeholder);\r\n\t\t\t\tplaceholders.forEach(function(p){\r\n\t\t\t\t\tgantt.silent(function(){\r\n\t\t\t\t\t\tif(gantt.isTaskExists(p.id))\r\n\t\t\t\t\t\t\tgantt.deleteTask(p.id);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\tinsertPlaceholder();\r\n\t\t\t}\r\n\t\t}));\r\n\t\tgantt.attachEvent(\"onParse\", callIfEnabled(insertPlaceholder));\r\n\t});\r\n\r\n\tfunction isPlaceholderTask(taskId){\r\n\t\tif(gantt.config.types.placeholder && gantt.isTaskExists(taskId)){\r\n\t\t\tvar task = gantt.getTask(taskId);\r\n\t\t\tif(task.type == gantt.config.types.placeholder){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tfunction isPlaceholderLink(link){\r\n\t\tif(isPlaceholderTask(link.source) || isPlaceholderTask(link.target)){\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tgantt.attachEvent(\"onLinkValidation\", function(link){\r\n\t\tif(isPlaceholderLink(link)){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t});\r\n\tgantt.attachEvent(\"onBeforeLinkAdd\", function(id,link){\r\n\t\tif(isPlaceholderLink(link)){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onBeforeUndoStack\", function(action){\r\n\t\tfor(var i = 0; i < action.commands.length; i++){\r\n\t\t\tvar command = action.commands[i];\r\n\t\t\tif(command.entity === \"task\" && command.value.type === gantt.config.types.placeholder){\r\n\t\t\t\taction.commands.splice(i,1);\r\n\t\t\t\ti--;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t});\r\n\r\n};","export default function(gantt) {\r\n\tfunction isEnabled() {\r\n\t\treturn gantt.config.auto_types && // if enabled\r\n\t\t\t(gantt.getTaskType(gantt.config.types.project) == gantt.config.types.project);// and supported\r\n\t}\r\n\r\n\tfunction callIfEnabled(callback) {\r\n\t\treturn function() {\r\n\t\t\tif (!isEnabled()) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn callback.apply(this, arguments);\r\n\t\t};\r\n\t}\r\n\r\n\tfunction checkTaskType(id, changedTypes) {\r\n\t\tvar task = gantt.getTask(id);\r\n\t\tvar targetType = getTaskTypeToUpdate(task);\r\n\t\tif (targetType !== false && gantt.getTaskType(task) !== targetType) {\r\n\t\t\tchangedTypes.$needsUpdate = true;\r\n\t\t\tchangedTypes[task.id] = {task: task, type: targetType};\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getUpdatedTypes(id, changedTypes) {\r\n\t\tchangedTypes = changedTypes || {};\r\n\t\t\r\n\t\tcheckTaskType(id, changedTypes);\r\n\t\tgantt.eachParent(function(parent) {\r\n\t\t\tcheckTaskType(parent.id, changedTypes);\r\n\t\t}, id);\r\n\r\n\t\treturn changedTypes;\r\n\t}\r\n\r\n\tfunction applyChanges(changedTypes) {\r\n\t\tfor (var i in changedTypes) {\r\n\t\t\tif(changedTypes[i] && changedTypes[i].task){\r\n\t\t\t\tvar task = changedTypes[i].task;\r\n\t\t\t\ttask.type = changedTypes[i].type;\r\n\t\t\t\tgantt.updateTask(task.id);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction updateParentTypes(startId) {\r\n\t\tif (gantt.getState().group_mode) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar changedTypes = getUpdatedTypes(startId);\r\n\t\tif (changedTypes.$needsUpdate) {\r\n\t\t\tgantt.batchUpdate(function() {\r\n\t\t\t\tapplyChanges(changedTypes);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tvar delTaskParent;\r\n\r\n\tfunction updateTaskType(task, targetType) {\r\n\t\tif(!gantt.getState().group_mode){\r\n\t\t\ttask.type = targetType;\r\n\t\t\tgantt.updateTask(task.id);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getTaskTypeToUpdate(task) {\r\n\t\tvar allTypes = gantt.config.types;\r\n\t\tvar hasChildren = gantt.hasChild(task.id);\r\n\t\tvar taskType = gantt.getTaskType(task.type);\r\n\r\n\t\tif (hasChildren && taskType === allTypes.task) {\r\n\t\t\treturn allTypes.project;\r\n\t\t}\r\n\r\n\t\tif (!hasChildren && taskType === allTypes.project) {\r\n\t\t\treturn allTypes.task;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tvar isParsingDone = true;\r\n\r\n\tgantt.attachEvent(\"onParse\", callIfEnabled(function() {\r\n\t\tisParsingDone = false;\r\n\t\tif(gantt.getState().group_mode){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tgantt.batchUpdate(function() {\r\n\t\t\tgantt.eachTask(function(task) {\r\n\t\t\t\tvar targetType = getTaskTypeToUpdate(task);\r\n\t\t\t\tif (targetType !== false) {\r\n\t\t\t\t\tupdateTaskType(task, targetType);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tisParsingDone = true;\r\n\t}));\r\n\r\n\tgantt.attachEvent(\"onAfterTaskAdd\", callIfEnabled(function(id) {\r\n\t\tif (isParsingDone) {\r\n\t\t\tupdateParentTypes(id);\r\n\t\t}\r\n\t}));\r\n\r\n\tgantt.attachEvent(\"onAfterTaskUpdate\", callIfEnabled(function(id) {\r\n\t\tif (isParsingDone) {\r\n\t\t\tupdateParentTypes(id);\r\n\t\t}\r\n\t}));\r\n\r\n\tfunction updateAfterRemoveChild(id){\r\n\t\tif (id != gantt.config.root_id && gantt.isTaskExists(id)) {\r\n\t\t\tupdateParentTypes(id);\r\n\t\t}\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onBeforeTaskDelete\", callIfEnabled(function(id, task) {\r\n\t\tdelTaskParent = gantt.getParent(id);\r\n\t\treturn true;\r\n\t}));\r\n\r\n\tgantt.attachEvent(\"onAfterTaskDelete\", callIfEnabled(function(id, task) {\r\n\t\tupdateAfterRemoveChild(delTaskParent);\r\n\t}));\r\n\r\n\r\n\tvar originalRowDndParent;\r\n\r\n\tgantt.attachEvent(\"onRowDragStart\", callIfEnabled(function(id, target, e) {\r\n\t\toriginalRowDndParent = gantt.getParent(id);\r\n\t\treturn true;\r\n\t}));\r\n\r\n\tgantt.attachEvent(\"onRowDragEnd\", callIfEnabled(function(id, target) {\r\n\t\tupdateAfterRemoveChild(originalRowDndParent);\r\n\t\tupdateParentTypes(id);\r\n\t}));\r\n\r\n\tvar originalMoveTaskParent;\r\n\r\n\tgantt.attachEvent(\"onBeforeTaskMove\", callIfEnabled(function(sid, parent, tindex) {\r\n\t\toriginalMoveTaskParent = gantt.getParent(sid);\r\n\t\treturn true;\r\n\t}));\r\n\r\n\tgantt.attachEvent(\"onAfterTaskMove\", callIfEnabled(function(id, parent, tindex) {\r\n\t\tif (document.querySelector(\".gantt_drag_marker\")) {\r\n\t\t\t// vertical dnd in progress\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tupdateAfterRemoveChild(originalMoveTaskParent);\r\n\t\tupdateParentTypes(id);\r\n\t}));\r\n};","export default class DurationFormatterNumeric implements IDurationFormatter {\r\n\tstatic create = (settings: IDurationFormatterConfig = null): IDurationFormatter => {\r\n\t\treturn new DurationFormatterNumeric();\r\n\t};\r\n\tcanParse = (value: string) : boolean => {\r\n\t\treturn !isNaN(this.parse(value));\r\n\t};\r\n\tformat = (value: number) : string => {\r\n\t\treturn String(value);\r\n\t};\r\n\tparse = (value: string) : number => {\r\n\t\treturn parseInt(value, 10);\r\n\t};\r\n}","export default class LinkFormatterSimple implements ILinkFormatter {\r\n\tstatic create = (settings: ILinkFormatterConfig = null, gantt: any): LinkFormatterSimple => {\r\n\t\treturn new LinkFormatterSimple(gantt);\r\n\t};\r\n\tprotected _linkReg: RegExp;\r\n\tprotected _gantt: any;\r\n\r\n\tconstructor(gantt: any) {\r\n\t\tthis._linkReg = /^[0-9\\.]+/;\r\n\t\tthis._gantt = gantt;\r\n\t}\r\n\r\n\tformat = (link: ILink) : string => {\r\n\t\tconst wbs = this._getWBSCode(link.source);\r\n\t\treturn wbs;\r\n\t};\r\n\r\n\tcanParse = (value: string) : boolean => {\r\n\t\treturn this._linkReg.test(value);\r\n\t};\r\n\tparse = (value: string) : ILink => {\r\n\t\tif(!this.canParse(value)){\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst linkPart = this._linkReg.exec(value)[0].trim();\r\n\r\n\t\tconst source = this._findSource(linkPart) || null;\r\n\r\n\t\treturn {\r\n\t\t\tid: undefined,\r\n\t\t\tsource,\r\n\t\t\ttarget: null,\r\n\t\t\ttype: this._gantt.config.links.finish_to_start,\r\n\t\t\tlag: 0\r\n\t\t};\r\n\t};\r\n\r\n\tprotected _getWBSCode = (source: number | string) => {\r\n\t\tconst pred = this._gantt.getTask(source);\r\n\t\treturn this._gantt.getWBSCode(pred);\r\n\t};\r\n\r\n\tprotected _findSource = (value: string) => {\r\n\t\tconst reqTemplate = new RegExp(\"^[0-9\\.]+\", \"i\");\r\n\t\tif(reqTemplate.exec(value)){\r\n\t\t\tconst wbs = reqTemplate.exec(value)[0];\r\n\t\t\tconst task = this._gantt.getTaskByWBSCode(wbs);\r\n\t\t\tif(task){\r\n\t\t\t\treturn task.id;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n}","\r\nimport DurationFormatter from \"../common/duration_formatter\";\r\nimport LinkFormatter from \"../common/link_formatter\";\r\n\r\nexport default function(gantt){\r\n\tgantt.ext.formatters = {\r\n\t\tdurationFormatter: function(settings){\r\n\t\t\tif(!settings){\r\n\t\t\t\tsettings = {};\r\n\t\t\t}\r\n\t\t\tif(!settings.store){\r\n\t\t\t\tsettings.store = gantt.config.duration_unit;\r\n\t\t\t}\r\n\t\t\tif(!settings.enter){\r\n\t\t\t\tsettings.enter = gantt.config.duration_unit;\r\n\t\t\t}\r\n\t\t\treturn DurationFormatter.create(settings, gantt);\r\n\t\t},\r\n\t\tlinkFormatter: function(settings){\r\n\t\t\treturn LinkFormatter.create(settings, gantt);\r\n\t\t}\r\n\t};\r\n};","export default function(gantt: any){\r\n\r\n\tgantt.ext = gantt.ext || {};\r\n\tgantt.config.show_empty_state = false;\r\n\r\n\tgantt.ext.emptyStateElement = gantt.ext.emptyStateElement || {\r\n\t\tisEnabled() {\r\n\t\t\treturn gantt.config.show_empty_state === true;\r\n\t\t},\r\n\t\tisGanttEmpty(){\r\n\t\t\treturn !gantt.getTaskByTime().length;\r\n\t\t},\r\n\t\trenderContent(container){\r\n\t\t\tconst placeholderTextElement = `<div class='gantt_empty_state_text'>\r\n    <div class='gantt_empty_state_text_link' data-empty-state-create-task>${gantt.locale.labels.empty_state_text_link}</div>\r\n    <div class='gantt_empty_state_text_description'>${gantt.locale.labels.empty_state_text_description}</div>\r\n    </div>`;\r\n\t\t\tconst placeholderImageElement = \"<div class='gantt_empty_state_image'></div>\";\r\n\r\n\t\t\tconst placeholderContainer = `<div class='gantt_empty_state'>${placeholderImageElement}${placeholderTextElement}</div>`;\r\n\t\t\tcontainer.innerHTML = placeholderContainer;\r\n\t\t},\r\n\r\n\t\tclickEvents: [],\r\n\t\tattachAddTaskEvent(){\r\n\t\t\tconst id = gantt.attachEvent(\"onEmptyClick\", function(e){\r\n\t\t\t\tconst domHelpers = gantt.utils.dom;\r\n\t\t\t\tconst gridPlaceholder = domHelpers.closest(e.target, \"[data-empty-state-create-task]\");\r\n\t\t\t\tif (gridPlaceholder){\r\n\t\t\t\t\tgantt.createTask({\r\n\t\t\t\t\t\tid: gantt.uid(),\r\n\t\t\t\t\t\ttext: \"New Task\"\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis.clickEvents.push(id);\r\n\t\t},\r\n\t\tdetachAddTaskEvents(){\r\n\t\t\tthis.clickEvents.forEach(function(event){\r\n\t\t\t\tgantt.detachEvent(event);\r\n\t\t\t});\r\n\t\t\tthis.clickEvents = [];\r\n\t\t},\r\n\r\n\t\tgetContainer(){\r\n\t\t\tif (gantt.$container) {\r\n\t\t\t\tconst domHelpers = gantt.utils.dom;\r\n\t\t\t\tif (gantt.$container.contains(gantt.$grid_data)) {\r\n\t\t\t\t\treturn domHelpers.closest(gantt.$grid_data, \".gantt_layout_content\");\r\n\t\t\t\t}\r\n\t\t\t\tif (gantt.$container.contains(gantt.$task_data)){\r\n\t\t\t\t\treturn domHelpers.closest(gantt.$task_data, \".gantt_layout_content\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t},\r\n\r\n\t\tgetNode(){\r\n\t\t\tconst container = this.getContainer();\r\n\t\t\tif (!container){\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tconst emptyStateElementNode = container.querySelector(\".gantt_empty_state_wrapper\");\r\n\t\t\treturn emptyStateElementNode;\r\n\t\t},\r\n\r\n\t\tshow(){\r\n\t\t\tconst container = this.getContainer();\r\n\t\t\tif (!container && this.isGanttEmpty()){\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tconst wrapper = document.createElement(\"div\");\r\n\t\t\twrapper.className = \"gantt_empty_state_wrapper\";\r\n\t\t\twrapper.style.marginTop = (gantt.config.scale_height - container.offsetHeight) + \"px\";\r\n\t\t\tconst oldNodes = gantt.$container.querySelectorAll(\".gantt_empty_state_wrapper\");\r\n\t\t\t// for IE11\r\n\t\t\tArray.prototype.forEach.call(oldNodes, function(node){\r\n\t\t\t\tnode.parentNode.removeChild(node);\r\n\t\t\t});\r\n\r\n\t\t\tthis.detachAddTaskEvents();\r\n\t\t\tthis.attachAddTaskEvent();\r\n\r\n\t\t\tcontainer.appendChild(wrapper);\r\n\t\t\tthis.renderContent(wrapper);\r\n\t\t},\r\n\t\thide(){\r\n\t\t\tconst emptyStateElementNode = this.getNode();\r\n\t\t\tif (emptyStateElementNode){\r\n\t\t\t\temptyStateElementNode.parentNode.removeChild(emptyStateElementNode);\r\n\t\t\t} else{\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tinit(){ }\r\n\t};\r\n\r\n\tgantt.attachEvent(\"onDataRender\", function() {\r\n\t\tconst emptyStateElement = gantt.ext.emptyStateElement;\r\n\t\tif (emptyStateElement.isEnabled() && emptyStateElement.isGanttEmpty()) {\r\n\t\t\temptyStateElement.show();\r\n\t\t} else {\r\n\t\t\temptyStateElement.hide();\r\n\t\t}\r\n\t});\r\n\r\n\r\n\r\n\r\n}\r\n","export const hasBaselinesBelow = function (gantt, task) {\r\n  const baselines = task.baselines && task.baselines.length;\r\n  const baselinesOnDifferentRow = gantt.config.baselines.render_mode == \"separateRow\" || gantt.config.baselines.render_mode == \"individualRow\";\r\n  if (baselines && baselinesOnDifferentRow) {\r\n    return true;\r\n  }\r\n};\r\n\r\nexport const childrenHaveBaselines = function (gantt, taskId) {\r\n  let hasBaselines = false;\r\n  gantt.eachTask(function (child) {\r\n    if (hasBaselines) {\r\n      return;\r\n    }\r\n    hasBaselines = hasBaselinesBelow(gantt, child);\r\n  }, taskId);\r\n  return hasBaselines;\r\n};\r\n\r\nexport const isSplitChild = function (gantt, id) {\r\n  let splitChild = false;\r\n  gantt.eachParent(function (parent) {\r\n    if (isSplitParent(parent)) {\r\n      splitChild = true;\r\n    }\r\n  }, id);\r\n  return splitChild;\r\n};\r\n\r\nexport const isSplitParent = function (task) {\r\n  return task.render && task.render == \"split\" && !task.$open;\r\n};\r\n\r\nexport const getMaxParentHeight = function (gantt, view, task, heightLimit) {\r\n  let maxHeight = heightLimit || view.$task_data.scrollHeight;\r\n  let shrinkHeight = false;\r\n  let splitChild = false;\r\n\r\n  gantt.eachParent(function (parent) {\r\n    if (isSplitParent(parent)) {\r\n      splitChild = true;\r\n      const parentSizes = view.getItemPosition(parent);\r\n      const parentHeight = parentSizes.rowHeight;\r\n      if (parentHeight < maxHeight) {\r\n        maxHeight = parentHeight;\r\n        shrinkHeight = true;\r\n      }\r\n    }\r\n  }, task.id);\r\n\r\n  return { maxHeight, shrinkHeight, splitChild };\r\n};\r\n\r\nexport const getMilestoneHeight = function (height) {\r\n  return Math.sqrt(2 * height * height);\r\n};\r\n\r\nexport const getInvertedMilestoneHeight = function (height) {\r\n  return Math.round(height / Math.sqrt(2));\r\n};\r\n\r\nexport const getAdjustedPosition = function (gantt, timeline, sizes, heightLimit, task, childBaselines) {\r\n  const baselines = hasBaselinesBelow(gantt, task);\r\n\r\n  const splitParams = getMaxParentHeight(gantt, timeline, task);\r\n  let maxHeight = splitParams.maxHeight;\r\n\r\n  let height = sizes.height;\r\n  let largerHeight = height > heightLimit;\r\n  let noNeedToShrink = sizes.rowHeight >= heightLimit && !splitParams.splitChild && !baselines;\r\n  if (largerHeight || noNeedToShrink) {\r\n    height = heightLimit;\r\n  }\r\n\r\n  if (maxHeight < height) {\r\n    height = maxHeight;\r\n  }\r\n\r\n  let marginTop = Math.floor((sizes.rowHeight - height) / 2);\r\n\r\n  if (splitParams.splitChild) {\r\n    marginTop = Math.floor((maxHeight - height) / 2);\r\n  }\r\n  if (childBaselines || baselines) {\r\n    let heightDiff = Math.min(sizes.height, maxHeight) - height;\r\n\r\n    let additionalMargin = 2;\r\n    let exceedBarHeight = baselines && task.bar_height >= task.row_height;\r\n    let exceedParentHeight = splitParams.splitChild && sizes.height >= maxHeight;\r\n    if (exceedBarHeight || exceedParentHeight){\r\n      additionalMargin = 0;\r\n    }\r\n\r\n    marginTop = Math.floor(heightDiff / 2) + additionalMargin;\r\n    const bottom = height + marginTop;\r\n    if (bottom > sizes.rowHeight || bottom > maxHeight) {\r\n      // marginTop = 0;\r\n    }\r\n  }\r\n\r\n  return { height, marginTop };\r\n};\r\n\r\nexport default {\r\n  hasBaselinesBelow,\r\n  childrenHaveBaselines,\r\n  isSplitChild,\r\n  isSplitParent,\r\n  getMaxParentHeight,\r\n  getMilestoneHeight,\r\n  getInvertedMilestoneHeight,\r\n  getAdjustedPosition\r\n};\r\n","import { hasBaselinesBelow, isSplitParent } from \"../ui/render/baseline_helper\";\r\nimport isHeadless from \"../../utils/is_headless\";\r\n\r\nexport default function (gantt) {\r\n  gantt.config.baselines = {\r\n    datastore: \"baselines\",\r\n    render_mode: false,\r\n    dataprocessor_baselines: false,\r\n    row_height: 16,\r\n    bar_height: 8\r\n  };\r\n\r\n  function initBaselineFields(item, task) {\r\n    // don't add baseline if it doesn't belong to any task\r\n    // or if doesn't have the dates\r\n    if (!item.task_id || (!item.start_date && !item.end_date)) {\r\n      return false;\r\n    }\r\n\r\n    if (item.start_date) {\r\n      item.start_date = gantt.date.parseDate(item.start_date, \"parse_date\");\r\n    } else {\r\n      item.start_date = null;\r\n    }\r\n\r\n    if (item.end_date) {\r\n      item.end_date = gantt.date.parseDate(item.end_date, \"parse_date\");\r\n    } else {\r\n      item.end_date = null;\r\n    }\r\n\r\n    // set min baseline duration\r\n    item.duration = item.duration || 1;\r\n\r\n    // GS-2636. Calculate the 3rd date parameter basing on existing date parameters\r\n    if (item.start_date && !item.end_date){\r\n      item.end_date = gantt.calculateEndDate(item.start_date, item.duration);\r\n    } else if (item.end_date && !item.start_date){\r\n      item.start_date = gantt.calculateEndDate(item.end_date, -item.duration);\r\n    } \r\n  }\r\n  // gantt init\r\n  const baselineStore = gantt.createDatastore({\r\n    name: gantt.config.baselines.datastore,\r\n    initItem: function (item) {\r\n      if (!item.id) {\r\n        item.id = gantt.uid();\r\n      }\r\n\r\n      initBaselineFields(item);\r\n\r\n      return item;\r\n    }\r\n  });\r\n\r\n  gantt.$data.baselineStore = baselineStore;\r\n\r\n  function _syncBaselines(task) {\r\n    let shouldRepaint = false;\r\n    const iteratedBaselines = {};\r\n\r\n    const taskBaselines = task.baselines || [];\r\n    const exisingBaselines = gantt.getTaskBaselines(task.id);\r\n\r\n    if (taskBaselines.length != exisingBaselines.length) {\r\n      shouldRepaint = true;\r\n    }\r\n\r\n    taskBaselines.forEach(function (baseline) {\r\n      iteratedBaselines[baseline.id] = true;\r\n      const exisingBaseline = baselineStore.getItem(baseline.id);\r\n      if (exisingBaseline) {\r\n        const start = +exisingBaseline.start_date !== +baseline.start_date;\r\n        const end = +exisingBaseline.end_date !== +baseline.end_date;\r\n        if (start || end) {\r\n          baselineStore.updateItem(baseline.id, baseline);\r\n        }\r\n      } else {\r\n        baselineStore.addItem(baseline);\r\n      }\r\n    });\r\n\r\n    exisingBaselines.forEach(function (baseline) {\r\n      if (!iteratedBaselines[baseline.id]) {\r\n        baselineStore.removeItem(baseline.id);\r\n      }\r\n    });\r\n\r\n    if (shouldRepaint) {\r\n      if (isSplitParent(task)){\r\n        // here we adjust the parent height, then adjust it with the total child height\r\n        _adjustSplitParentHeight (task);\r\n      } else {\r\n        gantt.adjustTaskHeightForBaselines(task);\r\n      }\r\n      gantt.render();\r\n    }\r\n  }\r\n\r\n  function _deleteOrphanBaselines() {\r\n    baselineStore.eachItem(function (baseline) {\r\n      if (!gantt.isTaskExists(baseline.task_id)) {\r\n        baselineStore.removeItem(baseline.id);\r\n      }\r\n    });\r\n  }\r\n\r\n  function _adjustSplitParentHeight (task){\r\n    let maxParentHeight = 0;\r\n\r\n    gantt.adjustTaskHeightForBaselines(task);\r\n\r\n    gantt.eachTask(function(child){\r\n      let childHeight = child.row_height || gantt.config.row_height;\r\n\r\n      maxParentHeight = maxParentHeight || childHeight;\r\n      if (childHeight > maxParentHeight){\r\n        maxParentHeight = childHeight;\r\n      }\r\n    }, task.id);\r\n\r\n    if (task.row_height < maxParentHeight){\r\n      task.row_height = maxParentHeight;\r\n    }\r\n  }\r\n\r\n  gantt.adjustTaskHeightForBaselines = function (task) {\r\n    let height, baselineSize, betweenBaselines;\r\n    let margins = 2;\r\n    let baselineAmount = task.baselines && task.baselines.length || 0;\r\n    const subrowHeight = gantt.config.baselines.row_height;\r\n    //const baselineBarHeight = task?.baselines.bar_height\r\n\r\n    const timelineView = gantt.getLayoutView(\"timeline\");\r\n    if (!timelineView || !gantt.config.show_chart){\r\n      return;\r\n    }\r\n\r\n    switch (gantt.config.baselines.render_mode) {\r\n      case \"taskRow\":\r\n        task.row_height = task.bar_height + 4;\r\n        break;\r\n\r\n      case \"separateRow\":\r\n        height = timelineView.getBarHeight(task.id);\r\n        if (baselineAmount) {\r\n          task.bar_height = task.bar_height || height;\r\n\r\n          if (task.bar_height > height){\r\n            height = task.bar_height;\r\n          }\r\n\r\n          task.row_height = height + subrowHeight;\r\n        } else if (task.bar_height) {\r\n          task.row_height = task.bar_height + 4;\r\n        }\r\n\r\n        _increaseSplitParentHeight(task);\r\n        break;\r\n\r\n      case \"individualRow\":\r\n        height = timelineView.getBarHeight(task.id);\r\n\r\n        if (baselineAmount) {\r\n          task.bar_height = task.bar_height || height;\r\n\r\n          if (task.bar_height > height){\r\n            height = task.bar_height;\r\n          }\r\n\r\n          baselineSize = subrowHeight * baselineAmount;\r\n       //   betweenBaselines = 3 * (baselineAmount + 1);\r\n\r\n          task.row_height = height + baselineSize + margins;\r\n        } else if (task.bar_height){\r\n          task.row_height = task.bar_height + 4;\r\n        }\r\n\r\n        _increaseSplitParentHeight(task);\r\n    }\r\n  };\r\n\r\n  function _increaseSplitParentHeight(task) {\r\n    gantt.eachParent(function (parent) {\r\n      if (isSplitParent(parent)) {\r\n        const parentHeight = parent.row_height || gantt.getLayoutView(\"timeline\").getBarHeight(parent.id);\r\n        let maxHeight = task.row_height;\r\n\r\n        // iterate only direct children\r\n        const subtasks = gantt.getChildren(parent.id);\r\n        subtasks.forEach(function (subtaskId) {\r\n          const subtask = gantt.getTask(subtaskId);\r\n          if (subtask.id == task.id) {\r\n            return;\r\n          }\r\n          const subtaskHeight = subtask.row_height || gantt.getLayoutView(\"timeline\").getBarHeight(subtask.id);\r\n          maxHeight = maxHeight || subtaskHeight;\r\n          if (subtaskHeight > maxHeight) {\r\n            maxHeight = subtaskHeight;\r\n          }\r\n        });\r\n\r\n        parent.row_height = maxHeight;\r\n        parent.bar_height = parent.bar_height || parentHeight;\r\n      }\r\n    }, task.id);\r\n  }\r\n\r\n  gantt.attachEvent(\r\n    \"onGanttReady\",\r\n    function () {\r\n\r\n      if(!gantt.config.baselines){\r\n        return;\r\n      }\r\n\r\n      gantt.attachEvent(\"onParse\", function () {\r\n        baselineStore.eachItem(function (baseline) {\r\n          const taskId = baseline.task_id;\r\n          if (gantt.isTaskExists(taskId)) {\r\n            const task = gantt.getTask(taskId);\r\n\r\n            task.baselines = task.baselines || [];\r\n\r\n            let newBaseline = true;\r\n            for (let i = 0; i < task.baselines.length; i++) {\r\n              let existingBaseline = task.baselines[i];\r\n              if (existingBaseline.id == baseline.id){\r\n                newBaseline = false;\r\n                gantt.mixin(existingBaseline, baseline, true);\r\n                break;\r\n              }\r\n            }\r\n            if (newBaseline){\r\n              task.baselines.push(baseline);\r\n            }\r\n\r\n            if(!isHeadless(gantt)){\r\n              if (isSplitParent(task)){\r\n                _adjustSplitParentHeight (task);\r\n              } else {\r\n                gantt.adjustTaskHeightForBaselines(task);\r\n              }\r\n            }\r\n          }\r\n        });\r\n      });\r\n\r\n      gantt.attachEvent(\"onBeforeTaskUpdate\", function (id, task) {\r\n        _syncBaselines(task);\r\n        return true;\r\n      });\r\n\r\n      gantt.attachEvent(\"onAfterUndo\", function(action){\r\n        const baselinesRenderedBelow = gantt.config.baselines.render_mode == \"separateRow\" || gantt.config.baselines.render_mode == \"individualRow\";\r\n        if (baselinesRenderedBelow && action){\r\n          let repaint = false;\r\n          action.commands.forEach(function(command){\r\n            if (command.entity == \"task\"){\r\n              const taskId = command.value.id;\r\n              if (gantt.isTaskExists(taskId)){\r\n                const task = gantt.getTask(taskId);\r\n                if (task.parent && gantt.isTaskExists(task.parent)){\r\n                  const parent = gantt.getTask(task.parent);\r\n                  if (isSplitParent(parent)){\r\n                    _adjustSplitParentHeight (parent);\r\n                    repaint = true;\r\n                  }\r\n                }\r\n              }    \r\n            }\r\n          });\r\n          if (repaint){\r\n            gantt.render();\r\n          }\r\n        }\r\n      });\r\n\r\n      gantt.attachEvent(\"onAfterTaskDelete\", function (id, task) {\r\n        if (hasBaselinesBelow){\r\n          if (task.parent && gantt.isTaskExists(task.parent)){\r\n            const parent = gantt.getTask(task.parent);\r\n            if (isSplitParent(parent)){\r\n              _adjustSplitParentHeight (parent);\r\n            }\r\n          }\r\n        }\r\n        _deleteOrphanBaselines();\r\n      });\r\n\r\n      gantt.getTaskBaselines = function (taskId) {\r\n        const baselines = [];\r\n        baselineStore.eachItem(function (baseline) {\r\n          if (baseline.task_id == taskId) {\r\n            baselines.push(baseline);\r\n          }\r\n        });\r\n        return baselines;\r\n      };\r\n      gantt.$data.baselineStore.attachEvent(\"onClearAll\", function () {\r\n        gantt.eachTask(function(task){\r\n          if (task.baselines){\r\n            delete task.baselines;\r\n          }\r\n        });\r\n        // The data should not be repainted as otherwise it causes issues when we have resource \r\n        // assignments and group tasks. It should be fixed when we add a repaint stack\r\n        // gantt.refreshData();\r\n        return true;\r\n      });\r\n\r\n      gantt.$data.tasksStore.attachEvent(\"onClearAll\", function () {\r\n        baselineStore.clearAll();\r\n        return true;\r\n      });\r\n      gantt.attachEvent(\"onTaskIdChange\", function (id, new_id) {\r\n        const baselines = baselineStore.find(function (a) {\r\n          return a.task_id == id;\r\n        });\r\n        baselines.forEach(function (a) {\r\n          a.task_id = new_id;\r\n          baselineStore.updateItem(a.id);\r\n        });\r\n      });\r\n    },\r\n    { once: true }\r\n  );\r\n};\r\n","import batch_update from \"./batch_update\";\r\nimport wbs from \"./wbs\";\r\nimport resources from \"./resources\";\r\nimport resource_assignments from \"./resource_assignments\";\r\nimport new_task_placeholder from \"./new_task_placeholder\";\r\nimport auto_task_types from \"./auto_task_types\";\r\nimport formatters from \"./formatters\";\r\nimport empty_state_screen from \"./empty_state_screen\";\r\nimport baselines from \"./baselines\";\r\n\r\nexport default function(gantt){\r\n\tif(!gantt.ext){\r\n\t\tgantt.ext = {};\r\n\t}\r\n\r\n\tvar modules = [\r\n\t\tbatch_update,\r\n\t\twbs,\r\n\t\tresources,\r\n\t\tresource_assignments,\r\n\t\tnew_task_placeholder,\r\n\t\tauto_task_types,\r\n\t\tformatters,\r\n\t\tempty_state_screen,\r\n\t\tbaselines\r\n\t];\r\n\r\n\tfor(var i = 0; i < modules.length; i++){\r\n\t\tif(modules[i])\r\n\t\t\tmodules[i](gantt);\r\n\t}\r\n};","export default function(gantt) {\r\n\tgantt.getGridColumn = function(name) {\r\n\t\tvar columns = gantt.config.columns;\r\n\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tif (columns[i].name == name)\r\n\t\t\t\treturn columns[i];\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t};\r\n\r\n\tgantt.getGridColumns = function() {\r\n\t\treturn gantt.config.columns.slice();\r\n\t};\r\n};","export default function(gantt) {\r\n\tgantt.isReadonly = function (item) {\r\n\r\n\t\tif((typeof item == \"number\" || typeof item == \"string\") && gantt.isTaskExists(item)){\r\n\t\t\titem = gantt.getTask(item);\r\n\t\t}\r\n\t\tif (item && item[this.config.editable_property]) {\r\n\t\t\treturn false;\r\n\t\t} else {\r\n\t\t\treturn (item && item[this.config.readonly_property]) || this.config.readonly;\r\n\t\t}\r\n\t};\r\n};","import * as helpers from \"../../utils/helpers\";\r\n\r\nexport default function(gantt) {\r\n\tgantt.load = function(){\r\n\t\tthrow new Error(\"gantt.load() method is not available in the node.js, use gantt.parse() instead\");\r\n\t};\r\n\tgantt.parse = function (data, type) {\r\n\t\tthis.on_load({xmlDoc: {responseText: data}}, type);\r\n\t};\r\n\r\n\tgantt.serialize = function (type) {\r\n\t\ttype = type || \"json\";\r\n\t\treturn this[type].serialize();\r\n\t};\r\n\r\n\t/*\r\n\ttasks and relations\r\n\t{\r\n\tdata:[\r\n\t\t{\r\n\t\t\t\"id\":\"string\",\r\n\t\t\t\"text\":\"...\",\r\n\t\t\t\"start_date\":\"Date or string\",\r\n\t\t\t\"end_date\":\"Date or string\",\r\n\t\t\t\"duration\":\"number\",\r\n\t\t\t\"progress\":\"0..1\",\r\n\t\t\t\"parent_id\":\"string\",\r\n\t\t\t\"order\":\"number\"\r\n\t\t},...],\r\n\tlinks:[\r\n\t\t{\r\n\t\t\tid:\"string\",\r\n\t\t\tsource:\"string\",\r\n\t\t\ttarget:\"string\",\r\n\t\t\ttype:\"string\"\r\n\t\t},...],\r\n\tcollections:{\r\n\t\t\tcollectionName:[\r\n\t\t\t\t{key:, label:, optional:...},...\r\n\t\t\t],...\r\n\t\t}\r\n\t}\r\n\r\n\t* */\r\n\r\n\tgantt.on_load = function (resp, type) {\r\n\t\tif(resp.xmlDoc && resp.xmlDoc.status === 404){ // work if we don't have a file at current url\r\n\t\t\tthis.assert(false, \"Failed to load the data from <a href='\" + resp.xmlDoc.responseURL + \"' target='_blank'>\" \r\n\t\t\t\t+ resp.xmlDoc.responseURL + \"</a>, server returns 404\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(gantt.$destroyed){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.callEvent(\"onBeforeParse\", []);\r\n\t\tif (!type)\r\n\t\t\ttype = \"json\";\r\n\t\tthis.assert(this[type], \"Invalid data type:'\" + type + \"'\");\r\n\r\n\t\tvar raw = resp.xmlDoc.responseText;\r\n\r\n\t\tvar data = this[type].parse(raw, resp);\r\n\t\tthis._process_loading(data);\r\n\t};\r\n\r\n\tfunction attachAssignmentsToTasks(tasks, assignments) {\r\n\t\tconst assignmentsByTasks = {};\r\n\t\tassignments.forEach((a)=>{\r\n\t\t\tif(!assignmentsByTasks[a.task_id]) {\r\n\t\t\t\tassignmentsByTasks[a.task_id] = [];\r\n\t\t\t}\r\n\t\t\tassignmentsByTasks[a.task_id].push(a);\r\n\t\t});\r\n\t\ttasks.forEach((t) => {\r\n\t\t\tt[gantt.config.resource_property] = assignmentsByTasks[t.id] || [];\r\n\t\t});\t\r\n\t}\r\n\t\r\n\tgantt._process_loading = function (data) {\r\n\t\tif(data.collections)\r\n\t\t\tthis._load_collections(data.collections);\r\n\r\n\t\tif(data.resources && this.$data.resourcesStore){\r\n\t\t\tthis.$data.resourcesStore.parse(data.resources);\r\n\t\t}\r\n\t\tif(gantt.config.baselines && data.baselines && this.$data.baselineStore){\r\n\t\t\tthis.$data.baselineStore.parse(data.baselines);\r\n\t\t}\r\n\t\t\r\n\t\tconst tasks = data.data || data.tasks;\r\n\t\tif(data.assignments){\r\n\t\t\tattachAssignmentsToTasks(tasks, data.assignments);\r\n\t\t}\r\n\r\n\t\tthis.$data.tasksStore.parse(tasks);\r\n\t\tvar links = data.links || ((data.collections && data.collections.links) ? data.collections.links : []);\r\n\t\tthis.$data.linksStore.parse(links);\r\n\r\n\t\t//this._sync_links();\r\n\t\tthis.callEvent(\"onParse\", []);\r\n\t\tthis.render();\r\n\t};\r\n\r\n\tgantt._load_collections = function (collections) {\r\n\t\tvar collections_loaded = false;\r\n\t\tfor (var key in collections) {\r\n\t\t\tif (collections.hasOwnProperty(key)) {\r\n\t\t\t\tcollections_loaded = true;\r\n\t\t\t\tvar collection = collections[key];\r\n\t\t\t\t// GS-1728. Create an empty serverList if it doesn't exist\r\n\t\t\t\tthis.serverList[key] = this.serverList[key] || [];\r\n\t\t\t\tvar arr = this.serverList[key];\r\n\t\t\t\tif (!arr) continue;\r\n\t\t\t\tarr.splice(0, arr.length); //clear old options\r\n\t\t\t\tfor (var j = 0; j < collection.length; j++) {\r\n\t\t\t\t\tvar option = collection[j];\r\n\t\t\t\t\tvar obj = this.copy(option);\r\n\t\t\t\t\tobj.key = obj.value;// resulting option object\r\n\r\n\t\t\t\t\tfor (var option_key in option) {\r\n\t\t\t\t\t\tif (option.hasOwnProperty(option_key)) {\r\n\t\t\t\t\t\t\tif (option_key == \"value\" || option_key == \"label\")\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\tobj[option_key] = option[option_key]; // obj['value'] = option['value']\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tarr.push(obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (collections_loaded)\r\n\t\t\tthis.callEvent(\"onOptionsLoad\", []);\r\n\t};\r\n\r\n\tgantt.attachEvent(\"onBeforeTaskDisplay\", function (id, task) {\r\n\t\treturn !task.$ignore;\r\n\t});\r\n\r\n\tfunction jsonParseError(data){\r\n\t\tgantt.assert(false, \"Can't parse data: incorrect value of gantt.parse or gantt.load method. \"\r\n\t\t\t+ \"Actual argument value: \" + JSON.stringify(data));\r\n\t\tthrow new Error(\"Invalid argument for gantt.parse or gantt.load. An object or a JSON string of format https://docs.dhtmlx.com/gantt/desktop__supported_data_formats.html#json is expected. Actual argument value: \"\r\n\t\t\t+ JSON.stringify(data));\r\n\t}\r\n\r\n\tgantt.json = {\r\n\t\tparse: function (data) {\r\n\t\t\tif(!data){\r\n\t\t\t\tjsonParseError(data);\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof data == \"string\") {\r\n\t\t\t\tif (typeof JSON != undefined){\r\n\t\t\t\t\ttry{\r\n\t\t\t\t\t\tdata = JSON.parse(data);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch(e) {\r\n\t\t\t\t\t\tjsonParseError(data);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tgantt.assert(false, \"JSON is not supported\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(!data.data && !data.tasks){\r\n\t\t\t\tjsonParseError(data);\r\n\t\t\t}\r\n\r\n\t\t\tif (data.dhx_security)\r\n\t\t\t\tgantt.security_key = data.dhx_security;\r\n\t\t\treturn data;\r\n\t\t},\r\n\t\tserializeTask: function (task) {\r\n\t\t\treturn this._copyObject(task);\r\n\t\t},\r\n\t\tserializeLink: function (link) {\r\n\t\t\treturn this._copyLink(link);\r\n\t\t},\r\n\t\t_copyLink: function (obj) {\r\n\t\t\tvar copy = {};\r\n\t\t\tfor (var key in obj)\r\n\t\t\t\tcopy[key] = obj[key];\r\n\t\t\treturn copy;\r\n\t\t},\r\n\t\t_copyObject: function (obj) {\r\n\t\t\tvar copy = {};\r\n\t\t\tfor (var key in obj) {\r\n\t\t\t\tif (key.charAt(0) == \"$\")\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\tcopy[key] = obj[key];\r\n\r\n\t\t\t\tif (helpers.isDate(copy[key])) {\r\n\t\t\t\t\tcopy[key] = gantt.defined(gantt.templates.xml_format) ? gantt.templates.xml_format(copy[key]) : gantt.templates.format_date(copy[key]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn copy;\r\n\t\t},\r\n\t\tserialize: function () {\r\n\t\t\tvar tasks = [];\r\n\t\t\tvar links = [];\r\n\t\t\tlet baselines = [];\r\n\r\n\t\t\tgantt.eachTask(function (obj) {\r\n\t\t\t\tgantt.resetProjectDates(obj);\r\n\t\t\t\ttasks.push(this.serializeTask(obj));\r\n\t\t\t}, gantt.config.root_id, this);\r\n\r\n\t\t\tvar rawLinks = gantt.getLinks();\r\n\t\t\tfor (var i = 0; i < rawLinks.length; i++) {\r\n\t\t\t\tlinks.push(this.serializeLink(rawLinks[i]));\r\n\t\t\t}\r\n\r\n\t\t\tconst baselineStore = gantt.getDatastore(\"baselines\");\r\n\t\t\tbaselineStore.eachItem(function(baseline){\r\n\t\t\t\tconst baselineCopy = gantt.json.serializeTask(baseline);\r\n\t\t\t\tbaselines.push(baselineCopy);\r\n\t\t\t});\r\n\r\n\t\t\treturn {\r\n\t\t\t\tdata: tasks,\r\n\t\t\t\tlinks,\r\n\t\t\t\tbaselines\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n\r\n\t/*\r\n\t<data>\r\n\t\t<task id:\"some\" parent_id=\"0\" progress=\"0.5\">\r\n\t\t\t<text>My task 1</text>\r\n\t\t\t<start_date>16.08.2013</start_date>\r\n\t\t\t<end_date>22.08.2013</end_date>\r\n\t\t</task>\r\n\t\t<coll_options>\r\n\t\t\t<links>\r\n\t\t\t\t<link source='a1' target='b2' type='c3' />\r\n\t\t\t</links>\r\n\t\t</coll_options>\r\n\t</data>\r\n\t*/\r\n\r\n\tfunction xmlParseError(data){\r\n\t\tgantt.assert(false, \"Can't parse data: incorrect value of gantt.parse or gantt.load method. \"\r\n\t\t\t+ \"Actual argument value: \" + JSON.stringify(data));\r\n\t\tthrow new Error(\"Invalid argument for gantt.parse or gantt.load. An XML of format https://docs.dhtmlx.com/gantt/desktop__supported_data_formats.html#xmldhtmlxgantt20 is expected. Actual argument value: \"\r\n\t\t\t+ JSON.stringify(data));\r\n\t}\r\n\r\n\tgantt.xml = {\r\n\t\t_xmlNodeToJSON: function (node, attrs_only) {\r\n\t\t\tvar t = {};\r\n\t\t\tfor (var i = 0; i < node.attributes.length; i++)\r\n\t\t\t\tt[node.attributes[i].name] = node.attributes[i].value;\r\n\r\n\t\t\tif (!attrs_only) {\r\n\t\t\t\tfor (var i = 0; i < node.childNodes.length; i++) {\r\n\t\t\t\t\tvar child = node.childNodes[i];\r\n\t\t\t\t\tif (child.nodeType == 1)\r\n\t\t\t\t\t\tt[child.tagName] = child.firstChild ? child.firstChild.nodeValue : \"\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!t.text) t.text = node.firstChild ? node.firstChild.nodeValue : \"\";\r\n\t\t\t}\r\n\r\n\t\t\treturn t;\r\n\t\t},\r\n\t\t_getCollections: function (loader) {\r\n\t\t\tvar collection = {};\r\n\t\t\tvar opts = gantt.ajax.xpath(\"//coll_options\", loader);\r\n\t\t\tfor (var i = 0; i < opts.length; i++) {\r\n\t\t\t\tvar bind = opts[i].getAttribute(\"for\");\r\n\t\t\t\tvar arr = collection[bind] = [];\r\n\t\t\t\tvar itms = gantt.ajax.xpath(\".//item\", opts[i]);\r\n\t\t\t\tfor (var j = 0; j < itms.length; j++) {\r\n\t\t\t\t\tvar itm = itms[j];\r\n\t\t\t\t\tvar attrs = itm.attributes;\r\n\t\t\t\t\tvar obj = {key: itms[j].getAttribute(\"value\"), label: itms[j].getAttribute(\"label\")};\r\n\t\t\t\t\tfor (var k = 0; k < attrs.length; k++) {\r\n\t\t\t\t\t\tvar attr = attrs[k];\r\n\t\t\t\t\t\tif (attr.nodeName == \"value\" || attr.nodeName == \"label\")\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\tobj[attr.nodeName] = attr.nodeValue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tarr.push(obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn collection;\r\n\t\t},\r\n\t\t_getXML: function (text, loader, toptag) {\r\n\t\t\ttoptag = toptag || \"data\";\r\n\t\t\tif (!loader.getXMLTopNode) {\r\n\t\t\t\tloader = gantt.ajax.parse(loader);\r\n\t\t\t}\r\n\r\n\t\t\tvar xml = gantt.ajax.xmltop(toptag, loader.xmlDoc);\r\n\t\t\tif (!xml || xml.tagName != toptag) {\r\n\t\t\t\txmlParseError(text);\r\n\t\t\t}\r\n\r\n\t\t\tvar skey = xml.getAttribute(\"dhx_security\");\r\n\t\t\tif (skey)\r\n\t\t\t\tgantt.security_key = skey;\r\n\r\n\t\t\treturn xml;\r\n\t\t},\r\n\t\tparse: function (text, loader) {\r\n\t\t\tloader = this._getXML(text, loader);\r\n\t\t\tvar data = {};\r\n\r\n\t\t\tvar evs = data.data = [];\r\n\t\t\tvar xml = gantt.ajax.xpath(\"//task\", loader);\r\n\r\n\t\t\tfor (var i = 0; i < xml.length; i++)\r\n\t\t\t\tevs[i] = this._xmlNodeToJSON(xml[i]);\r\n\r\n\t\t\tdata.collections = this._getCollections(loader);\r\n\t\t\treturn data;\r\n\t\t},\r\n\t\t_copyLink: function (obj) {\r\n\t\t\treturn \"<item id='\" + obj.id + \"' source='\" + obj.source + \"' target='\" + obj.target + \"' type='\" + obj.type + \"' />\";\r\n\t\t},\r\n\t\t_copyObject: function (obj) {\r\n\t\t\treturn \"<task id='\" + obj.id + \"' parent='\" + (obj.parent || \"\") + \"' start_date='\" + obj.start_date + \"' duration='\" + obj.duration + \"' open='\" + (!!obj.open) + \"' progress='\" + obj.progress + \"' end_date='\" + obj.end_date + \"'><![CDATA[\" + obj.text + \"]]></task>\";\r\n\t\t},\r\n\t\tserialize: function () {\r\n\t\t\tvar tasks = [];\r\n\t\t\tvar links = [];\r\n\r\n\t\t\tvar json = gantt.json.serialize();\r\n\t\t\tfor (var i = 0, len = json.data.length; i < len; i++) {\r\n\t\t\t\ttasks.push(this._copyObject(json.data[i]));\r\n\t\t\t}\r\n\t\t\tfor (var i = 0, len = json.links.length; i < len; i++) {\r\n\t\t\t\tlinks.push(this._copyLink(json.links[i]));\r\n\t\t\t}\r\n\t\t\treturn \"<data>\" + tasks.join(\"\") + \"<coll_options for='links'>\" + links.join(\"\") + \"</coll_options></data>\";\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tgantt.oldxml = {\r\n\t\tparse: function (text, loader) {\r\n\t\t\tloader = gantt.xml._getXML(text, loader, \"projects\");\r\n\t\t\tvar data = {collections: {links: []}};\r\n\r\n\t\t\tvar evs = data.data = [];\r\n\t\t\tvar xml = gantt.ajax.xpath(\"//task\", loader);\r\n\r\n\t\t\tfor (var i = 0; i < xml.length; i++) {\r\n\t\t\t\tevs[i] = gantt.xml._xmlNodeToJSON(xml[i]);\r\n\t\t\t\tvar parent = xml[i].parentNode;\r\n\r\n\t\t\t\tif (parent.tagName == \"project\")\r\n\t\t\t\t\tevs[i].parent = \"project-\" + parent.getAttribute(\"id\");\r\n\t\t\t\telse\r\n\t\t\t\t\tevs[i].parent = parent.parentNode.getAttribute(\"id\");\r\n\t\t\t}\r\n\r\n\t\t\txml = gantt.ajax.xpath(\"//project\", loader);\r\n\t\t\tfor (var i = 0; i < xml.length; i++) {\r\n\t\t\t\tvar ev = gantt.xml._xmlNodeToJSON(xml[i], true);\r\n\t\t\t\tev.id = \"project-\" + ev.id;\r\n\t\t\t\tevs.push(ev);\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0; i < evs.length; i++) {\r\n\t\t\t\tvar ev = evs[i];\r\n\t\t\t\tev.start_date = ev.startdate || ev.est;\r\n\t\t\t\tev.end_date = ev.enddate;\r\n\t\t\t\tev.text = ev.name;\r\n\t\t\t\tev.duration = ev.duration / 8;\r\n\t\t\t\tev.open = 1;\r\n\t\t\t\tif (!ev.duration && !ev.end_date) ev.duration = 1;\r\n\t\t\t\tif (ev.predecessortasks)\r\n\t\t\t\t\tdata.collections.links.push({\r\n\t\t\t\t\t\ttarget: ev.id,\r\n\t\t\t\t\t\tsource: ev.predecessortasks,\r\n\t\t\t\t\t\ttype: gantt.config.links.finish_to_start\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\t\t},\r\n\t\tserialize: function () {\r\n\t\t\tgantt.message(\"Serialization to 'old XML' is not implemented\");\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.serverList = function (name, array) {\r\n\t\tif (array) {\r\n\t\t\tthis.serverList[name] = array.slice(0);\r\n\t\t} else if (!this.serverList[name]) {\r\n\t\t\tthis.serverList[name] = [];\r\n\t\t}\r\n\t\treturn this.serverList[name];\r\n\t};\r\n\r\n};","import * as utils from \"../../utils/utils\";\r\nimport * as helpers from \"../../utils/helpers\";\r\n\r\n\r\nfunction IsWorkTimeArgument(date, unit, task, id, calendar){\r\n\tthis.date = date;\r\n\tthis.unit = unit;\r\n\tthis.task = task;\r\n\tthis.id = id;\r\n\tthis.calendar = calendar;\r\n\treturn this;\r\n}\r\n\r\nfunction ClosestWorkTimeArgument(date, dir, unit, task, id, calendar){\r\n\tthis.date = date;\r\n\tthis.dir = dir;\r\n\tthis.unit = unit;\r\n\tthis.task = task;\r\n\tthis.id = id;\r\n\tthis.calendar = calendar;\r\n\treturn this;\r\n}\r\n\r\nfunction CalculateEndDateArgument(start_date, duration, unit, step, task, id, calendar){\r\n\tthis.start_date = start_date;\r\n\tthis.duration = duration;\r\n\tthis.unit = unit;\r\n\tthis.step = step;\r\n\tthis.task = task;\r\n\tthis.id = id;\r\n\tthis.calendar = calendar;\r\n\treturn this;\r\n}\r\n\r\nfunction GetDurationArgument(start, end, task, calendar) {\r\n\tthis.start_date = start;\r\n\tthis.end_date = end;\r\n\tthis.task = task;\r\n\tthis.calendar = calendar;\r\n\tthis.unit = null;\r\n\tthis.step = null;\r\n\treturn this;\r\n}\r\n\r\nvar calendarArgumentsHelper = function(gantt){\r\n\treturn {\r\n\t\tgetWorkHoursArguments: function () {\r\n\t\t\tvar config = arguments[0];\r\n\t\t\tif (helpers.isDate(config)) {\r\n\t\t\t\tconfig = {\r\n\t\t\t\t\tdate: config\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\tconfig = utils.mixin({}, config);\r\n\t\t\t}\r\n\r\n\t\t\tif(!helpers.isValidDate(config.date)){\r\n\t\t\t\tgantt.assert(false, \"Invalid date argument for getWorkHours method\");\r\n\t\t\t\tthrow new Error(\"Invalid date argument for getWorkHours method\");\r\n\t\t\t}\r\n\r\n\t\t\treturn config;\r\n\t\t},\r\n\t\tsetWorkTimeArguments: function () {\r\n\t\t\treturn arguments[0];\r\n\t\t},\r\n\t\tunsetWorkTimeArguments: function () {\r\n\t\t\treturn arguments[0];\r\n\t\t},\r\n\t\tisWorkTimeArguments: function () {\r\n\t\t\tvar config = arguments[0];\r\n\t\t\tif(config instanceof IsWorkTimeArgument){\r\n\t\t\t\treturn config;\r\n\t\t\t}\r\n\r\n\t\t\tvar processedConfig;\r\n\t\t\tif (!config.date) {\r\n\t\t\t\t//IsWorkTimeArgument(date, unit, task, id, calendar)\r\n\t\t\t\tprocessedConfig = new IsWorkTimeArgument(arguments[0], arguments[1], arguments[2], null, arguments[3]);\r\n\t\t\t} else {\r\n\t\t\t\tprocessedConfig = new IsWorkTimeArgument(config.date, config.unit, config.task, null, config.calendar);\r\n\t\t\t}\r\n\r\n\t\t\tprocessedConfig.unit = processedConfig.unit || gantt.config.duration_unit;\r\n\r\n\t\t\tif(!helpers.isValidDate(processedConfig.date)){\r\n\t\t\t\tgantt.assert(false, \"Invalid date argument for isWorkTime method\");\r\n\t\t\t\tthrow new Error(\"Invalid date argument for isWorkTime method\");\r\n\t\t\t}\r\n\r\n\t\t\treturn processedConfig;\r\n\t\t},\r\n\t\tgetClosestWorkTimeArguments: function (arg) {\r\n\t\t\tvar config = arguments[0];\r\n\t\t\tif (config instanceof ClosestWorkTimeArgument)\r\n\t\t\t\treturn config;\r\n\r\n\t\t\tvar processedConfig;\r\n\t\t\tif (helpers.isDate(config)) {\r\n\t\t\t\tprocessedConfig = new ClosestWorkTimeArgument(config);\r\n\r\n\t\t\t} else {\r\n\t\t\t\tprocessedConfig = new ClosestWorkTimeArgument(\r\n\t\t\t\t\tconfig.date,\r\n\t\t\t\t\tconfig.dir,\r\n\t\t\t\t\tconfig.unit,\r\n\t\t\t\t\tconfig.task,\r\n\t\t\t\t\tnull,//config.id,\r\n\t\t\t\t\tconfig.calendar\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tif(config.id){\r\n\t\t\t\tprocessedConfig.task = config;\r\n\t\t\t}\r\n\t\t\tprocessedConfig.dir = config.dir || 'any';\r\n\t\t\tprocessedConfig.unit = config.unit || gantt.config.duration_unit;\r\n\r\n\t\t\tif(!helpers.isValidDate(processedConfig.date)){\r\n\t\t\t\tgantt.assert(false, \"Invalid date argument for getClosestWorkTime method\");\r\n\t\t\t\tthrow new Error(\"Invalid date argument for getClosestWorkTime method\");\r\n\t\t\t}\r\n\t\t\treturn processedConfig;\r\n\t\t},\r\n\r\n\t\t_getStartEndConfig: function (param) {\r\n\t\t\tvar argumentType = GetDurationArgument;\r\n\t\t\tvar config;\r\n\t\t\tif (param instanceof argumentType)\r\n\t\t\t\treturn param;\r\n\r\n\t\t\tif (helpers.isDate(param)) {\r\n\t\t\t\tconfig = new argumentType(arguments[0], arguments[1], arguments[2], arguments[3]);\r\n\t\t\t} else {\r\n\t\t\t\tconfig = new argumentType(param.start_date, param.end_date, param.task);\r\n\t\t\t\tif (param.id !== null && param.id !== undefined) {\r\n\t\t\t\t\tconfig.task = param;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconfig.unit = config.unit || gantt.config.duration_unit;\r\n\t\t\tconfig.step = config.step || gantt.config.duration_step;\r\n\t\t\tconfig.start_date = config.start_date || config.start || config.date;\r\n\r\n\t\t\tif(!helpers.isValidDate(config.start_date)){\r\n\t\t\t\tgantt.assert(false, \"Invalid start_date argument for getDuration method\");\r\n\t\t\t\tthrow new Error(\"Invalid start_date argument for getDuration method\");\r\n\t\t\t}\r\n\r\n\t\t\tif(!helpers.isValidDate(config.end_date)){\r\n\t\t\t\tgantt.assert(false, \"Invalid end_date argument for getDuration method\");\r\n\t\t\t\tthrow new Error(\"Invalid end_date argument for getDuration method\");\r\n\t\t\t}\r\n\r\n\t\t\treturn config;\r\n\t\t},\r\n\r\n\t\tgetDurationArguments: function (start, end, unit, step) {\r\n\t\t\treturn this._getStartEndConfig.apply(this, arguments);\r\n\t\t},\r\n\r\n\t\thasDurationArguments: function (start, end, unit, step) {\r\n\t\t\treturn this._getStartEndConfig.apply(this, arguments);\r\n\t\t},\r\n\r\n\t\tcalculateEndDateArguments: function (start, duration, unit, step) {\r\n\t\t\tvar config = arguments[0];\r\n\t\t\tif (config instanceof CalculateEndDateArgument)\r\n\t\t\t\treturn config;\r\n\r\n\t\t\tvar processedConfig;\r\n\t\t\t//CalculateEndDateArgument(start_date, duration, unit, step, task, id, calendar)\r\n\t\t\tif (helpers.isDate(config)) {\r\n\t\t\t\tprocessedConfig = new CalculateEndDateArgument(\r\n\t\t\t\t\targuments[0],\r\n\t\t\t\t\targuments[1],\r\n\t\t\t\t\targuments[2],\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\targuments[3],\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\targuments[4]\r\n\t\t\t\t);\r\n\r\n\t\t\t} else {\r\n\t\t\t\tprocessedConfig = new CalculateEndDateArgument(\r\n\t\t\t\t\tconfig.start_date,\r\n\t\t\t\t\tconfig.duration,\r\n\t\t\t\t\tconfig.unit,\r\n\t\t\t\t\tconfig.step,\r\n\t\t\t\t\tconfig.task,\r\n\t\t\t\t\tnull,//config.id,\r\n\t\t\t\t\tconfig.calendar\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tif(config.id !== null && config.id !== undefined){\r\n\t\t\t\tprocessedConfig.task = config;\r\n\r\n\t\t\t\t// received a task object as an argument\r\n\t\t\t\t// ignore 'unit' and 'step' properties in this case, since it's likely a part of data model of a task\r\n\t\t\t\tprocessedConfig.unit = null;\r\n\t\t\t\tprocessedConfig.step = null;\r\n\t\t\t}\r\n\r\n\t\t\tprocessedConfig.unit = processedConfig.unit || gantt.config.duration_unit;\r\n\t\t\tprocessedConfig.step = processedConfig.step || gantt.config.duration_step;\r\n\r\n\t\t\tif(!helpers.isValidDate(processedConfig.start_date)){\r\n\t\t\t\tgantt.assert(false, \"Invalid start_date argument for calculateEndDate method\");\r\n\t\t\t\tthrow new Error(\"Invalid start_date argument for calculateEndDate method\");\r\n\t\t\t}\r\n\r\n\t\t\treturn processedConfig;\r\n\t\t}\r\n\t};\r\n};\r\n\r\n\r\nexport default calendarArgumentsHelper;","import * as utils from \"../../../utils/utils\";\r\nfunction WorkTimeCalendarMerger(){\r\n}\r\n\r\nWorkTimeCalendarMerger.prototype = {\r\n\r\n\r\n\t/**\r\n\t * convert hours array items into objects, e.g. [8, 12, 17, 18] -> [{start: 8, end: 12}, {start:17, end:18}]\r\n\t * @param {Array} hoursArray\r\n\t */\r\n\t_getIntervals: function(hoursArray){\r\n\t\tvar result = [];\r\n\t\tfor(var i = 0; i < hoursArray.length; i += 2){\r\n\r\n\t\t\tresult.push({\r\n\t\t\t\tstart: hoursArray[i],\r\n\t\t\t\tend: hoursArray[i+1]\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/**\r\n\t * Convert ranges config into hours array\r\n\t * [{start: 8, end: 12}, {start:17, end:18}] --> [8, 12, 17, 18]\r\n\t * @param {*} intervalsArray\r\n\t */\r\n\t_toHoursArray: function(intervalsArray){\r\n\t\tvar result = [];\r\n\r\n\t\tfunction toFixed(value){\r\n\t\t\tvar str = String(value);\r\n\t\t\tif(str.length < 2){\r\n\t\t\t\tstr = \"0\" + str;\r\n\t\t\t}\r\n\t\t\treturn str;\r\n\t\t}\r\n\t\tfunction formatHHMM(secondsValue){\r\n\t\t\tvar hours = Math.floor(secondsValue / (60*60));\r\n\t\t\tvar minutePart = secondsValue - hours * 60 * 60;\r\n\r\n\t\t\tvar minutes = Math.floor(minutePart / (60));\r\n\t\t\treturn hours + \":\" + toFixed(minutes);\r\n\t\t}\r\n\t\tfor(var i = 0; i < intervalsArray.length; i++){\r\n\t\t\tresult.push(\r\n\t\t\t\tformatHHMM(intervalsArray[i].start) +\r\n\t\t\t\t\"-\" +\r\n\t\t\t\tformatHHMM(intervalsArray[i].end)\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/**\r\n\t * Build intersection of hour intervals. e.g.\r\n\t * first: [{start: 8, end: 12}, {start:13, end:18}]\r\n\t * second: [{start: 10, end: 15}]\r\n\t * result: [{start: 10, end: 12}, {start: 13, end: 15}]\r\n\t * @param {Array} first\r\n\t * @param {Array} second\r\n\t */\r\n\t_intersectHourRanges: function(first, second){\r\n\t\tvar result = [];\r\n\r\n\t\tvar baseArray = first.length > second.length ? first : second;\r\n\t\tvar overridesArray = first === baseArray ? second: first;\r\n\t\tbaseArray = baseArray.slice();\r\n\t\toverridesArray = overridesArray.slice();\r\n\r\n\t\tvar result = [];\r\n\t\tfor(var i = 0; i < baseArray.length; i++){\r\n\t\t\tvar base = baseArray[i];\r\n\r\n\t\t\tfor(var j = 0; j < overridesArray.length; j++){\r\n\t\t\t\tvar current = overridesArray[j];\r\n\t\t\t\tif(current.start < base.end && current.end > base.start){\r\n\t\t\t\t\tresult.push({\r\n\t\t\t\t\t\tstart: Math.max(base.start, current.start),\r\n\t\t\t\t\t\tend: Math.min(base.end, current.end)\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif(base.end > current.end){\r\n\t\t\t\t\t\toverridesArray.splice(j, 1);\r\n\t\t\t\t\t\tj--;\r\n\t\t\t\t\t\ti--;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/**\r\n\t * Reduce the number of ranges in config when possible,\r\n\t * joins ranges that can be merged\r\n\t * parts: [{start: 8, end: 12}, {start:12, end:13}, {start: 15, end: 17}]\r\n\t * result: [{start: 8, end: 13}, {start: 15, end: 17}]\r\n\t * @param {Array} parts\r\n\t */\r\n\t_mergeAdjacentIntervals: function(parts){\r\n\t\tvar result = parts.slice();\r\n\t\tresult.sort(function(a, b){\r\n\t\t\treturn a.start - b.start;\r\n\t\t});\r\n\t\tvar base = result[0];\r\n\t\tfor(var i = 1; i < result.length; i++){\r\n\t\t\tvar current = result[i];\r\n\t\t\tif(current.start <= base.end){\r\n\t\t\t\tif(current.end > base.end){\r\n\t\t\t\t\tbase.end = current.end;\r\n\t\t\t\t}\r\n\t\t\t\tresult.splice(i, 1);\r\n\t\t\t\ti--;\r\n\t\t\t}else{\r\n\t\t\t\tbase = current;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t_mergeHoursConfig: function(firstHours, secondHours){\r\n\t\t//var firstIntervals = this._getIntervals(firstHours);\r\n\t\t//var secondIntervals = this._getIntervals(secondHours);\r\n\r\n\t\treturn this._mergeAdjacentIntervals(\r\n\t\t\tthis._intersectHourRanges(firstHours, secondHours)\r\n\t\t);\r\n\t},\r\n\r\n\tmerge: function(first, second){\r\n\t\tvar firstConfig = utils.copy(first.getConfig().parsed);\r\n\r\n\t\tvar secondConfig = utils.copy(second.getConfig().parsed);\r\n\r\n\t\tvar mergedSettings = {\r\n\t\t\thours: this._toHoursArray(this._mergeHoursConfig(firstConfig.hours, secondConfig.hours)),\r\n\t\t\tdates: {},\r\n\t\t\tcustomWeeks: {}\r\n\t\t};\r\n\r\n\t\tconst processCalendar = (config1, config2) => {\r\n\t\t\tfor (let i in config1.dates) {\r\n\t\t\t\tconst date1 = config1.dates[i];\r\n\t\r\n\t\t\t\t// dates contain day-of-week rules [0-7] and rules for specific dates (js date timestamps) - set false date rules initially\r\n\t\t\t\tif (+i > 1000) {\r\n\t\t\t\t\tmergedSettings.dates[i] = false;\r\n\t\t\t\t}\r\n\t\t\t\t// Check if the key exists in the fisrt calendar object\r\n\t\t\t\tfor (const key in config2.dates) {\r\n\t\t\t\t\tconst date2 = config2.dates[key];\r\n\t\r\n\t\t\t\t\t// Logical AND for week days\r\n\t\t\t\t\tif (key == i) {\r\n\t\t\t\t\t\tmergedSettings.dates[i] = !!(date1 && date2);\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t// Handle case where dates are arrays\r\n\t\t\t\t\tif (Array.isArray(date1)) {\r\n\t\t\t\t\t\tconst hours2 = Array.isArray(date2) ? date2 : config2.hours;\r\n\t\t\t\t\t\tmergedSettings.dates[i] = this._toHoursArray(this._mergeHoursConfig(date1, hours2));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\r\n\t\t// Check both calendars\r\n\t\tprocessCalendar(firstConfig, secondConfig);\r\n\t\tprocessCalendar(secondConfig, firstConfig);\r\n\r\n\t\t// transfer and overwrite custom week calendars\r\n\t\tif(firstConfig.customWeeks){\r\n\t\t\tfor(var i in firstConfig.customWeeks){\r\n\t\t\t\tmergedSettings.customWeeks[i] = firstConfig.customWeeks[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(secondConfig.customWeeks){\r\n\t\t\tfor(var i in secondConfig.customWeeks){\r\n\t\t\t\tmergedSettings.customWeeks[i] = secondConfig.customWeeks[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn mergedSettings;\r\n\r\n\t}\r\n\r\n};\r\n\r\nexport default WorkTimeCalendarMerger;","\r\n\r\nimport { IWorkUnitCache } from \"./workunit_cache_interface\";\r\n\r\nexport class WorkUnitsMapCache implements IWorkUnitCache {\r\n\tprivate _cache: Map<string, Array<Map<string, boolean>>>;\r\n\tconstructor() {\r\n\t\tthis.clear();\r\n\t}\r\n\r\n\tgetItem(unit: string, timestamp: string, value: Date): number|boolean {\r\n\t\tif (this._cache.has(unit)) {\r\n\t\t\tconst unitCache = this._cache.get(unit);\r\n\r\n\t\t\tconst subCache = unitCache[value.getFullYear()];\r\n\t\t\tif (subCache && subCache.has(timestamp)) {\r\n\t\t\t\treturn subCache.get(timestamp);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn -1;\r\n\t}\r\n\tsetItem(unit: string, timestamp: string, value: boolean, rawValue: Date): void {\r\n\t\tif (!unit || !timestamp) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst cache = this._cache;\r\n\t\tconst year = rawValue.getFullYear();\r\n\r\n\t\tlet unitCache;\r\n\t\tif (!cache.has(unit)) {\r\n\t\t\tunitCache = [];\r\n\t\t\tcache.set(unit, unitCache);\r\n\t\t} else {\r\n\t\t\tunitCache = cache.get(unit);\r\n\t\t}\r\n\r\n\t\tlet yearCache = unitCache[year];\r\n\t\tif(!yearCache){\r\n\t\t\tyearCache = unitCache[year] = new Map<string, boolean>();\r\n\t\t}\r\n\r\n\r\n\t\tyearCache.set(timestamp, value);\r\n\t}\r\n\tclear(): void{\r\n\t\tthis._cache = new Map<string, Array<Map<string, boolean>>>();\r\n\t}\r\n}","import { IWorkUnitCache } from \"./workunit_cache_interface\";\r\n\r\nexport class WorkUnitsObjectCache implements IWorkUnitCache {\r\n\tprivate _cache: any;\r\n\tconstructor() {\r\n\t\tthis.clear();\r\n\t}\r\n\r\n\tgetItem(unit: string, timestamp: string, value: Date): number|boolean {\r\n\t\tconst cache = this._cache;\r\n\t\tif (cache && cache[unit]) {\r\n\t\t\tconst units = cache[unit];\r\n\t\t\tif(units === undefined){\r\n\t\t\t\treturn -1;\r\n\t\t\t}\r\n\t\t\tconst subCache = units[value.getFullYear()];\r\n\t\t\tif (subCache && subCache[timestamp] !== undefined) {\r\n\t\t\t\treturn subCache[timestamp];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn -1;\r\n\t}\r\n\tsetItem(unit: string, timestamp: string, value: boolean, rawValue: Date): void {\r\n\t\tif (!unit || !timestamp) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst cache = this._cache;\r\n\r\n\t\tif (!cache) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!cache[unit]) {\r\n\t\t\tcache[unit] = [];\r\n\t\t}\r\n\t\tconst unitCache = cache[unit];\r\n\r\n\t\tconst year = rawValue.getFullYear();\r\n\t\tlet yearCache = unitCache[year];\r\n\t\tif(!yearCache){\r\n\t\t\tyearCache = unitCache[year] = {};\r\n\t\t}\r\n\t\tyearCache[timestamp] = value;\r\n\t}\r\n\tclear(): void{\r\n\t\tthis._cache = {};\r\n\t}\r\n}","\r\n\r\nexport class LargerUnitsCache {\r\n\tprivate _weekCache: Map<number, number>;\r\n\tprivate _monthCache: Map<number, number>;\r\n\tprivate _calendar: any;\r\n\tconstructor(calendar) {\r\n\t\tthis.clear();\r\n\t\tthis._calendar = calendar;\r\n\t}\r\n\r\n\tgetMinutesPerWeek = (weekStart: Date) => {\r\n\t\tconst key = weekStart.valueOf();\r\n\r\n\t\tif(this._weekCache.has(key)){\r\n\t\t\treturn this._weekCache.get(key);\r\n\t\t}\r\n\r\n\t\tconst calendar = this._calendar;\r\n\t\tconst gantt = this._calendar.$gantt;\r\n\r\n\t\tlet minutesPerWeek = 0;\r\n\t\tlet start = gantt.date.week_start(new Date(weekStart));\r\n\t\tfor(let i = 0; i < 7; i++){\r\n\t\t\tminutesPerWeek += calendar.getHoursPerDay(start) * 60;\r\n\t\t\tstart = gantt.date.add(start, 1, \"day\");\r\n\t\t}\r\n\r\n\t\tthis._weekCache.set(key, minutesPerWeek);\r\n\t\treturn minutesPerWeek;\r\n\t};\r\n\r\n\tgetMinutesPerMonth = (monthStart: Date) => {\r\n\t\tconst key = monthStart.valueOf();\r\n\r\n\t\tif(this._monthCache.has(key)){\r\n\t\t\treturn this._monthCache.get(key);\r\n\t\t}\r\n\r\n\t\tconst calendar = this._calendar;\r\n\t\tconst gantt = this._calendar.$gantt;\r\n\r\n\t\tlet minutesPerMonth = 0;\r\n\t\tlet start = gantt.date.week_start(new Date(monthStart));\r\n\t\tconst nextMonth = gantt.date.add(start, 1, \"month\").valueOf();\r\n\t\twhile(start.valueOf() < nextMonth){\r\n\t\t\tminutesPerMonth += calendar.getHoursPerDay(start) * 60;\r\n\t\t\tstart = gantt.date.add(start, 1, \"day\");\r\n\t\t}\r\n\r\n\t\tthis._monthCache.set(key, minutesPerMonth);\r\n\t\treturn minutesPerMonth;\r\n\t};\r\n\r\n\tclear = (): void => {\r\n\t\tthis._weekCache = new Map<number, number>();\r\n\t\tthis._monthCache = new Map<number, number>();\r\n\t};\r\n}","import { IWorkUnitCache } from \"./workunit_cache_interface\";\r\nimport { WorkUnitsMapCache } from \"./workunit_map_cache\";\r\nimport { WorkUnitsObjectCache } from \"./workunit_object_cache\";\r\nexport { LargerUnitsCache } from \"./larger_units_helper\";\r\n\r\nexport function createCacheObject(): IWorkUnitCache {\r\n\r\n\t// worktime hash is on the hot path,\r\n\t// Map seems to work faster than plain array, use it whenever possible\r\n\tif (typeof Map !== \"undefined\") {\r\n\t\treturn new WorkUnitsMapCache();\r\n\t} else {\r\n\t\treturn new WorkUnitsObjectCache();\r\n\t}\r\n}\r\n","export class DateDurationCache  {\r\n\tprivate _cache: any;\r\n\tconstructor() {\r\n\t\tthis.clear();\r\n\t}\r\n\r\n\t_getCacheObject(startDate: Date, unit: string, step:number){\r\n\t\tconst cache = this._cache;\r\n\t\tif (!cache[unit]) {\r\n\t\t\tcache[unit] = [];\r\n\t\t}\r\n\t\tlet unitCache = cache[unit];\r\n\t\tif(!unitCache) {\r\n\t\t\tunitCache = cache[unit] = {};\r\n\t\t}\r\n\r\n\t\tlet stepCache = unitCache[step];\r\n\t\tif(!stepCache) {\r\n\t\t\tstepCache = unitCache[step] = {};\r\n\t\t}\r\n\r\n\t\tconst year = startDate.getFullYear();\r\n\t\tlet yearCache = stepCache[year];\r\n\t\tif(!yearCache){\r\n\t\t\tyearCache = stepCache[year] = {durations: {}, endDates: {}};\r\n\t\t}\r\n\r\n\t\treturn yearCache;\r\n\t}\r\n\t_endDateCacheKey(startDate: number, duration: number){\r\n\t\treturn String(startDate) + \"-\" + String(duration);\r\n\t}\r\n\t_durationCacheKey(startDate: number, endDate: number){\r\n\t\treturn String(startDate) + \"-\" + String(endDate);\r\n\t}\r\n\tgetEndDate(startDate: Date, duration: number, unit: string, step: number, compute: () => Date): number|null{\r\n\t\tconst cache = this._getCacheObject(startDate, unit, step);\r\n\r\n\t\tconst startDateTimestamp = startDate.valueOf();\r\n\t\tconst key = this._endDateCacheKey(startDateTimestamp, duration);\r\n\t\tlet endDate;\r\n\t\tif(cache.endDates[key] === undefined){\r\n\t\t\tconst result = compute();\r\n\t\t\tconst resultTimestamp = result.valueOf();\r\n\t\t\tcache.endDates[key] = resultTimestamp;\r\n\t\t\tcache.durations[this._durationCacheKey(startDateTimestamp, resultTimestamp)] = duration;\r\n\t\t\tendDate = result;\r\n\t\t}else{\r\n\t\t\tendDate = new Date(cache.endDates[key]);\r\n\t\t}\r\n\r\n\t\treturn endDate;\r\n\t}\r\n\r\n\tgetDuration(startDate: Date, endDate: Date, unit: string, step: number, compute: () => number): number|null{\r\n\t\tconst cache = this._getCacheObject(startDate, unit, step);\r\n\r\n\t\tconst startDateTimestamp = startDate.valueOf();\r\n\t\tconst endDateTimestamp = endDate.valueOf();\r\n\t\tconst key = this._durationCacheKey(startDateTimestamp, endDateTimestamp);\r\n\t\tlet duration;\r\n\t\tif(cache.durations[key] === undefined){\r\n\t\t\tconst result = compute();\r\n\t\t\tcache.durations[key] = result.valueOf();\r\n\r\n\t\t\t// can't populate end date due to logic of end date calculation, current unit tests capture it\r\n\t\t\t// cache.endDates[this._endDateCacheKey(startDateTimestamp, result)] = endDateTimestamp;\r\n\t\t\tduration = result;\r\n\t\t}else{\r\n\t\t\tduration = cache.durations[key];\r\n\t\t}\r\n\r\n\t\treturn duration;\r\n\t}\r\n\r\n\tclear(): void{\r\n\t\tthis._cache = {};\r\n\t}\r\n}","import {createCacheObject} from \"./work_unit_cache\";\r\nimport {LargerUnitsCache} from \"./work_unit_cache\";\r\nimport * as utils from \"../../../utils/utils\";\r\nimport {DateDurationCache} from \"./work_unit_cache/date_duration_cache\";\r\n\r\nfunction CalendarWorkTimeStrategy(gantt, argumentsHelper) {\r\n\tthis.argumentsHelper = argumentsHelper;\r\n\tthis.$gantt = gantt;\r\n\tthis._workingUnitsCache = createCacheObject();\r\n\tthis._largeUnitsCache = new LargerUnitsCache(this);\r\n\tthis._dateDurationCache = new DateDurationCache();\r\n\tthis._worktime = null;\r\n\tthis._cached_timestamps = {};\r\n\tthis._cached_timestamps_count = 0;\r\n}\r\n\r\nCalendarWorkTimeStrategy.prototype = {\r\n\tunits: [\r\n\t\t\"year\",\r\n\t\t\"month\",\r\n\t\t\"week\",\r\n\t\t\"day\",\r\n\t\t\"hour\",\r\n\t\t\"minute\"\r\n\t],\r\n\t_clearCaches: function(){\r\n\t\tthis._workingUnitsCache.clear();\r\n\t\tthis._largeUnitsCache.clear();\r\n\t\tthis._dateDurationCache.clear();\r\n\t},\r\n\t// cache previously calculated worktime\r\n\t_getUnitOrder: function (unit) {\r\n\t\tfor (var i = 0, len = this.units.length; i < len; i++) {\r\n\t\t\tif (this.units[i] == unit)\r\n\t\t\t\treturn i;\r\n\t\t}\r\n\t},\r\n\t_resetTimestampCache: function(){\r\n\t\tthis._cached_timestamps = {};\r\n\t\tthis._cached_timestamps_count = 0;\r\n\t},\r\n\t_timestamp: function (settings) {\r\n\t\t// minor optimization, store calculated timestamps to reduce computations\r\n\t\t// reset cache when number of keys exceeds large number where key lookup may became more expensive than the recalculation\r\n\t\tif(this._cached_timestamps_count > 1000000){\r\n\t\t\tthis._resetTimestampCache();\r\n\t\t}\r\n\r\n\t\tvar timestamp = null;\r\n\t\tif ((settings.day || settings.day === 0)) {\r\n\t\t\ttimestamp = settings.day;\r\n\t\t} else if (settings.date) {\r\n\t\t\tvar value = String(settings.date.valueOf());\r\n\t\t\tif(this._cached_timestamps[value]){\r\n\t\t\t\ttimestamp = this._cached_timestamps[value];\r\n\t\t\t}else{\r\n\t\t\t\t// store worktime datestamp in utc so it could be recognized in different timezones (e.g. opened locally and sent to the export service in different timezone)\r\n\t\t\t\ttimestamp = Date.UTC(settings.date.getFullYear(), settings.date.getMonth(), settings.date.getDate());\r\n\t\t\t\tthis._cached_timestamps[value] = timestamp;\r\n\t\t\t\tthis._cached_timestamps_count++;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\treturn timestamp;\r\n\t},\r\n\t_checkIfWorkingUnit: function (date, unit) {\r\n\t\t// GS-596: If unit is larger than day or has a custom logic\r\n\t\tif (!this[\"_is_work_\" + unit]) {\r\n\t\t\tconst from = this.$gantt.date[`${unit}_start`](new Date(date));\r\n\t\t\tconst to = this.$gantt.date.add(from, 1, unit);\r\n\t\t\treturn this.hasDuration(from, to);\r\n\t\t}\r\n\t\treturn this[\"_is_work_\" + unit](date);\r\n\t},\r\n\t//checkings for particular time units\r\n\t//methods for month-year-week can be defined, otherwise always return 'true'\r\n\t_is_work_day: function (date) {\r\n\t\tvar val = this._getWorkHours(date);\r\n\r\n\t\tif (Array.isArray(val)) {\r\n\t\t\treturn val.length > 0;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\t_is_work_hour: function (date) {\r\n\t\tvar hours = this._getWorkHours(date); // [{start: 8*60*60, end: 12*60*60}, {start: 13*60*60, end: 17*60*60}]\r\n\t\tvar value = date.getHours();\r\n\t\tfor (var i = 0; i < hours.length; i++) {\r\n\t\t\tif(value >= hours[i].startHour && value < hours[i].endHour){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\t_getTimeOfDayStamp: function(date, dayEnd) {\r\n\t\tvar hours = date.getHours();\r\n\t\tif(!date.getHours() && !date.getMinutes() && dayEnd){\r\n\t\t\thours = 24;\r\n\t\t}\r\n\t\treturn hours * 60 * 60 + date.getMinutes() * 60;\r\n\t},\r\n\r\n\t_is_work_minute: function(date){\r\n\t\tvar hours = this._getWorkHours(date); // [{start: 8*60*60, end: 12*60*60}, {start: 13*60*60, end: 17*60*60}]\r\n\t\tvar checkTime = this._getTimeOfDayStamp(date);\r\n\t\tfor (var i = 0; i < hours.length; i++) {\r\n\t\t\tif(checkTime >= hours[i].start && checkTime < hours[i].end){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\t_nextDate: function (start, unit, step) {\r\n\t\treturn this.$gantt.date.add(start, step, unit);\r\n\t},\r\n\t_getWorkUnitsBetweenGeneric: function (from, to, unit, step) {\r\n\t\tvar dateHelper = this.$gantt.date;\r\n\t\tvar start = new Date(from),\r\n\t\t\tend = new Date(to);\r\n\t\tstep = step || 1;\r\n\t\tvar units = 0;\r\n\r\n\r\n\t\tvar next = null;\r\n\t\tvar stepStart,\r\n\t\t\tstepEnd;\r\n\r\n\t\t// calculating decimal durations, i.e. 2016-09-20 00:05:00 - 2016-09-20 01:00:00 ~ 0.95 instead of 1\r\n\t\t// and also  2016-09-20 00:00:00 - 2016-09-20 00:05:00 ~ 0.05 instead of 1\r\n\t\t// durations must be rounded later\r\n\t\tvar checkFirst = false;\r\n\t\tstepStart = dateHelper[unit + \"_start\"](new Date(start));\r\n\t\tif (stepStart.valueOf() != start.valueOf()) {\r\n\t\t\tcheckFirst = true;\r\n\t\t}\r\n\t\tvar checkLast = false;\r\n\t\tstepEnd = dateHelper[unit + \"_start\"](new Date(to));\r\n\t\tif (stepEnd.valueOf() != to.valueOf()) {\r\n\t\t\tcheckLast = true;\r\n\t\t}\r\n\r\n\t\tvar isLastStep = false;\r\n\t\twhile (start.valueOf() < end.valueOf()) {\r\n\t\t\tnext = this._nextDate(start, unit, step);\r\n\t\t\tisLastStep = (next.valueOf() > end.valueOf());\r\n\r\n\t\t\tif (this._isWorkTime(start, unit)) {\r\n\t\t\t\tif (checkFirst || (checkLast && isLastStep)) {\r\n\t\t\t\t\tstepStart = dateHelper[unit + \"_start\"](new Date(start));\r\n\t\t\t\t\tstepEnd = dateHelper.add(stepStart, step, unit);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (checkFirst) {\r\n\t\t\t\t\tcheckFirst = false;\r\n\t\t\t\t\tnext = this._nextDate(stepStart, unit, step);\r\n\t\t\t\t\tunits += ((stepEnd.valueOf() - start.valueOf()) / (stepEnd.valueOf() - stepStart.valueOf()));\r\n\t\t\t\t} else if (checkLast && isLastStep) {\r\n\t\t\t\t\tcheckLast = false;\r\n\t\t\t\t\tunits += ((end.valueOf() - start.valueOf()) / (stepEnd.valueOf() - stepStart.valueOf()));\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tunits++;\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tvar unitOrder = this._getUnitOrder(unit);\r\n\t\t\t\tvar biggerTimeUnit = this.units[unitOrder - 1];\r\n\t\t\t\tif(biggerTimeUnit && !this._isWorkTime(start, biggerTimeUnit)){\r\n\t\t\t\t\tnext = this._getClosestWorkTimeFuture(start, biggerTimeUnit);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tstart = next;\r\n\t\t}\r\n\t\treturn units;\r\n\t},\r\n\r\n\t_getMinutesPerHour: function (date) {\r\n\t\tvar hourStart = this._getTimeOfDayStamp(date);\r\n\t\tvar hourEnd = this._getTimeOfDayStamp(this._nextDate(date, \"hour\", 1));\r\n\t\tif (hourEnd === 0){\r\n\t\t\thourEnd = 24 * 60 * 60;\r\n\t\t}\r\n\t\tvar worktimes = this._getWorkHours(date);\r\n\r\n\t\tfor(var i = 0; i < worktimes.length; i++){\r\n\t\t\tvar interval = worktimes[i];\r\n\t\t\tif(hourStart >= interval.start && hourEnd <= interval.end){\r\n\t\t\t\treturn 60;// hour inside a working interval, all hour is a work hour\r\n\t\t\t}else if(hourStart < interval.end && hourEnd > interval.start){\r\n\t\t\t\t// hour is partially work time\r\n\t\t\t\tvar duration = Math.min(hourEnd, interval.end) - Math.max(hourStart, interval.start);\r\n\t\t\t\treturn duration / 60;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn 0;\r\n\t},\r\n\r\n\t_getMinutesPerDay: function (date) {\r\n\t\tvar hours = this._getWorkHours(date);\r\n\t\tvar res = 0;\r\n\t\thours.forEach(function(interval){\r\n\t\t\tres+= interval.durationMinutes;\r\n\t\t});\r\n\t\treturn res;\r\n\t},\r\n\tgetHoursPerDay: function (date) {\r\n\t\tvar hours = this._getWorkHours(date);\r\n\t\tvar res = 0;\r\n\t\thours.forEach(function(interval){\r\n\t\t\tres+= interval.durationHours;\r\n\t\t});\r\n\t\treturn res;\r\n\t},\r\n\t_getWorkUnitsForRange: function (from, to, unit, step) {\r\n\t\tvar total = 0;\r\n\t\tvar start = new Date(from),\r\n\t\t\tend = new Date(to);\r\n\r\n\t\tvar getUnitsPerDay;\r\n\t\tif (unit == \"minute\") {\r\n\t\t\tgetUnitsPerDay = utils.bind(this._getMinutesPerDay, this);\r\n\t\t} else {\r\n\t\t\tgetUnitsPerDay = utils.bind(this.getHoursPerDay, this);\r\n\t\t}\r\n\r\n\t\twhile (start.valueOf() < end.valueOf()) {\r\n\t\t\tif(end - start > 1000*60*60*24*32 && start.getDate() === 0) {\r\n\t\t\t\tvar units = this._largeUnitsCache.getMinutesPerMonth(start);\r\n\t\t\t\tif(unit == \"hour\"){\r\n\t\t\t\t\tunits = units / 60;\r\n\t\t\t\t}\r\n\t\t\t\ttotal += units;\r\n\t\t\t\tstart = this.$gantt.date.add(start, 1, \"month\");\r\n\t\t\t\tcontinue;\r\n\t\t\t}else if(end - start > 1000*60*60*24*16) {\r\n\t\t\t\tvar weekStart = this.$gantt.date.week_start(new Date(start));\r\n\t\t\t\tif(start.valueOf() === weekStart.valueOf()){\r\n\t\t\t\t\tvar units = this._largeUnitsCache.getMinutesPerWeek(start);\r\n\t\t\t\t\tif(unit == \"hour\"){\r\n\t\t\t\t\t\tunits = units / 60;\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttotal += units;\r\n\t\t\t\t\tstart = this.$gantt.date.add(start, 7, \"day\");\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t//\tif (this._isWorkTime(start, \"day\")) {\r\n\t\t\ttotal += getUnitsPerDay(start);\r\n\t\t//\t}\r\n\t\t\tstart = this._nextDate(start, \"day\", 1);\r\n\t\t}\r\n\r\n\t\treturn total / step;\r\n\t},\r\n\r\n\r\n\t_getMinutesBetweenSingleDay: function(from, to){\r\n\t\tvar range = this._getIntervalTimestamp(from, to);\r\n\t\tvar worktimes = this._getWorkHours(from);\r\n\t\tvar result = 0;\r\n\r\n\t\tfor(var i = 0; i < worktimes.length; i++){\r\n\t\t\tvar interval = worktimes[i];\r\n\t\t\tif(range.end >= interval.start && range.start <= interval.end){\r\n\t\t\t\tvar minuteFrom = Math.max(interval.start, range.start);\r\n\t\t\t\tvar minuteTo = Math.min(interval.end, range.end);\r\n\r\n\t\t\t\tresult += (minuteTo - minuteFrom) / 60;\r\n\t\t\t\trange.start = minuteTo;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn Math.floor(result);\r\n\t},\r\n\r\n\t_getMinutesBetween: function(from, to, unit, step){\r\n\t\tvar start = new Date(from),\r\n\t\t\tend = new Date(to);\r\n\t\tstep = step || 1;\r\n\r\n\t\tvar firstDayStart = new Date(start);\r\n\t\tvar firstDayEnd = this.$gantt.date.add(this.$gantt.date.day_start(new Date(start)), 1, \"day\");\r\n\r\n\t\tif (end.valueOf() <= firstDayEnd.valueOf()) {\r\n\t\t\treturn this._getMinutesBetweenSingleDay(from, to);\r\n\t\t} else {\r\n\r\n\t\t\tvar lastDayStart = this.$gantt.date.day_start(new Date(end));\r\n\t\t\tvar lastDayEnd = end;\r\n\r\n\t\t\tvar startPart = this._getMinutesBetweenSingleDay(firstDayStart, firstDayEnd);\r\n\t\t\tvar endPart = this._getMinutesBetweenSingleDay(lastDayStart, lastDayEnd);\r\n\r\n\t\t\tvar rangePart = this._getWorkUnitsForRange(firstDayEnd, lastDayStart, unit, step);\r\n\t\t\tvar total = startPart + rangePart + endPart;\r\n\r\n\t\t\treturn total;\r\n\t\t}\r\n\t},\r\n\t// optimized method for calculating work units duration of large time spans\r\n\t// implemented for hours and minutes units, bigger time units don't benefit from the optimization so much\r\n\t_getHoursBetween: function (from, to, unit, step) {\r\n\t\tvar start = new Date(from),\r\n\t\t\tend = new Date(to);\r\n\t\tstep = step || 1;\r\n\r\n\t\tvar firstDayStart = new Date(start);\r\n\t\tvar firstDayEnd = this.$gantt.date.add(this.$gantt.date.day_start(new Date(start)), 1, \"day\");\r\n\r\n\t\tif (end.valueOf() <= firstDayEnd.valueOf()) {\r\n\t\t\treturn Math.round(this._getMinutesBetweenSingleDay(from, to) / 60);\r\n\t\t} else {\r\n\r\n\t\t\tvar lastDayStart = this.$gantt.date.day_start(new Date(end));\r\n\t\t\tvar lastDayEnd = end;\r\n\r\n\t\t\tvar startPart = this._getMinutesBetweenSingleDay(firstDayStart, firstDayEnd, unit, step) / 60;\r\n\t\t\tvar endPart = this._getMinutesBetweenSingleDay(lastDayStart, lastDayEnd, unit, step) / 60;\r\n\r\n\t\t\tvar rangePart = this._getWorkUnitsForRange(firstDayEnd, lastDayStart, unit, step);\r\n\t\t\tvar total = startPart + rangePart + endPart;\r\n\r\n\t\t\treturn Math.round(total);\r\n\t\t}\r\n\t},\r\n\r\n\tgetConfig: function () {\r\n\t\treturn this._worktime;\r\n\t},\r\n\t_setConfig: function (settings) {\r\n\t\tthis._worktime = settings;\r\n\t\tthis._parseSettings();\r\n\t\tthis._clearCaches();\r\n\t},\r\n\t_parseSettings: function() {\r\n\t\tvar settings = this.getConfig();\r\n\t\tsettings.parsed = {\r\n\t\t\tdates: {},\r\n\t\t\thours: null,\r\n\t\t\thaveCustomWeeks: false,\r\n\t\t\tcustomWeeks: {},\r\n\t\t\tcustomWeeksRangeStart: null,\r\n\t\t\tcustomWeeksRangeEnd: null,\r\n\t\t\tcustomWeeksBoundaries: []\r\n\t\t};\r\n\r\n\t\tsettings.parsed.hours = this._parseHours(settings.hours);\r\n\t\tfor(var i in settings.dates){\r\n\t\t\tsettings.parsed.dates[i] = this._parseHours(settings.dates[i]);\r\n\t\t}\r\n\r\n\t\tif(settings.customWeeks) {\r\n\t\t\tvar minCustomRangeStart = null;\r\n\t\t\tvar maxCustomRangeEnd = null;\r\n\t\t\tfor(var i in settings.customWeeks){\r\n\t\t\t\tvar customTime = settings.customWeeks[i];\r\n\r\n\t\t\t\tif(customTime.from && customTime.to){\r\n\t\t\t\t\tvar rangeStart = customTime.from;\r\n\t\t\t\t\tvar rangeEnd = customTime.to;\r\n\t\t\t\t\tif(!minCustomRangeStart || minCustomRangeStart > rangeStart.valueOf()){\r\n\t\t\t\t\t\tminCustomRangeStart = rangeStart.valueOf();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!maxCustomRangeEnd || maxCustomRangeEnd < rangeEnd.valueOf()){\r\n\t\t\t\t\t\tmaxCustomRangeEnd = rangeEnd.valueOf();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tsettings.parsed.customWeeksBoundaries.push({\r\n\t\t\t\t\t\tfrom: rangeStart.valueOf(),\r\n\t\t\t\t\t\tfromReadable: new Date(rangeStart),\r\n\t\t\t\t\t\tto: rangeEnd.valueOf(),\r\n\t\t\t\t\t\ttoReadable: new Date(rangeEnd),\r\n\t\t\t\t\t\tname: i\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tsettings.parsed.haveCustomWeeks = true;\r\n\t\t\t\t\tvar currentWeek = settings.parsed.customWeeks[i] = {\r\n\t\t\t\t\t\tfrom: customTime.from,\r\n\t\t\t\t\t\tto: customTime.to,\r\n\t\t\t\t\t\thours: this._parseHours(customTime.hours),\r\n\t\t\t\t\t\tdates: {}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tfor(var d in customTime.dates){\r\n\t\t\t\t\t\tcurrentWeek.dates[d] = this._parseHours(customTime.dates[d]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tsettings.parsed.customWeeksRangeStart = minCustomRangeStart;\r\n\t\t\tsettings.parsed.customWeeksRangeEnd = maxCustomRangeEnd;\r\n\r\n\t\t}\r\n\t},\r\n\r\n\t_tryChangeCalendarSettings: function (payload) {\r\n\t\tvar backup = JSON.stringify(this.getConfig());\r\n\t\tpayload();\r\n\t\tif (!this.hasWorkTime()) {\r\n\t\t//\tthis.$gantt.assert(false, \"Invalid calendar settings, no worktime available\");\r\n\t\t\tthis._setConfig(JSON.parse(backup));\r\n\t\t\tthis._clearCaches();\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\r\n\t},\r\n\r\n\t_arraysEqual: function(a, b){\r\n\t\tif (a === b) return true;\r\n\t\tif (!a || !b) return false;\r\n\t\tif (a.length != b.length) return false;\r\n\r\n\t\tfor (var i = 0; i < a.length; ++i) {\r\n\t\t\tif (a[i] !== b[i]) return false;\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\r\n\t_compareSettings: function (mySettings, thatSettings) {\r\n\t\tif (!this._arraysEqual(mySettings.hours, thatSettings.hours)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar myDays = Object.keys(mySettings.dates);\r\n\t\tvar otherDates = Object.keys(thatSettings.dates);\r\n\t\tmyDays.sort();\r\n\t\totherDates.sort();\r\n\r\n\t\tif (!this._arraysEqual(myDays, otherDates)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tfor(var i = 0; i < myDays.length; i++){\r\n\t\t\tvar timestamp = myDays[i];\r\n\t\t\tvar myHours = mySettings.dates[timestamp];\r\n\t\t\tvar otherHours = mySettings.dates[timestamp];\r\n\r\n\t\t\t// day settings not equal\r\n\t\t\tif(myHours !== otherHours &&\r\n\t\t\t\t// but still can be two arrays with the equivalent hour settings\r\n\t\t\t\t!(Array.isArray(myHours) && Array.isArray(otherHours) && this._arraysEqual(myHours, otherHours))\r\n\t\t\t\t){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\tequals: function (calendar) {\r\n\t\tif(!(calendar instanceof CalendarWorkTimeStrategy)){\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar mySettings = this.getConfig();\r\n\t\tvar thatSettings = calendar.getConfig();\r\n\r\n\t\tif(!this._compareSettings(mySettings, thatSettings)){\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif(mySettings.parsed.haveCustomWeeks && thatSettings.parsed.haveCustomWeeks){\r\n\t\t\tif(mySettings.parsed.customWeeksBoundaries.length != thatSettings.parsed.customWeeksBoundaries.length){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tfor(var i in mySettings.parsed.customWeeks){\r\n\t\t\t\tvar myWeek = mySettings.parsed.customWeeks[i];\r\n\t\t\t\tvar thatWeek = thatSettings.parsed.customWeeks[i];\r\n\t\t\t\tif(!thatWeek){\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!this._compareSettings(myWeek, thatWeek)){\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}else if(mySettings.parse.haveCustomWeeks !== thatSettings.parsed.haveCustomWeeks){\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\tgetWorkHours: function () {\r\n\t\tvar config = this.argumentsHelper.getWorkHoursArguments.apply(this.argumentsHelper, arguments);\r\n\t\treturn this._getWorkHours(config.date, false);\r\n\t},\r\n\t_getWorkHours: function (date, parsed) {\r\n\t\tvar calendar = this.getConfig();\r\n\t\tif(parsed !== false){\r\n\t\t\tcalendar = calendar.parsed;\r\n\t\t}\r\n\r\n\t\tif(!date){\r\n\t\t\treturn calendar.hours;\r\n\t\t}\r\n\r\n\t\tvar dateValue = this._timestamp({date: date});\r\n\r\n\t\tif(calendar.haveCustomWeeks){\r\n\t\t\tif(calendar.customWeeksRangeStart <= dateValue && calendar.customWeeksRangeEnd > dateValue){\r\n\t\t\t\tfor(var i = 0; i < calendar.customWeeksBoundaries.length; i++){\r\n\t\t\t\t\tif(calendar.customWeeksBoundaries[i].from <= dateValue && calendar.customWeeksBoundaries[i].to > dateValue){\r\n\t\t\t\t\t\tcalendar = calendar.customWeeks[calendar.customWeeksBoundaries[i].name];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar hours = true;\r\n\r\n\t\tif (calendar.dates[dateValue] !== undefined) {\r\n\t\t\thours = calendar.dates[dateValue];//custom day\r\n\t\t} else if (calendar.dates[date.getDay()] !== undefined) {\r\n\t\t\thours = calendar.dates[date.getDay()];//week day\r\n\t\t}\r\n\t\tif (hours === true) {\r\n\t\t\treturn calendar.hours;\r\n\t\t} else if (hours) {\r\n\t\t\treturn hours;\r\n\t\t}\r\n\t\treturn [];\r\n\t},\r\n\r\n\t_getIntervalTimestamp: function(from, to){\r\n\t\tvar res = {\r\n\t\t\tstart: 0,\r\n\t\t\tend: 0\r\n\t\t};\r\n\r\n\t\tres.start = from.getHours() * 60 * 60 + from.getMinutes() * 60 + from.getSeconds();\r\n\t\tvar endHours = to.getHours();\r\n\t\tif(!endHours && !to.getMinutes() && !to.getSeconds() && from.valueOf() < to.valueOf()){\r\n\t\t\tendHours = 24;\r\n\t\t}\r\n\t\tres.end = endHours * 60 * 60 + to.getMinutes() * 60 + to.getSeconds();\r\n\t\treturn res;\r\n\t},\r\n\r\n\t_parseHours: function(hours) {\r\n\t\tif(Array.isArray(hours)){\r\n\r\n\t\t\tvar timestampRanges = [];// worktime as seconds range\r\n\t\t\thours.forEach(function(hour){\r\n\t\t\t\tif(typeof hour === \"number\"){\r\n\t\t\t\t\ttimestampRanges.push(hour*60*60);\r\n\t\t\t\t}else if(typeof hour === \"string\") {\r\n\t\t\t\t\t// \"12-13\", or \"12:00-13:00\", or \"12:00:00-13:00:00\"\r\n\t\t\t\t\thour.split(\"-\").map(function(time){\r\n\t\t\t\t\t\treturn time.trim();\r\n\t\t\t\t\t}).forEach(function(part){\r\n\t\t\t\t\t\tvar parsed = part.split(\":\").map(function(time){\r\n\t\t\t\t\t\t\treturn time.trim();\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tvar value = parseInt(parsed[0]*60*60);\r\n\t\t\t\t\t\tif(parsed[1]){\r\n\t\t\t\t\t\t\tvalue += parseInt(parsed[1]*60);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(parsed[2]){\r\n\t\t\t\t\t\t\tvalue += parseInt(parsed[2]);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ttimestampRanges.push(value);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tvar timerangeConfig = [];\r\n\t\t\tfor (var i = 0; i < timestampRanges.length; i += 2) {\r\n\t\t\t\tvar start = timestampRanges[i];\r\n\t\t\t\tvar end = timestampRanges[i + 1];\r\n\t\t\t\tvar duration = end - start;\r\n\r\n\t\t\t\ttimerangeConfig.push({\r\n\t\t\t\t\tstart: start,\r\n\t\t\t\t\tend: end,\r\n\t\t\t\t\tstartHour: Math.floor(start / (60*60)),\r\n\t\t\t\t\tstartMinute: Math.floor(start / (60)),\r\n\t\t\t\t\tendHour: Math.ceil(end / (60*60)),\r\n\t\t\t\t\tendMinute: Math.ceil(end / (60)),\r\n\t\t\t\t\tdurationSeconds: duration,\r\n\t\t\t\t\tdurationMinutes: duration/60,\r\n\t\t\t\t\tdurationHours: duration/(60 * 60)\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn timerangeConfig;\r\n\t\t} else {\r\n\t\t\treturn hours;\r\n\t\t}\r\n\t},\r\n\r\n\tsetWorkTime: function (settings) {\r\n\t\treturn this._tryChangeCalendarSettings(utils.bind(function () {\r\n\t\t\tvar hours = settings.hours !== undefined ? settings.hours : true;\r\n\t\t\tvar timestamp = this._timestamp(settings);\r\n\t\t\tvar calendarConfig = this.getConfig();\r\n\t\t\tif (timestamp !== null) {\r\n\t\t\t\tcalendarConfig.dates[timestamp] = hours;\r\n\t\t\t} else if(!settings.customWeeks) {\r\n\t\t\t\tcalendarConfig.hours = hours;\r\n\t\t\t}\r\n\r\n\t\t\tif(settings.customWeeks){\r\n\t\t\t\tif(!calendarConfig.customWeeks){\r\n\t\t\t\t\tcalendarConfig.customWeeks = {};\r\n\t\t\t\t}\r\n\t\t\t\t// GS-1867. allow setWorkTime to exclude dates in the customWeeks range\r\n\t\t\t\tif (typeof settings.customWeeks == \"string\"){\r\n\t\t\t\t\tif (timestamp !== null) {\r\n\t\t\t\t\t\tcalendarConfig.customWeeks[settings.customWeeks].dates[timestamp] = hours;\r\n\t\t\t\t\t} else if(!settings.customWeeks) {\r\n\t\t\t\t\t\tcalendarConfig.customWeeks[settings.customWeeks].hours = hours;\r\n\t\t\t\t\t}\t\t\r\n\t\t\t\t} else if (typeof settings.customWeeks === \"object\"\r\n\t\t\t\t&& Function.prototype.toString.call(settings.customWeeks.constructor) === \"function Object() { [native code] }\"){\r\n\t\t\t\t\tfor(var i in settings.customWeeks){\r\n\t\t\t\t\t\tcalendarConfig.customWeeks[i] = settings.customWeeks[i];\r\n\t\t\t\t\t}\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._parseSettings();\r\n\t\t\tthis._clearCaches();\r\n\t\t}, this));\r\n\t},\r\n\r\n\tunsetWorkTime: function (settings) {\r\n\t\treturn this._tryChangeCalendarSettings(utils.bind(function () {\r\n\t\t\tif (!settings) {\r\n\t\t\t\tthis.reset_calendar();\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar timestamp = this._timestamp(settings);\r\n\r\n\t\t\t\tif (timestamp !== null) {\r\n\t\t\t\t\tdelete this.getConfig().dates[timestamp];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// Load updated settings and clear work units cache\r\n\t\t\tthis._parseSettings();\r\n\t\t\tthis._clearCaches();\r\n\t\t}, this));\r\n\t},\r\n\r\n\t_isWorkTime: function (date, unit) {\r\n\t\t// Check if this item has in the cache\r\n\r\n\t\tvar useCache = true;//unit === \"day\"; // use cache only for days. In case of hours/minutes cache size grows too large and the overhead exceeds the gains\r\n\t\tvar isWorkUnit = -1;\r\n\t\tvar dateKey = null;\r\n\r\n\t\tif(useCache){\r\n\t\t\t// use string keys\r\n\t\t\tdateKey = String(date.valueOf());\r\n\t\t\tisWorkUnit = this._workingUnitsCache.getItem(unit, dateKey, date);\r\n\t\t}\r\n\r\n\t\tif (isWorkUnit == -1) {\r\n\t\t\t// calculate if not cached\r\n\t\t\tisWorkUnit = this._checkIfWorkingUnit(date, unit);\r\n\t\t\tif(useCache){\r\n\t\t\t\tthis._workingUnitsCache.setItem(unit, dateKey, isWorkUnit, date);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn isWorkUnit;\r\n\t},\r\n\r\n\tisWorkTime: function () {\r\n\t\tvar config =  this.argumentsHelper.isWorkTimeArguments.apply( this.argumentsHelper, arguments);\r\n\t\treturn this._isWorkTime(config.date, config.unit);\r\n\t},\r\n\r\n\tcalculateDuration: function () {\r\n\t\tvar config =  this.argumentsHelper.getDurationArguments.apply( this.argumentsHelper, arguments);\r\n\r\n\t\tif (!config.unit) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t//return this._calculateDuration(config.start_date, config.end_date, config.unit, config.step);\r\n\r\n\t\tvar self = this;\r\n\t\treturn this._dateDurationCache.getDuration(config.start_date, config.end_date, config.unit, config.step, function(){ \r\n\t\t\treturn self._calculateDuration(config.start_date, config.end_date, config.unit, config.step);\r\n\t\t});\r\n\t},\r\n\r\n\t_calculateDuration: function (from, to, unit, step) {\r\n\t\tvar res = 0;\r\n\r\n\t\tvar sign = 1;\r\n\t\tif(from.valueOf() > to.valueOf()){\r\n\t\t\tvar tmp = to;\r\n\t\t\tto = from;\r\n\t\t\tfrom = tmp;\r\n\t\t\tsign = -1;\r\n\t\t}\r\n\r\n\t\tif (unit == \"hour\" && step == 1) {\r\n\t\t\tres = this._getHoursBetween(from, to, unit, step);\r\n\t\t} else if(unit == \"minute\" && step == 1){\r\n\t\t\t// quick calculation for minutes with 1 minute step\r\n\t\t\tres = this._getMinutesBetween(from, to, unit, step);\r\n\t\t} else {\r\n\t\t\tres = this._getWorkUnitsBetweenGeneric(from, to, unit, step);\r\n\t\t}\r\n\r\n\t\t// getWorkUnits.. returns decimal durations\r\n\t\treturn sign * Math.round(res);\r\n\t},\r\n\thasDuration: function () {\r\n\t\tvar config =  this.argumentsHelper.getDurationArguments.apply( this.argumentsHelper, arguments);\r\n\r\n\t\tvar from = config.start_date,\r\n\t\t\tto = config.end_date,\r\n\t\t\tunit = config.unit,\r\n\t\t\tstep = config.step;\r\n\r\n\t\tif (!unit) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar start = new Date(from),\r\n\t\t\tend = new Date(to);\r\n\t\tstep = step || 1;\r\n\r\n\t\twhile (start.valueOf() < end.valueOf()) {\r\n\t\t\tif (this._isWorkTime(start, unit))\r\n\t\t\t\treturn true;\r\n\t\t\tstart = this._nextDate(start, unit, step);\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\r\n\tcalculateEndDate: function () {\r\n\t\tvar config =  this.argumentsHelper.calculateEndDateArguments.apply( this.argumentsHelper, arguments);\r\n\r\n\t\tvar from = config.start_date,\r\n\t\t\tduration = config.duration,\r\n\t\t\tunit = config.unit,\r\n\t\t\tstep = config.step;\r\n\r\n\t\tif (!unit)\r\n\t\t\treturn false;\r\n\r\n\t\tvar mult = (config.duration >= 0) ? 1 : -1;\r\n\t\tduration = Math.abs(duration * 1);\r\n\t//\tvar endDate = this._calculateEndDate(from, duration, unit, step * mult);\r\n\t//\treturn endDate;\r\n\t\tvar self = this;\r\n\t\treturn this._dateDurationCache.getEndDate(from, duration, unit, step * mult, function(){ \r\n\t\t\treturn self._calculateEndDate(from, duration, unit, step * mult);\r\n\t\t} );\r\n\t},\r\n\r\n\t_calculateEndDate: function (from, duration, unit, step) {\r\n\t\tif (!unit)\r\n\t\t\treturn false;\r\n\r\n\t\tif (step == 1 && unit == \"minute\") {\r\n\t\t\treturn this._calculateMinuteEndDate(from, duration, step);\r\n\t\t} else if(step == -1 && unit == \"minute\") {\r\n\t\t\treturn this._subtractMinuteDate(from, duration, step);\r\n\t\t} else if (step == 1 && unit == \"hour\") {\r\n\t\t\treturn this._calculateHourEndDate(from, duration, step);\r\n\t\t} else {\r\n\t\t\tvar interval = this._addInterval(from, duration, unit, step, null);\r\n\t\t\treturn interval.end;\r\n\t\t}\r\n\t},\r\n\r\n\t_addInterval: function (start, duration, unit, step, stopAction) {\r\n\t\tvar added = 0;\r\n\t\tvar current = start;\r\n\t\tvar dstShift = false;\r\n\r\n\t\twhile (added < duration && !(stopAction && stopAction(current))) {\r\n\t\t\tvar next = this._nextDate(current, unit, step);\r\n\r\n\t\t\t// GS-1501. Correct hours after DST change\r\n\t\t\tif (unit == \"day\"){\r\n\t\t\t\tdstShift = dstShift || !current.getHours() && next.getHours();\r\n\r\n\t\t\t\tif (dstShift){\r\n\t\t\t\t\tnext.setHours(0);\r\n\t\t\t\t\tif (next.getHours()){\r\n\t\t\t\t\t// the day when the timezone is changed, try to correct hours next time\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdstShift = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar dateValue = new Date(next.valueOf() + 1);\r\n\t\t\tif (step > 0) {\r\n\t\t\t\tdateValue = new Date(next.valueOf() - 1);\r\n\t\t\t}\r\n\t\t\tvar workTimeCheck = this._isWorkTime(dateValue, unit);\r\n\r\n\t\t\tif (workTimeCheck && !dstShift) {\r\n\t\t\t\tadded++;\r\n\t\t\t}\r\n\t\t\tcurrent = next;\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tend: current,\r\n\t\t\tstart: start,\r\n\t\t\tadded: added\r\n\t\t};\r\n\t},\r\n\r\n\t_addHoursUntilDayEnd: function(from, duration) {\r\n\t\tvar dayEnd = this.$gantt.date.add(this.$gantt.date.day_start(new Date(from)), 1, \"day\");\r\n\t\tvar added = 0;\r\n\t\tvar left = duration;\r\n\r\n\t\tvar range = this._getIntervalTimestamp(from, dayEnd);\r\n\t\tvar worktimes = this._getWorkHours(from);\r\n\t\tfor(var i = 0; i < worktimes.length && added < duration; i++){\r\n\t\t\tvar interval = worktimes[i];\r\n\t\t\tif(range.end >= interval.start && range.start <= interval.end){\r\n\t\t\t\tvar minuteFrom = Math.max(interval.start, range.start);\r\n\t\t\t\tvar minuteTo = Math.min(interval.end, range.end);\r\n\t\t\t\tvar rangeHours = (minuteTo - minuteFrom) / (60 * 60);\r\n\t\t\t\tif(rangeHours > left){\r\n\t\t\t\t\trangeHours = left;\r\n\t\t\t\t\tminuteTo = minuteFrom + (left * 60 * 60);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar addHours = Math.round((minuteTo - minuteFrom) / (60 * 60));\r\n\t\t\t\tadded += addHours;\r\n\t\t\t\tleft -= addHours;\r\n\t\t\t\trange.start = minuteTo;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar intervalEnd = dayEnd;\r\n\t\tif(added === duration){\r\n\t\t\tintervalEnd = new Date(from.getFullYear(), from.getMonth(), from.getDate(), 0, 0, range.start);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tadded: added,\r\n\t\t\tend: intervalEnd\r\n\t\t};\r\n\t},\r\n\r\n\t_calculateHourEndDate: function (from, duration,  step) {\r\n\t\tvar start = new Date(from),\r\n\t\tadded = 0;\r\n\t\tstep = step || 1;\r\n\t\tduration = Math.abs(duration * 1);\r\n\r\n\t\tvar interval = this._addHoursUntilDayEnd(start, duration);\r\n\t\tadded = interval.added;\r\n\t\tstart = interval.end;\r\n\r\n\t\tvar durationLeft = duration - added;\r\n\r\n\t\tif (durationLeft) {\r\n\t\t\tvar current = start;\r\n\t\t\twhile (added < duration) {\r\n\t\t\t\tvar next = this._nextDate(current, \"day\", step);\r\n\t\t\t\t// reset to day start in case DST switch happens in the process\r\n\t\t\t\tnext.setHours(0);\r\n\t\t\t\tnext.setMinutes(0);\r\n\t\t\t\tnext.setSeconds(0);\r\n\r\n\t\t\t\tvar hoursPerDay = 0;\r\n\t\t\t\tif(step > 0){\r\n\t\t\t\t\thoursPerDay = this.getHoursPerDay(new Date(next.valueOf() - 1));\r\n\t\t\t\t}else{\r\n\t\t\t\t\thoursPerDay = this.getHoursPerDay(new Date(next.valueOf() + 1));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (added + hoursPerDay >= duration) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tadded += hoursPerDay;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcurrent = next;\r\n\t\t\t}\r\n\t\t\tstart = current;\r\n\t\t}\r\n\r\n\t\tif (added < duration) {\r\n\t\t\tvar durationLeft = duration - added;\r\n\t\t\tinterval = this._addHoursUntilDayEnd(start, durationLeft);\r\n\t\t\tstart = interval.end;\r\n\t\t}\r\n\r\n\t\treturn start;\r\n\t},\r\n\r\n\t_addMinutesUntilHourEnd: function(from, duration){\r\n\t\tif(from.getMinutes() === 0) {\r\n\t\t\t// already at hour end\r\n\t\t\treturn {\r\n\t\t\t\tadded: 0,\r\n\t\t\t\tend: new Date(from)\r\n\t\t\t};\r\n\t\t}\r\n\t\tvar hourEnd = this.$gantt.date.add(this.$gantt.date.hour_start(new Date(from)), 1, \"hour\");\r\n\t\tvar added = 0;\r\n\t\tvar left = duration;\r\n\r\n\t\tvar range = this._getIntervalTimestamp(from, hourEnd);\r\n\t\tvar worktimes = this._getWorkHours(from);\r\n\t\tfor(var i = 0; i < worktimes.length && added < duration; i++){\r\n\t\t\tvar interval = worktimes[i];\r\n\t\t\tif(range.end >= interval.start && range.start <= interval.end){\r\n\t\t\t\tvar minuteFrom = Math.max(interval.start, range.start);\r\n\t\t\t\tvar minuteTo = Math.min(interval.end, range.end);\r\n\t\t\t\tvar rangeMinutes = (minuteTo - minuteFrom) / 60;\r\n\t\t\t\tif(rangeMinutes > left){\r\n\t\t\t\t\trangeMinutes = left;\r\n\t\t\t\t\tminuteTo = minuteFrom + (left * 60);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// TODO: verify testcase https://dhtmlxsupport.teamwork.com/desk/tickets/9625700/messages\r\n\t\t\t\t/*if (rangeMinutes === 0) {\r\n\t\t\t\t\trangeMinutes = left;\r\n\t\t\t\t\tminuteTo = minuteFrom + (left * 60);\r\n\t\t\t\t}*/\r\n\r\n\t\t\t\tvar addMinutes = Math.round((minuteTo - minuteFrom) / 60);\r\n\t\t\t\tleft -= addMinutes;\r\n\t\t\t\tadded += addMinutes;\r\n\t\t\t\trange.start = minuteTo;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar intervalEnd = hourEnd;\r\n\t\tif(added === duration){\r\n\t\t\tintervalEnd = new Date(from.getFullYear(), from.getMonth(), from.getDate(), 0, 0, range.start);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tadded: added,\r\n\t\t\tend: intervalEnd\r\n\t\t};\r\n\t},\r\n\r\n\t_subtractMinutesUntilHourStart: function(from, duration){\r\n\t\tvar hourStart = this.$gantt.date.hour_start(new Date(from));\r\n\t\tvar added = 0;\r\n\t\tvar left = duration;\r\n\r\n\t\tvar hourStartTimestamp = hourStart.getHours() * 60 * 60 + hourStart.getMinutes() * 60 + hourStart.getSeconds();\r\n\t\tvar initialDateTimestamp = from.getHours() * 60 * 60 + from.getMinutes() * 60 + from.getSeconds();\r\n\r\n\t\tvar worktimes = this._getWorkHours(from);\r\n\t\tfor(var i = worktimes.length - 1; i >= 0 && added < duration; i--){\r\n\t\t\tvar interval = worktimes[i];\r\n\t\t\tif(initialDateTimestamp > interval.start && hourStartTimestamp <= interval.end){\r\n\t\t\t\tvar minuteFrom = Math.min(initialDateTimestamp, interval.end);\r\n\t\t\t\tvar minuteTo = Math.max(hourStartTimestamp, interval.start);\r\n\r\n\t\t\t//\tvar minuteFrom = Math.max(interval.start, currentHour.start);\r\n\t\t\t//\tvar minuteTo = Math.min(interval.end, currentHour.end);\r\n\t\t\t\tvar rangeMinutes = (minuteFrom - minuteTo) / 60;\r\n\t\t\t\tif(rangeMinutes > left){\r\n\t\t\t\t\trangeMinutes = left;\r\n\t\t\t\t\tminuteTo = minuteFrom - (left * 60);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// TODO: verify testcase https://dhtmlxsupport.teamwork.com/desk/tickets/9625700/messages\r\n\t\t\t\t/*if (rangeMinutes === 0) {\r\n\t\t\t\t\trangeMinutes = left;\r\n\t\t\t\t\tminuteTo = minuteFrom - (left * 60);\r\n\t\t\t\t}*/\r\n\r\n\t\t\t\tvar addMinutes = Math.abs(Math.round((minuteFrom - minuteTo) / 60));\r\n\t\t\t\tleft -= addMinutes;\r\n\t\t\t\tadded += addMinutes;\r\n\t\t\t\tinitialDateTimestamp = minuteTo;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar intervalEnd = hourStart;\r\n\t\tif(added === duration){\r\n\t\t\tintervalEnd = new Date(from.getFullYear(), from.getMonth(), from.getDate(), 0, 0, initialDateTimestamp);\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tadded: added,\r\n\t\t\tend: intervalEnd\r\n\t\t};\r\n\t},\r\n\r\n\t_subtractMinuteDate: function (from, duration, step) {\r\n\t\t// var start = new Date(from),\r\n\t\t// GS-2683. We should start calculating minutes from the working time\r\n\t\tvar start = this.getClosestWorkTime({ date: from, dir: \"past\", unit: \"minute\" }),\r\n\t\t\tadded = 0;\r\n\t\tstep = step || -1;\r\n\t\tduration = Math.abs(duration * 1);\r\n\t\tduration = Math.round(duration);\r\n\r\n\t\tconst minutePrecision = this._isMinutePrecision(start);\r\n\r\n\t\tlet addedInterval = this._subtractMinutesUntilHourStart(start, duration);\r\n\t\tadded += addedInterval.added;\r\n\r\n\t\tstart = addedInterval.end;\r\n\r\n\t\tvar calculatedDay = 0;\r\n\t\tvar daySchedule = [];\r\n\t\tvar minutesInDay = 0;\r\n\r\n\t\twhile (added < duration) {\r\n\t\t\tvar dayStart = this.$gantt.date.day_start(new Date(start));\r\n\r\n\t\t\tvar iterateFromDayEnd = false;\r\n\t\t\tif(start.valueOf() === dayStart.valueOf()){\r\n\t\t\t\tdayStart = this.$gantt.date.add(dayStart, -1, \"day\");\r\n\t\t\t\titerateFromDayEnd = true;\r\n\t\t\t}\r\n\t\t\t//var dayStartTimestamp = this.$gantt.date.day_start(new Date(start)).valueOf();\r\n\t\t\tvar dayEnd = new Date(dayStart.getFullYear(), dayStart.getMonth(), dayStart.getDate(), 23, 59,59,999).valueOf();\r\n\r\n\t\t\tif(dayEnd !== calculatedDay){\r\n\t\t\t\tdaySchedule = this._getWorkHours(dayStart);\r\n\t\t\t\tminutesInDay = this._getMinutesPerDay(dayStart);\r\n\t\t\t\tcalculatedDay = dayEnd;\r\n\t\t\t}\r\n\r\n\t\t\tvar left = duration - added;\r\n\t\t\tvar timestamp = this._getTimeOfDayStamp(start, iterateFromDayEnd);\r\n\r\n\t\t\tif(!daySchedule.length || !minutesInDay){\r\n\t\t\t\tstart = this.$gantt.date.add(start, -1, \"day\");\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif(daySchedule[daySchedule.length - 1].end <= timestamp){\r\n\t\t\t\tif(left > minutesInDay){\r\n\t\t\t\t\tadded += minutesInDay;\r\n\t\t\t\t\tstart = this.$gantt.date.add(start, -1, \"day\");\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar isWorkHour = false;\r\n\t\t\tvar workInterval = null;\r\n\t\t\tvar prevInterval = null;\r\n\t\t\tfor(var i = daySchedule.length - 1; i >= 0; i--){\r\n\t\t\t\tif(daySchedule[i].start < timestamp - 1 && daySchedule[i].end >= timestamp - 1){\r\n\t\t\t\t\tisWorkHour = true;\r\n\t\t\t\t\tworkInterval = daySchedule[i];\r\n\t\t\t\t\tprevInterval = daySchedule[i-1];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(isWorkHour){\r\n\r\n\t\t\t\t// we're at the end of worktime interval and subtracting more than the duration of the interval\r\n\t\t\t\t// -> subtract the duration of the interval and move to the start of the interval (we're moving from end)\r\n\t\t\t\tif(timestamp === workInterval.end && left >= workInterval.durationMinutes){\r\n\t\t\t\t\tadded += workInterval.durationMinutes;\r\n\t\t\t\t\tstart = this.$gantt.date.add(start, -workInterval.durationMinutes, \"minute\");\r\n\t\t\t\t} // worktime is set in whole hours (no intervals like 9:15-10:00)\r\n\t\t\t\t// the amount we need to subtract lies inside the interval\r\n\t\t\t\telse if(!minutePrecision && left <= (timestamp/60 - workInterval.startMinute)){\r\n\t\t\t\t\tadded += left;\r\n\t\t\t\t\tstart = this.$gantt.date.add(start, -left, \"minute\");\r\n\t\t\t\t}else if (minutePrecision){\r\n\t\t\t\t\t// GS-2129. If the working time is set in minutes, we accumulate the working time in minutes from right to left\r\n\t\t\t\t\t\r\n\t\t\t\t\t// duration we need to subtract lies completely inside the work interval\r\n\t\t\t\t\tif(left <= (timestamp/60 - workInterval.startMinute)){\r\n\t\t\t\t\t\tadded += left;\r\n\t\t\t\t\t\tstart = this.$gantt.date.add(start, -left, \"minute\");\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\t\t// we need to go trough multiple work intervals to subtract needed time\r\n\t\t\t\t\t\tadded += (timestamp/60 - workInterval.startMinute);\r\n\t\t\t\t\t\tif(prevInterval){\r\n\t\t\t\t\t\t\tstart = new Date(start.getFullYear(), start.getMonth(), start.getDate(), 0, 0, prevInterval.end);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tstart = this.$gantt.date.day_start(start);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\r\n\t\t\t\t}else{\r\n\t\t\t\t\tvar minutesInHour = this._getMinutesPerHour(start);\r\n\t\t\t\t\tif(minutesInHour <= left){\r\n\t\t\t\t\t\tadded += minutesInHour;\r\n\t\t\t\t\t\tstart = this._nextDate(start, \"hour\", step);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\taddedInterval = this._subtractMinutesUntilHourStart(start, left);\r\n\t\t\t\t\t\tadded += addedInterval.added;\r\n\t\t\t\t\t\tstart = addedInterval.end;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tif(start.getHours() === 0 && start.getMinutes() === 0 && start.getSeconds() === 0){\r\n\t\t\t\t\tvar prev = this._getClosestWorkTimePast(start, \"hour\");\r\n\t\t\t\t\tif(prev.valueOf() === start.valueOf()){\r\n\t\t\t\t\t\tvar prev = this.$gantt.date.add(start, -1, \"day\");\r\n\t\t\t\t\t\tvar times = this._getWorkHours(prev);\r\n\t\t\t\t\t\tif(times.length){\r\n\t\t\t\t\t\t\tvar lastInterval = times[times.length - 1];\r\n\t\t\t\t\t\t\tprev.setSeconds(lastInterval.durationSeconds);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tstart = prev;\r\n\r\n\t\t\t\t} else{\r\n\t\t\t\t\tstart = this._getClosestWorkTimePast(new Date(start - 1), \"hour\");\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (added < duration) {\r\n\t\t\tvar durationLeft = duration - added;\r\n\t\t\taddedInterval = this._subtractMinutesUntilHourStart(start, durationLeft);\r\n\t\t\tadded += addedInterval.added;\r\n\t\t\tstart = addedInterval.end;\r\n\t\t}\r\n\r\n\t\treturn start;\r\n\t},\r\n\t_calculateMinuteEndDate: function (from, duration, step) {\r\n\t\tvar start = new Date(from),\r\n\t\t\tadded = 0;\r\n\t\tstep = step || 1;\r\n\t\tduration = Math.abs(duration * 1);\r\n\t\tduration = Math.round(duration);\r\n\r\n\t\tvar addedInterval = this._addMinutesUntilHourEnd(start, duration);\r\n\t\tadded += addedInterval.added;\r\n\r\n\t\tstart = addedInterval.end;\r\n\r\n\t\tvar calculatedDay = 0;\r\n\t\tvar daySchedule = [];\r\n\t\tvar minutesInDay = 0;\r\n\r\n\t\tvar minutePrecision = this._isMinutePrecision(start);\r\n\r\n\t\twhile (added < duration) {\r\n\t\t\tvar dayStart = this.$gantt.date.day_start(new Date(start)).valueOf();\r\n\t\t\tif(dayStart !== calculatedDay){\r\n\t\t\t\tdaySchedule = this._getWorkHours(start);\r\n\t\t\t\tminutesInDay = this._getMinutesPerDay(start);\r\n\t\t\t\tcalculatedDay = dayStart;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar left = duration - added;\r\n\t\t\tvar timestamp = this._getTimeOfDayStamp(start);\r\n\r\n\t\t\tif(!daySchedule.length || !minutesInDay){\r\n\t\t\t\tstart = this.$gantt.date.add(this.$gantt.date.day_start(start), 1, \"day\");\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif(daySchedule[0].start >= timestamp){\r\n\t\t\t\tif(left >= minutesInDay){\r\n\t\t\t\t\tadded += minutesInDay;\r\n\t\t\t\t\tif (left == minutesInDay) {\r\n\t\t\t\t\t\tstart = new Date(start.getFullYear(), start.getMonth(), start.getDate(), 0, 0, daySchedule[daySchedule.length - 1].end);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tstart = this.$gantt.date.add(start, 1, \"day\");\r\n\t\t\t\t\t\tstart = this.$gantt.date.day_start(start);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar isWorkHour = false;\r\n\t\t\tvar workInterval = null;\r\n\t\t\tfor(var i = 0; i < daySchedule.length; i++){\r\n\t\t\t\tif(daySchedule[i].start <= timestamp && daySchedule[i].end > timestamp){\r\n\t\t\t\t\tisWorkHour = true;\r\n\t\t\t\t\tworkInterval = daySchedule[i];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(isWorkHour){\r\n\r\n\t\t\t\tif(timestamp === workInterval.start && left >= workInterval.durationMinutes){\r\n\t\t\t\t\tadded += workInterval.durationMinutes;\r\n\t\t\t\t\tstart = this.$gantt.date.add(start, workInterval.durationMinutes, \"minute\");\r\n\t\t\t\t}else if(left <= (workInterval.endMinute - timestamp/60)){\r\n\t\t\t\t\tadded += left;\r\n\t\t\t\t\tstart = this.$gantt.date.add(start, left, \"minute\");\r\n\t\t\t\t}else{\r\n\t\t\t\t\tvar minutesInHour = this._getMinutesPerHour(start);\r\n\t\t\t\t\tif(minutesInHour <= left){\r\n\t\t\t\t\t\tadded += minutesInHour;\r\n\t\t\t\t\t\t// when the working time settings are set in minutes move to the next minutes\r\n\t\t\t\t\t\tif (minutePrecision) {\r\n\t\t\t\t\t\t\tstart = this.$gantt.date.add(start, minutesInHour, \"minute\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tstart = this._nextDate(start, \"hour\", step);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\taddedInterval = this._addMinutesUntilHourEnd(start, left);\r\n\t\t\t\t\t\tadded += addedInterval.added;\r\n\t\t\t\t\t\tstart = addedInterval.end;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tstart = this._getClosestWorkTimeFuture(start, \"hour\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (added < duration) {\r\n\t\t\tvar durationLeft = duration - added;\r\n\t\t\taddedInterval = this._addMinutesUntilHourEnd(start, durationLeft);\r\n\t\t\tadded += addedInterval.added;\r\n\t\t\tstart = addedInterval.end;\r\n\t\t}\r\n\r\n\t\treturn start;\r\n\t},\r\n\r\n\tgetClosestWorkTime: function () {\r\n\t\tvar settings =  this.argumentsHelper.getClosestWorkTimeArguments.apply( this.argumentsHelper, arguments);\r\n\t\treturn this._getClosestWorkTime(settings.date, settings.unit, settings.dir);\r\n\t},\r\n\r\n\t_getClosestWorkTime: function (inputDate, unit, direction) {\r\n\t\tvar result = new Date(inputDate);\r\n\r\n\t\tif (this._isWorkTime(result, unit)) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tresult = this.$gantt.date[unit + '_start'](result);\r\n\r\n\t\tif (direction == 'any' || !direction) {\r\n\t\t\tvar closestFuture = this._getClosestWorkTimeFuture(result, unit);\r\n\t\t\tvar closestPast = this._getClosestWorkTimePast(result, unit);\r\n\t\t\tif (Math.abs(closestFuture - inputDate) <= Math.abs(inputDate - closestPast)) {\r\n\t\t\t\tresult = closestFuture;\r\n\t\t\t} else {\r\n\t\t\t\tresult = closestPast;\r\n\t\t\t}\r\n\t\t} else if (direction == \"past\") {\r\n\t\t\tresult = this._getClosestWorkTimePast(result, unit);\r\n\t\t} else {\r\n\t\t\tresult = this._getClosestWorkTimeFuture(result, unit);\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t_getClosestWorkTimeFuture: function (date, unit) {\r\n\t\treturn this._getClosestWorkTimeGeneric(date, unit, 1);\r\n\t},\r\n\r\n\t_getClosestWorkTimePast: function (date, unit) {\r\n\t\tvar result = this._getClosestWorkTimeGeneric(date, unit, -1);\r\n\t\t// should return the end of the closest work interval\r\n\t\treturn this.$gantt.date.add(result, 1, unit);\r\n\t},\r\n\r\n\t_findClosestTimeInDay: function(date, direction, worktimes) {\r\n\t\tvar start = new Date(date);\r\n\t\tvar resultDate = null;\r\n\t\tvar fromDayEnd = false;\r\n\t\tif(!this._getWorkHours(start).length){\r\n\t\t\tstart = this._getClosestWorkTime(start, \"day\", direction < 0 ? \"past\" : \"future\");\r\n\t\t\tif(direction < 0){\r\n\t\t\t\tstart = new Date(start.valueOf() - 1);\r\n\t\t\t\tfromDayEnd = true;\r\n\t\t\t}\r\n\t\t\tworktimes = this._getWorkHours(start);\r\n\t\t}\r\n\r\n\t\tvar value = this._getTimeOfDayStamp(start);\r\n\t\tif(fromDayEnd){\r\n\t\t\tvalue = this._getTimeOfDayStamp(new Date(start.valueOf() + 1), fromDayEnd);\r\n\t\t}\r\n\t\tif(direction > 0){\r\n\t\t\tfor(var i = 0; i < worktimes.length; i++){\r\n\t\t\t\tif(worktimes[i].start >= value){\r\n\t\t\t\t\tresultDate = new Date(start.getFullYear(), start.getMonth(), start.getDate(), 0, 0, worktimes[i].start);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tfor(var i = worktimes.length - 1; i >= 0; i--){\r\n\t\t\t\tif(worktimes[i].end <= value){\r\n\t\t\t\t\tresultDate = new Date(start.getFullYear(), start.getMonth(), start.getDate(), 0, 0, worktimes[i].end);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}else if(worktimes[i].end > value && worktimes[i].start <= value) {\r\n\t\t\t\t\tresultDate = new Date(start.getFullYear(), start.getMonth(), start.getDate(), 0, 0, value);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn resultDate;\r\n\t},\r\n\t_getClosestWorkMinute: function(date, unit, direction) {\r\n\t\tvar start = new Date(date);\r\n\t\tvar worktimes = this._getWorkHours(start);\r\n\t\tvar resultDate = this._findClosestTimeInDay(start, direction, worktimes);\r\n\t\tif(!resultDate){\r\n\t\t\tif(direction > 0){\r\n\t\t\t\tstart = this.calculateEndDate(start, direction, unit);\r\n\t\t\t\tstart = this.$gantt.date.day_start(start);\r\n\t\t\t}else{\r\n\t\t\t\tstart = this.calculateEndDate(start, direction, \"day\");\r\n\t\t\t\tstart = this.$gantt.date.day_start(start);\r\n\t\t\t\tstart = this.$gantt.date.add(start, 1, \"day\");\r\n\t\t\t\tstart = new Date(start.valueOf() - 1);\r\n\t\t\t}\r\n\t\t\tworktimes = this._getWorkHours(start);\r\n\t\t\tresultDate = this._findClosestTimeInDay(start, direction, worktimes);\r\n\t\t}\r\n\t\tif(direction < 0){\r\n\t\t\t// getClosestWorkTimePast adds one time unit to the result date after this\r\n\t\t\tresultDate = this.$gantt.date.add(resultDate, -1, unit);\r\n\t\t}\r\n\t\treturn resultDate;\r\n\t},\r\n\r\n\t_getClosestWorkTimeGeneric: function (date, unit, increment) {\r\n\t\tif(unit === \"hour\" || unit === \"minute\"){\r\n\t\t\treturn this._getClosestWorkMinute(date, unit, increment);\r\n\t\t}\r\n\r\n\t\tvar unitOrder = this._getUnitOrder(unit),\r\n\t\t\tbiggerTimeUnit = this.units[unitOrder - 1];\r\n\r\n\t\tvar result = date;\r\n\r\n\t\t// be extra sure we won't fall into infinite loop, 3k seems big enough\r\n\t\tvar maximumLoop = 3000,\r\n\t\t\tcount = 0;\r\n\r\n\t\twhile (!this._isWorkTime(result, unit)) {\r\n\t\t\tif (biggerTimeUnit && !this._isWorkTime(result, biggerTimeUnit)) {\r\n\t\t\t\t// if we look for closest work hour and detect a week-end - first find the closest work day,\r\n\t\t\t\t// and continue iterations after that\r\n\t\t\t\tif (increment > 0) {\r\n\t\t\t\t\tresult = this._getClosestWorkTimeFuture(result, biggerTimeUnit);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult = this._getClosestWorkTimePast(result, biggerTimeUnit);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this._isWorkTime(result, unit)) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tcount++;\r\n\t\t\tif (count > maximumLoop) {\r\n\t\t\t\tthis.$gantt.assert(false, \"Invalid working time check\");\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tvar tzOffset = result.getTimezoneOffset();\r\n\t\t\tresult = this.$gantt.date.add(result, increment, unit);\r\n\r\n\t\t\tresult = this.$gantt._correct_dst_change(result, tzOffset, increment, unit);\r\n\t\t\tif (this.$gantt.date[unit + '_start']) {\r\n\t\t\t\tresult = this.$gantt.date[unit + '_start'](result);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/**\r\n\t * Check whether this calendar has working time. Calendar has working time only if there are regular working days of week\r\n\t *\r\n\t */\r\n\thasWorkTime: function () {\r\n\t\tvar worktime = this.getConfig();\r\n\t\tvar dates = worktime.dates;\r\n\r\n\t\tvar daysOfWeek = [0, 1, 2, 3, 4, 5, 6];\r\n\t\tvar exceptions = [];\r\n\t\tfor(var i in worktime.dates){\r\n\t\t\tif(Number(i) > 6){\r\n\t\t\t\texceptions.push(Number(i));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar hasRegularHours = this._checkWorkHours(worktime.hours);\r\n\r\n\t\tvar result = false;\r\n\t\tdaysOfWeek.forEach((function(day){\r\n\t\t\tif(result){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar dayConfig = dates[day];\r\n\t\t\tif(dayConfig === true){\r\n\t\t\t\t// workday uses global hours\r\n\t\t\t\tresult = hasRegularHours;\r\n\t\t\t}else if(Array.isArray(dayConfig)){\r\n\t\t\t\t// workday uses custom hours\r\n\t\t\t\tresult = this._checkWorkHours(dayConfig);\r\n\t\t\t}\r\n\t\t}).bind(this));\r\n\r\n\t\treturn result;\r\n\r\n\t},\r\n\r\n\t_checkWorkHours: function(hoursArray) {\r\n\t\tif (hoursArray.length === 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar result = false;\r\n\t\tfor (var i = 0; i < hoursArray.length; i += 2) {\r\n\t\t\tif (hoursArray[i] !== hoursArray[i + 1]) {\r\n\t\t\t\tresult = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\r\n\t_isMinutePrecision: function (date) {\r\n\t\tlet minutePrecision = false;\r\n\t\tthis._getWorkHours(date).forEach(function(interval){\r\n\t\t\tif (interval.startMinute % 60 || interval.endMinute % 60){\r\n\t\t\t\tminutePrecision = true;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn minutePrecision;\r\n\t}\r\n};\r\n\r\nexport default CalendarWorkTimeStrategy;","export default {\r\n\tisLegacyResourceCalendarFormat: function(resourceCalendarsProperty){\r\n\t\t// modern format:\r\n\t\t//gantt.config.resource_calendars = {\r\n\t\t//\tresourceId: calendarId,\r\n\t\t//\tresourceId: calendarId,\r\n\t\t//\tresourceId: calendarId\r\n\t\t//\t};\r\n\t\t\r\n\t\t// legacy format:\r\n\t\t// gantt.config.resource_calendars = {\r\n\t\t//\t\"resourceProperty\": {\r\n\t\t//\t\tresourceId: calendarId,\r\n\t\t//\t\tresourceId: calendarId,\r\n\t\t//\t\tresourceId: calendarId\r\n\t\t//\t\t}\r\n\t\t//\t};\r\n\r\n\t\tif(!resourceCalendarsProperty){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tfor(var i in resourceCalendarsProperty){\r\n\t\t\tif(resourceCalendarsProperty[i] && typeof resourceCalendarsProperty[i] === \"object\"){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t},\r\n\tgetResourceProperty: function(config){\r\n\t\tvar resourceCalendarsConfig = config.resource_calendars;\r\n\t\tvar propertyName = config.resource_property;\r\n\t\tif(this.isLegacyResourceCalendarFormat(resourceCalendarsConfig)){\r\n\t\t\tfor(var i in config){\r\n\t\t\t\tpropertyName = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn propertyName;\r\n\t},\r\n\tgetCalendarIdFromLegacyConfig: function(task, config){\r\n\t\tif (config) {\r\n\t\t\tfor (var field in config) {\r\n\t\t\t\tvar resource = config[field];\r\n\t\t\t\tif (task[field]) {\r\n\t\t\t\t\tvar calendarId = resource[task[field]];\r\n\t\t\t\t\tif (calendarId) {\r\n\t\t\t\t\t\treturn calendarId;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n};","export default function() {\r\n\tfunction getResourcesCalendarKey(resourceAssignments){\r\n\t\treturn resourceAssignments.map(function(res){\r\n\t\t\tif(res && res.resource_id){\r\n\t\t\t\treturn res.resource_id;\r\n\t\t\t} else {\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t}).sort().join(\"-\");\r\n\t}\r\n\r\n\tvar dynamicCalendars = {};\r\n\r\n\tfunction mergeResourceCalendars(resourceAssignments, manager){\r\n\t\treturn manager.mergeCalendars(resourceAssignments.map(function(assignment){\r\n\t\t\tvar resourceId = (assignment && assignment.resource_id) ? assignment.resource_id : assignment;\r\n\t\t\treturn manager.getResourceCalendar(resourceId);\r\n\t\t}));\r\n\t}\r\n\tfunction getCalendarIdFromMultipleResources(resourceAssignments, manager){\r\n\t\tvar key = getResourcesCalendarKey(resourceAssignments);\r\n\t\tif(!resourceAssignments.length){\r\n\t\t\treturn null;\r\n\t\t}else if(resourceAssignments.length === 1){\r\n\t\t\treturn manager.getResourceCalendar(key).id;\r\n\t\t}else if (dynamicCalendars[key]){\r\n\t\t\treturn dynamicCalendars[key].id;\r\n\t\t} else {\r\n\t\t\tvar tempCalendar = mergeResourceCalendars(resourceAssignments, manager);\r\n\r\n\t\t\tdynamicCalendars[key] = tempCalendar;\r\n\t\t\treturn manager.addCalendar(tempCalendar);\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\tgetCalendarIdFromMultipleResources: getCalendarIdFromMultipleResources\r\n\t};\r\n};","import * as utils from \"../../utils/utils\";\r\nimport createArgumentsHelper from \"./calendar_arguments_helper\";\r\nimport CalendarMergeHelper from \"./strategy/work_calendar_merger\";\r\nimport CalendarWorkTimeStrategy from \"./strategy/calendar_strategy\";\r\nimport legacyResourceCalendarConfig from \"./legacy_resource_config\";\r\nimport dynamicResourceCalendarsFactory from \"./dynamic_resource_calendars\";\r\n\r\nconst dynamicResourceCalendars = dynamicResourceCalendarsFactory();\r\n\r\nfunction CalendarManager (gantt){\r\n\tthis.$gantt = gantt;\r\n\tthis._calendars = {};\r\n\tthis._legacyConfig = undefined;\r\n\tthis.$gantt.attachEvent(\"onGanttReady\", function(){\r\n\t\tif(this.$gantt.config.resource_calendars){\r\n\t\t\tthis._isLegacyConfig = legacyResourceCalendarConfig.isLegacyResourceCalendarFormat(this.$gantt.config.resource_calendars);\r\n\t\t}\r\n\t}.bind(this));\r\n\r\n\tthis.$gantt.attachEvent(\"onBeforeGanttReady\", function(){\r\n\t\tthis.createDefaultCalendars();\r\n\t}.bind(this));\r\n\tthis.$gantt.attachEvent(\"onBeforeGanttRender\", function(){\r\n\t\tthis.createDefaultCalendars();\r\n\t}.bind(this));\r\n}\r\n\r\nCalendarManager.prototype = {\r\n\t_calendars: {},\r\n\t_convertWorkTimeSettings: function (settings) {\r\n\t\tvar days = settings.days;\r\n\t\tif (days && !settings.dates) {\r\n\t\t\tsettings.dates = settings.dates || {};\r\n\t\t\tfor (var i = 0; i < days.length; i++) {\r\n\t\t\t\tsettings.dates[i] = days[i];\r\n\t\t\t\tif (!(days[i] instanceof Array)) {\r\n\t\t\t\t\tsettings.dates[i] = !!days[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tdelete settings.days;\r\n\t\treturn settings;\r\n\t},\r\n\tmergeCalendars: function(){\r\n\t\tvar calendars = [];\r\n\t\tvar args = arguments;\r\n\t\tif(Array.isArray(args[0])){\r\n\t\t\tcalendars = args[0].slice();\r\n\t\t}else{\r\n\t\t\tfor(var i = 0; i < arguments.length; i++){\r\n\t\t\t\tcalendars.push(arguments[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar mergeHelper = new CalendarMergeHelper();\r\n\r\n\t\tvar result;\r\n\t\tcalendars.forEach(function(calendar){\r\n\t\t\tif(!result){\r\n\t\t\t\tresult = calendar;\r\n\t\t\t} else{\r\n\t\t\t\tresult = this._createCalendarFromConfig(mergeHelper.merge(result, calendar));\r\n\t\t\t}\r\n\r\n\t\t}.bind(this));\r\n\t\treturn this.createCalendar(result);\r\n\t},\r\n\r\n\t_createCalendarFromConfig: function(config){\r\n\t\tvar apiCore = new CalendarWorkTimeStrategy(this.$gantt, createArgumentsHelper(this.$gantt));\r\n\t\tapiCore.id = String(utils.uid());\r\n\r\n\t\tvar preparedConfig = this._convertWorkTimeSettings(config);\r\n\t\tif(preparedConfig.customWeeks){\r\n\t\t\tfor(var i in preparedConfig.customWeeks){\r\n\t\t\t\tpreparedConfig.customWeeks[i] = this._convertWorkTimeSettings(preparedConfig.customWeeks[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tapiCore._setConfig(preparedConfig);\r\n\r\n\t\treturn apiCore;\r\n\t},\r\n\r\n\tcreateCalendar: function (parentCalendar) {\r\n\t\tvar settings;\r\n\r\n\t\tif (!parentCalendar) {\r\n\t\t\tparentCalendar = {};\r\n\t\t}\r\n\r\n\t\tif (parentCalendar.getConfig){\r\n\t\t\tsettings = utils.copy(parentCalendar.getConfig());\r\n\t\t} else if (parentCalendar.worktime) {\r\n\t\t\tsettings = utils.copy(parentCalendar.worktime);\r\n\t\t} else {\r\n\t\t\tsettings = utils.copy(parentCalendar);\r\n\t\t}\r\n\r\n\t\tvar defaults = utils.copy(this.defaults.fulltime.worktime);\r\n\t\tutils.mixin(settings, defaults);\r\n\r\n\t\treturn this._createCalendarFromConfig(settings);\r\n\t},\r\n\r\n\tgetCalendar: function (id) {\r\n\t\tid = id || \"global\";\r\n\t\tvar calendar = this._calendars[id];\r\n\t\tif(!calendar){\r\n\t\t\tthis.createDefaultCalendars();\r\n\t\t\tcalendar = this._calendars[id];\r\n\t\t}\r\n\r\n\t\treturn calendar;\r\n\t},\r\n\r\n\tgetCalendars: function () {\r\n\t\tvar res = [];\r\n\t\tfor (var i in this._calendars) {\r\n\t\t\tres.push(this.getCalendar(i));\r\n\t\t}\r\n\t\treturn res;\r\n\t},\r\n\r\n\t_getOwnCalendar: function(task){\r\n\t\tvar config = this.$gantt.config;\r\n\t\tif (task[config.calendar_property]) {\r\n\t\t\treturn this.getCalendar(task[config.calendar_property]);\r\n\t\t}\r\n\r\n\t\tif (config.resource_calendars) {\r\n\t\t\tvar calendar;\r\n\t\t\tvar calendarId;\r\n\t\t\tvar resourceProperty;\r\n\t\t\tif(this._legacyConfig === false){\r\n\t\t\t\tresourceProperty = config.resource_property;\r\n\t\t\t}else{\r\n\t\t\t\tresourceProperty = legacyResourceCalendarConfig.getResourceProperty(config);\r\n\t\t\t}\r\n\t\t\tif(Array.isArray(task[resourceProperty])){\r\n\t\t\t\t// if multiple resources are attached to the task - merge their calendars\r\n\t\t\t\tif(config.dynamic_resource_calendars){\r\n\t\t\t\t\tcalendarId = dynamicResourceCalendars.getCalendarIdFromMultipleResources(task[resourceProperty], this);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcalendar = this.getResourceCalendar(task[resourceProperty]);\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tif(this._legacyConfig === undefined){\r\n\t\t\t\t\tthis._legacyConfig = legacyResourceCalendarConfig.isLegacyResourceCalendarFormat(config.resource_calendars);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(this._legacyConfig){\r\n\t\t\t\t\tvar calendarId = legacyResourceCalendarConfig.getCalendarIdFromLegacyConfig(task, config.resource_calendars);\r\n\t\t\t\t}else if(resourceProperty && task[resourceProperty] && config.resource_calendars[task[resourceProperty]]){\r\n\t\t\t\t\tvar calendar = this.getResourceCalendar(task[resourceProperty]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(calendarId){\r\n\t\t\t\tcalendar = this.getCalendar(calendarId);\r\n\t\t\t}\r\n\r\n\t\t\tif(calendar){\r\n\t\t\t\treturn calendar;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\t/**\r\n\t * Returns calendar assigned to the specified resource.\r\n\t * Returns the global calendar if no custom calendar is associated with the resource.\r\n\t * @param {(string|number|Object)} resource - resource object or resource id\r\n\t * @returns {object} Calendar object\r\n\t */\r\n\tgetResourceCalendar: function(resource) {\r\n\t\tif (resource === null || resource === undefined) {\r\n\t\t\treturn this.getCalendar();\r\n\t\t}\r\n\r\n\t\tvar resourceId = null;\r\n\t\t// if task id is provided\r\n\t\tif((typeof resource === \"number\" || typeof resource === \"string\")){\r\n\t\t\tresourceId = resource;\r\n\t\t}else{\r\n\t\t\tresourceId = resource.id || resource.key;\r\n\t\t}\r\n\r\n\t\tvar config = this.$gantt.config;\r\n\t\tvar calendarsConfig = config.resource_calendars;\r\n\t\tvar calendarId = null;\r\n\r\n\t\t// GS-1714: if resource is specified through array\r\n\t\tif (Array.isArray(resource)){\r\n\t\t\tif (resource.length === 1){\r\n\t\t\t\tif (typeof resource[0] === 'object'){\r\n\t\t\t\t\tresourceId = resource[0].resource_id; // if resource: [\"resource_id: \"6\", value: \"4\", ...\"]\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresourceId = resource[0]; // if resource: [1]\r\n\t\t\t\t}\r\n\t\t\t} \r\n\t\t}\r\n\t\t\r\n\t\tif (calendarsConfig) {\r\n\t\t\tif(this._legacyConfig === undefined){\r\n\t\t\t\tthis._legacyConfig = legacyResourceCalendarConfig.isLegacyResourceCalendarFormat(config.resource_calendars);\r\n\t\t\t}\r\n\r\n\t\t\tif(this._legacyConfig){\r\n\t\t\t\tfor(var field in calendarsConfig){\r\n\t\t\t\t\tif(calendarsConfig[field][resourceId]){\r\n\t\t\t\t\t\tcalendarId = calendarsConfig[field][resourceId];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tvar calendarId = calendarsConfig[resourceId];\r\n\t\t\t}\r\n\r\n\t\t\tif(calendarId){\r\n\t\t\t\treturn this.getCalendar(calendarId);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\treturn this.getCalendar();\r\n\t},\r\n\r\n\t/**\r\n\t * Returns the calendar assigned to a task.\r\n\t * - Returns a calendar assigned via task[gantt.config.calendar_property] if specified.\r\n\t * - Returns a calendar assigned to the task resource if specified.\r\n\t * - Returns the global calendar otherwise.\r\n\t * @param {(string|number|Object)} task - task object or task id\r\n\t * @returns {object} Calendar object\r\n\t */\r\n\tgetTaskCalendar: function (task) {\r\n\t\tvar gantt = this.$gantt;\r\n\t\tvar taskObject;\r\n\t\tif (task === null || task === undefined) {\r\n\t\t\treturn this.getCalendar();\r\n\t\t}\r\n\r\n\t\t// if task id is provided\r\n\t\tif((typeof task === \"number\" || typeof task === \"string\") && gantt.isTaskExists(task)){\r\n\t\t\ttaskObject = gantt.getTask(task);\r\n\t\t}else{\r\n\t\t\ttaskObject = task;\r\n\t\t}\r\n\r\n\t\tif(!taskObject){\r\n\t\t\treturn this.getCalendar();\r\n\t\t}\r\n\r\n\t\tvar calendar = this._getOwnCalendar(taskObject);\r\n\t\tvar groupMode = !!gantt.getState().group_mode;\r\n\r\n\t\tif (!calendar && gantt.config.inherit_calendar && gantt.isTaskExists(taskObject.parent)){\r\n\t\t\t// GS-1579  group mode overrides tree hierarchy, iterate using `.parent` property, instead of using eachParent iterator\r\n\t\t\tvar currentTask = taskObject;\r\n\t\t\twhile(gantt.isTaskExists(currentTask.parent)){\r\n\t\t\t\tcurrentTask = gantt.getTask(currentTask.parent);\r\n\t\t\t\tif(gantt.isSummaryTask(currentTask)){\r\n\t\t\t\t\tcalendar = this._getOwnCalendar(currentTask);\r\n\t\t\t\t\tif(calendar){\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(groupMode && !calendar){\r\n\t\t\t\t// if group mode and inherit_calendars is enabled - preserve previously applied parent calendar\r\n\t\t\t\t// we may need it when groupBy parses grouped data, old parent may be not loaded yet\r\n\t\t\t\tif(task.$effective_calendar){\r\n\t\t\t\t\tcalendar = this.getCalendar(task.$effective_calendar);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn calendar || this.getCalendar();\r\n\t},\r\n\r\n\taddCalendar: function(calendar) { // puts new calendar to Global Storage - gantt.calendarManager._calendars {}\r\n\t\tif (!(this.isCalendar(calendar))) {\r\n\t\t\tvar id = calendar.id;\r\n\t\t\tcalendar = this.createCalendar(calendar);\r\n\t\t\tcalendar.id = id;\r\n\t\t}\r\n\r\n\t\t// validate/check if empty calendar\r\n\t\tif (!calendar._tryChangeCalendarSettings(function () {\r\n\t\t\t})) {\r\n\r\n\t\t\tthis.$gantt.callEvent(\"onCalendarError\", [{message: \"Invalid calendar settings, no worktime available\"}, calendar]);\r\n\t\t\treturn null;\r\n\t\t} else {\r\n\t\t\tvar config = this.$gantt.config;\r\n\r\n\t\t\tcalendar.id = calendar.id || utils.uid();\r\n\t\t\tthis._calendars[calendar.id] = calendar;\r\n\t\t\tif (!config.worktimes)\r\n\t\t\t\tconfig.worktimes = {};\r\n\t\t\tconfig.worktimes[calendar.id] = calendar.getConfig();\r\n\t\t\treturn calendar.id;\r\n\t\t}\r\n\t},\r\n\r\n\tdeleteCalendar: function (calendar) {\r\n\t\tvar config = this.$gantt.config;\r\n\t\tif (!calendar) return false;\r\n\t\tif (this._calendars[calendar]) {\r\n\t\t\tdelete this._calendars[calendar];\r\n\t\t\tif (config.worktimes && config.worktimes[calendar])\r\n\t\t\t\tdelete config.worktimes[calendar];\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t},\r\n\r\n\trestoreConfigCalendars: function (configs) {\r\n\t\tfor (var i in configs) {\r\n\t\t\tif (this._calendars[i])\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tvar settings = configs[i];\r\n\t\t\tvar calendar = this.createCalendar(settings);\r\n\t\t\tcalendar.id = i;\r\n\t\t\tthis.addCalendar(calendar);\r\n\t\t}\r\n\t},\r\n\r\n\tdefaults: {\r\n\t\tglobal: {\r\n\t\t\tid: \"global\",\r\n\t\t\tworktime: {\r\n\t\t\t\thours: [8, 12, 13, 17],\r\n\t\t\t\tdays: [0, 1, 1, 1, 1, 1, 0]\r\n\t\t\t}\r\n\t\t},\r\n\t\tfulltime: {\r\n\t\t\tid: \"fulltime\",\r\n\t\t\tworktime: {\r\n\t\t\t\thours: [0, 24],\r\n\t\t\t\tdays: [1, 1, 1, 1, 1, 1, 1]\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tcreateDefaultCalendars: function () {\r\n\t\tvar config = this.$gantt.config;\r\n\t\tthis.restoreConfigCalendars(this.defaults);\r\n\t\tthis.restoreConfigCalendars(config.worktimes);\r\n\t},\r\n\r\n\tisCalendar: function(possibleCalendar) {\r\n\t\t// because we don't have any way to check without dependency to CalendarWorkTimeStrategy\r\n\t\tvar props = [\r\n\t\t\tpossibleCalendar.isWorkTime,\r\n\t\t\tpossibleCalendar.setWorkTime,\r\n\t\t\tpossibleCalendar.getWorkHours,\r\n\t\t\tpossibleCalendar.unsetWorkTime,\r\n\t\t\tpossibleCalendar.getClosestWorkTime,\r\n\t\t\tpossibleCalendar.calculateDuration,\r\n\t\t\tpossibleCalendar.hasDuration,\r\n\t\t\tpossibleCalendar.calculateEndDate\r\n\t\t];\r\n\t\treturn props.every(function(entry) {\r\n\t\t\treturn entry instanceof Function;\r\n\t\t});\r\n\t}\r\n};\r\n\r\nexport default CalendarManager;","function CalendarDisabledTimeStrategy(gantt, argumentsHelper){\r\n\tthis.argumentsHelper = argumentsHelper;\r\n\tthis.$gantt = gantt;\r\n}\r\n\r\nCalendarDisabledTimeStrategy.prototype = {\r\n\tgetWorkHours: function () {\r\n\t\treturn [0, 24];\r\n\t},\r\n\tsetWorkTime: function () {\r\n\t\treturn true;\r\n\t},\r\n\tunsetWorkTime: function () {\r\n\t\treturn true;\r\n\t},\r\n\tisWorkTime: function () {\r\n\t\treturn true;\r\n\t},\r\n\tgetClosestWorkTime: function (config) {\r\n\t\tvar config = this.argumentsHelper.getClosestWorkTimeArguments.apply(this.argumentsHelper, arguments);\r\n\t\treturn config.date;\r\n\t},\r\n\r\n\tcalculateDuration: function () {\r\n\t\tvar config = this.argumentsHelper.getDurationArguments.apply(this.argumentsHelper, arguments);\r\n\t\tvar from = config.start_date,\r\n\t\t\tto = config.end_date,\r\n\t\t\tunit = config.unit,\r\n\t\t\tstep = config.step;\r\n\r\n\t\treturn this._calculateDuration(from, to, unit, step);\r\n\t},\r\n\t_calculateDuration: function (start, end, unit, step) {\r\n\t\tvar dateHelper = this.$gantt.date;\r\n\t\tvar fixedUnits = {\r\n\t\t\t\"week\": 1000 * 60 * 60 * 24 * 7,\r\n\t\t\t\"day\": 1000 * 60 * 60 * 24,\r\n\t\t\t\"hour\": 1000 * 60 * 60,\r\n\t\t\t\"minute\": 1000 * 60\r\n\t\t};\r\n\r\n\t\tvar res = 0;\r\n\t\tif (fixedUnits[unit]) {\r\n\t\t\tres = Math.round((end - start) / (step * fixedUnits[unit]));\r\n\t\t} else {\r\n\t\t\tvar from = new Date(start),\r\n\t\t\t\tto = new Date(end);\r\n\t\t\twhile (from.valueOf() < to.valueOf()) {\r\n\t\t\t\tres += 1;\r\n\t\t\t\tfrom = dateHelper.add(from, step, unit);\r\n\t\t\t}\r\n\r\n\t\t\tif (from.valueOf() != end.valueOf()) {\r\n\t\t\t\tres += (to - from) / (dateHelper.add(from, step, unit) - from);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn Math.round(res);\r\n\t},\r\n\r\n\thasDuration: function () {\r\n\t\tvar config = this.argumentsHelper.getDurationArguments.apply(this.argumentsHelper, arguments);\r\n\t\tvar from = config.start_date,\r\n\t\t\tto = config.end_date,\r\n\t\t\tunit = config.unit;\r\n\r\n\t\tif (!unit) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tfrom = new Date(from);\r\n\t\tto = new Date(to);\r\n\r\n\t\treturn (from.valueOf() < to.valueOf());\r\n\t},\r\n\r\n\thasWorkTime: function() {\r\n\t\treturn true;\r\n\t},\r\n\r\n\tequals: function(calendar) {\r\n\t\tif(!(calendar instanceof CalendarDisabledTimeStrategy)){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\tcalculateEndDate: function () {\r\n\t\tvar config = this.argumentsHelper.calculateEndDateArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tvar start = config.start_date,\r\n\t\t\tduration = config.duration,\r\n\t\t\tunit = config.unit,\r\n\t\t\tstep = config.step;\r\n\r\n\t\treturn this.$gantt.date.add(start, step * duration, unit);\r\n\t}\r\n};\r\n\r\nexport default CalendarDisabledTimeStrategy;","import createArgumentsHelper from \"./calendar_arguments_helper\";\r\nimport NoWorkTimeCalendar from \"./strategy/no_work_time\";\r\n\r\nfunction TimeCalculator(calendarManager){\r\n\r\n\tthis.$gantt = calendarManager.$gantt;\r\n\tthis.argumentsHelper = createArgumentsHelper(this.$gantt);\r\n\tthis.calendarManager = calendarManager;\r\n\tthis.$disabledCalendar = new NoWorkTimeCalendar(this.$gantt, this.argumentsHelper);\r\n}\r\n\r\nTimeCalculator.prototype = {\r\n\t_getCalendar: function (config) {\r\n\t\tvar calendar;\r\n\t\tif (!this.$gantt.config.work_time) {\r\n\t\t\tcalendar = this.$disabledCalendar;\r\n\t\t} else {\r\n\t\t\tvar manager = this.calendarManager;\r\n\t\t\tif (config.task) {\r\n\t\t\t\tcalendar = manager.getTaskCalendar(config.task);\r\n\t\t\t} else if (config.id) {\r\n\t\t\t\tcalendar = manager.getTaskCalendar(config);\r\n\t\t\t} else if (config.calendar) {\r\n\t\t\t\tcalendar = config.calendar;\r\n\t\t\t}\r\n\t\t\tif (!calendar) {\r\n\t\t\t\tcalendar = manager.getTaskCalendar();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn calendar;\r\n\t},\r\n\r\n\tgetWorkHours: function (config) {\r\n\t\tconfig = this.argumentsHelper.getWorkHoursArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tvar calendar = this._getCalendar(config);\r\n\r\n\t\treturn calendar.getWorkHours(config.date);\r\n\t},\r\n\r\n\tsetWorkTime: function (config, calendar) {\r\n\t\tconfig = this.argumentsHelper.setWorkTimeArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tif (!calendar)\r\n\t\t\tcalendar = this.calendarManager.getCalendar(); // Global\r\n\t\treturn calendar.setWorkTime(config);\r\n\t},\r\n\r\n\tunsetWorkTime: function (config, calendar) {\r\n\t\tconfig = this.argumentsHelper.unsetWorkTimeArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tif (!calendar)\r\n\t\t\tcalendar = this.calendarManager.getCalendar(); // Global\r\n\t\treturn calendar.unsetWorkTime(config);\r\n\t},\r\n\tisWorkTime: function (date, unit, task, calendar) {\r\n\t\tvar config = this.argumentsHelper.isWorkTimeArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tcalendar = this._getCalendar(config);\r\n\t\treturn calendar.isWorkTime(config);\r\n\t},\r\n\tgetClosestWorkTime: function (config) {\r\n\t\tconfig = this.argumentsHelper.getClosestWorkTimeArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tvar calendar = this._getCalendar(config);\r\n\r\n\t\treturn calendar.getClosestWorkTime(config);\r\n\t},\r\n\r\n\tcalculateDuration: function () { // start_date_date, end_date, task\r\n\t\tvar config = this.argumentsHelper.getDurationArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\r\n\t\tvar calendar = this._getCalendar(config);\r\n\t\treturn calendar.calculateDuration(config);\r\n\t},\r\n\thasDuration: function () {\r\n\t\tvar config = this.argumentsHelper.hasDurationArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tvar calendar = this._getCalendar(config);\r\n\r\n\t\treturn calendar.hasDuration(config);\r\n\t},\r\n\tcalculateEndDate: function (config) { // start_date, duration, unit, task\r\n\t\tvar config = this.argumentsHelper.calculateEndDateArguments.apply(this.argumentsHelper, arguments);\r\n\r\n\t\tvar calendar = this._getCalendar(config);\r\n\t\treturn calendar.calculateEndDate(config);\r\n\t}\r\n};\r\n\r\nexport default TimeCalculator;\r\n\r\n","// TODO: rework public api for date methods\r\nimport * as utils from \"../../utils/utils\";\r\n\r\nvar createWorkTimeFacade = function(calendarManager, timeCalculator){\r\n\treturn {\r\n\t\tgetWorkHours: function (date) {\r\n\t\t\treturn timeCalculator.getWorkHours(date);\r\n\t\t},\r\n\r\n\t\tsetWorkTime: function (config) {\r\n\t\t\treturn timeCalculator.setWorkTime(config);\r\n\t\t},\r\n\r\n\t\tunsetWorkTime: function (config) {\r\n\t\t\ttimeCalculator.unsetWorkTime(config);\r\n\t\t},\r\n\r\n\t\tisWorkTime: function (date, unit, task) {\r\n\t\t\treturn timeCalculator.isWorkTime(date, unit, task);\r\n\t\t},\r\n\r\n\t\tgetClosestWorkTime: function (config) {\r\n\t\t\treturn timeCalculator.getClosestWorkTime(config);\r\n\t\t},\r\n\r\n\t\tcalculateDuration: function (start_date, end_date, task) {\r\n\t\t\treturn timeCalculator.calculateDuration(start_date, end_date, task);\r\n\t\t},\r\n\t\t_hasDuration: function (start_date, end_date, task) {\r\n\t\t\treturn timeCalculator.hasDuration(start_date, end_date, task);\r\n\t\t},\r\n\r\n\t\tcalculateEndDate: function (start, duration, unit, task) {\r\n\t\t\treturn timeCalculator.calculateEndDate(start, duration, unit, task);\r\n\t\t},\r\n\r\n\t\tmergeCalendars: utils.bind(calendarManager.mergeCalendars, calendarManager),\r\n\t\tcreateCalendar: utils.bind(calendarManager.createCalendar, calendarManager),\r\n\t\taddCalendar: utils.bind(calendarManager.addCalendar, calendarManager),\r\n\t\tgetCalendar: utils.bind(calendarManager.getCalendar, calendarManager),\r\n\t\tgetCalendars: utils.bind(calendarManager.getCalendars, calendarManager),\r\n\t\tgetResourceCalendar: utils.bind(calendarManager.getResourceCalendar, calendarManager),\r\n\t\tgetTaskCalendar: utils.bind(calendarManager.getTaskCalendar, calendarManager),\r\n\t\tdeleteCalendar: utils.bind(calendarManager.deleteCalendar, calendarManager)\r\n\t};\r\n};\r\n\r\n\r\nexport default { create: createWorkTimeFacade };","import CalendarManager from \"./calendar_manager\";\r\nimport TimeCalculator from \"./time_calculator\";\r\nimport worktimeFacadeFactory from \"../facades/worktime_calendars\";\r\nimport * as utils from \"../../utils/utils\";\r\n\r\nexport default function (gantt) {\r\n\tvar manager = new CalendarManager(gantt),\r\n\ttimeCalculator = new TimeCalculator(manager);\r\n\tvar facade = worktimeFacadeFactory.create(manager, timeCalculator);\r\n\tutils.mixin(gantt, facade);\r\n};\r\n","import * as helpers from \"../utils/helpers\";\r\n\r\nexport default function(gantt) {\r\n\r\n\tgantt.isUnscheduledTask = function (task) {\r\n\t\tgantt.assert(task && task instanceof Object, \"Invalid argument <b>task</b>=\"+task+\" of gantt.isUnscheduledTask. Task object was expected\");\r\n\t\treturn (!!task.unscheduled || !task.start_date);\r\n\t};\r\n\r\n\tgantt._isAllowedUnscheduledTask = function (task) {\r\n\t\treturn !!(task.unscheduled && gantt.config.show_unscheduled);\r\n\t};\r\n\r\n\tgantt._isTaskInTimelineLimits = function(task) {\r\n\t\tvar taskStart = task.start_date ? task.start_date.valueOf() : null;\r\n\t\tvar taskEnd = task.end_date ? task.end_date.valueOf() : null;\r\n\t\treturn !!(taskStart && taskEnd && taskStart <= this._max_date.valueOf() && taskEnd >= this._min_date.valueOf());\r\n\t};\r\n\tgantt.isTaskVisible = function (id) {\r\n\t\tif (!this.isTaskExists(id)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar task = this.getTask(id);\r\n\t\tif (!(this._isAllowedUnscheduledTask(task) || this._isTaskInTimelineLimits(task))) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn !!(this.getGlobalTaskIndex(id) >= 0);\r\n\t};\r\n\r\n\tgantt._getProjectEnd = function() {\r\n\t\tif(gantt.config.project_end){\r\n\t\t\treturn gantt.config.project_end;\r\n\t\t}else{\r\n\t\t\tvar tasks = gantt.getTaskByTime();\r\n\t\t\ttasks = tasks.sort(function (a, b) {\r\n\t\t\t\treturn +a.end_date > +b.end_date ? 1 : -1;\r\n\t\t\t});\r\n\t\t\treturn tasks.length ? tasks[tasks.length - 1].end_date : null;\r\n\t\t}\r\n\t};\r\n\tgantt._getProjectStart = function() {\r\n\t\tif (gantt.config.project_start) {\r\n\t\t\treturn gantt.config.project_start;\r\n\t\t}\r\n\r\n\t\t// use timeline start if project start is not specified\r\n\t\tif (gantt.config.start_date) {\r\n\t\t\treturn gantt.config.start_date;\r\n\t\t}\r\n\t\tif (gantt.getState().min_date) {\r\n\t\t\treturn gantt.getState().min_date;\r\n\t\t}\r\n\r\n\t\t// earliest task start if neither project start nor timeline are specified\r\n\t\tvar tasks = gantt.getTaskByTime();\r\n\t\ttasks = tasks.sort(function (a, b) {\r\n\t\t\treturn +a.start_date > +b.start_date ? 1 : -1;\r\n\t\t});\r\n\t\treturn tasks.length ? tasks[0].start_date : null;\r\n\t};\r\n\r\n\tvar getDefaultTaskDate = function (item, parent_id) {\r\n\t\tvar parentExists = parent_id && parent_id != gantt.config.root_id && gantt.isTaskExists(parent_id);\r\n\t\tvar parent = parentExists ? gantt.getTask(parent_id) : false,\r\n\t\t\tstartDate = null;\r\n\t\tif (parent) {\r\n\t\t\tif(gantt.config.schedule_from_end){\r\n\t\t\t\tstartDate = gantt.calculateEndDate({\r\n\t\t\t\t\tstart_date: parent.end_date,\r\n\t\t\t\t\tduration: - gantt.config.duration_step,\r\n\t\t\t\t\ttask:item\r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\tif(!parent.start_date){\r\n\t\t\t\t\treturn getDefaultTaskDate(parent, gantt.getParent(parent));\r\n\t\t\t\t}\r\n\t\t\t\tstartDate = parent.start_date;\r\n\t\t\t}\r\n\r\n\t\t} else if(gantt.config.schedule_from_end) {\r\n\t\t\tstartDate = gantt.calculateEndDate({\r\n\t\t\t\tstart_date: gantt._getProjectEnd(),\r\n\t\t\t\tduration: - gantt.config.duration_step,\r\n\t\t\t\ttask:item\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tconst first = gantt.getTaskByIndex(0);\r\n\t\t\tconst minDate = gantt.config.start_date || gantt.getState().min_date;\r\n\r\n\t\t\tif (first){\r\n\t\t\t\tif (first.start_date){\r\n\t\t\t\t\tstartDate = first.start_date;\r\n\t\t\t\t}\r\n\t\t\t\telse if (first.end_date){\r\n\t\t\t\t\tstartDate = gantt.calculateEndDate({\r\n\t\t\t\t\t\tstart_date: first.end_date,\r\n\t\t\t\t\t\tduration: -gantt.config.duration_step,\r\n\t\t\t\t\t\ttask:item\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tstartDate = minDate;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tstartDate = minDate;\r\n\t\t\t}\r\n\t\t}\r\n\t\tgantt.assert(startDate, \"Invalid dates\");\r\n\t\treturn new Date(startDate);\r\n\t};\r\n\r\n\tgantt._set_default_task_timing = function (task) {\r\n\t\ttask.start_date = task.start_date || getDefaultTaskDate(task, gantt.getParent(task));\r\n\t\ttask.duration = task.duration || gantt.config.duration_step;\r\n\t\ttask.end_date = task.end_date || gantt.calculateEndDate(task);\r\n\t};\r\n\r\n\tgantt.createTask = function (item, parent, index) {\r\n\t\titem = item || {};\r\n\r\n\t\tif (!gantt.defined(item.id))\r\n\t\t\titem.id = gantt.uid();\r\n\r\n\t\tif (!item.start_date) {\r\n\t\t\titem.start_date = getDefaultTaskDate(item, parent);\r\n\t\t}\r\n\t\tif (item.text === undefined) {\r\n\t\t\titem.text = gantt.locale.labels.new_task;\r\n\t\t}\r\n\t\tif (item.duration === undefined) {\r\n\t\t\titem.duration = 1;\r\n\t\t}\r\n\r\n\t\tif (this.isTaskExists(parent)) {\r\n\t\t\tthis.setParent(item, parent, true);\r\n\t\t\tvar parentObj = this.getTask(parent);\r\n\t\t\tparentObj.$open = true;\r\n\t\t\t// GS-1583. Save the $open state to the Undo Stack\r\n\t\t\tif (!this.config.details_on_create){\r\n\t\t\t\tthis.callEvent(\"onAfterParentExpand\", [parent, parentObj]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!this.callEvent(\"onTaskCreated\", [item])) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (this.config.details_on_create) {\r\n\t\t\t//GS-761: assert unique ID\r\n\t\t\tif (gantt.isTaskExists(item.id)){\r\n\t\t\t\tvar task = gantt.getTask(item.id);\r\n\t\t\t\tif (task.$index != item.$index) {\r\n\t\t\t\t\t// Someone may try to mistakenly add a task with the same ID, and most likely\r\n\t\t\t\t\t// use the string format for the dates. Gantt shouldn't break in this scenario\r\n\t\t\t\t\tif (item.start_date && typeof item.start_date === \"string\"){\r\n\t\t\t\t\t\titem.start_date = this.date.parseDate(item.start_date, \"parse_date\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (item.end_date && typeof item.end_date === \"string\"){\r\n\t\t\t\t\t\titem.end_date = this.date.parseDate(item.end_date, \"parse_date\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.$data.tasksStore.updateItem(item.id, item);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\titem.$new = true;\r\n\t\t\t\tthis.silent(function(){\r\n\t\t\t\t\tgantt.$data.tasksStore.addItem(item, index);\r\n\t\t\t\t});\t\r\n\t\t\t}\r\n\t\t\tthis.selectTask(item.id);\r\n\t\t\tthis.refreshData();\r\n\t\t\tthis.showLightbox(item.id);\r\n\t\t} else {\r\n\t\t\tif (this.addTask(item, parent, index)) {\r\n\t\t\t\tthis.showTask(item.id);\r\n\t\t\t\tthis.selectTask(item.id);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn item.id;\r\n\t};\r\n\r\n\tgantt._update_flags = function (oldid, newid) {\r\n\t\t//  TODO: need a proper way to update all possible flags\r\n\t\tvar store = gantt.$data.tasksStore;\r\n\t\tif (oldid === undefined) {\r\n\t\t\tthis._lightbox_id = null;\r\n\r\n\t\t\tstore.silent(function(){\r\n\t\t\t\tstore.unselect();\r\n\t\t\t});\r\n\t\t\t// GS-1522. If we have multiselect, unselect all previously selected tasks\r\n\t\t\tif (this.getSelectedTasks) {\r\n\t\t\t\tthis._multiselect.reset();\r\n\t\t\t}\r\n\r\n\t\t\tif (this._tasks_dnd && this._tasks_dnd.drag) {\r\n\t\t\t\tthis._tasks_dnd.drag.id = null;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (this._lightbox_id == oldid)\r\n\t\t\t\tthis._lightbox_id = newid;\r\n\r\n\t\t\t// TODO: probably can be removed\r\n\t\t\tif (store.getSelectedId() == oldid) {\r\n\t\t\t\tstore.silent(function(){\r\n\t\t\t\t\tstore.unselect(oldid);\r\n\t\t\t\t\tstore.select(newid);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif (this._tasks_dnd && this._tasks_dnd.drag && this._tasks_dnd.drag.id == oldid) {\r\n\t\t\t\tthis._tasks_dnd.drag.id = newid;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tvar getTaskTimingMode = function (task, force) {\r\n\t\tvar task_type = gantt.getTaskType(task.type);\r\n\r\n\t\tvar state = {\r\n\t\t\ttype: task_type,\r\n\t\t\t$no_start: false,\r\n\t\t\t$no_end: false,\r\n\t\t\tscheduled_summary: false\r\n\t\t};\r\n\r\n\t\tif(task_type === gantt.config.types.project && task.auto_scheduling === false){\r\n\t\t\tstate.scheduled_summary = true;\r\n\t\t}\r\n\r\n\t\tif (!force && task_type == task.$rendered_type) {\r\n\t\t\tstate.$no_start = task.$no_start;\r\n\t\t\tstate.$no_end = task.$no_end;\r\n\t\t\treturn state;\r\n\t\t}\r\n\r\n\t\tif (task_type == gantt.config.types.project) {\r\n\t\t\t//project duration is always defined by children duration\r\n\t\t\tstate.$no_end = state.$no_start = true;\r\n\t\t} else if (task_type != gantt.config.types.milestone) {\r\n\t\t\t//tasks can have fixed duration, children duration(as projects), or one date fixed, and other defined by nested items\r\n\t\t\tstate.$no_end = !(task.end_date || task.duration);\r\n\t\t\tstate.$no_start = !task.start_date;\r\n\r\n\t\t\tif (gantt._isAllowedUnscheduledTask(task)) {\r\n\t\t\t\tstate.$no_end = state.$no_start = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn state;\r\n\t};\r\n\r\n\tgantt._init_task_timing = function (task) {\r\n\t\tvar task_mode = getTaskTimingMode(task, true);\r\n\r\n\t\tvar dirty = task.$rendered_type != task_mode.type;\r\n\r\n\t\tvar task_type = task_mode.type;\r\n\r\n\t\tif (dirty) {\r\n\t\t\ttask.$no_start = task_mode.$no_start;\r\n\t\t\ttask.$no_end = task_mode.$no_end;\r\n\t\t\ttask.$rendered_type = task_mode.type;\r\n\t\t}\r\n\r\n\t\tif (dirty && task_type != this.config.types.milestone) {\r\n\t\t\tif (task_type == this.config.types.project) {\r\n\t\t\t\t//project duration is always defined by children duration\r\n\t\t\t\tthis._set_default_task_timing(task);\r\n\t\t\t\ttask.$calculate_duration = false;// do not recalculate duration below\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (task_type == this.config.types.milestone) {\r\n\t\t\ttask.end_date = task.start_date;\r\n\t\t}\r\n\t\tif (task.start_date && task.end_date && task.$calculate_duration !== false) {\r\n\t\t\ttask.duration = this.calculateDuration(task);\r\n\t\t}\r\n\r\n\t\tif(!task.$calculate_duration){\r\n\t\t\ttask.$calculate_duration = true;\r\n\t\t}\r\n\r\n\t\tif (!task.end_date) {\r\n\t\t\ttask.end_date = task.start_date;\r\n\t\t}\r\n\r\n\t\ttask.duration = task.duration || 0;\r\n\t\t// GS-1145. We should let tasks to have 0 duration if user wants it\r\n\t\tif (this.config.min_duration === 0 && task.duration === 0){\r\n\t\t\ttask.$no_end = false;\r\n\t\t}\r\n\r\n\t\t// work calendar of task has changed\r\n\t\tvar effectiveCalendar = this.getTaskCalendar(task);\r\n\t\tif(task.$effective_calendar && task.$effective_calendar !== effectiveCalendar.id){\r\n\t\t\tupdateTaskTiming(task);\r\n\t\t\tif(this.config.inherit_calendar && this.isSummaryTask(task)){\r\n\t\t\t\tthis.eachTask(function(child){\r\n\t\t\t\t\tupdateTaskTiming(child);\r\n\t\t\t\t}, task.id);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttask.$effective_calendar = effectiveCalendar.id;\r\n\t};\r\n\r\n\tfunction updateTaskTiming(task) {\r\n\t\ttask.$effective_calendar = gantt.getTaskCalendar(task).id;\r\n\t\ttask.start_date = gantt.getClosestWorkTime({\r\n\t\t\tdir: \"future\",\r\n\t\t\tdate: task.start_date,\r\n\t\t\tunit: gantt.config.duration_unit,\r\n\t\t\ttask: task\r\n\t\t});\r\n\t\ttask.end_date = gantt.calculateEndDate(task);\r\n\t}\r\n\r\n\tgantt.isSummaryTask = function (task) {\r\n\t\tgantt.assert(task && task instanceof Object, \"Invalid argument <b>task</b>=\"+task+\" of gantt.isSummaryTask. Task object was expected\");\r\n\r\n\t\tvar mode = getTaskTimingMode(task);\r\n\r\n\t\treturn !!(mode.$no_end || mode.$no_start);\r\n\t};\r\n\r\n// downward calculation of project duration\r\n\tgantt.resetProjectDates = function (task) {\r\n\t\tvar taskMode = getTaskTimingMode(task);\r\n\t\tif (taskMode.$no_end || taskMode.$no_start) {\r\n\t\t\tvar info = getSubtaskInfo(task.id);\r\n\t\t\tassignProjectDates.call(this, task, taskMode, info.start_date, info.end_date);\r\n\t\t\ttask.$rollup = info.rollup;\r\n\t\t}\r\n\t};\r\n\r\n\tfunction assignProjectDates(task, taskTiming, from, to) {\r\n\r\n\t\tconst summaryDateFields = {\r\n\t\t\tstart: \"start_date\",\r\n\t\t\tend: \"end_date\"\r\n\t\t};\r\n\t\tconst manuallyScheduledSummaryDateFields = {\r\n\t\t\tstart: \"$auto_start_date\",\r\n\t\t\tend: \"$auto_end_date\"\r\n\t\t};\r\n\r\n\t\tlet dateFields;\r\n\t\tif(task.type === gantt.config.types.project && task.auto_scheduling === false){\r\n\t\t\tdateFields = manuallyScheduledSummaryDateFields;\r\n\t\t}else{\r\n\t\t\tdateFields = summaryDateFields;\r\n\t\t}\r\n\r\n\t\tif (taskTiming.$no_start) {\r\n\t\t\tif (from) {\r\n\t\t\t\ttask[dateFields.start] = new Date(from);\r\n\t\t\t} else {\r\n\t\t\t\ttask[dateFields.start] = getDefaultTaskDate(task, this.getParent(task));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (taskTiming.$no_end) {\r\n\t\t\tif (to) {\r\n\t\t\t\ttask[dateFields.end] = new Date(to);\r\n\t\t\t} else {\r\n\t\t\t\ttask[dateFields.end] = this.calculateEndDate({\r\n\t\t\t\t\tstart_date: task[dateFields.start],\r\n\t\t\t\t\tduration: this.config.duration_step,\r\n\t\t\t\t\ttask: task\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (taskTiming.$no_start || taskTiming.$no_end) {\r\n\t\t\tthis._init_task_timing(task);\r\n\t\t}\r\n\t}\r\n\r\n\tgantt.getSubtaskDuration = function (taskId) {\r\n\t\tvar res = 0,\r\n\t\t\troot = taskId !== undefined ? taskId : gantt.config.root_id;\r\n\r\n\t\tthis.eachTask(function (child) {\r\n\t\t\tif (this.getTaskType(child.type) == gantt.config.types.project || this.isUnscheduledTask(child))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tres += child.duration;\r\n\t\t}, root);\r\n\r\n\t\treturn res;\r\n\t};\r\n\r\n\tfunction getSubtaskInfo (taskId){\r\n\t\tvar min = null,\r\n\t\t\tmax = null,\r\n\t\t\troot = taskId !== undefined ? taskId : gantt.config.root_id,\r\n\t\t\trollup = [];\r\n\r\n\t\tgantt.eachTask(function (child) {\r\n\t\t\tconst isScheduledSummary = (gantt.getTaskType(child.type) == gantt.config.types.project && (child.auto_scheduling === false));\r\n\t\t\tif ((gantt.getTaskType(child.type) == gantt.config.types.project && !isScheduledSummary) || gantt.isUnscheduledTask(child))\r\n\t\t\t\treturn;\r\n\t\t\t\r\n\t\t\tif(child.rollup){\r\n\t\t\t\trollup.push(child.id);\r\n\t\t\t}\r\n\r\n\t\t\tif ((child.start_date && (!child.$no_start || isScheduledSummary)) && (!min || min > child.start_date.valueOf()))\r\n\t\t\t\tmin = child.start_date.valueOf();\r\n\t\t\tif ((child.end_date && (!child.$no_end || isScheduledSummary)) && (!max || max < child.end_date.valueOf()))\r\n\t\t\t\tmax = child.end_date.valueOf();\r\n\t\t}, root);\r\n\r\n\t\treturn {\r\n\t\t\tstart_date: min ? new Date(min) : null,\r\n\t\t\tend_date: max ? new Date(max) : null,\r\n\t\t\trollup: rollup\r\n\t\t};\r\n\t}\r\n\r\n\tgantt.getSubtaskDates = function (task_id) {\r\n\t\tvar info = getSubtaskInfo(task_id);\r\n\t\treturn {\r\n\t\t\tstart_date: info.start_date,\r\n\t\t\tend_date: info.end_date\r\n\t\t};\r\n\t};\r\n\r\n\r\n// upward calculation of project duration\r\n\tgantt._update_parents = function (taskId, silent, updateAll) {\r\n\t\tif (!taskId) return;\r\n\r\n\t\tvar task = this.getTask(taskId);\r\n\t\tif(task.rollup){\r\n\t\t\tupdateAll = true;\r\n\t\t}\r\n\t\tvar pid = this.getParent(task);\r\n\r\n\t\tvar taskTiming = getTaskTimingMode(task);\r\n\r\n\t\tvar has_changed = true;\r\n\t\t// GS-761 the dates check is necessary for adding empty tasks: gantt.addTask({id:\"2\"})\r\n\t\tif (updateAll || (task.start_date && task.end_date && (taskTiming.$no_start || taskTiming.$no_end))) {\r\n\r\n\t\t\tconst startDateField = task.$auto_start_date ? \"$auto_start_date\" : \"start_date\";\r\n\t\t\tconst endDateField = task.$auto_end_date ? \"$auto_end_date\" : \"end_date\";\r\n\r\n\t\t\tvar oldStart = task[startDateField].valueOf(),\r\n\t\t\t\toldEnd = task[endDateField].valueOf();\r\n\r\n\t\t\tgantt.resetProjectDates(task);\r\n\r\n\t\t\t// not refresh parent projects if dates hasn't changed\r\n\t\t\tif (!updateAll && oldStart == task[startDateField].valueOf() && oldEnd == task[endDateField].valueOf()) {\r\n\t\t\t\thas_changed = false;\r\n\t\t\t}\r\n\r\n\t\t\tif (has_changed && !silent) {\r\n\t\t\t\tthis.refreshTask(task.id, true);\r\n\t\t\t}\r\n\r\n\t\t\tif(taskTiming.scheduled_summary){\r\n\t\t\t\thas_changed = true;//recalculate upwards from scheduled summaries\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tif (has_changed && pid && this.isTaskExists(pid)) {\r\n\t\t\tthis._update_parents(pid, silent, updateAll);\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.roundDate = function (config) {\r\n\t\tvar scale = gantt.getScale();\r\n\r\n\t\tif (helpers.isDate(config)) {\r\n\t\t\tconfig = {\r\n\t\t\t\tdate: config,\r\n\t\t\t\tunit: scale ? scale.unit : gantt.config.duration_unit,\r\n\t\t\t\tstep: scale ?  scale.step : gantt.config.duration_step\r\n\t\t\t};\r\n\t\t}\r\n\t\tvar date = config.date,\r\n\t\t\tsteps = config.step,\r\n\t\t\tunit = config.unit;\r\n\r\n\t\tif(!scale){\r\n\t\t\treturn date;\r\n\t\t}\r\n\r\n\t\tvar upper, lower, colIndex;\r\n\t\tif (unit == scale.unit && steps == scale.step &&\r\n\t\t\t+date >= +scale.min_date && +date <= +scale.max_date) {\r\n\t\t\t//find date in time scale config\r\n\t\t\tcolIndex = Math.floor(gantt.columnIndexByDate(date));\r\n\r\n\t\t\tif (!scale.trace_x[colIndex]) {\r\n\t\t\t\tcolIndex -= 1;// end of time scale\r\n\t\t\t\tif(scale.rtl){\r\n\t\t\t\t\tcolIndex = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlower = new Date(scale.trace_x[colIndex]);\r\n\t\t\tupper = gantt.date.add(lower, steps, unit);\r\n\t\t} else {\r\n\t\t\tcolIndex = Math.floor(gantt.columnIndexByDate(date));\r\n\r\n\t\t\tupper = gantt.date[unit + \"_start\"](new Date(scale.min_date));\r\n\t\t\tif (scale.trace_x[colIndex]) {\r\n\t\t\t\tupper = gantt.date[unit + \"_start\"](scale.trace_x[colIndex]);// end of time scale\r\n\t\t\t}\r\n\r\n\t\t\twhile (+upper < +date) {\r\n\t\t\t\tupper = gantt.date[unit + \"_start\"](gantt.date.add(upper, steps, unit));\r\n\r\n\t\t\t\tvar tzOffset = upper.getTimezoneOffset();\r\n\r\n\t\t\t\tupper = gantt._correct_dst_change(upper, tzOffset, upper, unit);\r\n\t\t\t\tif (gantt.date[unit + '_start'])\r\n\t\t\t\t\tupper = gantt.date[unit + '_start'](upper);\r\n\t\t\t}\r\n\r\n\t\t\tlower = gantt.date.add(upper, -1 * steps, unit);\r\n\r\n\t\t}\r\n\t\tif (config.dir && config.dir == 'future')\r\n\t\t\treturn upper;\r\n\t\tif (config.dir && config.dir == 'past')\r\n\t\t\treturn lower;\r\n\r\n\t\tif (Math.abs(date - lower) < Math.abs(upper - date)) {\r\n\t\t\treturn lower;\r\n\t\t} else {\r\n\t\t\treturn upper;\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tgantt.correctTaskWorkTime = function (task) {\r\n\t\tif (gantt.config.work_time && gantt.config.correct_work_time) {\r\n\t\t\tif (!this.isWorkTime(task.start_date, undefined, task)) {\r\n\t\t\t\ttask.start_date = this.getClosestWorkTime({date: task.start_date, dir: 'future', task: task});\r\n\t\t\t\ttask.end_date = this.calculateEndDate(task);\r\n\t\t\t} else if (!this.isWorkTime(new Date(+task.end_date - 1), undefined, task)) {\r\n\t\t\t\ttask.end_date = this.calculateEndDate(task);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.attachEvent(\"onBeforeTaskUpdate\", function (id, task) {\r\n\t\tgantt._init_task_timing(task);\r\n\t\treturn true;\r\n\t});\r\n\tgantt.attachEvent(\"onBeforeTaskAdd\", function (id, task) {\r\n\t\tgantt._init_task_timing(task);\r\n\t\treturn true;\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onAfterTaskMove\", function (id, parent, tindex) {\r\n\t\tgantt._init_task_timing(gantt.getTask(id));\r\n\t\treturn true;\r\n\t});\r\n\r\n};","export default function(gantt) {\r\n\r\n\tgantt.getTaskType = function (type) {\r\n\t\treturn \"task\";\r\n\t};\r\n};","/*\r\n reuse results of functions that can be recalculated during rendering\r\n greatly increases the rendering speed when critical path enabled\r\n Sample - 94_dev/critical_path.html\r\n\r\n */\r\nexport default function(gantt){\r\n\r\ngantt._cached_functions = {\r\n\tcache: {},\r\n\tmode: false,\r\n\tcritical_path_mode: false,\r\n\twrap_methods : function(methods, object){\r\n\t\tif(object._prefetch_originals){\r\n\t\t\tfor(var i in object._prefetch_originals){\r\n\t\t\t\tobject[i] = object._prefetch_originals[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\tobject._prefetch_originals = {};\r\n\t\tfor(var i = 0; i < methods.length; i++)\r\n\t\t\tthis.prefetch(methods[i], object);\r\n\r\n\t},\r\n\tprefetch : function(methodname, host){\r\n\t\tvar original = host[methodname];\r\n\t\tif(original){\r\n\t\t\tvar optimizer = this;\r\n\r\n\t\t\thost._prefetch_originals[methodname] = original;\r\n\t\t\thost[methodname] = function get_prefetched_value(){\r\n\r\n\t\t\t\tvar argumentsArray = new Array(arguments.length);\r\n\t\t\t\tfor (var i = 0, l = arguments.length; i < l; i++) {\r\n\t\t\t\t\targumentsArray[i] = arguments[i];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(optimizer.active){\r\n\t\t\t\t\tvar args = optimizer.get_arguments_hash(Array.prototype.slice.call(argumentsArray));\r\n\t\t\t\t\tif(!optimizer.cache[methodname]){\r\n\t\t\t\t\t\toptimizer.cache[methodname] = {};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar cached_values = optimizer.cache[methodname];\r\n\r\n\t\t\t\t\tif(optimizer.has_cached_value(cached_values, args)){\r\n\t\t\t\t\t\treturn optimizer.get_cached_value(cached_values, args);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tvar value = original.apply(this, argumentsArray);\r\n\t\t\t\t\t\toptimizer.cache_value(cached_values, args, value);\r\n\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn original.apply(this, argumentsArray);\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn original;\r\n\t},\r\n\tcache_value: function(cache, arguments_hash, value){\r\n\t\tif(this.is_date(value))\r\n\t\t\tvalue = new Date(value);\r\n\t\tcache[arguments_hash] = value;\r\n\t},\r\n\thas_cached_value: function(cache, arguments_hash){\r\n\t\treturn cache.hasOwnProperty(arguments_hash);\r\n\t},\r\n\tget_cached_value: function(cache, arguments_hash){\r\n\t\tvar data = cache[arguments_hash];\r\n\r\n\t\t//for cached dates - return copy\r\n\t\tif(this.is_date(data)){\r\n\t\t\tdata = new Date(data);\r\n\t\t}\r\n\t\treturn data;\r\n\t},\r\n\tis_date: function(value){\r\n\t\treturn (value && value.getUTCDate);\r\n\t},\r\n\tget_arguments_hash:function(args){\r\n\t\tvar values = [];\r\n\t\tfor(var i = 0; i < args.length; i++){\r\n\t\t\tvalues.push(this.stringify_argument(args[i]));\r\n\t\t}\r\n\t\treturn \"(\" + values.join(\";\") + \")\";\r\n\t},\r\n\tstringify_argument: function(value){\r\n\t\t//expecting task or link, or any other data entries, dates and primitive values\r\n\t\tvar ret = \"\";\r\n\t\tif(value.id){\r\n\t\t\tret = value.id;\r\n\t\t}else if(this.is_date(value)){\r\n\t\t\tret = value.valueOf();\r\n\t\t}else{\r\n\t\t\tret = value;\r\n\t\t}\r\n\t\treturn ret + \"\";\r\n\t},\r\n\tactivate: function(){\r\n\t\tthis.clear();\r\n\t\tthis.active = true;\r\n\t},\r\n\tdeactivate: function(){\r\n\t\tthis.clear();\r\n\t\tthis.active = false;\r\n\t},\r\n\tclear: function(){\r\n\t\tthis.cache = {};\r\n\t},\r\n\r\n\tsetup: function(gantt){\r\n\t\tvar override_gantt = [];\r\n\r\n\t\tvar gantt_methods  = [\r\n\t\t\t'_isProjectEnd',\r\n\t\t\t'_getProjectEnd',\r\n\t\t\t'_getSlack'\r\n\t\t];\r\n\r\n\r\n\r\n\t\tif(this.mode == 'auto'){\r\n\t\t\tif(gantt.config.highlight_critical_path){\r\n\t\t\t\toverride_gantt = gantt_methods;\r\n\t\t\t}\r\n\t\t}else if(this.mode === true){\r\n\t\t\toverride_gantt = gantt_methods;\r\n\t\t}\r\n\r\n\t\tthis.wrap_methods(override_gantt, gantt);\r\n\r\n\t},\r\n\tupdate_if_changed: function(gantt){\r\n\t\tvar changed = (this.critical_path_mode != gantt.config.highlight_critical_path ||\r\n\t\t\t\t\t\tthis.mode !== gantt.config.optimize_render);\r\n\t\tif(changed){\r\n\t\t\tthis.critical_path_mode = gantt.config.highlight_critical_path;\r\n\t\t\tthis.mode = gantt.config.optimize_render;\r\n\t\t\tthis.setup(gantt);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nfunction activate(){\r\n\tgantt._cached_functions.update_if_changed(gantt);\r\n\tif(!gantt._cached_functions.active){\r\n\t\tgantt._cached_functions.activate();\r\n\t}\r\n\treturn true;\r\n}\r\ngantt.attachEvent(\"onBeforeGanttRender\", activate);\r\ngantt.attachEvent(\"onBeforeDataRender\", activate);\r\ngantt.attachEvent(\"onBeforeSmartRender\",  function(){\r\n\tactivate();\r\n});\r\ngantt.attachEvent(\"onBeforeParse\", activate);\r\ngantt.attachEvent(\"onDataRender\", function(){\r\n\tgantt._cached_functions.deactivate();\r\n});\r\nvar deactivTimeout = null;\r\ngantt.attachEvent(\"onSmartRender\", function(){\r\n\tif(deactivTimeout)\r\n\t\tclearTimeout(deactivTimeout);\r\n\tdeactivTimeout = setTimeout(function(){\r\n\t\tgantt._cached_functions.deactivate();\r\n\t}, 1000);\r\n});\r\n\r\ngantt.attachEvent(\"onBeforeGanttReady\", function(){\r\n\tgantt._cached_functions.update_if_changed(gantt);\r\n\treturn true;\r\n});\r\n\r\n};","function addResizeListener(gantt){\r\n\tvar containerStyles = window.getComputedStyle(gantt.$root);\r\n\tif(containerStyles.getPropertyValue(\"position\") == \"static\"){\r\n\t\tgantt.$root.style.position = \"relative\";\r\n\t}\r\n\r\n\tvar resizeWatcher = document.createElement('iframe');\r\n\tresizeWatcher.className = \"gantt_container_resize_watcher\";\r\n\tresizeWatcher.tabIndex = -1;\r\n\tif(gantt.config.wai_aria_attributes){\r\n\t\tresizeWatcher.setAttribute(\"role\", \"none\");\r\n\t\tresizeWatcher.setAttribute(\"aria-hidden\", true);\r\n\t}\r\n\r\n\tvar salesforce_environment = !!window[\"Sfdc\"] || !!window[\"$A\"] || window[\"Aura\"];\r\n\tif (salesforce_environment){\r\n\t\tgantt.config.container_resize_method = \"timeout\";\r\n\t}\r\n\r\n\t// in some environments (namely, in SalesForce) iframe.contentWindow is not available\r\n\tgantt.$root.appendChild(resizeWatcher);\r\n\tif (resizeWatcher.contentWindow) {\r\n\t\tlistenWindowResize(gantt, resizeWatcher.contentWindow);\r\n\t} else {\r\n\t\t// if so - ditch the iframe and fallback to listening the main window resize\r\n\t\tgantt.$root.removeChild(resizeWatcher);\r\n\t\tlistenWindowResize(gantt, window);\r\n\t}\r\n}\r\n\r\nfunction listenWindowResize(gantt, window){\r\n\tvar resizeTimeout = gantt.config.container_resize_timeout || 20;\r\n\tvar resizeDelay;\r\n\tlet previousSize = getContainerSize(gantt);\r\n\r\n\tif (gantt.config.container_resize_method == \"timeout\"){\r\n\t\tlowlevelResizeWatcher();\r\n\t}\r\n\telse {\r\n\t\ttry {\r\n\t\t\tgantt.event(window, \"resize\", function () {\r\n\t\t\t\tif (gantt.$scrollbarRepaint) {\r\n\t\t\t\t\tgantt.$scrollbarRepaint = null;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// GS-2140. Don't repaint Gantt if it has the same sizes\r\n\t\t\t\t\tlet currentSize = getContainerSize(gantt);\r\n\t\t\t\t\tif (previousSize.x == currentSize.x && previousSize.y == currentSize.y){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpreviousSize = currentSize;\r\n\t\t\t\t\trepaintGantt();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tcatch (e) {\r\n\t\t\tlowlevelResizeWatcher();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction repaintGantt(){\r\n\t\tclearTimeout(resizeDelay);\r\n\t\tresizeDelay = setTimeout(function(){\r\n\t\t\tif(!gantt.$destroyed){\r\n\t\t\t\tgantt.render();\r\n\t\t\t}\r\n\t\t}, resizeTimeout);\r\n\t}\r\n\r\n\tvar previousHeight = gantt.$root.offsetHeight;\r\n\tvar previousWidth = gantt.$root.offsetWidth;\t\r\n\r\n\tfunction lowlevelResizeWatcher(){\r\n\t\tif (gantt.$root.offsetHeight != previousHeight ||\r\n\t\t\t\tgantt.$root.offsetWidth != previousWidth){\r\n\t\t\t\trepaintGantt();\r\n\t\t}\r\n\r\n\t\tpreviousHeight = gantt.$root.offsetHeight;\r\n\t\tpreviousWidth = gantt.$root.offsetWidth;\r\n\r\n\t\tsetTimeout(lowlevelResizeWatcher, resizeTimeout);\r\n\t}\r\n}\r\n\r\nfunction getContainerSize(gantt){\r\n\treturn {\r\n\t\tx: gantt.$root.offsetWidth,\r\n\t\ty: gantt.$root.offsetHeight\r\n\t};\r\n}\r\n\r\nexport default addResizeListener;","/*\r\n \tasserts will be removed in final code, so you can place them anythere\r\n\twithout caring about performance impacts\r\n*/\r\n\r\nexport default function(gantt){\r\n\treturn function assert(check, message){\r\n\t\tif (!check){\r\n\t\t\tif(gantt.config.show_errors && gantt.callEvent(\"onError\",[message]) !== false) {\r\n\t\t\t\tif (gantt.message) {\r\n\t\t\t\t\tgantt.message({type: \"error\", text: message, expire: -1});\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// eslint-disable-next-line\r\n\t\t\t\t\tconsole.log(message);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// eslint-disable-next-line no-debugger\r\n\t\t\t\tdebugger;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n};","import * as domHelpers from \"./ui/utils/dom_helpers\";\r\nimport * as helpers from \"../utils/helpers\";\r\nimport isHeadless from \"../utils/is_headless\";\r\nimport addResizeListener from \"./ui/resize_listener\";\r\nimport calculateScaleRange from \"./gantt_data_range\";\r\nimport assert from \"./common/assert\";\r\n\r\nexport default function(gantt){\r\n\t\r\n\r\n\tgantt.assert = assert(gantt);\r\n\r\n\tfunction isHTMLElement(node){\r\n\t\ttry {\r\n\t\t\tnode.cloneNode(false);\r\n\t\t}\r\n\t\tcatch (e){\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\tvar invalidContainerMessage = \"Invalid value of the first argument of `gantt.init`. Supported values: HTMLElement, String (element id).\" +\r\n\t\"This error means that either invalid object is passed into `gantt.init` or that the element with the specified ID doesn't exist on the page when `gantt.init` is called.\";\r\n\r\n\tfunction validateNode(node){\r\n\t\tif (!node || (typeof node == 'string' && document.getElementById(node))) return true;\r\n\t\tif (isHTMLElement(node)) return true;\r\n\r\n\t\tgantt.assert(false, invalidContainerMessage);\r\n\t\tthrow new Error(invalidContainerMessage);\r\n\t}\r\n\r\n//initial initialization\r\n\tgantt.init = function(node, from, to){\r\n\t\tif (gantt.env.isNode) { \r\n\t\t\tnode = null; // for the nodejs version\r\n\t\t} else {\r\n\t\t\tvalidateNode(node); // for the web version\r\n\t\t}\r\n\r\n\t\tif(from && to){\r\n\t\t\tthis.config.start_date = this._min_date = new Date(from);\r\n\t\t\tthis.config.end_date = this._max_date = new Date(to);\r\n\t\t}\r\n\t\tthis.date.init();\r\n\r\n\t\t//can be called only once\r\n\t\tthis.init = function(node){\r\n\t\t\tif (gantt.env.isNode) { \r\n\t\t\t\tnode = null; // for the nodejs version\r\n\t\t\t} else {\r\n\t\t\t\tvalidateNode(node); // for the web version\r\n\t\t\t}\r\n\r\n\t\t\tif (this.$container && this.$container.parentNode){\r\n\t\t\t\tthis.$container.parentNode.removeChild(this.$container);\r\n\t\t\t\tthis.$container = null;\r\n\t\t\t}\r\n\r\n\t\t\tif(this.$layout){\r\n\t\t\t\tthis.$layout.clear();\r\n\t\t\t}\r\n\t\t\tthis._reinit(node);\r\n\t\t};\r\n\t\tthis._reinit(node);\r\n\t};\r\n\r\n\tgantt._quickRefresh = function(code){\r\n\t\tvar stores = this._getDatastores.call(this);\r\n\t\tfor(var i = 0; i < stores.length; i++){\r\n\t\t\tstores[i]._quick_refresh = true;\r\n\t\t}\r\n\r\n\t\tcode();\r\n\r\n\t\tfor(var i = 0; i < stores.length; i++){\r\n\t\t\tstores[i]._quick_refresh = false;\r\n\t\t}\r\n\t};\r\n\r\n\tvar dropLayout = (function dropLayout(){\r\n\t\tif(this._clearTaskLayers){\r\n\t\t\tthis._clearTaskLayers();\r\n\t\t}\r\n\r\n\t\tif(this._clearLinkLayers){\r\n\t\t\tthis._clearLinkLayers();\r\n\t\t}\r\n\r\n\t\tif(this.$layout){\r\n\t\t\tthis.$layout.destructor();\r\n\t\t\tthis.$layout = null;\r\n\t\t\tthis.$ui.reset();\r\n\t\t}\r\n\t}).bind(gantt);\r\n\r\n\tvar rebuildLayout = (function rebuildLayout(){\r\n\t\tif(isHeadless(gantt)){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.$root.innerHTML = \"\";\r\n\r\n\t\tthis.$root.gantt = this;\r\n\t\tcalculateScaleRange(this);\r\n\t\tthis.config.layout.id = \"main\";\r\n\t\tthis.$layout = this.$ui.createView(\"layout\", this.$root, this.config.layout);\r\n\r\n\t\tthis.$layout.attachEvent(\"onBeforeResize\", function(){\r\n\t\t\tvar storeNames = gantt.$services.getService(\"datastores\");\r\n\t\t\tfor(var i = 0; i < storeNames.length; i++){\r\n\t\t\t\tgantt.getDatastore(storeNames[i]).filter();\r\n\t\t\t\tif (gantt.$data.tasksStore._skipTaskRecalculation){\r\n\t\t\t\t\t// do not repaint items, they will be repainted later in the onStoreUpdate event\r\n\t\t\t\t\tif (gantt.$data.tasksStore._skipTaskRecalculation != \"lightbox\"){\r\n\t\t\t\t\t\tgantt.$data.tasksStore._skipTaskRecalculation = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t} else {\r\n\t\t\t\t\tgantt.getDatastore(storeNames[i]).callEvent(\"onBeforeRefreshAll\", []);\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.$layout.attachEvent(\"onResize\", function(){\r\n\t\t\tgantt._quickRefresh(function(){\r\n\t\t\t\tgantt.refreshData();\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tthis.callEvent(\"onGanttLayoutReady\", []);\r\n\t\tthis.$layout.render();\r\n\r\n\t\tthis.$container = this.$layout.$container.firstChild;\r\n\r\n\t\taddResizeListener(this);\r\n\t}).bind(gantt);\r\n\r\n\tgantt.resetLayout = function(){\r\n\t\tdropLayout();\r\n\t\trebuildLayout();\r\n\t\tthis.render();\r\n\t};\r\n\r\n\tgantt._reinit = function(node){\r\n\t\tthis.callEvent(\"onBeforeGanttReady\", []);\r\n\t\tthis._update_flags();\r\n\r\n\t\tvar config = this.$services.getService(\"templateLoader\");\r\n\t\tconfig.initTemplates(this);\r\n\r\n\t\tdropLayout();\r\n\r\n\t\tthis.$root = null;\r\n\t\tif(node){\r\n\t\t\tthis.$root = domHelpers.toNode(node);\r\n\t\t\trebuildLayout();\r\n\t\t\tthis.$mouseEvents.reset(this.$root);\r\n\t\t\taddMinimalSizes(gantt);\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onTemplatesReady\",[]);\r\n\r\n\t\tthis.callEvent(\"onGanttReady\", []);\r\n\r\n\t\tthis.render();\r\n\t};\r\n\r\n\tfunction addMinimalSizes(gantt) {\r\n\t\tif (gantt.$container && !gantt.config.autosize) {\r\n\t\t\tif (gantt.$root.offsetHeight < 50) {\r\n\t\t\t\t// eslint-disable-next-line no-console\r\n\t\t\t\tconsole.warn(`The Gantt container has a small height, so you cannot see its content. If it is not intended, you need to set the 'height' style rule to the container:\r\nhttps://docs.dhtmlx.com/gantt/faq.html#theganttchartisntrenderedcorrectly`);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgantt.$click={\r\n\t\tbuttons:{\r\n\t\t\t\"edit\": function(id) {\r\n\t\t\t\tif (gantt.isReadonly(gantt.getTask(id))) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tgantt.showLightbox(id);\r\n\t\t\t},\r\n\t\t\t\"delete\": function(id) {\r\n\t\t\t\tvar task = gantt.getTask(id);\r\n\t\t\t\tif (gantt.isReadonly(task)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar question = gantt.locale.labels.confirm_deleting;\r\n\t\t\t\tvar title = gantt.locale.labels.confirm_deleting_title;\r\n\r\n\t\t\t\tgantt._simple_confirm(question, title, function(){\r\n\t\t\t\t\tif(!gantt.isTaskExists(id)){\r\n\t\t\t\t\t\tgantt.hideLightbox();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(task.$new){\r\n\t\t\t\t\t\t// GS-2170. Do not recalculate the indexes and dates of other tasks\r\n\t\t\t\t\t\t// as they will be recalculated in the `refreshData`\r\n\t\t\t\t\t\tgantt.$data.tasksStore._skipTaskRecalculation = \"lightbox\";\r\n\t\t\t\t\t\tgantt.silent(function(){\r\n\t\t\t\t\t\t\tgantt.deleteTask(id, true);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tgantt.$data.tasksStore._skipTaskRecalculation = false;\r\n\t\t\t\t\t\tgantt.refreshData();\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tgantt.$data.tasksStore._skipTaskRecalculation = true;\r\n\t\t\t\t\t\tgantt.deleteTask(id);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tgantt.hideLightbox();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n//renders self\r\n\tgantt.render = function(){\r\n\t\tthis.callEvent(\"onBeforeGanttRender\", []);\r\n\r\n\t\tvar visibleDate;\r\n\t\tif(!isHeadless(gantt)){\r\n\t\t\tif (!this.config.sort && this._sort) {\r\n\t\t\t\tthis._sort = undefined;\r\n\t\t\t}\r\n\r\n\t\t\tif(this.$root){\r\n\t\t\t\tif(this.config.rtl){\r\n\t\t\t\t\tthis.$root.classList.add(\"gantt_rtl\");\r\n\t\t\t\t\tthis.$root.firstChild.classList.add(\"gantt_rtl\"); // GS-1499\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.$root.classList.remove(\"gantt_rtl\");\r\n\t\t\t\t\tthis.$root.firstChild.classList.remove(\"gantt_rtl\"); // GS-1499\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar pos = this.getScrollState();\r\n\t\t\tvar posX = pos ? pos.x : 0;\r\n\t\t\tif(this._getHorizontalScrollbar()){\r\n\t\t\t\tvar scrollbar = this._getHorizontalScrollbar();\r\n\t\t\t\tposX = scrollbar.$config.codeScrollLeft || posX || 0;\r\n\t\t\t}\r\n\r\n\r\n\t\t\tvisibleDate = null;\r\n\t\t\tif(posX){\r\n\t\t\t\tvisibleDate = gantt.dateFromPos(posX + this.config.task_scroll_offset);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcalculateScaleRange(this);\r\n\r\n\t\tif(!isHeadless(gantt)){\r\n\t\t\tthis.$layout.$config.autosize = this.config.autosize;\r\n\t\t\tvar preserveScroll = this.config.preserve_scroll;\r\n\t\t\tthis.config.preserve_scroll = false; // prevent scrolling from layout resize, scroll will be called here later on\r\n\t\t\tthis.$layout.resize();\r\n\t\t\tthis.config.preserve_scroll = preserveScroll;\r\n\r\n\t\t\tif(this.config.preserve_scroll && pos){\r\n\r\n\t\t\t\t// GS-1640: We need pos.y, otherwise part of the timeline won't be rendered if the scrollbar disappeared\r\n\t\t\t\tif (posX || pos.y) {\r\n\t\t\t\t\tvar new_pos = gantt.getScrollState();\r\n\t\t\t\t\tvar new_date = gantt.dateFromPos(new_pos.x);\r\n\t\t\t\t\tif(!(+visibleDate == +new_date && new_pos.y == pos.y)){\r\n\t\t\t\t\t\tvar posX = null;\r\n\t\t\t\t\t\tvar posY = null;\r\n\t\t\t\t\t\tif(visibleDate){\r\n\t\t\t\t\t\t\tvar posX = Math.max(gantt.posFromDate(visibleDate) - gantt.config.task_scroll_offset, 0);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(pos.y){\r\n\t\t\t\t\t\t\tposY = pos.y;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tgantt.scrollTo(posX, posY);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// GS-1640: We need to reset the scroll position for the grid if the scrollbar disappeared and\r\n\t\t\t\t// the grid and timeline have different scrollbars\r\n\t\t\t\t// GS-2718: if we have resources and two verticall scrollbars for tasks timeline and resource timeline\r\n\t\t\t\t// we don't get the scroll state of the resource timeline\r\n\t\t\t\tconst scrollbarsInfo = this.$layout.getScrollbarsInfo();\r\n\t\t\t\tscrollbarsInfo.forEach((scroll_info) => {\r\n\t\t\t\t\tconst scroll = gantt.$ui.getView(scroll_info.id);\r\n\t\t\t\t\tconst scrollbarNodeVisible = gantt.utils.dom.isChildOf(scroll.$view, gantt.$container);\r\n\t\t\t\t\tscroll_info.boundViews.forEach((viewName) => {\r\n\t\t\t\t\t\tconst view = gantt.$ui.getView(viewName);\r\n\t\t\t\t\t\tif(scroll_info.y && scroll_info.y != pos.y){\r\n\t\t\t\t\t\t\tif(view && !scrollbarNodeVisible){\r\n\t\t\t\t\t\t\t\tview.scrollTo(undefined, 0);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//GS-2586: take into account the horizontal scroll of the resource timeline\r\n\t\t\t\t\t\tif(scroll_info.x_pos && scroll_info.x_pos != pos.x){\r\n\t\t\t\t\t\t\tif(view && scrollbarNodeVisible){\r\n\t\t\t\t\t\t\t\tview.scrollTo(scroll_info.x_pos, undefined);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t}else{\r\n\t\t\tgantt.refreshData();\r\n\t\t}\r\n\t\tthis.callEvent(\"onGanttRender\", []);\r\n\t};\r\n\r\n\t//TODO: add layout.resize method that wouldn't trigger data repaint\r\n\tgantt.setSizes = gantt.render;\r\n\r\n\r\n\tgantt.getTaskRowNode = function(id) {\r\n\t\tvar els = this.$grid_data.childNodes;\r\n\t\tvar attribute = this.config.task_attribute;\r\n\t\tfor (var i = 0; i < els.length; i++) {\r\n\t\t\tif (els[i].getAttribute) {\r\n\t\t\t\tvar value = els[i].getAttribute(attribute);\r\n\t\t\t\tif (value == id) return els[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t};\r\n\r\n\tgantt.changeLightboxType = function(type){\r\n\t\tif(this.getLightboxType() == type)\r\n\t\t\treturn true;\r\n\t\tgantt._silent_redraw_lightbox(type);\r\n\t};\r\n\r\n\tgantt._get_link_type = function (from_start, to_start) {\r\n\t\tvar type = null;\r\n\t\tif (from_start && to_start) {\r\n\t\t\ttype = gantt.config.links.start_to_start;\r\n\t\t} else if (!from_start && to_start) {\r\n\t\t\ttype = gantt.config.links.finish_to_start;\r\n\t\t} else if (!from_start && !to_start) {\r\n\t\t\ttype = gantt.config.links.finish_to_finish;\r\n\t\t} else if (from_start && !to_start) {\r\n\t\t\ttype = gantt.config.links.start_to_finish;\r\n\t\t}\r\n\t\treturn type;\r\n\t};\r\n\r\n\tgantt.isLinkAllowed = function (from, to, from_start, to_start) {\r\n\t\tvar link = null;\r\n\t\tif (typeof(from) == \"object\") {\r\n\t\t\tlink = from;\r\n\t\t} else {\r\n\t\t\tlink = {source: from, target: to, type: this._get_link_type(from_start, to_start)};\r\n\t\t}\r\n\r\n\t\tif (!link) return false;\r\n\t\tif (!(link.source && link.target && link.type)) return false;\r\n\t\tif (link.source == link.target) return false;\r\n\r\n\t\tvar res = true;\r\n\t\t//any custom rules\r\n\t\tif (this.checkEvent(\"onLinkValidation\"))\r\n\t\t\tres = this.callEvent(\"onLinkValidation\", [link]);\r\n\r\n\t\treturn res;\r\n\t};\r\n\r\n\r\n\tgantt._correct_dst_change = function(date, prevOffset, step, unit){\r\n\t\tvar time_unit = helpers.getSecondsInUnit(unit) * step;\r\n\t\tif(time_unit > 60*60 && time_unit < 60*60*24){\r\n\t\t\t//correct dst change only if current unit is more than one hour and less than day (days have own checking), e.g. 12h\r\n\t\t\tvar offsetChanged = date.getTimezoneOffset() - prevOffset;\r\n\t\t\tif(offsetChanged){\r\n\t\t\t\tdate = gantt.date.add(date, offsetChanged, \"minute\");\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn date;\r\n\t};\r\n\r\n\tgantt.isSplitTask = function(task){\r\n\t\tgantt.assert(task && task instanceof Object, \"Invalid argument <b>task</b>=\"+task+\" of gantt.isSplitTask. Task object was expected\");\r\n\t\treturn this.$data.tasksStore._isSplitItem(task);\r\n\t};\r\n\r\n\tgantt._is_icon_open_click = function(e) {\r\n\t\tif (!e)\r\n\t\t\treturn false;\r\n\t\tvar target = e.target || e.srcElement;\r\n\t\tif (!(target && target.className))\r\n\t\t\treturn false;\r\n\t\tvar className = domHelpers.getClassName(target);\r\n\t\tif (className.indexOf(\"gantt_tree_icon\") !== -1 && (className.indexOf(\"gantt_close\") !== -1 || className.indexOf(\"gantt_open\") !== -1))\r\n\t\t\treturn true;\r\n\t\treturn false;\r\n\t};\r\n\r\n};","function extend(gantt){\r\n\r\n\tgantt.destructor = function(){\r\n\t\tthis.clearAll();\r\n\t\tthis.callEvent(\"onDestroy\", []);\r\n\r\n\t\tif(this.$root){\r\n\t\t\tdelete this.$root.gantt;\r\n\t\t}\r\n\r\n\t\tif(this._eventRemoveAll){\r\n\t\t\tthis._eventRemoveAll();\r\n\t\t}\r\n\r\n\t\tif(this.$layout){\r\n\t\t\tthis.$layout.destructor();\r\n\t\t}\r\n\r\n\t\tif(this.resetLightbox){\r\n\t\t\tthis.resetLightbox();\r\n\t\t}\r\n\r\n\t\t// GS-99. Call this here to detach the events\r\n\t\tif (this.ext.inlineEditors) {\r\n\t\t\tthis.ext.inlineEditors.destructor();\r\n\t\t}\r\n\r\n\t\tif(this._dp && this._dp.destructor){\r\n\t\t\tthis._dp.destructor();\r\n\t\t}\r\n\t\tthis.$services.destructor();\r\n\r\n\t\t// detachAllEvents should be called last, because in components may be attached events\r\n\t\tthis.detachAllEvents();\r\n\r\n\t\tfor(var i in this){\r\n\t\t\tif(i.indexOf(\"$\") === 0){\r\n\t\t\t\tdelete this[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.$destroyed = true;\r\n\t};\r\n}\r\n\r\nexport default extend;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"كانون الثاني\", \"شباط\", \"آذار\", \"نيسان\", \"أيار\", \"حزيران\", \"تموز\", \"آب\", \"أيلول\", \"تشرين الأول\", \"تشرين الثاني\", \"كانون الأول\"],\r\n\t\tmonth_short: [\"يناير\", \"فبراير\", \"مارس\", \"أبريل\", \"مايو\", \"يونيو\", \"يوليو\", \"أغسطس\", \"سبتمبر\", \"أكتوبر\", \"نوفمبر\", \"ديسمبر\"],\r\n\t\tday_full: [\"الأحد\", \"الأثنين\", \"ألثلاثاء\", \"الأربعاء\", \"ألحميس\", \"ألجمعة\", \"السبت\"],\r\n\t\tday_short: [\"احد\", \"اثنين\", \"ثلاثاء\", \"اربعاء\", \"خميس\", \"جمعة\", \"سبت\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"مهمة جديد\",\r\n\t\ticon_save: \"اخزن\",\r\n\t\ticon_cancel: \"الغاء\",\r\n\t\ticon_details: \"تفاصيل\",\r\n\t\ticon_edit: \"تحرير\",\r\n\t\ticon_delete: \"حذف\",\r\n\t\tconfirm_closing: \"التغييرات سوف تضيع, هل انت متأكد؟\", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"الحدث سيتم حذفها نهائيا ، هل أنت متأكد؟\",\r\n\t\tsection_description: \"الوصف\",\r\n\t\tsection_time: \"الفترة الزمنية\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"الغاء\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Студзень\", \"Люты\", \"Сакавік\", \"Красавік\", \"Maй\", \"Чэрвень\", \"Ліпень\", \"Жнівень\", \"Верасень\", \"Кастрычнік\", \"Лістапад\", \"Снежань\"],\r\n\t\tmonth_short: [\"Студз\", \"Лют\", \"Сак\", \"Крас\", \"Maй\", \"Чэр\", \"Ліп\", \"Жнів\", \"Вер\", \"Каст\", \"Ліст\", \"Снеж\"],\r\n\t\tday_full: [\"Нядзеля\", \"Панядзелак\", \"Аўторак\", \"Серада\", \"Чацвер\", \"Пятніца\", \"Субота\"],\r\n\t\tday_short: [\"Нд\", \"Пн\", \"Аўт\", \"Ср\", \"Чцв\", \"Пт\", \"Сб\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Новае заданне\",\r\n\t\ticon_save: \"Захаваць\",\r\n\t\ticon_cancel: \"Адмяніць\",\r\n\t\ticon_details: \"Дэталі\",\r\n\t\ticon_edit: \"Змяніць\",\r\n\t\ticon_delete: \"Выдаліць\",\r\n\t\tconfirm_closing: \"\", // Унесеныя змены будуць страчаны, працягнуць?\r\n\t\tconfirm_deleting: \"Падзея будзе выдалена незваротна, працягнуць?\",\r\n\t\tsection_description: \"Апісанне\",\r\n\t\tsection_time: \"Перыяд часу\",\r\n\t\tsection_type: \"Тып\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"ІСР\",\r\n\t\tcolumn_text: \"Задача\",\r\n\t\tcolumn_start_date: \"Пачатак\",\r\n\t\tcolumn_duration: \"Працяг\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Сувязь\",\r\n\t\tconfirm_link_deleting: \"будзе выдалена\",\r\n\t\tlink_start: \"(пачатак)\",\r\n\t\tlink_end: \"(канец)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Хвiлiна\",\r\n\t\thours: \"Гадзiна\",\r\n\t\tdays: \"Дзень\",\r\n\t\tweeks: \"Тыдзень\",\r\n\t\tmonths: \"Месяц\",\r\n\t\tyears: \"Год\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Адмяніць\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n @Traducido por Vicente Adria Bohigues - vicenteadria@hotmail.com\r\n */\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Gener\", \"Febrer\", \"Març\", \"Abril\", \"Maig\", \"Juny\", \"Juliol\", \"Agost\", \"Setembre\", \"Octubre\", \"Novembre\", \"Desembre\"],\r\n\t\tmonth_short: [\"Gen\", \"Feb\", \"Mar\", \"Abr\", \"Mai\", \"Jun\", \"Jul\", \"Ago\", \"Set\", \"Oct\", \"Nov\", \"Des\"],\r\n\t\tday_full: [\"Diumenge\", \"Dilluns\", \"Dimarts\", \"Dimecres\", \"Dijous\", \"Divendres\", \"Dissabte\"],\r\n\t\tday_short: [\"Dg\", \"Dl\", \"Dm\", \"Dc\", \"Dj\", \"Dv\", \"Ds\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nova tasca\",\r\n\t\ticon_save: \"Guardar\",\r\n\t\ticon_cancel: \"Cancel·lar\",\r\n\t\ticon_details: \"Detalls\",\r\n\t\ticon_edit: \"Editar\",\r\n\t\ticon_delete: \"Esborrar\",\r\n\t\tconfirm_closing: \"\", // \"Els seus canvis es perdràn, continuar ?\"\r\n\t\tconfirm_deleting: \"L'esdeveniment s'esborrarà definitivament, continuar ?\",\r\n\t\tsection_description: \"Descripció\",\r\n\t\tsection_time: \"Periode de temps\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Cancel·lar\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\nTranslation by FreezeSoul\r\n\r\nUpdate 26/10/2015:\r\nTranslation of new labels by zwh8800\r\n https://github.com/DHTMLX/gantt/pull/7\r\n\r\n*/\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"一月\", \"二月\", \"三月\", \"四月\", \"五月\", \"六月\", \"七月\", \"八月\", \"九月\", \"十月\", \"十一月\", \"十二月\"],\r\n\t\tmonth_short: [\"1月\", \"2月\", \"3月\", \"4月\", \"5月\", \"6月\", \"7月\", \"8月\", \"9月\", \"10月\", \"11月\", \"12月\"],\r\n\t\tday_full: [\"星期日\", \"星期一\", \"星期二\", \"星期三\", \"星期四\", \"星期五\", \"星期六\"],\r\n\t\tday_short: [\"日\", \"一\", \"二\", \"三\", \"四\", \"五\", \"六\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"新任務\",\r\n\t\ticon_save: \"保存\",\r\n\t\ticon_cancel: \"关闭\",\r\n\t\ticon_details: \"详细\",\r\n\t\ticon_edit: \"编辑\",\r\n\t\ticon_delete: \"删除\",\r\n\t\tconfirm_closing: \"请确认是否撤销修改!\", // Your changes will be lost, are your sure?\r\n\t\tconfirm_deleting: \"是否删除日程?\",\r\n\t\tsection_description: \"描述\",\r\n\t\tsection_time: \"时间范围\",\r\n\t\tsection_type: \"类型\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"工作分解结构\",\r\n\t\tcolumn_text: \"任务名\",\r\n\t\tcolumn_start_date: \"开始时间\",\r\n\t\tcolumn_duration: \"持续时间\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\r\n\t\tlink: \"关联\",\r\n\t\tconfirm_link_deleting: \"将被删除\",\r\n\t\tlink_start: \" (开始)\",\r\n\t\tlink_end: \" (结束)\",\r\n\r\n\t\ttype_task: \"任务\",\r\n\t\ttype_project: \"项目\",\r\n\t\ttype_milestone: \"里程碑\",\r\n\r\n\t\tminutes: \"分钟\",\r\n\t\thours: \"小时\",\r\n\t\tdays: \"天\",\r\n\t\tweeks: \"周\",\r\n\t\tmonths: \"月\",\r\n\t\tyears: \"年\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"关闭\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Leden\", \"Únor\", \"Březen\", \"Duben\", \"Květen\", \"Červen\", \"Červenec\", \"Srpen\", \"Září\", \"Říjen\", \"Listopad\", \"Prosinec\"],\r\n\t\tmonth_short: [\"Led\", \"Ún\", \"Bře\", \"Dub\", \"Kvě\", \"Čer\", \"Čec\", \"Srp\", \"Září\", \"Říj\", \"List\", \"Pro\"],\r\n\t\tday_full: [\"Neděle\", \"Pondělí\", \"Úterý\", \"Středa\", \"Čtvrtek\", \"Pátek\", \"Sobota\"],\r\n\t\tday_short: [\"Ne\", \"Po\", \"Út\", \"St\", \"Čt\", \"Pá\", \"So\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nová práce\",\r\n\t\ticon_save: \"Uložit\",\r\n\t\ticon_cancel: \"Zpět\",\r\n\t\ticon_details: \"Detail\",\r\n\t\ticon_edit: \"Edituj\",\r\n\t\ticon_delete: \"Smazat\",\r\n\t\tconfirm_closing: \"\", // Vaše změny budou ztraceny, opravdu ?\r\n\t\tconfirm_deleting: \"Událost bude trvale smazána, opravdu?\",\r\n\t\tsection_description: \"Poznámky\",\r\n\t\tsection_time: \"Doba platnosti\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Zpět\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Januar\", \"Februar\", \"Marts\", \"April\", \"Maj\", \"Juni\", \"Juli\", \"August\", \"September\", \"Oktober\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Maj\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Søndag\", \"Mandag\", \"Tirsdag\", \"Onsdag\", \"Torsdag\", \"Fredag\", \"Lørdag\"],\r\n\t\tday_short: [\"Søn\", \"Man\", \"Tir\", \"Ons\", \"Tor\", \"Fre\", \"Lør\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Ny opgave\",\r\n\t\ticon_save: \"Gem\",\r\n\t\ticon_cancel: \"Fortryd\",\r\n\t\ticon_details: \"Detaljer\",\r\n\t\ticon_edit: \"Tilret\",\r\n\t\ticon_delete: \"Slet\",\r\n\t\tconfirm_closing: \"Dine rettelser vil gå tabt.. Er dy sikker?\", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"Bigivenheden vil blive slettet permanent. Er du sikker?\",\r\n\t\tsection_description: \"Beskrivelse\",\r\n\t\tsection_time: \"Tidsperiode\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Fortryd\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\" Januar\", \" Februar\", \" März \", \" April\", \" Mai\", \" Juni\", \" Juli\", \" August\", \" September \", \" Oktober\", \" November \", \" Dezember\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mär\", \"Apr\", \"Mai\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dez\"],\r\n\t\tday_full: [\"Sonntag\", \"Montag\", \"Dienstag\", \" Mittwoch\", \" Donnerstag\", \"Freitag\", \"Samstag\"],\r\n\t\tday_short: [\"So\", \"Mo\", \"Di\", \"Mi\", \"Do\", \"Fr\", \"Sa\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Neue Aufgabe\",\r\n\t\ticon_save: \"Speichern\",\r\n\t\ticon_cancel: \"Abbrechen\",\r\n\t\ticon_details: \"Details\",\r\n\t\ticon_edit: \"Ändern\",\r\n\t\ticon_delete: \"Löschen\",\r\n\t\tconfirm_closing: \"\", // \"Ihre Veränderungen werden verloren sein, wollen Sie ergänzen? \"\r\n\t\tconfirm_deleting: \"Der Eintrag wird gelöscht\",\r\n\t\tsection_description: \"Beschreibung\",\r\n\t\tsection_time: \"Zeitspanne\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"PSP\",\r\n\t\tcolumn_text: \"Task-Namen\",\r\n\t\tcolumn_start_date: \"Startzeit\",\r\n\t\tcolumn_duration: \"Dauer\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"werden gelöscht\",\r\n\t\tlink_start: \"(starten)\",\r\n\t\tlink_end: \"(ende)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minuten\",\r\n\t\thours: \"Stunden\",\r\n\t\tdays: \"Tage\",\r\n\t\tweeks: \"Wochen\",\r\n\t\tmonths: \"Monate\",\r\n\t\tyears: \"Jahre\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Abbrechen\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Regel\",\r\n\t\tconstraint_type: \"Regel\",\r\n\t\tconstraint_date: \"Regel - Datum\",\r\n\t\tasap: \"So bald wie möglich\",\r\n\t\talap: \"So spät wie möglich\",\r\n\t\tsnet: \"Beginn nicht vor\",\r\n\t\tsnlt: \"Beginn nicht später als\",\r\n\t\tfnet: \"Fertigstellung nicht vor\",\r\n\t\tfnlt: \"Fertigstellung nicht später als\",\r\n\t\tmso: \"Muss beginnen am\",\r\n\t\tmfo: \"Muss fertig sein am\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Ιανουάριος\", \"Φεβρουάριος\", \"Μάρτιος\", \"Απρίλιος\", \"Μάϊος\", \"Ιούνιος\", \"Ιούλιος\", \"Αύγουστος\", \"Σεπτέμβριος\", \"Οκτώβριος\", \"Νοέμβριος\", \"Δεκέμβριος\"],\r\n\t\tmonth_short: [\"ΙΑΝ\", \"ΦΕΒ\", \"ΜΑΡ\", \"ΑΠΡ\", \"ΜΑΙ\", \"ΙΟΥΝ\", \"ΙΟΥΛ\", \"ΑΥΓ\", \"ΣΕΠ\", \"ΟΚΤ\", \"ΝΟΕ\", \"ΔΕΚ\"],\r\n\t\tday_full: [\"Κυριακή\", \"Δευτέρα\", \"Τρίτη\", \"Τετάρτη\", \"Πέμπτη\", \"Παρασκευή\", \"Κυριακή\"],\r\n\t\tday_short: [\"ΚΥ\", \"ΔΕ\", \"ΤΡ\", \"ΤΕ\", \"ΠΕ\", \"ΠΑ\", \"ΣΑ\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Νέα εργασία\",\r\n\t\ticon_save: \"Αποθήκευση\",\r\n\t\ticon_cancel: \"Άκυρο\",\r\n\t\ticon_details: \"Λεπτομέρειες\",\r\n\t\ticon_edit: \"Επεξεργασία\",\r\n\t\ticon_delete: \"Διαγραφή\",\r\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"Το έργο θα διαγραφεί οριστικά. Θέλετε να συνεχίσετε;\",\r\n\t\tsection_description: \"Περιγραφή\",\r\n\t\tsection_time: \"Χρονική περίοδος\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Άκυρο\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"],\r\n\t\tday_short: [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"New task\",\r\n\t\ticon_save: \"Save\",\r\n\t\ticon_cancel: \"Cancel\",\r\n\t\ticon_details: \"Details\",\r\n\t\ticon_edit: \"Edit\",\r\n\t\ticon_delete: \"Delete\",\r\n\t\tconfirm_closing: \"\",// Your changes will be lost, are you sure?\r\n\t\tconfirm_deleting: \"Task will be deleted permanently, are you sure?\",\r\n\t\tsection_description: \"Description\",\r\n\t\tsection_time: \"Time period\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\r\n\t\t/* grid columns */\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Cancel\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;","/*\r\n @Autor Manuel Fernandez Panzuela - www.mfernandez.es\r\n\r\n Update 30/10/2015:\r\n Translation of new labels by Jorge Macias\r\n https://disqus.com/by/disqus_bTuZk1voC7/\r\n */\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Enero\", \"Febrero\", \"Marzo\", \"Abril\", \"Mayo\", \"Junio\", \"Julio\", \"Agosto\", \"Septiembre\", \"Octubre\", \"Noviembre\", \"Diciembre\"],\r\n\t\tmonth_short: [\"Ene\", \"Feb\", \"Mar\", \"Abr\", \"May\", \"Jun\", \"Jul\", \"Ago\", \"Sep\", \"Oct\", \"Nov\", \"Dic\"],\r\n\t\tday_full: [\"Domingo\", \"Lunes\", \"Martes\", \"Miércoles\", \"Jueves\", \"Viernes\", \"Sábado\"],\r\n\t\tday_short: [\"Dom\", \"Lun\", \"Mar\", \"Mié\", \"Jue\", \"Vie\", \"Sáb\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nueva tarea\",\r\n\t\ticon_save: \"Guardar\",\r\n\t\ticon_cancel: \"Cancelar\",\r\n\t\ticon_details: \"Detalles\",\r\n\t\ticon_edit: \"Editar\",\r\n\t\ticon_delete: \"Eliminar\",\r\n\t\tconfirm_closing: \"\", // \"Sus cambios se perderán, continuar ?\"\r\n\t\tconfirm_deleting: \"El evento se borrará definitivamente, ¿continuar?\",\r\n\t\tsection_description: \"Descripción\",\r\n\t\tsection_time: \"Período\",\r\n\t\tsection_type: \"Tipo\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"EDT\",\r\n\t\tcolumn_text: \"Tarea\",\r\n\t\tcolumn_start_date: \"Inicio\",\r\n\t\tcolumn_duration: \"Duración\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Enlace\",\r\n\t\tconfirm_link_deleting: \"será borrada\",\r\n\t\tlink_start: \" (inicio)\",\r\n\t\tlink_end: \" (fin)\",\r\n\r\n\t\ttype_task: \"Tarea\",\r\n\t\ttype_project: \"Proyecto\",\r\n\t\ttype_milestone: \"Hito\",\r\n\r\n\r\n\t\tminutes: \"Minutos\",\r\n\t\thours: \"Horas\",\r\n\t\tdays: \"Días\",\r\n\t\tweeks: \"Semanas\",\r\n\t\tmonths: \"Meses\",\r\n\t\tyears: \"Años\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Cancelar\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n dhtmlxGantt Persian (Farsi, fa_IR) locale by Mohammad Shokri http://slashsbin.com/\r\n */\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\r\n\t\t\t\"ژانویه\",\r\n\t\t\t\"فوریه\",\r\n\t\t\t\"مارس\",\r\n\t\t\t\"آوریل\",\r\n\t\t\t\"مه\",\r\n\t\t\t\"ژوئن\",\r\n\t\t\t\"ژوئیه\",\r\n\t\t\t\"اوت\",\r\n\t\t\t\"سپتامبر\",\r\n\t\t\t\"اکتبر\",\r\n\t\t\t\"نوامبر\",\r\n\t\t\t\"دسامبر\"\r\n\t\t],\r\n\t\tmonth_short: [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\"],\r\n\t\tday_full: [\r\n\t\t\t\"يکشنبه\",\r\n\t\t\t\"دوشنبه\",\r\n\t\t\t\"سه‌شنبه\",\r\n\t\t\t\"چهارشنبه\",\r\n\t\t\t\"پنجشنبه\",\r\n\t\t\t\"جمعه\",\r\n\t\t\t\"شنبه\"\r\n\t\t],\r\n\t\tday_short: [\r\n\t\t\t\"ی\",\r\n\t\t\t\"د\",\r\n\t\t\t\"س\",\r\n\t\t\t\"چ\",\r\n\t\t\t\"پ\",\r\n\t\t\t\"ج\",\r\n\t\t\t\"ش\"\r\n\t\t]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"وظیفه جدید\",\r\n\t\ticon_save: \"ذخیره\",\r\n\t\ticon_cancel: \"لغو\",\r\n\t\ticon_details: \"جزییات\",\r\n\t\ticon_edit: \"ویرایش\",\r\n\t\ticon_delete: \"حذف\",\r\n\t\tconfirm_closing: \"تغییرات شما ازدست خواهد رفت، آیا مطمئن هستید؟\",\r\n\t\tconfirm_deleting: \"این مورد برای همیشه حذف خواهد شد، آیا مطمئن هستید؟\",\r\n\t\tsection_description: \"توضیحات\",\r\n\t\tsection_time: \"مدت زمان\",\r\n\t\tsection_type: \"نوع\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"عنوان\",\r\n\t\tcolumn_start_date: \"زمان شروع\",\r\n\t\tcolumn_duration: \"مدت\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"ارتباط\",\r\n\t\tconfirm_link_deleting: \"حذف خواهد شد\",\r\n\t\tlink_start: \" (آغاز)\",\r\n\t\tlink_end: \" (پایان)\",\r\n\r\n\t\ttype_task: \"وظیفه\",\r\n\t\ttype_project: \"پروژه\",\r\n\t\ttype_milestone: \"نگارش\",\r\n\r\n\t\tminutes: \"دقایق\",\r\n\t\thours: \"ساعات\",\r\n\t\tdays: \"روزها\",\r\n\t\tweeks: \"هفته\",\r\n\t\tmonths: \"ماه‌ها\",\r\n\t\tyears: \"سال‌ها\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"تایید\",\r\n\t\tmessage_cancel: \"لغو\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Tammikuu\", \"Helmikuu\", \"Maaliskuu\", \"Huhtikuu\", \"Toukokuu\", \"Kes&auml;kuu\", \"Hein&auml;kuu\", \"Elokuu\", \"Syyskuu\", \"Lokakuu\", \"Marraskuu\", \"Joulukuu\"],\r\n\t\tmonth_short: [\"Tam\", \"Hel\", \"Maa\", \"Huh\", \"Tou\", \"Kes\", \"Hei\", \"Elo\", \"Syy\", \"Lok\", \"Mar\", \"Jou\"],\r\n\t\tday_full: [\"Sunnuntai\", \"Maanantai\", \"Tiistai\", \"Keskiviikko\", \"Torstai\", \"Perjantai\", \"Lauantai\"],\r\n\t\tday_short: [\"Su\", \"Ma\", \"Ti\", \"Ke\", \"To\", \"Pe\", \"La\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Uusi tehtävä\",\r\n\t\ticon_save: \"Tallenna\",\r\n\t\ticon_cancel: \"Peru\",\r\n\t\ticon_details: \"Tiedot\",\r\n\t\ticon_edit: \"Muokkaa\",\r\n\t\ticon_delete: \"Poista\",\r\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"Haluatko varmasti poistaa tapahtuman?\",\r\n\t\tsection_description: \"Kuvaus\",\r\n\t\tsection_time: \"Aikajakso\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Peru\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Janvier\", \"Février\", \"Mars\", \"Avril\", \"Mai\", \"Juin\", \"Juillet\", \"Août\", \"Septembre\", \"Octobre\", \"Novembre\", \"Décembre\"],\r\n\t\tmonth_short: [\"Jan\", \"Fév\", \"Mar\", \"Avr\", \"Mai\", \"Juin\", \"Juil\", \"Aoû\", \"Sep\", \"Oct\", \"Nov\", \"Déc\"],\r\n\t\tday_full: [\"Dimanche\", \"Lundi\", \"Mardi\", \"Mercredi\", \"Jeudi\", \"Vendredi\", \"Samedi\"],\r\n\t\tday_short: [\"Dim\", \"Lun\", \"Mar\", \"Mer\", \"Jeu\", \"Ven\", \"Sam\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nouvelle tâche\",\r\n\t\ticon_save: \"Enregistrer\",\r\n\t\ticon_cancel: \"Annuler\",\r\n\t\ticon_details: \"Détails\",\r\n\t\ticon_edit: \"Modifier\",\r\n\t\ticon_delete: \"Effacer\",\r\n\t\tconfirm_closing: \"\",// Vos modifications seront perdus, êtes-vous sûr ?\r\n\t\tconfirm_deleting: \"L'événement sera effacé sans appel, êtes-vous sûr ?\",\r\n\r\n\t\tsection_description: \"Description\",\r\n\t\tsection_time: \"Période\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"OTP\",\r\n\t\tcolumn_text: \"Nom de la tâche\",\r\n\t\tcolumn_start_date: \"Date initiale\",\r\n\t\tcolumn_duration: \"Durée\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Le lien\",\r\n\t\tconfirm_link_deleting: \"sera supprimé\",\r\n\t\tlink_start: \"(début)\",\r\n\t\tlink_end: \"(fin)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Heures\",\r\n\t\tdays: \"Jours\",\r\n\t\tweeks: \"Semaines\",\r\n\t\tmonths: \"Mois\",\r\n\t\tyears: \"Années\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Annuler\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"ינואר\", \"פברואר\", \"מרץ\", \"אפריל\", \"מאי\", \"יוני\", \"יולי\", \"אוגוסט\", \"ספטמבר\", \"אוקטובר\", \"נובמבר\", \"דצמבר\"],\r\n\t\tmonth_short: [\"ינו\", \"פבר\", \"מרץ\", \"אפר\", \"מאי\", \"יונ\", \"יול\", \"אוג\", \"ספט\", \"אוק\", \"נוב\", \"דצמ\"],\r\n\t\tday_full: [\"ראשון\", \"שני\", \"שלישי\", \"רביעי\", \"חמישי\", \"שישי\", \"שבת\"],\r\n\t\tday_short: [\"א\", \"ב\", \"ג\", \"ד\", \"ה\", \"ו\", \"ש\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"משימה חדש\",\r\n\t\ticon_save: \"שמור\",\r\n\t\ticon_cancel: \"בטל\",\r\n\t\ticon_details: \"פרטים\",\r\n\t\ticon_edit: \"ערוך\",\r\n\t\ticon_delete: \"מחק\",\r\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"ארוע ימחק סופית.להמשיך?\",\r\n\t\tsection_description: \"הסבר\",\r\n\t\tsection_time: \"תקופה\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"בטל\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n  Translation by Davor\r\n http://docs.dhtmlx.com/gantt/desktop__localization.html#comment-2569116291\r\n */\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Siječanj\", \"Veljača\", \"Ožujak\", \"Travanj\", \"Svibanj\", \"Lipanj\", \"Srpanj\", \"Kolovoz\", \"Rujan\", \"Listopad\", \"Studeni\", \"Prosinac\"],\r\n\t\tmonth_short: [\"Sij\", \"Velj\", \"Ožu\", \"Tra\", \"Svi\", \"Lip\", \"Srp\", \"Kol\", \"Ruj\", \"Lis\", \"Stu\", \"Pro\"],\r\n\t\tday_full: [\"Nedjelja\", \"Ponedjeljak\", \"Utorak\", \"Srijeda\", \"Četvrtak\", \"Petak\", \"Subota\"],\r\n\t\tday_short: [\"Ned\", \"Pon\", \"Uto\", \"Sri\", \"Čet\", \"Pet\", \"Sub\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Novi Zadatak\",\r\n\t\ticon_save: \"Spremi\",\r\n\t\ticon_cancel: \"Odustani\",\r\n\t\ticon_details: \"Detalji\",\r\n\t\ticon_edit: \"Izmjeni\",\r\n\t\ticon_delete: \"Obriši\",\r\n\t\tconfirm_closing: \"\",\r\n\t\tconfirm_deleting: \"Zadatak će biti trajno izbrisan, jeste li sigurni?\",\r\n\t\tsection_description: \"Opis\",\r\n\t\tsection_time: \"Vremenski Period\",\r\n\t\tsection_type: \"Tip\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\r\n\t\t/* grid columns */\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Naziv Zadatka\",\r\n\t\tcolumn_start_date: \"Početno Vrijeme\",\r\n\t\tcolumn_duration: \"Trajanje\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Poveznica\",\r\n\t\tconfirm_link_deleting: \"će biti izbrisan\",\r\n\t\tlink_start: \" (početak)\",\r\n\t\tlink_end: \" (kraj)\",\r\n\r\n\t\ttype_task: \"Zadatak\",\r\n\t\ttype_project: \"Projekt\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\t\tminutes: \"Minute\",\r\n\t\thours: \"Sati\",\r\n\t\tdays: \"Dani\",\r\n\t\tweeks: \"Tjedni\",\r\n\t\tmonths: \"Mjeseci\",\r\n\t\tyears: \"Godine\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Odustani\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Január\", \"Február\", \"Március\", \"Április\", \"Május\", \"Június\", \"Július\", \"Augusztus\", \"Szeptember\", \"Október\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Már\", \"Ápr\", \"Máj\", \"Jún\", \"Júl\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Vasárnap\", \"Hétfõ\", \"Kedd\", \"Szerda\", \"Csütörtök\", \"Péntek\", \"szombat\"],\r\n\t\tday_short: [\"Va\", \"Hé\", \"Ke\", \"Sze\", \"Csü\", \"Pé\", \"Szo\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Új feladat\",\r\n\t\ticon_save: \"Mentés\",\r\n\t\ticon_cancel: \"Mégse\",\r\n\t\ticon_details: \"Részletek\",\r\n\t\ticon_edit: \"Szerkesztés\",\r\n\t\ticon_delete: \"Törlés\",\r\n\t\tconfirm_closing: \"\", // A változások elvesznek, biztosan folytatja? \"\r\n\t\tconfirm_deleting: \"Az esemény törölve lesz, biztosan folytatja?\",\r\n\t\tsection_description: \"Leírás\",\r\n\t\tsection_time: \"Idõszak\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Mégse\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Januari\", \"Februari\", \"Maret\", \"April\", \"Mei\", \"Juni\", \"Juli\", \"Agustus\", \"September\", \"Oktober\", \"November\", \"Desember\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Mei\", \"Jun\", \"Jul\", \"Ags\", \"Sep\", \"Okt\", \"Nov\", \"Des\"],\r\n\t\tday_full: [\"Minggu\", \"Senin\", \"Selasa\", \"Rabu\", \"Kamis\", \"Jumat\", \"Sabtu\"],\r\n\t\tday_short: [\"Ming\", \"Sen\", \"Sel\", \"Rab\", \"Kam\", \"Jum\", \"Sab\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Tugas baru\",\r\n\t\ticon_save: \"Simpan\",\r\n\t\ticon_cancel: \"Batal\",\r\n\t\ticon_details: \"Detail\",\r\n\t\ticon_edit: \"Edit\",\r\n\t\ticon_delete: \"Hapus\",\r\n\t\tconfirm_closing: \"\", /* Perubahan tidak akan disimpan ? */\r\n\t\tconfirm_deleting: \"Acara akan dihapus\",\r\n\t\tsection_description: \"Keterangan\",\r\n\t\tsection_time: \"Periode\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Batal\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n Update 29/12/2015:\r\n New labels translation by ARCANGELI CLAUDIO\r\n\r\n */\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Gennaio\", \"Febbraio\", \"Marzo\", \"Aprile\", \"Maggio\", \"Giugno\", \"Luglio\", \"Agosto\", \"Settembre\", \"Ottobre\", \"Novembre\", \"Dicembre\"],\r\n\t\tmonth_short: [\"Gen\", \"Feb\", \"Mar\", \"Apr\", \"Mag\", \"Giu\", \"Lug\", \"Ago\", \"Set\", \"Ott\", \"Nov\", \"Dic\"],\r\n\t\tday_full: [\"Domenica\", \"Lunedì\", \"Martedì\", \"Mercoledì\", \"Giovedì\", \"Venerdì\", \"Sabato\"],\r\n\t\tday_short: [\"Dom\", \"Lun\", \"Mar\", \"Mer\", \"Gio\", \"Ven\", \"Sab\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nuovo compito\",\r\n\t\ticon_save: \"Salva\",\r\n\t\ticon_cancel: \"Chiudi\",\r\n\t\ticon_details: \"Dettagli\",\r\n\t\ticon_edit: \"Modifica\",\r\n\t\ticon_delete: \"Elimina\",\r\n\t\tconfirm_closing: \"\",// \"Sei sicuro di confermare la chiusura?\",\r\n\t\tconfirm_deleting: \"Sei sicuro di confermare l'eliminazione?\",\r\n\t\tsection_description: \"Descrizione\",\r\n\t\tsection_time: \"Periodo di tempo\",\r\n\t\tsection_type: \"Tipo\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Nome Attività\",\r\n\t\tcolumn_start_date: \"Inizio\",\r\n\t\tcolumn_duration: \"Durata\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"sarà eliminato\",\r\n\t\tlink_start: \" (inizio)\",\r\n\t\tlink_end: \" (fine)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minuti\",\r\n\t\thours: \"Ore\",\r\n\t\tdays: \"Giorni\",\r\n\t\tweeks: \"Settimane\",\r\n\t\tmonths: \"Mesi\",\r\n\t\tyears: \"Anni\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Chiudi\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n Translation by Genexus Japan Inc.\r\n */\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"1月\", \"2月\", \"3月\", \"4月\", \"5月\", \"6月\", \"7月\", \"8月\", \"9月\", \"10月\", \"11月\", \"12月\"],\r\n\t\tmonth_short: [\"1月\", \"2月\", \"3月\", \"4月\", \"5月\", \"6月\", \"7月\", \"8月\", \"9月\", \"10月\", \"11月\", \"12月\"],\r\n\t\tday_full: [\"日曜日\", \"月曜日\", \"火曜日\", \"水曜日\", \"木曜日\", \"金曜日\", \"土曜日\"],\r\n\t\tday_short: [\"日\", \"月\", \"火\", \"水\", \"木\", \"金\", \"土\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"新しい仕事\",\r\n\t\ticon_save: \"保存\",\r\n\t\ticon_cancel: \"キャンセル\",\r\n\t\ticon_details: \"詳細\",\r\n\t\ticon_edit: \"編集\",\r\n\t\ticon_delete: \"削除\",\r\n\t\tconfirm_closing: \"\", // 変更が取り消されます、宜しいですか？\r\n\t\tconfirm_deleting: \"イベント完全に削除されます、宜しいですか？\",\r\n\t\tsection_description: \"デスクリプション\",\r\n\t\tsection_time: \"期間\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"キャンセル\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n\tTranslated by cjkim@dbvalley.com\r\n*/\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"1월\", \"2월\", \"3월\", \"4월\", \"5월\", \"6월\", \"7월\", \"8월\", \"9월\", \"10월\", \"11월\", \"12월\"],\r\n\t\tmonth_short: [\"1월\", \"2월\", \"3월\", \"4월\", \"5월\", \"6월\", \"7월\", \"8월\", \"9월\", \"10월\", \"11월\", \"12월\"],\r\n\t\tday_full: [\"일요일\", \"월요일\", \"화요일\", \"수요일\", \"목요일\", \"금요일\", \"토요일\"],\r\n\t\tday_short: [\"일\", \"월\", \"화\", \"수\", \"목\", \"금\", \"토\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"이름없는 작업\",\r\n\t\ticon_save: \"저장\",\r\n\t\ticon_cancel: \"취소\",\r\n\t\ticon_details: \"세부 사항\",\r\n\t\ticon_edit: \"수정\",\r\n\t\ticon_delete: \"삭제\",\r\n\t\tconfirm_closing: \"\",\r\n\t\tconfirm_deleting: \"작업을 삭제하시겠습니까?\",\r\n\t\tsection_description: \"설명\",\r\n\t\tsection_time: \"기간\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"작업명\",\r\n\t\tcolumn_start_date: \"시작일\",\r\n\t\tcolumn_duration: \"기간\",\r\n\t\tcolumn_add: \"\",\r\n\t\tlink: \"전제\",\r\n\t\tconfirm_link_deleting: \"삭제 하시겠습니까?\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\t\ttype_task: \"작업\",\r\n\t\ttype_project: \"프로젝트\",\r\n\t\ttype_milestone: \"마일스톤\",\r\n\t\tminutes: \"분\",\r\n\t\thours: \"시간\",\r\n\t\tdays: \"일\",\r\n\t\tweeks: \"주\",\r\n\t\tmonths: \"달\",\r\n\t\tyears: \"년\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"취소\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","export default class LocaleManager{\r\n\tprivate _locales:{[key:string]: IGanttLocale };\r\n\r\n\tconstructor(config: {[key:string]: IGanttLocale }){\r\n\t\tthis._locales = {};\r\n\t\tfor(const i in config){\r\n\t\t\tthis._locales[i] = config[i];\r\n\t\t}\r\n\t}\r\n\r\n\taddLocale = (name: string, locale: IGanttLocale) => {\r\n\t\tthis._locales[name] = locale;\r\n\t};\r\n\r\n\tgetLocale = (name: string): IGanttLocale => {\r\n\t\treturn this._locales[name];\r\n\t};\r\n}","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Januar\", \"Februar\", \"Mars\", \"April\", \"Mai\", \"Juni\", \"Juli\", \"August\", \"September\", \"Oktober\", \"November\", \"Desember\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Mai\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Des\"],\r\n\t\tday_full: [\"Søndag\", \"Mandag\", \"Tirsdag\", \"Onsdag\", \"Torsdag\", \"Fredag\", \"Lørdag\"],\r\n\t\tday_short: [\"Søn\", \"Mon\", \"Tir\", \"Ons\", \"Tor\", \"Fre\", \"Lør\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Ny oppgave\",\r\n\t\ticon_save: \"Lagre\",\r\n\t\ticon_cancel: \"Avbryt\",\r\n\t\ticon_details: \"Detaljer\",\r\n\t\ticon_edit: \"Rediger\",\r\n\t\ticon_delete: \"Slett\",\r\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"Hendelsen vil bli slettet permanent. Er du sikker?\",\r\n\t\tsection_description: \"Beskrivelse\",\r\n\t\tsection_time: \"Tidsperiode\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Avbryt\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Januari\", \"Februari\", \"Maart\", \"April\", \"Mei\", \"Juni\", \"Juli\", \"Augustus\", \"September\", \"Oktober\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"mrt\", \"Apr\", \"Mei\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Zondag\", \"Maandag\", \"Dinsdag\", \"Woensdag\", \"Donderdag\", \"Vrijdag\", \"Zaterdag\"],\r\n\t\tday_short: [\"Zo\", \"Ma\", \"Di\", \"Wo\", \"Do\", \"Vr\", \"Za\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nieuwe taak\",\r\n\t\ticon_save: \"Opslaan\",\r\n\t\ticon_cancel: \"Annuleren\",\r\n\t\ticon_details: \"Details\",\r\n\t\ticon_edit: \"Bewerken\",\r\n\t\ticon_delete: \"Verwijderen\",\r\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"Item zal permanent worden verwijderd, doorgaan?\",\r\n\t\tsection_description: \"Beschrijving\",\r\n\t\tsection_time: \"Tijd periode\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Taak omschrijving\",\r\n\t\tcolumn_start_date: \"Startdatum\",\r\n\t\tcolumn_duration: \"Duur\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Koppeling\",\r\n\t\tconfirm_link_deleting: \"zal worden verwijderd\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (eind)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"minuten\",\r\n\t\thours: \"uren\",\r\n\t\tdays: \"dagen\",\r\n\t\tweeks: \"weken\",\r\n\t\tmonths: \"maanden\",\r\n\t\tyears: \"jaren\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Annuleren\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Januar\", \"Februar\", \"Mars\", \"April\", \"Mai\", \"Juni\", \"Juli\", \"August\", \"September\", \"Oktober\", \"November\", \"Desember\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Mai\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Des\"],\r\n\t\tday_full: [\"Søndag\", \"Mandag\", \"Tirsdag\", \"Onsdag\", \"Torsdag\", \"Fredag\", \"Lørdag\"],\r\n\t\tday_short: [\"Søn\", \"Man\", \"Tir\", \"Ons\", \"Tor\", \"Fre\", \"Lør\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Ny oppgave\",\r\n\t\ticon_save: \"Lagre\",\r\n\t\ticon_cancel: \"Avbryt\",\r\n\t\ticon_details: \"Detaljer\",\r\n\t\ticon_edit: \"Endre\",\r\n\t\ticon_delete: \"Slett\",\r\n\t\tconfirm_closing: \"Endringer blir ikke lagret, er du sikker?\", // Endringer blir ikke lagret, er du sikker?\r\n\t\tconfirm_deleting: \"Oppføringen vil bli slettet, er du sikker?\",\r\n\t\tsection_description: \"Beskrivelse\",\r\n\t\tsection_time: \"Tidsperiode\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Avbryt\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Styczeń\", \"Luty\", \"Marzec\", \"Kwiecień\", \"Maj\", \"Czerwiec\", \"Lipiec\", \"Sierpień\", \"Wrzesień\", \"Październik\", \"Listopad\", \"Grudzień\"],\r\n\t\tmonth_short: [\"Sty\", \"Lut\", \"Mar\", \"Kwi\", \"Maj\", \"Cze\", \"Lip\", \"Sie\", \"Wrz\", \"Paź\", \"Lis\", \"Gru\"],\r\n\t\tday_full: [\"Niedziela\", \"Poniedziałek\", \"Wtorek\", \"Środa\", \"Czwartek\", \"Piątek\", \"Sobota\"],\r\n\t\tday_short: [\"Nie\", \"Pon\", \"Wto\", \"Śro\", \"Czw\", \"Pią\", \"Sob\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nowe zadanie\",\r\n\t\ticon_save: \"Zapisz\",\r\n\t\ticon_cancel: \"Anuluj\",\r\n\t\ticon_details: \"Szczegóły\",\r\n\t\ticon_edit: \"Edytuj\",\r\n\t\ticon_delete: \"Usuń\",\r\n\t\tconfirm_closing: \"\", // Zmiany zostaną usunięte, jesteś pewien?\r\n\t\tconfirm_deleting: \"Zdarzenie zostanie usunięte na zawsze, kontynuować?\",\r\n\t\tsection_description: \"Opis\",\r\n\t\tsection_time: \"Okres czasu\",\r\n\t\tsection_type: \"Typ\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Nazwa zadania\",\r\n\t\tcolumn_start_date: \"Początek\",\r\n\t\tcolumn_duration: \"Czas trwania\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"zostanie usunięty\",\r\n\t\tlink_start: \" (początek)\",\r\n\t\tlink_end: \" (koniec)\",\r\n\r\n\t\ttype_task: \"Zadanie\",\r\n\t\ttype_project: \"Projekt\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minuty\",\r\n\t\thours: \"Godziny\",\r\n\t\tdays: \"Dni\",\r\n\t\tweeks: \"Tydzień\",\r\n\t\tmonths: \"Miesiące\",\r\n\t\tyears: \"Lata\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Anuluj\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n\r\n TRANSLATION BY MATTHEUS PIROVANI RORIZ GONЗALVES\r\n\r\n mattheusroriz@hotmail.com / mattheus.pirovani@gmail.com /\r\n\r\n www.atrixian.com.br\r\n\r\n\r\n Updated by Jorge Albernaz Martins\r\n\r\n jorgefox@hotmail.com\r\n\r\n www.redfox.inf.br\r\n\r\n JorgeFox\r\n\r\n*/\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Janeiro\", \"Fevereiro\", \"Março\", \"Abril\", \"Maio\", \"Junho\", \"Julho\", \"Agosto\", \"Setembro\", \"Outubro\", \"Novembro\", \"Dezembro\"],\r\n\t\tmonth_short: [\"Jan\", \"Fev\", \"Mar\", \"Abr\", \"Mai\", \"Jun\", \"Jul\", \"Ago\", \"Set\", \"Out\", \"Nov\", \"Dez\"],\r\n\t\tday_full: [\"Domingo\", \"Segunda\", \"Terça\", \"Quarta\", \"Quinta\", \"Sexta\", \"Sábado\"],\r\n\t\tday_short: [\"Dom\", \"Seg\", \"Ter\", \"Qua\", \"Qui\", \"Sex\", \"Sab\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nova tarefa\",\r\n\t\ticon_save: \"Salvar\",\r\n\t\ticon_cancel: \"Cancelar\",\r\n\t\ticon_details: \"Detalhes\",\r\n\t\ticon_edit: \"Editar\",\r\n\t\ticon_delete: \"Excluir\",\r\n\t\tconfirm_closing: \"\",// Suas alterações serão perdidas, confirme?\r\n\t\tconfirm_deleting: \"As tarefas serão excluidas permanentemente, confirme?\",\r\n\t\tsection_description: \"Descrição\",\r\n\t\tsection_time: \"Período\",\r\n\t\tsection_type: \"Tipo\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"EAP\",\r\n\t\tcolumn_text: \"Nome tarefa\",\r\n\t\tcolumn_start_date: \"Data início\",\r\n\t\tcolumn_duration: \"Duração\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"Será excluído!\",\r\n\t\tlink_start: \" (início)\",\r\n\t\tlink_end: \" (fim)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Projeto\",\r\n\t\ttype_milestone: \"Marco\",\r\n\r\n\r\n\t\tminutes: \"Minutos\",\r\n\t\thours: \"Horas\",\r\n\t\tdays: \"Dias\",\r\n\t\tweeks: \"Semanas\",\r\n\t\tmonths: \"Meses\",\r\n\t\tyears: \"Anos\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Cancelar\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Restrição\",\r\n\t\tconstraint_type: \"Tipo Restrição\",\r\n\t\tconstraint_date: \"Data restrição\",\r\n\t\tasap: \"Mais breve possível\",\r\n\t\talap: \"Mais tarde possível\",\r\n\t\tsnet: \"Não começar antes de\",\r\n\t\tsnlt: \"Não começar depois de\",\r\n\t\tfnet: \"Não terminar antes de\",\r\n\t\tfnlt: \"Não terminar depois de\",\r\n\t\tmso: \"Precisa começar em\",\r\n\t\tmfo: \"Precisa terminar em\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"Tipo de filtros\",\r\n\t\tresources_filter_label: \"Ocultar vazios\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n\tTraducere de Ovidiu Lixandru: http://www.madball.ro\r\n */\r\n\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Ianuarie\", \"Februarie\", \"Martie\", \"Aprilie\", \"Mai\", \"Iunie\", \"Iulie\", \"August\", \"Septembrie\", \"Octombrie\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Ian\", \"Feb\", \"Mar\", \"Apr\", \"Mai\", \"Iun\", \"Iul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Duminica\", \"Luni\", \"Marti\", \"Miercuri\", \"Joi\", \"Vineri\", \"Sambata\"],\r\n\t\tday_short: [\"Du\", \"Lu\", \"Ma\", \"Mi\", \"Jo\", \"Vi\", \"Sa\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Sarcina noua\",\r\n\t\ticon_save: \"Salveaza\",\r\n\t\ticon_cancel: \"Anuleaza\",\r\n\t\ticon_details: \"Detalii\",\r\n\t\ticon_edit: \"Editeaza\",\r\n\t\ticon_delete: \"Sterge\",\r\n\t\tconfirm_closing: \"Schimbarile nu vor fi salvate, esti sigur?\",// Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"Evenimentul va fi sters permanent, esti sigur?\",\r\n\t\tsection_description: \"Descriere\",\r\n\t\tsection_time: \"Interval\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Anuleaza\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Январь\", \"Февраль\", \"Март\", \"Апрель\", \"Maй\", \"Июнь\", \"Июль\", \"Август\", \"Сентябрь\", \"Oктябрь\", \"Ноябрь\", \"Декабрь\"],\r\n\t\tmonth_short: [\"Янв\", \"Фев\", \"Maр\", \"Aпр\", \"Maй\", \"Июн\", \"Июл\", \"Aвг\", \"Сен\", \"Окт\", \"Ноя\", \"Дек\"],\r\n\t\tday_full: [\"Воскресенье\", \"Понедельник\", \"Вторник\", \"Среда\", \"Четверг\", \"Пятница\", \"Суббота\"],\r\n\t\tday_short: [\"Вс\", \"Пн\", \"Вт\", \"Ср\", \"Чт\", \"Пт\", \"Сб\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Новое задание\",\r\n\t\ticon_save: \"Сохранить\",\r\n\t\ticon_cancel: \"Отменить\",\r\n\t\ticon_details: \"Детали\",\r\n\t\ticon_edit: \"Изменить\",\r\n\t\ticon_delete: \"Удалить\",\r\n\t\tconfirm_closing: \"\", // Ваши изменения будут потеряны, продолжить?\r\n\t\tconfirm_deleting: \"Событие будет удалено безвозвратно, продолжить?\",\r\n\t\tsection_description: \"Описание\",\r\n\t\tsection_time: \"Период времени\",\r\n\t\tsection_type: \"Тип\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"ИСР\",\r\n\t\tcolumn_text: \"Задача\",\r\n\t\tcolumn_start_date: \"Начало\",\r\n\t\tcolumn_duration: \"Длительность\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Связь\",\r\n\t\tconfirm_link_deleting: \"будет удалена\",\r\n\t\tlink_start: \" (начало)\",\r\n\t\tlink_end: \" (конец)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Минута\",\r\n\t\thours: \"Час\",\r\n\t\tdays: \"День\",\r\n\t\tweeks: \"Неделя\",\r\n\t\tmonths: \"Месяц\",\r\n\t\tyears: \"Год\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Отменить\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"начните вводить слово для фильтрации\",\r\n\t\tresources_filter_label: \"спрятать не установленные\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Januar\", \"Februar\", \"Marec\", \"April\", \"Maj\", \"Junij\", \"Julij\", \"Avgust\", \"September\", \"Oktober\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Maj\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Nedelja\", \"Ponedeljek\", \"Torek\", \"Sreda\", \"Četrtek\", \"Petek\", \"Sobota\"],\r\n\t\tday_short: [\"Ned\", \"Pon\", \"Tor\", \"Sre\", \"Čet\", \"Pet\", \"Sob\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nova naloga\",\r\n\t\ticon_save: \"Shrani\",\r\n\t\ticon_cancel: \"Prekliči\",\r\n\t\ticon_details: \"Podrobnosti\",\r\n\t\ticon_edit: \"Uredi\",\r\n\t\ticon_delete: \"Izbriši\",\r\n\t\tconfirm_closing: \"\", // Spremembe ne bodo shranjene. Želite nadaljevati ?\r\n\t\tconfirm_deleting: \"Dogodek bo izbrisan. Želite nadaljevati?\",\r\n\t\tsection_description: \"Opis\",\r\n\t\tsection_time: \"Časovni okvir\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Prekliči\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Január\", \"Február\", \"Marec\", \"Apríl\", \"Máj\", \"Jún\", \"Júl\", \"August\", \"September\", \"Október\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Máj\", \"Jún\", \"Júl\", \"Aug\", \"Sept\", \"Okt\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Nedeľa\", \"Pondelok\", \"Utorok\", \"Streda\", \"Štvrtok\", \"Piatok\", \"Sobota\"],\r\n\t\tday_short: [\"Ne\", \"Po\", \"Ut\", \"St\", \"Št\", \"Pi\", \"So\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Nová úloha\",\r\n\t\ticon_save: \"Uložiť\",\r\n\t\ticon_cancel: \"Späť\",\r\n\t\ticon_details: \"Detail\",\r\n\t\ticon_edit: \"Edituj\",\r\n\t\ticon_delete: \"Zmazať\",\r\n\t\tconfirm_closing: \"Vaše zmeny nebudú uložené. Skutočne?\", // Vaše změny budou ztraceny, opravdu ?\r\n\t\tconfirm_deleting: \"Udalosť bude natrvalo vymazaná. Skutočne?\",\r\n\t\tsection_description: \"Poznámky\",\r\n\t\tsection_time: \"Doba platnosti\",\r\n\t\tsection_type: \"Type\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Späť\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n\tTranslation by Peter Eriksson\r\n */\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Januari\", \"Februari\", \"Mars\", \"April\", \"Maj\", \"Juni\", \"Juli\", \"Augusti\", \"September\", \"Oktober\", \"November\", \"December\"],\r\n\t\tmonth_short: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"Maj\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Okt\", \"Nov\", \"Dec\"],\r\n\t\tday_full: [\"Söndag\", \"Måndag\", \"Tisdag\", \"Onsdag\", \"Torsdag\", \"Fredag\", \"Lördag\"],\r\n\t\tday_short: [\"Sön\", \"Mån\", \"Tis\", \"Ons\", \"Tor\", \"Fre\", \"Lör\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Ny uppgift\",\r\n\t\ticon_save: \"Spara\",\r\n\t\ticon_cancel: \"Avbryt\",\r\n\t\ticon_details: \"Detajer\",\r\n\t\ticon_edit: \"Ändra\",\r\n\t\ticon_delete: \"Ta bort\",\r\n\t\tconfirm_closing: \"\",\r\n\t\tconfirm_deleting: \"Är du säker på att du vill ta bort händelsen permanent?\",\r\n\t\tsection_description: \"Beskrivning\",\r\n\t\tsection_time: \"Tid\",\r\n\t\tsection_type: \"Typ\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Uppgiftsnamn\",\r\n\t\tcolumn_start_date: \"Starttid\",\r\n\t\tcolumn_duration: \"Varaktighet\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\r\n\t\tlink: \"Länk\",\r\n\t\tconfirm_link_deleting: \"kommer tas bort\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (slut)\",\r\n\t\ttype_task: \"Uppgift\",\r\n\t\ttype_project: \"Projekt\",\r\n\t\ttype_milestone: \"Milstolpe\",\r\n\r\n\t\tminutes: \"Minuter\",\r\n\t\thours: \"Timmar\",\r\n\t\tdays: \"Dagar\",\r\n\t\tweeks: \"Veckor\",\r\n\t\tmonths: \"Månader\",\r\n\t\tyears: \"År\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Avbryt\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","/*\r\n * updated by @levkar at https://github.com/DHTMLX/gantt/pull/10\r\n */\r\nconst locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Ocak\", \"Şubat\", \"Mart\", \"Nisan\", \"Mayıs\", \"Haziran\", \"Temmuz\", \"Ağustos\", \"Eylül\", \"Ekim\", \"Kasım\", \"Aralık\"],\r\n\t\tmonth_short: [\"Oca\", \"Şub\", \"Mar\", \"Nis\", \"May\", \"Haz\", \"Tem\", \"Ağu\", \"Eyl\", \"Eki\", \"Kas\", \"Ara\"],\r\n\t\tday_full: [\"Pazar\", \"Pazartesi\", \"Salı\", \"Çarşamba\", \"Perşembe\", \"Cuma\", \"Cumartesi\"],\r\n\t\tday_short: [\"Paz\", \"Pzt\", \"Sal\", \"Çar\", \"Per\", \"Cum\", \"Cmt\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Yeni görev\",\r\n\t\ticon_save: \"Kaydet\",\r\n\t\ticon_cancel: \"İptal\",\r\n\t\ticon_details: \"Detaylar\",\r\n\t\ticon_edit: \"Düzenle\",\r\n\t\ticon_delete: \"Sil\",\r\n\t\tconfirm_closing: \"\", // Your changes will be lost, are your sure ?\r\n\t\tconfirm_deleting: \"Görev silinecek, emin misiniz?\",\r\n\t\tsection_description: \"Açıklama\",\r\n\t\tsection_time: \"Zaman Aralığı\",\r\n\t\tsection_type: \"Tip\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Görev Adı\",\r\n\t\tcolumn_start_date: \"Başlangıç\",\r\n\t\tcolumn_duration: \"Süre\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Bağlantı\",\r\n\t\tconfirm_link_deleting: \"silinecek\",\r\n\t\tlink_start: \" (başlangıç)\",\r\n\t\tlink_end: \" (bitiş)\",\r\n\r\n\t\ttype_task: \"Görev\",\r\n\t\ttype_project: \"Proje\",\r\n\t\ttype_milestone: \"Kilometretaşı\",\r\n\r\n\r\n\t\tminutes: \"Dakika\",\r\n\t\thours: \"Saat\",\r\n\t\tdays: \"Gün\",\r\n\t\tweeks: \"Hafta\",\r\n\t\tmonths: \"Ay\",\r\n\t\tyears: \"Yıl\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Ýptal\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","const locale: IGanttLocale = {\r\n\tdate: {\r\n\t\tmonth_full: [\"Січень\", \"Лютий\", \"Березень\", \"Квітень\", \"Травень\", \"Червень\", \"Липень\", \"Серпень\", \"Вересень\", \"Жовтень\", \"Листопад\", \"Грудень\"],\r\n\t\tmonth_short: [\"Січ\", \"Лют\", \"Бер\", \"Кві\", \"Тра\", \"Чер\", \"Лип\", \"Сер\", \"Вер\", \"Жов\", \"Лис\", \"Гру\"],\r\n\t\tday_full: [\"Неділя\", \"Понеділок\", \"Вівторок\", \"Середа\", \"Четвер\", \"П'ятниця\", \"Субота\"],\r\n\t\tday_short: [\"Нед\", \"Пон\", \"Вів\", \"Сер\", \"Чет\", \"Птн\", \"Суб\"]\r\n\t},\r\n\tlabels: {\r\n\t\tnew_task: \"Нове завдання\",\r\n\t\ticon_save: \"Зберегти\",\r\n\t\ticon_cancel: \"Відміна\",\r\n\t\ticon_details: \"Деталі\",\r\n\t\ticon_edit: \"Редагувати\",\r\n\t\ticon_delete: \"Вилучити\",\r\n\t\tconfirm_closing: \"\", // Ваші зміни втратяться. Ви впевнені ?\r\n\t\tconfirm_deleting: \"Подія вилучиться назавжди. Ви впевнені?\",\r\n\t\tsection_description: \"Опис\",\r\n\t\tsection_time: \"Часовий проміжок\",\r\n\t\tsection_type: \"Тип\",\r\n\t\tsection_deadline: \"Deadline\",\r\n\t\tsection_baselines: \"Baselines\",\r\n\t\t/* grid columns */\r\n\r\n\t\tcolumn_wbs: \"WBS\",\r\n\t\tcolumn_text: \"Task name\",\r\n\t\tcolumn_start_date: \"Start time\",\r\n\t\tcolumn_duration: \"Duration\",\r\n\t\tcolumn_add: \"\",\r\n\r\n\t\t/* link confirmation */\r\n\t\tlink: \"Link\",\r\n\t\tconfirm_link_deleting: \"will be deleted\",\r\n\t\tlink_start: \" (start)\",\r\n\t\tlink_end: \" (end)\",\r\n\r\n\t\ttype_task: \"Task\",\r\n\t\ttype_project: \"Project\",\r\n\t\ttype_milestone: \"Milestone\",\r\n\r\n\r\n\t\tminutes: \"Minutes\",\r\n\t\thours: \"Hours\",\r\n\t\tdays: \"Days\",\r\n\t\tweeks: \"Week\",\r\n\t\tmonths: \"Months\",\r\n\t\tyears: \"Years\",\r\n\r\n\t\t/* message popup */\r\n\t\tmessage_ok: \"OK\",\r\n\t\tmessage_cancel: \"Відміна\",\r\n\r\n\t\t/* constraints */\r\n\t\tsection_constraint: \"Constraint\",\r\n\t\tconstraint_type: \"Constraint type\",\r\n\t\tconstraint_date: \"Constraint date\",\r\n\t\tasap: \"As Soon As Possible\",\r\n\t\talap: \"As Late As Possible\",\r\n\t\tsnet: \"Start No Earlier Than\",\r\n\t\tsnlt: \"Start No Later Than\",\r\n\t\tfnet: \"Finish No Earlier Than\",\r\n\t\tfnlt: \"Finish No Later Than\",\r\n\t\tmso: \"Must Start On\",\r\n\t\tmfo: \"Must Finish On\",\r\n\r\n\t\t/* resource control */\r\n\t\tresources_filter_placeholder: \"type to filter\",\r\n\t\tresources_filter_label: \"hide empty\",\r\n\r\n\t\t/* empty state screen */\r\n\t\tempty_state_text_link: \"Click here\",\r\n\t\tempty_state_text_description: \"to create your first task\",\r\n\r\n\t\t/* baselines control */\r\n\t\tbaselines_section_placeholder: \"Start adding a new baseline\",\r\n\t\tbaselines_add_button: \"Add Baseline\",\r\n\t\tbaselines_remove_button: \"Remove\",\r\n\t\tbaselines_remove_all_button: \"Remove All\",\r\n\r\n\t\t/* deadline control */\r\n\t\tdeadline_enable_button: \"Set\",\r\n\t\tdeadline_disable_button: \"Remove\"\r\n\t}\r\n};\r\n\r\nexport default locale;\r\n","import ar from \"./locale_ar\";\r\nimport be from \"./locale_be\";\r\nimport ca from \"./locale_ca\";\r\nimport cn from \"./locale_cn\";\r\nimport cs from \"./locale_cs\";\r\nimport da from \"./locale_da\";\r\nimport de from \"./locale_de\";\r\nimport el from \"./locale_el\";\r\nimport en from \"./locale_en\";\r\nimport es from \"./locale_es\";\r\nimport fa from \"./locale_fa\";\r\nimport fi from \"./locale_fi\";\r\nimport fr from \"./locale_fr\";\r\nimport he from \"./locale_he\";\r\nimport hr from \"./locale_hr\";\r\nimport hu from \"./locale_hu\";\r\nimport id from \"./locale_id\";\r\nimport it from \"./locale_it\";\r\nimport jp from \"./locale_jp\";\r\nimport kr from \"./locale_kr\";\r\n\r\nimport LocaleManager from \"./locale_manager\";\r\n\r\nimport nb from \"./locale_nb\";\r\nimport nl from \"./locale_nl\";\r\nimport no from \"./locale_no\";\r\nimport pl from \"./locale_pl\";\r\nimport pt from \"./locale_pt\";\r\nimport ro from \"./locale_ro\";\r\nimport ru from \"./locale_ru\";\r\nimport si from \"./locale_si\";\r\nimport sk from \"./locale_sk\";\r\nimport sv from \"./locale_sv\";\r\nimport tr from \"./locale_tr\";\r\nimport ua from \"./locale_ua\";\r\n\r\nexport default function(){\r\n\treturn new LocaleManager({\r\n\t\ten,\r\n\t\tar,\r\n\t\tbe,\r\n\t\tca,\r\n\t\tcn,\r\n\t\tcs,\r\n\t\tda,\r\n\t\tde,\r\n\t\tel,\r\n\t\tes,\r\n\t\tfa,\r\n\t\tfi,\r\n\t\tfr,\r\n\t\the,\r\n\t\thr,\r\n\t\thu,\r\n\t\tid,\r\n\t\tit,\r\n\t\tjp,\r\n\t\tkr,\r\n\t\tnb,\r\n\t\tnl,\r\n\t\tno,\r\n\t\tpl,\r\n\t\tpt,\r\n\t\tro,\r\n\t\tru,\r\n\t\tsi,\r\n\t\tsk,\r\n\t\tsv,\r\n\t\ttr,\r\n\t\tua\r\n\t});\r\n}","import * as utils from \"../utils/utils\";\r\nimport constants from \"../constants\";\r\nimport ExtensionManager from \"../ext/extension_manager\";\r\n\r\nimport services from \"../core/common/services\";\r\nimport config from \"../core/common/config\";\r\nimport ajax from \"../core/common/ajax\";\r\nimport date from \"../core/common/date\";\r\nimport {remoteEvents} from \"../core/remote/remote_events\";\r\n\r\nimport DnD from \"../core/common/dnd\";\r\nimport templates from \"../core/common/templates\";\r\nimport eventable from \"../utils/eventable\";\r\n\r\nimport StateService from \"../core/common/state\";\r\n\r\nimport Promise from \"../utils/promise\";\r\nimport env from \"../utils/env\";\r\nimport datastoreHooks from \"../core/datastore/datastore_hooks\";\r\nimport DataProcessor from \"../core/dataprocessor\";\r\n\r\nimport plugins from \"../core/plugins\";\r\n\r\nimport grid_column_api from \"../core/grid_column_api\";\r\nimport tasks from \"../core/tasks\";\r\nimport parsing from \"../core/loading/parsing\";\r\nimport work_time from \"../core/worktime/work_time\";\r\nimport data from \"../core/data\";\r\n\r\nimport void_script_second from \"../publish_helpers/void_script_second\";\r\n\r\nimport data_task_types from \"../core/data_task_types\";\r\nimport cached_functions from \"../core/cached_functions\";\r\n\r\nimport gantt_core from \"../core/gantt_core\";\r\nimport destructor from \"../core/destructor\";\r\nimport void_script_third from \"../publish_helpers/void_script_third\";\r\n\r\nimport i18nFactory from \"../locale\";\r\n\r\nfunction DHXGantt(){\r\n\tthis.constants = constants;\r\n\tthis.version = VERSION;\r\n\tthis.license = LICENSE;\r\n\tthis.templates = {};\r\n\tthis.ext = {};\r\n\tthis.keys = {\r\n\t\tedit_save: this.constants.KEY_CODES.ENTER,\r\n\t\tedit_cancel: this.constants.KEY_CODES.ESC\r\n\t};\r\n}\r\n\r\nexport default function(supportedExtensions) {\r\n\t// use a named constructor to make gantt instance discoverable in heap snapshots\r\n\tvar gantt = new DHXGantt();\r\n\r\n\tvar extensionManager = new ExtensionManager(supportedExtensions);\r\n\tvar activePlugins = {};\r\n\tgantt.plugins = function(config){\r\n\t\tfor(var i in config){\r\n\t\t\tif(config[i] && !activePlugins[i]){\r\n\t\t\t\tvar plugin = extensionManager.getExtension(i);\r\n\t\t\t\tif(plugin){\r\n\t\t\t\t\tplugin(gantt);\r\n\t\t\t\t\tactivePlugins[i] = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn activePlugins;\r\n\t};\r\n\r\n\tgantt.$services = services();\r\n\tgantt.config = config();\r\n\tgantt.ajax =  ajax(gantt);\r\n\tgantt.date = date(gantt);\r\n\tgantt.RemoteEvents = remoteEvents;\r\n\r\n\tvar dnd = DnD(gantt);\r\n\tgantt.$services.setService(\"dnd\", function(){return dnd;});\r\n\r\n\tvar templatesLoader = templates(gantt);\r\n\tgantt.$services.setService(\"templateLoader\", function () {\r\n\t\treturn templatesLoader;\r\n\t});\r\n\r\n\teventable(gantt);\r\n\r\n\t\r\n\tvar stateService = new StateService();\r\n\r\n\tstateService.registerProvider(\"global\", function () {\r\n\t\tvar res = {\r\n\t\t\tmin_date: gantt._min_date,\r\n\t\t\tmax_date: gantt._max_date,\r\n\t\t\tselected_task: null\r\n\t\t};\r\n\r\n\t\t// do not throw error if getState called from non-initialized gantt\r\n\t\tif(gantt.$data && gantt.$data.tasksStore){\r\n\t\t\tres.selected_task = gantt.$data.tasksStore.getSelectedId();\r\n\t\t}\r\n\t\treturn res;\r\n\t});\r\n\tgantt.getState = stateService.getState;\r\n\tgantt.$services.setService(\"state\", function () {\r\n\t\treturn stateService;\r\n\t});\r\n\r\n\tutils.mixin(gantt, utils);\r\n\r\n\tgantt.Promise = Promise;\r\n\tgantt.env = env;\r\n\r\n\tdatastoreHooks(gantt);\r\n\r\n\tgantt.dataProcessor = DataProcessor.DEPRECATED_api;\r\n\tgantt.createDataProcessor = DataProcessor.createDataProcessor;\r\n\r\n\tplugins(gantt);\r\n\r\n\tgrid_column_api(gantt);\r\n\ttasks(gantt);\r\n\tparsing(gantt);\r\n\twork_time(gantt);\r\n\tdata(gantt);\r\n\r\n\tvoid_script_second(gantt);\r\n\r\n\tdata_task_types(gantt);\r\n\tcached_functions(gantt);\r\n\r\n\tgantt_core(gantt);\r\n\tdestructor(gantt);\r\n\tvoid_script_third(gantt);\r\n\r\n\tvar i18n = i18nFactory();\r\n\tgantt.i18n = {\r\n\t\taddLocale: i18n.addLocale,\r\n\t\tsetLocale: function(locale){\r\n\t\t\tif(typeof locale === \"string\"){\r\n\t\t\t\tvar localeObject = i18n.getLocale(locale);\r\n\t\t\t\tif(!localeObject){\r\n\t\t\t\t\tlocaleObject = i18n.getLocale(\"en\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgantt.locale = localeObject;\r\n\t\t\t}else if(locale){\r\n\t\t\t\tif(!gantt.locale){\r\n\t\t\t\t\tgantt.locale = locale;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tfor(var i in locale){\r\n\t\t\t\t\t\tif(locale[i] && typeof locale[i] === \"object\"){\r\n\t\t\t\t\t\t\tif(!gantt.locale[i]){\r\n\t\t\t\t\t\t\t\tgantt.locale[i] = {};\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tgantt.mixin(gantt.locale[i], locale[i], true);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tgantt.locale[i] = locale[i];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst labels = gantt.locale.labels;\r\n\t\t\tlabels.gantt_save_btn = labels.gantt_save_btn || labels.icon_save;\r\n\t\t\tlabels.gantt_cancel_btn = labels.gantt_cancel_btn || labels.icon_cancel;\r\n\t\t\tlabels.gantt_delete_btn = labels.gantt_delete_btn || labels.icon_delete;\r\n\t\t},\r\n\t\tgetLocale: i18n.getLocale\r\n\t};\r\n\tgantt.i18n.setLocale(\"en\");\r\n\treturn gantt;\r\n};","import * as utils from \"../../utils/utils\";\r\nimport * as domHelpers from \"./utils/dom_helpers\";\r\n\r\nexport default function(gantt) {\r\n\r\n\tvar boxAttribute = \"data-dhxbox\";\r\n\r\n\tvar _dhx_msg_cfg = null;\r\n\r\n\tfunction callback(config, result) {\r\n\t\tvar usercall = config.callback;\r\n\t\tmodalBox.hide(config.box);\r\n\r\n\t\t_dhx_msg_cfg = config.box = null;\r\n\t\tif (usercall)\r\n\t\t\tusercall(result);\r\n\t}\r\n\r\n\tfunction modal_key(event) {\r\n\t\tif (_dhx_msg_cfg) {\r\n\r\n\t\t\tvar code = event.which || event.keyCode;\r\n\t\t\tvar preventDefault = false;\r\n\r\n\t\t\tif (messageBox.keyboard) {\r\n\t\t\t\tif (code == 13 || code == 32) {\r\n\t\t\t\t\t// default behavior is to confirm/submit popup on space/enter\r\n\t\t\t\t\t// if browser focus is set on button element - do button click instead of default behavior\r\n\t\t\t\t\tvar target = event.target || event.srcElement;\r\n\t\t\t\t\tif (domHelpers.getClassName(target).indexOf(\"gantt_popup_button\") > -1 && target.click) {\r\n\t\t\t\t\t\ttarget.click();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcallback(_dhx_msg_cfg, true);\r\n\t\t\t\t\t\tpreventDefault = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (code == 27) {\r\n\t\t\t\t\tcallback(_dhx_msg_cfg, false);\r\n\t\t\t\t\tpreventDefault = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (preventDefault) {\r\n\t\t\t\tif (event.preventDefault){\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t\treturn !(event.cancelBubble = true);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\tvar eventElement = domHelpers.getRootNode(gantt.$root) || document;\r\n\tgantt.event(eventElement, \"keydown\", modal_key, true);\r\n\r\n\tfunction modality(mode) {\r\n\t\tif (!modality.cover) {\r\n\t\t\tmodality.cover = document.createElement(\"div\");\r\n\t\t\t//necessary for IE only\r\n\t\t\tmodality.cover.onkeydown = modal_key;\r\n\t\t\tmodality.cover.className = \"dhx_modal_cover\";\r\n\t\t\tdocument.body.appendChild(modality.cover);\r\n\t\t}\r\n\r\n\t\tmodality.cover.style.display = mode ? \"inline-block\" : \"none\";\r\n\t}\r\n\r\n\tfunction button(text, className, result) {\r\n\t\tvar buttonAriaAttrs = gantt._waiAria.messageButtonAttrString(text);\r\n\t\tvar name = className.toLowerCase().replace(/ /g, \"_\");\r\n\t\tvar button_css = \"gantt_\" + name + \"_button\";\r\n\t\treturn \"<div \" + buttonAriaAttrs + \" class='gantt_popup_button \" + button_css + \"' data-result='\" + result + \"' result='\" + result + \"' ><div>\" + text + \"</div></div>\";\r\n\t}\r\n\r\n\tfunction info(text) {\r\n\t\tif (!messageBox.area) {\r\n\t\t\tmessageBox.area = document.createElement(\"div\");\r\n\t\t\tmessageBox.area.className = \"gantt_message_area\";\r\n\t\t\tmessageBox.area.style[messageBox.position] = \"5px\";\r\n\t\t\tdocument.body.appendChild(messageBox.area);\r\n\t\t}\r\n\r\n\t\tmessageBox.hide(text.id);\r\n\t\tvar message = document.createElement(\"div\");\r\n\t\tmessage.innerHTML = \"<div>\" + text.text + \"</div>\";\r\n\t\tmessage.className = \"gantt-info gantt-\" + text.type;\r\n\t\tmessage.onclick = function () {\r\n\t\t\tmessageBox.hide(text.id);\r\n\t\t\ttext = null;\r\n\t\t};\r\n\r\n\t\tgantt._waiAria.messageInfoAttr(message);\r\n\r\n\t\tif (messageBox.position == \"bottom\" && messageBox.area.firstChild)\r\n\t\t\tmessageBox.area.insertBefore(message, messageBox.area.firstChild);\r\n\t\telse\r\n\t\t\tmessageBox.area.appendChild(message);\r\n\r\n\t\tif (text.expire > 0)\r\n\t\t\tmessageBox.timers[text.id] = window.setTimeout(function () {\r\n\t\t\t\t// GS-1213: We need that when Gantt is destroyed\r\n\t\t\t\tif (messageBox) messageBox.hide(text.id);\r\n\t\t\t}, text.expire);\r\n\r\n\t\tmessageBox.pull[text.id] = message;\r\n\t\tmessage = null;\r\n\r\n\t\treturn text.id;\r\n\t}\r\n\r\n\tfunction getFirstDefined() {\r\n\t\tvar values = [].slice.apply(arguments, [0]);\r\n\r\n\t\tfor (var i = 0; i < values.length; i++) {\r\n\t\t\tif (values[i]) {\r\n\t\t\t\treturn values[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction _boxStructure(config, ok, cancel) {\r\n\t\tvar box = document.createElement(\"div\");\r\n\r\n\t\tvar contentId = utils.uid();\r\n\t\tgantt._waiAria.messageModalAttr(box, contentId);\r\n\r\n\r\n\t\tbox.className = \" gantt_modal_box gantt-\" + config.type;\r\n\t\tbox.setAttribute(boxAttribute, 1);\r\n\r\n\t\tvar inner = '';\r\n\r\n\t\tif (config.width)\r\n\t\t\tbox.style.width = config.width;\r\n\t\tif (config.height)\r\n\t\t\tbox.style.height = config.height;\r\n\t\tif (config.title)\r\n\t\t\tinner += '<div class=\"gantt_popup_title\">' + config.title + '</div>';\r\n\t\tinner += '<div class=\"gantt_popup_text\" id=\"' + contentId + '\"><span>' + (config.content ? '' : config.text) + '</span></div><div  class=\"gantt_popup_controls\">';\r\n\t\tif (ok)\r\n\t\t\tinner += button(getFirstDefined(config.ok, gantt.locale.labels.message_ok, \"OK\"), \"ok\", true);\r\n\t\tif (cancel)\r\n\t\t\tinner += button(getFirstDefined(config.cancel, gantt.locale.labels.message_cancel, \"Cancel\"), \"cancel\", false);\r\n\r\n\t\tif (config.buttons) {\r\n\t\t\tfor (var i = 0; i < config.buttons.length; i++) {\r\n\t\t\t\tvar btn = config.buttons[i];\r\n\t\t\t\tif (typeof btn == \"object\") {\r\n\t\t\t\t\t// Support { label:\"Save\", css:\"main_button\", value:\"save\" }\r\n\t\t\t\t\tvar label = btn.label;\r\n\t\t\t\t\tvar css = btn.css || (\"gantt_\" + btn.label.toLowerCase() + \"_button\");\r\n\t\t\t\t\tvar value = btn.value || i;\r\n\t\t\t\t\tinner += button(label, css, value);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tinner += button(btn, btn, i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tinner += '</div>';\r\n\t\tbox.innerHTML = inner;\r\n\r\n\t\tif (config.content) {\r\n\t\t\tvar node = config.content;\r\n\t\t\tif (typeof node == \"string\")\r\n\t\t\t\tnode = document.getElementById(node);\r\n\t\t\tif (node.style.display == 'none')\r\n\t\t\t\tnode.style.display = \"\";\r\n\t\t\tbox.childNodes[config.title ? 1 : 0].appendChild(node);\r\n\t\t}\r\n\r\n\t\tbox.onclick = function (event) {\r\n\t\t\tvar source = event.target || event.srcElement;\r\n\t\t\tif (!source.className) source = source.parentNode;\r\n\t\t\tif (domHelpers.closest(source, \".gantt_popup_button\")) {\r\n\t\t\t\tvar result = source.getAttribute(\"data-result\");\r\n\t\t\t\tresult = (result == \"true\") || (result == \"false\" ? false : result);\r\n\t\t\t\tcallback(config, result);\r\n\t\t\t}\r\n\t\t};\r\n\t\tconfig.box = box;\r\n\t\tif (ok || cancel)\r\n\t\t\t_dhx_msg_cfg = config;\r\n\r\n\t\treturn box;\r\n\t}\r\n\r\n\tfunction _createBox(config, ok, cancel) {\r\n\t\tvar box = config.tagName ? config : _boxStructure(config, ok, cancel);\r\n\r\n\t\tif (!config.hidden)\r\n\t\t\tmodality(true);\r\n\t\tdocument.body.appendChild(box);\r\n\t\tvar x = Math.abs(Math.floor(((window.innerWidth || document.documentElement.offsetWidth) - box.offsetWidth) / 2));\r\n\t\tvar y = Math.abs(Math.floor(((window.innerHeight || document.documentElement.offsetHeight) - box.offsetHeight) / 2));\r\n\t\tif (config.position == \"top\")\r\n\t\t\tbox.style.top = \"-3px\";\r\n\t\telse\r\n\t\t\tbox.style.top = y + 'px';\r\n\t\tbox.style.left = x + 'px';\r\n\t\t//necessary for IE only\r\n\t\tbox.onkeydown = modal_key;\r\n\r\n\t\tmodalBox.focus(box);\r\n\r\n\t\tif (config.hidden)\r\n\t\t\tmodalBox.hide(box);\r\n\r\n\t\tgantt.callEvent(\"onMessagePopup\", [box]);\r\n\t\treturn box;\r\n\t}\r\n\r\n\tfunction alertPopup(config) {\r\n\t\treturn _createBox(config, true, false);\r\n\t}\r\n\r\n\tfunction confirmPopup(config) {\r\n\t\treturn _createBox(config, true, true);\r\n\t}\r\n\r\n\tfunction boxPopup(config) {\r\n\t\treturn _createBox(config);\r\n\t}\r\n\r\n\tfunction box_params(text, type, callback) {\r\n\t\tif (typeof text != \"object\") {\r\n\t\t\tif (typeof type == \"function\") {\r\n\t\t\t\tcallback = type;\r\n\t\t\t\ttype = \"\";\r\n\t\t\t}\r\n\t\t\ttext = {text: text, type: type, callback: callback};\r\n\t\t}\r\n\t\treturn text;\r\n\t}\r\n\r\n\tfunction params(text, type, expire, id) {\r\n\t\tif (typeof text != \"object\")\r\n\t\t\ttext = {text: text, type: type, expire: expire, id: id};\r\n\t\ttext.id = text.id || utils.uid();\r\n\t\ttext.expire = text.expire || messageBox.expire;\r\n\t\treturn text;\r\n\t}\r\n\r\n\tvar alertBox = function () {\r\n\t\tvar text = box_params.apply(this, arguments);\r\n\t\ttext.type = text.type || \"confirm\";\r\n\t\treturn alertPopup(text);\r\n\t};\r\n\tvar confirmBox = function () {\r\n\t\tvar text = box_params.apply(this, arguments);\r\n\t\ttext.type = text.type || \"alert\";\r\n\t\treturn confirmPopup(text);\r\n\t};\r\n\tvar modalBox = function () {\r\n\t\tvar text = box_params.apply(this, arguments);\r\n\t\ttext.type = text.type || \"alert\";\r\n\t\treturn boxPopup(text);\r\n\t};\r\n\tmodalBox.hide = function (node) {\r\n\t\twhile (node && node.getAttribute && !node.getAttribute(boxAttribute))\r\n\t\t\tnode = node.parentNode;\r\n\t\tif (node) {\r\n\t\t\tnode.parentNode.removeChild(node);\r\n\t\t\tmodality(false);\r\n\r\n\t\t\tgantt.callEvent(\"onAfterMessagePopup\", [node]);\r\n\t\t}\r\n\t};\r\n\r\n\tmodalBox.focus = function (node) {\r\n\t\tsetTimeout(function () {\r\n\t\t\tvar focusable = domHelpers.getFocusableNodes(node);\r\n\t\t\tif (focusable.length) {\r\n\t\t\t\tif (focusable[0].focus) focusable[0].focus();\r\n\t\t\t}\r\n\t\t}, 1);\r\n\t};\r\n\r\n\tvar messageBox = function (text, type, expire, id) {\r\n\t\ttext = params.apply(this, arguments);\r\n\t\ttext.type = text.type || \"info\";\r\n\r\n\t\tvar subtype = text.type.split(\"-\")[0];\r\n\t\tswitch (subtype) {\r\n\t\t\tcase \"alert\":\r\n\t\t\t\treturn alertPopup(text);\r\n\t\t\tcase \"confirm\":\r\n\t\t\t\treturn confirmPopup(text);\r\n\t\t\tcase \"modalbox\":\r\n\t\t\t\treturn boxPopup(text);\r\n\t\t\tdefault:\r\n\t\t\t\treturn info(text);\r\n\t\t}\r\n\t};\r\n\r\n\tmessageBox.seed = (new Date()).valueOf();\r\n\tmessageBox.uid = utils.uid;\r\n\tmessageBox.expire = 4000;\r\n\tmessageBox.keyboard = true;\r\n\tmessageBox.position = \"top\";\r\n\tmessageBox.pull = {};\r\n\tmessageBox.timers = {};\r\n\r\n\tmessageBox.hideAll = function () {\r\n\t\tfor (var key in messageBox.pull)\r\n\t\t\tmessageBox.hide(key);\r\n\t};\r\n\tmessageBox.hide = function (id) {\r\n\t\tvar obj = messageBox.pull[id];\r\n\t\tif (obj && obj.parentNode) {\r\n\t\t\twindow.setTimeout(function () {\r\n\t\t\t\tobj.parentNode.removeChild(obj);\r\n\t\t\t\tobj = null;\r\n\t\t\t}, 2000);\r\n\t\t\tobj.className += \" hidden\";\r\n\r\n\t\t\tif (messageBox.timers[id])\r\n\t\t\t\twindow.clearTimeout(messageBox.timers[id]);\r\n\t\t\tdelete messageBox.pull[id];\r\n\t\t}\r\n\t};\r\n\r\n\tvar popups = [];\r\n\tgantt.attachEvent(\"onMessagePopup\", function(box){\r\n\t\tpopups.push(box);\r\n\t});\r\n\tgantt.attachEvent(\"onAfterMessagePopup\", function(box){\r\n\t\tfor(var i = 0; i < popups.length; i++){\r\n\t\t\tif(popups[i] === box){\r\n\t\t\t\tpopups.splice(i, 1);\r\n\t\t\t\ti--;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onDestroy\", function(){\r\n\t\tif(modality.cover && modality.cover.parentNode){\r\n\t\t\tmodality.cover.parentNode.removeChild(modality.cover);\r\n\t\t}\r\n\r\n\t\tfor(var i = 0; i < popups.length; i++){\r\n\t\t\tif(popups[i].parentNode){\r\n\t\t\t\tpopups[i].parentNode.removeChild(popups[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tpopups = null;\r\n\r\n\t\tif(messageBox.area && messageBox.area.parentNode){\r\n\t\t\tmessageBox.area.parentNode.removeChild(messageBox.area);\r\n\t\t}\r\n\t\tmessageBox = null;\r\n\t});\r\n\r\n\treturn {\r\n\t\talert: alertBox,\r\n\t\tconfirm: confirmBox,\r\n\t\tmessage: messageBox,\r\n\t\tmodalbox: modalBox\r\n\t};\r\n};","import * as utils from \"../../utils/utils\";\r\n\r\nfunction extendSettings (store, parentSettings){\r\n\tvar own = this.$config[store];\r\n\r\n\tif(own){\r\n\t\tif(!own.$extendedConfig){\r\n\t\t\town.$extendedConfig = true;\r\n\t\t\tObject.setPrototypeOf(own, parentSettings);\r\n\t\t}\r\n\t\treturn own;\r\n\t}else{\r\n\t\treturn parentSettings;\r\n\t}\r\n}\r\n\r\nvar configurable = function(parentView){\r\n\tvar parentConfig,\r\n\t\tparentTemplates;\r\n\r\n\treturn {\r\n\t\t$getConfig: function(){\r\n\t\t\tif(!parentConfig){\r\n\t\t\t\tparentConfig = parentView ? parentView.$getConfig() : this.$gantt.config;\r\n\t\t\t}\r\n\t\t\tif(!this.$config.config){\r\n\t\t\t\treturn parentConfig;\r\n\t\t\t}else{\r\n\t\t\t\treturn extendSettings.call(this, \"config\", parentConfig);\r\n\t\t\t}\r\n\t\t},\r\n\t\t$getTemplates: function(){\r\n\t\t\tif(!parentTemplates){\r\n\t\t\t\tparentTemplates = parentView ? parentView.$getTemplates() : this.$gantt.templates;\r\n\t\t\t}\r\n\t\t\tif(!this.$config.templates){\r\n\t\t\t\treturn parentTemplates;\r\n\t\t\t}else{\r\n\t\t\t\treturn extendSettings.call(this, \"templates\", parentTemplates);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n};\r\n\r\nexport default function(obj, parent){\r\n\tutils.mixin(obj, configurable(parent));\r\n};","import * as utils from \"../../utils/utils\";\r\nimport configurable from \"./configurable\";\r\n\r\nvar uiFactory = function createFactory(gantt){\r\n\tvar views = {};\r\n\r\n\tfunction ui(cell, parentView) {\r\n\t\tvar content;\r\n\t\tvar view = \"cell\";\r\n\t\tif (cell.view){\r\n\t\t\tview = \"viewcell\";\r\n\t\t}else if (cell.resizer) {\r\n\t\t\tview = \"resizer\";\r\n\t\t}\r\n\t\telse if (cell.rows || cell.cols) {\r\n\t\t\tview = \"layout\";\r\n\t\t}\r\n\t\telse if (cell.views) {\r\n\t\t\tview = \"multiview\";\r\n\t\t}\r\n\r\n\t\tcontent = createView.call(this, view, null, cell, parentView);\r\n\t\treturn content;\r\n\t}\r\n\t\r\n\tvar createdViews = {};\r\n\r\n\tfunction createView(name, parent, config, parentView) {\r\n\t\tvar creator = views[name];\r\n\r\n\t\tif(!creator || !creator.create)\r\n\t\t\treturn false;\r\n\r\n\t\tif(name == \"resizer\" && !config.mode){\r\n\t\t\tif(parentView.$config.cols){\r\n\t\t\t\tconfig.mode = \"x\";\r\n\t\t\t}else{\r\n\t\t\t\tconfig.mode = \"y\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(name == \"viewcell\" && config.view == \"scrollbar\" && !config.scroll){\r\n\t\t\tif(parentView.$config.cols){\r\n\t\t\t\tconfig.scroll = \"y\";\r\n\t\t\t}else{\r\n\t\t\t\tconfig.scroll = \"x\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar config = utils.copy(config);\r\n\r\n\t\tif(!config.id && !createdViews[config.view]){\r\n\t\t\tconfig.id = config.view;\r\n\t\t}\r\n\r\n\t\tif(config.id && !config.css){\r\n\t\t\tconfig.css = config.id+\"_cell\";\r\n\t\t}\r\n\r\n\t\tvar view = new creator.create(parent, config, this, gantt);\r\n\r\n\t\tif(creator.configure){\r\n\t\t\tcreator.configure(view);\r\n\t\t}\r\n\r\n\t\tconfigurable(view, parentView);\r\n\t\tif(!view.$id){\r\n\t\t\tview.$id = config.id || gantt.uid();\r\n\t\t}\r\n\r\n\t\tif(!view.$parent && typeof parent == \"object\"){\r\n\t\t\tview.$parent = parent;\r\n\t\t}\r\n\t\tif(!view.$config){\r\n\t\t\tview.$config = config;\r\n\t\t}\r\n\r\n\t\tif(createdViews[view.$id]){\r\n\t\t\tview.$id = gantt.uid();\r\n\t\t}\r\n\r\n\t\tcreatedViews[view.$id] = view;\r\n\r\n\t\treturn view;\r\n\t}\r\n\r\n\tfunction reset(){\r\n\t\tcreatedViews = {};\r\n\t}\r\n\r\n\tfunction register(name, viewConstructor, configure){\r\n\t\tviews[name] = {create: viewConstructor, configure: configure};\r\n\t}\r\n\r\n\tfunction getView(id){\r\n\t\treturn createdViews[id];\r\n\t}\r\n\r\n\tvar factory = {\r\n\t\tinitUI:ui,\r\n\t\treset: reset,\r\n\t\tregisterView: register,\r\n\t\tcreateView: createView,\r\n\t\tgetView: getView\r\n\t};\r\n\r\n\treturn factory;\r\n};\r\n\r\nexport default {\r\n\tcreateFactory: uiFactory\r\n};\r\n\r\n","import * as domHelpers from \"./utils/dom_helpers\";\r\n\r\nvar createMouseHandler = (function(domHelpers) {\r\n\treturn function (gantt) {\r\n\t\tvar eventHandlers = {\r\n\t\t\t\"click\": {},\r\n\t\t\t\"doubleclick\": {},\r\n\t\t\t\"contextMenu\": {}\r\n\t\t};\r\n\r\n\t\tfunction addEventTarget(event, className, handler, root) {\r\n\t\t\tif(!eventHandlers[event][className]){\r\n\t\t\t\teventHandlers[event][className] = [];\r\n\t\t\t}\r\n\r\n\t\t\teventHandlers[event][className].push({\r\n\t\t\t\thandler: handler,\r\n\t\t\t\troot: root\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction callHandler(eventName, className, root, args) {\r\n\t\t\tvar handlers = eventHandlers[eventName][className];\r\n\t\t\tif(handlers){\r\n\t\t\t\tfor(var i = 0; i < handlers.length; i++){\r\n\t\t\t\t\tif(!(root || handlers[i].root) || handlers[i].root === root){\r\n\t\t\t\t\t\thandlers[i].handler.apply(this, args);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction onClick(e) {\r\n\t\t\te = e || window.event;\r\n\t\t\tvar id = gantt.locate(e);\r\n\r\n\t\t\tvar handlers = findEventHandlers(e, eventHandlers.click);\r\n\t\t\tvar res = true;\r\n\t\t\tif (id !== null) {\r\n\t\t\t\tres = !gantt.checkEvent(\"onTaskClick\") || gantt.callEvent(\"onTaskClick\", [id, e]);\r\n\t\t\t} else {\r\n\t\t\t\tgantt.callEvent(\"onEmptyClick\", [e]);\r\n\t\t\t}\r\n\r\n\t\t\tif (res) {\r\n\t\t\t\tvar default_action = callEventHandlers(handlers, e, id);\r\n\t\t\t\tif (!default_action)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t// GS-1025: if we don't do that, the dropdown or date select will be closed for unselected tasks\r\n\t\t\t\t// GS-1078: or for the built-in select inline editor\r\n\t\t\t\tswitch(e.target.nodeName) {\r\n\t\t\t\t\tcase \"SELECT\":\r\n\t\t\t\t\tcase 'INPUT':\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//allow task selection when the multiselect plugin is not enabled\r\n\t\t\t\tif (id && gantt.getTask(id) && !gantt._multiselect && gantt.config.select_task) {\r\n\t\t\t\t\tgantt.selectTask(id);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction onContextMenu(e) {\r\n\t\t\te = e || window.event;\r\n\t\t\tvar src = e.target || e.srcElement,\r\n\t\t\t\ttaskId = gantt.locate(src),\r\n\t\t\t\tlinkId = gantt.locate(src, gantt.config.link_attribute);\r\n\r\n\t\t\tvar res = !gantt.checkEvent(\"onContextMenu\") || gantt.callEvent(\"onContextMenu\", [taskId, linkId, e]);\r\n\t\t\tif (!res) {\r\n\t\t\t\tif (e.preventDefault)\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\telse\r\n\t\t\t\t\te.returnValue = false;\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t}\r\n\r\n\t\tfunction findEventHandlers(e, hash){\r\n\t\t\tvar trg = e.target || e.srcElement;\r\n\t\t\tvar handlers = [];\r\n\t\t\twhile (trg) {\r\n\t\t\t\tvar css = domHelpers.getClassName(trg);\r\n\t\t\t\tif (css) {\r\n\t\t\t\t\tcss = css.split(\" \");\r\n\t\t\t\t\tfor (var i = 0; i < css.length; i++) {\r\n\t\t\t\t\t\tif (!css[i]) continue;\r\n\t\t\t\t\t\tif (hash[css[i]]) {\r\n\t\t\t\t\t\t\tvar delegateHandlers = hash[css[i]];\r\n\r\n\t\t\t\t\t\t\tfor(var h = 0; h < delegateHandlers.length; h++){\r\n\t\t\t\t\t\t\t\tif(delegateHandlers[h].root){\r\n\t\t\t\t\t\t\t\t\tif(!domHelpers.isChildOf(trg, delegateHandlers[h].root)){\r\n\t\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\thandlers.push(delegateHandlers[h].handler);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\ttrg = trg.parentNode;\r\n\t\t\t}\r\n\t\t\treturn handlers;\r\n\t\t}\r\n\r\n\t\tfunction callEventHandlers(handlers, e, id){\r\n\t\t\tvar res = true;\r\n\r\n\t\t\tfor(var i = 0; i < handlers.length; i++){\r\n\t\t\t\tvar handlerResult =  handlers[i].call(gantt, e, id, e.target || e.srcElement);\r\n\t\t\t\tres = res && !(typeof handlerResult != \"undefined\" && handlerResult !== true);\r\n\t\t\t}\r\n\r\n\t\t\treturn res;\r\n\t\t}\r\n\r\n\r\n\t\tfunction onDoubleClick(e) {\r\n\t\t\te = e || window.event;\r\n\t\t\tvar id = gantt.locate(e);\r\n\r\n\t\t\tvar handlers = findEventHandlers(e, eventHandlers.doubleclick);\r\n\t\t\t// when doubleclick fired not on task, id === null\r\n\t\t\tvar res = !gantt.checkEvent(\"onTaskDblClick\") || id === null || gantt.callEvent(\"onTaskDblClick\", [id, e]);\r\n\t\t\tif (res) {\r\n\t\t\t\tvar default_action = callEventHandlers(handlers, e, id);\r\n\t\t\t\tif (!default_action)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tif (id !== null && gantt.getTask(id)) {\r\n\t\t\t\t\tif (res && gantt.config.details_on_dblclick && !gantt.isReadonly(id)) {\r\n\t\t\t\t\t\tgantt.showLightbox(id);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction onMouseMove(e) {\r\n\t\t\tif (gantt.checkEvent(\"onMouseMove\")) {\r\n\t\t\t\tvar id = gantt.locate(e);\r\n\t\t\t\tgantt._last_move_event = e;\r\n\t\t\t\tgantt.callEvent(\"onMouseMove\", [id, e]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction detach(eventName, className, handler, root) {\r\n\t\t\tif (eventHandlers[eventName] && eventHandlers[eventName][className]) {\r\n\t\t\t\tvar handlers = eventHandlers[eventName];\r\n\t\t\t\tvar elementHandlers = handlers[className];\r\n\t\t\t\tfor(var i = 0; i < elementHandlers.length; i++){\r\n\t\t\t\t\tif(elementHandlers[i].root == root){\r\n\t\t\t\t\t\telementHandlers.splice(i, 1);\r\n\t\t\t\t\t\ti--;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(!elementHandlers.length){\r\n\t\t\t\t\tdelete handlers[className];\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar domEvents = gantt._createDomEventScope();\r\n\r\n\t\tfunction reset(node){\r\n\r\n\t\t\tdomEvents.detachAll();\r\n\r\n\t\t\tif(node){\r\n\t\t\t\tdomEvents.attach(node, \"click\", onClick);\r\n\t\t\t\tdomEvents.attach(node, \"dblclick\", onDoubleClick);\r\n\t\t\t\tdomEvents.attach(node, \"mousemove\", onMouseMove);\r\n\t\t\t\tdomEvents.attach(node, \"contextmenu\", onContextMenu);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\r\n\t\treturn {\r\n\t\t\treset: reset,\r\n\t\t\tglobal: function(event, classname, handler){\r\n\t\t\t\taddEventTarget(event, classname, handler, null);\r\n\t\t\t},\r\n\t\t\tdelegate: addEventTarget,\r\n\t\t\tdetach: detach,\r\n\t\t\tcallHandler: callHandler,\r\n\t\t\tonDoubleClick: onDoubleClick,\r\n\t\t\tonMouseMove: onMouseMove,\r\n\t\t\tonContextMenu: onContextMenu,\r\n\t\t\tonClick: onClick,\r\n\t\t\tdestructor: function(){\r\n\t\t\t\treset();\r\n\t\t\t\teventHandlers = null;\r\n\t\t\t\tdomEvents = null;\r\n\t\t\t}\r\n\r\n\t\t};\r\n\t};\r\n\r\n})(domHelpers);\r\n\r\n\r\nexport default {\r\n\tinit:createMouseHandler\r\n};","export default function(viewport, box, gantt){\r\n\tif(!box){\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif(box.left > viewport.x_end || box.left + box.width < viewport.x){\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif(box.top > viewport.y_end || box.top + box.height < viewport.y){\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\treturn true;\r\n};","export default function(gantt){\r\n\treturn gantt.config.smart_rendering && gantt._smart_render;\r\n};","export default function(item, view, config){\r\n\treturn {\r\n\t\ttop: view.getItemTop(item.id),\r\n\t\theight: view.getItemHeight(item.id),\r\n\t\tleft: 0,\r\n\t\tright: Infinity\r\n\t};\r\n};","export default function getVisibleTasksRange(gantt, view, config, datastore, viewport){\r\n\tvar buffer = 1;\r\n\tvar start = view.getItemIndexByTopPosition(viewport.y) || 0;\r\n\tvar end = view.getItemIndexByTopPosition(viewport.y_end) || datastore.count();\r\n\tvar indexStart = Math.max(0, start - buffer);\r\n\tvar indexEnd =  Math.min(datastore.count(), end + buffer);\r\n\t// GS-2481 and GS-1715, need to take into account selected task when using keyboard shortcuts and when the inline editor is opened \r\n\tconst extraTasksIds= [];\r\n\tif (gantt.config.keyboard_navigation && gantt.getSelectedId()) {\r\n\t\tlet task = gantt.getTask(gantt.getSelectedId());\r\n\t\t//GS-2661: selected task might be collapsed\r\n\t\tif(task.$expanded_branch) {\r\n\t\t\textraTasksIds.push(gantt.getSelectedId());\r\n\t\t}\r\n\t}\r\n\tif (gantt.$ui.getView(\"grid\") && gantt.ext.inlineEditors && gantt.ext.inlineEditors.getState().id) {\r\n\t\tlet inlineEditorId = gantt.ext.inlineEditors.getState().id;\r\n\t\tif (datastore.exists(inlineEditorId)){\r\n\t\t\textraTasksIds.push(inlineEditorId);\r\n\t\t}\r\n\t}\r\n\treturn {\r\n\t\tstart: indexStart,\r\n\t\tend: indexEnd,\r\n\t\tids: extraTasksIds \r\n\t};\r\n};","import genericViewPortChecker from \"./viewport/is_in_viewport\";\r\nimport isLegacyRender from \"./is_legacy_smart_render\";\r\nimport basicGetRectangle from \"./viewport/get_grid_row_rectangle\";\r\nimport basicGetRange from \"./viewport/get_visible_bars_range\";\r\nvar rendererFactory = function(gantt){\r\n\r\n\t//hash of dom elements is needed to redraw single bar/link\r\n\tvar task_area_pulls = {},\r\n\t\ttask_area_renderers = {};\r\n\r\n\tfunction getView(layer){\r\n\t\tvar view = null;\r\n\t\tif (typeof layer.view === \"string\") {\r\n\t\t\tview = gantt.$ui.getView(layer.view);\r\n\t\t} else if (layer.view) {\r\n\t\t\tview = layer.view;\r\n\t\t}\r\n\t\treturn view;\r\n\t}\r\n\r\n\tfunction getRenderer(id, layer, node) {\r\n\t\t\r\n\t\tif (task_area_renderers[id])\r\n\t\t\treturn task_area_renderers[id];\r\n\r\n\t\tif (!layer.renderer)\r\n\t\t\tgantt.assert(false, \"Invalid renderer call\");\r\n\r\n\t\tvar renderMethod = null;\r\n\t\tvar updateMethod = null;\r\n\t\tvar getRectangle = null;\r\n\t\tvar renderCallbackMethod = null;\r\n\t\tvar specializedViewPortChecker = null;\r\n\r\n\t\tif(typeof layer.renderer === \"function\"){\r\n\t\t\trenderMethod = layer.renderer;\r\n\t\t\tgetRectangle = basicGetRectangle;\r\n\t\t}else{\r\n\t\t\trenderMethod = layer.renderer.render;\r\n\t\t\tupdateMethod = layer.renderer.update;\r\n\t\t\trenderCallbackMethod = layer.renderer.onrender;\r\n\t\t\t\r\n\t\t\tif(layer.renderer.isInViewPort){\r\n\t\t\t\tspecializedViewPortChecker = layer.renderer.isInViewPort;\r\n\t\t\t}else{\r\n\t\t\t\tgetRectangle = layer.renderer.getRectangle;\r\n\t\t\t}\r\n\r\n\t\t\tif (!getRectangle && getRectangle !== null) {\r\n\t\t\t\tgetRectangle = basicGetRectangle;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar filter = layer.filter;\r\n\r\n\t\tif (node)\r\n\t\t\tnode.setAttribute(gantt.config.layer_attribute, true);\r\n\r\n\t\ttask_area_renderers[id] = {\r\n\t\t\trender_item: function (item, container, viewPort, layerView, viewConfig) {\r\n\t\t\t\tcontainer = container || node;\r\n\t\t\t\tif (filter) {\r\n\t\t\t\t\tif (!filter(item)) {\r\n\t\t\t\t\t\tthis.remove_item(item.id);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar view = layerView || getView(layer);\r\n\t\t\t\tvar config = viewConfig || (view ? view.$getConfig() : null);\r\n\t\t\t\tvar rendererViewPort = viewPort;\r\n\t\t\t\tif(!rendererViewPort && config && config.smart_rendering){\r\n\t\t\t\t\trendererViewPort = view.getViewPort();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar dom = null;\r\n\t\t\t\tif(!isLegacyRender(gantt) && (getRectangle || specializedViewPortChecker) && rendererViewPort){\r\n\t\t\t\t\tvar isVisible = false;\r\n\t\t\t\t\tif(specializedViewPortChecker){\r\n\t\t\t\t\t\tisVisible = specializedViewPortChecker(item, rendererViewPort, view, config, gantt);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tisVisible = genericViewPortChecker(rendererViewPort, getRectangle(item, view, config, gantt), gantt);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(isVisible){\r\n\t\t\t\t\t\tdom = renderMethod.call(gantt, item, view, config, rendererViewPort);\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdom = renderMethod.call(gantt, item, view, config, rendererViewPort);\r\n\t\t\t\t}\r\n\t\t\t\tthis.append(item, dom, container);\r\n\r\n\t\t\t\tvar useBuffer = container.nodeType == 11;//DocumentFragment\r\n\t\t\t\tif(renderCallbackMethod && !useBuffer && dom) {\r\n\t\t\t\t\trenderCallbackMethod.call(gantt, item, dom, view);\r\n\t\t\t\t} \r\n\t\t\t},\r\n\r\n\t\t\tclear: function (container) {\r\n\r\n\t\t\t\tthis.rendered = task_area_pulls[id] = {};\r\n\t\t\t\tif(!layer.append)\r\n\t\t\t\t\tthis.clear_container(container);\r\n\t\t\t},\r\n\t\t\tclear_container: function (container) {\r\n\t\t\t\tcontainer = container || node;\r\n\t\t\t\tif (container){\r\n\t\t\t\t\tcontainer.innerHTML = \"\";\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tget_visible_range: function(datastore){\r\n\t\t\t\tvar view = getView(layer);\r\n\t\t\t\tvar viewport;\r\n\t\t\t\tvar viewConfig = view ? view.$getConfig() : null;\r\n\t\t\t\tif(viewConfig && viewConfig.smart_rendering){\r\n\t\t\t\t\tviewport = view.getViewPort();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar range;\r\n\t\t\t\tif(view && viewport){\r\n\t\t\t\t\tif(typeof layer.renderer === \"function\"){\r\n\t\t\t\t\t\trange = basicGetRange(gantt, view, viewConfig, datastore, viewport);\r\n\t\t\t\t\t}else if(layer.renderer && layer.renderer.getVisibleRange){\r\n\t\t\t\t\t\trange = layer.renderer.getVisibleRange(gantt, view, viewConfig, datastore, viewport);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(!range){\r\n\t\t\t\t\trange = {\r\n\t\t\t\t\t\tstart: 0,\r\n\t\t\t\t\t\tend: datastore.count()\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn range;\r\n\t\t\t},\r\n\t\t\tprepare_data: function(items){\r\n\t\t\t\tif(layer.renderer && layer.renderer.prepareData){\r\n\t\t\t\t\treturn layer.renderer.prepareData(items, gantt, layer);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\trender_items: function (items, container) {\r\n\t\t\t\tcontainer = container || node;\r\n\r\n\t\t\t\tvar buffer = document.createDocumentFragment();\r\n\t\t\t\tthis.clear(container);\r\n\r\n\t\t\t\tvar viewPort = null;\r\n\t\t\t\tvar view = getView(layer);\r\n\t\t\t\tvar viewConfig = view ? view.$getConfig() : null;\r\n\t\t\t\tif(viewConfig && viewConfig.smart_rendering){\r\n\t\t\t\t\tviewPort = view.getViewPort();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (var i = 0, vis = items.length; i < vis; i++) {\r\n\t\t\t\t\tthis.render_item(items[i], buffer, viewPort, view, viewConfig);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontainer.appendChild(buffer, container);\r\n\r\n\t\t\t\tvar itemsSearch = {};\r\n\t\t\t\titems.forEach(function(item){\r\n\t\t\t\t\titemsSearch[item.id] = item;\r\n\t\t\t\t});\r\n\t\t\t\tvar renderedItems = {};\r\n\t\t\t\tif (renderCallbackMethod) {\r\n\t\t\t\t\tvar newElements = {};\r\n\t\t\t\t\tfor(var i in this.rendered) {\r\n\t\t\t\t\t\tif(!renderedItems[i]){\r\n\t\t\t\t\t\t\tnewElements[i] = this.rendered[i];\r\n\t\t\t\t\t\t\trenderCallbackMethod.call(gantt, itemsSearch[i], this.rendered[i], view);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tupdate_items: function (items, container) {\r\n\t\t\t\tvar view = getView(layer);\r\n\t\t\t\tvar viewConfig = view ? view.$getConfig() : null;\r\n\t\t\t\tif(!view || !view.$getConfig().smart_rendering || isLegacyRender(gantt)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!this.rendered){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!(getRectangle || specializedViewPortChecker)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontainer = container || node;\r\n\r\n\t\t\t\tvar buffer = document.createDocumentFragment();\r\n\r\n\t\t\t\tvar viewPort = null;\r\n\t\t\t\tif(view){\r\n\t\t\t\t\tviewPort = view.getViewPort();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar itemsSearch = {};\r\n\t\t\t\titems.forEach(function(item){\r\n\t\t\t\t\titemsSearch[item.id] = item;\r\n\t\t\t\t});\r\n\t\t\t\tvar renderedItems = {};\r\n\r\n\t\t\t\tvar nodesToRemove = {};\r\n\t\t\t\tfor(var i in this.rendered){\r\n\t\t\t\t\tnodesToRemove[i] = true;\r\n\t\t\t\t\trenderedItems[i] = true;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvar renderCalledFor = {};\r\n\t\t\t\tfor (var i = 0, vis = items.length; i < vis; i++) {\r\n\t\t\t\t\tvar item = items[i];\r\n\t\t\t\t\tvar itemNode = this.rendered[item.id];\r\n\t\t\t\t\tnodesToRemove[item.id] = false;\r\n\t\t\t\t\tif (itemNode && itemNode.parentNode) {\r\n\t\t\t\t\t\tvar isVisible = false;\r\n\t\t\t\t\t\tif(specializedViewPortChecker){\r\n\t\t\t\t\t\t\tisVisible = specializedViewPortChecker(item, viewPort, view, viewConfig, gantt);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tisVisible = genericViewPortChecker(viewPort, getRectangle(item, view, viewConfig, gantt), gantt);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (!isVisible) {\r\n\t\t\t\t\t\t\tnodesToRemove[item.id] = true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif(updateMethod){\r\n\t\t\t\t\t\t\t\tupdateMethod.call(gantt, item, itemNode, view, viewConfig, viewPort);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis.restore(item, buffer);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trenderCalledFor[items[i].id] = true;\r\n\t\t\t\t\t\tthis.render_item(items[i], buffer, viewPort, view, viewConfig);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor(var i in nodesToRemove){\r\n\t\t\t\t\tif(nodesToRemove[i]){\r\n\t\t\t\t\t\tthis.hide(i);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(buffer.childNodes.length){\r\n\t\t\t\t\tcontainer.appendChild(buffer, container);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (renderCallbackMethod) {\r\n\t\t\t\t\tvar newElements = {};\r\n\t\t\t\t\tfor(var i in this.rendered) {\r\n\t\t\t\t\t\tif(!renderedItems[i] || renderCalledFor[i]){\r\n\t\t\t\t\t\t\tnewElements[i] = this.rendered[i];\r\n\t\t\t\t\t\t\trenderCallbackMethod.call(gantt, itemsSearch[i], this.rendered[i], view);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tappend: function (item, node, container) {\r\n\t\t\t\tif(!this.rendered){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!node) {\r\n\t\t\t\t\tif (this.rendered[item.id]) {\r\n\t\t\t\t\t\tthis.remove_item(item.id);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.rendered[item.id] && this.rendered[item.id].parentNode) {\r\n\t\t\t\t\tthis.replace_item(item.id, node);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcontainer.appendChild(node);\r\n\t\t\t\t}\r\n\t\t\t\tthis.rendered[item.id] = node;\r\n\t\t\t},\r\n\t\t\treplace_item: function (item_id, newNode) {\r\n\t\t\t\tvar item = this.rendered[item_id];\r\n\t\t\t\tif (item && item.parentNode) {\r\n\t\t\t\t\titem.parentNode.replaceChild(newNode, item);\r\n\r\n\t\t\t\t}\r\n\t\t\t\tthis.rendered[item_id] = newNode;\r\n\t\t\t},\r\n\t\t\tremove_item: function (item_id) {\r\n\t\t\t\tthis.hide(item_id);\r\n\t\t\t\tdelete this.rendered[item_id];\r\n\t\t\t},\r\n\t\t\thide: function (item_id) {\r\n\t\t\t\tvar item = this.rendered[item_id];\r\n\t\t\t\tif (item && item.parentNode) {\r\n\t\t\t\t\titem.parentNode.removeChild(item);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\trestore: function (item, container) {\r\n\t\t\t\tvar dom = this.rendered[item.id];\r\n\t\t\t\tif (dom) {\r\n\t\t\t\t\tif (!dom.parentNode) {\r\n\t\t\t\t\t\tthis.append(item, dom, container || node);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.render_item(item, container || node);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tchange_id: function (oldid, newid) {\r\n\t\t\t\tthis.rendered[newid] = this.rendered[oldid];\r\n\t\t\t\tdelete this.rendered[oldid];\r\n\t\t\t},\r\n\t\t\trendered: task_area_pulls[id],\r\n\t\t\tnode: node,\r\n\t\t\tdestructor: function () {\r\n\t\t\t\tthis.clear();\r\n\t\t\t\tdelete task_area_renderers[id];\r\n\t\t\t\tdelete task_area_pulls[id];\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\treturn task_area_renderers[id];\r\n\t}\r\n\r\n\r\n\tfunction clearRenderers() {\r\n\t\tfor (var i in task_area_renderers) {\r\n\t\t\tgetRenderer(i).destructor();\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\tgetRenderer: getRenderer,\r\n\t\tclearRenderers: clearRenderers\r\n\t};\r\n\r\n};\r\n\r\nexport default rendererFactory;","import renderFactoryProvider from \"./render_factory\";\r\nimport * as utils from \"../../../utils/utils\";\r\nimport * as domHelpers from \"../utils/dom_helpers\";\r\nimport isLegacyRender from \"./is_legacy_smart_render\";\r\n\r\nvar layerFactory = function(gantt){\r\n\r\n\tvar renderFactory = renderFactoryProvider(gantt);\r\n\treturn {\r\n\tcreateGroup: function (getContainer, relativeRoot, defaultFilters, initLayer) {\r\n\r\n\t\tvar renderGroup = {\r\n\t\t\ttempCollection: [],\r\n\t\t\trenderers: {},\r\n\t\t\tcontainer: getContainer,\r\n\t\t\tfilters: [],\r\n\t\t\tgetLayers: function () {\r\n\t\t\t\tthis._add();// add pending layers\r\n\r\n\t\t\t\tvar res = [];\r\n\t\t\t\tfor (var i in this.renderers) {\r\n\t\t\t\t\tres.push(this.renderers[i]);\r\n\t\t\t\t}\r\n\t\t\t\treturn res;\r\n\t\t\t},\r\n\t\t\tgetLayer: function (id) {\r\n\t\t\t\treturn this.renderers[id];\r\n\t\t\t},\r\n\t\t\t_add: function (layer) {\r\n\t\t\t\tif (layer) {\r\n\t\t\t\t\tlayer.id = layer.id || utils.uid();\r\n\t\t\t\t\tthis.tempCollection.push(layer);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar container = this.container();\r\n\r\n\t\t\t\tvar pending = this.tempCollection;\r\n\t\t\t\tfor (var i = 0; i < pending.length; i++) {\r\n\t\t\t\t\tlayer = pending[i];\r\n\r\n\t\t\t\t\tif (!this.container() && !(layer && layer.container && domHelpers.isChildOf(layer.container, document.body))) continue;\r\n\r\n\t\t\t\t\tvar node = layer.container,\r\n\t\t\t\t\t\tid = layer.id,\r\n\t\t\t\t\t\ttopmost = layer.topmost;\r\n\t\t\t\t\tif (!node.parentNode) {\r\n\t\t\t\t\t\t//insert on top or below the tasks\r\n\t\t\t\t\t\tif (topmost) {\r\n\t\t\t\t\t\t\tcontainer.appendChild(node);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar rel = relativeRoot ? relativeRoot() : container.firstChild;\r\n\t\t\t\t\t\t\t// GS-1274: if we don't add the second check, Gantt stops working if\r\n\t\t\t\t\t\t\t// we add the task layer without the timeline and switch to a layout with the timeline\r\n\t\t\t\t\t\t\tif (rel && rel.parentNode == container)\r\n\t\t\t\t\t\t\t\tcontainer.insertBefore(node, rel);\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tcontainer.appendChild(node);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.renderers[id] = renderFactory.getRenderer(\r\n\t\t\t\t\t\tid,\r\n\t\t\t\t\t\tlayer,\r\n\t\t\t\t\t\tnode\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tif (initLayer) {\r\n\t\t\t\t\t\tinitLayer(layer, gantt);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.tempCollection.splice(i, 1);\r\n\t\t\t\t\ti--;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\taddLayer: function (config) {\r\n\t\t\t\tif(config){\r\n\t\t\t\t\tif(typeof config == \"function\"){\r\n\t\t\t\t\t\tconfig = {renderer: config};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(config.filter === undefined){\r\n\t\t\t\t\t\tconfig.filter = mergeFilters(defaultFilters || []);\r\n\t\t\t\t\t}else if(config.filter instanceof Array){\r\n\t\t\t\t\t\tconfig.filter.push(defaultFilters);\r\n\t\t\t\t\t\tconfig.filter = mergeFilters(config.filter);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(!config.container){\r\n\t\t\t\t\t\tconfig.container = document.createElement(\"div\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tconfig.requestUpdate = function(){\r\n\t\t\t\t\t\tif(gantt.config.smart_rendering && !isLegacyRender(gantt)){\r\n\t\t\t\t\t\t\tif(self.renderers[config.id]){\r\n\t\t\t\t\t\t\t\tself.onUpdateRequest(self.renderers[config.id]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._add(config);\r\n\t\t\t\treturn (config ? config.id : undefined);\r\n\t\t\t},\r\n\t\t\tonUpdateRequest: function(layer){\r\n\r\n\t\t\t},\r\n\r\n\t\t\teachLayer: function(code){\r\n\t\t\t\tfor (var i in this.renderers) {\r\n\t\t\t\t\tcode(this.renderers[i]);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tremoveLayer: function (id) {\r\n\t\t\t\tif(!this.renderers[id])\r\n\t\t\t\t\treturn;\r\n\t\t\t\tthis.renderers[id].destructor();\r\n\t\t\t\tdelete this.renderers[id];\r\n\t\t\t},\r\n\t\t\tclear: function () {\r\n\t\t\t\tfor (var i in this.renderers) {\r\n\t\t\t\t\tthis.renderers[i].destructor();\r\n\t\t\t\t}\r\n\t\t\t\tthis.renderers = {};\r\n\t\t\t}//,\r\n\t\t\t//prepareConfig: prepareConfig\r\n\t\t};\r\n\r\n\t\tgantt.attachEvent(\"onDestroy\", function(){\r\n\t\t\trenderGroup.clear();\r\n\t\t\trenderGroup = null;\r\n\t\t});\r\n\r\n\t\treturn renderGroup;\r\n\t}\r\n};};\r\n\r\n\r\nfunction mergeFilters(filter_methods){\r\n\tif(!(filter_methods instanceof Array)){\r\n\t\tfilter_methods = Array.prototype.slice.call(arguments, 0);\r\n\t}\r\n\r\n\treturn function(obj){\r\n\t\tvar res = true;\r\n\t\tfor(var i = 0, len = filter_methods.length; i < len; i++){\r\n\t\t\tvar filter_method = filter_methods[i];\r\n\t\t\tif(filter_method){\r\n\t\t\t\tres = res && (filter_method(obj.id, obj) !== false);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn res;\r\n\t};\r\n}\r\n\r\n\r\nexport default layerFactory;\r\n","export default function(item, view, config){\r\n\tif(!item.start_date || !item.end_date){\r\n\t\treturn null;\r\n\t}\r\n\tvar padding = 200;\r\n\tvar startCoord = view.posFromDate(item.start_date);\r\n\tvar endCoord = view.posFromDate(item.end_date);\r\n\tvar left = Math.min(startCoord, endCoord) - padding;\r\n\tvar right = Math.max(startCoord, endCoord) + padding;\r\n\treturn {\r\n\t\ttop: view.getItemTop(item.id),\r\n\t\theight: view.getItemHeight(item.id),\r\n\t\tleft: left,\r\n\t\twidth: right - left\r\n\t};\r\n};","\r\n\r\nimport barRectangle from \"./get_bar_rectangle\";\r\n\r\nexport default function getLinkBox(item, view, config, gantt){\r\n\tif(!gantt.isTaskExists(item.source)){\r\n\t\treturn null;\r\n\t}\r\n\r\n\tif(!gantt.isTaskExists(item.target)){\r\n\t\treturn null;\r\n\t}\r\n\tvar sourceBox = barRectangle(gantt.getTask(item.source), view, gantt);\r\n\tvar targetBox = barRectangle(gantt.getTask(item.target), view, gantt);\r\n\r\n\tif(!sourceBox || !targetBox){\r\n\t\treturn null;\r\n\t}\r\n\r\n\tvar padding = 100;\r\n\tvar left = Math.min(sourceBox.left, targetBox.left) - padding;\r\n\tvar right = Math.max(sourceBox.left + sourceBox.width, targetBox.left + targetBox.width) + padding;\r\n\tvar top = Math.min(sourceBox.top, targetBox.top) - padding;\r\n\tvar bottom = Math.max(sourceBox.top + sourceBox.height, targetBox.top + targetBox.height) + padding;\r\n\r\n\treturn {\r\n\t\ttop: top,\r\n\t\theight: bottom - top,\r\n\t\tbottom,\r\n\t\tleft: left,\r\n\t\twidth: right - left,\r\n\t\tright\r\n\t};\r\n};\r\n","import getLinkRectangle from \"../get_link_rectangle\";\r\n\r\nexport default function(){\r\n\tvar coordinates = [];\r\n\tvar calculated = false;\r\n\r\n\tfunction clearCache(){\r\n\t\tcoordinates = [];\r\n\t\tcalculated = false;\r\n\t}\r\n\r\n\tfunction buildCache(datastore, view, gantt){\r\n\t\tvar config = view.$getConfig();\r\n\t\tvar visibleItems = datastore.getVisibleItems();\r\n\t\t//datastore.eachItem(function(link){\r\n\t\tvisibleItems.forEach(function(link){\r\n\t\t\tvar rec = getLinkRectangle(link, view, config, gantt);\r\n\t\t\tif(!rec){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tcoordinates.push({id: link.id, rec: rec});\r\n\t\t});\r\n\r\n\t\tcoordinates.sort(function(a, b){\r\n\t\t\tif(a.rec.right < b.rec.right){\r\n\t\t\t\treturn -1;\r\n\t\t\t}else {\r\n\t\t\t\treturn 1;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tcalculated = true;\r\n\t}\r\n\r\n\tvar initialized = false;\r\n\tfunction init(datastore){\r\n\t\tif(initialized){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tinitialized = true;\r\n\t\tdatastore.attachEvent(\"onPreFilter\", clearCache);\r\n\t\tdatastore.attachEvent(\"onStoreUpdated\", clearCache);\r\n\t\tdatastore.attachEvent(\"onClearAll\", clearCache);\r\n\t\tdatastore.attachEvent(\"onBeforeStoreUpdate\", clearCache);\r\n\t}\r\n\r\n\treturn function getVisibleLinksRange(gantt, view, config, datastore, viewport){\r\n\t\tinit(datastore);\r\n\t\tif(!calculated){\r\n\t\t\tbuildCache(datastore, view, gantt);\r\n\t\t}\r\n\r\n\t\tvar visibleBoxes = [];\r\n\t\tfor(var i = 0; i < coordinates.length; i++){\r\n\t\t\tvar item = coordinates[i];\r\n\t\t\tvar box = item.rec;\r\n\t\t\tif(box.right < viewport.x){\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(box.left < viewport.x_end && box.right > viewport.x && box.top < viewport.y_end && box.bottom > viewport.y){\r\n\t\t\t\tvisibleBoxes.push(item.id);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn {\r\n\t\t\tids: visibleBoxes\r\n\t\t};\r\n\t};\r\n};","\r\n// optimized checker for links smart rendering\r\n\r\n// first check the vertical position since it's easier to calculate\r\n\r\nexport default function isLinkInViewPort(item, viewport, view, config, gantt){\r\n\tvar source = view.$gantt.getTask(item.source);\r\n\tvar target = view.$gantt.getTask(item.target);\r\n\t// check vertical visibility first since it's a lighter check\r\n\tvar sourceTop = view.getItemTop(source.id);\r\n\tvar sourceHeight = view.getItemHeight(source.id);\r\n\r\n\tvar targetTop = view.getItemTop(target.id);\r\n\tvar targetHeight = view.getItemHeight(target.id);\r\n\r\n\tif(viewport.y > sourceTop + sourceHeight &&\r\n\t\tviewport.y > targetTop + targetHeight){\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif(viewport.y_end < targetTop &&\r\n\t\tviewport.y_end < sourceTop){\r\n\t\treturn false;\r\n\t}\r\n\r\n\tvar padding = 100;\r\n\tvar sourceLeft = view.posFromDate(source.start_date);\r\n\tvar sourceRight = view.posFromDate(source.end_date);\r\n\tvar targetLeft = view.posFromDate(target.start_date);\r\n\tvar targetRight = view.posFromDate(target.end_date);\r\n\r\n\tif(sourceLeft > sourceRight){\r\n\t\t// rtl\r\n\t\tvar tmp = sourceRight;\r\n\t\tsourceRight = sourceLeft;\r\n\t\tsourceLeft = tmp;\r\n\t}\r\n\tif(targetLeft > targetRight){\r\n\t\t// rtl\r\n\t\tvar tmp = targetRight;\r\n\t\ttargetRight = targetLeft;\r\n\t\ttargetLeft = tmp;\r\n\t}\r\n\tsourceLeft += -padding; // add buffer for custom elements\r\n\tsourceRight += padding;\r\n\ttargetLeft += -padding; // add buffer for custom elements\r\n\ttargetRight += padding;\r\n\r\n\tif(viewport.x > sourceRight &&\r\n\t\tviewport.x > targetRight){\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif(viewport.x_end < sourceLeft &&\r\n\t\tviewport.x_end < targetLeft){\r\n\t\treturn false;\r\n\t}\r\n\treturn true;\r\n};\r\n","import createLayerFactory from \"./render/layer_engine\";\r\n\r\nimport getVisibleTaskRange from \"./render/viewport/get_visible_bars_range\";\r\nimport getVisibleLinksRangeFactory from \"./render/viewport/factory/get_visible_link_range\";\r\n\r\nimport isLinkInViewport from \"./render/viewport/is_link_in_viewport\";\r\n\r\nfunction initLayer(layer, gantt){\r\n\tif(!layer.view){\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar view = layer.view;\r\n\tif(typeof view === \"string\"){\r\n\t\tview = gantt.$ui.getView(view);\r\n\t}\r\n\r\n\tif(view && view.attachEvent){\r\n\t\tview.attachEvent(\"onScroll\", function(){\r\n\t\t\tvar state = gantt.$services.getService(\"state\");\r\n\t\t\t// don't repaint if we're inside batchUpdate, a complete repaint will be called afterwards\r\n\t\t\tif(!state.getState(\"batchUpdate\").batch_update && !view.$config.$skipSmartRenderOnScroll){\r\n\t\t\t\tif(layer.requestUpdate){\r\n\t\t\t\t\tlayer.requestUpdate();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nvar createLayerEngine = function(gantt){\r\n\tvar factory = createLayerFactory(gantt);\r\n\treturn {\r\n\t\tgetDataRender: function(name){\r\n\t\t\treturn gantt.$services.getService(\"layer:\" + name) || null;\r\n\t\t},\r\n\t\tcreateDataRender: function(config){\r\n\t\t\tvar name = config.name,\r\n\t\t\t\tdefaultContainer = config.defaultContainer,\r\n\t\t\t\tpreviusSiblingContainer = config.defaultContainerSibling;\r\n\r\n\t\t\tvar layers = factory.createGroup(\r\n\t\t\t\tdefaultContainer,\r\n\t\t\t\tpreviusSiblingContainer,\r\n\t\t\t\tfunction(itemId, item){\r\n\t\t\t\t\tif(layers.filters){\r\n\t\t\t\t\t\tfor(var i = 0; i < layers.filters.length; i++){\r\n\t\t\t\t\t\t\tif(layers.filters[i](itemId, item) === false){\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tinitLayer\r\n\t\t\t);\r\n\r\n\t\t\tgantt.$services.setService(\"layer:\" + name, function(){\r\n\t\t\t\treturn layers;\r\n\t\t\t});\r\n\r\n\t\t\tgantt.attachEvent(\"onGanttReady\", function () {\r\n\t\t\t\tlayers.addLayer();// init layers on start\r\n\t\t\t});\r\n\r\n\t\t\treturn layers;\r\n\t\t},\r\n\t\tinit: function(){\r\n\t\t\tvar taskLayers = this.createDataRender({\r\n\t\t\t\tname: \"task\",\r\n\t\t\t\tdefaultContainer: function(){\r\n\t\t\t\t\tif(gantt.$task_data){\r\n\t\t\t\t\t\treturn gantt.$task_data;\r\n\t\t\t\t\t}else if(gantt.$ui.getView(\"timeline\")){\r\n\t\t\t\t\t\treturn gantt.$ui.getView(\"timeline\").$task_data;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tdefaultContainerSibling: function(){\r\n\t\t\t\t\tif(gantt.$task_links){\r\n\t\t\t\t\t\treturn gantt.$task_links;\r\n\t\t\t\t\t}else if(gantt.$ui.getView(\"timeline\")){\r\n\t\t\t\t\t\treturn gantt.$ui.getView(\"timeline\").$task_links;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tfilter: function(item){\r\n\r\n\t\t\t\t}\r\n\t\t\t}, gantt);\r\n\r\n\t\t\tvar linkLayers = this.createDataRender({\r\n\t\t\t\tname: \"link\",\r\n\t\t\t\tdefaultContainer: function(){\r\n\t\t\t\t\tif(gantt.$task_data){\r\n\t\t\t\t\t\treturn gantt.$task_data;\r\n\t\t\t\t\t}else if(gantt.$ui.getView(\"timeline\")){\r\n\t\t\t\t\t\treturn gantt.$ui.getView(\"timeline\").$task_data;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, gantt);\r\n\r\n\t\t\treturn {\r\n\t\t\t\taddTaskLayer: function(config){\r\n\t\t\t\t\tconst rangeFunction = getVisibleTaskRange;\r\n\t\t\t\t\tif(typeof config === \"function\"){\r\n\t\t\t\t\t\tconfig = {\r\n\t\t\t\t\t\t\trenderer: {\r\n\t\t\t\t\t\t\t\trender: config,\r\n\t\t\t\t\t\t\t\tgetVisibleRange: rangeFunction\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tif(config.renderer && !config.renderer.getVisibleRange){\r\n\t\t\t\t\t\t\tconfig.renderer.getVisibleRange = rangeFunction;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconfig.view = \"timeline\";\r\n\r\n\t\t\t\t\treturn taskLayers.addLayer(config);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t_getTaskLayers: function(){\r\n\t\t\t\t\treturn taskLayers.getLayers();\r\n\t\t\t\t},\r\n\t\t\t\tremoveTaskLayer: function(id){\r\n\t\t\t\t\ttaskLayers.removeLayer(id);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t_clearTaskLayers: function(){\r\n\t\t\t\t\ttaskLayers.clear();\r\n\t\t\t\t},\r\n\t\t\t\taddLinkLayer: function(config){\r\n\t\t\t\t\tconst rangeFunction = getVisibleLinksRangeFactory();\r\n\t\t\t\t\tif(typeof config === \"function\"){\r\n\t\t\t\t\t\tconfig = {\r\n\t\t\t\t\t\t\trenderer: {\r\n\t\t\t\t\t\t\t\trender: config,\r\n\t\t\t\t\t\t\t\tgetVisibleRange: rangeFunction\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tif(config.renderer && !config.renderer.getVisibleRange){\r\n\t\t\t\t\t\t\tconfig.renderer.getVisibleRange = rangeFunction;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconfig.view = \"timeline\";\r\n\t\t\t\t\tif(config && config.renderer){\r\n\t\t\t\t\t\tif(!config.renderer.getRectangle && !config.renderer.isInViewPort){\r\n\t\t\t\t\t\t\tconfig.renderer.isInViewPort = isLinkInViewport;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn linkLayers.addLayer(config);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t_getLinkLayers: function(){\r\n\t\t\t\t\treturn linkLayers.getLayers();\r\n\t\t\t\t},\r\n\t\t\t\tremoveLinkLayer: function(id){\r\n\t\t\t\t\tlinkLayers.removeLayer(id);\r\n\t\t\t\t},\r\n\r\n\t\t\t\t_clearLinkLayers: function(){\r\n\t\t\t\t\tlinkLayers.clear();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n};\r\n\r\nexport default createLayerEngine;","import * as utils from \"../../../utils/utils\";\r\nimport eventable from \"../../../utils/eventable\";\r\nimport * as domHelpers from \"../utils/dom_helpers\";\r\n\r\nvar Cell = (function () {\r\n\t\"use strict\";\r\n\r\n\tfunction Cell(parent, config, factory, gantt) {\r\n\t\tif (parent) {\r\n\t\t\tthis.$container = domHelpers.toNode(parent);\r\n\t\t\tthis.$parent = parent;\r\n\t\t}\r\n\t\t// save config\r\n\t\tthis.$config = utils.mixin(config, {\r\n\t\t\theaderHeight: 33\r\n\t\t});\r\n\t\tthis.$gantt = gantt;\r\n\t\tthis.$domEvents = gantt._createDomEventScope();\r\n\t\t// set id\r\n\t\tthis.$id = config.id || \"c\" + utils.uid();\r\n\r\n\t\tthis.$name = \"cell\";\r\n\t\tthis.$factory = factory;\r\n\r\n\t\teventable(this);\r\n\r\n\t}\r\n\r\n\tCell.prototype.destructor = function () {\r\n\t\tthis.$parent = this.$container = this.$view = null;\r\n\t\tvar mouse = this.$gantt.$services.getService(\"mouseEvents\");\r\n\t\tmouse.detach(\"click\", \"gantt_header_arrow\", this._headerClickHandler);\r\n\t\tthis.$domEvents.detachAll();\r\n\t\tthis.callEvent(\"onDestroy\", []);\r\n\t\tthis.detachAllEvents();\r\n\t};\r\n\tCell.prototype.cell = function (id) {\r\n\t\treturn null;\r\n\t};\r\n\r\n\tCell.prototype.scrollTo = function(left, top){\r\n\r\n\t\t//GS-333 Add a way to scroll the HTML views:\r\n\t\tvar cell = this.$view;\r\n\t\tif (this.$config.html) cell = this.$view.firstChild;\r\n\r\n\t\tif (left*1 == left){\r\n\t\t\tcell.scrollLeft = left;\r\n\t\t}\r\n\t\tif(top*1 == top){\r\n\t\t\tcell.scrollTop = top;\r\n\t\t}\r\n\t};\r\n\r\n\tCell.prototype.clear = function(){\r\n\t\tthis.getNode().innerHTML = \"\";\r\n\t\tthis.getNode().className = \"gantt_layout_content\";\r\n\t\tthis.getNode().style.padding = \"0\";\r\n\t};\r\n\r\n\tCell.prototype.resize = function (final) {\r\n\t\tif (this.$parent) {\r\n\t\t\treturn this.$parent.resize(final);\r\n\t\t}\r\n\r\n\t\tif(final === false){\r\n\t\t\tthis.$preResize = true;\r\n\t\t}\r\n\r\n\t\tvar topCont = this.$container;\r\n\t\tvar x = topCont.offsetWidth;\r\n\t\tvar y = topCont.offsetHeight;\r\n\t\tvar topSize = this.getSize();\r\n\t\tif (topCont === document.body) {\r\n\t\t\tx = document.body.offsetWidth;\r\n\t\t\ty = document.body.offsetHeight;\r\n\t\t}\r\n\t\tif (x < topSize.minWidth) {\r\n\t\t\tx = topSize.minWidth;\r\n\t\t}\r\n\t\tif (x > topSize.maxWidth) {\r\n\t\t\tx = topSize.maxWidth;\r\n\t\t}\r\n\t\tif (y < topSize.minHeight) {\r\n\t\t\ty = topSize.minHeight;\r\n\t\t}\r\n\t\tif (y > topSize.maxHeight) {\r\n\t\t\ty = topSize.maxHeight;\r\n\t\t}\r\n\t\tthis.setSize(x, y);\r\n\r\n\t\tif(!this.$preResize){\r\n\t\t//\tself.callEvent(\"onResize\", [x, y]);\r\n\t\t}\r\n\t\tthis.$preResize = false;\r\n\t};\r\n\r\n\tCell.prototype.hide = function () {\r\n\t\tthis._hide(true);\r\n\t\tthis.resize();\r\n\t};\r\n\tCell.prototype.show = function (force) {\r\n\t\tthis._hide(false);\r\n\t\tif (force && this.$parent) {\r\n\t\t\tthis.$parent.show();\r\n\t\t}\r\n\t\tthis.resize();\r\n\t};\r\n\tCell.prototype._hide = function (mode) {\r\n\t\tif (mode === true && this.$view.parentNode) {\r\n\t\t\tthis.$view.parentNode.removeChild(this.$view);\r\n\t\t}\r\n\t\telse if (mode === false && !this.$view.parentNode) {\r\n\t\t\tvar index = this.$parent.cellIndex(this.$id);\r\n\t\t\tthis.$parent.moveView(this, index);\r\n\t\t}\r\n\t\tthis.$config.hidden = mode;\r\n\t};\r\n\tCell.prototype.$toHTML = function (content, css) {\r\n\t\tif (content === void 0) { content = \"\"; }\r\n\t\tcss = [(css || \"\"), (this.$config.css || \"\")].join(\" \");\r\n\t\tvar obj = this.$config;\r\n\t\tvar header = \"\";\r\n\t\tif (obj.raw) {\r\n\t\t\tcontent = typeof obj.raw === \"string\" ? obj.raw : \"\";\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (!content) {\r\n\t\t\t\tcontent = \"<div class='gantt_layout_content' \"+(css ? \" class='\"+css+\"' \" : \"\")+\" >\" + (obj.html || \"\") + \"</div>\";\r\n\t\t\t}\r\n\t\t\tif (obj.header) {\r\n\t\t\t\tvar collapseIcon = obj.canCollapse ? \"<div class='gantt_layout_header_arrow'></div>\" : \"\";\r\n\t\t\t\theader = \"<div class='gantt_layout_header'>\" + collapseIcon + \"<div class='gantt_layout_header_content'>\" + obj.header + \"</div></div>\";\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn \"<div class='gantt_layout_cell \" + css + \"' data-cell-id='\" + this.$id + \"'>\" + header + content + \"</div>\";\r\n\t};\r\n\tCell.prototype.$fill = function (node, parent) {\r\n\t\tthis.$view = node;\r\n\t\tthis.$parent = parent;\r\n\t\tthis.init();\r\n\t};\r\n\tCell.prototype.getNode = function () {\r\n\t\treturn (this.$view.querySelector(\"gantt_layout_cell\") || this.$view);\r\n\t};\r\n\tCell.prototype.init = function () {\r\n\t\t// [NOT-GOOD] code is executed for each component, while it still has only one handler, it is no good\r\n\r\n\t\tvar self = this;\r\n\r\n\t\tthis._headerClickHandler = function(e){\r\n\t\t\tvar cellId = domHelpers.locateAttribute(e, \"data-cell-id\");\r\n\t\t\tif(cellId == self.$id){\r\n\t\t\t\tself.toggle();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar mouse = this.$gantt.$services.getService(\"mouseEvents\");\r\n\t\tmouse.delegate(\"click\", \"gantt_header_arrow\", this._headerClickHandler);\r\n\r\n\t\tthis.callEvent(\"onReady\", []);\r\n\t};\r\n\tCell.prototype.toggle = function () {\r\n\t\tthis.$config.collapsed = !this.$config.collapsed;\r\n\t\tthis.resize();\r\n\t};\r\n\tCell.prototype.getSize = function () {\r\n\t\tvar size = {\r\n\t\t\theight: this.$config.height || 0,\r\n\t\t\twidth: this.$config.width || 0,\r\n\t\t\tgravity: this.$config.gravity || 1,\r\n\t\t\tminHeight: this.$config.minHeight || 0,\r\n\t\t\tminWidth: this.$config.minWidth || 0,\r\n\t\t\tmaxHeight: this.$config.maxHeight || 100000000000,\r\n\t\t\tmaxWidth: this.$config.maxWidth || 100000000000\r\n\t\t};\r\n\t\tif (this.$config.collapsed) {\r\n\t\t\tvar mode = this.$config.mode === \"x\";\r\n\t\t\tsize[mode ? \"width\" : \"height\"] = size[mode ? \"maxWidth\" : \"maxHeight\"] = this.$config.headerHeight;\r\n\t\t}\r\n\t\treturn size;\r\n\t};\r\n\r\n\tCell.prototype.getContentSize = function(){\r\n\r\n\t\tvar width = this.$lastSize.contentX;\r\n\t\tif(width !== width*1){\r\n\t\t\twidth = this.$lastSize.width;\r\n\t\t}\r\n\r\n\t\tvar height = this.$lastSize.contentY;\r\n\t\tif(height !== height*1){\r\n\t\t\theight = this.$lastSize.height;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\twidth: width,\r\n\t\t\theight: height\r\n\t\t};\r\n\t};\r\n\r\n\tCell.prototype._getBorderSizes = function(){\r\n\t\tvar borders = {\r\n\t\t\ttop: 0,\r\n\t\t\tright: 0,\r\n\t\t\tbottom: 0,\r\n\t\t\tleft: 0,\r\n\t\t\thorizontal: 0,\r\n\t\t\tvertical: 0\r\n\t\t};\r\n\t\tif(this._currentBorders){\r\n\t\t\tif(this._currentBorders[this._borders.left]){\r\n\t\t\t\tborders.left = 1;\r\n\t\t\t\tborders.horizontal++;\r\n\t\t\t}\r\n\r\n\t\t\tif(this._currentBorders[this._borders.right]){\r\n\t\t\t\tborders.right = 1;\r\n\t\t\t\tborders.horizontal++;\r\n\t\t\t}\r\n\r\n\t\t\tif(this._currentBorders[this._borders.top]){\r\n\t\t\t\tborders.top = 1;\r\n\t\t\t\tborders.vertical++;\r\n\t\t\t}\r\n\r\n\t\t\tif(this._currentBorders[this._borders.bottom]){\r\n\t\t\t\tborders.bottom = 1;\r\n\t\t\t\tborders.vertical++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn borders;\r\n\r\n\t};\r\n\r\n\tCell.prototype.setSize = function (x, y) {\r\n\t\tthis.$view.style.width = x + \"px\";\r\n\t\tthis.$view.style.height = y + \"px\";\r\n\r\n\t\tvar borders = this._getBorderSizes();\r\n\t\tvar contentY = y - borders.vertical;\r\n\t\tvar contentX = x - borders.horizontal;\r\n\r\n\t\tthis.$lastSize = { x: x, y: y, contentX: contentX, contentY: contentY };\r\n\t\tif (this.$config.header) {\r\n\t\t\tthis._sizeHeader();\r\n\t\t}else{\r\n\t\t\tthis._sizeContent();\r\n\t\t}\r\n\t};\r\n\r\n\tCell.prototype._borders = {\r\n\t\t\"left\":\"gantt_layout_cell_border_left\",\r\n\t\t\"right\":\"gantt_layout_cell_border_right\",\r\n\t\t\"top\":\"gantt_layout_cell_border_top\",\r\n\t\t\"bottom\":\"gantt_layout_cell_border_bottom\"\r\n\t};\r\n\r\n\tCell.prototype._setBorders = function(css, view){\r\n\t\tif(!view) {\r\n\t\t\tview = this;\r\n\t\t}\r\n\t\tvar node = view.$view;\r\n\r\n\t\tfor( var i in this._borders){\r\n\t\t\tdomHelpers.removeClassName(node, this._borders[i]);\r\n\t\t}\r\n\r\n\t\tif(typeof css == \"string\"){\r\n\t\t\tcss = [css];\r\n\t\t}\r\n\r\n\t\tvar cssHash = {};\r\n\r\n\t\tfor(var i = 0; i < css.length; i++){\r\n\t\t\tdomHelpers.addClassName(node, css[i]);\r\n\t\t\tcssHash[css[i]] = true;\r\n\t\t}\r\n\r\n\t\tview._currentBorders = cssHash;\r\n\t};\r\n\r\n\r\n\tCell.prototype._sizeContent = function(){\r\n\t\tvar content = this.$view.childNodes[0];\r\n\t\tif(content && content.className == \"gantt_layout_content\"){\r\n\t\t\tcontent.style.height = this.$lastSize.contentY + \"px\";\r\n\t\t}\r\n\t};\r\n\r\n\tCell.prototype._sizeHeader = function () {\r\n\t\tvar size = this.$lastSize;\r\n\t\tsize.contentY -= this.$config.headerHeight;\r\n\t\tvar header = this.$view.childNodes[0];\r\n\t\tvar content = this.$view.childNodes[1];\r\n\t\tvar xLayout = this.$config.mode === \"x\";\r\n\t\tif (this.$config.collapsed) {\r\n\t\t\tcontent.style.display = \"none\";\r\n\t\t\tif (xLayout) {\r\n\t\t\t\theader.className = \"gantt_layout_header collapsed_x\";\r\n\t\t\t\theader.style.width = size.y + \"px\";\r\n\t\t\t\tvar d = Math.floor(size.y / 2 - size.x / 2);\r\n\t\t\t\theader.style.transform = \"rotate(90deg) translate(\" + d + \"px, \" + d + \"px)\";\r\n\t\t\t\tcontent.style.display = \"none\";\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\theader.className = \"gantt_layout_header collapsed_y\";\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (xLayout) {\r\n\t\t\t\theader.className = \"gantt_layout_header\";\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\theader.className = \"gantt_layout_header vertical\";\r\n\t\t\t}\r\n\t\t\theader.style.width = 'auto';\r\n\t\t\theader.style.transform = '';\r\n\t\t\tcontent.style.display = \"\";\r\n\t\t\tcontent.style.height = size.contentY + \"px\";\r\n\t\t}\r\n\t\theader.style.height = this.$config.headerHeight + \"px\";\r\n\t};\r\n\treturn Cell;\r\n}());\r\n\r\nexport default Cell;\r\n","export default function (d, b) {\r\n\tfor (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n\tfunction __() { this.constructor = d; }\r\n\td.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n};","import __extends from \"../../../utils/extends\";\r\nimport * as domHelpers from \"../utils/dom_helpers\";\r\nimport Cell from \"./cell\";\r\n\r\nvar Layout = (function (_super) {\r\n\t\"use strict\";\r\n\r\n\t__extends(Layout, _super);\r\n\tfunction Layout(parent, config, factory) {\r\n\t\tvar _this = _super.apply(this, arguments) || this;\r\n\r\n\t\tif(parent)\r\n\t\t\t_this.$root = true;\r\n\r\n\t\t_this._parseConfig(config);\r\n\t\t_this.$name = \"layout\";\r\n\t\treturn _this;\r\n\t}\r\n\r\n\tLayout.prototype.destructor = function () {\r\n\t\tif (this.$container && this.$view) {\r\n\t\t\tdomHelpers.removeNode(this.$view);\r\n\t\t}\r\n\r\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\t\t\tvar child = this.$cells[i];\r\n\t\t\tchild.destructor();\r\n\t\t}\r\n\t\tthis.$cells = [];\r\n\r\n\t\t_super.prototype.destructor.call(this);\r\n\t};\r\n\r\n\tLayout.prototype._resizeScrollbars = function(autosize, scrollbars){\r\n\t\tvar scrollChanged = false;\r\n\t\tvar visibleScrollbars = [],\r\n\t\t\thiddenScrollbars = [];\r\n\r\n\t\tconst scrollbarsToHide = [];\r\n\r\n\t\tfunction showScrollbar(scrollbar){\r\n\t\t\tscrollbar.$parent.show();\r\n\t\t\tscrollChanged = true;\r\n\t\t\tvisibleScrollbars.push(scrollbar);\r\n\t\t}\r\n\t\tfunction hideScrollbar(scrollbar){\r\n\t\t\tscrollbar.$parent.hide();\r\n\t\t\tscrollChanged = true;\r\n\t\t\thiddenScrollbars.push(scrollbar);\r\n\t\t}\r\n\r\n\t\tvar scrollbar;\r\n\t\tfor(var i = 0; i < scrollbars.length; i++){\r\n\t\t\tscrollbar = scrollbars[i];\r\n\r\n\t\t\tif(autosize[scrollbar.$config.scroll]) {\r\n\t\t\t\thideScrollbar(scrollbar);\r\n\t\t\t}else if(scrollbar.shouldHide()){\r\n\t\t\t\t//hideScrollbar(scrollbar);\r\n\t\t\t\tscrollbarsToHide.push(scrollbar);\r\n\t\t\t}else if(scrollbar.shouldShow()){\r\n\t\t\t\tshowScrollbar(scrollbar);\r\n\t\t\t}else{\r\n\t\t\t\tif(scrollbar.isVisible()){\r\n\t\t\t\t\tvisibleScrollbars.push(scrollbar);\r\n\t\t\t\t}else{\r\n\t\t\t\t\thiddenScrollbars.push(scrollbar);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar visibleGroups = {};\r\n\t\tfor(var i = 0; i < visibleScrollbars.length; i++){\r\n\t\t\tif(visibleScrollbars[i].$config.group){\r\n\t\t\t\tvisibleGroups[visibleScrollbars[i].$config.group] = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// GS-2220\r\n\t\tscrollbarsToHide.forEach(function(scrollbar){\r\n\t\t\tif(!(scrollbar.$config.group && visibleGroups[scrollbar.$config.group])){\r\n\t\t\t\thideScrollbar(scrollbar);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfor(var i = 0; i < hiddenScrollbars.length; i++){\r\n\t\t\tscrollbar = hiddenScrollbars[i];\r\n\r\n\t\t\tif(scrollbar.$config.group && visibleGroups[scrollbar.$config.group]){\r\n\t\t\t\tshowScrollbar(scrollbar);\r\n\t\t\t\t// GS-707 If the scrollbar was hidden then showed, the container resize shouldn't happen because of that\r\n\t\t\t\tfor(var j = 0; j < visibleScrollbars.length; j++){\r\n\t\t\t\t\tif(visibleScrollbars[j] == scrollbar){\r\n\t\t\t\t\t\tthis.$gantt.$scrollbarRepaint = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn scrollChanged;\r\n\t};\r\n\r\n\tLayout.prototype.getScrollbarsInfo = function(){\r\n\t\tconst scrollbars = this.getCellsByType(\"scroller\");\r\n\t\tconst scrollbarsInfo = [];\r\n\t\tscrollbars.forEach(scrollbar => {\r\n\t\t\tlet obj = {};\r\n\t\t\tconst {visible, direction, size, scrollSize, position} = scrollbar.getScrollState();\r\n\t\t\tlet linkedViews = scrollbar._getLinkedViews();\r\n\t\t\tlet boundViews = linkedViews.map(view => view.$config.id);\r\n\r\n\t\t\tobj.id = scrollbar.$id;\r\n\t\t\tobj.visible = visible;\r\n\t\t\tobj.boundViews = boundViews;\r\n\t\t\tif(direction === \"x\"){\r\n\t\t\t\tobj.x = size;\r\n\t\t\t\tobj.x_inner = scrollSize;\r\n\t\t\t\tobj.x_pos = position || 0;\r\n\t\t\t} else {\r\n\t\t\t\tobj.y = size;\r\n\t\t\t\tobj.y_inner = scrollSize;\r\n\t\t\t\tobj.y_pos = position || 0;\r\n\t\t\t}\r\n\t\t\tscrollbarsInfo.push(obj);\r\n\t\t});\r\n\t\treturn scrollbarsInfo;\r\n\t};\r\n\r\n\tLayout.prototype._syncCellSizes = function(groupName, newSize){\r\n\t\tif(!groupName)\r\n\t\t\treturn;\r\n\r\n\t\tvar groups = {};\r\n\r\n\t\tthis._eachChild(function(cell){\r\n\t\t\tif(cell.$config.group && cell.$name != \"scrollbar\" && cell.$name != \"resizer\"){\r\n\t\t\t\tif(!groups[cell.$config.group]){\r\n\t\t\t\t\tgroups[cell.$config.group] = [];\r\n\t\t\t\t}\r\n\t\t\t\tgroups[cell.$config.group].push(cell);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif(groups[groupName]){\r\n\t\t\tthis._syncGroupSize(groups[groupName], newSize);\r\n\t\t}\r\n\t\treturn groups[groupName];\r\n\t};\r\n\r\n\tLayout.prototype._syncGroupSize = function(cells, newSize){\r\n\t\tif(!cells.length) return;\r\n\r\n\t\tvar property = cells[0].$parent._xLayout ? \"width\" : \"height\";\r\n\t\tvar direction = cells[0].$parent.getNextSibling(cells[0].$id) ? 1 : -1;\r\n\r\n\t\tvar newSizeValue = newSize.value;\r\n\t\tvar isGravity = newSize.isGravity;\r\n\t\tfor(var i = 0; i < cells.length; i++){\r\n\t\t\tvar ownSize = cells[i].getSize();\r\n\r\n\t\t\tvar resizeSibling = direction > 0 ? cells[i].$parent.getNextSibling(cells[i].$id) : cells[i].$parent.getPrevSibling(cells[i].$id);\r\n\t\t\tif(resizeSibling.$name == \"resizer\"){\r\n\t\t\t\tresizeSibling = direction > 0 ? resizeSibling.$parent.getNextSibling(resizeSibling.$id) : resizeSibling.$parent.getPrevSibling(resizeSibling.$id);\r\n\t\t\t}\r\n\t\t\tvar siblingSize = resizeSibling.getSize();\r\n\r\n\t\t\tif(!isGravity) {\r\n\t\t\t\tif(resizeSibling[property]){\r\n\t\t\t\t\tvar totalGravity = ownSize.gravity + siblingSize.gravity;\r\n\t\t\t\t\tvar totalSize = ownSize[property] + siblingSize[property];\r\n\t\t\t\t\tvar k = totalGravity / totalSize;\r\n\t\t\t\t\tcells[i].$config.gravity = k * newSizeValue;\r\n\r\n\t\t\t\t\tresizeSibling.$config[property] = totalSize - newSizeValue;\r\n\t\t\t\t\tresizeSibling.$config.gravity = totalGravity - k * newSizeValue;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tcells[i].$config[property] = newSizeValue;\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tcells[i].$config.gravity = newSizeValue;\r\n\t\t\t}\r\n\r\n\t\t\tvar mainGrid = this.$gantt.$ui.getView(\"grid\");\r\n\t\t\tif(mainGrid && cells[i].$content === mainGrid && !mainGrid.$config.scrollable && !isGravity){\r\n\t\t\t\tthis.$gantt.config.grid_width = newSizeValue;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tLayout.prototype.resize = function(startStage){\r\n\t\tvar mainCall = false;\r\n\t\tif(this.$root && !this._resizeInProgress){\r\n\t\t\tthis.callEvent(\"onBeforeResize\", []);\r\n\t\t\tmainCall = true;\r\n\t\t\tthis._resizeInProgress = true;\r\n\t\t}\r\n\r\n\t\t_super.prototype.resize.call(this, true);\r\n\t\t_super.prototype.resize.call(this, false);\r\n\r\n\t\tif(mainCall){\r\n\r\n\t\t\tvar contentViews = [];\r\n\t\t\tcontentViews = contentViews.concat(this.getCellsByType(\"viewCell\"));\r\n\t\t\tcontentViews = contentViews.concat(this.getCellsByType(\"viewLayout\"));\r\n\t\t\tcontentViews = contentViews.concat(this.getCellsByType(\"hostCell\"));\r\n\r\n\t\t\tvar scrollbars = this.getCellsByType(\"scroller\");\r\n\r\n\t\t\tfor(var i = 0; i < contentViews.length; i++){\r\n\t\t\t\tif(!contentViews[i].$config.hidden)\r\n\t\t\t\t\tcontentViews[i].setContentSize();\r\n\t\t\t}\r\n\r\n\t\t\tvar autosize = this._getAutosizeMode(this.$config.autosize);\r\n\r\n\t/* // possible to rollback set content size when autisize is disabled, not sure if need to\r\n\t\t\tcontentViews.forEach(function(view){\r\n\t\t\t\tconst parent = view.$parent;\r\n\t\t\t\tif(!autosize.x){\r\n\t\t\t\t\tif(parent.$config.$originalWidthStored){\r\n\t\t\t\t\t\tparent.$config.$originalWidthStored = false;\r\n\t\t\t\t\t\tparent.$config.width = parent.$config.$originalWidth;\r\n\t\t\t\t\t\tparent.$config.$originalWidth = undefined;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!autosize.y){\r\n\t\t\t\t\tif(parent.$config.$originalHeightStored){\r\n\t\t\t\t\t\tparent.$config.$originalHeightStored = false;\r\n\t\t\t\t\t\tparent.$config.height = parent.$config.$originalHeight;\r\n\t\t\t\t\t\tparent.$config.$originalHeight = undefined;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});*/\r\n\t\t\t\r\n\t\t\tvar scrollChanged = this._resizeScrollbars(autosize, scrollbars);\r\n\r\n\t\t\tif(this.$config.autosize){\r\n\t\t\t\tthis.autosize(this.$config.autosize);\r\n\t\t\t\tcontentViews.forEach(function(view){\r\n\t\t\t\t\tconst parent = view.$parent;\r\n\t\t\t\t\tconst sizes = parent.getContentSize(autosize);\r\n\t\t\t\t\tif(autosize.x){\r\n\t\t\t\t\t\tif(!parent.$config.$originalWidthStored){\r\n\t\t\t\t\t\t\tparent.$config.$originalWidthStored = true;\r\n\t\t\t\t\t\t\tparent.$config.$originalWidth = parent.$config.width;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tparent.$config.width = sizes.width;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(autosize.y){\r\n\t\t\t\t\t\tif(!parent.$config.$originalHeightStored){\r\n\t\t\t\t\t\t\tparent.$config.$originalHeightStored = true;\r\n\t\t\t\t\t\t\tparent.$config.$originalHeight = parent.$config.height;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tparent.$config.height = sizes.height;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tscrollChanged = true;\r\n\t\t\t}\r\n\r\n\t\t\tif(scrollChanged){\r\n\t\t\t\tthis.resize();\r\n\t\t\t\tfor(var i = 0; i < contentViews.length; i++){\r\n\t\t\t\t\tif(!contentViews[i].$config.hidden)\r\n\t\t\t\t\t\tcontentViews[i].setContentSize();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.callEvent(\"onResize\", []);\r\n\t\t}\r\n\t\tif(mainCall){\r\n\t\t\tthis._resizeInProgress = false;\r\n\t\t}\r\n\t};\r\n\r\n\tLayout.prototype._eachChild = function(code, cell){\r\n\t\tcell = cell || this;\r\n\t\tcode(cell);\r\n\t\tif(cell.$cells){\r\n\t\t\tfor(var i = 0; i < cell.$cells.length; i++){\r\n\t\t\t\tthis._eachChild(code, cell.$cells[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tLayout.prototype.isChild = function(view){\r\n\t\tvar res = false;\r\n\t\tthis._eachChild(function(child){\r\n\t\t\tif(child === view || child.$content === view){\r\n\t\t\t\tres = true;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn res;\r\n\t};\r\n\r\n\tLayout.prototype.getCellsByType = function(type){\r\n\t\tvar res = [];\r\n\t\tif(type === this.$name){\r\n\t\t\tres.push(this);\r\n\t\t}\r\n\r\n\t\tif(this.$content && this.$content.$name == type){\r\n\t\t\tres.push(this.$content);\r\n\t\t}\r\n\r\n\t\tif(this.$cells){\r\n\t\t\tfor(var i = 0; i < this.$cells.length; i++){\r\n\t\t\t\tvar children = Layout.prototype.getCellsByType.call(this.$cells[i], type);\r\n\t\t\t\tif(children.length){\r\n\t\t\t\t\tres.push.apply(res, children);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn res;\r\n\t};\r\n\r\n\tLayout.prototype.getNextSibling = function(cellId){\r\n\t\tvar index = this.cellIndex(cellId);\r\n\t\tif(index >= 0 && this.$cells[index + 1]){\r\n\t\t\treturn this.$cells[index + 1];\r\n\t\t}else{\r\n\t\t\treturn null;\r\n\t\t}\r\n\t};\r\n\r\n\tLayout.prototype.getPrevSibling = function(cellId){\r\n\t\tvar index = this.cellIndex(cellId);\r\n\t\tif(index >= 0 && this.$cells[index - 1]){\r\n\t\t\treturn this.$cells[index - 1];\r\n\t\t}else{\r\n\t\t\treturn null;\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tLayout.prototype.cell = function (id) {\r\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\t\t\tvar child = this.$cells[i];\r\n\t\t\tif (child.$id === id) {\r\n\t\t\t\treturn child;\r\n\t\t\t}\r\n\t\t\tvar sub = child.cell(id);\r\n\t\t\tif (sub) {\r\n\t\t\t\treturn sub;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tLayout.prototype.cellIndex = function (id) {\r\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\t\t\tif (this.$cells[i].$id === id) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t};\r\n\tLayout.prototype.moveView = function (view, ind) {\r\n\t\tif (this.$cells[ind] !== view) {\r\n\t\t\treturn window.alert(\"Not implemented\");\r\n\t\t}\r\n\t\telse {\r\n\t\t\tind += this.$config.header ? 1 : 0;\r\n\t\t\tvar node = this.$view;\r\n\t\t\tif (ind >= node.childNodes.length) {\r\n\t\t\t\tnode.appendChild(view.$view);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tnode.insertBefore(view.$view, node.childNodes[ind]);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tLayout.prototype._parseConfig = function (config) {\r\n\t\tthis.$cells = [];\r\n\t\tthis._xLayout = !config.rows;\r\n\t\tvar cells = config.rows || config.cols || config.views;\r\n\t\tfor (var i = 0; i < cells.length; i++) {\r\n\t\t\tvar cell = cells[i];\r\n\t\t\tcell.mode = this._xLayout ? \"x\" : \"y\";\r\n\t\t\tvar $content = this.$factory.initUI(cell, this);\r\n\t\t\tif(!$content){\r\n\t\t\t\tcells.splice(i, 1);\r\n\t\t\t\ti--;\r\n\t\t\t}else{\r\n\t\t\t\t$content.$parent = this;\r\n\t\t\t\tthis.$cells.push($content);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tLayout.prototype.getCells = function () {\r\n\t\treturn this.$cells;\r\n\t};\r\n\tLayout.prototype.render = function () {\r\n\t\tvar view = domHelpers.insertNode(this.$container, this.$toHTML());\r\n\t\tthis.$fill(view, null);\r\n\t\tthis.callEvent(\"onReady\", []);\r\n\t\tthis.resize();\r\n\r\n\t\t// do simple repaint after the first call\r\n\t\tthis.render = this.resize;\r\n\t};\r\n\tLayout.prototype.$fill = function (node, parent) {\r\n\t\tthis.$view = node;\r\n\t\tthis.$parent = parent;\r\n\t\tvar cells = domHelpers.getChildNodes(node, \"gantt_layout_cell\");\r\n\t\tfor (var i = cells.length - 1; i >= 0; i--) {\r\n\t\t\tvar sub = this.$cells[i];\r\n\t\t\tsub.$fill(cells[i], this);\r\n\t\t\t// initially hidden cell\r\n\t\t\tif (sub.$config.hidden) {\r\n\t\t\t\tsub.$view.parentNode.removeChild(sub.$view);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tLayout.prototype.$toHTML = function () {\r\n\t\tvar mode = this._xLayout ? \"x\" : \"y\";\r\n\t\tvar html = [];\r\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\t\t\thtml.push(this.$cells[i].$toHTML());\r\n\t\t}\r\n\t\treturn _super.prototype.$toHTML.call(this, html.join(\"\"), (this.$root ? \"gantt_layout_root \" : \"\") + \"gantt_layout gantt_layout_\" + mode);\r\n\t};\r\n\r\n\tLayout.prototype.getContentSize = function(mode){\r\n\t\tvar contentWidth = 0,\r\n\t\t\tcontentHeight = 0;\r\n\r\n\t\tvar cellSize, cell, borders;\r\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\t\t\tcell = this.$cells[i];\r\n\t\t\tif(cell.$config.hidden)\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tcellSize = cell.getContentSize(mode);\r\n\r\n\t\t\tif(cell.$config.view === \"scrollbar\" && mode[cell.$config.scroll]){\r\n\t\t\t\tcellSize.height = 0;\r\n\t\t\t\tcellSize.width = 0;\r\n\t\t\t}\r\n\r\n\t\t\tif(cell.$config.resizer){\r\n\t\t\t\tif(this._xLayout){\r\n\t\t\t\t\tcellSize.height = 0;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tcellSize.width = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tborders = cell._getBorderSizes();\r\n\r\n\t\t\tif(this._xLayout){\r\n\t\t\t\tcontentWidth += (cellSize.width + borders.horizontal);\r\n\t\t\t\tcontentHeight = Math.max(contentHeight, (cellSize.height + borders.vertical));\r\n\t\t\t}else{\r\n\t\t\t\tcontentWidth = Math.max(contentWidth, cellSize.width + borders.horizontal);\r\n\t\t\t\tcontentHeight += cellSize.height + borders.vertical;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tborders = this._getBorderSizes();\r\n\t\tcontentWidth += borders.horizontal;\r\n\t\tcontentHeight += borders.vertical;\r\n\r\n\t\t// GS-149 & GS-150: By default this code only increases the container sizes, because of that, the cell sizes\r\n\t\t// are also increased. Keep this code here in the case if something goes wrong\r\n\t\t/*\r\n\t\tif(this.$root){\r\n\t\t\tcontentWidth += 1;\r\n\t\t\tcontentHeight += 1;\r\n\t\t}\r\n\t\t*/\r\n\t\treturn {\r\n\t\t\twidth: contentWidth,\r\n\t\t\theight: contentHeight\r\n\t\t};\r\n\t};\r\n\r\n\tLayout.prototype._cleanElSize = function(value){\r\n\t\treturn ((value || \"\").toString().replace(\"px\", \"\") * 1 || 0);\r\n\t};\r\n\tLayout.prototype._getBoxStyles = function(div){\r\n\t\tvar computed = null;\r\n\t\tif(window.getComputedStyle){\r\n\t\t\tcomputed = window.getComputedStyle(div, null);\r\n\t\t}else{\r\n\t\t\t//IE with elem.currentStyle does not calculate sizes from %, so will use the default approach\r\n\t\t\tcomputed = {\r\n\t\t\t\t\"width\":div.clientWidth,\r\n\t\t\t\t\"height\":div.clientHeight\r\n\t\t\t};\r\n\t\t}\r\n\t\tvar properties = [\r\n\t\t\t\"width\",\r\n\t\t\t\"height\",\r\n\r\n\t\t\t\"paddingTop\",\r\n\t\t\t\"paddingBottom\",\r\n\t\t\t\"paddingLeft\",\r\n\t\t\t\"paddingRight\",\r\n\r\n\t\t\t\"borderLeftWidth\",\r\n\t\t\t\"borderRightWidth\",\r\n\t\t\t\"borderTopWidth\",\r\n\t\t\t\"borderBottomWidth\"\r\n\t\t];\r\n\t\tvar styles = {\r\n\t\t\tboxSizing:(computed.boxSizing == \"border-box\")\r\n\t\t};\r\n\r\n\t\tif(computed.MozBoxSizing){\r\n\t\t\tstyles.boxSizing = (computed.MozBoxSizing == \"border-box\");\r\n\t\t}\r\n\t\tfor(var i =0; i < properties.length; i++){\r\n\t\t\tstyles[properties[i]] = computed[properties[i]] ? this._cleanElSize(computed[properties[i]]) : 0;\r\n\t\t}\r\n\r\n\r\n\t\tvar box = {\r\n\t\t\thorPaddings : (styles.paddingLeft + styles.paddingRight + styles.borderLeftWidth + styles.borderRightWidth),\r\n\t\t\tvertPaddings : (styles.paddingTop + styles.paddingBottom + styles.borderTopWidth + styles.borderBottomWidth),\r\n\t\t\tborderBox: styles.boxSizing,\r\n\t\t\tinnerWidth : styles.width,\r\n\t\t\tinnerHeight : styles.height,\r\n\t\t\touterWidth : styles.width,\r\n\t\t\touterHeight : styles.height\r\n\t\t};\r\n\r\n\r\n\t\tif(box.borderBox){\r\n\t\t\tbox.innerWidth -= box.horPaddings;\r\n\t\t\tbox.innerHeight -= box.vertPaddings;\r\n\t\t}else{\r\n\t\t\tbox.outerWidth += box.horPaddings;\r\n\t\t\tbox.outerHeight += box.vertPaddings;\r\n\t\t}\r\n\r\n\t\treturn box;\r\n\t};\r\n\r\n\tLayout.prototype._getAutosizeMode = function(config){\r\n\t\tvar res = {x:false, y:false};\r\n\t\tif(config === \"xy\"){\r\n\t\t\tres.x = res.y = true;\r\n\t\t}else if(config === \"y\" || config === true){\r\n\t\t\tres.y = true;\r\n\t\t}else if(config === \"x\"){\r\n\t\t\tres.x = true;\r\n\t\t}\r\n\t\treturn res;\r\n\t};\r\n\r\n\tLayout.prototype.autosize = function(mode) {\r\n\t\tvar res = this._getAutosizeMode(mode);\r\n\t\tvar boxSizes = this._getBoxStyles(this.$container);\r\n\t\tvar contentSizes = this.getContentSize(mode);\r\n\r\n\t\tvar node = this.$container;\r\n\t\tif(res.x){\r\n\t\t\tif(boxSizes.borderBox){\r\n\t\t\t\tcontentSizes.width += boxSizes.horPaddings;\r\n\t\t\t}\r\n\t\t\tnode.style.width = contentSizes.width + \"px\";\r\n\t\t}\r\n\t\tif(res.y){\r\n\t\t\tif(boxSizes.borderBox){\r\n\t\t\t\tcontentSizes.height += boxSizes.vertPaddings;\r\n\t\t\t}\r\n\t\t\tnode.style.height = contentSizes.height + \"px\";\r\n\t\t}\r\n\t};\r\n\r\n\tLayout.prototype.getSize = function () {\r\n\t\tthis._sizes = [];\r\n\t\tvar width = 0;\r\n\t\tvar minWidth = 0;\r\n\t\tvar maxWidth = 100000000000;\r\n\t\tvar height = 0;\r\n\t\tvar maxHeight = 100000000000;\r\n\t\tvar minHeight = 0;\r\n\r\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\r\n\t\t\tvar size = this._sizes[i] = this.$cells[i].getSize();\r\n\t\t\tif (this.$cells[i].$config.hidden) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (this._xLayout) {\r\n\t\t\t\tif (!size.width && size.minWidth) {\r\n\t\t\t\t\twidth += size.minWidth;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\twidth += size.width;\r\n\t\t\t\t}\r\n\t\t\t\tmaxWidth += size.maxWidth;\r\n\t\t\t\tminWidth += size.minWidth;\r\n\t\t\t\theight = Math.max(height, size.height);\r\n\t\t\t\tmaxHeight = Math.min(maxHeight, size.maxHeight); // min of maxHeight\r\n\t\t\t\tminHeight = Math.max(minHeight, size.minHeight); // max of minHeight\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (!size.height && size.minHeight) {\r\n\t\t\t\t\theight += size.minHeight;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\theight += size.height;\r\n\t\t\t\t}\r\n\t\t\t\tmaxHeight += size.maxHeight;\r\n\t\t\t\tminHeight += size.minHeight;\r\n\t\t\t\twidth = Math.max(width, size.width);\r\n\t\t\t\tmaxWidth = Math.min(maxWidth, size.maxWidth); // min of maxWidth\r\n\t\t\t\tminWidth = Math.max(minWidth, size.minWidth); // max of minWidth\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar self = _super.prototype.getSize.call(this);\r\n\t\t// maxWidth\r\n\t\tif (self.maxWidth >= 100000) {\r\n\t\t\tself.maxWidth = maxWidth;\r\n\t\t}\r\n\t\t// maxHeight\r\n\t\tif (self.maxHeight >= 100000) {\r\n\t\t\tself.maxHeight = maxHeight;\r\n\t\t}\r\n\t\t// minWidth\r\n\t\tself.minWidth = self.minWidth !== self.minWidth ? 0 : self.minWidth;// || self.width || Math.max(minWidth, width);\r\n\t\t// minHeight\r\n\t\tself.minHeight = self.minHeight !== self.minHeight ? 0 : self.minHeight;//self.minHeight || self.height || Math.max(minHeight, height);\r\n\t\t// sizes with paddings and margins\r\n\t\tif (this._xLayout) {\r\n\t\t\tself.minWidth += this.$config.margin * (this.$cells.length) || 0;\r\n\t\t\tself.minWidth += this.$config.padding * 2 || 0;\r\n\t\t\tself.minHeight += (this.$config.padding * 2) || 0;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tself.minHeight += this.$config.margin * (this.$cells.length) || 0;\r\n\t\t\tself.minHeight += (this.$config.padding * 2) || 0;\r\n\t\t}\r\n\t\t\r\n\t\treturn self;\r\n\t};\r\n\t// calc total gravity and free space\r\n\tLayout.prototype._calcFreeSpace = function (s, cell, xLayout) {\r\n\t\tvar min = xLayout ? cell.minWidth : cell.minHeight;\r\n\t\tvar max = xLayout ? cell.maxWidth : cell.maxWidth;\r\n\t\tvar side = s;\r\n\t\tif (!side) {\r\n\t\t\tside = Math.floor(this._free / this._gravity * cell.gravity);\r\n\t\t\tif (side > max) {\r\n\t\t\t\tside = max;\r\n\t\t\t\tthis._free -= side;\r\n\t\t\t\tthis._gravity -= cell.gravity;\r\n\t\t\t}\r\n\t\t\tif (side < min) {\r\n\t\t\t\tside = min;\r\n\t\t\t\tthis._free -= side;\r\n\t\t\t\tthis._gravity -= cell.gravity;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (side > max) {\r\n\t\t\t\tside = max;\r\n\t\t\t}\r\n\t\t\tif (side < min) {\r\n\t\t\t\tside = min;\r\n\t\t\t}\r\n\t\t\tthis._free -= side;\r\n\t\t}\r\n\t\treturn side;\r\n\t};\r\n\tLayout.prototype._calcSize = function (s, size, xLayout) {\r\n\t\tvar side = s;\r\n\t\tvar min = xLayout ? size.minWidth : size.minHeight;\r\n\t\tvar max = xLayout ? size.maxWidth : size.maxHeight;\r\n\t\tif (!side) {\r\n\t\t\tside = Math.floor(this._free / this._gravity * size.gravity);\r\n\t\t}\r\n\t\tif (side > max) {\r\n\t\t\tside = max;\r\n\t\t}\r\n\t\tif (side < min) {\r\n\t\t\tside = min;\r\n\t\t}\r\n\t\treturn side;\r\n\t};\r\n\r\n\tLayout.prototype._configureBorders = function(){\r\n\t\tif(this.$root){\r\n\t\t\tthis._setBorders([\r\n\t\t\t\tthis._borders.left,\r\n\t\t\t\tthis._borders.top,\r\n\t\t\t\tthis._borders.right,\r\n\t\t\t\tthis._borders.bottom\r\n\t\t\t],\r\n\t\t\tthis);\r\n\t\t}\r\n\r\n\t\tvar borderClass = this._xLayout ? this._borders.right : this._borders.bottom;\r\n\r\n\t\tvar cells = this.$cells;\r\n\r\n\t\tvar lastVisibleIndex = cells.length - 1;\r\n\t\tfor(var i = lastVisibleIndex; i >= 0; i--){\r\n\t\t\tif (!cells[i].$config.hidden) {\r\n\t\t\t\tlastVisibleIndex = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (var i = 0; i < cells.length; i++) {\r\n\t\t\tif (cells[i].$config.hidden) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tvar lastCell = i >= lastVisibleIndex;\r\n\t\t\tvar borderColorClass = \"\";\r\n\t\t\tif(!lastCell && cells[i + 1]){\r\n\t\t\t\tif(cells[i + 1].$config.view == \"scrollbar\"){\r\n\t\t\t\t\tif(this._xLayout){\r\n\t\t\t\t\t\tlastCell = true;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tborderColorClass = \"gantt_layout_cell_border_transparent\";\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n\t\t\tthis._setBorders(lastCell ? [] : [borderClass, borderColorClass], cells[i]);\r\n\t\t}\r\n\t};\r\n\r\n\tLayout.prototype._updateCellVisibility = function(){\r\n\t\tvar oldVisibleCells = this._visibleCells || {};\r\n\t\tvar firstCall = !this._visibleCells;\r\n\t\tvar visibleCells = {};\r\n\t\tvar cell = null;\r\n\t\tvar parentVisibility = [];\r\n\t\tfor (var i = 0; i < this._sizes.length; i++) {\r\n\t\t\tcell = this.$cells[i];\r\n\t\t\tif (cell.$config.hide_empty){\r\n\t\t\t\tparentVisibility.push(cell);\r\n\t\t\t}\r\n\r\n\t\t\tif (!firstCall && cell.$config.hidden && oldVisibleCells[cell.$id]) {\r\n\t\t\t\tcell._hide(true);\r\n\t\t\t}else if(!cell.$config.hidden && !oldVisibleCells[cell.$id]){\r\n\t\t\t\tcell._hide(false);\r\n\t\t\t}\r\n\r\n\t\t\tif(!cell.$config.hidden){\r\n\t\t\t\tvisibleCells[cell.$id] = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._visibleCells = visibleCells;\r\n\r\n\t\t// GS-27. A way to hide the whole cell if all its children are hidden\r\n\t\tfor (var i = 0; i < parentVisibility.length; i++) {\r\n\t\t\tvar cell = parentVisibility[i];\r\n\t\t\tvar children = cell.$cells;\r\n\t\t\tvar hideCell = true;\r\n\t\t\tchildren.forEach(function(child){\r\n\t\t\t\tif (!child.$config.hidden && !child.$config.resizer){\r\n\t\t\t\t\thideCell = false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tcell.$config.hidden = hideCell;\r\n\t\t}\r\n\t};\r\n\r\n\tLayout.prototype.setSize = function (x, y) {\r\n\t\tthis._configureBorders();\r\n\t\t_super.prototype.setSize.call(this, x, y);\r\n\t\ty = this.$lastSize.contentY;\r\n\t\tx = this.$lastSize.contentX;\r\n\r\n\t\tvar padding = (this.$config.padding || 0);\r\n\t\tthis.$view.style.padding = padding + \"px\";\r\n\t\tthis._gravity = 0;\r\n\t\tthis._free = this._xLayout ? x : y;\r\n\t\tthis._free -= padding * 2;\r\n\t\t// calc all gravity\r\n\r\n\t\tvar cell,\r\n\t\t\tsize;\r\n\r\n\t\tthis._updateCellVisibility();\r\n\r\n\t\tfor (var i = 0; i < this._sizes.length; i++) {\r\n\t\t\tcell = this.$cells[i];\r\n\r\n\t\t\tif (cell.$config.hidden) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tvar margin = (this.$config.margin || 0);\r\n\t\t\tif(cell.$name == \"resizer\" && !margin){\r\n\t\t\t\tmargin = -1;\r\n\t\t\t}\r\n\r\n\t\t\t// set margins to child cell\r\n\t\t\tvar cellView = cell.$view;\r\n\r\n\t\t\tvar marginSide = this._xLayout ? \"marginRight\" : \"marginBottom\";\r\n\t\t\tif (i !== this.$cells.length - 1) {\r\n\t\t\t\tcellView.style[marginSide] = margin + \"px\";\r\n\t\t\t\tthis._free -= margin; // calc free space without margin\r\n\t\t\t}\r\n\t\t\tsize = this._sizes[i];\r\n\t\t\tif (this._xLayout) {\r\n\t\t\t\tif (!size.width) {\r\n\t\t\t\t\tthis._gravity += size.gravity;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (!size.height) {\r\n\t\t\t\t\tthis._gravity += size.gravity;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (var i = 0; i < this._sizes.length; i++) {\r\n\t\t\tcell = this.$cells[i];\r\n\r\n\t\t\tif (cell.$config.hidden) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tsize = this._sizes[i];\r\n\t\t\tvar width = size.width;\r\n\t\t\tvar height = size.height;\r\n\t\t\tif (this._xLayout) {\r\n\t\t\t\tthis._calcFreeSpace(width, size, true);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._calcFreeSpace(height, size, false);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\t\t\tcell = this.$cells[i];\r\n\r\n\t\t\tif (cell.$config.hidden) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tsize = this._sizes[i];\r\n\t\t\tvar dx = void 0;\r\n\t\t\tvar dy = void 0;\r\n\t\t\tif (this._xLayout) {\r\n\t\t\t\tdx = this._calcSize(size.width, size, true);\r\n\t\t\t\tdy = y - padding * 2; // layout height without paddings\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tdx = x - padding * 2; // layout width without paddings\r\n\t\t\t\tdy = this._calcSize(size.height, size, false);\r\n\t\t\t}\r\n\r\n\t\t\tcell.setSize(dx, dy);\r\n\t\t}\r\n\r\n\t};\r\n\r\n\treturn Layout;\r\n}(Cell));\r\n\r\nexport default Layout;","import __extends from \"../../../utils/extends\";\r\nimport Layout from \"./layout\";\r\nimport Cell from \"./cell\";\r\n\r\nvar ViewLayout = (function (_super) {\r\n\t\"use strict\";\r\n\r\n\t__extends(ViewLayout, _super);\r\n\tfunction ViewLayout(parent, config, factory) {\r\n\t\tvar _this = _super.apply(this, arguments) || this;\r\n\t\tfor (var i = 0; i < _this.$cells.length; i++) {\r\n\t\t\t_this.$cells[i].$config.hidden = (i !== 0);\r\n\t\t}\r\n\t\t_this.$cell = _this.$cells[0];\r\n\t\t_this.$name = \"viewLayout\";\r\n\r\n\t\treturn _this;\r\n\t}\r\n\tViewLayout.prototype.cell = function (id) {\r\n\t\tvar cell = _super.prototype.cell.call(this, id);\r\n\t\tif (!cell.$view) {\r\n\t\t\tthis.$fill(null, this);\r\n\t\t}\r\n\t\treturn cell;\r\n\t};\r\n\tViewLayout.prototype.moveView = function (view) {\r\n\t\tvar body = this.$view;\r\n\t\tif (this.$cell) {\r\n\t\t\tthis.$cell.$config.hidden = true;\r\n\t\t\tbody.removeChild(this.$cell.$view);\r\n\t\t}\r\n\t\tthis.$cell = view;\r\n\t\tbody.appendChild(view.$view);\r\n\t};\r\n\tViewLayout.prototype.setSize = function (x, y) {\r\n\t\tCell.prototype.setSize.call(this, x, y);\r\n\t};\r\n\r\n\tViewLayout.prototype.setContentSize = function(){\r\n\t\tvar size = this.$lastSize;\r\n\t\tthis.$cell.setSize(size.contentX, size.contentY);\r\n\t};\r\n\r\n\tViewLayout.prototype.getSize = function () {\r\n\t\tvar sizes = _super.prototype.getSize.call(this);\r\n\t\tif (this.$cell) {\r\n\t\t\tvar cellSize = this.$cell.getSize();\r\n\t\t\tif (this.$config.byMaxSize) {\r\n\t\t\t\tfor (var i = 0; i < this.$cells.length; i++) {\r\n\t\t\t\t\tvar otherCell = this.$cells[i].getSize();\r\n\t\t\t\t\tfor (var cell in cellSize) {\r\n\t\t\t\t\t\tcellSize[cell] = Math.max(cellSize[cell], otherCell[cell]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (var size in sizes) {\r\n\t\t\t\tsizes[size] = sizes[size] || cellSize[size];\r\n\t\t\t}\r\n\t\t\tsizes.gravity = Math.max(sizes.gravity, cellSize.gravity);\r\n\t\t}\r\n\t\treturn sizes;\r\n\t};\r\n\treturn ViewLayout;\r\n}(Layout));\r\n\r\nexport default ViewLayout;","import __extends from \"../../../utils/extends\";\r\nimport * as utils from \"../../../utils/utils\";\r\nimport Cell from \"./cell\";\r\n\r\nvar ViewCell = (function (_super) {\r\n\t\"use strict\";\r\n\r\n\t__extends(ViewCell, _super);\r\n\tfunction ViewCell(parent, config, factory) {\r\n\r\n\t\tvar _this = _super.apply(this, arguments) || this;\r\n\r\n\t\tif(config.view){\r\n\t\t\tif(config.id){\r\n\t\t\t\t// pass id to the nested view\r\n\t\t\t\tthis.$id = utils.uid();\r\n\t\t\t}\r\n\t\t\tvar childConfig = utils.copy(config);\r\n\t\t\tdelete childConfig.config;\r\n\t\t\tdelete childConfig.templates;\r\n\r\n\t\t\tthis.$content = this.$factory.createView(config.view, this, childConfig, this);\r\n\t\t\tif(!this.$content)\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t_this.$name = \"viewCell\";\r\n\t\treturn _this;\r\n\t}\r\n\r\n\tViewCell.prototype.destructor = function(){\r\n\t\tthis.clear();\r\n\t\t_super.prototype.destructor.call(this);\r\n\t};\r\n\r\n\tViewCell.prototype.clear = function(){\r\n\r\n\t\tthis.$initialized = false;\r\n\r\n\t\t// call destructor\r\n\t\tif (this.$content){\r\n\t\t\tvar method = this.$content.unload || this.$content.destructor;\r\n\t\t\tif (method){\r\n\t\t\t\tmethod.call(this.$content);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t_super.prototype.clear.call(this);\r\n\r\n\t};\r\n\r\n\tViewCell.prototype.scrollTo = function(left, top){\r\n\r\n\t\tif(this.$content && this.$content.scrollTo){\r\n\t\t\tthis.$content.scrollTo(left, top);\r\n\t\t}else{\r\n\t\t\t_super.prototype.scrollTo.call(this, left, top);\r\n\t\t}\r\n\t};\r\n\r\n\tViewCell.prototype._setContentSize = function(x, y){\r\n\t\tvar borders = this._getBorderSizes();\r\n\t\tif(typeof x === \"number\"){\r\n\t\t\tvar outerX = x + borders.horizontal;\r\n\t\t\tthis.$config.width = outerX;\r\n\t\t}\r\n\t\tif(typeof y === \"number\"){\r\n\t\t\tvar outerY = y + borders.vertical;\r\n\t\t\tthis.$config.height = outerY;\r\n\t\t}\r\n\t};\r\n\r\n\tViewCell.prototype.setSize = function(x, y){\r\n\t\t_super.prototype.setSize.call(this, x, y);\r\n\r\n\t\tif(!this.$preResize && this.$content) {\r\n\t\t\tif (!this.$initialized) {\r\n\t\t\t\tthis.$initialized = true;\r\n\t\t\t\tvar header = this.$view.childNodes[0];\r\n\t\t\t\tvar content = this.$view.childNodes[1];\r\n\t\t\t\tif(!content) content = header;\r\n\r\n\t\t\t\t/*if(this.$content.$config){\r\n\t\t\t\t\tthis.$content.$config.width = this.$lastSize.contentX;\r\n\t\t\t\t\tthis.$content.$config.height = this.$lastSize.contentY;\r\n\t\t\t\t}*/\r\n\t\t\t\tthis.$content.init(content);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tViewCell.prototype.setContentSize = function(){\r\n\t\tif(!this.$preResize && this.$content) {\r\n\t\t\tif (this.$initialized) {\r\n\t\t\t\tthis.$content.setSize(this.$lastSize.contentX, this.$lastSize.contentY);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tViewCell.prototype.getContentSize = function(){\r\n\t\tvar size = _super.prototype.getContentSize.call(this);\r\n\r\n\t\tif(this.$content && this.$initialized){\r\n\t\t\tvar childSize = this.$content.getSize();\r\n\t\t\tsize.width = childSize.contentX === undefined ? childSize.width : childSize.contentX;\r\n\t\t\tsize.height = childSize.contentY === undefined ? childSize.height : childSize.contentY;\r\n\t\t}\r\n\r\n\t\tvar borders = this._getBorderSizes();\r\n\t\tsize.width += borders.horizontal;\r\n\t\tsize.height += borders.vertical;\r\n\r\n\t\treturn size;\r\n\t};\r\n\r\n\treturn ViewCell;\r\n}(Cell));\r\n\r\nexport default ViewCell;","export default null;","import __extends from \"../../../utils/extends\";\r\nimport * as domHelpers from \"../utils/dom_helpers\";\r\nimport * as utils from \"../../../utils/utils\";\r\nimport env from \"../../../utils/env\";\r\nimport Cell from \"./cell\";\r\n\r\nvar ScrollbarCell = (function (_super) {\r\n\t\"use strict\";\r\n\r\n\tvar SCROLL_MODIFIER_KEYS = [\"altKey\", \"shiftKey\", \"metaKey\"]; // it's no way to disable ctrl+wheel\r\n\t__extends(ScrollbarCell, _super);\r\n\tfunction ScrollbarCell(parent, config, factory, gantt) {\r\n\r\n\t\tvar _this = _super.apply(this, arguments) || this;\r\n\t\tthis.$config = utils.mixin(config, {scroll: \"x\"});\r\n\t\t_this._scrollHorizontalHandler = utils.bind(_this._scrollHorizontalHandler, _this);\r\n\t\t_this._scrollVerticalHandler = utils.bind(_this._scrollVerticalHandler, _this);\r\n\t\t_this._outerScrollVerticalHandler = utils.bind(_this._outerScrollVerticalHandler, _this);\r\n\t\t_this._outerScrollHorizontalHandler = utils.bind(_this._outerScrollHorizontalHandler, _this);\r\n\t\t_this._mouseWheelHandler = utils.bind(_this._mouseWheelHandler, _this);\r\n\r\n\t\tthis.$config.hidden = true;\r\n\t\tvar size = gantt.config.scroll_size;\r\n\r\n\t\tif(gantt.env.isIE){\r\n\t\t\t// full element height/width must be bigger than just a browser scrollbar,\r\n\t\t\t// otherwise the scrollbar element won't be scrolled on click\r\n\t\t\tsize += 1;\r\n\t\t}\r\n\r\n\t\tif(this._isHorizontal()){\r\n\t\t\t_this.$config.height = size;\r\n\t\t\t_this.$parent.$config.height = size;\r\n\t\t}else{\r\n\t\t\t_this.$config.width = size;\r\n\t\t\t_this.$parent.$config.width = size;\r\n\t\t}\r\n\r\n\t\tthis.$config.scrollPosition = 0;\r\n\r\n\t\t_this.$name = \"scroller\";\r\n\t\treturn _this;\r\n\t}\r\n\r\n\tScrollbarCell.prototype.init = function(container){\r\n\t\tcontainer.innerHTML = this.$toHTML();\r\n\t\tthis.$view = container.firstChild;\r\n\r\n\t\tif(!this.$view){\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t\tif(this._isVertical()){\r\n\t\t\tthis._initVertical();\r\n\t\t}else{\r\n\t\t\tthis._initHorizontal();\r\n\t\t}\r\n\t\tthis._initMouseWheel();\r\n\t\tthis._initLinkedViews();\r\n\t};\r\n\r\n\tScrollbarCell.prototype.$toHTML = function () {\r\n\t\tvar className = this._isHorizontal() ? \"gantt_hor_scroll\" : \"gantt_ver_scroll\";\r\n\t\treturn \"<div class='gantt_layout_cell \"+className+\"'><div style='\"+(this._isHorizontal() ? \"width:2000px\" : \"height:2000px\")+\"'></div></div>\";\r\n\t};\r\n\r\n\tScrollbarCell.prototype._getRootParent = function(){\r\n\t\tvar parent = this.$parent;\r\n\t\twhile(parent && parent.$parent){\r\n\t\t\tparent = parent.$parent;\r\n\t\t}\r\n\t\tif(parent){\r\n\t\t\treturn parent;\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tfunction eachCell(root, res){\r\n\t\tres.push(root);\r\n\t\tif(root.$cells){\r\n\t\t\tfor(var i = 0; i < root.$cells.length; i++){\r\n\t\t\t\teachCell(root.$cells[i], res);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tScrollbarCell.prototype._eachView = function(){\r\n\t\tvar res = [];\r\n\t\teachCell(this._getRootParent(), res);\r\n\t\treturn res;\r\n\t};\r\n\r\n\tScrollbarCell.prototype._getLinkedViews = function(){\r\n\t\tvar views = this._eachView();\r\n\t\tvar res = [];\r\n\t\tfor(var i = 0; i < views.length; i++){\r\n\t\t\tif(views[i].$config && ((this._isVertical() && views[i].$config.scrollY == this.$id) || (this._isHorizontal() && views[i].$config.scrollX == this.$id)) ){\r\n\t\t\t\tres.push(views[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn res;\r\n\t};\r\n\r\n\r\n\tScrollbarCell.prototype._initHorizontal = function(){\r\n\t\tthis.$scroll_hor = this.$view;\r\n\t\tthis.$domEvents.attach(this.$view, \"scroll\", this._scrollHorizontalHandler);\r\n\r\n\t};\r\n\r\n\tScrollbarCell.prototype._initLinkedViews = function(){\r\n\t\tvar views = this._getLinkedViews();\r\n\t\tvar css = this._isVertical() ?\"gantt_layout_outer_scroll gantt_layout_outer_scroll_vertical\" : \"gantt_layout_outer_scroll gantt_layout_outer_scroll_horizontal\";\r\n\t\tfor(var i = 0; i < views.length; i++){\r\n\t\t\t//views[i].$config.css = [views[i].$config.css || \"\", css].join(\" \");\r\n\t\t\tdomHelpers.addClassName(views[i].$view || views[i].getNode(), css);\r\n\t\t}\r\n\t};\r\n\r\n\tScrollbarCell.prototype._initVertical = function(){\r\n\t\tthis.$scroll_ver = this.$view;\r\n\t\tthis.$domEvents.attach(this.$view, \"scroll\", this._scrollVerticalHandler);\r\n\t};\r\n\r\n\tScrollbarCell.prototype._updateLinkedViews = function(){\r\n\t};\r\n\r\n\tScrollbarCell.prototype._initMouseWheel = function(){\r\n\t\tvar ff = env.isFF;\r\n\t\tif (ff)\r\n\t\t\tthis.$domEvents.attach(this._getRootParent().$view, \"wheel\", this._mouseWheelHandler, {passive: false});\r\n\t\telse\r\n\t\t\tthis.$domEvents.attach(this._getRootParent().$view, \"mousewheel\", this._mouseWheelHandler, {passive: false});\r\n\t};\r\n\r\n\r\n\r\n\r\n\tScrollbarCell.prototype.scrollHorizontally = function(left){\r\n\t\tif(this._scrolling) return;\r\n\t\tthis._scrolling = true;\r\n\r\n\t\tthis.$scroll_hor.scrollLeft = left;\r\n\t\tthis.$config.codeScrollLeft = left;\r\n\t\tleft = this.$scroll_hor.scrollLeft;\r\n\r\n\t\tvar views = this._getLinkedViews();\r\n\t\tfor(var i = 0; i < views.length; i++){\r\n\t\t\tif(views[i].scrollTo){\r\n\t\t\t\tviews[i].scrollTo(left, undefined);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar oldSize = this.$config.scrollPosition;\r\n\t\tthis.$config.scrollPosition = left;\r\n\t\tthis.callEvent(\"onScroll\", [oldSize, left, this.$config.scroll]);\r\n\t\tthis._scrolling = false;\r\n\t};\r\n\tScrollbarCell.prototype.scrollVertically = function(top){\r\n\t\tif(this._scrolling) return;\r\n\t\tthis._scrolling = true;\r\n\r\n\t\tthis.$scroll_ver.scrollTop = top;\r\n\t\ttop = this.$scroll_ver.scrollTop;\r\n\r\n\t\tvar views = this._getLinkedViews();\r\n\r\n\t\tfor(var i = 0; i < views.length; i++){\r\n\t\t\tif(views[i].scrollTo){\r\n\t\t\t\tviews[i].scrollTo(undefined, top);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar oldSize = this.$config.scrollPosition;\r\n\t\tthis.$config.scrollPosition = top;\r\n\t\tthis.callEvent(\"onScroll\", [oldSize, top, this.$config.scroll]);\r\n\t\tthis._scrolling = false;\r\n\t};\r\n\r\n\tScrollbarCell.prototype._isVertical = function(){\r\n\t\treturn this.$config.scroll == \"y\";\r\n\t};\r\n\tScrollbarCell.prototype._isHorizontal = function(){\r\n\t\treturn this.$config.scroll == \"x\";\r\n\t};\r\n\tScrollbarCell.prototype._scrollHorizontalHandler = function (e) {\r\n\t\tif(this._isVertical() || this._scrolling){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//in safari we can catch previous onscroll after setting new value from mouse-wheel event\r\n\t\t//set delay to prevent value drifiting\r\n\t\tif ((new Date()) - ( this._wheel_time || 0 ) < 100) return true;\r\n\t\t//if (this.$gantt._touch_scroll_active) return;\r\n\t\tvar left = this.$scroll_hor.scrollLeft;\r\n\r\n\t\tthis.scrollHorizontally(left);\r\n\r\n\t\tthis._oldLeft = this.$scroll_hor.scrollLeft;\r\n\t};\r\n\tScrollbarCell.prototype._outerScrollHorizontalHandler = function(e){\r\n\t\tif(this._isVertical()){\r\n\t\t\treturn;\r\n\t\t}\r\n\t};\r\n\r\n\tScrollbarCell.prototype.show = function(){\r\n\t\tthis.$parent.show();\r\n\t};\r\n\tScrollbarCell.prototype.hide = function(){\r\n\t\tthis.$parent.hide();\r\n\t};\r\n\r\n\tScrollbarCell.prototype._getScrollSize = function(){\r\n\t\tvar scrollSize = 0;\r\n\t\tvar outerSize = 0;\r\n\t\tvar isHorizontal = this._isHorizontal();\r\n\r\n\t\tvar linked = this._getLinkedViews();\r\n\t\tvar view;\r\n\t\tvar scrollProperty = isHorizontal ? \"scrollWidth\" : \"scrollHeight\",\r\n\t\t\tinnerSizeProperty = isHorizontal ? \"contentX\" : \"contentY\";\r\n\t\tvar outerProperty = isHorizontal ? \"x\" : \"y\";\r\n\t\tvar offset = this._getScrollOffset();\r\n\r\n\t\tfor(var i = 0; i < linked.length; i++){\r\n\t\t\tview = linked[i];\r\n\t\t\tif(!(view && view.$content && view.$content.getSize && !view.$config.hidden)) continue;\r\n\r\n\t\t\tvar sizes = view.$content.getSize();\r\n\t\t\tvar cellScrollSize;\r\n\t\t\tif(sizes.hasOwnProperty(scrollProperty)){\r\n\t\t\t\tcellScrollSize = sizes[scrollProperty];\r\n\t\t\t}else{\r\n\t\t\t\tcellScrollSize = sizes[innerSizeProperty];\r\n\t\t\t}\r\n\r\n\t\t\tif(offset){\r\n\t\t\t\t// precalculated vertical/horizontal offsets of scrollbar to emulate 4.x look\r\n\t\t\t\tif(sizes[innerSizeProperty] > sizes[outerProperty] && sizes[innerSizeProperty] > scrollSize && (cellScrollSize > (sizes[outerProperty] - offset + 2))){\r\n\t\t\t\t\tscrollSize = cellScrollSize + (isHorizontal ? 0 : 2);\r\n\t\t\t\t\touterSize = sizes[outerProperty];\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tvar nonScrollableSize = Math.max(sizes[innerSizeProperty] - cellScrollSize, 0);\r\n\t\t\t\tvar scrollableViewPortSize = Math.max(sizes[outerProperty] - nonScrollableSize, 0);\r\n\t\t\t\tcellScrollSize = cellScrollSize + nonScrollableSize;\r\n\r\n\t\t\t\tif(cellScrollSize > scrollableViewPortSize && (cellScrollSize > scrollSize) ){\r\n\t\t\t\t\t//|| (cellScrollSize === scrollSize && sizes[outerProperty] < outerSize) // same scroll width but smaller scrollable view port\r\n\r\n\t\t\t\t\tscrollSize = cellScrollSize;\r\n\t\t\t\t\touterSize = sizes[outerProperty];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\touterScroll: outerSize,\r\n\t\t\tinnerScroll: scrollSize\r\n\t\t};\r\n\t};\r\n\r\n\tScrollbarCell.prototype.scroll = function(position){\r\n\t\tif(this._isHorizontal()){\r\n\t\t\tthis.scrollHorizontally(position);\r\n\t\t}else{\r\n\t\t\tthis.scrollVertically(position);\r\n\t\t}\r\n\t};\r\n\r\n\tScrollbarCell.prototype.getScrollState = function(){\r\n\t\treturn {\r\n\t\t\tvisible: this.isVisible(),\r\n\t\t\tdirection: this.$config.scroll,\r\n\t\t\tsize: this.$config.outerSize,\r\n\t\t\tscrollSize: this.$config.scrollSize || 0,\r\n\t\t\tposition: this.$config.scrollPosition || 0\r\n\t\t};\r\n\t};\r\n\r\n\tScrollbarCell.prototype.setSize = function(width, height){\r\n\t\t_super.prototype.setSize.apply(this, arguments);\r\n\r\n\t\tvar scrollSizes = this._getScrollSize();\r\n\r\n\t\tvar ownSize = (this._isVertical() ? height : width) - this._getScrollOffset() + (this._isHorizontal() ? 1 : 0);\r\n\r\n\t\tif(scrollSizes.innerScroll && ownSize > scrollSizes.outerScroll){\r\n\t\t\tscrollSizes.innerScroll += (ownSize - scrollSizes.outerScroll);\r\n\t\t}\r\n\t\tthis.$config.scrollSize = scrollSizes.innerScroll;\r\n\r\n\t\tthis.$config.width = width;\r\n\t\tthis.$config.height = height;\r\n\t\tthis._setScrollSize(scrollSizes.innerScroll);\r\n\t};\r\n\r\n\tScrollbarCell.prototype.isVisible = function(){\r\n\t\treturn !!(this.$parent && this.$parent.$view.parentNode);\r\n\t};\r\n\r\n\tScrollbarCell.prototype.shouldShow = function(){\r\n\t\tvar scrollSizes = this._getScrollSize();\r\n\t\tif(!scrollSizes.innerScroll && (this.$parent && this.$parent.$view.parentNode)){\r\n\t\t\treturn false;\r\n\t\t}else if(scrollSizes.innerScroll && !(this.$parent && this.$parent.$view.parentNode)){\r\n\t\t\treturn true;\r\n\t\t}else{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t};\r\n\r\n\tScrollbarCell.prototype.shouldHide = function(){\r\n\t\tvar scrollSizes = this._getScrollSize();\r\n\t\tif(!scrollSizes.innerScroll && (this.$parent && this.$parent.$view.parentNode)){\r\n\t\t\treturn true;\r\n\t\t}else{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tScrollbarCell.prototype.toggleVisibility = function(){\r\n\t\tif(this.shouldHide()){\r\n\t\t\tthis.hide();\r\n\t\t}else if(this.shouldShow()){\r\n\t\t\tthis.show();\r\n\t\t}\r\n\t};\r\n\r\n\tScrollbarCell.prototype._getScaleOffset = function(view){\r\n\t\tvar offset = 0;\r\n\t\tif(view && (view.$config.view == \"timeline\" || view.$config.view == \"grid\")){\r\n\t\t\toffset = view.$content.$getConfig().scale_height;\r\n\t\t}\r\n\t\treturn offset;\r\n\t};\r\n\r\n\tScrollbarCell.prototype._getScrollOffset = function(){\r\n\t\tvar offset = 0;\r\n\t\tif(this._isVertical()){\r\n\t\t\tvar parentLayout = this.$parent.$parent;\r\n\t\t\toffset = Math.max(\r\n\t\t\t\tthis._getScaleOffset(parentLayout.getPrevSibling(this.$parent.$id)),\r\n\t\t\t\tthis._getScaleOffset(parentLayout.getNextSibling(this.$parent.$id))\r\n\t\t\t\t);\r\n\t\t}else{\r\n\t\t\tvar linked = this._getLinkedViews();\r\n\r\n\t\t\tfor (var i = 0; i < linked.length; i++) {\r\n\t\t\t\tvar view = linked[i],\r\n\t\t\t\t\tvparent = view.$parent;\r\n\t\t\t\tvar cells = vparent.$cells;\r\n\r\n\t\t\t\tvar last = cells[cells.length - 1];\r\n\r\n\t\t\t\tif (last && last.$config.view == \"scrollbar\" && last.$config.hidden === false) {\r\n\t\t\t\t\toffset = last.$config.width;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn offset || 0;\r\n\t};\r\n\r\n\tScrollbarCell.prototype._setScrollSize = function(size){\r\n\t\tvar property = this._isHorizontal() ? \"width\" : \"height\";\r\n\t\tvar scrollbar = this._isHorizontal() ? this.$scroll_hor : this.$scroll_ver;\r\n\r\n\t\tvar offset = this._getScrollOffset();\r\n\r\n\t\tvar node = scrollbar.firstChild;\r\n\r\n\t\tif(offset){\r\n\t\t\tif(this._isVertical()){\r\n\r\n\t\t\t\tthis.$config.outerSize = (this.$config.height - offset + 3);\r\n\t\t\t\tscrollbar.style.height = this.$config.outerSize + \"px\";\r\n\t\t\t\tscrollbar.style.top = (offset-1) + \"px\";\r\n\t\t\t\tdomHelpers.addClassName(scrollbar, this.$parent._borders.top);\r\n\t\t\t\tdomHelpers.addClassName(scrollbar.parentNode, \"gantt_task_vscroll\");\r\n\t\t\t}else{\r\n\t\t\t\tthis.$config.outerSize = (this.$config.width - offset + 1);\r\n\t\t\t\tscrollbar.style.width = this.$config.outerSize + \"px\";\r\n\t\t\t\t//domHelpers.addClassName(scrollbar, this.$parent._borders.right);\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tscrollbar.style.top = \"auto\";\r\n\t\t\tdomHelpers.removeClassName(scrollbar, this.$parent._borders.top);\r\n\t\t\tdomHelpers.removeClassName(scrollbar.parentNode, \"gantt_task_vscroll\");\r\n\t\t\tthis.$config.outerSize = this.$config.height;\r\n\t\t}\r\n\r\n\t\tnode.style[property] = size + \"px\";\r\n\t};\r\n\r\n\tScrollbarCell.prototype._scrollVerticalHandler = function (e) {\r\n\t\tif(this._scrollHorizontalHandler() || this._scrolling){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//if (this.$gantt._touch_scroll_active) return;\r\n\t\tvar top = this.$scroll_ver.scrollTop;\r\n\t\tvar prev = this._oldTop;\r\n\t\tif(top == prev) return;\r\n\r\n\t\tthis.scrollVertically(top);\r\n\r\n\t\tthis._oldTop = this.$scroll_ver.scrollTop;\r\n\r\n\t};\r\n\tScrollbarCell.prototype._outerScrollVerticalHandler = function(e){\r\n\t\tif(this._scrollHorizontalHandler()){\r\n\t\t\treturn;\r\n\t\t}\r\n\t};\r\n\r\n\tScrollbarCell.prototype._checkWheelTarget = function(targetNode){\r\n\t\tvar connectedViews = this._getLinkedViews().concat(this);\r\n\r\n\t\tfor(var i = 0; i < connectedViews.length; i++){\r\n\t\t\tvar node = connectedViews[i].$view;\r\n\t\t\tif(domHelpers.isChildOf(targetNode, node)){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t};\r\n\r\n\tScrollbarCell.prototype._mouseWheelHandler = function(e){\r\n\t\tvar target = e.target || e.srcElement;\r\n\r\n\t\tif(!this._checkWheelTarget(target))\r\n\t\t\treturn;\r\n\r\n\t\tthis._wheel_time = new Date();\r\n\r\n\t\tvar res = {};\r\n\r\n\t\tvar wheelSpeed = {x: 1, y: 1};\r\n\t\tvar wheelSpeedConfig = this.$gantt.config.wheel_scroll_sensitivity;\r\n\r\n\t\tif (typeof wheelSpeedConfig == \"number\" && !!wheelSpeedConfig) {\r\n\t\t\twheelSpeed = {x: wheelSpeedConfig, y: wheelSpeedConfig};\r\n\t\t}\r\n\t\telse if (({}).toString.apply(wheelSpeedConfig) == \"[object Object]\") {\r\n\t\t\twheelSpeed = {x: wheelSpeedConfig.x, y: wheelSpeedConfig.y};\r\n\t\t}\r\n\r\n\t\tvar ff = env.isFF;\r\n\t\tvar deltaX = ff ? (e.deltaX) : e.wheelDeltaX;\r\n\t\tvar deltaY = ff ? (e.deltaY) : e.wheelDelta;\r\n\r\n\t\tvar multiplier = -20;\r\n\t\tif (ff) {\r\n\t\t\tif (e.deltaMode !== 0) {\r\n\t\t\t\tmultiplier = -40;\r\n\t\t\t} else {\r\n\t\t\t\tmultiplier = -10;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar wx = ff ? (deltaX * multiplier * wheelSpeed.x) : deltaX * 2 * wheelSpeed.x;\r\n\t\tvar wy = ff ? (deltaY * multiplier * wheelSpeed.y) : deltaY * wheelSpeed.y;\r\n\r\n\t\tvar horizontalScrollModifier = this.$gantt.config.horizontal_scroll_key;\r\n\r\n\t\tif (horizontalScrollModifier !== false) {\r\n\t\t\tif (SCROLL_MODIFIER_KEYS.indexOf(horizontalScrollModifier) >= 0) {\r\n\t\t\t\tif(e[horizontalScrollModifier] && !(e.deltaX || e.wheelDeltaX)){\r\n\t\t\t\t\t// shift+mousewheel for horizontal scroll\r\n\t\t\t\t\twx = wy*2;\r\n\t\t\t\t\twy = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tif (wx && Math.abs(wx) > Math.abs(wy)){\r\n\t\t\tif(this._isVertical()){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(res.x) return true;//no horisontal scroll, must not block scrolling\r\n\t\t\tif(!this.$scroll_hor || !this.$scroll_hor.offsetWidth) return true;\r\n\r\n\t\t\tvar dir  = wx/-40;\r\n\t\t\tvar oldLeft = this._oldLeft;\r\n\t\t\tvar left = oldLeft+dir*30;\r\n\t\t\tthis.scrollHorizontally(left);\r\n\t\t\tthis.$scroll_hor.scrollLeft = left;\r\n\t\t\t// not block scroll if position hasn't changed\r\n\t\t\tif(oldLeft == this.$scroll_hor.scrollLeft){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tthis._oldLeft = this.$scroll_hor.scrollLeft;\r\n\t\t} else {\r\n\t\t\tif(this._isHorizontal()){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(res.y) return true;//no vertical scroll, must not block scrolling\r\n\t\t\tif(!this.$scroll_ver || !this.$scroll_ver.offsetHeight) return true;\r\n\r\n\t\t\tvar dir  = wy/-40;\r\n\t\t\tif (typeof wy == \"undefined\")\r\n\t\t\t\tdir = e.detail;\r\n\r\n\t\t\tvar oldTop = this._oldTop;\r\n\t\t\tvar top = this.$scroll_ver.scrollTop+dir*30;\r\n\r\n\t\t\t//if(!this.$gantt.config.prevent_default_scroll &&\r\n\t\t\t//\t(this.$gantt._cached_scroll_pos && ((this.$gantt._cached_scroll_pos.y == top) || (this.$gantt._cached_scroll_pos.y <= 0 && top <= 0)))) return true;\r\n\r\n\r\n\t\t\tthis.scrollVertically(top);\r\n\t\t\tthis.$scroll_ver.scrollTop = top;\r\n\r\n\t\t\t// not block scroll if position hasn't changed\r\n\t\t\tif(oldTop == this.$scroll_ver.scrollTop){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tthis._oldTop = this.$scroll_ver.scrollTop;\r\n\t\t}\r\n\r\n\t\tif (e.preventDefault)\r\n\t\t\te.preventDefault();\r\n\t\te.cancelBubble=true;\r\n\t\treturn false;\r\n\t};\r\n\r\n\treturn ScrollbarCell;\r\n})(Cell);\r\n\r\nexport default ScrollbarCell;","function createHelper(view){\r\n\tvar cachedRowHeight = -1;\r\n\tvar canUseSimpleCalc = -1;\r\n\treturn {\r\n\t\tresetCache: function(){\r\n\t\t\tcachedRowHeight = -1;\r\n\t\t\tcanUseSimpleCalc = -1;\r\n\t\t},\r\n\t\t_getRowHeight: function(){\r\n\t\t\tif(cachedRowHeight === -1){\r\n\t\t\t\tcachedRowHeight = view.$getConfig().row_height;\r\n\t\t\t}\r\n\t\t\treturn cachedRowHeight;\r\n\t\t},\r\n\t\t_refreshState: function(){\r\n\t\t\tthis.resetCache();\r\n\t\t\tcanUseSimpleCalc = true;\r\n\t\t\tvar store = view.$config.rowStore;\r\n\t\t\tif(!store){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar globalRowHeight = this._getRowHeight();\r\n\t\t\tfor (var i=0; i<store.fullOrder.length; i++) {\r\n\t\t\t\tvar item = store.getItem(store.fullOrder[i]);\r\n\t\t\t\t// GS-1491: ignore the task when it is filtered:\r\n\t\t\t\tif (!item) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif(item.row_height && item.row_height !== globalRowHeight){\r\n\t\t\t\t\tcanUseSimpleCalc = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n\t\t},\r\n\t\tcanUseSimpleCalculation: function(){\r\n\t\t\tif(canUseSimpleCalc === -1){\r\n\t\t\t\tthis._refreshState();\r\n\t\t\t}\r\n\t\t\treturn canUseSimpleCalc;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get top coordinate by row index (order)\r\n\t\t * @param {number} index\r\n\t\t */\r\n\t\tgetRowTop: function(index){\r\n\t\t\tvar store = view.$config.rowStore;\r\n\t\t\tif(!store){\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t\treturn index * this._getRowHeight();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get height of the item by item id\r\n\t\t * @param {*} itemId\r\n\t\t */\r\n\t\tgetItemHeight: function (itemId) {\r\n\t\t\treturn this._getRowHeight();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get total height of items\r\n\t\t */\r\n\t\tgetTotalHeight: function () {\r\n\t\t\tif(view.$config.rowStore){\r\n\t\t\t\tvar store = view.$config.rowStore;\r\n\t\t\t\treturn store.countVisible() * this._getRowHeight();\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get item by top position\r\n\t\t * @param {*} top\r\n\t\t */\r\n\t\tgetItemIndexByTopPosition: function (top) {\r\n\t\t\tif(view.$config.rowStore){\r\n\t\t\t\treturn Math.floor(top / this._getRowHeight());\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default createHelper;","import quickPositionHelperFactory from \"./row_position_fixed_height\";\r\n\r\nfunction createMixin(view){\r\n\tvar getItemTopCache = {};\r\n\tvar getRowTopCache = {};\r\n\tvar getItemHeightCache = null;\r\n\tvar totalHeightCache = -1;\r\n\tvar getItemHeightCacheState = null;\r\n\r\n\tvar quickPosition = quickPositionHelperFactory(view);\r\n\r\n\treturn {\r\n\t\t_resetTopPositionHeight: function(){\r\n\t\t\tgetItemTopCache = {};\r\n\t\t\tgetRowTopCache = {};\r\n\t\t\tquickPosition.resetCache();\r\n\t\t},\r\n\t\t_resetHeight: function(){\r\n\t\t\tvar store = this.$config.rowStore;\r\n\t\t\tvar newState = this.getCacheStateTotalHeight(store);\r\n\t\t\tif(!getItemHeightCacheState){\r\n\t\t\t\tgetItemHeightCacheState = newState;\r\n\t\t\t}else if(this.shouldClearHeightCache(getItemHeightCacheState, newState)){\r\n\t\t\t\tgetItemHeightCacheState = newState;\r\n\t\t\t\tgetItemHeightCache = null;\r\n\t\t\t}\r\n\r\n\t\t\ttotalHeightCache = -1;\r\n\t\t\tquickPosition.resetCache();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get top coordinate by row index (order)\r\n\t\t * @param {number} index\r\n\t\t */\r\n\t\tgetRowTop: function(index){\r\n\t\t\tif(quickPosition.canUseSimpleCalculation()){\r\n\t\t\t\treturn quickPosition.getRowTop(index);\r\n\t\t\t}\r\n\r\n\t\t\tvar store = this.$config.rowStore;\r\n\t\t\tif(!store){\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t\tif(getRowTopCache[index] !== undefined){\r\n\t\t\t\treturn getRowTopCache[index];\r\n\t\t\t}else {\r\n\t\t\t\tvar all = store.getIndexRange();\r\n\t\t\t\tvar top = 0;\r\n\t\t\t\tvar result = 0;\r\n\t\t\t\tfor(var i = 0; i < all.length; i++){\r\n\t\t\t\t\tgetRowTopCache[i] = top;\r\n\t\t\t\t\ttop += this.getItemHeight(all[i].id);\r\n\t\t\t\t\tif(i < index){\r\n\t\t\t\t\t\tresult = top;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get top coordinate by item id\r\n\t\t * @param {*} task_id\r\n\t\t */\r\n\t\tgetItemTop: function (taskId) {\r\n\t\t\tif(this.$config.rowStore){\r\n\t\t\t\tif(getItemTopCache[taskId] !== undefined){\r\n\t\t\t\t\treturn getItemTopCache[taskId];\r\n\t\t\t\t}\r\n\t\t\t\tvar store = this.$config.rowStore;\r\n\t\t\t\tif(!store) return 0;\r\n\r\n\t\t\t\tvar itemIndex = store.getIndexById(taskId);\r\n\r\n\t\t\t\tif (itemIndex === -1 && store.getParent && store.exists(taskId)) {\r\n\t\t\t\t\tvar parentId = store.getParent(taskId);\r\n\t\t\t\t\tif (store.exists(parentId)) {\r\n\t\t\t\t\t\t// if task is not found in list - maybe it's parent is a split task and we should use parents index instead\r\n\t\t\t\t\t\tvar parent = store.getItem(parentId);\r\n\t\t\t\t\t\tif (this.$gantt.isSplitTask(parent)) {\r\n\t\t\t\t\t\t\treturn this.getItemTop(parentId);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tgetItemTopCache[taskId] = this.getRowTop(itemIndex);\r\n\t\t\t\treturn getItemTopCache[taskId];\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get height of the item by item id\r\n\t\t * @param {*} itemId\r\n\t\t */\r\n\t\tgetItemHeight: function (itemId) {\r\n\t\t\tif(quickPosition.canUseSimpleCalculation()){\r\n\t\t\t\treturn quickPosition.getItemHeight(itemId);\r\n\t\t\t}\r\n\r\n\t\t\tif(!getItemHeightCache && this.$config.rowStore){\r\n\t\t\t\tthis._fillHeightCache(this.$config.rowStore);\r\n\t\t\t}\r\n\r\n\t\t\tif(getItemHeightCache[itemId] !== undefined){\r\n\t\t\t\treturn getItemHeightCache[itemId];\r\n\t\t\t}\r\n\r\n\t\t\tvar defaultHeight = this.$getConfig().row_height;\r\n\r\n\t\t\tif(this.$config.rowStore){\r\n\t\t\t\tvar store = this.$config.rowStore;\r\n\t\t\t\tif(!store) return defaultHeight;\r\n\r\n\t\t\t\tvar item = store.getItem(itemId);\r\n\r\n\t\t\t\treturn getItemHeightCache[itemId] = item && item.row_height || defaultHeight;\r\n\t\t\t}else{\r\n\t\t\t\treturn defaultHeight;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_fillHeightCache: function(store){\r\n\t\t\tif(!store){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tgetItemHeightCache = {};\r\n\t\t\tvar defaultHeight = this.$getConfig().row_height;\r\n\t\t\tstore.eachItem(function(item){\r\n\t\t\t\treturn getItemHeightCache[item.id] = item && item.row_height || defaultHeight;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetCacheStateTotalHeight: function(store){\r\n\r\n\t\t\tvar globalHeight = this.$getConfig().row_height;\r\n\t\t\tvar itemHeightCache = {};\r\n\t\t\tvar items = [];\r\n\t\t\tvar sumHeight = 0;\r\n\t\t\tif(store){\r\n\t\t\t\tstore.eachItem(function(item){\r\n\t\t\t\t\titems.push(item);\r\n\t\t\t\t\titemHeightCache[item.id] = item.row_height;\r\n\t\t\t\t\tsumHeight += item.row_height || globalHeight;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\r\n\t\t\treturn {\r\n\t\t\t\tglobalHeight: globalHeight,\r\n\t\t\t\titems: items,\r\n\t\t\t\tcount: items.length,\r\n\t\t\t\tsumHeight: sumHeight\r\n\t\t\t};\r\n\t\t},\r\n\t\tshouldClearHeightCache: function(oldState, newState){\r\n\r\n\t\t\tif(oldState.count != newState.count){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif(oldState.globalHeight != newState.globalHeight){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tif(oldState.sumHeight != newState.sumHeight){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tfor(var i in oldState.items){\r\n\t\t\t\tvar newValue = newState.items[i];\r\n\t\t\t\tif(newValue !== undefined && newValue != oldState.items[i]){\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\t/**\r\n\t\t * Get total height of items\r\n\t\t */\r\n\t\tgetTotalHeight: function () {\r\n\t\t\tif(quickPosition.canUseSimpleCalculation()){\r\n\t\t\t\treturn quickPosition.getTotalHeight();\r\n\t\t\t}\r\n\r\n\t\t\tif(totalHeightCache != -1){\r\n\t\t\t\treturn totalHeightCache;\r\n\t\t\t}\r\n\r\n\t\t\tif(this.$config.rowStore){\r\n\t\t\t\tvar store = this.$config.rowStore;\r\n\t\t\t\tthis._fillHeightCache(store);\r\n\t\t\t\tvar getHeight = this.getItemHeight.bind(this);\r\n\t\t\t\tvar visibleItems = store.getVisibleItems();\r\n\t\t\t\tvar totalHeight = 0;\r\n\r\n\t\t\t\tvisibleItems.forEach(function(item){\r\n\t\t\t\t\ttotalHeight += getHeight(item.id);\r\n\t\t\t\t});\r\n\r\n\t\t\t\ttotalHeightCache = totalHeight;\r\n\t\t\t\treturn totalHeight;\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get item by top position\r\n\t\t * @param {*} top\r\n\t\t */\r\n\t\tgetItemIndexByTopPosition: function (top) {\r\n\t\t\tif(this.$config.rowStore){\r\n\t\t\t\tif(quickPosition.canUseSimpleCalculation()){\r\n\t\t\t\t\treturn quickPosition.getItemIndexByTopPosition(top);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar store = this.$config.rowStore;\r\n\t\t\t\tfor(var i = 0; i < store.countVisible(); i++){\r\n\t\t\t\t\tvar current = this.getRowTop(i);\r\n\t\t\t\t\tvar next = this.getRowTop(i+1);\r\n\t\t\t\t\tif(!next){\r\n\t\t\t\t\t\tvar taskId = store.getIdByIndex(i);\r\n\t\t\t\t\t\tnext = current + this.getItemHeight(taskId);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(top >= current && top < next){\r\n\t\t\t\t\t\treturn i;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// GS-1723: If we iterated all tasks and didn't find the position, the target is below all other tasks\r\n\t\t\t\treturn store.countVisible() + 2;\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default createMixin;","var createStaticBgHelper = function(){\r\n\treturn {\r\n\t\trender: function () { },\r\n\t\tdestroy: function () { }\r\n\t};\r\n};\r\n\r\nexport default {\r\n\tcreate: function(){\r\n\t\treturn createStaticBgHelper();\r\n\t}\r\n};\r\n\r\n","\r\nexport default function(){\r\n\tvar self = this;\r\n\tvar taskFilter = function(){\r\n\t\treturn self.isVisible();\r\n\t};\r\n\r\n\tvar barVisible = function(id, task){\r\n\t\treturn !task.hide_bar;\r\n\t};\r\n\r\n\tconst gantt = this.$gantt;\r\n\r\n\tvar taskLayers = [\r\n\t\t{\r\n\t\t\texpose: true,\r\n\t\t\trenderer: this.$gantt.$ui.layers.taskBar(),\r\n\t\t\tcontainer: this.$task_bars,\r\n\t\t\tfilter: [taskFilter, barVisible]\r\n\t\t}\r\n\t];\r\n\r\n\ttaskLayers.push({\r\n\t\trenderer: this.$gantt.$ui.layers.taskBg(),\r\n\t\tcontainer: this.$task_bg,\r\n\t\tfilter: [\r\n\t\t\t//function(){\r\n\t\t\t//\treturn !self.$getConfig().static_background;\r\n\t\t\t//},\r\n\t\t\ttaskFilter\r\n\t\t]\r\n\t});\r\n\r\n\tvar linkLayers = [\r\n\t\t{\r\n\t\t\texpose: true,\r\n\t\t\trenderer: this.$gantt.$ui.layers.link(),\r\n\t\t\tcontainer: this.$task_links,\r\n\t\t\tfilter: [taskFilter]\r\n\t\t}\r\n\t];\r\n\r\n\treturn {\r\n\t\ttasks: taskLayers,\r\n\t\tlinks: linkLayers\r\n\t};\r\n\r\n};","import ScaleHelper from \"./scales_ignore\";\r\nimport eventable from \"../../../utils/eventable\";\r\nimport * as utils from \"../../../utils/utils\";\r\nimport * as helpers from \"../../../utils/helpers\";\r\nimport topPositionMixin from \"../row_position_mixin\";\r\nimport canvasRender from \"./tasks_canvas_render\";\r\nimport createLayerConfig from \"./timeline_layers\";\r\n\r\nvar Timeline = function(parent, config, factory, gantt){\r\n\tthis.$config = utils.mixin({}, config || {});\r\n\tthis.$scaleHelper = new ScaleHelper(gantt);\r\n\tthis.$gantt = gantt;\r\n\tthis._posFromDateCache = {};\r\n\tthis._timelineDragScroll = null;\r\n\tutils.mixin(this, topPositionMixin(this));\r\n\teventable(this);\r\n};\r\n\r\nTimeline.prototype = {\r\n\tinit: function(container) {\r\n\t\tcontainer.innerHTML += \"<div class='gantt_task' style='width:inherit;height:inherit;'></div>\";\r\n\t\tthis.$task = container.childNodes[0];\r\n\r\n\t\tthis.$task.innerHTML = \"<div class='gantt_task_scale'></div><div class='gantt_data_area'></div>\";\r\n\t\tthis.$task_scale = this.$task.childNodes[0];\r\n\r\n\t\tthis.$task_data = this.$task.childNodes[1];\r\n\t\tconst taskBg = \"<div class='gantt_task_bg'></div>\";\r\n\t\tconst links = \"<div class='gantt_links_area'></div>\";\r\n\t\tconst taskBars = \"<div class='gantt_bars_area'></div>\";\r\n\r\n\t\tconst taskConstraints = \"<div class='gantt_task_constraints'></div>\";\r\n\t\tconst taskDeadlines = \"<div class='gantt_task_deadlines'></div>\";\r\n\t\tconst taskBaselines = \"<div class='gantt_task_baselines'></div>\";\r\n\r\n\t\tthis.$task_data.innerHTML = taskBg + taskBaselines + links + taskBars + taskConstraints + taskDeadlines;\r\n\r\n\t\tthis.$task_bg = this.$task_data.childNodes[0];\r\n\t\tthis.$task_baselines = this.$task_data.childNodes[1];\r\n\t\tthis.$task_links = this.$task_data.childNodes[2];\r\n\t\tthis.$task_bars = this.$task_data.childNodes[3];\r\n\t\tthis.$task_constraints = this.$task_data.childNodes[4];\r\n\t\tthis.$task_deadlines = this.$task_data.childNodes[5];\r\n\r\n\t\tthis._tasks = {\r\n\t\t\tcol_width: 0,\r\n\t\t\twidth: [], // width of each column\r\n\t\t\tfull_width: 0, // width of all columns\r\n\t\t\ttrace_x: [],\r\n\t\t\trendered: {}\r\n\t\t};\r\n\r\n\t\tvar config = this.$getConfig();\r\n\t\tvar attr = config[this.$config.bind + \"_attribute\"];\r\n\t\tvar linksAttr = config[this.$config.bindLinks + \"_attribute\"];\r\n\t\tif(!attr && this.$config.bind){\r\n\t\t\tattr = \"data-\" + this.$config.bind + \"-id\";\r\n\t\t}\r\n\t\tif(!linksAttr && this.$config.bindLinks){\r\n\t\t\tlinksAttr = \"data-\" + this.$config.bindLinks + \"-id\";\r\n\t\t}\r\n\t\tthis.$config.item_attribute = attr || null;\r\n\t\tthis.$config.link_attribute = linksAttr || null;\r\n\r\n\t\tvar layers = this._createLayerConfig();\r\n\t\tif(!this.$config.layers){\r\n\t\t\tthis.$config.layers = layers.tasks;\r\n\t\t}\r\n\t\tif(!this.$config.linkLayers){\r\n\t\t\tthis.$config.linkLayers = layers.links;\r\n\t\t}\r\n\r\n\t\tthis._attachLayers(this.$gantt);\r\n\r\n\t\tthis.callEvent(\"onReady\", []);\r\n\t\t//this.refresh();\r\n\t\tif (this.$gantt.ext.dragTimeline) {\r\n\t\t\tthis._timelineDragScroll = this.$gantt.ext.dragTimeline.create();\r\n\t\t\tthis._timelineDragScroll.attach(this);\r\n\t\t}\r\n\t},\r\n\r\n\tsetSize: function(width, height){\r\n\t\tvar config = this.$getConfig();\r\n\r\n\t\tif(width*1 === width){\r\n\t\t\tthis.$config.width = width;\r\n\t\t}\r\n\t\tif(height*1 === height){\r\n\r\n\t\t\tthis.$config.height = height;\r\n\t\t\tvar dataHeight = Math.max(this.$config.height - config.scale_height);\r\n\t\t\tthis.$task_data.style.height = dataHeight + 'px';\r\n\t\t}\r\n\r\n\t\tthis.refresh();\r\n\t\tthis.$task_bg.style.backgroundImage = \"\";\r\n\r\n\t\tif(config.smart_rendering && this.$config.rowStore){\r\n\t\t\tthis.$task_bg.style.height = this.getTotalHeight() +\"px\";\r\n\t\t}else{\r\n\t\t\tthis.$task_bg.style.height = \"\";\r\n\t\t}\r\n\r\n\t\tvar scale = this._tasks;\r\n\t\t//timeline area layers\r\n\t\tvar data_els = this.$task_data.childNodes;\r\n\t\tfor(var i= 0, len = data_els.length; i < len; i++){\r\n\t\t\tvar el = data_els[i];\r\n\t\t\tif(el.hasAttribute(\"data-layer\") && el.style)\r\n\t\t\t\tel.style.width = scale.full_width + \"px\";\r\n\t\t}\r\n\t},\r\n\r\n\tisVisible: function(){\r\n\t\tif(this.$parent && this.$parent.$config){\r\n\t\t\treturn !this.$parent.$config.hidden;\r\n\t\t}else{\r\n\t\t\treturn this.$task.offsetWidth;\r\n\t\t}\r\n\t},\r\n\r\n\tgetSize: function(){\r\n\t\tvar config = this.$getConfig();\r\n\t\tvar store = this.$config.rowStore;\r\n\r\n\t\tvar contentHeight = store ? this.getTotalHeight() : 0,\r\n\t\t\tcontentWidth = this.isVisible() ? this._tasks.full_width : 0;\r\n\r\n\t\treturn {\r\n\t\t\tx: this.isVisible() ? this.$config.width : 0,\r\n\t\t\ty: this.isVisible() ? this.$config.height : 0,\r\n\t\t\tcontentX: this.isVisible() ? contentWidth : 0,\r\n\t\t\tcontentY: this.isVisible() ? (config.scale_height + contentHeight) : 0,\r\n\t\t\tscrollHeight: this.isVisible() ? contentHeight : 0,\r\n\t\t\tscrollWidth: this.isVisible() ? contentWidth : 0\r\n\t\t};\r\n\t},\r\n\r\n\tscrollTo: function(left, top){\r\n\t\tif(!this.isVisible())\r\n\t\t\treturn;\r\n\r\n\t\tvar scrolled = false;\r\n\r\n\t\tthis.$config.scrollTop = this.$config.scrollTop || 0;\r\n\t\tthis.$config.scrollLeft = this.$config.scrollLeft || 0;\r\n\t\tif(top*1 === top){\r\n\t\t\tthis.$config.scrollTop = top;\r\n\t\t\tthis.$task_data.scrollTop = this.$config.scrollTop;\r\n\t\t\tscrolled = true;\r\n\t\t}\r\n\t\tif (left*1 === left){\r\n\t\t\tthis.$task.scrollLeft = left;\r\n\t\t\tthis.$config.scrollLeft = this.$task.scrollLeft;\r\n\t\t\tthis._refreshScales();\r\n\t\t\tscrolled = true;\r\n\t\t}\r\n\r\n\t\tif(scrolled){\r\n\t\t\tthis.callEvent(\"onScroll\", [this.$config.scrollLeft, this.$config.scrollTop]);\r\n\t\t}\r\n\t},\r\n\r\n\t_refreshScales: function _refreshScales() {\r\n\t\tif(!this.isVisible())\r\n\t\t\treturn;\r\n\r\n\t\tvar config = this.$getConfig();\r\n\t\tif (!config.smart_scales) return;\r\n\r\n\t\tvar viewPort = this.getViewPort();\r\n\r\n\t\tvar scales = this._scales;\r\n\t\tthis.$task_scale.innerHTML = this._getScaleChunkHtml(scales, viewPort.x, viewPort.x_end);\r\n\t},\r\n\r\n\tgetViewPort: function(){\r\n\t\tvar scrollLeft = this.$config.scrollLeft || 0;\r\n\t\tvar scrollTop = this.$config.scrollTop || 0;\r\n\t\tvar height = this.$config.height || 0;\r\n\t\tvar width = this.$config.width || 0;\r\n\t\treturn {\r\n\t\t\ty: scrollTop,\r\n\t\t\ty_end: scrollTop + height,\r\n\t\t\tx: scrollLeft,\r\n\t\t\tx_end: scrollLeft + width,\r\n\t\t\theight: height,\r\n\t\t\twidth: width\r\n\t\t};\r\n\t},\r\n\r\n\t_createLayerConfig: createLayerConfig,\r\n\r\n\t_attachLayers: function(gantt){\r\n\t\tthis._taskLayers = [];\r\n\t\tthis._linkLayers = [];\r\n\r\n\t\tvar self = this;\r\n\r\n\t\tvar layers = this.$gantt.$services.getService(\"layers\");\r\n\r\n\t\tif(this.$config.bind){\r\n\r\n\t\t\tthis._bindStore();\r\n\t\t\tvar taskRenderer = layers.getDataRender(this.$config.bind);\r\n\r\n\t\t\tif(!taskRenderer){\r\n\t\t\t\ttaskRenderer = layers.createDataRender({\r\n\t\t\t\t\tname: this.$config.bind,\r\n\t\t\t\t\tdefaultContainer: function(){ return self.$task_data;}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\ttaskRenderer.container = function(){ return self.$task_data;};\r\n\r\n\t\t\tvar taskLayers = this.$config.layers;\r\n\t\t\tfor(var i = 0; taskLayers && i < taskLayers.length; i++){\r\n\t\t\t\tvar layer = taskLayers[i];\r\n\r\n\t\t\t\tif(typeof layer == \"string\"){\r\n\t\t\t\t\tlayer = this.$gantt.$ui.layers[layer]();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(typeof layer == \"function\" || (layer && layer.render && layer.update)){\r\n\t\t\t\t\tlayer = {renderer: layer};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlayer.view = this;\r\n\r\n\t\t\t\tvar bar_layer = taskRenderer.addLayer(layer);\r\n\t\t\t\tthis._taskLayers.push(bar_layer);\r\n\t\t\t\tif(layer.expose){\r\n\t\t\t\t\tthis._taskRenderer = taskRenderer.getLayer(bar_layer);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._initStaticBackgroundRender();\r\n\t\t}\r\n\r\n\t\tif(this.$config.bindLinks){\r\n\t\t\tself.$config.linkStore = self.$gantt.getDatastore(self.$config.bindLinks);\r\n\r\n\t\t\tvar linkRenderer = layers.getDataRender(this.$config.bindLinks);\r\n\r\n\t\t\tif(!linkRenderer){\r\n\t\t\t\tlinkRenderer = layers.createDataRender({\r\n\t\t\t\t\tname: this.$config.bindLinks,\r\n\t\t\t\t\tdefaultContainer: function(){ return self.$task_data;}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tvar linkLayers = this.$config.linkLayers;\r\n\t\t\tfor(var i = 0; linkLayers && i < linkLayers.length; i++){\r\n\r\n\t\t\t\tif(typeof layer == \"string\"){\r\n\t\t\t\t\tlayer = this.$gantt.$ui.layers[layer]();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar layer = linkLayers[i];\r\n\t\t\t\tlayer.view = this;\r\n\t\t\t//\tlayer.getViewPort = getViewPort;\r\n\t\t\t//\tsubscribeSmartRender(layer);\r\n\t\t\t\tvar linkLayer = linkRenderer.addLayer(layer);\r\n\t\t\t\tthis._taskLayers.push(linkLayer);\r\n\t\t\t\tif(linkLayers[i].expose){\r\n\t\t\t\t\tthis._linkRenderer = linkRenderer.getLayer(linkLayer);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t_initStaticBackgroundRender: function(){\r\n\t\tvar self = this;\r\n\t\tvar staticRender = canvasRender.create();\r\n\t\tvar store = self.$config.rowStore;\r\n\t\tif(!store) return;\r\n\r\n\t\tthis._staticBgHandler = store.attachEvent(\"onStoreUpdated\", function(id, item, mode){\r\n\t\t\tif(id !== null) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(!self.isVisible())\r\n\t\t\t\treturn;\r\n\t\t\tvar config = self.$getConfig();\r\n\t\t\tif(config.static_background || config.timeline_placeholder) {\r\n\t\t\t\tvar store = self.$gantt.getDatastore(self.$config.bind);\r\n\t\t\t\tvar staticBgContainer = self.$task_bg_static;\r\n\t\t\t\tif(!staticBgContainer){\r\n\t\t\t\t\tstaticBgContainer = document.createElement(\"div\");\r\n\t\t\t\t\tstaticBgContainer.className = \"gantt_task_bg\";\r\n\t\t\t\t\tself.$task_bg_static = staticBgContainer;\r\n\t\t\t\t\tif(self.$task_bg.nextSibling){\r\n\t\t\t\t\t\tself.$task_data.insertBefore(staticBgContainer, self.$task_bg.nextSibling);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tself.$task_data.appendChild(staticBgContainer);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (store) {\r\n\t\t\t\t\tvar staticBackgroundHeight = self.getTotalHeight();\r\n\t\t\t\t\tif (config.timeline_placeholder){\r\n\t\t\t\t\t\tstaticBackgroundHeight = config.timeline_placeholder.height || self.$task_data.offsetHeight || 99999;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tstaticRender.render(staticBgContainer, config, self.getScale(), staticBackgroundHeight, self.getItemHeight(item ? item.id : null));\r\n\t\t\t\t}\r\n\t\t\t}else if(config.static_background){\r\n\t\t\t\tif(self.$task_bg_static && self.$task_bg_static.parentNode){\r\n\t\t\t\t\tself.$task_bg_static.parentNode.removeChild(self.$task_bg_static);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.attachEvent(\"onDestroy\", function () {\r\n\t\t\tstaticRender.destroy();\r\n\t\t});\r\n\t\tthis._initStaticBackgroundRender = function(){};//init once\r\n\t},\r\n\r\n\t_clearLayers: function(gantt){\r\n\t\tvar layers = this.$gantt.$services.getService(\"layers\");\r\n\t\tvar taskRenderer = layers.getDataRender(this.$config.bind);\r\n\t\tvar linkRenderer = layers.getDataRender(this.$config.bindLinks);\r\n\r\n\t\tif (this._taskLayers) {\r\n\t\t\tfor(var i = 0; i < this._taskLayers.length; i++){\r\n\t\t\t\ttaskRenderer.removeLayer(this._taskLayers[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._linkLayers) {\r\n\t\t\tfor(var i = 0; i < this._linkLayers.length; i++){\r\n\t\t\t\tlinkRenderer.removeLayer(this._linkLayers[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._linkLayers = [];\r\n\t\tthis._taskLayers = [];\r\n\t},\r\n\r\n\t_render_tasks_scales: function _render_tasks_scales() {\r\n\t\tvar config = this.$getConfig();\r\n\r\n\t\tvar scales_html = \"\",\r\n\t\t\touter_width = 0,\r\n\t\t\tscale_height = 0;\r\n\r\n\t\tvar state = this.$gantt.getState();\r\n\r\n\t\tif (this.isVisible()) {\r\n\t\t\tvar helpers = this.$scaleHelper;\r\n\t\t\tvar scales = this._getScales();\r\n\t\t\tscale_height = config.scale_height;\r\n\r\n\t\t\tvar availWidth = this.$config.width;\r\n\t\t\tif(config.autosize == \"x\" || config.autosize == \"xy\"){\r\n\t\t\t\tavailWidth = Math.max(config.autosize_min_width, 0);\r\n\t\t\t}\r\n\r\n\t\t\tvar cfgs = helpers.prepareConfigs(scales, config.min_column_width, availWidth, scale_height - 1, state.min_date, state.max_date, config.rtl);\r\n\t\t\tvar cfg = this._tasks = cfgs[cfgs.length - 1];\r\n\t\t\tthis._scales = cfgs;\r\n\t\t\tthis._posFromDateCache = {};\r\n\r\n\t\t\tscales_html = this._getScaleChunkHtml(cfgs, 0, this.$config.width);\r\n\r\n\t\t\touter_width = cfg.full_width + \"px\";//cfg.full_width + (this._scroll_sizes().y ? scrollSizes.scroll_size : 0) + \"px\";\r\n\t\t\tscale_height += \"px\";\r\n\t\t}\r\n\r\n\t\tthis.$task_scale.style.height = scale_height;\r\n\r\n\t\tthis.$task_data.style.width =\r\n\t\t\tthis.$task_scale.style.width = outer_width;\r\n\r\n\t\tthis.$task_scale.innerHTML = scales_html;\r\n\r\n\t},\r\n\r\n\t_getScaleChunkHtml: function _get_scale_chunk_html (scales, fromPos, toPos) {\r\n\t\tvar templates = this.$gantt.templates;\r\n\t\tvar html = [];\r\n\r\n\t\tvar css = templates.scale_row_class;\r\n\t\tfor (var i = 0; i < scales.length; i++) {\r\n\t\t\tvar cssClass = \"gantt_scale_line\";\r\n\t\t\tvar tplClass = css(scales[i]);\r\n\t\t\tif (tplClass) {\r\n\t\t\t\tcssClass += \" \" + tplClass;\r\n\t\t\t}\r\n\r\n\t\t\thtml.push(\"<div class=\\\"\" + cssClass + \"\\\" style=\\\"height:\" + (scales[i].height) +\r\n\t\t\t\t\"px;position:relative;line-height:\" + (scales[i].height) + \"px\\\">\" + this._prepareScaleHtml(scales[i], fromPos, toPos, i) + \"</div>\");\r\n\t\t}\r\n\r\n\t\treturn html.join(\"\");\r\n\t},\r\n\t_prepareScaleHtml: function _prepare_scale_html(config, fromPos, toPos, index) {\r\n\t\tvar globalConfig = this.$getConfig();\r\n\t\tvar globalTemplates = this.$gantt.templates;\r\n\r\n\t\tvar cells = [];\r\n\t\tvar date = null, css = null;\r\n\r\n\t\tvar content = config.format || config.template || config.date;\r\n\r\n\t\tif(typeof content === \"string\"){\r\n\t\t\tcontent = this.$gantt.date.date_to_str(content);\r\n\t\t}\r\n\r\n\t\tvar startIndex = 0,\r\n\t\t\tendIndex = config.count;\r\n\r\n\t\tif (globalConfig.smart_scales && (!isNaN(fromPos) && !isNaN(toPos))) {\r\n\t\t\tstartIndex = helpers.findBinary(config.left, fromPos);\r\n\t\t\tendIndex = helpers.findBinary(config.left, toPos) + 1;\r\n\t\t}\r\n\r\n\t\tcss = config.css || function () {\r\n\t\t\t};\r\n\t\tif (!config.css && globalConfig.inherit_scale_class) {\r\n\t\t\tcss = globalTemplates.scale_cell_class;\r\n\t\t}\r\n\r\n\t\tfor (var i = startIndex; i < endIndex; i++) {\r\n\t\t\tif (!config.trace_x[i]) break;\r\n\r\n\t\t\tdate = new Date(config.trace_x[i]);\r\n\t\t\tvar value = content.call(this, date),\r\n\t\t\t\twidth = config.width[i],\r\n\t\t\t\theight = config.height,\r\n\t\t\t\tleft = config.left[i],\r\n\t\t\t\tstyle = \"\",\r\n\t\t\t\ttemplate = \"\",\r\n\t\t\t\tcssclass = \"\";\r\n\r\n\t\t\tif (width) {\r\n\t\t\t\tvar position = globalConfig.smart_scales ? (\"position:absolute;left:\" + left + \"px\") : \"\";\r\n\r\n\t\t\t\tstyle = \"width:\" + (width) + \"px;\" + position;\r\n\t\t\t\t// GS-1188: Display the scale value in the viewport for long cells\r\n\t\t\t\tconst viewPort = this.getViewPort();\r\n\t\t\t\tconst floatConfig = (globalConfig.scales[index] || {}).sticky; // for old scale settings\r\n\r\n\t\t\t\tlet labelPosition = '';\r\n\t\t\t\tconst approxLabelWidth = 70;\r\n\t\t\t\t// if sticky config is not specified - sticky labels are enabled for long cells only\r\n\t\t\t\tif ((floatConfig !== false && width > approxLabelWidth) || floatConfig === true) {\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (left < viewPort.x && left + width/2 - approxLabelWidth/2 < viewPort.x){\r\n\t\t\t\t\t\tlabelPosition = ` style='position:absolute;left: ${viewPort.x  - left + 10}px;' `;\r\n\t\t\t\t\t} else if(left + width/2 + approxLabelWidth/2 > viewPort.x_end && width > approxLabelWidth){\r\n\t\t\t\t\t\tlet labelPos = viewPort.x_end - left - 10;\r\n\t\t\t\t\t\tlet translateValue = \"-100%\";\r\n\t\t\t\t\t\tif(labelPos < approxLabelWidth) {\r\n\t\t\t\t\t\t\tlabelPos = approxLabelWidth;\r\n\t\t\t\t\t\t\ttranslateValue = `-${labelPos}px`;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlabelPosition = ` style='position:absolute;left: ${labelPos}px;transform: translate(${translateValue},0);' `;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcssclass = \"gantt_scale_cell\" + (i == config.count - 1 ? \" gantt_last_cell\" : \"\");\r\n\r\n\t\t\t\ttemplate = css.call(this, date);\r\n\t\t\t\tif (template) cssclass += \" \" + template;\r\n\r\n\t\t\t\tvar ariaAttr = this.$gantt._waiAria.getTimelineCellAttr(value);\r\n\t\t\t\tvar cell = `<div class='${cssclass}' ${ariaAttr} style='${style}'><span ${labelPosition}>${value}</span></div>`;\r\n\t\t\t\tcells.push(cell);\r\n\t\t\t} else {\r\n\t\t\t\t//do not render ignored cells\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\treturn cells.join(\"\");\r\n\t},\r\n\tdateFromPos: function dateFromPos(x) {\r\n\t\tvar scale = this._tasks;\r\n\t\tif (x < 0 || x > scale.full_width || !scale.full_width) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar ind = helpers.findBinary(this._tasks.left, x);\r\n\t\tvar summ = this._tasks.left[ind];\r\n\r\n\t\tvar col_width = scale.width[ind] || scale.col_width;\r\n\t\tvar part = 0;\r\n\t\tif (col_width) {\r\n\t\t\tpart = (x - summ) / col_width;\r\n\t\t\tif(scale.rtl){\r\n\t\t\t\tpart = 1 - part;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar unit = 0;\r\n\t\tif (part) {\r\n\t\t\tunit = this._getColumnDuration(scale, scale.trace_x[ind]);\r\n\t\t}\r\n\r\n\t\tvar date = new Date(scale.trace_x[ind].valueOf() + Math.round(part * unit));\r\n\t\treturn date;\r\n\t},\r\n\tposFromDate: function posFromDate(date) {\r\n\t\tif (!this.isVisible())\r\n\t\t\treturn 0;\r\n\r\n\t\tif(!date){\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tvar dateValue = String(date.valueOf());\r\n\r\n\t\tif(this._posFromDateCache[dateValue] !== undefined){\r\n\t\t\treturn this._posFromDateCache[dateValue];\r\n\t\t}\r\n\t\tvar ind = this.columnIndexByDate(date);\r\n\t\tthis.$gantt.assert(ind >= 0, \"Invalid day index\");\r\n\r\n\t\tvar wholeCells = Math.floor(ind);\r\n\t\tvar partCell = ind % 1;\r\n\r\n\t\tvar pos = this._tasks.left[Math.min(wholeCells, this._tasks.width.length - 1)];\r\n\t\tif (wholeCells == this._tasks.width.length)\r\n\t\t\tpos += this._tasks.width[this._tasks.width.length - 1];\r\n\t\t//for(var i=1; i <= wholeCells; i++)\r\n\t\t//\tpos += gantt._tasks.width[i-1];\r\n\r\n\t\tif (partCell) {\r\n\t\t\tif (wholeCells < this._tasks.width.length) {\r\n\t\t\t\tpos += this._tasks.width[wholeCells] * (partCell % 1);\r\n\t\t\t} else {\r\n\t\t\t\tpos += 1;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar roundPos = Math.round(pos);\r\n\t\tthis._posFromDateCache[dateValue] = roundPos;\r\n\t\treturn Math.round(roundPos);\r\n\t},\r\n\r\n\t_getNextVisibleColumn: function (startIndex, columns, ignores) {\r\n\t\t// iterate columns to the right\r\n\t\tvar date = +columns[startIndex];\r\n\t\tvar visibleDateIndex = startIndex;\r\n\t\twhile (ignores[date]) {\r\n\t\t\tvisibleDateIndex++;\r\n\t\t\tdate = +columns[visibleDateIndex];\r\n\t\t}\r\n\r\n\t\treturn visibleDateIndex;\r\n\t},\r\n\t_getPrevVisibleColumn: function (startIndex, columns, ignores) {\r\n\t\t// iterate columns to the left\r\n\t\tvar date = +columns[startIndex];\r\n\t\tvar visibleDateIndex = startIndex;\r\n\t\twhile (ignores[date]) {\r\n\t\t\tvisibleDateIndex--;\r\n\t\t\tdate = +columns[visibleDateIndex];\r\n\t\t}\r\n\t\treturn visibleDateIndex;\r\n\t},\r\n\t_getClosestVisibleColumn: function (startIndex, columns, ignores) {\r\n\t\tvar visibleDateIndex = this._getNextVisibleColumn(startIndex, columns, ignores);\r\n\t\tif (!columns[visibleDateIndex]) {\r\n\t\t\tvisibleDateIndex =  this._getPrevVisibleColumn(startIndex, columns, ignores);\r\n\t\t}\r\n\t\treturn visibleDateIndex;\r\n\t},\r\n\tcolumnIndexByDate: function columnIndexByDate(date) {\r\n\t\tvar pos = new Date(date).valueOf();\r\n\t\tvar days = this._tasks.trace_x_ascending,\r\n\t\t\tignores = this._tasks.ignore_x;\r\n\r\n\t\tvar state = this.$gantt.getState();\r\n\r\n\t\tif (pos <= state.min_date) {\r\n\t\t\tif(this._tasks.rtl){\r\n\t\t\t\treturn days.length;\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (pos >= state.max_date) {\r\n\t\t\tif(this._tasks.rtl){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn days.length;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar dateIndex = helpers.findBinary(days, pos);\r\n\r\n\t\tvar visibleIndex = this._getClosestVisibleColumn(dateIndex, days, ignores);\r\n\t\tvar visibleDate = days[visibleIndex];\r\n\t\tvar transition = this._tasks.trace_index_transition;\r\n\r\n\t\tif(!visibleDate){\r\n\t\t\tif(transition){\r\n\t\t\t\treturn transition[0];\r\n\t\t\t}else{\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar part = ((date - days[visibleIndex]) / this._getColumnDuration(this._tasks, days[visibleIndex]));\r\n\t\tif(transition){\r\n\t\t\treturn transition[visibleIndex] + (1 - part);\r\n\t\t}else{\r\n\t\t\treturn visibleIndex + part;\r\n\t\t}\r\n\t},\r\n\tgetItemPosition:function (task, start_date, end_date) {\r\n\t\tvar xLeft, xRight, width;\r\n\r\n\t\tlet displayStart = start_date || task.start_date || task.$auto_start_date;\r\n\t\tlet displayEnd = end_date || task.end_date || task.$auto_end_date;\r\n\t\tif(this._tasks.rtl){\r\n\t\t\txRight = this.posFromDate(displayStart);\r\n\t\t\txLeft = this.posFromDate(displayEnd);\r\n\t\t}else{\r\n\t\t\txLeft = this.posFromDate(displayStart);\r\n\t\t\txRight = this.posFromDate(displayEnd);\r\n\t\t}\r\n\t\twidth =  Math.max((xRight - xLeft), 0);\r\n\r\n\t\tvar y = this.getItemTop(task.id);\r\n\r\n\t\tvar height = this.getBarHeight(task.id);\r\n\t\tvar rowHeight = this.getItemHeight(task.id);\r\n\t\treturn {\r\n\t\t\tleft: xLeft,\r\n\t\t\ttop: y,\r\n\t\t\theight: height,\r\n\t\t\twidth: width,\r\n\t\t\trowHeight: rowHeight\r\n\t\t};\r\n\t},\r\n\r\n\tgetBarHeight: function(taskId, isMilestoneRender){\r\n\t\tvar config = this.$getConfig();\r\n\r\n\t\tvar task = this.$config.rowStore.getItem(taskId);\r\n\t\t// height of the bar item\r\n\t\tvar height = task.task_height || task.bar_height || config.bar_height || config.task_height;\r\n\t\tvar rowHeight = this.getItemHeight(taskId);\r\n\r\n\t\tif (height == \"full\") {\r\n\t\t\tvar offset = config.bar_height_padding || 3;\r\n\t\t\theight = rowHeight - offset;\r\n\t\t}\r\n\t\t//item height cannot be bigger than row height\r\n\t\theight = Math.min(height, rowHeight);\r\n\t\tif (isMilestoneRender) { // to get correct height for addapting Milestone to the row\r\n\t\t\theight = Math.round(height / Math.sqrt(2));\r\n\t\t}\r\n\t\treturn Math.max(height, 0);\r\n\t},\r\n\r\n\tgetScale: function(){\r\n\t\treturn this._tasks;\r\n\t},\r\n\r\n\t_getScales: function _get_scales() {\r\n\t\tvar config = this.$getConfig();\r\n\t\tvar helpers = this.$scaleHelper;\r\n\t\tvar scales = [helpers.primaryScale(config)].concat(helpers.getSubScales(config));\r\n\r\n\t\thelpers.sortScales(scales);\r\n\t\treturn scales;\r\n\t},\r\n\r\n\t_getColumnDuration: function _get_coll_duration(scale, date) {\r\n\t\treturn this.$gantt.date.add(date, scale.step, scale.unit) - date;\r\n\t},\r\n\t_bindStore: function () {\r\n\t\tif (this.$config.bind){\r\n\t\t\tvar rowStore = this.$gantt.getDatastore(this.$config.bind);\r\n\t\t\tthis.$config.rowStore = rowStore;\r\n\t\t\tif(rowStore && !rowStore._timelineCacheAttached){\r\n\t\t\t\tvar self = this;\r\n\t\t\t\trowStore._timelineCacheAttached = rowStore.attachEvent(\"onBeforeFilter\", function(){\r\n\t\t\t\t\tself._resetTopPositionHeight();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t_unbindStore: function(){\r\n\t\tif (this.$config.bind){\r\n\t\t\tvar rowStore = this.$gantt.getDatastore(this.$config.bind);\r\n\t\t\tif(rowStore && rowStore._timelineCacheAttached){\r\n\t\t\t\trowStore.detachEvent(rowStore._timelineCacheAttached);\r\n\t\t\t\trowStore._timelineCacheAttached = false;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\trefresh: function(){\r\n\t\tthis._bindStore();\r\n\r\n\t\tif(this.$config.bindLinks) {\r\n\t\t\tthis.$config.linkStore = this.$gantt.getDatastore(this.$config.bindLinks);\r\n\t\t}\r\n\r\n\t\tthis._resetTopPositionHeight();\r\n\t\tthis._resetHeight();\r\n\t\tthis._initStaticBackgroundRender();\r\n\t\tthis._render_tasks_scales();\r\n\t},\r\n\r\n\tdestructor: function(){\r\n\t\tvar gantt = this.$gantt;\r\n\t\tthis._clearLayers(gantt);\r\n\t\tthis._unbindStore();\r\n\t\tthis.$task = null;\r\n\t\tthis.$task_scale = null;\r\n\t\tthis.$task_data = null;\r\n\t\tthis.$task_bg = null;\r\n\t\tthis.$task_links = null;\r\n\t\tthis.$task_bars = null;\r\n\r\n\t\tthis.$gantt = null;\r\n\r\n\t\tif(this.$config.rowStore){\r\n\t\t\tthis.$config.rowStore.detachEvent(this._staticBgHandler);\r\n\t\t\tthis.$config.rowStore = null;\r\n\t\t}\r\n\t\tif(this.$config.linkStore){\r\n\t\t\tthis.$config.linkStore = null;\r\n\t\t}\r\n\r\n\t\tif(this._timelineDragScroll) {\r\n\t\t\tthis._timelineDragScroll.destructor();\r\n\t\t\tthis._timelineDragScroll = null;\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onDestroy\", []);\r\n\t\tthis.detachAllEvents();\r\n\r\n\t}\r\n};\r\n\r\nexport default Timeline;","function createResizer(gantt, grid){\r\n\treturn {\r\n\t\tinit: function(){},\r\n\t\tdoOnRender: function(){}\r\n\t};\r\n}\r\n\r\nexport default createResizer;","import * as domHelpers from \"../utils/dom_helpers\";\r\n\r\nfunction createRowResizer(gantt, grid){\r\n\r\n\tvar _task_grid_row_resize = {\r\n\t\trow_before_start: gantt.bind(function (dnd, obj, e) {\r\n\t\t\tvar config = grid.$getConfig();\r\n\t\t\tvar store = grid.$config.rowStore;\r\n\r\n\t\t\tvar el = domHelpers.locateAttribute(e, config.task_grid_row_resizer_attribute);\r\n\t\t\tif (!el) return false;\r\n\r\n\t\t\tvar row_id = this.locate(e, config.task_grid_row_resizer_attribute),\r\n\t\t\t\trow = store.getItem(row_id);\r\n\r\n\t\t\tif (grid.callEvent(\"onBeforeRowResize\", [row]) === false)\r\n\t\t\t\treturn false;\r\n\t\t}, gantt),\r\n\r\n\t\trow_after_start: gantt.bind(function (dnd, obj, e) {\r\n\t\t\tvar config = grid.$getConfig();\r\n\r\n\t\t\tvar row_id = this.locate(e, config.task_grid_row_resizer_attribute);\r\n\t\t\tdnd.config.marker.innerHTML = \"\";\r\n\r\n\t\t\tdnd.config.marker.className += \" gantt_row_grid_resize_area\";\r\n\t\t\tdnd.config.marker.style.width = grid.$grid.offsetWidth + \"px\";\r\n\t\t\tdnd.config.drag_id = row_id;\r\n\r\n\t\t}, gantt),\r\n\r\n\t\trow_drag_move: gantt.bind(function (dnd, obj, e) {\r\n\t\t\tvar store = grid.$config.rowStore;\r\n\t\t\tvar config = grid.$getConfig();\r\n\t\t\tvar dd = dnd.config;\r\n\t\t\tvar id = dd.drag_id,\r\n\t\t\t\titemHeight = grid.getItemHeight(id),\r\n\t\t\t\titemTop = grid.getItemTop(id) - obj.scrollTop;\r\n\t\t\tvar pos = domHelpers.getNodePosition(grid.$grid_data),\r\n\t\t\t\tpointerPosition = parseInt(dd.marker.style.top, 10),\r\n\t\t\t\tmarkerStartPosition = itemTop + pos.y,\r\n\t\t\t\tmarker_height = 0,\r\n\t\t\t\tminPointerPosition = config.min_task_grid_row_height;\r\n\r\n\t\t\tmarker_height = pointerPosition - markerStartPosition;\r\n\t\t\tif(marker_height < minPointerPosition){\r\n\t\t\t\tmarker_height = minPointerPosition;\r\n\t\t\t}\r\n\r\n\t\t\tdd.marker.style.left = pos.x + \"px\";\r\n\t\t\tdd.marker.style.top = markerStartPosition - 1 + \"px\";\r\n\t\t\tdd.marker.style.height = Math.abs(marker_height) + 1 + \"px\";\r\n\r\n\t\t\tdd.marker_height = marker_height;\r\n\t\t\t\r\n\t\t\tgrid.callEvent(\"onRowResize\", [id, store.getItem(id), marker_height + itemHeight]);\r\n\t\t\treturn true;\r\n\t\t}, gantt),\r\n\r\n\t\trow_drag_end: gantt.bind(function (dnd, obj, e) {\r\n\t\t\tvar store = grid.$config.rowStore;\r\n\t\t\tvar dd = dnd.config;\r\n\t\t\tvar id = dd.drag_id,\r\n\t\t\t\titem = store.getItem(id),\r\n\t\t\t\toldItemHeight = grid.getItemHeight(id);\r\n\r\n\t\t\tvar finalHeight = dd.marker_height;\r\n\r\n\t\t\tif (grid.callEvent(\"onBeforeRowResizeEnd\", [id, item, finalHeight]) === false)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (item.row_height == finalHeight)\r\n\t\t\t\treturn;\r\n\r\n\t\t\titem.row_height = finalHeight;\r\n\t\t\t// GS-2275: case for resizing resource grid row and others\r\n\t\t\tstore.updateItem(id);\r\n\t\t\tgrid.callEvent(\"onAfterRowResize\", [id, item, oldItemHeight, finalHeight]);\r\n\r\n\t\t\tthis.render();\r\n\t\t}, gantt)\r\n\t};\r\n\r\n\t// calls the initialization of the D'n'D events for resize elements\r\n\tvar _init_resize = function () {\r\n\r\n\t\tvar DnD = gantt.$services.getService(\"dnd\");\r\n\r\n\t\tvar config = grid.$getConfig();\r\n\r\n\t\tvar dnd = new DnD(grid.$grid_data, {updates_per_second: 60});\r\n\t\tif (gantt.defined(config.dnd_sensitivity))\r\n\t\t\tdnd.config.sensitivity = config.dnd_sensitivity;\r\n\r\n\t\tdnd.attachEvent(\"onBeforeDragStart\", function (obj, e) {\r\n\t\t\treturn _task_grid_row_resize.row_before_start(dnd, obj, e);\r\n\t\t});\r\n\t\tdnd.attachEvent(\"onAfterDragStart\", function (obj, e) {\r\n\t\t\treturn _task_grid_row_resize.row_after_start(dnd, obj, e);\r\n\t\t});\r\n\t\tdnd.attachEvent(\"onDragMove\", function (obj, e) {\r\n\t\t\treturn _task_grid_row_resize.row_drag_move(dnd, obj, e);\r\n\t\t});\r\n\t\tdnd.attachEvent(\"onDragEnd\", function (obj, e) {\r\n\t\t\treturn _task_grid_row_resize.row_drag_end(dnd, obj, e);\r\n\t\t});\r\n\r\n\t};\r\n\r\n\treturn {\r\n\t\tinit: _init_resize\r\n\t};\r\n}\r\n\r\nexport default createRowResizer;","const SENSITIVITY = 20;\r\nconst TIMEOUT = 50;\r\nconst SCROLLSTEP = 10;\r\n\r\nexport default class ScrollableGrid {\r\n\tpublic getCurrentX;\r\n\tprivate $gantt;\r\n\tprivate $grid;\r\n\tprivate _dnd;\r\n\tprivate _scrollView;\r\n\tprivate _scrollOrder: 0 | 1 | -1 = 0;\r\n\r\n\tconstructor(params) {\r\n\t\tconst {gantt, grid, dnd, getCurrentX} = params;\r\n\t\tthis.$gantt = gantt;\r\n\t\tthis.$grid = grid;\r\n\t\tthis._dnd = dnd;\r\n\t\tthis.getCurrentX = getCurrentX;\r\n\t\tthis._scrollView = this.$gantt.$ui.getView(this.$grid.$config.scrollX);\r\n\t\tthis.attachEvents();\r\n\t}\r\n\tattachEvents() {\r\n\t\tif (this.isScrollable()) {\r\n\t\t\tthis._dnd.attachEvent(\"onDragMove\", (obj, e) => {\r\n\t\t\t\tconst gridBoundingRect = this.$grid.$grid.getBoundingClientRect();\r\n\t\t\t\tconst maxLeft = gridBoundingRect.right;\r\n\t\t\t\tconst minLeft = gridBoundingRect.left;\r\n\t\t\t\tconst currentX = this.getCurrentX(e.clientX);\r\n\r\n\t\t\t\tif (currentX >= maxLeft - SENSITIVITY) {\r\n\t\t\t\t\tthis.autoscrollRight();\r\n\t\t\t\t\tthis.autoscrollStart();\r\n\t\t\t\t}\r\n\t\t\t\tif (currentX <= minLeft + SENSITIVITY) {\r\n\t\t\t\t\tthis.autoscrollLeft();\r\n\t\t\t\t\tthis.autoscrollStart();\r\n\t\t\t\t}\r\n\t\t\t\tif (currentX < maxLeft - SENSITIVITY && currentX > minLeft + SENSITIVITY) {\r\n\t\t\t\t\tthis.autoscrollStop();\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t\tthis._dnd.attachEvent(\"onDragEnd\", () => {\r\n\t\t\t\tthis.autoscrollStop();\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\tautoscrollStart() {\r\n\t\tif (this._scrollOrder === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst scrollStep = SCROLLSTEP * this._scrollOrder;\r\n\t\tconst scrollState = this._scrollView.getScrollState();\r\n\t\tthis._scrollView.scrollTo(scrollState.position + scrollStep);\r\n\t\tsetTimeout(() => { this.autoscrollStart(); }, TIMEOUT);\r\n\t}\r\n\tautoscrollRight() {\r\n\t\tthis._scrollOrder = 1;\r\n\t}\r\n\tautoscrollLeft() {\r\n\t\tthis._scrollOrder = -1;\r\n\t}\r\n\tautoscrollStop() {\r\n\t\tthis._scrollOrder = 0;\r\n\t}\r\n\tgetCorrection() {\r\n\t\tif (!this.isScrollable()) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\treturn this._scrollView.getScrollState().position;\r\n\t}\r\n\tisScrollable() {\r\n\t\treturn !!this.$grid.$config.scrollable;\r\n\t}\r\n}","import * as domHelpers from \"../../utils/dom_helpers\";\r\nimport ScrollableGrid from \"./scrollable_grid\";\r\n\r\nconst COLUMN_ID_ATTR_NAME = \"data-column-id\";\r\n\r\nexport class ColumnsGridDnd {\r\n\tprivate $gantt;\r\n\tprivate $grid;\r\n\tprivate _dragX;\r\n\tprivate _dnd;\r\n\tprivate _originAutoscroll;\r\n\tprivate _scrollableGrid: ScrollableGrid;\r\n\tprivate _draggedCell;\r\n\tprivate _targetMarker = null;\r\n\tprivate _gridConfig;\r\n\tconstructor(gantt, grid) {\r\n\t\tthis.$gantt = gantt;\r\n\t\tthis.$grid = grid;\r\n\t}\r\n\tinit() {\r\n\t\tconst DND = this.$gantt.$services.getService(\"dnd\");\r\n\t\tthis._dnd = new DND(this.$grid.$grid_scale, { updates_per_second: 60 });\r\n\t\tthis._scrollableGrid = new ScrollableGrid({\r\n\t\t\tgantt: this.$gantt,\r\n\t\t\tgrid: this.$grid,\r\n\t\t\tdnd: this._dnd,\r\n\t\t\tgetCurrentX: this.calculateCurrentPosition\r\n\t\t});\r\n\t\tthis.attachEvents();\r\n\t}\r\n\tattachEvents() {\r\n\t\tthis._dnd.attachEvent(\"onBeforeDragStart\", (obj, e) => {\r\n\t\t\tthis._draggedCell = this.$gantt.utils.dom.closest(e.target, \".gantt_grid_head_cell\");\r\n\t\t\tif(!this._draggedCell){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst columns = this.$grid.$getConfig().columns;\r\n\t\t\tconst columnName = this._draggedCell.getAttribute(COLUMN_ID_ATTR_NAME);\r\n\t\t\tlet draggedColumn;\r\n\t\t\tlet draggedIndex;\r\n\t\t\tcolumns.map(function(column, index){\r\n\t\t\t\tif(column.name === columnName){\r\n\t\t\t\t\tdraggedColumn = column;\r\n\t\t\t\t\tdraggedIndex = index;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (this.$grid.callEvent(\"onBeforeColumnDragStart\", [{ draggedColumn, draggedIndex}]) === false) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (!this._draggedCell || !draggedColumn) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tthis._gridConfig = this.$grid.$getConfig();\r\n\t\t\tthis._originAutoscroll = this.$gantt.config.autoscroll;\r\n\t\t\tthis.$gantt.config.autoscroll = false;\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tthis._dnd.attachEvent(\"onAfterDragStart\", (obj, e) => {\r\n\t\t\tif (!this._draggedCell) {\r\n\t\t\t\treturn; // GS-1333: don't try to reorder a column when we resize it\r\n\t\t\t}\r\n\t\t\tthis._dnd.config.column = this._draggedCell.getAttribute(COLUMN_ID_ATTR_NAME);\r\n\t\t\tthis._dnd.config.marker.innerHTML = this._draggedCell.outerHTML;\r\n\t\t\tthis._dnd.config.marker.classList.add(\"gantt_column_drag_marker\");\r\n\t\t\tthis._dnd.config.marker.style.height = this._gridConfig.scale_height + \"px\";\r\n\t\t\tthis._dnd.config.marker.style.lineHeight = this._gridConfig.scale_height + \"px\";\r\n\t\t\tthis._draggedCell.classList.add(\"gantt_grid_head_cell_dragged\");\r\n\t\t});\r\n\r\n\t\tthis._dnd.attachEvent(\"onDragMove\", (obj, e) => {\r\n\t\t\tif(!this._draggedCell){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis._dragX = e.clientX;\r\n\t\t\tconst x = this.calculateCurrentPosition(e.clientX);\r\n\t\t\tconst columnIndexes = this.findColumnsIndexes();\r\n\t\t\tthis.setMarkerPosition(x);\r\n\t\t\tthis.drawTargetMarker(columnIndexes);\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tthis._dnd.attachEvent(\"onDragEnd\", () => {\r\n\t\t\tif (!this._draggedCell) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst columnIndexes = this.findColumnsIndexes();\r\n\t\t\tconst targetIndex = columnIndexes.targetIndex;\r\n\t\t\tconst draggedIndex = columnIndexes.draggedIndex;\r\n\t\t\tconst columns = this.$grid.$getConfig().columns;\r\n\r\n\t\t\tconst draggedColumn = columns[draggedIndex];\r\n\t\t\tconst targetColumn = columns[targetIndex];\r\n\t\t\tif (this.$grid.callEvent(\"onColumnDragMove\", [{ draggedColumn, targetColumn, draggedIndex, targetIndex }]) === false) {\r\n\t\t\t\tthis.cleanTargetMarker();\r\n\t\t\t\tthis.$gantt.render();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.$gantt.config.autoscroll = this._originAutoscroll;\r\n\t\t\tthis._draggedCell.classList.remove(\"gantt_grid_head_cell_dragged\");\r\n\t\t\tthis.cleanTargetMarker();\r\n\t\t\tthis.reorderColumns();\r\n\t\t});\r\n\r\n\t}\r\n\treorderColumns() {\r\n\t\tconst { targetIndex, draggedIndex } = this.findColumnsIndexes();\r\n\r\n\t\tconst columns = this.$grid.$getConfig().columns;\r\n\t\tconst draggedColumn = columns[draggedIndex];\r\n\t\tconst targetColumn = columns[targetIndex];\r\n\r\n\t\tif (this.$grid.callEvent(\"onBeforeColumnReorder\", [{ draggedColumn, targetColumn, draggedIndex, targetIndex }]) === false) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (targetIndex === draggedIndex) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcolumns.splice(draggedIndex, 1);\r\n\t\tcolumns.splice(targetIndex, 0, draggedColumn);\r\n\t\tthis.$gantt.render();\r\n\t\tthis.$grid.callEvent(\"onAfterColumnReorder\", [{ draggedColumn, targetColumn, draggedIndex, targetIndex }]);\r\n\t}\r\n\tfindColumnsIndexes() {\r\n\t\tconst draggedId = this._dnd.config.column;\r\n\t\tconst columns = this.$grid.$getConfig().columns;\r\n\t\tlet targetIndex: number;\r\n\t\tlet draggedIndex: number;\r\n\t\tlet xBefore: number;\r\n\t\tlet xAfter: number;\r\n\t\tconst currentColumn = { startX: 0, endX: 0 };\r\n\r\n\t\tlet start = 0;\r\n\t\tlet end = columns.length - 1;\r\n\t\tlet compare = (a, b) => a <= b;\r\n\t\tlet next = (index) => ++index;\r\n\t\tif (this.$gantt.config.rtl) {\r\n\t\t\tstart = columns.length - 1;\r\n\t\t\tend = 0;\r\n\t\t\tcompare = (a, b) => a >= b;\r\n\t\t\tnext = (index) => --index;\r\n\t\t}\r\n\r\n\t\tlet columnRelativePos: number;\r\n\r\n\t\tconst relativeX = this._dragX - this.$grid.$grid.getBoundingClientRect().left + this._scrollableGrid.getCorrection();\r\n\t\tfor (let i = start; compare(i, end); i = next(i)) {\r\n\t\t\tif (targetIndex !== undefined && draggedIndex !== undefined) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif(!columns[i].hide) {\r\n\t\t\t\tcurrentColumn.startX = currentColumn.endX;\r\n\t\t\t\tcurrentColumn.endX += columns[i].width;\r\n\r\n\t\t\t\t// if drop on a column or drop after the last column\r\n\t\t\t\tif (relativeX >= currentColumn.startX && (relativeX <= currentColumn.endX || !compare(next(i), end))) {\r\n\t\t\t\t\ttargetIndex = i;\r\n\t\t\t\t\txBefore = currentColumn.startX;\r\n\t\t\t\t\txAfter = currentColumn.endX;\r\n\t\t\t\t\tcolumnRelativePos = (relativeX - currentColumn.startX) / (currentColumn.endX - currentColumn.startX);\r\n\t\t\t\t}\r\n\t\t\t\tif (draggedId === columns[i].name) {\r\n\t\t\t\t\tdraggedIndex = i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\ttargetIndex,\r\n\t\t\tdraggedIndex,\r\n\t\t\txBefore,\r\n\t\t\txAfter,\r\n\t\t\tcolumnRelativePos\r\n\t\t};\r\n\t}\r\n\tsetMarkerPosition(x: number, y: number = 10) {\r\n\t\tconst { marker } = this._dnd.config;\r\n\t\tconst gridOffset = this._dnd._obj.getBoundingClientRect();\r\n\t\tmarker.style.top = `${gridOffset.y + y}px`;\r\n\t\tmarker.style.left = `${x}px`;\r\n\t}\r\n\tcalculateCurrentPosition = (eventX: number) => {\r\n\t\tconst gridBoundingRect = this.$grid.$grid.getBoundingClientRect();\r\n\t\tconst maxLeft = gridBoundingRect.right;\r\n\t\tconst minLeft = gridBoundingRect.left;\r\n\t\tlet x = eventX;\r\n\t\tif (x > maxLeft) {\r\n\t\t\tx = maxLeft;\r\n\t\t}\r\n\t\tif (x < minLeft) {\r\n\t\t\tx = minLeft;\r\n\t\t}\r\n\t\treturn x;\r\n\t};\r\n\tdrawTargetMarker({ targetIndex, draggedIndex, xBefore, xAfter, columnRelativePos }) {\r\n\t\tif (!this._targetMarker) {\r\n\t\t\tthis._targetMarker = document.createElement(\"div\");\r\n\t\t\tdomHelpers.addClassName(this._targetMarker, \"gantt_grid_target_marker\");\r\n\t\t\tthis._targetMarker.style.display = \"none\";\r\n\t\t\tthis._targetMarker.style.height = `${this._gridConfig.scale_height}px`;\r\n\t\t}\r\n\r\n\t\t// marker can be detached after gantt.render\r\n\t\tif(!this._targetMarker.parentNode){\r\n\t\t\tthis.$grid.$grid_scale.appendChild(this._targetMarker);\r\n\t\t}\r\n\r\n\t\tlet nextPosition: number;\r\n\t\tif (targetIndex > draggedIndex) {\r\n\t\t\tnextPosition = xAfter;\r\n\t\t} else if (targetIndex < draggedIndex) {\r\n\t\t\tnextPosition = xBefore;\r\n\t\t} else {\r\n\t\t\tif(columnRelativePos > 0.5){\r\n\t\t\t\tnextPosition = xAfter;\r\n\t\t\t}else{\r\n\t\t\t\tnextPosition = xBefore;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._targetMarker.style.left = `${nextPosition}px`;\r\n\t\tthis._targetMarker.style.display = \"block\";\r\n\t}\r\n\tcleanTargetMarker() {\r\n\t\tif (this._targetMarker && this._targetMarker.parentNode) {\r\n\t\t\tthis.$grid.$grid_scale.removeChild(this._targetMarker);\r\n\t\t}\r\n\t\tthis._targetMarker = null;\r\n\t}\r\n}","function create(gantt){\r\n\tvar events = [];\r\n\r\n\treturn {\r\n\t\tdelegate:function(event, className, handler, root) {\r\n\t\t\tevents.push([event, className, handler, root]);\r\n\r\n\t\t\tvar helper = gantt.$services.getService(\"mouseEvents\");\r\n\t\t\thelper.delegate(event, className, handler, root);\r\n\t\t},\r\n\t\tdestructor: function(){\r\n\t\t\tvar mouseEvents = gantt.$services.getService(\"mouseEvents\");\r\n\t\t\tfor(var i = 0; i < events.length; i++){\r\n\t\t\t\tvar h = events[i];\r\n\t\t\t\tmouseEvents.detach(h[0], h[1], h[2], h[3]);\r\n\t\t\t}\r\n\t\t\tevents = [];\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default create;","import * as domHelpers from \"../utils/dom_helpers\";\r\nimport * as utils from \"../../../utils/utils\";\r\nimport eventable from \"../../../utils/eventable\";\r\nimport gridResize from \"./grid_resize\";\r\nimport topPositionMixin from \"../row_position_mixin\";\r\nimport rowResize from \"./task_grid_row_resize\";\r\n\r\nimport ColumnDnd from \"../plugins/column_grid_dnd\";\r\n\r\nimport mouseEventContainer from \"../mouse_event_container\";\r\n\r\nvar Grid = function (parent, config, factory, gantt) {\r\n\tthis.$config = utils.mixin({}, config || {});\r\n\tthis.$gantt = gantt;\r\n\tthis.$parent = parent;\r\n\teventable(this);\r\n\tthis.$state = {};\r\n\tutils.mixin(this, topPositionMixin(this));\r\n};\r\n\r\n\r\nGrid.prototype = {\r\n\tinit: function(container) {\r\n\t\tvar gantt = this.$gantt;\r\n\t\tvar gridAriaAttr = gantt._waiAria.gridAttrString();\r\n\t\tvar gridDataAriaAttr = gantt._waiAria.gridDataAttrString();\r\n\t\tvar _ganttConfig = this.$getConfig();\r\n\t\tvar reorderColumns = _ganttConfig.reorder_grid_columns || false;\r\n\t\tif (this.$config.reorder_grid_columns !== undefined) {\r\n\t\t\treorderColumns = this.$config.reorder_grid_columns;\r\n\t\t}\r\n\r\n\r\n\t\tcontainer.innerHTML = \"<div class='gantt_grid' style='height:inherit;width:inherit;' \" + gridAriaAttr + \"></div>\";\r\n\t\tthis.$grid = container.childNodes[0];\r\n\r\n\t\tthis.$grid.innerHTML = \"<div class='gantt_grid_scale' \" +\r\n\t\t\tgantt._waiAria.gridScaleRowAttrString() + \"></div><div class='gantt_grid_data' \" + gridDataAriaAttr + \"></div>\";\r\n\r\n\t\tthis.$grid_scale = this.$grid.childNodes[0];\r\n\t\tthis.$grid_data = this.$grid.childNodes[1];\r\n\r\n\t\tvar attr = _ganttConfig[this.$config.bind + \"_attribute\"];\r\n\t\tif (!attr && this.$config.bind) {\r\n\t\t\tattr = \"data-\" + this.$config.bind + \"-id\";\r\n\t\t}\r\n\t\tthis.$config.item_attribute = attr || null;\r\n\r\n\t\tif (!this.$config.layers) {\r\n\t\t\tvar layers = this._createLayerConfig();\r\n\t\t\tthis.$config.layers = layers;\r\n\t\t}\r\n\r\n\t\tvar resizer = gridResize(gantt, this);\r\n\t\tresizer.init();\r\n\t\tthis._renderHeaderResizers = resizer.doOnRender;\r\n\t\tthis._mouseDelegates = mouseEventContainer(gantt);\r\n\r\n\t\tvar resizerrow = rowResize(gantt, this);\r\n\t\tresizerrow.init();\r\n\r\n\t\tthis._addLayers(this.$gantt);\r\n\t\tthis._initEvents();\r\n\r\n\t\tif (reorderColumns) {\r\n\t\t\tthis._columnDND = new ColumnDnd(gantt, this);\r\n\t\t\tthis._columnDND.init();\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onReady\", []);\r\n\t\t//this.refresh();\r\n\t},\r\n\r\n\t_validateColumnWidth: function (column, property) {\r\n\t\t// user can set {name:\"text\", width:\"200\",...} for some reason,\r\n\t\t// check and convert it to number when possible\r\n\t\tvar value = column[property];\r\n\t\tif (value && value != \"*\") {\r\n\t\t\tvar gantt = this.$gantt;\r\n\t\t\tvar numericWidth = value * 1;\r\n\t\t\tif (isNaN(numericWidth)) {\r\n\t\t\t\tgantt.assert(false, \"Wrong \" + property + \" value of column \" + column.name);\r\n\t\t\t} else {\r\n\t\t\t\tcolumn[property] = numericWidth;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tsetSize: function (width, height) {\r\n\t\tthis.$config.width = this.$state.width = width;\r\n\t\tthis.$config.height = this.$state.height = height;\r\n\r\n\t\t// TODO: maybe inherit and override in a subclass instead of extending here\r\n\r\n\t\tvar columns = this.getGridColumns(),\r\n\t\t\tinnerWidth = 0;\r\n\r\n\t\tvar config = this.$getConfig();\r\n\t\tvar elasticColumns = config.grid_elastic_columns;\r\n\r\n\t\tfor (var i = 0, l = columns.length; i < l; i++) {\r\n\t\t\tthis._validateColumnWidth(columns[i], \"min_width\");\r\n\t\t\tthis._validateColumnWidth(columns[i], \"max_width\");\r\n\t\t\tthis._validateColumnWidth(columns[i], \"width\");\r\n\r\n\t\t\tinnerWidth += columns[i].width * 1;\r\n\t\t}\r\n\r\n\t\tvar outerWidth;\r\n\t\tif (isNaN(innerWidth) || !this.$config.scrollable) {\r\n\t\t\touterWidth = this._setColumnsWidth(width + 1);\r\n\t\t\tinnerWidth = outerWidth;\r\n\t\t}\r\n\r\n\t\tif(this.$config.scrollable && elasticColumns && !isNaN(innerWidth)){\r\n\t\t\t// GS-1352: Allow resizing the grid columns, then the grid width is increased\r\n\t\t\t// or keep the grid width, but don't allow column resize to affect the grid width\r\n\t\t\tlet columnProperty = \"width\";\r\n\t\t\tif (elasticColumns == \"min_width\"){\r\n\t\t\t\tcolumnProperty = \"min_width\";\r\n\t\t\t}\r\n\t\t\tlet newColumnWidth = 0;\r\n\t\t\tcolumns.forEach(function(col){\r\n\t\t\t\tnewColumnWidth += col[columnProperty] || config.min_grid_column_width;\r\n\t\t\t});\r\n\t\t\t//newColumnWidth--; // the total column width shouldn't match the outerWidth // GS-2190 reducing width seems to be not needed\r\n\t\t\tvar columnsWidth = Math.max(newColumnWidth, width);\r\n\t\t\tinnerWidth = this._setColumnsWidth(columnsWidth);\r\n\t\t\touterWidth = width;\r\n\t\t}\r\n\r\n\t\tif (this.$config.scrollable) {\r\n\t\t\tthis.$grid_scale.style.width = innerWidth + \"px\";\r\n\t\t\tthis.$grid_data.style.width = innerWidth + \"px\";\r\n\t\t} else {\r\n\t\t\tthis.$grid_scale.style.width = \"inherit\";\r\n\t\t\tthis.$grid_data.style.width = \"inherit\";\r\n\t\t}\r\n\t\tthis.$config.width -= 1;\r\n\r\n\t\tvar config = this.$getConfig();\r\n\t\tif (outerWidth !== width) {\r\n\t\t\tif(outerWidth !== undefined){\r\n\t\t\t\tconfig.grid_width = outerWidth;\r\n\t\t\t\tthis.$config.width = outerWidth - 1;\r\n\t\t\t}else{\r\n\t\t\t\tif(!isNaN(innerWidth)){\r\n\t\t\t\t\tthis._setColumnsWidth(innerWidth);\r\n\t\t\t\t\tconfig.grid_width = innerWidth;\r\n\t\t\t\t\tthis.$config.width = innerWidth - 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar dataHeight = Math.max(this.$state.height - config.scale_height, 0);\r\n\t\tthis.$grid_data.style.height = dataHeight + \"px\";\r\n\t\tthis.refresh();\r\n\t},\r\n\tgetSize: function () {\r\n\r\n\t\tvar config = this.$getConfig();\r\n\r\n\t\tvar store = this.$config.rowStore;\r\n\r\n\t\tvar contentHeight = store ? this.getTotalHeight() : 0,\r\n\t\t\tcontentWidth = this._getGridWidth();\r\n\r\n\t\tvar size = {\r\n\t\t\tx: this.$state.width,\r\n\t\t\ty: this.$state.height,\r\n\t\t\tcontentX: this.isVisible() ? contentWidth : 0,\r\n\t\t\tcontentY: this.isVisible() ? (config.scale_height + contentHeight) : 0,\r\n\t\t\tscrollHeight: this.isVisible() ? contentHeight : 0,\r\n\t\t\tscrollWidth: this.isVisible() ? contentWidth : 0\r\n\t\t};\r\n\r\n\t\treturn size;\r\n\t},\r\n\r\n\t_bindStore: function () {\r\n\t\tif (this.$config.bind){\r\n\t\t\tvar rowStore = this.$gantt.getDatastore(this.$config.bind);\r\n\t\t\tthis.$config.rowStore = rowStore;\r\n\t\t\tif(rowStore && !rowStore._gridCacheAttached){\r\n\t\t\t\tvar self = this;\r\n\t\t\t\trowStore._gridCacheAttached = rowStore.attachEvent(\"onBeforeFilter\", function(){\r\n\t\t\t\t\tself._resetTopPositionHeight();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t_unbindStore: function(){\r\n\t\tif (this.$config.bind){\r\n\t\t\tvar rowStore = this.$gantt.getDatastore(this.$config.bind);\r\n\t\t\tif(rowStore && rowStore._gridCacheAttached){\r\n\t\t\t\trowStore.detachEvent(rowStore._gridCacheAttached);\r\n\t\t\t\trowStore._gridCacheAttached = false;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\trefresh: function () {\r\n\t\tthis._bindStore();\r\n\r\n\t\tthis._resetTopPositionHeight();\r\n\t\tthis._resetHeight();\r\n\t\tthis._initSmartRenderingPlaceholder();\r\n\r\n\t\tthis._calculateGridWidth();\r\n\t\tthis._renderGridHeader();\r\n\t},\r\n\r\n\tgetViewPort: function(){\r\n\t\tvar scrollLeft = this.$config.scrollLeft || 0;\r\n\t\tvar scrollTop = this.$config.scrollTop || 0;\r\n\t\tvar height = this.$config.height || 0;\r\n\t\tvar width = this.$config.width || 0;\r\n\t\treturn {\r\n\t\t\ty: scrollTop,\r\n\t\t\ty_end: scrollTop + height,\r\n\t\t\tx: scrollLeft,\r\n\t\t\tx_end: scrollLeft + width,\r\n\t\t\theight: height,\r\n\t\t\twidth: width\r\n\t\t};\r\n\t},\r\n\r\n\tscrollTo: function (left, top) {\r\n\t\tif (!this.isVisible())\r\n\t\t\treturn;\r\n\r\n\t\tvar scrolled = false;\r\n\r\n\t\tthis.$config.scrollTop = this.$config.scrollTop || 0;\r\n\t\tthis.$config.scrollLeft = this.$config.scrollLeft || 0;\r\n\r\n\t\tif (left * 1 == left) {\r\n\t\t\tthis.$config.scrollLeft = this.$state.scrollLeft = this.$grid.scrollLeft = left;\r\n\t\t\tscrolled = true;\r\n\t\t}\r\n\r\n\t\t// var config = this.$getConfig();\r\n\t\tif (top * 1 == top) {\r\n\t\t\tthis.$config.scrollTop = this.$state.scrollTop = this.$grid_data.scrollTop = top;\r\n\t\t\tscrolled = true;\r\n\t\t}\r\n\r\n\t\tif(scrolled){\r\n\t\t\tthis.callEvent(\"onScroll\", [this.$config.scrollLeft, this.$config.scrollTop]);\r\n\t\t}\r\n\t},\r\n\r\n\tgetColumnIndex: function (name, excludeHidden) {\r\n\t\tvar columns = this.$getConfig().columns;\r\n\t\tvar hiddenIndexShift = 0;\r\n\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\t// GS-1257. If the cell is hidden, the target column index should be correct\r\n\t\t\tif (excludeHidden && columns[i].hide){\r\n\t\t\t\thiddenIndexShift++;\r\n\t\t\t}\r\n\t\t\tif (columns[i].name == name) {\r\n\t\t\t\treturn i - hiddenIndexShift;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\tgetColumn: function (name) {\r\n\t\tvar index = this.getColumnIndex(name);\r\n\t\tif (index === null) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn this.$getConfig().columns[index];\r\n\t},\r\n\r\n\tgetGridColumns: function () {\r\n\t\tvar config = this.$getConfig();\r\n\t\treturn config.columns.slice();\r\n\t},\r\n\tisVisible: function () {\r\n\t\tif (this.$parent && this.$parent.$config) {\r\n\t\t\treturn !this.$parent.$config.hidden;\r\n\t\t} else {\r\n\t\t\treturn this.$grid.offsetWidth;\r\n\t\t}\r\n\t},\r\n\r\n\t// getItemHeight: function () {\r\n\t// \tvar config = this.$getConfig();\r\n\t// \treturn config.row_height;\r\n\t// },\r\n\r\n\t_createLayerConfig: function () {\r\n\t\tvar gantt = this.$gantt;\r\n\t\tvar self = this;\r\n\t\tvar layers = [\r\n\t\t\t{\r\n\t\t\t\trenderer: gantt.$ui.layers.gridLine(),\r\n\t\t\t\tcontainer: this.$grid_data,\r\n\t\t\t\tfilter: [function () {\r\n\t\t\t\t\treturn self.isVisible();\r\n\t\t\t\t}]\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\trenderer: gantt.$ui.layers.gridTaskRowResizer(),\r\n\t\t\t\tcontainer: this.$grid_data,\r\n\t\t\t\tappend: true,\r\n\t\t\t\tfilter: [function () {\r\n\t\t\t\t\treturn gantt.config.resize_rows;\r\n\t\t\t\t}]\r\n\t\t\t}\r\n\t\t];\r\n\t\treturn layers;\r\n\t},\r\n\r\n\t_addLayers: function (gantt) {\r\n\t\tif (!this.$config.bind)\r\n\t\t\treturn;\r\n\r\n\t\tthis._taskLayers = [];\r\n\r\n\t\tvar self = this;\r\n\r\n\t\tvar layers = this.$gantt.$services.getService(\"layers\");\r\n\t\tvar taskRenderer = layers.getDataRender(this.$config.bind);\r\n\r\n\t\tif (!taskRenderer) {\r\n\t\t\ttaskRenderer = layers.createDataRender({\r\n\t\t\t\tname: this.$config.bind,\r\n\t\t\t\tdefaultContainer: function () { return self.$grid_data; }\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tvar taskLayers = this.$config.layers;\r\n\t\tfor (var i = 0; taskLayers && i < taskLayers.length; i++) {\r\n\t\t\tvar layer = taskLayers[i];\r\n\t\t\tlayer.view = this;\r\n\r\n\t\t\tvar bar_layer = taskRenderer.addLayer(layer);\r\n\t\t\tthis._taskLayers.push(bar_layer);\r\n\t\t}\r\n\r\n\t\tthis._bindStore();\r\n\r\n\t\tthis._initSmartRenderingPlaceholder();\r\n\t},\r\n\r\n\t_refreshPlaceholderOnStoreUpdate: function (id) {\r\n\t\tvar config = this.$getConfig(),\r\n\t\t\tstore = this.$config.rowStore;\r\n\r\n\t\tif (!store || id !== null || !this.isVisible() || !config.smart_rendering) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar contentHeight;\r\n\t\tif (this.$config.scrollY) {\r\n\t\t\tvar scroll = this.$gantt.$ui.getView(this.$config.scrollY);\r\n\t\t\tif (scroll)\r\n\t\t\t\tcontentHeight = scroll.getScrollState().scrollSize;\r\n\t\t}\r\n\r\n\t\tif (!contentHeight) {\r\n\t\t\tcontentHeight = store ? this.getTotalHeight() : 0;\r\n\t\t}\r\n\r\n\t\tif (contentHeight) {\r\n\t\t\tif (this.$rowsPlaceholder && this.$rowsPlaceholder.parentNode) {\r\n\t\t\t\tthis.$rowsPlaceholder.parentNode.removeChild(this.$rowsPlaceholder);\r\n\t\t\t}\r\n\r\n\t\t\tvar placeholder = this.$rowsPlaceholder = document.createElement(\"div\");\r\n\t\t\tplaceholder.style.visibility = \"hidden\";\r\n\t\t\tplaceholder.style.height = contentHeight + \"px\";\r\n\t\t\tplaceholder.style.width = \"1px\";\r\n\t\t\tthis.$grid_data.appendChild(placeholder);\r\n\t\t}\r\n\t},\r\n\r\n\t_initSmartRenderingPlaceholder: function () {\r\n\t\tvar store = this.$config.rowStore;\r\n\t\tif (!store) {\r\n\t\t\treturn;\r\n\t\t} else {\r\n\t\t\tthis._initSmartRenderingPlaceholder = function () { };\r\n\t\t}\r\n\t\tthis._staticBgHandler = store.attachEvent(\"onStoreUpdated\", utils.bind(this._refreshPlaceholderOnStoreUpdate, this));\r\n\t},\r\n\r\n\t_initEvents: function () {\r\n\t\tvar gantt = this.$gantt;\r\n\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_close\", gantt.bind(function (e, id, trg) {\r\n\t\t\tvar store = this.$config.rowStore;\r\n\t\t\tif (!store) return true;\r\n\r\n\t\t\tvar target = domHelpers.locateAttribute(e, this.$config.item_attribute);\r\n\t\t\tif (target) {\r\n\t\t\t\tstore.close(target.getAttribute(this.$config.item_attribute));\r\n\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}, this), this.$grid);\r\n\r\n\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_open\", gantt.bind(function (e, id, trg) {\r\n\t\t\tvar store = this.$config.rowStore;\r\n\t\t\tif (!store) return true;\r\n\r\n\t\t\tvar target = domHelpers.locateAttribute(e, this.$config.item_attribute);\r\n\t\t\tif (target) {\r\n\t\t\t\tstore.open(target.getAttribute(this.$config.item_attribute));\r\n\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}, this), this.$grid);\r\n\t},\r\n\r\n\t_clearLayers: function (gantt) {\r\n\t\tvar layers = this.$gantt.$services.getService(\"layers\");\r\n\t\tvar taskRenderer = layers.getDataRender(this.$config.bind);\r\n\r\n\t\tif (this._taskLayers) {\r\n\t\t\tfor (var i = 0; i < this._taskLayers.length; i++) {\r\n\t\t\t\ttaskRenderer.removeLayer(this._taskLayers[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._taskLayers = [];\r\n\t},\r\n\r\n\t_getColumnWidth: function (column, config, width) {\r\n\t\tvar min_width = column.min_width || config.min_grid_column_width;\r\n\t\tvar new_width = Math.max(width, min_width || 10);\r\n\t\tif (column.max_width)\r\n\t\t\tnew_width = Math.min(new_width, column.max_width);\r\n\t\treturn new_width;\r\n\t},\r\n\t// set min width only if width < than config.min_grid_column_width\r\n\t_checkGridColumnMinWidthLimits: function (columns, config) {\r\n\t\tfor (var i = 0, l = columns.length; i < l; i++) {\r\n\t\t\tvar width = columns[i].width * 1;\r\n\t\t\tif (!columns[i].min_width && width < config.min_grid_column_width){\r\n\t\t\t\tcolumns[i].min_width = width;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t// return min and max possible grid width according to restricts\r\n\t_getGridWidthLimits: function () {\r\n\t\tvar config = this.$getConfig(),\r\n\t\t\tcolumns = this.getGridColumns(),\r\n\t\t\tmin_limit = 0,\r\n\t\t\tmax_limit = 0;\r\n\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tmin_limit += columns[i].min_width ? columns[i].min_width : config.min_grid_column_width;\r\n\t\t\tif (max_limit !== undefined) {\r\n\t\t\t\tmax_limit = columns[i].max_width ? (max_limit + columns[i].max_width) : undefined;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._checkGridColumnMinWidthLimits(columns, config); // FIX ME: should it be before calculating limits?\r\n\t\treturn [min_limit, max_limit];\r\n\t},\r\n\t// resize columns to get total newWidth, starting from columns[start_index]\r\n\t_setColumnsWidth: function (newWidth, start_index) {\r\n\t\tvar config = this.$getConfig();\r\n\t\tvar columns = this.getGridColumns(),\r\n\t\t\tcolumns_width = 0,\r\n\t\t\tfinal_width = newWidth;\r\n\r\n\t\tstart_index = !window.isNaN(start_index) ? start_index : -1;\r\n\r\n\t\tfor (var i = 0, l = columns.length; i < l; i++) {\r\n\t\t\tcolumns_width += columns[i].width * 1;\r\n\t\t}\r\n\r\n\t\tif (window.isNaN(columns_width)) {\r\n\t\t\tthis._calculateGridWidth();\r\n\t\t\tcolumns_width = 0;\r\n\t\t\tfor (var i = 0, l = columns.length; i < l; i++) {\r\n\t\t\t\tcolumns_width += columns[i].width * 1;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar extra_width = final_width - columns_width;\r\n\r\n\t\tvar start_width = 0;\r\n\t\tfor (var i = 0; i < start_index + 1; i++) {\r\n\t\t\tstart_width += columns[i].width;\r\n\t\t}\r\n\r\n\t\tcolumns_width -= start_width;\r\n\r\n\t\tfor (var i = start_index + 1; i < columns.length; i++) {\r\n\r\n\t\t\tvar col = columns[i];\r\n\t\t\tvar share = Math.round(extra_width * (col.width / columns_width));\r\n\r\n\t\t\t// columns have 2 additional restrict fields - min_width & max_width that are set by user\r\n\t\t\tif (extra_width < 0) {\r\n\t\t\t\tif (col.min_width && col.width + share < col.min_width)\r\n\t\t\t\t\tshare = col.min_width - col.width;\r\n\t\t\t\telse if (!col.min_width && config.min_grid_column_width && col.width + share < config.min_grid_column_width)\r\n\t\t\t\t\tshare = config.min_grid_column_width - col.width;\r\n\t\t\t} else if (col.max_width && col.width + share > col.max_width)\r\n\t\t\t\tshare = col.max_width - col.width;\r\n\r\n\t\t\tcolumns_width -= col.width;\r\n\t\t\tcol.width += share;\r\n\t\t\textra_width -= share;\r\n\r\n\t\t}\r\n\r\n\t\tvar iterator = extra_width > 0 ? 1 : -1;\r\n\t\twhile ((extra_width > 0 && iterator === 1) || (extra_width < 0 && iterator === -1)) {\r\n\t\t\tvar curExtra = extra_width;\r\n\t\t\tfor (i = start_index + 1; i < columns.length; i++) {\r\n\t\t\t\tvar new_width = columns[i].width + iterator;\r\n\r\n\t\t\t\tif (new_width == this._getColumnWidth(columns[i], config, new_width)) {\r\n\t\t\t\t\textra_width -= iterator;\r\n\t\t\t\t\tcolumns[i].width = new_width;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!extra_width)\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif (curExtra == extra_width)\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t// if impossible to resize the right-side columns, resize the start column\r\n\t\tif (extra_width && start_index > -1) {\r\n\t\t\tvar new_width = columns[start_index].width + extra_width;\r\n\t\t\tif (new_width == this._getColumnWidth(columns[start_index], config, new_width))\r\n\t\t\t\tcolumns[start_index].width = new_width;\r\n\t\t}\r\n\r\n\t\t//if (this.callEvent(\"onGridResizeEnd\", [config.grid_width, final_width]) === false)\r\n\t\t//\treturn;\r\n\r\n\t\treturn this._getColsTotalWidth();\r\n\t},\r\n\r\n\t_getColsTotalWidth: function () {\r\n\t\tvar columns = this.getGridColumns();\r\n\t\tvar cols_width = 0;\r\n\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tvar v = parseFloat(columns[i].width);\r\n\t\t\tif (window.isNaN(v)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tcols_width += v;\r\n\t\t}\r\n\t\treturn cols_width;\r\n\t},\r\n\t_calculateGridWidth: function () {\r\n\t\tvar config = this.$getConfig();\r\n\t\tvar columns = this.getGridColumns();\r\n\t\tvar cols_width = 0;\r\n\t\tvar unknown = [];\r\n\t\tvar width = [];\r\n\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tvar v = parseFloat(columns[i].width);\r\n\t\t\tif (window.isNaN(v)) {\r\n\t\t\t\tv = config.min_grid_column_width || 10;\r\n\t\t\t\tunknown.push(i);\r\n\t\t\t}\r\n\t\t\twidth[i] = v;\r\n\t\t\tcols_width += v;\r\n\t\t}\r\n\t\tvar gridWidth = this._getGridWidth() + 1;\r\n\t\tif (config.autofit || unknown.length) {\r\n\t\t\tvar diff = gridWidth - cols_width;\r\n\t\t\t// TODO: logic may be improved for proportional changing of width\r\n\r\n\t\t\t// autofit adjusts columns widths to the outer grid width\r\n\t\t\t// it doesn't makes sense if grid has inner scroll with elastic columns\r\n\t\t\tif (config.autofit && !config.grid_elastic_columns) {\r\n\t\t\t\t// delta must be added for all columns\r\n\t\t\t\tfor (var i = 0; i < width.length; i++) {\r\n\t\t\t\t\tvar delta = Math.round(diff / (width.length - i));\r\n\t\t\t\t\twidth[i] += delta;\r\n\t\t\t\t\tvar new_width = this._getColumnWidth(columns[i], config, width[i]);\r\n\r\n\t\t\t\t\tif (new_width != width[i]) {\r\n\t\t\t\t\t\tdelta = new_width - width[i];\r\n\t\t\t\t\t\twidth[i] = new_width;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdiff -= delta;\r\n\t\t\t\t}\r\n\t\t\t} else if (unknown.length) {\r\n\t\t\t\t// there are several columns with undefined width\r\n\t\t\t\tfor (var i = 0; i < unknown.length; i++) {\r\n\t\t\t\t\tvar delta = Math.round(diff / (unknown.length - i)); // no float values, just integer\r\n\t\t\t\t\tvar index = unknown[i];\r\n\t\t\t\t\twidth[index] += delta;\r\n\t\t\t\t\tvar new_width = this._getColumnWidth(columns[index], config, width[index]);\r\n\t\t\t\t\tif (new_width != width[index]) {\r\n\t\t\t\t\t\tdelta = new_width - width[index];\r\n\t\t\t\t\t\twidth[index] = new_width;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdiff -= delta;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0; i < width.length; i++) {\r\n\t\t\t\tcolumns[i].width = width[i];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar changed = (gridWidth != cols_width);\r\n\t\t\tthis.$config.width = cols_width - 1;\r\n\t\t\tconfig.grid_width = cols_width;\r\n\t\t\tif (changed) {\r\n\t\t\t\tthis.$parent._setContentSize(this.$config.width, null);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t_renderGridHeader: function () {\r\n\t\tvar gantt = this.$gantt;\r\n\t\tvar config = this.$getConfig();\r\n\t\tvar locale = this.$gantt.locale;\r\n\t\tvar templates = this.$gantt.templates;\r\n\r\n\t\tvar columns = this.getGridColumns();\r\n\t\tif (config.rtl) {\r\n\t\t\tcolumns = columns.reverse();\r\n\t\t}\r\n\t\tvar cells = [];\r\n\t\tvar width = 0,\r\n\t\t\tlabels = locale.labels;\r\n\r\n\t\tvar lineHeigth = config.scale_height - 1;\r\n\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tvar last = i == columns.length - 1;\r\n\t\t\tvar col = columns[i];\r\n\r\n\t\t\t// ensure columns have non-empty names\r\n\t\t\tif (!col.name) {\r\n\t\t\t\tcol.name = gantt.uid() + \"\";\r\n\t\t\t}\r\n\r\n\t\t\tvar colWidth = col.width * 1;\r\n\r\n\t\t\tvar gridWidth = this._getGridWidth();\r\n\t\t\tif (last && gridWidth > width + colWidth)\r\n\t\t\t\tcol.width = colWidth = gridWidth - width;\r\n\t\t\twidth += colWidth;\r\n\t\t\tvar sort = (gantt._sort && col.name == gantt._sort.name) ? (`<div data-column-id=\"${col.name}\" class=\"gantt_sort gantt_${gantt._sort.direction}\"></div>`) : \"\";\r\n\t\t\tvar cssClass = [\"gantt_grid_head_cell\",\r\n\t\t\t\t(\"gantt_grid_head_\" + col.name),\r\n\t\t\t\t(last ? \"gantt_last_cell\" : \"\"),\r\n\t\t\t\ttemplates.grid_header_class(col.name, col)].join(\" \");\r\n\r\n\t\t\tvar style = \"width:\" + (colWidth - (last ? 1 : 0)) + \"px;\";\r\n\t\t\tvar label = (col.label || labels[\"column_\" + col.name] || labels[col.name]);\r\n\t\t\tlabel = label || \"\";\r\n\r\n\t\t\tvar ariaAttrs = gantt._waiAria.gridScaleCellAttrString(col, label);\r\n\r\n\t\t\tvar cell = \"<div class='\" + cssClass + \"' style='\" + style + \"' \" + ariaAttrs + \r\n\t\t\t\t\" data-column-id='\" + col.name + \"' column_id='\" + col.name + \"'\" +\r\n\t\t\t\t\" data-column-name='\" + col.name + \"' data-column-index='\" + i + \"'\" +\r\n\t\t\t\t\">\" + label + sort + \"</div>\";\r\n\t\t\tcells.push(cell);\r\n\t\t}\r\n\t\tthis.$grid_scale.style.height = (config.scale_height) + \"px\";\r\n\t\tthis.$grid_scale.style.lineHeight = lineHeigth + \"px\";\r\n\t\t//this.$grid_scale.style.width = \"inherit\";\r\n\t\tthis.$grid_scale.innerHTML = cells.join(\"\");\r\n\r\n\t\tif (this._renderHeaderResizers) {\r\n\t\t\tthis._renderHeaderResizers();\r\n\t\t}\r\n\t},\r\n\r\n\t_getGridWidth: function () {\r\n\t\t// TODO: refactor/remove/comment some of _getGridWidth/this.$config.width/this.$state.width, it's not clear what they do\r\n\t\treturn this.$config.width;\r\n\t},\r\n\r\n\tdestructor: function () {\r\n\t\tthis._clearLayers(this.$gantt);\r\n\t\tif (this._mouseDelegates) {\r\n\t\t\tthis._mouseDelegates.destructor();\r\n\t\t\tthis._mouseDelegates = null;\r\n\t\t}\r\n\t\tthis._unbindStore();\r\n\t\tthis.$grid = null;\r\n\t\tthis.$grid_scale = null;\r\n\t\tthis.$grid_data = null;\r\n\t\tthis.$gantt = null;\r\n\t\tif (this.$config.rowStore) {\r\n\t\t\tthis.$config.rowStore.detachEvent(this._staticBgHandler);\r\n\t\t\tthis.$config.rowStore = null;\r\n\t\t}\r\n\r\n\t\tthis.callEvent(\"onDestroy\", []);\r\n\t\tthis.detachAllEvents();\r\n\t}\r\n};\r\n\r\nexport default Grid;\r\n","export default {\r\n\tinit: function (controller, grid) {\r\n\t\tvar gantt = grid.$gantt;\r\n\r\n\t\tgantt.attachEvent(\"onTaskClick\", function (id, e) {\r\n\t\t\tif (gantt._is_icon_open_click(e))\r\n\t\t\t\treturn true;\r\n\t\t\tvar state = controller.getState();\r\n\t\t\tvar cell = controller.locateCell(e.target);\r\n\r\n\t\t\tif (cell && controller.getEditorConfig(cell.columnName)) {\r\n\t\t\t\tif (controller.isVisible() && state.id == cell.id && state.columnName == cell.columnName) {\r\n\t\t\t\t\t// do nothing if editor is already active in this cell\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcontroller.startEdit(cell.id, cell.columnName);\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onEmptyClick\", function () {\r\n\t\t\tif (controller.isVisible() && controller.isChanged()) {\r\n\t\t\t\tcontroller.save();\r\n\t\t\t} else {\r\n\t\t\t\tcontroller.hide();\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onTaskDblClick\", function (id, e) {\r\n\t\t\tvar state = controller.getState();\r\n\t\t\tvar cell = controller.locateCell(e.target);\r\n\t\t\tif (cell && controller.isVisible() && cell.columnName == state.columnName) {\r\n\t\t\t\t//GS-933 probably, we don't need to hide the inline editor because the lightbox cannot be opened if you double-click on an inline editor\r\n\t\t\t\t//remove this code later if people don't complain\r\n\t\t\t\t//controller.hide();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\t},\r\n\r\n\tonShow: function (controller, placeholder, grid) {\r\n\t\tvar gantt = grid.$gantt;\r\n\t\t\r\n\r\n\t\tif(gantt.ext && gantt.ext.keyboardNavigation){\r\n\t\t\tvar keyNav = gantt.ext.keyboardNavigation;\r\n\t\t\tkeyNav.attachEvent(\"onKeyDown\", function(command, e){\r\n\t\t\t\tvar keyboard = gantt.constants.KEY_CODES;\r\n\t\t\t\tvar keyCode = e.keyCode;\r\n\t\t\t\tvar preventKeyNav = false;\r\n\r\n\t\t\t\tswitch (keyCode){\r\n\t\t\t\t\tcase keyboard.SPACE:\r\n\t\t\t\t\t\tif(controller.isVisible()){\r\n\t\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (preventKeyNav){\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t} else{\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tplaceholder.onkeydown = function (e) {\r\n\t\t\te = e || window.event;\r\n\r\n\t\t\tvar keyboard = gantt.constants.KEY_CODES;\r\n\t\t\tif (e.defaultPrevented || (e.shiftKey && e.keyCode != keyboard.TAB)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar shouldPrevent = true;\r\n\t\t\tswitch (e.keyCode) {\r\n\t\t\t\tcase gantt.keys.edit_save:\r\n\t\t\t\t\tcontroller.save();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase gantt.keys.edit_cancel:\r\n\t\t\t\t\tcontroller.hide();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.UP:\r\n\t\t\t\tcase keyboard.DOWN:\r\n\t\t\t\t\tif (controller.isVisible()) {\r\n\t\t\t\t\t\tcontroller.hide();\r\n\t\t\t\t\t\tshouldPrevent = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.TAB:\r\n\t\t\t\t\tif (e.shiftKey) {\r\n\t\t\t\t\t\tcontroller.editPrevCell(true);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcontroller.editNextCell(true);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tshouldPrevent = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (shouldPrevent) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\tonHide: function () {\r\n\r\n\t},\r\n\r\n\tdestroy: function () {\r\n\r\n\t}\r\n};\r\n\r\n","export default {\r\n\tinit: function(controller, grid){\r\n\t\tvar self = controller;\r\n\t\tvar gantt = grid.$gantt;\r\n\r\n\t\tvar onBlurDelay = null;\r\n\t\tvar keyNav = gantt.ext.keyboardNavigation;\r\n\t\tkeyNav.attachEvent(\"onBeforeFocus\", function (node) {\r\n\t\t\tvar activeCell = controller.locateCell(node);\r\n\t\t\tclearTimeout(onBlurDelay);\r\n\t\t\tif (activeCell) {\r\n\t\t\t\tvar columnName = activeCell.columnName;\r\n\t\t\t\tvar id = activeCell.id;\r\n\r\n\t\t\t\tvar editorState = self.getState();\r\n\t\t\t\tif(self.isVisible()){\r\n\t\t\t\t\tif(editorState.id == id && editorState.columnName === columnName) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tkeyNav.attachEvent(\"onFocus\", function (node) {\r\n\t\t\tvar activeCell = controller.locateCell(node);\r\n\t\t\tvar state = controller.getState();\r\n\t\t\tclearTimeout(onBlurDelay);\r\n\t\t\tif (activeCell && !(activeCell.id == state.id && activeCell.columnName == state.columnName)) {\r\n\t\t\t\tif(self.isVisible()){\r\n\t\t\t\t\tself.save();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tcontroller.attachEvent(\"onHide\", function(){\r\n\t\t\tclearTimeout(onBlurDelay);\r\n\t\t});\r\n\r\n\t\tkeyNav.attachEvent(\"onBlur\", function () {\r\n\t\t\tonBlurDelay = setTimeout(function(){\r\n\t\t\t\tself.save();\r\n\t\t\t});\r\n\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onTaskDblClick\", function(id,e){\r\n\t\t\t// block lightbox on double click inside editor\r\n\t\t\tvar state = controller.getState();\r\n\t\t\tvar cell = controller.locateCell(e.target);\r\n\t\t\tif(cell && controller.isVisible() && cell.columnName == state.columnName){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tgantt.attachEvent(\"onTaskClick\", function (id, e) {\r\n\t\t\tif(gantt._is_icon_open_click(e))\r\n\t\t\t\treturn true;\r\n\r\n\t\t\tvar state = controller.getState();\r\n\t\t\tvar cell = controller.locateCell(e.target);\r\n\r\n\t\t\tif (cell && controller.getEditorConfig(cell.columnName)) {\r\n\t\t\t\tif(controller.isVisible() && state.id == cell.id && state.columnName == cell.columnName){\r\n\t\t\t\t\t// do nothing if editor is already active in this cell\r\n\t\t\t\t}else{\r\n\t\t\t\t\tcontroller.startEdit(cell.id, cell.columnName);\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\t\tgantt.attachEvent(\"onEmptyClick\", function () {\r\n\t\t\tself.save();\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tkeyNav.attachEvent(\"onKeyDown\", function(command, e){\r\n\t\t\tvar activeCell = controller.locateCell(e.target);\r\n\t\t\tvar hasEditor = activeCell ? controller.getEditorConfig(activeCell.columnName) : false;\r\n\r\n\t\t\tvar state = controller.getState();\r\n\t\t\tvar keyboard = gantt.constants.KEY_CODES;\r\n\t\t\tvar keyCode = e.keyCode;\r\n\t\t\tvar preventKeyNav = false;\r\n\r\n\t\t\tswitch (keyCode){\r\n\t\t\t\tcase keyboard.ENTER:\r\n\t\t\t\t\tif(controller.isVisible()){\r\n\t\t\t\t\t\tcontroller.save();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}else if(hasEditor && !(e.ctrlKey || e.metaKey || e.shiftKey)){\r\n\t\t\t\t\t\tself.startEdit(activeCell.id, activeCell.columnName);\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.ESC:\r\n\t\t\t\t\tif(controller.isVisible()){\r\n\t\t\t\t\t\tcontroller.hide();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.UP:\r\n\t\t\t\tcase keyboard.DOWN:\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.LEFT:\r\n\t\t\t\tcase keyboard.RIGHT:\r\n\t\t\t\t\tif((hasEditor && controller.isVisible()) || state.editorType === \"date\"){\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.SPACE:\r\n\t\t\t\t\tif(controller.isVisible()){\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(hasEditor && !controller.isVisible()){\r\n\t\t\t\t\t\tself.startEdit(activeCell.id, activeCell.columnName);\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.DELETE:\r\n\t\t\t\t\tif(hasEditor && !controller.isVisible()){\r\n\t\t\t\t\t\tself.startEdit(activeCell.id, activeCell.columnName);\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t} else if(hasEditor && controller.isVisible()){\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase keyboard.TAB:\r\n\t\t\t\t\tif(controller.isVisible()){\r\n\r\n\t\t\t\t\t\tif(e.shiftKey){\r\n\t\t\t\t\t\t\tcontroller.editPrevCell(true);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tcontroller.editNextCell(true);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar newState = controller.getState();\r\n\t\t\t\t\t\tif(newState.id){\r\n\t\t\t\t\t\t\tkeyNav.focus({type:\"taskCell\", id: newState.id, column:newState.columnName});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tif(controller.isVisible())\r\n\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\telse{\r\n\r\n\t\t\t\t\t\t// start editing on character key\r\n\t\t\t\t\t\tif((keyCode >= 48 && keyCode <= 57) || // [0-9]\r\n\t\t\t\t\t\t\t(keyCode > 95 && keyCode < 112) || // numpad\r\n\t\t\t\t\t\t\t(keyCode >= 64 && keyCode <= 91) || // [a-z]\r\n\t\t\t\t\t\t\t(keyCode > 185 && keyCode < 193) || //;=-,etc\r\n\t\t\t\t\t\t\t(keyCode > 218  && keyCode < 223)\r\n\t\t\t\t\t\t){\r\n\t\t\t\t\t\t\tvar modifiers = command.modifiers;\r\n\r\n\t\t\t\t\t\t\tvar anyModifier = modifiers.alt || modifiers.ctrl || modifiers.meta || modifiers.shift;\r\n\t\t\t\t\t\t\tif(modifiers.alt){\r\n\t\t\t\t\t\t\t\t// don't start editing on alt+key\r\n\t\t\t\t\t\t\t}else if (anyModifier && keyNav.getCommandHandler(command, \"taskCell\")){\r\n\t\t\t\t\t\t\t\t// don't start editing if command already have a keyboard shortcut\r\n\t\t\t\t\t\t\t}else if(hasEditor && !controller.isVisible()){\r\n\t\t\t\t\t\t\t\tself.startEdit(activeCell.id, activeCell.columnName);\r\n\t\t\t\t\t\t\t\tpreventKeyNav = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (preventKeyNav){\r\n\t\t\t\treturn false;\r\n\t\t\t} else{\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t});\r\n\t},\r\n\tonShow: function(controller, placeholder, grid){},\r\n\tonHide: function(controller, placeholder, grid){\r\n\t\tconst gantt = grid.$gantt;\r\n\t\tif (gantt){\r\n\t\t\tgantt.focus();\r\n\t\t}\r\n\r\n\t},\r\n\tdestroy: function(){}\r\n};\r\n\r\n","import defaultMapping from \"./keyboard_mappings/default\";\r\nimport keyNavMappings from \"./keyboard_mappings/keyboard_navigation\";\r\n\r\nexport default function(gantt){\r\n\r\n\tvar mapping = null;\r\n\r\n\treturn {\r\n\t\tsetMapping: function(map){\r\n\t\t\tmapping = map;\r\n\t\t},\r\n\t\tgetMapping: function(){\r\n\r\n\t\t\tif(mapping){\r\n\t\t\t\treturn mapping;\r\n\t\t\t}else if(gantt.config.keyboard_navigation_cells && gantt.ext.keyboardNavigation){\r\n\t\t\t\treturn keyNavMappings;\r\n\t\t\t}else{\r\n\t\t\t\treturn defaultMapping;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n};\r\n","export default function (gantt) {\r\n\r\n\tvar BaseEditor = function () {\r\n\t};\r\n\r\n\tBaseEditor.prototype = {\r\n\t\tshow: function (id, column, config, placeholder) {\r\n\t\t},\r\n\t\thide: function () {\r\n\t\t},\r\n\t\tset_value: function (value, id, column, node) {\r\n\t\t\tthis.get_input(node).value = value;\r\n\t\t},\r\n\t\tget_value: function (id, column, node) {\r\n\t\t\treturn this.get_input(node).value || \"\";\r\n\t\t},\r\n\t\tis_changed: function (value, id, column, node) {\r\n\t\t\tvar currentValue = this.get_value(id, column, node);\r\n\t\t\tif (currentValue && value && currentValue.valueOf && value.valueOf) {\r\n\t\t\t\treturn currentValue.valueOf() != value.valueOf();\r\n\t\t\t} else {\r\n\t\t\t\treturn currentValue != value;\r\n\t\t\t}\r\n\t\t},\r\n\t\tis_valid: function (value, id, column, node) {\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\t\tsave: function (id, column, node) {\r\n\r\n\t\t},\r\n\t\tget_input: function (node) {\r\n\t\t\treturn node.querySelector(\"input\");\r\n\t\t},\r\n\t\tfocus: function (node) {\r\n\t\t\tvar input = this.get_input(node);\r\n\t\t\tif (!input) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (input.focus) {\r\n\t\t\t\tinput.focus();\r\n\t\t\t}\r\n\r\n\t\t\tif (input.select) {\r\n\t\t\t\tinput.select();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\treturn BaseEditor;\r\n};","import BaseFactory from \"./base\";\r\nimport * as utils from \"../../../../../utils/utils\";\r\nimport __extends from \"../../../../../utils/extends\";\r\n\r\n\r\nexport default function(gantt) {\r\n\r\n\tvar BaseEditor = BaseFactory(gantt);\r\n\r\n\tfunction TextEditor() {\r\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(TextEditor, BaseEditor);\r\n\r\n\tutils.mixin(TextEditor.prototype, {\r\n\t\tshow: function (id, column, config, placeholder) {\r\n\t\t\tvar html = `<div role='cell'><input type='text' name='${column.name}' title='${column.name}'></div>`;\r\n\t\t\tplaceholder.innerHTML = html;\r\n\t\t}\r\n\t}, true);\r\n\r\n\treturn TextEditor;\r\n};","import BaseFactory from \"./base\";\r\nimport * as utils from \"../../../../../utils/utils\";\r\nimport __extends from \"../../../../../utils/extends\";\r\n\r\n\r\nexport default function(gantt) {\r\n\r\n\tvar BaseEditor = BaseFactory(gantt);\r\n\r\n\tfunction NumberEditor() {\r\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(NumberEditor, BaseEditor);\r\n\r\n\tutils.mixin(NumberEditor.prototype, {\r\n\t\tshow: function (id, column, config, placeholder) {\r\n\t\t\tvar min = config.min || 0,\r\n\t\t\t\tmax = config.max || 100;\r\n\r\n\t\t\tvar html = `<div role='cell'><input type='number' min='${min}' max='${max}' name='${column.name}' title='${column.name}'></div>`;\r\n\t\t\tplaceholder.innerHTML = html;\r\n\r\n\t\t\t// GS-1914. Do not allow entering alues beyond min and max via keyboard\r\n\t\t\tplaceholder.oninput = function (e) {\r\n\t\t\t\tif (+e.target.value < min) {\r\n\t\t\t\t\te.target.value = min;\r\n\t\t\t\t}\r\n\t\t\t\tif (+e.target.value > max) {\r\n\t\t\t\t\te.target.value = max;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\tget_value: function (id, column, node) {\r\n\t\t\treturn this.get_input(node).value || \"\";\r\n\t\t},\r\n\t\tis_valid: function (value, id, column, node) {\r\n\t\t\treturn !isNaN(parseInt(value, 10));\r\n\t\t}\r\n\t}, true);\r\n\r\n\treturn NumberEditor;\r\n};","import BaseFactory from \"./base\";\r\nimport * as utils from \"../../../../../utils/utils\";\r\nimport __extends from \"../../../../../utils/extends\";\r\n\r\n\r\nexport default function(gantt) {\r\n\r\n\tvar BaseEditor = BaseFactory(gantt);\r\n\r\n\tfunction SelectEditor() {\r\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(SelectEditor, BaseEditor);\r\n\r\n\tutils.mixin(SelectEditor.prototype, {\r\n\t\tshow: function (id, column, config, placeholder) {\r\n\t\t\tvar html = `<div role='cell'><select name='${column.name}' title='${column.name}'>`;\r\n\t\t\tvar optionsHtml = [],\r\n\t\t\t\toptions = config.options || [];\r\n\r\n\t\t\tfor (var i = 0; i < options.length; i++) {\r\n\t\t\t\toptionsHtml.push(\"<option value='\" + config.options[i].key + \"'>\" + options[i].label + \"</option>\");\r\n\t\t\t}\r\n\r\n\t\t\thtml += optionsHtml.join(\"\") + \"</select></div>\";\r\n\t\t\tplaceholder.innerHTML = html;\r\n\t\t},\r\n\t\tget_input: function (node) {\r\n\t\t\treturn node.querySelector(\"select\");\r\n\t\t}\r\n\t}, true);\r\n\r\n\treturn SelectEditor;\r\n};","import * as utils from \"../../../../../utils/utils\";\r\nimport __extends from \"../../../../../utils/extends\";\r\nimport BaseFactory from \"./base\";\r\n\r\nexport default function (gantt) {\r\n\tvar BaseEditor = BaseFactory(gantt);\r\n\t\r\n\t\r\n\r\n\tvar html5DateFormat = \"%Y-%m-%d\";\r\n\r\n\tvar dateToStr = null;\r\n\tvar strToDate = null;\r\n\r\n\tfunction init() {\r\n\t\tif (!dateToStr) {\r\n\t\t\tdateToStr = gantt.date.date_to_str(html5DateFormat);\r\n\t\t}\r\n\t\tif (!strToDate) {\r\n\t\t\tstrToDate = gantt.date.str_to_date(html5DateFormat);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction DateEditor() {\r\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\r\n\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(DateEditor, BaseEditor);\r\n\r\n\tutils.mixin(DateEditor.prototype, {\r\n\t\tshow: function (id, column, config, placeholder) {\r\n\t\t\tinit();\r\n\t\t\tvar minValue = null;\r\n\t\t\tvar maxValue = null;\r\n\r\n\t\t\tif(typeof config.min === \"function\"){\r\n\t\t\t\tminValue = config.min(id, column);\r\n\t\t\t}else{\r\n\t\t\t\tminValue = config.min;\r\n\t\t\t}\r\n\r\n\t\t\tif(typeof config.max === \"function\"){\r\n\t\t\t\tmaxValue = config.max(id, column);\r\n\t\t\t}else{\r\n\t\t\t\tmaxValue = config.max;\r\n\t\t\t}\r\n\r\n\t\t\tvar minAttr = minValue ? \" min='\" + dateToStr(minValue)+\"' \"  : \"\";\r\n\t\t\tvar maxAttr = maxValue ? \" max='\" + dateToStr(maxValue)+\"' \"  : \"\";\r\n\t\t\tvar html = `<div style='width:140px' role='cell'><input type='date' ${minAttr} ${maxAttr} name='${column.name}' title='${column.name}'></div>`;\r\n\t\t\tplaceholder.innerHTML = html;\r\n\r\n\t\t\t// GS-1914. Do not allow entering alues beyond min and max via keyboard\r\n\t\t\tplaceholder.oninput = function (e) {\r\n\t\t\t\tif (e.target.value && (minValue || maxValue)){\r\n\t\t\t\t\tif (+gantt.date.str_to_date(\"%Y-%m-%d\")(e.target.value) < +minValue) {\r\n\t\t\t\t\t\te.target.value = gantt.date.date_to_str(\"%Y-%m-%d\")(minValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (+gantt.date.str_to_date(\"%Y-%m-%d\")(e.target.value) > +maxValue) {\r\n\t\t\t\t\t\te.target.value = gantt.date.date_to_str(\"%Y-%m-%d\")(maxValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\tset_value: function (value, id, column, node) {\r\n\t\t\tif (value && value.getFullYear) {\r\n\t\t\t\tthis.get_input(node).value = dateToStr(value);\r\n\t\t\t} else {\r\n\t\t\t\tthis.get_input(node).value = value;\r\n\t\t\t}\r\n\t\t},\r\n\t\tis_valid: function (value, id, column, node) {\r\n\t\t\tif (!value || isNaN(value.getTime()))\r\n\t\t\t\treturn false;\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tget_value: function (id, column, node) {\r\n\t\t\tvar parsed;\r\n\t\t\ttry {\r\n\t\t\t\tparsed = strToDate(this.get_input(node).value || \"\");\r\n\t\t\t} catch (e) {\r\n\t\t\t\tparsed = null;// return null will cancel changes\r\n\t\t\t}\r\n\r\n\t\t\treturn parsed;\r\n\t\t}\r\n\t}, true);\r\n\r\n\treturn DateEditor;\r\n};\r\n","import BaseFactory from \"./base\";\r\nimport * as utils from \"../../../../../utils/utils\";\r\nimport __extends from \"../../../../../utils/extends\";\r\n\r\n\r\nexport default function(gantt) {\r\n\r\n\tvar BaseEditor = BaseFactory(gantt);\r\n\r\n\tfunction PredecessorEditor() {\r\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(PredecessorEditor, BaseEditor);\r\n\r\n\tfunction getFormatter(config) {\r\n\t\treturn config.formatter || gantt.ext.formatters.linkFormatter();\r\n\t}\r\n\r\n\tfunction parseInputString(value, config) {\r\n\t\tvar predecessors = (value || \"\").split(config.delimiter || \",\");\r\n\t\tfor (var i = 0; i < predecessors.length; i++) {\r\n\t\t\tvar val = predecessors[i].trim();\r\n\t\t\tif (val) {\r\n\t\t\t\tpredecessors[i] = val;\r\n\t\t\t} else {\r\n\t\t\t\tpredecessors.splice(i, 1);\r\n\t\t\t\ti--;\r\n\t\t\t}\r\n\t\t}\r\n\t\tpredecessors.sort();\r\n\t\treturn predecessors;\r\n\t}\r\n\r\n\tfunction formatPredecessors(task, config, gantt) {\r\n\t\tvar links = task.$target;\r\n\t\tvar labels = [];\r\n\t\tfor (var i = 0; i < links.length; i++) {\r\n\t\t\tvar link = gantt.getLink(links[i]);\r\n\t\t\tlabels.push(getFormatter(config).format(link));\r\n\t\t}\r\n\t\treturn labels.join((config.delimiter || \",\") + \" \");\r\n\t}\r\n\r\n\tfunction getSelectedLinks(taskId, predecessorCodes, config) {\r\n\t\tvar links = [];\r\n\t\t// select only unique codes GS-1439\r\n\t\t[...new Set(predecessorCodes)].forEach(function (code) {\r\n\t\t\tvar link = getFormatter(config).parse(code);\r\n\t\t\tif(link){\r\n\t\t\t\tlink.target = taskId;\r\n\t\t\t\t// GS-1290 A way to preserve the link. Otherwise validation will return false\r\n\t\t\t\t// because the existing link ID is not passed there\r\n\t\t\t\tlink.id = \"predecessor_generated\";\r\n\t\t\t\tif (gantt.isLinkAllowed(link)) {\r\n\t\t\t\t\tlink.id = undefined;\r\n\t\t\t\t\tlinks.push(link);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn links;\r\n\t}\r\n\r\n\tfunction formatLinkKey(link){\r\n\t\treturn link.source + \"_\" + link.target + \"_\" + link.type + \"_\" + (link.lag||0);\r\n\t}\r\n\r\n\tfunction getLinksDiff(task, predecessorCodes, config) {\r\n\t\tvar selectedLinks = getSelectedLinks(task.id, predecessorCodes, config);\r\n\t\tvar existingLinksSearch = {};\r\n\t\ttask.$target.forEach(function (linkId) {\r\n\t\t\tvar link = gantt.getLink(linkId);\r\n\t\t\texistingLinksSearch[formatLinkKey(link)] = link.id;\r\n\t\t});\r\n\r\n\t\tvar linksToAdd = [];\r\n\t\tselectedLinks.forEach(function (link) {\r\n\t\t\tvar linkKey = formatLinkKey(link);\r\n\t\t\tif (!existingLinksSearch[linkKey]) {\r\n\t\t\t\tlinksToAdd.push(link);\r\n\t\t\t} else {\r\n\t\t\t\tdelete existingLinksSearch[linkKey];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar linksToDelete = [];\r\n\t\tfor (var i in existingLinksSearch) {\r\n\t\t\tlinksToDelete.push(existingLinksSearch[i]);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tadd: linksToAdd,\r\n\t\t\tremove: linksToDelete\r\n\t\t};\r\n\t}\r\n\r\n\tutils.mixin(PredecessorEditor.prototype, {\r\n\t\tshow: function (id, column, config, placeholder) {\r\n\t\t\tvar html = `<div role='cell'><input type='text' name='${column.name}' title='${column.name}'></div>`;\r\n\t\t\tplaceholder.innerHTML = html;\r\n\t\t},\r\n\t\thide: function () {\r\n\t\t},\r\n\t\tset_value: function (value, id, column, node) {\r\n\t\t\tthis.get_input(node).value = formatPredecessors(value, column.editor, gantt);\r\n\t\t},\r\n\t\tget_value: function (id, column, node) {\r\n\t\t\treturn parseInputString((this.get_input(node).value || \"\"), column.editor);\r\n\t\t},\r\n\t\tsave: function (id, column, node) {\r\n\t\t\tvar task = gantt.getTask(id);\r\n\r\n\t\t\tvar linksDiff = getLinksDiff(task, this.get_value(id, column, node), column.editor);\r\n\r\n\t\t\tif (linksDiff.add.length || linksDiff.remove.length) {\r\n\t\t\t\tgantt.batchUpdate(function () {\r\n\t\t\t\t\tlinksDiff.add.forEach(function (link) {\r\n\t\t\t\t\t\tgantt.addLink(link);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tlinksDiff.remove.forEach(function (linkId) {\r\n\t\t\t\t\t\tgantt.deleteLink(linkId);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (gantt.autoSchedule)\r\n\t\t\t\t\t\tgantt.autoSchedule();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\tis_changed: function (value, id, column, node) {\r\n\t\t\tvar inputPredecessors = this.get_value(id, column, node);\r\n\t\t\tvar taskPredecessors = parseInputString(formatPredecessors(value, column.editor, gantt), column.editor);\r\n\r\n\t\t\treturn inputPredecessors.join() !== taskPredecessors.join();\r\n\t\t}\r\n\t}, true);\r\n\r\n\treturn PredecessorEditor;\r\n};","import BaseFactory from \"./base\";\r\nimport * as utils from \"../../../../../utils/utils\";\r\nimport __extends from \"../../../../../utils/extends\";\r\n\r\n\r\nexport default function(gantt) {\r\n\r\n\tvar BaseEditor = BaseFactory(gantt);\r\n\r\n\tfunction TextEditor() {\r\n\t\tvar self = BaseEditor.apply(this, arguments) || this;\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(TextEditor, BaseEditor);\r\n\r\n\tfunction getFormatter(config) {\r\n\t\treturn config.formatter || gantt.ext.formatters.durationFormatter();\r\n\t}\r\n\tutils.mixin(TextEditor.prototype, {\r\n\t\tshow: function (id, column, config, placeholder) {\r\n\t\t\tvar html = `<div role='cell'><input type='text' name='${column.name}' title='${column.name}'></div>`;\r\n\t\t\tplaceholder.innerHTML = html;\r\n\t\t},\r\n\t\tset_value: function (value, id, column, node) {\r\n\t\t\tthis.get_input(node).value = getFormatter(column.editor).format(value);\r\n\t\t},\r\n\t\tget_value: function (id, column, node) {\r\n\t\t\treturn getFormatter(column.editor).parse(this.get_input(node).value || \"\");\r\n\t\t}\r\n\t}, true);\r\n\r\n\treturn TextEditor;\r\n};","export default function (gantt) {\r\n\treturn function processTaskDateProperties(item, mapTo, mode) {\r\n\t\tif (mode == \"keepDates\") {\r\n\t\t\tkeepDatesOnEdit(item, mapTo);\r\n\t\t} else if (mode == \"keepDuration\") {\r\n\t\t\tkeepDurationOnEdit(item, mapTo);\r\n\t\t} else {\r\n\t\t\tdefaultActionOnEdit(item, mapTo);\r\n\t\t}\r\n\t};\r\n\r\n\t// resize task\r\n\t// resize task when start/end/duration changes\r\n\tfunction keepDatesOnEdit(item, mapTo) {\r\n\t\tif (mapTo == \"duration\") {\r\n\t\t\titem.end_date = gantt.calculateEndDate(item);\r\n\t\t} else if (mapTo == \"end_date\" || mapTo == \"start_date\") {\r\n\t\t\titem.duration = gantt.calculateDuration(item);\r\n\t\t}\r\n\t}\r\n\r\n\t// move task(before 6.2)\r\n\t// move task when start/end dates changes\r\n\t// resize task when duration changes\r\n\tfunction keepDurationOnEdit(item, mapTo) {\r\n\t\tif (mapTo == \"end_date\") {\r\n\t\t\titem.start_date = decreaseStartDate(item);\r\n\t\t} else if (mapTo == \"start_date\" || mapTo == \"duration\") {\r\n\t\t\titem.end_date = gantt.calculateEndDate(item);\r\n\t\t}\r\n\t}\r\n\r\n\t// default behavior\r\n\t// move task when start date changes\r\n\t// resize task when end date/duration changes\r\n\tfunction defaultActionOnEdit(item, mapTo) {\r\n\t\tif (gantt.config.schedule_from_end){\r\n\t\t\tif (mapTo == \"end_date\" || mapTo == \"duration\") {\r\n\t\t\t\titem.start_date = decreaseStartDate(item);\r\n\t\t\t} else if (mapTo == \"start_date\") {\r\n\t\t\t\titem.duration = gantt.calculateDuration(item);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (mapTo == \"start_date\" || mapTo == \"duration\") {\r\n\t\t\t\titem.end_date = gantt.calculateEndDate(item);\r\n\t\t\t} else if (mapTo == \"end_date\") {\r\n\t\t\t\titem.duration = gantt.calculateDuration(item);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction decreaseStartDate(item){\r\n\t\treturn gantt.calculateEndDate({\r\n\t\t\tstart_date: item.end_date,\r\n\t\t\tduration: -item.duration,\r\n\t\t\ttask: item\r\n\t\t});\r\n\t}\r\n};","import getKeyboardMapping from \"./keyboard_mappings\";\r\nimport textEditorFactory from \"./editors/text\";\r\nimport numberEditorFactory from \"./editors/number\";\r\nimport selectEditorFactory from \"./editors/select\";\r\nimport dateEditorFactory from \"./editors/date\";\r\nimport predecessorEditorFactory from \"./editors/predecessor\";\r\nimport durationEditorFactory from \"./editors/duration\";\r\nimport * as utils from \"../../../../utils/utils\";\r\nimport * as domHelpers from \"../../utils/dom_helpers\";\r\nimport eventable from \"../../../../utils/eventable\";\r\nimport linkedPropertiesProcessor from \"./linked_properties\";\r\n\r\nfunction initConfigs(gantt){\r\n\tgantt.config.editor_types = {\r\n\t\ttext: new (textEditorFactory(gantt))(),\r\n\t\tnumber: new (numberEditorFactory(gantt))(),\r\n\t\tselect: new (selectEditorFactory(gantt))(),\r\n\t\tdate: new (dateEditorFactory(gantt))(),\r\n\t\tpredecessor: new (predecessorEditorFactory(gantt))(),\r\n\t\tduration: new (durationEditorFactory(gantt))()\r\n\t};\r\n}\r\n\r\nfunction create(gantt){\r\n\tvar keyboardMapping = getKeyboardMapping(gantt);\r\n\r\n\tvar eventBus = {};\r\n\teventable(eventBus);\r\n\r\n\tfunction createGridEditors(grid) {\r\n\r\n\t\tfunction _getGridCellFromNode(node){\r\n\t\t\tif(!domHelpers.isChildOf(node, grid.$grid)){\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tvar row = domHelpers.locateAttribute(node, grid.$config.item_attribute);\r\n\t\t\tvar cell = domHelpers.locateAttribute(node, \"data-column-name\");\r\n\t\t\tif(row && cell){\r\n\t\t\t\tvar columnName = cell.getAttribute(\"data-column-name\");\r\n\t\t\t\tvar id = row.getAttribute(grid.$config.item_attribute);\r\n\t\t\t\treturn {\r\n\t\t\t\t\tid: id,\r\n\t\t\t\t\tcolumnName: columnName\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\tfunction _getEditorPosition(itemId, columnName) {\r\n\t\t\tvar config = grid.$getConfig();\r\n\t\t\tvar top = grid.getItemTop(itemId);\r\n\t\t\tvar height = grid.getItemHeight(itemId);\r\n\t\t\tvar cols = grid.getGridColumns();\r\n\t\t\tvar left = 0,\r\n\t\t\t\tright = 0,\r\n\t\t\t\twidth = 0;\r\n\r\n\t\t\tfor (var i = 0; i < cols.length; i++) {\r\n\t\t\t\tif (cols[i].name == columnName) {\r\n\t\t\t\t\twidth = cols[i].width;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (config.rtl) {\r\n\t\t\t\t\tright += cols[i].width;\r\n\t\t\t\t}\telse {\r\n\t\t\t\t\tleft += cols[i].width;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\tif (config.rtl) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttop: top,\r\n\t\t\t\t\tright: right,\r\n\t\t\t\t\theight: height,\r\n\t\t\t\t\twidth: width\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttop: top,\r\n\t\t\t\t\tleft: left,\r\n\t\t\t\t\theight: height,\r\n\t\t\t\t\twidth: width\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction findVisibleIndex(grid, columnName) {\r\n\t\t\tvar columns = grid.getGridColumns();\r\n\t\t\tfor (var i = 0; i < columns.length; i++){\r\n\t\t\t\tif(columns[i].name == columnName){\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tfunction _createPlaceholder(itemId, columnName) {\r\n\t\t\tvar config = grid.$getConfig();\r\n\t\t\tvar pos = _getEditorPosition(itemId, columnName);\r\n\t\t\tvar el = document.createElement(\"div\");\r\n\t\t\tel.className = \"gantt_grid_editor_placeholder\";\r\n\t\t\tel.setAttribute(grid.$config.item_attribute, itemId);\r\n\t\t\tel.setAttribute(grid.$config.bind + \"_id\", itemId);// for backward compatibility\r\n\r\n\t\t\tel.setAttribute(\"data-column-name\", columnName);\r\n\r\n\t\t\tvar visibleIndex = findVisibleIndex(grid, columnName);\r\n\t\t\tel.setAttribute(\"data-column-index\", visibleIndex);\r\n\r\n\t\t\tgantt._waiAria.inlineEditorAttr(el);\r\n\r\n\t\t\tif (config.rtl) {\r\n\t\t\t\tel.style.cssText = [\r\n\t\t\t\t\t\"top:\" + pos.top + \"px\",\r\n\t\t\t\t\t\"right:\" + pos.right + \"px\",\r\n\t\t\t\t\t\"width:\" + pos.width + \"px\",\r\n\t\t\t\t\t\"height:\" + pos.height + \"px\"\r\n\t\t\t\t].join(\";\");\r\n\t\t\t} else {\r\n\t\t\t\tel.style.cssText = [\r\n\t\t\t\t\t\"top:\" + pos.top + \"px\",\r\n\t\t\t\t\t\"left:\" + pos.left + \"px\",\r\n\t\t\t\t\t\"width:\" + pos.width + \"px\",\r\n\t\t\t\t\t\"height:\" + pos.height + \"px\"\r\n\t\t\t\t].join(\";\");\r\n\t\t\t}\r\n\r\n\t\t\treturn el;\r\n\t\t}\r\n\r\n\t\tvar updateTaskDateProperties = linkedPropertiesProcessor(gantt);\r\n\r\n\t\tvar handlers = [];\r\n\t\tvar ganttHandlers = [];\r\n\t\tvar store = null;\r\n\t\tvar controller = {\r\n\t\t\t_itemId: null,\r\n\t\t\t_columnName: null,\r\n\t\t\t_editor: null,\r\n\t\t\t_editorType: null,\r\n\t\t\t_placeholder: null,\r\n\r\n\t\t\tlocateCell: _getGridCellFromNode,\r\n\t\t\tgetEditorConfig: function (columnName) {\r\n\t\t\t\tvar column = grid.getColumn(columnName);\r\n\t\t\t\treturn column.editor;\r\n\t\t\t},\r\n\r\n\t\t\tinit: function () {\r\n\t\t\t\tvar mapping = keyboardMapping.getMapping();\r\n\t\t\t\tif(mapping.init){\r\n\t\t\t\t\tmapping.init(this, grid);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstore = grid.$gantt.getDatastore(grid.$config.bind);\r\n\r\n\t\t\t\tvar self = this;\r\n\r\n\t\t\t\thandlers.push(store.attachEvent(\"onIdChange\", function(oldId, newId){\r\n\t\t\t\t\tif(self._itemId == oldId){\r\n\t\t\t\t\t\tself._itemId = newId;\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\t\t\t\thandlers.push(store.attachEvent(\"onStoreUpdated\", function(){\r\n\t\t\t\t\tif(grid.$gantt.getState(\"batchUpdate\").batch_update){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(self.isVisible() && !store.isVisible(self._itemId)){\r\n\t\t\t\t\t\tself.hide();\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\r\n\t\t\t\tganttHandlers.push(gantt.attachEvent(\"onDataRender\", function(){\r\n\t\t\t\t\tif(self._editor && self._placeholder && !domHelpers.isChildOf(self._placeholder, gantt.$root)){\r\n\t\t\t\t\t\tgrid.$grid_data.appendChild(self._placeholder);\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\r\n\t\t\t\tthis.init = function(){};\r\n\t\t\t},\r\n\r\n\t\t\tgetState: function(){\r\n\t\t\t\treturn {\r\n\t\t\t\t\teditor: this._editor,\r\n\t\t\t\t\teditorType: this._editorType,\r\n\t\t\t\t\tplaceholder: this._placeholder,\r\n\t\t\t\t\tid: this._itemId,\r\n\t\t\t\t\tcolumnName: this._columnName\r\n\t\t\t\t};\r\n\t\t\t},\r\n\r\n\t\t\tstartEdit: function(itemId, columnName) {\r\n\t\t\t\tif (this.isVisible()) {\r\n\t\t\t\t\tthis.save();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!store.exists(itemId)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar editorState = {id: itemId, columnName: columnName};\r\n\t\t\t\tif (gantt.isReadonly(store.getItem(itemId))) {\r\n\t\t\t\t\tthis.callEvent(\"onEditPrevent\", [editorState]);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.callEvent(\"onBeforeEditStart\", [editorState]) === false) {\r\n\t\t\t\t\tthis.callEvent(\"onEditPrevent\", [editorState]);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.show(editorState.id, editorState.columnName);\r\n\t\t\t\tthis.setValue();\r\n\r\n\t\t\t\tthis.callEvent(\"onEditStart\", [editorState]);\r\n\t\t\t},\r\n\t\t\tisVisible: function(){\r\n\t\t\t\treturn !!(this._editor && domHelpers.isChildOf(this._placeholder, gantt.$root));\r\n\t\t\t},\r\n\t\t\tshow: function (itemId, columnName) {\r\n\t\t\t\tif (this.isVisible()) {\r\n\t\t\t\t\tthis.save();\r\n\t\t\t\t}\r\n\t\t\t\tvar editorState = {id: itemId, columnName: columnName};\r\n\r\n\t\t\t\tvar column = grid.getColumn(editorState.columnName);\r\n\t\t\t\tvar editorConfig = this.getEditorConfig(column.name);\r\n\t\t\t\tif(!editorConfig)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tvar editor = grid.$getConfig().editor_types[editorConfig.type];\r\n\r\n\t\t\t\tvar placeholder = _createPlaceholder(editorState.id, editorState.columnName);\r\n\t\t\t\tgrid.$grid_data.appendChild(placeholder);\r\n\t\t\t\teditor.show(editorState.id, column, editorConfig, placeholder);\r\n\t\t\t\tthis._editor = editor;\r\n\t\t\t\tthis._placeholder = placeholder;\r\n\t\t\t\tthis._itemId = editorState.id;\r\n\t\t\t\tthis._columnName = editorState.columnName;\r\n\t\t\t\tthis._editorType = editorConfig.type;\r\n\r\n\t\t\t\tvar mapping = keyboardMapping.getMapping();\r\n\t\t\t\tif(mapping.onShow){\r\n\t\t\t\t\tmapping.onShow(this, placeholder, grid);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tsetValue: function () {\r\n\t\t\t\tvar state = this.getState();\r\n\t\t\t\tvar itemId = state.id,\r\n\t\t\t\t\tcolumnName = state.columnName;\r\n\r\n\t\t\t\tvar column = grid.getColumn(columnName);\r\n\t\t\t\tvar item = store.getItem(itemId);\r\n\t\t\t\tvar editorConfig = this.getEditorConfig(columnName);\r\n\r\n\t\t\t\tif(!editorConfig)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tvar value = item[editorConfig.map_to];\r\n\t\t\t\tif(editorConfig.map_to == \"auto\"){\r\n\t\t\t\t\tvalue = store.getItem(itemId);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._editor.set_value(value, itemId, column, this._placeholder);\r\n\t\t\t\tthis.focus();\r\n\t\t\t},\r\n\r\n\t\t\tfocus: function(){\r\n\t\t\t\tthis._editor.focus(this._placeholder);\r\n\t\t\t},\r\n\r\n\t\t\tgetValue: function () {\r\n\t\t\t\tvar column = grid.getColumn(this._columnName);\r\n\t\t\t\treturn this._editor.get_value(this._itemId, column, this._placeholder);\r\n\t\t\t},\r\n\r\n\t\t\t_getItemValue: function() {\r\n\t\t\t\tvar editorConfig = this.getEditorConfig(this._columnName);\r\n\r\n\t\t\t\tif(!editorConfig)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tvar item = gantt.getTask(this._itemId);\r\n\t\t\t\tvar value = item[editorConfig.map_to];\r\n\t\t\t\tif(editorConfig.map_to == \"auto\"){\r\n\t\t\t\t\tvalue = store.getItem(this._itemId);\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t},\r\n\r\n\t\t\tisChanged: function(){\r\n\r\n\t\t\t\tvar column = grid.getColumn(this._columnName);\r\n\r\n\t\t\t\tvar value = this._getItemValue();\r\n\r\n\t\t\t\treturn this._editor.is_changed(value, this._itemId, column, this._placeholder);\r\n\t\t\t},\r\n\r\n\t\t\thide: function () {\r\n\t\t\t\tif(!this._itemId)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tvar itemId = this._itemId,\r\n\t\t\t\t\tcolumnName = this._columnName;\r\n\r\n\t\t\t\tvar mapping = keyboardMapping.getMapping();\r\n\t\t\t\tif(mapping.onHide){\r\n\t\t\t\t\tmapping.onHide(this, this._placeholder, grid);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._itemId = null;\r\n\t\t\t\tthis._columnName = null;\r\n\t\t\t\tthis._editorType = null;\r\n\t\t\t\tif (!this._placeholder) return;\r\n\r\n\t\t\t\tif (this._editor && this._editor.hide) {\r\n\t\t\t\t\tthis._editor.hide(this._placeholder);\r\n\t\t\t\t}\r\n\t\t\t\tthis._editor = null;\r\n\t\t\t\tif (this._placeholder.parentNode) {\r\n\t\t\t\t\tthis._placeholder.parentNode.removeChild(this._placeholder);\r\n\t\t\t\t}\r\n\t\t\t\tthis._placeholder = null;\r\n\r\n\t\t\t\tthis.callEvent(\"onEditEnd\", [{id: itemId, columnName: columnName}]);\r\n\t\t\t},\r\n\t\t\tsave: function () {\r\n\t\t\t\tif(!(this.isVisible() && store.exists(this._itemId) && this.isChanged())) {\r\n\t\t\t\t\tthis.hide();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar itemId = this._itemId,\r\n\t\t\t\t\tcolumnName = this._columnName;\r\n\r\n\t\t\t\tif(!store.exists(itemId)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar item = store.getItem(itemId);\r\n\t\t\t\tvar editorConfig = this.getEditorConfig(columnName);\r\n\t\t\t\tvar editorState = {\r\n\t\t\t\t\tid: itemId,\r\n\t\t\t\t\tcolumnName: columnName,\r\n\t\t\t\t\tnewValue: this.getValue(),\r\n\t\t\t\t\toldValue: this._getItemValue()\r\n\t\t\t\t};\r\n\t\t\t\tif (this.callEvent(\"onBeforeSave\", [editorState]) !== false) {\r\n\t\t\t\t\tif (!this._editor.is_valid || this._editor.is_valid(editorState.newValue, editorState.id, grid.getColumn(columnName), this._placeholder)) {\r\n\r\n\t\t\t\t\t\tvar mapTo = editorConfig.map_to;\r\n\t\t\t\t\t\tvar value = editorState.newValue;\r\n\t\t\t\t\t\tif (mapTo != \"auto\") {\r\n\t\t\t\t\t\t\titem[mapTo] = value;\r\n\t\t\t\t\t\t\tupdateTaskDateProperties(item, mapTo, gantt.config.inline_editors_date_processing);\r\n\r\n\t\t\t\t\t\t\tstore.updateItem(itemId);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._editor.save(itemId, grid.getColumn(columnName), this._placeholder);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.callEvent(\"onSave\", [editorState]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.hide();\r\n\t\t\t},\r\n\r\n\t\t\t_findEditableCell: function findEditableCell(start, direction){\r\n\t\t\t\tvar nextIndex = start;\r\n\t\t\t\tvar columns = grid.getGridColumns();\r\n\t\t\t\tvar nextColumn = columns[nextIndex];\r\n\r\n\t\t\t\tvar columnName = nextColumn ? nextColumn.name : null;\r\n\t\t\t\tif(columnName){\r\n\t\t\t\t\twhile(columnName && !this.getEditorConfig(columnName)){\r\n\t\t\t\t\t\tcolumnName = this._findEditableCell(start + direction, direction);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn columnName;\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t},\r\n\r\n\t\t\tgetNextCell: function moveCell(dir){\r\n\t\t\t\t// GS-1257. true means to exclude hidden columns\r\n\t\t\t\treturn this._findEditableCell(grid.getColumnIndex(this._columnName, true) + dir, dir);\r\n\t\t\t},\r\n\r\n\t\t\tgetFirstCell: function getFirstCell(){\r\n\t\t\t\treturn this._findEditableCell(0, 1);\r\n\t\t\t},\r\n\r\n\t\t\tgetLastCell: function getLastCell(){\r\n\t\t\t\treturn this._findEditableCell(grid.getGridColumns().length - 1, -1);\r\n\t\t\t},\r\n\r\n\t\t\teditNextCell: function nextCell(canChangeRow){\r\n\t\t\t\tvar cell = this.getNextCell(1);\r\n\t\t\t\tif(cell){\r\n\t\t\t\t\tvar nextColumn = this.getNextCell(1);\r\n\t\t\t\t\tif(nextColumn && this.getEditorConfig(nextColumn)){\r\n\t\t\t\t\t\tthis.startEdit(this._itemId, nextColumn);\r\n\t\t\t\t\t}\r\n\t\t\t\t}else if(canChangeRow && this.moveRow(1)){\r\n\t\t\t\t\tvar task = this.moveRow(1);\r\n\t\t\t\t\tcell = this.getFirstCell();\r\n\t\t\t\t\tif(cell && this.getEditorConfig(cell)){\r\n\t\t\t\t\t\tthis.startEdit(task, cell);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\teditPrevCell: function prevCell(canChangeRow){\r\n\t\t\t\tvar cell = this.getNextCell(-1);\r\n\t\t\t\tif(cell){\r\n\t\t\t\t\tvar nextColumn = this.getNextCell(-1);\r\n\t\t\t\t\tif(nextColumn && this.getEditorConfig(nextColumn)){\r\n\t\t\t\t\t\tthis.startEdit(this._itemId, nextColumn);\r\n\t\t\t\t\t}\r\n\t\t\t\t}else if(canChangeRow && this.moveRow(-1)){\r\n\t\t\t\t\tvar task = this.moveRow(-1);\r\n\t\t\t\t\tcell = this.getLastCell();\r\n\t\t\t\t\tif(cell && this.getEditorConfig(cell)){\r\n\t\t\t\t\t\tthis.startEdit(task, cell);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tmoveRow: function moveRow(dir) {\r\n\t\t\t\tvar moveTask = dir > 0 ? gantt.getNext : gantt.getPrev;\r\n\t\t\t\tmoveTask = gantt.bind(moveTask, gantt);\r\n\r\n\t\t\t\tvar nextItem = moveTask(this._itemId);\r\n\t\t\t\t// skip readonly rows\r\n\t\t\t\twhile (gantt.isTaskExists(nextItem) && gantt.isReadonly(gantt.getTask(nextItem))) {\r\n\t\t\t\t\tnextItem = moveTask(nextItem);\r\n\t\t\t\t}\r\n\t\t\t\treturn nextItem;\r\n\t\t\t},\r\n\r\n\t\t\teditNextRow: function nextRow(skipReadonly){\r\n\t\t\t\tvar id = this.getState().id;\r\n\t\t\t\tif (!gantt.isTaskExists(id)) return;\r\n\r\n\t\t\t\tvar next = null;\r\n\t\t\t\tif (skipReadonly){\r\n\t\t\t\t\tnext = this.moveRow(1);\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tnext = gantt.getNext(id);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (gantt.isTaskExists(next)){\r\n\t\t\t\t\tthis.startEdit(next, this._columnName);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\teditPrevRow: function prevRow(skipReadonly){\r\n\t\t\t\tvar id = this.getState().id;\r\n\t\t\t\tif (!gantt.isTaskExists(id)) return;\r\n\r\n\t\t\t\tvar prev = null;\r\n\t\t\t\tif (skipReadonly){\r\n\t\t\t\t\tprev = this.moveRow(-1);\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tprev = gantt.getPrev(id);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (gantt.isTaskExists(prev)){\r\n\t\t\t\t\tthis.startEdit(prev, this._columnName);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdetachStore: function(){\r\n\t\t\t\thandlers.forEach(function(handlerId){\r\n\t\t\t\t\tstore.detachEvent(handlerId);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tganttHandlers.forEach(function(handlerId){\r\n\t\t\t\t\tgantt.detachEvent(handlerId);\r\n\t\t\t\t});\r\n\t\t\t\thandlers = [];\r\n\t\t\t\tganttHandlers = [];\r\n\r\n\t\t\t\tstore = null;\r\n\t\t\t\tthis.hide();\r\n\t\t\t},\r\n\t\t\tdestructor: function(){\r\n\t\t\t\tthis.detachStore();\r\n\t\t\t\tthis.detachAllEvents();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tutils.mixin(controller, keyboardMapping);\r\n\t\tutils.mixin(controller, eventBus);\r\n\r\n\t\treturn controller;\r\n\t}\r\n\r\n\r\n\tvar inlineEditController = {\r\n\t\tinit: initConfigs,\r\n\t\tcreateEditors: createGridEditors\r\n\t};\r\n\r\n\tutils.mixin(inlineEditController, keyboardMapping);\r\n\tutils.mixin(inlineEditController, eventBus);\r\n\r\n\treturn inlineEditController;\r\n}\r\n\r\n\r\n\r\n\r\nexport default create;","// optimized checker for task bars smart rendering\r\n\r\n// first check the vertical position since it's easier to calculate\r\nexport default function isBarInViewport(item, viewport, view, config, gantt){\r\n\tif(!item.start_date || !item.end_date){\r\n\t\treturn null;\r\n\t}\r\n\r\n\tvar top = view.getItemTop(item.id);\r\n\tvar height = view.getItemHeight(item.id);\r\n\r\n\tif(top > viewport.y_end || top + height < viewport.y){\r\n\t\treturn false;\r\n\t}\r\n\r\n\tvar padding = 200;\r\n\tvar startCoord = view.posFromDate(item.start_date);\r\n\tvar endCoord = view.posFromDate(item.end_date);\r\n\tvar left = Math.min(startCoord, endCoord) - padding;\r\n\tvar right = Math.max(startCoord, endCoord) + padding;\r\n\r\n\tif(left > viewport.x_end || right < viewport.x){\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn true;\r\n};","function createTaskRenderer(gantt) {\r\n\r\n\tfunction _render_task_element(task, view, config) {\r\n\t\tvar config = view.$getConfig();\r\n\t\tvar painters = config.type_renderers;\r\n\t\tvar renderer = painters[gantt.getTaskType(task.type)],\r\n\t\t\tdefaultRenderer = _task_default_render;\r\n\r\n\t\tif (!renderer) {\r\n\t\t\treturn defaultRenderer.call(gantt, task, view, config);\r\n\t\t}else{\r\n\t\t\treturn renderer.call(gantt, task, function(task){ return defaultRenderer.call(gantt, task, view, config);}, view);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _task_default_render(task, view, config) {\r\n\t\tif (gantt._isAllowedUnscheduledTask(task))\r\n\t\t\treturn;\r\n\r\n\t\tif (!gantt._isTaskInTimelineLimits(task)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar pos = view.getItemPosition(task);\r\n\r\n\t\tvar cfg = config,\r\n\t\t\ttemplates = view.$getTemplates();\r\n\r\n\t\tvar taskType = gantt.getTaskType(task.type);\r\n\t\tvar height = view.getBarHeight(task.id, taskType == cfg.types.milestone);\r\n\r\n\t\tvar controlsMargin = 0;\r\n\t\tif (taskType == cfg.types.milestone) {\r\n\t\t\tcontrolsMargin = (height - pos.height)/2;\r\n\t\t}\r\n\r\n\t\tvar padd = Math.floor((view.getItemHeight(task.id) - height) / 2);\r\n\t\tconst hasBaselines = gantt.config.baselines && task.baselines && task.baselines.length;\r\n\t\tconst baselinesOnDifferentRow = gantt.config.baselines && (gantt.config.baselines.render_mode == \"separateRow\" || gantt.config.baselines.render_mode == \"individualRow\");\r\n\t\tif (hasBaselines && baselinesOnDifferentRow){\r\n\t\t\tif (task.bar_height !== \"full\" && task.bar_height < task.row_height){\r\n\t\t\t\tif (taskType === cfg.types.milestone){\r\n\t\t\t\t\tlet milestoneHeight = view.getBarHeight(task.id, true);\r\n\t\t\t\t\tlet milestoneWidth = Math.sqrt(2 * milestoneHeight * milestoneHeight);\r\n\t\t\t\t\tpadd = Math.floor((milestoneWidth - height) / 2) + 2;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpadd = 2;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t//\tif(task.type == cfg.types.milestone){\r\n\t//\t\tpadd -= 1;\r\n\t//\t}\r\n\t//\tif (taskType == cfg.types.milestone && cfg.link_line_width > 1) {\r\n\t//\t\t//little adjust milestone position, so horisontal corners would match link arrow when thickness of link line is more than 1px\r\n\t//\t\tpadd += 1;\r\n\t//\t}\r\n\r\n\t\tif (taskType == cfg.types.milestone) {\r\n\t\t\tpos.left -= Math.round(height / 2);\r\n\t\t\tpos.width = height;\r\n\t\t}\r\n\r\n\t\tvar div = document.createElement(\"div\");\r\n\r\n\t\tvar width = Math.round(pos.width);\r\n\r\n\t\tif(view.$config.item_attribute) {\r\n\t\t\tdiv.setAttribute(view.$config.item_attribute, task.id);\r\n\t\t\tdiv.setAttribute(view.$config.bind + \"_id\", task.id); // 'task_id'/'resource_id' for backward compatibility\r\n\t\t}\r\n\r\n\t\tif (cfg.show_progress && taskType != cfg.types.milestone) {\r\n\t\t\t_render_task_progress(task, div, width, cfg, templates);\r\n\t\t}\r\n\r\n\t\t//use separate div to display content above progress bar\r\n\t\tvar content = _render_task_content(task, width, templates);\r\n\r\n\t\tdiv.appendChild(content);\r\n\r\n\t\tvar css = _combine_item_class(\"gantt_task_line\",\r\n\t\t\ttemplates.task_class(task.start_date, task.end_date, task),\r\n\t\t\ttask.id,\r\n\t\t\tview);\r\n\t\tif (task.color || task.progressColor || task.textColor) {\r\n\t\t\tcss += \" gantt_task_inline_color\";\r\n\t\t}\r\n\t\tif (pos.width < 20){\r\n\t\t\tcss += \" gantt_thin_task\";\r\n\t\t}\r\n\t\tdiv.className = css;\r\n\r\n\t\tvar styles = [\r\n\t\t\t\"left:\" + pos.left + \"px\",\r\n\t\t\t\"top:\" + (padd + pos.top) + 'px',\r\n\t\t\t\"height:\" + (height) + 'px',\r\n\t\t\t\"line-height:\" + (Math.max(height < 30 ? height - 2 : height, 0)) + 'px',\r\n\t\t\t\"width:\" + width + 'px'\r\n\t\t];\r\n\r\n\t\tdiv.style.cssText = styles.join(\";\");\r\n\t\tif (task.color) {\r\n\t\t\tdiv.style.setProperty(\"--dhx-gantt-task-background\", task.color);\r\n\t\t}\r\n\t\tif (task.textColor) {\r\n\t\t\tdiv.style.setProperty(\"--dhx-gantt-task-color\", task.textColor);\r\n\t\t}\r\n\r\n\t\tif (task.progressColor) {\r\n\t\t\tdiv.style.setProperty(\"--dhx-gantt-task-progress-color\", task.progressColor);\r\n\t\t}\r\n\r\n\t\t\r\n\t\tvar side = _render_leftside_content(task, cfg, templates, controlsMargin);\r\n\t\tif (side) div.appendChild(side);\r\n\r\n\t\tside = _render_rightside_content(task, cfg, templates, controlsMargin);\r\n\t\tif (side) div.appendChild(side);\r\n\r\n\t\tgantt._waiAria.setTaskBarAttr(task, div);\r\n\r\n\t\tvar state = gantt.getState();\r\n\t\tconst taskEditable = !gantt.isReadonly(task);\r\n\t\tconst timelineDrag = gantt.ext.dragTimeline && gantt.ext.dragTimeline._isDragInProgress();\r\n\r\n\t\tif (taskEditable || timelineDrag) {\r\n\t\t\tif (cfg.drag_resize && !gantt.isSummaryTask(task) && taskType != cfg.types.milestone) {\r\n\t\t\t\t_render_pair(div, \"gantt_task_drag\", task, function (css) {\r\n\t\t\t\t\tvar el = document.createElement(\"div\");\r\n\t\t\t\t\tel.className = css;\r\n\t\t\t\t\treturn el;\r\n\t\t\t\t}, cfg);\r\n\t\t\t}\r\n\t\t\tif (cfg.drag_links && cfg.show_links) {\r\n\t\t\t\t_render_pair(div, \"gantt_link_control\", task, function (css) {\r\n\t\t\t\t\tvar outer = document.createElement(\"div\");\r\n\t\t\t\t\touter.className = css;\r\n\t\t\t\t\touter.style.cssText = [\r\n\t\t\t\t\t\t\"height:\" + height + 'px',\r\n\t\t\t\t\t\t\"line-height:\" + height + 'px'\r\n\t\t\t\t\t].join(\";\");\r\n\t\t\t\t\tvar inner = document.createElement(\"div\");\r\n\t\t\t\t\tinner.className = \"gantt_link_point\";\r\n\r\n\t\t\t\t\tvar showLinkPoints = false;\r\n\t\t\t\t\tif(state.link_source_id && cfg.touch){\r\n\t\t\t\t\t\tshowLinkPoints = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tinner.style.display = showLinkPoints ? \"block\" : \"\";\r\n\t\t\t\t\touter.appendChild(inner);\r\n\t\t\t\t\treturn outer;\r\n\t\t\t\t}, cfg, controlsMargin);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn div;\r\n\t}\r\n\r\n\tfunction _render_side_content(task, template, cssClass, marginStyle) {\r\n\t\tif (!template) return null;\r\n\r\n\t\tvar text = template(task.start_date, task.end_date, task);\r\n\t\tif (!text) return null;\r\n\t\tvar content = document.createElement(\"div\");\r\n\t\tcontent.className = \"gantt_side_content \" + cssClass;\r\n\t\tcontent.innerHTML = text;\r\n\t\tif(marginStyle){\r\n\t\t\tcontent.style[marginStyle.type] = Math.abs(marginStyle.value) + \"px\";\r\n\t\t}\r\n\t\treturn content;\r\n\t}\r\n\r\n\tfunction _render_leftside_content(task, cfg, templates, margin) {\r\n\t\tvar css = \"gantt_left \" + _get_link_crossing_css(!cfg.rtl ? true : false, task, cfg);\r\n\t\tvar marginStyle = null;\r\n\t\tif(margin){\r\n\t\t\tmarginStyle = { type: \"marginRight\", value: margin };\r\n\t\t}\r\n\t\treturn _render_side_content(task, templates.leftside_text, css, marginStyle);\r\n\t}\r\n\r\n\tfunction _render_rightside_content(task, cfg, templates, margin) {\r\n\t\tvar css = \"gantt_right \" + _get_link_crossing_css(!cfg.rtl ? false : true, task, cfg);\r\n\t\tvar marginStyle = null;\r\n\t\tif(margin){\r\n\t\t\tmarginStyle = { type: \"marginLeft\", value: margin };\r\n\t\t}\r\n\t\treturn _render_side_content(task, templates.rightside_text, css, marginStyle);\r\n\t}\r\n\r\n\tfunction _get_link_crossing_css(left, task) {\r\n\t\tvar cond = _get_conditions(left);\r\n\r\n\t\tfor (var i in cond) {\r\n\t\t\tvar links = task[i];\r\n\t\t\tfor (var ln = 0; ln < links.length; ln++) {\r\n\t\t\t\tvar link = gantt.getLink(links[ln]);\r\n\r\n\t\t\t\tfor (var tp = 0; tp < cond[i].length; tp++) {\r\n\t\t\t\t\tif (link.type == cond[i][tp]) {\r\n\t\t\t\t\t\treturn \"gantt_link_crossing\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\r\n\tfunction _render_task_content(task, width, templates) {\r\n\t\tvar content = document.createElement(\"div\");\r\n\t\tif (gantt.getTaskType(task.type) != gantt.config.types.milestone){\r\n\t\t\tcontent.innerHTML = templates.task_text(task.start_date, task.end_date, task);\r\n\t\t} else if(gantt.getTaskType(task.type) == gantt.config.types.milestone && width) {\r\n\t\t\tcontent.style.height = content.style.width = width + \"px\";\r\n\t\t}\r\n\t\tcontent.className = \"gantt_task_content\";\r\n\t\t//content.style.width = width + 'px';\r\n\t\treturn content;\r\n\t}\r\n\r\n\tfunction _render_task_progress(task, element, maxWidth, cfg, templates) {\r\n\t\tvar done = task.progress * 1 || 0;\r\n\r\n\t\tmaxWidth = Math.max(maxWidth - 2, 0);//2px for borders\r\n\t\tvar pr = document.createElement(\"div\");\r\n\t\tvar width = Math.round(maxWidth * done);\r\n\r\n\t\twidth = Math.min(maxWidth, width);\r\n\r\n\t\tpr.style.width = width + 'px';\r\n\t\tpr.className = \"gantt_task_progress\";\r\n\t\tpr.innerHTML = templates.progress_text(task.start_date, task.end_date, task);\r\n\r\n\t\tif(cfg.rtl){\r\n\t\t\tpr.style.position = \"absolute\";\r\n\t\t\tpr.style.right = \"0px\";\r\n\t\t}\r\n\r\n\t\tvar wrapper = document.createElement(\"div\");\r\n\t\twrapper.className = \"gantt_task_progress_wrapper\";\r\n\t\twrapper.appendChild(pr);\r\n\t\telement.appendChild(wrapper);\r\n\r\n\t\tconst taskEditable = !gantt.isReadonly(task);\r\n\t\tconst timelineDrag = gantt.ext.dragTimeline && gantt.ext.dragTimeline._isDragInProgress();\r\n\r\n\t\tif (gantt.config.drag_progress && (taskEditable || timelineDrag)) {\r\n\t\t\tvar drag = document.createElement(\"div\");\r\n\r\n\t\t\tvar markerPos = width;\r\n\t\t\tif(cfg.rtl){\r\n\t\t\t\tmarkerPos = maxWidth - width;\r\n\t\t\t}\r\n\r\n\t\t\tdrag.style.left = markerPos + 'px';\r\n\t\t\tdrag.className = \"gantt_task_progress_drag\";\r\n\t\t\tdrag.innerHTML = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"9\" viewBox=\"0 0 12 9\" fill=\"none\">\r\n<path d=\"M5.58397 1.52543C5.78189 1.22856 6.21811 1.22856 6.41602 1.52543L10.5475 7.72265C10.769 8.05493 10.5308 8.5 10.1315 8.5L1.86852 8.5C1.46917 8.5 1.23097 8.05493 1.45249 7.72265L5.58397 1.52543Z\" fill=\"var(--dhx-gantt-progress-handle-background)\" stroke=\"var(--dhx-gantt-progress-handle-border)\"/>\r\n</svg>`;\r\n\t\t\tpr.appendChild(drag);\r\n\t\t\telement.appendChild(drag);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _get_conditions(leftside) {\r\n\t\tif (leftside) {\r\n\t\t\treturn {\r\n\t\t\t\t$source: [\r\n\t\t\t\t\tgantt.config.links.start_to_start\r\n\t\t\t\t],\r\n\t\t\t\t$target: [\r\n\t\t\t\t\tgantt.config.links.start_to_start,\r\n\t\t\t\t\tgantt.config.links.finish_to_start\r\n\t\t\t\t]\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\treturn {\r\n\t\t\t\t$source: [\r\n\t\t\t\t\tgantt.config.links.finish_to_start,\r\n\t\t\t\t\tgantt.config.links.finish_to_finish\r\n\t\t\t\t],\r\n\t\t\t\t$target: [\r\n\t\t\t\t\tgantt.config.links.finish_to_finish\r\n\t\t\t\t]\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _combine_item_class(basic, template, itemId, view) {\r\n\t\tvar cfg = view.$getConfig();\r\n\t\tvar css = [basic];\r\n\t\tif (template)\r\n\t\t\tcss.push(template);\r\n\r\n\t\tvar state = gantt.getState();\r\n\r\n\t\tvar task = gantt.getTask(itemId);\r\n\r\n\t\tif (gantt.getTaskType(task.type) == cfg.types.milestone) {\r\n\t\t\tcss.push(\"gantt_milestone\");\r\n\t\t}else if (gantt.getTaskType(task.type) == cfg.types.project) {\r\n\t\t\tcss.push(\"gantt_project\");\r\n\t\t}\r\n\r\n\t\tcss.push(\"gantt_bar_\" + gantt.getTaskType(task.type));\r\n\r\n\r\n\t\tif (gantt.isSummaryTask(task))\r\n\t\t\tcss.push(\"gantt_dependent_task\");\r\n\r\n\t\tif (gantt.isSplitTask(task) && ((cfg.open_split_tasks && !task.$open) || !cfg.open_split_tasks)) {\r\n\t\t\tcss.push(\"gantt_split_parent\");\r\n\t\t}\r\n\r\n\t\tif (cfg.select_task && gantt.isSelectedTask(itemId)) {\r\n\t\t\tcss.push(\"gantt_selected\");\r\n\t\t}\r\n\r\n\t\tif (itemId == state.drag_id) {\r\n\t\t\tcss.push(\"gantt_drag_\" + state.drag_mode);\r\n\t\t\tif (state.touch_drag) {\r\n\t\t\t\tcss.push(\"gantt_touch_\" + state.drag_mode);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (state.link_source_id == itemId){\r\n\t\t\tcss.push(\"gantt_link_source\");\r\n\t\t\tif(state.link_from_start) {\r\n\t\t\t\tcss.push(\"gantt_link_from_start\");\r\n\t\t\t}else{\r\n\t\t\t\tcss.push(\"gantt_link_from_end\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (state.link_target_id == itemId)\r\n\t\t\tcss.push(\"gantt_link_target\");\r\n\r\n\r\n\t\tif (cfg.highlight_critical_path && gantt.isCriticalTask) {\r\n\t\t\tif (gantt.isCriticalTask(task))\r\n\t\t\t\tcss.push(\"gantt_critical_task\");\r\n\t\t}\r\n\r\n\t\tif (state.link_landing_area &&\r\n\t\t\t(state.link_target_id && state.link_source_id) &&\r\n\t\t\t(state.link_target_id != state.link_source_id) &&\r\n\t\t\t(state.link_target_id == itemId || state.link_source_id == itemId)) {\r\n\r\n\t\t\tvar from_id = state.link_source_id;\r\n\t\t\tvar from_start = state.link_from_start;\r\n\t\t\tvar to_start = state.link_to_start;\r\n\r\n\t\t\tvar allowDrag = gantt.isLinkAllowed(from_id, itemId, from_start, to_start);\r\n\r\n\t\t\tvar dragClass = \"\";\r\n\t\t\tif (allowDrag) {\r\n\t\t\t\tif (to_start)\r\n\t\t\t\t\tdragClass = \"link_start_allow\";\r\n\t\t\t\telse\r\n\t\t\t\t\tdragClass = \"link_finish_allow\";\r\n\t\t\t} else {\r\n\t\t\t\tif (to_start)\r\n\t\t\t\t\tdragClass = \"link_start_deny\";\r\n\t\t\t\telse\r\n\t\t\t\t\tdragClass = \"link_finish_deny\";\r\n\t\t\t}\r\n\t\t\tcss.push(dragClass);\r\n\t\t}\r\n\t\treturn css.join(\" \");\r\n\t}\r\n\r\n\tfunction _render_pair(parent, css, task, content, config, margin) {\r\n\t\tvar state = gantt.getState();\r\n\t\tvar className, element;\r\n\t\tif (+task.start_date >= +state.min_date) {\r\n\t\t\tclassName = [css, config.rtl ? \"task_right\" : \"task_left\", \"task_start_date\"];\r\n\t\t\telement = content(className.join(\" \"));\r\n\t\t\telement.setAttribute(\"data-bind-property\", \"start_date\");\r\n\t\t\tif(margin){\r\n\t\t\t\telement.style.marginLeft = margin + \"px\";\r\n\t\t\t}\r\n\t\t\tparent.appendChild(element);\r\n\t\t}\r\n\r\n\t\tif (+task.end_date <= +state.max_date){\r\n\t\t\tclassName = [css, config.rtl ? \"task_left\" : \"task_right\", \"task_end_date\"];\r\n\t\t\telement = content(className.join(\" \"));\r\n\t\t\telement.setAttribute(\"data-bind-property\", \"end_date\");\r\n\t\t\tif(margin){\r\n\t\t\t\telement.style.marginRight = margin + \"px\";\r\n\t\t\t}\r\n\t\t\tparent.appendChild(element);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn _render_task_element;\r\n}\r\n\r\nexport default createTaskRenderer;","import isInViewPort from \"./viewport/is_bar_in_viewport\";\r\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\r\nimport createBaseBarRender from \"./task_bar_render\";\r\n\r\nexport default function createTaskRenderer(gantt){\r\n\tvar defaultRender = createBaseBarRender(gantt);\r\n\treturn {\r\n\t\trender: defaultRender,\r\n\t\tupdate: null,\r\n\t\t//getRectangle: getBarRectangle\r\n\t\tisInViewPort: isInViewPort,\r\n\t\tgetVisibleRange: getVisibleRange\r\n\t};\r\n};","export default function () {\r\n  // eslint-disable-next-line no-console\r\n  console.error(\"You are trying to use a Pro feature that is not available in the GPL version.\");\r\n  return {\r\n    render: function (){},\r\n    isInViewPort: function (){},\r\n    getVisibleRange: function (){}\r\n  };\r\n};\r\n","import createBaseBarRender from \"./task_bar_render\";\r\nimport isInViewPort from \"./viewport/is_bar_in_viewport\";\r\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\r\n\r\nfunction createTaskRenderer(gantt){\r\n\tconst defaultRender = createBaseBarRender(gantt);\r\n\r\n\tconst renderedNodes = {};\r\n\r\n\tfunction checkVisibility(child, viewPort, timeline, config, gantt){\r\n\t\tlet isVisible = true;\r\n\t\t// GS-2123. Don't render rollup tasks that are outside the viewport\r\n\t\tif (config.smart_rendering){\r\n\t\t\tisVisible = isInViewPort(child, viewPort, timeline, config, gantt);\r\n\t\t}\r\n\t\treturn isVisible;\r\n\t}\r\n\r\n\tfunction generateChildElement(task, child, timeline, sizes){\r\n\t\tconst childCopy = gantt.copy(gantt.getTask(child.id));\r\n\t\tchildCopy.$rendered_at = task.id;\r\n\t\t// a way to filter rollup tasks:\r\n\t\tconst displayRollup = gantt.callEvent(\"onBeforeRollupTaskDisplay\", [childCopy.id, childCopy, task.id]);\r\n\t\tif (displayRollup === false){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst element = defaultRender(childCopy, timeline);\r\n\t\tif(!element){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst height = timeline.getBarHeight(task.id, child.type == gantt.config.types.milestone);\r\n\t\tconst padding = Math.floor((timeline.getItemHeight(task.id) - height) / 2);\r\n\r\n\t\telement.style.top = (sizes.top + padding) + \"px\";\r\n\t\telement.classList.add(\"gantt_rollup_child\");\r\n\t\telement.setAttribute(\"data-rollup-parent-id\", task.id);\r\n\r\n\t\treturn element;\r\n\t}\r\n\r\n\tfunction getKey(childId, renderParentId){\r\n\t\treturn childId + \"_\" + renderParentId;\r\n\t}\r\n\r\n\r\n\tfunction renderRollupTask(task, timeline, config, viewPort) {\r\n\t\tif (task.rollup !== false && task.$rollup && task.$rollup.length) {\r\n\t\t\tconst el = document.createElement('div'),\r\n\t\t\t\tsizes = gantt.getTaskPosition(task);\r\n\r\n\t\t\t// vertical position is not important for the rollup tasks as long as the parent is rendered\r\n\t\t\tif (viewPort){\r\n\t\t\t\tviewPort.y = 0;\r\n\t\t\t\tviewPort.y_end = gantt.$task_bg.scrollHeight;\r\n\t\t\t}\r\n\r\n\t\t\ttask.$rollup.forEach(function(itemId){\r\n\t\t\t\tif (!gantt.isTaskExists(itemId)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tconst child = gantt.getTask(itemId);\r\n\t\t\t\tlet isVisible = checkVisibility(child, viewPort, timeline, config, gantt);\r\n\t\t\t\tif (!isVisible){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst element = generateChildElement(task, child, timeline, sizes);\r\n\t\t\t\tif (element) {\r\n\t\t\t\t\trenderedNodes[getKey(child.id, task.id)] = element;\r\n\t\t\t\t\tel.appendChild(element);\r\n\t\t\t\t} else{\r\n\t\t\t\t\trenderedNodes[getKey(child.id, task.id)] = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\t\t\treturn el;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction repaintRollupTask(task, itemNode, timeline, config, viewPort) {\r\n\t\tconst el = document.createElement(\"div\"),\r\n\t\tsizes = gantt.getTaskPosition(task);\r\n\r\n\t\t// vertical position is not important for the rollup tasks as long as the parent is rendered\r\n\t\tviewPort.y = 0;\r\n\t\tviewPort.y_end = gantt.$task_bg.scrollHeight;\r\n\r\n\t\ttask.$rollup.forEach(function(itemId){\r\n\t\t\tconst child = gantt.getTask(itemId);\r\n\t\t\tconst rollupKey = getKey(child.id, task.id);\r\n\t\t\tlet isVisible = checkVisibility(child, viewPort, timeline, config, gantt);\r\n\t\t\tif (isVisible !== !!renderedNodes[rollupKey]) {\r\n\r\n\t\t\t\tif (isVisible) {\r\n\t\t\t\t\tconst element = generateChildElement(task, child, timeline, sizes);\r\n\t\t\t\t\trenderedNodes[rollupKey] = element || false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\trenderedNodes[rollupKey] = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!!renderedNodes[rollupKey]) {\r\n\t\t\t\tel.appendChild(renderedNodes[rollupKey]);\r\n\t\t\t}\r\n\t\t\titemNode.innerHTML = \"\";\r\n\t\t\titemNode.appendChild(el);\r\n\t\t});\r\n\t}\r\n\r\n\r\n\r\n\treturn {\r\n\t\trender: renderRollupTask,\r\n\t\tupdate: repaintRollupTask,\r\n\t\t//getRectangle: getBarRectangle\r\n\t\tisInViewPort: isInViewPort,\r\n\t\tgetVisibleRange: getVisibleRange\r\n\t};\r\n}\r\n\r\nexport default createTaskRenderer;","export default function(item, view, config){\r\n\treturn {\r\n\t\ttop: view.getItemTop(item.id),\r\n\t\theight: view.getItemHeight(item.id),\r\n\t\tleft: 0,\r\n\t\tright: Infinity\r\n\t};\r\n};","export default function getVisibleCellsRange(scale, viewport){\r\n\tvar firstCellIndex = 0;\r\n\tvar lastCellIndex = scale.left.length - 1;\r\n\tif(viewport){\r\n\t\tfor(var i = 0; i < scale.left.length; i++){\r\n\t\t\tvar left = scale.left[i];\r\n\t\t\tif(left < viewport.x){\r\n\t\t\t\tfirstCellIndex = i;\r\n\t\t\t}\r\n\t\t\tif(left > viewport.x_end){\r\n\t\t\t\tlastCellIndex = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\tstart: firstCellIndex,\r\n\t\tend: lastCellIndex\r\n\t};\r\n};","import isLegacyRender from \"../is_legacy_smart_render\";\r\n\r\nexport default function isColumnVisible(columnIndex, scale, viewPort, gantt){\r\n\tvar width = scale.width[columnIndex];\r\n\tif(width <= 0){\r\n\t\treturn false;\r\n\t}\r\n\tif(!gantt.config.smart_rendering || isLegacyRender(gantt)){\r\n\t\treturn true;\r\n\t}\r\n\tvar cellLeftCoord = scale.left[columnIndex] - width;\r\n\tvar cellRightCoord = scale.left[columnIndex] + width;\r\n\treturn (cellLeftCoord <= viewPort.x_end && cellRightCoord >= viewPort.x);//do not render skipped columns\r\n};","export default function (items, gantt){\r\n\tvar placeholderConfig = gantt.config.timeline_placeholder;\r\n\titems = items || [];\r\n\tif (placeholderConfig && items.filter(e => e.id === 'timeline_placeholder_task').length === 0){\r\n\t\tvar state = gantt.getState();\r\n\t\tvar lastTaskId = null;\r\n\t\tvar start_date = state.min_date;\r\n\t\tvar end_date = state.max_date;\r\n\t\tif (items.length){\r\n\t\t\tlastTaskId = items[items.length -1].id;\r\n\t\t}\r\n\t\tvar placeholderTask = {\r\n\t\t\tstart_date: start_date, \r\n\t\t\tend_date: end_date, \r\n\t\t\trow_height: placeholderConfig.height || 0,\r\n\t\t\tid: \"timeline_placeholder_task\", \r\n\t\t\tunscheduled: true,\r\n\t\t\tlastTaskId: lastTaskId, \r\n\t\t\tcalendar_id: placeholderConfig.calendar || \"global\",\r\n\t\t\t$source:[], \r\n\t\t\t$target: []\r\n\t\t};\r\n\t\titems.push(placeholderTask);\r\n\t}\r\n};","import getRowRectangle from \"./viewport/get_bg_row_rectangle\";\r\nimport isLegacyRender from \"./is_legacy_smart_render\";\r\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\r\nimport getVisibleCellsRange from \"./viewport/get_visible_cells_range\";\r\nimport isColumnVisible from \"./viewport/is_column_visible\";\r\nimport bgPlaceholder from \"./prerender/task_bg_placeholder\";\r\n\r\nfunction createTaskBgRender(gantt){\r\n\tvar renderedCells = {};\r\n\tvar visibleCells = {};\r\n\r\n\tfunction isRendered(item, columnIndex){\r\n\t\tif(renderedCells[item.id][columnIndex] && renderedCells[item.id][columnIndex].parentNode){\r\n\t\t\treturn true;\r\n\t\t}else{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction detachRenderedCell(itemId, columnIndex){\r\n\t\tif(renderedCells[itemId] && renderedCells[itemId][columnIndex] &&\r\n\t\t\trenderedCells[itemId][columnIndex].parentNode\r\n\t\t\t){\r\n\t\t\t\trenderedCells[itemId][columnIndex].parentNode.removeChild(renderedCells[itemId][columnIndex]);\r\n\t\t\t}\r\n\t}\r\n\r\n\tfunction getCellClassTemplate(view){\r\n\t\tvar templates = view.$getTemplates();\r\n\t\tvar cssTemplate;\r\n\t\tif (typeof templates.task_cell_class !== \"undefined\") {\r\n\t\t\tcssTemplate = templates.task_cell_class;\r\n\t\t\t// eslint-disable-next-line no-console\r\n\t\t\tvar log = console.warn || console.log;\r\n\t\t\tlog('gantt.templates.task_cell_class template is deprecated and will be removed soon. Please use gantt.templates.timeline_cell_class instead.');\r\n\t\t} else {\r\n\t\t\tcssTemplate = templates.timeline_cell_class;\r\n\t\t}\r\n\t\treturn cssTemplate;\r\n\t}\r\n\tfunction getCellContentTemplate(view){\r\n\t\tvar templates = view.$getTemplates();\r\n\t\tvar contentTemplate = templates.timeline_cell_content;\r\n\t\treturn contentTemplate;\r\n\t}\r\n\r\n\tfunction renderCells(item, node, view, config, viewPort){\r\n\t\tvar cfg = view.getScale();\r\n\t\tvar count = cfg.count;\r\n\t\tvar cssTemplate = getCellClassTemplate(view);\r\n\t\tvar contentTemplate = getCellContentTemplate(view);\r\n\r\n\t\tif (config.show_task_cells) {\r\n\t\t\tif(!renderedCells[item.id]){\r\n\t\t\t\trenderedCells[item.id] = {};\r\n\t\t\t}\r\n\t\t\tif(!visibleCells[item.id]){\r\n\t\t\t\tvisibleCells[item.id] = {};\r\n\t\t\t}\r\n\r\n\t\t\tvar range = getVisibleCellsRange(cfg, viewPort);\r\n\r\n\t\t\tfor(var i in visibleCells[item.id]){\r\n\t\t\t\tvar index = visibleCells[item.id][i];\r\n\r\n\t\t\t\tif(Number(index) < range.start || Number(index) > range.end){\r\n\t\t\t\t\tdetachRenderedCell(item.id, index);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvisibleCells[item.id] = {};\r\n\t\t\t// TODO: do not iterate all cell, only ones in the viewport and once that are already rendered\r\n\t\t\tfor (var columnIndex = range.start; columnIndex <= range.end; columnIndex++) {\r\n\t\t\t\tvar cell = renderOneCell(cfg, columnIndex, item, viewPort, count, cssTemplate, contentTemplate, config);\r\n\t\t\t\tif(!cell && isRendered(item, columnIndex)){\r\n\t\t\t\t\tdetachRenderedCell(item.id, columnIndex);\r\n\t\t\t\t}else if (cell && !cell.parentNode){\r\n\t\t\t\t\tnode.appendChild(cell);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction renderOneCell(scale, columnIndex, item, viewPort, count, cssTemplate, contentTemplate, config){\r\n\t\tvar width = scale.width[columnIndex],\r\n\t\t\tcssclass = \"\";\r\n\r\n\t\tif (isColumnVisible(columnIndex, scale, viewPort, gantt)) {//do not render skipped columns\r\n\r\n\t\t\tvar cssTemplateContent = cssTemplate(item, scale.trace_x[columnIndex]);\r\n\t\t\tvar htmlTemplateContent = \"\";\r\n\t\t\tif (contentTemplate) {// for backward compatibility, contentTemplate was added in 7.2.0+, will be undefined if someone used copy of old config/template object\r\n\t\t\t\thtmlTemplateContent = contentTemplate(item, scale.trace_x[columnIndex]);\r\n\t\t\t}\r\n\r\n\t\t\tif(config.static_background){\r\n\t\t\t\t// if cell render in static background is not allowed, or if it's a blank cell\r\n\t\t\t\tvar customCell = !!(cssTemplateContent || htmlTemplateContent);\r\n\t\t\t\tif(!(config.static_background_cells && customCell)){\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(renderedCells[item.id][columnIndex]){\r\n\t\t\t\tvisibleCells[item.id][columnIndex] = columnIndex;\r\n\t\t\t\treturn renderedCells[item.id][columnIndex];\r\n\t\t\t}\r\n\t\t\tvar cell = document.createElement(\"div\");\r\n\t\t\tcell.style.width = (width) + \"px\";\r\n\r\n\t\t\tcssclass = \"gantt_task_cell\" + (columnIndex == count - 1 ? \" gantt_last_cell\" : \"\");\r\n\t\t\tif (cssTemplateContent) {\r\n\t\t\t\tcssclass += \" \" + cssTemplateContent;\r\n\t\t\t}\r\n\t\t\tcell.className = cssclass;\r\n\r\n\t\t\tif (htmlTemplateContent) {\r\n\t\t\t\tcell.innerHTML = htmlTemplateContent;\r\n\t\t\t}\r\n\r\n\t\t\tcell.style.position = \"absolute\";\r\n\t\t\tcell.style.left = scale.left[columnIndex] + \"px\";\r\n\t\t\trenderedCells[item.id][columnIndex] = cell;\r\n\t\t\tvisibleCells[item.id][columnIndex] = columnIndex;\r\n\r\n\t\t\treturn cell;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tfunction _render_bg_line(item, view, config, viewPort) {\r\n\t\tvar templates = view.$getTemplates();\r\n\t\tvar cfg = view.getScale();\r\n\t\tvar count = cfg.count;\r\n\r\n\t\tif(config.static_background && !config.static_background_cells){\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar row = document.createElement(\"div\");\r\n\r\n\t\tvar cellCssTemplate = getCellClassTemplate(view);\r\n\t\tvar cellHtmlTemplate = getCellContentTemplate(view);\r\n\r\n\t\tvar range;\r\n\r\n\t\tif(!viewPort || !config.smart_rendering || isLegacyRender(gantt)){\r\n\t\t\trange = {\r\n\t\t\t\tstart: 0,\r\n\t\t\t\tend: count - 1\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\trange = getVisibleCellsRange(cfg, viewPort.x);\r\n\t\t}\r\n\t\tif (config.show_task_cells) {\r\n\t\t\trenderedCells[item.id] = {};\r\n\t\t\tvisibleCells[item.id] = {};\r\n\t\t\tfor (var columnIndex = range.start; columnIndex <= range.end; columnIndex++) {\r\n\t\t\t\tvar cell = renderOneCell(cfg, columnIndex, item, viewPort, count, cellCssTemplate, cellHtmlTemplate, config);\r\n\t\t\t\tif(cell){\r\n\t\t\t\t\trow.appendChild(cell);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// GS-291. The odd class should be assigned correctly\r\n\t\tconst store = view.$config.rowStore;\r\n\t\tconst odd = store.getIndexById(item.id) % 2 !== 0;\r\n\r\n\t\tvar cssTemplate = templates.task_row_class(item.start_date, item.end_date, item);\r\n\t\tvar css = \"gantt_task_row\" + (odd ? \" odd\" : \"\") + (cssTemplate ? ' ' + cssTemplate : '');\r\n\r\n\t\tif(store.isSelected(item.id)) {\r\n\t\t\tcss += \" gantt_selected\";\r\n\t\t}\r\n\r\n\t\trow.className = css;\r\n\r\n\t\tif (config.smart_rendering) {\r\n\t\t\trow.style.position = \"absolute\";\r\n\t\t\trow.style.top = view.getItemTop(item.id) + \"px\";\r\n\t\t\trow.style.width = \"100%\";\r\n\t\t}else{\r\n\t\t\trow.style.position = \"relative\";\r\n\t\t}\r\n\t\trow.style.height = (view.getItemHeight(item.id)) + \"px\";\r\n\r\n\t\tif (item.id == \"timeline_placeholder_task\"){\r\n\t\t\tvar placeholderTop = 0;\r\n\t\t\tif (item.lastTaskId){\r\n\t\t\t\tvar lastTaskTop = view.getItemTop(item.lastTaskId);\r\n\t\t\t\tvar lastTaskHeight = view.getItemHeight(item.lastTaskId);\r\n\t\t\t\tplaceholderTop = lastTaskTop + lastTaskHeight;\t\r\n\t\t\t}\r\n\r\n\t\t\tvar maxHeight = item.row_height || view.$task_data.offsetHeight;\r\n\r\n\t\t\tvar placeholderHeight = maxHeight - placeholderTop;\r\n\t\t\t// So that it won't exceed the placeholder timeline height\r\n\t\t\tif (placeholderHeight < 0){\r\n\t\t\t\tplaceholderHeight = 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (config.smart_rendering) {\r\n\t\t\t\trow.style.top = placeholderTop + \"px\";\t\r\n\t\t\t}\r\n\t\t\trow.style.height = placeholderHeight + \"px\";\r\n\t\t}\r\n\r\n\r\n\t\tif(view.$config.item_attribute){\r\n\t\t\trow.setAttribute(view.$config.item_attribute, item.id);\r\n\t\t\trow.setAttribute(view.$config.bind + \"_id\", item.id); // 'task_id'/'resource_id' for backward compatibility\r\n\t\t}\r\n\r\n\t\treturn row;\r\n\t}\r\n\r\n\treturn {\r\n\t\trender: _render_bg_line,\r\n\t\tupdate: renderCells,\r\n\t\tgetRectangle: getRowRectangle,\r\n\t\tgetVisibleRange: getVisibleRange,\r\n\t\tprepareData: bgPlaceholder\r\n\t};\r\n}\r\n\r\nexport default createTaskBgRender;\r\n","import isInViewPort from \"./viewport/is_link_in_viewport\";\r\nimport getVisibleRange from \"./viewport/factory/get_visible_link_range\";\r\nimport { childrenHaveBaselines, getMaxParentHeight } from \"./baseline_helper\";\r\n\r\n\r\nfunction createLinkRender(gantt){\r\n\r\nfunction _render_link_element(link, view, config) {\r\n\tvar source = gantt.getTask(link.source);\r\n\tif(source.hide_bar){\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar target = gantt.getTask(link.target);\r\n\tif(target.hide_bar){\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar pt = path_builder.get_endpoint(link, view, source, target);\r\n\tvar dy = pt.e_y - pt.y;\r\n\tvar dx = pt.e_x - pt.x;\r\n\tif(!dx && !dy){\r\n\t\treturn null;\r\n\t}\r\n\r\n\r\n\tvar dots = path_builder.get_points(link, view, source, target);\r\n\tconst lines = drawer.get_lines(dots, view);\r\n\r\n\tconst shapes = transform_lines_to_shapes(lines.filter(l => l.size > 0), config);\r\n  \r\n\tconst div = render_shapes(shapes, view, link, config);\r\n\r\n\r\n\tvar css = \"gantt_task_link\";\r\n\r\n\tif (link.color) {\r\n\t\tcss += \" gantt_link_inline_color\";\r\n\t}\r\n\tvar cssTemplate = gantt.templates.link_class ? gantt.templates.link_class(link) : \"\";\r\n\tif (cssTemplate) {\r\n\t\tcss += \" \" + cssTemplate;\r\n\t}\r\n\r\n\tif (config.highlight_critical_path && gantt.isCriticalLink) {\r\n\t\tif (gantt.isCriticalLink(link))\r\n\t\t\tcss += \" gantt_critical_link\";\r\n\t}\r\n\r\n\tdiv.className = css;\r\n\r\n\tif(view.$config.link_attribute){\r\n\t\tdiv.setAttribute(view.$config.link_attribute, link.id);\r\n\t\tdiv.setAttribute(\"link_id\", link.id);\r\n\t}\r\n\tif (link.color) {\r\n\t\tdiv.style.setProperty(\"--dhx-gantt-link-background\", link.color);\r\n\t}\r\n\r\n\tgantt._waiAria.linkAttr(link, div);\r\n\r\n\treturn div;\r\n}\r\n\r\n\tfunction render_shapes(shapes, view, link, config) {\r\n\t\tconst container = document.createElement(\"div\");\r\n\r\n\t\tshapes.forEach(shape => {\r\n\t\t\tlet element;\r\n\t\t\tif (shape.type === 'line') {\r\n\t\t\t\telement = drawer.render_line(shape.data, null, view, link.source);\r\n\t\t\t} else if (shape.type === 'corner') {\r\n\t\t\t\telement = drawer.render_corner(shape.data, view);\r\n\t\t\t}else if (shape.type === 'arrow') {\r\n\t\t\t\telement = drawer.render_arrow(shape.data, config);\r\n\t\t\t}\r\n\r\n\t\t\tcontainer.appendChild(element);\r\n\t\t});\r\n\r\n\t\treturn container;\r\n\t}\r\n\r\n\tfunction transform_lines_to_shapes(lines, config) {\r\n\t\tconst radius = config.link_radius || 4;\r\n\t\tconst arrowSize = config.link_arrow_size || 6; // Arrow size from config\r\n\t\tconst shapes = [];\r\n\t\r\n\t\tfor (let i = 0; i < lines.length; i++) {\r\n\t\t\tconst line = lines[i];\r\n\t\t\tconst nextLine = lines[i + 1];\r\n\t\r\n\t\t\tif (!nextLine || config.link_radius <= 1) {\r\n\t\t\t\tshapes.push({ type: 'line', data: line });\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\r\n\t\t\tif (line.direction !== nextLine.direction) {\r\n\t\t\t\tif(line.size < radius || nextLine.size < radius){\r\n\t\t\t\t\tshapes.push({ type: 'line', data: line });\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tline.size -= radius;\r\n\t\t\t\tshapes.push({ type: 'line', data: line });\r\n\t\r\n\t\t\t\tlet cornerX = line.x;\r\n\t\t\t\tlet cornerY = line.y - config.link_line_width / 2;\r\n\t\r\n\t\t\t\tswitch (line.direction) {\r\n\t\t\t\t\tcase 'right':\r\n\t\t\t\t\t\tcornerX += line.size;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'left':\r\n\t\t\t\t\t\tcornerX -= line.size;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'down':\r\n\t\t\t\t\t\tcornerY += line.size;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'up':\r\n\t\t\t\t\t\tcornerY -= line.size;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tconst corner = {\r\n\t\t\t\t\tx: cornerX,\r\n\t\t\t\t\ty: cornerY,\r\n\t\t\t\t\tdirection: { from: line.direction, to: nextLine.direction },\r\n\t\t\t\t\tradius\r\n\t\t\t\t};\r\n\t\t\t\tshapes.push({ type: 'corner', data: corner });\r\n\t\r\n\t\t\t\tswitch (nextLine.direction) {\r\n\t\t\t\t\tcase 'right':\r\n\t\t\t\t\t\tnextLine.x += radius;\r\n\t\t\t\t\t\tnextLine.size -= radius;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'left':\r\n\t\t\t\t\t\tnextLine.x -= radius;\r\n\t\t\t\t\t\tnextLine.size -= radius;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'down':\r\n\t\t\t\t\t\tnextLine.y += radius;\r\n\t\t\t\t\t\tnextLine.size -= radius;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'up':\r\n\t\t\t\t\t\tnextLine.y -= radius;\r\n\t\t\t\t\t\tnextLine.size -= radius;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tshapes.push({ type: 'line', data: line });\r\n\t\t\t}\r\n\t\t}\r\n\t\r\n\t\tconst lastLine = lines[lines.length - 1];\r\n\t\r\n\t\tif (lastLine.direction === 'right' || lastLine.direction === 'left') {\r\n\t\t\tlastLine.size -= arrowSize*3/4; \r\n\t\r\n\t\t\tlet arrowX = lastLine.direction === 'right' ? (lastLine.x + lastLine.size) : lastLine.x - lastLine.size - arrowSize/2;\r\n\t\t\tlet arrowY = lastLine.y - (config.link_line_width / 2) - (arrowSize / 2) + 1;\r\n\t\r\n\t\t\tif(lastLine.direction === 'left'){\r\n\t\t\t\tarrowY -= 1;// left pointing arrows for some reason need adjustments\r\n\t\t\t\tarrowX -= 2;\r\n\t\t\t}else{\r\n\t\t\t\tarrowX -= 1;\r\n\t\t\t}\r\n\t\t\tconst arrow = {\r\n\t\t\t\tx: arrowX,\r\n\t\t\t\ty: arrowY,\r\n\t\t\t\tsize: arrowSize,\r\n\t\t\t\tdirection: lastLine.direction\r\n\t\t\t};\r\n\t\r\n\t\t\tshapes.push({ type: 'line', data: lastLine });\r\n\t\t\tshapes.push({ type: 'arrow', data: arrow });\r\n\t\t} else {\r\n\t\t\tshapes.push({ type: 'line', data: lastLine });\r\n\t\t}\r\n\t\r\n\t\treturn shapes;\r\n\t}\r\n\t\r\n\r\n\r\nvar drawer = {\r\n\tcurrent_pos: null,\r\n\tdirs: {\"left\": 'left', \"right\": 'right', \"up\": 'up', \"down\": 'down'},\r\n\tpath: [],\r\n\tclear: function () {\r\n\t\tthis.current_pos = null;\r\n\t\tthis.path = [];\r\n\t},\r\n\tpoint: function (pos) {\r\n\t\tthis.current_pos = gantt.copy(pos);\r\n\t},\r\n\tget_lines: function (dots) {\r\n\t\tthis.clear();\r\n\t\tthis.point(dots[0]);\r\n\t\tfor (var i = 1; i < dots.length; i++) {\r\n\t\t\tthis.line_to(dots[i]);\r\n\t\t}\r\n\t\treturn this.get_path();\r\n\t},\r\n\tline_to: function (pos) {\r\n\t\tvar next = gantt.copy(pos);\r\n\t\tvar prev = this.current_pos;\r\n\r\n\t\tvar line = this._get_line(prev, next);\r\n\t\tthis.path.push(line);\r\n\t\tthis.current_pos = next;\r\n\t},\r\n\tget_path: function () {\r\n\t\treturn this.path;\r\n\t},\r\n\tget_wrapper_sizes: function (v, view, itemId) {\r\n\t\tvar config = view.$getConfig();\r\n\t\tvar res,\r\n\t\t\twrapper_size = config.link_wrapper_width,\r\n\t\t\ty = v.y - (wrapper_size) / 2;\r\n\t\tswitch (v.direction) {\r\n\t\t\tcase this.dirs.left:\r\n\t\t\t\tres = {\r\n\t\t\t\t\ttop: y,\r\n\t\t\t\t\theight: wrapper_size,\r\n\t\t\t\t\tlineHeight: wrapper_size,\r\n\t\t\t\t\tleft: v.x - v.size - wrapper_size / 2,\r\n\t\t\t\t\twidth: v.size + wrapper_size\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tcase this.dirs.right:\r\n\t\t\t\tres = {\r\n\t\t\t\t\ttop: y,\r\n\t\t\t\t\tlineHeight: wrapper_size,\r\n\t\t\t\t\theight: wrapper_size,\r\n\t\t\t\t\tleft: v.x - wrapper_size / 2,\r\n\t\t\t\t\twidth: v.size + wrapper_size\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tcase this.dirs.up:\r\n\t\t\t\tres = {\r\n\t\t\t\t\ttop: y - v.size,\r\n\t\t\t\t\tlineHeight: v.size + wrapper_size,\r\n\t\t\t\t\theight: v.size + wrapper_size,\r\n\t\t\t\t\tleft: v.x - wrapper_size / 2,\r\n\t\t\t\t\twidth: wrapper_size\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tcase this.dirs.down:\r\n\t\t\t\tres = {\r\n\t\t\t\t\ttop: y /*- wrapper_size/2*/,\r\n\t\t\t\t\tlineHeight: v.size + wrapper_size,\r\n\t\t\t\t\theight: v.size + wrapper_size,\r\n\t\t\t\t\tleft: v.x - wrapper_size / 2,\r\n\t\t\t\t\twidth: wrapper_size\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn res;\r\n\t},\r\n\tget_line_sizes: function (v, view) {\r\n\t\tvar config = view.$getConfig();\r\n\t\tvar res,\r\n\t\t\tline_size = config.link_line_width,\r\n\t\t\twrapper_size = config.link_wrapper_width,\r\n\t\t\tsize = v.size + line_size;\r\n\t\tswitch (v.direction) {\r\n\t\t\tcase this.dirs.left:\r\n\t\t\tcase this.dirs.right:\r\n\t\t\t\tres = {\r\n\t\t\t\t\theight: line_size,\r\n\t\t\t\t\twidth: size,\r\n\t\t\t\t\tmarginTop: (wrapper_size - line_size) / 2,\r\n\t\t\t\t\tmarginLeft: (wrapper_size - line_size) / 2\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tcase this.dirs.up:\r\n\t\t\tcase this.dirs.down:\r\n\t\t\t\tres = {\r\n\t\t\t\t\theight: size,\r\n\t\t\t\t\twidth: line_size,\r\n\t\t\t\t\tmarginTop: (wrapper_size - line_size) / 2,\r\n\t\t\t\t\tmarginLeft: (wrapper_size - line_size) / 2\r\n\t\t\t\t};\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\r\n\t\treturn res;\r\n\t},\r\n\trender_line: function (v, end, view, itemId) {\r\n\t\tvar pos = this.get_wrapper_sizes(v, view, itemId);\r\n\t\tvar wrapper = document.createElement(\"div\");\r\n\t\twrapper.style.cssText = [\r\n\t\t\t\"top:\" + pos.top + \"px\",\r\n\t\t\t\"left:\" + pos.left + \"px\",\r\n\t\t\t\"height:\" + pos.height + \"px\",\r\n\t\t\t\"width:\" + pos.width + \"px\"\r\n\t\t].join(';');\r\n\t\twrapper.className = \"gantt_line_wrapper\";\r\n\r\n\t\tvar innerPos = this.get_line_sizes(v, view);\r\n\t\tvar inner = document.createElement(\"div\");\r\n\t\tinner.style.cssText = [\r\n\t\t\t\"height:\" + innerPos.height + \"px\",\r\n\t\t\t\"width:\" + innerPos.width + \"px\",\r\n\t\t\t\"margin-top:\" + innerPos.marginTop + \"px\",\r\n\t\t\t\"margin-left:\" + innerPos.marginLeft + \"px\"\r\n\t\t].join(\";\");\r\n\r\n\t\tinner.className = \"gantt_link_line_\" + v.direction;\r\n\t\twrapper.appendChild(inner);\r\n\r\n\t\treturn wrapper;\r\n\t},\r\n\r\n\trender_corner: function (corner, view) {\r\n\t\tconst radius = corner.radius;\r\n\t\tconst config = view.$getConfig();\r\n\t\tconst lineWidth = config.link_line_width || 2;\r\n\t\tconst cornerDiv = document.createElement(\"div\");\r\n\t\r\n\t\tcornerDiv.classList.add(\"gantt_link_corner\");\r\n\t\tcornerDiv.classList.add(`gantt_link_corner_${corner.direction.from}_${corner.direction.to}`);\r\n\t\r\n\t\tcornerDiv.style.width = `${radius}px`;\r\n\t\tcornerDiv.style.height = `${radius}px`;\r\n\t\r\n\t\tlet borderVertical;\r\n\t\tlet borderHorizontal;\r\n\r\n\t\tif (corner.direction.from === 'right' && corner.direction.to === 'down') {\r\n\t\t\tborderVertical = \"Right\";\r\n\t\t\tborderHorizontal = \"Top\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y}px`;\r\n\t\t} else if (corner.direction.from === 'down' && corner.direction.to === 'right') {\r\n\t\t\tborderVertical = \"Left\";\r\n\t\t\tborderHorizontal = \"Bottom\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y}px`;\r\n\t\t} else if (corner.direction.from === 'right' && corner.direction.to === 'up') {\r\n\t\t\tborderVertical = \"Right\";\r\n\t\t\tborderHorizontal = \"Bottom\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y - radius}px`;\r\n\t\t} else if (corner.direction.from === 'up' && corner.direction.to === 'right') {\r\n\t\t\tborderVertical = \"Left\";\r\n\t\t\tborderHorizontal = \"Top\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y - radius}px`;\r\n\t\t} else if (corner.direction.from === 'left' && corner.direction.to === 'down') {\r\n\t\t\tborderVertical = \"Left\";\r\n\t\t\tborderHorizontal = \"Top\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - radius - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y}px`;\r\n\t\t} else if (corner.direction.from === 'down' && corner.direction.to === 'left') {\r\n\t\t\tborderVertical = \"Right\";\r\n\t\t\tborderHorizontal = \"Bottom\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - radius - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y}px`;\r\n\t\t} else if (corner.direction.from === 'left' && corner.direction.to === 'up') {\r\n\t\t\tborderVertical = \"Left\";\r\n\t\t\tborderHorizontal = \"Bottom\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - radius - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y - radius}px`;\r\n\t\t} else if (corner.direction.from === 'up' && corner.direction.to === 'left') {\r\n\t\t\tborderVertical = \"Right\";\r\n\t\t\tborderHorizontal = \"Top\";\r\n\t\t\tcornerDiv.style.left = `${corner.x - radius - config.link_line_width/2}px`;\r\n\t\t\tcornerDiv.style.top = `${corner.y - radius}px`;\r\n\t\t}\r\n\r\n\t\tcornerDiv.style[`border${borderHorizontal}Width`] = `${lineWidth}px`;\r\n\t\tcornerDiv.style[`border${borderVertical}Width`] = `${lineWidth}px`;\r\n\t\tcornerDiv.style[`border${borderVertical}Style`] = `solid`;\r\n\t\tcornerDiv.style[`border${borderHorizontal}Style`] = `solid`;\r\n\t\tcornerDiv.style[`border${borderHorizontal}${borderVertical}Radius`] = `${radius}px`;\r\n\r\n\t\r\n\t\treturn cornerDiv;\r\n\t},\r\n\r\n\trender_arrow(arrow, config) {\r\n\t\tvar div = document.createElement(\"div\");\r\n\t\tvar top = arrow.y;\r\n\t\tvar left = arrow.x;\r\n\t\r\n\t\tvar size = config.link_arrow_size;\r\n\t\tdiv.style.setProperty(\"--dhx-gantt-icon-size\", `${size}px`);\r\n\t\r\n\t\tvar className = \"gantt_link_arrow gantt_link_arrow_\" + arrow.direction;\r\n\r\n\t\tdiv.style.top = top + \"px\";\r\n\t\tdiv.style.left = left + 'px';\r\n\t\tdiv.className = className;\r\n\t\r\n\t\treturn div;\r\n\t},\r\n\t\r\n\t_get_line: function (from, to) {\r\n\t\tvar direction = this.get_direction(from, to);\r\n\t\tvar vect = {\r\n\t\t\tx: from.x,\r\n\t\t\ty: from.y,\r\n\t\t\tdirection: this.get_direction(from, to)\r\n\t\t};\r\n\t\tif (direction == this.dirs.left || direction == this.dirs.right) {\r\n\t\t\tvect.size = Math.abs(from.x - to.x);\r\n\t\t} else {\r\n\t\t\tvect.size = Math.abs(from.y - to.y);\r\n\t\t}\r\n\t\treturn vect;\r\n\t},\r\n\tget_direction: function (from, to) {\r\n\t\tvar direction = 0;\r\n\t\tif (to.x < from.x) {\r\n\t\t\tdirection = this.dirs.left;\r\n\t\t} else if (to.x > from.x) {\r\n\t\t\tdirection = this.dirs.right;\r\n\t\t} else if (to.y > from.y) {\r\n\t\t\tdirection = this.dirs.down;\r\n\t\t} else {\r\n\t\t\tdirection = this.dirs.up;\r\n\t\t}\r\n\t\treturn direction;\r\n\t}\r\n\r\n};\r\n\r\nvar path_builder = {\r\n\r\n\tpath: [],\r\n\tclear: function () {\r\n\t\tthis.path = [];\r\n\t},\r\n\tcurrent: function () {\r\n\t\treturn this.path[this.path.length - 1];\r\n\t},\r\n\tpoint: function (next) {\r\n\t\tif (!next)\r\n\t\t\treturn this.current();\r\n\r\n\t\tthis.path.push(gantt.copy(next));\r\n\t\treturn next;\r\n\t},\r\n\tpoint_to: function (direction, diff, point) {\r\n\t\tif (!point)\r\n\t\t\tpoint = gantt.copy(this.point());\r\n\t\telse\r\n\t\t\tpoint = {x: point.x, y: point.y};\r\n\t\tvar dir = drawer.dirs;\r\n\t\tswitch (direction) {\r\n\t\t\tcase (dir.left):\r\n\t\t\t\tpoint.x -= diff;\r\n\t\t\t\tbreak;\r\n\t\t\tcase (dir.right):\r\n\t\t\t\tpoint.x += diff;\r\n\t\t\t\tbreak;\r\n\t\t\tcase (dir.up):\r\n\t\t\t\tpoint.y -= diff;\r\n\t\t\t\tbreak;\r\n\t\t\tcase (dir.down):\r\n\t\t\t\tpoint.y += diff;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn this.point(point);\r\n\t},\r\n\tget_points: function (link, view, source, target) {\r\n\t\tvar pt = this.get_endpoint(link, view, source, target);\r\n\t\tvar xy = gantt.config;\r\n\r\n\t\tvar dy = pt.e_y - pt.y;\r\n\t\tvar dx = pt.e_x - pt.x;\r\n\r\n\t\tvar dir = drawer.dirs;\r\n\r\n\t\tvar rowHeight = view.getItemHeight(link.source);\r\n\r\n\t\tthis.clear();\r\n\t\tthis.point({x: pt.x, y: pt.y});\r\n\r\n\t\tvar shiftX = 2 * xy.link_arrow_size;//just random size for first line\r\n\t\tvar lineType = this.get_line_type(link, view.$getConfig());\r\n\r\n\t\tvar forward = (pt.e_x > pt.x);\r\n\t\tif (lineType.from_start && lineType.to_start) {\r\n\t\t\tthis.point_to(dir.left, shiftX);\r\n\t\t\tif (forward) {\r\n\t\t\t\tthis.point_to(dir.down, dy);\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t} else {\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t\tthis.point_to(dir.down, dy);\r\n\t\t\t}\r\n\t\t\tthis.point_to(dir.right, shiftX);\r\n\r\n\t\t} else if (!lineType.from_start && lineType.to_start) {\r\n\t\t\t// GS-2619. No need to add loops for the split tasks (zero dy means the tasks are on the same line)\r\n\t\t\tif (dy !== 0){\r\n\t\t\t\tforward = (pt.e_x > (pt.x + 2 * shiftX));\r\n\t\t\t}\r\n\t\t\tthis.point_to(dir.right, shiftX);\r\n\t\t\tif (forward) {\r\n\t\t\t\tdx -= shiftX;\r\n\t\t\t\tthis.point_to(dir.down, dy);\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t} else {\r\n\t\t\t\tdx -= 2 * shiftX;\r\n\t\t\t\tvar sign = dy > 0 ? 1 : -1;\r\n\r\n\t\t\t\tthis.point_to(dir.down, sign * (rowHeight / 2));\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t\tthis.point_to(dir.down, sign * ( Math.abs(dy) - (rowHeight / 2)));\r\n\t\t\t\tthis.point_to(dir.right, shiftX);\r\n\t\t\t}\r\n\r\n\t\t} else if (!lineType.from_start && !lineType.to_start) {\r\n\t\t\tthis.point_to(dir.right, shiftX);\r\n\t\t\tif (forward) {\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t\tthis.point_to(dir.down, dy);\r\n\t\t\t} else {\r\n\t\t\t\tthis.point_to(dir.down, dy);\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t}\r\n\t\t\tthis.point_to(dir.left, shiftX);\r\n\t\t} else if (lineType.from_start && !lineType.to_start) {\r\n\t\t\t// GS-2619. No need to add loops for the split tasks (zero dy means the tasks are on the same line)\r\n\t\t\tif (dy !== 0){\r\n\t\t\t\tforward = (pt.e_x > (pt.x - 2 * shiftX));\r\n\t\t\t}\r\n\t\t\tthis.point_to(dir.left, shiftX);\r\n\r\n\t\t\tif (!forward) {\r\n\t\t\t\tdx += shiftX;\r\n\t\t\t\tthis.point_to(dir.down, dy);\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t} else {\r\n\t\t\t\tdx += 2 * shiftX;\r\n\t\t\t\tvar sign = dy > 0 ? 1 : -1;\r\n\t\t\t\tthis.point_to(dir.down, sign * (rowHeight / 2));\r\n\t\t\t\tthis.point_to(dir.right, dx);\r\n\t\t\t\tthis.point_to(dir.down, sign * ( Math.abs(dy) - (rowHeight / 2)));\r\n\t\t\t\tthis.point_to(dir.left, shiftX);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn this.path;\r\n\t},\r\n\tget_line_type: function(link, config){\r\n\t\tvar types = config.links;\r\n\t\tvar from_start = false, to_start = false;\r\n\t\tif (link.type == types.start_to_start) {\r\n\t\t\tfrom_start = to_start = true;\r\n\t\t} else if (link.type == types.finish_to_finish) {\r\n\t\t\tfrom_start = to_start = false;\r\n\t\t} else if (link.type == types.finish_to_start) {\r\n\t\t\tfrom_start = false;\r\n\t\t\tto_start = true;\r\n\t\t} else if (link.type == types.start_to_finish) {\r\n\t\t\tfrom_start = true;\r\n\t\t\tto_start = false;\r\n\t\t} else {\r\n\t\t\tgantt.assert(false, \"Invalid link type\");\r\n\t\t}\r\n\r\n\t\tif(config.rtl){\r\n\t\t\tfrom_start = !from_start;\r\n\t\t\tto_start = !to_start;\r\n\t\t}\r\n\r\n\t\treturn {from_start: from_start, to_start: to_start};\r\n\t},\r\n\r\n\tget_endpoint: function (link, view, source, target) {\r\n\t\tvar config = view.$getConfig();\r\n\r\n\t\tvar lineType = this.get_line_type(link, config);\r\n\t\tvar from_start = lineType.from_start,\r\n\t\t\tto_start = lineType.to_start;\r\n\r\n\t\tvar from = getMilestonePosition(source, view, config),\r\n\t\t\tto = getMilestonePosition(target, view, config);\r\n\r\n\t\treturn {\r\n\t\t\tx: from_start ? from.left : (from.left + from.width),\r\n\t\t\te_x: to_start ? to.left : (to.left + to.width),\r\n\t\t\ty: from.top + (from.rowHeight/2) - 1,\r\n\t\t\te_y: to.top + (to.rowHeight/2) - 1\r\n\t\t};\r\n\t}\r\n};\r\n\r\nfunction getMilestonePosition(task, view, config){\r\n\tvar pos = view.getItemPosition(task);\r\n\r\n\t// GS-2270: Link to the split children shouldn't exceed the parent row height\r\n\tlet splitParams = getMaxParentHeight(gantt, view, task);\r\n\tlet maxHeight = splitParams.maxHeight;\r\n\r\n\tlet splitChild = splitParams.splitChild;\r\n\tconst baselinesOnDifferentRow = gantt.config.baselines && (gantt.config.baselines.render_mode == \"separateRow\" || gantt.config.baselines.render_mode == \"individualRow\");\r\n\tconst baselines = baselinesOnDifferentRow && task.baselines && task.baselines.length;\r\n\r\n\tif (splitParams.shrinkHeight){\r\n\t\tpos.rowHeight = maxHeight;\r\n\t}\r\n\r\n\tlet milestoneWidth;\r\n\tlet milestoneTask = gantt.getTaskType(task.type) == config.types.milestone;\r\n\tif(milestoneTask){\r\n\t\tlet milestoneHeight = view.getBarHeight(task.id, true);\r\n\t\tmilestoneWidth = Math.sqrt(2*milestoneHeight*milestoneHeight);\r\n\t\tif (splitParams.shrinkHeight && maxHeight < milestoneHeight){\r\n\t\t\tmilestoneHeight = maxHeight;\r\n\t\t\tmilestoneWidth = maxHeight;\r\n\t\t}\r\n\t\tpos.left -= milestoneWidth / 2;\r\n\t\tpos.width = milestoneWidth;\r\n\t} \r\n\tif (splitChild){\r\n\t\tif (maxHeight >= pos.height) {\r\n\t\t\tconst siblingBaselines = childrenHaveBaselines(gantt, task.parent);\r\n\t\t\tif (baselines || siblingBaselines){\r\n\t\t\t\tif (milestoneTask){\r\n\t\t\t\t\tpos.rowHeight = pos.height + 4;\r\n\t\t\t\t\tpos.left += (pos.width - pos.rowHeight + 4) / 2;\r\n\t\t\t\t\tpos.width = pos.rowHeight - 3;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tpos.rowHeight = pos.height + 6;\r\n\t\t\t\t}\r\n\t\t\t} else if (milestoneTask) {\r\n\t\t\t\tpos.left += (milestoneWidth - pos.height) / 2;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tpos.rowHeight = maxHeight + 2;\r\n\t\t\tif (milestoneTask){\r\n\t\t\t\tpos.left += (pos.width - pos.rowHeight + 4) / 2;\r\n\t\t\t\tpos.width = pos.rowHeight - 3;\r\n\t\t\t}\r\n\t\t}\r\n\t} else if (baselines){\r\n\t\tpos.rowHeight = pos.height + 4;\r\n\t}\r\n\r\n\treturn pos;\r\n}\r\n\r\n\r\nreturn {\r\n\trender: _render_link_element,\r\n\tupdate: null,\r\n\t//getRectangle: getLinkRectangle\r\n\tisInViewPort: isInViewPort,\r\n\tgetVisibleRange: getVisibleRange()\r\n};\r\n}\r\n\r\nexport default createLinkRender;","export default function(item, viewport, view, config, gantt){\r\n    // GS-2481 and GS-1715, don't remove selected task when using keyboard shortcuts and when the inline editor is opened\r\n    if(gantt.$ui.getView(\"grid\") && ((gantt.config.keyboard_navigation && gantt.getSelectedId()) || (gantt.ext.inlineEditors && gantt.ext.inlineEditors.getState().id))) {\r\n\t\t//GS-2661: selected task might be collapsed\r\n\t\tif(!item.$expanded_branch) return false;\r\n\t\treturn true;\r\n\t}\r\n    var top = view.getItemTop(item.id);\r\n\tvar height = view.getItemHeight(item.id);\r\n\r\n\tif(top > viewport.y_end || top + height < viewport.y){\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn true;\r\n};","import * as helpers from \"../../../utils/helpers\";\r\nimport getRowRectangle from \"./viewport/get_grid_row_rectangle\";\r\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\r\nimport isInViewPort from \"./viewport/is_grid_row_in_viewport\";\r\n\r\nfunction createGridLineRender(gantt){\r\n\r\n\tfunction _render_grid_item(item, view, config, viewport) {\r\n\t\tvar columns = view.getGridColumns();\r\n\t\tvar templates = view.$getTemplates();\r\n\r\n\t\tvar store = view.$config.rowStore;\r\n\r\n\t\tvar cells = [];\r\n\t\tvar has_child;\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tvar last = i == columns.length - 1;\r\n\t\t\tvar col = columns[i];\r\n\t\t\tvar cell;\r\n\r\n\t\t\tvar value;\r\n\t\t\tvar textValue;\r\n\t\t\tif (col.name == \"add\") {\r\n\t\t\t\tvar aria = gantt._waiAria.gridAddButtonAttrString(col);\r\n\r\n\t\t\t\tvalue = \"<div \" + aria + \" class='gantt_add'></div>\";\r\n\t\t\t\ttextValue = \"\";\r\n\t\t\t} else {\r\n\t\t\t\tif (col.template)\r\n\t\t\t\t\tvalue = col.template(item);\r\n\t\t\t\telse\r\n\t\t\t\t\tvalue = item[col.name];\r\n\r\n\t\t\t\tif (helpers.isDate(value)){\r\n\t\t\t\t\tvalue = templates.date_grid(value, item, col.name);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (value === null || value === undefined) {\r\n\t\t\t\t\tvalue = \"\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttextValue = value;\r\n\t\t\t\tvalue = \"<div class='gantt_tree_content'>\" + value + \"</div>\";\r\n\t\t\t}\r\n\t\t\tvar css = \"gantt_cell\" + (last ? \" gantt_last_cell\" : \"\");\r\n\r\n\t\t\tvar tree = [];\r\n\t\t\tif (col.tree) {\r\n\t\t\t\tcss += \" gantt_cell_tree\";\r\n\t\t\t\tfor (var j = 0; j < item.$level; j++)\r\n\t\t\t\t\ttree.push(templates.grid_indent(item));\r\n\r\n\t\t\t\thas_child = store.hasChild(item.id) && !(gantt.isSplitTask(item) && !gantt.config.open_split_tasks);\r\n\t\t\t\tif (has_child) {\r\n\t\t\t\t\ttree.push(templates.grid_open(item));\r\n\t\t\t\t\ttree.push(templates.grid_folder(item));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttree.push(templates.grid_blank(item));\r\n\t\t\t\t\ttree.push(templates.grid_file(item));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar style = \"width:\" + (col.width - (last ? 1 : 0)) + \"px;\";\r\n\t\t\tif (this.defined(col.align)){\r\n\t\t\t\tvar flexAlign = {\r\n\t\t\t\t\tright: \"flex-end\",\r\n\t\t\t\t\tleft: \"flex-start\",\r\n\t\t\t\t\tcenter: \"center\"\r\n\t\t\t\t};\r\n\t\t\t\tvar justifyContent = flexAlign[col.align];\r\n\r\n\t\t\t\tstyle += \"text-align:\" + col.align + \";justify-content:\"  + justifyContent + \";\";\r\n\t\t\t}\r\n\r\n\t\t\tvar aria = gantt._waiAria.gridCellAttrString(col, textValue, item);\r\n\r\n\t\t\ttree.push(value);\r\n\t\t\tcell = \"<div class='\" + css + \"' data-column-index='\"+i+\"' data-column-name='\"+col.name+\"' style='\" + style + \"' \" + aria + \">\" + tree.join(\"\") + \"</div>\";\r\n\t\t\tcells.push(cell);\r\n\t\t}\r\n\t\t// GS-291. The odd class should be assigned correctly\r\n\t\tcss = \"\";\r\n\t\tconst storeName = store.$config.name;\r\n\t\tswitch (storeName) {\r\n\t\t\tcase \"task\":\r\n\t\t\t\tcss = gantt.getGlobalTaskIndex(item.id) % 2 === 0 ? \"\" : \" odd\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"resource\":\r\n\t\t\t\tcss = store.visibleOrder.indexOf(item.id) % 2 === 0 ? \"\" : \" odd\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tcss += (item.$transparent) ? \" gantt_transparent\" : \"\";\r\n\r\n\t\tcss += (item.$dataprocessor_class ? \" \" + item.$dataprocessor_class : \"\");\r\n\r\n\t\tif (templates.grid_row_class) {\r\n\t\t\tvar css_template = templates.grid_row_class.call(gantt, item.start_date, item.end_date, item);\r\n\t\t\tif (css_template)\r\n\t\t\t\tcss += \" \" + css_template;\r\n\t\t}\r\n\r\n\t\tif(store.isSelected(item.id)) {\r\n\t\t\tcss += \" gantt_selected\";\r\n\t\t}\r\n\r\n\t\tvar el = document.createElement(\"div\");\r\n\t\tel.className = \"gantt_row\" + css + \" gantt_row_\" + gantt.getTaskType(item.type);\r\n\t\tvar height = view.getItemHeight(item.id);\r\n\t\tel.style.height = height + \"px\";\r\n\t\tel.style.lineHeight = height + \"px\";\r\n\r\n\t\tif(config.smart_rendering){\r\n\t\t\tel.style.position = \"absolute\";\r\n\t\t\tel.style.left = \"0px\";\r\n\t\t\tel.style.top = view.getItemTop(item.id) + \"px\";\r\n\t\t}\r\n\r\n\t\tif(view.$config.item_attribute){\r\n\t\t\tel.setAttribute(view.$config.item_attribute, item.id);\r\n\t\t\tel.setAttribute(view.$config.bind + \"_id\", item.id); // 'task_id'/'resource_id' for backward compatibility\r\n\t\t}\r\n\r\n\t\tgantt._waiAria.taskRowAttr(item, el);\r\n\r\n\t\tel.innerHTML = cells.join(\"\");\r\n\t\treturn el;\r\n\t}\r\n\r\n\tfunction onrender(item, rowNode, view){\r\n\t\tvar columns = view.getGridColumns();\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tvar column = columns[i];\r\n\t\t\tif (column.onrender){\r\n\r\n\t\t\t\t// find cell node for current column\r\n\t\t\t\tvar cellNode = rowNode.querySelector(\"[data-column-name=\" + column.name + \"]\");\r\n\t\t\t\tif (cellNode) {\r\n\t\t\t\t\tvar content = column.onrender(item, cellNode);\r\n\t\t\t\t\tif (content && typeof content === \"string\") {\r\n\t\t\t\t\t\tcellNode.innerHTML = content;\r\n\t\t\t\t\t} else if (content && typeof content === \"object\") {\r\n\t\t\t\t\t\t// render object to node using additional functionality\r\n\t\t\t\t\t\tif (gantt.config.external_render){\r\n\t\t\t\t\t\t\tvar adapter = gantt.config.external_render;\r\n\t\t\t\t\t\t\tif (adapter.isElement(content)){\r\n\t\t\t\t\t\t\t\tadapter.renderElement(content, cellNode);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\trender: _render_grid_item,\r\n\t\tupdate: null,\r\n\t\tgetRectangle: getRowRectangle,\r\n\t\tisInViewPort: isInViewPort,\r\n\t\tgetVisibleRange: getVisibleRange,\r\n\t\tonrender: onrender\r\n\t};\r\n}\r\n\r\nexport default createGridLineRender;","import * as helpers from \"../utils/helpers\";\r\n\r\nexport default function createResourceTimelineBuilder(gantt){\r\n\r\n\tlet resourceTaskCache = {};\r\n\r\n\tgantt.$data.tasksStore.attachEvent(\"onStoreUpdated\", function(){\r\n\t\tresourceTaskCache = {};\r\n\t});\r\n\r\n\tfunction getResourceLoad(resource, resourceProperty, scale, timeline){\r\n\t\tconst cacheKey = resource.id + \"_\" + resourceProperty  + \"_\" + scale.unit + \"_\" + scale.step;\r\n\t\tlet res;\r\n\t\tif (!resourceTaskCache[cacheKey]) {\r\n\t\t\tres = resourceTaskCache[cacheKey] = calculateResourceLoad(resource, resourceProperty, scale, timeline);\r\n\r\n\t\t} else {\r\n\t\t\tres = resourceTaskCache[cacheKey];\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\r\n\tfunction calculateResourceLoadFromAssignments(items, scale, assignmentsPassed){\r\n\t\tconst scaleUnit = scale.unit;\r\n\t\tconst scaleStep = scale.step;\r\n\t\tconst timegrid = {};\r\n\r\n\t\tconst precalculatedTimes = {};\r\n\t\tfor (let i = 0; i < items.length; i++) {\r\n\t\t\tconst item = items[i];\r\n\t\t\tlet task = item;\r\n\t\t\tif(assignmentsPassed){\r\n\t\t\t\ttask = gantt.getTask(item.task_id);\r\n\t\t\t}\r\n\t\t\tif (task.unscheduled){\r\n\t\t\t\tcontinue; // do not process assignments for unscheduled tasks\r\n\t\t\t}\r\n\t\t\tlet minDate = (item.start_date || task.start_date);\r\n\t\t\tlet maxDate = (item.end_date || task.end_date);\r\n\t\t\tif(assignmentsPassed){\r\n\t\t\t\tif(item.start_date){\r\n\t\t\t\t\tminDate = new Date(Math.max(item.start_date.valueOf(), task.start_date.valueOf()));\r\n\t\t\t\t}\r\n\t\t\t\tif(item.end_date){\r\n\t\t\t\t\tmaxDate = new Date(Math.min(item.end_date.valueOf(), task.end_date.valueOf()));\r\n\t\t\t\t}\r\n\t\t\t\t// GS-2063: handle case with fixedDates mode\r\n\t\t\t\tif(item.mode && item.mode == \"fixedDates\"){\r\n\t\t\t\t\tminDate = item.start_date;\r\n\t\t\t\t\tmaxDate = item.end_date;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlet firstColumn = helpers.findBinary(scale.trace_x, minDate.valueOf());\r\n\t\t\tlet minScaleDate = new Date(scale.trace_x[firstColumn] || gantt.date[scaleUnit + \"_start\"](new Date(minDate)));\r\n\t\t\t// GS-2307: need to take into account that task could start before the min scale date\r\n\t\t\t// so the task would be added to timegrid\r\n\t\t\tlet currDate = new Date(Math.min(minDate.valueOf(), minScaleDate.valueOf())); \r\n\r\n\t\t\tlet calendar = gantt.config.work_time ? gantt.getTaskCalendar(task) : gantt;\r\n\t\t\tprecalculatedTimes[calendar.id] = {};\r\n\t\t\twhile (currDate < maxDate) {\r\n\t\t\t\tconst cachedTimes = precalculatedTimes[calendar.id];\r\n\r\n\t\t\t\tlet date = currDate;\r\n\t\t\t\tconst timestamp = date.valueOf();\r\n\r\n\t\t\t\tcurrDate = gantt.date.add(currDate, scaleStep, scaleUnit);\r\n\r\n\t\t\t\tif(cachedTimes[timestamp] === false){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!timegrid[timestamp]){\r\n\t\t\t\t\ttimegrid[timestamp] = {tasks: [], assignments: []};\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttimegrid[timestamp].tasks.push(task);\r\n\t\t\t\tif(assignmentsPassed){\r\n\t\t\t\t\ttimegrid[timestamp].assignments.push(item);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn timegrid;\r\n\t}\r\n\r\n\tfunction calculateResourceLoad(resource, resourceProperty, scale, timeline) {\r\n\r\n\t\tlet items;\r\n\t\tlet assignmentsPassed = false;\r\n\t\tlet timegrid = {};\r\n\r\n\t\tif(gantt.config.process_resource_assignments && resourceProperty === gantt.config.resource_property){\r\n\t\t\tif(resource.$role == \"task\"){\r\n\t\t\t\titems = gantt.getResourceAssignments(resource.$resource_id, resource.$task_id);\r\n\t\t\t}else{\r\n\t\t\t\titems = gantt.getResourceAssignments(resource.id);\r\n\t\t\t}\r\n\r\n\t\t\tassignmentsPassed = true;\r\n\t\t}else if(resource.$role == \"task\"){\r\n\t\t\titems = [];\r\n\t\t}else{\r\n\t\t\titems = gantt.getTaskBy(resourceProperty, resource.id);\r\n\t\t}\r\n\r\n\t\ttimegrid = calculateResourceLoadFromAssignments(items, scale, assignmentsPassed);\r\n\t\tconst scaleUnit = scale.unit;\r\n\t\tconst scaleStep = scale.step;\r\n\r\n\t\tconst timetable = [];\r\n\t\tlet start, end, tasks, assignments, cell;\r\n\t\tconst config = timeline.$getConfig();\r\n\r\n\t\tfor(let i = 0; i < scale.trace_x.length; i++){\r\n\t\t\tstart = new Date(scale.trace_x[i]);\r\n\t\t\tend = gantt.date.add(start, scaleStep, scaleUnit);\r\n\t\t\tcell = timegrid[start.valueOf()] || {};\r\n\t\t\ttasks = cell.tasks || [];\r\n\t\t\tassignments = cell.assignments || [];\r\n\t\t\tif(tasks.length || config.resource_render_empty_cells){\r\n\t\t\t\ttimetable.push({\r\n\t\t\t\t\tstart_date: start,\r\n\t\t\t\t\tend_date: end,\r\n\t\t\t\t\ttasks: tasks,\r\n\t\t\t\t\tassignments: assignments\r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\ttimetable.push(null);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn timetable;\r\n\t}\r\n\r\n\r\n\r\n\treturn getResourceLoad;\r\n};","import getRectangle from \"./viewport/get_bg_row_rectangle\";\r\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\r\nimport getVisibleCellsRange from \"./viewport/get_visible_cells_range\";\r\nimport isColumnVisible from \"./viewport/is_column_visible\";\r\nimport resourceTimetable from \"../../resource_timetable_builder\";\r\n\r\nfunction generateRenderResourceLine(gantt){\r\n\tvar getResourceLoad = resourceTimetable(gantt);\r\n\tvar renderedResourceLines = {};\r\n\r\n\tfunction renderResourceLineCell(resource, day, templates, config, timeline){\r\n\t\tvar css = templates.resource_cell_class(day.start_date, day.end_date, resource, day.tasks, day.assignments);\r\n\t\tvar content = templates.resource_cell_value(day.start_date, day.end_date, resource, day.tasks, day.assignments);\r\n\t\tvar height = timeline.getItemHeight(resource.id) - 1;\r\n\r\n\t\tif (css || content){\r\n\t\t\tvar sizes = timeline.getItemPosition(resource, day.start_date, day.end_date);\r\n\t\t\tvar el = document.createElement('div');\r\n\t\t\tel.setAttribute(timeline.$config.item_attribute, resource.id);\r\n\t\t\tel.className = [\"gantt_resource_marker\", css].join(\" \");\r\n\r\n\t\t\tel.style.cssText = [\r\n\t\t\t\t'left:' + sizes.left + 'px',\r\n\t\t\t\t'width:' + sizes.width + 'px',\r\n\t\t\t\t'height:' + (height) + 'px',\r\n\t\t\t\t'line-height:' + (height) + 'px',\r\n\t\t\t\t'top:' + sizes.top + 'px'\r\n\t\t\t].join(\";\");\r\n\r\n\t\t\tif(content)\r\n\t\t\t\tel.innerHTML = content;\r\n\r\n\t\t\treturn el;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tfunction detachRenderedResourceLine(id, index){\r\n\t\tif(renderedResourceLines[id] && renderedResourceLines[id][index] &&\r\n\t\t\trenderedResourceLines[id][index].parentNode\r\n\t\t\t){\r\n\t\t\t\trenderedResourceLines[id][index].parentNode.removeChild(renderedResourceLines[id][index]);\r\n\t\t\t}\r\n\t}\r\n\r\n\tfunction renderResourceLine(resource, timeline, config, viewport) {\r\n\t\tvar templates = timeline.$getTemplates();\r\n\t\tvar scale = timeline.getScale();\r\n\t\tvar timetable = getResourceLoad(resource, config.resource_property, timeline.getScale(), timeline);\r\n\t\tvar smartRendering = !!viewport;//no viewport means smart rendering is disabled\r\n\t\tvar cells = [];\r\n\t\trenderedResourceLines[resource.id] = {};\r\n\r\n\t\tvar range = getVisibleCellsRange(scale, viewport);\r\n\t\tfor (var columnIndex = range.start; columnIndex <= range.end; columnIndex++) {\r\n\r\n\t\t\tvar day = timetable[columnIndex];\r\n\t\t\tif(!day){\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif(smartRendering && !isColumnVisible(columnIndex, scale, viewport, gantt)){\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tvar cell = renderResourceLineCell(resource, day, templates, config, timeline);\r\n\t\t\tif(cell){\r\n\t\t\t\tcells.push(cell);\r\n\t\t\t\trenderedResourceLines[resource.id][columnIndex] = cell;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar row = null;\r\n\t\tif(cells.length){\r\n\t\t\trow = document.createElement(\"div\");\r\n\t\t\tfor(var i = 0; i < cells.length; i++){\r\n\t\t\t\trow.appendChild(cells[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn row;\r\n\t}\r\n\r\n\tfunction updateResourceLine(resource, node, timeline, config, viewport) {\r\n\t\tvar templates = timeline.$getTemplates();\r\n\t\tvar scale = timeline.getScale();\r\n\t\tvar timetable = getResourceLoad(resource, config.resource_property, timeline.getScale(), timeline);\r\n\r\n\t\tvar range = getVisibleCellsRange(scale, viewport);\r\n\r\n\t\tvar checkedColumns = {};\r\n\t\tif(renderedResourceLines && renderedResourceLines[resource.id]){\r\n\t\t\tfor(var i in renderedResourceLines[resource.id]){\r\n\t\t\t\tcheckedColumns[i] = i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (var columnIndex = range.start; columnIndex <= range.end; columnIndex++) {\r\n\t\t\tvar day = timetable[columnIndex];\r\n\t\t\tcheckedColumns[columnIndex] = false;\r\n\t\t\tif(!day){\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif(!isColumnVisible(columnIndex, scale, viewport, gantt)){\r\n\t\t\t\tdetachRenderedResourceLine(resource.id, columnIndex);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif(!renderedResourceLines[resource.id] || !renderedResourceLines[resource.id][columnIndex]){\r\n\t\t\t\tvar cell = renderResourceLineCell(resource, day, templates, config, timeline);\r\n\t\t\t\tif(cell){\r\n\t\t\t\t\tnode.appendChild(cell);\r\n\t\t\t\t\trenderedResourceLines[resource.id][columnIndex] = cell;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if(renderedResourceLines[resource.id] && renderedResourceLines[resource.id][columnIndex] && !renderedResourceLines[resource.id][columnIndex].parentNode){\r\n\t\t\t\tnode.appendChild(renderedResourceLines[resource.id][columnIndex]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor(var i in checkedColumns){\r\n\t\t\tif(checkedColumns[i] !== false){\r\n\t\t\t\tdetachRenderedResourceLine(resource.id, i);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\trender: renderResourceLine,\r\n\t\tupdate: updateResourceLine,\r\n\t\tgetRectangle: getRectangle,\r\n\t\tgetVisibleRange: getVisibleRange\r\n\t};\r\n}\r\n\r\nexport default generateRenderResourceLine;","import getRowRectangle from \"./viewport/get_grid_row_rectangle\";\r\nimport getVisibleRange from \"./viewport/get_visible_bars_range\";\r\n\r\nfunction createGridTaskRowResizerRender(gantt){\r\n\r\n\tfunction _render_grid_item(item, view, viewport) {\r\n\r\n\t\tvar config = view.$getConfig();\r\n\t\tvar resize_el = document.createElement(\"div\");\r\n\t\tresize_el.className = \"gantt_task_grid_row_resize_wrap\";\r\n\r\n\t\tresize_el.style.top = (view.getItemTop(item.id) + view.getItemHeight(item.id)) + \"px\";\r\n\r\n\t\tresize_el.innerHTML = \"<div class='gantt_task_grid_row_resize' role='cell'></div>\";\r\n\t\tresize_el.setAttribute(config.task_grid_row_resizer_attribute, item.id);\r\n\r\n\t\tgantt._waiAria.rowResizerAttr(resize_el);\r\n\t\treturn resize_el;\r\n\t}\r\n\r\n\treturn {\r\n\t\trender: _render_grid_item,\r\n\t\tupdate: null,\r\n\t\tgetRectangle: getRowRectangle,\r\n\t\tgetVisibleRange: getVisibleRange\r\n\t};\r\n}\r\n\r\nexport default createGridTaskRowResizerRender;","import * as domHelpers from \"../utils/dom_helpers\";\r\nimport isPlaceholderTask from \"../../../utils/placeholder_task\";\r\n\r\nfunction _init_dnd(gantt, grid) {\r\n\tvar DnD = gantt.$services.getService(\"dnd\");\r\n\r\n\tif(!grid.$config.bind || !gantt.getDatastore(grid.$config.bind)){\r\n\t\treturn;\r\n\t}\r\n\r\n\tfunction locate(e){\r\n\t\treturn domHelpers.locateAttribute(e, grid.$config.item_attribute);\r\n\t}\r\n\r\n\tfunction getStore(){\r\n\t\treturn gantt.getDatastore(grid.$config.bind);\r\n\t}\r\n\r\n\tfunction checkPlaceholderTask(id){\r\n\t\treturn isPlaceholderTask(id, gantt, getStore());\r\n\t}\r\n\r\n\tvar dnd = new DnD(grid.$grid_data, {updates_per_second: 60});\r\n\tif (gantt.defined(grid.$getConfig().dnd_sensitivity))\r\n\t\tdnd.config.sensitivity = grid.$getConfig().dnd_sensitivity;\r\n\r\n\tdnd.attachEvent(\"onBeforeDragStart\", gantt.bind(function (obj, e) {\r\n\t\tvar el = locate(e);\r\n\t\tif (!el) return false;\r\n\t\tif (gantt.hideQuickInfo) gantt.hideQuickInfo();\r\n\r\n\t\tif (domHelpers.closest(e.target, \".gantt_grid_editor_placeholder\")){\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar id = el.getAttribute(grid.$config.item_attribute);\r\n\t\tif (checkPlaceholderTask(id)) return false;\r\n\r\n\t\tvar datastore = getStore();\r\n\r\n\t\tvar task = datastore.getItem(id);\r\n\r\n\t\tif (gantt.isReadonly(task))\r\n\t\t\treturn false;\r\n\r\n\t\tdnd.config.initial_open_state = task.$open;\r\n\t\tif (!gantt.callEvent(\"onRowDragStart\", [id, e.target || e.srcElement, e])) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t}, gantt));\r\n\r\n\tdnd.attachEvent(\"onAfterDragStart\", gantt.bind(function (obj, e) {\r\n\t\tvar el = locate(e);\r\n\t\tdnd.config.marker.innerHTML = el.outerHTML;\r\n\t\tvar element = dnd.config.marker.firstChild;\r\n\t\tif(element){\r\n\t\t\telement.style.position = \"static\";\r\n\t\t}\r\n\r\n\t\tdnd.config.id = el.getAttribute(grid.$config.item_attribute);\r\n\r\n\t\tvar store = getStore();\r\n\r\n\t\tvar task = store.getItem(dnd.config.id);\r\n\t\tdnd.config.index = store.getBranchIndex(dnd.config.id);\r\n\t\tdnd.config.parent = task.parent;\r\n\t\ttask.$open = false;\r\n\t\ttask.$transparent = true;\r\n\t\tthis.refreshData();\r\n\t}, gantt));\r\n\r\n\tdnd.lastTaskOfLevel = function (level) {\r\n\t\tvar last_item = null;\r\n\t\tvar store = getStore();\r\n\t\tvar tasks = store.getItems();\r\n\t\tfor (var i = 0, len = tasks.length; i < len; i++) {\r\n\t\t\tif (tasks[i].$level == level) {\r\n\t\t\t\tlast_item = tasks[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn last_item ? last_item.id : null;\r\n\t};\r\n\tdnd._getGridPos = gantt.bind(function (e) {\r\n\t\tvar pos = domHelpers.getNodePosition(grid.$grid_data);\r\n\t\t// row offset\r\n\t\tvar x = pos.x + grid.$grid.scrollLeft;\r\n\t\tvar y = e.pos.y - 10;\r\n\r\n\t\tvar rowHeight = grid.getItemHeight(dnd.config.id);\r\n\t\t// prevent moving row out of grid_data container\r\n\t\tif (y < pos.y) y = pos.y;\r\n\t\tvar gridHeight = grid.getTotalHeight();\r\n\t\tif (y > pos.y + gridHeight - rowHeight) y = pos.y + gridHeight - rowHeight;\r\n\t\tconst maxBottom = pos.y + pos.height;\r\n\t\tif (y > maxBottom - rowHeight) {\r\n\t\t\ty = maxBottom - rowHeight;\r\n\t\t}\r\n\r\n\t\tpos.x = x;\r\n\t\tpos.y = y;\r\n\t\treturn pos;\r\n\t}, gantt);\r\n\tdnd._getTargetY = gantt.bind(function (e) {\r\n\t\tvar pos = domHelpers.getNodePosition(grid.$grid_data);\r\n\t\tvar scrollPos = grid.$state.scrollTop || 0;\r\n\t\tvar maxBottom = gantt.$grid_data.getBoundingClientRect().height + scrollPos;\r\n\r\n\t\tvar y = e.pageY - pos.y + scrollPos;\r\n\t\tif (y > maxBottom) {\r\n\t\t\ty = maxBottom;\r\n\t\t} else if (y < scrollPos) {\r\n\t\t\ty = scrollPos;\r\n\t\t}\r\n\t\treturn y;\r\n\t}, gantt);\r\n\tdnd._getTaskByY = gantt.bind(function (y, dropIndex) {\r\n\r\n\t\tvar store = getStore();\r\n\r\n\t\ty = y || 0;\r\n\r\n\t\tvar index = grid.getItemIndexByTopPosition(y);\r\n\t\tindex = dropIndex < index ? index - 1 : index;\r\n\r\n\t\tif (index > store.countVisible() - 1)\r\n\t\t\treturn null;\r\n\r\n\t\treturn store.getIdByIndex(index);\r\n\t}, gantt);\r\n\tdnd.attachEvent(\"onDragMove\", gantt.bind(function (obj, e) {\r\n\t\tvar gridDataSizes = gantt.$grid_data.getBoundingClientRect();\r\n\t\tvar maxBottom = gridDataSizes.height + gridDataSizes.y + (grid.$state.scrollTop || 0) + window.scrollY;\r\n\t\tvar dd = dnd.config;\r\n\t\tvar pos = dnd._getGridPos(e);\r\n\r\n\t\tgantt._waiAria.reorderMarkerAttr(dd.marker);\r\n\r\n\t\tvar config = grid.$getConfig(),\r\n\t\t\tstore = getStore();\r\n\r\n\t\t// setting position of row\r\n\t\tif (pos.y < maxBottom) {\r\n\t\t\tdd.marker.style.top = pos.y + \"px\";\r\n\t\t} else {\r\n\t\t\tdd.marker.style.top = maxBottom + \"px\";\r\n\t\t}\r\n\t\tdd.marker.style.left = pos.x + 10 + \"px\";\r\n\t\tconst containerSize = domHelpers.getNodePosition(gantt.$root);\r\n\t\tif (pos.width > containerSize.width){\r\n\t\t\tdd.marker.style.width = containerSize.width - 10 - 2 + \"px\";\r\n\t\t\tdd.marker.style.overflow = \"hidden\";\t\r\n\t\t}\r\n\r\n\t\t// highlight row when mouseover\r\n\t\tvar item = store.getItem(dnd.config.id);\r\n\t\tvar targetY = dnd._getTargetY(e);\r\n\t\tvar el = dnd._getTaskByY(targetY, store.getIndexById(item.id));\r\n\r\n\t\tif (!store.exists(el)) {\r\n\t\t\tel = dnd.lastTaskOfLevel(config.order_branch_free ? item.$level : 0);\r\n\t\t\tif (el == dnd.config.id) {\r\n\t\t\t\tel = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction allowedLevel(next, item) {\r\n\t\t\treturn (!(store.isChildOf(over.id, item.id)) && (next.$level == item.$level || config.order_branch_free));\r\n\t\t}\r\n\r\n\t\tif (store.exists(el)) {\r\n\t\t\tvar over = store.getItem(el);\r\n\r\n\t\t\tvar itemTop = grid.getItemTop(over.id);\r\n\t\t\tvar itemHeight = grid.getItemHeight(over.id);\r\n\t\t\tif (itemTop + itemHeight / 2 < targetY) {\r\n\t\t\t\t//hovering over bottom part of item, check can be drop to bottom\r\n\t\t\t\tvar index = store.getIndexById(over.id);\r\n\t\t\t\tvar nextId = store.getNext(over.id);//adds +1 when hovering over placeholder\r\n\t\t\t\tvar next = store.getItem(nextId);\r\n\t\t\t\tif (checkPlaceholderTask(nextId)){\r\n\t\t\t\t\tvar prevId = store.getPrev(next.id);\r\n\t\t\t\t\tnext = store.getItem(prevId);\r\n\t\t\t\t}\r\n\t\t\t\tif (next) {\r\n\t\t\t\t\tif (next.id != item.id) {\r\n\t\t\t\t\t\tover = next; //there is a valid target\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tif (config.order_branch_free) {\r\n\t\t\t\t\t\t\tif (!(store.isChildOf(item.id, over.id) && store.getChildren(over.id).length == 1))\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tstore.move(item.id, store.getBranchIndex(over.id) + 1, store.getParent(over.id));\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//we at end of the list, check and drop at the end of list\r\n\t\t\t\t\tnextId = store.getIdByIndex(index);\r\n\t\t\t\t\tnext = store.getItem(nextId);\r\n\r\n\t\t\t\t\tif (checkPlaceholderTask(nextId)){\r\n\t\t\t\t\t\tvar prevId = store.getPrev(next.id);\r\n\t\t\t\t\t\tnext = store.getItem(prevId);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (allowedLevel(next, item) && next.id != item.id) {\r\n\t\t\t\t\t\tstore.move(item.id, -1, store.getParent(next.id));\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (config.order_branch_free) {\r\n\t\t\t\tif (over.id != item.id && allowedLevel(over, item) && !checkPlaceholderTask(over.id)) {\r\n\t\t\t\t\tif (!store.hasChild(over.id)) {\r\n\t\t\t\t\t\tover.$open = true;\r\n\t\t\t\t\t\tstore.move(item.id, -1, over.id);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (store.getIndexById(over.id) || itemHeight / 3 < targetY) return;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//if item is on different level, check the one before it\r\n\t\t\tvar index = store.getIndexById(over.id),\r\n\t\t\t\tprevId = store.getIdByIndex(index - 1);\r\n\r\n\t\t\tvar prev = store.getItem(prevId);\r\n\r\n\t\t\tvar shift = 1;\r\n\t\t\twhile ((!prev || prev.id == over.id) && index - shift >= 0) {\r\n\r\n\t\t\t\tprevId = store.getIdByIndex(index - shift);\r\n\t\t\t\tprev = store.getItem(prevId);\r\n\t\t\t\tshift++;\r\n\t\t\t}\r\n\r\n\t\t\tif (item.id == over.id || checkPlaceholderTask(over.id)) return;\r\n\t\t\t//replacing item under cursor\r\n\t\t\tif (allowedLevel(over, item) && item.id != over.id) {\r\n\t\t\t\tstore.move(item.id, 0, 0, over.id);\r\n\r\n\t\t\t} else if (over.$level == item.$level - 1 && !store.getChildren(over.id).length) {\r\n\t\t\t\tstore.move(item.id, 0, over.id);\r\n\r\n\t\t\t} else if (prev && (allowedLevel(prev, item)) && (item.id != prev.id)) {\r\n\t\t\t\tstore.move(item.id, -1, store.getParent(prev.id));\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}, gantt));\r\n\r\n\tdnd.attachEvent(\"onDragEnd\", gantt.bind(function () {\r\n\t\tvar store = getStore();\r\n\t\tvar task = store.getItem(dnd.config.id);\r\n\t\ttask.$transparent = false;\r\n\t\ttask.$open = dnd.config.initial_open_state;\r\n\r\n\t\tif (this.callEvent(\"onBeforeRowDragEnd\", [dnd.config.id, dnd.config.parent, dnd.config.index]) === false) {\r\n\t\t\tstore.move(dnd.config.id, dnd.config.index, dnd.config.parent);\r\n\t\t\ttask.$drop_target = null;\r\n\t\t} else {\r\n\t\t\tthis.callEvent(\"onRowDragEnd\", [dnd.config.id, task.$drop_target]);\r\n\t\t}\r\n\t\tgantt.render();\r\n\t\tthis.refreshData();\r\n\t}, gantt));\r\n}\r\n\r\nexport default {\r\n\tinit: _init_dnd\r\n};","/**\r\n * The state object for order branch drag and drop\r\n */\r\n\r\nimport * as utils from \"../../../../utils/utils\";\r\n\r\nexport default {\r\n\tcreateDropTargetObject: function createDropTargetObject(parent) {\r\n\t\tvar res = {\r\n\t\t\ttargetParent: null,\r\n\t\t\ttargetIndex: 0,\r\n\t\t\ttargetId: null,\r\n\t\t\tchild: false,\r\n\t\t\tnextSibling: false,\r\n\t\t\tprevSibling: false\r\n\t\t};\r\n\r\n\t\tif (parent) {\r\n\t\t\tutils.mixin(res, parent, true);\r\n\t\t}\r\n\t\treturn res;\r\n\t},\r\n\tnextSiblingTarget: function nextSiblingTarget(dndTaskId, targetTaskId, store) {\r\n\t\tvar result = this.createDropTargetObject();\r\n\t\tresult.targetId = targetTaskId;\r\n\t\tresult.nextSibling = true;\r\n\t\tresult.targetParent = store.getParent(result.targetId);\r\n\t\tresult.targetIndex = store.getBranchIndex(result.targetId);\r\n\t\tif(store.getParent(dndTaskId) != result.targetParent || result.targetIndex < store.getBranchIndex(dndTaskId)){\r\n\t\t\tresult.targetIndex += 1;\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\tprevSiblingTarget: function prevSiblingTarget(dndTaskId, targetTaskId, store) {\r\n\t\tvar result = this.createDropTargetObject();\r\n\t\tresult.targetId = targetTaskId;\r\n\t\tresult.prevSibling = true;\r\n\t\tresult.targetParent = store.getParent(result.targetId);\r\n\t\tresult.targetIndex = store.getBranchIndex(result.targetId);\r\n\t\tif(store.getParent(dndTaskId) == result.targetParent && result.targetIndex > store.getBranchIndex(dndTaskId)){\r\n\t\t\tresult.targetIndex -= 1;\r\n\t\t}\r\n\t\treturn result;\r\n\t},\r\n\tfirstChildTarget: function firstChildTarget(dndTaskId, targetTaskId, store) {\r\n\t\tvar result = this.createDropTargetObject();\r\n\t\tresult.targetId = targetTaskId;\r\n\t\tresult.targetParent = result.targetId;\r\n\t\tresult.targetIndex = 0;\r\n\t\tresult.child = true;\r\n\t\treturn result;\r\n\t},\r\n\tlastChildTarget: function lastChildTarget(dndTaskId, targetTaskId, store) {\r\n\t\tvar children = store.getChildren(targetTaskId);\r\n\t\tvar result = this.createDropTargetObject();\r\n\t\tresult.targetId = children[children.length - 1];\r\n\t\tresult.targetParent = targetTaskId;\r\n\t\tresult.targetIndex = children.length;\r\n\t\tresult.nextSibling = true;\r\n\t\treturn result;\r\n\t}\r\n};","/**\r\n * resolve dnd position of the task when gantt.config.order_branch_free = false\r\n */\r\n\r\nimport dropTarget from \"./drop_target\";\r\n\r\nfunction getLast(store){\r\n\tvar current = store.getNext();\r\n\twhile(store.exists(current)){\r\n\r\n\t\tvar next = store.getNext(current);\r\n\t\tif(!store.exists(next)){\r\n\t\t\treturn current;\r\n\t\t}else{\r\n\t\t\tcurrent = next;\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction findClosesTarget(dndTaskId, taskId, allowedLevel, store, up){\r\n\tvar prev = taskId;\r\n\twhile(store.exists(prev)){\r\n\t\tvar targetLevel = store.calculateItemLevel(store.getItem(prev));\r\n\t\tif((targetLevel === allowedLevel || targetLevel === (allowedLevel - 1)) && store.getBranchIndex(prev) > -1){\r\n\t\t\tbreak;\r\n\t\t}else {\r\n\t\t\tprev = up ? store.getPrev(prev) : store.getNext(prev);\r\n\t\t}\r\n\t}\r\n\r\n\tif(store.exists(prev)){\r\n\t\tif(store.calculateItemLevel(store.getItem(prev)) === allowedLevel){\r\n\t\t\treturn up ? dropTarget.nextSiblingTarget(dndTaskId, prev, store) : dropTarget.prevSiblingTarget(dndTaskId, prev, store);\r\n\t\t}else{\r\n\t\t\treturn dropTarget.firstChildTarget(dndTaskId, prev, store);\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction findTargetAbove(dndTaskId, taskId, allowedLevel, store){\r\n\treturn findClosesTarget(dndTaskId, taskId, allowedLevel, store, true);\r\n}\r\nfunction findTargetBelow(dndTaskId, taskId, allowedLevel, store){\r\n\treturn findClosesTarget(dndTaskId, taskId, allowedLevel, store, false);\r\n}\r\n\r\nexport default function getSameLevelDropPosition(dndTaskId, targetTaskId, relTargetPos, eventTop, store, level){\r\n\tvar result;\r\n\tif(targetTaskId !== store.$getRootId()){\r\n\t\tvar targetTask = store.getItem(targetTaskId);\r\n\t\tvar targetLevel = store.calculateItemLevel(targetTask);\r\n\t\tif(targetLevel === level){\r\n\t\t\tvar prevSibling = store.getPrevSibling(targetTaskId);\r\n\t\t\tif(relTargetPos < 0.5 && !prevSibling){\r\n\t\t\t\tresult = dropTarget.prevSiblingTarget(dndTaskId, targetTaskId, store);\r\n\t\t\t}else{\r\n\t\t\t\tif(relTargetPos < 0.5){\r\n\t\t\t\t\ttargetTaskId = prevSibling;\r\n\t\t\t\t}\r\n\t\t\t\tresult = dropTarget.nextSiblingTarget(dndTaskId, targetTaskId, store);\r\n\t\t\t}\r\n\t\t}else if(targetLevel > level){\r\n\t\t\tstore.eachParent(function(parent){\r\n\t\t\t\tif(store.calculateItemLevel(parent) === level){\r\n\t\t\t\t\ttargetTaskId = parent.id;\r\n\t\t\t\t}\r\n\t\t\t}, targetTask); \r\n\t\t\tresult = findTargetAbove(dndTaskId, targetTaskId, level, store);\r\n\t\t}else{\r\n\t\t\tvar targetAbove = findTargetAbove(dndTaskId, targetTaskId, level, store);\r\n\t\t\tvar targetBelow = findTargetBelow(dndTaskId, targetTaskId, level, store);\r\n\t\t\tresult = (relTargetPos < 0.5) ? targetAbove : targetBelow;\r\n\t\t}\r\n\t}else{\r\n\t\tvar rootId = store.$getRootId();\r\n\t\tvar rootLevel = store.getChildren(rootId);\r\n\t\tresult = dropTarget.createDropTargetObject();\r\n\t\tif(rootLevel.length && eventTop >= 0){\r\n\t\t\tresult = findTargetAbove(dndTaskId, getLast(store), level, store);\r\n\t\t}else{\r\n\t\t\tresult = findTargetBelow(dndTaskId, rootId, level, store);\r\n\t\t}\r\n\t}\r\n\r\n\treturn result;\r\n};\r\n","/**\r\n * resolve dnd position of the task when gantt.config.order_branch_free = true\r\n */\r\n\r\nimport dropTarget from \"./drop_target\";\r\n\r\nexport default function getMultiLevelDropPosition(dndTaskId, targetTaskId, relTargetPos, eventTop, store){\r\n\tvar result;\r\n\r\n\tif(targetTaskId !== store.$getRootId()){\r\n\t\tif(relTargetPos < 0.25){\r\n\t\t\tresult = dropTarget.prevSiblingTarget(dndTaskId, targetTaskId, store);\r\n\t\t}else if(relTargetPos > 0.60 && !(store.hasChild(targetTaskId) && store.getItem(targetTaskId).$open)){\r\n\t\t\tresult = dropTarget.nextSiblingTarget(dndTaskId, targetTaskId, store);\r\n\t\t}else {\r\n\t\t\tresult = dropTarget.firstChildTarget(dndTaskId, targetTaskId, store);\r\n\t\t}\r\n\t}else{\r\n\t\tvar rootId = store.$getRootId();\r\n\t\tif(store.hasChild(rootId) && eventTop >= 0){\r\n\t\t\tresult = dropTarget.lastChildTarget(dndTaskId, rootId, store);\r\n\t\t}else{\r\n\t\t\tresult = dropTarget.firstChildTarget(dndTaskId, rootId, store);\r\n\t\t}\r\n\t}\r\n\r\n\treturn result;\r\n};","import * as domHelpers from \"../../utils/dom_helpers\";\r\n\r\n/**\r\n * methods for highlighting current drag and drop position\r\n */\r\n\r\nfunction highlightPosition(target, root, grid){\r\n\tvar markerPos = getTaskMarkerPosition(target, grid);\r\n\t// setting position of row\r\n\troot.marker.style.left = markerPos.x + 9 + \"px\";\r\n\troot.marker.style.width = markerPos.width + \"px\";\r\n\troot.marker.style.overflow = \"hidden\";\r\n\tvar markerLine = root.markerLine;\r\n\tif(!markerLine){\r\n\t\tmarkerLine = document.createElement(\"div\");\r\n\t\tmarkerLine.className = \"gantt_drag_marker gantt_grid_dnd_marker\";\r\n\t\tmarkerLine.innerHTML = \"<div class='gantt_grid_dnd_marker_line'></div>\";\r\n\t\tmarkerLine.style.pointerEvents = \"none\";\r\n\t}\r\n\r\n\tif(target.child){\r\n\t\thighlightFolder(target, markerLine, grid);\r\n\t}else{\r\n\t\thighlightRow(target, markerLine, grid);\r\n\t}\r\n\r\n\tif(!root.markerLine){\r\n\t\tdocument.body.appendChild(markerLine);\r\n\t\troot.markerLine = markerLine;\r\n\t}\r\n}\r\n\r\nfunction removeLineHighlight(root){\r\n\tif(root.markerLine && root.markerLine.parentNode){\r\n\t\troot.markerLine.parentNode.removeChild(root.markerLine);\r\n\t}\r\n\troot.markerLine = null;\r\n}\r\n\r\nfunction highlightRow(target, markerLine, grid){\r\n\tvar linePos = getLineMarkerPosition(target, grid);\r\n\tvar maxBottom = grid.$grid_data.getBoundingClientRect().bottom + window.scrollY;\r\n\r\n\tmarkerLine.innerHTML = \"<div class='gantt_grid_dnd_marker_line'></div>\";\r\n\tmarkerLine.style.left = linePos.x + \"px\";\r\n\tmarkerLine.style.height = \"4px\";\r\n\r\n\tvar markerLineTop = linePos.y - 2;\r\n\tmarkerLine.style.top = markerLineTop + \"px\";\r\n\tmarkerLine.style.width = linePos.width + \"px\";\r\n\r\n\tif (markerLineTop > maxBottom) {\r\n\t\tmarkerLine.style.top = maxBottom + 'px';\r\n\t}\r\n\r\n\treturn markerLine;\r\n}\r\nfunction highlightFolder(target, markerFolder, grid){\r\n\tvar id = target.targetParent;\r\n\tvar pos = gridToPageCoordinates({x: 0, y: grid.getItemTop(id)}, grid);\r\n\tvar maxBottom = grid.$grid_data.getBoundingClientRect().bottom + window.scrollY;\r\n\r\n\tlet folderHighlightWidth = setWidthWithinContainer(grid.$gantt, grid.$grid_data.offsetWidth);\t\r\n\r\n\tmarkerFolder.innerHTML = \"<div class='gantt_grid_dnd_marker_folder'></div>\";\r\n\tmarkerFolder.style.width = folderHighlightWidth + \"px\";\r\n\tmarkerFolder.style.top = pos.y + \"px\";\r\n\tmarkerFolder.style.left = pos.x  + \"px\";\r\n\tmarkerFolder.style.height = grid.getItemHeight(id) + \"px\";\r\n\tif (pos.y > maxBottom) {\r\n\t\tmarkerFolder.style.top = maxBottom + 'px';\r\n\t}\r\n\r\n\treturn markerFolder;\r\n}\r\n\r\nfunction getLineMarkerPosition(target, grid){\r\n\tvar store = grid.$config.rowStore;\r\n\tvar pos = {x:0, y:0};\r\n\tvar indentNode = grid.$grid_data.querySelector(\".gantt_tree_indent\");\r\n\tvar indent = 15;\r\n\tvar level = 0;\r\n\tif(indentNode){\r\n\t\tindent = indentNode.offsetWidth;\r\n\t}\r\n\tvar iconWidth = 40;\r\n\tif(target.targetId !== store.$getRootId()){\r\n\t\tvar itemTop = grid.getItemTop(target.targetId);\r\n\t\tvar itemHeight = grid.getItemHeight(target.targetId);\r\n\t\tlevel = store.exists(target.targetId) ? store.calculateItemLevel(store.getItem(target.targetId)) : 0;\r\n\r\n\t\tif(target.prevSibling){\r\n\t\t\tpos.y = itemTop;\r\n\t\t}else if(target.nextSibling){\r\n\t\t\tvar childCount = 0;\r\n\t\t\tstore.eachItem(function(child){\r\n\t\t\t\tif(store.getIndexById(child.id) !== -1)\r\n\t\t\t\t\tchildCount++;\r\n\t\t\t}, target.targetId);\r\n\r\n\t\t\tpos.y = itemTop + itemHeight + childCount*itemHeight;\r\n\t\t}else {\r\n\t\t\tpos.y = itemTop + itemHeight;\r\n\t\t\tlevel += 1;\r\n\t\t}\r\n\t}\r\n\tpos.x = iconWidth + level * indent;\r\n\tpos.width = setWidthWithinContainer(grid.$gantt, Math.max(grid.$grid_data.offsetWidth - pos.x, 0), pos.x);\r\n\treturn gridToPageCoordinates(pos, grid);\r\n}\r\n\r\nfunction gridToPageCoordinates(pos, grid){\r\n\tvar gridPos = domHelpers.getNodePosition(grid.$grid_data);\r\n\tpos.x += gridPos.x + grid.$grid.scrollLeft;\r\n\tpos.y += gridPos.y - grid.$grid_data.scrollTop;\r\n\treturn pos;\r\n}\r\n\r\nfunction getTaskMarkerPosition(e, grid) {\r\n\tvar pos = domHelpers.getNodePosition(grid.$grid_data);\r\n\tvar ePos = domHelpers.getRelativeEventPosition(e, grid.$grid_data);\r\n\t// row offset\r\n\tvar x = pos.x + grid.$grid.scrollLeft;\r\n\tvar y = ePos.y - 10;\r\n\r\n\tvar rowHeight = grid.getItemHeight(e.targetId);\r\n\t// prevent moving row out of grid_data container\r\n\tif (y < pos.y) y = pos.y;\r\n\tvar gridHeight = grid.getTotalHeight();\r\n\tif (y > pos.y + gridHeight - rowHeight) y = pos.y + gridHeight - rowHeight;\r\n\r\n\tpos.x = x;\r\n\tpos.y = y;\r\n\tpos.width = setWidthWithinContainer(grid.$gantt, pos.width, 9);\r\n\treturn pos;\r\n}\r\n\r\nfunction setWidthWithinContainer(gantt, width, offset = 0){\r\n\tconst containerSize = domHelpers.getNodePosition(gantt.$root);\r\n\tif (width > containerSize.width){\r\n\t\twidth = containerSize.width - offset - 2;\r\n\t}\r\n\treturn width;\r\n}\r\n\r\nexport default {\r\n\tremoveLineHighlight: removeLineHighlight,\r\n\thighlightPosition: highlightPosition\r\n};\r\n","import * as domHelpers from \"../utils/dom_helpers\";\r\nimport dropTarget from \"./tasks_grid_dnd_marker_helpers/drop_target\";\r\nimport getLockedLevelTarget from \"./tasks_grid_dnd_marker_helpers/locked_level\";\r\nimport getMultiLevelTarget from \"./tasks_grid_dnd_marker_helpers/multi_level\";\r\nimport higlighter from \"./tasks_grid_dnd_marker_helpers/highlight\";\r\nimport isPlaceholderTask from \"../../../utils/placeholder_task\";\r\n\r\nfunction _init_dnd(gantt, grid) {\r\n\tvar DnD = gantt.$services.getService(\"dnd\");\r\n\r\n\tif(!grid.$config.bind || !gantt.getDatastore(grid.$config.bind)){\r\n\t\treturn;\r\n\t}\r\n\r\n\tfunction locate(e){\r\n\t\treturn domHelpers.locateAttribute(e, grid.$config.item_attribute);\r\n\t}\r\n\r\n\tfunction getStore(){\r\n\t\treturn gantt.getDatastore(grid.$config.bind);\r\n\t}\r\n\r\n\tfunction checkPlaceholderTask(id){\r\n\t\treturn isPlaceholderTask(id, gantt, getStore());\r\n\t}\r\n\r\n\tvar dnd = new DnD(grid.$grid_data, {updates_per_second: 60});\r\n\tif (gantt.defined(grid.$getConfig().dnd_sensitivity))\r\n\t\tdnd.config.sensitivity = grid.$getConfig().dnd_sensitivity;\r\n\r\n\tdnd.attachEvent(\"onBeforeDragStart\", gantt.bind(function (obj, e) {\r\n\t\tvar el = locate(e);\r\n\t\tif (!el) return false;\r\n\t\tif (gantt.hideQuickInfo) gantt.hideQuickInfo();\r\n\t\tif (domHelpers.closest(e.target, \".gantt_grid_editor_placeholder\")){\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar id = el.getAttribute(grid.$config.item_attribute);\r\n\t\tvar datastore = grid.$config.rowStore;\r\n\t\tvar task = datastore.getItem(id);\r\n\r\n\t\tif (gantt.isReadonly(task) || checkPlaceholderTask(id))\r\n\t\t\treturn false;\r\n\r\n\t\tdnd.config.initial_open_state = task.$open;\r\n\t\tif (!gantt.callEvent(\"onRowDragStart\", [id, e.target || e.srcElement, e])) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t}, gantt));\r\n\r\n\tdnd.attachEvent(\"onAfterDragStart\", gantt.bind(function (obj, e) {\r\n\t\tvar el = locate(e);\r\n\r\n\t\tdnd.config.marker.innerHTML = el.outerHTML;\r\n\t\tvar element = dnd.config.marker.firstChild;\r\n\t\tif(element){\r\n\t\t\tdnd.config.marker.style.opacity = 0.4;\r\n\t\t\telement.style.position = \"static\";\r\n\t\t\telement.style.pointerEvents = \"none\";\r\n\t\t}\r\n\r\n\t\tdnd.config.id = el.getAttribute(grid.$config.item_attribute);\r\n\r\n\t\tvar store = grid.$config.rowStore;\r\n\r\n\t\tvar task = store.getItem(dnd.config.id);\r\n\t\tdnd.config.level = store.calculateItemLevel(task);\r\n\t\tdnd.config.drop_target = dropTarget.createDropTargetObject({\r\n\t\t\ttargetParent: store.getParent(task.id),\r\n\t\t\ttargetIndex: store.getBranchIndex(task.id),\r\n\t\t\ttargetId: task.id,\r\n\t\t\tnextSibling: true\r\n\t\t});\r\n\r\n\t\ttask.$open = false;\r\n\t\ttask.$transparent = true;\r\n\t\tthis.refreshData();\r\n\t}, gantt));\r\n\r\n\tfunction getTargetTaskId(e){\r\n\t\tvar y = domHelpers.getRelativeEventPosition(e, grid.$grid_data).y;\r\n\t\tvar store = grid.$config.rowStore;\r\n\r\n\t\tif (!document.doctype){\r\n\t\t\ty += window.scrollY;\r\n\t\t}\r\n\t\ty = y || 0;\r\n\r\n\t\t// limits for the marker according to the layout layer\r\n\t\tvar scrollPos = grid.$state.scrollTop || 0;\r\n\t\tvar maxBottom = gantt.$grid_data.getBoundingClientRect().height + scrollPos + window.scrollY;\r\n\t\tvar minTop = scrollPos;\r\n\r\n\t\tvar firstVisibleTaskIndex = grid.getItemIndexByTopPosition(grid.$state.scrollTop);\r\n\t\tif (!store.exists(firstVisibleTaskIndex)){\r\n\t\t\tfirstVisibleTaskIndex = store.countVisible() - 1;\r\n\t\t}\r\n\t\tif (firstVisibleTaskIndex < 0) {\r\n\t\t\treturn store.$getRootId();\r\n\t\t}\r\n\r\n\t\tvar firstVisibleTaskId = store.getIdByIndex(firstVisibleTaskIndex);\r\n\r\n\t\tvar firstVisibleTaskPos = grid.$state.scrollTop / grid.getItemHeight(firstVisibleTaskId);\r\n\t\tvar hiddenTaskPart = firstVisibleTaskPos - Math.floor(firstVisibleTaskPos);\r\n\t\tif (hiddenTaskPart > 0.1 && hiddenTaskPart < 0.9) {\r\n\t\t\tmaxBottom = maxBottom - grid.getItemHeight(firstVisibleTaskId) * hiddenTaskPart;\r\n\t\t\tminTop = minTop + grid.getItemHeight(firstVisibleTaskId) * (1 - hiddenTaskPart);\r\n\t\t}\r\n\r\n\t\t// GS-715. The placeholder task row shouldn't be draggable below the Gantt container\r\n\t\tconst gridPosition = domHelpers.getNodePosition(grid.$grid_data);\r\n\t\tconst gridBottom = gridPosition.y + gridPosition.height;\r\n\t\tconst placeholderRowHeight = dnd.config.marker.offsetHeight;\r\n\t\tif (y + placeholderRowHeight + window.scrollY >= maxBottom){\r\n\t\t\tdnd.config.marker.style.top = gridBottom - placeholderRowHeight\t+ \"px\";\r\n\t\t}\r\n\r\n\t\tif (y >= maxBottom) {\r\n\t\t\ty = maxBottom;\r\n\t\t} else if (y <= minTop) {\r\n\t\t\ty = minTop;\r\n\t\t\tdnd.config.marker.style.top = gridPosition.y + \"px\";\r\n\t\t}\r\n\r\n\t\tvar index = grid.getItemIndexByTopPosition(y);\r\n\r\n\t\tif (index > store.countVisible() - 1 || index < 0) {\r\n\t\t\treturn store.$getRootId();\r\n\t\t}\r\n\r\n\t\tvar targetId = store.getIdByIndex(index);\r\n\t\tif (checkPlaceholderTask(targetId)) {\r\n\t\t\treturn store.getPrevSibling(targetId);\r\n\t\t}\r\n\r\n\t\treturn store.getIdByIndex(index);\r\n\t}\r\n\r\n\tfunction getDropPosition(e){\r\n\t\tvar targetTaskId = getTargetTaskId(e);\r\n\t\tvar relTargetPos = null;\r\n\t\tvar store = grid.$config.rowStore;\r\n\t\tvar config = grid.$getConfig();\r\n\t\tvar lockLevel = !config.order_branch_free;\r\n\r\n\t\tvar eventTop = domHelpers.getRelativeEventPosition(e, grid.$grid_data).y;\r\n\t\tif (!document.doctype){\r\n\t\t\teventTop += window.scrollY;\r\n\t\t}\r\n\r\n\t\tif(targetTaskId !== store.$getRootId()) {\r\n\t\t\tvar rowTop = grid.getItemTop(targetTaskId);\r\n\t\t\tvar rowHeight = grid.getItemHeight(targetTaskId);\r\n\t\t\trelTargetPos = (eventTop - rowTop) / rowHeight;\r\n\t\t}\r\n\r\n\t\tvar result;\r\n\t\tif(!lockLevel){\r\n\t\t\tresult = getMultiLevelTarget(dnd.config.id, targetTaskId, relTargetPos, eventTop, store);\r\n\t\t}else{\r\n\t\t\tresult = getLockedLevelTarget(dnd.config.id, targetTaskId, relTargetPos, eventTop, store, dnd.config.level);\r\n\t\t\tif(result && result.targetParent && checkPlaceholderTask(result.targetParent)){\r\n\t\t\t\ttargetTaskId = store.getPrevSibling(result.targetParent);\r\n\t\t\t\tresult = getLockedLevelTarget(dnd.config.id, targetTaskId, relTargetPos, eventTop, store, dnd.config.level);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tdnd.attachEvent(\"onDragMove\", gantt.bind(function (obj, e) {\r\n\t\tvar target = getDropPosition(e);\r\n\r\n\t\tif(!target ||\r\n\t\t\tgantt.callEvent(\"onBeforeRowDragMove\", [dnd.config.id, target.targetParent, target.targetIndex]) === false){\r\n\t\t\t\ttarget = dropTarget.createDropTargetObject(dnd.config.drop_target);\r\n\t\t\t}\r\n\r\n\t\thiglighter.highlightPosition(target, dnd.config, grid);\r\n\t\tdnd.config.drop_target = target;\r\n\t\tgantt._waiAria.reorderMarkerAttr(dnd.config.marker);\r\n\r\n\t\tthis.callEvent(\"onRowDragMove\", [dnd.config.id, target.targetParent, target.targetIndex]);\r\n\t\treturn true;\r\n\t}, gantt));\r\n\r\n\tdnd.attachEvent(\"onDragEnd\", gantt.bind(function () {\r\n\t\tvar store = grid.$config.rowStore;\r\n\t\tvar task = store.getItem(dnd.config.id);\r\n\r\n\t\thiglighter.removeLineHighlight(dnd.config);\r\n\r\n\t\ttask.$transparent = false;\r\n\t\ttask.$open = dnd.config.initial_open_state;\r\n\t\tvar target = dnd.config.drop_target;\r\n\r\n\t\tif (this.callEvent(\"onBeforeRowDragEnd\", [dnd.config.id, target.targetParent, target.targetIndex]) === false) {\r\n\t\t\ttask.$drop_target = null;\r\n\t\t} else {\r\n\t\t\tstore.move(dnd.config.id, target.targetIndex, target.targetParent);\r\n\t\t\tgantt.render();\r\n\t\t\tthis.callEvent(\"onRowDragEnd\", [dnd.config.id, target.targetParent, target.targetIndex]);\r\n\t\t}\r\n\t\tstore.refresh(task.id);\r\n\t}, gantt));\r\n}\r\n\r\nexport default {\r\n\tinit: _init_dnd\r\n};","import * as utils from \"../../../utils/utils\";\r\nimport rowDnd from \"./tasks_grid_dnd\";\r\nimport rowDndMarker from \"./tasks_grid_dnd_marker\";\r\nimport mouseEventContainer from \"../mouse_event_container\";\r\n\r\nvar initializer = (function(){\r\n\treturn function(gantt){\r\n\t\treturn {\r\n\t\t\tonCreated: function (grid) {\r\n\t\t\t\tgrid.$config = utils.mixin(grid.$config, {\r\n\t\t\t\t\tbind: \"task\"\r\n\t\t\t\t});\r\n\t\t\t\tif(grid.$config.id == \"grid\") {\r\n\t\t\t\t\tthis.extendGantt(grid);\r\n\t\t\t\t\tgantt.ext.inlineEditors = gantt.ext._inlineEditors.createEditors(grid);\r\n\t\t\t\t\tgantt.ext.inlineEditors.init();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._mouseDelegates = mouseEventContainer(gantt);\r\n\t\t\t},\r\n\t\t\tonInitialized: function (grid) {\r\n\t\t\t\tvar config = grid.$getConfig();\r\n\t\t\t\tif (config.order_branch) {\r\n\t\t\t\t\tif(config.order_branch == \"marker\"){\r\n\t\t\t\t\t\trowDndMarker.init(grid.$gantt, grid);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\trowDnd.init(grid.$gantt, grid);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.initEvents(grid, gantt);\r\n\t\t\t\tif(grid.$config.id == \"grid\") {\r\n\t\t\t\t\tthis.extendDom(grid);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonDestroyed: function (grid) {\r\n\t\t\t\tif(grid.$config.id == \"grid\") {\r\n\t\t\t\t\t// GS-1288. We need to only detach the store and its events without detaching the\r\n\t\t\t\t\t// inline editor's events. Otherwise, we won't be able to access them\r\n\t\t\t\t\tgantt.ext.inlineEditors.detachStore();\r\n\t\t\t\t}\r\n\t\t\t\tthis.clearEvents(grid, gantt);\r\n\t\t\t},\r\n\r\n\t\t\tinitEvents: function (grid, gantt) {\r\n\t\t\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_row\", gantt.bind(function (e, id, trg) {\r\n\t\t\t\t\tconst config = grid.$getConfig();\r\n\t\t\t\t\tif (id !== null) {\r\n\t\t\t\t\t\tconst task = this.getTask(id);\r\n\t\t\t\t\t\tif (config.scroll_on_click) {\r\n\t\t\t\t\t\t\tconst notOpenIcon = !gantt._is_icon_open_click(e);\r\n\t\t\t\t\t\t\tconst visibleTimeline = gantt.$ui.getView(\"timeline\");\r\n\t\t\t\t\t\t\t// don't need to scroll to the date when the timeline is not visible\r\n\t\t\t\t\t\t\t// or when we click on the open/close icon\r\n\t\t\t\t\t\t\tif (notOpenIcon && visibleTimeline){\r\n\t\t\t\t\t\t\t\tthis.showDate(task.start_date);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tgantt.callEvent(\"onTaskRowClick\", [id, trg]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, gantt), grid.$grid);\r\n\r\n\t\t\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_grid_head_cell\", gantt.bind(function (e, id, trg) {\r\n\t\t\t\t\tvar column = trg.getAttribute(\"data-column-id\");\r\n\r\n\t\t\t\t\tif (!gantt.callEvent(\"onGridHeaderClick\", [column, e]))\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tvar config = grid.$getConfig();\r\n\r\n\t\t\t\t\tif (column == \"add\") {\r\n\t\t\t\t\t\tvar mouseEvents = gantt.$services.getService(\"mouseEvents\");\r\n\t\t\t\t\t\tmouseEvents.callHandler(\"click\", \"gantt_add\", grid.$grid, [e, config.root_id]);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (config.sort && column) { // GS-929: if there is no column name, we cannot sort the column\r\n\t\t\t\t\t\tvar sorting_method = column,\r\n\t\t\t\t\t\t\tconf;\r\n\r\n\t\t\t\t\t\tfor (var i = 0; i < config.columns.length; i++) {\r\n\t\t\t\t\t\t\tif (config.columns[i].name == column) {\r\n\t\t\t\t\t\t\t\tconf = config.columns[i];\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (conf && conf.sort !== undefined && conf.sort !== true) {\r\n\t\t\t\t\t\t\tsorting_method = conf.sort;\r\n\r\n\t\t\t\t\t\t\tif (!sorting_method) { // column sort property 'false', no sorting\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar sort = (this._sort && this._sort.direction && this._sort.name == column) ? this._sort.direction : \"desc\";\r\n\t\t\t\t\t\t// invert sort direction\r\n\t\t\t\t\t\tsort = (sort == \"desc\") ? \"asc\" : \"desc\";\r\n\t\t\t\t\t\tthis._sort = {\r\n\t\t\t\t\t\t\tname: column,\r\n\t\t\t\t\t\t\tdirection: sort\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis.sort(sorting_method, sort == \"desc\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}, gantt), grid.$grid);\r\n\r\n\t\t\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_add\", gantt.bind(function (e, id, trg) {\r\n\t\t\t\t\tvar config = grid.$getConfig();\r\n\t\t\t\t\tif (config.readonly) return;\r\n\r\n\t\t\t\t\tvar item = {};\r\n\t\t\t\t\tthis.createTask(item, id ? id : gantt.config.root_id);\r\n\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}, gantt), grid.$grid);\r\n\r\n\t\t\t},\r\n\r\n\t\t\tclearEvents: function(grid, gantt){\r\n\t\t\t\tthis._mouseDelegates.destructor();\r\n\t\t\t\tthis._mouseDelegates = null;\r\n\t\t\t},\r\n\r\n\t\t\textendDom: function(grid){\r\n\t\t\t\tgantt.$grid = grid.$grid;\r\n\t\t\t\tgantt.$grid_scale = grid.$grid_scale;\r\n\t\t\t\tgantt.$grid_data = grid.$grid_data;\r\n\t\t\t},\r\n\t\t\textendGantt: function(grid){\r\n\t\t\t\tgantt.getGridColumns = gantt.bind(grid.getGridColumns, grid);\r\n\r\n\t\t\t\tgrid.attachEvent(\"onColumnResizeStart\", function(){\r\n\t\t\t\t\treturn gantt.callEvent(\"onColumnResizeStart\", arguments);\r\n\t\t\t\t});\r\n\t\t\t\tgrid.attachEvent(\"onColumnResize\", function(){\r\n\t\t\t\t\treturn gantt.callEvent(\"onColumnResize\", arguments);\r\n\t\t\t\t});\r\n\t\t\t\tgrid.attachEvent(\"onColumnResizeEnd\", function(){\r\n\t\t\t\t\treturn gantt.callEvent(\"onColumnResizeEnd\", arguments);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tgrid.attachEvent(\"onColumnResizeComplete\", function(columns, totalWidth){\r\n\t\t\t\t\tgantt.config.grid_width = totalWidth;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tgrid.attachEvent(\"onBeforeRowResize\", function(){\r\n\t\t\t\t\treturn gantt.callEvent(\"onBeforeRowResize\", arguments);\r\n\t\t\t\t});\r\n\t\t\t\tgrid.attachEvent(\"onRowResize\", function(){\r\n\t\t\t\t\treturn gantt.callEvent(\"onRowResize\", arguments);\r\n\t\t\t\t});\r\n\t\t\t\tgrid.attachEvent(\"onBeforeRowResizeEnd\", function(){\r\n\t\t\t\t\treturn gantt.callEvent(\"onBeforeRowResizeEnd\", arguments);\r\n\t\t\t\t});\r\n\t\t\t\tgrid.attachEvent(\"onAfterRowResize\", function(){\r\n\t\t\t\t\treturn gantt.callEvent(\"onAfterRowResize\", arguments);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n})();\r\n\r\nexport default initializer;","import * as domHelpers from \"../utils/dom_helpers\";\r\nimport * as utils from \"../../../utils/utils\";\r\nimport timeout from \"../../../utils/timeout\";\r\nimport * as helpers from \"../../../utils/helpers\";\r\n\r\nfunction createTaskDND(timeline, gantt) {\r\n\tvar services = gantt.$services;\r\n\treturn {\r\n\t\tdrag: null,\r\n\t\tdragMultiple: {},\r\n\t\t_events: {\r\n\t\t\tbefore_start: {},\r\n\t\t\tbefore_finish: {},\r\n\t\t\tafter_finish: {}\r\n\t\t},\r\n\t\t_handlers: {},\r\n\t\tinit: function() {\r\n\t\t\tthis._domEvents = gantt._createDomEventScope();\r\n\t\t\tthis.clear_drag_state();\r\n\t\t\tvar drag = gantt.config.drag_mode;\r\n\t\t\tthis.set_actions();\r\n\r\n\t\t\tvar stateService = services.getService(\"state\");\r\n\t\t\tstateService.registerProvider(\"tasksDnd\", utils.bind(function() {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdrag_id : this.drag ? this.drag.id : undefined,\r\n\t\t\t\t\tdrag_mode : this.drag ? this.drag.mode : undefined,\r\n\t\t\t\t\tdrag_from_start : this.drag ? this.drag.left : undefined\r\n\t\t\t\t};\r\n\t\t\t}, this));\r\n\r\n\t\t\tvar evs = {\r\n\t\t\t\t\"before_start\": \"onBeforeTaskDrag\",\r\n\t\t\t\t\"before_finish\": \"onBeforeTaskChanged\",\r\n\t\t\t\t\"after_finish\": \"onAfterTaskDrag\"\r\n\t\t\t};\r\n\t\t\t//for now, all drag operations will trigger the same events\r\n\t\t\tfor (var stage in this._events) {\r\n\t\t\t\tfor (var mode in drag) {\r\n\t\t\t\t\tthis._events[stage][mode] = evs[stage];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._handlers[drag.move] = this._move;\r\n\t\t\tthis._handlers[drag.resize] = this._resize;\r\n\t\t\tthis._handlers[drag.progress] = this._resize_progress;\r\n\t\t},\r\n\t\tset_actions: function() {\r\n\t\t\tvar data = timeline.$task_data;\r\n\t\t\tthis._domEvents.attach(data, \"mousemove\", gantt.bind(function(e) {\r\n\t\t\t\tthis.on_mouse_move(e);\r\n\t\t\t}, this));\r\n\t\t\tthis._domEvents.attach(data, \"mousedown\", gantt.bind(function(e) {\r\n\t\t\t\tthis.on_mouse_down(e);\r\n\t\t\t}, this));\r\n\t\t\tthis._domEvents.attach(document.body, \"mouseup\", gantt.bind(function(e) {\r\n\t\t\t\tthis.on_mouse_up(e);\r\n\t\t\t}, this));\r\n\t\t},\r\n\r\n\t\tclear_drag_state: function() {\r\n\t\t\tthis.drag = {\r\n\t\t\t\tid: null,\r\n\t\t\t\tmode: null,\r\n\t\t\t\tpos: null,\r\n\t\t\t\tstart_x: null,\r\n\t\t\t\tstart_y: null,\r\n\t\t\t\tobj: null,\r\n\t\t\t\tleft: null\r\n\t\t\t};\r\n\t\t\tthis.dragMultiple = {};\r\n\t\t},\r\n\t\t_resize: function(task, shift, drag) {\r\n\t\t\tvar cfg = timeline.$getConfig();\r\n\t\t\tvar coords_x = this._drag_task_coords(task, drag);\r\n\t\t\tif (drag.left) {\r\n\t\t\t\ttask.start_date = gantt.dateFromPos(coords_x.start + shift);\r\n\t\t\t\tif (!task.start_date) {\r\n\t\t\t\t\ttask.start_date = new Date(gantt.getState().min_date);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\ttask.end_date = gantt.dateFromPos(coords_x.end + shift);\r\n\t\t\t\tif (!task.end_date) {\r\n\t\t\t\t\ttask.end_date = new Date(gantt.getState().max_date);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar minDurationInUnits = this._calculateMinDuration(cfg.min_duration, cfg.duration_unit);\r\n\t\t\tif (task.end_date - task.start_date < cfg.min_duration) {\r\n\t\t\t\tif (drag.left)\r\n\t\t\t\t\ttask.start_date = gantt.calculateEndDate(task.end_date, -minDurationInUnits, cfg.duration_unit, task);\r\n\t\t\t\telse\r\n\t\t\t\t\ttask.end_date = gantt.calculateEndDate(task.start_date, minDurationInUnits, cfg.duration_unit, task);\r\n\t\t\t}\r\n\t\t\tgantt._init_task_timing(task);\r\n\t\t},\r\n\t\t_calculateMinDuration: function(duration, unit) {\r\n\t\t\tvar inMs = {\r\n\t\t\t\t\"minute\": 60000,\r\n\t\t\t\t\"hour\": 3600000,\r\n\t\t\t\t\"day\": 86400000,\r\n\t\t\t\t\"week\": 604800000,\r\n\t\t\t\t\"month\": 2419200000,\r\n\t\t\t\t\"year\": 31356000000\r\n\t\t\t};\r\n\t\t\treturn Math.ceil(duration / inMs[unit]);\r\n\t\t},\r\n\t\t_resize_progress: function(task, shift, drag) {\r\n\t\t\tvar coords_x = this._drag_task_coords(task, drag);\r\n\r\n\t\t\tvar config = timeline.$getConfig();\r\n\t\t\tvar diffValue = !config.rtl ? (drag.pos.x - coords_x.start) : (coords_x.start - drag.pos.x);\r\n\r\n\t\t\tvar diff = Math.max(0, diffValue);\r\n\t\t\ttask.progress = Math.min(1, diff / Math.abs(coords_x.end - coords_x.start));\r\n\t\t},\r\n\t\t_find_max_shift: function(dragItems, shift) {\r\n\t\t\tvar correctShift;\r\n\t\t\tfor (var i in dragItems) {\r\n\t\t\t\tvar drag = dragItems[i];\r\n\t\t\t\tvar task = gantt.getTask(drag.id);\r\n\r\n\t\t\t\tvar coords_x = this._drag_task_coords(task, drag);\r\n\t\t\t\tvar minX = gantt.posFromDate(new Date(gantt.getState().min_date));\r\n\t\t\t\tvar maxX = gantt.posFromDate(new Date(gantt.getState().max_date));\r\n\r\n\t\t\t\tif (coords_x.end + shift > maxX) {\r\n\t\t\t\t\tvar maxShift = maxX - coords_x.end;\r\n\t\t\t\t\tif (maxShift < correctShift || correctShift === undefined) {\r\n\t\t\t\t\t\tcorrectShift = maxShift;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (coords_x.start + shift < minX) {\r\n\t\t\t\t\tvar minShift = minX - coords_x.start;\r\n\t\t\t\t\tif (minShift > correctShift || correctShift === undefined) {\r\n\t\t\t\t\t\tcorrectShift = minShift;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn correctShift;\r\n\t\t},\r\n\t\t_move: function(task, shift, drag, multipleDragShift) {\r\n\t\t\tvar coords_x = this._drag_task_coords(task, drag);\r\n\t\t\tvar new_start = null,\r\n\t\t\tnew_end = null;\r\n\t\t\t// GS-454: If we drag multiple tasks, rely on the dates instead of timeline coordinates\r\n\t\t\tif (multipleDragShift){\r\n\t\t\t\tnew_start = new Date(+drag.obj.start_date + multipleDragShift),\r\n\t\t\t\tnew_end = new Date(+drag.obj.end_date + multipleDragShift);\r\n\t\t\t} else {\r\n\t\t\t\tnew_start = gantt.dateFromPos(coords_x.start + shift),\r\n\t\t\t\tnew_end = gantt.dateFromPos(coords_x.end + shift);\r\n\t\t\t}\r\n\t\t\tif (!new_start) {\r\n\t\t\t\ttask.start_date = new Date(gantt.getState().min_date);\r\n\t\t\t\ttask.end_date = gantt.dateFromPos(gantt.posFromDate(task.start_date) + (coords_x.end - coords_x.start));\r\n\t\t\t} else if (!new_end) {\r\n\t\t\t\ttask.end_date = new Date(gantt.getState().max_date);\r\n\t\t\t\ttask.start_date = gantt.dateFromPos(gantt.posFromDate(task.end_date) - (coords_x.end - coords_x.start));\r\n\t\t\t} else {\r\n\t\t\t\ttask.start_date = new_start;\r\n\t\t\t\ttask.end_date = new_end;\r\n\t\t\t}\r\n\t\t},\r\n\t\t_drag_task_coords: function(t, drag) {\r\n\t\t\tvar start = drag.obj_s_x = drag.obj_s_x || gantt.posFromDate(t.start_date);\r\n\t\t\tvar end = drag.obj_e_x = drag.obj_e_x || gantt.posFromDate(t.end_date);\r\n\t\t\treturn {\r\n\t\t\t\tstart: start,\r\n\t\t\t\tend: end\r\n\t\t\t};\r\n\t\t},\r\n\t\t_mouse_position_change: function(oldPos, newPos) {\r\n\t\t\tvar dx = oldPos.x - newPos.x,\r\n\t\t\t\tdy = oldPos.y - newPos.y;\r\n\t\t\treturn Math.sqrt(dx * dx + dy * dy);\r\n\t\t},\r\n\t\t_is_number: function(n) {\r\n\t\t\treturn !isNaN(parseFloat(n)) && isFinite(n);\r\n\t\t},\r\n\r\n\t\ton_mouse_move: function(e) {\r\n\t\t\tif (this.drag.start_drag) {\r\n\t\t\t\tvar pos = domHelpers.getRelativeEventPosition(e, gantt.$task_data);\r\n\r\n\t\t\t\tvar sX = this.drag.start_drag.start_x,\r\n\t\t\t\t\tsY = this.drag.start_drag.start_y;\r\n\r\n\t\t\t\tif ((Date.now() - this.drag.timestamp > 50) ||\r\n\t\t\t\t\t(this._is_number(sX) && this._is_number(sY) && this._mouse_position_change({\r\n\t\t\t\t\t\tx: sX,\r\n\t\t\t\t\t\ty: sY\r\n\t\t\t\t\t}, pos) > 20)) {\r\n\t\t\t\t\tthis._start_dnd(e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar drag = this.drag;\r\n\r\n\t\t\tif (drag.mode) {\r\n\t\t\t\tif (!timeout(this, 40))//limit update frequency\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tthis._update_on_move(e);\r\n\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_update_item_on_move: function(shift, id, mode, drag, e, multipleDragShift) {\r\n\t\t\tvar task = gantt.getTask(id);\r\n\t\t\tvar original = gantt.mixin({}, task);\r\n\t\t\tvar copy = gantt.mixin({}, task);\r\n\t\t\tthis._handlers[mode].apply(this, [copy, shift, drag, multipleDragShift]);\r\n\t\t\tgantt.mixin(task, copy, true);\r\n\t\t\t//gantt._update_parents(drag.id, true);\r\n\t\t\tgantt.callEvent(\"onTaskDrag\", [task.id, mode, copy, original, e]);\r\n\t\t\tgantt.mixin(task, copy, true);\r\n\t\t\tgantt.refreshTask(id);\r\n\t\t},\r\n\r\n\t\t_update_on_move: function(e) {\r\n\t\t\tvar drag = this.drag;\r\n\t\t\tvar config = timeline.$getConfig();\r\n\t\t\tif (drag.mode) {\r\n\t\t\t\tvar pos = domHelpers.getRelativeEventPosition(e, timeline.$task_data);\r\n\t\t\t\tif (drag.pos && drag.pos.x == pos.x)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tdrag.pos = pos;\r\n\r\n\t\t\t\tvar curr_date = gantt.dateFromPos(pos.x);\r\n\t\t\t\tif (!curr_date || isNaN(curr_date.getTime()))\r\n\t\t\t\t\treturn;\r\n\r\n\r\n\t\t\t\tvar shift = pos.x - drag.start_x;\r\n\t\t\t\tvar task = gantt.getTask(drag.id);\r\n\t\t\t\tif (this._handlers[drag.mode]) {\r\n\t\t\t\t\tif (drag.mode === config.drag_mode.move) {\r\n\t\t\t\t\t\tvar dragHash = {};\r\n\r\n\t\t\t\t\t\tif (this._isMultiselect()) {\r\n\t\t\t\t\t\t\tvar selectedTasksIds = gantt.getSelectedTasks();\r\n\t\t\t\t\t\t\tif (selectedTasksIds.indexOf(drag.id) >= 0) {\r\n\t\t\t\t\t\t\t\tdragHash = this.dragMultiple;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar dragProject = false;\r\n\t\t\t\t\t\tif (gantt.isSummaryTask(task) && gantt.config.drag_project) {\r\n\t\t\t\t\t\t\tvar initialDrag = {};\r\n\t\t\t\t\t\t\tinitialDrag[drag.id] = utils.copy(drag);\r\n\t\t\t\t\t\t\tdragProject = true;\r\n\t\t\t\t\t\t\tdragHash = utils.mixin(initialDrag, this.dragMultiple);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar maxShift = this._find_max_shift(dragHash, shift);\r\n\t\t\t\t\t\tif (maxShift !== undefined) {\r\n\t\t\t\t\t\t\tshift = maxShift;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis._update_item_on_move(shift, drag.id, drag.mode, drag, e);\r\n\r\n\t\t\t\t\t\tlet multipleDragShift;\r\n\t\t\t\t\t\tif (maxShift === undefined) {\r\n\t\t\t\t\t\t\t// GS-2593. If the timeline is repainted during the drag (infinite scale scenario)\r\n\t\t\t\t\t\t\t// we need to update the initial drag position to correctly update\r\n\t\t\t\t\t\t\t// the position of other dragged tasks\r\n\t\t\t\t\t\t\tconst newStartPos = gantt.posFromDate(drag.obj.start_date);\r\n\t\t\t\t\t\t\tconst newEndPos = gantt.posFromDate(drag.obj.end_date);\r\n\t\t\t\t\t\t\t// calculate the offset only when the drag started\r\n\t\t\t\t\t\t\tif (drag.handle_offset === undefined){\r\n\t\t\t\t\t\t\t\tconst width = newEndPos - newStartPos;\r\n\t\t\t\t\t\t\t\tconst dragPos = drag.start_x - newStartPos;\r\n\t\t\t\t\t\t\t\tdrag.handle_offset = dragPos / width;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconst newWidth = Math.abs(newEndPos - newStartPos);\r\n\t\t\t\t\t\t\tlet dragX = newStartPos + newWidth * drag.handle_offset;\r\n\r\n\t\t\t\t\t\t\t// GS-454: Calculate the date shift in milliseconds instead of pixels\r\n\t\t\t\t\t\t\tconst shiftDate = gantt.dateFromPos(dragX);\r\n\t\t\t\t\t\t\tmultipleDragShift = curr_date - shiftDate;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor (var i in dragHash) {\r\n\t\t\t\t\t\t\tvar childDrag = dragHash[i];\r\n\t\t\t\t\t\t\tif(dragProject && childDrag.id != drag.id){\r\n\t\t\t\t\t\t\t\tgantt._bulk_dnd = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis._update_item_on_move(shift, childDrag.id, childDrag.mode, childDrag, e, multipleDragShift);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tgantt._bulk_dnd = false;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// for resize and progress\r\n\t\t\t\t\t\tthis._update_item_on_move(shift, drag.id, drag.mode, drag, e);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgantt._update_parents(drag.id);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\ton_mouse_down: function(e, src) {\r\n\t\t\t// on Mac we do not get onmouseup event when clicking right mouse button leaving us in dnd state\r\n\t\t\t// let's ignore right mouse button then\r\n\t\t\tif (e.button == 2 && e.button !== undefined)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tvar config = timeline.$getConfig();\r\n\t\t\tvar id = gantt.locate(e);\r\n\t\t\tvar task = null;\r\n\t\t\tif (gantt.isTaskExists(id)) {\r\n\t\t\t\ttask = gantt.getTask(id);\r\n\t\t\t}\r\n\r\n\t\t\tif (gantt.isReadonly(task) || this.drag.mode) return;\r\n\r\n\t\t\tthis.clear_drag_state();\r\n\r\n\t\t\tsrc = src || (e.target || e.srcElement);\r\n\r\n\t\t\tvar className = domHelpers.getClassName(src);\r\n\t\t\tvar drag = this._get_drag_mode(className, src);\r\n\r\n\t\t\tif (!className || !drag) {\r\n\t\t\t\tif (src.parentNode)\r\n\t\t\t\t\treturn this.on_mouse_down(e, src.parentNode);\r\n\t\t\t\telse\r\n\t\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (!drag) {\r\n\t\t\t\tif (gantt.checkEvent(\"onMouseDown\") && gantt.callEvent(\"onMouseDown\", [className.split(\" \")[0]])) {\r\n\t\t\t\t\tif (src.parentNode)\r\n\t\t\t\t\t\treturn this.on_mouse_down(e, src.parentNode);\r\n\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (drag.mode && drag.mode != config.drag_mode.ignore && config[\"drag_\" + drag.mode]) {\r\n\t\t\t\t\tid = gantt.locate(src);\r\n\t\t\t\t\ttask = gantt.copy(gantt.getTask(id) || {});\r\n\r\n\t\t\t\t\tif (gantt.isReadonly(task)) {\r\n\t\t\t\t\t\tthis.clear_drag_state();\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ((gantt.isSummaryTask(task) && !(task.auto_scheduling === false) && !config.drag_project) && drag.mode != config.drag_mode.progress) {//only progress drag is allowed for tasks with flexible duration\r\n\t\t\t\t\t\tthis.clear_drag_state();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdrag.id = id;\r\n\t\t\t\t\tvar pos = domHelpers.getRelativeEventPosition(e, gantt.$task_data);\r\n\r\n\t\t\t\t\tdrag.start_x = pos.x;\r\n\t\t\t\t\tdrag.start_y = pos.y;\r\n\t\t\t\t\tdrag.obj = task;\r\n\t\t\t\t\tthis.drag.start_drag = drag;\r\n\t\t\t\t\tthis.drag.timestamp = Date.now();\r\n\r\n\t\t\t\t} else\r\n\t\t\t\t\tthis.clear_drag_state();\r\n\t\t\t}\r\n\t\t},\r\n\t\t_fix_dnd_scale_time: function(task, drag) {\r\n\t\t\tvar config = timeline.$getConfig();\r\n\t\t\tvar unit = gantt.getScale().unit,\r\n\t\t\t\tstep = gantt.getScale().step;\r\n\t\t\tif (!config.round_dnd_dates) {\r\n\t\t\t\tunit = 'minute';\r\n\t\t\t\tstep = config.time_step;\r\n\t\t\t}\r\n\r\n\t\t\tfunction fixStart(task) {\r\n\t\t\t\tif (!gantt.config.correct_work_time)\r\n\t\t\t\t\treturn;\r\n\t\t\t\tvar config = timeline.$getConfig();\r\n\t\t\t\tif (!gantt.isWorkTime(task.start_date, undefined, task))\r\n\t\t\t\t\ttask.start_date = gantt.calculateEndDate({\r\n\t\t\t\t\t\tstart_date: task.start_date,\r\n\t\t\t\t\t\tduration: -1,\r\n\t\t\t\t\t\tunit: config.duration_unit,\r\n\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfunction fixEnd(task) {\r\n\t\t\t\tif (!gantt.config.correct_work_time)\r\n\t\t\t\t\treturn;\r\n\t\t\t\tvar config = timeline.$getConfig();\r\n\t\t\t\tif (!gantt.isWorkTime(new Date(task.end_date - 1), undefined, task))\r\n\t\t\t\t\ttask.end_date = gantt.calculateEndDate({\r\n\t\t\t\t\t\tstart_date: task.end_date,\r\n\t\t\t\t\t\tduration: 1,\r\n\t\t\t\t\t\tunit: config.duration_unit,\r\n\t\t\t\t\t\ttask: task\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (drag.mode == config.drag_mode.resize) {\r\n\t\t\t\tif (drag.left) {\r\n\t\t\t\t\ttask.start_date = gantt.roundDate({date: task.start_date, unit: unit, step: step});\r\n\t\t\t\t\tfixStart(task);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttask.end_date = gantt.roundDate({date: task.end_date, unit: unit, step: step});\r\n\t\t\t\t\tfixEnd(task);\r\n\t\t\t\t}\r\n\t\t\t} else if (drag.mode == config.drag_mode.move) {\r\n\t\t\t\ttask.start_date = gantt.roundDate({date: task.start_date, unit: unit, step: step});\r\n\t\t\t\tfixStart(task);\r\n\t\t\t\ttask.end_date = gantt.calculateEndDate(task);\r\n\t\t\t}\r\n\t\t},\r\n\t\t_fix_working_times: function(task, drag) {\r\n\t\t\tvar config = timeline.$getConfig();\r\n\t\t\tvar drag = drag || {mode: config.drag_mode.move};\r\n\r\n\t\t\tif (drag.mode == config.drag_mode.resize) {\r\n\t\t\t\tif (drag.left) {\r\n\t\t\t\t\ttask.start_date = gantt.getClosestWorkTime({date: task.start_date, dir: 'future', task: task});\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttask.end_date = gantt.getClosestWorkTime({date: task.end_date, dir: 'past', task: task});\r\n\t\t\t\t}\r\n\t\t\t} else if (drag.mode == config.drag_mode.move) {\r\n\t\t\t\tgantt.correctTaskWorkTime(task);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_finalize_mouse_up: function(taskId, config, drag, e) {\r\n\t\t\tvar task = gantt.getTask(taskId);\r\n\r\n\t\t\tif (config.work_time && config.correct_work_time) {\r\n\t\t\t\tthis._fix_working_times(task, drag);\r\n\t\t\t}\r\n\r\n\t\t\tthis._fix_dnd_scale_time(task, drag);\r\n\r\n\t\t\tif (!this._fireEvent(\"before_finish\", drag.mode, [taskId, drag.mode, gantt.copy(drag.obj), e])) {\r\n\t\t\t\t//drag.obj._dhx_changed = false;\r\n\t\t\t\tthis.clear_drag_state();\r\n\t\t\t\tif (taskId == drag.id) {\r\n\t\t\t\t\tdrag.obj._dhx_changed = false;\r\n\t\t\t\t\tgantt.mixin(task, drag.obj, true);\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tgantt.refreshTask(task.id);\r\n\t\t\t} else {\r\n\t\t\t\tvar drag_id = taskId;\r\n\r\n\t\t\t\tgantt._init_task_timing(task);\r\n\r\n\t\t\t\tthis.clear_drag_state();\r\n\t\t\t\tgantt.updateTask(task.id);\r\n\t\t\t\tthis._fireEvent(\"after_finish\", drag.mode, [drag_id, drag.mode, e]);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\ton_mouse_up: function(e) {\r\n\r\n\t\t\tvar drag = this.drag;\r\n\t\t\tif (drag.mode && drag.id) {\r\n\t\t\t\tvar config = timeline.$getConfig();\r\n\t\t\t\t//drop\r\n\t\t\t\tvar task = gantt.getTask(drag.id);\r\n\t\t\t\tvar dragMultiple = this.dragMultiple;\r\n\r\n\t\t\t\tvar finalizingBulkMove = false;\r\n\t\t\t\tvar moveCount = 0;\r\n\t\t\t\tif (drag.mode === config.drag_mode.move) {\r\n\t\t\t\t\tif ((gantt.isSummaryTask(task) && config.drag_project) || (this._isMultiselect())) {\r\n\t\t\t\t\t\tfinalizingBulkMove = true;\r\n\t\t\t\t\t\tmoveCount = Object.keys(dragMultiple).length;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar doFinalize = function doFinalize(){\r\n\t\t\t\t\tif(finalizingBulkMove){\r\n\t\t\t\t\t\tfor (var i in dragMultiple) {\r\n\t\t\t\t\t\t\t// GS-1057: Don't call drag events for the dragged task as they will be called later\r\n\t\t\t\t\t\t\tif (dragMultiple[i].id != drag.id){\r\n\t\t\t\t\t\t\t\tthis._finalize_mouse_up(dragMultiple[i].id, config, dragMultiple[i], e);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._finalize_mouse_up(drag.id, config, drag, e);\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(finalizingBulkMove && moveCount > 10){// 10 - arbitrary threshold for bulk dnd at which we start doing complete repaint to refresh\r\n\t\t\t\t\tgantt.batchUpdate(function(){\r\n\t\t\t\t\t\tdoFinalize.call(this);\r\n\t\t\t\t\t}.bind(this));\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdoFinalize.call(this);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\tthis.clear_drag_state();\r\n\t\t},\r\n\t\t_get_drag_mode: function(className, el) {\r\n\t\t\tvar config = timeline.$getConfig();\r\n\t\t\tvar modes = config.drag_mode;\r\n\t\t\tvar classes = (className || \"\").split(\" \");\r\n\t\t\tvar classname = classes[0];\r\n\t\t\tvar drag = {mode: null, left: null};\r\n\t\t\tswitch (classname) {\r\n\t\t\t\tcase \"gantt_task_line\":\r\n\t\t\t\tcase \"gantt_task_content\":\r\n\t\t\t\t\tdrag.mode = modes.move;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"gantt_task_drag\":\r\n\t\t\t\t\tdrag.mode = modes.resize;\r\n\r\n\t\t\t\t\tvar dragProperty = el.getAttribute(\"data-bind-property\");\r\n\r\n\t\t\t\t\tif (dragProperty == \"start_date\") {\r\n\t\t\t\t\t\tdrag.left = true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdrag.left = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"gantt_task_progress_drag\":\r\n\t\t\t\t\tdrag.mode = modes.progress;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"gantt_link_control\":\r\n\t\t\t\tcase \"gantt_link_point\":\r\n\t\t\t\t\tdrag.mode = modes.ignore;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tdrag = null;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\treturn drag;\r\n\r\n\t\t},\r\n\r\n\t\t_start_dnd: function(e) {\r\n\t\t\tvar drag = this.drag = this.drag.start_drag;\r\n\t\t\tdelete drag.start_drag;\r\n\r\n\t\t\tvar cfg = timeline.$getConfig();\r\n\t\t\tvar id = drag.id;\r\n\r\n\t\t\tif (!cfg[\"drag_\" + drag.mode] || !gantt.callEvent(\"onBeforeDrag\", [id, drag.mode, e]) || !this._fireEvent(\"before_start\", drag.mode, [id, drag.mode, e])) {\r\n\t\t\t\tthis.clear_drag_state();\r\n\t\t\t} else {\r\n\t\t\t\tdelete drag.start_drag;\r\n\t\t\t\tvar task = gantt.getTask(id);\r\n\t\t\t\tif (gantt.isReadonly(task)){\r\n\t\t\t\t\tthis.clear_drag_state();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (this._isMultiselect()) {\r\n\t\t\t\t\t// for don't move selected tasks when drag unselected task\r\n\t\t\t\t\tvar selectedTasksIds = gantt.getSelectedTasks();\r\n\t\t\t\t\tif (selectedTasksIds.indexOf(drag.id) >= 0) {\r\n\t\t\t\t\t\thelpers.forEach(selectedTasksIds, gantt.bind(function(taskId) {\r\n\t\t\t\t\t\t\tvar selectedTask = gantt.getTask(taskId);\r\n\t\t\t\t\t\t\tif (gantt.isSummaryTask(selectedTask) && gantt.config.drag_project && drag.mode == cfg.drag_mode.move) {\r\n\t\t\t\t\t\t\t\tthis._addSubtasksToDragMultiple(selectedTask.id);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis.dragMultiple[taskId] = gantt.mixin({\r\n\t\t\t\t\t\t\t\tid: selectedTask.id,\r\n\t\t\t\t\t\t\t\tobj: gantt.copy(selectedTask)\r\n\t\t\t\t\t\t\t}, this.drag);\r\n\t\t\t\t\t\t}, this));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// for move unselected summary\r\n\t\t\t\tif (gantt.isSummaryTask(task) && gantt.config.drag_project && drag.mode == cfg.drag_mode.move) {\r\n\t\t\t\t\tthis._addSubtasksToDragMultiple(task.id);\r\n\t\t\t\t}\r\n\t\t\t\tgantt.callEvent(\"onTaskDragStart\", []);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\t_fireEvent: function(stage, mode, params) {\r\n\t\t\tgantt.assert(this._events[stage], \"Invalid stage:{\" + stage + \"}\");\r\n\r\n\t\t\tvar trigger = this._events[stage][mode];\r\n\r\n\t\t\tgantt.assert(trigger, \"Unknown after drop mode:{\" + mode + \"}\");\r\n\t\t\tgantt.assert(params, \"Invalid event arguments\");\r\n\r\n\r\n\t\t\tif (!gantt.checkEvent(trigger))\r\n\t\t\t\treturn true;\r\n\r\n\t\t\treturn gantt.callEvent(trigger, params);\r\n\t\t},\r\n\r\n\t\tround_task_dates: function(task) {\r\n\t\t\tvar drag_state = this.drag;\r\n\t\t\tvar config = timeline.$getConfig();\r\n\t\t\tif (!drag_state) {\r\n\t\t\t\tdrag_state = {mode: config.drag_mode.move};\r\n\t\t\t}\r\n\t\t\tthis._fix_dnd_scale_time(task, drag_state);\r\n\t\t},\r\n\t\tdestructor: function() {\r\n\t\t\tthis._domEvents.detachAll();\r\n\t\t},\r\n\t\t_isMultiselect: function() {\r\n\t\t\treturn gantt.config.drag_multiple && !!(gantt.getSelectedTasks && gantt.getSelectedTasks().length > 0);\r\n\t\t},\r\n\t\t_addSubtasksToDragMultiple: function(summaryId) {\r\n\t\t\tgantt.eachTask(function(child) {\r\n\t\t\t\tthis.dragMultiple[child.id] = gantt.mixin({\r\n\t\t\t\t\tid: child.id,\r\n\t\t\t\t\tobj: gantt.copy(child)\r\n\t\t\t\t}, this.drag);\r\n\t\t\t}, summaryId, this);\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction initTaskDND() {\r\n\tvar _tasks_dnd;\r\n\treturn {\r\n\t\textend: function(timeline) {\r\n\t\t\ttimeline.roundTaskDates = function(task) {\r\n\t\t\t\t_tasks_dnd.round_task_dates(task);\r\n\t\t\t};\r\n\r\n\t\t},\r\n\t\tinit: function(timeline, gantt) {\r\n\t\t\t_tasks_dnd = createTaskDND(timeline, gantt);\r\n\t\t\t// TODO: entry point for touch handlers, move touch to timeline\r\n\t\t\ttimeline._tasks_dnd = _tasks_dnd;\r\n\t\t\treturn _tasks_dnd.init(gantt);\r\n\t\t},\r\n\t\tdestructor: function() {\r\n\t\t\tif (_tasks_dnd) {\r\n\t\t\t\t_tasks_dnd.destructor();\r\n\t\t\t\t_tasks_dnd = null;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default {\r\n\tcreateTaskDND: initTaskDND\r\n};","import * as domHelpers from \"../utils/dom_helpers\";\r\n\r\nvar initLinksDND = function(timeline, gantt) {\r\n\tvar _link_landing,\r\n\t\t_link_target_task,\r\n\t\t_link_target_task_start,\r\n\t\t_link_source_task,\r\n\t\t_link_source_task_start,\r\n\t\tmarkerDefaultOffset = 10,\r\n\t\tscrollDefaultSize = 18;\r\n\r\n\tfunction getDndState(){\r\n\t\treturn {\r\n\t\t\tlink_source_id : _link_source_task,\r\n\t\t\tlink_target_id : _link_target_task,\r\n\t\t\tlink_from_start : _link_source_task_start,\r\n\t\t\tlink_to_start : _link_target_task_start,\r\n\t\t\tlink_landing_area : _link_landing\r\n\t\t};\r\n\t}\r\n\r\n\tvar services = gantt.$services;\r\n\r\n\tvar state = services.getService(\"state\");\r\n\tvar DnD = services.getService(\"dnd\");\r\n\r\n\tstate.registerProvider(\"linksDnD\", getDndState);\r\n\r\n\tvar start_marker = \"task_start_date\",\r\n\t\tend_marker = \"task_end_date\",\r\n\t\tlink_edge_marker = \"gantt_link_point\",\r\n\t\tlink_landing_hover_area = \"gantt_link_control\";\r\n\r\n\tvar dnd = new DnD(timeline.$task_bars, {\r\n\t\tsensitivity : 0,\r\n\t\tupdates_per_second : 60,\r\n\t\tmousemoveContainer: gantt.$root,\r\n\t\tselector: \".\" + link_edge_marker,\r\n\t\tpreventDefault: true\r\n\t});\r\n\r\n\tdnd.attachEvent(\"onBeforeDragStart\", gantt.bind(function(obj,e) {\r\n\t\tvar target = (e.target||e.srcElement);\r\n\t\tresetDndState();\r\n\t\tif(gantt.getState(\"tasksDnd\").drag_id)\r\n\t\t\treturn false;\r\n\r\n\t\tif(domHelpers.locateClassName(target, link_edge_marker)){\r\n\t\t\tif(domHelpers.locateClassName(target, start_marker))\r\n\t\t\t\t_link_source_task_start = true;\r\n\r\n\t\t\tvar sid = gantt.locate(e);\r\n\t\t\t_link_source_task = sid;\r\n\r\n\t\t\tvar t = gantt.getTask(sid);\r\n\t\t\tif(gantt.isReadonly(t)){\r\n\t\t\t\tresetDndState();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tthis._dir_start = {\r\n\t\t\t\tx: dnd.config.original_element_sizes.x + dnd.config.original_element_sizes.width/2,\r\n\t\t\t\ty: dnd.config.original_element_sizes.y + dnd.config.original_element_sizes.height/2\r\n\t\t\t};\r\n\r\n\t\t\treturn true;\r\n\t\t}else{\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t}, this));\r\n\r\n\tdnd.attachEvent(\"onAfterDragStart\", gantt.bind(function(obj,e) {\r\n\t\tif(gantt.config.touch) {\r\n\t\t\tgantt.refreshData();\r\n\t\t}\r\n\t\tupdateMarkedHtml(dnd.config.marker);\r\n\t}, this));\r\n\r\n\tfunction getVieportSize(){\r\n\t\tvar root = gantt.$root;\r\n\t\treturn { right: root.offsetWidth, bottom: root.offsetHeight };\r\n\t}\r\n\tfunction getMarkerSize (marker){\r\n\t\tvar width = 0, height = 0;\r\n\t\tif(marker){\r\n\t\t\twidth = marker.offsetWidth || 0;\r\n\t\t\theight = marker.offsetHeight || 0;\r\n\t\t}\r\n\t\treturn { width: width, height: height };\r\n\t}\r\n\r\n\tfunction getPosition(e, marker){\r\n\t\tvar oldPos = dnd.getPosition(e);\r\n\r\n\t\tvar markerSize = getMarkerSize(marker);\r\n\t\tvar viewportSize = getVieportSize();\r\n\r\n\t\tvar offsetX = gantt.config.tooltip_offset_x || markerDefaultOffset;\r\n\t\tvar offsetY = gantt.config.tooltip_offset_y || markerDefaultOffset;\r\n\r\n\t\tvar scrollSize = gantt.config.scroll_size || scrollDefaultSize;\r\n\r\n\t\t// GS-1315: Add offset if there are elements above Gantt\r\n\t\tvar ganttOffsetY = gantt.$container.getBoundingClientRect().y + window.scrollY;\r\n\r\n\t\tvar position = {\r\n\t\t\ty: oldPos.y + offsetY,\r\n\t\t\tx: oldPos.x + offsetX,\r\n\t\t\tbottom: oldPos.y + markerSize.height + offsetY + scrollSize,\r\n\t\t\tright: oldPos.x + markerSize.width + offsetX + scrollSize\r\n\t\t};\r\n\r\n\t\tif(position.bottom > viewportSize.bottom + ganttOffsetY){\r\n\t\t\tposition.y = viewportSize.bottom + ganttOffsetY - markerSize.height - offsetY;\r\n\t\t}\r\n\r\n\t\tif(position.right > viewportSize.right){\r\n\t\t\tposition.x = viewportSize.right - markerSize.width - offsetX;\r\n\t\t}\r\n\t\treturn position;\r\n\t}\r\n\r\n\tdnd.attachEvent(\"onDragMove\", gantt.bind(function(obj,e) {\r\n\t\tvar dd = dnd.config;\r\n\t\tvar pos = getPosition(e, dd.marker);\r\n\t\tadvanceMarker(dd.marker, pos);\r\n\t\tvar landing = !!domHelpers.locateClassName(e, link_landing_hover_area);\r\n\r\n\t\tvar prevTarget = _link_target_task;\r\n\t\tvar prevLanding = _link_landing;\r\n\t\tvar prevToStart = _link_target_task_start;\r\n\r\n\t\tvar targ = gantt.locate(e),\r\n\t\t\tto_start = true;\r\n\r\n\t\t// can drag and drop link to another gantt on the page, such links are not supported\r\n\t\tvar eventTarget = domHelpers.getTargetNode(e);\r\n\r\n\t\tvar sameGantt = domHelpers.isChildOf(eventTarget, gantt.$root);\r\n\t\tif(!sameGantt){\r\n\t\t\tlanding = false;\r\n\t\t\ttarg = null;\r\n\t\t}\r\n\r\n\t\tif(landing){\r\n\t\t\t//refreshTask\r\n\t\t\tto_start = !domHelpers.locateClassName(e, end_marker);\r\n\t\t\tlanding = !!targ;\r\n\t\t}\r\n\r\n\t\t_link_target_task = targ;\r\n\t\t_link_landing = landing;\r\n\t\t_link_target_task_start = to_start;\r\n\r\n\t\tif(landing){\r\n\r\n\t\t\tvar node = domHelpers.locateClassName(e, link_landing_hover_area);\r\n\t\t\r\n\t\t\tconst point = node.querySelector(`.${link_edge_marker}`);\r\n\t\t\tif(point){\r\n\t\t\t\tconst absCoords = domHelpers.getRelativeNodePosition(point, timeline.$task_bg);\r\n\t\t\t\tthis._dir_end = {\r\n\t\t\t\t\tx: absCoords.x + point.offsetWidth/2,\r\n\t\t\t\t\ty: absCoords.y + point.offsetHeight/2\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t}else{\r\n\t\t\tthis._dir_end = domHelpers.getRelativeEventPosition(e, timeline.$task_data);\r\n\t\t\tif(gantt.env.isEdge){ // to fix margin collapsing\r\n\t\t\t\tthis._dir_end.y += window.scrollY;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar targetChanged = !(prevLanding == landing && prevTarget == targ && prevToStart == to_start);\r\n\t\tif(targetChanged){\r\n\t\t\tif(prevTarget)\r\n\t\t\t\tgantt.refreshTask(prevTarget, false);\r\n\t\t\tif(targ)\r\n\t\t\t\tgantt.refreshTask(targ, false);\r\n\t\t}\r\n\r\n\t\tif(targetChanged){\r\n\t\t\tupdateMarkedHtml(dd.marker);\r\n\t\t}\r\n\r\n\t\tshowDirectingLine(this._dir_start.x, this._dir_start.y, this._dir_end.x, this._dir_end.y);\r\n\r\n\t\treturn true;\r\n\t}, this));\r\n\r\n\r\n\tdnd.attachEvent(\"onDragEnd\", gantt.bind(function() {\r\n\t\tvar drag = getDndState();\r\n\r\n\t\tif(drag.link_source_id && drag.link_target_id && drag.link_source_id != drag.link_target_id){\r\n\t\t\tvar type = gantt._get_link_type(drag.link_from_start, drag.link_to_start);\r\n\r\n\t\t\tvar link = {source : drag.link_source_id, target: drag.link_target_id, type:type};\r\n\t\t\tif(link.type && gantt.isLinkAllowed(link)) {\r\n\t\t\t\tif(gantt.callEvent(\"onLinkCreated\", [link])){\r\n\t\t\t\t\tgantt.addLink(link);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tresetDndState();\r\n\r\n\t\tif(gantt.config.touch) {\r\n\t\t\tgantt.refreshData();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (drag.link_source_id)\r\n\t\t\t\tgantt.refreshTask(drag.link_source_id, false);\r\n\t\t\tif (drag.link_target_id)\r\n\t\t\t\tgantt.refreshTask(drag.link_target_id, false);\r\n\t\t}\r\n\t\tremoveDirectionLine();\r\n\t}, this));\r\n\r\n\tfunction updateMarkedHtml(marker){\r\n\t\tvar link = getDndState();\r\n\r\n\t\tvar css = [\"gantt_link_tooltip\"];\r\n\t\tif(link.link_source_id && link.link_target_id){\r\n\t\t\tif(gantt.isLinkAllowed(link.link_source_id, link.link_target_id, link.link_from_start, link.link_to_start)){\r\n\t\t\t\tcss.push(\"gantt_allowed_link\");\r\n\t\t\t}else{\r\n\t\t\t\tcss.push(\"gantt_invalid_link\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar className = gantt.templates.drag_link_class(link.link_source_id, link.link_from_start, link.link_target_id, link.link_to_start);\r\n\t\tif(className)\r\n\t\t\tcss.push(className);\r\n\r\n\t\tvar html = \"<div class='\"+className+ \"'>\" +\r\n\t\t\tgantt.templates.drag_link(link.link_source_id, link.link_from_start, link.link_target_id, link.link_to_start) +\r\n\t\t\t\"</div>\";\r\n\t\tmarker.innerHTML = html;\r\n\t}\r\n\r\n\tfunction advanceMarker(marker, pos){\r\n\t\tmarker.style.left = pos.x + \"px\";\r\n\t\tmarker.style.top = pos.y + \"px\";\r\n\t}\r\n\r\n\tfunction resetDndState(){\r\n\t\t_link_source_task =\r\n\t\t\t_link_source_task_start =\r\n\t\t\t\t_link_target_task = null;\r\n\t\t_link_target_task_start = true;\r\n\t}\r\n\tfunction showDirectingLine(s_x, s_y, e_x, e_y){\r\n\t\tvar div = getDirectionLine();\r\n\r\n\t\tvar link = getDndState();\r\n\r\n\t\tvar css = [\"gantt_link_direction\"];\r\n\t\tif(gantt.templates.link_direction_class){\r\n\t\t\tcss.push(gantt.templates.link_direction_class(link.link_source_id, link.link_from_start, link.link_target_id, link.link_to_start));\r\n\t\t}\r\n\r\n\t\tvar dist =Math.sqrt( (Math.pow(e_x - s_x, 2)) + (Math.pow(e_y - s_y, 2)) );\r\n\t\tdist = Math.max(0, dist - 3);\r\n\t\tif(!dist)\r\n\t\t\treturn;\r\n\r\n\t\tdiv.className = css.join(\" \");\r\n\t\tvar tan = (e_y - s_y)/(e_x - s_x),\r\n\t\t\tangle = Math.atan(tan);\r\n\r\n\t\tif(coordinateCircleQuarter(s_x, e_x, s_y, e_y) == 2){\r\n\t\t\tangle += Math.PI;\r\n\t\t}else if(coordinateCircleQuarter(s_x, e_x, s_y, e_y) == 3){\r\n\t\t\tangle -= Math.PI;\r\n\t\t}\r\n\r\n\r\n\r\n\t\tvar sin = Math.sin(angle),\r\n\t\t\tcos = Math.cos(angle),\r\n\t\t\ttop = Math.round(s_y),\r\n\t\t\tleft = Math.round(s_x);\r\n\r\n\r\n\t\tvar style = [\r\n\t\t\t\"-webkit-transform: rotate(\"+angle+\"rad)\",\r\n\t\t\t\"-moz-transform: rotate(\"+angle+\"rad)\",\r\n\t\t\t\"-ms-transform: rotate(\"+angle+\"rad)\",\r\n\t\t\t\"-o-transform: rotate(\"+angle+\"rad)\",\r\n\t\t\t\"transform: rotate(\"+angle+\"rad)\",\r\n\t\t\t\"width:\" + Math.round(dist) + \"px\"\r\n\t\t];\r\n\r\n\t\tif(window.navigator.userAgent.indexOf(\"MSIE 8.0\") != -1){\r\n\t\t\t//ms-filter breaks styles in ie9, so add it only for 8th\r\n\t\t\tstyle.push(\"-ms-filter: \\\"\" + ieTransform(sin, cos) + \"\\\"\");\r\n\r\n\t\t\tvar shiftLeft = Math.abs(Math.round(s_x - e_x)),\r\n\t\t\t\tshiftTop = Math.abs(Math.round(e_y - s_y));\r\n\t\t\t//fix rotation axis\r\n\t\t\tswitch(coordinateCircleQuarter(s_x, e_x, s_y, e_y)){\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\ttop -= shiftTop;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tleft -= shiftLeft;\r\n\t\t\t\t\ttop -= shiftTop;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tleft -= shiftLeft;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tstyle.push(\"top:\" +  top + \"px\");\r\n\t\tstyle.push(\"left:\" +  left + \"px\");\r\n\r\n\t\tdiv.style.cssText = style.join(\";\");\r\n\t}\r\n\r\n\tfunction ieTransform(sin, cos){\r\n\t\treturn \"progid:DXImageTransform.Microsoft.Matrix(\"+\r\n\t\t\t\"M11 = \"+cos+\",\"+\r\n\t\t\t\"M12 = -\"+sin+\",\"+\r\n\t\t\t\"M21 = \"+sin+\",\"+\r\n\t\t\t\"M22 = \"+cos+\",\"+\r\n\t\t\t\"SizingMethod = 'auto expand'\"+\r\n\t\t\")\";\r\n\t}\r\n\tfunction coordinateCircleQuarter(sX, eX, sY, eY){\r\n\t\tif(eX >= sX){\r\n\t\t\tif(eY <= sY){\r\n\t\t\t\treturn 1;\r\n\t\t\t}else{\r\n\t\t\t\treturn 4;\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tif(eY <= sY){\r\n\t\t\t\treturn 2;\r\n\t\t\t}else{\r\n\t\t\t\treturn 3;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\tfunction getDirectionLine(){\r\n\t\tif(!dnd._direction || !dnd._direction.parentNode){\r\n\t\t\tdnd._direction = document.createElement(\"div\");\r\n\t\t\ttimeline.$task_links.appendChild(dnd._direction);\r\n\t\t}\r\n\t\treturn dnd._direction;\r\n\t}\r\n\tfunction removeDirectionLine(){\r\n\t\tif(dnd._direction){\r\n\t\t\tif (dnd._direction.parentNode)\t//the event line can be detached because of data refresh\r\n\t\t\t\tdnd._direction.parentNode.removeChild(dnd._direction);\r\n\r\n\t\t\tdnd._direction = null;\r\n\t\t}\r\n\t}\r\n\tgantt.attachEvent(\"onGanttRender\", gantt.bind(function() {\r\n\t\tif(dnd._direction){\r\n\t\t\tshowDirectingLine(this._dir_start.x, this._dir_start.y, this._dir_end.x, this._dir_end.y);\r\n\t\t}\r\n\t}, this));\r\n};\r\n\r\nexport default {\r\n\tcreateLinkDND: function(){\r\n\t\treturn {\r\n\t\t\tinit: initLinksDND\r\n\t\t};\r\n\t}\r\n};","import * as utils from \"../../../utils/utils\";\r\nimport taskDnD from \"./tasks_dnd\";\r\nimport linkDnD from \"./links_dnd\";\r\nimport * as domHelpers from \"../utils/dom_helpers\";\r\nimport MouseDelegates from \"../mouse_event_container\";\r\n\r\nvar initializer = (function(){\r\n\treturn function(gantt){\r\n\t\tvar services = gantt.$services;\r\n\t\treturn {\r\n\t\t\tonCreated: function (timeline) {\r\n\t\t\t\tvar config = timeline.$config;\r\n\t\t\t\tconfig.bind = utils.defined(config.bind) ? config.bind : \"task\";\r\n\t\t\t\tconfig.bindLinks = utils.defined(config.bindLinks) ? config.bindLinks : \"link\";\r\n\r\n\t\t\t\ttimeline._linksDnD = linkDnD.createLinkDND();\r\n\t\t\t\ttimeline._tasksDnD = taskDnD.createTaskDND();\r\n\t\t\t\ttimeline._tasksDnD.extend(timeline);\r\n\r\n\t\t\t\tthis._mouseDelegates = MouseDelegates(gantt);\r\n\t\t\t},\r\n\t\t\tonInitialized: function (timeline) {\r\n\t\t\t\tthis._attachDomEvents(gantt);\r\n\r\n\t\t\t\tthis._attachStateProvider(gantt, timeline);\r\n\r\n\t\t\t\ttimeline._tasksDnD.init(timeline, gantt);\r\n\t\t\t\ttimeline._linksDnD.init(timeline, gantt);\r\n\r\n\t\t\t\tif(timeline.$config.id == \"timeline\"){\r\n\t\t\t\t\tthis.extendDom(timeline);\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\t\t\tonDestroyed: function (timeline) {\r\n\t\t\t\tthis._clearDomEvents(gantt);\r\n\t\t\t\tthis._clearStateProvider(gantt);\r\n\t\t\t\tif (timeline._tasksDnD) {\r\n\t\t\t\t\ttimeline._tasksDnD.destructor();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\textendDom: function(timeline){\r\n\t\t\t\tgantt.$task = timeline.$task;\r\n\t\t\t\tgantt.$task_scale = timeline.$task_scale;\r\n\t\t\t\tgantt.$task_data = timeline.$task_data;\r\n\t\t\t\tgantt.$task_bg = timeline.$task_bg;\r\n\t\t\t\tgantt.$task_links = timeline.$task_links;\r\n\t\t\t\tgantt.$task_bars = timeline.$task_bars;\r\n\t\t\t},\r\n\r\n\t\t\t_clearDomEvents: function(){\r\n\t\t\t\tthis._mouseDelegates.destructor();\r\n\t\t\t\tthis._mouseDelegates = null;\r\n\t\t\t},\r\n\r\n\t\t\t_attachDomEvents: function(gantt){\r\n\t\t\t\tfunction _delete_link_handler(id, e) {\r\n\t\t\t\t\tif (id && this.callEvent(\"onLinkDblClick\", [id, e])) {\r\n\r\n\t\t\t\t\t\tvar link = this.getLink(id);\r\n\t\t\t\t\t\tif (this.isReadonly(link)) return;\r\n\r\n\t\t\t\t\t\tvar title = \"\";\r\n\t\t\t\t\t\tvar question = this.locale.labels.link + \" \" + this.templates.link_description(this.getLink(id)) + \" \" + this.locale.labels.confirm_link_deleting;\r\n\r\n\t\t\t\t\t\twindow.setTimeout(function () {\r\n\t\t\t\t\t\t\tgantt._simple_confirm(question, title, function () {\r\n\t\t\t\t\t\t\t\tgantt.deleteLink(id);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}, (this.config.touch ? 300 : 1));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_task_link\", gantt.bind(function (e, trg) {\r\n\t\t\t\t\tvar id = this.locate(e, this.config.link_attribute);\r\n\t\t\t\t\tif (id) {\r\n\t\t\t\t\t\tthis.callEvent(\"onLinkClick\", [id, e]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, gantt), this.$task);\r\n\r\n\t\t\t\tthis._mouseDelegates.delegate(\"click\", \"gantt_scale_cell\", gantt.bind(function (e, trg) {\r\n\t\t\t\t\tvar pos = domHelpers.getRelativeEventPosition(e, gantt.$task_data);\r\n\t\t\t\t\tvar date = gantt.dateFromPos(pos.x);\r\n\t\t\t\t\tvar coll = Math.floor(gantt.columnIndexByDate(date));\r\n\r\n\t\t\t\t\tvar coll_date = gantt.getScale().trace_x[coll];\r\n\r\n\t\t\t\t\tgantt.callEvent(\"onScaleClick\", [e, coll_date]);\r\n\t\t\t\t}, gantt), this.$task);\r\n\r\n\t\t\t\tthis._mouseDelegates.delegate(\"doubleclick\", \"gantt_task_link\", gantt.bind(function (e, id, trg) {\r\n\t\t\t\t\tvar id = this.locate(e, gantt.config.link_attribute);\r\n\t\t\t\t\t_delete_link_handler.call(this, id, e);\r\n\t\t\t\t}, gantt), this.$task);\r\n\r\n\t\t\t\tthis._mouseDelegates.delegate(\"doubleclick\", \"gantt_link_point\", gantt.bind(function (e, id, trg) {\r\n\t\t\t\t\tvar id = this.locate(e),\r\n\t\t\t\t\t\ttask = this.getTask(id);\r\n\r\n\t\t\t\t\tvar link = null;\r\n\t\t\t\t\tif (trg.parentNode && domHelpers.getClassName(trg.parentNode)) {\r\n\t\t\t\t\t\tif (domHelpers.getClassName(trg.parentNode).indexOf(\"_left\") > -1) {\r\n\t\t\t\t\t\t\tlink = task.$target[0];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tlink = task.$source[0];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (link)\r\n\t\t\t\t\t\t_delete_link_handler.call(this, link, e);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}, gantt), this.$task);\r\n\t\t\t},\r\n\r\n\t\t\t_attachStateProvider: function(gantt, timeline){\r\n\t\t\t\tvar self = timeline;\r\n\t\t\t\tvar state = services.getService(\"state\");\r\n\t\t\t\tstate.registerProvider(\"tasksTimeline\", function(){\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tscale_unit: self._tasks ? self._tasks.unit : undefined,\r\n\t\t\t\t\t\tscale_step:  self._tasks ? self._tasks.step  : undefined\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\t_clearStateProvider: function(){\r\n\t\t\t\tvar state = services.getService(\"state\");\r\n\t\t\t\tstate.unregisterProvider(\"tasksTimeline\");\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\r\n})();\r\n\r\nexport default initializer;","import * as domHelpers from \"./utils/dom_helpers\";\r\n\r\nvar initializer = (function() {\r\n\treturn function (gantt) {\r\n\t\treturn {\r\n\r\n\t\t\tgetVerticalScrollbar: function(){\r\n\t\t\t\treturn gantt.$ui.getView(\"scrollVer\");\r\n\t\t\t},\r\n\t\t\tgetHorizontalScrollbar: function(){\r\n\t\t\t\treturn gantt.$ui.getView(\"scrollHor\");\r\n\t\t\t},\r\n\r\n\t\t\t_legacyGridResizerClass: function(layout){\r\n\t\t\t\tvar resizers = layout.getCellsByType(\"resizer\");\r\n\t\t\t\tfor(var i = 0; i < resizers.length; i++){\r\n\t\t\t\t\tvar r = resizers[i];\r\n\t\t\t\t\tvar gridResizer = false;\r\n\r\n\t\t\t\t\tvar prev = r.$parent.getPrevSibling(r.$id);\r\n\t\t\t\t\tif(prev && prev.$config && prev.$config.id === \"grid\"){\r\n\t\t\t\t\t\tgridResizer= true;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tvar next = r.$parent.getNextSibling(r.$id);\r\n\t\t\t\t\t\tif(next && next.$config && next.$config.id === \"grid\"){\r\n\t\t\t\t\t\t\tgridResizer= true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(gridResizer){\r\n\t\t\t\t\t\tr.$config.css = (r.$config.css ? r.$config.css + \" \" : \"\") + \"gantt_grid_resize_wrap\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tonCreated: function(layout) {\r\n\t\t\t\tvar first = true;\r\n\r\n\t\t\t\tthis._legacyGridResizerClass(layout);\r\n\r\n\t\t\t\tlayout.attachEvent(\"onBeforeResize\", function() {\r\n\t\t\t\t\tvar mainTimeline = gantt.$ui.getView(\"timeline\");\r\n\t\t\t\t\tif (mainTimeline)\r\n\t\t\t\t\t\tmainTimeline.$config.hidden = mainTimeline.$parent.$config.hidden = !gantt.config.show_chart;\r\n\r\n\t\t\t\t\tvar mainGrid = gantt.$ui.getView(\"grid\");\r\n\r\n\t\t\t\t\tif(!mainGrid)\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tvar colsWidth = mainGrid._getColsTotalWidth();\r\n\t\t\t\t\tvar hideGrid = !gantt.config.show_grid || !gantt.config.grid_width || colsWidth === 0;\r\n\t\t\t\t\tif (first && !hideGrid && colsWidth !== false){\r\n\t\t\t\t\t\t\tgantt.config.grid_width = colsWidth;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmainGrid.$config.hidden = mainGrid.$parent.$config.hidden = hideGrid;\r\n\r\n\t\t\t\t\tif (!mainGrid.$config.hidden) {\r\n\t\t\t\t\t\t/* restrict grid width due to min_width, max_width, min_grid_column_width */\r\n\t\t\t\t\t\tvar grid_limits = mainGrid._getGridWidthLimits();\r\n\t\t\t\t\t\tif (grid_limits[0] && gantt.config.grid_width < grid_limits[0])\r\n\t\t\t\t\t\t\tgantt.config.grid_width = grid_limits[0];\r\n\t\t\t\t\t\tif (grid_limits[1] && gantt.config.grid_width > grid_limits[1])\r\n\t\t\t\t\t\t\tgantt.config.grid_width = grid_limits[1];\r\n\t\t\t\t\t\tif (mainTimeline && gantt.config.show_chart){\r\n\r\n\t\t\t\t\t\t\tmainGrid.$config.width = gantt.config.grid_width - 1;\r\n\r\n\t\t\t\t\t\t\t// GS-1314: Don't let the non-scrollable grid to be larger than the container with the correct width\r\n\t\t\t\t\t\t\tif (!mainGrid.$config.scrollable && mainGrid.$config.scrollY && gantt.$root.offsetWidth){\r\n\t\t\t\t\t\t\t\tvar ganttContainerWidth = mainGrid.$gantt.$layout.$container.offsetWidth;\r\n\t\t\t\t\t\t\t\tvar verticalScrollbar = gantt.$ui.getView(mainGrid.$config.scrollY);\r\n\t\t\t\t\t\t\t\tvar verticalScrollbarWidth = verticalScrollbar.$config.width;\r\n\r\n\t\t\t\t\t\t\t\t// GS-2488: to prevent grid from occupying the whole gantt container(timeline will be disabled) \r\n\t\t\t\t\t\t\t\t// need to leave min width for timeline\r\n\t\t\t\t\t\t\t\tvar gridOverflow = ganttContainerWidth - (mainGrid.$config.width + verticalScrollbarWidth) - 4;\r\n\t\t\t\t\t\t\t\tif (gridOverflow < 0){\r\n\t\t\t\t\t\t\t\t\tmainGrid.$config.width += gridOverflow;\r\n\t\t\t\t\t\t\t\t\tgantt.config.grid_width += gridOverflow;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (!first) {\r\n\t\t\t\t\t\t\t\tif (mainTimeline && !domHelpers.isChildOf(mainTimeline.$task, layout.$view)) {\r\n\t\t\t\t\t\t\t\t\t// timeline is being displayed after being not visible, reset grid with from full screen\r\n\t\t\t\t\t\t\t\t\tif (!mainGrid.$config.original_grid_width) {\r\n\t\t\t\t\t\t\t\t\t\tvar skinSettings = gantt.skins[gantt.skin];\r\n\t\t\t\t\t\t\t\t\t\tif(skinSettings && skinSettings.config && skinSettings.config.grid_width){\r\n\t\t\t\t\t\t\t\t\t\t\tmainGrid.$config.original_grid_width =  skinSettings.config.grid_width;\r\n\t\t\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t\t\tmainGrid.$config.original_grid_width = 0;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tgantt.config.grid_width = mainGrid.$config.original_grid_width;\r\n\t\t\t\t\t\t\t\t\tmainGrid.$parent.$config.width = gantt.config.grid_width;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tmainGrid.$parent._setContentSize(mainGrid.$config.width, null);\r\n\t\t\t\t\t\t\t\t\tgantt.$layout._syncCellSizes(mainGrid.$parent.$config.group, {value: gantt.config.grid_width, isGravity: false});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tmainGrid.$parent.$config.width = gantt.config.grid_width;\r\n\t\t\t\t\t\t\t\tif (mainGrid.$parent.$config.group) {\r\n\t\t\t\t\t\t\t\t\tgantt.$layout._syncCellSizes(mainGrid.$parent.$config.group, {value: mainGrid.$parent.$config.width, isGravity: false});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (mainTimeline && domHelpers.isChildOf(mainTimeline.$task, layout.$view)) {\r\n\t\t\t\t\t\t\t\t// hiding timeline, remember grid with to restore it when timeline is displayed again\r\n\t\t\t\t\t\t\t\tmainGrid.$config.original_grid_width = gantt.config.grid_width;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (!first) {\r\n\t\t\t\t\t\t\t\tmainGrid.$parent.$config.width = 0;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfirst = false;\r\n\t\t\t\t});\r\n\t\t\t\tthis._initScrollStateEvents(layout);\r\n\t\t\t},\r\n\r\n\t\t\t_initScrollStateEvents: function(layout) {\r\n\t\t\t\tgantt._getVerticalScrollbar = this.getVerticalScrollbar;\r\n\t\t\t\tgantt._getHorizontalScrollbar = this.getHorizontalScrollbar;\r\n\r\n\t\t\t\tvar vertical = this.getVerticalScrollbar();\r\n\t\t\t\tvar horizontal = this.getHorizontalScrollbar();\r\n\t\t\t\tif (vertical) {\r\n\t\t\t\t\tvertical.attachEvent(\"onScroll\", function(oldPos, newPos, dir){\r\n\t\t\t\t\t\tvar scrollState = gantt.getScrollState();\r\n\t\t\t\t\t\tgantt.callEvent(\"onGanttScroll\", [scrollState.x, oldPos, scrollState.x, newPos]);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tif (horizontal) {\r\n\t\t\t\t\thorizontal.attachEvent(\"onScroll\", function(oldPos, newPos, dir){\r\n\t\t\t\t\t\tvar scrollState = gantt.getScrollState();\r\n\t\t\t\t\t\tgantt.callEvent(\"onGanttScroll\", [oldPos, scrollState.y, newPos, scrollState.y]);\r\n\r\n\t\t\t\t\t\t// if the grid doesn't fit the width, scroll the row container\r\n\t\t\t\t\t\tvar grid = gantt.$ui.getView(\"grid\");\r\n\t\t\t\t\t\tif (grid && grid.$grid_data && !grid.$config.scrollable){\r\n\t\t\t\t\t\t\tgrid.$grid_data.style.left = grid.$grid.scrollLeft + \"px\";\r\n\t\t\t\t\t\t\tgrid.$grid_data.scrollLeft = grid.$grid.scrollLeft;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlayout.attachEvent(\"onResize\", function(){\r\n\t\t\t\t\tif (vertical && !gantt.$scroll_ver){\r\n\t\t\t\t\t\tgantt.$scroll_ver = vertical.$scroll_ver;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (horizontal && !gantt.$scroll_hor){\r\n\t\t\t\t\t\tgantt.$scroll_hor = horizontal.$scroll_hor;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\t_findGridResizer: function(layout, grid){\r\n\t\t\t\tvar resizers = layout.getCellsByType(\"resizer\");\r\n\r\n\t\t\t\tvar gridFirst = true;\r\n\t\t\t\tvar gridResizer;\r\n\t\t\t\tfor(var i = 0; i < resizers.length; i++){\r\n\t\t\t\t\tvar res = resizers[i];\r\n\t\t\t\t\tres._getSiblings();\r\n\t\t\t\t\tvar prev = res._behind;\r\n\t\t\t\t\tvar next = res._front;\r\n\t\t\t\t\tif(prev && prev.$content === grid || (prev.isChild && prev.isChild(grid))){\r\n\t\t\t\t\t\tgridResizer = res;\r\n\t\t\t\t\t\tgridFirst = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}else if(next && next.$content === grid || (next.isChild && next.isChild(grid))){\r\n\t\t\t\t\t\tgridResizer = res;\r\n\t\t\t\t\t\tgridFirst = false;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn {\r\n\t\t\t\t\tresizer: gridResizer,\r\n\t\t\t\t\tgridFirst: gridFirst\r\n\t\t\t\t};\r\n\t\t\t},\r\n\r\n\t\t\tonInitialized: function (layout) {\r\n\t\t\t\tvar grid = gantt.$ui.getView(\"grid\");\r\n\r\n\t\t\t\tvar resizeInfo = this._findGridResizer(layout, grid);\r\n\r\n\t\t\t\t// expose grid resize events\r\n\t\t\t\tif(resizeInfo.resizer){\r\n\t\t\t\t\tvar gridFirst = resizeInfo.gridFirst,\r\n\t\t\t\t\t\tnext = resizeInfo.resizer;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tif(next.$config.mode !== \"x\"){\r\n\t\t\t\t\t\treturn;// track only horizontal resize\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar initialWidth;\r\n\t\t\t\t\tnext.attachEvent(\"onResizeStart\", function(prevCellWidth, nextCellWidth){\r\n\r\n\t\t\t\t\t\tvar grid = gantt.$ui.getView(\"grid\");\r\n\t\t\t\t\t\tvar viewCell = grid ? grid.$parent : null;\r\n\t\t\t\t\t\tif(viewCell){\r\n\t\t\t\t\t\t\tvar limits = grid._getGridWidthLimits();\r\n\r\n\t\t\t\t\t\t\t// min grid width is defined by min widths of its columns, unless grid has horizontal scroll\r\n\t\t\t\t\t\t\tif(!grid.$config.scrollable)\r\n\t\t\t\t\t\t\t\tviewCell.$config.minWidth = limits[0];\r\n\r\n\t\t\t\t\t\t\tviewCell.$config.maxWidth = limits[1];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tinitialWidth = gridFirst ? prevCellWidth : nextCellWidth;\r\n\t\t\t\t\t\treturn gantt.callEvent(\"onGridResizeStart\", [initialWidth]);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tnext.attachEvent(\"onResize\", function(newBehindSize, newFrontSize){\r\n\t\t\t\t\t\tvar newSize = gridFirst ? newBehindSize : newFrontSize;\r\n\t\t\t\t\t\treturn gantt.callEvent(\"onGridResize\", [initialWidth, newSize]);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tnext.attachEvent(\"onResizeEnd\", function(oldBackSize, oldFrontSize, newBackSize, newFrontSize){\r\n\r\n\t\t\t\t\t\tvar oldSize = gridFirst ? oldBackSize : oldFrontSize;\r\n\t\t\t\t\t\tvar newSize = gridFirst ? newBackSize : newFrontSize;\r\n\t\t\t\t\t\tvar grid = gantt.$ui.getView(\"grid\");\r\n\t\t\t\t\t\tvar viewCell = grid ? grid.$parent : null;\r\n\t\t\t\t\t\tif(viewCell){\r\n\t\t\t\t\t\t\tviewCell.$config.minWidth = undefined;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar res = gantt.callEvent(\"onGridResizeEnd\", [oldSize, newSize]);\r\n\t\t\t\t\t\tif(res && newSize !== 0){// new size may be numeric zero when cell size is defined by 'gravity', actual size will be calculated by layout later\r\n\t\t\t\t\t\t\tgantt.config.grid_width = newSize;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn res;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\t\t\tonDestroyed: function (timeline) {\r\n\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t};\r\n})();\r\n\r\nexport default initializer;","import uiFactory from \"./ui_factory\";\r\nimport mouseEvents from \"./mouse\";\r\nimport createLayers from \"./gantt_layers\";\r\nimport Cell from \"./layout/cell\";\r\nimport Layout from \"./layout/layout\";\r\nimport ViewLayout from \"./layout/view_layout\";\r\nimport ViewCell from \"./layout/view_cell\";\r\nimport Resizer from \"./layout/resizer_cell\";\r\nimport Scrollbar from \"./layout/scrollbar_cell\";\r\nimport Timeline from \"./timeline/timeline\";\r\nimport Grid from \"./grid/grid\";\r\nimport ResourceGrid from \"./grid/resource_grid\";\r\nimport ResourceTimeline from \"./timeline/resource_timeline\";\r\nimport ResourceHistogram from \"./timeline/resource_histogram\";\r\n\r\n\r\nimport gridEditorsFactory from \"./grid/editors/controller\";\r\n\r\nimport renderTaskBar from \"./render/task_bar_smart_render\";\r\nimport renderTimedProjectBar from \"./render/task_project_smart_render\";\r\nimport renderSplitTaskBar from \"./render/task_split_render\";\r\nimport renderRollupTaskBar from \"./render/task_rollup_render\";\r\nimport renderTaskBg from \"./render/task_bg_render\";\r\nimport renderLink from \"./render/link_render\";\r\nimport gridRenderer from \"./render/task_grid_line_render\";\r\nimport resourceMatrixRenderer from \"./render/resource_matrix_render\";\r\nimport resourceHistogramRenderer from \"./render/resource_histogram_render\";\r\nimport gridTaskRowResizerRenderer from \"./render/task_grid_row_resize_render\";\r\nimport renderConstraints from \"./render/task_constraints_render\";\r\nimport renderDeadline from \"./render/task_deadline_render\";\r\nimport renderBaselines from \"./render/task_baselines_render\";\r\nimport mainGridInitializer from \"./grid/main_grid_initializer\";\r\nimport mainTimelineInitializer from \"./timeline/main_timeline_initializer\";\r\nimport mainLayoutInitializer from \"./main_layout_initializer\";\r\n\r\nfunction initUI(gantt){\r\n\tfunction attachInitializer(view, initializer){\r\n\t\tvar ext = initializer(gantt);\r\n\t\tif(ext.onCreated)\r\n\t\t\text.onCreated(view);\r\n\t\tview.attachEvent(\"onReady\", function(){\r\n\t\t\tif(ext.onInitialized)\r\n\t\t\t\text.onInitialized(view);\r\n\t\t});\r\n\t\tview.attachEvent(\"onDestroy\", function(){\r\n\t\t\tif(ext.onDestroyed)\r\n\t\t\t\text.onDestroyed(view);\r\n\t\t});\r\n\t}\r\n\r\n\tvar factory = uiFactory.createFactory(gantt);\r\n\tfactory.registerView(\"cell\", Cell);\r\n\tfactory.registerView(\"resizer\", Resizer);\r\n\tfactory.registerView(\"scrollbar\", Scrollbar);\r\n\tfactory.registerView(\"layout\", Layout, function(view){\r\n\t\tvar id = view.$config ? view.$config.id : null;\r\n\t\tif(id === \"main\"){\r\n\t\t\tattachInitializer(view, mainLayoutInitializer);\r\n\t\t}\r\n\t});\r\n\tfactory.registerView(\"viewcell\", ViewCell);\r\n\tfactory.registerView(\"multiview\", ViewLayout);\r\n\tfactory.registerView(\"timeline\", Timeline, function(view){\r\n\t\tvar id = view.$config ? view.$config.id : null;\r\n\t\tif(id === \"timeline\" || view.$config.bind == \"task\"){\r\n\t\t\tattachInitializer(view, mainTimelineInitializer);\r\n\t\t}\r\n\t});\r\n\tfactory.registerView(\"grid\", Grid, function(view){\r\n\t\tvar id = view.$config ? view.$config.id : null;\r\n\t\tif(id === \"grid\" || view.$config.bind == \"task\"){\r\n\t\t\tattachInitializer(view, mainGridInitializer);\r\n\t\t}\r\n\t});\r\n\r\n\tfactory.registerView(\"resourceGrid\", ResourceGrid);\r\n\tfactory.registerView(\"resourceTimeline\", ResourceTimeline);\r\n\tfactory.registerView(\"resourceHistogram\", ResourceHistogram);\r\n\r\n\tvar layersEngine = createLayers(gantt);\r\n\r\n\tvar inlineEditors = gridEditorsFactory(gantt);\r\n\r\n\tgantt.ext.inlineEditors = inlineEditors;\r\n\tgantt.ext._inlineEditors = inlineEditors;\r\n\tinlineEditors.init(gantt);\r\n\r\n\treturn {\r\n\t\tfactory:factory,\r\n\t\tmouseEvents: mouseEvents.init(gantt),\r\n\t\tlayersApi: layersEngine.init(),\r\n\t\trender:{\r\n\t\t\tgridLine: function(){\r\n\t\t\t\treturn gridRenderer(gantt);\r\n\t\t\t},\r\n\t\t\ttaskBg: function(){\r\n\t\t\t\treturn renderTaskBg(gantt);\r\n\t\t\t},\r\n\t\t\ttaskBar: function(){\r\n\t\t\t\treturn renderTaskBar(gantt);\r\n\t\t\t},\r\n\t\t\ttimedProjectBar: function(){\r\n\t\t\t\treturn renderTimedProjectBar(gantt);\r\n\t\t\t},\r\n\t\t\ttaskRollupBar: function() {\r\n\t\t\t\treturn renderRollupTaskBar(gantt);\r\n\t\t\t},\r\n\t\t\ttaskSplitBar: function(){\r\n\t\t\t\treturn renderSplitTaskBar(gantt);\r\n\t\t\t},\r\n\t\t\ttaskConstraints: function(){\r\n\t\t\t\treturn renderConstraints(gantt);\r\n\t\t\t},\r\n\t\t\ttaskDeadline: function(){\r\n\t\t\t\treturn renderDeadline(gantt);\r\n\t\t\t},\r\n\t\t\ttaskBaselines: function(){\r\n\t\t\t\treturn renderBaselines(gantt);\r\n\t\t\t},\r\n\t\t\tlink: function(){\r\n\t\t\t\treturn renderLink(gantt);\r\n\t\t\t},\r\n\t\t\tresourceRow: function(){\r\n\t\t\t\treturn resourceMatrixRenderer(gantt);\r\n\t\t\t},\r\n\t\t\tresourceHistogram: function(){\r\n\t\t\t\treturn resourceHistogramRenderer(gantt);\r\n\t\t\t},\r\n\t\t\tgridTaskRowResizer: function(){\r\n\t\t\t\treturn gridTaskRowResizerRenderer(gantt);\r\n\t\t\t}\r\n\t\t},\r\n\t\tlayersService: {\r\n\t\t\tgetDataRender: function(name){\r\n\t\t\t\treturn layersEngine.getDataRender(name, gantt);\r\n\t\t\t},\r\n\t\t\tcreateDataRender: function(config){\r\n\t\t\t\treturn layersEngine.createDataRender(config, gantt);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default {\r\n\tinit: initUI\r\n};","function createLayoutFacade(){\r\n\r\n\tfunction getTimeline(gantt){\r\n\t\treturn gantt.$ui.getView(\"timeline\");\r\n\t}\r\n\r\n\tfunction getGrid(gantt){\r\n\t\treturn gantt.$ui.getView(\"grid\");\r\n\t}\r\n\r\n\tfunction getBaseCell(gantt){\r\n\t\tvar timeline = getTimeline(gantt);\r\n\t\tif (timeline && !timeline.$config.hidden){\r\n\t\t\treturn timeline;\r\n\t\t} else{\r\n\t\t\tvar grid = getGrid(gantt);\r\n\t\t\tif (grid && !grid.$config.hidden){\r\n\t\t\t\treturn grid;\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getVerticalScrollbar(gantt){\r\n\t\tvar baseCell = null;\r\n\t\t// GS-1150: if we reorder or resize something in the grid, we should obtain the grid container\r\n\t\tvar gridDrag = false;\r\n\t\tvar gridMarkers = [\r\n\t\t\t\".gantt_drag_marker.gantt_grid_resize_area\",\r\n\t\t\t\".gantt_drag_marker .gantt_row.gantt_row_task\",\r\n\t\t\t\".gantt_drag_marker.gantt_grid_dnd_marker\"\r\n\t\t];\r\n\t\tgridMarkers.forEach(function (selector) {\r\n\t\t\tgridDrag = gridDrag || !!document.querySelector(selector);\r\n\t\t});\r\n\t\tif (gridDrag){\r\n\t\t\tbaseCell = getGrid(gantt);\r\n\t\t} else{\r\n\t\t\tbaseCell = getBaseCell(gantt);\r\n\t\t}\r\n\r\n\t\t// GS-1827. If there is no grid and timeline, there is no scrollbar for them\r\n\t\tif (!baseCell){\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar verticalScrollbar = getAttachedScrollbar(gantt, baseCell, \"scrollY\");\r\n\t\treturn verticalScrollbar;\r\n\t}\r\n\r\n\tfunction getHorizontalScrollbar(gantt){\r\n\t\tvar baseCell = getBaseCell(gantt);\r\n\t\tif (!baseCell || baseCell.id == \"grid\"){\r\n\t\t\treturn null; // if the timeline is not displayed, do not return the scrollbar\r\n\t\t}\r\n\t\tvar horizontalScrollbar = getAttachedScrollbar(gantt, baseCell, \"scrollX\");\r\n\t\treturn horizontalScrollbar;\r\n\t}\r\n\r\n\tfunction getAttachedScrollbar(gantt, cell, type){\r\n\t\tvar attachedScrollbar = cell.$config[type];\r\n\t\tvar scrollbarView = gantt.$ui.getView(attachedScrollbar);\r\n\t\treturn scrollbarView;\r\n\t}\r\n\r\n\tvar DEFAULT_VALUE = \"DEFAULT_VALUE\";\r\n\r\n\tfunction tryCall(getView, method, args, fallback){\r\n\t\tvar view = getView(this);\r\n\t\tif (!(view && view.isVisible())) {\r\n\t\t\tif(fallback){\r\n\t\t\t\treturn fallback();\r\n\t\t\t}else{\r\n\t\t\t\treturn DEFAULT_VALUE;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn view[method].apply(view, args);\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\r\n\t\tgetColumnIndex: function(name) {\r\n\t\t\tvar res = tryCall.call(this, getGrid, \"getColumnIndex\", [name]);\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdateFromPos: function(x) {\r\n\t\t\tvar res = tryCall.call(this, getTimeline, \"dateFromPos\", Array.prototype.slice.call(arguments));\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn this.getState().min_date;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tposFromDate: function(date) {\r\n\t\t\tvar res = tryCall.call(this, getTimeline, \"posFromDate\", [date]);\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetRowTop: function(index) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar res = tryCall.call(self, getTimeline, \"getRowTop\", [index],\r\n\t\t\t\tfunction(){ return tryCall.call(self, getGrid, \"getRowTop\", [index]);}\r\n\t\t\t\t);\r\n\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetTaskTop: function(id) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar res = tryCall.call(self, getTimeline, \"getItemTop\", [id],\r\n\t\t\t\tfunction(){ return tryCall.call(self, getGrid, \"getItemTop\", [id]);}\r\n\t\t\t);\r\n\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\tgetTaskPosition: function(task, start_date, end_date) {\r\n\t\t\tvar res = tryCall.call(this, getTimeline, \"getItemPosition\", [task, start_date, end_date]);\r\n\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\tvar top = this.getTaskTop(task.id);\r\n\t\t\t\tvar height = this.getTaskBarHeight(task.id);\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tleft: 0,\r\n\t\t\t\t\ttop: top,\r\n\t\t\t\t\theight: height,\r\n\t\t\t\t\twidth: 0\r\n\t\t\t\t};\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetTaskBarHeight: function(taskId, isMilestoneRender) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar res = tryCall.call(self, getTimeline, \"getBarHeight\", [taskId, isMilestoneRender],\r\n\t\t\t\tfunction(){ return tryCall.call(self, getGrid, \"getItemHeight\", [taskId]);}\r\n\t\t\t);\r\n\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetTaskHeight: function(taskId) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar res = tryCall.call(self, getTimeline, \"getItemHeight\", [taskId],\r\n\t\t\t\tfunction(){ return tryCall.call(self, getGrid, \"getItemHeight\", [taskId]);}\r\n\t\t\t);\r\n\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\tcolumnIndexByDate: function(date) {\r\n\t\t\tvar res = tryCall.call(this, getTimeline, \"columnIndexByDate\", [date]);\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn 0;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\troundTaskDates: function() {\r\n\t\t\ttryCall.call(this, getTimeline, \"roundTaskDates\", []);\r\n\t\t},\r\n\r\n\t\tgetScale: function() {\r\n\t\t\tvar res = tryCall.call(this, getTimeline, \"getScale\", []);\r\n\t\t\tif(res === DEFAULT_VALUE){\r\n\t\t\t\treturn null;\r\n\t\t\t}else{\r\n\t\t\t\treturn res;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetTaskNode: function(id) {\r\n\t\t\tvar timeline = getTimeline(this);\r\n\t\t\tif (!timeline || !timeline.isVisible()) {\r\n\t\t\t\treturn null;\r\n\t\t\t} else {\r\n\t\t\t\tvar node = timeline._taskRenderer.rendered[id];\r\n\t\t\t\tif(!node){\r\n\t\t\t\t\tvar domAttr = timeline.$config.item_attribute;\r\n\t\t\t\t\tnode = timeline.$task_bars.querySelector(\"[\" +domAttr+ \"='\"+id+\"']\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn node || null;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\tgetLinkNode: function(id) {\r\n\t\t\tvar timeline = getTimeline(this);\r\n\t\t\tif (!timeline.isVisible()) {\r\n\t\t\t\treturn null;\r\n\t\t\t} else {\r\n\t\t\t\treturn timeline._linkRenderer.rendered[id];\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tscrollTo: function(left, top){\r\n\t\t\tvar vertical = getVerticalScrollbar(this);\r\n\t\t\tvar horizontal = getHorizontalScrollbar(this);\r\n\r\n\t\t\tvar oldH = {position: 0},\r\n\t\t\t\toldV = {position: 0};\r\n\r\n\t\t\tif(vertical){\r\n\t\t\t\toldV = vertical.getScrollState();\r\n\t\t\t}\r\n\t\t\tif(horizontal){\r\n\t\t\t\toldH = horizontal.getScrollState();\r\n\t\t\t}\r\n\r\n\t\t\tvar scrollHorizontal = (horizontal && left*1 == left);\r\n\t\t\tvar scrollVertical = (vertical && top*1 == top);\r\n\t\t\tvar scrollBoth = scrollHorizontal && scrollVertical;\r\n\r\n\t\t\tif(scrollBoth){\r\n\t\t\t\t// some views will be scrolled both horizontally and vertically and smart rendering can be called twice\r\n\t\t\t\t// set flag in order not to invoke smart rendering at the horizontal scroll stage\r\n\t\t\t\t// so it will repaint only once when the scroll is completed\r\n\t\t\t\tvar verticalViews = vertical._getLinkedViews();\r\n\t\t\t\tvar horizontalViews = horizontal._getLinkedViews();\r\n\r\n\t\t\t\tvar commonViews = [];\r\n\t\t\t\tfor(var i = 0; i < verticalViews.length; i++){\r\n\t\t\t\t\tfor(var j = 0; j < horizontalViews.length; j++){\r\n\r\n\t\t\t\t\t\tif(verticalViews[i].$config.id && horizontalViews[j].$config.id && verticalViews[i].$config.id === horizontalViews[j].$config.id){\r\n\t\t\t\t\t\t\tcommonViews.push(verticalViews[i].$config.id);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (scrollHorizontal){\r\n\t\t\t\tif(commonViews){\r\n\t\t\t\t\tcommonViews.forEach((function(viewId){\r\n\t\t\t\t\t\tthis.$ui.getView(viewId).$config.$skipSmartRenderOnScroll = true;\r\n\t\t\t\t\t}).bind(this));\r\n\t\t\t\t}\r\n\r\n\t\t\t\thorizontal.scroll(left);\r\n\t\t\t\tif(commonViews){\r\n\t\t\t\t\tcommonViews.forEach((function(viewId){\r\n\t\t\t\t\t\tthis.$ui.getView(viewId).$config.$skipSmartRenderOnScroll = false;\r\n\t\t\t\t\t}).bind(this));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(scrollVertical){\r\n\t\t\t\tvertical.scroll(top);\r\n\t\t\t}\r\n\r\n\t\t\tvar newV = {position: 0},\r\n\t\t\t\tnewH = {position: 0};\r\n\t\t\tif(vertical){\r\n\t\t\t\tnewV = vertical.getScrollState();\r\n\t\t\t}\r\n\t\t\tif(horizontal){\r\n\t\t\t\tnewH = horizontal.getScrollState();\r\n\t\t\t}\r\n\r\n\t\t\tthis.callEvent(\"onGanttScroll\", [oldH.position, oldV.position, newH.position, newV.position]);\r\n\t\t},\r\n\r\n\t\tshowDate: function(date){\r\n\t\t\tvar date_x = this.posFromDate(date);\r\n\t\t\tvar scroll_to = Math.max(date_x - this.config.task_scroll_offset, 0);\r\n\t\t\tthis.scrollTo(scroll_to);\r\n\t\t},\r\n\t\tshowTask: function(id) {\r\n\t\t\tvar pos = this.getTaskPosition(this.getTask(id));\r\n\r\n\t\t\t// GS-1261: we need to show the start_date even in the RTL mode\r\n\t\t\tvar leftPos = pos.left;\r\n\t\t\tif (this.config.rtl) leftPos = pos.left + pos.width;\r\n\r\n\t\t\tvar left = Math.max(leftPos - this.config.task_scroll_offset, 0);\r\n\r\n\t\t\tvar dataHeight = this._scroll_state().y;\r\n\t\t\tvar top;\r\n\t\t\tif(!dataHeight){\r\n\t\t\t\ttop = pos.top;\r\n\t\t\t}else{\r\n\t\t\t\ttop = pos.top - (dataHeight - this.getTaskBarHeight(id))/2;\r\n\t\t\t}\r\n\r\n\t\t\tthis.scrollTo(left, top);\r\n\t\t\t// GS-1150: if the grid and timeline have different scrollbars, we need to scroll thegrid to show the task\r\n\t\t\tvar gridCell = getGrid(this);\r\n\t\t\tvar timelineCell = getTimeline(this);\r\n\t\t\tif (gridCell && timelineCell && gridCell.$config.scrollY != timelineCell.$config.scrollY){\r\n\t\t\t\tvar gridScrollbar = getAttachedScrollbar(this, gridCell, \"scrollY\");\r\n\t\t\t\tgridScrollbar.scrollTo(null, top);\r\n\t\t\t}\r\n\t\t},\r\n\t\t_scroll_state: function(){\r\n\t\t\tvar result = {\r\n\t\t\t\tx: false,\r\n\t\t\t\ty: false,\r\n\t\t\t\tx_pos: 0,\r\n\t\t\t\ty_pos: 0,\r\n\t\t\t\tscroll_size: this.config.scroll_size + 1,//1px for inner content\r\n\t\t\t\tx_inner: 0,\r\n\t\t\t\ty_inner: 0\r\n\t\t\t};\r\n\r\n\t\t\tvar scrollVer = getVerticalScrollbar(this),\r\n\t\t\t\tscrollHor = getHorizontalScrollbar(this);\r\n\t\t\tif(scrollHor){\r\n\t\t\t\tvar horState = scrollHor.getScrollState();\r\n\t\t\t\tif(horState.visible){\r\n\t\t\t\t\tresult.x = horState.size;\r\n\t\t\t\t\tresult.x_inner = horState.scrollSize;\r\n\t\t\t\t}\r\n\t\t\t\tresult.x_pos = horState.position || 0;\r\n\t\t\t}\r\n\r\n\t\t\tif(scrollVer){\r\n\t\t\t\tvar verState = scrollVer.getScrollState();\r\n\t\t\t\tif(verState.visible){\r\n\t\t\t\t\tresult.y = verState.size;\r\n\r\n\t\t\t\t\tresult.y_inner = verState.scrollSize;\r\n\t\t\t\t}\r\n\t\t\t\tresult.y_pos = verState.position || 0;\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\tgetScrollState: function(){\r\n\t\t\tvar state = this._scroll_state();\r\n\t\t\treturn { x:state.x_pos, y:state.y_pos, inner_width:state.x, inner_height:state.y, width: state.x_inner, height: state.y_inner };\r\n\t\t},\r\n\r\n\t\tgetLayoutView: function(cellName){\r\n\t\t\treturn this.$ui.getView(cellName);\r\n\t\t},\r\n\r\n\t\tscrollLayoutCell: function(cellName, left, top){\r\n\t\t\tconst cell = this.$ui.getView(cellName);\r\n\t\t\tif (!cell){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (left !== null){\r\n\t\t\t\tconst horizontalScroll = this.$ui.getView(cell.$config.scrollX);\r\n\t\t\t\tif (horizontalScroll){\r\n\t\t\t\t\thorizontalScroll.scrollTo(left, null);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (top !== null){\r\n\t\t\t\tconst verticalScroll = this.$ui.getView(cell.$config.scrollY);\r\n\t\t\t\tif (verticalScroll){\r\n\t\t\t\t\tverticalScroll.scrollTo(null, top);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t};\r\n\r\n}\r\n\r\nexport default createLayoutFacade;","export default function(gantt) {\r\n\tdelete gantt.addTaskLayer;\r\n\tdelete gantt.addLinkLayer;\r\n};","function _configure(col, data, force) {\r\n\tfor (var key in data)\r\n\t\tif (typeof col[key] == \"undefined\" || force)\r\n\t\t\tcol[key] = data[key];\r\n}\r\n\r\nfunction _get_skin(force, gantt) {\r\n\r\n\tconst styles = getComputedStyle(gantt.$root);\r\n\tconst themeVar = styles.getPropertyValue(\"--dhx-gantt-theme\");\r\n\tlet isCssVarTheme = !!themeVar;\r\n\tlet themeName;\r\n\r\n\t\r\n\tif(isCssVarTheme){\r\n\t\tthemeName = themeVar;\r\n\t}else{\r\n\t\tvar skin = gantt.skin;\r\n\t\tthemeName = skin;\r\n\t\tif (!skin || force) {\r\n\t\t\tvar links = document.getElementsByTagName(\"link\");\r\n\t\t\tfor (var i = 0; i < links.length; i++) {\r\n\t\t\t\tvar res = links[i].href.match(\"dhtmlxgantt_([a-z_]+).css\");\r\n\t\t\t\tif (res) {\r\n\t\t\t\t\tif (gantt.skins[res[1]] || !skin) {\r\n\t\t\t\t\t\tthemeName = res[1];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tgantt._theme_info = {\r\n\t\ttheme: themeName,\r\n\t\tcssVarTheme: isCssVarTheme\r\n\t};\r\n\r\n\r\n\r\n\tgantt.skin = themeName || \"terrace\";\r\n\tvar skinset = gantt.skins[gantt.skin] || gantt.skins[\"terrace\"];\r\n\r\n\t//apply skin related settings\r\n\t_configure(gantt.config, skinset.config, force);\r\n\r\n\tif(!isCssVarTheme){\r\n\t\tgantt.config.link_radius = 1;\r\n\t}\r\n\r\n\tvar config = gantt.getGridColumns();\r\n\tif (config[1] && !gantt.defined(config[1].width))\r\n\t\tconfig[1].width = skinset._second_column_width;\r\n\tif (config[2] && !gantt.defined(config[2].width))\r\n\t\tconfig[2].width = skinset._third_column_width;\r\n\t\r\n\tfor (var i=0; i<config.length; i++) {\r\n\t\tvar column = config[i];\r\n\t\tif (column.name == \"add\") {\r\n\t\t\tif(!column.width){\r\n\t\t\t\tcolumn.width = 44;\r\n\t\t\t}\r\n\t\t\tif (!(gantt.defined(column.min_width) && gantt.defined(column.max_width))) {\r\n\t\t\t\tcolumn.min_width = column.min_width || column.width;\r\n\t\t\t\tcolumn.max_width = column.max_width || column.width;\r\n\t\t\t}\r\n\t\t\tif (column.min_width)\r\n\t\t\t\tcolumn.min_width = +column.min_width;\r\n\t\t\tif (column.max_width)\r\n\t\t\t\tcolumn.max_width = +column.max_width;\r\n\t\t\tif (column.width) {\r\n\t\t\t\tcolumn.width = +column.width;\r\n\t\t\t\tcolumn.width = (column.min_width && column.min_width > column.width) ? column.min_width : column.width;\r\n\t\t\t\tcolumn.width = (column.max_width && column.max_width < column.width) ? column.max_width : column.width;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (skinset.config.task_height){\r\n\t\tgantt.config.task_height = skinset.config.task_height || \"full\";\r\n\t}\r\n\tif (skinset.config.bar_height){\r\n\t\tgantt.config.bar_height = skinset.config.bar_height || \"full\";\r\n\t}\r\n\r\n\tif (skinset._lightbox_template)\r\n\t\tgantt._lightbox_template = skinset._lightbox_template;\r\n\r\n\tif (skinset._redefine_lightbox_buttons) {\r\n\t\tgantt.config.buttons_right = skinset._redefine_lightbox_buttons[\"buttons_right\"];\r\n\t\tgantt.config.buttons_left = skinset._redefine_lightbox_buttons[\"buttons_left\"];\r\n\t}\r\n\r\n\r\n\tgantt.resetLightbox();\r\n}\r\n\r\n\r\n\r\nexport default function(gantt) {\r\n\t\r\n\tif(!gantt.resetSkin){\r\n\t\tgantt.resetSkin = function () {\r\n\t\t\tthis.skin = \"\";\r\n\t\t\t_get_skin(true, this);\r\n\t\t};\r\n\t\tgantt.skins = {};\r\n\r\n\t\tgantt.attachEvent(\"onGanttLayoutReady\", function(){\r\n\t\t\t_get_skin(false, this);\r\n\t\t\tmonitorThemeChange();\r\n\t\t});\r\n\t}\r\n\r\n\tgantt._addThemeClass = function(){\r\n\t\tdocument.documentElement.setAttribute(\"data-gantt-theme\", gantt.skin);\r\n\t};\r\n\r\n\tgantt.setSkin = function(value){\r\n\t\tthis.skin = value;\r\n\t\tgantt._addThemeClass();\r\n\t\tmonitorThemeChange();\r\n\t\tif(gantt.$root){\r\n\t\t\t_get_skin(true, gantt);\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t\t\r\n\t\t//\r\n\t};\r\n\r\n\r\n\tlet monitorIntervalId = null;\r\n\tfunction monitorThemeChange(){\r\n\t\tconst container = gantt.$root;\r\n\t\t\r\n\t\tif(monitorIntervalId){\r\n\t\t\tclearInterval(monitorIntervalId);\r\n\t\t}\r\n\t\t\r\n\t\tif(container){\r\n\t\t\tmonitorIntervalId = setInterval(() => {\r\n\t\t\t\tconst csstheme = getComputedStyle(container).getPropertyValue('--dhx-gantt-theme');\r\n\t\t\t\tif(csstheme && csstheme !== gantt.skin){\r\n\t\t\t\t\tgantt.setSkin(csstheme);\r\n\t\t\t\t}\r\n\r\n\t\t\t}, 100);\r\n\t\t}\r\n\t}\r\n\tgantt.attachEvent(\"onDestroy\", function(){\r\n\t\tclearInterval(monitorIntervalId);\r\n\t});\r\n};","export default function(gantt) {\r\ngantt.skins.skyblue = {\r\n\tconfig:{\r\n\t\tgrid_width:370,\r\n\t\trow_height: 27,\r\n\t\tbar_height_padding:4,\r\n\t\tscale_height: 27,\r\n\t\tlink_line_width:1,\r\n\t\tlink_arrow_size:8,\r\n\t\tlink_radius:2,\r\n\t\tlightbox_additional_height:75\r\n\t},\r\n\t_second_column_width:95,\r\n\t_third_column_width:80\r\n};\r\n\r\n};","export default function(gantt) {\r\ngantt.skins.meadow = {\r\n\tconfig:{\r\n\t\tgrid_width:380,\r\n\t\trow_height: 27,\r\n\t\tscale_height: 30,\r\n\t\tlink_line_width:2,\r\n\t\tlink_arrow_size:10,\r\n\t\tbar_height_padding:4,\r\n\t\tlightbox_additional_height:72\r\n\t},\r\n\t_second_column_width:95,\r\n\t_third_column_width:80\r\n};\r\n\r\n};","export default function(gantt) {\r\ngantt.skins.terrace = {\r\n\tconfig:{\r\n\t\tgrid_width:390,\r\n\t\trow_height: 36,\r\n\t\tscale_height: 36,\r\n\t\tlink_line_width:2,\r\n\t\tlink_arrow_size:12,\r\n\t\tbar_height_padding:9,\r\n\t\tlightbox_additional_height:75\r\n\t},\r\n\t_second_column_width:100,\r\n\t_third_column_width:70\t\t\r\n};\r\n\r\n};","export default function(gantt) {\r\n\tgantt.skins.broadway = {\r\n\t\tconfig: {\r\n\t\t\tgrid_width: 390,\r\n\t\t\trow_height: 35,\r\n\t\t\tscale_height: 35,\r\n\t\t\tlink_line_width: 1,\r\n\t\t\tlink_arrow_size: 9,\r\n\t\t\tbar_height_padding:4,\r\n\t\t\tlightbox_additional_height: 86\r\n\t\t},\r\n\t\t_second_column_width: 100,\r\n\t\t_third_column_width: 80,\r\n\r\n\t\t_lightbox_template: \"<div class='gantt_cal_ltitle'><span class='gantt_mark'>&nbsp;</span><span class='gantt_time'></span><span class='gantt_title'></span><div class='gantt_cancel_btn'></div></div><div class='gantt_cal_larea'></div>\",\r\n\t\t_config_buttons_left: {},\r\n\t\t_config_buttons_right: {\r\n\t\t\t\"gantt_delete_btn\": \"icon_delete\",\r\n\t\t\t\"gantt_save_btn\": \"icon_save\"\r\n\t\t}\r\n\t};\r\n};","export default function(gantt) {\r\n\tgantt.skins.material = {\r\n\t\tconfig: {\r\n\t\t\tgrid_width: 411,\r\n\t\t\trow_height: 34,\r\n\t\t\tscale_height: 36,\r\n\t\t\tlink_line_width: 2,\r\n\t\t\tlink_arrow_size: 12,\r\n\t\t\tbar_height_padding:9,\r\n\t\t\tlightbox_additional_height: 80\r\n\t\t},\r\n\t\t_second_column_width: 110,\r\n\t\t_third_column_width: 75,\r\n\t\t_redefine_lightbox_buttons: {\r\n\t\t\t\"buttons_left\": [\"dhx_delete_btn\"],\r\n\t\t\t\"buttons_right\": [\"dhx_cancel_btn\", \"dhx_save_btn\"]\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.attachEvent(\"onAfterTaskDrag\", function (id) {\r\n\t\tvar t = gantt.getTaskNode(id);\r\n\t\tif (t) {\r\n\t\t\tt.className += \" gantt_drag_animation\";\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tvar indx = t.className.indexOf(\" gantt_drag_animation\");\r\n\t\t\t\tif (indx > -1) {\r\n\t\t\t\t\tt.className = t.className.slice(0, indx);\r\n\t\t\t\t}\r\n\t\t\t}, 200);\r\n\t\t}\r\n\t});\r\n\r\n};","export default function(gantt) {\r\ngantt.skins.dark = {\r\n\tconfig:{\r\n\t\tgrid_width:390,\r\n\t\trow_height: 36,\r\n\t\tscale_height: 36,\r\n\t\tlink_line_width:2,\r\n\t\tlink_arrow_size:12,\r\n\t\tbar_height_padding:9,\r\n\t\tlightbox_additional_height:75\r\n\t},\r\n\t_second_column_width:100,\r\n\t_third_column_width:70\t\t\r\n};\r\n\r\n};","export default function(gantt) {\r\ngantt.skins[\"contrast_black\"] = {\r\n\tconfig:{\r\n\t\tgrid_width:390,\r\n\t\trow_height: 35,\r\n\t\tscale_height: 35,\r\n\t\tlink_line_width:2,\r\n\t\tlink_arrow_size:12,\r\n\t\tlightbox_additional_height:75\r\n\t},\r\n\t_second_column_width:100,\r\n\t_third_column_width:80\r\n};\r\n\r\n};","export default function(gantt) {\r\ngantt.skins[\"contrast_white\"] = {\r\n\tconfig:{\r\n\t\tgrid_width:390,\r\n\t\trow_height: 35,\r\n\t\tscale_height: 35,\r\n\t\tlink_line_width:2,\r\n\t\tlink_arrow_size:12,\r\n\t\tlightbox_additional_height:75\r\n\t},\r\n\t_second_column_width:100,\r\n\t_third_column_width:80\r\n};\r\n\r\n};","import * as domHelpers from \"../utils/dom_helpers\";\r\nimport isHeadless from \"../../../utils/is_headless\";\r\n\r\nexport default function(gantt){\r\n\r\n\tvar scrollRange = 50,\r\n\t\tscrollStep = 30,\r\n\t\tscrollDelay = 10,\r\n\t\tscrollSpeed = 50;\r\n\r\n\tvar interval = null,\r\n\t\tisMove = false,\r\n\t\tdelayTimeout = null,\r\n\t\tstartPos = {\r\n\t\t\tstarted: false\r\n\t\t},\r\n\t\teventPos = {};\r\n\r\n\r\n\tfunction isDisplayed(element){\r\n\t\treturn element &&\r\n\t\t\tdomHelpers.isChildOf(element, gantt.$root) &&\r\n\t\t\telement.offsetHeight;\r\n\t}\r\n\r\n\tfunction getAutoscrollContainer(){\r\n\t\tvar element;\r\n\t\tif(isDisplayed(gantt.$task)){\r\n\t\t\telement = gantt.$task;\r\n\t\t}else if(isDisplayed(gantt.$grid)){\r\n\t\t\telement = gantt.$grid;\r\n\t\t}else{\r\n\t\t\telement = gantt.$root;\r\n\t\t}\r\n\r\n\t\treturn element;\r\n\t}\r\n\r\n\tfunction isScrollState() {\r\n\t\tvar dragMarker = !!document.querySelector(\".gantt_drag_marker\");\r\n\t\tvar isResize = !!document.querySelector(\".gantt_drag_marker.gantt_grid_resize_area\")\r\n\t\t\t|| !!document.querySelector(\".gantt_drag_marker.gantt_row_grid_resize_area\") ;\r\n\t\tvar isLink = !!document.querySelector(\".gantt_link_direction\");\r\n\t\tvar state = gantt.getState();\r\n\t\tvar isClickDrag = state.autoscroll;\r\n\t\tisMove = dragMarker && !isResize && !isLink;\r\n\r\n\t\treturn !((!state.drag_mode && !dragMarker) || isResize) || isClickDrag;\r\n\t}\r\n\r\n\tfunction defineDelayTimeout(state) {\r\n\t\tif (delayTimeout) {\r\n\t\t\tclearTimeout(delayTimeout);\r\n\t\t\tdelayTimeout = null;\r\n\t\t}\r\n\t\tif (state) {\r\n\t\t\tvar speed = gantt.config.autoscroll_speed;\r\n\t\t\tif (speed && speed < 10) // limit speed value to 10\r\n\t\t\t\tspeed = 10;\r\n\r\n\t\t\tdelayTimeout = setTimeout(function() {\r\n\t\t\t\tinterval = setInterval(tick, speed || scrollSpeed);\r\n\t\t\t}, gantt.config.autoscroll_delay || scrollDelay);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction defineScrollInterval(state) {\r\n\t\tif (state) {\r\n\t\t\tdefineDelayTimeout(true);\r\n\t\t\tif (!startPos.started) {\r\n\t\t\t\tstartPos.x = eventPos.x;\r\n\t\t\t\tstartPos.y = eventPos.y;\r\n\t\t\t\tstartPos.started = true;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (interval) {\r\n\t\t\t\tclearInterval(interval);\r\n\t\t\t\tinterval = null;\r\n\t\t\t}\r\n\t\t\tdefineDelayTimeout(false);\r\n\t\t\tstartPos.started = false;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction autoscrollInterval(event) {\r\n\t\tvar isScroll = isScrollState();\r\n\r\n\t\tif ((interval || delayTimeout) && !isScroll) {\r\n\t\t\tdefineScrollInterval(false);\r\n\t\t}\r\n\r\n\t\tif (!gantt.config.autoscroll || !isScroll) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\teventPos = {\r\n\t\t\tx: event.clientX,\r\n\t\t\ty: event.clientY\r\n\t\t};\r\n\r\n\t\t// if it is a mobile device, we need to detect the touch event coords\r\n\t\tif (event.type == \"touchmove\"){\r\n\t\t\teventPos.x = event.targetTouches[0].clientX;\r\n\t\t\teventPos.y = event.targetTouches[0].clientY;\r\n\t\t}\r\n\r\n\t\tif (!interval && isScroll) {\r\n\t\t\tdefineScrollInterval(true);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction tick() {\r\n\r\n\t\tif (!isScrollState()) {\r\n\t\t\tdefineScrollInterval(false);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar container = getAutoscrollContainer();\r\n\t\tif(!container){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// GS-1150: if we reorder or resize something in the grid, we should obtain the grid container\r\n\t\tvar gridDrag = false;\r\n\t\tvar gridMarkers = [\r\n\t\t\t\".gantt_drag_marker.gantt_grid_resize_area\",\r\n\t\t\t\".gantt_drag_marker .gantt_row.gantt_row_task\",\r\n\t\t\t\".gantt_drag_marker.gantt_grid_dnd_marker\"\r\n\t\t];\r\n\t\tgridMarkers.forEach(function (selector) {\r\n\t\t\tgridDrag = gridDrag || !!document.querySelector(selector);\r\n\t\t});\r\n\t\tif (gridDrag){\r\n\t\t\tcontainer = gantt.$grid;\r\n\t\t}\r\n\r\n\t\tvar box = domHelpers.getNodePosition(container);\r\n\r\n\t\tvar posX = eventPos.x - box.x;\r\n\t\tvar posY = eventPos.y - box.y + window.scrollY; // GS-1315: window.scrollY here and below for the elements above Gantt\r\n\r\n\t\tvar scrollLeft = isMove ? 0 : need_scroll(posX, box.width, startPos.x - box.x);\r\n\t\tvar scrollTop = need_scroll(posY, box.height, startPos.y - box.y + window.scrollY);\r\n\r\n\t\tvar scrollState = gantt.getScrollState();\r\n\r\n\t\tvar currentScrollTop = scrollState.y,\r\n\t\t\tscrollOuterHeight = scrollState.inner_height,\r\n\t\t\tscrollInnerHeight = scrollState.height,\r\n\t\t\tcurrentScrollLeft = scrollState.x,\r\n\t\t\tscrollOuterWidth = scrollState.inner_width,\r\n\t\t\tscrollInnerWidth = scrollState.width;\r\n\r\n\t\t// do scrolling only if we have scrollable area to do so\r\n\t\tif (scrollTop && !scrollOuterHeight) {\r\n\t\t\tscrollTop = 0;\r\n\t\t} else if (scrollTop < 0 && !currentScrollTop) {\r\n\t\t\tscrollTop = 0;\r\n\t\t} else if (scrollTop > 0 && currentScrollTop + scrollOuterHeight >= scrollInnerHeight + 2) {\r\n\t\t\tscrollTop = 0;\r\n\t\t}\r\n\r\n\t\tif (scrollLeft && !scrollOuterWidth) {\r\n\t\t\tscrollLeft = 0;\r\n\t\t} else if (scrollLeft < 0 && !currentScrollLeft) {\r\n\t\t\tscrollLeft = 0;\r\n\t\t} else if (scrollLeft > 0 && currentScrollLeft + scrollOuterWidth >= scrollInnerWidth) {\r\n\t\t\tscrollLeft = 0;\r\n\t\t}\r\n\r\n\t\tvar step = gantt.config.autoscroll_step;\r\n\r\n\t\tif (step && step < 2) // limit step value to 2\r\n\t\t\tstep = 2;\r\n\r\n\t\tscrollLeft = scrollLeft * (step || scrollStep);\r\n\t\tscrollTop = scrollTop * (step || scrollStep);\r\n\r\n\t\tif (scrollLeft || scrollTop) {\r\n\t\t\tscroll(scrollLeft, scrollTop);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction need_scroll(pos, boxSize, startCoord) {\r\n\t\tif ((pos - scrollRange < 0) && (pos < startCoord))\r\n\t\t\treturn -1;\r\n\t\telse if ((pos > boxSize - scrollRange) && (pos > startCoord))\r\n\t\t\treturn 1;\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tfunction scroll(left, top) {\r\n\t\tvar scrollState = gantt.getScrollState();\r\n\r\n\t\tvar scrollLeft = null,\r\n\t\t\tscrollTop = null;\r\n\r\n\t\tif (left) {\r\n\t\t\tscrollLeft = scrollState.x + left;\r\n\t\t\tscrollLeft = Math.min(scrollState.width, scrollLeft);\r\n\t\t\tscrollLeft = Math.max(0, scrollLeft);\r\n\t\t}\r\n\r\n\t\tif (top) {\r\n\t\t\tscrollTop = scrollState.y + top;\r\n\t\t\tscrollTop = Math.min(scrollState.height, scrollTop);\r\n\t\t\tscrollTop = Math.max(0, scrollTop);\r\n\t\t}\r\n\r\n\t\tgantt.scrollTo(scrollLeft, scrollTop);\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onGanttReady\", function() {\r\n\t\tif(!isHeadless(gantt)){\r\n\t\t\tvar eventElement = domHelpers.getRootNode(gantt.$root) || document.body;\r\n\t\t\tgantt.eventRemove(eventElement, \"mousemove\", autoscrollInterval);\r\n\t\t\tgantt.event(eventElement, \"mousemove\", autoscrollInterval);\r\n\r\n\t\t\tgantt.eventRemove(eventElement, \"touchmove\", autoscrollInterval);\r\n\t\t\tgantt.event(eventElement, \"touchmove\", autoscrollInterval);\r\n\r\n\t\t\tgantt.eventRemove(eventElement, \"pointermove\", autoscrollInterval);\r\n\t\t\tgantt.event(eventElement, \"pointermove\", autoscrollInterval);\r\n\t\t}\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onDestroy\", function(){\r\n\t\tdefineScrollInterval(false);\r\n\t});\r\n\r\n};","if (window.jQuery){\r\n\r\n\t(function( $ ){\r\n\r\n\t\tvar methods = [];\r\n\t\t$.fn.dhx_gantt = function(config){\r\n\t\t\tconfig = config || {};\r\n\t\t\tif (typeof(config) === 'string') {\r\n\t\t\t\tif (methods[config] ) {\r\n\t\t\t\t\treturn methods[config].apply(this, []);\r\n\t\t\t\t}else {\r\n\t\t\t\t\t$.error('Method ' +  config + ' does not exist on jQuery.dhx_gantt');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar views = [];\r\n\t\t\t\tthis.each(function() {\r\n\t\t\t\t\tif (this && this.getAttribute){\r\n\t\t\t\t\t\tif (!this.gantt && !(window.gantt.$root == this)){\r\n\r\n\t\t\t\t\t\t\tvar newgantt = (window.gantt.$container && window.Gantt) ? window.Gantt.getGanttInstance():window.gantt;\r\n\t\t\t\t\t\t\tfor (var key in config)\r\n\t\t\t\t\t\t\t\tif (key!=\"data\")\r\n\t\t\t\t\t\t\t\t\tnewgantt.config[key] = config[key];\r\n\r\n\t\t\t\t\t\t\tnewgantt.init(this);\r\n\t\t\t\t\t\t\tif (config.data)\r\n\t\t\t\t\t\t\t\tnewgantt.parse(config.data);\r\n\r\n\t\t\t\t\t\t\tviews.push(newgantt);\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tviews.push(typeof this.gantt == \"object\" ? this.gantt : window.gantt);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\r\n\t\t\t\tif (views.length === 1) return views[0];\r\n\t\t\t\treturn views;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t})(window.jQuery);\r\n\r\n}\r\n\r\n\r\nexport default null;","if (window.dhtmlx){\r\n\r\n\tif (!window.dhtmlx.attaches)\r\n\twindow.dhtmlx.attaches = {};\r\n\r\n\twindow.dhtmlx.attaches.attachGantt=function(start, end, gantt){\r\n\t\tvar obj = document.createElement(\"DIV\");\r\n\r\n\t\tgantt = gantt || window.gantt;\r\n\r\n\t\tobj.id = \"gantt_\"+ gantt.uid();\r\n\t\tobj.style.width = \"100%\";\r\n\t\tobj.style.height = \"100%\";\r\n\t\tobj.cmp = \"grid\";\r\n\r\n\t\tdocument.body.appendChild(obj);\r\n\t\tthis.attachObject(obj.id);\r\n\t\tthis.dataType = \"gantt\";\r\n\t\tthis.dataObj = gantt;\r\n\r\n\t\tvar that = this.vs[this.av];\r\n\t\tthat.grid = gantt;\r\n\r\n\t\tgantt.init(obj.id, start, end);\r\n\t\tobj.firstChild.style.border = \"none\";\r\n\r\n\t\tthat.gridId = obj.id;\r\n\t\tthat.gridObj = obj;\r\n\r\n\t\tvar method_name=\"_viewRestore\";\r\n\t\treturn this.vs[this[method_name]()].grid;\r\n\t};\r\n\r\n}\r\nif (typeof(window.dhtmlXCellObject) != \"undefined\") {\r\n\r\n\twindow.dhtmlXCellObject.prototype.attachGantt=function(start, end, gantt){\r\n\t\tgantt = gantt || window.gantt;\r\n\r\n\t\tvar obj = document.createElement(\"DIV\");\r\n\t\tobj.id = \"gantt_\"+gantt.uid();\r\n\t\tobj.style.width = \"100%\";\r\n\t\tobj.style.height = \"100%\";\r\n\t\tobj.cmp = \"grid\";\r\n\r\n\t\tdocument.body.appendChild(obj);\r\n\t\tthis.attachObject(obj.id);\r\n\r\n\t\tthis.dataType = \"gantt\";\r\n\t\tthis.dataObj = gantt;\r\n\r\n\t\tgantt.init(obj.id, start, end);\r\n\t\tobj.firstChild.style.border = \"none\";\r\n\r\n\t\tobj = null;\r\n\t\tthis.callEvent(\"_onContentAttach\",[]);\r\n\r\n\t\treturn this.dataObj;\r\n\t};\r\n}\r\n\r\nexport default null;","import env from \"../../../utils/env\";\r\nimport eventable from \"../../../utils/eventable\";\r\nimport { IScale, TModifierKeys } from \"../../common/config\";\r\n\r\ninterface ITimelineZoomConfig {\r\n\thandler?: (e: Event) => {};\r\n\tstartDate?: Date;\r\n\tendDate?: Date;\r\n\tlevels: IZoomLevel[];\r\n\tactiveLevelIndex?: number;\r\n\twidthStep?: number;\r\n\tminColumnWidth?: number;\r\n\tmaxColumnWidth?: number;\r\n\tuseKey?: \"ctrlKey\" | \"altKey\" | \"shiftKey\";\r\n\ttrigger?: \"wheel\" | null | undefined;\r\n\telement?: Element | (() => Element);\r\n}\r\n\r\nconst USE_KEY = [\"ctrlKey\", \"altKey\", \"shiftKey\", \"metaKey\"];\r\n\r\ninterface IZoomLevel {\r\n\tname?: string;\r\n\tscale_height?: number;\r\n\tmin_column_width: number;\r\n\tscales: IScale[];\r\n}\r\n\r\nconst _defaultScales = [\r\n\t[\r\n\t\t{\r\n\t\t\tunit: \"month\",\r\n\t\t\tdate: \"%M\",\r\n\t\t\tstep: 1\r\n\t\t},\r\n\t\t{\r\n\t\t\tunit: \"day\",\r\n\t\t\tdate: \"%d\",\r\n\t\t\tstep: 1\r\n\t\t}\r\n\t],\r\n\t[\r\n\t\t{\r\n\t\t\tunit: \"day\",\r\n\t\t\tdate: \"%d %M\",\r\n\t\t\tstep: 1\r\n\t\t}\r\n\t],\r\n\t[\r\n\t\t{\r\n\t\t\tunit: \"day\",\r\n\t\t\tdate: \"%d %M\",\r\n\t\t\tstep: 1\r\n\t\t},\r\n\t\t{\r\n\t\t\tunit: \"hour\",\r\n\t\t\tdate: \"%H:00\",\r\n\t\t\tstep: 8\r\n\t\t}\r\n\t],\r\n\t[\r\n\t\t{\r\n\t\t\tunit: \"day\",\r\n\t\t\tdate: \"%d %M\",\r\n\t\t\tstep: 1\r\n\t\t},\r\n\t\t{\r\n\t\t\tunit: \"hour\",\r\n\t\t\tdate: \"%H:00\",\r\n\t\t\tstep: 1\r\n\t\t}\r\n\t]\r\n];\r\n\r\nexport default class TimelineZoom {\r\n\tpublic attachEvent: (eventName: string, handler: () => void) => string;\r\n\tpublic callEvent: (eventName: string, args: any[]) => any;\r\n\tpublic detachEvent: (eventName: string) => any;\r\n\tprotected _initialStartDate: Date;\r\n\tprotected _initialEndDate: Date;\r\n\tprotected _activeLevelIndex: number;\r\n\tprotected _levels: IZoomLevel[];\r\n\tprotected _handler: (e: any) => void;\r\n\tprotected $gantt;\r\n\tprotected _widthStep: number;\r\n\tprotected _minColumnWidth: number;\r\n\tprotected _maxColumnWidth: number;\r\n\tprotected _useKey: TModifierKeys;\r\n\tprotected _visibleDate: Date;\r\n\tprotected _initialized: boolean;\r\n\tprotected _domEvents: any;\r\n\r\n\tconstructor(gantt) {\r\n\t\tthis.$gantt = gantt;\r\n\t\tthis._domEvents = this.$gantt._createDomEventScope();\r\n\t}\r\n\r\n\tpublic init(config: ITimelineZoomConfig) {\r\n\t\t// GS-1354 and GS-1318. If we check the headless mode using the function,\r\n\t\t// it will return false when Gantt is not initialized, but we may want to do it later\r\n\t\tif(this.$gantt.env.isNode){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._initialStartDate = config.startDate;\r\n\t\tthis._initialEndDate = config.endDate;\r\n\t\tthis._activeLevelIndex = config.activeLevelIndex ? config.activeLevelIndex : 0;\r\n\t\tthis._levels = this._mapScales(config.levels || _defaultScales);\r\n\t\tthis._handler = config.handler || this._defaultHandler;\r\n\t\tthis._minColumnWidth = config.minColumnWidth || 60;\r\n\t\tthis._maxColumnWidth = config.maxColumnWidth || 240;\r\n\t\tthis._widthStep = config.widthStep || 3/8 * config.minColumnWidth;\r\n\t\tthis._useKey = config.useKey;\r\n\r\n\t\tif(!this._initialized){\r\n\t\t\teventable(this);\r\n\t\t\tthis.$gantt.attachEvent(\"onGanttScroll\", () => {\r\n\t\t\t\tthis._getVisibleDate();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis._domEvents.detachAll();\r\n\r\n\t\tif(config.trigger === \"wheel\"){\r\n\t\t\tif(this.$gantt.$root){\r\n\t\t\t\tthis._attachWheelEvent(config);\r\n\t\t\t}else{\r\n\t\t\t\tthis.$gantt.attachEvent(\"onGanttReady\", () => {\r\n\t\t\t\t\tthis._attachWheelEvent(config);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._initialized = true;\r\n\t\tthis.setLevel(this._activeLevelIndex);\r\n\t}\r\n\r\n\tpublic zoomIn = () => {\r\n\t\tconst index = this.getCurrentLevel() - 1;\r\n\t\tif(index < 0){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.setLevel(index);\r\n\t};\r\n\r\n\tpublic zoomOut = () => {\r\n\t\tconst index = this.getCurrentLevel() + 1;\r\n\t\tif(index > this._levels.length - 1){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.setLevel(index);\r\n\t};\r\n\r\n\tpublic getCurrentLevel = () => {\r\n\t\treturn this._activeLevelIndex;\r\n\t};\r\n\r\n\tpublic getLevels = () => {\r\n\t\treturn this._levels;\r\n\t};\r\n\r\n\tpublic setLevel = (level: number|string) => {\r\n\t\tconst zoomLevel = this._getZoomIndexByName(level);\r\n\r\n\t\tif(zoomLevel === -1){\r\n\t\t\tthis.$gantt.assert(zoomLevel !== -1, \"Invalid zoom level for gantt.ext.zoom.setLevel. \" + level + \" is not an expected value.\");\r\n\t\t}\r\n\t\tthis._setLevel(zoomLevel, 0);\r\n\t};\r\n\r\n\tprotected _getZoomIndexByName = (levelName: number|string) => {\r\n\t\tlet zoomLevel:number = -1;\r\n\t\tif(typeof levelName === \"string\"){\r\n\t\t\tif(!isNaN(Number(levelName)) &&  this._levels[Number(levelName)]){\r\n\t\t\t\tzoomLevel = Number(levelName);\r\n\t\t\t}else{\r\n\t\t\t\tfor(let i = 0; i < this._levels.length; i++){\r\n\t\t\t\t\tif(this._levels[i].name === levelName){\r\n\t\t\t\t\t\tzoomLevel = i;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tzoomLevel = levelName;\r\n\t\t}\r\n\t\treturn zoomLevel;\r\n\t};\r\n\r\n\tprotected _mapScales(levels: IScale[][] | any): IZoomLevel[]{\r\n\t\treturn levels.map((l) => {\r\n\t\t\tif(Array.isArray(l)){\r\n\t\t\t\treturn {\r\n\t\t\t\t\tscales: l\r\n\t\t\t\t};\r\n\t\t\t}else{\r\n\t\t\t\treturn l;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected _getVisibleDate = () => {\r\n\t\t// GS-1450. Don't try to get the visible date if there is no timeline\r\n\t\tif (!this.$gantt.$task){\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tconst scrollPos = this.$gantt.getScrollState().x;\r\n\t\tconst viewPort = this.$gantt.$task.offsetWidth;\r\n\t\tthis._visibleDate = this.$gantt.dateFromPos(scrollPos + viewPort/2);\r\n\t};\r\n\r\n\tprotected _setLevel = (level: number, cursorOffset: number) => {\r\n\t\tthis._activeLevelIndex = level;\r\n\r\n\t\tconst gantt = this.$gantt;\r\n\t\tconst nextConfig = gantt.copy(this._levels[this._activeLevelIndex]);\r\n\t\tconst chartConfig = gantt.copy(nextConfig);\r\n\t\tdelete chartConfig.name;\r\n\r\n\t\tgantt.mixin(gantt.config, chartConfig, true);\r\n\r\n\t\t// GS-1148: Change scales for the resource views\r\n\t\tconst resourceViews = [\r\n\t\t\t\"resourceTimeline\",\r\n\t\t\t\"resourceHistogram\"\r\n\t\t];\r\n\r\n\t\tresourceViews.forEach(function(name){\r\n\t\t\tconst resourceView = gantt.$ui.getView(name);\r\n\t\t\tif (resourceView){\r\n\t\t\t\tconst resourceConfig = resourceView.$getConfig();\r\n\t\t\t\tif (!resourceConfig.fixed_scales){\r\n\t\t\t\t\tgantt.mixin(resourceConfig, chartConfig, true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst isRendered = !!gantt.$root && !!gantt.$task;\r\n\r\n\t\tif(isRendered){\r\n\t\t\tif(cursorOffset){\r\n\t\t\t\tconst cursorDate = this.$gantt.dateFromPos(cursorOffset + this.$gantt.getScrollState().x);\r\n\t\t\t\tthis.$gantt.render();\r\n\t\t\t\tconst newPosition = this.$gantt.posFromDate(cursorDate);\r\n\t\t\t\tthis.$gantt.scrollTo(newPosition - cursorOffset);\r\n\t\t\t}else{\r\n\t\t\t\tconst viewPort = this.$gantt.$task.offsetWidth;\r\n\t\t\t\tif(!this._visibleDate){\r\n\t\t\t\t\tthis._getVisibleDate();\r\n\t\t\t\t}\r\n\t\t\t\tconst middleDate = this._visibleDate;\r\n\t\t\t\tthis.$gantt.render();\r\n\t\t\t\tconst newPosition = this.$gantt.posFromDate(middleDate);\r\n\t\t\t\tthis.$gantt.scrollTo(newPosition - viewPort/2);\r\n\t\t\t}\r\n\r\n\t\t\tthis.callEvent(\"onAfterZoom\", [this._activeLevelIndex, nextConfig]);\r\n\t\t}\r\n\t};\r\n\r\n\tprivate _attachWheelEvent = (config) => {\r\n\t\tconst event = env.isFF ? \"wheel\" : \"mousewheel\";\r\n\t\tlet el: Element;\r\n\t\tif(typeof config.element === \"function\"){\r\n\t\t\tel = config.element();\r\n\t\t}else{\r\n\t\t\tel = config.element as Element;\r\n\t\t}\r\n\t\tif (!el){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._domEvents.attach(el, event, this.$gantt.bind(function(e) {\r\n\t\t\tif (this._useKey) {\r\n\t\t\t\tif (USE_KEY.indexOf(this._useKey) < 0) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tif (!e[this._useKey]) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (typeof this._handler === \"function\") {\r\n\t\t\t\tthis._handler.apply(this, [e]);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}, this), {passive: false});\r\n\t};\r\n\r\n\tprivate _defaultHandler = (e: any):void => {\r\n\t\tconst timelineOffset = this.$gantt.$task.getBoundingClientRect().x;\r\n\t\tconst cursorOffset = e.clientX - timelineOffset;\r\n\t\tconst wheelY = this.$gantt.env.isFF ? (e.deltaY*-40) : e.wheelDelta;\r\n\t\tlet wheelUp = false;\r\n\t\tif (wheelY > 0) {\r\n\t\t\twheelUp = true;\r\n\t\t}\r\n\t\te.preventDefault();\r\n\t\te.stopPropagation();\r\n\t\tthis._setScaleSettings(wheelUp, cursorOffset);\r\n\t};\r\n\r\n\tprivate _setScaleSettings(wheelUp: boolean, cursorOffset: number) {\r\n\t\tif (wheelUp) {\r\n\t\t\tthis._stepUp(cursorOffset);\r\n\t\t} else {\r\n\t\t\tthis._stepDown(cursorOffset);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _setScaleDates = () => {\r\n\t\tif(this._initialStartDate && this._initialEndDate){\r\n\t\t\tthis.$gantt.config.start_date = this._initialStartDate;\r\n\t\t\tthis.$gantt.config.end_date = this._initialEndDate;\r\n\t\t}\r\n\t};\r\n\r\n\tprivate _stepUp(cursorOffset) {\r\n\t\tif (this._activeLevelIndex >= this._levels.length - 1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet nextLevel = this._activeLevelIndex;\r\n\t\tthis._setScaleDates();\r\n\r\n\t\tif(this._widthStep){\r\n\t\t\tlet newColumnWidth = this.$gantt.config.min_column_width + this._widthStep;\r\n\t\t\tif (newColumnWidth > this._maxColumnWidth) {\r\n\t\t\t\tnewColumnWidth = this._minColumnWidth;\r\n\t\t\t\tnextLevel++;\r\n\t\t\t}\r\n\r\n\t\t\tthis.$gantt.config.min_column_width = newColumnWidth;\r\n\t\t}else{\r\n\t\t\tnextLevel++;\r\n\t\t}\r\n\t\tthis._setLevel(nextLevel, cursorOffset);\r\n\t}\r\n\tprivate _stepDown(cursorOffset) {\r\n\t\tif (this._activeLevelIndex < 1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet nextLevel = this._activeLevelIndex;\r\n\t\tthis._setScaleDates();\r\n\r\n\t\tif(this._widthStep){\r\n\t\t\tlet newColumnWidth = this.$gantt.config.min_column_width - this._widthStep;\r\n\t\t\tif (newColumnWidth < this._minColumnWidth) {\r\n\t\t\t\tnewColumnWidth = this._maxColumnWidth;\r\n\t\t\t\tnextLevel--;\r\n\t\t\t}\r\n\t\t\tthis.$gantt.config.min_column_width = newColumnWidth;\r\n\t\t}else{\r\n\t\t\tnextLevel--;\r\n\t\t}\r\n\t\tthis._setLevel(nextLevel, cursorOffset);\r\n\t}\r\n}","import autoscroll from \"./autoscroll\";\r\nimport jquery_hooks from \"./jquery_hooks\";\r\nimport dhtmlx_hooks from \"./dhtmlx_hooks\";\r\nimport TimelineZoom from \"./timeline_zoom\";\r\n\r\n\r\nexport default function(gantt){\r\n\tif(!gantt.ext){\r\n\t\tgantt.ext = {};\r\n\t}\r\n\r\n\tvar modules = [\r\n\t\tautoscroll,\r\n\t\tjquery_hooks,\r\n\t\tdhtmlx_hooks\r\n\t];\r\n\r\n\tfor(var i = 0; i < modules.length; i++){\r\n\t\tif(modules[i])\r\n\t\t\tmodules[i](gantt);\r\n\t}\r\n\r\n\tgantt.ext.zoom = new TimelineZoom(gantt);\r\n};","export default function(gantt) {\r\n\r\n\tgantt.config.touch_drag = 75; //nearly immediate dnd\r\n\tgantt.config.touch = true;\r\n\tgantt.config.touch_feedback = true;\r\n\tgantt.config.touch_feedback_duration = 1;\r\n\tgantt._prevent_touch_scroll = false;\r\n\r\n\r\n\tgantt._touch_feedback = function () {\r\n\t\tif (gantt.config.touch_feedback) {\r\n\t\t\tif (navigator.vibrate)\r\n\t\t\t\tnavigator.vibrate(gantt.config.touch_feedback_duration);\r\n\t\t}\r\n\t};\r\n\r\n\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\t\tif (gantt.$container)\t{\r\n\t\t\taddTouchEvents();\r\n\t\t}\r\n\t});\r\n\tgantt.attachEvent(\"onGanttLayoutReady\", function(){\r\n\t\tif (gantt.$container)\t{\r\n\t\t\t\tgantt.attachEvent(\"onGanttRender\", addTouchEvents, {once: true});\r\n\t\t}\r\n\t});\r\n\r\n\tfunction addTouchEvents(){\r\n\t\tif (gantt.config.touch != \"force\")\r\n\t\t\tgantt.config.touch = gantt.config.touch &&\r\n\t\t\t\t((navigator.userAgent.indexOf(\"Mobile\") != -1) ||\r\n\t\t\t\t\t(navigator.userAgent.indexOf(\"iPad\") != -1) ||\r\n\t\t\t\t\t(navigator.userAgent.indexOf(\"Android\") != -1) ||\r\n\t\t\t\t\t(navigator.userAgent.indexOf(\"Touch\") != -1)) ||\r\n\t\t\t\t\t((navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1));\r\n\r\n\t\tif (gantt.config.touch) {\r\n\r\n\t\t\tvar touchEventsSupported = true;\r\n\t\t\ttry {\r\n\t\t\t\tdocument.createEvent(\"TouchEvent\");\r\n\t\t\t} catch (e) {\r\n\t\t\t\ttouchEventsSupported = false;\r\n\t\t\t}\r\n\r\n\t\t\tif (touchEventsSupported) {\r\n\t\t\t\tgantt._touch_events([\"touchmove\", \"touchstart\", \"touchend\"], function (ev) {\r\n\t\t\t\t\tif (ev.touches && ev.touches.length > 1) return null;\r\n\t\t\t\t\tif (ev.touches[0])\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\ttarget: ev.target,\r\n\t\t\t\t\t\t\tpageX: ev.touches[0].pageX,\r\n\t\t\t\t\t\t\tpageY: ev.touches[0].pageY,\r\n\t\t\t\t\t\t\tclientX: ev.touches[0].clientX,\r\n\t\t\t\t\t\t\tclientY: ev.touches[0].clientY\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\treturn ev;\r\n\t\t\t\t}, function () {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t});\r\n\t\t\t} else if (window.navigator.pointerEnabled) {\r\n\t\t\t\tgantt._touch_events([\"pointermove\", \"pointerdown\", \"pointerup\"], function (ev) {\r\n\t\t\t\t\tif (ev.pointerType == \"mouse\") return null;\r\n\t\t\t\t\treturn ev;\r\n\t\t\t\t}, function (ev) {\r\n\t\t\t\t\treturn (!ev || (ev.pointerType == \"mouse\" ));\r\n\t\t\t\t});\r\n\t\t\t} else if (window.navigator.msPointerEnabled) {\r\n\t\t\t\tgantt._touch_events([\"MSPointerMove\", \"MSPointerDown\", \"MSPointerUp\"], function (ev) {\r\n\t\t\t\t\tif (ev.pointerType == ev.MSPOINTER_TYPE_MOUSE) return null;\r\n\t\t\t\t\treturn ev;\r\n\t\t\t\t}, function (ev) {\r\n\t\t\t\t\treturn (!ev || ev.pointerType == ev.MSPOINTER_TYPE_MOUSE);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tfunction findTargetView(event){\r\n\t\tvar allViews = gantt.$layout.getCellsByType(\"viewCell\");\r\n\r\n\t\tfor(var i = 0; i < allViews.length; i++){\r\n\t\t\tvar box = allViews[i].$view.getBoundingClientRect();\r\n\t\t\tif(event.clientX >= box.left && event.clientX <= box.right &&\r\n\t\t\t\tevent.clientY <= box.bottom && event.clientY >= box.top){\r\n\t\t\t\t\treturn allViews[i];\r\n\t\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getScrollState(view){\r\n\t\tvar scrollX = view.$config.scrollX ? gantt.$ui.getView(view.$config.scrollX) : null;\r\n\t\tvar scrollY = view.$config.scrollY ? gantt.$ui.getView(view.$config.scrollY) : null;\r\n\r\n\t\tvar scrollState = {x: null, y: null};\r\n\t\tif(scrollX){\r\n\t\t\tvar state = scrollX.getScrollState();\r\n\t\t\tif(state.visible){\r\n\t\t\t\tscrollState.x = scrollX.$view.scrollLeft;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(scrollY){\r\n\t\t\tvar state = scrollY.getScrollState();\r\n\t\t\tif(state.visible){\r\n\t\t\t\tscrollState.y = scrollY.$view.scrollTop;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn scrollState;\r\n\t}\r\n\r\n\tfunction scrollView(view, left, top){\r\n\t\tvar scrollX = view.$config.scrollX ? gantt.$ui.getView(view.$config.scrollX) : null;\r\n\t\tvar scrollY = view.$config.scrollY ? gantt.$ui.getView(view.$config.scrollY) : null;\r\n\r\n\t\tif(scrollX){\r\n\t\t\tscrollX.scrollTo(left, null);\r\n\t\t}\r\n\t\tif(scrollY){\r\n\t\t\tscrollY.scrollTo(null, top);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getTaskDND(){\r\n\t\tvar tasksDnD;\r\n\t\tif(gantt.$ui.getView(\"timeline\")){\r\n\t\t\ttasksDnD = gantt.$ui.getView(\"timeline\")._tasks_dnd;\r\n\t\t}\r\n\t\treturn tasksDnD;\r\n\t}\r\n\r\n\tvar touchHandlers = [];\r\n\r\n//we can't use native scrolling, as we need to sync momentum between different parts\r\n//so we will block native scroll and use the custom one\r\n//in future we can add custom momentum\r\n\tgantt._touch_events = function (names, accessor, ignore) {\r\n\t\t//webkit on android need to be handled separately\r\n\t\tvar dblclicktime = 0;\r\n\t\tvar actionMode = false;\r\n\t\tvar scrollMode = false;\r\n\t\tvar actionStart = null;\r\n\t\tvar scrollState;\r\n\t\tvar longTapTimer = null;\r\n\t\tvar currentDndId = null;\r\n\t\tvar dndNodes = [];\r\n\t\tvar targetView = null;\r\n\t\tlet multiTouchEvents = {};\r\n\r\n\t\tfor(var i = 0; i < touchHandlers.length; i++){\r\n\t\t\tgantt.eventRemove(touchHandlers[i][0], touchHandlers[i][1], touchHandlers[i][2]);\r\n\t\t}\r\n\t\ttouchHandlers = [];\r\n\r\n\t\t//touch move\r\n\t\ttouchHandlers.push([gantt.$container, names[0], function (e) {\r\n\t\t\tvar tasksDnD = getTaskDND();\r\n\r\n\t\t\t\tif (ignore(e)) return;\r\n\r\n\t\t\t\t//ignore common and scrolling moves\r\n\t\t\t\tif (!actionMode) return;\r\n\r\n\t\t\t\tif (longTapTimer) clearTimeout(longTapTimer);\r\n\r\n\t\t\t\tvar source = accessor(e);\r\n\t\t\t\tif (tasksDnD && (tasksDnD.drag.id || tasksDnD.drag.start_drag)) {\r\n\t\t\t\t\ttasksDnD.on_mouse_move(source);\r\n\t\t\t\t\tif (e.preventDefault)\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.cancelBubble = true;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tif (!gantt._prevent_touch_scroll) {\r\n\t\t\t\t\tif (source && actionStart) {\r\n\t\t\t\t\t\tvar dx = actionStart.pageX - source.pageX;\r\n\t\t\t\t\t\tvar dy = actionStart.pageY - source.pageY;\r\n\t\t\t\t\t\tif (!scrollMode && (Math.abs(dx) > 5 || Math.abs(dy) > 5)) {\r\n\t\t\t\t\t\t\tscrollMode = true;\r\n\t\t\t\t\t\t\t//gantt._touch_scroll_active = scroll_mode = true;\r\n\t\t\t\t\t\t\tdblclicktime = 0;\r\n\r\n\t\t\t\t\t\t\tif(targetView){\r\n\t\t\t\t\t\t\t\tscrollState = getScrollState(targetView);\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\tscrollState = gantt.getScrollState();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (scrollMode) {\r\n\r\n\t\t\t\t\t\t\tvar newScrollState;\r\n\t\t\t\t\t\t\tvar scrollX = scrollState.x + dx;\r\n\t\t\t\t\t\t\tvar scrollY = scrollState.y + dy;\r\n\t\t\t\t\t\t\tif(targetView){\r\n\t\t\t\t\t\t\t\tscrollView(targetView, scrollX, scrollY);\r\n\t\t\t\t\t\t\t\tnewScrollState = getScrollState(targetView);\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\tgantt.scrollTo(scrollX, scrollY);\r\n\t\t\t\t\t\t\t\tnewScrollState = gantt.getScrollState();\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif ((scrollState.x != newScrollState.x && dy > 2 * dx) ||\r\n\t\t\t\t\t\t\t\t(scrollState.y != newScrollState.y && dx > 2 * dy )) {\r\n\t\t\t\t\t\t\t\treturn block_action(e);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn block_action(e);\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}]);\r\n\r\n\t\t// prevent page drag on touch move\r\n\t\ttry{\r\n\t\t\tdocument.addEventListener('touchmove', function(e) {\r\n\t\t\t\tif (gantt._touch_drag) {\r\n\t\t\t\t\tblock_action(e);\r\n\t\t\t\t}\r\n\t\t\t}, { passive: false });\r\n\t\t}\r\n\t\tcatch(e){\r\n\t\t\t// eslint-disable-next-line no-console\r\n\t\t\tconsole.warn(\"Cannot prevent touch event for the page drag\");\r\n\t\t}\r\n\r\n\t\t//block touch context menu in IE10\r\n\t\ttouchHandlers.push([this.$container, \"contextmenu\", function (e) {\r\n\t\t\tif (actionMode)\r\n\t\t\t\treturn block_action(e);\r\n\t\t}]);\r\n\r\n\t\t//touch start\r\n\t\ttouchHandlers.push([this.$container, names[1], function (e) {\r\n\t\t\tmultiTouchEvents = e.touches.length;\r\n\t\t\t// block pull-to-refresh\r\n\t\t\tif(document && document.body){\r\n\t\t\t\tdocument.body.classList.add(\"gantt_touch_active\");\r\n\t\t\t}\r\n\r\n\t\t\tif (ignore(e)) return;\r\n\t\t\tif (e.touches && e.touches.length > 1) {\r\n\t\t\t\tactionMode = false;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tactionStart = accessor(e);\r\n\t\t\ttargetView = findTargetView(actionStart);\r\n\t\t\tif (!gantt._locate_css(actionStart, \"gantt_hor_scroll\") && !gantt._locate_css(actionStart, \"gantt_ver_scroll\")) {\r\n\t\t\t\tactionMode = true;\r\n\t\t\t}\r\n\t\t\tvar tasksDnD = getTaskDND();\r\n\r\n\t\t\t//long tap\r\n\t\t\tlongTapTimer = setTimeout(function () {\r\n\t\t\t\tvar taskId = gantt.locate(actionStart);\r\n\t\t\t\tif (tasksDnD && (taskId && !gantt._locate_css(actionStart, \"gantt_link_control\") && !gantt._locate_css(actionStart, \"gantt_grid_data\"))) {\r\n\t\t\t\t\ttasksDnD.on_mouse_down(actionStart);\r\n\r\n\t\t\t\t\tif (tasksDnD.drag && tasksDnD.drag.start_drag) {\r\n\t\t\t\t\t\t// we need that as touch events break if the target node is removed from the DOM\r\n\t\t\t\t\t\tcloneTaskRendered(taskId);\r\n\t\t\t\t\t\ttasksDnD._start_dnd(actionStart);\r\n\t\t\t\t\t\tgantt._touch_drag = true;\r\n\r\n\t\t\t\t\t\tgantt.refreshTask(taskId);\r\n\r\n\t\t\t\t\t\tgantt._touch_feedback();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlongTapTimer = null;\r\n\t\t\t}, gantt.config.touch_drag);\r\n\t\t}]);\r\n\r\n\t\t//touch end\r\n\t\ttouchHandlers.push([this.$container, names[2], function (e) {\r\n\t\t\tif(document && document.body){\r\n\t\t\t\tdocument.body.classList.remove(\"gantt_touch_active\");\r\n\t\t\t}\r\n\t\t\tif (ignore(e)) return;\r\n\t\t\tif (longTapTimer) clearTimeout(longTapTimer);\r\n\t\t\tgantt._touch_drag = false;\r\n\t\t\tactionMode = false;\r\n\t\t\tvar source = accessor(e);\r\n\r\n\t\t\tvar tasksDnD = getTaskDND();\r\n\r\n\t\t\tif(tasksDnD)\r\n\t\t\t\ttasksDnD.on_mouse_up(source);\r\n\r\n\t\t\tif (currentDndId && gantt.isTaskExists(currentDndId)) {\r\n\t\t\t\tgantt.refreshTask(currentDndId);\r\n\t\t\t\tif(dndNodes.length){\r\n\t\t\t\t\tdndNodes.forEach(function(node){\r\n\t\t\t\t\t\tif(node.parentNode){\r\n\t\t\t\t\t\t\tnode.parentNode.removeChild(node);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tgantt._touch_feedback();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//gantt._touch_scroll_active = action_mode = scroll_mode = false;\r\n\t\t\tactionMode = scrollMode = false;\r\n\t\t\tdndNodes = [];\r\n\t\t\tcurrentDndId = null;\r\n\r\n\t\t\t//dbl-tap handling\r\n\t\t\tif (actionStart && dblclicktime) {\r\n\t\t\t\tvar now = new Date();\r\n\t\t\t\t// doubletap shouldn't happen with multitouch\r\n\t\t\t\tif ((now - dblclicktime) < 500 && multiTouchEvents <= 1) {\r\n\r\n\t\t\t\t\tvar mouseEvents = gantt.$services.getService(\"mouseEvents\");\r\n\t\t\t\t\tmouseEvents.onDoubleClick(actionStart);\r\n\t\t\t\t\tblock_action(e);\r\n\t\t\t\t} else\r\n\t\t\t\t\tdblclicktime = now;\r\n\t\t\t} else {\r\n\t\t\t\tdblclicktime = new Date();\r\n\t\t\t}\r\n\t\t}]);\r\n\r\n\t\tfor(var i = 0; i < touchHandlers.length; i++){\r\n\t\t\tgantt.event(touchHandlers[i][0], touchHandlers[i][1], touchHandlers[i][2]);\r\n\t\t}\r\n\r\n\t\t//common helper, prevents event\r\n\t\tfunction block_action(e) {\r\n\t\t\tif (e && e.preventDefault && e.cancelable){\r\n\t\t\t\te.preventDefault();\r\n\t\t\t}\r\n\t\t\te.cancelBubble = true;\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tfunction cloneTaskRendered(taskId) {\r\n\t\t\tconst renders = gantt._getTaskLayers();\r\n\t\t\tlet task = gantt.getTask(taskId);\r\n\t\t\tif (task) {\r\n\t\t\t\tlet visible = gantt.isTaskVisible(taskId);\r\n\t\t\t\tif (visible){\r\n\t\t\t\t\tcurrentDndId = taskId;\r\n\t\t\t\t\tfor (let i = 0; i < renders.length; i++) {\r\n\t\t\t\t\t\ttask = renders[i].rendered[taskId];\r\n\t\t\t\t\t\tif (task && task.getAttribute(gantt.config.task_attribute) && task.getAttribute(gantt.config.task_attribute) == taskId) {\r\n\t\t\t\t\t\t\tconst copy = task.cloneNode(true);\r\n\t\t\t\t\t\t\tdndNodes.push(task);\r\n\t\t\t\t\t\t\trenders[i].rendered[taskId] = copy;\r\n\t\t\t\t\t\t\ttask.style.display = \"none\";\r\n\t\t\t\t\t\t\tcopy.className += \" gantt_drag_move \";\r\n\t\t\t\t\t\t\ttask.parentNode.appendChild(copy);\r\n\t\t\t\t\t\t\t//return copy;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (task.$split_subtask){\r\n\t\t\t\t\tlet renderedParent = task.$rendered_parent;\r\n\t\t\t\t\tvisible = gantt.isTaskVisible(renderedParent);\r\n\t\t\t\t\tif (!visible){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcurrentDndId = taskId;\r\n\t\t\t\t\tfor (let i = 0; i < renders.length; i++) {\r\n\t\t\t\t\t\tconst parent = renders[i].rendered[renderedParent];\r\n\t\t\t\t\t\tlet taskNode;\r\n\t\t\t\t\t\tif (parent && parent.childNodes){\r\n\t\t\t\t\t\t\ttaskNode = parent.querySelector(`[${gantt.config.task_attribute}=\"${task.id}\"]`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (taskNode) {\r\n\t\t\t\t\t\t\t// move the child node to a different parent as the task bar will be repainted\r\n\t\t\t\t\t\t\t// and the initial node will be lost\r\n\t\t\t\t\t\t\tconst copy = taskNode.cloneNode(true);\r\n\t\t\t\t\t\t\ttaskNode.parentNode.appendChild(copy);\r\n\r\n\t\t\t\t\t\t\tgantt.$task_bars.appendChild(taskNode);\r\n\t\t\t\t\t\t\ttaskNode.style.display = \"none\";\r\n\r\n\t\t\t\t\t\t\t// don't add the node as rendered otherwise it will be lost:\r\n\t\t\t\t\t\t\t// renders[i].rendered[taskId] = taskNode;\r\n\t\t\t\t\t\t\t// instead, add it to dndNodes as its elements will be removed after drag\r\n\t\t\t\t\t\t\tdndNodes.push(taskNode);\r\n\r\n\t\t\t\t\t\t\ttaskNode = null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n};","function dummy() {\r\n\t// eslint-disable-next-line\r\n\tconsole.log(\"Method is not implemented.\"); \r\n}\r\nfunction BaseControl() {\r\n}\r\n\r\n// base methods will be runned in gantt context\r\nBaseControl.prototype.render = dummy; // arguments: sns\r\nBaseControl.prototype.set_value = dummy; // arguments: node, value, ev, sns(config)\r\nBaseControl.prototype.get_value = dummy; // arguments node, ev, sns(config)\r\nBaseControl.prototype.focus = dummy; // arguments: node\r\n\r\nexport default function(gantt) { // we could send current instance of gantt to module\r\n\treturn BaseControl;\r\n};","import __extends from \"../../../../utils/extends\";\r\n\r\nimport Super from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tconst _super = Super(gantt);\r\n\r\n\tfunction TemplateControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this; \r\n\t\treturn self; \r\n\t}\r\n\r\n\t__extends(TemplateControl, _super);\r\n\r\n\r\n\tTemplateControl.prototype.render = function(sns) {\r\n\t\tlet height = sns.height ? `${sns.height}px` : '';\r\n\t\treturn `<div class='gantt_cal_ltext gantt_cal_template gantt_section_${sns.name}' ${height ? `style='height:${height};'` : ''}></div>`;\r\n\t};\r\n\r\n\tTemplateControl.prototype.set_value = function(node, value) {\r\n\t\tnode.innerHTML = value || \"\";\r\n\t};\r\n\r\n\tTemplateControl.prototype.get_value = function(node) {\r\n\t\treturn node.innerHTML || \"\";\r\n\t};\r\n\r\n\tTemplateControl.prototype.focus = function() {};\r\n\r\n\treturn TemplateControl;\r\n};","import __extends from \"../../../../utils/extends\";\r\n\r\nimport Super from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tconst _super = Super(gantt);\r\n\r\n\tfunction TextareaControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this;\r\n\r\n\t\treturn self; \r\n\t}\r\n\r\n\t__extends(TextareaControl, _super);\r\n\r\n\tTextareaControl.prototype.render = function(sns) {\r\n\t\tconst height = (sns.height || \"130\") + \"px\";\r\n\t\tconst placeholder = sns.placeholder ? `placeholder='${sns.placeholder}'` : \"\";\r\n\t\treturn `<div class='gantt_cal_ltext gantt_section_${sns.name}' style='height:${height};' ${placeholder}><textarea></textarea></div>`;\r\n\t};\r\n\r\n\tTextareaControl.prototype.set_value = function(node, value) {\r\n\t\tgantt.form_blocks.textarea._get_input(node).value = value || \"\";\r\n\t};\r\n\r\n\tTextareaControl.prototype.get_value = function(node) {\r\n\t\treturn gantt.form_blocks.textarea._get_input(node).value;\r\n\t};\r\n\r\n\tTextareaControl.prototype.focus = function(node) {\r\n\t\tvar a = gantt.form_blocks.textarea._get_input(node);\r\n\t\tgantt._focus(a, true);\r\n\t};\r\n\r\n\tTextareaControl.prototype._get_input = function(node) {\r\n\t\treturn node.querySelector(\"textarea\");\r\n\t};\r\n\r\n\treturn TextareaControl;\r\n};","import __extends from \"../../../../utils/extends\";\r\n\r\nimport Super from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tconst _super = Super(gantt);\r\n\r\n\tfunction TimeControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this;\r\n\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(TimeControl, _super);\r\n\r\n\tTimeControl.prototype.render = function (sns) {\r\n\t\tvar time = gantt.form_blocks.getTimePicker.call(this, sns);\r\n\t\tlet sectionClassName = \"gantt_section_time\";\r\n\t\tif (sns.name !== \"time\"){\r\n\t\t\tsectionClassName += \" gantt_section_\" + sns.name;\r\n\t\t}\r\n\t\tvar html = \"<div style='padding-top:0px;font-size:inherit;text-align:center;' class='\" + sectionClassName + \"'>\";\r\n\t\thtml += time;\r\n\r\n\t\tif (sns.single_date) {\r\n\t\t\ttime = gantt.form_blocks.getTimePicker.call(this, sns, true);\r\n\t\t\thtml += \"<span></span>\";\r\n\t\t} else {\r\n\t\t\thtml += \"<span class='gantt_section_time_spacer'> &nbsp;&ndash;&nbsp; </span>\";\r\n\t\t}\r\n\r\n\t\thtml += time;\r\n\t\thtml += \"</div>\";\r\n\t\treturn html;\r\n\t};\r\n\r\n\tTimeControl.prototype.set_value = function (node, value, ev, config) {\r\n\t\tvar cfg = config;\r\n\t\tvar s = node.getElementsByTagName(\"select\");\r\n\t\tvar map = config._time_format_order;\r\n\r\n\t\tif (cfg.auto_end_date) {\r\n\t\t\tvar _update_lightbox_select = function () {\r\n\t\t\t\tstart_date = new Date(s[map[2]].value, s[map[1]].value, s[map[0]].value, 0, 0);\r\n\t\t\t\tend_date = gantt.calculateEndDate({ start_date: start_date, duration: 1, task: ev });\r\n\t\t\t\tgantt.form_blocks._fill_lightbox_select(s, map.size, end_date, map, cfg);\r\n\t\t\t};\r\n\t\t\tfor (var i = 0; i < 4; i++) {\r\n\t\t\t\ts[i].onchange = _update_lightbox_select;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar mapping = gantt._resolve_default_mapping(config);\r\n\r\n\t\tif (typeof (mapping) === \"string\") mapping = { start_date: mapping };\r\n\r\n\t\tvar start_date = ev[mapping.start_date] || new Date();\r\n\t\tvar end_date = ev[mapping.end_date] || gantt.calculateEndDate({\r\n\t\t\tstart_date: start_date,\r\n\t\t\tduration: 1,\r\n\t\t\ttask: ev\r\n\t\t});\r\n\r\n\t\tgantt.form_blocks._fill_lightbox_select(s, 0, start_date, map, cfg);\r\n\t\tgantt.form_blocks._fill_lightbox_select(s, map.size, end_date, map, cfg);\r\n\t};\r\n\r\n\tTimeControl.prototype.get_value = function (node, ev, config) {\r\n\t\tvar selects = node.getElementsByTagName(\"select\");\r\n\t\tvar startDate;\r\n\t\tvar map = config._time_format_order;\r\n\t\tfunction _getEndDate(selects, map, startDate) {\r\n\t\t\tvar endDate = gantt.form_blocks.getTimePickerValue(selects, config, map.size);\r\n\t\t\t// GS-1010: We need to add a way to obtain exact end_date for validation\r\n\t\t\tif (endDate <= startDate) {  // when end date seems wrong\r\n\t\t\t\tif (config.autofix_end !== false || config.single_date) { // auto correct it in two cases - when the auto correction is not disabled, or when we have 'single date' control and the user don't have the UI to specify the end date\r\n\t\t\t\t\treturn gantt.date.add(startDate, gantt._get_timepicker_step(), \"minute\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn endDate;\r\n\t\t}\r\n\r\n\t\tstartDate = gantt.form_blocks.getTimePickerValue(selects, config);\r\n\r\n\t\tif (typeof gantt._resolve_default_mapping(config) === \"string\") {\r\n\t\t\treturn startDate;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tstart_date: startDate,\r\n\t\t\tend_date: _getEndDate(selects, map, startDate)\r\n\t\t};\r\n\t};\r\n\r\n\tTimeControl.prototype.focus = function (node) {\r\n\t\tgantt._focus(node.getElementsByTagName(\"select\")[0]);\r\n\t};\r\n\r\n\treturn TimeControl;\r\n};","import * as helpers from \"../../../utils/helpers\";\r\n\r\nvar htmlHelpers = {\r\n\tgetHtmlSelect: function(options, attributes, value) {\r\n\t\tvar innerHTML = \"\";\r\n\t\tvar _this = this;\r\n\r\n\t\toptions = options || [];\r\n\t\t\r\n\t\thelpers.forEach(options, function(entry) {\r\n\t\t\tvar _attributes = [{ key: \"value\", value: entry.key }];\r\n\r\n\t\t\tif (value == entry.key) {\r\n\t\t\t\t_attributes[_attributes.length] = { key: \"selected\", value: \"selected\" };\r\n\t\t\t}\r\n\t\t\tif (entry.attributes) {\r\n\t\t\t\t_attributes = _attributes.concat(entry.attributes);\r\n\t\t\t}\r\n\t\t\tinnerHTML += _this.getHtmlOption({ innerHTML: entry.label }, _attributes);\r\n\t\t});\r\n\r\n\t\treturn _getHtmlContainer(\"select\", { innerHTML: innerHTML }, attributes);\r\n\t},\r\n\tgetHtmlOption: function(options, attributes) { return _getHtmlContainer(\"option\", options, attributes); },\r\n\tgetHtmlButton: function(options, attributes) { return _getHtmlContainer(\"button\", options, attributes); },\r\n\tgetHtmlDiv: function(options, attributes) { return _getHtmlContainer(\"div\", options, attributes); },\r\n\tgetHtmlLabel: function(options, attributes) { return _getHtmlContainer(\"label\", options, attributes); },\r\n\tgetHtmlInput: function(attributes) {\r\n\t\treturn \"<input\" + _getHtmlAttributes(attributes || []) + \">\";\r\n\t}\r\n};\r\n\r\nfunction _getHtmlContainer(tag, options, attributes) {\r\n\tvar html;\r\n\r\n\toptions = options || [];\r\n\t\r\n\thtml = \"<\" + tag + _getHtmlAttributes(attributes || []) + \">\" + (options.innerHTML || \"\") + \"</\" + tag +\">\";\r\n\treturn html;\r\n\r\n}\r\n\r\nfunction _getHtmlAttributes(attributes) {\r\n\tvar html = \"\";\r\n\r\n\thelpers.forEach(attributes, function(entry) {\r\n\t\thtml += \" \" + entry.key + \"='\" + entry.value + \"'\";\r\n\t});\r\n\treturn html;\r\n}\r\n\r\nexport default htmlHelpers;","import __extends from \"../../../../utils/extends\";\r\nimport htmlHelpers from \"../../utils/html_helpers\";\r\n\r\nimport Super from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tconst _super = Super(gantt);\r\n\r\n\tfunction SelectControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this;\r\n\t\r\n\t\treturn self; \r\n\t}\r\n\t\r\n\t__extends(SelectControl, _super);\r\n\t\r\n\tSelectControl.prototype.render = function(sns) {\r\n\t\tconst height = sns.height ? `height:${sns.height}px;` : '';\r\n\t\tlet html = `<div class='gantt_cal_ltext gantt_section_${sns.name}' ${height ? `style='${height}'` : ''}>`;\r\n\r\n\t\thtml += htmlHelpers.getHtmlSelect(sns.options, [{ key: \"style\", value: \"width:100%;\" }, { key: \"title\", value: sns.name }]);\r\n\t\thtml += \"</div>\";\r\n\t\treturn html;\r\n\t};\r\n\r\n\tSelectControl.prototype.set_value = function(node, value, ev, sns) {\r\n\t\tvar select = node.firstChild;\r\n\t\tif (!select._dhx_onchange && sns.onchange) {\r\n\t\t\tselect.onchange = sns.onchange;\r\n\t\t\tselect._dhx_onchange = true;\r\n\t\t}\r\n\t\tif (typeof value === \"undefined\")\r\n\t\t\tvalue = (select.options[0] || {}).value;\r\n\t\tselect.value = value || \"\";\r\n\t};\r\n\t\r\n\tSelectControl.prototype.get_value = function(node) {\r\n\t\treturn node.firstChild.value;\r\n\t};\r\n\t\r\n\tSelectControl.prototype.focus = function(node) {\r\n\t\tvar a = node.firstChild;\r\n\t\tgantt._focus(a, true);\r\n\t};\r\n\t\r\n\treturn SelectControl;\r\n};","import * as helpers from \"../../../../utils/helpers\";\r\nimport __extends from \"../../../../utils/extends\";\r\nimport BaseConstrutor from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tvar _super = BaseConstrutor(gantt);\r\n\r\n\tfunction CheckboxControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this;\r\n\r\n\t\treturn self; \r\n\t}\r\n\r\n\t__extends(CheckboxControl, _super);\r\n\r\n\tCheckboxControl.prototype.render = function(sns) {\r\n\t\tconst height = sns.height ? `height:${sns.height}px;` : '';\r\n\t\tlet html = `<div class='gantt_cal_ltext gantt_cal_lcheckbox gantt_section_${sns.name}' ${height ? `style='${height}'` : ''}>`;\r\n\r\n\t\tif (sns.options && sns.options.length) {\r\n\t\t\tfor (var i = 0; i < sns.options.length; i++) {\r\n\t\t\t\thtml += \"<label><input type='checkbox' value='\" + sns.options[i].key + \"' name='\" + sns.name + \"'>\" + sns.options[i].label + \"</label>\";\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tsns.single_value = true;\r\n\t\t\thtml += \"<label><input type='checkbox' name='\" + sns.name + \"'></label>\";\r\n\t\t}\r\n\t\thtml += \"</div>\";\r\n\t\treturn html;\r\n\t};\r\n\r\n\tCheckboxControl.prototype.set_value = function(node, value, ev, sns) {\r\n\t\tvar checkboxes = Array.prototype.slice.call(node.querySelectorAll(\"input[type=checkbox]\"));\r\n\r\n\t\tif (!node._dhx_onchange && sns.onchange) {\r\n\t\t\tnode.onchange = sns.onchange;\r\n\t\t\tnode._dhx_onchange = true;\r\n\t\t}\r\n\r\n\t\tif(sns.single_value){\r\n\t\t\tvar box = checkboxes[0];\r\n\t\t\tbox.checked = !!value;\r\n\t\t}else{\r\n\t\t\thelpers.forEach(checkboxes, function(entry) {\r\n\t\t\t\tentry.checked = value ? value.indexOf(entry.value) >= 0 : false;\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tCheckboxControl.prototype.get_value = function(node, task, sns) {\r\n\t\tif(sns.single_value){\r\n\t\t\tvar box = node.querySelector(\"input[type=checkbox]\");\r\n\t\t\treturn box.checked;\r\n\t\t}else{\r\n\t\t\treturn helpers.arrayMap(Array.prototype.slice.call(node.querySelectorAll(\"input[type=checkbox]:checked\")), function(entry) {\r\n\t\t\t\treturn entry.value;\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tCheckboxControl.prototype.focus = function(node) {\r\n\t\tgantt._focus(node.querySelector(\"input[type=checkbox]\"));\r\n\t};\r\n\r\n\treturn CheckboxControl;\r\n};","import __extends from \"../../../../utils/extends\";\r\nimport Super from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tconst _super = Super(gantt);\r\n\r\n\tfunction RadioControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this;\r\n\r\n\t\treturn self; \r\n\t}\r\n\r\n\t__extends(RadioControl, _super);\r\n\r\n\tRadioControl.prototype.render = function(sns) {\r\n\t\tconst height = sns.height ? `${sns.height}px` : '';\r\n\t\tlet html = `<div class='gantt_cal_ltext gantt_cal_lradio gantt_section_${sns.name}' ${height ? `style='height:${height};'` : ''}>`;\r\n\r\n\t\tif (sns.options && sns.options.length) {\r\n\t\t\tfor (var i = 0; i < sns.options.length; i++) {\r\n\t\t\t\thtml += \"<label><input type='radio' value='\" + sns.options[i].key + \"' name='\" + sns.name + \"'>\" + sns.options[i].label + \"</label>\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\thtml += \"</div>\";\r\n\t\treturn html;\r\n\t};\r\n\r\n\tRadioControl.prototype.set_value = function(node, value, ev, sns) {\r\n\t\tvar radio;\r\n\r\n\t\tif (!sns.options || !sns.options.length) return;\r\n\r\n\t\tradio = node.querySelector(\"input[type=radio][value='\" + value + \"']\") ||\r\n\t\t\t\tnode.querySelector(\"input[type=radio][value='\" + sns.default_value + \"']\");\r\n\r\n\t\tif (!radio) return;\r\n\r\n\t\tif (!node._dhx_onchange && sns.onchange) {\r\n\t\t\tnode.onchange = sns.onchange;\r\n\t\t\tnode._dhx_onchange = true;\r\n\t\t}\r\n\r\n\t\tradio.checked = true;\r\n\t};\r\n\r\n\tRadioControl.prototype.get_value = function(node, ev) {\r\n\t\tvar result = node.querySelector(\"input[type=radio]:checked\");\r\n\r\n\t\treturn result ? result.value : \"\";\r\n\t};\r\n\r\n\tRadioControl.prototype.focus = function(node) {\r\n\t\tgantt._focus(node.querySelector(\"input[type=radio]\"));\r\n\t};\r\n\r\n\treturn RadioControl;\r\n};","import __extends from \"../../../../utils/extends\";\r\n\r\nimport DurationFormatterNumeric from  \"../../../common/duration_formatter_numeric\";\r\nimport BaseConstrutor from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tvar _super = BaseConstrutor(gantt);\r\n\r\n\tfunction DurationControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this; \r\n\r\n\t\treturn self; \r\n\t}\r\n\r\n\tfunction getFormatter(config) {\r\n\t\treturn config.formatter || new DurationFormatterNumeric();\r\n\t}\r\n\r\n\t__extends(DurationControl, _super);\r\n\r\n\tDurationControl.prototype.render = function(sns) {\r\n\t\tvar time = \"<div class='gantt_time_selects'>\" + gantt.form_blocks.getTimePicker.call(this, sns) + \"</div>\";\r\n\t\tvar label = \" \"+ gantt.locale.labels[gantt.config.duration_unit + \"s\"] +\" \";\r\n\t\tvar singleDate = sns.single_date ? \" style='display:none'\" : \"\";\r\n\t\tvar readonly = sns.readonly ? \" disabled='disabled'\" : \"\";\r\n\t\tvar ariaAttr = gantt._waiAria.lightboxDurationInputAttrString(sns);\r\n\r\n\t\tvar durationInputClass = \"gantt_duration_value\";\r\n\t\tif(sns.formatter) {\r\n\t\t\tlabel = \"\";\r\n\t\t\tdurationInputClass += \" gantt_duration_value_formatted\" ;\r\n\t\t}\r\n\r\n\t\tvar duration = \"<div class='gantt_duration' \" + singleDate + \">\" +\r\n\t\t\"<div class='gantt_duration_inputs'>\" +\r\n\t\t\t\"<input type='button' class='gantt_duration_dec' value='−'\" + readonly + \">\" +\r\n\t\t\t\"<input type='text' value='5days' class='\"+durationInputClass+\"'\" + readonly + \" \" + ariaAttr + \">\" +\r\n\t\t\t\"<input type='button' class='gantt_duration_inc' value='+'\" + readonly + \">\"+\r\n\t\t\t\"</div>\" +\r\n\t\t\t\"<div class='gantt_duration_end_date'>\"+label+\"<span></span></div>\" +\r\n\t\t\t\"</div>\" +\r\n\t\t\t\"</div>\";\r\n\t\tlet sectionClassName = \"gantt_section_time gantt_section_duration\";\r\n\t\tif (sns.name !== \"time\"){\r\n\t\t\tsectionClassName += \" gantt_section_\" + sns.name;\r\n\t\t}\t\r\n\t\tvar html = \"<div style='padding-top:0px;font-size:inherit;' class='\" + sectionClassName + \"'>\" + time + \" \" + duration + \"</div>\";\r\n\t\treturn html;\r\n\t};\r\n\r\n\tDurationControl.prototype.set_value = function(node, value, ev, config) {\r\n\t\tvar s = node.getElementsByTagName(\"select\");\r\n\t\tvar inps = node.getElementsByTagName(\"input\");\r\n\t\tvar duration = inps[1];\r\n\t\tvar btns = [inps[0], inps[2]];\r\n\t\tvar endspan = node.getElementsByTagName(\"span\")[0];\r\n\t\tvar map = config._time_format_order;\r\n\t\tvar mapping;\r\n\t\tvar start_date;\r\n\t\tvar end_date;\r\n\t\tvar duration_val;\r\n\r\n\t\tfunction _calc_date() {\r\n\t\t\tvar start_date = _getStartDate.call(gantt, node, config);\r\n\t\t\tvar duration = _getDuration.call(gantt, node, config);\r\n\t\t\tvar end_date = gantt.calculateEndDate({start_date: start_date, duration: duration, task: ev});\r\n\r\n\t\t\tvar template = gantt.templates.task_end_date || gantt.templates.task_date;\r\n\t\t\tendspan.innerHTML = template(end_date);\r\n\t\t}\r\n\r\n\t\tfunction _change_duration(step) {\r\n\t\t\tvar value = duration.value;\r\n\r\n\t\t\tvalue = getFormatter(config).parse(value);\r\n\t\t\tif (window.isNaN(value))\r\n\t\t\t\tvalue = 0;\r\n\t\t\tvalue += step;\r\n\t\t\tif (value < 1) value = 1;\r\n\t\t\tduration.value = getFormatter(config).format(value);\r\n\t\t\t_calc_date();\r\n\t\t}\r\n\r\n\t\tbtns[0].onclick = gantt.bind(function() {\r\n\t\t\t_change_duration(-1 * gantt.config.duration_step);\r\n\t\t}, this);\r\n\t\tbtns[1].onclick = gantt.bind(function() {\r\n\t\t\t_change_duration(1 * gantt.config.duration_step);\r\n\t\t}, this);\r\n\t\ts[0].onchange = _calc_date;\r\n\t\ts[1].onchange = _calc_date;\r\n\t\ts[2].onchange = _calc_date;\r\n\t\tif (s[3]) s[3].onchange = _calc_date;\r\n\r\n\t\tduration.onkeydown = gantt.bind(function(e) {\r\n\t\t\tvar code; \r\n\r\n\t\t\te = e || window.event;\r\n\t\t\tcode = (e.charCode || e.keyCode || e.which);\r\n\t\t\t\r\n\t\t\tif (code == gantt.constants.KEY_CODES.DOWN) {\r\n\t\t\t\t_change_duration(-1 * gantt.config.duration_step);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (code == gantt.constants.KEY_CODES.UP) {\r\n\t\t\t\t_change_duration(1 * gantt.config.duration_step);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\twindow.setTimeout(_calc_date, 1);\r\n\t\t}, this);\r\n\r\n\t\tduration.onchange = gantt.bind(_calc_date, this);\r\n\r\n\t\tmapping = gantt._resolve_default_mapping(config);\r\n\t\tif (typeof(mapping) === \"string\") mapping = {start_date: mapping};\r\n\r\n\t\tstart_date = ev[mapping.start_date] || new Date();\r\n\t\tend_date = ev[mapping.end_date] || gantt.calculateEndDate({\r\n\t\t\tstart_date: start_date,\r\n\t\t\tduration: 1,\r\n\t\t\ttask: ev\r\n\t\t});\r\n\t\tduration_val = Math.round(ev[mapping.duration]) || gantt.calculateDuration({\r\n\t\t\tstart_date: start_date,\r\n\t\t\tend_date: end_date,\r\n\t\t\ttask: ev\r\n\t\t});\r\n\t\tduration_val = getFormatter(config).format(duration_val);\r\n\r\n\t\tgantt.form_blocks._fill_lightbox_select(s, 0, start_date, map, config);\r\n\t\tduration.value = duration_val;\r\n\t\t_calc_date();\r\n\t};\r\n\r\n\tDurationControl.prototype.get_value = function(node, ev, config) {\r\n\t\tvar startDate = _getStartDate(node, config);\r\n\t\tvar duration = _getDuration(node, config);\r\n\t\tvar endDate = gantt.calculateEndDate({start_date: startDate, duration: duration, task: ev});\r\n\r\n\t\tif (typeof gantt._resolve_default_mapping(config) == \"string\") {\r\n\t\t\treturn startDate;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tstart_date: startDate,\r\n\t\t\tend_date: endDate,\r\n\t\t\tduration: duration\r\n\t\t};\r\n\t};\r\n\r\n\tDurationControl.prototype.focus = function(node) {\r\n\t\tgantt._focus(node.getElementsByTagName(\"select\")[0]);\r\n\t};\r\n\r\n\r\n\tfunction _getStartDate(node, config) {\r\n\t\tvar s = node.getElementsByTagName(\"select\");\r\n\t\tvar map = config._time_format_order;\r\n\t\tvar hours = 0;\r\n\t\tvar minutes = 0;\r\n\r\n\t\tif (gantt.defined(map[3])) {\r\n\t\t\tvar input = s[map[3]];\r\n\t\t\tvar time = parseInt(input.value, 10);\r\n\t\t\tif (isNaN(time) && input.hasAttribute(\"data-value\")) {\r\n\t\t\t\ttime = parseInt(input.getAttribute(\"data-value\"), 10);\r\n\t\t\t}\r\n\r\n\t\t\thours = Math.floor(time / 60);\r\n\t\t\tminutes = time % 60;\r\n\t\t}\r\n\t\treturn new Date(s[map[2]].value, s[map[1]].value, s[map[0]].value, hours, minutes);\r\n\t}\r\n\r\n\tfunction _getDuration(node, config) {\r\n\t\tvar duration = node.getElementsByTagName(\"input\")[1];\r\n\r\n\t\tduration = getFormatter(config).parse(duration.value);\r\n\t\tif (!duration || window.isNaN(duration)) duration = 1;\r\n\t\tif (duration < 0) duration *= -1;\r\n\t\treturn duration;\r\n\t}\r\n\r\n\treturn DurationControl; \r\n};","import __extends from \"../../../../utils/extends\";\r\nimport SelectControl from \"./select_control\";\r\nexport default function(gantt) {\r\n\tvar _super = SelectControl(gantt);\r\n\r\n\tfunction ParentControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this; \r\n\r\n\t\treturn self; \r\n\t}\r\n\r\n\t__extends(ParentControl, _super);\r\n\r\n\r\n\tParentControl.prototype.render = function(sns) {\r\n\t\treturn _display(sns, false);\r\n\t};\r\n\r\n\tParentControl.prototype.set_value = function(node, value, ev, config) {\r\n\t\t// GS-1051. If the value is `0`, the set_value function in the select control won't select \r\n\t\t// the first child because (0 || '') = '';\r\n\t\tif (value === 0) value = \"0\";\r\n\r\n\t\tvar tmpDom = document.createElement(\"div\");\r\n\t\ttmpDom.innerHTML = _display(config, ev.id);\r\n\t\tvar newOptions = tmpDom.removeChild(tmpDom.firstChild);\r\n\t\tnode.onselect = null;\r\n\t\tnode.parentNode.replaceChild(newOptions, node);\r\n\r\n\t\treturn gantt.form_blocks.select.set_value.apply(gantt, [newOptions, value, ev, config]);\r\n\t};\r\n\r\n\tfunction _display(config, item_id) {\r\n\t\tvar tasks = [],\r\n\t\t\toptions = [];\r\n\t\tif (item_id) {\r\n\t\t\ttasks = gantt.getTaskByTime();\r\n\t\t\tif (config.allow_root) {\r\n\t\t\t\ttasks.unshift({id: gantt.config.root_id, text: config.root_label || \"\"});\r\n\t\t\t}\r\n\t\t\ttasks = _filter(tasks, config, item_id);\r\n\t\t\tif (config.sort) {\r\n\t\t\t\ttasks.sort(config.sort);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar text = config.template || gantt.templates.task_text;\r\n\t\tfor (var i = 0; i < tasks.length; i++) {\r\n\t\t\tvar label = text.apply(gantt, [tasks[i].start_date, tasks[i].end_date, tasks[i]]);\r\n\t\t\tif (label === undefined) {\r\n\t\t\t\tlabel = \"\";\r\n\t\t\t}\r\n\t\t\toptions.push({\r\n\t\t\t\tkey: tasks[i].id,\r\n\t\t\t\tlabel: label\r\n\t\t\t});\r\n\t\t}\r\n\t\tconfig.options = options;\r\n\t\tconfig.map_to = config.map_to || \"parent\";\r\n\t\treturn gantt.form_blocks.select.render.apply(this, arguments);\r\n\t}\r\n\r\n\tfunction _filter(options, config, item_id) {\r\n\t\tvar filter = config.filter || function() {\r\n\t\t\treturn true;\r\n\t\t};\r\n\r\n\t\toptions = options.slice(0);\r\n\r\n\t\tfor (var i = 0; i < options.length; i++) {\r\n\t\t\tvar task = options[i];\r\n\t\t\tif (task.id == item_id || gantt.isChildOf(task.id, item_id) || filter(task.id, task) === false) {\r\n\t\t\t\toptions.splice(i, 1);\r\n\t\t\t\ti--;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn options;\r\n\t}\r\n\treturn ParentControl;\r\n};","import __extends from \"../../../../utils/extends\";\r\nimport htmlHelpers from \"../../utils/html_helpers\";\r\nimport BaseConstrutor from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tvar _super = BaseConstrutor(gantt);\r\n\r\n\tfunction ConstraintControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this;\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(ConstraintControl, _super);\r\n\r\n\tfunction isNonTimedConstraint(value) {\r\n\t\tif (!value || value === gantt.config.constraint_types.ASAP || value === gantt.config.constraint_types.ALAP) {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction toggleTimeSelect(timeSelects, typeValue) {\r\n\t\tvar isNonTimed = isNonTimedConstraint(typeValue);\r\n\t\tfor (var i = 0; i < timeSelects.length; i++) {\r\n\t\t\ttimeSelects[i].disabled = isNonTimed;\r\n\t\t}\r\n\t}\r\n\r\n\tConstraintControl.prototype.render = function (sns) {\r\n\t\tconst height = sns.height ? `height:${sns.height}px;` : '';\r\n\t\tlet html = `<div class='gantt_cal_ltext gantt_section_${sns.name}' ${height ? `style='${height}'` : ''}>`;\r\n\r\n\t\tvar options = [];\r\n\t\tfor (var i in gantt.config.constraint_types) {\r\n\t\t\toptions.push({ key: gantt.config.constraint_types[i], label: gantt.locale.labels[gantt.config.constraint_types[i]] });\r\n\t\t}\r\n\r\n\t\tsns.options = sns.options || options;\r\n\r\n\t\thtml += \"<span data-constraint-type-select>\" + htmlHelpers.getHtmlSelect(sns.options, [{ key: \"data-type\", value: \"constraint-type\" }]) + \"</span>\";\r\n\r\n\t\tvar timeLabel = gantt.locale.labels[\"constraint_date\"] || \"Constraint date\";\r\n\t\thtml += \"<label data-constraint-time-select>\" + timeLabel + \": \" + gantt.form_blocks.getTimePicker.call(this, sns) + \"</label>\";\r\n\r\n\t\thtml += \"</div>\";\r\n\t\treturn html;\r\n\t};\r\n\r\n\tConstraintControl.prototype.set_value = function (node, value, task, config) {\r\n\t\tvar typeSelect = node.querySelector(\"[data-constraint-type-select] select\");\r\n\t\tvar timeSelects = node.querySelectorAll(\"[data-constraint-time-select] select\");\r\n\t\tvar map = config._time_format_order;\r\n\r\n\t\tvar mapping = gantt._resolve_default_mapping(config);\r\n\r\n\t\tif (!typeSelect._eventsInitialized) {\r\n\t\t\ttypeSelect.addEventListener(\"change\", function (e) {\r\n\t\t\t\ttoggleTimeSelect(timeSelects, e.target.value);\r\n\t\t\t});\r\n\t\t\ttypeSelect._eventsInitialized = true;\r\n\t\t}\r\n\r\n\t\tvar constraintDate = task[mapping.constraint_date] || new Date();\r\n\t\tgantt.form_blocks._fill_lightbox_select(timeSelects, 0, constraintDate, map, config);\r\n\r\n\t\tvar constraintType = task[mapping.constraint_type] || gantt.getConstraintType(task);\r\n\t\ttypeSelect.value = constraintType;\r\n\t\ttoggleTimeSelect(timeSelects, constraintType);\r\n\t};\r\n\r\n\tConstraintControl.prototype.get_value = function (node, task, config) {\r\n\t\tvar typeSelect = node.querySelector(\"[data-constraint-type-select] select\");\r\n\t\tvar timeSelects = node.querySelectorAll(\"[data-constraint-time-select] select\");\r\n\r\n\t\tvar constraintType = typeSelect.value;\r\n\t\tvar constraintDate = null;\r\n\t\tif (!isNonTimedConstraint(constraintType)) {\r\n\t\t\tconstraintDate = gantt.form_blocks.getTimePickerValue(timeSelects, config);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tconstraint_type: constraintType,\r\n\t\t\tconstraint_date: constraintDate\r\n\t\t};\r\n\t};\r\n\r\n\tConstraintControl.prototype.focus = function (node) {\r\n\t\tgantt._focus(node.querySelector(\"select\"));\r\n\t};\r\n\r\n\treturn ConstraintControl;\r\n};","import __extends from \"../../../../utils/extends\";\r\n\r\nimport Super from \"./select_control\";\r\n\r\nexport default function(gantt) {\r\n\tconst _super = Super(gantt);\r\n\r\n\tfunction TypeselectControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this;\r\n\r\n\t\treturn self;\r\n\t}\r\n\r\n\t__extends(TypeselectControl, _super);\r\n\r\n\tTypeselectControl.prototype.render = function(sns) {\r\n\t\tvar types = gantt.config.types,\r\n\t\t\tlocale = gantt.locale.labels,\r\n\t\t\toptions = [];\r\n\r\n\t\tvar filter = sns.filter || function (typeKey, typeValue) {\r\n\t\t\tif (!types.placeholder || typeValue !== types.placeholder) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t};\r\n\t\tfor (var i in types) {\r\n\t\t\tif (!filter(i, types[i]) === false) {\r\n\t\t\t\toptions.push({ key: types[i], label: locale[\"type_\" + i] });\r\n\t\t\t}\r\n\t\t}\r\n\t\tsns.options = options;\r\n\r\n\t\tvar oldOnChange = sns.onchange;\r\n\t\tsns.onchange = function () {\r\n\t\t\tgantt._lightbox_current_type = this.value;\r\n\t\t\tgantt.changeLightboxType(this.value);\r\n\t\t\tif (typeof oldOnChange == 'function') {\r\n\t\t\t\toldOnChange.apply(this, arguments);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\treturn _super.prototype.render.apply(this, arguments);\r\n\t};\r\n\r\n\treturn TypeselectControl;\r\n};\r\n","\r\nimport __extends from \"../../../../utils/extends\";\r\nimport DurationFormatterNumeric from \"../../../common/duration_formatter_numeric\";\r\nimport BaseConstrutor from \"./base_control\";\r\n\r\nexport default function(gantt) {\r\n\tvar _super = BaseConstrutor(gantt);\r\n\r\n\tfunction DurationControl() {\r\n\t\tvar self = _super.apply(this, arguments) || this; \r\n\r\n\t\treturn self; \r\n\t}\r\n\r\n\tfunction getFormatter(config) {\r\n\t\treturn config.formatter || new DurationFormatterNumeric();\r\n\t}\r\n\r\n\tfunction _generateBaselineRow (node, baseline, task, config){\r\n\t\tconst time = \"<div class='gantt_time_selects'>\" + gantt.form_blocks.getTimePicker.call(gantt, config) + \"</div>\";\r\n\t\tlet durationLabel = \" \"+ gantt.locale.labels[gantt.config.duration_unit + \"s\"] +\" \";\r\n\t\tconst singleDate = config.single_date ? \" style='display:none'\" : \"\";\r\n\t\tconst readonly = config.readonly ? \" disabled='disabled'\" : \"\";\r\n\t\tconst ariaAttr = gantt._waiAria.lightboxDurationInputAttrString(config);\r\n\t\tconst deleteLabel = gantt.locale.labels.baselines_remove_button;\r\n\r\n\t\tlet durationInputClass = \"gantt_duration_value\";\r\n\t\tif(config.formatter) {\r\n\t\t\tdurationLabel = \"\";\r\n\t\t\tdurationInputClass += \" gantt_duration_value_formatted\";\r\n\t\t}\r\n\r\n\t\tconst durationEl = \"<div class='gantt_duration' \" + singleDate + \">\" +\r\n\t\t\"<div class='gantt_duration_inputs'>\" +\r\n\t\t\t\"<input type='button' class='gantt_duration_dec' value='−'\" + readonly + \">\" +\r\n\t\t\t\"<input type='text' value='5days' class='\"+durationInputClass+\"'\" + readonly + \" \" + ariaAttr + \">\" +\r\n\t\t\t\"<input type='button' class='gantt_duration_inc' value='+'\" + readonly + \">\"+\r\n\t\t\t\"</div>\" +\r\n\t\t\t\"<div class='gantt_duration_end_date'>\"+durationLabel+\"<span></span></div>\" +\r\n\t\t\t\"</div>\" +\r\n\t\t\t\"</div>\";\r\n\r\n\t\tconst deleteButton = `<div><div class='baseline_delete_button gantt_custom_button'>${deleteLabel}</div></div>`;\r\n\r\n\t\tconst baselineRow = document.createElement(\"div\");\r\n\t\tbaselineRow.className = \"gantt_section_time gantt_section_duration\";\r\n\t\tbaselineRow.setAttribute(\"data-baseline-id\", baseline.id);\r\n\t\tbaselineRow.innerHTML = time + durationEl + deleteButton + \"<br>\";\r\n\t\tnode.appendChild(baselineRow);\r\n\r\n\t\tvar s = baselineRow.getElementsByTagName(\"select\");\r\n\t\tvar inps = baselineRow.getElementsByTagName(\"input\");\r\n\t\tvar duration = inps[1];\r\n\t\tvar btns = [inps[0], inps[2]];\r\n\t\tvar endspan = baselineRow.getElementsByTagName(\"span\")[0];\r\n\t\tvar map = config._time_format_order;\r\n\t\tvar mapping;\r\n\t\tvar start_date;\r\n\t\tvar end_date;\r\n\t\tvar duration_val;\r\n\r\n\t\tconst deleteEl = baselineRow.querySelector(\".baseline_delete_button\");\r\n\t\tdeleteEl.onclick = function(e){\r\n\t\t\tconst section = baselineRow.parentNode;\r\n\t\t\tbaselineRow.innerHTML = \"\";\r\n\t\t\tbaselineRow.remove();\r\n\t\t\tif (section.innerHTML === \"\"){\r\n\t\t\t\tsection.innerHTML = gantt.locale.labels.baselines_section_placeholder;\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\r\n\t\tfunction _calc_date() {\r\n\t\t\tvar start_date = _getStartDate.call(gantt, baselineRow, config);\r\n\t\t\tvar duration = _getDuration.call(gantt, baselineRow, config);\r\n\t\t\tvar end_date = gantt.calculateEndDate({start_date: start_date, duration: duration, task: task});\r\n\r\n\t\t\tvar template = gantt.templates.task_end_date || gantt.templates.task_date;\r\n\t\t\tendspan.innerHTML = template(end_date);\r\n\t\t}\r\n\r\n\t\tfunction _change_duration(step) {\r\n\t\t\tvar value = duration.value;\r\n\r\n\t\t\tvalue = getFormatter(config).parse(value);\r\n\t\t\tif (window.isNaN(value))\r\n\t\t\t\tvalue = 0;\r\n\t\t\tvalue += step;\r\n\t\t\tif (value < 1) value = 1;\r\n\t\t\tduration.value = getFormatter(config).format(value);\r\n\t\t\t_calc_date();\r\n\t\t}\r\n\r\n\t\tbtns[0].onclick = gantt.bind(function() {\r\n\t\t\t_change_duration(-1 * gantt.config.duration_step);\r\n\t\t}, gantt);\r\n\t\tbtns[1].onclick = gantt.bind(function() {\r\n\t\t\t_change_duration(1 * gantt.config.duration_step);\r\n\t\t}, gantt);\r\n\t\ts[0].onchange = _calc_date;\r\n\t\ts[1].onchange = _calc_date;\r\n\t\ts[2].onchange = _calc_date;\r\n\t\tif (s[3]) s[3].onchange = _calc_date;\r\n\r\n\t\tduration.onkeydown = gantt.bind(function(e) {\r\n\t\t\tvar code; \r\n\r\n\t\t\te = e || window.event;\r\n\t\t\tcode = (e.charCode || e.keyCode || e.which);\r\n\t\t\t\r\n\t\t\tif (code == gantt.constants.KEY_CODES.DOWN) {\r\n\t\t\t\t_change_duration(-1 * gantt.config.duration_step);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (code == gantt.constants.KEY_CODES.UP) {\r\n\t\t\t\t_change_duration(1 * gantt.config.duration_step);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\twindow.setTimeout(_calc_date, 1);\r\n\t\t}, gantt);\r\n\r\n\t\tduration.onchange = gantt.bind(_calc_date, gantt);\r\n\r\n\t\tmapping = gantt._resolve_default_mapping(config);\r\n\t\tif (typeof(mapping) === \"string\") mapping = {start_date: mapping};\r\n\r\n\t\tstart_date = baseline.start_date || new Date();\r\n\t\tend_date = baseline.end_date || gantt.calculateEndDate({\r\n\t\t\tstart_date: start_date,\r\n\t\t\tduration: 1,\r\n\t\t\ttask\r\n\t\t});\r\n\t\tduration_val = gantt.calculateDuration({\r\n\t\t\tstart_date: start_date,\r\n\t\t\tend_date: end_date,\r\n\t\t\ttask\r\n\t\t});\r\n\t\tduration_val = getFormatter(config).format(duration_val);\r\n\r\n\t\tgantt.form_blocks._fill_lightbox_select(s, 0, start_date, map, config);\r\n\t\tduration.value = duration_val;\r\n\t\t_calc_date();\r\n\t}\r\n\r\n\t__extends(DurationControl, _super);\r\n\r\n\tDurationControl.prototype.render = function(sns) {\r\n\t\tconst baselineSection = `<div style='height: ${sns.height || 100}px; padding-top:0px; font-size:inherit;' class='gantt_section_baselines'></div>`;\r\n\t\treturn baselineSection;\r\n\t};\r\n\r\n\tDurationControl.prototype.set_value = function(node, value, task, config) {\r\n\t\tif (task.baselines){\r\n\t\t\tnode.innerHTML = \"\";\r\n\r\n\t\t\ttask.baselines.forEach((baseline)=>{\r\n\t\t\t\t_generateBaselineRow(node, baseline, task, config);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tnode.innerHTML = gantt.locale.labels.baselines_section_placeholder;\r\n\t\t}\t\t\r\n\r\n\t};\r\n\r\n\tDurationControl.prototype.get_value = function(node, task, config) {\r\n\t\tconst baselines = [];\r\n\t\tconst baselineRows = node.querySelectorAll(`[data-baseline-id]`);\r\n\t\tbaselineRows.forEach((baselineNode)=>{\r\n\t\t\tconst baselineId = baselineNode.dataset.baselineId;\r\n\t\t\tconst baselineStore = gantt.getDatastore(\"baselines\");\r\n\t\t\tlet baseline = baselineStore.getItem(baselineId);\r\n\t\t\tlet updatedBaseline;\r\n\t\t\tif (baseline){\r\n\t\t\t\tupdatedBaseline = gantt.copy(baseline);\r\n\t\t\t} else {\r\n\t\t\t\tupdatedBaseline = {\r\n\t\t\t\t\tid: gantt.uid(),\r\n\t\t\t\t\ttask_id: task.id,\r\n\t\t\t\t\ttext: \"Baseline 1\"\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tupdatedBaseline.start_date = _getStartDate(baselineNode, config);\r\n\t\t\tupdatedBaseline.duration = _getDuration(baselineNode, config);\r\n\t\t\tupdatedBaseline.end_date = gantt.calculateEndDate({start_date: updatedBaseline.start_date, duration: updatedBaseline.duration, task});\r\n\r\n\t\t\tbaselines.push(updatedBaseline);\r\n\t\t});\r\n\r\n\t\treturn baselines;\r\n\t};\r\n\r\n\tDurationControl.prototype.button_click = function (index, el, section, container) {\r\n\t\tif (gantt.callEvent(\"onSectionButton\", [gantt._lightbox_id, section]) === false) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (el.closest(\".gantt_custom_button.gantt_remove_baselines\")){\r\n\t\t\tcontainer.innerHTML = gantt.locale.labels.baselines_section_placeholder;\r\n\t\t}\r\n\t\tif (el.closest(\".gantt_custom_button.gantt_add_baselines\")){\r\n\t\t\tif (container.innerHTML == gantt.locale.labels.baselines_section_placeholder){\r\n\t\t\t\tcontainer.innerHTML = \"\";\r\n\t\t\t}\r\n\t\t\tconst task = gantt.getTask(gantt._lightbox_id);\r\n\t\t\tconst baseline = {\r\n\t\t\t\tid: gantt.uid(),\r\n\t\t\t\ttask_id: task.id,\r\n\t\t\t\ttext: \"Baseline 1\",\r\n\t\t\t\tstart_date: task.start_date,\r\n\t\t\t\tend_date: task.end_date\r\n\t\t\t};\r\n\t\t\tconst config = gantt._get_typed_lightbox_config()[index];\r\n\t\t\t_generateBaselineRow(container, baseline, task, config);\r\n\t\t}\r\n\t};\r\n\r\n\tDurationControl.prototype.focus = function(node) {\r\n\t\tgantt._focus(node.getElementsByTagName(\"select\")[0]);\r\n\t};\r\n\r\n\r\n\tfunction _getStartDate(node, config) {\r\n\t\tvar s = node.getElementsByTagName(\"select\");\r\n\t\tvar map = config._time_format_order;\r\n\t\tvar hours = 0;\r\n\t\tvar minutes = 0;\r\n\r\n\t\tif (gantt.defined(map[3])) {\r\n\t\t\tvar input = s[map[3]];\r\n\t\t\tvar time = parseInt(input.value, 10);\r\n\t\t\tif (isNaN(time) && input.hasAttribute(\"data-value\")) {\r\n\t\t\t\ttime = parseInt(input.getAttribute(\"data-value\"), 10);\r\n\t\t\t}\r\n\r\n\t\t\thours = Math.floor(time / 60);\r\n\t\t\tminutes = time % 60;\r\n\t\t}\r\n\t\treturn new Date(s[map[2]].value, s[map[1]].value, s[map[0]].value, hours, minutes);\r\n\t}\r\n\r\n\tfunction _getDuration(node, config) {\r\n\t\tvar duration = node.getElementsByTagName(\"input\")[1];\r\n\r\n\t\tduration = getFormatter(config).parse(duration.value);\r\n\t\tif (!duration || window.isNaN(duration)) duration = 1;\r\n\t\tif (duration < 0) duration *= -1;\r\n\t\treturn duration;\r\n\t}\r\n\r\n\treturn DurationControl; \r\n};","import TemplateControlConstructor from \"./controls/template_control\";\r\nimport TextareaControlConstructor from \"./controls/textarea_control\";\r\nimport TimeControlConstructor from \"./controls/time_control\";\r\nimport SelectControlConstructor from \"./controls/select_control\";\r\nimport CheckboxControlConstructor from \"./controls/checkbox_control\";\r\nimport RadioControlConstructor from \"./controls/radio_control\";\r\nimport DurationControlConstructor from \"./controls/duration_control\";\r\nimport ParentControlConstructor from \"./controls/parent_control\";\r\nimport ResourcesControlConstructor from \"./controls/resources_control\";\r\nimport ConstraintControlConstructor from \"./controls/constraint_control\";\r\nimport TypeselectControlConstructor from \"./controls/typeselect_control\";\r\nimport BaselineControlConstructor from \"./controls/baseline_control\";\r\n\r\nimport * as domHelpers from \"../utils/dom_helpers\";\r\nimport * as helpers from \"../../../utils/helpers\";\r\n\t\r\n\r\nexport default function (gantt) {\r\n\r\n\r\n\tvar TemplateControl = TemplateControlConstructor(gantt);\r\n\tvar TextareaControl = TextareaControlConstructor(gantt);\r\n\tvar TimeControl = TimeControlConstructor(gantt);\r\n\tvar SelectControl = SelectControlConstructor(gantt);\r\n\tvar CheckboxControl = CheckboxControlConstructor(gantt);\r\n\tvar RadioControl = RadioControlConstructor(gantt);\r\n\tvar DurationControl = DurationControlConstructor(gantt);\r\n\tvar ParentControl = ParentControlConstructor(gantt);\r\n\tvar ResourcesControl = ResourcesControlConstructor(gantt);\r\n\tvar ConstraintControl = ConstraintControlConstructor(gantt);\r\n\tvar TypeselectControl = TypeselectControlConstructor(gantt);\r\n\tvar BaselineControl = BaselineControlConstructor(gantt);\r\n\r\n\tgantt._lightbox_methods = {};\r\n\tgantt._lightbox_template = \"<div class='gantt_cal_ltitle'><span class='gantt_mark'>&nbsp;</span><span class='gantt_time'></span><span class='gantt_title'></span></div><div class='gantt_cal_larea'></div>\";\r\n\tgantt._lightbox_template = `<div class='gantt_cal_ltitle'><div class=\"dhx_cal_ltitle_descr\"><span class='gantt_mark'>&nbsp;</span><span class='gantt_time'></span><span class='dhx_title'></span>\r\n</div>\r\n<div class=\"gantt_cal_ltitle_controls\">\r\n\t<a class=\"gantt_cal_ltitle_close_btn dhx_gantt_icon dhx_gantt_icon_close\"></a>\r\n\r\n</div></div><div class='gantt_cal_larea'></div>`;\r\n\r\n\t// GS-1952. Attaching the lightbox to the BODY element is not considered secure.\r\n\t// Attach it to Gantt container for Salesforce and other secure environments\r\n\tgantt._lightbox_root = gantt.$root;\r\n\tfunction setParentNode() {\r\n\t\tconst cspEnvironment = gantt.config.csp === true;\r\n\t\tconst salesforceEnvironment = !!window[\"Sfdc\"] || !!window[\"$A\"] || window[\"Aura\"] || ('$shadowResolver$' in document.body);\r\n\t\tif (cspEnvironment || salesforceEnvironment) {\r\n\t\t\tgantt._lightbox_root = gantt.$root;\r\n\t\t} else {\r\n\t\t\tgantt._lightbox_root = document.body;\r\n\t\t}\r\n\t}\r\n\r\n\t//TODO: gantt._lightbox_id is changed from data.js and accessed from autoscheduling, check if it can be removed from gantt object\r\n\tvar state = gantt.$services.getService(\"state\");\r\n\tstate.registerProvider(\"lightbox\", function () {\r\n\t\treturn {\r\n\t\t\tlightbox: gantt._lightbox_id\r\n\t\t};\r\n\t});\r\n\r\n\tgantt.showLightbox = function (id) {\r\n\t\tvar task = this.getTask(id);\r\n\t\tif (!this.callEvent(\"onBeforeLightbox\", [id])) {\r\n\t\t\tif(gantt.isTaskExists(id) && gantt.getTask(id).$new){\r\n\t\t\t\t//GS-2340 if 'onBeforeLightbox' returns 'false' need update the order in datastore\r\n\t\t\t\tthis.$data.tasksStore._updateOrder();\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar box = this.getLightbox(this.getTaskType(task.type));\r\n\r\n\t\tthis.showCover(box);\r\n\t\tthis._fill_lightbox(id, box);\r\n\t\tthis._setLbPosition(box);\r\n\t\tthis._waiAria.lightboxVisibleAttr(box);\r\n\r\n\t\tthis.callEvent(\"onLightbox\", [id]);\r\n\t};\r\n\r\n\tfunction _is_chart_visible(gantt) {\r\n\t\tvar timeline = gantt.$ui.getView(\"timeline\");\r\n\t\tif (timeline && timeline.isVisible()) {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tgantt._get_timepicker_step = function () {\r\n\t\tif (this.config.round_dnd_dates) {\r\n\t\t\tvar step;\r\n\t\t\tif (_is_chart_visible(this)) {\r\n\t\t\t\tvar scale = gantt.getScale();\r\n\t\t\t\tstep = (helpers.getSecondsInUnit(scale.unit) * scale.step) / 60;//timepicker step is measured in minutes\r\n\t\t\t}\r\n\r\n\t\t\tif (!step || step >= 60 * 24) {\r\n\t\t\t\tstep = this.config.time_step;\r\n\t\t\t}\r\n\t\t\treturn step;\r\n\t\t}\r\n\t\treturn this.config.time_step;\r\n\t};\r\n\tgantt.getLabel = function (property, key) {\r\n\t\tvar sections = this._get_typed_lightbox_config();\r\n\t\tfor (var i = 0; i < sections.length; i++) {\r\n\t\t\tif (sections[i].map_to == property) {\r\n\t\t\t\tvar options = sections[i].options;\r\n\t\t\t\tfor (var j = 0; j < options.length; j++) {\r\n\t\t\t\t\tif (options[j].key == key) {\r\n\t\t\t\t\t\treturn options[j].label;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn \"\";\r\n\t};\r\n\r\n\tgantt.updateCollection = function (list_name, collection) {\r\n\t\tcollection = collection.slice(0);\r\n\t\tvar list = gantt.serverList(list_name);\r\n\t\tif (!list) return false;\r\n\t\tlist.splice(0, list.length);\r\n\t\tlist.push.apply(list, collection || []);\r\n\t\tgantt.resetLightbox();\r\n\t};\r\n\tgantt.getLightboxType = function () {\r\n\t\treturn this.getTaskType(this._lightbox_type);\r\n\t};\r\n\tgantt.getLightbox = function (type) {\r\n\t\tvar lightboxDiv;\r\n\t\tvar fullWidth;\r\n\t\tvar html;\r\n\t\tvar sns;\r\n\t\tvar ds;\r\n\t\tvar classNames = \"\";\r\n\t\tsetParentNode();\r\n\r\n\t\tif (type === undefined)\r\n\t\t\ttype = this.getLightboxType();\r\n\r\n\t\tif (!this._lightbox || this.getLightboxType() != this.getTaskType(type)) {\r\n\t\t\tthis._lightbox_type = this.getTaskType(type);\r\n\t\t\tlightboxDiv = document.createElement(\"div\");\r\n\t\t\tclassNames = \"gantt_cal_light\";\r\n\t\t\tfullWidth = this._is_lightbox_timepicker();\r\n\r\n\t\t\tif (gantt.config.wide_form)\r\n\t\t\t\tclassNames += \" gantt_cal_light_wide\";\r\n\r\n\t\t\tif (fullWidth) {\r\n\t\t\t\tclassNames += \" gantt_cal_light_full\";\r\n\t\t\t}\r\n\r\n\t\t\tlightboxDiv.className = classNames;\r\n\r\n\t\t\tlightboxDiv.style.visibility = \"hidden\";\r\n\t\t\thtml = this._lightbox_template;\r\n\t\t\thtml += \"<div class='gantt_cal_lcontrols'>\";\r\n\t\t\thtml += getHtmlButtons(this.config.buttons_left);\r\n\t\t\thtml += \"<div class='gantt_cal_lcontrols_push_right'></div>\";\r\n\t\t\thtml += getHtmlButtons(this.config.buttons_right, true);\r\n\t\t\thtml += \"</div>\";\r\n\r\n\t\t\tlightboxDiv.innerHTML = html;\r\n\r\n\t\t\tgantt._waiAria.lightboxAttr(lightboxDiv);\r\n\r\n\t\t\tif (gantt.config.drag_lightbox) {\r\n\t\t\t\tlightboxDiv.firstChild.onmousedown = gantt._ready_to_dnd;\r\n\t\t\t\tlightboxDiv.firstChild.ontouchstart = function (e){\r\n\t\t\t\t\tgantt._ready_to_dnd(e.touches[0]);\r\n\t\t\t\t};\r\n\t\t\t\tlightboxDiv.firstChild.onselectstart = function () {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t};\r\n\t\t\t\tlightboxDiv.firstChild.style.cursor = \"pointer\";\r\n\t\t\t\tgantt._init_dnd_events();\r\n\t\t\t}\r\n\r\n\t\t\t// GS-1428: If there is lightbox node, we need to remove it from the DOM\r\n\t\t\tif (this._lightbox){\r\n\t\t\t\tthis.resetLightbox();\r\n\t\t\t}\r\n\t\t\tshow_cover();\r\n\t\t\tthis._cover.insertBefore(lightboxDiv, this._cover.firstChild);\r\n\t\t\tthis._lightbox = lightboxDiv;\r\n\r\n\t\t\tsns = this._get_typed_lightbox_config(type);\r\n\t\t\thtml = this._render_sections(sns);\r\n\r\n\t\t\tds = lightboxDiv.querySelector(\"div.gantt_cal_larea\");\r\n\t\t\t\r\n\t\t\t//GS-1131. If gantt_cal_larea is displayed, Firefox renders buttons incorrectly;\r\n\t\t\tvar backup_overflow = ds.style.overflow;\r\n\t\t\tds.style.overflow = 'hidden';\r\n\r\n\t\t\tds.innerHTML = html;\r\n\r\n\t\t\t\r\n\r\n\t\t\tbindLabelsToInputs(sns);\r\n\r\n\t\t\tds.style.overflow = backup_overflow;\r\n\r\n\t\t\tthis._init_lightbox_events(this);\r\n\t\t\tlightboxDiv.style.display = \"none\";\r\n\t\t\tlightboxDiv.style.visibility = \"visible\";\r\n\t\t}\r\n\t\treturn this._lightbox;\r\n\t};\r\n\r\n\tgantt._render_sections = function (sns) {\r\n\t\tvar html = \"\";\r\n\t\tfor (var i = 0; i < sns.length; i++) {\r\n\t\t\tvar block = this.form_blocks[sns[i].type];\r\n\t\t\tif (!block) continue; //ignore incorrect blocks\r\n\t\t\tsns[i].id = \"area_\" + this.uid();\r\n\r\n\t\t\tvar display = sns[i].hidden ? \" style='display:none'\" : \"\";\r\n\t\t\tvar button = \"\";\r\n\t\t\tif (sns[i].button) {\r\n\t\t\t\tbutton = \"<div class='gantt_custom_button' data-index='\" + i + \"'><div class='gantt_custom_button_\" + sns[i].button + \"'></div><div class='gantt_custom_button_label'>\" + this.locale.labels[\"button_\" + sns[i].button] + \"</div></div>\";\r\n\t\t\t}\r\n\t\t\tif (sns[i].type == \"baselines\") {\r\n\t\t\t\tbutton = \"<div class='gantt_custom_button gantt_remove_baselines' data-index='\" + i + \"'><div class='gantt_custom_button_delete_baselines'></div><div class='gantt_custom_button_label'>\" + this.locale.labels.baselines_remove_all_button + \"</div></div>\" +\r\n\t\t\t\t\"<div class='gantt_custom_button gantt_add_baselines' data-index='\" + i + \"'><div class='gantt_custom_button_add_baseline'></div><div class='gantt_custom_button_label'>\" + this.locale.labels.baselines_add_button + \"</div></div>\";\r\n\t\t\t}\r\n\t\t\tif (this.config.wide_form) {\r\n\t\t\t\thtml += \"<div class='gantt_wrap_section' \" + display + \">\";\r\n\t\t\t}\r\n\t\t\thtml += \"<div id='\" + sns[i].id + \"' class='gantt_cal_lsection'><label>\" + button + this.locale.labels[\"section_\" + sns[i].name] + \"</label></div>\" + block.render.call(this, sns[i]);\r\n\t\t\thtml += \"</div>\";\r\n\t\t}\r\n\t\treturn html;\r\n\t};\r\n\r\n\tgantt._center_lightbox = function(box){\r\n\t\tgantt._setLbPosition(box);\r\n\t};\r\n\tgantt._setLbPosition = function(box) {\r\n\t\tif(!box){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst rootElement = gantt._lightbox_root || gantt.$root;\r\n\t\tbox.style.top = Math.max(rootElement.offsetHeight / 2 - box.offsetHeight/2, 0) + \"px\";\r\n\t\tbox.style.left = Math.max(rootElement.offsetWidth / 2 - box.offsetWidth/2, 0) + \"px\";\r\n\t};\r\n\r\n\tgantt.showCover = function (box) {\r\n\t\tif (box){\r\n\t\t\tbox.style.display=\"block\";\r\n\t\r\n\t\t\tthis._setLbPosition(box);\r\n\t\t}\r\n\t\tshow_cover();\r\n\t\tthis._cover.style.display = \"\";\r\n\t};\r\n\tconst show_cover=function(){\r\n\t\tif(gantt._cover) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\tgantt._cover=document.createElement(\"div\");\r\n\t\tgantt._cover.className=\"gantt_cal_cover\";\r\n\t\tgantt._cover.style.display = \"none\";\r\n\t\r\n\t\tgantt.event(gantt._cover, \"mousemove\", gantt._move_while_dnd);\r\n\t\tgantt.event(gantt._cover, \"mouseup\", gantt._finish_dnd);\r\n\t\r\n\t\tconst rootElement = gantt._lightbox_root || gantt.$root;\r\n\t\trootElement.appendChild(gantt._cover);\r\n\t};\r\n\r\n\tgantt._init_lightbox_events = function () {\r\n\t\tgantt.lightbox_events = {};\r\n\r\n\r\n\t\tgantt.lightbox_events.gantt_save_btn = function () {\r\n\t\t\tgantt._save_lightbox();\r\n\t\t};\r\n\r\n\r\n\t\tgantt.lightbox_events.gantt_delete_btn = function () {\r\n\t\t\tgantt._lightbox_current_type = null;\r\n\t\t\tif (!gantt.callEvent(\"onLightboxDelete\", [gantt._lightbox_id]))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (gantt.isTaskExists(gantt._lightbox_id)) {\r\n\t\t\t\tgantt.$click.buttons[\"delete\"](gantt._lightbox_id);\r\n\t\t\t} else {\r\n\t\t\t\tgantt.hideLightbox();\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\r\n\t\tgantt.lightbox_events.gantt_cancel_btn = function () {\r\n\t\t\tgantt._cancel_lightbox();\r\n\t\t};\r\n\r\n\r\n\t\tgantt.lightbox_events[\"default\"] = function (e, src) {\r\n\t\t\tif (src.getAttribute(\"data-dhx-button\")) {\r\n\t\t\t\tgantt.callEvent(\"onLightboxButton\", [src.className, src, e]);\r\n\t\t\t} else {\r\n\t\t\t\tvar index, block, sec;\r\n\r\n\t\t\t\tvar className = domHelpers.getClassName(src);\r\n\t\t\t\tif (className.indexOf(\"gantt_custom_button\") != -1) {\r\n\t\t\t\t\tif (className.indexOf(\"gantt_custom_button_\") != -1) {\r\n\t\t\t\t\t\tindex = src.parentNode.getAttribute(\"data-index\");\r\n\t\t\t\t\t\tsec = src;\r\n\t\t\t\t\t\twhile (sec && domHelpers.getClassName(sec).indexOf(\"gantt_cal_lsection\") == -1) {\r\n\t\t\t\t\t\t\tsec = sec.parentNode;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tindex = src.getAttribute(\"data-index\");\r\n\t\t\t\t\t\tsec = src.closest(\".gantt_cal_lsection\");\r\n\t\t\t\t\t\tsrc = src.firstChild;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar sections = gantt._get_typed_lightbox_config();\r\n\r\n\t\t\t\tif (index) {\r\n\t\t\t\t\tindex = index * 1;\r\n\t\t\t\t\tblock = gantt.form_blocks[sections[index * 1].type];\r\n\t\t\t\t\tblock.button_click(index, src, sec, sec.nextSibling);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\tthis.event(gantt.getLightbox(), \"click\", function (e) {\r\n\t\t\tif(e.target.closest(\".gantt_cal_ltitle_close_btn\")){\r\n\t\t\t\tgantt._cancel_lightbox();\r\n\t\t\t}\r\n\t\t\tvar src = domHelpers.getTargetNode(e);\r\n\r\n\t\t\tvar className = domHelpers.getClassName(src);\r\n\t\t\tif (!className) {\r\n\t\t\t\tsrc = src.previousSibling;\r\n\t\t\t\tclassName = domHelpers.getClassName(src);\r\n\t\t\t}\r\n\t\t\tif (src && className && className.indexOf(\"gantt_btn_set\") === 0) {\r\n\t\t\t\tsrc = src.firstChild;\r\n\t\t\t\tclassName = domHelpers.getClassName(src);\r\n\t\t\t}\r\n\t\t\tif (src && className) {\r\n\t\t\t\tvar func = gantt.defined(gantt.lightbox_events[src.className]) ? gantt.lightbox_events[src.className] : gantt.lightbox_events[\"default\"];\r\n\t\t\t\treturn func(e, src);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tgantt.getLightbox().onkeydown = function (e) {\r\n\t\t\tvar event = e || window.event;\r\n\t\t\tvar target = e.target || e.srcElement;\r\n\t\t\tvar buttonTarget = domHelpers.getClassName(target).indexOf(\"gantt_btn_set\") > -1;\r\n\r\n\t\t\tswitch ((e || event).keyCode) {\r\n\t\t\t\tcase gantt.constants.KEY_CODES.SPACE: {\r\n\t\t\t\t\tif ((e || event).shiftKey) return;\r\n\t\t\t\t\tif (buttonTarget && target.click) {\r\n\t\t\t\t\t\ttarget.click();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tcase gantt.keys.edit_save:\r\n\t\t\t\t\tif ((e || event).shiftKey) return;\r\n\t\t\t\t\tif (buttonTarget && target.click) {\r\n\t\t\t\t\t\ttarget.click();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tgantt._save_lightbox();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase gantt.keys.edit_cancel:\r\n\t\t\t\t\tgantt._cancel_lightbox();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\r\n\tgantt._cancel_lightbox = function () {\r\n\t\tvar task = this.getLightboxValues();\r\n\t\tgantt._lightbox_current_type = null;\r\n\t\tthis.callEvent(\"onLightboxCancel\", [this._lightbox_id, task.$new]);\r\n\t\tif (gantt.isTaskExists(task.id) && task.$new) {\r\n\t\t\tthis.silent(function () {\r\n\t\t\t\tgantt.$data.tasksStore.removeItem(task.id);\r\n\t\t\t\tgantt._update_flags(task.id, null);\r\n\t\t\t});\r\n\t\t\tthis.refreshData();\r\n\t\t}\r\n\r\n\t\tthis.hideLightbox();\r\n\t};\r\n\r\n\tgantt._save_lightbox = function () {\r\n\t\tvar task = this.getLightboxValues();\r\n\t\tgantt._lightbox_current_type = null;\r\n\t\tif (!this.callEvent(\"onLightboxSave\", [this._lightbox_id, task, !!task.$new]))\r\n\t\t\treturn;\r\n\r\n\t\t// GS-2170. Do not recalculate the indexes and dates of other tasks\r\n\t\t// as they will be recalculated in the `refreshData`\r\n\t\tgantt.$data.tasksStore._skipTaskRecalculation = \"lightbox\";\r\n\t\tif (task.$new) {\r\n\t\t\tdelete task.$new;\r\n\t\t\tthis.addTask(task, task.parent, this.getTaskIndex(task.id));\r\n\t\t} else if (this.isTaskExists(task.id)) {\r\n\t\t\tthis.mixin(this.getTask(task.id), task, true);\r\n\t\t\tthis.refreshTask(task.id);\r\n\t\t\tthis.updateTask(task.id);\r\n\t\t}\r\n\t\tgantt.$data.tasksStore._skipTaskRecalculation = false;\r\n\t\tthis.refreshData();\r\n\r\n\t\t// TODO: do we need any blockable events here to prevent closing lightbox?\r\n\t\tthis.hideLightbox();\r\n\t};\r\n\r\n\tgantt._resolve_default_mapping = function (section) {\r\n\t\tvar mapping = section.map_to;\r\n\t\tvar time_controls = { \"time\": true, \"time_optional\": true, \"duration\": true, \"duration_optional\": true };\r\n\t\tif (time_controls[section.type]) {\r\n\t\t\tif (section.map_to == \"auto\") {\r\n\t\t\t\tmapping = { start_date: \"start_date\", end_date: \"end_date\", duration: \"duration\" };\r\n\t\t\t} else if (typeof (section.map_to) === \"string\") {\r\n\t\t\t\tmapping = { start_date: section.map_to };\r\n\t\t\t}\r\n\t\t} else if (section.type === \"constraint\") {\r\n\t\t\tif (!section.map_to || typeof (section.map_to) === \"string\") {\r\n\t\t\t\tmapping = { constraint_type: \"constraint_type\", constraint_date: \"constraint_date\" };\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn mapping;\r\n\t};\r\n\r\n\tgantt.getLightboxValues = function () {\r\n\t\tvar task = {};\r\n\r\n\t\tif (gantt.isTaskExists(this._lightbox_id)) {\r\n\t\t\ttask = this.mixin({}, this.getTask(this._lightbox_id));\r\n\t\t}\r\n\r\n\t\tvar sns = this._get_typed_lightbox_config();\r\n\t\tfor (var i = 0; i < sns.length; i++) {\r\n\t\t\tvar node = gantt._lightbox_root.querySelector(\"#\" + sns[i].id);\r\n\t\t\tnode = (node ? node.nextSibling : node);\r\n\t\t\tvar block = this.form_blocks[sns[i].type];\r\n\t\t\tif (!block) continue;\r\n\t\t\tvar res = block.get_value.call(this, node, task, sns[i]);\r\n\t\t\tvar map_to = gantt._resolve_default_mapping(sns[i]);\r\n\t\t\tif (typeof map_to == \"string\" && map_to != \"auto\") {\r\n\t\t\t\ttask[map_to] = res;\r\n\t\t\t} else if (typeof map_to == \"object\") {\r\n\t\t\t\tfor (var property in map_to) {\r\n\t\t\t\t\tif (map_to[property])\r\n\t\t\t\t\t\ttask[map_to[property]] = res[property];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// GS-1282 We need to preserve the task type even if the lightbox doesn't have the typeselect section\r\n\t\t// GS-2460 set the current type from selector\r\n\t\tif (gantt._lightbox_current_type) {\r\n\t\t\ttask.type = gantt._lightbox_current_type;\r\n\t\t}\r\n\r\n\t\treturn task;\r\n\t};\r\n\r\n\r\n\tgantt.hideLightbox = function () {\r\n\t\tvar box = this.getLightbox();\r\n\t\tif (box) box.style.display = \"none\";\r\n\r\n\t\tthis._waiAria.lightboxHiddenAttr(box);\r\n\t\tthis._lightbox_id = null;\r\n\r\n\t\tthis.hideCover(box);\r\n\t\tthis.resetLightbox();\r\n\t\tthis.callEvent(\"onAfterLightbox\", []);\r\n\t};\r\n\tgantt.hideCover = function (box) {\r\n\t\tif(box){\r\n\t\t\tbox.style.display = \"none\";\r\n\t\t}\r\n\t\tif (this._cover)\r\n\t\t\tthis._cover.parentNode.removeChild(this._cover);\r\n\t\tthis._cover = null;\r\n\t};\r\n\r\n\tgantt.resetLightbox = function () {\r\n\t\tif (gantt._lightbox && !gantt._custom_lightbox)\r\n\t\t\tgantt._lightbox.remove();\r\n\t\tgantt._lightbox = null;\r\n\t};\r\n\tgantt._set_lightbox_values = function (data, box) {\r\n\t\tvar task = data;\r\n\t\tvar s = box.getElementsByTagName(\"span\");\r\n\t\tvar lightboxHeader = [];\r\n\t\tif (gantt.templates.lightbox_header) {\r\n\t\t\tlightboxHeader.push(\"\");\r\n\t\t\tlightboxHeader.push(gantt.templates.lightbox_header(task.start_date, task.end_date, task));\r\n\t\t\ts[1].innerHTML = \"\";\r\n\t\t\ts[2].innerHTML = gantt.templates.lightbox_header(task.start_date, task.end_date, task);\r\n\t\t} else {\r\n\t\t\tlightboxHeader.push(this.templates.task_time(task.start_date, task.end_date, task));\r\n\t\t\tlightboxHeader.push(String(this.templates.task_text(task.start_date, task.end_date, task) || \"\").substr(0, 70)); //IE6 fix\r\n\t\t\ts[1].innerHTML = this.templates.task_time(task.start_date, task.end_date, task);\r\n\t\t\ts[2].innerHTML = String(this.templates.task_text(task.start_date, task.end_date, task) || \"\").substr(0, 70); //IE6 fix\r\n\t\t}\r\n\t\ts[1].innerHTML = lightboxHeader[0];\r\n\t\ts[2].innerHTML = lightboxHeader[1];\r\n\r\n\t\tgantt._waiAria.lightboxHeader(box, lightboxHeader.join(\" \"));\r\n\r\n\t\tvar sns = this._get_typed_lightbox_config(this.getLightboxType());\r\n\t\tfor (var i = 0; i < sns.length; i++) {\r\n\t\t\tvar section = sns[i];\r\n\r\n\t\t\tif (!this.form_blocks[section.type]) {\r\n\t\t\t\tcontinue;//skip incorrect sections, same check is done during rendering\r\n\t\t\t}\r\n\r\n\r\n\t\t\tvar node = gantt._lightbox_root.querySelector(\"#\" + section.id).nextSibling;\r\n\t\t\tvar block = this.form_blocks[section.type];\r\n\t\t\tvar map_to = gantt._resolve_default_mapping(sns[i]);\r\n\t\t\tvar value = this.defined(task[map_to]) ? task[map_to] : section.default_value;\r\n\t\t\tblock.set_value.call(gantt, node, value, task, section);\r\n\r\n\t\t\tif (section.focus)\r\n\t\t\t\tblock.focus.call(gantt, node);\r\n\t\t}\r\n\t\tif (gantt.isTaskExists(data.id)){\r\n\t\t\tgantt._lightbox_id = data.id;\r\n\t\t}\r\n\t};\r\n\tgantt._fill_lightbox = function (id, box) {\r\n\t\tvar task = this.getTask(id);\r\n\t\tthis._set_lightbox_values(task, box);\r\n\t};\r\n\r\n\r\n\tgantt.getLightboxSection = function (name) {\r\n\t\tvar config = this._get_typed_lightbox_config();\r\n\t\tvar i = 0;\r\n\t\tfor (i; i < config.length; i++)\r\n\t\t\tif (config[i].name == name)\r\n\t\t\t\tbreak;\r\n\t\tvar section = config[i];\r\n\t\tif (!section)\r\n\t\t\treturn null;\r\n\r\n\t\tif (!this._lightbox)\r\n\t\t\tthis.getLightbox();\r\n\t\tvar header = gantt._lightbox_root.querySelector(\"#\" + section.id);\r\n\t\tvar node = header.nextSibling;\r\n\r\n\t\tvar result = {\r\n\t\t\tsection: section,\r\n\t\t\theader: header,\r\n\t\t\tnode: node,\r\n\t\t\tgetValue: function (ev) {\r\n\t\t\t\treturn gantt.form_blocks[section.type].get_value.call(gantt, node, (ev || {}), section);\r\n\t\t\t},\r\n\t\t\tsetValue: function (value, ev) {\r\n\t\t\t\treturn gantt.form_blocks[section.type].set_value.call(gantt, node, value, (ev || {}), section);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar handler = this._lightbox_methods[\"get_\" + section.type + \"_control\"];\r\n\t\treturn handler ? handler(result) : result;\r\n\t};\r\n\r\n\tgantt._lightbox_methods.get_template_control = function (result) {\r\n\t\tresult.control = result.node;\r\n\t\treturn result;\r\n\t};\r\n\tgantt._lightbox_methods.get_select_control = function (result) {\r\n\t\tresult.control = result.node.getElementsByTagName(\"select\")[0];\r\n\t\treturn result;\r\n\t};\r\n\tgantt._lightbox_methods.get_textarea_control = function (result) {\r\n\t\tresult.control = result.node.getElementsByTagName(\"textarea\")[0];\r\n\t\treturn result;\r\n\t};\r\n\tgantt._lightbox_methods.get_time_control = function (result) {\r\n\t\tresult.control = result.node.getElementsByTagName(\"select\"); // array\r\n\t\treturn result;\r\n\t};\r\n\r\n\r\n\tgantt._init_dnd_events = function () {\r\n\t\tvar eventElement = gantt._lightbox_root;\r\n\t\tthis.event(eventElement, \"mousemove\", gantt._move_while_dnd);\r\n\t\tthis.event(eventElement, \"mouseup\", gantt._finish_dnd);\r\n\t\tthis.event(eventElement, \"touchmove\", function (e){\r\n\t\t\tgantt._move_while_dnd(e.touches[0]);\r\n\t\t});\r\n\t\tthis.event(eventElement, \"touchend\", function (e){\r\n\t\t\tgantt._finish_dnd(e.touches[0]);\r\n\t\t});\r\n\t\t// GS-1952: In Salesforce environment, the lightbox is attached to the Gantt container. \r\n\t\t// So when Gantt is reinitialized, the events are no longer attached to the Gantt container.\r\n\t\t// gantt._init_dnd_events = function () {\r\n\t\t// };\r\n\t};\r\n\tgantt._move_while_dnd = function (event) {\r\n\t\tif (gantt._dnd_start_lb) {\r\n\t\t\tif (!document.gantt_unselectable) {\r\n\t\t\t\tgantt._lightbox_root.className += \" gantt_unselectable\";\r\n\t\t\t\tdocument.gantt_unselectable = true;\r\n\t\t\t}\r\n\t\t\tvar lb = gantt.getLightbox();\r\n\t\t\tvar now = [event.pageX, event.pageY];\r\n\t\t\tlb.style.top = gantt._lb_start[1] + now[1] - gantt._dnd_start_lb[1] + \"px\";\r\n\t\t\tlb.style.left = gantt._lb_start[0] + now[0] - gantt._dnd_start_lb[0] + \"px\";\r\n\t\t}\r\n\t};\r\n\tgantt._ready_to_dnd = function (event) {\r\n\t\tvar lb = gantt.getLightbox();\r\n\t\tgantt._lb_start = [lb.offsetLeft, lb.offsetTop];\r\n\t\tgantt._dnd_start_lb = [event.pageX, event.pageY];\r\n\t};\r\n\tgantt._finish_dnd = function () {\r\n\t\tif (gantt._lb_start) {\r\n\t\t\tgantt._lb_start = gantt._dnd_start_lb = false;\r\n\t\t\tgantt._lightbox_root.className = gantt._lightbox_root.className.replace(\" gantt_unselectable\", \"\");\r\n\t\t\tdocument.gantt_unselectable = false;\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tgantt._focus = function (node, select) {\r\n\t\tif (node && node.focus) {\r\n\t\t\tif (gantt.config.touch) {\r\n\t\t\t\t//do not focus editor, to prevent auto-zoom\r\n\t\t\t} else {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (select && node.select) node.select();\r\n\t\t\t\t\tnode.focus();\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\t// silent errors\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tgantt.form_blocks = {\r\n\t\tgetTimePicker: function (sns, hidden) {\r\n\t\t\tvar html = \"\";\r\n\t\t\tvar cfg = this.config;\r\n\t\t\tvar i;\r\n\t\t\tvar options;\r\n\t\t\tvar ariaAttrs;\r\n\t\t\tvar readonly;\r\n\t\t\tvar display;\r\n\t\t\tvar settings = {\r\n\t\t\t\tfirst: 0,\r\n\t\t\t\tlast: 24 * 60,\r\n\t\t\t\tdate: this.date.date_part(new Date(gantt._min_date.valueOf())),\r\n\t\t\t\ttimeFormat: getTimeFormat(sns)\r\n\t\t\t};\r\n\r\n\t\t\t// map: default order => real one\r\n\t\t\tsns._time_format_order = { size: 0 };\r\n\r\n\t\t\tif (gantt.config.limit_time_select) {\r\n\t\t\t\tsettings.first = 60 * cfg.first_hour;\r\n\t\t\t\tsettings.last = 60 * cfg.last_hour + 1;\r\n\t\t\t\tsettings.date.setHours(cfg.first_hour);\r\n\t\t\t}\r\n\r\n\t\t\tfor (i = 0; i < settings.timeFormat.length; i++) {\r\n\t\t\t\t// adding spaces between selects\r\n\t\t\t\tif (i > 0) {\r\n\t\t\t\t\thtml += \" \";\r\n\t\t\t\t}\r\n\r\n\t\t\t\toptions = getHtmlTimePickerOptions(sns, i, settings);\r\n\r\n\t\t\t\tif (options) {\r\n\t\t\t\t\tariaAttrs = gantt._waiAria.lightboxSelectAttrString(settings.timeFormat[i]);\r\n\t\t\t\t\treadonly = sns.readonly ? \"disabled='disabled'\" : \"\";\r\n\t\t\t\t\tdisplay = hidden ? \" style='display:none' \" : \"\";\r\n\t\t\t\t\thtml += \"<select \" + readonly + display + ariaAttrs + \">\" + options + \"</select>\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn html;\r\n\t\t},\r\n\t\tgetTimePickerValue: function (selects, config, offset) {\r\n\t\t\tvar map = config._time_format_order;\r\n\t\t\tvar needSetTime = gantt.defined(map[3]);\r\n\r\n\t\t\tvar time;\r\n\t\t\tvar hours = 0;\r\n\t\t\tvar minutes = 0;\r\n\r\n\t\t\tvar mapOffset = offset || 0;\r\n\r\n\t\t\tif (needSetTime) {\r\n\t\t\t\ttime = parseInt(selects[map[3] + mapOffset].value, 10);\r\n\t\t\t\thours = Math.floor(time / 60);\r\n\t\t\t\tminutes = time % 60;\r\n\t\t\t}\r\n\t\t\treturn new Date(selects[map[2] + mapOffset].value, selects[map[1] + mapOffset].value, selects[map[0] + mapOffset].value, hours, minutes);\r\n\t\t},\r\n\r\n\t\t_fill_lightbox_select: function (s, i, d, map) {\r\n\t\t\ts[i + map[0]].value = d.getDate();\r\n\t\t\ts[i + map[1]].value = d.getMonth();\r\n\t\t\ts[i + map[2]].value = d.getFullYear();\r\n\t\t\tif (gantt.defined(map[3])) {\r\n\t\t\t\tvar v = d.getHours() * 60 + d.getMinutes();\r\n\t\t\t\tv = Math.round(v / gantt._get_timepicker_step()) * gantt._get_timepicker_step();\r\n\t\t\t\tvar input = s[i + map[3]];\r\n\t\t\t\tinput.value = v;\r\n\t\t\t\t//in case option not shown\r\n\t\t\t\tinput.setAttribute(\"data-value\", v);\r\n\t\t\t}\r\n\t\t},\r\n\t\ttemplate: new TemplateControl(),\r\n\t\ttextarea: new TextareaControl(),\r\n\t\tselect: new SelectControl(),\r\n\t\ttime: new TimeControl(),\r\n\t\tduration: new DurationControl(),\r\n\t\tparent: new ParentControl(),\r\n\t\tradio: new RadioControl(),\r\n\t\tcheckbox: new CheckboxControl(),\r\n\t\tresources: new ResourcesControl(),\r\n\t\tconstraint: new ConstraintControl(),\r\n\t\tbaselines: new BaselineControl(),\r\n\t\ttypeselect: new TypeselectControl()\r\n\t};\r\n\r\n\tgantt._is_lightbox_timepicker = function () {\r\n\t\tvar s = this._get_typed_lightbox_config();\r\n\t\tfor (var i = 0; i < s.length; i++)\r\n\t\t\tif (s[i].name == \"time\" && s[i].type == \"time\")\r\n\t\t\t\treturn true;\r\n\t\treturn false;\r\n\t};\r\n\r\n\tgantt._simple_confirm = function (message, title, callback, ok) {\r\n\t\tif (!message)\r\n\t\t\treturn callback();\r\n\t\tvar opts = { text: message };\r\n\t\tif (title)\r\n\t\t\topts.title = title;\r\n\t\tif (ok) {\r\n\t\t\topts.ok = ok;\r\n\t\t}\r\n\t\tif (callback) {\r\n\t\t\topts.callback = function (result) {\r\n\t\t\t\tif (result)\r\n\t\t\t\t\tcallback();\r\n\t\t\t};\r\n\t\t}\r\n\t\tgantt.confirm(opts);\r\n\t};\r\n\r\n\tfunction _get_type_name(type_value) {\r\n\t\tfor (var i in this.config.types) {\r\n\t\t\tif (this.config.types[i] == type_value) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn \"task\";\r\n\t}\r\n\r\n\tgantt._get_typed_lightbox_config = function (type) {\r\n\t\tif (type === undefined) {\r\n\t\t\ttype = this.getLightboxType();\r\n\t\t}\r\n\r\n\t\tvar field = _get_type_name.call(this, type);\r\n\r\n\t\tif (gantt.config.lightbox[field + \"_sections\"]) {\r\n\t\t\treturn gantt.config.lightbox[field + \"_sections\"];\r\n\t\t} else {\r\n\t\t\treturn gantt.config.lightbox.sections;\r\n\t\t}\r\n\t};\r\n\r\n\tgantt._silent_redraw_lightbox = function (type) {\r\n\t\tvar oldType = this.getLightboxType();\r\n\r\n\t\tif (this.getState().lightbox) {\r\n\t\t\tvar taskId = this.getState().lightbox;\r\n\t\t\tvar formData = this.getLightboxValues(),\r\n\t\t\t\ttask = this.copy(this.getTask(taskId));\r\n\r\n\t\t\tthis.resetLightbox();\r\n\r\n\t\t\tvar updTask = this.mixin(task, formData, true);\r\n\t\t\tvar box = this.getLightbox(type ? type : undefined);\r\n\t\t\tthis._set_lightbox_values(updTask, box);\r\n\t\t\tthis.showCover(box);\r\n\t\t} else {\r\n\t\t\tthis.resetLightbox();\r\n\t\t\tthis.getLightbox(type ? type : undefined);\r\n\t\t}\r\n\t\tthis.callEvent(\"onLightboxChange\", [oldType, this.getLightboxType()]);\r\n\t};\r\n\r\n\tfunction bindLabelsToInputs(sns) {\r\n\t\tvar section;\r\n\t\tvar label;\r\n\t\tvar labelBlock;\r\n\t\tvar inputBlock;\r\n\t\tvar input;\r\n\t\tvar i;\r\n\r\n\t\tfor (i = 0; i < sns.length; i++) {\r\n\t\t\tsection = sns[i];\r\n\t\t\tlabelBlock = gantt._lightbox_root.querySelector(\"#\" + section.id);\r\n\r\n\t\t\tif (!section.id || !labelBlock) continue;\r\n\r\n\t\t\tlabel = labelBlock.querySelector(\"label\");\r\n\t\t\tinputBlock = labelBlock.nextSibling;\r\n\r\n\t\t\tif (!inputBlock) continue;\r\n\r\n\t\t\tinput = inputBlock.querySelector(\"input, select, textarea\");\r\n\t\t\tif (input) {\r\n\t\t\t\tinput.id = input.id || \"input_\" + gantt.uid();\r\n\t\t\t\tsection.inputId = input.id;\r\n\t\t\t\tlabel.setAttribute(\"for\", section.inputId);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getHtmlButtons(buttons, floatRight) {\r\n\t\tvar button;\r\n\t\tvar ariaAttr;\r\n\t\tvar html = \"\";\r\n\t\tvar i;\r\n\r\n\t\tfor (i = 0; i < buttons.length; i++) {\r\n\t\t\t// needed to migrate from 'dhx_something' to 'gantt_something' naming in a lightbox\r\n\t\t\tbutton = gantt.config._migrate_buttons[buttons[i]] ? gantt.config._migrate_buttons[buttons[i]] : buttons[i];\r\n\r\n\t\t\tariaAttr = gantt._waiAria.lightboxButtonAttrString(button);\r\n\t\t\thtml += \"<div \" + ariaAttr + \" class='gantt_btn_set gantt_left_btn_set \" + button + \"_set'\" + \"><div dhx_button='1' data-dhx-button='1' class='\" + button + \"'></div><div>\" + gantt.locale.labels[button] + \"</div></div>\";\r\n\t\t}\r\n\t\treturn html;\r\n\t}\r\n\r\n\tfunction getTimeFormat(sns) {\r\n\t\tvar scale;\r\n\t\tvar unit;\r\n\t\tvar result;\r\n\r\n\t\tif (sns.time_format) return sns.time_format;\r\n\r\n\t\t// default order\r\n\t\tresult = [\"%d\", \"%m\", \"%Y\"];\r\n\t\tscale = gantt.getScale();\r\n\t\tunit = scale ? scale.unit : gantt.config.duration_unit;\r\n\t\tif (helpers.getSecondsInUnit(unit) < helpers.getSecondsInUnit(\"day\")) {\r\n\t\t\tresult.push(\"%H:%i\");\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfunction getHtmlTimePickerOptions(sns, index, settings) {\r\n\t\tvar range;\r\n\t\tvar offset;\r\n\t\tvar start_year;\r\n\t\tvar end_year;\r\n\t\tvar i;\r\n\t\tvar time;\r\n\t\tvar diff;\r\n\t\tvar tdate;\r\n\t\tvar html = \"\";\r\n\r\n\t\tswitch (settings.timeFormat[index]) {\r\n\t\t\tcase \"%Y\":\r\n\t\t\t\tsns._time_format_order[2] = index;\r\n\t\t\t\tsns._time_format_order.size++;\r\n\t\t\t\t//year\r\n\r\n\t\t\t\tif (sns.year_range) {\r\n\t\t\t\t\tif (!isNaN(sns.year_range)) {\r\n\t\t\t\t\t\trange = sns.year_range;\r\n\t\t\t\t\t} else if (sns.year_range.push) {\r\n\t\t\t\t\t\t// if\r\n\t\t\t\t\t\tstart_year = sns.year_range[0];\r\n\t\t\t\t\t\tend_year = sns.year_range[1];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\trange = range || 10;\r\n\t\t\t\toffset = offset || Math.floor(range / 2);\r\n\t\t\t\tstart_year = start_year || settings.date.getFullYear() - offset;\r\n\t\t\t\tend_year = end_year || gantt.getState().max_date.getFullYear() + offset;\r\n\r\n\t\t\t\tfor (i = start_year; i <= end_year; i++)\r\n\t\t\t\t\thtml += \"<option value='\" + (i) + \"'>\" + (i) + \"</option>\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%m\":\r\n\t\t\t\tsns._time_format_order[1] = index;\r\n\t\t\t\tsns._time_format_order.size++;\r\n\t\t\t\t//month\r\n\t\t\t\tfor (i = 0; i < 12; i++)\r\n\t\t\t\t\thtml += \"<option value='\" + i + \"'>\" + gantt.locale.date.month_full[i] + \"</option>\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%d\":\r\n\t\t\t\tsns._time_format_order[0] = index;\r\n\t\t\t\tsns._time_format_order.size++;\r\n\t\t\t\t//days\r\n\t\t\t\tfor (i = 1; i < 32; i++)\r\n\t\t\t\t\thtml += \"<option value='\" + i + \"'>\" + i + \"</option>\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"%H:%i\":\r\n\t\t\t\t//  var last = 24*60, first = 0;\r\n\t\t\t\tsns._time_format_order[3] = index;\r\n\t\t\t\tsns._time_format_order.size++;\r\n\t\t\t\t//hours\r\n\t\t\t\ti = settings.first;\r\n\t\t\t\ttdate = settings.date.getDate();\r\n\t\t\t\tsns._time_values = [];\r\n\r\n\t\t\t\twhile (i < settings.last) {\r\n\t\t\t\t\ttime = gantt.templates.time_picker(settings.date);\r\n\t\t\t\t\thtml += \"<option value='\" + i + \"'>\" + time + \"</option>\";\r\n\t\t\t\t\tsns._time_values.push(i);\r\n\t\t\t\t\tsettings.date.setTime(settings.date.valueOf() + gantt._get_timepicker_step() * 60 * 1000);\r\n\t\t\t\t\tdiff = (settings.date.getDate() != tdate) ? 1 : 0; // moved or not to the next day\r\n\t\t\t\t\ti = diff * 24 * 60 + settings.date.getHours() * 60 + settings.date.getMinutes();\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn html;\r\n\t}\r\n};","export default function(gantt) {\r\n\r\n\tgantt._extend_to_optional = function (lightbox_block) {\r\n\r\n\t\tvar duration = lightbox_block;\r\n\t\tvar optional_time = {\r\n\t\t\trender: duration.render,\r\n\t\t\tfocus: duration.focus,\r\n\t\t\tset_value: function (node, value, task, section) {\r\n\t\t\t\tvar mapping = gantt._resolve_default_mapping(section);\r\n\t\t\t\tif (!task[mapping.start_date] || (mapping.start_date == \"start_date\" && this._isAllowedUnscheduledTask(task))) {\r\n\t\t\t\t\toptional_time.disable(node, section);\r\n\t\t\t\t\tvar val = {};\r\n\r\n\t\t\t\t\tfor (var i in mapping) {\r\n\t\t\t\t\t\t//take default values from the time control from task start/end dates\r\n\t\t\t\t\t\tval[mapping[i]] = task[i];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn duration.set_value.call(gantt, node, value, val, section);//set default value\r\n\t\t\t\t} else {\r\n\t\t\t\t\toptional_time.enable(node, section);\r\n\t\t\t\t\treturn duration.set_value.call(gantt, node, value, task, section);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tget_value: function (node, task, section) {\r\n\t\t\t\tif (section.disabled) {\r\n\t\t\t\t\treturn {start_date: null};\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn duration.get_value.call(gantt, node, task, section);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tupdate_block: function (node, section) {\r\n\t\t\t\tgantt.callEvent(\"onSectionToggle\", [gantt._lightbox_id, section]);\r\n\t\t\t\tnode.style.display = section.disabled ? \"none\" : \"\";\r\n\r\n\t\t\t\tif (section.button) {\r\n\t\t\t\t\tvar button = node.previousSibling.querySelector(\".gantt_custom_button_label\"),\r\n\t\t\t\t\t\tlabels = gantt.locale.labels;\r\n\r\n\t\t\t\t\tvar button_text = section.disabled ? labels[section.name + \"_enable_button\"] : labels[section.name + \"_disable_button\"];\r\n\r\n\t\t\t\t\tbutton.innerHTML = button_text;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdisable: function (node, section) {\r\n\t\t\t\tsection.disabled = true;\r\n\t\t\t\toptional_time.update_block(node, section);\r\n\r\n\t\t\t},\r\n\t\t\tenable: function (node, section) {\r\n\t\t\t\tsection.disabled = false;\r\n\t\t\t\toptional_time.update_block(node, section);\r\n\t\t\t},\r\n\t\t\tbutton_click: function (index, el, section, container) {\r\n\t\t\t\tif (gantt.callEvent(\"onSectionButton\", [gantt._lightbox_id, section]) === false) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar config = gantt._get_typed_lightbox_config()[index];\r\n\t\t\t\tif (config.disabled) {\r\n\t\t\t\t\toptional_time.enable(container, config);\r\n\t\t\t\t} else {\r\n\t\t\t\t\toptional_time.disable(container, config);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\treturn optional_time;\r\n\t};\r\n\r\n\tgantt.form_blocks.duration_optional = gantt._extend_to_optional(gantt.form_blocks.duration);\r\n\tgantt.form_blocks.time_optional = gantt._extend_to_optional(gantt.form_blocks.time);\r\n\r\n};","export default function(gantt){\r\n\tvar htmlTags = new RegExp(\"<(?:.|\\n)*?>\", \"gm\");\r\n\tvar extraSpaces = new RegExp(\" +\", \"gm\");\r\n\r\n\tfunction stripHTMLLite(htmlText){\r\n\t\treturn (htmlText + \"\")\r\n\t\t\t.replace(htmlTags, \" \").\r\n\t\t\treplace(extraSpaces, \" \");\r\n\t}\r\n\r\n\tvar singleQuotes = new RegExp(\"'\", \"gm\");\r\n\tfunction escapeQuotes(text){\r\n\t\treturn (text + \"\").replace(singleQuotes, \"&#39;\");\r\n\t}\r\n\r\n\tgantt._waiAria = {\r\n\t\tgetAttributeString: function(attr){\r\n\t\t\tvar attributes = [\" \"];\r\n\t\t\tfor(var i in attr){\r\n\t\t\t\tvar text = escapeQuotes(stripHTMLLite(attr[i]));\r\n\t\t\t\tattributes.push(i + \"='\" + text + \"'\");\r\n\t\t\t}\r\n\t\t\tattributes.push(\" \");\r\n\t\t\treturn attributes.join(\" \");\r\n\r\n\t\t},\r\n\r\n\t\tgetTimelineCellAttr:function(dateString){\r\n\r\n\t\t\treturn gantt._waiAria.getAttributeString({\"aria-label\": dateString});\r\n\t\t},\r\n\r\n\t\t_taskCommonAttr: function(task, div){\r\n\r\n\t\t\tif(!(task.start_date && task.end_date))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tdiv.setAttribute(\"aria-label\", stripHTMLLite(gantt.templates.tooltip_text(task.start_date, task.end_date, task)));\r\n\r\n\t\t\tif(task.$dataprocessor_class){\r\n\t\t\t\tdiv.setAttribute(\"aria-busy\", true);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\tsetTaskBarAttr: function(task, div){\r\n\t\t\tthis._taskCommonAttr(task, div);\r\n\r\n\t\t\t// task bars are complex elements that should be treated as a single element\r\n\t\t\tdiv.setAttribute(\"role\", \"img\");\r\n\r\n\t\t\tif(!gantt.isReadonly(task) && gantt.config.drag_move){\r\n\t\t\t\tif(task.id != gantt.getState(\"tasksDnd\").drag_id){\r\n\t\t\t\t\tdiv.setAttribute(\"aria-grabbed\", false);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdiv.setAttribute(\"aria-grabbed\", true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\ttaskRowAttr: function(task, div){\r\n\r\n\t\t\tthis._taskCommonAttr(task, div);\r\n\r\n\t\t\tif(!gantt.isReadonly(task) && gantt.config.order_branch){\r\n\t\t\t\tdiv.setAttribute(\"aria-grabbed\", false);\r\n\t\t\t}\r\n\r\n\t\t\tdiv.setAttribute(\"role\", \"row\");\r\n\t\t\t// selected attribute should be added only to the grid  because\r\n\t\t\t// other parts don't have the keyboard navigation\r\n\t\t\tdiv.setAttribute(\"aria-selected\", gantt.isSelectedTask(task.id) ? \"true\" : \"false\");\r\n\r\n\t\t\t// allowed values start from 1, set 1 for non-tree datastores\r\n\t\t\tdiv.setAttribute(\"aria-level\", task.$level + 1 || 1);\r\n\r\n\t\t\tif(gantt.hasChild(task.id)){\r\n\t\t\t\tdiv.setAttribute(\"aria-expanded\", task.$open ? \"true\" : \"false\");\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tlinkAttr: function(link, div){\r\n\r\n\t\t\tvar linkTypes = gantt.config.links;\r\n\r\n\t\t\tvar toStart = link.type == linkTypes.finish_to_start || link.type == linkTypes.start_to_start;\r\n\t\t\tvar fromStart = link.type == linkTypes.start_to_start || link.type == linkTypes.start_to_finish;\r\n\r\n\t\t\tvar content = gantt.locale.labels.link + \" \" +  gantt.templates.drag_link(link.source, fromStart, link.target, toStart);\r\n\r\n\t\t\t// links are complex elements that should be treated as a single element\r\n\t\t\tdiv.setAttribute(\"role\", \"img\");\r\n\r\n\t\t\tdiv.setAttribute(\"aria-label\", stripHTMLLite(content));\r\n\t\t\tif(gantt.isReadonly(link)){\r\n\t\t\t\tdiv.setAttribute(\"aria-readonly\", true);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgridSeparatorAttr: function(div){\r\n\t\t\t// the only valid role for the grid header\r\n\t\t\tdiv.setAttribute(\"role\", \"columnheader\");\r\n\t\t},\r\n\t\trowResizerAttr: function(div){\r\n\t\t\t// the only valid role for the grid header\r\n\t\t\tdiv.setAttribute(\"role\", \"row\");\r\n\t\t},\r\n\r\n\t\tlightboxHiddenAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"aria-hidden\", \"true\");\r\n\t\t},\r\n\r\n\t\tlightboxVisibleAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"aria-hidden\", \"false\");\r\n\t\t},\r\n\r\n\t\tlightboxAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"role\", \"dialog\");\r\n\t\t\tdiv.setAttribute(\"aria-hidden\", \"true\");\r\n\t\t\tdiv.firstChild.setAttribute(\"role\", \"heading\");\r\n\t\t\tdiv.firstChild.setAttribute(\"aria-level\", \"1\");\r\n\t\t},\r\n\r\n\t\tlightboxButtonAttrString:function(buttonName){\r\n\t\t\treturn this.getAttributeString({\"role\":\"button\", \"aria-label\":gantt.locale.labels[buttonName], \"tabindex\":\"0\"});\r\n\t\t},\r\n\r\n\t\tlightboxHeader: function(div, headerText){\r\n\t\t\tdiv.setAttribute(\"aria-label\", headerText);\r\n\t\t},\r\n\r\n\t\tlightboxSelectAttrString: function(time_option){\r\n\t\t\tvar label = \"\";\r\n\r\n\t\t\tswitch (time_option) {\r\n\t\t\t\tcase \"%Y\":\r\n\t\t\t\t\tlabel = gantt.locale.labels.years;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%m\":\r\n\t\t\t\t\tlabel = gantt.locale.labels.months;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%d\":\r\n\t\t\t\t\tlabel = gantt.locale.labels.days;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%H:%i\":\r\n\t\t\t\t\tlabel = gantt.locale.labels.hours + gantt.locale.labels.minutes;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\treturn gantt._waiAria.getAttributeString({\"aria-label\": label});\r\n\t\t},\r\n\r\n\t\tlightboxDurationInputAttrString: function(section){\r\n\t\t\treturn this.getAttributeString({\r\n\t\t\t\t\"aria-label\": gantt.locale.labels.column_duration,\r\n\t\t\t\t\"aria-valuemin\": \"0\",\r\n\t\t\t\t\"role\": \"spinbutton\"\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tinlineEditorAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"role\", \"row\");\r\n\t\t},\r\n\r\n\t\tgridAttrString: function(){\r\n\t\t\treturn [\" role='treegrid'\", gantt.config.multiselect ? \"aria-multiselectable='true'\" : \"aria-multiselectable='false'\", \" \"].join(\" \");\r\n\t\t},\r\n\r\n\r\n\t\tgridScaleRowAttrString: function(){\r\n\t\t\treturn \"role='row'\";\r\n\t\t},\r\n\r\n\t\tgridScaleCellAttrString: function(column, label){\r\n\t\t\tvar attrs = \"\";\r\n\t\t\tif(column.name == \"add\"){\r\n\t\t\t\t// a more precise role is button, but it is not valid for the grid header\r\n\t\t\t\tattrs = this.getAttributeString({\"role\":\"columnheader\", \"aria-label\": gantt.locale.labels.new_task});\r\n\t\t\t}else{\r\n\r\n\t\t\t\tvar attributes = {\r\n\t\t\t\t\t\"role\":\"columnheader\",\r\n\t\t\t\t\t\"aria-label\": label\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(gantt._sort && gantt._sort.name == column.name){\r\n\t\t\t\t\tif(gantt._sort.direction == \"asc\"){\r\n\t\t\t\t\t\tattributes[\"aria-sort\"] = \"ascending\";\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tattributes[\"aria-sort\"] = \"descending\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tattrs = this.getAttributeString(attributes);\r\n\t\t\t}\r\n\t\t\treturn attrs;\r\n\t\t},\r\n\r\n\t\tgridDataAttrString: function(){\r\n\t\t\treturn \"role='rowgroup'\";\r\n\t\t},\r\n\r\n\t\treorderMarkerAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"role\", \"grid\");\r\n\t\t\tdiv.firstChild.removeAttribute(\"aria-level\");\r\n\t\t\tdiv.firstChild.setAttribute(\"aria-grabbed\", \"true\");\r\n\t\t},\r\n\r\n\t\tgridCellAttrString: function(column, textValue, task){\r\n\t\t\tvar attributes = {\"role\":\"gridcell\", \"aria-label\": textValue};\r\n\t\t\tif(!column.editor || gantt.isReadonly(task)){\r\n\t\t\t\tattributes[\"aria-readonly\"] = true;\r\n\t\t\t}\r\n\r\n\t\t\treturn this.getAttributeString(attributes);\r\n\t\t},\r\n\r\n\t\tgridAddButtonAttrString: function(column){\r\n\t\t\treturn this.getAttributeString({\"role\":\"button\", \"aria-label\": gantt.locale.labels.new_task});\r\n\t\t},\r\n\r\n\t\tmessageButtonAttrString: function(buttonLabel){\r\n\t\t\treturn \"tabindex='0' role='button' aria-label='\"+buttonLabel+\"'\";\r\n\t\t},\r\n\r\n\t\tmessageInfoAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"role\", \"alert\");\r\n\t\t\t//div.setAttribute(\"tabindex\", \"-1\");\r\n\t\t},\r\n\r\n\t\tmessageModalAttr: function(div, uid){\r\n\t\t\tdiv.setAttribute(\"role\", \"dialog\");\r\n\t\t\tif(uid){\r\n\t\t\t\tdiv.setAttribute(\"aria-labelledby\", uid);\r\n\t\t\t}\r\n\r\n\t\t//\tdiv.setAttribute(\"tabindex\", \"-1\");\r\n\t\t},\r\n\r\n\t\tquickInfoAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"role\", \"dialog\");\r\n\t\t},\r\n\r\n\t\tquickInfoHeaderAttrString: function(){\r\n\t\t\treturn \" role='heading' aria-level='1' \";\r\n\t\t},\r\n\r\n\t\tquickInfoHeader: function(div, header){\r\n\t\t\tdiv.setAttribute(\"aria-label\", header);\r\n\t\t},\r\n\r\n\t\tquickInfoButtonAttrString: function(label){\r\n\t\t\treturn gantt._waiAria.getAttributeString({\"role\":\"button\", \"aria-label\":label, \"tabindex\":\"0\"});\r\n\t\t},\r\n\r\n\t\ttooltipAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"role\", \"tooltip\");\r\n\t\t},\r\n\r\n\t\ttooltipVisibleAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"aria-hidden\", \"false\");\r\n\t\t},\r\n\r\n\t\ttooltipHiddenAttr: function(div){\r\n\t\t\tdiv.setAttribute(\"aria-hidden\", \"true\");\r\n\t\t}\r\n\t};\r\n\r\n\tfunction isDisabled(){\r\n\t\treturn !gantt.config.wai_aria_attributes;\r\n\t}\r\n\r\n\tfor(var i in gantt._waiAria){\r\n\t\tgantt._waiAria[i] = (function(payload){\r\n\t\t\treturn function(){\r\n\t\t\t\tif(isDisabled()){\r\n\t\t\t\t\treturn \"\";\r\n\t\t\t\t}\r\n\t\t\t\treturn payload.apply(this, arguments);\r\n\t\t\t};\r\n\t\t})(gantt._waiAria[i]);\r\n\t}\r\n\r\n\r\n};","import * as utils from \"../utils/utils\";\r\nimport env from \"../utils/env\";\r\nimport isHeadless from \"../utils/is_headless\";\r\nimport * as domHelpers from \"./ui/utils/dom_helpers\";\r\nimport * as codeHelpers from \"../utils/helpers\";\r\nimport domEventScope from \"./ui/utils/dom_event_scope\";\r\nimport messages from \"./ui/message\";\r\nimport ui from \"./ui/index\";\r\nimport createLayoutFacade from \"./facades/layout\";\r\nimport taskLayers from \"./data_task_layers\";\r\n\r\nimport skin from \"./ui/skin\";\r\nimport skyblue from \"../css/skins/skyblue\";\r\nimport meadow from \"../css/skins/meadow\";\r\nimport terrace from \"../css/skins/terrace\";\r\nimport broadway from \"../css/skins/broadway\";\r\nimport material from \"../css/skins/material\";\r\nimport dark from \"../css/skins/dark\";\r\nimport contrast_black from \"../css/skins/contrast_black\";\r\nimport contrast_white from \"../css/skins/contrast_white\";\r\nimport plugins from \"./ui/plugins\";\r\nimport touch from \"./ui/touch\";\r\nimport lightbox from \"./ui/lightbox\";\r\nimport lightbox_optional_time from \"./ui/lightbox/lightbox_optional_time\";\r\nimport wai_aria from \"./ui/wai_aria\";\r\n\r\n\r\nexport default function(gantt) {\r\n\r\n\tif(!env.isNode){\r\n\r\n\t\tgantt.utils = {\r\n\t\t\tarrayFind: codeHelpers.arrayFind,\r\n\t\t\tdom: domHelpers\r\n\t\t};\r\n\r\n\t\tvar domEvents = domEventScope();\r\n\t\tgantt.event = domEvents.attach;\r\n\t\tgantt.eventRemove = domEvents.detach;\r\n\t\tgantt._eventRemoveAll = domEvents.detachAll;\r\n\t\tgantt._createDomEventScope = domEvents.extend;\r\n\r\n\t\tutils.mixin(gantt, messages(gantt));\r\n\t\tvar uiApi = ui.init(gantt);\r\n\t\tgantt.$ui = uiApi.factory;\r\n\t\tgantt.$ui.layers = uiApi.render;\r\n\t\tgantt.$mouseEvents = uiApi.mouseEvents;\r\n\t\tgantt.$services.setService(\"mouseEvents\", function () {\r\n\t\t\treturn gantt.$mouseEvents;\r\n\t\t});\r\n\t\tgantt.mixin(gantt, uiApi.layersApi);\r\n\r\n\t\ttaskLayers(gantt);\r\n\r\n\t\tgantt.$services.setService(\"layers\", function () {\r\n\t\t\treturn uiApi.layersService;\r\n\t\t});\r\n\r\n\t\tgantt.mixin(gantt, createLayoutFacade());\r\n\t\tskin(gantt);\r\n\t\tskyblue(gantt);\r\n\t\tdark(gantt);\r\n\t\tmeadow(gantt);\r\n\t\tterrace(gantt);\r\n\t\tbroadway(gantt);\r\n\t\tmaterial(gantt);\r\n\t\tcontrast_black(gantt);\r\n\t\tcontrast_white(gantt);\r\n\t\tplugins(gantt);\r\n\t\ttouch(gantt);\r\n\t\tlightbox(gantt);\r\n\t\tlightbox_optional_time(gantt);\r\n\t\twai_aria(gantt);\r\n\r\n\t\tgantt.locate = function(e) {\r\n\t\t\tvar trg = domHelpers.getTargetNode(e);\r\n\r\n\t\t\t// ignore empty rows/cells of the timeline\r\n\t\t\tif(domHelpers.closest(trg, \".gantt_task_row\")){\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tvar targetAttribute = arguments[1] || this.config.task_attribute;\r\n\r\n\t\t\tvar node = domHelpers.locateAttribute(trg, targetAttribute);\r\n\t\t\tif(node){\r\n\t\t\t\treturn node.getAttribute(targetAttribute);\r\n\t\t\t}else{\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tgantt._locate_css = function(e, classname, strict){\r\n\t\t\treturn domHelpers.locateClassName(e, classname, strict);\r\n\t\t};\r\n\r\n\t\tgantt._locateHTML = function(e, attribute) {\r\n\t\t\treturn domHelpers.locateAttribute(e, attribute || this.config.task_attribute);\r\n\t\t};\r\n\t}\r\n\r\n\tgantt.attachEvent(\"onParse\", function(){\r\n\t\tif(!isHeadless(gantt)){\r\n\t\t\tgantt.attachEvent(\"onGanttRender\", function(){\r\n\t\t\t\tif(gantt.config.initial_scroll){\r\n\t\t\t\t\tvar firstTask = gantt.getTaskByIndex(0);\r\n\t\t\t\t\tvar id = firstTask ? firstTask.id : gantt.config.root_id;\r\n\t\t\t\t\t// GS-1450. Don't scroll to the task if there is no timeline\r\n\t\t\t\t\tif(gantt.isTaskExists(id) && gantt.$task && gantt.utils.dom.isChildOf(gantt.$task, gantt.$container)){\r\n\t\t\t\t\t\tgantt.showTask(id);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, {once: true});\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tgantt.attachEvent(\"onBeforeGanttReady\", function(){\r\n\t\tif (!this.config.scroll_size)\r\n\t\t\tthis.config.scroll_size = domHelpers.getScrollSize() || 15;\r\n\r\n\t\tif(!isHeadless(gantt)){\r\n\t\t\t// detach listeners before clearing old DOM, possible IE errors when accessing detached nodes\r\n\t\t\tthis._eventRemoveAll();\r\n\t\t\tthis.$mouseEvents.reset();\r\n\r\n\t\t\tthis.resetLightbox();\r\n\t\t}\r\n\r\n\t});\r\n\r\n\t// GS-1261: scroll the views to the right side when RTL is enabled\r\n\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\t\tif(!isHeadless(gantt) && gantt.config.rtl){\r\n\t\t\tgantt.$layout.getCellsByType(\"viewCell\").forEach(function(cell){ \r\n\t\t\t\tvar attachedScrollbar = cell.$config.scrollX;\r\n\t\t\t\tif (!attachedScrollbar) return;\r\n\r\n\t\t\t\tvar scrollbar = gantt.$ui.getView(attachedScrollbar);\r\n\t\t\t\tif (scrollbar) scrollbar.scrollTo(scrollbar.$config.scrollSize,0);\r\n\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\t// GS-1649: check if extensions are connected via files\r\n\tgantt.attachEvent(\"onGanttReady\", function(){\r\n\t\tif(!isHeadless(gantt)){\r\n\r\n\t\t\tvar activePlugins = gantt.plugins();\r\n\r\n\t\t\tvar availablePlugins = {\r\n\t\t\t\tauto_scheduling: gantt.autoSchedule,\r\n\t\t\t\tclick_drag: gantt.ext.clickDrag,\r\n\t\t\t\tcritical_path: gantt.isCriticalTask,\r\n\t\t\t\tdrag_timeline: gantt.ext.dragTimeline,\r\n\t\t\t\texport_api: gantt.exportToPDF,\r\n\t\t\t\tfullscreen: gantt.ext.fullscreen,\r\n\t\t\t\tgrouping: gantt.groupBy,\r\n\t\t\t\tkeyboard_navigation: gantt.ext.keyboardNavigation,\r\n\t\t\t\tmarker: gantt.addMarker,\r\n\t\t\t\tmultiselect: gantt.eachSelectedTask,\r\n\t\t\t\toverlay: gantt.ext.overlay,\r\n\t\t\t\tquick_info: gantt.templates.quick_info_content,\r\n\t\t\t\ttooltip: gantt.ext.tooltips,\r\n\t\t\t\tundo: gantt.undo\r\n\t\t\t};\r\n\r\n\t\t\tfor (let plugin in availablePlugins){\r\n\t\t\t\tif (availablePlugins[plugin] && !activePlugins[plugin]){\r\n\t\t\t\t\t// eslint-disable-next-line no-console\r\n\t\t\t\t\tconsole.warn(`You connected the '${plugin}' extension via an obsolete file. \r\nTo fix it, you need to remove the obsolete file and connect the extension via the plugins method: https://docs.dhtmlx.com/gantt/api__gantt_plugins.html`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n};","export default function(gantt) {\r\n\tgantt.load = function (url, type, callback) {\r\n\t\tthis._load_url = url;\r\n\t\tthis.assert(arguments.length, \"Invalid load arguments\");\r\n\r\n\t\tvar tp = 'json', cl = null;\r\n\t\tif (arguments.length >= 3) {\r\n\t\t\ttp = type;\r\n\t\t\tcl = callback;\r\n\t\t} else {\r\n\t\t\tif (typeof arguments[1] == \"string\")\r\n\t\t\t\ttp = arguments[1];\r\n\t\t\telse if (typeof arguments[1] == \"function\")\r\n\t\t\t\tcl = arguments[1];\r\n\t\t}\r\n\r\n\t\tthis._load_type = tp;\r\n\r\n\t\tthis.callEvent(\"onLoadStart\", [url, tp]);\r\n\r\n\t\treturn this.ajax.get(url, gantt.bind(function (l) {\r\n\t\t\tthis.on_load(l, tp);\r\n\t\t\tthis.callEvent(\"onLoadEnd\", [url, tp]);\r\n\t\t\tif (typeof cl == \"function\")\r\n\t\t\t\tcl.call(this);\r\n\t\t}, this));\r\n\t};\r\n};","import \"../css/dhtmlxgantt.less\";\r\n\r\nimport factory from \"./make_instance_common\";\r\nimport ui from \"../core/ui_core\";\r\nimport ajaxLoading from \"../core/loading/ajax_loading\";\r\nimport dynamicLoading from \"../core/loading/dynamic_loading\";\r\n\r\nexport default function(supportedExtensions) {\r\n\tvar gantt = factory(supportedExtensions);\r\n\r\n\tif(!gantt.env.isNode){\r\n\t\tui(gantt);\r\n\t\tajaxLoading(gantt);\r\n\t\tdynamicLoading(gantt);\r\n\t}\r\n\r\n\treturn gantt;\r\n};","import extensions from \"./ext/extensions_gpl\";\r\nimport base from \"./factory/make_instance_web\";\r\nimport scope from \"./utils/global\";\r\nconst gantt = (scope as any).gantt = base(extensions);\r\n\r\nexport default gantt;\r\nexport { gantt };"],"names":["getNodePosition","elem","top","left","right","bottom","getBoundingClientRect","box","body","document","docElem","documentElement","parentNode","scrollTop","window","pageYOffset","scrollLeft","pageXOffset","clientTop","clientLeft","offsetWidth","offsetHeight","parseInt","offsetTop","offsetLeft","offsetParent","y","Math","round","x","width","height","isVisible","node","display","visibility","getComputedStyle","style","currentStyle","hasNonNegativeTabIndex","isNaN","getAttribute","hasHref","canHaveHref","a","area","nodeName","loLowerCase","isEnabled","canDisable","input","select","textarea","button","object","toLowerCase","hasAttribute","getFocusableNodes","root","nodes","querySelectorAll","join","nodesArray","Array","prototype","slice","call","i","length","$position","sort","b","tabIndex","isValid","splice","getScrollSize","div","createElement","cssText","appendChild","clientWidth","removeChild","max","getClassName","className","baseVal","indexOf","_trimString","addClassName","removeClassName","name","split","regEx","RegExp","replace","hasClass","element","classList","contains","test","toNode","getElementById","querySelector","_slave","insertNode","newone","innerHTML","child","firstChild","removeNode","getChildNodes","css","ch","childNodes","len","out","obj","push","getTargetNode","e","trg","tagName","event","target","srcElement","shadowRoot","composedPath","locateAttribute","attribute","str","func","String","trim","this","apply","locateClassName","classname","strict","undefined","ind","charAt","getRelativeEventPosition","ev","d","clientX","clientY","getRelativeNodePosition","parent","childPos","parentPos","isChildOf","closest","selector","matches","msMatchesSelector","webkitMatchesSelector","el","method","parentElement","nodeType","console","error","getClosestSizedElement","isShadowDomSupported","head","createShadowRoot","attachShadow","getActiveElement","activeElement","getSelection","focusNode","getRootNode","ShadowRoot","host","hasShadowParent","globalScope","global","scope","EventsManager$1","EventsManager","gantt","_mouseDown","_gantt","_domEvents","_createDomEventScope","selectedRegion","useKey","ignore","_target","getViewPort","_originPosition","_restoreOriginPosition","position","state","$services","getService","registerProvider","result","autoscroll","scheduledDndCoordinates","startDragAndDrop","setStart","copy","setPosition","setEnd","attach","filterTargets","utils","dom","_getCoordinates","eventElement","domHelpers.getRootNode","$root","coordinates","dragEnd","dragTimeline","ext","clickDrag","dragTimelineUseKey","config","drag_timeline","abs","relative","render","detach","detachAll","unregisterProvider","viewPort","viewPortBounds","absolute","EventHost","_silent_mode","listeners","_silentStart","_silentEnd","createEventStorage","handlers","index","eventStorage","combinedResult","handlerResult","arguments","addEvent","handler","settings","handlerId","id","once","originalHandler","removeEvent","clear","makeEventable","eventHost","attachEvent","eventName","thisObject","bind","innerId","attachAll","callback","callEvent","eventArguments","handlerName","concat","checkEvent","detachEvent","list","eventId","detachAllEvents","units","second","minute","hour","day","week","month","quarter","year","getSecondsInUnit","unit","forEach","arr","workArray","arrayMap","map","resArray","arrayFind","find","arrayIncludes","item","includes","isArray","pop","isDate","getFullYear","getMonth","getDate","isValidDate","getTime","delay","timeout","timer","$cancelTimeout","$pending","args","setTimeout","clearTimeout","$execute","isEventable","replaceValidZeroId","rootId","checkZeroId","findBinary","array","low","high","prev","floor","SelectedRegion","view","_el","defaultRender","start","end","min","_singleRow","pos","_getTaskPositionByTop","_startPoint","_view","_viewPort","add","_callback","_endPoint","draw","eventable","singleRow","_useRequestAnimationFrame","useRequestAnimationFrame","requestAnimationFrame","getElement","startPoint","_startDate","dateFromPos","endPoint","_endDate","_positionPoint","positionPoint","getState","max_date","valueOf","tasksByTime","getTaskByTime","tasksByIndex","_getTasksByTop","getInBounds","startValue","endValue","startIndex","endIndex","task","getTaskByIndex","getItemIndexByTopPosition","getItemHeight","itemTop","getItemTop","dataHeight","getTotalHeight","row_height","getTaskCount","click_drag","defaultConfig","setClickDrag","$task_data","destructor","timeline","$ui","getView","$container","_dragInProgress","_calculateDirectionVector","traceSteps","_trace","dots","vectors","resultVector","vector","magnitude","sqrt","angleDegrees","atan2","PI","_applyDndReadyStyles","_timeline","$task","_clearDndReadyStyles","remove","_getScrollPosition","$config","scrollX","getScrollState","scrollY","_countNewScrollPosition","coords","shiftX","shiftY","_scrollState","_setScrollPosition","scrollLayoutCell","$id","_stopDrag","_originalReadonly","readonly","_originAutoscroll","_startDrag","create","enabled","clickDragUseKey","scrollPosition","_isDragInProgress","export_api","_apiUrl","type","previousDateRage","start_date","end_date","date","str_to_date","date_format","mixin","data","_serializeHtml","_serializeAll","_fixColumns","columns","raw","_preparePDFConfigRaw","_prepareConfigPDF","version","_sendToExport","_pdfExportRouter","_serializePlain","tasks","dates","scroll","smartRendering","smart_rendering","visual","convert","eachTask","_eachTaskTimed","_no_progress_colors","title","_serializeTimeline","_serializeGrid","rawDates","scales","_serializeScales","min_date","scrollTo","worktime","_getWorktimeSettings","formData","File","FormData","append","_sendImportAjaxExcel","_sendImportAjaxMSP","importFromMSProject","skip_circular_links","oldXmlFormat","templates","xml_format","oldFormatDate","format_date","oldXmlDate","xml_date","oldDateFormat","exportServiceDateFormat","date_to_str","_customProjectProperties","_customTaskProperties","_clearRecLinks","_exportConfig","$custom_data","custom","exportToMSProject","label","locale","labels","url","pack","cb","ajax","post","base","template","$template","server","store","JSON","stringify","sheet","xhr","XMLHttpRequest","onreadystatechange","readyState","status","onload","fail","info","parse","responseText","open","setRequestHeader","send","encodeURIComponent","loader","xdoc","xmlDoc","_xdr","col","editor","editor_types","skin","_serializableGanttConfig","_markColumns","Date","_ajaxToExport","form","_createHiddenForm","action","value","submit","_hidden_export_form","t","constraint_date","deadline","key","formatDate","_color_box","_color_hash","color","_getColor","backgroundColor","parsedRanges","minutes","range","startMinute","endMinute","defaultWorkTimes","hours","time","work_time","wTime","_working_time_helper","get_calendar","worktimes","parsed","_getMinutesWorktimeSettings","code","master","root_id","branch","getChildren","_pull","hasChild","_originalCopyObject","json","_copyObject","text","task_text","_copyObjectBase","rgb","match","toString","toISOstring","_copyObjectColumns","_copyObjectPlain","getDayIndex","_day_index_by_date","columnIndexByDate","$start","$end","hiddenCells","scaleCellsWidth","getScale","$level","$type","$rendered_type","tmps","$text","$left","leftside_text","$right","rightside_text","_copyObjectTable","getTaskNode","$color","ct","val","date_grid","$open","smartScales","smart_scales","html","_copyObjectAll","_exportSerialize","links","_getRaw","_scale_helpers","_get_scales","minWidth","min_column_width","autosizeMinWidth","_get_resize_options","autosize_min_width","scale_height","prepareConfigs","availWidth","autosize","_getScales","rtl","$scaleHelper","_copyObjectColors","cellColors","timeline_cell_class","task_cell_class","steps","trace_x","styles","getTask","j","cellCss","_getStyles","Infinity","col_width","row","step","format","date_scale","scaleCell","scaleCell_class","scaleCss","exportMode","cols","ccount","header","tree","xmlFormat","serialize","_lvl","_setLevel","link","isTaskExists","source","_makeLinksSameLevel","skippedLinks","_clearCircDependencies","Object","keys","_clearLinksSameLevel","_clearLevel","usedTasks","prevLink","sources","$_source","_onCircDependencyFind","targets","curLink","targetTask","_source","targetLvl","linkT","sourceParent","targetParent","$_target","project","projectName","projectDates","getSubtaskDates","start_end","manual","auto_scheduling","res","durationUnit","projectProperties","taskProperties","exportToPDF","exportToPNG","exportToICal","exportToExcel","exportToJSON","importFromExcel","importFromPrimaveraP6","exportToPrimaveraP6","fullscreen","isExpanded","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","isFullscreenAvailable","fullscreenEnabled","webkitFullscreenEnabled","mozFullScreenEnabled","msFullscreenEnabled","backupBodyPadding","overflow","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","backupElementSizes","zIndex","modified","backupPositioning","resetParentPositioning","positions","originalPositioning","restoreParentPositioning","record","setFullScreenSizes","getFullscreenElement","updateSizes","restoreSizes","addDOMEvents","onFullScreenChange","expandGantt","isBodyExpanded","cantFullscreen","warning","log","requestArguments","webkitRequestFullscreen","Element","ALLOW_KEYBOARD_INPUT","requestFullscreen","msRequestFullscreen","mozRequestFullScreen","collapse","requestExitFullscreen","msExitFullscreen","mozCancelFullScreen","webkitExitFullscreen","exitFullscreen","toggle","expand","keyboard_shortcuts","$keyboardNavigation","shortcuts","createCommand","modifiers","shift","alt","ctrl","meta","keyCode","shortcut","commands","expr","getExpressions","words","getWords","command","commandKeys","specialKeys","charCodeAt","getCommandFromEvent","domEvent","shiftKey","altKey","ctrlKey","metaKey","which","printableKey","fromCharCode","getHashFromEvent","getHash","parts","junctionChar","term","combinationChar","backspace","tab","enter","esc","space","up","down","home","pageup","pagedown","delete","insert","plus","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","eventhandler","EventHandler","_handlers","findHandler","hash","doAction","eventFacade","facade","preventDefault","returnValue","unbind","bindAll","initKeys","trap_modal_focus","domHelpers.getFocusableNodes","trapFocus","focusable","currentFocus","domHelpers.getActiveElement","currentIndex","lastItem","focus","firstItem","gantt_node","GanttNode","_compose","blur","scrollHorizontal","dir","scale","posFromDate","scrollVertical","undo","redo","nav_node","KeyNavNode","fallback","moveTo","dispatcher","setActiveNode","compareTo","canStringifyThis","canStringifyThat","getNode","setAttribute","$eventAttached","header_cell","HeaderCell","show_grid","getVisibleTaskCount","getGridColumns","TaskRow","visibleColumns","fromDomElement","cellElement","domHelpers.locateClassName","previousSibling","$grid_scale","cells","taskRow","rootLevel","keyboard_navigation_cells","TaskCell","click","isReadonly","createTask","taskId","task_row","getTaskIndex","globalIndex","getGlobalTaskIndex","splitItem","$split_subtask","parentId","getParent","nextIndex","locate","isTaskVisible","$grid","task_attribute","replaceAll","keptFocus","getTaskPosition","getTaskHeight","viewWidth","inner_width","viewHeight","$grid_data","inner_height","visibleTimeline","show_chart","scroll_on_click","task_scroll_offset","scrollGrid","grid","scrollPositionX","scrollPositionY","attachedScrollbarHorizontal","scrollable","scrollbarHorizontal","attachedScrollbarVertical","scrollbarVertical","nextElement","prevTask","getPrev","nextTask","getNext","close","prevId","getPrevSibling","moveTask","updateTask","isSelectedTask","selectTask","unselectTask","$click","buttons","showLightbox","task_cell","columnIndex","domHelpers.locateAttribute","show_tasks_outside_timescale","modals","modalsStack","isModal","afterPopup","$destroyed","startModal","eventRemove","endModal","isTopModal","currentTarget","traceLightbox","getLightbox","saveFocus","restoreFocus","focusElement","core","isActive","activeNode","globalNode","enable","getActiveNode","disable","getDefaultNode","setDefaultNode","inputs","focusGlobalNode","blurNode","focusChanged","keyDownHandler","defaultPrevented","ganttNode","_timeout","awaitsFocus","clearDelay","keyboard_navigation","setupKeyNav","p","isTaskFocused","isInlineEditorCell","isNoKeyboardNavigationElement","isLightboxElement","focusHandler","$preventDefault","reFocusActiveNode","outsideGantt","domHelpers.isChildOf","localName","domElement","mousedownHandler","removeAttribute","getTaskNodeConstructor","domHelpers.closest","locateTask","visibleGrid","taskBar","gridLeft","gridRight","nodePosition","nodeHidden","rightPosition","positionX","column","hide","onReady","$data","tasksStore","currentNode","gridDataTopScroll","gridDataBottomScroll","_smart_render","updateRender","_redrawTasks","renderers","items","focusedItemVisible","createdTaskId","keepFocusOnNewTask","types","placeholder","nodeConstructor","placeholder_task","focusOnCreate","oldId","newId","interval","setInterval","clearInterval","getScopeName","getScope","mode","scopes","headerCell","taskCell","findVisibleColumnIndex","columnName","keyNavFacade","addShortcut","scopeObject","getShortcutHandler","getCommandHandler","removeShortcut","constructor","keyboardNavigation","marker","_markers","createDatastore","initItem","uid","show_markers","render_marker","marker_class","markerHeight","getRowTop","timeline_placeholder","scrollHeight","initMarkerArea","$marker_area","markerArea","renderMarkers","layers","markerRenderer","createDataRender","defaultContainer","addLayer","getMarker","getItem","addMarker","addItem","deleteMarker","exists","removeItem","updateMarker","refresh","_getMarkers","getItems","multiselect","multiselect_one_level","_multiselect","_selected","_one_level","_active","_first_selected_when_shift","getDefaultSelected","selected","getSelected","setFirstSelected","getFirstSelected","updateState","active","select_task","reset","setLastSelected","silent","unselect","getLastSelected","last","getSelectedId","afterSelect","isSelected","forSelected","isSameLevel","calculateTaskLevel","_quickRefresh","refreshTask","doSelection","_is_icon_open_click","target_ev","defaultLast","isLast","multiSelect","singleSelection","controller","inlineEditors","cell","locateCell","inline_editors_multiselect_open","getEditorConfig","startEdit","blockSelection","first_indx","target_indx","last_indx","tmp","old_selectTask","old_unselectTask","toggleTaskSelection","getSelectedTasks","eachSelectedTask","getLastSelectedTask","old_isSelected","new_id","task_id","oldSelectedId","oldSelectedTask","newSelectedTask","differentTreeLevel","QuickInfo","show","_showForTask","_showAtCoordinates","forced","qi","_quickInfoBox","_quickInfoBoxId","_quickInfoTask","quick_info_detached","setContainer","container","_container","setContent","content","defaultContent","quickinfo_buttons","_createQuickInfoElement","titleBox","titleContent","titleDate","main","controls","_waiAria","quickInfoHeader","ariaAttr","quickInfoButtonAttrString","_qiButtonClickHandler","_qiKeyPressHandler","_qi_button_click","_appendAtCoordinates","show_quick_info","offset","_getContainer","_get_event_counter_part","xViewport","yViewport","_init_quick_info","_prepare_quick_info_classname","_fill_quick_data","_show_quick_info","domEv","getTaskRowNode","dx","dy","quickInfoAttr","quickInfoHeaderAttrString","_quickInfoReadonly","taskType","getTaskType","quick_info_class","allowedButtons","isEditor","icon_delete","icon_edit","quick_info_title","quick_info_date","quick_info_content","popupHeight","scrolls","screenWidth","relativePopupTop","relativePopupBottom","mask","$layout","quick_info","quickInfo","substr","details","task_time","events","hidingFunction","hideQuickInfo","quickInfoClick","clearQuickInfo","showQuickInfo","plainObjectConstructor","isCustomType","constructorString","helpers.isDate","helpers.isArray","hasOwnProperty","force","f","defined","seed","functor","capture","addEventListener","removeEventListener","createScope","utils.event","utils.eventRemove","eventScope","staticArray","extend","Tooltip","_tooltipNode","tooltipAttr","_root","_isLikeMouseEvent","_calculateTooltipPosition","tooltipVisibleAttr","tooltipHiddenAttr","viewport","_getViewPortSize","tooltipNode","tooltip","offsetX","tooltip_offset_x","offsetY","tooltip_offset_y","mouse","domHelpers.getRelativeEventPosition","containerPos","domHelpers.getNodePosition","_getViewPort","TooltipManager","_listeners","domEventsScope","_initDelayedFunctions","hideTooltip","delayHide","watchableTarget","eventTarget","domHelpers.getTargetNode","targetNode","doOnMouseEnter","onmouseenter","onmousemove","onmouseleave","listener","cloneDomEvent","clone","createEvent","delayShow","helpers.delay","tooltip_timeout","tooltip_hide_timeout","tooltipManager","tooltips","tooltipFor","touch","touch_tooltip","targetTaskId","tooltip_text","isLinkCreate","link_source_id","noTrack","onBeforeUndo","onBeforeRedo","batchActions","Monitor","_batchAction","_batchMode","_ignore","_ignoreMoveEvents","_initialTasks","_initialLinks","_nestedTasks","_nestedLinks","_undo","_attachEvents","overwrite","undo_types","_storeTask","_storeLink","newValue","startBatchAction","stopBatchAction","logAction","_storeTaskCommand","update","$local_index","_storeEntityCommand","getInitialTask","move","entity","children","childrenLinks","_storeLinkCommand","taskIds","linkIds","_getLinks","setInitialTask","uniqueLinks","setInitialLink","$index","setInitialTaskObject","clearInitialTasks","getLink","clearInitialLinks","deleteCacheCooldown","saveInitialAll","getLinks","getMoveObjectByTaskId","startIgnore","stopIgnore","clearUndoStack","clearRedoStack","onTaskAdded","onTaskUpdated","onTaskDeleted","onLinkAdded","onLinkUpdated","onLinkDeleted","onTaskMoved","toggleIgnoreMoveEvents","nested","setNestedTasks","datastore","getDatastore","tindex","isMoveEventsIgnored","dragId","projectDrag","drag_id","isSummaryTask","drag_project","plugins","selectedIds","multipleDrag","onBeforeEditStartId","onEditStart","updateConfigs","undoEnabled","old","actionType","entityType","_storeCommand","getInitialLink","$source","$target","linkId","MAX_UNDO_STEPS","Undo","maxSteps","redoEnabled","invert","revert","oldValue","inverseCommands","assert","_undoStack","_redoStack","stack","undo_steps","undo_actions","_pop","_reorderCommands","_applyAction","_push","weights","any","actionWeights","weightA","weightB","entities","actions","methods","get","isExists","batchUpdate","getMethod","check","prop","internalProperty","startsWith","whitelist","copyProperty","monitor","getUndoStack","setUndoStack","getRedoStack","setRedoStack","saveState","getInitialState","isEqualIds","first","updTask","changeTaskCommandId","updLink","oldTaskId","newTaskId","changeLinkCommandId","updateTasksIds","entry","updateLinksIds","extensions","constants","KEY_CODES","UP","DOWN","LEFT","RIGHT","SPACE","ENTER","DELETE","ESC","TAB","ExtensionsManager","addExtension","_extensions","getExtension","services","register","getter","dropService","servicesEnum","setService","service","layout","rows","resizer","finish_to_start","start_to_start","finish_to_finish","start_to_finish","milestone","auto_types","duration_unit","correct_work_time","skip_off_time","cascade_delete","autoscroll_speed","deepcopy_on_parse","show_links","show_task_cells","static_background","static_background_cells","branch_loading","branch_loading_property","show_loading","min_duration","start_on_monday","server_utc","show_progress","fit_tasks","preserve_scroll","container_resize_timeout","deadlines","drag_links","drag_progress","drag_resize","drag_move","drag_mode","resize","progress","round_dnd_dates","link_wrapper_width","link_arrow_size","autofit","align","scale_offset_minimal","inherit_scale_class","time_step","duration_step","task_date","time_picker","link_attribute","layer_attribute","buttons_left","_migrate_buttons","dhx_save_btn","dhx_cancel_btn","dhx_delete_btn","buttons_right","lightbox","sections","map_to","project_sections","milestone_sections","single_date","drag_lightbox","details_on_create","details_on_dblclick","initial_scroll","order_branch","order_branch_free","task_height","bar_height","bar_height_padding","min_grid_column_width","grid_resizer_column_attribute","keep_grid_width","grid_resize","grid_elastic_columns","show_unscheduled","resize_rows","task_grid_row_resizer_attribute","min_task_grid_row_height","readonly_property","editable_property","calendar_property","resource_calendars","dynamic_resource_calendars","inherit_calendar","type_renderers","open_tree_initially","optimize_render","prevent_default_scroll","show_errors","wai_aria_attributes","horizontal_scroll_key","drag_multiple","csp","isWindowAwailable","env","isIE","navigator","userAgent","isIE6","isIE7","isIE8","isOpera","isChrome","isKHTML","isFF","isIPad","search","isEdge","isNode","serialized","createConfig","Error","async","headers","cache","DOMParser","parseFromString","ActiveXObject","loadXML","xmltop","tagname","xml","responseXML","getElementsByTagName","xpath","xpathExp","docObj","selectNodes","ownerDocument","evaluate","XPathResult","ANY_TYPE","iterateNext","query","_call","onLoad","getSync","put","postData","del","postSync","Promise","resolve","reject","isQt","filePath","noCache","toUpperCase","urlSeparator","dateToStr","utc","dateToStrFn","Function","to_fixed","getISOWeek","getWeek","strToDate","splt","strToDateFn","dateString","fastVersion","getUTCDate","getUTCMonth","getUTCFullYear","day_short","getUTCDay","getDay","day_full","month_short","month_full","getUTCHours","getHours","getUTCMinutes","getMinutes","getUTCSeconds","getSeconds","getUTCISOWeek","set","temp","month_short_hash","month_full_hash","UTC","cspVersion","canUseCsp","cspAutoCheck","useCsp","dateHelper","init","s","date_part","setHours","hour_start","setTime","time_part","getTimezoneOffset","week_start","month_start","setDate","quarter_start","m","res_month","setMonth","year_start","day_start","setMinutes","minute_start","setSeconds","getMilliseconds","setMilliseconds","_add_days","modifiedDate","inc","originalDate","incCondition","getHoursCondition","getDateCondition","worktimeCalculation","ndate","setYear","add_quarter","num","cspCompliantVersion","_getWeekNumber","isoWeek","nday","first_thursday","year_number","ordinal_date","week_number","convert_to_utc","parseDate","parse_date","token","_url","_token","_mode","_seed","_queue","api","_events","Accept","credentials","fetch","then","websocket","_wrapper","connect","_socket","onclose","n","location","protocol","o","r","WebSocket","onmessage","fire","onError","_send","_resubscribe","_uid","onCall","filter","catch","onResponse","remoteEvents","remote","remote_client.Client","req","_ready","load","back","_remote","ready","on","checkTimeout","updPerSecond","_on_timeout","ceil","DnD","copyDomEvent","pageX","pageY","_obj","_settings","inputMethods","getInputMethods","_drag_start_timer","utils.bind","clearDragTimer","lastDown","eventParams","passive","accessor","timeStamp","original_target","original_element_sizes","domHelpers.getClosestSizedElement","dragStart","touch_drag","traceDragEvents","inputMethod","mousemove","dragMove","dragScroll","limited_mousemove","started","utils.defined","updates_per_second","dndActive","cancelable","mousemoveContainer","mouseup","checkPositionChange","diff_x","diff_y","distance","pow","sensitivity","initDnDMarker","backupEventTarget","getEvent","cloneNode","backup_element","touchEventsSupported","touches","elementFromPoint","pointerEnabled","pointerType","msPointerEnabled","MSPOINTER_TYPE_MOUSE","getPosition","utils.mixin","_prevent_touch_scroll","_touch_drag","_touch_feedback","targetTouches","regTemplates","initTemplate","initial","template_name","initTemplates","c","progress_text","grid_header_class","task_class","task_end_date","grid_row_class","task_row_class","timeline_cell_content","scale_cell_class","scale_row_class","grid_indent","grid_folder","grid_file","grid_open","grid_blank","isUnscheduledTask","task_unscheduled_time","grid_date_format","link_class","link_description","from","to","drag_link","from_start","to_start","link_start","link_end","drag_link_class","allowed","isLinkAllowed","tooltip_date_format","baseline_text","baseline","StateService","stateProviders","provider","internal","Promise$1","createTasksDatastoreFacade","updateItem","addTask","utils.uid","setParent","parentObj","deleteTask","count","countVisible","getBranchIndex","getIndexById","eachItem","eachParent","startTask","changeTaskId","oldid","newid","changeId","calculateItemLevel","new_pid","getSiblings","getNextSibling","getIdByIndex","sid","field","desc","createLinksStoreFacade","getLinkCount","linksStore","isLinkExists","addLink","newLink","isSilent","fullOrder","updateLink","deleteLink","changeLinkId","$powerArray","$create","$removeAt","$remove","$find","$insertAt","$each","$map","$filter","isPlaceholderTask","DataStore","pull","$initItem","visibleOrder","powerArray","_skip_refresh","_filterRule","_searchVisibleOrder","_indexRangeCache","_getItemsCache","_attachDataChange","_parseInner","loaded","copyOnParse","utils.copy","_updateOrder","_removeItemInner","_addItemInner","order","data_size","getVisibleItems","getIndexRange","_changeIdInner","_moveInner","sindex","clearAll","alreadySilent","arraysEqual","arr1","arr2","quick","skipFilter","_quick_refresh","_mark_recompute","oldOrder","rule","filteredOrder","placeholderIds","_ganttConfig","cacheKey","ret","_getNullIfUndefined","getFirst","getLast","TreeDataStore","_branches","loadedItem","existingItem","$parentProperty","parentProperty","$getRootId","$openInitially","openInitially","_eachItemMainRangeCache","getConfig","splitParents","splitItems","taskOpenState","taskVisibility","haveSplitItems","_isSplitItem","canOpenSplitTasks","open_split_tasks","$expanded_branch","_buildTree","_add_branch","parentIndex","targetIndex","_move_branch","$rendered_parent","_replace_branch_child","_traverseBranches","itemId","source_pid","tbranch","tid","diff","childId","pid","siblings","nextSibling","level","_setParentInner","_eachItemCached","_eachItemIterate","startId","itemsStack","reverse","useCache","buildCache","startItem","parentsHash","added_already","old_parent","new_parent","old_id","newbranch","criteria","original_criteria","els","renderedParent","actualParent","_skipTaskRecalculation","createDataStoreSelectMixin","selectedId","deleteItem","subItem","isHeadless","storeRenderCreator","itemRepainter","renderItem","renderer","renders","getLayers","render_item","renderItems","allData","loadedRanges","layer","layerData","get_visible_range","ids","prepare_data","render_items","updateItems","update_items","extraDataArr","getDataRender","onUpdateRequest","skipRepaint","batch_update","refreshId","change_id","datastoreRender","bindDataStore","getDatastores","storeNames","createDatastoreFacade","$StoreType","self","createDatastoreSelect","servicePrefix","storeAccessName","storeList","_getDatastores","refreshData","scrollState","stores","refresh_links","refreshLinks","refreshLink","_bulk_dnd","hasSplitParent","isSplitTask","_update_flags","userdata","_clear_data","oldSelectId","_skipResourceRepaint","createFacade","createTasksFacade","createLinksFacade","facadeFactory","ScaleHelper","getSum","sizes","summ","setSumWidth","sum_width","oldWidth","adjustSize","full_width","splitSize","full","share","sortScales","cellSize","_isLegacyMode","scaleConfig","scale_unit","subscales","_prepareScaleObject","primaryScale","legacyMode","getSubScales","docLink","warn","min_coll_width","container_width","minDate","maxDate","heights","configs","main_scale","cfg","initScaleConfig","processIgnores","initColSizes","limitVisibleRange","unshift","alineScaleColumns","reverseScale","setPosSettings","indexes","trace_indexes","trace_index_transition","_ignore_time_config","skip","probe","isWorkTime","ignore_x","display_count","min_col_width","line_height","cont_width","column_count","ignores","days","eachColumn","trace_x_ascending","iterateScales","lower_scale","upper_scale","upper_dates","lower_dates","prevUpper","target_index","upper_start","upper_end","lower_start","lower_end","targetWidth","actualWidth","curr","tzOffset","_correct_dst_change","lastDate","outDate","shared","resolveConfigRange","start_interval","_scale_range_unit","PrimaryScaleHelper","helper","_init_tasks_range","onlyProjectTasks","extendRangeForDates","constraint_type","constraint_types","ASAP","ALAP","baselines","calculateEndDate","duration","_min_date","_max_date","_adjust_scales","old_min","old_max","updateTasksRange","copyLinkIdsArray","targetHash","copyLinkIds","getSubtreeLinks","getSubtreeTasks","treeHelper","initDataStores","_init_task","_init_link","taskLinks","existingLink","sourceMatch","targetMatch","typeMatch","resetProjectDates","_isAllowedUnscheduledTask","changedTask","rollup","_update_parents","$drop_target","oldState","calculateScaleRange","newState","sync_link","sync_links","sync_link_delete","checkLinkedTaskVisibility","sourceVisible","targetVisible","deletedLinks","mapEvents","onItemLoading","onBeforeAdd","onAfterAdd","onBeforeUpdate","onAfterUpdate","onBeforeDelete","onAfterDelete","onIdChange","onBeforeItemMove","onAfterItemMove","onFilterItem","onItemOpen","onItemClose","onBeforeSelect","onAfterSelect","onAfterUnselect","sourceTask","conf","mapFrom","mapTo","sourceEvent","targetEvent","Number","_set_default_task_timing","_init_task_timing","correctTaskWorkTime","originalTask","DataProcessorEvents","dp","$gantt","$dp","_dataProcessorHandlers","cascadeDelete","clientSideDelete","getTaskLinks","_links","setGanttMode","setUpdated","_sendTaskOrder","deleteAfterConfirmation","needDbDelete","needCascadeDelete","dpMode","updateMode","setUpdateMode","cascade","storeItem","sendAllData","_tSend","_waitMode","itemLinks","_dp","_tMode","_serverProcessor","_ganttMode","substring","serverProcessor","pluralizedMode","insertCallback","upd","_xmlNodeToJSON","isExist","updateCallback","objData","property","deleteCallback","assignmentsStore","handleResourceCRUD","handleResourceAssignmentCRUD","handleBaselineCRUD","updated","updatedRows","clientOnly","getUserData","_in_progress","resources","dataprocessor_assignments","resource_assignment_store","insertedTasks","pendingAssignments","putAssignmentToQueue","insertResourceAssignment","assignment","dataprocessor_resources","resourcesStore","resource_store","insertResource","resource","dataprocessor_baselines","baselineStore","helpers.forEach","extendGantt","setUserData","_change_id","_row_style","rowId","$dataprocessor_class","_delete_task","setDp","SimpleStorage","_storage","getStoredItem","createDataProcessor","router","tMode","DataProcessor","setTransactionMode","DataProcessor$1","serverProcessorURL","action_param","autoUpdate","_headers","_payload","_postDelim","_routerParametersFormat","_invalid","messages","inserted","deleted","invalid","invalid_cell","enableUTFencoding","total","payload","_serializeAsJson","_router","_utf","escape","getSyncState","dnd","findRow","existing","set_invalid","is_invalid","markRow","sendData","_methods","editStop","pendingUpdateModes","modes","knownModes","checkBeforeUpdate","_beforeSendData","_getRowData","_serializeAsJSON","serialize_one","security_key","pref","valid","_forEachUpdatedRow","_sendData","_getAllData","pattern","_uActions","btag","ganttMode","correct","originalSid","that","_xml","getGanttMode","reqUrl","tag","processCallback","afterUpdateCallback","finalizeUpdate","cleanUpdate","atag","_initialized","_dp_init","_setDefaultTransactionMode","delete_confirmation","dataProcessorEvents","user","_user","_needUpdate","_updateBusy","afterAutoUpdate","fullSync","loadUpdate","xml_node","getUpdates","vers","_getXmlNodeValue","updates","dataToSend","processedData","_cleanupArgumentsBeforeSend","_cleanupItemBeforeSend","updatedItem","output","taskState","taskAction","getActionByState","_onResolvedCreateUpdate","actionPromise","errorMsgStart","errorMsgEnd","queryParams","afterUpdate","dhxVersion","urlParams","_applyPayload","preprocessedData","nodeValue","hasOne","traversedObjects","_prepareDate","helpers.arrayIncludes","_prepareArray","_prepareObject","rawItem","processedItem","dataItem","_prepareDataItem","DEPRECATED_api","DataProcessor.DataProcessor","DataProcessor.createDataProcessor","createMethod","disableMethod","methodName","dummyMethod","restoreMethod","disableMethods","methodsHash","restoreMethods","batchUpdatePayload","noRedraw","call_dp","dp_mode","resetProjects","createWbs","_needRecalc","_isRecalcNeeded","_isGroupSort","_getWBSCode","_calcWBS","$virtual","$wbs","_setWBSCode","getWBSCode","getByWBSCode","_isFirst","_prevSibling","_getPrevNonPlaceholderSibling","_increaseWBS","_parent","siblingiId","_wbs","prevSibling","currentId","wbs","getTaskByWBSCode","resetCache","createResourceMethods","resourceTaskCache","singleResourceCacheBuilt","getTaskBy","propertyName","propertyValue","typeFilter","filterResourceTasks","getResourceTasks","falsyValuePrefix","random","resourceHashFunction","getCacheKey","resourceIds","matchingResources","resourceId","resourceValue","resource_id","selectAssignments","resource_property","owners","getResourceAssignments","assignments","createHelper","resourcePlugin","renderEditableLabel","editable","$task_id","$resource_id","renderSummaryLabel","sum","reduce","editableResourceCellTemplate","$role","editableResourceCellClass","capacity","getSummaryResourceAssignments","childResource","initEditableDiagram","resource_render_empty_cells","timeoutId","makeEditable","cancelAnimationFrame","contentEditable","ganttViews","getCellsByType","$content","currentFocusIndex","setNextFocus","focusableElementsAfterRender","dom_helpers.getFocusableNodes","assignmentEditInProcess","focusableElements","strValue","innerText","assignmentId","startDate","endDate","assignmentStore","nextChunk","calculateDuration","updateTaskAssignments","editable_resource_diagram","fetchTasks","lightbox_resources","selectResourceControlOptions","lightboxOptions","resourceStoreConfig","initItems","storeType","$resourcesStore","lightboxOptionsFnc","options","filteredResources","updateCollection","histogram_cell_class","histogram_cell_label","histogram_cell_allocated","histogram_cell_capacity","defaultResourceCellClass","defaultResourceCellTemplate","resource_cell_value","resource_cell_class","resource_assignments","resourceAssignmentsProperty","process_resource_assignments","resourceAssignmentFormats","auto","singleValue","valueArray","resourceValueArray","assignmentsArray","resourceAssignmentFormat","assignmentModes","fixedDates","fixedDuration","default","initAssignmentFields","initDelay","timing","_assignmentTimeFromTask","resourceAssignmentsStore","_makeAssignmentsFromTask","resourceAssignments","detectFormat","usedIds","defaultMode","_updateTaskBack","getTaskAssignments","_assignAssignments","_loadAssignmentsFromTask","diffAssignments","taskValues","assignmentsStoreValues","inBoth","inTaskNotInStore","inStoreNotInTask","taskOwner","ownerId","foundOwnerAssignment","taskSearch","storeSearch","processedIds","inTask","inStore","assignmentHasChanged","ignoreFields","updateAssignment","_syncAssignments","storeAssignments","tasksAssignments","_syncOnTaskUpdate","_syncOnTaskDelete","idsSearch","taskResources","totalAssignments","needUpdate","needUpdateFor","undoBatchCancel","assignmentsHash","taskAssignmentsCache","unscheduled","deleteIds","resourceAssignmentsCache","resourceTaskAssignmentsCache","searchTaskId","resourceTaskCacheKey","getTaskResources","uniqueResources","addPlaceholder","callIfEnabled","silenceDataProcessor","dataProcessor","_silencedPlaceholder","insertPlaceholder","placeholders","new_task","afterEdit","newTask","isPlaceholderLink","auto_task_types","checkTaskType","changedTypes","targetType","getTaskTypeToUpdate","$needsUpdate","getUpdatedTypes","applyChanges","updateParentTypes","group_mode","delTaskParent","updateTaskType","allTypes","hasChildren","isParsingDone","updateAfterRemoveChild","originalRowDndParent","originalMoveTaskParent","DurationFormatterNumeric","canParse","LinkFormatterSimple","_linkReg","linkPart","exec","_findSource","lag","pred","reqTemplate","formatters","durationFormatter","DurationFormatter","linkFormatter","LinkFormatter","empty_state_screen","show_empty_state","emptyStateElement","isGanttEmpty","placeholderTextElement","empty_state_text_link","empty_state_text_description","placeholderImageElement","placeholderContainer","clickEvents","domHelpers","gridPlaceholder","getContainer","emptyStateElementNode","wrapper","marginTop","oldNodes","detachAddTaskEvents","attachAddTaskEvent","renderContent","hasBaselinesBelow","baselinesOnDifferentRow","render_mode","childrenHaveBaselines","hasBaselines","isSplitParent","getMaxParentHeight","heightLimit","maxHeight","shrinkHeight","splitChild","parentSizes","getItemPosition","parentHeight","rowHeight","initBaselineFields","_syncBaselines","shouldRepaint","iteratedBaselines","taskBaselines","exisingBaselines","getTaskBaselines","exisingBaseline","_adjustSplitParentHeight","adjustTaskHeightForBaselines","_deleteOrphanBaselines","maxParentHeight","childHeight","baselineSize","margins","baselineAmount","subrowHeight","timelineView","getLayoutView","getBarHeight","_increaseSplitParentHeight","subtasks","subtaskId","subtask","subtaskHeight","newBaseline","existingBaseline","baselinesRenderedBelow","repaint","plugins$1","modules","new_task_placeholder","grid_column_api","getGridColumn","parsing","on_load","resp","responseURL","_process_loading","attachAssignmentsToTasks","assignmentsByTasks","collections","_load_collections","collections_loaded","collection","serverList","option","option_key","$ignore","jsonParseError","dhx_security","serializeTask","serializeLink","_copyLink","rawLinks","baselineCopy","xmlParseError","attrs_only","attributes","_getCollections","opts","itms","itm","attrs","k","attr","_getXML","toptag","getXMLTopNode","skey","evs","oldxml","startdate","est","enddate","predecessortasks","message","IsWorkTimeArgument","calendar","ClosestWorkTimeArgument","CalculateEndDateArgument","GetDurationArgument","calendarArgumentsHelper","getWorkHoursArguments","helpers.isValidDate","setWorkTimeArguments","unsetWorkTimeArguments","isWorkTimeArguments","processedConfig","getClosestWorkTimeArguments","arg","_getStartEndConfig","param","argumentType","getDurationArguments","hasDurationArguments","calculateEndDateArguments","WorkTimeCalendarMerger","_getIntervals","hoursArray","_toHoursArray","intervalsArray","toFixed","formatHHMM","secondsValue","minutePart","_intersectHourRanges","baseArray","overridesArray","current","_mergeAdjacentIntervals","_mergeHoursConfig","firstHours","secondHours","merge","firstConfig","secondConfig","mergedSettings","customWeeks","processCalendar","config1","config2","date1","date2","hours2","WorkUnitsMapCache","timestamp","_cache","has","unitCache","subCache","rawValue","yearCache","Map","WorkUnitsObjectCache","LargerUnitsCache","getMinutesPerWeek","weekStart","_weekCache","_calendar","minutesPerWeek","getHoursPerDay","getMinutesPerMonth","monthStart","_monthCache","minutesPerMonth","nextMonth","createCacheObject","DateDurationCache","stepCache","durations","endDates","compute","_getCacheObject","startDateTimestamp","_endDateCacheKey","resultTimestamp","_durationCacheKey","endDateTimestamp","CalendarWorkTimeStrategy","argumentsHelper","_workingUnitsCache","_largeUnitsCache","_dateDurationCache","_worktime","_cached_timestamps","_cached_timestamps_count","_clearCaches","_getUnitOrder","_resetTimestampCache","_timestamp","_checkIfWorkingUnit","hasDuration","_is_work_day","_getWorkHours","_is_work_hour","startHour","endHour","_getTimeOfDayStamp","dayEnd","_is_work_minute","checkTime","_nextDate","_getWorkUnitsBetweenGeneric","next","stepStart","stepEnd","checkFirst","checkLast","isLastStep","_isWorkTime","unitOrder","biggerTimeUnit","_getClosestWorkTimeFuture","_getMinutesPerHour","hourStart","hourEnd","_getMinutesPerDay","durationMinutes","durationHours","_getWorkUnitsForRange","getUnitsPerDay","_getMinutesBetweenSingleDay","_getIntervalTimestamp","minuteFrom","minuteTo","_getMinutesBetween","firstDayStart","firstDayEnd","lastDayStart","lastDayEnd","startPart","endPart","rangePart","_getHoursBetween","_setConfig","_parseSettings","haveCustomWeeks","customWeeksRangeStart","customWeeksRangeEnd","customWeeksBoundaries","_parseHours","minCustomRangeStart","maxCustomRangeEnd","customTime","rangeStart","rangeEnd","fromReadable","toReadable","currentWeek","_tryChangeCalendarSettings","backup","hasWorkTime","_arraysEqual","_compareSettings","mySettings","thatSettings","myDays","otherDates","myHours","otherHours","equals","myWeek","thatWeek","getWorkHours","dateValue","endHours","timestampRanges","part","timerangeConfig","durationSeconds","setWorkTime","calendarConfig","unsetWorkTime","reset_calendar","isWorkUnit","dateKey","setItem","getDuration","_calculateDuration","sign","mult","getEndDate","_calculateEndDate","_calculateMinuteEndDate","_subtractMinuteDate","_calculateHourEndDate","_addInterval","stopAction","added","dstShift","workTimeCheck","_addHoursUntilDayEnd","rangeHours","addHours","intervalEnd","durationLeft","hoursPerDay","_addMinutesUntilHourEnd","rangeMinutes","addMinutes","_subtractMinutesUntilHourStart","hourStartTimestamp","initialDateTimestamp","getClosestWorkTime","minutePrecision","_isMinutePrecision","addedInterval","calculatedDay","daySchedule","minutesInDay","dayStart","iterateFromDayEnd","isWorkHour","workInterval","prevInterval","minutesInHour","_getClosestWorkTimePast","times","lastInterval","_getClosestWorkTime","inputDate","direction","closestFuture","closestPast","_getClosestWorkTimeGeneric","_findClosestTimeInDay","resultDate","fromDayEnd","_getClosestWorkMinute","increment","maximumLoop","daysOfWeek","hasRegularHours","_checkWorkHours","dayConfig","legacyResourceCalendarConfig","isLegacyResourceCalendarFormat","resourceCalendarsProperty","getResourceProperty","resourceCalendarsConfig","getCalendarIdFromLegacyConfig","calendarId","dynamicResourceCalendarsFactory","getResourcesCalendarKey","dynamicCalendars","mergeResourceCalendars","manager","mergeCalendars","getResourceCalendar","getCalendarIdFromMultipleResources","tempCalendar","addCalendar","dynamicResourceCalendars","CalendarManager","_calendars","_legacyConfig","_isLegacyConfig","createDefaultCalendars","_convertWorkTimeSettings","calendars","mergeHelper","CalendarMergeHelper","_createCalendarFromConfig","createCalendar","apiCore","createArgumentsHelper","preparedConfig","parentCalendar","defaults","fulltime","getCalendar","getCalendars","_getOwnCalendar","resourceProperty","calendarsConfig","getTaskCalendar","taskObject","groupMode","currentTask","$effective_calendar","isCalendar","deleteCalendar","restoreConfigCalendars","possibleCalendar","props","every","CalendarDisabledTimeStrategy","fixedUnits","TimeCalculator","calendarManager","$disabledCalendar","NoWorkTimeCalendar","_getCalendar","createWorkTimeFacade","timeCalculator","_hasDuration","worktimeFacadeFactory","_isTaskInTimelineLimits","taskStart","taskEnd","_getProjectEnd","project_end","_getProjectStart","project_start","getDefaultTaskDate","parent_id","parentExists","schedule_from_end","$new","showTask","_lightbox_id","_tasks_dnd","drag","getTaskTimingMode","task_type","$no_start","$no_end","scheduled_summary","task_mode","dirty","$calculate_duration","effectiveCalendar","updateTaskTiming","taskMode","getSubtaskInfo","assignProjectDates","$rollup","taskTiming","summaryDateFields","manuallyScheduledSummaryDateFields","dateFields","getSubtaskDuration","isScheduledSummary","updateAll","has_changed","startDateField","$auto_start_date","endDateField","$auto_end_date","oldStart","oldEnd","roundDate","upper","lower","colIndex","data_task_types","cached_functions","_cached_functions","critical_path_mode","wrap_methods","_prefetch_originals","prefetch","methodname","original","optimizer","get_prefetched_value","argumentsArray","l","get_arguments_hash","cached_values","has_cached_value","get_cached_value","cache_value","arguments_hash","is_date","values","stringify_argument","activate","deactivate","setup","override_gantt","gantt_methods","highlight_critical_path","update_if_changed","changed","deactivTimeout","addResizeListener","containerStyles","getPropertyValue","resizeWatcher","salesforce_environment","container_resize_method","contentWindow","listenWindowResize","resizeTimeout","resizeDelay","previousSize","getContainerSize","lowlevelResizeWatcher","$scrollbarRepaint","currentSize","repaintGantt","previousHeight","previousWidth","expire","gantt_core","isHTMLElement","invalidContainerMessage","validateNode","_reinit","dropLayout","_clearTaskLayers","_clearLinkLayers","rebuildLayout","createView","resetLayout","domHelpers.toNode","$mouseEvents","addMinimalSizes","edit","question","confirm_deleting","confirm_deleting_title","_simple_confirm","hideLightbox","visibleDate","_sort","posX","_getHorizontalScrollbar","scrollbar","codeScrollLeft","preserveScroll","new_pos","new_date","posY","scrollbarsInfo","getScrollbarsInfo","scroll_info","scrollbarNodeVisible","$view","boundViews","viewName","x_pos","setSizes","changeLightboxType","getLightboxType","_silent_redraw_lightbox","_get_link_type","prevOffset","time_unit","helpers.getSecondsInUnit","offsetChanged","domHelpers.getClassName","_eventRemoveAll","resetLightbox","icon_save","icon_cancel","icon_details","confirm_closing","section_description","section_time","section_type","section_deadline","section_baselines","column_wbs","column_text","column_start_date","column_duration","column_add","confirm_link_deleting","type_task","type_project","type_milestone","weeks","months","years","message_ok","message_cancel","section_constraint","asap","alap","snet","snlt","fnet","fnlt","mso","mfo","resources_filter_placeholder","resources_filter_label","baselines_section_placeholder","baselines_add_button","baselines_remove_button","baselines_remove_all_button","deadline_enable_button","deadline_disable_button","LocaleManager","addLocale","_locales","getLocale","i18nFactory","en","ar","be","ca","cn","cs","da","de","es","fa","fi","fr","he","hr","hu","it","jp","kr","nb","nl","no","pl","pt","ro","ru","si","sk","sv","tr","ua","DHXGantt","license","edit_save","edit_cancel","factory","supportedExtensions","extensionManager","ExtensionManager","activePlugins","plugin","RemoteEvents","templatesLoader","stateService","selected_task","datastoreHooks","i18n","setLocale","localeObject","gantt_save_btn","gantt_cancel_btn","gantt_delete_btn","boxAttribute","_dhx_msg_cfg","usercall","modalBox","modal_key","messageBox","keyboard","cancelBubble","modality","cover","onkeydown","buttonAriaAttrs","messageButtonAttrString","button_css","onclick","messageInfoAttr","insertBefore","timers","getFirstDefined","_boxStructure","ok","cancel","contentId","messageModalAttr","inner","btn","_createBox","hidden","innerWidth","innerHeight","alertPopup","confirmPopup","boxPopup","box_params","params","alertBox","confirmBox","subtype","hideAll","popups","alert","confirm","modalbox","extendSettings","parentSettings","own","$extendedConfig","setPrototypeOf","configurable","parentView","parentConfig","parentTemplates","$getConfig","$getTemplates","configurable$1","uiFactory","createFactory","views","ui","createdViews","creator","configure","$parent","viewConstructor","initUI","registerView","uiFactory$1","createMouseHandler","eventHandlers","doubleclick","contextMenu","addEventTarget","callHandler","onClick","findEventHandlers","default_action","callEventHandlers","onContextMenu","src","delegateHandlers","h","onDoubleClick","onMouseMove","_last_move_event","elementHandlers","domEvents","delegate","mouseEvents","genericViewPortChecker","x_end","y_end","isLegacyRender","getRowRectangle","getVisibleTasksRange","buffer","indexStart","indexEnd","extraTasksIds","inlineEditorId","rendererFactory","task_area_pulls","task_area_renderers","getRenderer","renderMethod","updateMethod","getRectangle","renderCallbackMethod","specializedViewPortChecker","basicGetRectangle","onrender","isInViewPort","layerView","viewConfig","remove_item","rendererViewPort","useBuffer","rendered","clear_container","basicGetRange","getVisibleRange","prepareData","createDocumentFragment","vis","itemsSearch","renderedItems","newElements","nodesToRemove","renderCalledFor","itemNode","restore","replace_item","item_id","newNode","replaceChild","clearRenderers","layerFactory","renderFactory","renderFactoryProvider","createGroup","relativeRoot","defaultFilters","initLayer","renderGroup","tempCollection","filters","_add","getLayer","pending","topmost","rel","mergeFilters","requestUpdate","eachLayer","removeLayer","filter_methods","filter_method","barRectangle","startCoord","endCoord","getLinkBox","sourceBox","targetBox","calculated","clearCache","visibleItems","rec","getLinkRectangle","initialized","getVisibleLinksRange","visibleBoxes","isLinkInViewPort","sourceTop","sourceHeight","targetTop","targetHeight","sourceLeft","sourceRight","targetLeft","targetRight","$skipSmartRenderOnScroll","createLayerEngine","createLayerFactory","previusSiblingContainer","defaultContainerSibling","taskLayers","$task_links","linkLayers","addTaskLayer","rangeFunction","getVisibleTaskRange","_getTaskLayers","removeTaskLayer","addLinkLayer","getVisibleLinksRangeFactory","isLinkInViewport","_getLinkLayers","removeLinkLayer","Cell","headerHeight","$domEvents","$name","$factory","_headerClickHandler","final","$preResize","topCont","topSize","getSize","maxWidth","minHeight","setSize","_hide","cellIndex","moveView","$toHTML","collapseIcon","canCollapse","$fill","cellId","collapsed","size","gravity","getContentSize","$lastSize","contentX","contentY","_getBorderSizes","borders","horizontal","vertical","_currentBorders","_borders","_sizeHeader","_sizeContent","_setBorders","domHelpers.removeClassName","cssHash","domHelpers.addClassName","xLayout","transform","__extends","__","Layout","_super","_this","_parseConfig","domHelpers.removeNode","$cells","_resizeScrollbars","scrollbars","scrollChanged","visibleScrollbars","hiddenScrollbars","scrollbarsToHide","showScrollbar","hideScrollbar","shouldHide","shouldShow","visibleGroups","group","visible","scrollSize","linkedViews","_getLinkedViews","x_inner","y_inner","y_pos","_syncCellSizes","groupName","newSize","groups","_eachChild","_syncGroupSize","_xLayout","newSizeValue","isGravity","ownSize","resizeSibling","siblingSize","totalGravity","totalSize","mainGrid","grid_width","startStage","mainCall","_resizeInProgress","contentViews","setContentSize","_getAutosizeMode","$originalWidthStored","$originalWidth","$originalHeightStored","$originalHeight","isChild","sub","getCells","domHelpers.insertNode","domHelpers.getChildNodes","contentWidth","contentHeight","_cleanElSize","_getBoxStyles","computed","clientHeight","properties","boxSizing","MozBoxSizing","horPaddings","borderLeftWidth","borderRightWidth","vertPaddings","borderTopWidth","borderBottomWidth","borderBox","outerWidth","outerHeight","boxSizes","contentSizes","_sizes","margin","_calcFreeSpace","side","_free","_gravity","_calcSize","_configureBorders","borderClass","lastVisibleIndex","lastCell","borderColorClass","_updateCellVisibility","oldVisibleCells","_visibleCells","firstCall","visibleCells","parentVisibility","hide_empty","hideCell","cellView","marginSide","ViewLayout","$cell","byMaxSize","otherCell","ViewCell","childConfig","$initialized","unload","_setContentSize","outerX","outerY","childSize","Resizer","ScrollbarCell","SCROLL_MODIFIER_KEYS","_scrollHorizontalHandler","_scrollVerticalHandler","_outerScrollVerticalHandler","_outerScrollHorizontalHandler","_mouseWheelHandler","scroll_size","_isHorizontal","_isVertical","_initVertical","_initHorizontal","_initMouseWheel","_initLinkedViews","_getRootParent","eachCell","_eachView","$scroll_hor","$scroll_ver","_updateLinkedViews","ff","scrollHorizontally","_scrolling","oldSize","scrollVertically","_wheel_time","_oldLeft","_getScrollSize","outerSize","isHorizontal","linked","scrollProperty","innerSizeProperty","outerProperty","_getScrollOffset","cellScrollSize","nonScrollableSize","scrollableViewPortSize","outerScroll","innerScroll","scrollSizes","_setScrollSize","toggleVisibility","_getScaleOffset","parentLayout","vparent","_oldTop","_checkWheelTarget","connectedViews","wheelSpeed","wheelSpeedConfig","wheel_scroll_sensitivity","deltaX","wheelDeltaX","deltaY","wheelDelta","multiplier","deltaMode","wx","wy","horizontalScrollModifier","oldLeft","detail","oldTop","cachedRowHeight","canUseSimpleCalc","_getRowHeight","_refreshState","rowStore","globalRowHeight","canUseSimpleCalculation","createMixin","getItemTopCache","getRowTopCache","getItemHeightCache","totalHeightCache","getItemHeightCacheState","quickPosition","quickPositionHelperFactory","_resetTopPositionHeight","_resetHeight","getCacheStateTotalHeight","shouldClearHeightCache","all","itemIndex","_fillHeightCache","defaultHeight","globalHeight","itemHeightCache","sumHeight","getHeight","totalHeight","createStaticBgHelper","destroy","canvasRender","createLayerConfig","taskFilter","barVisible","hide_bar","expose","$task_bars","taskBg","$task_bg","Timeline","_posFromDateCache","_timelineDragScroll","topPositionMixin","$task_scale","taskBars","taskConstraints","taskDeadlines","$task_baselines","$task_constraints","$task_deadlines","_tasks","linksAttr","bindLinks","item_attribute","_createLayerConfig","_attachLayers","backgroundImage","data_els","scrollWidth","scrolled","_refreshScales","_scales","_getScaleChunkHtml","_taskLayers","_linkLayers","_bindStore","taskRenderer","bar_layer","_taskRenderer","_initStaticBackgroundRender","linkStore","linkRenderer","linkLayer","_linkRenderer","staticRender","_staticBgHandler","staticBgContainer","$task_bg_static","staticBackgroundHeight","_clearLayers","_render_tasks_scales","scales_html","outer_width","helpers","cfgs","_get_scale_chunk_html","fromPos","toPos","cssClass","tplClass","_prepareScaleHtml","_prepare_scale_html","globalConfig","globalTemplates","helpers.findBinary","cssclass","floatConfig","sticky","labelPosition","approxLabelWidth","labelPos","translateValue","getTimelineCellAttr","_getColumnDuration","wholeCells","partCell","roundPos","_getNextVisibleColumn","visibleDateIndex","_getPrevVisibleColumn","_getClosestVisibleColumn","dateIndex","visibleIndex","transition","xLeft","xRight","displayStart","displayEnd","isMilestoneRender","_get_coll_duration","_timelineCacheAttached","_unbindStore","createResizer","doOnRender","createRowResizer","_task_grid_row_resize","row_before_start","row_id","row_after_start","row_drag_move","dd","itemHeight","pointerPosition","markerStartPosition","marker_height","minPointerPosition","row_drag_end","oldItemHeight","finalHeight","_init_resize","dnd_sensitivity","SENSITIVITY","TIMEOUT","SCROLLSTEP","ScrollableGrid","_scrollOrder","getCurrentX","_dnd","_scrollView","attachEvents","isScrollable","gridBoundingRect","maxLeft","minLeft","currentX","autoscrollRight","autoscrollStart","autoscrollLeft","autoscrollStop","scrollStep","getCorrection","COLUMN_ID_ATTR_NAME","ColumnsGridDnd","_targetMarker","calculateCurrentPosition","eventX","DND","_scrollableGrid","_draggedCell","draggedColumn","draggedIndex","_gridConfig","outerHTML","lineHeight","_dragX","columnIndexes","findColumnsIndexes","setMarkerPosition","drawTargetMarker","targetColumn","cleanTargetMarker","reorderColumns","draggedId","xBefore","xAfter","currentColumn","startX","endX","compare","columnRelativePos","relativeX","gridOffset","nextPosition","Grid","$state","gridAriaAttr","gridAttrString","gridDataAriaAttr","gridDataAttrString","reorder_grid_columns","gridScaleRowAttrString","gridResize","_renderHeaderResizers","_mouseDelegates","mouseEventContainer","resizerrow","rowResize","_addLayers","_initEvents","_columnDND","ColumnDnd","_validateColumnWidth","numericWidth","elasticColumns","_setColumnsWidth","columnProperty","newColumnWidth","columnsWidth","_getGridWidth","_gridCacheAttached","_initSmartRenderingPlaceholder","_calculateGridWidth","_renderGridHeader","getColumnIndex","excludeHidden","hiddenIndexShift","getColumn","gridLine","gridTaskRowResizer","_refreshPlaceholderOnStoreUpdate","$rowsPlaceholder","_getColumnWidth","min_width","new_width","max_width","_checkGridColumnMinWidthLimits","_getGridWidthLimits","min_limit","max_limit","newWidth","start_index","columns_width","final_width","extra_width","start_width","iterator","curExtra","_getColsTotalWidth","cols_width","v","parseFloat","unknown","gridWidth","delta","lineHeigth","colWidth","ariaAttrs","gridScaleCellAttrString","defaultMapping","isChanged","save","onShow","keyNav","preventKeyNav","shouldPrevent","editPrevCell","editNextCell","onHide","keyNavMappings","onBlurDelay","activeCell","editorState","hasEditor","editorType","anyModifier","getKeyboardMapping","mapping","setMapping","getMapping","BaseFactory","BaseEditor","set_value","get_input","get_value","is_changed","currentValue","is_valid","textEditorFactory","TextEditor","numberEditorFactory","NumberEditor","oninput","selectEditorFactory","SelectEditor","optionsHtml","dateEditorFactory","html5DateFormat","DateEditor","minValue","maxValue","minAttr","maxAttr","predecessorEditorFactory","PredecessorEditor","getFormatter","formatter","parseInputString","predecessors","delimiter","formatPredecessors","getSelectedLinks","predecessorCodes","Set","formatLinkKey","getLinksDiff","selectedLinks","existingLinksSearch","linksToAdd","linkKey","linksToDelete","linksDiff","autoSchedule","inputPredecessors","taskPredecessors","durationEditorFactory","linkedPropertiesProcessor","processTaskDateProperties","keepDatesOnEdit","keepDurationOnEdit","defaultActionOnEdit","decreaseStartDate","initConfigs","number","predecessor","keyboardMapping","eventBus","createGridEditors","_getGridCellFromNode","_getEditorPosition","findVisibleIndex","_createPlaceholder","inlineEditorAttr","updateTaskDateProperties","ganttHandlers","_itemId","_columnName","_editor","_editorType","_placeholder","setValue","editorConfig","getValue","_getItemValue","inline_editors_date_processing","_findEditableCell","findEditableCell","nextColumn","getNextCell","moveCell","getFirstCell","getLastCell","nextCell","canChangeRow","moveRow","prevCell","nextItem","editNextRow","nextRow","skipReadonly","editPrevRow","prevRow","detachStore","inlineEditController","createEditors","isBarInViewport","createTaskRenderer","_render_task_element","painters","defaultRenderer","_task_default_render","controlsMargin","padd","milestoneHeight","milestoneWidth","_render_task_progress","_render_task_content","_combine_item_class","progressColor","textColor","setProperty","_render_leftside_content","_render_rightside_content","setTaskBarAttr","taskEditable","timelineDrag","_render_pair","outer","showLinkPoints","_render_side_content","marginStyle","_get_link_crossing_css","cond","_get_conditions","ln","tp","done","pr","markerPos","leftside","basic","link_from_start","link_target_id","isCriticalTask","link_landing_area","from_id","link_to_start","allowDrag","dragClass","marginLeft","marginRight","createBaseBarRender","resourceHistogramRenderer","renderedNodes","checkVisibility","generateChildElement","childCopy","$rendered_at","displayRollup","getKey","renderParentId","renderRollupTask","repaintRollupTask","rollupKey","getVisibleCellsRange","firstCellIndex","lastCellIndex","isColumnVisible","cellLeftCoord","cellRightCoord","bgPlaceholder","placeholderConfig","lastTaskId","placeholderTask","calendar_id","createTaskBgRender","renderedCells","isRendered","detachRenderedCell","getCellClassTemplate","cssTemplate","getCellContentTemplate","contentTemplate","renderCells","renderOneCell","cssTemplateContent","htmlTemplateContent","customCell","_render_bg_line","cellCssTemplate","cellHtmlTemplate","odd","placeholderTop","lastTaskTop","lastTaskHeight","placeholderHeight","createLinkRender","_render_link_element","path_builder","get_endpoint","e_y","e_x","get_points","lines","drawer","get_lines","shapes","transform_lines_to_shapes","render_shapes","isCriticalLink","linkAttr","shape","render_line","render_corner","render_arrow","radius","link_radius","arrowSize","line","nextLine","cornerX","cornerY","link_line_width","corner","lastLine","arrowX","arrowY","arrow","current_pos","dirs","path","point","line_to","get_path","_get_line","get_wrapper_sizes","wrapper_size","get_line_sizes","line_size","innerPos","lineWidth","cornerDiv","borderVertical","borderHorizontal","get_direction","vect","point_to","xy","lineType","get_line_type","forward","getMilestonePosition","splitParams","milestoneTask","siblingBaselines","createGridLineRender","_render_grid_item","has_child","textValue","aria","gridAddButtonAttrString","flexAlign","center","justifyContent","gridCellAttrString","storeName","css_template","taskRowAttr","rowNode","cellNode","external_render","adapter","isElement","renderElement","createResourceTimelineBuilder","getResourceLoad","calculateResourceLoad","calculateResourceLoadFromAssignments","assignmentsPassed","scaleUnit","scaleStep","timegrid","precalculatedTimes","firstColumn","minScaleDate","currDate","cachedTimes","timetable","generateRenderResourceLine","resourceTimetable","renderedResourceLines","renderResourceLineCell","detachRenderedResourceLine","renderResourceLine","updateResourceLine","checkedColumns","createGridTaskRowResizerRender","resize_el","rowResizerAttr","_init_dnd","getStore","checkPlaceholderTask","initial_open_state","$transparent","lastTaskOfLevel","last_item","_getGridPos","gridHeight","maxBottom","_getTargetY","scrollPos","_getTaskByY","dropIndex","gridDataSizes","reorderMarkerAttr","containerSize","targetY","allowedLevel","over","nextId","rowDnd","dropTarget","createDropTargetObject","targetId","nextSiblingTarget","dndTaskId","prevSiblingTarget","firstChildTarget","lastChildTarget","findClosesTarget","targetLevel","findTargetAbove","findTargetBelow","getSameLevelDropPosition","relTargetPos","eventTop","targetAbove","targetBelow","getMultiLevelDropPosition","highlightPosition","getTaskMarkerPosition","markerLine","pointerEvents","highlightFolder","highlightRow","removeLineHighlight","linePos","getLineMarkerPosition","markerLineTop","markerFolder","gridToPageCoordinates","folderHighlightWidth","setWidthWithinContainer","indentNode","indent","iconWidth","childCount","gridPos","ePos","higlighter","opacity","drop_target","getTargetTaskId","doctype","minTop","firstVisibleTaskIndex","firstVisibleTaskId","firstVisibleTaskPos","hiddenTaskPart","gridPosition","gridBottom","placeholderRowHeight","getDropPosition","lockLevel","rowTop","getMultiLevelTarget","getLockedLevelTarget","rowDndMarker","initializer","onCreated","_inlineEditors","onInitialized","initEvents","extendDom","onDestroyed","clearEvents","notOpenIcon","showDate","sorting_method","totalWidth","createTaskDND","dragMultiple","before_start","before_finish","after_finish","clear_drag_state","set_actions","drag_from_start","stage","_move","_resize","_resize_progress","on_mouse_move","on_mouse_down","on_mouse_up","start_x","start_y","coords_x","_drag_task_coords","minDurationInUnits","_calculateMinDuration","inMs","diffValue","_find_max_shift","dragItems","correctShift","minX","maxX","maxShift","minShift","multipleDragShift","new_start","new_end","obj_s_x","obj_e_x","_mouse_position_change","oldPos","newPos","_is_number","isFinite","start_drag","sX","sY","now","_start_dnd","_update_on_move","_update_item_on_move","curr_date","dragHash","_isMultiselect","selectedTasksIds","dragProject","initialDrag","newStartPos","newEndPos","handle_offset","dragPos","dragX","shiftDate","childDrag","_get_drag_mode","_fix_dnd_scale_time","fixStart","fixEnd","_fix_working_times","_finalize_mouse_up","_fireEvent","_dhx_changed","finalizingBulkMove","moveCount","doFinalize","classes","dragProperty","selectedTask","_addSubtasksToDragMultiple","trigger","round_task_dates","drag_state","summaryId","initTaskDND","roundTaskDates","taskDnD","initLinksDND","_link_landing","_link_target_task","_link_target_task_start","_link_source_task","_link_source_task_start","markerDefaultOffset","scrollDefaultSize","getDndState","start_marker","end_marker","link_edge_marker","link_landing_hover_area","resetDndState","_dir_start","updateMarkedHtml","getVieportSize","getMarkerSize","markerSize","viewportSize","ganttOffsetY","advanceMarker","landing","prevTarget","prevLanding","prevToStart","targ","sameGantt","absCoords","domHelpers.getRelativeNodePosition","_dir_end","targetChanged","showDirectingLine","removeDirectionLine","s_x","s_y","getDirectionLine","link_direction_class","dist","tan","angle","atan","coordinateCircleQuarter","sin","cos","ieTransform","shiftLeft","shiftTop","eX","eY","_direction","linkDnD","createLinkDND","_linksDnD","_tasksDnD","MouseDelegates","_attachDomEvents","_attachStateProvider","_clearDomEvents","_clearStateProvider","_delete_link_handler","coll","coll_date","scale_step","getVerticalScrollbar","getHorizontalScrollbar","_legacyGridResizerClass","resizers","gridResizer","mainTimeline","colsWidth","hideGrid","grid_limits","ganttContainerWidth","verticalScrollbar","verticalScrollbarWidth","gridOverflow","original_grid_width","skinSettings","skins","_initScrollStateEvents","_getVerticalScrollbar","_findGridResizer","gridFirst","_getSiblings","_behind","_front","resizeInfo","initialWidth","prevCellWidth","nextCellWidth","viewCell","limits","newBehindSize","newFrontSize","oldBackSize","oldFrontSize","newBackSize","attachInitializer","Scrollbar","mainLayoutInitializer","mainTimelineInitializer","mainGridInitializer","ResourceGrid","ResourceTimeline","ResourceHistogram","layersEngine","createLayers","gridEditorsFactory","layersApi","gridRenderer","renderTaskBg","renderTaskBar","timedProjectBar","renderTimedProjectBar","taskRollupBar","renderRollupTaskBar","taskSplitBar","renderSplitTaskBar","renderConstraints","taskDeadline","renderDeadline","renderBaselines","renderLink","resourceRow","resourceMatrixRenderer","resourceHistogram","gridTaskRowResizerRenderer","layersService","ui$1","createLayoutFacade","getTimeline","getGrid","getBaseCell","baseCell","gridDrag","gridMarkers","getAttachedScrollbar","horizontalScrollbar","attachedScrollbar","scrollbarView","DEFAULT_VALUE","tryCall","getTaskTop","getTaskBarHeight","domAttr","getLinkNode","oldH","oldV","scrollBoth","verticalViews","horizontalViews","commonViews","viewId","newV","newH","date_x","scroll_to","leftPos","_scroll_state","gridCell","timelineCell","gridScrollbar","scrollVer","scrollHor","horState","verState","cellName","horizontalScroll","verticalScroll","_configure","_get_skin","themeVar","isCssVarTheme","themeName","href","_theme_info","theme","cssVarTheme","skinset","_second_column_width","_third_column_width","_lightbox_template","_redefine_lightbox_buttons","resetSkin","monitorThemeChange","_addThemeClass","setSkin","monitorIntervalId","csstheme","skyblue","lightbox_additional_height","meadow","terrace","broadway","_config_buttons_left","_config_buttons_right","material","indx","dark","contrast_black","contrast_white","scrollRange","scrollDelay","scrollSpeed","isMove","delayTimeout","startPos","eventPos","isDisplayed","getAutoscrollContainer","isScrollState","dragMarker","isResize","isLink","isClickDrag","defineDelayTimeout","speed","tick","autoscroll_delay","defineScrollInterval","autoscrollInterval","isScroll","need_scroll","currentScrollTop","scrollOuterHeight","scrollInnerHeight","currentScrollLeft","scrollOuterWidth","scrollInnerWidth","autoscroll_step","boxSize","jQuery","$","fn","dhx_gantt","each","newgantt","Gantt","getGanttInstance","jquery_hooks","dhtmlx","attaches","attachGantt","cmp","attachObject","dataType","dataObj","vs","av","border","gridId","gridObj","method_name","dhtmlXCellObject","dhtmlx_hooks","USE_KEY","_defaultScales","TimelineZoom","zoomIn","getCurrentLevel","setLevel","zoomOut","_levels","_activeLevelIndex","getLevels","zoomLevel","_getZoomIndexByName","levelName","_getVisibleDate","_visibleDate","cursorOffset","nextConfig","chartConfig","resourceViews","resourceView","resourceConfig","fixed_scales","cursorDate","newPosition","middleDate","_attachWheelEvent","_useKey","_handler","_defaultHandler","timelineOffset","wheelY","wheelUp","stopPropagation","_setScaleSettings","_setScaleDates","_initialStartDate","_initialEndDate","activeLevelIndex","_mapScales","levels","_minColumnWidth","minColumnWidth","_maxColumnWidth","maxColumnWidth","_widthStep","widthStep","_stepUp","_stepDown","nextLevel","zoom","touch_feedback","touch_feedback_duration","vibrate","addTouchEvents","platform","maxTouchPoints","_touch_events","findTargetView","allViews","scrollView","getTaskDND","tasksDnD","touchHandlers","names","dblclicktime","actionMode","scrollMode","actionStart","longTapTimer","currentDndId","dndNodes","targetView","multiTouchEvents","newScrollState","block_action","_locate_css","cloneTaskRendered","taskNode","dummy","BaseControl","BaseConstrutor","TemplateControlConstructor","Super","TemplateControl","sns","TextareaControlConstructor","TextareaControl","form_blocks","_get_input","_focus","TimeControlConstructor","TimeControl","getTimePicker","sectionClassName","_time_format_order","auto_end_date","_update_lightbox_select","_fill_lightbox_select","onchange","_resolve_default_mapping","selects","_getEndDate","getTimePickerValue","autofix_end","_get_timepicker_step","htmlHelpers","getHtmlSelect","_attributes","getHtmlOption","_getHtmlContainer","getHtmlButton","getHtmlDiv","getHtmlLabel","getHtmlInput","_getHtmlAttributes","ResourcesControlConstructor","SelectControl","_dhx_onchange","CheckboxControlConstructor","CheckboxControl","single_value","checkboxes","checked","helpers.arrayMap","RadioControlConstructor","RadioControl","radio","default_value","DurationControlConstructor","DurationControl","singleDate","lightboxDurationInputAttrString","durationInputClass","inps","btns","endspan","duration_val","_calc_date","_getStartDate","_getDuration","_change_duration","charCode","ParentControlConstructor","ParentControl","_display","tmpDom","newOptions","onselect","allow_root","root_label","_filter","ConstraintControlConstructor","ConstraintControl","isNonTimedConstraint","toggleTimeSelect","timeSelects","typeValue","isNonTimed","disabled","timeLabel","typeSelect","_eventsInitialized","constraintDate","constraintType","getConstraintType","TypeselectControlConstructor","TypeselectControl","typeKey","oldOnChange","_lightbox_current_type","BaselineControlConstructor","_generateBaselineRow","durationLabel","deleteLabel","durationEl","deleteButton","baselineRow","deleteEl","section","baselineSection","baselineRows","baselineNode","baselineId","dataset","updatedBaseline","button_click","_get_typed_lightbox_config","SelectControlConstructor","ResourcesControl","BaselineControl","_lightbox_methods","_lightbox_root","setParentNode","cspEnvironment","salesforceEnvironment","showCover","_fill_lightbox","_setLbPosition","lightboxVisibleAttr","_is_chart_visible","getLabel","list_name","_lightbox_type","lightboxDiv","fullWidth","ds","classNames","_lightbox","_is_lightbox_timepicker","wide_form","getHtmlButtons","lightboxAttr","onmousedown","_ready_to_dnd","ontouchstart","onselectstart","cursor","_init_dnd_events","show_cover","_cover","_render_sections","backup_overflow","bindLabelsToInputs","_init_lightbox_events","block","_center_lightbox","rootElement","_move_while_dnd","_finish_dnd","lightbox_events","_save_lightbox","_cancel_lightbox","sec","buttonTarget","getLightboxValues","time_controls","time_optional","duration_optional","lightboxHiddenAttr","hideCover","_custom_lightbox","_set_lightbox_values","lightboxHeader","lightbox_header","getLightboxSection","get_template_control","control","get_select_control","get_textarea_control","get_time_control","_dnd_start_lb","gantt_unselectable","lb","_lb_start","timeFormat","getTimeFormat","limit_time_select","first_hour","last_hour","getHtmlTimePickerOptions","lightboxSelectAttrString","needSetTime","mapOffset","checkbox","constraint","typeselect","_get_type_name","type_value","oldType","labelBlock","inputBlock","inputId","floatRight","lightboxButtonAttrString","time_format","start_year","end_year","tdate","year_range","_time_values","lightbox_optional_time","_extend_to_optional","lightbox_block","optional_time","update_block","button_text","wai_aria","htmlTags","extraSpaces","stripHTMLLite","htmlText","singleQuotes","escapeQuotes","getAttributeString","_taskCommonAttr","linkTypes","toStart","fromStart","gridSeparatorAttr","buttonName","role","tabindex","headerText","time_option","buttonLabel","isDisabled","domEventScope","uiApi","targetAttribute","_locateHTML","firstTask","domHelpers.getScrollSize","availablePlugins","critical_path","grouping","groupBy","overlay","ajaxLoading","_load_url","cl","_load_type"],"mappings":";;;;;;;;;;;AACA,SAASA,gBAAgBC;AACxB,MAAIC,MAAI,GAAGC,OAAK,GAAGC,QAAM,GAAGC,SAAO;AACnC,MAAIJ,KAAKK,uBAAuB;AAC/B,QAAIC,MAAMN,KAAKK,sBACf;AAAA,QAAIE,OAAOC,SAASD;AACpB,QAAIE,UAAWD,SAASE,mBACvBF,SAASD,KAAKI,cACdH,SAASD;AAEV,QAAIK,YAAYC,OAAOC,eAAeL,QAAQG,aAAaL,KAAKK;AAChE,QAAIG,aAAaF,OAAOG,eAAeP,QAAQM,cAAcR,KAAKQ;AAClE,QAAIE,YAAYR,QAAQQ,aAAaV,KAAKU,aAAa;AACvD,QAAIC,aAAaT,QAAQS,cAAcX,KAAKW,cAAc;AAC1DjB,UAAOK,IAAIL,MAAOW,YAAYK;AAC9Bf,WAAOI,IAAIJ,OAAOa,aAAaG;AAE/Bf,YAAQK,SAASD,KAAKY,cAAcb,IAAIH;AACxCC,aAASI,SAASD,KAAKa,eAAed,IAAIF;AAAAA,EAC5C,OAAQ;AACN,WAAMJ,MAAM;AACXC,YAAMA,MAAMoB,SAASrB,KAAKsB,WAAU,EAAA;AACpCpB,aAAOA,OAAOmB,SAASrB,KAAKuB,YAAW,EACvCvB;AAAAA,aAAOA,KAAKwB;AAAAA,IACZ;AAEDrB,YAAQK,SAASD,KAAKY,cAAcnB,KAAKmB,cAAcjB;AACvDE,aAASI,SAASD,KAAKa,eAAepB,KAAKoB,eAAenB;AAAAA,EAC1D;AACD,SAAO,EAAEwB,GAAGC,KAAKC,MAAM1B,GAAAA,GAAM2B,GAAGF,KAAKC,MAAMzB,IAAAA,GAAO2B,OAAM7B,KAAKmB,aAAaW,QAAO9B,KAAKoB,cAAcjB,OAAOuB,KAAKC,MAAMxB,KAAQC,GAAAA,QAAQsB,KAAKC,MAAMvB;AAClJ;AAEA,SAAS2B,UAAUC,MAAAA;AAClB,MAAIC,UAAU,OACbC,aAAa;AACd,MAAGrB,OAAOsB,kBAAiB;AAC1B,QAAIC,QAAQvB,OAAOsB,iBAAiBH,MAAM,IAAA;AAC1CC,cAAUG,MAAM,SAAA;AAChBF,iBAAaE,MAAM,YACrB;AAAA,EAAA,WAAUJ,KAAKK,cAAa;AAC1BJ,cAAUD,KAAKK,aAAa;AAC5BH,iBAAaF,KAAKK,aAAa,YAAA;AAAA,EAC/B;AACD,SAAQJ,WAAW,UAAUC,cAAc;AAC5C;AAEA,SAASI,uBAAuBN,MAC/B;AAAA,SAAA,CAAQO,MAAMP,KAAKQ,aAAa,UAAA,CAAA,KAAiBR,KAAKQ,aAAa,UAAA,IAAY,KAAK;AACrF;AAEA,SAASC,QAAQT,MAChB;AAAA,MAAIU,cAAc,EAACC,GAAK,MAAMC,MAAQ,KACtC;AAAA,MAAGF,YAAYV,KAAKa,SAASC,gBAAe;AAC3C,WAAA,CAAA,CAASd,KAAKQ,aAAa,MAC3B;AAAA,EAAA;AACD,SAAO;AACR;AAEA,SAASO,UAAUf,MAAAA;AAClB,MAAIgB,aAAa,EAACC,OAAQ,MAAMC,QAAS,MAAMC,UAAW,MAAMC,QAAS,MAAMC,QAAS,KAAA;AACxF,MAAGL,WAAWhB,KAAKa,SAASS,YAAAA,CAAAA,GAAe;AAC1C,WAAA,CAAQtB,KAAKuB,aAAa,UAAA;AAAA,EAC1B;AAED,SAAO;AACR;AAEA,SAASC,kBAAkBC,MAAAA;AAC1B,MAAIC,QAAQD,KAAKE,iBAAiB,CACjC,WACA,cACA,SACA,UACA,YACA,UACA,UACA,UACA,SACA,cACA,mBACCC,EAAAA,KAAK;AAEP,MAAIC,aAAaC,MAAMC,UAAUC,MAAMC,KAAKP,OAAO,CAAA;AAEnD,WAAQQ,IAAI,GAAGA,IAAIL,WAAWM,QAAQD,KAAI;AACzCL,eAAWK,GAAGE,YAAYF;AAAAA,EAI1B;AAGDL,aAAWQ,KAAK,SAAS1B,GAAG2B,GAC3B;AAAA,QAAG3B,EAAE4B,aAAa,KAAKD,EAAEC,aAAa,GAAE;AACvC,aAAO;AAAA,IACP;AACD,QAAG5B,EAAE4B,aAAa,KAAKD,EAAEC,aAAa,GAAE;AACvC,aAAQ;AAAA,IACR;AAED,QAAI5B,EAAE4B,aAAaD,EAAEC,UAAS;AAE7B,aAAO5B,EAAEyB,YAAYE,EAAEF;AAAAA,IACvB;AACD,QAAIzB,EAAE4B,WAAWD,EAAEC,UAAU;AAC5B,aAAA;AAAA,IACA;AACD,WAAO;AAAA,EACT,CAEC;AAAA,WAAQL,IAAI,GAAGA,IAAIL,WAAWM,QAAQD,KAAI;AACzC,QAAIlC,OAAO6B,WAAWK;AACtB,QAAIM,WAAWlC,uBAAuBN,IAAAA,KAAUe,UAAUf,IAAAA,KAASS,QAAQT,IAAUD,MAAAA,UAAUC;AAC/F,QAAIwC,CAAAA,SAAQ;AACXX,iBAAWY,OAAOP,GAAG,CAAA;AACrBA;AAAAA,IACA;AAAA,EACD;AACD,SAAOL;AACR;AAEA,SAASa,gBACR;AAAA,MAAIC,MAAMnE,SAASoE,cAAc,KACjCD;AAAAA,MAAIvC,MAAMyC,UAAQ;AAElBrE,WAASD,KAAKuE,YAAYH,GAC1B;AAAA,MAAI9C,QAAQ8C,IAAIxD,cAAYwD,IAAII;AAChCvE,WAASD,KAAKyE,YAAYL,GAE1B;AAAA,SAAOjD,KAAKuD,IAAIpD,OAAO,EAAA;AACxB;AAEA,SAASqD,aAAalD,MACrB;AAAA,MAAA,CAAIA,KAAM,QAAO;AAEjB,MAAImD,YAAYnD,KAAKmD,aAAa;AAClC,MAAGA,UAAUC,QACZD,aAAYA,UAAUC;AAEvB,MAAA,CAAID,UAAUE,QACbF,aAAY;AAEb,SAAOG,YAAYH;AACpB;AAEA,SAASI,aAAavD,MAAMmD,WAC3B;AAAA,MAAIA,aAAanD,KAAKmD,UAAUE,QAAQF,SAAgB,MAAA,IAAG;AAC1DnD,SAAKmD,aAAa,MAAMA;AAAAA,EACxB;AACF;AAEA,SAASK,gBAAgBxD,MAAMyD,MAC9BA;AAAAA,SAAOA,KAAKC,MAAM;AAClB,WAASxB,IAAI,GAAGA,IAAIuB,KAAKtB,QAAQD,KAAK;AACrC,QAAIyB,QAAQ,IAAIC,OAAO,YAAYH,KAAKvB,CAAK,IAAA,gBAAgB,EAC7DlC;AAAAA,SAAKmD,YAAYnD,KAAKmD,UAAUU,QAAQF,OAAO,EAAA;AAAA,EAC/C;AACF;AAEA,SAASG,SAASC,SAASZ,WAC1B;AAAA,MAAI,eAAeY,SAAS;AAC3B,WAAOA,QAAQC,UAAUC,SAASd,SACpC;AAAA,EAAA,OAAQ;AACN,WAAO,IAAIS,OAAO,QAAQT,YAAY,KAAA,EAAOe,KAAKH,QAAQZ,SAC1D;AAAA,EAAA;AACF;AAEA,SAASgB,OAAOnE,MACf;AAAA,MAAA,OAAWA,SAAS,UAAU;AAC7B,WAAQxB,SAAS4F,eAAepE,IAASxB,KAAAA,SAAS6F,cAAcrE,IAASxB,KAAAA,SAASD;AAAAA,EAClF;AACD,SAAOyB,QAAQxB,SAASD;AACzB;AAEA,IAAI+F;AACJ,SAASC,WAAWvE,MAAMwE,QAAAA;AACzB,MAAIF,CAAAA,QAAO;AACVA,aAAS9F,SAASoE,cAAc,KAAA;AAAA,EAChC;AACD0B,SAAOG,YAAYD;AACnB,MAAIE,QAAQJ,OAAOK;AACnB3E,OAAK8C,YAAY4B;AACjB,SAAOA;AACR;AAEA,SAASE,WAAW5E,MAAAA;AACnB,MAAIA,QAAQA,KAAKrB,YAAY;AAC5BqB,SAAKrB,WAAWqE,YAAYhD,IAC5B;AAAA,EAAA;AACF;AAEA,SAAS6E,cAAc7E,MAAM8E,KAC5B;AAAA,MAAIC,KAAK/E,KAAKgF;AACd,MAAIC,MAAMF,GAAG5C;AACb,MAAI+C,MAAM,CACV;AAAA,WAAShD,IAAI,GAAGA,IAAI+C,KAAK/C,KAAK;AAC7B,QAAIiD,MAAMJ,GAAG7C;AACb,QAAIiD,IAAIhC,aAAagC,IAAIhC,UAAUE,QAAQyB,GAAAA,MAAAA,IAAa;AACvDI,UAAIE,KAAKD,GAAAA;AAAAA,IACT;AAAA,EACD;AACD,SAAOD;AACR;AAEA,SAASG,cAAcC,GACtB;AAAA,MAAIC;AACJ,MAAID,EAAEE,QACLD,OAAMD;AAAAA,OACF;AACJA,QAAIA,KAAKzG,OAAO4G;AAChBF,UAAMD,EAAEI,UAAUJ,EAAEK;AACpB,QAAIJ,IAAIK,cAAcN,EAAEO,cAAc;AACrCN,YAAMD,EAAEO,aAAe,EAAA,CAAA;AAAA,IACvB;AAAA,EACD;AACD,SAAON;AACR;AAEA,SAASO,gBAAgBR,GAAGS;AAC3B,MAAIA,CAAAA,UAAW;AAEf,MAAIR,MAAMF,cAAcC;AAExB,SAAOC,KAAI;AACV,QAAIA,IAAI/E,cAAa;AACpB,UAAI0D,OAAOqB,IAAI/E,aAAauF,SAC5B;AAAA,UAAI7B,KAAM,QAAOqB;AAAAA,IACjB;AACDA,UAAIA,IAAI5G;AAAAA,EACR;AACD,SAAO;AACR;AAEA,SAAS2E,YAAY0C;AACpB,MAAIC,OAAOC,OAAOnE,UAAUoE,QAAQ,WAAA;AAAY,WAAOC,KAAKvC,QAAQ,cAAc,EAAA;AAAA,EAAI;AACtF,SAAOoC,KAAKI,MAAML,GAAAA;AACnB;AAEA,SAASM,gBAAgBhB,GAAGiB,WAAWC,QAAAA;AACtC,MAAIjB,MAAMF,cAAcC,CAAAA;AACxB,MAAIR,MAAM;AAEV,MAAG0B,WAAWC,OACbD,UAAS;AAEV,SAAOjB,KAAI;AACVT,UAAM5B,aAAaqC,GAAAA;AACnB,QAAGT,KAAI;AACN,UAAI4B,MAAM5B,IAAIzB,QAAQkD,SACtB;AAAA,UAAIG,OAAO,GAAE;AACZ,YAAA,CAAKF,OACJ,QAAOjB;AAGR,YAAIrH,OAAQwI,QAAQ,MAAQpD,YAAYwB,IAAI6B,OAAOD,MAAM,CACzD,CAAA;AAAA,YAAIvI,QAAUuI,MAAMH,UAAUpE,UAAU2C,IAAI3C,UAAAA,CAAcmB,YAAYwB,IAAI6B,OAAOD,MAAMH,UAAUpE,MAEjG,CAAA;AAAA,YAAIjE,QAAQC,MACX,QAAOoH;AAAAA,MACR;AAAA,IACD;AACDA,UAAIA,IAAI5G;AAAAA,EACR;AACD,SAAO;AACR;AAKA,SAASiI,yBAAyBC,IAAI7G,MAAAA;AACrC,MAAI8G,IAAItI,SAASE;AACjB,MAAIJ,MAAMP,gBAAgBiC,IAAAA;AAE1B,SAAO,EACNJ,GAAGiH,GAAGE,UAAUD,EAAE/H,aAAa+H,EAAE5H,aAAaZ,IAAIsB,IAAII,KAAKjB,YAC3DU,GAAGoH,GAAGG,UAAUF,EAAElI,YAAYkI,EAAE7H,YAAYX,IAAImB,IAAIO,KAAKpB,UAE3D;AAAA;AAEA,SAASqI,wBAAwBvC,OAAOwC,QAAAA;AACvC,QAAMC,WAAWpJ,gBAAgB2G,KACjC;AAAA,QAAM0C,YAAYrJ,gBAAgBmJ;AAClC,SAAO,EACNtH,GAAGuH,SAASvH,IAAIwH,UAAUxH,GAC1BH,GAAG0H,SAAS1H,IAAI2H,UAAU3H,EAAAA;AAE5B;AAEA,SAAS4H,UAAU3C,OAAOwC,QAAAA;AACzB,MAAIxC,CAAAA,SAAAA,CAAUwC,QAAO;AACpB,WAAO;AAAA,EACP;AAED,SAAMxC,SAASA,SAASwC,QAAQ;AAC/BxC,YAAQA,MAAM/F;AAAAA,EACd;AAED,SAAO+F,UAAUwC;AAClB;AAEA,SAASI,QAAQvD,SAASwD,UAAAA;AACzB,MAAGxD,QAAQuD,SAAQ;AAClB,WAAOvD,QAAQuD,QAAQC,QACzB;AAAA,EAAA,WAAUxD,QAAQyD,WAAWzD,QAAQ0D,qBAAqB1D,QAAQ2D,uBAAsB;AACtF,QAAIC,KAAK5D;AACT,QAAA,CAAKvF,SAASE,gBAAgBuF,SAAS0D,IAAK,QAAO;AACnD,OAAG;AACF,UAAIC,SAASD,GAAGH,WAAWG,GAAGF,qBAAqBE,GAAGD;AAEtD,UAAIE,OAAO3F,KAAK0F,IAAIJ,QAAAA,EAAW,QAAOI;AACtCA,WAAKA,GAAGE,iBAAiBF,GAAGhJ;AAAAA,IAC5B,SAAQgJ,OAAO,QAAQA,GAAGG,aAAa;AACxC,WAAO;AAAA,EACT,OAAM;AAEJC,YAAQC,MAAM,+BAAA;AACd,WAAO;AAAA,EACP;AACF;AAEA,SAASC,uBAAuBlE,SAAAA;AAC/B,SAAOA,SAAS;AACf,QAAIA,QAAQ5E,cAAc,KAAK4E,QAAQ3E,eAAe,GAAG;AACxD,aAAO2E;AAAAA,IACP;AACDA,cAAUA,QAAQ8D;AAAAA,EAClB;AACD,SAAO;AACR;AAEA,SAASK,uBACR;AAAA,SAAO1J,SAAS2J,KAAKC,oBAAoB5J,SAAS2J,KAAKE;AACxD;AAOA,SAASC,mBACR;AAAA,MAAIC,gBAAgB/J,SAAS+J;AAC7B,MAAIA,cAAc3C,YAAY;AAC7B2C,oBAAgBA,cAAc3C,WAAW2C;AAAAA,EACzC;AACD,MAAIA,kBAAkB/J,SAASD,QAAQC,SAASgK,cAAc;AAC7DD,oBAAgB/J,SAASgK,eAAeC,aAAajK,SAASD;AAAAA,EAC9D;AAED,SAAOgK;AACR;AAOA,SAASG,YAAY3E,SAAAA;AACpB,MAAKA,CAAAA,SAAS;AACb,WAAOvF,SAASD;AAAAA,EAChB;AACD,MAAK2J,CAAAA,qBAAAA,GAAwB;AAC5B,WAAO1J,SAASD;AAAAA,EAChB;AACD,SAAOwF,QAAQpF,eAAeoF,UAAUA,QAAQpF,aAAa;AAC5D,QAAIoF,mBAAmB4E,YAAY;AAClC,aAAO5E,QAAQ6E;AAAAA,IACf;AAAA,EACD;AACD,SAAOpK,SAASD;AACjB;AAEA,SAASsK,gBAAgB9E;AACxB,SAAS2E,CAAAA,CAAAA,YAAY3E,OACtB;AAAA;;ACnXA,IAAI+E;AACJ,IAAUjK,OAAAA,WAAW,aAAY;AAChCiK,gBAAcjK;AACf,OAAK;AACJiK,gBAAcC;AACf;AAGA,MAAAC,QAAeF;ACNR,IAAAG,kBAAA,MAAMC,cAMZ;AAAA,EAAA,YAAYC,QALZ/C;AAAAA,SAAQgD,aAAsB;AAM7BhD,SAAKiD,SAASF;AACT/C,SAAAkD,aAAaH,OAAMI,qBACzB;AAAA,EAAA;AAAA,EAEA,OAAOC,gBAAgCC,QAA4CC;AAClF,UAAMP,SAAQ/C,KAAKiD;AACb,UAAAM,UAAUH,eAAeI,YAC/BxD;AAAAA,SAAKyD,kBAAkBd,MAAO5I,iBAAiBwJ,SAAS1J;AACxDmG,SAAK0D,yBAAyB,MAAA;AACrBH,cAAAvJ,MAAM2J,WAAW3D,KAAKyD;AAAAA,IAAA;AAE3B,QAAAzD,KAAKyD,oBAAoB,UAAU;AACtCF,cAAQvJ,MAAM2J,WAAW;AAAA,IAC1B;AACA,UAAMC,QAAQb,OAAMc,UAAUC,WAAW,OAAA;AACnCF,UAAAG,iBAAiB,aAAa,MAC7B;AAAA,YAAAC,SAAS,EAAEC,YAAY,MACtB;AAAA,aAAAD;AAAAA,IAAA,CAIR;AAAA,QAAIE,0BAA0B;AAC9B,UAAMC,mBAAmB,MAAA;AACxB,UAAKD,CAAAA,yBAAyB;AAC7B;AAAA,MACD;AAEAlE,WAAKgD,aAAa;AAClBI,qBAAegB,SAASrB,OAAMsB,KAAKH,uBAAAA,CAAAA;AACnCd,qBAAekB,YAAYvB,OAAMsB,KAAKH,uBAAAA,CAAAA;AACtCd,qBAAemB,OAAOxB,OAAMsB,KAAKH;AACPA,gCAAA;AAAA,IAAA;AAG3BlE,SAAKkD,WAAWsB,OAAOjB,SAAS,aAAclE,CAAAA,WAAAA;AACnB6E,gCAAA;AAC1B,UAAIO,gBAAgB;AACpB,UAAInB,WAAsB,QAAA;AACzB,YAAIA,kBAAkB5H,OAAO;AACZ+I,0BAAAnB,OAAO9H,KAAK,IAAA;AAAA,QAAI,OAC1B;AACUiJ,0BAAAnB;AAAAA,QACjB;AAAA,MACD;AACA,UAAImB,eAAe;AAClB,YAAI1B,OAAM2B,MAAMC,IAAIzD,QAAQ7B,OAAMC,QAAQmF,aAAgB,GAAA;AACzD;AAAA,QACD;AAAA,MACD;AACMb,YAAAG,iBAAiB,aAAa,MAAA;AACnC,cAAMC,SAAS,EAAEC,YAAYjE,KAAKgD,WAC3B;AAAA,eAAAgB;AAAAA,MAAA,CAAA;AAGR,UAAIX,UAAUhE,OAAMgE,YAAY,MAAM;AAAE;AAAA,MAAQ;AACtBa,gCAAAlE,KAAK4E,gBAAgBvF,QAAO+D,cAAAA;AAAAA,IAAc;AAErE,UAAMyB,eAAeC,YAAuB/B,OAAMgC,KAAAA,KAAU3M,SAASD;AACrE6H,SAAKkD,WAAWsB,OAAOK,cAAc,WAAYxF,CAAAA;AACtB6E,gCAAA;AAC1B,UAAIb,UAAUhE,OAAMgE,YAAY,MAAM;AAAE;AAAA,MAAQ;AAC5C,UAAArD,KAAKgD,eAAe,MAAM;AAC7BhD,aAAKgD,aAAa;AAClB,cAAMgC,cAAchF,KAAK4E,gBAAgBvF,QAAO+D,cAAAA;AAChDA,uBAAe6B,QAAQD;MACxB;AAAA,IAEDhF,CAAAA;AAAAA,SAAKkD,WAAWsB,OAAOjB,SAAS,aAAclE,CAAAA,WAC7C;AAAA,UAAIgE,UAAUhE,OAAMgE,MAAY,MAAA,MAAM;AAAE;AAAA,MAAQ;AAG1C,YAAA6B,eAAelF,KAAKiD,OAAOkC,IAAIC;AACrC,YAAMC,sBAAsBrF,KAAKiD,OAAOqC,OAAOC,iBAAiB,CAAI,GAAAlC;AACpE,UAAI6B,gBAAgBG,oBAAoB;AACvC,YAAKhC,CAAAA,UAAUhE,OAAMgG,kBAAAA,GAAqB;AACzC;AAAA,QACD;AAAA,MACD;AACA,UAAIL,cAAc;AACf,WAAChF,KAAKgD,cAAckB,yBAAwB;AAChCc,sBAAAhF,KAAK4E,gBAAgBvF,QAAO+D,cAAAA;AACvC,YAAA9J,KAAKkM,IAAItB,wBAAwBuB,SAAS3N,OAAOkN,YAAYS,SAAS3N,IAAQ,IAAA,GAAE;AAEjEqM,2BAClB;AAAA,QAAA;AACA;AAAA,MACD;AACI,UAAAnE,KAAKgD,eAAe,MAAM;AACfgC,sBAAAhF,KAAK4E,gBAAgBvF,QAAO+D,cAC1CA;AAAAA,uBAAemB,OAAOS,WACtB5B;AAAAA,uBAAesC;MAChB;AAAA,IAEF,CAAA;AAAA,EAAA;AAAA,EAEA,SAAAC;AACC,UAAM5C,SAAQ/C,KAAKiD;AACnBjD,SAAKkD,WAAW0C,UAAAA;AAChB,QAAG5F,KAAK0D,wBAAuB;AAC9B1D,WAAK0D,uBACN;AAAA,IAAA;AAEA,UAAME,QAAQb,OAAMc,UAAUC,WAAW;AACzCF,UAAMiC,mBAAmB;EAC1B;AAAA,EAEA,aACC7F;AAAAA,SAAK2F,OACN;AAAA,EAAA;AAAA,EAEQ,gBAAgBtG,QAAmB+D,gBACpC;AAAA,UAAA0C,WAAW1C,eAAeI;AAC1B,UAAAuC,iBAAiBD,SAAS7N,sBAAAA;AAC1B,UAAA0I,EAAAA,SAAWC,QAAAA,IAAYvB;AAC7B,UAAM2E,SAAS,EACdgC,UAAU,EACTlO,MAAM6I,SACN9I,KAAK+I,QAAAA,GAEN6E,UAAU,EACT3N,MAAM6I,UAAUoF,eAAejO,OAAOgO,SAASnN,YAC/Cd,KAAK+I,UAAUmF,eAAelO,MAAMiO,SAAStN,UAAAA,EAAAA;AAGxC,WAAAwL;AAAAA,EACR;AAAA;ACxID,IAAIiC,YAAY,WAAA;AACfjG,OAAKkG,eAAe;AACpBlG,OAAKmG,YAAY;AAClB;AAEAF,UAAUtK,YAAY,EACrByK,cAAc,WAAA;AACbpG,OAAKkG,eAAe;AACpB,GACDG,YAAY,WACXrG;AAAAA,OAAKkG,eAAe;AACpB,EAAA;AAGF,IAAII,qBAAqB,SAASvH;AACjC,MAAIwH,WAAW,CAAA;AACf,MAAIC,QAAQ;AACZ,MAAIC,eAAe,WAClB;AAAA,QAAIC,iBAAiB;AACrB,aAAQ5K,KAAKyK,UAAS;AACrB,UAAII,gBAAgBJ,SAASzK,CAAGmE,EAAAA,MAAMlB,KAAK6H,SAC3CF;AAAAA,uBAAeA,kBAAkBC;AAAAA,IACjC;AACD,WAAOD;AAAAA,EACT;AACCD,eAAaI,WAAS,SAASC,SAASC,UACvC;AAAA,QAAA,OAAY,WAAY,YAAW;AAClC,UAAIC;AACJ,UAAGD,YAAYA,SAASE,IAAG;AAC1BD,oBAAYD,SAASE;AAAAA,MACzB,OAAQ;AACJD,oBAAYR;AACZA;AAAAA,MACA;AAED,UAAGO,YAAYA,SAASG,MAAK;AAC5B,YAAIC,kBAAkBL;AACtBA,kBAAU,WAAA;AACTK;AACAV,uBAAaW,YAAYJ,SAC9B;AAAA,QAAA;AAAA,MACI;AAEDT,eAASS,aAAaF;AACtB,aAAOE;AAAAA,IACP;AACD,WAAO;AAAA,EACT;AACCP,eAAaW,cAAY,SAASH,IAC1BV;AAAAA,WAAAA,SAASU;EAClB;AAECR,eAAaY,QAAQ,WACpBd;AAAAA,eAAW,CAAA;AAAA,EACb;AAEC,SAAOE;AACR;AAEA,SAASa,cAAcvI,KAEtB;AAAA,MAAIwI,YAAY,IAAItB;AACpBlH,MAAIyI,cAAY,SAASC,WAAWX,SAASC,UAC5CU;AAAAA,gBAAY,QAAMA,UAAUvM,YAAAA;AAC5B,QAAKqM,CAAAA,UAAUpB,UAAUsB,SAAAA,GAAW;AACnCF,gBAAUpB,UAAUsB,SAAanB,IAAAA,mBAAmBtG,IACpD;AAAA,IAAA;AAED,QAAG+G,YAAYA,SAASW,YAAW;AAClCZ,gBAAUA,QAAQa,KAAKZ,SAASW,UAChC;AAAA,IAAA;AAED,QAAIE,UAAUL,UAAUpB,UAAUsB,SAAAA,EAAWZ,SAASC,SAASC,QAE/D;AAAA,QAAIC,YAAaS,YAAU,MAAIG;AAC/B,QAAGb,YAAYA,SAASE,IAAG;AAC1BD,kBAAYD,SAASE;AAAAA,IACrB;AACD,WAAOD;AAAAA,EACT;AAECjI,MAAI8I,YAAY,SAASC,UAAAA;AACxB9H,SAAKwH,YAAY,cAAcM,QACjC;AAAA,EAAA;AAEC/I,MAAIgJ,YAAU,SAAS1K,MAAM2K,gBAAAA;AAC5B,QAAIT,UAAUrB,aAAc,QAAO;AAEnC,QAAI+B,cAAc,QAAM5K,KAAKnC,YAAAA;AAE7B,QAAIiL,YAAYoB,UAAUpB;AAC1B,QAAIA,UAAU,eAAA,GAAiB;AAC9BA,gBAAU,eAAA,EAAiBlG,MAAMD,MAAM,CAAC3C,MAAM6K,OAAOF,cAAAA,CAAAA;AAAAA,IACrD;AAED,QAAI7B,UAAU8B,WAAAA,EACb,QAAO9B,UAAU8B,WAAAA,EAAahI,MAAMD,MAAMgI,cAAAA;AAC3C,WAAO;AAAA,EACT;AAECjJ,MAAIoJ,aAAW,SAAS9K,MAAAA;AACvB,QAAI8I,YAAYoB,UAAUpB;AAC1B,WAAA,CAAA,CAAUA,UAAU,QAAM9I,KAAKnC,YACjC,CAAA;AAAA,EAAA;AAEC6D,MAAIqJ,cAAY,SAASnB,IAAAA;AACxB,QAAIA,IAAG;AACN,UAAId,YAAYoB,UAAUpB;AAC1B,eAAQrK,KAAKqK,WAAU;AACtBA,kBAAUrK,GAAGsL,YAAYH,EAAAA;AAAAA,MACzB;AAED,UAAIoB,OAAOpB,GAAG3J,MAAM,GAAA;AACpB,UAAI6I,YAAYoB,UAAUpB;AAC1B,UAAGkC,KAAKtM,WAAW,GAAE;AACpB,YAAI0L,YAAYY,KAAK,CAAA;AACrB,YAAIC,UAAUD,KAAK,CAAA;AACnB,YAAGlC,UAAUsB,SAAAA,GAAW;AACvBtB,oBAAUsB,SAAWL,EAAAA,YAAYkB;QACjC;AAAA,MACD;AAAA,IACD;AAAA,EACH;AACCvJ,MAAIwJ,kBAAkB;AACrB,aAASlL,QAAQkK,UAAUpB,WAAW;AACrCoB,gBAAUpB,UAAU9I,IAAMgK,EAAAA,MAAAA;AAAAA,IAC1B;AAAA,EACH;AAEA;ACjIA,IAAImB,QAAQ,EACXC,QAAU,GACVC,QAAU,IACVC,MAAQ,KAAK,IACbC,KAAO,KAAK,KAAK,IACjBC,MAAQ,KAAK,KAAK,KAAK,GACvBC,OAAS,KAAK,KAAK,KAAK,IACxBC,SAAW,KAAK,KAAK,KAAK,KAAK,GAC/BC,MAAQ,KAAK,KAAK,KAAK,IAAA;AAExB,SAASC,iBAAiBC,MACzB;AAAA,SAAOV,MAAMU,IAASV,KAAAA,MAAMG;AAC7B;AAEA,SAASQ,QAAQC,KAAKtB,UAAAA;AACrB,MAAIsB,IAAID,SAAS;AAChBC,QAAID,QAAQrB,QAAAA;AAAAA,EACd,OAAQ;AACN,QAAIuB,YAAYD,IAAIxN,MACpB;AAAA,aAASE,IAAI,GAAGA,IAAIuN,UAAUtN,QAAQD,KAAK;AAC1CgM,eAASuB,UAAUvN,IAAIA,CACvB;AAAA,IAAA;AAAA,EACD;AACF;AAEA,SAASwN,SAASF,KAAKtB,UACtB;AAAA,MAAIsB,IAAIG,KAAK;AACZ,WAAOH,IAAIG,IAAIzB,QAAAA;AAAAA,EACjB,OAAQ;AACN,QAAIuB,YAAYD,IAAIxN,MACpB;AAAA,QAAI4N,WAAW,CAEf;AAAA,aAAS1N,IAAI,GAAGA,IAAIuN,UAAUtN,QAAQD,KAAK;AAC1C0N,eAASxK,KAAK8I,SAASuB,UAAUvN,CAAAA,GAAIA;IACrC;AACD,WAAO0N;AAAAA,EACP;AACF;AAGA,SAASC,UAAUL,KAAKtB,UAAAA;AACvB,MAAIsB,IAAIM,MAAM;AACb,WAAON,IAAIM,KAAK5B,QAAAA;AAAAA,EAClB,OAAQ;AACN,aAAShM,IAAI,GAAGA,IAAIsN,IAAIrN,QAAQD,KAAK;AACpC,UAAIgM,SAASsB,IAAItN,CAAIA,GAAAA,CAAAA,GAAI;AACxB,eAAOsN,IAAItN;MACX;AAAA,IACD;AAAA,EACD;AACF;AAEA,SAAS6N,cAAcP,KAAKQ,MAC3B;AAAA,MAAGR,IAAIS,UAAS;AACf,WAAOT,IAAIS,SAASD;EACtB,OAAM;AACJ,aAAS9N,IAAI,GAAGA,IAAIsN,IAAIrN,QAAQD,KAAK;AACpC,UAAIsN,IAAItN,CAAO8N,MAAAA,MAAM;AACpB,eAAO;AAAA,MACP;AAAA,IACD;AACD,WAAO;AAAA,EACP;AACF;AAGA,SAASE,QAAQ/K;AAChB,MAAGrD,MAAMoO,SAAQ;AAChB,WAAOpO,MAAMoO,QAAQ/K,GACvB;AAAA,EAAA,OAAM;AAEJ,WAAQA,OAAOA,IAAIhD,WAAWsE,UAAatB,IAAIgL,OAAOhL,IAAIC;AAAAA,EAC1D;AACF;AAoBA,SAASgL,OAAOjL,KACf;AAAA,MAAIA,cAAcA,QAAQ,UAAU;AACnC,WAAA,CAAA,EAAUA,IAAIkL,eAAelL,IAAImL,YAAYnL,IAAIoL;AAAAA,EACnD,OAAQ;AACN,WAAO;AAAA,EACP;AACF;AAEA,SAASC,YAAYrL,KAAAA;AACpB,SAAOiL,OAAOjL,GAAAA,KAAAA,CAAS5E,MAAM4E,IAAIsL,QAClC,CAAA;AAAA;AA4DA,SAASC,MAAOxC,UAAUyC,SACzB;AAAA,MAAIC;AAEJ,MAAIxG,SAAS,WACZA;AAAAA,WAAOyG;AACPzG,WAAO0G,WAAW;AAClB,QAAIC,OAAOjP,MAAMC,UAAUC,MAAMC,KAAK+K;AACtC4D,YAAQI,WAAW,WAClB9C;AAAAA,eAAS7H,MAAMD,MAAM2K;AACrB3G,aAAO0G,WAAW;AAAA,IAClB,GAAEH,OACL;AAAA,EAAA;AAECvG,SAAO0G,WAAW;AAClB1G,SAAOyG,iBAAiB,WAAA;AACvBI,iBAAaL,KACbxG;AAAAA,WAAO0G,WAAW;AAAA,EACpB;AACC1G,SAAO8G,WAAW,WACjB;AAAA,QAAIH,OAAOjP,MAAMC,UAAUC,MAAMC,KAAK+K,SACtCkB;AAAAA,aAAS7H,MAAMD,MAAM2K,IACrB3G;AAAAA,WAAOyG;EACT;AAEC,SAAOzG;AACR;AA4BA,SAAS+G,YAAYhM,KACpB;AAAA,SAAOA,IAAIyI,eAAezI,IAAIqJ;AAC/B;AAGA,SAAS4C,mBAAmB/D,IAAIgE,QAC/B;AAAA,MAAIC,YAAYjE,EAAQiE,KAAAA,CAAAA,YAAYD,MAAQ,GAAA;AAC3ChE,SAAK;AAAA,EACL;AACD,SAAOA;AACR;AAEA,SAASiE,YAAYjE;AACpB,MAAIA,OAAO,GAAE;AACZ,WAAO;AAAA,EACP;AACD,SAAO;AACR;AAEA,SAASkE,WAAWC,OAAO9L;AAG1B,MAAI+L,MAAM,GAAGC,OAAOF,MAAMrP,SAAS,GAAGD,GAAG8N,MAAM2B;AAC/C,SAAOF,OAAOC,MAAM;AAEnBxP,QAAIxC,KAAKkS,OAAOH,MAAMC,QAAQ;AAC9B1B,WAAQwB,CAAAA,MAAMtP;AACdyP,WAAQH,CAAAA,MAAMtP,IAAI,CAClB;AAAA,QAAI8N,OAAOtK,QAAQ;AAClB+L,YAAMvP,IAAI;AACV;AAAA,IACA;AACD,QAAI8N,OAAOtK,QAAQ;AAClB,UAAA,EAAA,CAAOnF,MAAMoR,IAAAA,KAASA,OAAOjM,SAAS;AACrCgM,eAAOxP,IAAI;AACX;AAAA,MACJ,OAAU;AAEN,eAAOA,IAAI;AAAA,MACX;AAAA,IAED;AACD,WAAQsP,CAAAA,MAAMtP,OAAOsP,MAAMtP,IAAI,GAAIA;AAEnC,WAAOA;AAAAA,EACP;AACD,SAAOsP,MAAMrP,SAAS;AACvB;ACjPO,MAAM0P,eAeZ;AAAA,EAAA,YAAYnG,SAA+BvC,QAAY2I;AAZ/C1L,SAAA2L,MAAmBvT,SAASoE,cAAc,KAiDlCwD;AAAAA,SAAA4L,gBAAA,CAACC,OAAeC;AAC5B,UAAC9L,CAAAA,KAAK2L,KAAI;AACP3L,aAAA2L,MAAMvT,SAASoE,cAAc,KAAA;AAAA,MACnC;AACA,YAAM5C,OAAOoG,KAAK2L;AAGZ,YAAA9T,MAAMyB,KAAKyS,IAAIF,MAAMpG,SAAS5N,KAAKiU,IAAIrG,SAAS5N;AAChD,YAAAG,SAASsB,KAAKuD,IAAIgP,MAAMpG,SAAS5N,KAAKiU,IAAIrG,SAAS5N,GAAAA;AACnD,YAAAC,OAAOwB,KAAKyS,IAAIF,MAAMpG,SAAS3N,MAAMgU,IAAIrG,SAAS3N;AAClD,YAAAC,QAAQuB,KAAKuD,IAAIgP,MAAMpG,SAAS3N,MAAMgU,IAAIrG,SAAS3N;AAEzD,UAAIkI,KAAKgM,YAAY;AACpB,cAAMC,MAAMjM,KAAKkM,sBAAsBlM,KAAKmM,YAAY1G,SAAS5N,GAAAA;AAC5D+B,aAAAI,MAAMN,SAASuS,IAAIvS,SAAS;AAC5BE,aAAAI,MAAMnC,MAAMoU,IAAIpU,MAAM;AAAA,MAAA,OACrB;AACN+B,aAAKI,MAAMN,SAASJ,KAAKkM,IAAIxN,SAASH,GAAO,IAAA;AACxC+B,aAAAI,MAAMnC,MAAMA,MAAM;AAAA,MACxB;AACA+B,WAAKI,MAAMP,QAAQH,KAAKkM,IAAIzN,QAAQD,IAAAA,IAAQ;AACvC8B,WAAAI,MAAMlC,OAAOA,OAAO;AAClB,aAAA8B;AAAAA,IAAA;AA1DPoG,SAAKiD,SAASF;AACd/C,SAAKoM,QAAQV;AACb1L,SAAKqM,YAAY/G,QAAOQ;AACxB9F,SAAK2L,IAAI/N,UAAU0O,IAAIhH,QAAOvI,SAAAA;AAC1B,QAAOuI,OAAAA,QAAOwC,aAAa,YAAY;AAC1C9H,WAAKuM,YAAYjH,QAAOwC;AAAAA,IACzB;AAEA9H,SAAK0F,SAAS,MAAA;AACT,UAAA9L;AACJ,UAAG0L,QAAOI,QAAO;AAChB9L,eAAO0L,QAAOI,OAAO1F,KAAKmM,aAAanM,KAAKwM,SAAS;AAAA,MAAA,OACjD;AACJ5S,eAAOoG,KAAK4L,cAAc5L,KAAKmM,aAAanM,KAAKwM;MAClD;AAEG,UAAA5S,SAASoG,KAAK2L,KAAI;AACpB,YAAG3L,KAAK2L,OAAO3L,KAAK2L,IAAIpT,YAAW;AAClCyH,eAAK2L,IAAIpT,WAAWqE,YAAYoD,KAAK2L,GAAAA;AAAAA,QACtC;AACA3L,aAAK2L,MAAM/R;AAAAA,MACZ;AAEI,UAAA0L,QAAOvI,cAAc,IAAI;AAC5BiD,aAAK2L,IAAI/N,UAAU0O,IAAIhH,QAAOvI,SAC/B;AAAA,MAAA;AACAiD,WAAKyM,KAAK;AAAA,IAAA;AAGX,SAAK1B,YAAY/K,KAAKqM,YAAY;AACjCK,oBAAU1M,KAAKqM,SAAAA;AAAAA,IAChB;AACArM,SAAKgM,aAAa1G,QAAOqH;AACzB3M,SAAK4M,4BAA4BtH,QAAOuH;AAAAA,EACzC;AAAA,EA2BA,OACC;AAAA,QAAI7M,KAAK4M,2BAA2B;AACnC,aAAOE,sBAAsB,MAC5B9M;AAAAA,aAAKqM,UAAU3P,YAAYsD,KAAK+M,WAAY,CAAA;AAAA,MAAA,CAAA;AAAA,IAC5C,OACK;AACN/M,WAAKqM,UAAU3P,YAAYsD,KAAK+M,WAAAA,CAAAA;AAAAA,IACjC;AAAA,EACD;AAAA,EAEA;AACC,QAAI/M,KAAK4M,2BAA2B;AACnC,aAAOE,sBAAsB;AACxB,YAAC9M,CAAAA,KAAK2L,IAAIpT,YAAY;AACzB;AAAA,QACD;AACKyH,aAAAqM,UAAUzP,YAAYoD,KAAK2L,GAAG;AAAA,MAAA,CAAA;AAAA,IACnC,OACK;AACF,UAAA,CAAC3L,KAAK2L,IAAIpT,YAAY;AACzB;AAAA,MACD;AACKyH,WAAAqM,UAAUzP,YAAYoD,KAAK2L;IACjC;AAAA,EACD;AAAA,EAEA,aAAAoB;AACC,WAAO/M,KAAK2L;AAAAA,EACb;AAAA,EAEA,cACC;AAAA,WAAO3L,KAAKqM;AAAAA,EACb;AAAA,EAEA,SAASW;AACR,UAAMjK,SAAQ/C,KAAKiD;AACnBjD,SAAKmM,cAAca;AACnBhN,SAAKiN,aAAalK,OAAMmK,YAAYlN,KAAKmM,YAAY1G,SAAS3N,IAAAA;AAC9DkI,SAAKqM,UAAUtE,UAAU,gBAAgB,CAAC/H,KAAKmM,WAAAA,CAAAA;AAAAA,EAChD;AAAA,EAEA,OAAOgB;AACN,UAAMpK,SAAQ/C,KAAKiD;AACnBjD,SAAKwM,YAAYW;AACjB,QAAInN,KAAKgM,YAAY;AACpB,YAAMC,MAAMjM,KAAKkM,sBAAsBlM,KAAKmM,YAAY1G,SAAS5N,GAAAA;AAC5DmI,WAAAwM,UAAU/G,SAAS5N,MAAMoU,IAAIpU;AAAAA,IACnC;AACAmI,SAAKoN,WAAWrK,OAAMmK,YAAYlN,KAAKwM,UAAU/G,SAAS3N,IAAAA;AAC1D,QAAIkI,KAAKmM,YAAY1G,SAAS3N,OAAOkI,KAAKwM,UAAU/G,SAAS3N,MAAM;AAClEkI,WAAKqN,iBAAiB,EACrB5H,UAAU,EAAE3N,MAAMkI,KAAKwM,UAAU/G,SAAS3N,MAAMD,KAAKmI,KAAKqN,eAAe5H,SAAS5N,IAClFmO,GAAAA,UAAU,EAAElO,MAAMkI,KAAKwM,UAAUxG,SAASlO,MAAMD,KAAKmI,KAAKqN,eAAerH,SAASnO,IAEpF,EAAA;AAAA,IAAA;AACA,QAAImI,KAAKmM,YAAY1G,SAAS5N,MAAMmI,KAAKwM,UAAU/G,SAAS5N,KAAK;AAChEmI,WAAKqN,iBAAiB,EACrB5H,UAAU,EAAE3N,MAAMkI,KAAKqN,eAAe5H,SAAS3N,MAAMD,KAAKmI,KAAKwM,UAAU/G,SAAS5N,IAClFmO,GAAAA,UAAU,EAAElO,MAAMkI,KAAKqN,eAAerH,SAASlO,MAAMD,KAAKmI,KAAKwM,UAAUxG,SAASnO;IAEpF;AAGKmI,SAAAqM,UAAUtE,UAAU,UAAU,CAAC/H,KAAKmM,aAAanM,KAAKwM,SAC5D,CAAA;AAAA,EAAA;AAAA,EAEA,YAAYc;AACXtN,SAAKqN,iBAAiBC;AAAAA,EACvB;AAAA,EAEA,QAAQH;AACP,UAAMpK,SAAQ/C,KAAKiD;AAChB,QAAAkK,SAAS1H,SAAS3N,OAAO,GAAE;AAC7BqV,eAAS1H,SAAS3N,OAAO;AAAA,IAC1B;AACAkI,SAAKqM,UAAUtE,UAAU,mBAAmB,CAAC/H,KAAKmM,aAAagB,QAC/DnN,CAAAA;AAAAA,SAAKuE,OAAO4I,QAAAA;AAEZnN,SAAKoN,WAAWpN,KAAKoN,YAAYrK,OAAMwK,SAAAA,EAAWC;AAElD,QAAIxN,KAAKiN,WAAWQ,QAAAA,IAAYzN,KAAKoN,SAASK,WAAW;AACtDzN,OAAAA,KAAKiN,YAAYjN,KAAKoN,QAAa,IAAA,CAAEpN,KAAKoN,UAAUpN,KAAKiN,UAC5D;AAAA,IAAA;AACAjN,SAAKqH,MAAAA;AACL,UAAMqG,cAAc3K,OAAM4K,cAAc3N,KAAKiN,YAAYjN,KAAKoN,QACxD;AAAA,UAAAQ,eAAe5N,KAAK6N,eAAe7N,KAAKmM,YAAY1G,SAAS5N,KAAKmI,KAAKwM,UAAU/G,SAAS5N;AAE3FmI,SAAAqM,UAAUtE,UAAU,aAAa,CAAC/H,KAAKmM,aAAanM,KAAKwM,SAAAA,CAAAA;AAC9D,QAAIxM,KAAKuM,WAAW;AACdvM,WAAAuM,UAAUvM,KAAKmM,aAAanM,KAAKwM,WAAWxM,KAAKiN,YAAYjN,KAAKoN,UAAUM,aAAaE,YAC/F;AAAA,IAAA;AAAA,EACD;AAAA,EAEA,cAAAE;AACC,WAAO9N,KAAKgM;AAAAA,EACb;AAAA,EAEQ,eAAeH,OAAeC;AACrC,UAAM/I,SAAQ/C,KAAKiD;AACnB,QAAI8K,aAAalC;AACjB,QAAImC,WAAWlC;AACf,QAAID,QAAQC,KAAK;AACHiC,mBAAAjC;AACFkC,iBAAAnC;AAAAA,IACZ;AACA,UAAMoC,aAAajO,KAAKkM,sBAAsB6B,YAAYvH;AAC1D,UAAM0H,WAAWlO,KAAKkM,sBAAsB8B,UAAUxH;AACtD,UAAMxC,SAAS,CAAA;AACf,aAASlI,IAAImS,YAAYnS,KAAKoS,UAAUpS,KAAK;AACtC,YAAAqS,OAAOpL,OAAMqL,eAAetS,CAClC;AAAA,UAAIqS,MAAM;AACTnK,eAAOhF,KAAK+D,OAAMqL,eAAetS,CAClC,CAAA;AAAA,MAAA;AAAA,IACD;AACO,WAAAkI;AAAAA,EACR;AAAA,EAEQ,sBAAsBnM,KAAAA;AAC7B,UAAMkL,SAAQ/C,KAAKiD;AACnB,UAAMyI,OAAO1L,KAAKoM;AACZ,UAAA5F,QAAQkF,KAAK2C,0BAA0BxW,GAAAA;AACvC,UAAAsW,OAAOpL,OAAMqL,eAAe5H,KAClC;AAAA,QAAG2H,MAAK;AACP,YAAMzU,SAASgS,KAAK4C,cAAcH,KAAKlH;AACvC,YAAMsH,UAAU7C,KAAK8C,WAAWL,KAAKlH,EAAAA;AAC9B,aAAA,EACNpP,KAAK0W,WAAW,GAChB7U,QAAQA,UAAU,GAClB8M,MACD;AAAA,IAAA,OACM;AACA,YAAAiI,aAAa/C,KAAKgD,eACjB;AAAA,aAAA,EACN7W,KAAKA,MAAM4W,aAAaA,aAAa,GACrC/U,QAAQqJ,OAAMuC,OAAOqJ,YACrBnI,OAAO3O,MAAM4W,aAAa1L,OAAM6L,aAAiB,IAAA,EAAA;AAAA,IAEnD;AAAA,EACD;AAAA;AC1OD,SAAAC,WAAwB9L,QAAAA;AACnB,OAACA,OAAMoC,KAAK;AACfpC,IAAAA,OAAMoC,MAAM;EACb;AAEA,QAAM2J,gBAAuC,EAC5C/R,WAAW,yBACX8P,0BAA0B,MAC1B/E,UAAAA,QACA6E,WAAW,MAAA;AAGZ,WAASoC,eAAAA;AACR,UAAMzJ,UAAgC,EAAEQ,UAAU/C,OAAMiM,eAAeF,cACnE;AAAA,QAAA/L,OAAMoC,IAAIC,WAAU;AACjBrC,MAAAA,OAAAoC,IAAIC,UAAU6J;IACrB;AACAlM,IAAAA,OAAMoC,IAAIC,YAAY,IAAItC,gBAAcC,MAClC;AAAA,UAAAqC,YAAYrC,OAAMuC,OAAOuJ;AACxBvJ,IAAAA,QAAAI,SAASN,UAAUM,UAAUoJ,cAAcpJ;AAC3CJ,IAAAA,QAAAvI,YAAYqI,UAAUrI,aAAa+R,cAAc/R;AACjDuI,IAAAA,QAAAwC,WAAW1C,UAAU0C,YAAYgH,cAAchH;AAC/CxC,IAAAA,QAAAQ,WAAWV,UAAUU,YAAY/C,OAAMiM;AAC9C1J,IAAAA,QAAOuH,2BAA2BzH,UAAUyH,sCAC3CiC,cAAcjC,2BAA2BzH,UAAUyH;AAEpDvH,IAAAA,QAAOqH,YAAYvH,UAAUuH,cAA0B,SAAAmC,cAAcnC,YAAYvH,UAAUuH;AAC3F,UAAMuC,WAAWnM,OAAMoM,IAAIC,QAAQ,UACnC;AAAA,UAAMhM,iBAAiB,IAAIqI,eAAenG,SAAQvC,QAAOmM,QACzDnM;AAAAA,IAAAA,OAAMoC,IAAIC,UAAUZ,OAAOpB,gBAAgBgC,UAAU/B,QAAQ+B,UAAU9B,MAAAA;AAAAA,EACxE;AAEMP,EAAAA,OAAAyE,YAAY,gBAAgB,MAAA;AAC7B,QAAAzE,OAAMuC,OAAOuJ,YAAW;AACdE,mBACd;AAAA,IAAA;AAAA,EAAA,CAAA;AAGKhM,EAAAA,OAAAyE,YAAY,sBAAsB,WAAA;AACvC,QAAIzE,OAAMsM,cAActM,OAAMuC,OAAOuJ,YAAW;AACzC9L,MAAAA,OAAAyE,YAAY,iBAAiB,WAAA;AACrBuH,qBAAA;AAAA,MAAA,GACX,EAAC7H,MAAK,KAAA,CAAA;AAAA,IACV;AAAA,EAAA,CAGKnE;AAAAA,EAAAA,OAAAyE,YAAY,aAAa,MAAA;AAC1B,QAAAzE,OAAMoC,IAAIC,WAAU;AACjBrC,MAAAA,OAAAoC,IAAIC,UAAU6J,WACrB;AAAA,IAAA;AAAA,EAAA,CAAA;AAGF;AClDA,IAAIK,kBAA2B;AAExB,MAAMxM,eAiBZ;AAAA,EAAA,YAAYC,QAVZ/C;AAAAA,SAAQgD,aAAsB;AA4G9BhD,SAAQuP,4BAA4B;AACnC,YAAMC,aAAa;AAChB,UAAAxP,KAAKyP,OAAO1T,UAAUyT,YAAY;AACpC,cAAME,OAAO1P,KAAKyP,OAAO7T,MAAMoE,KAAKyP,OAAO1T,SAASyT,UAEpD;AAAA,cAAMG,UAAU,CAChB;AAAA,iBAAQ7T,IAAI,GAAGA,IAAI4T,KAAK3T,QAAQD,KAAK;AACpC6T,kBAAQ3Q,KAAK,EACZxF,GAAGkW,KAAK5T,CAAAA,EAAGtC,IAAIkW,KAAK5T,IAAI,GAAGtC,GAC3BH,GAAGqW,KAAK5T,CAAAA,EAAGzC,IAAIqW,KAAK5T,IAAI,CAAGzC,EAAAA,EAAAA,CAAAA;AAAAA,QAE7B;AACA,cAAMuW,eAAe,EAACpW,GAAE,GAAGH,GAAE,EAErBsW;AAAAA,gBAAAxG,QAAS0G,YAAAA;AAChBD,uBAAapW,KAAKqW,OAAOrW;AACzBoW,uBAAavW,KAAKwW,OAAOxW;AAAAA,QAAA,CAAA;AAGpB,cAAAyW,YAAYxW,KAAKyW,KAAKH,aAAapW,IAAEoW,aAAapW,IAAIoW,aAAavW,IAAEuW,aAAavW,CACxF;AAAA,cAAM2W,eAAe1W,KAAK2W,MAAM3W,KAAKkM,IAAIoK,aAAavW,CAAAA,GAAIC,KAAKkM,IAAIoK,aAAapW,MAAM,MAAMF,KAAK4W;AAE1F,eAAA,EACNJ,WACAE;MAGF;AACO,aAAA;AAAA,IAAA;AAGRhQ,SAAQmQ,uBAAuB;AAC9BnQ,WAAKoQ,UAAUC,MAAMzS,UAAU0O,IAAI,+BAAA;AAAA,IAA+B;AAGnEtM,SAAQsQ,uBAAuB;AAC9BtQ,WAAKoQ,UAAUC,MAAMzS,UAAU2S,OAAO,+BAA+B;AAAA,IAAA;AAG9DvQ,SAAAwQ,qBAAsBtB;AAC7B,YAAMnM,SAAQ/C,KAAKiD;AACZ,aAAA,EACNzJ,GAAGuJ,OAAMoM,IAAIC,QAAQF,SAASuB,QAAQC,OAAAA,EAASC,iBAAiBhN,UAChEtK,GAAG0J,OAAMoM,IAAIC,QAAQF,SAASuB,QAAQG,OAAAA,EAASD,eAAiBhN,EAAAA,SAAAA;AAAAA,IACjE;AAEO3D,SAAA6Q,0BAA2BC,YAC5B;AAAA,YAAAjB,SAAS7P,KAAKuP,0BACpB;AAAA,UAAIwB,SAAS/Q,KAAKmM,YAAY3S,IAAIsX,OAAOtX;AACzC,UAAIwX,SAAShR,KAAKmM,YAAY9S,IAAIyX,OAAOzX;AACzC,UAAGwW,QAAO;AACN,YAAAA,OAAOG,eAAe,IAAG;AAClBgB,mBAAA;AAAA,QAAA,WACAnB,OAAOG,eAAe,IAAG;AACzBe,mBAAA;AAAA,QACV;AAAA,MACD;AAEA,YAAM/M,SAAS,EACdxK,GAAGwG,KAAKiR,aAAazX,IAAIuX,QACzB1X,GAAG2G,KAAKiR,aAAa5X,IAAI2X,OAAAA;AAEnB,aAAAhN;AAAAA,IAAA;AAEAhE,SAAAkR,qBAAqB,CAAChC,UAAe4B;AAC5C,YAAM/N,SAAQ/C,KAAKiD;AACnB6J,4BAAsB,MAAA;AACrB/J,QAAAA,OAAMoO,iBAAiBjC,SAASkC,KAAKN,OAAOtX,GAAGsX,OAAOzX,CAAC;AAAA,MAAA,CAAA;AAAA,IACvD;AAEM2G,SAAAqR,YAAahS,CAAAA,WAAAA;AACpB,YAAM0D,SAAQ/C,KAAKiD;AACnBjD,WAAKyP,SAAS,CAAA;AACR1M,MAAAA,OAAAgC,MAAMnH,UAAU2S,OAAO,gBAAA;AAI1B,UAAAvQ,KAAKsR,8BAAgC;AACjCvO,QAAAA,OAAAuC,OAAOiM,WAAWvR,KAAKsR;AAC1B,YAAAtR,KAAKgD,cAAcD,OAAMuC,OAAOC,iBAAiBxC,OAAMuC,OAAOC,cAAcG,QAAO;AACrF3C,UAAAA,OAAM2C;QACP;AAAA,MACD;AAEG,UAAA1F,KAAKwR,sBAAgC,QAAA;AACjCzO,QAAAA,OAAAuC,OAAOrB,aAAajE,KAAKwR;AAAAA,MAChC;AAEG,UAAAzO,OAAMuC,OAAOC,eAAc;AAC7B,cAAA,EAAMlC,OAAaN,IAAAA,OAAMuC,OAAOC;AAChC,YAAIlC,UAAUhE,OAAMgE,MAAAA,MAAY,MAAM;AACrC;AAAA,QACD;AAAA,MACD;AAEArD,WAAKgD,aAAa;AACAsM,wBAAA;AAAA,IAAA;AAGXtP,SAAAyR,aAAcpS,CAAAA,WACrB;AAAA,YAAM0D,SAAQ/C,KAAKiD;AACdjD,WAAAwR,oBAAoBzO,OAAMuC,OAAOrB;AACtClB,MAAAA,OAAMuC,OAAOrB,aAAa;AACRqL,wBAAA;AAEZvM,MAAAA,OAAAgC,MAAMnH,UAAU0O,IAAI,gBAAA;AACrBtM,WAAAsR,oBAAoBvO,OAAMuC,OAAOiM;AACtCxO,MAAAA,OAAMuC,OAAOiM,WAAW;AAExB,UAAGxO,OAAMuC,OAAOC,iBAAiBxC,OAAMuC,OAAOC,cAAcG,QAAO;AAClE3C,QAAAA,OAAM2C,OACP;AAAA,MAAA;AAEA1F,WAAKyP,SAAS;AACdzP,WAAKgD,aAAa;AAClB,YAAMxJ,EAAAA,GAAKH,EAAAA,IAAM2G,KAAKwQ,mBAAmBxQ,KAAKoQ,SAAAA;AACzCpQ,WAAAiR,eAAe,EAAEzX,GAAGH,EAAAA;AACzB2G,WAAKmM,cAAc,EAAE3S,GAAG6F,OAAMsB,SAAStH,GAAGgG,OAAMuB,QAAAA;AAC3CZ,WAAAyP,OAAOzQ,KAAKgB,KAAKmM,WAAW;AAAA,IAAA;AAvNjCnM,SAAKiD,SAASF;AACT/C,SAAAkD,aAAaH,OAAMI,qBAAAA;AACxBnD,SAAKyP,SAAS,CAAA;AAAA,EACf;AAAA,EApBA,OAAOiC,OAAO3O;AACN,WAAA,IAAID,eAAcC,MAAAA;AAAAA,EAC1B;AAAA,EACA,OAAA;AACQ,WAAAuM;AAAAA,EACR;AAAA,EAiBA,aAAAL;AACCjP,SAAKkD,WAAW0C,UAAAA;AAAAA,EACjB;AAAA,EAEA,OAAOsJ,UAAAA;AACNlP,SAAKoQ,YAAYlB;AACjB,UAAMnM,SAAQ/C,KAAKiD;AACnBjD,SAAKkD,WAAWsB,OAAO0K,SAASmB,OAAO,aAAchR,CAAAA,WAAAA;AAChD,WAAC0D,OAAMuC,OAAOC,eAAe;AAChC;AAAA,MACD;AACA,YAAMlC,EAAAA,QAASC,QAAAqO,YAAoB5O,OAAMuC,OAAOC;AAChD,UAAGoM,YAAY,OAAO;AACrB;AAAA,MACD;AAEA,UAAIlN,gBAAgB;AACpB,UAAGnB,mBAAsB;AACxB,YAAGA,kBAAkB5H,OAAM;AACV+I,0BAAAnB,OAAO9H,KAAK,IAAA;AAAA,QAAI,OAC1B;AACUiJ,0BAAAnB;AAAAA,QACjB;AAAA,MACD;AACA,UAAImB,eAAe;AAClB,YAAI1B,OAAM2B,MAAMC,IAAIzD,QAAQ7B,OAAMC,QAAQmF,gBAAgB;AACzD;AAAA,QACD;AAAA,MACD;AACA,UAAIpB,UAAUhE,OAAMgE,MAAAA,MAAY,MAAM;AAAE;AAAA,MAAQ;AAEhDrD,WAAKyR,WAAWpS,MAAAA;AAAAA,IAAK;AAGtBW,SAAKkD,WAAWsB,OAAOpM,UAAU,WAAYiH,CAAAA,WACxC;AAAA,UAAA,CAAC0D,OAAMuC,OAAOC,eAAe;AAChC;AAAA,MACD;AACA,YAAMlC,EAAAA,WAAaN,OAAMuC,OAAOC;AAChC,UAAIlC,UAAUhE,OAAMgE,YAAY,MAAM;AACrCrD,aAAKmQ,qBAAAA;AAAAA,MACN;AAAA,IAEDnQ,CAAAA;AAAAA,SAAKkD,WAAWsB,OAAOpM,UAAU,SAAUiH,CAAAA,WAAAA;AACtC,UAAC0D,CAAAA,OAAMuC,OAAOC,eAAe;AAChC;AAAA,MACD;AACA,YAAA,EAAMlC,OAAaN,IAAAA,OAAMuC,OAAOC;AAChC,UAAIlC,UAAUhE,OAAMgE,MAAY,MAAA,OAAO;AACtCrD,aAAKsQ,qBAAAA;AACLtQ,aAAKqR,UAAUhS,MAAAA;AAAAA,MAChB;AAAA,IAGDW,CAAAA;AAAAA,SAAKkD,WAAWsB,OAAOpM,UAAU,WAAYiH,CAAAA,WAAAA;AAC5CW,WAAKqR,UAAUhS,MAAAA;AAAAA,IAAK;AAErBW,SAAKkD,WAAWsB,OAAOzB,OAAMgC,OAAO,WAAY1F,CAAAA;AAC/CW,WAAKqR,UAAUhS,MAAK;AAAA,IAAA,CAAA;AAErBW,SAAKkD,WAAWsB,OAAOpM,UAAU,cAAeiH,CAAAA,WAC/CW;AAAAA,WAAKqR,UAAUhS,MAAAA;AAAAA,IAAK;AAErBW,SAAKkD,WAAWsB,OAAOzB,OAAMgC,OAAO,cAAe1F,CAAAA,WAClDW;AAAAA,WAAKqR,UAAUhS,MAAAA;AAAAA,IAAK,CAGrBW;AAAAA,SAAKkD,WAAWsB,OAAOzB,OAAMgC,OAAO,aAAc1F,CAAAA,WAAAA;AAC7C,WAAC0D,OAAMuC,OAAOC,eAAe;AAChC;AAAA,MACD;AACA,cAAMlC,OAAEA,IAAWN,OAAMuC,OAAOC;AAChC,UAAIlC,UAAUhE,OAAMgE,MAAY,MAAA,MAAM;AAAE;AAAA,MAAQ;AAG1C,YAAA+B,YAAYpF,KAAKiD,OAAOkC,IAAIC;AAClC,YAAMwM,mBAAmB5R,KAAKiD,OAAOqC,OAAOuJ,cAAc,CAAI,GAAAxL;AAC9D,UAAI+B,aAAawM,iBAAiB;AACjC,aAAKvO,UAAUhE,OAAMuS,eAAkB,GAAA;AACtC;AAAA,QACD;AAAA,MACD;AACI,UAAA5R,KAAKgD,eAAe,MAAM;AACxBhD,aAAAyP,OAAOzQ,KAAK,EAAExF,GAAG6F,OAAMsB,SAAStH,GAAGgG,OAAMuB,QACxC,CAAA;AAAA,cAAAiR,iBAAyB7R,KAAK6Q,wBAAwB,EAAErX,GAAG6F,OAAMsB,SAAStH,GAAGgG,OAAMuB,QAAAA,CAAAA;AACpFZ,aAAAkR,mBAAmBhC,UAAU2C,cAClC7R;AAAAA,aAAKiR,eAAeY;AACpB7R,aAAKmM,cAAc,EAAE3S,GAAG6F,OAAMsB,SAAStH,GAAGgG,OAAMuB,QACjD;AAAA,MAAA;AAAA,IAAA,CAAA;AAAA,EAEF;;ACvHD,SAAA2E,cAAwBxC;AACnB,MAACA,CAAAA,OAAMoC,KAAI;AACdpC,IAAAA,OAAMoC,MAAM;EACb;AAEApC,EAAAA,OAAMoC,IAAID,eAAe,EACxBwM,QAAQ,MAAM5O,eAAc4O,OAAO3O,MACnC+O,GAAAA,mBAAmB,MAAMhP,eAAcgP,kBAAAA;AAGxC/O,EAAAA,OAAMuC,OAAOC,gBAAgB,EAC5BoM,SAAS,MACTjM,QAAQ,MAAA;AAEV;ACbA,SAAAqM,WAAwBhP,QAEjBA;AAAAA,EAAAA,OAAAoC,MAAMpC,OAAMoC,OAAO,CAAA;AAEzBpC,EAAAA,OAAMoC,IAAI4M,aAAahP,OAAMoC,IAAI4M,cAAc,EAE9CC,SAAS,mCAET,qBAAqB1M,SAAQ2M;AAC5B,QAAIC,mBAAuB;AACvB,QAAA5M,QAAOuG,SAASvG,QAAOwG,KAAI;AACXoG,yBAAA,EAClBC,YAAYpP,OAAMuC,OAAO6M,YACzBC,UAAUrP,OAAMuC,OAAO8M,SAAAA;AAElBrP,MAAAA,OAAAuC,OAAO6M,aAAapP,OAAMsP,KAAKC,YAAYvP,OAAMuC,OAAOiN,WAAAA,EAAajN,QAAOuG,KAC5E9I;AAAAA,MAAAA,OAAAuC,OAAO8M,WAAWrP,OAAMsP,KAAKC,YAAYvP,OAAMuC,OAAOiN,aAAajN,QAAOwG,GACjF;AAAA,IAAA;AAESxG,IAAAA,UAAAvC,OAAMyP,MAAMlN,SAAQ,EAC5BjI,MAAM,WAAW4U,MAAMQ,MAAM1P,OAAMoC,IAAI4M,WAAWW,eAAAA,EAAAA,CAAAA;AAGnD,QAAIR,kBAAiB;AACdnP,MAAAA,OAAAuC,OAAO6M,aAAaD,iBAAiBC;AACrCpP,MAAAA,OAAAuC,OAAO8M,WAAWF,iBAAiBE;AAAAA,IAC1C;AAAA,EACD,GAEA,kBAAkB9M,SAAQ2M;AACzB3M,IAAAA,UAASvC,OAAMyP,MAAOlN,WAAU,CAAA,GAAK,EACpCjI,MAAM,WAAW4U,MACjBQ,MAAM1P,OAAMoC,IAAI4M,WAAWY,cAC3BrN,GAAAA,QAAQvC,OAAMuC,OAEfvC,CAAAA;AAAAA,IAAAA,OAAMoC,IAAI4M,WAAWa,YAAYtN,QAAOA,OAAOuN,OACxC;AAAA,WAAAvN;AAAAA,EACR,GAEA,iBAAiBA,SAAQ2M,MAAAA;AACpB,QAAA3M,WAAUA,QAAOwN,KAAK;AACzB/P,MAAAA,OAAMoC,IAAI4M,WAAWgB,qBAAqBzN,SAAQ2M,IAAAA;AAAAA,IAAI,OAChD;AACN3M,MAAAA,UAASvC,OAAMoC,IAAI4M,WAAWiB,kBAAkB1N,SAAQ2M,IACzD;AAAA,IAAA;AACA3M,IAAAA,QAAO2N,UAAUlQ,OAAMkQ;AACvBlQ,IAAAA,OAAMoC,IAAI4M,WAAWmB,cAAc5N,SAAQ2M,IAAAA;AAAAA,EAC5C,GAEA,YAAY3M,SACXvC;AAAAA,IAAAA,OAAMoC,IAAI4M,WAAWoB,iBAAiB7N,SAAQ,KAAA;AAAA,EAC/C,GAEA,YAAYA,SAAAA;AACXvC,IAAAA,OAAMoC,IAAI4M,WAAWoB,iBAAiB7N,SAAQ,KAAA;AAAA,EAC/C,GAGA,aAAaA,SACZA;AAAAA,IAAAA,UAASvC,OAAMyP,MAAOlN,WAAU,CAAA,GAAK,EACpCjI,MAAM,cACNoV,MAAM1P,OAAMoC,IAAI4M,WAAWqB,gBAAAA,EAAkBX,MAC7CQ,SAASlQ,OAAMkQ,QAEhBlQ,CAAAA;AAAAA,IAAAA,OAAMoC,IAAI4M,WAAWmB,cAAc5N,SAAQ,MAC5C;AAAA,EAAA,GAEA,cAAcA,SACbA;AAAAA,IAAAA,UAASA,WAAU;AAEf,QAAA+N;AACA,QAAAC;AACA,QAAA1P;AACA,QAAA2P;AAEE,UAAAC,iBAAiBzQ,OAAMuC,OAAOmO;AAChC,QAAAnO,QAAOoO,WAAW,eAAc;AACnC3Q,MAAAA,OAAMuC,OAAOmO,kBAAkB;AAAA,IAChC;AAEI,QAAAnO,QAAOuG,SAASvG,QAAOwG,KAAK;AAC/BlI,cAAQb,OAAMwK;AACd+F,cAAQ,CAACvQ,OAAMuC,OAAO6M,YAAYpP,OAAMuC,OAAO8M,QAC/CmB;AAAAA,eAASxQ,OAAM4N,eACf;AAAA,YAAMgD,UAAU5Q,OAAMsP,KAAKC,YAAYvP,OAAMuC,OAAOiN,WAAAA;AACpDc,MAAAA,SAAQtQ,OAAM6Q;AAEd,UAAItO,QAAOuG,OAAM;AAChB9I,QAAAA,OAAMuC,OAAO6M,aAAawB,QAAQrO,QAAOuG,KAC1C;AAAA,MAAA;AACA,UAAIvG,QAAOwG,KAAI;AACd/I,QAAAA,OAAMuC,OAAO8M,WAAWuB,QAAQrO,QAAOwG,GACxC;AAAA,MAAA;AAEA/I,MAAAA,OAAM2C,OAAAA;AACN3C,MAAAA,OAAMuC,OAAOmO,kBAAkBD;AAEzBzQ,MAAAA,OAAA6Q,WAAW7Q,OAAMoC,IAAI4M,WAAW8B,eAAe9Q,OAAMuC,OAAO6M,YAAYpP,OAAMuC,OAAO8M,QAAAA;AAAAA,IAAQ,WACzF9M,QAAOoO,WAAW,eAAc;AAC1C3Q,MAAAA,OAAM2C,OAAAA;AACN3C,MAAAA,OAAMuC,OAAOmO,kBAAkBD;AAAAA,IAChC;AAEMzQ,IAAAA,OAAA+Q,sBAAsBxO,QAAOoO,WAAW;AAErCpO,IAAAA,UAAAvC,OAAMyP,MAAMlN,SAAQ,EAC5BjI,MAAM,cACN0W,OAAO,SACPtB,MAAM1P,OAAMoC,IAAI4M,WAAWiC,mBAAmB1O,OAAAA,EAAQmN,MACtDI,SAAS9P,OAAMoC,IAAI4M,WAAWkC,eAAe,EAAEC,UAAU,KAAA,CAAA,GACzDjB,SAASlQ,OAAMkQ;AAGhB,QAAI3N,QAAOoO,QAAO;AACjBpO,MAAAA,QAAO6O,SAASpR,OAAMoC,IAAI4M,WAAWqC,iBAAiB9O,OACvD;AAAA,IAAA;AAEAvC,IAAAA,OAAMoC,IAAI4M,WAAWmB,cAAc5N,SAAQ,OAEvC;AAAA,QAAAA,QAAOuG,SAASvG,QAAOwG,KAAK;AACzB/I,MAAAA,OAAAuC,OAAO6M,aAAavO,MAAMyQ;AAC1BtR,MAAAA,OAAAuC,OAAO8M,WAAWxO,MAAM4J;AAC9BzK,MAAAA,OAAM6Q,WAAWP;AAEjBtQ,MAAAA,OAAM2C,OAAAA;AACN3C,MAAAA,OAAMuR,SAASf,OAAO/Z,GAAG+Z,OAAOla,CAE1B0J;AAAAA,MAAAA,OAAAuC,OAAO6M,aAAamB,MAAM;AAC1BvQ,MAAAA,OAAAuC,OAAO8M,WAAWkB,MAAM,CAAA;AAAA,IAC/B;AAAA,EACD,GAEA,aAAahO;AACZA,IAAAA,UAASvC,OAAMyP,MAAOlN,WAAU,CAAA,GAAK,EACpCjI,MAAM,cACNoV,MAAM1P,OAAMoC,IAAI4M,WAAWY,cAC3BrN,GAAAA,QAAQvC,OAAMuC,QACduN,SAAS9P,OAAMoC,IAAI4M,WAAWkC,eAAAA,GAC9BM,UAAUxR,OAAMoC,IAAI4M,WAAWyC,wBAC/BvB,SAASlQ,OAAMkQ;AAEhBlQ,IAAAA,OAAMoC,IAAI4M,WAAWmB,cAAc5N,SAAQ,MAC5C;AAAA,EAAA,GAGA,gBAAgBA;AACX,QACH;AAAA,YAAMmP,WAAWnP,QAAOmN;AACxB,UAAIgC,oBAAoBC,MAAM;AACvB,cAAAjC,QAAO,IAAIkC;AACZlC,QAAAA,MAAAmC,OAAO,QAAQH,QACpBnP;AAAAA,QAAAA,QAAOmN,OAAOA;AAAAA,MACf;AAAA,aACQ7Q,OAAQ;AAAA,IAAA;AACXmB,IAAAA,OAAAoC,IAAI4M,WAAW8C,qBAAqBvP,OAAAA;AAAAA,EAC3C,GAEA,oBAAoBA,SACnB;AAAA,UAAMmP,WAAWnP,QAAOmN;AACpB,QAAA;AACH,UAAIgC,oBAAqBC,MAAM;AACxB,cAAAjC,QAAO,IAAIkC;AACZlC,QAAAA,MAAAmC,OAAO,QAAQH,QACpBnP;AAAAA,QAAAA,QAAOmN,OAAOA;AAAAA,MACf;AAAA,aACQ7Q,OAAAA;AAAAA,IAAQ;AACXmB,IAAAA,OAAAoC,IAAI4M,WAAW+C,mBAAmBxP,OACzC;AAAA,EAAA,GAEA,sBAAsBA,SAAAA;AACrBA,IAAAA,QAAO2M,OAAO;AACP,WAAAlP,OAAMgS,oBAAoBzP,OAClC;AAAA,EAAA,GAEA,kBAAkBA;AACjBA,IAAAA,UAASA,WAAU;AACnBA,IAAAA,QAAO0P,sBAAsB1P,QAAO0P,iCAAoC,OAAS1P,CAAAA,CAAAA,QAAO0P;AAElF,UAAAC,eAAelS,OAAMmS,UAAUC;AAC/B,UAAAC,gBAAgBrS,OAAMmS,UAAUG;AAChC,UAAAC,aAAavS,OAAMuC,OAAOiQ;AAC1B,UAAAC,gBAAgBzS,OAAMuC,OAAOiN;AAEnC,UAAMkD,0BAA0B;AAEhC1S,IAAAA,OAAMuC,OAAOiQ,WAAWE;AACxB1S,IAAAA,OAAMuC,OAAOiN,cAAckD;AAC3B1S,IAAAA,OAAMmS,UAAUC,aAAapS,OAAMsP,KAAKqD,YAAYD,uBACpD1S;AAAAA,IAAAA,OAAMmS,UAAUG,cAActS,OAAMsP,KAAKqD,YAAYD,uBACrD;AAAA,UAAMhD,QAAO1P,OAAMoC,IAAI4M,WAAWY,cAAAA;AAElC5P,IAAAA,OAAMoC,IAAI4M,WAAW4D,yBAAyBlD,OAAMnN,OAEpDvC;AAAAA,IAAAA,OAAMoC,IAAI4M,WAAW6D,sBAAsBnD,OAAMnN,OAEjD;AAAA,QAAIA,QAAO0P,qBAAqB;AACzBjS,MAAAA,OAAAoC,IAAI4M,WAAW8D,eAAepD;IACrC;AAEAnN,IAAAA,UAASvC,OAAMoC,IAAI4M,WAAW+D,cAAcrD,OAAMnN,OAElDvC;AAAAA,IAAAA,OAAMoC,IAAI4M,WAAWmB,cAAc5N,SAAQA,QAAO2M,QAAQ;AAC1DlP,IAAAA,OAAMuC,OAAOiQ,WAAWD;AACxBvS,IAAAA,OAAMuC,OAAOiN,cAAciD;AAC3BzS,IAAAA,OAAMmS,UAAUC,aAAaF;AAC7BlS,IAAAA,OAAMmS,UAAUG,cAAcD;AAE9BrS,IAAAA,OAAMuC,OAAOyQ,eAAe;AAC5BhT,IAAAA,OAAMuC,OAAO0Q,SAAS;AAAA,EACvB,GAEA,oBAAoB1Q,SACnBA;AAAAA,IAAAA,UAASA,WAAU;AACnBA,IAAAA,QAAO2M,OAAO;AACP,WAAAlP,OAAMkT,kBAAkB3Q,OAChC;AAAA,EAAA,GAEA,YAAYuN,SAAAA;AACX,aAAS/W,IAAI,GAAGA,IAAI+W,QAAQ9W,QAAQD,KAAK;AACxC+W,cAAQ/W,GAAGoa,QAAQrD,QAAQ/W,CAAGoa,EAAAA,SAASnT,OAAMoT,OAAOC,OAAO,YAAYvD,QAAQ/W,CAAGuB,EAAAA,IAAAA;AAClF,UAAWwV,OAAAA,QAAQ/W,GAAGrC,UAAU,UAAU;AACzCoZ,gBAAQ/W,CAAGrC,EAAAA,QAAQoZ,QAAQ/W,CAAGrC,EAAAA,QAAQ;AAAA,MACvC;AAAA,IACD;AAAA,EACD,GAEA,KAAK4c,KAAKC,MAAMC,IACfxT;AAAAA,IAAAA,OAAMyT,KAAKC,KAAKJ,KAAKC,MAAMC,EAC5B;AAAA,EAAA,GAEA,aAAaG,OAAAA;AACN,UAAA7D,UAAU6D,MAAKpR,OAAOuN;AAC5B,QAAIA,SAAQ;AACX,eAAS/W,IAAI,GAAGA,IAAI+W,QAAQ9W,QAAQD,KAAK;AACpC,YAAA+W,QAAQ/W,CAAAA,EAAG6a,UAAS;AACf9D,kBAAA/W,CAAAA,EAAG8a,YAAY;AAAA,QACxB;AAAA,MACD;AAAA,IACD;AAAA,EACD,GAGA,qBAAqBtR,SACpB;AAAA,UAAM+Q,MAAM/Q,QAAOuR,UAAU9T,OAAMoC,IAAI4M,WAAWC;AAC5C,UAAA8E,QAAQxR,QAAOwR,SAAS;AAC9B,UAAMrC,WAAWnP,QAAOmN;AACxB,UAAM3K,WAAWxC,QAAOwC;AAEf2M,aAAAG,OAAO,QAAQ,aAAA;AACfH,aAAAG,OAAO,QAAQmC,KAAKC,UAAU,EACtCC,OAAO3R,QAAO2R,SAAS,EAGxB,CAAA,CAAA;AAAA,QAAIH,OAAM;AACArC,eAAAG,OAAO,SAASkC,KAC1B;AAAA,IAAA;AAEM,UAAAI,MAAM,IAAIC;AACZD,QAAAE,qBAAqB,SAASlY,GACjC;AAAA,UAAIgY,IAAIG,eAAe,KAAKH,IAAII,WAAW,GAAG;AAC7C,YAAIxP,UAAU;AACbA,mBAAS,IACV;AAAA,QAAA;AAAA,MACD;AAAA,IAAA;AAGDoP,QAAIK,SAAS,WACN;AAAA,YAAAC,OAAON,IAAII,SAAS;AAC1B,UAAIG,OAAO;AAEX,WAAKD,MAAM;AACN;AACIC,iBAAAV,KAAKW,MAAMR,IAAIS,YAAAA;AAAAA,iBACdzY,GAAK;AAAA,QAAA;AAAA,MACf;AAEA,UAAI4I,UAAU;AACbA,iBAAS2P,IACV;AAAA,MAAA;AAAA,IAAA;AAGGP,QAAAU,KAAK,QAAQvB,KAAK,IAClBa;AAAAA,QAAAW,iBAAiB,oBAAoB,gBAAA;AACzCX,QAAIY,KAAKrD,QAAAA;AAAAA,EACV,GAGA,cAAchC,OAAMR,MAAMnK,UAClB2K;AAAAA,WAAAA,MAAK3K;AAEZ,UAAMuO,MAAM5D,MAAKoE,UAAU9T,OAAMoC,IAAI4M,WAAWC;AAC1C,UAAAsE,OAAO,UAAUrE,OAAO,mBAAmB8F,mBAAmBhB,KAAKC,UAAUvE,KAE7E,CAAA;AAAA,UAAA8D,KAAK,SAASyB,QAAAA;AACb,YAAAC,OAAOD,OAAOE,UAAUF;AACxB,YAAAR,OAAOS,KAAKX,SAAS;AAC3B,UAAIG,OAAO;AAEX,UAAA,CAAKD,MAAM;AACN,YACIC;AAAAA,iBAAAV,KAAKW,MAAMO,KAAKN;iBACfzY;QAAK;AAAA,MACf;AACA4I,eAAS2P,IAAAA;AAAAA,IAAI;AAGd1U,IAAAA,OAAMoC,IAAI4M,WAAWoG,KAAK9B,KAAKC,MAAMC,EAAAA;AAAAA,EACtC,GACA,yBAAyBjR,SACxB;AAAA,UAAMtB,SAASjB,OAAMyP,MAAM,IAAIlN;AAE/B,QAAItB,OAAO6O,SAAS;AACnB7O,aAAO6O,UAAU7O,OAAO6O,QAAQtJ,IAAI,SAAS6O,KAC5C;AAAA,cAAM/T,QAAOtB,OAAMyP,MAAM,IAAI4F,GACtB/T;AAAAA,eAAAA,MAAKgU;AACL,eAAAhU;AAAAA,MAAA,CAAA;AAAA,IAET;WAEOL,OAAOsU;AACP,WAAAtU;AAAAA,EACR,GAEA,cAAcyO,OAAMR,MACb;AAAA,UAAA0B,UAAU5Q,OAAMsP,KAAKqD,YAAY3S,OAAMuC,OAAOiN,eAAexP,OAAMuC,OAAOiQ;AAC7E,QAAC9C,CAAAA,MAAK8F,MAAK;AACb9F,MAAAA,MAAK8F,OAAOxV,OAAMwV;AAAAA,IACnB;AACA,QAAI9F,MAAKnN,QAAQ;AACXmN,MAAAA,MAAAnN,SAASvC,OAAMsB,KAAKtB,OAAMoC,IAAI4M,WAAWyG,yBAAyB/F,MAAKnN,MAC5EvC,CAAAA;AAAAA,MAAAA,OAAMoC,IAAI4M,WAAW0G,aAAahG,OAAMR,IAAAA;AAExC,UAAIQ,MAAKnN,OAAO6M,cAAcM,MAAKnN,OAAO8M,UAAU;AAC/C,YAAAK,MAAKnN,OAAO6M,sBAAsBuG,MAAM;AAC3CjG,UAAAA,MAAKnN,OAAO6M,aAAawB,QAAQlB,MAAKnN,OAAO6M;QAC9C;AACI,YAAAM,MAAKnN,OAAO8M,oBAAoBsG,MAAM;AACzCjG,UAAAA,MAAKnN,OAAO8M,WAAWuB,QAAQlB,MAAKnN,OAAO8M,QAC5C;AAAA,QAAA;AAAA,MACD;AAAA,IACD;AAEA,QAAIK,MAAK3K,UAAU;AAClB,aAAO/E,OAAMoC,IAAI4M,WAAW4G,cAAclG,OAAMR,MAAMQ,MAAK3K;IAC5D;AAEA,UAAM8Q,OAAO7V,OAAMoC,IAAI4M,WAAW8G;AAClCD,SAAKra,WAAWua,SAASrG,MAAKoE,UAAU9T,OAAMoC,IAAI4M,WAAWC;AAC7D4G,SAAKra,WAAWK,WAAW,GAAGma,QAAQhC,KAAKC,UAAUvE,KAAAA;AACrDmG,SAAKra,WAAWK,WAAW,CAAGma,EAAAA,QAAQ9G;AACtC2G,SAAKra,WAAWya,OAAAA;AAAAA,EACjB,GAEA,oBAAAH;AACC,SAAK9V,OAAMoC,IAAI4M,WAAWkH,qBAAqB;AAC9C,YAAMC,KAAInW,OAAMoC,IAAI4M,WAAWkH,sBAAsB7gB,SAASoE,cAAc,KAAA;AAC5E0c,MAAAA,GAAElf,MAAMH,UAAU;AAClBqf,MAAAA,GAAE7a,YAAY;AACLjG,eAAAD,KAAKuE,YAAYwc,EAC3B;AAAA,IAAA;AACO,WAAAnW,OAAMoC,IAAI4M,WAAWkH;AAAAA,EAC7B,GAGA,gBAAgBla,KACf;AAAA,UAAMsF,QAAO,EACZ8N,YAAAA,QACAC,UAAU,QACV+G,yBACAC,UAAAA,OAED;AAAA,eAAWC,OAAOta,KAAK;AACtB,UAAIsa,IAAI9Y,OAAO,CAAA,MAAO,OAAO8Y,QAAQ,aAAY;AAChD;AAAA,MACD;AACKhV,MAAAA,MAAAgV,OAAOta,IAAIsa,GAAAA;AAAAA,IACjB;AACA,UAAMC,aAAavW,OAAMmS,UAAUC,cAAcpS,OAAMmS,UAAUG;AAE5DhR,IAAAA,MAAA8N,aAAamH,WAAWjV,MAAK8N,UAAAA;AAClC,QAAI9N,MAAK+N,UAAS;AACZ/N,MAAAA,MAAA+N,WAAWkH,WAAWjV,MAAK+N,QACjC;AAAA,IAAA;AACA,QAAI/N,MAAK8U,iBAAgB;AACnB9U,MAAAA,MAAA8U,kBAAkBG,WAAWjV,MAAK8U,eACxC;AAAA,IAAA;AACA,QAAI9U,MAAK+U,UAAS;AACZ/U,MAAAA,MAAA+U,WAAWE,WAAWjV,MAAK+U,QACjC;AAAA,IAAA;AAEO,WAAA/U;AAAAA,EACR,GAGAkV,YAAY,MACZC,aAAa,CAAC,GAEd,WAAW9a,KACV;AAAA,QAAA,CAAKqE,OAAMoC,IAAI4M,WAAWwH,YAAY;AACrCxW,MAAAA,OAAMoC,IAAI4M,WAAWwH,aAAanhB,SAASoE,cAAc,KAAA;AACzDuG,MAAAA,OAAMoC,IAAI4M,WAAWwH,WAAWvf,MAAMyC,UAAU;AAChDrE,eAASD,KAAKuE,YAAYqG,OAAMoC,IAAI4M,WAAWwH;IAChD;AACA,QAAIxW,OAAMoC,IAAI4M,WAAWyH,YAAY9a,GAAAA,GAAK;AACzC,aAAOqE,OAAMoC,IAAI4M,WAAWyH,YAAY9a,GACzC;AAAA,IAAA;AAEMqE,IAAAA,OAAAoC,IAAI4M,WAAWwH,WAAWxc,YAAY2B;AACtC,UAAA+a,QAAQ1W,OAAMoC,IAAI4M,WAAW2H,UAAU3W,OAAMoC,IAAI4M,WAAWwH,YAAY,OAAA;AACxE,UAAAI,kBAAkB5W,OAAMoC,IAAI4M,WAAW2H,UAAU3W,OAAMoC,IAAI4M,WAAWwH,YAAY;AACxF,WAAQxW,OAAMoC,IAAI4M,WAAWyH,YAAY9a,GAAAA,IAAO+a,QAAQ,MAAME;AAAAA,EAC/D,GAGA,4BAA4BC;AAC3B,UAAMC,UAAc,CACPD;AAAAA,iBAAAzQ,QAAQ,SAAS2Q;AACrBD,cAAA7a,KAAK8a,MAAMC,WACXF;AAAAA,cAAA7a,KAAK8a,MAAME,SAAAA;AAAAA,IAAS,CAEtB;AAAA,WAAAH;AAAAA,EACR,GAEA,uBAEC;AAAA,UAAMI,mBAAmB,EACxBC,OAAO,CAAC,GAAG,EACXL,GAAAA,SAAS,MACTvG,OAAO,EAAE,GAAG,MAAM,GAAG,MAAM,GAAG,MAAM,GAAG,MAAM,GAAG,MAAM,GAAG,MAAM,GAAG,KAAA,EAAA;AAG/D,QAAA6G;AACA,QAAA,CAACpX,OAAMuC,OAAO8U,WAAW;AACrBD,aAAAF;AAAAA,IAAA,OACD;AACN,YAAMI,QAAQtX,OAAMuX;AAChB,UAAAD,SAASA,MAAME,cAAc;AAChCJ,eAAOE,MAAME;iBACHF,OAAO;AACVF,eAAA,EACND,OAAOG,MAAMH,OACbL,SAAS,MACTvG,OAAO+G,MAAM/G,MACd;AAAA,MAAA,WACUvQ,OAAMuC,OAAOkV,aAAazX,OAAMuC,OAAOkV,UAAU7X,QAAQ;AAC7D,cAAAoE,WAAWhE,OAAMuC,OAAOkV,UAAU7X;AAExC,YAAIoE,SAAS0T,QAAQ;AACpB,gBAAMZ,UAAU9W,OAAMoC,IAAI4M,WAAW2I,4BAA4B3T,SAAS0T,OAAOP,KAC1EC;AAAAA,iBAAA,EACND,OAAO,MACPL,SACAvG,OAAO,CAAC;AAEE,qBAAAxX,KAAKiL,SAAS0T,OAAOnH,OAAO;AACtC,gBAAI5X,MAAMoO,QAAQ/C,SAAS0T,OAAOnH,MAAMxX,KAAK;AACvCqe,mBAAA7G,MAAMxX,CAAAA,IAAKiH,OAAMoC,IAAI4M,WAAW2I,4BAA4B3T,SAAS0T,OAAOnH,MAAMxX,CAAAA,CAAAA;AAAAA,YAAE,OACnF;AACNqe,mBAAK7G,MAAMxX,CAAAA,IAAKiL,SAAS0T,OAAOnH,MAAMxX,CACvC;AAAA,YAAA;AAAA,UACD;AAAA,QAAA,OACM;AACCqe,iBAAA,EACND,OAAOnT,SAASmT,OAChBL,SAAS,MACTvG,OAAOvM,SAASuM,MAAAA;AAAAA,QAElB;AAAA,MAAA,OAEM;AACC6G,eAAAF;AAAAA,MACR;AAAA,IACD;AAEO,WAAAE;AAAAA,EACR,GAGA,eAAetO,OAAOC,KACd;AAAA,WAAA,SAAS6O,MAAM7Z,QAAQ8Z,QACpB9Z;AAAAA,eAAAA,UAAUiC,OAAMuC,OAAOuV;AAChCD,eAASA,UAAU7X;AAEb,YAAA+X,SAAS/X,OAAMgY,YAAYja,MACjC;AAAA,UAAIga,QAAO;AACV,iBAAShf,IAAI,GAAGA,IAAIgf,OAAO/e,QAAQD,KAAK;AACvC,gBAAM8N,OAAO7G,OAAMiY,MAAMF,OAAOhf,CAAAA,CAAAA;AAC3B,gBAAC+P,SAASjC,KAAKwI,WAAWvG,WAAYC,CAAAA,OAAOlC,KAAKuI,aAAarG,MAAK;AACnE6O,iBAAA9e,KAAK+e,QAAQhR;UACnB;AAEA,cAAI7G,OAAMkY,SAASrR,KAAK3C,EAAAA,GAAI;AAC3BlE,YAAAA,OAAM6Q,SAAS+G,MAAM/Q,KAAK3C,IAAI2T,MAAAA;AAAAA,UAC/B;AAAA,QACD;AAAA,MACD;AAAA,IAAA;AAAA,EAEF,GAIAM,qBAAqBnY,OAAMoY,KAAKC,aAGhC,iBAAiBrc,KACV;AAAA,UAAAsc,OAAOtY,OAAMmS,UAAUoG,UAAUvc,IAAIoT,YAAYpT,IAAIqT,UAAUrT,GAAAA;AAErE,UAAMsF,QAAOtB,OAAMoC,IAAI4M,WAAWwJ,gBAAgBxc,GAAAA;AAC7CsF,IAAAA,MAAAgX,OAAOA,QAAQhX,MAAKgX;AAElB,WAAAhX;AAAAA,EACR,GAEA,UAAUzK,MAAMI,OACT;AAAA,UAAA+e,QAAQnf,KAAKK,eAAeL,KAAKK,aAAaD,KAASD,IAAAA,iBAAiBH,MAAM,IAAA,EAAMI,KAC1F;AAAA,UAAMwhB,MAAMzC,MAAMtb,QAAQ,OAAO,EAAIge,EAAAA,MAAM;AAClC,YAAAD,OAAOA,IAAIzf,WAAW,KAC7B,MAAM9C,SAASuiB,IAAI,CAAA,GAAI,EAAIE,EAAAA,SAAS,EAAK9f,GAAAA,MAAAA,OACzC,MAAM3C,SAASuiB,IAAI,CAAA,GAAI,EAAIE,EAAAA,SAAS,KAAK9f,MAAM,EAAA,KAC/C,MAAM3C,SAASuiB,IAAI,IAAI,EAAIE,EAAAA,SAAS,EAAK9f,GAAAA,MAAAA,EAAYmd,IAAAA,OAAOtb,QAAQ,KAAK,EAAA;AAAA,EAC5E,GAIA,iBAAiBsB,KAAAA;AAGhB,UAAM4c,cAAc5Y,OAAMsP,KAAKqD,YAAY,wBAErC;AAAA,UAAArR,QAAOtB,OAAMoC,IAAI4M,WAAW6J,mBAAmB7c,KAAKgE,OAAMoC,IAAI4M,WAAW8J,iBAAiB9c,GAAAA,CAAAA;AAChG,QAAIsF,MAAK8N,YAAW;AACd9N,MAAAA,MAAA8N,aAAawJ,YAAY5c,IAAIoT;IACnC;AACA,QAAI9N,MAAK+N,UAAS;AACZ/N,MAAAA,MAAA+N,WAAWuJ,YAAY5c,IAAIqT;IACjC;AAGA,UAAM0J,cAAc/Y,OAAMgZ,qBAAqBhZ,OAAMgZ,qBAAqBhZ,OAAMiZ;AAEhF3X,IAAAA,MAAK4X,SAASH,YAAYjgB,KAAKkH,QAAOhE,IAAIoT,UAAAA;AAC1C9N,IAAAA,MAAK6X,OAAOJ,YAAYjgB,KAAKkH,QAAOhE,IAAIqT,QAAAA;AAGxC,QAAI+J,cAAc;AACZ,UAAAC,kBAAkBrZ,OAAMsZ,WAAW5iB;AACzC,QAAI2iB,gBAAgBnf,QAAQ,CAAS,IAAA,IAAA;AACpC,UAAInB,IAAI;AACR,WAAKA,GAAGA,IAAIuI,MAAK4X,QAAQngB,KAAK;AACzB,YAACsgB,CAAAA,gBAAgBtgB,IAAI;AACxBqgB;AAAAA,QACD;AAAA,MACD;AACA9X,MAAAA,MAAK4X,UAAUE;AAEf,WAAKrgB,GAAGA,IAAIuI,MAAK6X,MAAMpgB,KAAK;AACvB,YAAA,CAACsgB,gBAAgBtgB,CAAAA,GAAI;AACxBqgB;AAAAA,QACD;AAAA,MACD;AACA9X,MAAAA,MAAK6X,QAAQC;AAAAA,IACd;AAEA9X,IAAAA,MAAKiY,SAASvd,IAAIud;AAClBjY,IAAAA,MAAKkY,QAAQxd,IAAIyd;AAEjB,UAAMC,OAAO1Z,OAAMmS;AACnB7Q,IAAAA,MAAKqY,QAAQD,KAAKnB,UAAUvc,IAAI8M,OAAO9M,IAAIqT,UAAUrT;AAChDsF,IAAAA,MAAAsY,QAAQF,KAAKG,gBAAgBH,KAAKG,cAAc7d,IAAI8M,OAAO9M,IAAIqT,UAAUrT,GAAO,IAAA;AAChFsF,IAAAA,MAAAwY,SAASJ,KAAKK,iBAAiBL,KAAKK,eAAe/d,IAAI8M,OAAO9M,IAAIqT,UAAUrT,GAAO,IAAA;AAEjF,WAAAsF;AAAAA,EACR,GAEA,kBAAkBtF,KACjB;AAAA,UAAMsF,QAAOtB,OAAMoC,IAAI4M,WAAWgL,iBAAiBhe;AAEnD,UAAMnF,OAAOmJ,OAAMia,YAAYje,IAAIkI,EAC/B;AAAA,QAAArN,QAAQA,KAAK2E,YAAY;AACxB,UAAAkb,QAAQ1W,OAAMoC,IAAI4M,WAAW2H,UAAW3W,OAAM+Q,sBAAsBla,OAAOA,KAAK2E,YAAa,iBAAA;AACjG,UAAIkb,UAAU,UAAS;AACtBA,gBAAQ1W,OAAMoC,IAAI4M,WAAW2H,UAAU9f,MAAM,iBAAA;AAAA,MAC9C;AAEAyK,MAAAA,MAAK4Y,SAASxD;AAAAA,IAAA,WACJ1a,IAAI0a,OAAM;AACpBpV,MAAAA,MAAK4Y,SAASle,IAAI0a;AAAAA,IACnB;AAEO,WAAApV;AAAAA,EACR,GAEA,mBAAmBtF,KAAKsF,OACvB;AAAA,aAASvI,IAAI,GAAGA,IAAIiH,OAAMuC,OAAOuN,QAAQ9W,QAAQD,KAAK;AACrD,YAAMohB,KAAKna,OAAMuC,OAAOuN,QAAQ/W,CAAAA,EAAG6a;AACnC,UAAIuG,IAAI;AACH,YAAAC,MAAMD,GAAGne;AACb,YAAIoe,eAAezE,MAAK;AACvByE,gBAAMpa,OAAMmS,UAAUkI,UAAUD,KAAKpe;QACtC;AACKsF,QAAAA,MAAA,MAAMvI,CAAAA,IAAKqhB;AAAAA,MACjB;AAAA,IACD;AACO,WAAA9Y;AAAAA,EACR,GAEA,eAAetF,KAAAA;AACd,UAAMsF,QAAOtB,OAAMoC,IAAI4M,WAAWwJ,gBAAgBxc;AAElD,UAAMmW,aAAY,CACjB,iBACA,kBACA,aACA,iBACA,YAID;AAAA,aAASpZ,IAAI,GAAGA,IAAIoZ,WAAUnZ,QAAQD,KAAK;AAC1C,YAAM6a,WAAW5T,OAAMmS,UAAUA,WAAUpZ,CAAAA,CAAAA;AAC3C,UAAI6a,UAAS;AACPtS,QAAAA,MAAA,MAAMvI,CAAAA,IAAK6a,SAAS5X,IAAIoT,YAAYpT,IAAIqT,UAAUrT,GACxD;AAAA,MAAA;AAAA,IACD;AAEAgE,IAAAA,OAAMoC,IAAI4M,WAAW6J,mBAAmB7c,KAAKsF,KAAAA;AAC7CA,IAAAA,MAAKuT,OAAO7Y,IAAIse;AACT,WAAAhZ;AAAAA,EACR,GAGA,iBACO;AAAA,UAAAiZ,cAAcva,OAAMuC,OAAOiY;AAC3B,UAAA/J,iBAAiBzQ,OAAMuC,OAAOmO;AACpC,QAAI6J,eAAe9J,gBAAgB;AAClCzQ,MAAAA,OAAMuC,OAAOmO,kBAAkB;AAC/B1Q,MAAAA,OAAMuC,OAAOiY,eAAe;AAC5Bxa,MAAAA,OAAM2C,OAAAA;AAAAA,IACP;AAEM,UAAA8X,OAAOza,OAAMsM,WAAW9W,WAAW8F;AAEzC,QAAIif,eAAe9J,gBAAgB;AAClCzQ,MAAAA,OAAMuC,OAAOiY,eAAeD;AAC5Bva,MAAAA,OAAMuC,OAAOmO,kBAAkBD;AAC/BzQ,MAAAA,OAAM2C,OACP;AAAA,IAAA;AAEO,WAAA8X;AAAAA,EACR,GAEA,gBAAA7K;AACC5P,IAAAA,OAAMoY,KAAKC,cAAcrY,OAAMoC,IAAI4M,WAAW0L;AAC9C,UAAMhL,QAAO1P,OAAMoC,IAAI4M,WAAW2L,iBAAAA;AAClC3a,IAAAA,OAAMoY,KAAKC,cAAcrY,OAAMoC,IAAI4M,WAAWmJ;AACvC,WAAAzI;AAAAA,EACR,GAEA;AACO,UAAAwC,eAAelS,OAAMmS,UAAUC;AAC/B,UAAAC,gBAAgBrS,OAAMmS,UAAUG;AACtCtS,IAAAA,OAAMmS,UAAUC,aAAapS,OAAMsP,KAAKqD,YAAY,iBAAiB,IACrE3S;AAAAA,IAAAA,OAAMmS,UAAUG,cAActS,OAAMsP,KAAKqD,YAAY,iBAAiB,IAAA;AACtE3S,IAAAA,OAAMoY,KAAKC,cAAcrY,OAAMoC,IAAI4M,WAAW8J;AAE9C,UAAMpJ,QAAO1P,OAAMoC,IAAI4M,WAAW2L,iBAAAA;AAElC3a,IAAAA,OAAMmS,UAAUC,aAAaF;AAC7BlS,IAAAA,OAAMmS,UAAUG,cAAcD;AAC9BrS,IAAAA,OAAMoY,KAAKC,cAAcrY,OAAMoC,IAAI4M,WAAWmJ;AAEvCzI,WAAAA,MAAKkL;AACL,WAAAlL;AAAAA,EACR,GAEA,UAAAmL;AAEC,QAAI7a,OAAM8a,gBAAgB;AACnB,YAAA1J,SAASpR,OAAM+a,YACf;AAAA,YAAAC,WAAWhb,OAAMuC,OAAO0Y;AAC9B,YAAMC,mBAAmBlb,OAAMmb,oBAAsB1kB,EAAAA,IAAIF,KAAKuD,IAAIkG,OAAMuC,OAAO6Y,oBAAoB,CAAA,IAAKpb,OAAMuC,OAAO+K,MAAMtX;AAC3H,YAAMW,SAASqJ,OAAMuC,OAAOA,OAAO8Y,eAAe;AAClD,aAAOrb,OAAM8a,eAAeQ,eAAelK,QAAQ4J,UAAUE,kBAAkBvkB,MAAM;AAAA,IAAA,OAC/E;AACN,YAAMwV,WAAWnM,OAAMoM,IAAIC,QAAQ;AACnC,UAAIF,UAAU;AACT,YAAAoP,aAAapP,SAASuB,QAAQhX;AAClC,YAAIsJ,OAAMuC,OAAOiZ,aAAa,OAAOxb,OAAMuC,OAAOiZ,aAAa,MAAM;AACpED,uBAAahlB,KAAKuD,IAAIkG,OAAMuC,OAAO6Y,oBAAoB,CACxD;AAAA,QAAA;AACM,cAAAva,QAAQb,OAAMwK,SACd;AAAA,cAAA4G,SAASjF,SAASsP;AAClB,cAAAT,WAAWhb,OAAMuC,OAAO0Y;AACxB,cAAAtkB,SAASqJ,OAAMuC,OAAO8Y,eAAe;AACrC,cAAAK,MAAM1b,OAAMuC,OAAOmZ;AAClB,eAAAvP,SAASwP,aAAaL,eAAelK,QAAQ4J,UAAUO,YAAY5kB,QAAQkK,MAAMyQ,UAAUzQ,MAAM4J,UAAUiR,GACnH;AAAA,MAAA;AAAA,IACD;AAAA,EACD,GAEA,mBAAmBnZ,SAAAA;AACZvC,IAAAA,OAAAoY,KAAKC,cAAc9V,QAAOoO,SAAS3Q,OAAMoC,IAAI4M,WAAW4M,oBAAoB5b,OAAMoC,IAAI4M,WAAWgL;AACvG,UAAMtK,QAAO1P,OAAMoC,IAAI4M,WAAW2L,iBAClC3a;AAAAA,IAAAA,OAAMoY,KAAKC,cAAcrY,OAAMoC,IAAI4M,WAAWmJ;AAEvCzI,WAAAA,MAAKkL;AAEZ,QAAIrY,QAAOsZ,YAAY;AACtB,YAAMlgB,MAAMqE,OAAMmS,UAAU2J,uBAAuB9b,OAAMmS,UAAU4J;AACnE,UAAIpgB,KAAK;AACR,cAAMoU,MAAM/P,OAAMoC,IAAI4M,WAAW6L,QAAAA;AAC7B,YAAAmB,QAAQjM,IAAI,CAAGkM,EAAAA;AACnB,iBAASljB,IAAI,GAAGA,IAAIgX,IAAI/W,QAAQD,KAAI;AACnC,cAAIgX,IAAIhX,CAAGkjB,EAAAA,QAAQjjB,SAASgjB,MAAMhjB,QAAO;AAChCgjB,oBAAAjM,IAAIhX,CAAAA,EAAGkjB;AAAAA,UAChB;AAAA,QACD;AAEA,iBAASljB,IAAI,GAAGA,IAAI2W,MAAKA,KAAK1W,QAAQD,KAAK;AAC1C2W,UAAAA,MAAKA,KAAK3W,CAAAA,EAAGmjB,SAAS,CACtB;AAAA,gBAAM9Q,OAAOpL,OAAMmc,QAAQzM,MAAKA,KAAK3W,CAAGmL,EAAAA,EAAAA;AACxC,mBAASkY,IAAI,GAAGA,IAAIJ,MAAMhjB,QAAQojB,KAAK;AAChC,kBAAA9M,QAAO0M,MAAMI,CACb;AAAA,kBAAAC,UAAU1gB,IAAIyP,MAAMkE;AAC1B,gBAAI+M,SAAQ;AACX3M,cAAAA,MAAKA,KAAK3W,CAAAA,EAAGmjB,OAAOjgB,KAAK,EAAEwH,OAAO2Y,GAAGF,QAAQlc,OAAMoC,IAAI4M,WAAWsN,WAAWD,OAC9E,EAAA,CAAA;AAAA,YAAA;AAAA,UACD;AAAA,QACD;AAAA,MACD;AAAA,IACD;AACO,WAAA3M;AAAAA,EACR,GAEA,iBAAiBnN,SAChB;AAAA,UAAM6O,SAAa,CAAA;AACnB,UAAMrB,MAAM/P,OAAMoC,IAAI4M,WAAW6L,QAEjC;AAAA,QAAI7R,MAAMuT;AACV,QAAIziB,MAAM;AACV,aAASf,IAAI,GAAGA,IAAIgX,IAAI/W,QAAQD,KAAK;AACpCiQ,YAAMzS,KAAKyS,IAAIA,KAAK+G,IAAIhX,CAAAA,EAAGyjB,SAC5B;AAAA,IAAA;AAEA,aAASzjB,IAAI,GAAGA,IAAIgX,IAAI/W,QAAQD,KAAK;AACpC,UAAI+P,QAAQ;AACZ,UAAIC,MAAM;AACV,YAAM0T,MAAU,CAEhBrL;AAAAA,aAAOnV,KAAKwgB,GACN;AAAA,YAAAC,OAAO3M,IAAIhX,CACjBe;AAAAA,YAAMvD,KAAKuD,IAAIA,KAAK4iB,KAAKT,QAAQjjB,MACjC;AAAA,YAAM4a,WAAW8I,KAAKC,UAAUD,KAAK9I,aAAa8I,KAAKpN,OAAOtP,OAAMsP,KAAKqD,YAAY+J,KAAKpN,IAAQtP,IAAAA,OAAMuC,OAAOqa;AAE/G,eAASR,IAAI,GAAGA,IAAIM,KAAKT,QAAQjjB,QAAQojB,KAAK;AACvC,cAAA9M,QAAOoN,KAAKT,QAAQG,CAAAA;AAC1BrT,cAAMD,QAAQvS,KAAKC,MAAMkmB,KAAKhmB,MAAM0lB,CAAAA,IAAKpT;AAEnC,cAAA6T,YAAY,EAAEvE,MAAM1E,SAAStE,KAAOxG,GAAAA,OAAOC,KAAKmT,QAAQ;AAE9D,YAAI3Z,QAAOsZ,YAAY;AACtB,gBAAMlgB,MAAM+gB,KAAK/gB,OAAOqE,OAAMmS,UAAU2K;AACxC,cAAInhB,KAAK;AACF,kBAAAohB,WAAWphB,IAAI2T,KACrB;AAAA,gBAAIyN,UAAS;AACZF,wBAAUX,SAASlc,OAAMoC,IAAI4M,WAAWsN,WAAWS,QACpD;AAAA,YAAA;AAAA,UACD;AAAA,QACD;AAEAN,YAAIxgB,KAAK4gB,SACD/T;AAAAA,gBAAAC;AAAAA,MACT;AAAA,IACD;AAEA,WAAO,EAAErS,OAAOoD,KAAKnD,QAAQya,OAAOpY,QAAQ0W,MAAM0B,OACnD;AAAA,EAAA,GAEA,eAAe7O,SACdvC;AAAAA,IAAAA,OAAMgd,aAAa;AAEnB,UAAMlN,UAAc,CAAA;AACd,UAAAmN,OAAOjd,OAAMuC,OAAOuN;AAE1B,QAAIoN,SAAS;AACb,aAASnkB,IAAI,GAAGA,IAAIkkB,KAAKjkB,QAAQD,KAAK;AACjC,UAAAkkB,KAAKlkB,CAAAA,EAAGuB,SAAS,SAAS2iB,KAAKlkB,CAAGuB,EAAAA,SAAS,WAAW;AACzD;AAAA,MACD;AAEAwV,cAAQoN,MAAAA,IAAU,EACjBhZ,IAAM+Y,KAAKlkB,CAAAA,EAAG6a,WAAa,MAAM7a,IAAKkkB,KAAKlkB,CAAGuB,EAAAA,MAC9C6iB,QAAQF,KAAKlkB,CAAAA,EAAGoa,SAASnT,OAAMoT,OAAOC,OAAO,YAAY4J,KAAKlkB,CAAAA,EAAGuB,IACjE5D,GAAAA,OAAQumB,KAAKlkB,CAAAA,EAAGrC,QAAQH,KAAKkS,MAAMwU,KAAKlkB,CAAAA,EAAGrC,QAAQ,CAAA,IAAK,IACxD0mB,MAAMH,KAAKlkB,GAAGqkB,QAAQ,MAAA;AAGvB,UAAIH,KAAKlkB,CAAAA,EAAGuB,SAAS,YAAW;AACvBwV,gBAAAoN,QAAQhO,OAAO;AAAA,MACxB;AACI,UAAA+N,KAAKlkB,GAAGuB,SAAS,gBAAgB2iB,KAAKlkB,CAAAA,EAAGuB,SAAS,YAAY;AACzDwV,gBAAAoN,MAAAA,EAAQhO,OAAO;AACnB,YAAA3M,WAAUA,QAAO4O,UAAS;AAC7BrB,kBAAQoN,MAAQhZ,EAAAA,KAAK+Y,KAAKlkB,CAAGuB,EAAAA;AAAAA,QAC9B;AAAA,MACD;AAEA4iB;AAAAA,IACD;AAEAld,IAAAA,OAAMgd,aAAa;AACZ,WAAAlN;AAAAA,EACR,GAEA;AACC9P,IAAAA,OAAMgd,aAAa;AAEb,UAAAK,YAAYrd,OAAMmS,UAAUC;AAC5B,UAAAmE,aAAavW,OAAMmS,UAAUG;AAInCtS,IAAAA,OAAMmS,UAAUC,aACfpS,OAAMmS,UAAUG,cAChBtS,OAAMsP,KAAKqD,YAAY3S,OAAMuC,OAAOiN,eAAexP,OAAMuC,OAAOiQ,QAE3D;AAAA,UAAA9C,QAAO1P,OAAMsd,UAAAA;AAEnBtd,IAAAA,OAAMmS,UAAUC,aAAaiL;AAC7Brd,IAAAA,OAAMmS,UAAUG,cAAciE;AAC9BvW,IAAAA,OAAMgd,aAAa;AACZ,WAAAtN;AAAAA,EACR,GAGA,UAAUA,OAAAA;AACT,aAAS3W,IAAI,GAAGA,IAAI2W,MAAK1W,QAAQD,KAAK;AAErC,UAAI2W,MAAK3W,CAAGgF,EAAAA,UAAU,GAAG;AACnB2R,QAAAA,MAAA3W,CAAAA,EAAGwkB,OAAO;AAAA,MAChB;AACA,eAASnB,IAAIrjB,IAAI,GAAGqjB,IAAI1M,MAAK1W,QAAQojB,KAAK;AAEzC,YAAI1M,MAAK3W,CAAAA,EAAGmL,MAAMwL,MAAK0M,CAAAA,EAAGre,QAAQ;AACjC2R,UAAAA,MAAK0M,CAAGmB,EAAAA,OAAO7N,MAAK3W,CAAAA,EAAGwkB,OAAO;AAAA,QAC/B;AAAA,MACD;AAAA,IACD;AAAA,EACD,GAEA,YAAY7N,OACX;AAAA,aAAS3W,IAAI,GAAGA,IAAI2W,MAAK1W,QAAQD,KAAK;aAC9B2W,MAAK3W,CAAAA,EAAGwkB;AAAAA,IAChB;AAAA,EACD,GAEA,eAAe7N,OACd1P;AAAAA,IAAAA,OAAMoC,IAAI4M,WAAWwO,UAAU9N,MAAKA,IAAAA;AACpC,UAAMY,SAAQ,CAAA;AACd,aAASvX,IAAI,GAAGA,IAAI2W,MAAKA,KAAK1W,QAAQD,KAAK;AACpCuX,MAAAA,OAAAZ,MAAKA,KAAK3W,CAAAA,EAAGmL,EAAMwL,IAAAA,MAAKA,KAAK3W,CAAAA;AAAAA,IACpC;AAEA,UAAM6hB,QAAQ,CAAA;AAEd,aAAS7hB,IAAI,GAAGA,IAAI2W,MAAKkL,MAAM5hB,QAAQD,KAAK;AACrC,YAAA0kB,OAAO/N,MAAKkL,MAAM7hB,CAAAA;AACxB,UAAIiH,OAAM0d,aAAaD,KAAKE,MAAAA,KAAW3d,OAAM0d,aAAaD,KAAKlhB,MAC9D+T,KAAAA,OAAMmN,KAAKE,MAAWrN,KAAAA,OAAMmN,KAAKlhB,MAAS,GAAA;AACpCqe,cAAA6C,KAAKvZ,EAAMuZ,IAAAA;AAAAA,MAClB;AAAA,IACD;AAEA,eAAWrB,KAAKxB,OAAO;AACtB5a,MAAAA,OAAMoC,IAAI4M,WAAW4O,oBAAoBhD,MAAMwB,CAAAA,GAAI9L;IACpD;AAEA,UAAMuN,eAAe,CAAA;AACrB,eAAWzB,KAAK9L,QAAO;AAChBtQ,MAAAA,OAAAoC,IAAI4M,WAAW8O,uBAAuBxN,OAAM8L,CAAAA,GAAIxB,OAAOtK,QAAO,CAAA,GAAIuN,cAAc,IAAA;AAAA,IACvF;AAEI,QAAAE,OAAOC,KAAKpD,QAAQ;AACvB5a,MAAAA,OAAMoC,IAAI4M,WAAWiP,qBAAqBrD,OAAOtK;IAClD;AAEA,aAASvX,IAAI,GAAGA,IAAI2W,MAAKkL,MAAM5hB,QAAQD,KAAK;AAC3C,UAAA,CAAK6hB,MAAMlL,MAAKkL,MAAM7hB,CAAGmL,EAAAA,EAAAA,GAAK;AACxBwL,QAAAA,MAAAkL,MAAMthB,OAAOP,GAAG,CACrBA;AAAAA;AAAAA,MACD;AAAA,IACD;AAEAiH,IAAAA,OAAMoC,IAAI4M,WAAWkP,YAAYxO,MAAKA,IACvC;AAAA,EAAA,GAEA,uBAAuBtE,MAAMwP,OAAOtK,QAAO6N,WAAWN,cAAcO,UACnE;AAAA,UAAMC,UAAUjT,KAAKkT;AACrB,QAAA,CAAKD,SAAS;AACb;AAAA,IACD;AAEI,QAAAF,UAAU/S,KAAKlH,EAAK,GAAA;AACvBlE,MAAAA,OAAMoC,IAAI4M,WAAWuP,sBAAsBH,UAAUxD,OAAOuD,WAAWN;IACxE;AAEUM,cAAA/S,KAAKlH,EAAM,IAAA;AAErB,UAAMsa,UAAU,CAAA;AAEhB,aAASzlB,IAAI,GAAGA,IAAIslB,QAAQrlB,QAAQD,KAAK;AACxC,UAAI8kB,aAAaQ,QAAQtlB,CAAK,CAAA,GAAA;AAC7B;AAAA,MACD;AACA,YAAM0lB,UAAU7D,MAAMyD,QAAQtlB;AACxB,YAAA2lB,aAAapO,OAAMmO,QAAQje,OAC7B;AAAA,UAAAge,QAAQE,WAAWxa,EAAAA,GAAK;AAC3BlE,QAAAA,OAAMoC,IAAI4M,WAAWuP,sBAAsBE,SAAS7D,OAAOuD,WAAWN,YACvE;AAAA,MAAA;AACQW,cAAAE,WAAWxa,EAAAA,IAAM;AACnBlE,MAAAA,OAAAoC,IAAI4M,WAAW8O,uBAAuBY,YAAY9D,OAAOtK,QAAO6N,WAAWN,cAAcY;IAChG;AACUN,cAAA/S,KAAKlH,EAAAA,IAAM;AAAA,EACtB,GAEA,sBAAsBuZ,MAAM7C,OAAOuD,WAAWN,cAC7C;AAAA,QAAIJ,MAAM;AACL,UAAAzd,OAAMgF,UAAU,8BAA8B,CAACyY,KAAKvZ,IAAIuZ,IAAQ,CAAA,GAAA;AAAA,eAC5D7C,MAAM6C,KAAKvZ;MACnB;AAEOia,aAAAA,UAAUV,KAAKkB,OACfR;AAAAA,aAAAA,UAAUV,KAAKjd,OACTqd;AAAAA,mBAAAJ,KAAKvZ,EAAAA,IAAM;AAAA,IACzB;AAAA,EACD,GAEA,oBAAoBuZ,MAAMnN,QACrB;AAAA,QAAAlF;AACA,QAAAwT;AACJ,UAAMC,QAAQ,EACbtiB,QAAQ+T,OAAMmN,KAAKlhB,MAAAA,GACnBohB,QAAQrN,OAAMmN,KAAKE,MAAAA,EAAAA;AAGpB,QAAIkB,MAAMtiB,OAAOghB,QAAQsB,MAAMlB,OAAOJ,MAAM;AAC3C,UAAIsB,MAAMtiB,OAAOghB,OAAOsB,MAAMlB,OAAOJ,MAAM;AACnCnS,eAAA;AACPwT,oBAAYC,MAAMtiB,OAAOghB;AAAAA,MAAA,OACnB;AACCnS,eAAA;AACPwT,oBAAYC,MAAMlB,OAAOJ;AAAAA,MAC1B;AAEG,SAAA;AACF,cAAMxf,SAASuS,OAAMuO,MAAMzT,MAAMrN,MACjC;AAAA,YAAA,CAAKA,QAAQ;AACZ;AAAA,QACD;AACA8gB,cAAMzT,IAAQrN,IAAAA;AAAAA,MACN,SAAA8gB,MAAMzT,IAAAA,EAAMmS,OAAOqB;AAE5B,UAAIE,eAAexO,OAAMuO,MAAMlB,OAAO5f,MACtC;AAAA,UAAIghB,eAAezO,OAAMuO,MAAMtiB,OAAOwB,MAAAA;AAEtC,aAAO+gB,gBAAgBC,gBAAgBD,aAAa5a,MAAM6a,aAAa7a,IAAI;AAC1E2a,cAAMlB,SAASmB;AACfD,cAAMtiB,SAASwiB;AACAD,uBAAAxO,OAAMuO,MAAMlB,OAAO5f,MAAAA;AACnBghB,uBAAAzO,OAAMuO,MAAMtiB,OAAOwB;MACnC;AAAA,IACD;AAEK0f,SAAAjd,UAAUqe,MAAMtiB,OAAO2H;AACvBuZ,SAAAkB,UAAUE,MAAMlB,OAAOzZ;AAExB,SAAC2a,MAAMtiB,OAAOyiB,UAAS;AACpBH,YAAAtiB,OAAOyiB,WAAW,CACzB;AAAA,IAAA;AACAH,UAAMtiB,OAAOyiB,SAAS/iB,KAAKwhB,KAAKvZ,EAE5B;AAAA,QAAA,CAAC2a,MAAMlB,OAAOW,UAAS;AACpBO,YAAAlB,OAAOW,WAAW,CAAA;AAAA,IACzB;AACAO,UAAMlB,OAAOW,SAASriB,KAAKwhB,KAAKvZ,EACjC;AAAA,EAAA,GAEA,qBAAqB0W,OAAOtK,QAC3B;AAAA,eAAWmN,QAAQ7C,OAAO;AAClBA,aAAAA,MAAM6C,MAAMjd;AACZoa,aAAAA,MAAM6C,MAAMkB;AAAAA,IACpB;AAEA,eAAWvT,QAAQkF,QAAO;aAClBA,OAAMlF,IAAAA,EAAMkT;AACZhO,aAAAA,OAAMlF,IAAM4T,EAAAA;AAAAA,IACpB;AAAA,EACD,GAGA,yBAAyBtP,OAAMnN,SAC1B;AAAA,QAAAA,WAAUA,QAAO0c,SAAS;AAClB,iBAAAlmB,KAAKwJ,QAAO0c,SAAS;AAC3B,YAAA,CAACjf,OAAMuC,OAAOyQ,cAAa;AACxBhT,UAAAA,OAAAuC,OAAOyQ,eAAe;QAC7B;AACAhT,QAAAA,OAAMuC,OAAOyQ,aAAaja,CAAYwJ,IAAAA,OAAAA,QAAO0c,QAAQlmB,CAAO,MAAA,aAAawJ,QAAO0c,QAAQlmB,CAAAA,EAAGiH,OAAMuC,MAAUA,IAAAA,QAAO0c,QAAQlmB,CAAAA;AAAAA,MAC3H;AACOwJ,aAAAA,QAAO0c;AAAAA,IACf;AAAA,EACD,GAEA,sBAAsBvP,OAAMnN,SAAAA;AACvB,QAAAA,WAAUA,QAAO+N,OAAO;AACtBZ,MAAAA,MAAAA,KAAKtJ,QAAQ,SAAS5H,IAAAA;AACf,mBAAAzF,KAAKwJ,QAAO+N,OAAO;AACzB,cAAC9R,CAAAA,GAAGwU,cAAa;AACpBxU,eAAGwU,eAAe;UACnB;AACAxU,aAAGwU,aAAaja,YAAYwJ,QAAO+N,MAAMvX,CAAO,MAAA,aAAawJ,QAAO+N,MAAMvX,GAAGyF,IAAIwB,OAAMuC,UAAUA,QAAO+N,MAAMvX;QAC/G;AAAA,MAAA,CAAA;AAAA,aAEMwJ,QAAO+N;AAAAA,IACf;AAAA,EACD,GAEA,cAAcZ,OAAMnN,SACb;AAAA,UAAA2c,cAAc3c,QAAOjI,QAAQ;AAC5BiI,WAAAA,QAAOjI;AAEd0F,IAAAA,OAAMuC,OAAO0Q,SAAS1Q;AAEtB,UAAM6U,OAAOpX,OAAMoC,IAAI4M,WAAWyC;AAE5B,UAAA0N,eAAenf,OAAMof,gBAAAA;AACvB,QAAAD,aAAa/P,cAAc+P,aAAa9P,UAAU;AACrD,YAAMkH,aAAavW,OAAMmS,UAAUG,eAAetS,OAAMmS,UAAUC;AAClEpS,MAAAA,OAAMuC,OAAO8c,YAAY,EACxBjQ,YAAYmH,WAAW4I,aAAa/P,aACpCC,UAAUkH,WAAW4I,aAAa9P,QAAAA,EAAAA;AAAAA,IAEpC;AAEA,UAAMiQ,SAAS/c,QAAOgd,oBAAAA,SAAgC,QAAA,CAAA,CAAUhd,QAAOgd;AAEvE,UAAMC,MAAM,EACXza,UAAUxC,QAAOwC,YAAY,MAC7BxC,QAAQvC,OAAMuC,QACdmN,aACA4P,QACAhlB,MAAM4kB,aACN1N,UAAU4F,KAAAA;AAEX,eAAWre,KAAKwJ,SAAQ;AACnBid,UAAAzmB,CAAAA,IAAKwJ,QAAOxJ,CACjB;AAAA,IAAA;AACO,WAAAymB;AAAAA,EACR,GAGA,mBAAmBjd,SAClB;AAAA,UAAM+Q,MAAM/Q,QAAOuR,UAAU9T,OAAMoC,IAAI4M,WAAWC;AAC5C,UAAA8E,QAAQxR,QAAOwR,SAAS;AAC9B,UAAMrC,WAAWnP,QAAOmN;AACxB,UAAM3K,WAAWxC,QAAOwC;AAExB,UAAMf,WAAW,EAChByb,cAAcld,QAAOkd,gBAAgB,QACrCC,mBAAmBnd,QAAOmd,qBAAAA,QAC1BC,gBAAgBpd,QAAOod,yBAGxBjO;AAAAA,aAASG,OAAO,QAAQtP,QAAO2M,QAAQ;AACvCwC,aAASG,OAAO,QAAQmC,KAAKC,UAAUjQ;AAEvC,QAAI+P,OAAM;AACArC,eAAAG,OAAO,SAASkC;IAC1B;AAEM,UAAAI,MAAM,IAAIC;AACZD,QAAAE,qBAAqB,SAASlY,GACjC;AAAA,UAAIgY,IAAIG,eAAe,KAAKH,IAAII,WAAW,GAAG;AAC7C,YAAIxP,UAAU;AACbA,mBAAS,IAAA;AAAA,QACV;AAAA,MACD;AAAA,IAAA;AAGDoP,QAAIK,SAAS,WACN;AAAA,YAAAC,OAAON,IAAII,SAAS;AAC1B,UAAIG,OAAO;AAEX,UAAA,CAAKD,MAAM;AACN;AACIC,iBAAAV,KAAKW,MAAMR,IAAIS;iBACdzY,GAAK;AAAA,QAAA;AAAA,MACf;AAEA,UAAI4I,UAAU;AACbA,iBAAS2P,IACV;AAAA,MAAA;AAAA,IAAA;AAGGP,QAAAU,KAAK,QAAQvB,KAAK,IAAA;AAClBa,QAAAW,iBAAiB,oBAAoB,gBAAA;AACzCX,QAAIY,KAAKrD,QAAAA;AAAAA,EACV,EAKK1R;AAAAA,EAAAA,OAAA4f,cAAc5f,OAAMoC,IAAI4M,WAAW4Q;AACnC5f,EAAAA,OAAA6f,cAAc7f,OAAMoC,IAAI4M,WAAW6Q;AACnC7f,EAAAA,OAAA8f,eAAe9f,OAAMoC,IAAI4M,WAAW8Q;AACpC9f,EAAAA,OAAA+f,gBAAgB/f,OAAMoC,IAAI4M,WAAW+Q;AACrC/f,EAAAA,OAAAggB,eAAehgB,OAAMoC,IAAI4M,WAAWgR;AACpChgB,EAAAA,OAAAigB,kBAAkBjgB,OAAMoC,IAAI4M,WAAWiR;AACvCjgB,EAAAA,OAAAgS,sBAAsBhS,OAAMoC,IAAI4M,WAAWgD;AAC3ChS,EAAAA,OAAAkT,oBAAoBlT,OAAMoC,IAAI4M,WAAWkE;AACzClT,EAAAA,OAAAkgB,wBAAwBlgB,OAAMoC,IAAI4M,WAAWkR;AAC7ClgB,EAAAA,OAAAmgB,sBAAsBngB,OAAMoC,IAAI4M,WAAWmR;AAGjD,SAAOngB,OAAMoC,IAAI4M;AAClB;ACtmCA,SAAAoR,WAAwBpgB,QA2CxB;AAAA,WAASqgB;AACR,UAAMzlB,UAAYvF,SAAuBirB,qBACvCjrB,SAAuBkrB,wBACvBlrB,SAAuBmrB,2BACvBnrB,SAAuBorB;AACzB,WAAA,CAAA,EAAU7lB,WAAWA,YAAYvF,SAASD;AAAAA,EAC3C;AAEA,WAASsrB,wBAAAA;AACJ,QACH;AAAA,aAAQrrB,SAAuBsrB,qBAC7BtrB,SAAuBurB,2BACvBvrB,SAAuBwrB,wBACvBxrB,SAAuByrB;AAAAA,aACjB3kB,GAAAA;AAEAyC,cAAAC,MAAM,gCAAgC1C,CAC/C;AAAA,IAAA;AAAA,EACD;AAEA,QAAM0E,QAAQb,OAAMc,UAAUC,WAAW,OAAA;AACnCF,QAAAG,iBAAiB,cAAc,MAAA;AACpC,QAAI0f,sBAAwB,GAAA;AACpB,aAAA,EAAEN,YAAYC;IAAa,OAC5B;AACC,aAAA;AAAA,IACR;AAAA,EAGD,CAAA;AAAA,MAAIU,oBAAoB,EACvBC,UAAU,MACVC,SAAS,MACTC,YAAY,MACZC,cAAc,MACdC,eAAe,MACfC,aAAa;AAGd,QAAMC,qBAAoC,EACzC5qB,OAAO,MACPC,QAAQ,MACR7B,KAAK,MACLC,MAAM,MACN6L,UAAU,MACV2gB,QAAQ,MACRC,UAAU,MAAA;AAGX,MAAIC,oBAAoB;AACxB,WAASC,uBAAuBppB,MAC/B;AAAA,QAAIyF,SAASzF,KAAK9C;AAClB,UAAMmsB,YAAY;AACZ,WAAA5jB,UAAUA,OAAO9G,OAAM;AAC5B0qB,gBAAU1lB,KAAK,EACdrB,SAASmD,QACT6jB,qBAAqB7jB,OAAO9G,MAAM2J,SAAAA,CAAAA;AAEnC7C,aAAO9G,MAAM2J,WAAW;AACxB7C,eAASA,OAAOvI;AAAAA,IACjB;AACO,WAAAmsB;AAAAA,EACR;AAEA,WAASE,yBAAyBF,WACjCA;AAAAA,cAAUvb,QAAkB0b,YACpBA;AAAAA,aAAAlnB,QAAQ3D,MAAM2J,WAAWkhB,OAAOF;AAAAA,IAAA,CAEzC;AAAA,EAAA;AAGA,WAASG,qBAAAA;AACR,UAAMzpB,OAAO0H,OAAMoC,IAAIge,WAAW4B,qBAClC;AAAA,UAAM5sB,OAAOC,SAASD;AACV6sB,gBAAA3pB,KAAKrB,OAAOqqB,kBACJP;AAAAA,wBAAA,EACnBC,UAAU5rB,KAAK6B,MAAM+pB,UACrBC,SAAS7rB,KAAK6B,MAAMgqB,UAAU7rB,KAAK6B,MAAMgqB,UAAU,MACnDC,YAAY9rB,KAAK6B,MAAMiqB,aAAa9rB,KAAK6B,MAAMiqB,aAAa,MAC5DC,cAAc/rB,KAAK6B,MAAMkqB,eAAe/rB,KAAK6B,MAAMkqB,eAAe,MAClEC,eAAehsB,KAAK6B,MAAMmqB,gBAAgBhsB,KAAK6B,MAAMmqB,gBAAgB,MACrEC,aAAajsB,KAAK6B,MAAMoqB,cAAcjsB,KAAK6B,MAAMoqB,cAAc,KAAA;AAG5D,QAAAjsB,KAAK6B,MAAMgqB,SAAS;AACvB7rB,WAAK6B,MAAMgqB,UAAU;AAAA,IACtB;AACI,QAAA7rB,KAAK6B,MAAMiqB,YAAY;AAC1B9rB,WAAK6B,MAAMiqB,aAAa;AAAA,IACzB;AACI,QAAA9rB,KAAK6B,MAAMkqB,cAAc;AAC5B/rB,WAAK6B,MAAMkqB,eAAe;AAAA,IAC3B;AACI,QAAA/rB,KAAK6B,MAAMmqB,eAAe;AAC7BhsB,WAAK6B,MAAMmqB,gBAAgB;AAAA,IAC5B;AACI,QAAAhsB,KAAK6B,MAAMoqB,aAAa;AAC3BjsB,WAAK6B,MAAMoqB,cAAc;AAAA,IAC1B;AAEAjsB,SAAK6B,MAAM+pB,WAAW;AAEtB1oB,SAAKrB,MAAMP,QAAQ;AACnB4B,SAAKrB,MAAMN,SAAS;AACpB2B,SAAKrB,MAAMnC,MAAM;AACjBwD,SAAKrB,MAAMlC,OAAO;AAClBuD,SAAKrB,MAAM2J,WAAW;AACtBtI,SAAKrB,MAAMsqB,SAAS;AACpBD,uBAAmBE,WAAW;AAC9BC,wBAAoBC,uBAAuBppB,IAAAA;AAAAA,EAC5C;AAEA,WAAS4pB,eAAAA;AACR,UAAM5pB,OAAO0H,OAAMoC,IAAIge,WAAW4B,qBAClC;AAAA,UAAM5sB,OAAOC,SAASD;AACtB,QAAIksB,mBAAmBE,UAAU;AAChC,UAAIT,kBAAkBE,SAAS;AACzB7rB,aAAA6B,MAAMgqB,UAAUF,kBAAkBE;AAAAA,MACxC;AACA,UAAIF,kBAAkBG,YAAY;AAC5B9rB,aAAA6B,MAAMiqB,aAAaH,kBAAkBG;AAAAA,MAC3C;AACA,UAAIH,kBAAkBI,cAAc;AAC9B/rB,aAAA6B,MAAMkqB,eAAeJ,kBAAkBI;AAAAA,MAC7C;AACA,UAAIJ,kBAAkBK,eAAe;AAC/BhsB,aAAA6B,MAAMmqB,gBAAgBL,kBAAkBK;AAAAA,MAC9C;AACA,UAAIL,kBAAkBM,aAAa;AAC7BjsB,aAAA6B,MAAMoqB,cAAcN,kBAAkBM;AAAAA,MAC5C;AAEKjsB,WAAA6B,MAAM+pB,WAAWD,kBAAkBC;AACpBD,0BAAA,EACnBC,UAAU,MACVC,SAAS,MACTC,YAAY,MACZC,cAAc,MACdC,eAAe,MACfC,aAAa,KAEFY;AAAAA,kBAAAX,oBAAoBhpB,KAAKrB,KACrCqqB;AAAAA,yBAAmBE,WAAW;AAAA,IAC/B;AACAK,6BAAyBJ,iBACLA;AAAAA,wBAAA;AAAA,EACrB;AAES,WAAAQ,YAAYtE,QAAgBphB,QACpCA;AAAAA,WAAO7F,QAAQinB,OAAOjnB;AACtB6F,WAAO5F,SAASgnB,OAAOhnB;AACvB4F,WAAOzH,MAAM6oB,OAAO7oB;AACpByH,WAAOxH,OAAO4oB,OAAO5oB;AACrBwH,WAAOqE,WAAW+c,OAAO/c;AACzBrE,WAAOglB,SAAS5D,OAAO4D;AAAAA,EACxB;AAEA,WAASY,eACFniB;AAAAA,IAAAA,OAAA1D,MAAMjH,UAAU,0BAA0B+sB;AAC1CpiB,IAAAA,OAAA1D,MAAMjH,UAAU,uBAAuB+sB,kBAAAA;AACvCpiB,IAAAA,OAAA1D,MAAMjH,UAAU,sBAAsB+sB;AAEtCpiB,IAAAA,OAAA1D,MAAMjH,UAAU,oBAAoB+sB,kBACpCpiB;AAAAA,IAAAA,OAAA1D,MAAMjH,UAAU,oBAAoB+sB,kBAC3C;AAAA,EAAA;AAEA,MAAIC,cAAc;AAClB,WAASD,qBAAAA;AACJ,SAACpiB,OAAMsM,YAAY;AAEtB;AAAA,IACD;AACI,QAAAhQ;AACJ,UAAMgmB,iBAAiBjC;AAEvB,QAAIiC,gBAAgB;AACnB,UAAID,aAAa;AACR/lB,QAAAA,SAAA;AACWylB,2BAAAA;AAAAA,MACpB;AAAA,eACUM,aAAa;AACTA,oBAAA;AACN/lB,MAAAA,SAAA;AACK4lB,mBAAAA;AAAAA,IACd;AACAra,eAAW,MAAA;AACV7H,MAAAA,OAAM2C,OAAAA;AAAAA,IAAO,CAEdkF;AAAAA,eAAW;AACJ7H,MAAAA,OAAAgF,UAAU1I,QAAO,CAAC0D,OAAMoC,IAAIge,WAAW4B,qBAAAA,CAAAA,CAAAA;AAAAA,IAAuB,CAEtE;AAAA,EAAA;AAEA,WAASO,iBAAAA;AACJ,SAACviB,OAAMsM,YAAY;AACf,aAAA;AAAA,IACR;AACA,QAAKtM,CAAAA,OAAMoC,IAAIge,WAAW4B,qBAAwB,GAAA;AAC1C,aAAA;AAAA,IACR;AACI,QAACtB,CAAAA,sBAAAA,GAAyB;AAEvB,YAAAjiB,SAAUG,QAAqB4jB,WAAW5jB,QAAQ6jB;AACxDhkB,aAAO,qFAAA;AACA,aAAA;AAAA,IACR;AACO,WAAA;AAAA,EACR;AAEAuB,EAAAA,OAAMoC,IAAIge,aAAa,EACtB,SACC;AAAA,QAAImC,kBAAkB;AACrB;AAAA,IACD;AAEA,QAAIlC,WAAc,GAAA;AACjB;AAAA,IACD;AAEI,QAAA,CAACrgB,OAAMgF,UAAU,kBAAkB,CAAC/H,KAAK+kB,qBAA0B,CAAA,CAAA,GAAA;AACtE;AAAA,IACD;AACcK,kBAAA;AAId,UAAMznB,UAAUvF,SAASD;AACzB,UAAMstB,mBAAmB9nB,QAAQ+nB,0BAChC,CAAEC,QAAgCC,oBAAAA,IAAwB,CAE3D;AAAA,UAAMC,oBAAoBloB,QAAQmoB,uBACjCnoB,QAAQooB,wBACRpoB,QAAQ+nB,2BACR/nB,QAAQkoB;AAET,QAAIA,mBAAmB;AACJA,wBAAA5lB,MAAMtC,SAAS8nB,gBAAAA;AAAAA,IAClC;AAAA,EACD,GACA,WAAAO;AACC,QAAIV,eAAkB,GAAA;AACrB;AAAA,IACD;AAEI,QAAA,CAAClC,cAAc;AAClB;AAAA,IACD;AAEI,QAAA,CAACrgB,OAAMgF,UAAU,oBAAoB,CAAC/H,KAAK+kB,0BAA0B;AACxE;AAAA,IACD;AAEA,UAAMkB,wBAAyB7tB,SAAuB8tB,oBACpD9tB,SAAuB+tB,uBACvB/tB,SAAuBguB,wBACvBhuB,SAAuBiuB;AAEzB,QAAIJ,uBAAuB;AAC1BA,4BAAsBhmB,MAAM7H,QAAAA;AAAAA,IAC7B;AAAA,EACD,GACA,SAAAkuB;AACC,QAAIhB,eAAkB,GAAA;AACrB;AAAA,IACD;AACI,QAAA,CAAClC,cAAc;AAClBpjB,WAAKumB,OAAO;AAAA,IAAA,OACN;AACNvmB,WAAKgmB;IACN;AAAA,EAED,GACA,uBACC;AAAA,WAAOjjB,OAAMgC;AAAAA,EACd,EAAA;AAGDhC,EAAAA,OAAMwjB,SAAS,WACRxjB;AAAAA,IAAAA,OAAAoC,IAAIge,WAAWoD,OAAAA;AAAAA,EAAO;AAG7BxjB,EAAAA,OAAMijB,WAAW;AACVjjB,IAAAA,OAAAoC,IAAIge,WAAW6C,SAAAA;AAAAA,EAAS;AAGzBjjB,EAAAA,OAAAyE,YAAY,gBAAgB0d,YAAAA;AAElC;ACzUe,SAAQsB,mBAACzjB,QAAAA;AAEvBA,EAAAA,OAAM0jB,oBAAoBC,YAAY,EACrCC,eAAe,WACd;AAAA,WAAO,EACNC,WAAW,EACVC,OAAS,OACTC,KAAO,OACPC,MAAQ,OACRC,MAAQ,MAAA,GAETC,SAAS,KAAA;AAAA,EAEV,GACDvP,OAAO,SAAUwP;AAChB,QAAIC,WAAW;AAEf,QAAIC,OAAOpnB,KAAKqnB,eAAernB,KAAKD,KAAKmnB;AACzC,aAASprB,IAAI,GAAGA,IAAIsrB,KAAKrrB,QAAQD,KAAK;AACrC,UAAIwrB,QAAQtnB,KAAKunB,SAASH,KAAKtrB,CAAAA,CAAAA;AAE/B,UAAI0rB,UAAUxnB,KAAK2mB,cAAAA;AAEnB,eAASxH,IAAI,GAAGA,IAAImI,MAAMvrB,QAAQojB,KAAK;AACtC,YAAInf,KAAKynB,YAAYH,MAAMnI,KAAK;AAC/BqI,kBAAQZ,UAAUU,MAAMnI,CAAM,CAAA,IAAA;AAAA,QAC9B,WAAUnf,KAAK0nB,YAAYJ,MAAMnI,CAAK,CAAA,GAAA;AACtCqI,kBAAQP,UAAUjnB,KAAK0nB,YAAYJ,MAAMnI,CAC/C,CAAA;AAAA,QAAA,OAAY;AACNqI,kBAAQP,UAAUK,MAAMnI,CAAGwI,EAAAA,WAAW;QACtC;AAAA,MACD;AAEDR,eAASnoB,KAAKwoB,OACd;AAAA,IAAA;AACD,WAAOL;AAAAA,EACP,GAEDS,qBAAqB,SAAUC,UAC9B;AAAA,QAAIL,UAAUxnB,KAAK2mB,cAAAA;AACnBa,YAAQZ,UAAUC,QAAUgB,CAAAA,CAAAA,SAASC;AACrCN,YAAQZ,UAAUE,QAAQe,SAASE;AACnCP,YAAQZ,UAAUG,OAAAA,CAAAA,CAASc,SAASG;AACpCR,YAAQZ,UAAUI,SAASa,SAASI;AACpCT,YAAQP,UAAUY,SAASK,SAASL,SAASZ;AAE7C,QAAGO,QAAQP,WAAW,MAAMO,QAAQP,WAAW,KAAI;AAElDO,cAAQP,WAAW;AAAA,IACnB;AAED,QAAIkB,eAAeroB,OAAOsoB,aAAaZ,QAAQP;AAC/C,QAAIkB,cAAc;AACjBX,cAAQP,UAAUkB,aAAajtB,cAAcysB,WAAW,CAAA;AAAA,IACxD;AACD,WAAOH;AAAAA,EACP,GAEDa,kBAAkB,SAAUR,UAAAA;AAC3B,WAAO7nB,KAAKsoB,QAAQtoB,KAAK4nB,oBAAoBC,QAAAA,CAAAA;AAAAA,EAC7C,GAEDS,SAAS,SAAUd,SAAAA;AAClB,QAAIe,QAAQ,CAAA;AACZ,aAASzsB,KAAK0rB,QAAQZ,WAAW;AAChC,UAAIY,QAAQZ,UAAU9qB,CAAI,GAAA;AACzBysB,cAAMvpB,KAAKlD,CAAAA;AAAAA,MACX;AAAA,IACD;AACDysB,UAAMvpB,KAAKwoB,QAAQP,OAAAA;AAEnB,WAAOsB,MAAM/sB,KAAKwE,KAAKwoB;EACvB,GAEDnB,gBAAgB,SAAUH,UAAAA;AACzB,WAAOA,SAAS5pB,MAAM0C,KAAKwoB,YAAAA;AAAAA,EAC3B,GACDjB,UAAU,SAAUkB,MAAAA;AACnB,WAAOA,KAAKnrB,MAAM0C,KAAK0oB,eACvB;AAAA,EAAA,GACD3oB,MAAM,SAAUmnB,UAAAA;AACf,WAAOA,SAASzpB,QAAQ,OAAO;EAC/B,GACD+qB,cAAc,KACdE,iBAAiB,KACjBjB,aAAa,EACZZ,OAAS,IACTC,KAAO,IACPC,MAAQ,IACRC,MAAQ,KAAA,GAETU,aAAa,EACZiB,WAAa,GACbC,KAAO,GACPC,OAAS,IACTC,KAAO,IACPC,OAAS,IACTC,IAAM,IACNC,MAAQ,IACRnxB,MAAQ,IACRC,OAAS,IACTmxB,MAAQ,IACRpd,KAAO,IACPqd,QAAU,IACVC,UAAY,IACZC,QAAU,IACVC,QAAU,IACVC,MAAQ,KACRC,IAAM,KACNC,IAAM,KACNC,IAAM,KACNC,IAAM,KACNC,IAAM,KACNC,IAAM,KACNC,IAAM,KACNC,IAAM,KACNC,IAAM,KACNC,KAAO,KACPC,KAAO,KACPC,KAAO;AAGV;AC1He,SAAQC,aAACrnB,QAAAA;AAEvBA,EAAAA,OAAM0jB,oBAAoB4D,eAAe,EACxCC,WAAW,MACXC,aAAa,SAAU/C,SAAAA;AACtB,SAAKxnB,KAAKsqB,UAAWtqB,MAAKsqB,YAAY,CAAA;AACtC,QAAI5D,YAAY3jB,OAAM0jB,oBAAoBC;AAC1C,QAAI8D,OAAO9D,UAAU4B,QAAQd,OAE7B;AAAA,WAAOxnB,KAAKsqB,UAAUE;EACtB,GAEDC,UAAU,SAAUjD,SAAStoB,GAAAA;AAC5B,QAAI4H,UAAU9G,KAAKuqB,YAAY/C,OAAAA;AAC/B,QAAI1gB,SAAS;AACZ,UAAI4jB,cAAc3nB,OAAM0jB,oBAAoBkE;AAE5C,UAAGD,YAAY3iB,UAAU,kBAAkB,CAACyf,SAAStoB,CAAAA,CAAAA,MAAQ,OAAM;AAClE;AAAA,MACA;AAED4H,cAAQjL,KAAKmE,MAAMd;AAEnB,UAAIA,EAAE0rB,eAAgB1rB,GAAE0rB,eACnB1rB;AAAAA,UAAAA,GAAE2rB,cAAc;AAAA,IAErB;AAAA,EACD,GACDljB,MAAM,SAAUuf,UAAUpgB,SACzB;AAAA,QAAA,CAAK9G,KAAKsqB,UAAWtqB,MAAKsqB,YAAY,CAAA;AAEtC,QAAI5D,YAAY3jB,OAAM0jB,oBAAoBC;AAE1C,QAAIS,WAAWT,UAAUhP,MAAMwP,QAC/B;AAAA,aAASprB,IAAI,GAAGA,IAAIqrB,SAASprB,QAAQD,KAAK;AACzCkE,WAAKsqB,UAAU5D,UAAU4B,QAAQnB,SAASrrB,OAAOgL;AAAAA,IACjD;AAAA,EACD,GACDgkB,QAAQ,SAAU5D,UAAAA;AACjB,QAAIR,YAAY3jB,OAAM0jB,oBAAoBC;AAE1C,QAAIS,WAAWT,UAAUhP,MAAMwP,QAAAA;AAC/B,aAASprB,IAAI,GAAGA,IAAIqrB,SAASprB,QAAQD,KAAK;AACzC,UAAIkE,KAAKsqB,UAAU5D,UAAU4B,QAAQnB,SAASrrB,CAAAA,CAAAA,CAAAA,GAAM;eAC5CkE,KAAKsqB,UAAU5D,UAAU4B,QAAQnB,SAASrrB,CAAAA,CAAAA,CAAAA;AAAAA,MACjD;AAAA,IACD;AAAA,EACD,GAEDivB,SAAS,SAAUxhB,KAAAA;AAClB,aAASzN,KAAKyN,KAAK;AAClBvJ,WAAK2H,KAAK7L,GAAGyN,IAAIzN,CAAAA,CAAAA;AAAAA,IACjB;AAAA,EACD,GACDkvB,UAAU,WAAA;AACT,SAAKhrB,KAAKsqB,UACTtqB,MAAKsqB,YAAY;AAClB,QAAItqB,KAAK+gB,MAAM;AACd/gB,WAAK+qB,QAAQ/qB,KAAK+gB,IAClB;AAAA,IAAA;AAAA,EACD,EAGH;AAAA;AC7De,SAAQkK,iBAACloB;GAEvB,WAECA;AAAAA,IAAAA,OAAM0jB,oBAAoBrrB,oBAAoB8vB;AAE9CnoB,IAAAA,OAAM0jB,oBAAoB0E,YAAY,SAASA,UAAU9vB,MAAM6D,GAC9D;AAAA,UAAIA,EAAE+nB,WAAW,EAAG,QAAO;AAE3B,UAAImE,YAAYroB,OAAM0jB,oBAAoBrrB,kBAAkBC,IAAAA;AAC5D,UAAIgwB,eAAeC;AACnB,UAAIC,eAAAA;AACJ,eAASzvB,IAAI,GAAGA,IAAIsvB,UAAUrvB,QAAQD,KAAK;AAC1C,YAAIsvB,UAAUtvB,CAAMuvB,KAAAA,cAAc;AACjCE,yBAAezvB;AACf;AAAA,QACA;AAAA,MACD;AAED,UAAIoD,EAAE4oB,UAAU;AAEf,YAAIyD,gBAAgB,GAAG;AAEtB,cAAIC,WAAWJ,UAAUA,UAAUrvB,SAAS,CAC5C;AAAA,cAAIyvB,UAAU;AACbA,qBAASC,MACTvsB;AAAAA,cAAE0rB;AACF,mBAAO;AAAA,UACP;AAAA,QACD;AAAA,MAEL,OAAU;AAEN,YAAIW,gBAAgBH,UAAUrvB,SAAS,GAAG;AAEzC,cAAI2vB,YAAYN,UAAU,CAAA;AAC1B,cAAIM,WAAW;AACdA,sBAAUD,MAAAA;AACVvsB,cAAE0rB,eAAAA;AACF,mBAAO;AAAA,UACP;AAAA,QACD;AAAA,MACD;AAED,aAAO;AAAA,IACV;AAAA,EACE,GAEF;AAAA;AClDe,SAAQe,WAAC5oB;AAEvBA,EAAAA,OAAM0jB,oBAAoBmF,YAAY,WACvC;AAAA,EAAA;AAEC7oB,EAAAA,OAAM0jB,oBAAoBmF,UAAUjwB,YAAYoH,OAAM8oB,SACrD9oB,OAAM0jB,oBAAoB4D,cAC1B,EAECoB,OAAO,WACN1oB;AAAAA,IAAAA,OAAM0oB;EACN,GAEDK,MAAM,WAEL;AAAA,EAAA,GAEDnxB,WAAW,WAAA;AACV,WAAOoI,OAAMsM,WAAWlU,aAAa,UAAA;AAAA,EACrC,GAED4wB,kBAAkB,SAASA,iBAAiBC,KAAAA;AAC3C,QAAI3Z,QAAOtP,OAAMmK,YAAYnK,OAAM4N,eAAiBnX,EAAAA,CAAAA;AACpD,QAAIyyB,QAAQlpB,OAAMsZ;AAClB,QAAIoD,OAAOuM,MAAM,IAAA,CAAKC,MAAMxM,OAAOwM,MAAMxM;AACzCpN,IAAAA,QAAOtP,OAAMsP,KAAK/F,IAAI+F,OAAMoN,MAAMwM,MAAM/iB,IACxCnG;AAAAA,IAAAA,OAAMuR,SAASvR,OAAMmpB,YAAY7Z,KACjC,CAAA;AAAA,EAAA,GAED8Z,gBAAgB,SAASA,eAAeH;AACvC,QAAIn0B,MAAMkL,OAAM4N,eAAAA,EAAiBtX;AACjC,QAAIomB,OAAO1c,OAAMuC,OAAOqJ;AACxB5L,IAAAA,OAAMuR,SAAS,MAAMzc,OAAOm0B,MAAM,IAAA,KAAS,KAAKvM,IAChD;AAAA,EAAA,GAEDsB,MAAM,EACL,YAAY,SAAU7hB,GACrBc;AAAAA,SAAK+rB,mBACL;AAAA,EAAA,GACD,aAAa,SAAU7sB,GACtBc;AAAAA,SAAK+rB,iBAAiB,CACtB;AAAA,EAAA,GACD,UAAU,SAAU7sB,GACnBc;AAAAA,SAAKmsB,iBACL;AAAA,EAAA,GACD,YAAY,SAAUjtB,GACrBc;AAAAA,SAAKmsB,eAAe,CACpB;AAAA,EAAA,GAGD,UAAU,WACT;AAAA,QAAIppB,OAAMqpB,KAAMrpB,CAAAA,OAAMqpB,KACtB;AAAA,EAAA,GAGD,UAAU,WAAA;AACT,QAAIrpB,OAAMspB,KAAMtpB,CAAAA,OAAMspB,KAAAA;AAAAA,EACtB,EAKJtpB,EAAAA,CAAAA;AAAAA,EAAAA,OAAM0jB,oBAAoBmF,UAAUjwB,UAAUovB,QAAQhoB,OAAM0jB,oBAAoBmF,UAAUjwB,UAAUolB,IAErG;AAAA;AChEe,SAAQuL,SAACvpB,QAAAA;AAEvBA,EAAAA,OAAM0jB,oBAAoB8F,aAAa,WACxC;AAAA,EAAA;AAECxpB,EAAAA,OAAM0jB,oBAAoB8F,WAAW5wB,YAAYoH,OAAM8oB,SACtD9oB,OAAM0jB,oBAAoB4D,cAC1B,EACCjuB,SAAS,WACR;AAAA,WAAO;AAAA,EACP,GACDowB,UAAU,WACT;AAAA,WAAO;AAAA,EACP,GAEDC,QAAQ,SAAU9uB,SACjBoF;AAAAA,IAAAA,OAAM0jB,oBAAoBiG,WAAWC,cAAchvB,OAAAA;AAAAA,EACnD,GAEDivB,WAAW,SAAU1wB,GAEpB;AAAA,QAAA,CAAKA,EAAG,QAAO;AACf,aAASJ,KAAKkE,MAAM;AACnB,UAAA,CAAA,CAAMA,KAAKlE,CAAQI,KAAAA,CAAAA,CAAAA,EAAEJ,GAAI,QAAO;AAEhC,UAAI+wB,mBAAsB7sB,CAAAA,EAAAA,KAAKlE,CAAMkE,KAAAA,KAAKlE,CAAG4f,EAAAA;AAC7C,UAAIoR,mBAAsB5wB,CAAAA,EAAAA,EAAEJ,MAAMI,EAAEJ,CAAAA,EAAG4f;AACvC,UAAIoR,oBAAoBD,iBAAkB,QAAO;AACjD,UAAA,EAAMC,oBAAoBD,mBAAmB;AAC5C,YAAI3wB,EAAEJ,CAAAA,KAAMkE,KAAKlE,CAAI,EAAA,QAAO;AAAA,MAClC,OAAY;AACN,YAAII,EAAEJ,CAAG4f,EAAAA,SAAAA,KAAc1b,KAAKlE,CAAAA,EAAG4f,SAC9B,EAAA,QAAO;AAAA,MACR;AAAA,IACD;AACD,WAAO;AAAA,EACP,GAEDqR,SAAS;EACR,GACDtB,OAAO;AACN,QAAI7xB,OAAOoG,KAAK+sB,QAChB;AAAA,QAAA,CAAInzB,KACH;AAED,QAAI8wB,cAAc3nB,OAAM0jB,oBAAoBkE;AAE5C,QAAGD,YAAY3iB,UAAU,iBAAiB,CAACnO,IAAAA,CAAAA,MAAW,OAAM;AAC3D;AAAA,IACA;AAED,QAAIA,MAAM;AACTA,WAAKozB,aAAa,YAAY;AAC9B,UAAIpzB,CAAAA,KAAKqzB,gBAAe;AACvBrzB,aAAKqzB,iBAAiB;AACtBlqB,QAAAA,OAAM1D,MAAMzF,MAAM,SAAQ,SAASsF,GAAAA;AAClCA,YAAE0rB,eACF;AAAA,iBAAO;AAAA,QACP,GAAE,KACH;AAAA,MAAA;AAED,UAAI7nB,OAAM2B,MAAMC,IAAI1D,UAAU7I,SAAS+J,eAAevI,IAAM,GAAA;AAC3DA,eAAOxB,SAAS+J;AAAAA,MAChB;AACD,UAAIvI,KAAK6xB,MAAO7xB,MAAK6xB,MAAAA;AAErBf,kBAAY3iB,UAAU,WAAW,CAAC/H,KAAK+sB,QACvC,CAAA,CAAA;AAAA,IAAA;AAAA,EAED,GACDjB,MAAM;AACL,QAAIlyB,OAAOoG,KAAK+sB,QAChB;AAAA,QAAInzB,MAAM;AACT,UAAI8wB,cAAc3nB,OAAM0jB,oBAAoBkE;AAC5CD,kBAAY3iB,UAAU,UAAU,CAACnO,IAAAA,CAAAA;AACjCA,WAAKozB,aAAa,YAAY,IAE9B;AAAA,IAAA;AAAA,EACD,EAIJ,CAAA;AAAA;AChFe,SAAQE,YAACnqB;AAEvBA,EAAAA,OAAM0jB,oBAAoB0G,aAAa,SAAU3mB,OAAAA;AAChDxG,SAAKwG,QAAQA,SAAS;AAAA,EACxB;AAECzD,EAAAA,OAAM0jB,oBAAoB0G,WAAWxxB,YAAYoH,OAAM8oB,SACtD9oB,OAAM0jB,oBAAoB8F,YAC1B,EACCjC,WAAW,MAEXluB,SAAS,WACR;AAAA,QAAA,CAAK2G,OAAMuC,OAAO8nB,WAAW;AAC5B,UAAIrqB,OAAMsqB,sBACT,QAAO;AAAA,IACR;AACD,WAAA,CAAA,CAAStqB,OAAMuqB,eAAAA,EAAiBttB,KAAKwG,KAAWzD,KAAAA,CAAAA,OAAMsqB,oBACtD;AAAA,EAAA,GACDb,UAAU,WAAA;AACT,SAAKzpB,OAAMuC,OAAO8nB,WAAW;AAC5B,UAAIrqB,OAAMsqB,uBAAuB;AAChC,eAAO,IAAItqB,OAAM0jB,oBAAoB8G;AAAAA,MACrC;AACD,aAAO;AAAA,IACP;AACD,QAAIC,iBAAiBzqB,OAAMuqB,eAC3B;AAAA,QAAI9mB,QAAQxG,KAAKwG;AACjB,WAAOA,SAAS,GAAG;AAClB,UAAIgnB,eAAehnB,KAClB,EAAA;AACDA;AAAAA,IACA;AACD,QAAIgnB,eAAehnB,KAAQ,GAAA;AAC1B,aAAO,IAAIzD,OAAM0jB,oBAAoB0G,WAAW3mB,KACrD;AAAA,IAAA,OAAW;AACN,aAAO;AAAA,IACP;AAAA,EACD,GAEDinB,gBAAgB,SAASlsB;AACxB,QAAImsB,cAAcC,gBAA2BpsB,IAAI,sBACjD;AAAA,QAAGmsB,aAAY;AACd,UAAIlnB,QAAQ;AACZ,aAAMknB,eAAeA,YAAYE,iBAAgB;AAChDF,sBAAcA,YAAYE;AAC1BpnB,iBAAS;AAAA,MACT;AACD,aAAO,IAAIzD,OAAM0jB,oBAAoB0G,WAAW3mB,KAAAA;AAAAA,IACrD,OAAS;AACJ,aAAO;AAAA,IACP;AAAA,EACD,GAEDumB,SAAS;AACR,UAAMd,QAAQlpB,OAAM8qB;AACpB,QAAA,CAAK5B,OAAM;AACV,aAAO;AAAA,IACP;AACD,UAAM6B,QAAQ7B,MAAMrtB;AACpB,WAAOkvB,MAAM9tB,KAAKwG,KAClB;AAAA,EAAA,GAGDua,MAAM,EAELjpB,MAAQ,WAAA;AACP,QAAIkI,KAAKwG,QAAQ,GAAG;AACnBxG,WAAKysB,OAAO,IAAI1pB,OAAM0jB,oBAAoB0G,WAAWntB,KAAKwG,QAAQ;IAClE;AAAA,EACD,GACDzO,OAAS,WAAA;AACR,QAAI8a,UAAU9P,OAAMuqB,eACpB;AAAA,QAAIttB,KAAKwG,QAAQqM,QAAQ9W,SAAS,GAAG;AACpCiE,WAAKysB,OAAO,IAAI1pB,OAAM0jB,oBAAoB0G,WAAWntB,KAAKwG,QAAQ,CAAA,CAAA;AAAA,IAClE;AAAA,EACD,GACDyiB,MAAQ,WACP;AAAA,QAAI8E;AACJ,QAAIC,YAAYjrB,OAAMgY,YAAYhY,OAAMuC,OAAOuV,OAC/C;AAAA,QAAI9X,OAAM0d,aAAauN,UAAU,CAAK,CAAA,GAAA;AACrCD,gBAAUC,UAAU,CAAA;AAAA,IACpB;AACD,QAAID,SAAS;AACZ,UAAIhrB,OAAMuC,OAAO2oB,2BAA2B;AAC3CjuB,aAAKysB,OAAO,IAAI1pB,OAAM0jB,oBAAoByH,SAASH,SAAS/tB,KAAKwG,KAAAA,CAAAA;AAAAA,MACxE,OAAa;AACNxG,aAAKysB,OAAO,IAAI1pB,OAAM0jB,oBAAoB8G,QAAQQ;MAClD;AAAA,IACD;AAAA,EACD,GAEDjiB,KAAO,WACN;AAAA,QAAI+G,UAAU9P,OAAMuqB,eAAAA;AACpBttB,SAAKysB,OAAO,IAAI1pB,OAAM0jB,oBAAoB0G,WAAWta,QAAQ9W,SAAS,CAAA,CAAA;AAAA,EACtE,GACDmtB,MAAQ;AACPlpB,SAAKysB,OAAO,IAAI1pB,OAAM0jB,oBAAoB0G,WAAW,CACrD,CAAA;AAAA,EAAA,GAID,gBAAgB,WAAA;AACf,QAAIvzB,OAAO0xB;AACX1xB,SAAKu0B,MAAAA;AAAAA,EACL,GAGD,cAAc,WAAA;AACb,QAAIprB,OAAMqrB,WAAWpuB,IAAO,GAAA;AAC3B;AAAA,IACA;AACD+C,IAAAA,OAAMsrB,WAAW,CAAA,GAAIruB,KAAKsuB,MAAAA;AAAAA,EAC1B;AAKJvrB,EAAAA,OAAM0jB,oBAAoB0G,WAAWxxB,UAAUovB,QAAQhoB,OAAM0jB,oBAAoB0G,WAAWxxB,UAAUolB,IAEvG;AAAA;ACzHe,SAAQwN,SAACxrB;AAEvBA,EAAAA,OAAM0jB,oBAAoB8G,UAAU,SAAUe,QAC7C;AAAA,QAAA,CAAKA,QAAQ;AACZ,UAAIN,YAAYjrB,OAAMgY,YAAYhY,OAAMuC,OAAOuV,OAAAA;AAC/C,UAAImT,UAAU,CAAI,GAAA;AACjBM,iBAASN,UAAU,CAAA;AAAA,MACnB;AAAA,IACD;AACDhuB,SAAKsuB,SAASA;AACd,QAAIvrB,OAAM0d,aAAazgB,KAAKsuB,MAAAA,GAAS;AACpCtuB,WAAKwG,QAAQzD,OAAMyrB,aAAaxuB,KAAKsuB;AACrCtuB,WAAKyuB,cAAc1rB,OAAM2rB,mBAAmB1uB,KAAKsuB,MAAAA;AACjDtuB,WAAK2uB,YAAc5rB,CAAAA,CAAAA,OAAMmc,QAAQlf,KAAKsuB,MAAQM,EAAAA;AAC9C5uB,WAAK6uB,WAAW9rB,OAAM+rB,UAAU9uB,KAAKsuB,MACrC;AAAA,IAAA;AAAA,EACH;AAECvrB,EAAAA,OAAM0jB,oBAAoB8G,QAAQ5xB,YAAYoH,OAAM8oB,SACnD9oB,OAAM0jB,oBAAoB8F,YAC1B,EACCjC,WAAW,MACXluB,SAAS,WACR;AAAA,WAAO2G,OAAM0d,aAAazgB,KAAKsuB,MAAAA,KAAYvrB,OAAMyrB,aAAaxuB,KAAKsuB,MAAW,IAAA;AAAA,EAC9E,GACD9B,UAAU;AACT,QAAKzpB,CAAAA,OAAMsqB,uBAAuB;AACjC,UAAInN,SAAS,IAAInd,OAAM0jB,oBAAoB0G;AAC3C,UAAKjN,CAAAA,OAAO9jB,UAAW,QAAO;AAAA,UACzB,QAAO8jB;AAAAA,IACjB,OAAW;AAEN,WAAIlgB,KAAK2uB,WAAU;AAClB,YAAII,YAAa;AAEjB,YAAIhsB,OAAMqL,eAAepO,KAAKyuB,cAAc,CAAA,GAAI;AAC/CM,sBAAY/uB,KAAKyuB,cAAc;AAAA,QACtC,WAAiB1rB,OAAMqL,eAAepO,KAAKyuB,cAAc,CAAI,GAAA;AACtDM,sBAAY/uB,KAAKyuB,cAAc;AAAA,QACtC,OAAa;AACN,cAAIA,cAAczuB,KAAKyuB;AACvB,iBAAOA,eAAe,GAAG;AACxB,gBAAI1rB,OAAMqL,eAAeqgB,WAAAA,GAAc;AACtCM,0BAAYN;AACZ;AAAA,YACA;AACDA;AAAAA,UACA;AAAA,QAED;AACD,YAAIM,gBAAgB;AACnB,iBAAO,IAAIhsB,OAAM0jB,oBAAoB8G,QAAQxqB,OAAMqL,eAAe2gB,WAAW9nB,EAC7E;AAAA,QAAA;AAAA,MACP,OAAW;AACL,eAAO,IAAIlE,OAAM0jB,oBAAoB8G,QAAQvtB,KAAK6uB,QAClD;AAAA,MAAA;AAAA,IAED;AAAA,EACD,GAEDpB,gBAAgB,SAASlsB;AACxB,QAAGwB,OAAMuC,OAAO2oB,2BAA0B;AACzC,aAAO;AAAA,IACP;AAED,QAAIK,SAASvrB,OAAMisB,OAAOztB;AAC1B,QAAGwB,OAAM0d,aAAa6N,MAAAA,GAAQ;AAC7B,aAAO,IAAIvrB,OAAM0jB,oBAAoB8G,QAAQe,MAAAA;AAAAA,IAClD,OAAS;AACJ,aAAO;AAAA,IACP;AAAA,EACD,GAEDvB,SAAS,WACR;AAAA,QAAIhqB,OAAM0d,aAAazgB,KAAKsuB,WAAWvrB,OAAMksB,cAAcjvB,KAAKsuB,MAAS,GAAA;AACxE,UAAIvrB,OAAMuC,OAAO8nB,WAAW;AAC3B,eAAOrqB,OAAMmsB,MAAMjxB,cAAc,cAAc8E,OAAMuC,OAAO6pB,cAAAA,KAAmBrvB,OAAOE,KAAKsuB,MAAQc,EAAAA,WAAW,KAAK,KACzH,CAAA,IAAA;AAAA,MAAA,OAAY;AACN,eAAOrsB,OAAMia,YAAYhd,KAAKsuB,MAAAA;AAAAA,MAC9B;AAAA,IACD;AAAA,EACD,GAED7C,OAAO,SAAU4D,WAChB;AAAA,QAAA,CAAIA,WAAW;AACd,YAAMpjB,MAAMlJ,OAAMusB,gBAAgBvsB,OAAMmc,QAAQlf,KAAKsuB,MACrD,CAAA;AAAA,YAAM50B,SAASqJ,OAAMwsB,cAAcvvB,KAAKsuB,MACxC;AAAA,YAAM/a,SAASxQ,OAAM4N,eAAAA;AAErB,UAAI6e;AACJ,UAAGzsB,OAAMsN,OAAM;AACdmf,oBAAYzsB,OAAMsN,MAAMtX;AAAAA,MAC9B,OAAU;AACJy2B,oBAAYjc,OAAOkc;AAAAA,MACnB;AAED,UAAIC;AACJ,UAAG3sB,OAAM4sB,cAAc5sB,OAAMiM,YAAW;AACvC0gB,sBAAc3sB,OAAM4sB,cAAc5sB,OAAMiM,YAAYhW;AAAAA,MAC1D,OAAU;AACJ02B,qBAAanc,OAAOqc;AAAAA,MACpB;AACD,YAAMC,kBAAkB9sB,OAAMuC,OAAOwqB,cAAc/sB,OAAMoM,IAAIC,QAAQ,UAAA;AAErE,UAAInD,IAAIpU,MAAM0b,OAAOla,KAAK4S,IAAIpU,MAAM6B,SAAU6Z,OAAOla,IAAIq2B,YAAa;AAErE3sB,QAAAA,OAAMuR,SAAS,MAAMrI,IAAIpU,MAAM,EAC/B;AAAA,MAAA,WAAUkL,OAAMuC,OAAOyqB,mBAAmBF,iBAAiB;AAE3D,YAAI5jB,IAAInU,OAAQyb,OAAO/Z,IAAIg2B,WAAY;AACtCzsB,UAAAA,OAAMuR,SAASrI,IAAInU,OAAOiL,OAAMuC,OAAO0qB,kBAAAA;AAAAA,QAC9C,WAAiB/jB,IAAInU,OAAOmU,IAAIxS,QAAQ8Z,OAAO/Z,GAAG;AAC3CuJ,UAAAA,OAAMuR,SAASrI,IAAInU,OAAOmU,IAAIxS,QAAQsJ,OAAMuC,OAAO0qB;QACnD;AAAA,MACD;AAAA,IACD;AAEDjtB,IAAAA,OAAM0jB,oBAAoB8F,WAAW5wB,UAAU8vB,MAAMxrB,MAAMD,MAAM,CAACqvB,SAAAA,CAAAA;AAGlEY;AAEA,aAASA,aAAAA;AACR,UAAIC,OAAOntB,OAAMoM,IAAIC,QAAQ,MAC7B;AAAA,UAAA,CAAK8gB,SAASA,KAAKP,YAAW;AAE7B;AAAA,MACA;AACD,UAAIQ,kBAAkBl3B,SAASi3B,KAAKhB,MAAMv2B,UAC1C;AAAA,UAAIy3B,kBAAkBn3B,SAASi3B,KAAKP,WAAWn3B,SAAAA;AAE/C,UAAI63B,8BAA8BH,KAAKzf,QAAQC;AAE/C,UAAI2f,+BAA+BH,KAAKzf,QAAQ6f,YAAY;AAC3D,YAAIC,sBAAsBxtB,OAAMoM,IAAIC,QAAQihB,2BAC5C;AAAA,YAAIE,qBAAqB;AACxBA,8BAAoBjc,SAAS6b,iBAAiBC,eAC9C;AAAA,QAAA;AAAA,MACD;AAED,UAAII,4BAA4BN,KAAKzf,QAAQG;AAE7C,UAAI4f,2BAA2B;AAC9B,YAAIC,oBAAoB1tB,OAAMoM,IAAIC,QAAQohB,yBAC1C;AAAA,YAAIC,mBAAmB;AACtBA,4BAAkBnc,SAAS6b,iBAAiBC,eAC5C;AAAA,QAAA;AAAA,MACD;AAAA,IACD;AAAA,EAED,GAEDrP,MAAM,EACLqI,UAAY,WAAA;AACX,QAAIrmB,OAAMsqB,oBAAAA,GAAuB;AAChCrtB,WAAKysB,OAAO,IAAI1pB,OAAM0jB,oBAAoB8G,QAAQxqB,OAAMqL,eAAerL,OAAMsqB,wBAAwB,CAAGpmB,EAAAA,EAAAA,CAAAA;AAAAA,IACxG;AAAA,EACD,GACDkiB,QAAU,WAAA;AACT,QAAIpmB,OAAMsqB,oBAAAA,GAAuB;AAChCrtB,WAAKysB,OAAO,IAAI1pB,OAAM0jB,oBAAoB8G,QAAQxqB,OAAMqL,eAAe,CAAGnH,EAAAA,EAAAA,CAAAA;AAAAA,IAC1E;AAAA,EACD,GACD+hB,IAAM;AACL,QAAI0H,cAAc;AAClB,QAAIC,WAAW5tB,OAAM6tB,QAAQ5wB,KAAKsuB,MAAAA;AAClC,SAAKvrB,OAAM0d,aAAakQ,QAAW,GAAA;AAClCD,oBAAc,IAAI3tB,OAAM0jB,oBAAoB0G;AAAAA,IAClD,OAAY;AACNuD,oBAAc,IAAI3tB,OAAM0jB,oBAAoB8G,QAAQoD;IACpD;AACD3wB,SAAKysB,OAAOiE,WACZ;AAAA,EAAA,GACDzH,MAAQ,WAAA;AACP,QAAI4H,WAAW9tB,OAAM+tB,QAAQ9wB,KAAKsuB;AAClC,QAAIvrB,OAAM0d,aAAaoQ,QAAW,GAAA;AACjC7wB,WAAKysB,OAAO,IAAI1pB,OAAM0jB,oBAAoB8G,QAAQsD,QAAAA,CAAAA;AAAAA,IAClD;AAAA,EACD,GAED,cAAc;AACb,QAAG9tB,OAAMkY,SAASjb,KAAKsuB,MAAYvrB,KAAAA,CAAAA,OAAMmc,QAAQlf,KAAKsuB,MAAAA,EAAQjR,OAAM;AACnEta,MAAAA,OAAM6U,KAAK5X,KAAKsuB,MAChB;AAAA,IAAA;AAAA,EACD,GACD,YAAY,WACX;AAAA,QAAGvrB,OAAMkY,SAASjb,KAAKsuB,WAAWvrB,OAAMmc,QAAQlf,KAAKsuB,MAAQjR,EAAAA,OAAM;AAClEta,MAAAA,OAAMguB,MAAM/wB,KAAKsuB;IACjB;AAAA,EACD,GACD,eAAe,WAAA;AACd,QAAIvrB,OAAMqrB,WAAWpuB,IAAO,GAAA;AAC3B;AAAA,IACA;AACD,QAAIgxB,SAASjuB,OAAMkuB,eAAejxB,KAAKsuB;AACvC,QAAGvrB,OAAM0d,aAAauQ,MAAYjuB,KAAAA,CAAAA,OAAM9B,UAAUjB,KAAKsuB,QAAQ0C,MAAAA,GAAQ;AACtE,UAAIlwB,SAASiC,OAAMmc,QAAQ8R,MAC3BlwB;AAAAA,aAAOuc,QAAQ;AACf,UAAIrZ,SAASjB,OAAMmuB,SAASlxB,KAAKsuB,YAAY0C,MAAAA;AAC7C,UAAGhtB,WAAW,MACbjB,CAAAA,OAAMouB,WAAWnxB,KAAKsuB,MACvB;AAAA,IAAA;AAAA,EACD,GACD,cAAc;AACb,QAAIvrB,OAAMqrB,WAAWpuB,IAAO,GAAA;AAC3B;AAAA,IACA;AACD,QAAIc,SAASiC,OAAM+rB,UAAU9uB,KAAKsuB;AAClC,QAAGvrB,OAAM0d,aAAa3f,MAAQ,GAAA;AAC7B,UAAIkD,SAAUjB,OAAMmuB,SAASlxB,KAAKsuB,QAAQvrB,OAAMyrB,aAAa1tB,MAAU,IAAA,GAAGiC,OAAM+rB,UAAUhuB,MAC1F,CAAA;AAAA,UAAGkD,WAAW,MACbjB,CAAAA,OAAMouB,WAAWnxB,KAAKsuB,MACvB;AAAA,IAAA;AAAA,EACD,GAGDvF,OAAS,SAAU7pB;AAClB,QAAK6D,CAAAA,OAAMquB,eAAepxB,KAAKsuB,MAAAA,GAAS;AACvCvrB,MAAAA,OAAMsuB,WAAWrxB,KAAKsuB;IAC5B,OAAY;AACNvrB,MAAAA,OAAMuuB,aAAatxB,KAAKsuB,MAAAA;AAAAA,IACxB;AAAA,EACD,GAGD,aAAa,SAAUpvB,GAAAA;AACtB6D,IAAAA,OAAMguB,MAAM/wB,KAAKsuB,MACjB;AAAA,EAAA,GAED,cAAc,SAAUpvB,GAAAA;AACvB6D,IAAAA,OAAM6U,KAAK5X,KAAKsuB,MAChB;AAAA,EAAA,GAGDjF,QAAU,SAAUnqB;AACnB,QAAI6D,OAAMqrB,WAAWpuB,IAAAA,GAAO;AAC3B;AAAA,IACA;AACD+C,IAAAA,OAAMwuB,OAAOC,QAAQ,QAAA,EAAUxxB,KAAKsuB,MAAAA;AAAAA,EACpC,GAGDzF,OAAS,WAAA;AACR,QAAI9lB,OAAMqrB,WAAWpuB,OAAO;AAC3B;AAAA,IACA;AACD+C,IAAAA,OAAM0uB,aAAazxB,KAAKsuB;EACxB,GAGD,cAAc;AACb,QAAIvrB,OAAMqrB,WAAWpuB,IAAO,GAAA;AAC3B;AAAA,IACA;AACD+C,IAAAA,OAAMsrB,WAAW,CAAA,GAAIruB,KAAKsuB;EAC1B,EAIJvrB,EAAAA,CAAAA;AAAAA,EAAAA,OAAM0jB,oBAAoB8G,QAAQ5xB,UAAUovB,QAAQhoB,OAAM0jB,oBAAoB8G,QAAQ5xB,UAAUolB,IAEjG;AAAA;AClQe,SAAQ2Q,UAAC3uB,QAGvBA;AAAAA,EAAAA,OAAM0jB,oBAAoByH,WAAW,SAAUI,QAAQ9nB,OAAAA;AACtD8nB,aAAStjB,mBAAmBsjB,QAAQvrB,OAAMuC,OAAOuV;AACjD,QAAKyT,CAAAA,QAAQ;AACZ,UAAIN,YAAYjrB,OAAMgY,YAAYhY,OAAMuC,OAAOuV;AAC/C,UAAImT,UAAU,IAAI;AACjBM,iBAASN,UAAU,CACnB;AAAA,MAAA;AAAA,IACD;AACDhuB,SAAKsuB,SAASA;AACdtuB,SAAK2xB,cAAcnrB,SAAS;AAE5B,QAAIzD,OAAM0d,aAAazgB,KAAKsuB,MAAAA,GAAS;AACpCtuB,WAAKwG,QAAQzD,OAAMyrB,aAAaxuB,KAAKsuB,MAAAA;AACrCtuB,WAAKyuB,cAAc1rB,OAAM2rB,mBAAmB1uB,KAAKsuB,MACjD;AAAA,IAAA;AAAA,EACH;AAECvrB,EAAAA,OAAM0jB,oBAAoByH,SAASvyB,YAAYoH,OAAM8oB,SACpD9oB,OAAM0jB,oBAAoB8G,SAC1B,EACCjD,WAAW,MACXluB,SAAS,WAAA;AAER,WAAO2G,OAAM0jB,oBAAoB8G,QAAQ5xB,UAAUS,QAAQP,KAAKmE,IAAAA,KAAAA,CAAAA,CAAW+C,OAAMuqB,eAAiBttB,EAAAA,KAAK2xB,WACvG;AAAA,EAAA,GACDnF,UAAU,WAAA;AAET,QAAI5yB,OAAOmJ,OAAM0jB,oBAAoB8G,QAAQ5xB,UAAU6wB,SAAS3wB,KAAKmE,IAAAA;AACrE,QAAIgE,SAASpK;AACb,QAAIA,gBAAgBmJ,OAAM0jB,oBAAoB8G,SAAS;AACtD,UAAIC,iBAAiBzqB,OAAMuqB,eAC3B;AAAA,UAAI9mB,QAAQxG,KAAK2xB;AACjB,aAAOnrB,SAAS,GAAG;AAClB,YAAIgnB,eAAehnB,KAAAA,EAClB;AACDA;AAAAA,MACA;AACD,UAAIgnB,eAAehnB,KAAQ,GAAA;AAC1BxC,iBAAS,IAAIjB,OAAM0jB,oBAAoByH,SAASt0B,KAAK00B,QAAQ9nB;MAC7D;AAAA,IACD;AAED,WAAOxC;AAAAA,EACP,GAEDypB,gBAAgB,SAASlsB,IACxB;AAAA,QAAA,CAAIwB,OAAMuC,OAAO2oB,2BAA0B;AAC1C,aAAO;AAAA,IACP;AAED,QAAIK,SAASvrB,OAAMisB,OAAOztB,EAC1B;AAAA,QAAGwB,OAAM0d,aAAa6N,MAAQ,GAAA;AAC7B,UAAI9nB,QAAQ;AACZ,UAAIknB,cAAckE,gBAA2BrwB,IAAI;AAEjD,UAAGmsB,aAAY;AACdlnB,gBAAQknB,YAAYtzB,aAAa,mBAAqB,IAAA;AAAA,MACtD;AAED,aAAO,IAAI2I,OAAM0jB,oBAAoByH,SAASI,QAAQ9nB;IAC3D,OAAS;AACJ,aAAO;AAAA,IACP;AAAA,EACD,GAEDumB,SAAS,WACR;AAAA,QAAIhqB,OAAM0d,aAAazgB,KAAKsuB,YAAYvrB,OAAMksB,cAAcjvB,KAAKsuB,MAAWvrB,KAAAA,OAAMuC,OAAOusB,+BAA+B;AACvH,UAAI9uB,OAAMuC,OAAO8nB,aAAarqB,OAAMmsB,OAAO;AAC1C,YAAI1P,MAAMzc,OAAMmsB,MAAMjxB,cAAc,gBAAgB8E,OAAMuC,OAAO6pB,iBAAiB,OAAOnvB,KAAKsuB,SAAS,IACvG;AAAA,YAAA,CAAI9O,IACH,QAAO;AACR,eAAOA,IAAIvhB,cAAc,yBAAuB+B,KAAK2xB,cAAY,IAAA;AAAA,MACvE,OAAY;AACN,eAAO5uB,OAAMia,YAAYhd,KAAKsuB,MAC9B;AAAA,MAAA;AAAA,IACD;AAAA,EACD,GAEDvN,MAAM,EACLiI,IAAM;AAEL,QAAI0H,cAAc;AAClB,QAAIC,WAAW5tB,OAAM6tB,QAAQ5wB,KAAKsuB,MAAAA;AAClC,SAAKvrB,OAAM0d,aAAakQ,QAAW,GAAA;AAClCD,oBAAc,IAAI3tB,OAAM0jB,oBAAoB0G,WAAWntB,KAAK2xB,WAAAA;AAAAA,IAClE,OAAY;AACNjB,oBAAc,IAAI3tB,OAAM0jB,oBAAoByH,SAASyC,UAAU3wB,KAAK2xB,WACpE;AAAA,IAAA;AACD3xB,SAAKysB,OAAOiE,WACZ;AAAA,EAAA,GACDzH,MAAQ,WACP;AAAA,QAAI4H,WAAW9tB,OAAM+tB,QAAQ9wB,KAAKsuB,MAClC;AAAA,QAAIvrB,OAAM0d,aAAaoQ,QAAW,GAAA;AACjC7wB,WAAKysB,OAAO,IAAI1pB,OAAM0jB,oBAAoByH,SAAS2C,UAAU7wB,KAAK2xB,WAAAA,CAAAA;AAAAA,IAClE;AAAA,EACD,GACD75B,MAAQ,WAAA;AACP,QAAIkI,KAAK2xB,cAAc,GAAG;AACzB3xB,WAAKysB,OAAO,IAAI1pB,OAAM0jB,oBAAoByH,SAASluB,KAAKsuB,QAAQtuB,KAAK2xB,cAAc,CACnF,CAAA;AAAA,IAAA;AAAA,EACD,GACD55B,OAAS,WAAA;AACR,QAAI8a,UAAU9P,OAAMuqB,eACpB;AAAA,QAAIttB,KAAK2xB,cAAc9e,QAAQ9W,SAAS,GAAG;AAC1CiE,WAAKysB,OAAO,IAAI1pB,OAAM0jB,oBAAoByH,SAASluB,KAAKsuB,QAAQtuB,KAAK2xB,cAAc;IACnF;AAAA,EACD,GAED7lB,KAAO,WACN;AAAA,QAAI+G,UAAU9P,OAAMuqB,eAAAA;AACpBttB,SAAKysB,OAAO,IAAI1pB,OAAM0jB,oBAAoByH,SAASluB,KAAKsuB,QAAQzb,QAAQ9W,SAAS,CAAA,CAAA;AAAA,EACjF,GACDmtB,MAAQ,WAAA;AACPlpB,SAAKysB,OAAO,IAAI1pB,OAAM0jB,oBAAoByH,SAASluB,KAAKsuB,QAAQ,CAChE,CAAA;AAAA,EAAA,GACDlF,UAAY,WACX;AAAA,QAAIrmB,OAAMsqB,oBAAAA,GAAuB;AAChCrtB,WAAKysB,OAAO,IAAI1pB,OAAM0jB,oBAAoByH,SAASnrB,OAAMqL,eAAerL,OAAMsqB,oBAAAA,IAAwB,CAAGpmB,EAAAA,IAAIjH,KAAK2xB,WAAAA,CAAAA;AAAAA,IAClH;AAAA,EACD,GACDxI,QAAU;AACT,QAAIpmB,OAAMsqB,uBAAuB;AAChCrtB,WAAKysB,OAAO,IAAI1pB,OAAM0jB,oBAAoByH,SAASnrB,OAAMqL,eAAe,CAAGnH,EAAAA,IAAIjH,KAAK2xB,WAAAA,CAAAA;AAAAA,IACpF;AAAA,EACD,EAMJ5uB,EAAAA,CAAAA;AAAAA,EAAAA,OAAM0jB,oBAAoByH,SAASvyB,UAAUovB,QAAQhoB,OAAM0jB,oBAAoB8G,QAAQ5xB,UAAUolB,IACjGhe;AAAAA,EAAAA,OAAM0jB,oBAAoByH,SAASvyB,UAAUovB,QAAQhoB,OAAM0jB,oBAAoByH,SAASvyB,UAAUolB,IAEnG;AAAA;AC3Ie,SAAQ+Q,OAAC/uB,QAAAA;AAAAA,GAEvB;AACC,QAAIgvB,cAAc,CAElB;AAAA,aAASC,UACR;AAAA,aAAA,CAAA,CAASD,YAAYh2B;AAAAA,IACrB;AAED,aAASk2B,WAAW/5B,KAAAA;AACnB0S,iBAAW,WACV;AAAA,YAAA,CAAKonB,QAAU,GAAA;AACd,cAAIjvB,CAAAA,OAAMmvB,YAAW;AACpBnvB,YAAAA,OAAM0oB,MACN;AAAA,UAAA;AAAA,QACD;AAAA,MACD,GAAE;IACH;AAED,aAAS0G,WAAWj6B,KAAAA;AACnB6K,MAAAA,OAAMqvB,YAAYl6B,KAAK,WAAWizB,SAAAA;AAClCpoB,MAAAA,OAAM1D,MAAMnH,KAAK,WAAWizB,SAC5B4G;AAAAA,kBAAY/yB,KAAK9G,GAAAA;AAAAA,IAEjB;AAED,aAASm6B;AACR,UAAIn6B,MAAM65B,YAAYhoB,IACtB;AAAA,UAAI7R,KAAK;AACR6K,QAAAA,OAAMqvB,YAAYl6B,KAAK,WAAWizB,SAAAA;AAAAA,MAClC;AACD8G,iBAEA;AAAA,IAAA;AAGD,aAASK,WAAWp6B,KAAAA;AACnB,aAAOA,OAAO65B,YAAYA,YAAYh2B,SAAS,CAC/C;AAAA,IAAA;AAED,aAASovB,UAAU9rB,QAAAA;AAClB,UAAIC,SAASD,OAAMkzB;AACnB,WAAKD,WAAWhzB,MAAAA,EAAS;AAEzByD,MAAAA,OAAM0jB,oBAAoB0E,UAAU7rB,QAAQD,MAC5C;AAAA,IAAA;AAED,aAASmzB,gBACRL;AAAAA,iBAAWpvB,OAAM0vB,YACjB,CAAA;AAAA,IAAA;AAED1vB,IAAAA,OAAMyE,YAAY,cAAcgrB,aAAAA;AAChCzvB,IAAAA,OAAMyE,YAAY,mBAAmB6qB,QACrCtvB;AAAAA,IAAAA,OAAMyE,YAAY,oBAAoB;AACrC6qB,eACAG;AAAAA,oBAAAA;AAAAA,IACH,CAGEzvB;AAAAA,IAAAA,OAAMyE,YAAY,oBAAoB;AACrCyqB,iBACH;AAAA,IAAA,CAAA;AAEElvB,IAAAA,OAAMyE,YAAY,kBAAkB,SAAUtP,KAC7Cw6B;AAAAA,gBAAAA;AACAP,iBAAWj6B,GAAAA;AAAAA,IACd,CACE6K;AAAAA,IAAAA,OAAMyE,YAAY,uBAAuB,WAAA;AACxC6qB,eACAM;AAAAA,mBAAAA;AAAAA,IACH,CAEE;AAAA,QAAIC,eAAe;AAEnB,aAASF,YACRE;AAAAA,qBAAe7vB,OAAM2B,MAAMC,IAAIzC,iBAC/B;AAAA,IAAA;AAED,aAASywB,eACR/nB;AAAAA,iBAAW;AACV,YAAIgoB,cAAc;AACjBA,uBAAanH,MACbmH;AAAAA,yBAAe;AAAA,QACf;AAAA,MACD,GAAE;IACH;AAED7vB,IAAAA,OAAM0jB,oBAAoBuL,UAAUA;AAAAA,EAGpC,GAxFD;AA0FD;AC5Fe,SAAQa,KAAC9vB,QAEvBA;AAAAA,EAAAA,OAAM0jB,oBAAoBiG,aAAa,EACtCoG,UAAU,OACVC,YAAY,MACZC,YAAY,IAAIjwB,OAAM0jB,oBAAoBmF,aAE1CqH,QAAQ,WACPjzB;AAAAA,SAAK8yB,WAAW;AAChB9yB,SAAK2sB,cAAc3sB,KAAKkzB,cACxB,CAAA;AAAA,EAAA,GAEDC,SAAS,WAAA;AACRnzB,SAAK8yB,WAAW;AAAA,EAChB,GAEDn4B,WAAW,WAAA;AACV,aAASqF,KAAK8yB;AAAAA,EACd,GAEDM,gBAAgB,WACf;AAAA,QAAIx5B;AACJ,QAAImJ,OAAMuC,OAAO2oB,2BAA2B;AAC3Cr0B,aAAO,IAAImJ,OAAM0jB,oBAAoByH;AAAAA,IACzC,OAAU;AACNt0B,aAAO,IAAImJ,OAAM0jB,oBAAoB8G;AAAAA,IACrC;AAED,QAAA,CAAK3zB,KAAKwC,QAAW,GAAA;AACpBxC,aAAOA,KAAK4yB,SACZ;AAAA,IAAA;AACD,WAAO5yB;AAAAA,EACP,GAEDy5B,gBAAgB,WAAA;AACfrzB,SAAK2sB,cAAc3sB,KAAKozB,eACxB,CAAA;AAAA,EAAA,GAEDF,eAAe,WAAA;AACd,QAAIt5B,OAAOoG,KAAK+yB;AAChB,QAAIn5B,SAASA,KAAKwC,QAAAA,GAAW;AAC5BxC,aAAOA,KAAK4yB,SACZ;AAAA,IAAA;AACD,WAAO5yB;AAAAA,EACP,GAED6zB,gBAAgB,SAASvuB;AACxB,QAAIo0B,SAAS,CACZvwB,OAAM0jB,oBAAoB8G,SAC1BxqB,OAAM0jB,oBAAoByH,UAC1BnrB,OAAM0jB,oBAAoB0G,UAAAA;AAE3B,aAAQrxB,IAAI,GAAGA,IAAIw3B,OAAOv3B,QAAQD,KAAI;AACrC,UAAGw3B,OAAOx3B,CAAGH,EAAAA,UAAU8xB,gBAAe;AACrC,YAAI7zB,OAAO05B,OAAOx3B,CAAGH,EAAAA,UAAU8xB,eAAevuB,CAAAA;AAC9C,YAAGtF,KAAM,QAAOA;AAAAA,MAChB;AAAA,IACD;AACD,WAAO;AAAA,EACP,GAED25B,iBAAiB,WAAA;AAChBvzB,SAAKwzB,SAASxzB,KAAKgzB,UAAAA;AACnBhzB,SAAKqC,UAAUrC,KAAKgzB,UACpB;AAAA,EAAA,GAEDrG,eAAe,SAAUprB;AAExB,QAAIkyB,eAAe;AACnB,QAAIzzB,KAAK+yB,YAAY;AACpB,UAAI/yB,KAAK+yB,WAAWnG,UAAUrrB,EAAAA,GAAK;AAClCkyB,uBAAe;AAAA,MACf;AAAA,IACD;AACD,QAAIzzB,KAAKrF,aAAa;AACrB,UAAG84B,aACFzzB,MAAKwzB,SAASxzB,KAAK+yB;AAEpB/yB,WAAK+yB,aAAaxxB;AAClBvB,WAAKqC,UAAUrC,KAAK+yB,aAAaU,YACjC;AAAA,IAAA;AAAA,EACD,GAEDpxB,WAAW,SAAUd,IAAI8tB,WACxB;AAAA,QAAI9tB,MAAMA,GAAGkqB,OAAO;AACnBlqB,SAAGkqB,MAAM4D,SAAAA;AAAAA,IACT;AAAA,EACD,GACDmE,UAAU,SAAUjyB,IACnB;AAAA,QAAIA,MAAMA,GAAGuqB,MAAM;AAClBvqB,SAAGuqB,KACH;AAAA,IAAA;AAAA,EACD,GAED4H,gBAAgB,SAAUx0B;AAEzB,QAAI6D,OAAM0jB,oBAAoBuL,QAAAA,EAC7B;AAED,QAAA,CAAKhyB,KAAKrF,UACT,EAAA;AAED,QAAGuE,EAAEy0B,kBAAiB;AACrB;AAAA,IACA;AAED,QAAIC,YAAY5zB,KAAKgzB;AAErB,QAAIxL,UAAUzkB,OAAM0jB,oBAAoBC,UAAUkB,oBAAoB1oB,CAAAA;AAEtE,QAAIiD,gBAAgBnC,KAAKkzB,cACzB;AAAA,QAAIxI,cAAc3nB,OAAM0jB,oBAAoBkE;AAC5C,QAAGD,YAAY3iB,UAAU,aAAa,CAACyf,SAAStoB,CAAAA,CAAAA,MAAQ,OAAM;AAC7D;AAAA,IACA;AAED,SAAKiD,eAAe;AACnBnC,WAAKqzB,eACL;AAAA,IAAA,WAAUlxB,cAAcooB,YAAY/C,OAAU,GAAA;AAC9CrlB,oBAAcsoB,SAASjD,SAAStoB,CAChC;AAAA,IAAA,WAAU00B,UAAUrJ,YAAY/C,OAAAA,GAAU;AAC1CoM,gBAAUnJ,SAASjD,SAAStoB,CAAAA;AAAAA,IAC5B;AAAA,EAED,GACD20B,UAAU,MACVC,aAAa;AACZ,WAAO9zB,KAAK6zB,aAAa;AAAA,EACzB,GACDvpB,OAAO,SAASxC,UAAUwC,QAAAA;AAEzBO,iBAAa7K,KAAK6zB,QAAAA;AAClB7zB,SAAK6zB,WAAWjpB,WAAW7H,OAAM4E,KAAK,WAAA;AACrC3H,WAAK6zB,WAAW;AAChB/rB,eAAAA;AAAAA,IACA,GAAE9H,IAASsK,GAAAA,UAAS;EAErB,GACDypB,YAAY;AACXlpB,iBAAa7K,KAAK6zB,QAClB;AAAA,EAAA,EAAA;AAGH;AC/He,SAAQG,oBAACjxB,QACvB;AAAA,WAASkxB,YAAYlxB,QAAAA;AACpBA,IAAAA,OAAMuC,OAAO0uB,sBAAsB;AACnCjxB,IAAAA,OAAMuC,OAAO2oB,4BAA4B;AAEzClrB,IAAAA,OAAM0jB,sBAAsB;AAE5B1jB,IAAAA,OAAM8oB,WAAW,WAAA;AAChB,UAAItD,QAAQ7sB,MAAMC,UAAUC,MAAMC,KAAK+K,WAAW;AAClD,UAAI2b,MAAM,CAAA;AACV,eAAQzmB,IAAI,GAAGA,IAAIysB,MAAMxsB,QAAQD,KAAI;AACpC,YAAIiD,MAAMwpB,MAAMzsB;AAChB,YAAUiD,OAAAA,OAAO,YAAW;AAC3BA,gBAAM,IAAIA;AAAAA,QACV;AAED,iBAAQm1B,KAAKn1B,KAAI;AAChBwjB,cAAI2R,CAAKn1B,IAAAA,IAAIm1B;QACb;AAAA,MACD;AACD,aAAO3R;AAAAA,IACV;AAEEiE,uBAAmBzjB;AACnBqnB,iBAAarnB,MAAAA;AACbkoB,qBAAiBloB,MACjB4oB;AAAAA,eAAW5oB;AACXupB,aAASvpB,MAAAA;AACTmqB,gBAAYnqB,MAAAA;AACZwrB,aAASxrB,MAAAA;AACT2uB,cAAU3uB,MACV+uB;AAAAA,WAAO/uB;AACP8vB,SAAK9vB,MAAAA;AAAAA,KAGL;AACC,UAAI2pB,aAAa3pB,OAAM0jB,oBAAoBiG;AAE3CA,iBAAWyH,gBAAgB,SAASltB,IAAAA;AACnC,YAAIrN,OAAO8yB,WAAWqG;AACtB,YAAGn5B,gBAAgBmJ,OAAM0jB,oBAAoB8G,WAAW3zB,gBAAgBmJ,OAAM0jB,oBAAoByH,UAAU;AAC3G,cAAIt0B,KAAK00B,UAAUrnB,IAAI;AACtB,mBAAO;AAAA,UACP;AAAA,QACD;AACD,eAAO;AAAA,MACX;AAEG,UAAIysB,iBAAiB,SAASx0B,GAAAA;AAC7B,aAAI6D,OAAMuC,OAAO0uB,oBAAqB;AAEtC,YAAIjxB,CAAAA,OAAMuC,OAAO2oB,6BAA6BmG,mBAAmBl1B,CAAI,EAAA;AAErE,YAAIm1B,8BAA8Bn1B,MAAMo1B,kBAAkBp1B,CAAAA,GAAG;AAC5D;AAAA,QACA;AAED,eAAOwtB,WAAWgH,eAAex0B,CAAAA;AAAAA,MACrC;AAEG,UAAIq1B,eAAe,SAASr1B,GAC3B;AAAA,YAAGwtB,WAAW8H,iBAAgB;AAC7Bt1B,YAAE0rB;AACF7nB,UAAAA,OAAMsM,WAAWyc,KACjB;AAAA,iBAAO;AAAA,QAEZ,YAAgBY,WAAWoH,YAAAA,GAAe;AAErCpH,qBAAW6G,gBACX;AAAA,QAAA;AAAA,MAEL;AAEG,UAAIkB,oBAAoB;AACvB,YAAI/H,CAAAA,WAAW/xB,YACd;AAED,cAAM+5B,eAAgBC,CAAAA,UAAqBv8B,SAAS+J,eAAeY,OAAMsM,UAAejX,KAAAA,SAAS+J,cAAcyyB,aAAa;AAC5H,YAAI7B,aAAarG,WAAWwG,cAC5B;AAAA,YAAA,CAAIH,cAAc2B,aACjB;AAED,YAAIG,aAAa9B,WAAWhG,QAC5B;AAAA,YAAIl1B,KAAKC;AACT,YAAG+8B,cAAcA,WAAWt8B,YAAW;AACtCV,gBAAMg9B,WAAWt8B,WAAWC;AAC5BV,iBAAO+8B,WAAWt8B,WAAWI;AAAAA,QAE7B;AAEDo6B,mBAAWtH,MAAM,IAAA;AAEjB,YAAGoJ,cAAcA,WAAWt8B,YAAW;AACtCs8B,qBAAWt8B,WAAWC,YAAYX;AAClCg9B,qBAAWt8B,WAAWI,aAAab;AAAAA,QACnC;AAAA,MACL;AAGGiL,MAAAA,OAAMyE,YAAY,gBAAgB,WACjC;AAAA,YAAA,CAAIzE,OAAMuC,OAAO0uB,oBAAqB;AACtCS,0BAAAA;AAAAA,MACJ,CAEG1xB;AAAAA,MAAAA,OAAMyE,YAAY,iBAAiB;AAElC,YAAIzE,CAAAA,OAAMgC,MAAO;AACjBhC,QAAAA,OAAMqvB,YAAYrvB,OAAMgC,OAAO,WAAW2uB,cAAAA;AAC1C3wB,QAAAA,OAAMqvB,YAAYrvB,OAAMsM,YAAY,SAASklB,YAC7CxxB;AAAAA,QAAAA,OAAMqvB,YAAYrvB,OAAMsM,YAAY,aAAaylB,gBAAAA;AAEjD,YAAG/xB,OAAMuC,OAAO0uB,qBAAoB;AAEnCjxB,UAAAA,OAAM1D,MAAM0D,OAAMgC,OAAO,WAAW2uB;AACpC3wB,UAAAA,OAAM1D,MAAM0D,OAAMsM,YAAY,SAASklB,YAAAA;AACvCxxB,UAAAA,OAAM1D,MAAM0D,OAAMsM,YAAY,aAAaylB,gBAAAA;AAC3C/xB,UAAAA,OAAMsM,WAAW2d,aAAa,YAAY,GAAA;AAAA,QAE/C,OAAS;AACJjqB,UAAAA,OAAMsM,WAAW0lB,gBAAgB;QACjC;AAAA,MACL,CAAA;AAEG,eAASC,yBACR;AAAA,YAAIjyB,OAAMuC,OAAO2oB,2BAA2B;AAC3C,iBAAOlrB,OAAM0jB,oBAAoByH;AAAAA,QACtC,OAAW;AACN,iBAAOnrB,OAAM0jB,oBAAoB8G;AAAAA,QACjC;AAAA,MACD;AAED,eAAS6G,mBAAmBl1B;AAC3B,eAAS+1B,CAAAA,CAAAA,QAAmB/1B,EAAEI,QAAQ,gCAAA;AAAA,MACtC;AAED,eAAS+0B,8BAA8Bn1B,GACtC;AAAA,eAAA,CAAA,CAAS+1B,QAAmB/1B,EAAEI,QAAQ,yBACtC;AAAA,MAAA;AACD,eAASg1B,kBAAkBp1B,GAAAA;AAC1B,iBAAS+1B,QAAmB/1B,EAAEI,QAAQ,kBAAA;AAAA,MACtC;AAED,eAASw1B,iBAAiB51B,GACzB;AAAA,YAAA,CAAI6D,OAAMuC,OAAO0uB,oBAAqB,QAAO;AAE7C,YAAA,CAAIjxB,OAAMuC,OAAO2oB,6BAA6BmG,mBAAmBl1B,GAAI,QAAO;AAE5E,YAAIm1B,8BAA8Bn1B,CAAG,GAAA;AACpC;AAAA,QACA;AAED,YAAImD;AACJ,YAAI6yB,aAAaxI,WAAWe,eAAevuB,CAC3C;AAAA,YAAGg2B,YAAW;AAEb,cAAGxI,WAAWqG,sBAAsBhwB,OAAM0jB,oBAAoByH,YAAYyG,UAAqBz1B,EAAEI,QAAQyD,OAAMsN,KAAAA,GAAO;AACrH6kB,yBAAa,IAAInyB,OAAM0jB,oBAAoByH,SAASgH,WAAW5G,QAAQ5B,WAAWqG,WAAWpB;UAC7F;AACDtvB,sBAAY6yB;AAIZ,gBAAMC,cAAcpyB,OAAMuC,OAAO8nB,aAAarqB,OAAMoM,IAAIC,QAAQ,MAAA;AAChE,cAAG+lB,eAAepyB,OAAMuC,OAAO2oB,2BAA0B;AACxD,kBAAMF,UAAU7uB,EAAEI,OAAO1B,UAAUC,SAAS,WAC5C;AAAA,kBAAMu3B,UAAUl2B,EAAEI,OAAO4B,QAAQ,kBAEjC;AAAA,kBAAMm0B,WAAWtyB,OAAM2B,MAAMC,IAAIhN,gBAAgBoL,OAAMmsB,KAAAA,EAAO11B;AAC9D,kBAAM87B,YAAYD,WAAWtyB,OAAMmsB,MAAMn2B;AACzC,kBAAMw8B,eAAexyB,OAAM2B,MAAMC,IAAIhN,gBAAgBS,SAAS+J,eAAe3I;AAC7E,kBAAMg8B,aAAaD,eAAeF,YAAYC,YAAYC;AAE1D,gBAAIxH,WAAYqH,WAAWI,YAAY;AACtC,kBAAI3jB,iBAAiB9O,OAAMmsB,MAAMv2B;AACjC,oBAAM88B,gBAAgB5jB,iBAAiB9O,OAAMmsB,MAAMn2B;AACnD,kBAAI28B,YAAY;AAChB,kBAAI3H,SAAQ;AACXlc,iCAAiB9O,OAAM2B,MAAMC,IAAInE,yBAAyBtB,GAAG6D,OAAMmsB,KAAAA,EAAO11B;AAAAA,cAC1E;AACD,uBAASsC,IAAI,GAAGA,IAAIiH,OAAMuC,OAAOuN,QAAQ9W,QAAQD,KAAK;AACrD,sBAAM65B,SAAS5yB,OAAMuC,OAAOuN,QAAQ/W;AACpC,oBAAI65B,OAAOC,MAAK;AACf;AAAA,gBACA;AACDF,6BAAaC,OAAOl8B;AACpB,oBAAIoY,iBAAiB6jB,WAAU;AAC9B,sBAAID,gBAAgBC,WAAU;AAC7BA,iCAAaC,OAAOl8B;AAAAA,kBACpB;AACD4I,4BAAUsvB,cAAc71B;AACxB;AAAA,gBACA;AAAA,cACD;AAAA,YACD;AAAA,UACD;AAAA,QACD;AACD,YAAIuG,WAAW;AACd,cAAA,CAAKqqB,WAAW/xB,UAAAA,GAAa;AAC5B+xB,uBAAWqG,aAAa1wB;AAAAA,UAC9B,OAAY;AACNqqB,uBAAWpiB,MAAM,WAChBoiB;AAAAA,yBAAWC,cAActqB,SAAAA;AAAAA,YAChC,CACM;AAAA,UAAA;AAAA,QACN,OAAW;AAENqqB,qBAAW8H,kBAAkB;AAC7B5pB,qBAAW;AACV8hB,uBAAW8H,kBAAkB;AAAA,UAC7B,GAAE,GACH;AAAA,QAAA;AAAA,MACD;AAED,UAAIqB,UAAU9yB,OAAMyE,YAAY,gBAAgB,WAAA;AAE/CzE,QAAAA,OAAMqF,YAAYytB,OAAAA;AAElB9yB,QAAAA,OAAM+yB,MAAMC,WAAWvuB,YAAY,kBAAkB,SAASP,IAAAA;AAC7D,cAAIlE,OAAMuC,OAAO0uB,uBAAuBtH,WAAW/xB,UAAAA,GAAa;AAC/D,kBAAMq7B,cAActJ,WAAWwG;AAC/B,kBAAMhD,OAAOntB,OAAMoM,IAAIC,QAAQ;AAC/B,gBAAK8gB,CAAAA,QAAAA,CAASA,KAAKP,YAAW;AAC7B;AAAA,YACA;AACD,kBAAM93B,MAAMq4B,KAAK1hB,WAAWvH,EAAAA;AAC5B,kBAAMgvB,oBAAoB/F,KAAKP,WAAWn3B;AAC1C,kBAAM09B,uBAAuBD,oBAAoB/F,KAAKP,WAAW13B,sBAAwByB,EAAAA;AACzF,gBAAGs8B,eAAeA,YAAY1H,UAAUrnB,IAAG;AAE1C,kBAAGgvB,qBAAqBp+B,OAAOq+B,wBAAwBr+B,KAAI;AAC1D48B;cACA;AAAA,YACD;AAAA,UACD;AAAA,QACN,CAEI;AAAA,YAAG1xB,OAAMozB,eAAc;AACtB,cAAIC,eAAerzB,OAAMozB,cAAcE;AACvCtzB,UAAAA,OAAMozB,cAAcE,eAAe,SAASC,WAAWC,OAAAA;AACtD,gBAAGxzB,OAAMuC,OAAO0uB,uBAAuBtH,WAAW/xB,UAAY,GAAA;AAC7D,kBAAIq7B,cAActJ,WAAWwG;AAC7B,kBAAG8C,eAAeA,YAAY1H,WAAWjuB,QAAU;AAClD,oBAAIm2B,qBAAqB;AACzB,yBAAQ16B,IAAI,GAAGA,IAAIy6B,MAAMx6B,QAAQD,KAAI;AACpC,sBAAGy6B,MAAMz6B,GAAGmL,MAAM+uB,YAAY1H,UAAUiI,MAAMz6B,CAAAA,EAAGqW,YAAW;AAC3DqkB,yCAAqB;AACrB;AAAA,kBACA;AAAA,gBACD;AACD,qBAAIA,oBAAmB;AACtBD,wBAAMv3B,KAAK+D,OAAMmc,QAAQ8W,YAAY1H,MAAAA,CAAAA;AAAAA,gBACrC;AAAA,cACD;AAAA,YACD;AACD,gBAAI/L,MAAM6T,aAAan2B,MAAMD,MAAM4G,SAEnC;AAAA,mBAAO2b;AAAAA,UACb;AAAA,QACK;AAAA,MACL,CAGG;AAAA,UAAIkU,gBAAgB;AACpB,UAAIC,qBAAqB;AACzB3zB,MAAAA,OAAMyE,YAAY,iBAAiB,SAAU2G;AAC5CsoB,wBAAgBtoB,KAAKlH;AACrB,eAAO;AAAA,MACX,CAAA;AAEGlE,MAAAA,OAAMyE,YAAY,kBAAkB,SAASP,IAAG2C,MAAAA;AAC/C,aAAI7G,OAAMuC,OAAO0uB,oBAAqB,QAAO;AAC7C,YAAGtH,WAAW/xB,UAAY,GAAA;AAGzB,cAAIsM,MAAMwvB,eAAe;AACxBC,iCAAqB;AACrB9rB,uBAAW,MAAA;AACV8rB,mCAAqB;AACrBD,8BAAgB;AAAA,YAAI,CAAA;AAAA,UAErB;AACD,cAAIC,sBAAsB9sB,KAAKqI,QAAQlP,OAAMuC,OAAOqxB,MAAMC,aAAa;AACtE;AAAA,UACA;AAED,cAAIjF,cAAc;AAClB,cAAI/3B,OAAO8yB,WAAWqG;AACtB,cAAGn5B,gBAAgBmJ,OAAM0jB,oBAAoByH,UAAS;AACrDyD,0BAAc/3B,KAAK+3B;AAAAA,UACnB;AACD,cAAIkF,kBAAkB7B,uBAEtB;AAAA,cAAIprB,KAAKqI,QAAQlP,OAAMuC,OAAOqxB,MAAMC,eAAe7zB,OAAMuC,OAAOwxB,iBAAiBC,kBAAkB;eAE5F;AACNrK,uBAAWC,cAAc,IAAIkK,gBAAgB5vB,IAAI0qB;UACjD;AAAA,QAGD;AAAA,MACL;AAEG5uB,MAAAA,OAAMyE,YAAY,kBAAkB,SAASwvB,OAAOC,OACnD;AAAA,YAAA,CAAIl0B,OAAMuC,OAAO0uB,oBAAqB,QAAO;AAE7C,YAAIp6B,OAAO8yB,WAAWqG;AACtB,YAAGrG,WAAWyH,cAAc6C,KAAO,GAAA;AAClCp9B,eAAK00B,SAAS2I;AAAAA,QACd;AAED,eAAO;AAAA,MACX,CAEG;AAAA,UAAIC,WAAWC,YAAY,WAAA;AAC1B,YAAIp0B,CAAAA,OAAMuC,OAAO0uB,oBAAqB;AACtC,YAAItH,CAAAA,WAAW/xB,UAAY,GAAA;AAC1B+xB,qBAAWuG,OAAAA;AAAAA,QACX;AACD;AAAA,MACA,GAAE,GAEHlwB;AAAAA,MAAAA,OAAMyE,YAAY,aAAa;AAC9B4vB,sBAAcF,QAAAA;AAAAA,MAClB;AAEG,eAASG,aAAat4B;AACrB,YAAGA,eAAegE,OAAM0jB,oBAAoBmF,WAAU;AACrD,iBAAO;AAAA,QACP,WAAQ7sB,eAAegE,OAAM0jB,oBAAoB0G,YAAW;AAC5D,iBAAO;AAAA,QACP,WAAQpuB,eAAegE,OAAM0jB,oBAAoB8G,SAAQ;AACzD,iBAAO;AAAA,QACP,WAAQxuB,eAAegE,OAAM0jB,oBAAoByH,UAAS;AAC1D,iBAAO;AAAA,QACP;AACD,eAAO;AAAA,MACP;AAED,eAASoJ,SAASC,MAAAA;AACjB,YAAIC,SAAS,EACZz0B,OAAQA,OAAM0jB,oBAAoBmF,WAClC6L,YAAc10B,OAAM0jB,oBAAoB0G,YACxCY,SAAWhrB,OAAM0jB,oBAAoB8G,SACrCmK,UAAY30B,OAAM0jB,oBAAoByH,SAGvC;AAAA,eAAOsJ,OAAOD,IAAAA,KAASC,OAAOz0B;AAAAA,MAC9B;AAED,eAAS40B,uBAAuBC,YAC/B;AAAA,YAAI/kB,UAAU9P,OAAMuqB;AACpB,iBAASxxB,IAAI,GAAGA,IAAI+W,QAAQ9W,QAAQD,KAAI;AACvC,cAAG+W,QAAQ/W,CAAAA,EAAGuB,QAAQu6B,YAAW;AAChC,mBAAO97B;AAAAA,UACP;AAAA,QACD;AACD,eAAO;AAAA,MACP;AAED,UAAI+7B,eAAe,CAAA;AACnBnrB,oBAAUmrB,YAAAA;AACV90B,MAAAA,OAAMyP,MAAMqlB,cAAc,EACzBC,aAAa,SAAS5Q,UAAUpgB,SAASlE,QACxC;AAAA,YAAIm1B,cAAcT,SAAS10B,MAAAA;AAC3B,YAAGm1B,aAAY;AACdA,sBAAYp8B,UAAUgM,KAAKuf,UAAUpgB,OACrC;AAAA,QAAA;AAAA,MACD,GACDkxB,oBAAoB,SAAS9Q,UAAUtkB,QAAAA;AACtC,YAAIukB,WAAWpkB,OAAM0jB,oBAAoBC,UAAUhP,MAAMwP,QACzD;AAAA,YAAGC,SAASprB,QAAO;AAClB,iBAAO87B,aAAaI,kBAAkB9Q,SAAS,CAAA,GAAIvkB;QACnD;AAAA,MACD,GACDq1B,mBAAmB,SAASzQ,SAAS5kB,QAAAA;AACpC,YAAIm1B,cAAcT,SAAS10B;AAC3B,YAAGm1B,aAAY;AACd,cAAGvQ,SAAQ;AACV,mBAAOuQ,YAAYp8B,UAAU4uB,YAAY/C,OACzC;AAAA,UAAA;AAAA,QACD;AAAA,MACD,GACD0Q,gBAAgB,SAAShR,UAAUtkB,QAClC;AAAA,YAAIm1B,cAAcT,SAAS10B,MAC3B;AAAA,YAAGm1B,aAAY;AACdA,sBAAYp8B,UAAUmvB,OAAO5D,QAAAA;AAAAA,QAC7B;AAAA,MACD,GACDuE,OAAO,SAASnmB,SAAAA;AACf,YAAI2M,OAAO3M,UAASA,QAAO2M,OAAO;AAClC,YAAIkmB,cAAcb,SAASrlB;AAC3B,YAAIrY;AACJ,gBAAQqY,MAAAA;AAAAA,UACP,KAAK;AACJrY,mBAAO,IAAIu+B,YAAY7yB,QAAO2B,IAAI0wB,uBAAuBryB,QAAOqwB,MAChE,CAAA;AAAA;AAAA,UACD,KAAK;AACJ/7B,mBAAO,IAAIu+B,YAAY7yB,QAAO2B,EAAAA;AAC9B;AAAA,UACD,KAAK;AACJrN,mBAAO,IAAIu+B,YAAYR,uBAAuBryB,QAAOqwB,MAAAA,CAAAA;AACrD;AAAA,QAKFjJ;AAAAA,mBAAWpiB,MAAM,WAChB;AAAA,cAAG1Q,MAAK;AACP8yB,uBAAWC,cAAc/yB,IAChC;AAAA,UAAA,OAAW;AACJ8yB,uBAAWuG,OACX;AAAA,gBAAA,CAAIvG,WAAWwG,cAAgB,GAAA;AAE9BxG,yBAAW2G,eACnB;AAAA,YAAA,OAAY;AAEJ,kBAAI3G,CAAAA,WAAWoH,YAAc,GAAA;AAC5BpH,2BAAWuG,OAAAA;AAAAA,cACX;AAAA,YAED;AAAA,UACD;AAAA,QAEP;MACK,GAEDC,eAAe;AACd,YAAGxG,WAAW/xB,UAAY,GAAA;AACzB,cAAIf,OAAO8yB,WAAWwG,cACtB;AAAA,cAAItwB,SAAQy0B,aAAaz9B,IACzB;AAAA,cAAIiZ,UAAU9P,OAAMuqB,eAAAA;AACpB,kBAAQ1qB,QAAAA;AAAAA,YACP,KAAK;AACJ,qBAAO,EAACqP,MAAK,YAAYhL,IAAGrN,KAAK00B,QAAQqH,QAAO9iB,QAAQjZ,KAAK+3B,WAAAA,EAAat0B,KAC3E;AAAA,YAAA,KAAK;AACJ,qBAAO,EAAC4U,MAAK,WAAWhL,IAAGrN,KAAK00B,OACjC;AAAA,YAAA,KAAK;AACJ,qBAAO,EAACrc,MAAK,cAAc0jB,QAAO9iB,QAAQjZ,KAAK4M,KAAOnJ,EAAAA,KAAAA;AAAAA,UAAAA;AAAAA,QAExD;AACD,eAAO;AAAA,MACP,EAGF0F,CAAAA;AAAAA,MAAAA,OAAM0jB,oBAAoBkE,SAASkN;AAEnC90B,MAAAA,OAAMoC,IAAIizB,qBAAqBP;AAC/B90B,MAAAA,OAAM0oB,QAAQ;AACboM,qBAAapM,MAAAA;AAAAA,MACjB;AACG1oB,MAAAA,OAAM+0B,cAAcD,aAAaC;AACjC/0B,MAAAA,OAAMi1B,qBAAqBH,aAAaG;AACxCj1B,MAAAA,OAAMm1B,iBAAiBL,aAAaK;AAAAA,IACpC,GAlaD;AAAA,EAqaA;AAEDjE,cAAYlxB;AAIb;AC7de,SAAQs1B,OAACt1B,QAExB;AAAA,MAAA,CAAIA,OAAMu1B,UAAU;AACnBv1B,IAAAA,OAAMu1B,WAAWv1B,OAAMw1B,gBAAgB,EACtCl7B,MAAM,UACNm7B,UAAU,SAAUH,SAAAA;AACnBA,MAAAA,QAAOpxB,KAAKoxB,QAAOpxB,MAAMlE,OAAM01B,IAC/B;AAAA,aAAOJ;AAAAA,IACP,EAEH,CAAA;AAAA,EAAA;AAEAt1B,EAAAA,OAAMuC,OAAOozB,eAAe;AAE5B,WAASC,cAAcN,SAAAA;AACtB,QAAIt1B,CAAAA,OAAMuC,OAAOozB,aAChB,QAAO;AAER,QAAA,CAAIL,QAAOlmB,WACV,QAAO;AAER,QAAIvO,QAAQb,OAAMwK,SAAAA;AAClB,QAAI8qB,CAAAA,QAAOlmB,cAAcvO,MAAM4J,SAC9B;AACD,SAAA,CAAK6qB,QAAOjmB,YAAAA,CAAaimB,QAAOjmB,WAAYxO,CAAAA,MAAMyQ,aAAcgkB,CAAAA,QAAOlmB,aAAcvO,CAAAA,MAAMyQ,SAC1F;AAED,QAAI9X,MAAMnE,SAASoE,cAAc;AAEjCD,QAAIywB,aAAa,kBAAkBqL,QAAOpxB,EAE1C;AAAA,QAAIvI,MAAM;AACV,QAAGqE,OAAMmS,UAAU0jB,aAClBl6B,QAAO,MAAMqE,OAAMmS,UAAU0jB,aAAaP,OAAAA;AAE3C,QAAGA,QAAO35B,KAAI;AACbA,aAAO,MAAM25B,QAAO35B;AAAAA,IACpB;AAED,QAAGqE,OAAMmS,UAAU0jB,aAClBl6B,QAAO,MAAMqE,OAAMmS,UAAU0jB,aAAaP;AAE3C,QAAGA,QAAOtkB,OAAM;AACfxX,UAAIwX,QAAQskB,QAAOtkB;AAAAA,IACnB;AACDxX,QAAIQ,YAAY2B;AAEhB,QAAImN,QAAQ9I,OAAMmpB,YAAYmM,QAAOlmB,UAAAA;AACrC5V,QAAIvC,MAAMlC,OAAO+T,QAAQ;AACzB,QAAIgtB,eAAev/B,KAAKuD,IAAIkG,OAAM+1B,UAAU/1B,OAAMsqB,oBAAwB,CAAA,GAAA,CAAA,IAAK;AAC/E,QAAItqB,OAAMuC,OAAOyzB,wBAAwBh2B,OAAMiM,YAAW;AACzD6pB,qBAAe91B,OAAMiM,WAAWgqB,eAAe;AAAA,IAC/C;AACDz8B,QAAIvC,MAAMN,SAASm/B;AACnB,QAAGR,QAAOjmB,UAAS;AAClB,UAAItG,MAAM/I,OAAMmpB,YAAYmM,QAAOjmB,QACnC7V;AAAAA,UAAIvC,MAAMP,QAAQH,KAAKuD,IAAKiP,MAAMD,OAAQ,CAAK,IAAA;AAAA,IAE/C;AAED,QAAGwsB,QAAOhd,MAAK;AACd9e,UAAI8B,YAAY,wCAAwCg6B,QAAOhd,OAAO;AAAA,IACtE;AAED,WAAO9e;AAAAA,EACR;AAEA,WAAS08B,iBAAAA;AAER,QAAIl2B,CAAAA,OAAMiM,cAAejM,CAAAA,OAAMgC,MAAMlH,SAASkF,OAAMiM,aAAY;AAC/DjM,MAAAA,OAAMm2B,eAAe;AACrB;AAAA,IACA;AAGD,QAAGn2B,OAAMm2B,gBAAgBn2B,OAAMiM,WAAWnR,SAASkF,OAAMm2B,YAAc,GAAA;AACtE;AAAA,IACA;AAED,QAAIC,aAAa/gC,SAASoE,cAAc,KAAA;AACxC28B,eAAWp8B,YAAY;AACvBgG,IAAAA,OAAMiM,WAAWtS,YAAYy8B;AAC7Bp2B,IAAAA,OAAMm2B,eAAeC;AAAAA,EACtB;AAEAp2B,EAAAA,OAAMyE,YAAY,uBAAuB,WACxC;AAAA,QAAA,CAAIzE,OAAMm2B,aACTD,gBACF;AAAA,EAAA,CAAA;AAEAl2B,EAAAA,OAAMyE,YAAY,gBAAgB,WACjC;AAAA,QAAA,CAAIzE,OAAMm2B,cAAa;AACtBD,qBACAl2B;AAAAA,MAAAA,OAAMq2B;IACN;AAAA,EACF,CAAA;AAEAr2B,EAAAA,OAAMyE,YAAY,sBAAsB,WAGvCzE;AAAAA,IAAAA,OAAMyE,YAAY,uBAAuB;AAGxC,UAAIzE,OAAMm2B,cAAc;AACvBn2B,QAAAA,OAAMm2B,aAAa76B,YAAY;AAAA,MAC/B;AACD46B,qBAEA;AAAA,UAAII,SAASt2B,OAAMc,UAAUC,WAAW,QAAA;AACxC,UAAIw1B,iBAAiBD,OAAOE,iBAAiB,EAC5Cl8B,MAAM,UACNm8B,kBAAkB,WAAY;AAAA,eAAOz2B,OAAMm2B;AAAAA,MAAa,EAAA,CAAA;AAEzDI,qBAAeG,SAASd,aAC1B;AAAA,IAAA,GAAI,EAACzxB,MAAM,KAAA,CAAA;AAAA,EACX,CAEAnE;AAAAA,EAAAA,OAAM22B,YAAY,SAASzyB;AAC1B,QAAIjH,CAAAA,KAAKs4B,SAAU,QAAO;AAE1B,WAAOt4B,KAAKs4B,SAASqB,QAAQ1yB,EAAAA;AAAAA,EAC9B;AAEAlE,EAAAA,OAAM62B,YAAY,SAASvB,SAAAA;AAC1B,WAAOr4B,KAAKs4B,SAASuB,QAAQxB,OAC9B;AAAA,EAAA;AAEAt1B,EAAAA,OAAM+2B,eAAe,SAAS7yB,IAAAA;AAC7B,SAAIjH,KAAKs4B,SAASyB,OAAO9yB,EACxB,EAAA,QAAO;AAERjH,SAAKs4B,SAAS0B,WAAW/yB,EAAAA;AACzB,WAAO;AAAA,EACR;AACAlE,EAAAA,OAAMk3B,eAAe,SAAShzB,IAAAA;AAC7BjH,SAAKs4B,SAAS4B,QAAQjzB,EACvB;AAAA,EAAA;AAEAlE,EAAAA,OAAMo3B,cAAc,WACnB;AAAA,WAAOn6B,KAAKs4B,SAAS8B,SAAAA;AAAAA,EACtB;AAEAr3B,EAAAA,OAAMq2B,gBAAgB;AACrBp5B,SAAKs4B,SAAS4B,QACf;AAAA,EAAA;AAEA;ACjJe,SAAQG,YAACt3B,QAExBA;AAAAA,EAAAA,OAAMuC,OAAO+0B,cAAc;AAC3Bt3B,EAAAA,OAAMuC,OAAOg1B,wBAAwB;AAErCv3B,EAAAA,OAAMw3B,eAAe,EACpBC,WAAW,CAAE,GACbC,YAAY,OACZC,SAAS,MACTC,4BAA4B,MAC5BC,oBAAoB,WAAA;AACnB,QAAIC,WAAW76B,KAAK86B,YACpB;AAAA,WAAOD,SAAS9+B,SAAS8+B,SAASA,SAAS9+B,SAAS,CAAK,IAAA;AAAA,EACzD,GACDg/B,kBAAkB,SAAS9zB,IAAAA;AAC1BjH,SAAK26B,6BAA6B1zB;AAAAA,EAClC,GACD+zB,kBAAkB,WAAA;AACjB,WAAOh7B,KAAK26B;AAAAA,EACZ,GACD7H,UAAU,WACT9yB;AAAAA,SAAKi7B;AACL,WAAOj7B,KAAK06B;AAAAA,EACZ,GACDO,aAAa;AACZj7B,SAAKy6B,aAAa13B,OAAMuC,OAAOg1B;AAC/B,QAAIY,SAASl7B,KAAK06B;AAClB16B,SAAK06B,UAAU33B,OAAMuC,OAAO61B;AAC5B,QAAIn7B,KAAK06B,WAAWQ,QAAQ;AAC3Bl7B,WAAKo7B,MACL;AAAA,IAAA;AAAA,EACD,GACDA,OAAO,WACNp7B;AAAAA,SAAKw6B,YAAY;EACjB,GACDa,iBAAiB,SAAUp0B,IAAAA;AAC1BlE,IAAAA,OAAM+yB,MAAMC,WAAWuF,OAAO,WAC7B;AAAA,UAAIxkB,QAAQ/T,OAAM+yB,MAAMC;AACxB,UAAI9uB,GACH6P,OAAMhc,OAAOmM,KAAG,EAAA;AAAA,UAEhB6P,OAAMykB,SAAS,IACnB;AAAA,IAAA,CAAA;AAAA,EACE,GACDC,iBAAiB,WAAA;AAChB,QAAIC,OAAO14B,OAAM+yB,MAAMC,WAAW2F,cAClC;AAAA,QAAID,QAAQ14B,OAAM0d,aAAagb,MAC9B,QAAOA;AACR,WAAO;AAAA,EACP,GACD3gC,QAAQ,SAAUmM,IAAI/H,GAAAA;AACrB,QAAI+H,MAAMlE,OAAMgF,UAAU,2BAA2B,CAACd,IAAI,MAAM/H,CAAAA,CAAAA,KAAO6D,OAAMgF,UAAU,wBAAwB,CAACd,EAAAA,CAAAA,GAAM;AACrHjH,WAAKw6B,UAAUvzB,MAAM;AACrBjH,WAAKq7B,gBAAgBp0B,EAAAA;AACrBjH,WAAK27B,YAAY10B;AACjBlE,MAAAA,OAAMgF,UAAU,qBAAqB,CAACd,IAAI,MAAM/H,CAChD6D,CAAAA;AAAAA,MAAAA,OAAMgF,UAAU,kBAAkB,CAACd,EAAAA,CAAAA;AACnC,aAAO;AAAA,IACP;AACD,WAAO;AAAA,EACP,GACDqf,QAAQ,SAAUrf,IAAI/H,GACrB;AAAA,QAAIc,KAAKw6B,UAAUvzB,KAAK;AACvBjH,WAAKu7B,SAASt0B,IAAI/H,CACrB;AAAA,IAAA,OAAS;AACNc,WAAKlF,OAAOmM,IAAI/H,CAAAA;AAAAA,IAChB;AAAA,EACD,GACDq8B,UAAU,SAAUt0B,IAAI/H;AACvB,QAAI+H,MAAMlE,OAAMgF,UAAU,2BAA2B,CAACd,IAAI,OAAO/H,CAAAA,CAAAA,GAAK;AACrEc,WAAKw6B,UAAUvzB,EAAM,IAAA;AACrB,UAAIjH,KAAKw7B,qBAAqBv0B,GAC7BjH,MAAKq7B,gBAAgBr7B,KAAK46B,mBAC3B56B,CAAAA;AAAAA,WAAK27B,YAAY10B,EACjBlE;AAAAA,MAAAA,OAAMgF,UAAU,qBAAqB,CAACd,IAAI,OAAO/H,CAAAA,CAAAA;AACjD6D,MAAAA,OAAMgF,UAAU,oBAAoB,CAACd;IACrC;AAAA,EACD,GACD20B,YAAY,SAAU30B,IACrB;AAAA,WAAA,CAAA,EAAUlE,OAAM0d,aAAaxZ,EAAAA,KAAOjH,KAAKw6B,UAAUvzB,EACnD;AAAA,EAAA,GACD6zB,aAAa,WACZ;AAAA,QAAIvY,MAAM,CACV;AAAA,aAASzmB,KAAKkE,KAAKw6B,WAAW;AAC7B,UAAIx6B,KAAKw6B,UAAU1+B,CAAMiH,KAAAA,OAAM0d,aAAa3kB,CAAI,GAAA;AAC/CymB,YAAIvjB,KAAKlD,CAAAA;AAAAA,MACb,OAAU;AACNkE,aAAKw6B,UAAU1+B,KAAK;AAAA,MACpB;AAAA,IACD;AACDymB,QAAItmB,KAAK,SAAS1B,GAAG2B,GAAAA;AACpB,aAAO6G,OAAM2rB,mBAAmBn0B,CAAAA,IAAKwI,OAAM2rB,mBAAmBxyB,CAAAA,IAAK,IAAK;AAAA,IAC3E,CACE;AAAA,WAAOqmB;AAAAA,EACP,GACDsZ,aAAa,SAAU/zB,UAAAA;AACtB,QAAI+yB,WAAW76B,KAAK86B,YACpB;AAAA,aAASh/B,IAAI,GAAGA,IAAI++B,SAAS9+B,QAAQD,KAAK;AACzCgM,eAAS+yB,SAAS/+B;IAClB;AAAA,EACD,GACDggC,aAAa,SAAS70B,IACrB;AAAA,QAAA,CAAKjH,KAAKy6B,WACT,QAAO;AACR,QAAIgB,OAAOz7B,KAAKw7B;AAChB,QAAKC,CAAAA,KACJ,QAAO;AACR,QAAA,EAAM14B,OAAM0d,aAAagb,IAAAA,KAAS14B,OAAM0d,aAAaxZ,EACpD,GAAA,QAAO;AACR,WAAUlE,CAAAA,EAAAA,OAAMg5B,mBAAmBh5B,OAAMmc,QAAQuc,IAAAA,CAAAA,KAAU14B,OAAMg5B,mBAAmBh5B,OAAMmc,QAAQjY,EAAAA,CAAAA;AAAAA,EAClG,GACD00B,aAAa,SAAS10B,IACrB;AAAA,QAAIlE,OAAM0d,aAAaxZ,EAAAA,GAAI;AAE1BlE,MAAAA,OAAMi5B,cAAc,WACnBj5B;AAAAA,QAAAA,OAAMk5B,YAAYh1B,EAAAA;AAAAA,MACtB;IACG;AAAA,EACD,GACDi1B,aAAa,SAASh9B,GAAAA;AACrB,SAAKc,KAAK8yB,SAAAA,EACT,QAAO;AAGR,QAAI/vB,OAAMo5B,oBAAoBj9B,CAC7B,EAAA,QAAO;AAER,QAAIk9B,YAAYr5B,OAAMisB,OAAO9vB,CAAAA;AAC7B,QAAKk9B,CAAAA,UACJ,QAAO;AAER,SAAKr5B,OAAMgF,UAAU,uBAAuB,CAAC7I,CAC5C,CAAA,EAAA,QAAO;AAER,QAAI27B,WAAW76B,KAAK86B,YAAAA;AACpB,QAAIuB,cAAcr8B,KAAKg7B,iBACvB;AAAA,QAAIsB,SAAS;AACb,QAAIb,OAAOz7B,KAAKw7B,gBAAAA;AAChB,QAAIe,cAAcx5B,OAAMuC,OAAO+0B;AAG/B,QAAImC,mBAAkB;AAGrB,YAAMC,aAAa15B,OAAMoC,IAAIu3B;AAC7B,UAAGD,cAAcA,WAAWlvB,UAAS;AACpC,cAAM3J,QAAQ64B,WAAWlvB,SACzB;AAAA,cAAMovB,OAAOF,WAAWG,WAAW19B,EAAEI,MAAAA;AAErC,YAAIyD,OAAMuC,OAAOu3B,mCAAmCF,QAAQF,WAAWK,gBAAgBH,KAAK/E,UAAAA,GAAa;AACxG,cAAI6E,WAAW9iC,UAAeiK,KAAAA,MAAMqD,MAAM01B,KAAK11B,MAAMrD,MAAMg0B,cAAc+E,KAAK/E,WAEvE;AAAA,eAAA;AACN6E,uBAAWM,UAAUJ,KAAK11B,IAAI01B,KAAK/E,UACnC;AAAA,UAAA;AAAA,QACD;AAAA,MACD;AAED53B,WAAK+6B,iBAAiBqB,SAEtB;AAAA,UAAA,CAAKp8B,KAAK47B,WAAWQ,SAAAA,GAAY;AAChCp8B,aAAKlF,OAAOshC,WAAWl9B;MACvB;AACD27B,iBAAW76B,KAAK86B,YAChB;AAAA,eAASh/B,IAAI,GAAGA,IAAI++B,SAAS9+B,QAAQD,KAAK;AACzC,YAAI++B,SAAS/+B,CAAOsgC,MAAAA,WAAW;AAC9Bp8B,eAAKu7B,SAASV,SAAS/+B,CAAAA,GAAIoD,CAC3B;AAAA,QAAA;AAAA,MACD;AAAA,IACD,GAAEyI,KAAK3H,IAER;AAAA,QAAIg9B,kBAAiB,WACpB;AAAA,UAAA,CAAKvB,KACJA,QAAOW;AAAAA,eACCA,WAAW;AACnB,YAAIa,aAAal6B,OAAM2rB,mBAAmB1uB,KAAKg7B,iBAAAA,CAAAA;AAC/C,YAAIkC,cAAcn6B,OAAM2rB,mBAAmB0N,SAAAA;AAC3C,YAAIe,YAAYp6B,OAAM2rB,mBAAmB+M;AAEzC,YAAGwB,cAAAA,MAAoBE,aAAc,IAAE;AACtCF,uBAAaC;AACbl9B,eAAKo7B,MAAAA;AAAAA,QACL;AAED,YAAIgC,MAAM3B;AACV,eAAO14B,OAAM2rB,mBAAmB0O,GAASH,MAAAA,YAAY;AACpDj9B,eAAKu7B,SAAS6B,KAAKl+B,CAAAA;AACnBk+B,gBAAOH,aAAaE,YAAap6B,OAAM+tB,QAAQsM,OAAOr6B,OAAM6tB,QAAQwM;QACpE;AACDA,cAAMhB;AACN,eAAOr5B,OAAM2rB,mBAAmB0O,SAASH,YAAY;AACpD,cAAIj9B,KAAKlF,OAAOsiC,KAAKl+B,CAAOo9B,KAAAA,CAAAA,QAAQ;AACnCA,qBAAS;AACTD,0BAAce;AAAAA,UACd;AACDA,gBAAOH,aAAaC,cAAen6B,OAAM+tB,QAAQsM,GAAOr6B,IAAAA,OAAM6tB,QAAQwM,GAAAA;AAAAA,QACtE;AAAA,MACD;AAAA,IACD,GAAEz1B,KAAK3H,IAAAA;AAGR,QAAIu8B,gBAAgBr9B,EAAE8oB,WAAW9oB,EAAE+oB,UAAU;AAC5C,UAAKjoB,CAAAA,KAAK47B,WAAWQ,SAAAA,EACpBp8B,MAAK+6B,iBAAiBqB,SAAAA;AAEvB,UAAIA,WAAW;AACdp8B,aAAKsmB,OAAO8V,WAAWl9B,CACvB;AAAA,MAAA;AAAA,IACD,WAEQq9B,eAAer9B,EAAE4oB,UAAU;AACnC,UAAA,CAAK/kB,OAAM0d,aAAazgB,KAAKg7B,iBAAuBh7B,CAAAA,KAAAA,KAAKg7B,iBAAuB,MAAA,MAAM;AACrFh7B,aAAK+6B,iBAAiBqB,SACtB;AAAA,MAAA;AAED,UAAIvB,SAAS9+B,QAAQ;AACpBihC,uBACA;AAAA,MAAA,OACI;AACJR,wBAAAA;AAAAA,MACA;AAAA,IACD,OAEI;AACJA,sBACA;AAAA,IAAA;AAGD,QAAIx8B,KAAK47B,WAAWQ,SAAAA,GAAY;AAC/Bp8B,WAAKq7B,gBAAgBe,SACrB;AAAA,IAAA,WAAUC,aAAa;AACvB,UAAID,aAAaX,KAChBz7B,MAAKq7B,gBAAgBn8B,EAAE4oB,WAAWuU,cAAcr8B,KAAK46B,mBAAAA,CAAAA;AAAAA,IACzD,OAAS;AACN56B,WAAKq7B,gBAAgB,IAAA;AAAA,IACrB;AAED,QAAKr7B,CAAAA,KAAK86B,cAAc/+B,OACvBiE,MAAKq7B,gBAAgB,IAAA;AAEtB,QAAKr7B,CAAAA,KAAKw7B,sBAAsBx7B,KAAK47B,WAAW57B,KAAKg7B,iBACpDh7B,CAAAA,EAAAA,MAAK+6B,iBAAiB/6B,KAAKw7B,gBAAAA,CAAAA;AAE5B,WAAO;AAAA,EACP,EAGF;AAAA,GAAA,WAAA;AACC,QAAI6B,iBAAiBt6B,OAAMsuB;AAC3BtuB,IAAAA,OAAMsuB,aAAa,SAASpqB;AAC3BA,WAAK+D,mBAAmB/D,IAAIjH,KAAKsF,OAAOuV,OAAAA;AACxC,WAAK5T,GACJ,QAAO;AACR,UAAIozB,eAAct3B,OAAMw3B;AACxB,UAAIhY,MAAMtb;AACV,UAAIozB,aAAYvH,YAAY;AAC3B,YAAIuH,aAAYv/B,OAAOmM,IAAI,IAAA,GAAO;AACjCozB,UAAAA,aAAYgB,gBAAgBp0B,EAC5B;AAAA,QAAA;AACDozB,QAAAA,aAAYU,iBAAiBV,aAAYmB,gBAC5C,CAAA;AAAA,MAAA,OAAS;AACNjZ,cAAM8a,eAAexhC,KAAKmE,MAAMiH,EAAAA;AAAAA,MAChC;AACD,aAAOsb;AAAAA,IACT;AAEC,QAAI+a,mBAAmBv6B,OAAMuuB;AAC7BvuB,IAAAA,OAAMuuB,eAAe,SAASrqB;AAC7B,UAAIozB,eAAct3B,OAAMw3B;AACxB,UAAIzH,WAAWuH,aAAYvH,SAC3B7rB;AAAAA,WAAKA,MAAMozB,aAAYmB,gBAAAA;AACvB,UAAGv0B,MAAM6rB,UAAU;AAClBuH,QAAAA,aAAYkB,SAASt0B,IAAI;AACzB,YAAIA,MAAMozB,aAAYmB,gBACrBnB,EAAAA,CAAAA,aAAYgB,gBAAgB,IAC7Bt4B;AAAAA,QAAAA,OAAMk5B,YAAYh1B,EAAAA;AAClBozB,QAAAA,aAAYU,iBAAiBV,aAAYmB,gBACzC,CAAA;AAAA,MAAA;AACD,UAAIjZ,MAAMtb;AACV,WAAK6rB,SACJvQ,OAAM+a,iBAAiBzhC,KAAKmE,MAAMiH,EAAAA;AACnC,aAAOsb;AAAAA,IACT;AAECxf,IAAAA,OAAMw6B,sBAAsB,SAASt2B,IAAAA;AACpC,UAAIozB,eAAct3B,OAAMw3B;AACxB,UAAItzB,MAAMozB,aAAYvH,YAAY;AACjCuH,QAAAA,aAAY/T,OAAOrf,EACnBozB;AAAAA,QAAAA,aAAYU,iBAAiBV,aAAYmB,gBAAAA,CAAAA;AAAAA,MACzC;AAAA,IACH;AACCz4B,IAAAA,OAAMy6B,mBAAmB;AACxB,UAAInD,eAAct3B,OAAMw3B;AACxBF,MAAAA,aAAYvH;AACZ,aAAOuH,aAAYS,YACrB;AAAA,IAAA;AACC/3B,IAAAA,OAAM06B,mBAAmB,SAAS31B,UACjC;AAAA,aAAO9H,KAAKu6B,aAAasB,YAAY/zB;IACvC;AACC/E,IAAAA,OAAMquB,iBAAiB,SAASnqB,IAC/B;AAAA,aAAOjH,KAAKu6B,aAAaqB,WAAW30B,EACtC;AAAA,IAAA;AACClE,IAAAA,OAAM26B,sBAAsB;AAC3B,aAAO19B,KAAKu6B,aAAaiB,gBAAAA;AAAAA,IAC3B;AACCz4B,IAAAA,OAAMyE,YAAY,gBAAgB,WAAA;AACjC,UAAIm2B,iBAAiB56B,OAAM+yB,MAAMC,WAAW6F;AAC5C74B,MAAAA,OAAM+yB,MAAMC,WAAW6F,aAAa,SAAS30B,IAC5C;AAAA,YAAIlE,OAAMw3B,aAAazH,SAAAA,GAAY;AAClC,iBAAO/vB,OAAMw3B,aAAaqB,WAAW30B,EACrC;AAAA,QAAA;AACD,eAAO02B,eAAe9hC,KAAKmE,MAAMiH,EACpC;AAAA,MAAA;AAAA,IACA;EACC,GAnED;AAqEAlE,EAAAA,OAAMyE,YAAY,kBAAkB,SAAUP,IAAI22B,QACjD;AAAA,QAAIvD,eAAct3B,OAAMw3B;AACxB,QAAA,CAAKF,aAAYvH,SAChB,EAAA,QAAO;AACR,QAAI/vB,OAAMquB,eAAenqB,KAAK;AAC7BozB,MAAAA,aAAYkB,SAASt0B,IAAI,IAAA;AACzBozB,MAAAA,aAAYv/B,OAAO8iC,QAAQ,IAC3B;AAAA,IAAA;AAAA,EACF,CAEA76B;AAAAA,EAAAA,OAAMyE,YAAY,qBAAqB,SAAUP,IAAI2C,MAAAA;AACpD,QAAIywB,eAAct3B,OAAMw3B;AACxB,QAAA,CAAKF,aAAYvH,SAAAA,EAChB,QAAO;AAER,QAAIuH,aAAYG,UAAUvzB,KAAK;AAI9BozB,MAAAA,aAAYG,UAAUvzB,EAAM,IAAA;AAC5BozB,MAAAA,aAAYgB,gBAAgBhB,aAAYO,mBAAAA,CAAAA;AAAAA,IACxC;AAEDP,IAAAA,aAAYwB,YAAY,SAAUgC,SAAAA;AACjC,UAAK96B,CAAAA,OAAM0d,aAAaod,OACvBxD,EAAAA,CAAAA,aAAYkB,SAASsC,SAAS,IACjC;AAAA,IAAA,CAAA;AAAA,EACA;AAEA96B,EAAAA,OAAMyE,YAAY,2BAA2B,SAASP,IAAIrD,OAAO1E,GAChE;AAAA,UAAMm7B,eAAct3B,OAAMw3B;AAC1B,QAAI32B,SAASy2B,aAAYvH,SAAAA,GAAY;AAEpC,UAAIgL,gBAAgB/6B,OAAM24B,cAC1B;AAAA,UAAIqC,kBAAkB;AACtB,UAAID,eAAe;AAClBC,0BAAkBh7B,OAAMmc,QAAQ4e,aAChC;AAAA,MAAA;AACD,UAAIE,kBAAkBj7B,OAAMmc,QAAQjY,EAAAA;AACpC,UAAIg3B,qBAAqB;AACzB,UAAIF,mBAAmBA,gBAAgBzhB,UAAU0hB,gBAAgB1hB,QAAO;AACvE2hB,6BAAqB;AAAA,MACrB;AAED,UAAIl7B,OAAMuC,OAAOg1B,yBAAyB2D,sBAAuB/+B,CAAAA,EAAE8oB,YAAY9oB,EAAE4oB,UAAU;AAC1F,eAAO;AAAA,MACP;AACD,UAAIuS,aAAYI,YAAY;AAC3B,eAAOJ,aAAYyB,YAAY70B,EAC/B;AAAA,MAAA;AAAA,IACD;AACD,WAAO;AAAA,EACR,CAEAlE;AAAAA,EAAAA,OAAMyE,YAAY,eAAe,SAASP,IAAI/H,GAAAA;AAC7C,QAAI6D,OAAMw3B,aAAa2B,YAAYh9B,CAClC6D,EAAAA,CAAAA,OAAMgF,UAAU,iBAAiB,CAAC7I,CAAAA,CAAAA;AACnC,WAAO;AAAA,EACR,CAAA;AAEA;ACnXO,MAAMg/B,UAQZ;AAAA,EAAA,YAAYn7B,QAWR/C;AAAAA,SAAAm+B,OAAA,CAACl3B,IAAqB5N,MAAAA;AACzB,UAAIA,MAAiB,QAAA;AACpB2G,aAAKo+B,aAAan3B;MAAE,OACd;AACDjH,aAAAq+B,mBAAmBp3B,IAAc5N,CAAAA;AAAAA,MACvC;AAAA;AAGD2G,SAAA41B,OAAQ0I;AACP,YAAMv7B,SAAQ/C,KAAKiD;AACnB,YAAMs7B,KAAKv+B,KAAKw+B;AAChBx+B,WAAKy+B,kBAAkB;AACvB,YAAMnQ,SAAStuB,KAAK0+B;AACpB1+B,WAAK0+B,iBAAiB;AAElB,UAAAH,MAAMA,GAAGhmC,YAAW;AAEnB,YAAAwK,OAAMuC,OAAOq5B,qBAAqB;AACrC57B,UAAAA,OAAMgF,UAAU,oBAAoB,CAACumB,MAC9B,CAAA;AAAA,iBAAAiQ,GAAGhmC,WAAWqE,YAAY2hC,EAClC;AAAA,QAAA;AAEAA,WAAGxhC,aAAa;AACZ,YAAAwhC,GAAGvkC,MAAMjC,UAAU,QAAO;AAC7BwmC,aAAGvkC,MAAMlC,OAAO;AAAA,QAAA,OACV;AACNymC,aAAGvkC,MAAMjC,QAAQ;AAAA,QAClB;AAEA,YAAIumC,QAAQ;AACXC,aAAGvkC,MAAMlC,OAAOymC,GAAGvkC,MAAMjC,QAAQ;AAC9BwmC,aAAAhmC,WAAWqE,YAAY2hC,EAC3B;AAAA,QAAA;AACAx7B,QAAAA,OAAMgF,UAAU,oBAAoB,CAACumB,MAAAA,CAAAA;AAAAA,MACtC;AAAA,IAGDtuB;AAAAA,SAAA+sB,UAAU,MAAA;AACT,UAAG/sB,KAAKw+B,eAAe;AACtB,eAAOx+B,KAAKw+B;AAAAA,MACb;AACO,aAAA;AAAA,IAAA;AAGRx+B,SAAA4+B,eAAgBC;AACf,UAAGA,WAAU;AACZ7+B,aAAK8+B,aAAoBD,OAAAA,cAAc,WAAWzmC,SAAS4F,eAAe6gC,aAAaA;AAAAA,MACxF;AAAA,IAAA;AAGD7+B,SAAA++B,aAAcC,aAAAA;AACb,YAAMj8B,SAAQ/C,KAAKiD;AAEnB,YAAMg8B,iBAAiB,EACtB3Q,QAAQ,MACRpO,QAAQ,EACPnM,OAAO,IACP1B,MAAM,GAAA,GAEP2sB,SAAS,IACTxN,SAASzuB,OAAMuC,OAAO45B,kBAGvB;AAAA,UAAA,CAAIF,SAAQ;AACDA,kBAAAC;AAAAA,MACX;AAEG,UAACD,CAAAA,QAAQ1Q,QAAO;AAClB0Q,gBAAQ1Q,SAAS2Q,eAAe3Q;AAAAA,MACjC;AAEG,UAAA,CAAC0Q,QAAQ9e,QAAO;AAClB8e,gBAAQ9e,SAAS+e,eAAe/e;AAAAA,MACjC;AAEG,UAAC8e,CAAAA,QAAQ9e,OAAOnM,OAAM;AAChBirB,gBAAA9e,OAAOnM,QAAQkrB,eAAe/e,OAAOnM;AAAAA,MAC9C;AACG,WAACirB,QAAQ9e,OAAO7N,MAAK;AACf2sB,gBAAA9e,OAAO7N,OAAO4sB,eAAe/e,OAAO7N;AAAAA,MAC7C;AACG,UAAA,CAAC2sB,QAAQA,SAAQ;AACnBA,gBAAQA,UAAUC,eAAeD;AAAAA,MAClC;AACG,UAACA,CAAAA,QAAQxN,SAAQ;AACnBwN,gBAAQxN,UAAUyN,eAAezN;AAAAA,MAClC;AAGI,UAAA+M,KAAKv+B,KAAK+sB;AACd,UAAIwR,CAAAA,IAAG;AACNA,aAAKv+B,KAAKm/B,wBAAAA;AAAAA,MACX;AAEA,UAAGH,QAAQ1Q,QAAO;AACjBtuB,aAAKy+B,kBAAkBO,QAAQ1Q;AAAAA,MAChC;AAEM,YAAA8Q,WAAWb,GAAGtgC,cAAc,qBAC5B;AAAA,YAAAohC,eAAeD,SAASnhC,cAAc;AACtC,YAAAqhC,YAAYF,SAASnhC,cAAc,qBACnC;AAAA,YAAAshC,OAAOhB,GAAGtgC,cAAc,uBACxB;AAAA,YAAAuhC,WAAWjB,GAAGtgC,cAAc,wBAElC8E;AAAAA,MAAAA,OAAM08B,SAASC,gBAAgBnB,IAAI,CAACS,QAAQ9e,OAAOnM,OAAOirB,QAAQ9e,OAAO7N,IAAAA,EAAM7W,KAAK,GAEvE6jC,CAAAA;AAAAA,mBAAAhhC,YAAY2gC,QAAQ9e,OAAOnM;AAC9BurB,gBAAAjhC,YAAY2gC,QAAQ9e,OAAO7N;AAErC,UAAI2sB,CAAAA,QAAQ9e,OAAOnM,SAAUirB,CAAAA,QAAQ9e,OAAO7N,MAAK;AAChD+sB,iBAASplC,MAAMH,UAAU;AAAA,MAAA,OACrB;AACJulC,iBAASplC,MAAMH,UAAU;AAAA,MAC1B;AACA0lC,WAAKlhC,YAAY2gC,QAAQA;AAEzB,YAAMxN,UAAUwN,QAAQxN;AACrB,UAACA,CAAAA,QAAQz1B,QAAO;AAClByjC,iBAASxlC,MAAMH,UAAU;AAAA,MAAA,OACrB;AACJ2lC,iBAASxlC,MAAMH,UAAU;AAAA,MAC1B;AACA,UAAI2jB,OAAO;AACX,eAAS1hB,IAAI,GAAGA,IAAI01B,QAAQz1B,QAAQD,KAAI;AAEjC,cAAA6jC,WAAW58B,OAAM08B,SAASG,0BAA0B78B,OAAMoT,OAAOC,OAAOob,QAAQ11B,CAEtF0hB,CAAAA,CAAAA;AAAAA,gBAAQ,iCAAiCgU,QAAQ11B,CAAAA,CAAAA,cAAgB01B,QAAQ11B,CAAciH,CAAAA,YAAAA,OAAMoT,OAAOC,OAAOob,QAAQ11B,CAAAA,CAAAA,CAAAA,KAAQ6jC;uDACvEnO,QAAQ11B,CAAAA,CAAAA,8BAAgC01B,QAAQ11B,CAAAA,CAAAA;AAAAA,mBACpFiH,OAAMoT,OAAOC,OAAOob,QAAQ11B,CAAAA,CAAAA,CAAAA;AAAAA;AAAAA,MAE7C;AACA0jC,eAASnhC,YAAYmf;AAErBza,MAAAA,OAAMqvB,YAAYmM,IAAI,SAASv+B,KAAK6/B,qBAAAA;AACpC98B,MAAAA,OAAMqvB,YAAYmM,IAAI,YAAYv+B,KAAK8/B,kBAEvC/8B;AAAAA,MAAAA,OAAM1D,MAAMk/B,IAAI,SAASv+B,KAAK6/B,qBAAAA;AAC9B98B,MAAAA,OAAM1D,MAAMk/B,IAAI,YAAYv+B,KAAK8/B,kBAAkB;AAAA,IAAA;AAG5C9/B,SAAA6/B,wBAAyBp/B;AAC3BT,WAAA+/B,iBAAiBt/B,GAAGnB,MAAM;AAAA,IAAA;AAGxBU,SAAA8/B,qBAAsB5gC,OAAAA;AAE7B,YAAMyb,OAAOzb,EAAEgpB;AACX,UAAAvN,SAAS,MAAMA,SAAS,IAAG;AAC9B/P,mBAAW;AACL5K,eAAA+/B,iBAAiB7gC,EAAEI,MAAAA;AAAAA,QAAM,GAC7B,CAAA;AAAA,MACH;AAAA;AAlKAU,SAAKiD,SAASF;AAAAA,EACf;AAAA,EAoKQ,mBAAmBvJ,GAAWH,GAAAA;AACrC2G,SAAK41B,KAAK,IACV51B;AAAAA,SAAKy+B,kBAAkB;AACvBz+B,SAAK0+B,iBAAiB;AACnB,QAAA,CAAC1+B,KAAKw+B,eAAc;AACtBx+B,WAAKm/B,wBAAAA;AACLn/B,WAAK++B,WAAAA;AAAAA,IACN;AAEK/+B,SAAAggC,qBAAqBxmC,GAAGH,CAC7B2G;AAAAA,SAAKiD,OAAO8E,UAAU,eAAe,CAAC,IAAA,CAAA;AAAA,EACvC;AAAA,EAEQ,aAAad,IACpB;AAAA,UAAMlE,SAAQ/C,KAAKiD;AACnB,QACCgE,OAAOjH,KAAKy+B,mBACZ17B,OAAM2B,MAAMC,IAAI1D,UAAUjB,KAAKw+B,eAAepmC,SAASD,UAClD4K,OAAMuC,OAAO26B,iBAAiB;AAEnC;AAAA,IACD;AACAjgC,SAAK41B,KAAK,IAAA;AACV,UAAMsK,SAAS;AACT,UAAArB,YAAY7+B,KAAKmgC,cAAAA;AACjB,UAAAl0B,MAAMjM,KAAKogC,wBAAwBn5B,IAAIi5B,QAAQrB,UAAUwB,WAAWxB,UAAUyB,SAAAA;AAEpF,QAAIr0B,KAAI;AACFjM,WAAAw+B,gBAAgBx+B,KAAKugC,iBAAiBt5B,EAAAA;AAC3CjH,WAAK0+B,iBAAiBz3B;AACtBjH,WAAKw+B,cAAczhC,YAAYiD,KAAKwgC,8BAA8Bv5B,EAAAA;AAElEjH,WAAKygC,iBAAiBx5B,EAAAA;AACjBjH,WAAA0gC,iBAAiBz0B,KAAKi0B,MAAAA;AAC3Bn9B,MAAAA,OAAMgF,UAAU,eAAe,CAACd,EACjC,CAAA;AAAA,IAAA;AAAA,EACD;AAAA,EAEQ,wBAAwBA,IAAYi5B,QAAgBG,WAAwBC,WAAAA;AACnF,UAAMv9B,SAAQ/C,KAAKiD;AACf,QAAA09B,QAAQ59B,OAAMia,YAAY/V,EAAAA;AAC9B,QAAK05B,CAAAA,OAAO;AACHA,cAAA59B,OAAM69B,eAAe35B,EAAAA;AAC7B,WAAK05B,OAAO;AACJ,eAAA;AAAA,MACR;AAAA,IACD;AACA,QAAI7oC,OAAO;AACX,UAAMD,MAAMqoC,SAASS,MAAMznC,YAAYynC,MAAM3nC;AAE7C,QAAIY,OAAO+mC;AAEX,QAAI59B,OAAM2B,MAAMC,IAAI1D,UAAUrH,MAAMymC,SAAAA,GAAY;AACxC,aAAAzmC,QAAQA,SAASymC,WAAU;AACjCvoC,gBAAQ8B,KAAKT;AACbS,eAAOA,KAAKR;AAAAA,MACb;AAAA,IACD;AAEM,UAAAma,SAASxQ,OAAM4N,eAErB;AAAA,QAAG/W,MAAK;AACD,YAAAinC,KAAM/oC,OAAO6oC,MAAM5nC,cAAY,IAAKwa,OAAO/Z,IAAK6mC,UAAUtnC,cAAY,IAAK,IAAI;AAC/E,YAAA+nC,KAAMjpC,MAAM8oC,MAAM3nC,eAAa,IAAKua,OAAOla,IAAKinC,UAAUtnC,eAAa,IAAK,IAAI;AAE/E,aAAA,EAAElB,MAAMD,KAAKgpC,IAAIC,IAAIrnC,OAAMknC,MAAM5nC,aAAaW,QAAOinC,MAAM3nC,aAAAA;AAAAA,IACnE;AACO,WAAA;AAAA,EACR;AAAA,EAEQ,0BACP;AAAA,UAAM+J,SAAQ/C,KAAKiD;AACb,UAAAs7B,KAAKnmC,SAASoE,cAAc,KAAA;AAClC+hC,OAAGxhC,aAAa;AACVgG,IAAAA,OAAA08B,SAASsB,cAAcxC,EAGvB;AAAA,UAAAoB,WAAW58B,OAAM08B,SAASuB,0BAChC;AAAA,QAAIxjB,OAAO;AAAA;AAAA;AAAA;AAAA,oCAIuBmiB;;;;;;AAQ1BniB,YAAA;AAEAA,YAAA;AAER+gB,OAAGlgC,YAAYmf;AAGX,QAAAza,OAAMuC,OAAOq5B,qBAAqB;AAC/B,YAAAE,YAAY7+B,KAAKmgC,cAAAA;AACvBp9B,MAAAA,OAAM1D,MAAMw/B,UAAU/9B,QAAQ,UAAU,MAAA;AAAQd,aAAK41B,KAAAA;AAAAA,MAAK,CAC3D;AAAA,IAAA;AAEA51B,SAAKw+B,gBAAgBD;AACd,WAAAA;AAAAA,EACR;AAAA,EAEQ,iBAAiBt3B,IACxB;AAAA,UAAMlE,SAAQ/C,KAAKiD;AACb,UAAAkL,OAAOpL,OAAMmc,QAAQjY;AAGxB,QAAOjH,OAAAA,KAAKihC,uBAAuB,WAAU;AAC/C,UAAGl+B,OAAMqrB,WAAWjgB,IAAAA,MAAUnO,KAAKihC,oBAAmB;AACrDjhC,aAAK41B,KAAK,IACV51B;AAAAA,aAAKw+B,gBAAgB;AAAA,MACtB;AAAA,IACD;AAEKx+B,SAAAihC,qBAAqBl+B,OAAMqrB,WAAWjgB,IAEvC;AAAA,QAAA,CAACnO,KAAKw+B,eAAc;AAClBx+B,WAAAw+B,gBAAgBx+B,KAAKm/B,wBAC3B;AAAA,IAAA;AAEA,WAAOn/B,KAAKw+B;AAAAA,EACb;AAAA,EAEQ,8BAA8Bv3B,IACrC;AAAA,UAAMlE,SAAQ/C,KAAKiD;AACb,UAAAkL,OAAOpL,OAAMmc,QAAQjY;AACrB,UAAAi6B,WAAWn+B,OAAMo+B,YAAYhzB,IAAAA;AAE/B,QAAAzP,MAAM,8BAA8BwiC,QAClC;AAAA,UAAAvqB,WAAW5T,OAAMmS,UAAUksB,iBAAiBjzB,KAAKgE,YAAYhE,KAAKiE,UAAUjE,IAAAA;AAElF,QAAGwI,UAAS;AACXjY,aAAO,MAAMiY;AAAAA,IACd;AACO,WAAAjY;AAAAA,EACR;AAAA,EAEQ,iBAAiBuI,IAAAA;AACxB,UAAMlE,SAAQ/C,KAAKiD;AACb,UAAAxC,KAAKsC,OAAMmc,QAAQjY,EAEzBjH;AAAAA,SAAKy+B,kBAAkBx3B;AAEvB,QAAIo6B,iBAAiB;AACrB,QAAIrhC,KAAKihC,oBAAmB;AACrB,YAAAzP,UAAUzuB,OAAMuC,OAAO45B;AAC7B,YAAMoC,WAAW,EAACC,aAAa,MAAMC,WAAW,KAChD;AAAA,eAAS1lC,IAAI,GAAGA,IAAI01B,QAAQz1B,QAAQD,KAAI;AACvC,YAAGkE,KAAKihC,sBAAsBK,SAAS9P,QAAQ11B,CAAAA,CAAAA,GAAI;AAClD;AAAA,QACD;AACeulC,uBAAAriC,KAAKwyB,QAAQ11B,CAC7B,CAAA;AAAA,MAAA;AAAA,IAAA,OACM;AACNulC,uBAAiBt+B,OAAMuC,OAAO45B;AAAAA,IAC/B;AAEAl/B,SAAK++B,WAAW,EACf7e,QAAQ,EACPnM,OAAOhR,OAAMmS,UAAUusB,iBAAiBhhC,GAAG0R,YAAY1R,GAAG2R,UAAU3R,KACpE4R,MAAMtP,OAAMmS,UAAUwsB,gBAAgBjhC,GAAG0R,YAAY1R,GAAG2R,UAAU3R,EAEnEu+B,EAAAA,GAAAA,SAASj8B,OAAMmS,UAAUysB,mBAAmBlhC,GAAG0R,YAAY1R,GAAG2R,UAAU3R,EACxE+wB,GAAAA,SAAS6P;EAEX;AAAA,EAEQ,qBAAqB7nC,GAAWH,GACvC;AAAA,UAAMklC,KAAKv+B,KAAKw+B;AACV,UAAAK,YAAY7+B,KAAKmgC;AACnB,QAAC5B,CAAAA,GAAGhmC,cACPgmC,GAAGhmC,WAAWkC,SAASS,kBAAkB,sBAAqB;AACpD2jC,gBAAA/9B,OAAOpE,YAAY6hC,EAAAA;AAAAA,IAC9B;AAEGA,OAAAvkC,MAAMlC,OAAO0B,IAAI;AACjB+kC,OAAAvkC,MAAMnC,MAAMwB,IAAI;AAAA,EACpB;AAAA,EAEQ,iBAAiB4S,KAAUi0B,QAAAA;AAClC,UAAMn9B,SAAQ/C,KAAKiD;AACnB,UAAMs7B,KAAKv+B,KAAKw+B;AACZ,QAAAz7B,OAAMuC,OAAOq5B,qBAAqB;AAC/B,YAAAE,YAAY7+B,KAAKmgC,cACnB;AAAA,UAAA,CAAC5B,GAAGhmC,cACPgmC,GAAGhmC,WAAWkC,SAASS,YAAAA,MAAkB,sBAAqB;AACpD2jC,kBAAA/9B,OAAOpE,YAAY6hC,EAC9B;AAAA,MAAA;AACA,YAAM9kC,QAAQ8kC,GAAGxlC;AACjB,YAAM6oC,cAAcrD,GAAGvlC;AAEjB,YAAA6oC,UAAU9+B,OAAM4N,eACtB;AAAA,YAAM0vB,YAAYxB,UAAUwB;AAC5B,YAAMC,YAAYzB,UAAUyB;AAC5B,YAAMwB,cAAczB,UAAUtnC,cAAc8oC,QAAQroC,IAAIC;AAElD,YAAAsoC,mBAAmB91B,IAAIpU,MAAMgqC,QAAQxoC;AAC3C,YAAM2oC,sBAAsBD,mBAAmBH;AAE/C,UAAI/pC,MAAMoU,IAAIpU;AACX,UAAAmqC,sBAAsB1B,UAAUtnC,eAAe,GAAE;AACnDnB,cAAMoU,IAAIpU,OAAO+pC,cAAc31B,IAAIvS,SAAS,IAAEwmC;AAC9C,YAAGroC,MAAMgqC,QAAQxoC,KAAK2oC,uBAAuB1B,UAAUtnC,cAAa;AACnEnB,gBAAMoU,IAAIpU;AAAAA,QACX;AAAA,MACD;AAEI,UAAAA,MAAMgqC,QAAQxoC,GAAG;AACpBxB,cAAMgqC,QAAQxoC;AAAAA,MACf;AAEA,YAAMG,IAAIF,KAAKyS,IAAIzS,KAAKuD,IAAIglC,QAAQroC,GAAGyS,IAAInU,OAAOmU,IAAI40B,MAAIpnC,QAAQwS,IAAIxS,MAASqoC,GAAAA,WAAAA;AAC/E,YAAMzoC,IAAIxB;AAELmI,WAAAggC,qBAAqBxmC,GAAGH;IAAC,OACxB;AACNklC,SAAGvkC,MAAMnC,MAAM;AACX,UAAAoU,IAAI40B,OAAO,GAAE;AAChBtC,WAAGvkC,MAAMjC,QAAQ;AACjBwmC,WAAGvkC,MAAMlC,OAAO;AAEhB8S,mBAAW,MACV2zB;AAAAA,aAAGvkC,MAAMlC,OAAO;AAAA,QAAA,GACf,CAAC;AAAA,MAAA,OACG;AACNymC,WAAGvkC,MAAMlC,OAAO;AAChBymC,WAAGvkC,MAAMjC,QAAQ;AAEjB6S,mBAAW,MAAA;AACV2zB,aAAGvkC,MAAMjC,QAAQ;AAAA,QAAA,GAChB,CACH;AAAA,MAAA;AACAwmC,SAAGxhC,aAAa,gBAAckP,IAAI40B,OAAO,IAAI,SAAS;AAChD99B,MAAAA,OAAAgC,MAAMrI,YAAY6hC,EACzB;AAAA,IAAA;AAAA,EACD;AAAA,EAEQ,iBAAiB3kC,MACxB;AAAA,UAAMmJ,SAAQ/C,KAAKiD;AACnB,UAAM/K,MAAM8H,KAAKw+B;AACb,QAAC5kC,CAAAA,QAAQA,SAAS1B,KAAI;AACzB;AAAA,IACD;AACG,QAAA0B,KAAKsH,QAAQ,yBAAA,GAA2B;AAC1ClB,WAAK41B,KACL;AAAA;AAAA,IACD;AAEA,UAAMqM,OAAOroC,KAAKmD;AAClB,QAAIklC,KAAKhlC,QAAQ,OAAgB,MAAA,IAAA;AAChC,YAAMgK,KAAKjH,KAAKy+B;AAChB17B,MAAAA,OAAMwuB,OAAOC,QAAQyQ,KAAK3kC,MAAM,KAAK,CAAGG,EAAAA,QAAQ,SAAQ,EAAA,CAAA,EAAKwJ,EAAE;AAAA,IAAA,OACzD;AACDjH,WAAA+/B,iBAAiBnmC,KAAKrB,UAC5B;AAAA,IAAA;AAAA,EACD;AAAA,EAEQ,gBAAA4nC;AACP,UAAMp9B,SAAQ/C,KAAKiD;AACnB,QAAI47B,YAAY7+B,KAAK8+B,aAAa9+B,KAAK8+B,aAAa/7B,OAAMiM;AAC1D,QAAI6vB,aAAaA,UAAU7lC,gBAAgB6lC,UAAU9lC,aAAa;AAC1D,aAAA,EACN+H,QAAQ+9B,WACRwB,WAAWt9B,OAAMsN,OACjBiwB,WAAWv9B,OAAMiM,WAAAA;AAAAA,IAEnB;AACA6vB,gBAAY7+B,KAAK8+B,aAAa9+B,KAAK8+B,aAAa/7B,OAAM4sB;AACtD,QAAIkP,aAAaA,UAAU7lC,gBAAgB6lC,UAAU9lC,aAAa;AAC1D,aAAA,EACN+H,QAAQ+9B,WACRwB,WAAWt9B,OAAMmsB,OACjBoR,WAAWv9B,OAAM4sB,WAAAA;AAAAA,IAEnB;AAEO,WAAA,EACN7uB,QAAQd,KAAK8+B,aAAa9+B,KAAK8+B,aAAa/7B,OAAMm/B,SAClD7B,WAAWt9B,OAAMm/B,SACjB5B,WAAWv9B,OAAMm/B,QAEnB;AAAA,EAAA;AAAA;AChdD,SAAAC,WAAwBp/B,QAAAA;AAEpB,MAACA,CAAAA,OAAMoC,KAAK;AACfpC,IAAAA,OAAMoC,MAAM;EACb;AACApC,EAAAA,OAAMoC,IAAIi9B,YAAY,IAAIlE,UAAUn7B;AAEpCA,EAAAA,OAAMuC,OAAO45B,oBAAoB,CAAC,aAAa,aAC/Cn8B;AAAAA,EAAAA,OAAMuC,OAAOq5B,sBAAsB;AACnC57B,EAAAA,OAAMuC,OAAO26B,kBAAkB;AAE/Bl9B,EAAAA,OAAMmS,UAAUusB,mBAAmB,SAAS51B,OAAOC,KAAKrL,IAAK;AAAA,WAAOA,GAAG4a,KAAKgnB,OAAO,GAAE,EAAE;AAAA,EAAA;AACvFt/B,EAAAA,OAAMmS,UAAUysB,qBAAqB,SAAS91B,OAAOC,KAAKrL,IAAAA;AAAY,WAAAA,GAAG6hC,WAAW7hC,GAAG4a;AAAAA,EAAA;AACvFtY,EAAAA,OAAMmS,UAAUwsB,kBAAkB,SAAS71B,OAAOC,KAAKrL,IACtD;AAAA,WAAOsC,OAAMmS,UAAUqtB,UAAU12B,OAAOC,KAAKrL,EAAAA;AAAAA,EAAE;AAEhDsC,EAAAA,OAAMmS,UAAUksB,mBAAmB,SAASv1B,OAAOC,KAAKqC;AAAc,WAAA;AAAA,EAAA;AAEtEpL,EAAAA,OAAMyE,YAAY,eAAe,SAASP,IAAG/H,GAAAA;AAExC,QAAC6D,CAAAA,OAAM2B,MAAMC,IAAIzD,QAAQhC,EAAEI,QAAQ,eAAc;AACpDsL,iBAAW;AACJ7H,QAAAA,OAAAoC,IAAIi9B,UAAUjE,KAAKl3B;SACvB;IACJ;AAEO,WAAA;AAAA,EAAA,CAAA;AAGR,QAAMu7B,SAAS,CAAC,gBAAgB,cAAc,sBAAsB,cAAA;AACpE,QAAMC,iBAAiB;AAChB1/B,IAAAA,OAAAoC,IAAIi9B,UAAUxM,KACb;AAAA,WAAA;AAAA,EAAA;AAER,WAAS95B,IAAE,GAAGA,IAAE0mC,OAAOzmC,QAAQD,KAAI;AAClCiH,IAAAA,OAAMyE,YAAYg7B,OAAO1mC,CAAI2mC,GAAAA,cAAAA;AAAAA,EAC9B;AAEM1/B,EAAAA,OAAAyE,YAAY,gBAAgB,SAAStI,GAC1C;AAAA,QAAIwjC,gBAAgB;AACd,UAAA5hC,SAAS1I,SAAS6F,cAAc,uBACtC;AAAA,QAAI6C,QAAO;AACV,YAAM6hC,iBAAiB5/B,OAAM2B,MAAMC,IAAI1D,UAAU/B,EAAEI,QAAQwB,MAC3D;AAAA,UAAI6hC,gBAAe;AACFD,wBAAA;AAAA,MACjB;AAAA,IACD;AACA,QAAIA,eAAc;AACFD,qBAAAA;AAAAA,IAChB;AAAA,EAAA,CAED;AAAA,WAASG,iBACF7/B;AAAAA,IAAAA,OAAAoC,IAAIi9B,UAAUxM;AACd7yB,IAAAA,OAAAoC,IAAIi9B,UAAU5D,gBAAgB;AAC7B,WAAA;AAAA,EACR;AACMz7B,EAAAA,OAAAyE,YAAY,gBAAgBo7B,cAAAA;AAC5B7/B,EAAAA,OAAAyE,YAAY,aAAao7B;AAG/B7/B,EAAAA,OAAM1D,MAAM5G,QAAQ,WAAW,SAASyG,GACnC;AAAA,QAAAA,EAAE+nB,YAAY,IAAG;AACdlkB,MAAAA,OAAAoC,IAAIi9B,UAAUxM,KACrB;AAAA,IAAA;AAAA,EAAA;AAGD7yB,EAAAA,OAAM8/B,gBAAgB,WACrB9/B;AAAAA,IAAAA,OAAMoC,IAAIi9B,UAAUjE,KAAKl+B,MAAM8C,OAAMoC,IAAIi9B,WAAWx7B,SAAAA;AAAAA,EAAS;AAE9D7D,EAAAA,OAAM2/B,gBAAgB,WACrB3/B;AAAAA,IAAAA,OAAMoC,IAAIi9B,UAAUxM,KAAK31B,MAAM8C,OAAMoC,IAAIi9B,WAAWx7B,SAAAA;AAAAA,EAAS;AAG9D;ACzEA,IAAIk8B,yBAAyB,CAAG,EAAE3K,YAAYzc;AAC9C,SAASqnB,aAAa9nC;AACrB,MAAI+nC,oBAAoB/nC,OAAOk9B,YAAYzc,SAAAA;AAE3C,SAAOsnB,sBAAsBF;AAC9B;AAEA,SAASz+B,KAAKpJ,QAAAA;AACb,MAAIa,GAAGkI;AAEP,MAAI/I,iBAAiBA,UAAU,UAAU;AAExC,YAAQ,MACP;AAAA,MAAA,KAAMgoC,OAAehoC,MACpB+I;AAAAA,iBAAS,IAAI0U,KAAKzd,MAAAA;AAClB;AAAA,MACD,KAAMioC,QAAgBjoC,MACrB+I;AAAAA,iBAAS,IAAItI,MAAMT,OAAOc,MAC1B;AAAA,aAAID,IAAI,GAAGA,IAAIb,OAAOc,QAAQD,KAAI;AACjCkI,iBAAOlI,CAAAA,IAAKuI,KAAKpJ,OAAOa;QACxB;AACD;AAAA,MAUD;AACC,YAAGinC,aAAa9nC,SAAQ;AACvB+I,mBAAS8c,OAAOpP,OAAOzW,MAC5B;AAAA,QAAA,OAAS;AACJ+I,mBAAS,CAAA;AAAA,QACT;AAED,aAAKlI,KAAKb,QAAQ;AACjB,cAAI6lB,OAAOnlB,UAAUwnC,eAAeljC,MAAMhF,QAAQ,CAACa,CAAAA,CAAAA,EAClDkI,QAAOlI,CAAKuI,IAAAA,KAAKpJ,OAAOa,CACzB,CAAA;AAAA,QAAA;AACF;AAAA,IAED;AAAA,EAAA;AACD,SAAOkI,UAAU/I;AAClB;AAEA,SAASuX,MAAOlT,QAAQohB,QAAQ0iB;AAC/B,WAASC,KAAK3iB,OACb,KAAMphB,OAAO+jC,OAAOhjC,UAAc+iC,MAAQ9jC,QAAO+jC,CAAG3iB,IAAAA,OAAO2iB;AAC5D,SAAO/jC;AACR;AAEA,SAASgkC,QAAQvkC,KAAAA;AAChB,gBAAc,OAAQ;AACvB;AAEA,IAAIwkC;AACJ,SAAS9K;AACR,MAAK8K,CAAAA,KACJA,SAAO,oBAAK7qB,QAAQjL,QAAAA;AAErB81B;AACA,SAAOA;AACR;AAGA,SAAS57B,KAAK67B,SAASvoC,QACtB;AAAA,MAAGuoC,QAAQ77B,KACV,QAAO67B,QAAQ77B,KAAK1M,MAEpB;AAAA,MAAA,QAAO;AAAY,WAAOuoC,QAAQvjC,MAAMhF,QAAO2L,SAAAA;AAAAA;AACjD;AAEA,SAASvH,MAAMkC,IAAIlC,QAAOyH,SAAS28B;AAClC,MAAIliC,GAAGmiC,iBACNniC,IAAGmiC,iBAAiBrkC,QAAOyH,SAAS28B,YAAYpjC,SAAY,QAAQojC,OAEhE;AAAA,WAAIliC,GAAGiG,YACXjG,IAAGiG,YAAY,OAAKnI,QAAOyH,OAAAA;AAC7B;AAEA,SAASsrB,YAAY7wB,IAAIlC,QAAOyH,SAAS28B,SAAAA;AACxC,MAAIliC,GAAGoiC,oBACNpiC,IAAGoiC,oBAAoBtkC,QAAOyH,SAAS28B,YAAYpjC,SAAY,QAAQojC;WAE/DliC,GAAG6G,YACX7G,IAAG6G,YAAY,OAAK/I,QAAOyH,OAAAA;AAC7B;;ACzFA,SAAS88B,YAAY/8B,UAAUO,aAC9BP;AAAAA,aAAWA,YAAYg9B;AACvBz8B,gBAAcA,eAAe08B;AAE7B,MAAIv9B,WAAW;AAEf,MAAIw9B,aAAa,EAChBv/B,QAAQ,SAASjD,IAAIlC,QAAOyI,UAAU27B,SAAAA;AACrCl9B,aAASvH,KAAK,EAACrB,SAAS4D,IAAIlC,OAAMA,QAAOyI,UAAoB27B,QAC7D58B,CAAAA;AAAAA,aAAStF,IAAIlC,QAAOyI,UAAU27B,OAC9B;AAAA,EAAA,GACD99B,QAAQ,SAASpE,IAAIlC,QAAOyI,UAAU27B,SAAAA;AACrCr8B,gBAAY7F,IAAIlC,QAAOyI,UAAU27B;AACjC,aAAQ3nC,IAAI,GAAGA,IAAIyK,SAASxK,QAAQD,KAAI;AACvC,UAAIgL,UAAUP,SAASzK,CAAAA;AACvB,UAAIgL,QAAQnJ,YAAY4D,MAAMuF,QAAQzH,UAAUA,UAASyH,QAAQgB,aAAaA,YAAYhB,QAAQ28B,YAAYA,SAAS;AACtHl9B,iBAASlK,OAAOP,GAAG,CACnBA;AAAAA;AAAAA,MACA;AAAA,IACD;AAAA,EACD,GACD8J,WAAW,WAAA;AACV,QAAIo+B,cAAcz9B,SAAS3K,MAE3B;AAAA,aAASE,IAAI,GAAGA,IAAIkoC,YAAYjoC,QAAQD,KAAI;AAC3C,UAAIgL,UAAUk9B,YAAYloC,CAC1BioC;AAAAA,iBAAWp+B,OAAOmB,QAAQnJ,SAASmJ,QAAQzH,OAAOyH,QAAQgB,UAAUhB,QAAQ28B,OAAAA;AAC5EM,iBAAWp+B,OAAOmB,QAAQnJ,SAASmJ,QAAQzH,OAAOyH,QAAQgB,UAAUzH;AACpE0jC,iBAAWp+B,OAAOmB,QAAQnJ,SAASmJ,QAAQzH,OAAOyH,QAAQgB,UAAU,KAAA;AACpEi8B,iBAAWp+B,OAAOmB,QAAQnJ,SAASmJ,QAAQzH,OAAOyH,QAAQgB,UAAU,IACpE;AAAA,IAAA;AACDvB,aAASlK,OAAO,GAAGkK,SAASxK,MAC5B;AAAA,EAAA,GACDkoC,QAAQ,WACP;AAAA,WAAOL,YAAY5jC,KAAKX,OAAOW,KAAKoyB;EACpC,EAGF;AAAA,SAAO2R;AACR;ACzBO,MAAMG,QAAAA;AAAAA,EAKZ,YAAYnhC,QAAAA;AACX/C,SAAKiD,SAASF;AAAAA,EACf;AAAA,EAEA,UACC;AAAA,UAAMA,SAAQ/C,KAAKiD;AACf,SAACjD,KAAKmkC,cAAa;AACjBnkC,WAAAmkC,eAAe/rC,SAASoE,cAAc,KAC3CwD;AAAAA,WAAKmkC,aAAapnC,YAAY;AACxBgG,MAAAA,OAAA08B,SAAS2E,YAAYpkC,KAAKmkC,YAAAA;AAAAA,IACjC;AACA,WAAOnkC,KAAKmkC;AAAAA,EACb;AAAA,EAEA,YAAYvqC,MAAAA;AACXoG,SAAKqkC,QAAQzqC;AACN,WAAAoG;AAAAA,EACR;AAAA,EAIA,KAAKlI,MAA2BD,KAAAA;AAC/B,UAAMkL,SAAQ/C,KAAKiD;AACnB,UAAM47B,YAAYzmC,SAASD;AACrB,UAAAyB,OAAOoG,KAAK+sB;AAElB,QAAI4H,CAAAA,UAAqB/6B,MAAMilC,SAAW,GAAA;AACzC7+B,WAAK41B,KAGLh8B;AAAAA,WAAKI,MAAMnC,MAAM+B,KAAKI,MAAMnC,OAAO;AACnC+B,WAAKI,MAAMlC,OAAO8B,KAAKI,MAAMlC,QAAQ;AACrC+mC,gBAAUniC,YAAY9C,IAAAA;AAAAA,IACvB;AAEI,QAAAoG,KAAKskC,kBAAkBxsC,IAAAA,GAAO;AAC3B,YAAA6L,WAAW3D,KAAKukC,0BAA0BzsC,IAAAA;AAChDD,YAAM8L,SAAS9L;AACfC,aAAO6L,SAAS7L;AAAAA,IACjB;AAEK8B,SAAAI,MAAMnC,MAAMA,MAAM;AAClB+B,SAAAI,MAAMlC,OAAOA,OAAO;AAEnBiL,IAAAA,OAAA08B,SAAS+E,mBAAmB5qC,IAAAA;AAC3B,WAAAoG;AAAAA,EACR;AAAA,EACA,OACC;AAAA,UAAM+C,SAAQ/C,KAAKiD;AACb,UAAArJ,OAAOoG,KAAK+sB,QAAAA;AACf,QAAAnzB,QAAQA,KAAKrB,YAAW;AACrBqB,WAAArB,WAAWqE,YAAYhD,IAC7B;AAAA,IAAA;AACMmJ,IAAAA,OAAA08B,SAASgF,kBAAkB7qC;AAC1B,WAAAoG;AAAAA,EACR;AAAA,EAEA,WAAWwd,MACJ;AAAA,UAAA5jB,OAAOoG,KAAK+sB;AAClBnzB,SAAKyE,YAAYmf;AACV,WAAAxd;AAAAA,EACR;AAAA,EAGQ,kBAAkBX,QAAAA;AACzB,QAAKA,CAAAA,UAAAA,OAAgBA,WAAU,UAAU;AACjC,aAAA;AAAA,IACR;AACO,WAAA,aAAaA,UAAS,aAAaA;AAAAA,EAC3C;AAAA,EAEQ,eACA;AAAA,WAAAW,KAAKqkC,SAASjsC,SAASD;AAAAA,EAC/B;AAAA,EAGQ,0BAA0BkH;AACjC,UAAM0D,SAAQ/C,KAAKiD;AAEb,UAAAyhC,WAAY1kC,KAAK2kC,iBACjB;AAAA,UAAAC,cAAc5kC,KAAK+sB,QAAAA;AACzB,UAAM8X,WAAoB,EACzBhtC,KAAI,GACJC,MAAM,GACN2B,OAAOmrC,YAAY7rC,aACnBW,QAAQkrC,YAAY5rC,cACpBhB,QAAQ,GACRD,OAAO,EAAA;AAGF,UAAA+sC,UAAU/hC,OAAMuC,OAAOy/B;AACvB,UAAAC,UAAUjiC,OAAMuC,OAAO2/B;AAE7B,UAAMpG,YAAYzmC,SAASD;AAC3B,UAAM+sC,QAAQC,yBAAoC9lC,QAAOw/B,SACnD;AAAA,UAAAuG,eAAeC,gBAA2BxG,SAAAA;AAChDqG,UAAM7rC,KAAK+rC,aAAa/rC;AAExBwrC,IAAAA,SAAQhtC,MAAMqtC,MAAM7rC;AACpBwrC,IAAAA,SAAQ/sC,OAAOotC,MAAM1rC;AACrBqrC,IAAAA,SAAQhtC,OAAOmtC;AACfH,IAAAA,SAAQ/sC,QAAQgtC;AACRD,IAAAA,SAAA7sC,SAAS6sC,SAAQhtC,MAAMgtC,SAAQnrC;AAC/BmrC,IAAAA,SAAA9sC,QAAQ8sC,SAAQ/sC,OAAO+sC,SAAQprC;AAEjC,UAAAjB,YAAYC,OAAOmY,UAAUiuB,UAAUrmC;AAE7C,QAAGqsC,SAAQhtC,MAAM6sC,SAAS7sC,MAAMW,WAAU;AACzCqsC,MAAAA,SAAQhtC,MAAM6sC,SAAS7sC;AACfgtC,MAAAA,SAAA7sC,SAAS6sC,SAAQhtC,MAAMgtC,SAAQnrC;AAAAA,IAC/B,WAAAmrC,SAAQ7sC,SAAS0sC,SAAS1sC,QAAO;AACzC6sC,MAAAA,SAAQ7sC,SAAS0sC,SAAS1sC;AAClB6sC,MAAAA,SAAAhtC,MAAMgtC,SAAQ7sC,SAAS6sC,SAAQnrC;AAAAA,IACxC;AAEG,QAAAmrC,SAAQ/sC,OAAO4sC,SAAS5sC,MAAK;AAC/B+sC,MAAAA,SAAQ/sC,OAAO4sC,SAAS5sC;AAChB+sC,MAAAA,SAAA9sC,QAAQ2sC,SAAS5sC,OAAO+sC,SAAQprC;AAAAA,IAChC,WAAAorC,SAAQ9sC,QAAQ2sC,SAAS3sC,OAAM;AACvC8sC,MAAAA,SAAQ9sC,QAAQ2sC,SAAS3sC;AACjB8sC,MAAAA,SAAA/sC,OAAO+sC,SAAQ9sC,QAAQ8sC,SAAQprC;AAAAA,IACxC;AAEA,QAAGyrC,MAAM1rC,KAAKqrC,SAAQ/sC,QAAQotC,MAAM1rC,KAAKqrC,SAAQ9sC,OAAO;AACvD8sC,MAAAA,SAAQ/sC,OAAOotC,MAAM1rC,IAAIqrC,SAAQprC,QAAQqrC;AACjCD,MAAAA,SAAA9sC,QAAQ8sC,SAAQ/sC,OAAO+sC,SAAQprC;AAAAA,IACxC;AAEA,QAAGyrC,MAAM7rC,KAAKwrC,SAAQhtC,OAAOqtC,MAAM7rC,KAAKwrC,SAAQ7sC,QAAQ;AACvD6sC,MAAAA,SAAQhtC,MAAMqtC,MAAM7rC,IAAIwrC,SAAQnrC,SAASsrC;AACjCH,MAAAA,SAAA7sC,SAAS6sC,SAAQhtC,MAAMgtC,SAAQnrC;AAAAA,IACxC;AAEO,WAAAmrC;AAAAA,EACR;AAAA,EAEQ;AACP,UAAM9hC,SAAQ/C,KAAKiD;AACb,UAAA47B,YAAY7+B,KAAKslC,aACvB;AAAA,QAAIZ,WAAW7F;AACf,QAAIrmC,YAAYC,OAAOmY,UAAUxY,SAASD,KAAKK;AAC/C,QAAIG,aAAaF,OAAOiY,UAAUtY,SAASD,KAAKQ;AAC5C,QAAAsT;AAED,QAAA4yB,cAAc97B,OAAMiM,YAAW;AACjC01B,iBAAW3hC,OAAMsN;AACL7X,kBAAA;AACCG,mBAAA;AACPsT,YAAAo5B,gBAA2BtiC,OAAMsN;IAAK,OACxC;AACEpE,YAAAo5B,gBAA2BX,QAClC;AAAA,IAAA;AACO,WAAA,EACN5sC,MAAKmU,IAAIzS,IAAIb,YACbd,KAAKoU,IAAI5S,IAAIb,WACbiB,OAAOwS,IAAIxS,OACXC,QAAQuS,IAAIvS,QACZ1B,QAAQiU,IAAI5S,IAAI4S,IAAIvS,SAASlB,WAC7BT,OAAOkU,IAAIzS,IAAIyS,IAAIxS,QAAQd,WAE7B;AAAA,EAAA;AAAA;AClKM,MAAM4sC,eAAAA;AAAAA,EAQZ,YAAYxiC;AALZ/C,SAAQwlC,aAAqB;AAMvBxlC,SAAA6kC,UAAU,IAAIX,QAAQnhC,MAAAA;AAC3B/C,SAAKiD,SAASF;AACd/C,SAAKkD,aAAauiC,YAAAA;AAClBzlC,SAAK0lC,sBAAAA;AAAAA,EACN;AAAA,EAEA;AACC1lC,SAAK6kC,QAAQjP,KACb51B;AAAAA,SAAKkD,WAAW0C,UAAAA;AAAAA,EACjB;AAAA,EACA,cAAA+/B;AACC3lC,SAAK4lC,UAAAA;AAAAA,EACN;AAAA,EACA,OAAOtgC,SACN;AAAA,QAAIjK,OAAOjD,SAASD;AACpB,UAAM4K,SAAQ/C,KAAKiD;AAChB,QAAA,CAACqC,QAAO3C,QAAO;AACjBtH,aAAO0H,OAAMgC;AAAAA,IACd;AAEA,QAAI8gC,kBAAkB;AAChB,UAAA/+B,UAAWzH,CAAAA,WACV;AAAA,YAAAymC,cAAcC,cAAyB1mC;AAC7C,YAAM2mC,aAAa/Q,QAAmB6Q,aAAaxgC,QAAOnE;AAC1D,UAAGwzB,UAAqBmR,aAAa9lC,KAAK6kC,QAAQ9X,QAAAA,CAAAA,GAAW;AAC5D;AAAA,MACD;AAEA,YAAMkZ,iBAAiB,MAAA;AACJJ,0BAAAG;AACX1gC,QAAAA,QAAA4gC,aAAa7mC,QAAO2mC,UAAU;AAAA,MAAA;AAGtC,UAAGH,iBAAgB;AACf,YAAAG,cAAcA,eAAeH,iBAAgB;AACxCvgC,UAAAA,QAAA6gC,YAAY9mC,QAAO2mC,UAAU;AAAA,QAAA,OAChC;AACG1gC,UAAAA,QAAA8gC,aAAa/mC,QAAOwmC,eAAAA;AACTA,4BAAA;AAEf,cAAAG,cAAcA,eAAeH,iBAAgB;AAChCI,2BAChB;AAAA,UAAA;AAAA,QACD;AAAA,MAAA,OACI;AACJ,YAAGD,YAAW;AACEC;QAChB;AAAA,MACD;AAAA,IAAA;AAGIjmC,SAAA2F,OAAOL,QAAOnE,QAAAA;AACnBnB,SAAKkD,WAAWsB,OAAOnJ,MAAM,aAAayL,OACrC9G;AAAAA,SAAAwlC,WAAWlgC,QAAOnE,QAAAA,IAAY,EAClCvH,MAAMyB,MACNyL,QAAAA;AAAAA,EAEF;AAAA,EAEA,OAAO3F;AACA,UAAAklC,WAAWrmC,KAAKwlC,WAAWrkC,QAAAA;AACjC,QAAGklC,UAAS;AACXrmC,WAAKkD,WAAWyC,OAAO0gC,SAASzsC,MAAM,aAAaysC,SAASv/B,OAAAA;AAAAA,IAC7D;AAAA,EACD;AAAA,EAEA,WAAWxB,SAAAA;AACJ,UAAAghC,gBAAiBjnC,CAAAA;AACtB,UAAIknC,QAAQlnC;AAGZ,UAAGjH,SAAS,yBAAyBA,SAASouC,aAAY;AAEjDD,gBAAAnuC,SAAS,mBAAA,EAAqBiH;MACvC;AACO,aAAAknC;AAAAA,IAAA;AAERvmC,SAAK0lC;AACL1lC,SAAKwE,OAAO,EACXrD,UAAUmE,QAAOnE,UACjBwB,QAAQ2C,QAAO3C,QACfujC,cAAa,CAAC7mC,QAAmBzF;AAChC,YAAM4jB,OAAOlY,QAAOkY,KAAKne,QAAOzF,IAAAA;AAChC,UAAG4jB,MAAK;AACPxd,aAAKymC,UAAUH,cAAcjnC,MAAAA,GAAQme;MACtC;AAAA,IAED2oB,GAAAA,aAAY,CAAC9mC,QAAmBzF,SAC/B;AAAA,YAAM4jB,OAAOlY,QAAOkY,KAAKne,QAAOzF,IAChC;AAAA,UAAG4jB,MAAK;AACPxd,aAAKymC,UAAUH,cAAcjnC,MAAQme,GAAAA,IAAAA;AAAAA,MAAI,OACrC;AACJxd,aAAKymC,UAAUh8B,eAAAA;AACfzK,aAAK4lC,UAAAA;AAAAA,MACN;AAAA,OAEDQ,cAAa,MAAA;AACZpmC,WAAKymC,UAAUh8B,eACfzK;AAAAA,WAAK4lC;IAAU,EAGlB,CAAA;AAAA,EAAA;AAAA,EAEQ,wBACP;AAAA,UAAM7iC,SAAQ/C,KAAKiD;AAEnB,QAAGjD,KAAKymC,WAAU;AACjBzmC,WAAKymC,UAAUh8B,eAAAA;AAAAA,IAChB;AACA,QAAGzK,KAAK4lC,WAAU;AACjB5lC,WAAK4lC,UAAUn7B,eAChB;AAAA,IAAA;AACAzK,SAAK6kC,QAAQjP;AAEb51B,SAAKymC,YAAYC,MAAc,CAACrnC,QAAmBme;AAClD,UAAGza,OAAMgF,UAAU,mBAAmB,CAAC1I,MAAAA,CAAAA,MAAY,OAAO;AACzDW,aAAK6kC,QAAQjP,KAAK;AAAA,MAAA,OACZ;AACD51B,aAAA6kC,QAAQ9F,WAAWvhB,IAAAA;AACnBxd,aAAA6kC,QAAQ1G,KAAK9+B,MACnB;AAAA,MAAA;AAAA,IAAA,GACE0D,OAAMuC,OAAOqhC,mBAAmB;AAE9B3mC,SAAA4lC,YAAYc,MAAc,MAAA;AAC9B1mC,WAAKymC,UAAUh8B;AACfzK,WAAK6kC,QAAQjP,KAAK;AAAA,IAAA,GAChB7yB,OAAMuC,OAAOshC,wBAAwB,CACzC;AAAA,EAAA;AAAA;ACzJD,SAAA/B,QAAwB9hC,QAExBA;AAAAA,EAAAA,OAAMuC,OAAOqhC,kBAAkB;AAC/B5jC,EAAAA,OAAMuC,OAAO2/B,mBAAmB;AAChCliC,EAAAA,OAAMuC,OAAOy/B,mBAAmB;AAChChiC,EAAAA,OAAMuC,OAAOshC,uBAAuB;AAI9B,QAAAC,iBAAiB,IAAItB,eAAexiC;AAE1CA,EAAAA,OAAMoC,IAAI2hC,WAAWD;AAEf9jC,EAAAA,OAAAyE,YAAY,gBAAgB,WAE9B;AAAA,QAAA,CAACzE,OAAMgC,MAAO;AACjB8hC,mBAAeE,WAAW,EACzB5lC,UAAU,MAAI4B,OAAMuC,OAAO6pB,iBAAe,0BAC1C3R,MAAOne,CAAAA,WACN;AAAA,UAAI0D,OAAMuC,OAAO0hC,UAAUjkC,OAAMuC,OAAO2hC,eAAe;AACtD;AAAA,MACD;AAEM,YAAAC,eAAenkC,OAAMisB,OAAO3vB,MAC/B;AAAA,UAAA0D,OAAM0d,aAAaymB,YAAAA,GAAc;AAC7B,cAAA/4B,OAAOpL,OAAMmc,QAAQgoB,YAC3B;AAAA,eAAOnkC,OAAMmS,UAAUiyB,aAAah5B,KAAKgE,YAAYhE,KAAKiE,UAAUjE,IAAAA;AAAAA,MACrE;AACO,aAAA;AAAA,IAAA,GAERxL,QAAQ;EACR,CAGII;AAAAA,EAAAA,OAAAyE,YAAY,aAAa,WAAA;AAC9Bq/B,mBAAe53B,WAAAA;AAAAA,EAAW,CAGrBlM;AAAAA,EAAAA,OAAAyE,YAAY,cAAc,WAAA;AAC/Bq/B,mBAAelB,YAAAA;AAAAA,EAAY,CAE5B;AAAA,QAAMyB,eAAe,MACd;AAAA,UAAAxjC,QAAQb,OAAMwK,SACb;AAAA,WAAA,CAAA,CAAE3J,MAAMyjC;AAAAA,EAAA;AAEVtkC,EAAAA,OAAAyE,YAAY,mBAAmB;AACpC,QAAI4/B,aAAAA,GAAe;AACX,aAAA;AAAA,IACR;AAAA,EAAA;AAGKrkC,EAAAA,OAAAyE,YAAY,iBAAiB,WAAA;AAClCq/B,mBAAelB,YAAAA;AAAAA,EAAY;AAG5B;ACvDA,MAAM2B,UAAU,EACfC,cAAc,eACdC,cAAc,cAGf;AAAA,MAAMC,eAAe,CACpB,mBACA,qBACA,uBACA,qBACA,qBAGM;AAAA,MAAMC,QAaZ;AAAA,EAAA,YAAYtb,OAAarpB,QAAAA;AAZzB/C,SAAQ2nC,eAAe;AACvB3nC,SAAQ4nC,aAAa;AACrB5nC,SAAQ6nC,UAAU;AAClB7nC,SAAQ8nC,oBAAoB;AAC5B9nC,SAAQ+nC,gBAAgB;AACxB/nC,SAAQgoC,gBAAgB;AACxBhoC,SAAQioC,eAAgB;AACxBjoC,SAAQkoC,eAAe;AAMtBloC,SAAKmoC,QAAQ/b;AACbpsB,SAAKiD,SAASF;AACd/C,SAAKooC,cACN;AAAA,EAAA;AAAA,EAEA,MAAMnhC,IAAqBgL,MAAmBo2B,YAAqB,OAAA;AAClE,QAAIp2B,SAASjS,KAAKiD,OAAOqC,OAAOgjC,WAAWn6B,MAAM;AACzC,aAAAnO,KAAKuoC,WAAWthC,IAAIohC,SAC5B;AAAA,IAAA;AACA,QAAIp2B,SAASjS,KAAKiD,OAAOqC,OAAOgjC,WAAW9nB,MAAM;AACzC,aAAAxgB,KAAKwoC,WAAWvhC,IAAIohC,SAAAA;AAAAA,IAC5B;AACO,WAAA;AAAA,EACR;AAAA,EACA,sBACC;AAAA,WAAOroC,KAAK8nC;AAAAA,EACb;AAAA,EACA,uBAAuBW,UACtBzoC;AAAAA,SAAK8nC,oBAAoBW,YAAY;AAAA,EACtC;AAAA,EACA,cACCzoC;AAAAA,SAAK6nC,UAAU;AAAA,EAChB;AAAA,EACA,aACC7nC;AAAAA,SAAK6nC,UAAU;AAAA,EAChB;AAAA,EACA,mBAAAa;AAEK,QAAC1oC,CAAAA,KAAK6zB,UAAS;AACb7zB,WAAA6zB,WAAWjpB,WAAW,MAC1B5K;AAAAA,aAAK2oC;AACL3oC,aAAK6zB,WAAW;AAAA,MAAA,GACd,EACJ;AAAA,IAAA;AAGI,QAAA7zB,KAAK6nC,WAAW7nC,KAAK4nC,YAAY;AACpC;AAAA,IACD;AAEA5nC,SAAK4nC,aAAa;AAClB5nC,SAAK2nC,eAAe3nC,KAAKmoC,MAAMrvB,OAAOpH;EACvC;AAAA,EACA;AACC,QAAI1R,KAAK6nC,SAAS;AACjB;AAAA,IACD;AACA,UAAMzb,QAAOpsB,KAAKmoC;AAClB,QAAInoC,KAAK2nC,cAAc;AACjBvb,MAAAA,MAAAwc,UAAU5oC,KAAK2nC,YACrB;AAAA,IAAA;AACA3nC,SAAK4nC,aAAa;AAClB5nC,SAAK2nC,eAAe;AAAA,EACrB;AAAA,EACA,YAAYx5B,MAAAA;AACP,QAACnO,CAAAA,KAAK6nC,SAAS;AAClB7nC,WAAK6oC,kBAAkB16B,MAAMnO,KAAKmoC,MAAM3gB,QAAQvV,KAAK3F,GACtD;AAAA,IAAA;AAAA,EACD;AAAA,EACA,cAAc6B,MAAAA;AACT,SAACnO,KAAK6nC,SAAS;AAClB7nC,WAAK6oC,kBAAkB16B,MAAMnO,KAAKmoC,MAAM3gB,QAAQvV,KAAK62B,MAAAA;AAAAA,IACtD;AAAA,EACD;AAAA,EACA,YAAY36B,MAAAA;AACP,SAACnO,KAAK6nC,SAAS;AACjB15B,WAAa46B,eAAe/oC,KAAKiD,OAAOurB,aAAargB,KAAKlH;AACtDjH,WAAAgpC,oBACJ76B,MACAnO,KAAKipC,eAAe96B,KAAKlH,KACzBjH,KAAKmoC,MAAM3gB,QAAQvV,KAAKi3B,MACxBlpC,KAAKmoC,MAAM3gB,QAAQ2hB,OAAOh7B;IAE5B;AAAA,EACD;AAAA,EACA,cAAcA,MAAAA;AACT,QAACnO,CAAAA,KAAK6nC,SAAS;AAClB7nC,WAAK6oC,kBAAkB16B,MAAMnO,KAAKmoC,MAAM3gB,QAAQvV,KAAK1B,MACrD;AAAA,UAAIvQ,KAAKioC,aAAa95B,KAAKlH,EAAAA,GAAK;AAC/B,cAAMmiC,WAAWppC,KAAKioC,aAAa95B,KAAKlH;AACxC,iBAASnL,IAAI,GAAGA,IAAIstC,SAASrtC,QAAQD,KAAK;AACpCkE,eAAA6oC,kBAAkBO,SAASttC,CAAAA,GAAIkE,KAAKmoC,MAAM3gB,QAAQvV,KAAK1B,MAAAA;AAAAA,QAC7D;AAAA,MACD;AACA,UAAIvQ,KAAKkoC,aAAa/5B,KAAKlH,EAAK,GAAA;AAC/B,cAAMoiC,gBAAgBrpC,KAAKkoC,aAAa/5B,KAAKlH,EAC7C;AAAA,iBAASnL,IAAI,GAAGA,IAAIutC,cAActtC,QAAQD,KAAK;AACzCkE,eAAAspC,kBAAkBD,cAAcvtC,CAAIkE,GAAAA,KAAKmoC,MAAM3gB,QAAQvV,KAAK1B;QAClE;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA,EACA,YAAYiQ,MAAAA;AACP,QAACxgB,CAAAA,KAAK6nC,SAAS;AAClB7nC,WAAKspC,kBAAkB9oB,MAAMxgB,KAAKmoC,MAAM3gB,QAAQvV,KAAK3F,GAAAA;AAAAA,IACtD;AAAA,EACD;AAAA,EACA,cAAckU;AACT,QAACxgB,CAAAA,KAAK6nC,SAAS;AAClB7nC,WAAKspC,kBAAkB9oB,MAAMxgB,KAAKmoC,MAAM3gB,QAAQvV,KAAK62B,MAAAA;AAAAA,IACtD;AAAA,EACD;AAAA,EACA,cAActoB,MACT;AAAA,QAAA,CAACxgB,KAAK6nC,SAAS;AAClB7nC,WAAKspC,kBAAkB9oB,MAAMxgB,KAAKmoC,MAAM3gB,QAAQvV,KAAK1B;IACtD;AAAA,EACD;AAAA,EACA,eAAetJ,IAAYsiC,SAC1B;AAAA,UAAMxmC,SAAQ/C,KAAKiD;AACnB,QAAIkL,OAAO;AACX,UAAMkF,SAAQ,CAAA;AACd,QAAIm2B,UAAUxpC,KAAKypC,UAAU1mC,OAAMmc,QAAQjY,EAAAA,CAAAA;AAE3C,aAASnL,IAAI,GAAGA,IAAIytC,QAAQxtC,QAAQD,KAAK;AACxCqS,aAAOnO,KAAK0pC,eAAeH,QAAQztC;AACnC0tC,gBAAUA,QAAQthC,OAAOlI,KAAKypC,UAAUt7B,IAAAA,CAAAA;AACxCkF,MAAAA,OAAMrU,KAAKmP,IAAAA;AAAAA,IACZ;AAEA,UAAMw7B,cAAc,CAAA;AACpB,aAAS7tC,IAAI,GAAGA,IAAI0tC,QAAQztC,QAAQD,KAAK;AAC5B6tC,kBAAAH,QAAQ1tC,CAAAA,CAAAA,IAAM;AAAA,IAC3B;AACA,UAAM6hB,QAAQ,CAAA;AACd,eAAW7hB,KAAK6tC,aAAa;AAC5BhsB,YAAM3e,KAAKgB,KAAK4pC,eAAe9tC;IAChC;AACKkE,SAAAioC,aAAahhC,EAAMoM,IAAAA;AACnBrT,SAAAkoC,aAAajhC,EAAAA,IAAM0W;AAAAA,EACzB;AAAA,EACA,eAAe1W,IAAYohC,WAC1B;AAAA,UAAMtlC,SAAQ/C,KAAKiD;AACf,QAAAolC,cAAeroC,CAAAA,KAAK+nC,cAAc9gC,EAAAA,KAAAA,CAAQjH,KAAK4nC,aAAa;AAC/D,YAAMz5B,OAAOpL,OAAMsB,KAAKtB,OAAMmc,QAAQjY,EACjCkH,CAAAA;AAAAA,WAAA07B,SAAS9mC,OAAM2rB,mBAAmBznB,EAAAA;AAClCkH,WAAA46B,eAAehmC,OAAMyrB,aAAavnB,EAAAA;AAClCjH,WAAA8pC,qBAAqB7iC,IAAIkH,IAC/B;AAAA,IAAA;AACO,WAAAnO,KAAK+nC,cAAc9gC,EAAAA;AAAAA,EAC3B;AAAA,EACA,eAAeA;AACP,WAAAjH,KAAK+nC,cAAc9gC,EAC3B;AAAA,EAAA;AAAA,EACA,oBAAA8iC;AACC/pC,SAAK+nC,gBAAgB;EACtB;AAAA,EACA,qBAAqB9gC,IAAYhM;AAC3B+E,SAAA+nC,cAAc9gC,EAAMhM,IAAAA;AAAAA,EAC1B;AAAA,EACA,eAAegM,IAAYohC,WAAAA;AAC1B,SAAKroC,KAAKgoC,cAAc/gC,QAAQjH,KAAK4nC,YAAY;AAC3C5nC,WAAAgoC,cAAc/gC,EAAAA,IAAMjH,KAAKiD,OAAOoB,KAAKrE,KAAKiD,OAAO+mC,QAAQ/iC,EAAAA,CAAAA;AAAAA,IAC/D;AACO,WAAAjH,KAAKgoC,cAAc/gC,EAAAA;AAAAA,EAC3B;AAAA,EACA,eAAeA,IACP;AAAA,WAAAjH,KAAKgoC,cAAc/gC,EAAAA;AAAAA,EAC3B;AAAA,EACA,oBAAAgjC;AACCjqC,SAAKgoC,gBAAgB;EACtB;AAAA,EACQ,gBAAAI;AACP,QAAI8B,sBAAsB;AAC1B,UAAMnnC,SAAQ/C,KAAKiD;AAEnB,UAAMknC,iBAAiB,MAAA;AACtB,WAAKD,qBAAqB;AACzBA,8BAAsBt/B,WAAW,MAAA;AACVs/B,gCAAA;AAAA,QAAA,CAAA;AAGvBlqC,aAAK+pC,kBAAAA;AACChnC,QAAAA,OAAA6Q,SAAUzF;AACVnO,eAAA0pC,eAAev7B,KAAKlH,EAAAA;AAAAA,QAAE,CAG5BjH;AAAAA,aAAKiqC;AACLlnC,QAAAA,OAAMqnC,SAAAA,EAAWjhC,QAASqX,UAAAA;AACpBxgB,eAAA4pC,eAAeppB,KAAKvZ,EAAE;AAAA,QAAA,CAAA;AAAA,MAE7B;AAAA;AAEK,UAAAojC,wBAAyBpjC,QACvBlE,OAAMsB,KAAKtB,OAAMmc,QAAQjY,EAGjC,CAAA;AAAA,eAAWnL,KAAKwrC,SAAS;AAClBvkC,MAAAA,OAAAyE,YAAY1L,GAAG;AACpBkE,aAAKsqC,YAAAA;AACE,eAAA;AAAA,MAAA,CAERvnC;AAAAA,MAAAA,OAAMyE,YAAY8/B,QAAQxrC,CAAAA,GAAI;AAC7BkE,aAAKuqC,WAAAA;AACE,eAAA;AAAA,MAAA,CAAA;AAAA,IAET;AAEA,aAASzuC,IAAK,GAAGA,IAAI2rC,aAAa1rC,QAAQD,KAAK;AAC9CiH,MAAAA,OAAMyE,YAAYigC,aAAa3rC,CAAAA,GAAI,MAClCkE;AAAAA,aAAK0oC,iBACE;AAAA,eAAA;AAAA,MAAA,CAET;AAAA,IAAA;AAEM3lC,IAAAA,OAAAyE,YAAY,WAAW;AAC5BxH,WAAKmoC,MAAMqC,eACXxqC;AAAAA,WAAKmoC,MAAMsC,eAAAA;AACIN;IAAA,CAEhBpnC;AAAAA,IAAAA,OAAMyE,YAAY,kBAAkB,CAACP,IAAYkH,SAC3CnO;AAAAA,WAAA0pC,eAAeziC,IAAI,IACxBjH;AAAAA,WAAK0qC,YAAYv8B,IAAI;AAAA,IAAA,CAAA;AAEtBpL,IAAAA,OAAMyE,YAAY,qBAAqB,CAACP,IAAYkH,SAAAA;AACnDnO,WAAK2qC,cAAcx8B,IAAI;AAAA,IAAA,CAAA;AAExBpL,IAAAA,OAAMyE,YAAY,uBAAuB,CAACP,IAAYkH,SACrDnO;AAAAA,WAAK2qC,cAAcx8B,IAAI;AAAA,IAAA,CAAA;AAExBpL,IAAAA,OAAMyE,YAAY,qBAAqB,CAACP,IAAYkH,SACnDnO;AAAAA,WAAK4qC,cAAcz8B,IAAI;AAAA,IAAA,CAAA;AAExBpL,IAAAA,OAAMyE,YAAY,kBAAkB,CAACP,IAAYuZ,SAC3CxgB;AAAAA,WAAA4pC,eAAe3iC,IAAI,IAAA;AACxBjH,WAAK6qC,YAAYrqB,IAAAA;AAAAA,IAAI;AAEtBzd,IAAAA,OAAMyE,YAAY,qBAAqB,CAACP,IAAYuZ,SAAAA;AACnDxgB,WAAK8qC,cAActqB,IAAAA;AAAAA,IAAI;AAExBzd,IAAAA,OAAMyE,YAAY,qBAAqB,CAACP,IAAYuZ,SACnDxgB;AAAAA,WAAK+qC,cAAcvqB,IAAAA;AAAAA,IAAI;AAExBzd,IAAAA,OAAMyE,YAAY,gBAAgB,CAACP,IAAY3H,WAAAA;AACzCU,WAAAgrC,YAAYX,sBAAsBpjC,EACvCjH,CAAAA;AAAAA,WAAKirC,uBACE;AAAA,aAAA;AAAA,IAAA,CAEFloC;AAAAA,IAAAA,OAAAyE,YAAY,sBAAuBP,QAAAA;AACxCjH,WAAK8W,MAAM7P,IAAIlE,OAAMuC,OAAOgjC,WAAWn6B,IAAAA;AACvC,YAAM+8B,SAAS,CAAA;AAGAf;AAETpnC,MAAAA,OAAA6Q,SAAUzF;AACR+8B,eAAAlsC,KAAKmP,KAAKlH,EAAAA;AAAAA,MAAE,GACjBA,EAAAA;AACEjH,WAAAmrC,eAAelkC,IAAIikC;AACjB,aAAA;AAAA,IAAA;AAEF,UAAAE,YAAYroC,OAAMsoC,aAAa,MAErCD;AAAAA,cAAU5jC,YAAY,oBAAoB,CAACP,IAAYnG,QAAgBwqC,WAClE;AAAA,UAAA,CAACtrC,KAAKurC,oBAAuB,GAAA;AACjBpB,uBAChB;AAAA,MAAA;AACO,aAAA;AAAA,IAAA;AAGRiB,cAAU5jC,YAAY,mBAAmB,CAACP,IAAYnG,QAAgBwqC,WACjE;AAAA,UAAA,CAACtrC,KAAKurC,oBAAAA,GAAuB;AAC3BvrC,aAAAgrC,YAAYX,sBAAsBpjC,EAAAA,CAAAA;AAAAA,MACxC;AACO,aAAA;AAAA,IAAA,CAAA;AAGRlE,IAAAA,OAAMyE,YAAY,kBAAkB,CAACP,IAAY3H,QAAgBJ,MAAAA;AAChEc,WAAKirC,uBAAuB,IAAA;AACbd;AACR,aAAA;AAAA,IAAA;AAGR,QAAIqB,SAAS;AACb,QAAIC,cAAc;AACZ1oC,IAAAA,OAAAyE,YAAY,oBAAqB8mB,YAC7Bkd;AAAAA,eAAAzoC,OAAMwK,SAAAA,EAAWm+B;AAC1B,UAAIF,WAAWld,QAAO;AACf,cAAAngB,OAAOpL,OAAMmc,QAAQoP,MAAAA;AAC3B,YAAIvrB,OAAM4oC,cAAcx9B,SAASpL,OAAMuC,OAAOsmC,cAAa;AAC5CH,wBAAA;AAAA,QACf;AAAA,MACD;AAEI,UAAA1oC,OAAM8oC,QAAUxR,EAAAA,aAAY;AACzB,cAAAyR,cAAc/oC,OAAMy6B,iBAAAA;AACtB,YAAAsO,YAAY/vC,SAAS,GAAE;AACd+vC,sBAAA3iC,QAASlC,QAAAA;AACpBjH,iBAAK8W,MAAM7P,IAAIlE,OAAMuC,OAAOgjC,WAAWn6B,MAAM;UAAI,CAEnD;AAAA,QAAA;AAAA,MACD;AACA,aAAOnO,KAAK8W,MAAMwX,QAAQvrB,OAAMuC,OAAOgjC,WAAWn6B,IAAAA;AAAAA,IAAI,CAGjDpL;AAAAA,IAAAA,OAAAyE,YAAY,mBAAoB8mB,YAAAA;AAI/B,YAAAyd,eAAeN,eAAgB1oC,OAAM8oC,QAAUxR,EAAAA,eAAet3B,OAAMy6B,iBAAAA,EAAmBzhC,SAAS;AAClG,UAAAgwC,gBAAgBP,WAAWld,QAAO;AACvBmd,sBAAA;AACLD,iBAAA;AACTxrC,aAAK2oC,gBACN;AAAA,MAAA;AAEA3oC,WAAK8W,MAAMwX,QAAQvrB,OAAMuC,OAAOgjC,WAAWn6B,MAAM,IAAA;AAAA,IAAI;AAGhDpL,IAAAA,OAAAyE,YAAY,cAAe8mB,YAAmBtuB,KAAK8W,MAAMwX,QAAQvrB,OAAMuC,OAAOgjC,WAAWn6B,IAAAA,CAAAA;AAEzFpL,IAAAA,OAAAyE,YAAY,4BAA6B2G,UAC9CnO;AAAAA,WAAK8W,MAAM3I,KAAKlH,IAAIlE,OAAMuC,OAAOgjC,WAAWn6B,MAAM;AAC3C,aAAA;AAAA,IAAA;AAGJ,QAAApL,OAAMoC,IAAIu3B,eAAe;AAE5B,UAAIsP,sBAAsB;AAC1B,UAAIC,cAAc;AACZlpC,MAAAA,OAAAyE,YAAY,sBAAsB,MAAA;AACvC,YAAIwkC,qBAAqB;AAClBjpC,UAAAA,OAAAoC,IAAIu3B,cAAct0B,YAAY4jC;QACrC;AACA,YAAIC,aAAa;AACVlpC,UAAAA,OAAAoC,IAAIu3B,cAAct0B,YAAY6jC,WAAAA;AAAAA,QACrC;AAEAA,sBAAclpC,OAAMoC,IAAIu3B,cAAcl1B,YAAY,eAAgB5D;AACjE5D,eAAK8W,MAAMlT,MAAMqD,IAAIlE,OAAMuC,OAAOgjC,WAAWn6B,IAAI;AAAA,QAAA,CAAA;AAKlD69B,8BAAsBjpC,OAAMoC,IAAIu3B,cAAcl1B,YAAY,qBAAsB5D,WAC/E5D;AAAAA,eAAK2oC,gBACE;AAAA,iBAAA;AAAA,QAAA,CACP;AAAA,MAAA,CAAA;AAAA,IAEH;AAAA,EACD;AAAA,EAEQ,cAAcnhB;AACrB,UAAM4E,QAAOpsB,KAAKmoC;AAClB/b,IAAAA,MAAK8f,cAAAA;AAED,SAAC9f,MAAK+f,aAAa;AACtB;AAAA,IACD;AAEA,QAAInsC,KAAK4nC,YAAY;AACf5nC,WAAA2nC,aAAaxgB,SAASnoB,KAAKwoB,OAAO;AAAA,IAAA,OACjC;AACN,YAAM1O,SAASsT,MAAKtT,OAAOpH,OAAO,CAAC8V,OACnC4E,CAAAA;AAAAA,MAAAA,MAAKwc,UAAU9vB,MAAAA;AAAAA,IAChB;AAAA,EACD;AAAA,EACQ,oBAAoB/Z,KAAiBqtC,KAAiBC,YAAyBC,YACtF;AAAA,UAAMlgB,QAAOpsB,KAAKmoC;AAClB,UAAM3gB,UAAU4E,MAAK5E,QAAQ9V,OAAO3S,KAAKqtC,KAAKC,YAAYC,UAC1DtsC;AAAAA,SAAKusC,cAAc/kB,OAAAA;AAAAA,EACpB;AAAA,EACQ,kBAAkBzoB,KAAYkT,MAAAA;AACrC,QAAGjS,KAAKiD,OAAOwd,aAAa1hB,IAAIkI,EAAAA,GAAI;AAClClI,UAAYgqC,eAAe/oC,KAAKiD,OAAOurB,aAAazvB,IAAIkI,EAC1D;AAAA,IAAA;AAEAjH,SAAKgpC,oBAAoBjqC,KAAKiB,KAAKipC,eAAelqC,IAAIkI,EAAAA,GAAKgL,MAAMjS,KAAKmoC,MAAM3gB,QAAQ2hB,OAAOh7B;EAC5F;AAAA,EACQ,kBAAkBpP,KAAYkT,MAAAA;AACrCjS,SAAKgpC,oBAAoBjqC,KAAKiB,KAAKwsC,eAAeztC,IAAIkI,EAAAA,GAAKgL,MAAMjS,KAAKmoC,MAAM3gB,QAAQ2hB,OAAO3oB,IAAAA;AAAAA,EAC5F;AAAA,EACQ,UAAUrS,MAAAA;AACjB,WAAOA,KAAKs+B,QAAQvkC,OAAOiG,KAAKu+B,OAAAA;AAAAA,EACjC;AAAA,EACQ,WAAWpe,QAAgB+Z,YAAqB,OACvD;AAAA,UAAMtlC,SAAQ/C,KAAKiD;AACdjD,SAAA0pC,eAAepb,QAAQ+Z,SAAAA;AACtBtlC,IAAAA,OAAA6Q,SAAUtV,WAAAA;AACV0B,WAAA0pC,eAAeprC,MAAM2I,EAAAA;AAAAA,IAAE,GAC1BqnB,MACI;AAAA,WAAA;AAAA,EACR;AAAA,EACQ,WAAWqe,QAAgBtE,YAAqB,OAClDroC;AAAAA,SAAA4pC,eAAe+C,QAAQtE;AACrB,WAAA;AAAA,EACR;;AC5ZD,MAAMuE,iBAAiB;AAEhB,MAAMC,KAAAA;AAAAA,EAmEZ,YAAY9pC,QAjED/C;AAAAA,SAAA8sC,WAAAF;AACG5sC,SAAAmsC,cAAA;AACAnsC,SAAA+sC,cAAA;AACY/sC,SAAA8Y,SAAA,EACzBpH,QAASyV,eACD,EAAEA,UAAWA,WAAWA,SAASvrB,MAAAA,IAAU,CAEnDoxC,EAAAA,IAAAA,QAASl0B;AACR,YAAM/V,SAAQ/C,KAAKiD;AACb,YAAAgqC,SAASlqC,OAAMsB,KAAKyU,MAAAA;AAC1B,YAAMqO,WAAWnnB,KAAKwnB;AACtB,eAAS1rB,IAAI,GAAGA,IAAIgd,OAAOqO,SAASprB,QAAQD,KAAK;AAC1C,cAAA0rB,UAAUylB,OAAO9lB,SAASrrB,CAAKqrB,IAAAA,SAAS6lB,OAAOC,OAAO9lB,SAASrrB,CAAAA,CAAAA;AACjE,YAAA0rB,QAAQvV,SAASkV,SAASlV,KAAK62B,UAAUthB,QAAQvV,SAASkV,SAASlV,KAAKi3B,MAAM;AAChF1hB,WAAAA,QAAQzO,OAAOyO,QAAQ0lB,QAAAA,IAAY,CAAC1lB,QAAQ0lB,UAAU1lB,QAAQzO;QAChE;AAAA,MACD;AACO,aAAAk0B;AAAAA,IAAA,EAGmBjtC;AAAAA,SAAAwnB,UAAA,EAE3B2hB,QAAQ,MAGRl3B,MAAM,MAENP,QAAQ,CAACqH,OAAmBm0B,UAAsBj7B,MAAmBk3B,WACpE;AAAA,YAAMpmC,SAAQ/C,KAAKiD;AACZ,aAAA,EACNkmC,QACAl3B,MACA8G,OAAOhW,OAAMsB,KAAK0U,KAAAA,GAClBm0B,UAAUnqC,OAAMsB,KAAK6oC,YAAYn0B,KAAAA,EAAAA;AAAAA,IAClC,GAEDi0B,QAASxlB,aAAAA;AACR,YAAMzkB,SAAQ/C,KAAKiD;AACb,YAAAgqC,SAASlqC,OAAMsB,KAAKmjB,OAC1BylB;AAAAA,aAAOh7B,OAAOjS,KAAKwnB,QAAQ2lB,gBAAgB3lB,QAAQvV,IAC5C;AAAA,aAAAg7B;AAAAA,IAAA,GAERE,iBAAkB3lB,aAAAA;AACjB,YAAMzkB,SAAQ/C,KAAKiD;AACb,YAAA0zB,QAAQ32B,KAAKwnB,QAAQvV;AAC3B,cAAQuV,SAAAA;AAAAA,QACP,KAAKmP,MAAMmS;AACV,iBAAOnS,MAAMmS;AAAAA,QACd,KAAKnS,MAAMpmB;AACV,iBAAOomB,MAAMrqB;AAAAA,QACd,KAAKqqB,MAAMrqB;AACV,iBAAOqqB,MAAMpmB;AAAAA,QACd,KAAKomB,MAAMuS;AACV,iBAAOvS,MAAMuS;AAAAA,QACd;AACOnmC,UAAAA,OAAAqqC,OAAO,OAAO,qBAAoB5lB;AACjC,iBAAA;AAAA,MAAA;AAAA,IACT,EAIFxnB;AAAAA,SAAQqtC,aAAa,CAAA;AACrBrtC,SAAQstC,aAAa,CAAA;AAIpBttC,SAAKiD,SAASF;AAAAA,EACf;AAAA,EACA,eACC;AAAA,WAAO/C,KAAKqtC;AAAAA,EACb;AAAA,EACA,aAAaE,OAAAA;AACZvtC,SAAKqtC,aAAaE;AAAAA,EACnB;AAAA,EAEA,eACC;AAAA,WAAOvtC,KAAKstC;AAAAA,EACb;AAAA,EACA,aAAaC,OAAAA;AACZvtC,SAAKstC,aAAaC;AAAAA,EACnB;AAAA,EAEA,iBACCvtC;AAAAA,SAAKqtC,aAAa,CACnB;AAAA,EAAA;AAAA,EAEA,iBACCrtC;AAAAA,SAAKstC,aAAa,CAAA;AAAA,EACnB;AAAA,EAEA;AACC,UAAMvqC,SAAQ/C,KAAKiD;AACdjD,SAAA8sC,WAAW/pC,OAAMuC,OAAOkoC,cAAcZ;AACtC5sC,SAAAwnB,QAAQ2hB,SAASpmC,OAAMuC,OAAOgjC;AAC9BtoC,SAAAwnB,QAAQvV,OAAOlP,OAAMuC,OAAOmoC;AACjCztC,SAAKmsC,cAAAA,CAAAA,CAAgBppC,OAAMuC,OAAO8mB;AAClCpsB,SAAK+sC,cAAAA,CAAAA,CAAgBhqC,OAAMuC,OAAO+mB;AAAAA,EACnC;AAAA,EAEA,OACC;AAAA,UAAMtpB,SAAQ/C,KAAKiD;AACnBjD,SAAKksC;AACD,QAAClsC,CAAAA,KAAKmsC,aAAa;AACtB;AAAA,IACD;AAEA,UAAMrzB,SAAS9Y,KAAK0tC,KAAK1tC,KAAKqtC,UAAAA;AAC9B,QAAIv0B,QAAQ;AACX9Y,WAAK2tC,iBAAiB70B,MACvB;AAAA,IAAA;AACA,QAAI/V,OAAMgF,UAAU,gBAAgB,CAAC+Q,MAAa,CAAA,MAAA,OAAO;AACxD,UAAIA,QAAQ;AACX9Y,aAAK4tC,aAAa5tC,KAAK8Y,OAAOk0B,OAAOl0B,MACrC9Y,CAAAA;AAAAA,aAAK6tC,MAAM7tC,KAAKstC,YAAYvqC,OAAMsB,KAAKyU;AACvC/V,QAAAA,OAAMgF,UAAU,eAAe,CAAC+Q,MAAAA,CAAAA;AAChC;AAAA,MACD;AAAA,IACD;AACA/V,IAAAA,OAAMgF,UAAU,eAAe,CAAC;EACjC;AAAA,EAEA;AACC,UAAMhF,SAAQ/C,KAAKiD;AACnBjD,SAAKksC,cAAAA;AACD,SAAClsC,KAAK+sC,aAAa;AACtB;AAAA,IACD;AAEA,UAAMj0B,SAAS9Y,KAAK0tC,KAAK1tC,KAAKstC,UAAAA;AAC9B,QAAIx0B,QAAQ;AACX9Y,WAAK2tC,iBAAiB70B;IACvB;AAEA,QAAI/V,OAAMgF,UAAU,gBAAgB,CAAC+Q,MAAAA,CAAAA,MAAa,OAAO;AACxD,UAAIA,QAAQ;AACX9Y,aAAK4tC,aAAa90B,MAAAA;AAClB9Y,aAAK6tC,MAAM7tC,KAAKqtC,YAAYtqC,OAAMsB,KAAKyU,MAAAA,CAAAA;AACvC/V,QAAAA,OAAMgF,UAAU,eAAe,CAAC+Q,MAChC,CAAA;AAAA;AAAA,MACD;AAAA,IACD;AACA/V,IAAAA,OAAMgF,UAAU,eAAe,CAAC,IAAA,CAAA;AAAA,EACjC;AAAA,EAGA,UAAU+Q,QACJ9Y;AAAAA,SAAA6tC,MAAM7tC,KAAKqtC,YAAYv0B,MAC5B9Y;AAAAA,SAAKstC,aAAa,CAAA;AAAA,EACnB;AAAA,EAEQ,MAAMC,OAAmBz0B,QAAAA;AAChC,UAAM/V,SAAQ/C,KAAKiD;AACf,QAAC6V,CAAAA,OAAOqO,SAASprB,QAAQ;AAC5B;AAAA,IACD;AAEA,UAAMsD,SAAQkuC,UAAUvtC,KAAKqtC,aAAa,sBAAsB;AAChE,QAAItqC,OAAMgF,UAAU1I,QAAO,CAACyZ,aAAa,OAAM;AAC9C;AAAA,IACD;AAEI,QAAA,CAACA,OAAOqO,SAASprB,QAAQ;AAC5B;AAAA,IACD;AAEAwxC,UAAMvuC,KAAK8Z,MACJ;AAAA,WAAAy0B,MAAMxxC,SAASiE,KAAK8sC,UAAU;AACpCS,YAAM1mB,MAAAA;AAAAA,IACP;AACO,WAAA/N;AAAAA,EACR;AAAA,EAEQ,KAAKy0B,OAAAA;AACZ,WAAOA,MAAMxjC,IAAAA;AAAAA,EACd;AAAA,EAEQ,iBAAiB+O,QAIxB;AAAA,UAAMg1B,UAAU,EAAEC,KAAK,GAAGvtB,MAAK,GAAGrS,MAAK,EACvC;AAAA,UAAM6/B,gBAAgB,EAAE9E,MAAM,GAAG6E,KAAI,EACrCj1B;AAAAA,WAAOqO,SAASlrB,KAAK,SAAS1B,GAAG2B,GAChC;AAAA,UAAI3B,EAAE4uC,WAAW,UAAUjtC,EAAEitC,WAAW,QAAQ;AAC3C,YAAA5uC,EAAE0X,SAAS/V,EAAE+V,MAAM;AACd,kBAAA+7B,cAAc9xC,EAAE+V,IAAAA,KAAS,MAAM+7B,cAAczzC,EAAE0X,IAAAA,KAAS;AAAA,QACtD,WAAA1X,EAAE0X,SAAS,UAAU1X,EAAE2yC,YAAYhxC,EAAEgxC,YAAYhxC,EAAEgxC,SAASpsC,WAAWvG,EAAE2yC,SAASpsC,QAAQ;AACpG,iBAAOvG,EAAE2yC,SAASrD,SAAS3tC,EAAEgxC,SAASrD;AAAAA,QAAA,OAChC;AACC,iBAAA;AAAA,QACR;AAAA,MAAA,OACM;AACN,cAAMoE,UAAUH,QAAQvzC,EAAE4uC,MAAW2E,KAAAA,QAAQC;AAC7C,cAAMG,UAAUJ,QAAQ5xC,EAAEitC,MAAW2E,KAAAA,QAAQC;AAC7C,eAAOG,UAAUD;AAAAA,MAClB;AAAA,IAAA,CAGF;AAAA,EAAA;AAAA,EAEQ,aAAan1B;AACpB,QAAI0O,UAAU;AACR,UAAA2mB,WAAWnuC,KAAKwnB,QAAQ2hB;AACxB,UAAAiF,UAAUpuC,KAAKwnB,QAAQvV;AAC7B,UAAMlP,SAAQ/C,KAAKiD;AACnB,UAAMorC,UAAU,CAAA;AACRA,YAAAF,SAAShgC,IAAAA,IAAQ,EACxB7B,KAAK,WACLgiC,KAAK,WACLxF,QAAQ,cACRv4B,QAAQ,cACR24B,MAAM,YACNqF,UAAU,eAAA;AAEHF,YAAAF,SAAS3tB,QAAQ,EACxBlU,KAAK,WACLgiC,KAAK,WACLxF,QAAQ,cACRv4B,QAAQ,cACRg+B,UAAU,eAAA;AAGXxrC,IAAAA,OAAMyrC,YAAY;AAIjB,eAAS1yC,IAAI,GAAGA,IAAIgd,OAAOqO,SAASprB,QAAQD,KAAK;AACtC0rB,kBAAA1O,OAAOqO,SAASrrB,CAC1B;AAAA,cAAM0F,SAAS6sC,QAAQ7mB,QAAQ2hB,QAAQ3hB,QAAQvV,IAAAA;AAC/C,cAAMw8B,YAAYJ,QAAQ7mB,QAAQ2hB,QAAQmF;AAC1C,cAAMI,QAAQL,QAAQ7mB,QAAQ2hB,QAAQoF;AAElC,YAAA/mB,QAAQvV,SAASm8B,QAAQ9hC,KAAK;AAC3BvJ,UAAAA,OAAAvB,MAAAA,EAAQgmB,QAAQ0lB,UAAU1lB,QAAQ0lB,SAASpsC,QAAQ0mB,QAAQ0lB,SAASnE,YAChE;AAAA,QAAA,WAAAvhB,QAAQvV,SAASm8B,QAAQ79B,QAAQ;AAC3C,cAAIxN,OAAM2rC,OAAOlnB,QAAQzO,MAAM9R,EAAK,GAAA;AACnClE,YAAAA,OAAMvB,MAAAA,EAAQgmB,QAAQzO,MAAM9R,EAAAA;AAAAA,UAC7B;AAAA,QACU,WAAAugB,QAAQvV,SAASm8B,QAAQtF,QAAQ;AAC3C,gBAAMl/B,OAAO7G,OAAM0rC,WAAWjnB,QAAQzO,MAAM9R;AAClC,qBAAA0nC,QAAQnnB,QAAQzO,OAAM;AAC/B,kBAAM61B,mBAAmBD,KAAKE,WAAW,GAAQF,KAAAA,KAAKE,WAAW,GAAA;AAC3D,kBAAAC,YAAY,CAAC,OACnB;AAAA,gBAAIC,eAAgBH,CAAAA;AACpB,gBAAIE,UAAU7xC,QAAQ0xC,IAAW,IAAA,IAAA;AACjBI,6BAAA;AAAA,YAChB;AACA,gBAAGA,cAAa;AACfnlC,mBAAK+kC,IAAQnnB,IAAAA,QAAQzO,MAAM41B,IAC5B;AAAA,YAAA;AAAA,UACD;AAEA5rC,UAAAA,OAAMvB,MAAAA,EAAQgmB,QAAQzO,MAAM9R,EAAAA;AAAAA,QAClB,WAAAugB,QAAQvV,SAASm8B,QAAQlF,MAAM;AACnCnmC,UAAAA,OAAAvB,MAAQgmB,EAAAA,QAAQzO,MAAM9R,IAAIugB,QAAQzO,MAAMgwB,cAAcvhB,QAAQzO,MAAMjY;AAE1EiC,UAAAA,OAAMgF,UAAU,gBAAgB,CAACyf,QAAQzO,MAAM9R;QAChD;AAAA,MACD;AAAA,IAAA,CAEF;AAAA,EAAA;AAAA;ACtQD,SAAAmlB,KAAwBrpB;AAElB,QAAAolC,QAAQ,IAAI0E,KAAK9pC,MAAAA;AACvB,QAAMisC,UAAoB,IAAItH,QAAQS,OAAOplC,MAE7CA;AAAAA,EAAAA,OAAMuC,OAAO8mB,OAAO;AACpBrpB,EAAAA,OAAMuC,OAAO+mB,OAAO;AAMpBtpB,EAAAA,OAAMuC,OAAOgjC,aAAa,EACzB9nB,MAAM,QACNrS,MAAM,OAOPpL;AAAAA,EAAAA,OAAMuC,OAAOmoC,eAAe,EAC3B3E,QAAQ,UACRv4B,QAAQ,UACRjE,KAAK,OACL48B,MAAM;AAGH,MAACnmC,CAAAA,OAAMoC,KAAK;AACfpC,IAAAA,OAAMoC,MAAM;EACb;AAEApC,EAAAA,OAAMoC,IAAIinB,OAAO,EAChBA,MAAM,MAAM+b,MAAM/b,QAClBC,MAAM,MAAM8b,MAAM9b,KAClB4iB,GAAAA,cAAc,MAAM9G,MAAM8G,aAC1BC,GAAAA,cAAe3B,WAAapF,MAAM+G,aAAa3B,QAC/C4B,cAAc,MAAMhH,MAAMgH,aAC1BC,GAAAA,cAAe7B,WAAapF,MAAMiH,aAAa7B,KAAAA,GAC/C/C,gBAAgB,MAAMrC,MAAMqC,kBAC5BC,gBAAgB,MAAMtC,MAAMsC,eAC5B4E,GAAAA,WAAW,CAACpoC,IAAqBgL,SAAsB+8B,QAAQl4B,MAAM7P,IAAIgL,MAAM,IAC/Eq9B,GAAAA,iBAAiB,CAACroC,IAAqBgL;AACtC,QAAGA,SAASlP,OAAMuC,OAAOgjC,WAAW9nB,MAAK;AACjC,aAAAwuB,QAAQxC,eAAevlC,EAAE;AAAA,IAAA,OAC5B;AACG,aAAA+nC,QAAQ/F,eAAehiC,EAAAA;AAAAA,IAC/B;AAAA,EAIIlE,EAAAA;AAAAA,EAAAA,OAAAqpB,OAAOrpB,OAAMoC,IAAIinB,KAAKA;AACtBrpB,EAAAA,OAAAspB,OAAOtpB,OAAMoC,IAAIinB,KAAKC;AACtBtpB,EAAAA,OAAAksC,eAAelsC,OAAMoC,IAAIinB,KAAK6iB;AAC9BlsC,EAAAA,OAAAosC,eAAepsC,OAAMoC,IAAIinB,KAAK+iB;AAC9BpsC,EAAAA,OAAAynC,iBAAiBznC,OAAMoC,IAAIinB,KAAKoe;AAChCznC,EAAAA,OAAA0nC,iBAAiB1nC,OAAMoC,IAAIinB,KAAKqe;AAE7B,WAAA8E,YAAWC,OAAe/mC,QAAAA;AAClC,WAAO3I,OAAO0vC,WAAW1vC,OAAO2I,MAAAA;AAAAA,EACjC;AAES,WAAAgnC,QAAQthC,MAAa6oB,OAAeC,OAAAA;AAC5C,QAAK9oB,CAAAA,MAAM;AAAE;AAAA,IAAQ;AAErB,QAAIohC,YAAWphC,KAAKlH,IAAI+vB,KAAAA,GAAQ;AAC/B7oB,WAAKlH,KAAKgwB;AAAAA,IACX;AAEA,QAAIsY,YAAWphC,KAAKrN,QAAQk2B,KAAAA,GAAQ;AACnC7oB,WAAKrN,SAASm2B;AAAAA,IACf;AAAA,EACD;AAES,WAAAyY,oBAAoBloB,SAAuBwP,OAAeC;AAC1DwY,YAAAjoB,QAAQzO,OAAOie,OAAOC,KACtBwY;AAAAA,YAAAjoB,QAAQ0lB,UAAUlW,OAAOC,KAClC;AAAA,EAAA;AAES,WAAA0Y,QAAQnvB,MAAaovB,WAAmBC,WAAAA;AAChD,SAAKrvB,MAAM;AAAE;AAAA,IAAQ;AACrB,QAAI+uB,YAAW/uB,KAAKE,QAAQkvB,SAAAA,GAAY;AACvCpvB,WAAKE,SAASmvB;AAAAA,IACf;AACA,QAAIN,YAAW/uB,KAAKlhB,QAAQswC,SAAY,GAAA;AACvCpvB,WAAKlhB,SAASuwC;AAAAA,IACf;AAAA,EACD;AAES,WAAAC,oBAAoBtoB,SAAuBwP,OAAeC,OAC1D0Y;AAAAA,YAAAnoB,QAAQzO,OAAOie,OAAOC,KAAAA;AACtB0Y,YAAAnoB,QAAQ0lB,UAAUlW,OAAOC,KAAAA;AAAAA,EAClC;AAES,WAAA8Y,eAAevqB,KAAiBwR,OAAeC,OACvD;AAAA,UAAM7K,QAAO+b;AAEb,aAASrsC,IAAI,GAAGA,IAAI0pB,IAAIzpB,QAAQD,KAAK;AAC9B,YAAAk0C,QAAQxqB,IAAI1pB,CAAAA;AAClB,eAASqjB,IAAI,GAAGA,IAAI6wB,MAAM7oB,SAASprB,QAAQojB,KAAK;AAC3C,YAAA6wB,MAAM7oB,SAAShI,GAAGgqB,WAAW/c,MAAK5E,QAAQ2hB,OAAOh7B,MAAM;AAC1DuhC,8BAAoBM,MAAM7oB,SAAShI,CAAAA,GAAI6X,OAAOC,KAAAA;AAAAA,QAAK,WACzC+Y,MAAM7oB,SAAShI,CAAAA,EAAGgqB,WAAW/c,MAAK5E,QAAQ2hB,OAAO3oB,MAAM;AACjEsvB,8BAAoBE,MAAM7oB,SAAShI,IAAI6X,OAAOC,KAAAA;AAAAA,QAC/C;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAES,WAAAgZ,eAAezqB,KAAiBwR,OAAeC,OACvD;AAAA,UAAM7K,QAAO+b;AAEb,aAASrsC,IAAI,GAAGA,IAAI0pB,IAAIzpB,QAAQD,KAAK;AAC9B,YAAAk0C,QAAQxqB,IAAI1pB;AAClB,eAASqjB,IAAI,GAAGA,IAAI6wB,MAAM7oB,SAASprB,QAAQojB,KAAK;AACzC,cAAAqI,UAAUwoB,MAAM7oB,SAAShI,CAAAA;AAC/B,YAAIqI,QAAQ2hB,WAAW/c,MAAK5E,QAAQ2hB,OAAO3oB,MAAM;AAChD,cAAIgH,QAAQzO,SAASyO,QAAQzO,MAAM9R,OAAO+vB,OAAO;AAChDxP,oBAAQzO,MAAM9R,KAAKgwB;AAAAA,UACpB;AACA,cAAIzP,QAAQ0lB,YAAY1lB,QAAQ0lB,SAASjmC,OAAO+vB,OAAO;AACtDxP,oBAAQ0lB,SAASjmC,KAAKgwB;AAAAA,UACvB;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAEAl0B,EAAAA,OAAMyE,YAAY,kBAAkB,CAACwvB,OAAeC;AACnD,UAAM7K,QAAO+b;AACb4H,mBAAe3jB,MAAK6iB,aAAAA,GAAgBjY,OAAOC,KAC3C8Y;AAAAA,mBAAe3jB,MAAK+iB,aAAAA,GAAgBnY,OAAOC,KAAAA;AAAAA,EAAK;AAGjDl0B,EAAAA,OAAMyE,YAAY,kBAAkB,CAACwvB,OAAeC,UAAAA;AACnD,UAAM7K,QAAO+b;AACb8H,mBAAe7jB,MAAK6iB,aAAAA,GAAgBjY,OAAOC,KAC3CgZ;AAAAA,mBAAe7jB,MAAK+iB,aAAAA,GAAgBnY,OAAOC,KAAAA;AAAAA,EAAK;AAG3Cl0B,EAAAA,OAAAyE,YAAY,gBAAgB,MACjC2gC;AAAAA,UAAM+D;EAAc,CAGrB;AAAA;ACxIA,MAAegE,aAAA,EACdrhC,YACAtJ,eACA4d,YACA6Q,qBACAmO,YACA0C,SACAzY,MACAiM,QACAgC,aACAtoB,WAAAA;ACtBD,MAAeo+B,YAAA,EACdC,WAAW,EACVC,IAAI,IACJC,MAAM,IACNC,MAAM,IACNC,OAAO,IACPC,OAAO,IACPC,OAAO,IACPC,QAAQ,IACRC,KAAK,IACLC,KAAK,ECVP,EAAA;AAAA,MAAqBC;EAGpB,YAAYxrC,SAOGtF;AAAAA,SAAA+wC,eAAA,CAAC1zC,MAAc8H,QACxBnF;AAAAA,WAAAgxC,YAAY3zC,IAAQ8H,IAAAA;AAAAA,IAAA;AAG1BnF,SAAAixC,eAAgB5zC,UACR2C,KAAKgxC,YAAY3zC,IAAAA;AAXxB2C,SAAKgxC,cAAc;AACnB,eAAUl1C,KAAKwJ,SAAO;AACrBtF,WAAKgxC,YAAYl1C,CAAKwJ,IAAAA,QAAOxJ;IAC9B;AAAA,EACD;AAAA;ACRc,SAAAo1C,WAAAA;AACd,MAAIA,YAAW,CAAA;AACf,WAASC,SAAU9zC,MAAM+zC,QACxBF;AAAAA,IAAAA,UAAS7zC,QAAQ+zC;AAAAA,EACjB;AAED,WAASttC,WAAWzG,MAAAA;AACnB,SAAI6zC,UAAS7zC,IAAAA,GAAM;AAClB,aAAO;AAAA,IACP;AACD,WAAO6zC,UAAS7zC,IAAAA,EAAAA;AAAAA,EAChB;AAED,WAASg0C,YAAYh0C,MAAAA;AACpB,QAAI6zC,UAAS7zC,IAAAA,GAAO;AACZ6zC,aAAAA,UAAS7zC,IAChB;AAAA,IAAA;AAAA,EACD;AAED,MAAIi0C,eAAe,CAAA;AAEnB,SAAO,EACNJ,UAAUI,cACVC,YAAYJ,UACZrtC,YACAutC,aACApiC,YAAY,WACX;AAAA,aAAQnT,KAAKo1C,WAAS;AACrB,UAAGA,UAASp1C,CAAAA,GAAG;AACd,YAAI01C,UAAUN,UAASp1C,CAAAA;AACvB,YAAG01C,WAAWA,QAAQviC,YAAW;AAChCuiC,kBAAQviC,WACR;AAAA,QAAA;AAAA,MACD;AAAA,IACD;AACDiiC,IAAAA,YAAW;AAAA,EACX,EAAA;AAEH;AC4TA,MAAA5rC,SAAe;AACd,QAAMtB,SAAuB,EAC5BytC,QAAQ,EACP/yC,KAAK,mBACLgzC,MAAM,CACL,EACC1xB,MAAM,CACL,EAACtU,MAAM,QAAQgF,SAAS,aAAaE,SAAS,YAAA,GAC9C,EAAC+gC,SAAS,MAAMl4C,OAAO,EAAA,GACvB,EAACiS,MAAM,YAAYgF,SAAS,aAAaE,SAAS,YAAA,GAClD,EAAClF,MAAM,aAAazE,IAAI,YAAA,CAAA,EAAA,GAG1B,EAACyE,MAAM,aAAazE,IAAI,aAAavN,QAAQ,GAG/CikB,CAAAA,EAAAA,GAAAA,OAAO,EACNi0B,iBAAiB,KACjBC,gBAAgB,KAChBC,kBAAkB,KAClBC,iBAAiB,IAAA,GAElBpb,OAAO,EACNxoB,MAAM,QACN6T,SAAS,WACTgwB,WAAW,eAEZC,YAAY,OACZC,eAAe,OACf93B,WAAW,OACX+3B,mBAAmB,OACnBC,eAAe,OAEfC,gBAAgB,MAEhB9zB,UAAU,OACVJ,oBAAoB,GACpBla,YAAY,MACZquC,kBAAkB,IAClBC,mBAAmB,OACnBC,YAAY,MACZC,iBAAiB,MAEjBC,mBAAmB,OACnBC,yBAAyB,MACzBC,gBAAgB,OAChBC,yBAAyB,cACzBC,cAAc,OACdhjB,YAAY,MACZ1C,WAAW,MACX2lB,cAAc,KAAK,KAAK,KACxBxgC,aAAa,kBACbgD,UAAU,QACVy9B,iBAAiB,MACjBC,YAAY,OACZC,eAAe,MACfC,WAAW,OACXhY,aAAa,MACbpL,iBAAiB,MACjBtc,iBAAiB,MACjB2/B,iBAAiB,MACjB7hC,UAAU,OACV8hC,0BAA0B,IAC1BC,WAAW,MAGXl2B,WAAW,YAEXm2B,YAAY,MACZC,eAAe,MACfC,aAAa,MACb7H,cAAc,OACd8H,WAAW,MACXC,WAAW,EACVC,QAAQ,UACRC,UAAU,YACV3K,MAAM,QACN5lC,QAAQ,SAAA,GAETwwC,iBAAiB,MACjBC,oBAAoB,IACpBC,iBAAgB,IAChBn5B,SAAS,GAETo5B,SAAS,OACTphC,SAAS,CACR,EAACxV,MAAM,QAAQ8iB,MAAM,MAAM1mB,OAAO,KAAKm6C,QAAQ,QAC/C,EAACv2C,MAAM,cAAc62C,OAAO,UAAUN,QAAQ,QAC9C,EAACv2C,MAAM,YAAY62C,OAAO,SAC1B,GAAA,EAAC72C,MAAM,OAAO5D,OAAO,GAKtB06C,CAAAA,GAAAA,sBAAsB,MACtBC,qBAAqB,OAErBjgC,QAAQ,CACP,EACCjL,MAAM,OACNuW,MAAM,GACNpN,MAAM,QAKRgiC,CAAAA,GAAAA,WAAW,IACXC,eAAe,GACfC,WAAW,YACXC,aAAa,SACbrlB,gBAAgB,gBAChBslB,gBAAgB,gBAChBC,iBAAiB,cACjBC,cAAc,CACb,kBACA,kBAEDC,GAAAA,kBAAkB,EACjBC,cAAc,kBACdC,gBAAgB,oBAChBC,gBAAgB,mBAEjBC,GAAAA,eAAe,CACd,kBAAA,GAEDC,UAAU,EACTC,UAAU,CACT,EAAC73C,MAAM,eAAe3D,QAAQ,IAAIy7C,QAAQ,QAAQljC,MAAM,YAAYwZ,OAAO,QAC3E,EAACpuB,MAAM,QAAQ4U,MAAM,YAAYkjC,QAAQ,OAE1CC,CAAAA,GAAAA,kBAAkB,CACjB,EAAC/3C,MAAM,eAAe3D,QAAQ,IAAIy7C,QAAQ,QAAQljC,MAAM,YAAYwZ,OAAO,KAC3E,GAAA,EAACpuB,MAAM,QAAQ4U,MAAM,cAAckjC,QAAQ,OAC3C,GAAA,EAAC93C,MAAM,QAAQ4U,MAAM,YAAYV,UAAU,MAAM4jC,QAAQ,OAAA,CAAA,GAE1DE,oBAAoB,CACnB,EAACh4C,MAAM,eAAe3D,QAAQ,IAAIy7C,QAAQ,QAAQljC,MAAM,YAAYwZ,OAAO,KAC3E,GAAA,EAACpuB,MAAM,QAAQ4U,MAAM,cAAckjC,QAAQ,UAC3C,EAAC93C,MAAM,QAAQ4U,MAAM,YAAYqjC,aAAa,MAAMH,QAAQ,OAAA,CAAA,EAAA,GAG9DI,eAAe,MACft5C,MAAM,OACNu5C,mBAAmB,MACnBC,qBAAqB,MACrBC,gBAAgB,MAChB1lB,oBAAoB,KAEpB2lB,cAAc,OACdC,mBAAmB,OAGnBC,qBACAC,YAAY,QACZC,oBAAmB,GACnB/3B,kBAAkB,IAGlBg4B,uBAAuB,IAEvBC,+BAA+B,qBAK/BC,iBAAiB,OAGjBC,aAAa,OACbC,sBAAsB,OACtBvkB,8BAA8B,OAC9BwkB,kBAAkB,MAElBC,aAAa,OAEbC,iCAAiC,kBAEjCC,0BAA0B,IAC1B7nC,YAAY,IAGZ8nC,mBAAmB,YACnBC,mBAAmB,YACnBC,mBAAmB,eACnBC,oBAAoB,CAAC,GACrBC,4BAA4B,OAC5BC,kBAAkB,OAClBC,gBAAgB,CAAC,GAEjBC,qBAAqB,OACrBC,iBAAiB,MACjBC,wBAAwB,OACxBC,aAAa,MACbC,qBAAqB,MACrB75B,cAAc,MACdkB,KAAI,OACJqY,kBAAkB,OAClBugB,uBAAuB,YACvB9xC,eAAe,EACdlC,QAAAA,QACAC,QAAQ,sCACRoC,QAAQ,SAET4xC,eAAe,MACfC,KAAK,OAAA;AAEC,SAAAvzC;AAAA;AC/iBR,IAAIwzC,oBAAAA,OAA2B/+C,WAAW;AAI1C,MAAeg/C,MAAA,EACdC,MAAMF,sBAAsBG,UAAUC,UAAU36C,QAAQ,WAAW,KAAK06C,UAAUC,UAAU36C,QAAQ,SAAA,KAAc,IAClH46C,OAAOL,sBAAAA,CAAuBrgC,kBAAkBwgC,UAAUC,UAAU36C,QAAQ,WAAW,IACvF66C,OAAON,sBAAsBG,UAAUC,UAAU36C,QAAQ,UAAe,KAAA,KAAK06C,UAAUC,UAAU36C,QAAQ,SAAA,IAAa,IACtH86C,OAAOP,sBAAsBG,UAAUC,UAAU36C,QAAQ,UAAA,KAAe,KAAK06C,UAAUC,UAAU36C,QAAQ,SAAA,KAAc,IACvH+6C,SAASR,qBAAsBG,UAAUC,UAAU36C,QAAQ,OAAY,KAAA,GACvEg7C,UAAUT,qBAAsBG,UAAUC,UAAU36C,QAAQ,QAAa,KAAA,GACzEi7C,SAASV,sBAAsBG,UAAUC,UAAU36C,QAAQ,QAAa,KAAA,KAAK06C,UAAUC,UAAU36C,QAAQ,WAAgB,KAAA,IACzHk7C,MAAMX,qBAAsBG,UAAUC,UAAU36C,QAAQ,cAAc,GACtEm7C,QAAQZ,qBAAsBG,UAAUC,UAAUS,OAAO,QAAA,KAAa,GACtEC,QAAQd,qBAAsBG,UAAUC,UAAU36C,QAAQ,MAAA,KAAA,IAC1Ds7C,QAAAA,CAAUf,4BAA4BG,aAAa,eAAqD,UAAe,OAAA;AChBxH,SAAwBt3B,UAAU5N;AACjC,MAAWA,OAAAA,UAAS,mBAAmBA,UAAS,UAAU;AAClD,WAAAA;AAAAA,EACR;AAEA,MAAIzO,SAAS;AAEb,aAAWqV,OAAO5G,OAAM;AACvB,QAAI+lC,aAAa;AACb,QAAA/lC,MAAK0wB,eAAe9pB,GAAM,GAAA;AAC7B,iBAAW5G,MAAK4G,GAAAA,MAAS,UAAU;AACrBm/B,qBAAAzgC,mBAAmBtF,MAAK4G,GAAAA,CAAAA;AAAAA,MAC3B,WAAA,OAAO5G,MAAK4G,GAAAA,MAAS,UAAU;AAC5Bm/B,qBAAA14C,OAAO2S,MAAK4G,GAAI,CAAA;AAAA,MAAA,OACvB;AACNm/B,qBAAazgC,mBAAmBhB,KAAKC,UAAUvE,MAAK4G,GAAAA,CAAAA,CAAAA;AAAAA,MACrD;AACAm/B,mBAAan/B,MAAM,MAAMm/B;AAEzB,UAAIx0C,OAAOjI,QAAQ;AAClBy8C,qBAAa,MAAMA;AAAAA,MACpB;AACUx0C,gBAAAw0C;AAAAA,IACX;AAAA,EACD;AACO,SAAAx0C;AACR;ACtBA,SAASy0C,aAAaj3C,QAAQmJ,MAC7B;AAAA,MAAI3G,SAAS,EACZxC,OAGD;AAAA,MAAImJ,KAAK5O,WAAW,GAAG;AACtB,UAAM,IAAI28C,MAAM,mCAAA;AAAA,EAChB;AACD,MAAI/tC,KAAK5O,WAAW,GAAG;AACtB,QAAA,OAAW4O,KAAK,CAAA,MAAO,UAAU;AAChC3G,aAAOqS,MAAM1L,KAAK,CAClB3G;AAAAA,aAAO20C,QAAQ;AAAA,IAClB,OAAS;AACN30C,aAAOqS,MAAM1L,KAAK,CAAG0L,EAAAA;AACrBrS,aAAO20C,QAAShuC,KAAK,CAAA,EAAGguC,SAAS;AACjC30C,aAAO8D,WAAW6C,KAAK,CAAA,EAAG7C;AAC1B9D,aAAO40C,UAAUjuC,KAAK,CAAA,EAAGiuC;AAAAA,IACzB;AACD,QAAIp3C,WAAW,UAAU,OAAO;AAC/B,UAAImJ,KAAK,CAAG8H,EAAAA,MAAM;AACjB,YAAA,OAAW9H,KAAK,CAAA,EAAG8H,SAAS,UAAU;AACrCzO,iBAAOyO,OAAO4N,UAAU1V,KAAK,GAAG8H,IACrC;AAAA,QAAA,OAAW;AACNzO,iBAAOyO,OAAO9H,KAAK,GAAG8H;AAAAA,QACtB;AAAA,MACL,OAAU;AACNzO,eAAOyO,OAAO;AAAA,MACd;AAAA,IACD;AACD,WAAOzO;AAAAA,EACP;AAEDA,SAAOqS,MAAM1L,KAAK;AAClB,UAAOnJ,QAAAA;AAAAA,IACN,KAAK;AAAA,IACL,KAAK;AACJwC,aAAO8D,WAAW6C,KAAK;AACvB3G,aAAO40C,UAAUjuC,KAAK,CACvB;AAAA;AAAA,IACA,KAAK;AAAA,IACL,KAAK;AACJ,UAAIA,KAAK,CAAA,GAAI;AACZ,YAAWA,OAAAA,KAAK,CAAO,MAAA,UAAU;AAChC3G,iBAAOyO,OAAO4N,UAAU1V,KAAK,CAClC,CAAA;AAAA,QAAA,OAAW;AACN3G,iBAAOyO,OAAO9H,KAAK,CAAA;AAAA,QACnB;AAAA,MACL,OAAU;AACN3G,eAAOyO,OAAO;AAAA,MACd;AACDzO,aAAO8D,WAAW6C,KAAK;AACvB3G,aAAO40C,UAAUjuC,KAAK,CACvB;AAAA;AAAA,EAAA;AAED,SAAO3G;AACR;AAEe,SAAQwS,KAACzT,QACvB;AAAA,SAAO,EAIN81C,OAAO,MAIPr3C,QAAQ,OAERkW,OAAO,SAASjF,OACf;AAAA,QAAA,OAAWA,UAAS,SAAU,QAAOA;AAErC,QAAI1T;AACJ0T,IAAAA,QAAOA,MAAKhV,QAAQ,UAAS,EAAA;AAC7B,eAAWq7C,cAAc,eAAA,CAAgBrB,IAAIC,MAAM;AAClD34C,YAAM,IAAK+5C,YAAaC,gBAAgBtmC,OAAM,UAC9C;AAAA,IAAA,kBAAiB9P,MAAOq2C,kBAAkB,aAAa;AACvDj6C,YAAM,IAAI4D,MAAOq2C,cAAc,kBAAA;AAC/Bj6C,UAAI45C,QAAQ;AACZ55C,UAAIk6C,QAAQxmC,KACZ;AAAA,IAAA;AACD,WAAO1T;AAAAA,EACP,GACDm6C,QAAQ,SAASC,SAASjiC,KAAKnY;AAC9B,QAAWmY,OAAAA,IAAII,UAAU,eAAeJ,IAAII,SAAS,KAAK;AACzD,UAAI8hC,OAAQliC,IAAImiC,cAAer5C,KAAK0X,MAAMR,IAAIS,gBAAgBT,OAAQA,IAAImiC,eAAeniC;AACzF,UAAIkiC,OAAOA,IAAI9gD,oBAAoB,QAAS8gD,CAAAA,IAAIE,qBAAqB,aAAev9C,EAAAA,QAAQ;AAC3F,eAAOq9C,IAAIE,qBAAqBH,OAAAA,EAAS,CACzC;AAAA,MAAA;AAAA,IACD;AACD,QAAIp6C,QAAAA,GAAYgE,CAAAA,OAAMgF,UAAU,kBAAiB,CAAC,iBAAiBnB,UAAU,CAAA,GAAI7H,GACjF,CAAA;AAAA,WAAO3G,SAASoE,cAAc,KAAA;AAAA,EAC9B,GACD+8C,OAAO,SAASC,UAAUC,QACzB;AAAA,QAAA,CAAKA,OAAOh/C,SAAUg/C,UAASA,OAAOJ,eAAeI;AACrD,QAAIhC,IAAIC,MAAM;AACb,aAAO+B,OAAOC,YAAYF,QAAAA,KAAW,CACzC;AAAA,IAAA,OAAU;AACN,UAAI9H,OAAO,CACX;AAAA,UAAIlC;AACJ,UAAIp3B,OAAOqhC,OAAOE,iBAAeF,QAAQG,SAASJ,UAAUC,QAAQ,MAAMI,YAAYC,UAAU,IAAA;AAEhG,aAAO,MAAK;AACXtK,gBAAQp3B,IAAI2hC,YACZ;AAAA,YAAGvK,OAAM;AACRkC,eAAK1yC,KAAKwwC;QAChB,OAAU;AACJ;AAAA,QACA;AAAA,MACD;AACD,aAAOkC;AAAAA,IACP;AAAA,EACD,GACDsI,OAAO,SAAS10C,SAAAA;AACf,WAAOtF,KAAKi6C,MACV30C,QAAO9D,UAAU,OAClB8D,QAAO+Q,KACP/Q,QAAOmN,QAAQ,IACdnN,QAAOqzC,SAAS,MACjBrzC,QAAOwC,UACPxC,QAAOszC;EAER,GACDtK,KAAK,SAASj4B,KAAK6jC,QAAQtB,SAC1B;AAAA,QAAItzC,UAASmzC,aAAa,OAAO7xC,SACjC;AAAA,WAAO5G,KAAKg6C,MAAM10C,OAAAA;AAAAA,EAClB,GACD60C,SAAS,SAAS9jC,KAAKuiC,SAAAA;AACtB,QAAItzC,UAASmzC,aAAa,OAAO7xC,SAAAA;AACjCtB,IAAAA,QAAOqzC,QAAQ;AACf,WAAO34C,KAAKg6C,MAAM10C,OAClB;AAAA,EAAA,GACD80C,KAAK,SAAS/jC,KAAKgkC,UAAUH,QAAQtB,SACpC;AAAA,QAAItzC,UAASmzC,aAAa,OAAO7xC,SACjC;AAAA,WAAO5G,KAAKg6C,MAAM10C,OAClB;AAAA,EAAA,GACDg1C,KAAK,SAASjkC,KAAK6jC,QAAQtB,SAO1B;AAAA,QAAItzC,UAASmzC,aAAa,UAAU7xC,SACpC;AAAA,WAAO5G,KAAKg6C,MAAM10C;EAClB,GACDmR,MAAM,SAASJ,KAAKgkC,UAAUH,QAAQtB;AACrC,QAAIhyC,UAAU7K,UAAU,GAAG;AAC1Bs+C,iBAAW;AAAA,IACf,WAAczzC,UAAU7K,UAAU,KAAA,OAAY,YAAa,YAAY;AACnEm+C,eAASG;AACTA,iBAAW;AAAA,IACX;AACD,QAAI/0C,UAASmzC,aAAa,QAAQ7xC,SAClC;AAAA,WAAO5G,KAAKg6C,MAAM10C,OAAAA;AAAAA,EAClB,GACDi1C,UAAU,SAASlkC,KAAKgkC,UAAUzB,SACjCyB;AAAAA,eAAYA,aAAa,OAAO,KAAKv6C,OAAOu6C,QAE5C;AAAA,QAAI/0C,UAASmzC,aAAa,QAAQ7xC,SAAAA;AAClCtB,IAAAA,QAAOqzC,QAAQ;AACf,WAAO34C,KAAKg6C,MAAM10C;EAClB,GACD20C,OAAO,SAASz4C,QAAQ6U,KAAKgkC,UAAU1B,OAAOuB,QAAQtB,SAAAA;AACrD,WAAO,IAAI71C,OAAMy3C,QAAQ,SAASC,SAASC,QAC1C;AAAA,UAAIxhC,KAAY/B,OAAAA,mBAAmB9W,SAAY,IAAI8W,mBAAmB,IAAIxU,MAAOq2C,cAAc,mBAAA;AAC/F,UAAI2B,OAAQhD,UAAUC,UAAUn8B,MAAM,aAAmB,MAAA,QAAQk8B,UAAUC,UAAUn8B,MAAM,UAAU,QAAQk8B,UAAUC,UAAUn8B,MAAM,QAAA,MAAc;AAErJ,UAAA,CAAA,CAAMk9B,OAAO;AACZz/B,QAAAA,GAAE9B,qBAAqB,WAAA;AACtB,cAAK8B,GAAE7B,cAAc,KAAOsjC,QAAQzhC,GAAE7B,cAAc,GAAI;AACvD,gBAAI6B,GAAE5B,UAAU,OAAO4B,GAAEvB,iBAAiB;AACzC,mBAAK5U,OAAMgF,UAAU,eAAe,CAACmR,EAAK,CAAA,EAAA;AAAA;AAE3CtO,uBAAW,WACV;AAAA,kBAAA,OAAW,UAAW,YAAY;AACjCsvC,uBAAOj6C,MAAM0C,OAAQ,CAAC,EAACuV,QAAOgB,IAAG0hC,UAASvkC;cAC1C;AACDokC,sBAAQvhC;AACR,kBAAW,OAAA,UAAW,YAAY;AACjCghC,yBAAS;AACThhC,gBAAAA,KAAI;AAAA,cACJ;AAAA,YACD,GAAE,CACH;AAAA,UAAA;AAAA,QACP;AAAA,MACK;AAED,UAAI2hC,WAAW76C,QAASA,CAAAA,KAAK64C;AAC7B,UAAIr3C,UAAU,SAASq5C,SAAS;AAC/BxkC,gBAAQA,IAAIpZ,QAAQ,GAAA,KAAM,IAAE,MAAI,OAAK,UAAO,oBAAIyb,QAAOrO,QAAAA,IAAU;AAAA,MACjE;AAED6O,MAAAA,GAAEtB,KAAKpW,QAAQ6U,KAAKsiC,KAAAA;AAEpB,UAAIC,SAAQ;AACX,iBAASv/B,OAAOu/B,QACf1/B,CAAAA,GAAErB,iBAAiBwB,KAAKu/B,QAAQv/B,GACtC,CAAA;AAAA,MAAA,WAAe7X,OAAOs5C,YAAAA,KAAiB,UAAUt5C,UAAU,SAASA,UAAU,UAAU;AACnF0X,QAAAA,GAAErB,iBAAiB,gBAAgB,mCACxC;AAAA,MAAA,WAAerW,UAAU,OAAO;AAC3B64C,mBAAW;AAAA,MACX;AAEDnhC,MAAAA,GAAErB,iBAAiB,oBAAoB;AAEvCqB,MAAAA,GAAEpB,KAAKuiC;AAEP,UAAK1B,CAAAA,MAAO,QAAO,EAACzgC,QAAOgB,IAAG0hC,UAASvkC,IAC3C;AAAA,IAAA,CAAA;AAAA,EACG,GACD0kC,cAAc,SAASn7C,KAAAA;AACtB,QAAIA,IAAI3C,QAAQ,GAAS,KAAA,GACxB,QAAO;AAAA,QAEP,QAAO;AAAA,EACR,EAAA;AAEH;AC7NA,MAAM+9C,cAAY,CAACt7B,QAAgBu7B,KAAcl4C,WAChD2c;AAAAA,WAASA,OAAOjiB,QAAQ,cAAelD,OACtC;AAAA,YAAQA;MACP,KAAK;AACG,eAAA,sBAAsB0gD,MAAI,QAAM,EAAA;AAAA,MACxC,KAAK;AACG,eAAA,uBAAuBA,MAAI,QAAM,EACzC;AAAA,MAAA,KAAK;AACG,eAAA,aAAaA,MAAI,QAAM,EAC/B;AAAA,MAAA,KAAK;AACG,eAAA,cAAcA,MAAI,QAAM,EAChC;AAAA,MAAA,KAAK;AACG,eAAA,sBAAsBA,MAAI,QAAM,EACxC;AAAA,MAAA,KAAK;AACG,eAAA,aAAaA,MAAI,QAAM,EAAA;AAAA,MAC/B,KAAK;AACG,eAAA,mCAAmCA,MAAI,QAAM,EAAA;AAAA,MACrD,KAAK;AACG,eAAA,kCAAkCA,MAAI,QAAM;MACpD,KAAK;AACG,eAAA,qCAAqCA,MAAI,QAAM;MACvD,KAAK;AACG,eAAA,oCAAoCA,MAAI,QAAM,EACtD;AAAA,MAAA,KAAK;AACG,eAAA,uBAAuBA,MAAI,QAAM,EACzC;AAAA,MAAA,KAAK;AACG,eAAA,eAAeA,MAAI,QAAM,EACjC;AAAA,MAAA,KAAK;AACG,eAAA,aAAaA,MAAI,QAAM,EAC/B;AAAA,MAAA,KAAK;AACG,eAAA,sBAAsBA,MAAI,QAAM,EAAA;AAAA,MACxC,KAAK;AACG,eAAA,sBAAsBA,MAAI,QAAM,EAAA;AAAA,MACxC,KAAK;AACG,eAAA,cAAcA,MAAI,QAAM,EAChC;AAAA,MAAA,KAAK;AACG,eAAA,cAAcA,MAAI,QAAM;MAChC,KAAK;AACG,eAAA,sBAAsBA,MAAI,QAAM,EAAA;AAAA,MACxC,KAAK;AACG,eAAA;AAAA,MACR,KAAK;AACG,eAAA;AAAA,MACR;AACQ,eAAA1gD;AAAAA,IACT;AAAA,EAAA,CAAA;AAIK,QAAA2gD,cAAc,IAAIC,SAAS,QAAQ,YAAY,UAAU,cAAc,WAAW,WAAWz7B;AAEnG,SAAQrN,CAAAA,UACA6oC,YAAY7oC,OAAMtP,OAAMsP,KAAK+oC,UAAUr4C,OAAMoT,QAAQpT,OAAMsP,KAAKgpC,YAAYt4C,OAAMsP,KAAKipC,OAC/F;AAAA;AAID,MAAMC,cAAY,CAAC77B,QAAgBu7B,KAAcl4C,WAChD;AAAA,MAAIy4C,OAAO;AACL,QAAAvZ,OAAOviB,OAAOjE,MAAM,YAC1B;AAAA,WAAS3f,IAAI,GAAGA,IAAImmC,KAAKlmC,QAAQD,KAAK;AAC7B,YAAAmmC,KAAKnmC,CACZ,GAAA;AAAA,MAAA,KAAK;AAAA,MACL,KAAK;AACJ0/C,gBAAQ,eAAe1/C,CACvB;AAAA;AAAA,MACD,KAAK;AAAA,MACL,KAAK;AACJ0/C,gBAAQ,gBAAgB1/C,CACxB;AAAA;AAAA,MACD,KAAK;AACI0/C,gBAAA,eAAe1/C,CAAAA,aAAcA;AACrC;AAAA,MACD,KAAK;AAAA,MACL,KAAK;AAAA,MACL,KAAK;AAAA,MACL,KAAK;AACJ0/C,gBAAQ,eAAe1/C,CAAAA;AACvB;AAAA,MACD,KAAK;AACJ0/C,gBAAQ,eAAe1/C,CAAAA;AACvB;AAAA,MACD,KAAK;AACJ0/C,gBAAQ,eAAe1/C,CACvB;AAAA;AAAA,MACD,KAAK;AAAA,MACL,KAAK;AACJ0/C,gBAAQ,2BAA2B1/C,CAAAA;AACnC;AAAA,MACD,KAAK;AACJ0/C,gBAAQ,eAAe1/C,CACvB;AAAA;AAAA,MACD,KAAK;AACJ0/C,gBAAQ,4CAA4C1/C,CACpD;AAAA;AAAA,MACD,KAAK;AACJ0/C,gBAAQ,2CAA2C1/C;AACnD;AAAA,IAIH;AAAA,EAAA;AACA,MAAI6e,OAAO;AACX,MAAIsgC,KAAK;AAAEtgC,WAAO,aAAaA,IAAS;AAAA,EAAA;AAElC,QAAA8gC,cAAc,IAAIN,SAAS,QAAQ,UAAU,0BAA0BK,IAAwB7gC,oBAAAA,IAAAA,IAAAA;AAErG,SAAQ+gC,gBACAD,YAAYC,YAAY34C,OAAMoT,MACtC;AAAA;AAGD,MAAMwlC,cAAc,EACnBjmC,aAAaslC,aACb1oC,aAAaipC,YAAAA;AClHd,MAAMP,YAAY,CAACt7B,QAAgBu7B,KAAcl4C,WACxCsP,CAAAA,UACAqN,OAAOjiB,QAAQ,cAAelD;AACpC,UAAQA,GAAAA;AAAAA,IACP,KAAK;AAAM,aAAO0gD,MAAMl4C,OAAMsP,KAAK+oC,SAAS/oC,MAAKupC,WAAgB74C,CAAAA,IAAAA,OAAMsP,KAAK+oC,SAAS/oC,MAAKlI,QAC1F,CAAA;AAAA,IAAA,KAAK;AAAM,aAAO8wC,MAAMl4C,OAAMsP,KAAK+oC,SAAU/oC,MAAKwpC,YAAAA,IAAgB,KAAM94C,OAAMsP,KAAK+oC,SAAU/oC,MAAKnI,SAAa,IAAA,CAAA;AAAA,IAC/G,KAAK;AAAM,aAAO+wC,MAAM5oC,MAAKupC,WAAevpC,IAAAA,MAAKlI;IACjD,KAAK;AAAM,aAAO8wC,MAAO5oC,MAAKwpC,YAAAA,IAAgB,IAAMxpC,MAAKnI,SAAAA,IAAa;AAAA,IACtE,KAAK;AAAM,aAAO+wC,MAAMl4C,OAAMsP,KAAK+oC,SAAS/oC,MAAKypC,eAAAA,IAAmB,OAAO/4C,OAAMsP,KAAK+oC,SAAS/oC,MAAKpI,YAAgB,IAAA,GAAA;AAAA,IACpH,KAAK;AAAM,aAAOgxC,MAAM5oC,MAAKypC,eAAmBzpC,IAAAA,MAAKpI;IACrD,KAAK;AAAM,aAAOgxC,MAAMl4C,OAAMoT,OAAO9D,KAAK0pC,UAAU1pC,MAAK2pC,UAAAA,CAAAA,IAAej5C,OAAMoT,OAAO9D,KAAK0pC,UAAU1pC,MAAK4pC,OACzG,CAAA;AAAA,IAAA,KAAK;AAAM,aAAOhB,MAAMl4C,OAAMoT,OAAO9D,KAAK6pC,SAAS7pC,MAAK2pC,UAAAA,CAAAA,IAAej5C,OAAMoT,OAAO9D,KAAK6pC,SAAS7pC,MAAK4pC,OAAAA,CAAAA;AAAAA,IACvG,KAAK;AAAM,aAAOhB,MAAMl4C,OAAMoT,OAAO9D,KAAK8pC,YAAY9pC,MAAKwpC,YAAAA,CAAAA,IAAiB94C,OAAMoT,OAAO9D,KAAK8pC,YAAY9pC,MAAKnI,SAAAA,CAAAA;AAAAA,IAC/G,KAAK;AAAM,aAAO+wC,MAAMl4C,OAAMoT,OAAO9D,KAAK+pC,WAAW/pC,MAAKwpC,YAAAA,CAAAA,IAAiB94C,OAAMoT,OAAO9D,KAAK+pC,WAAW/pC,MAAKnI,SAC7G,CAAA;AAAA,IAAA,KAAK;AAAM,aAAO+wC,MAAMl4C,OAAMsP,KAAK+oC,UAAU/oC,MAAKgqC,gBAAgB,MAAM,KAAK,CAAKt5C,IAAAA,OAAMsP,KAAK+oC,UAAU/oC,MAAKiqC,SAAa,IAAA,MAAM,KAAK,CACpI;AAAA,IAAA,KAAK;AAAa,aAAArB,OAAQ5oC,MAAKgqC,YAAAA,IAAgB,MAAM,KAAK,KAAOhqC,MAAKiqC,SAAAA,IAAa,MAAM,KAAK;AAAA,IAC9F,KAAK;AAAM,aAAOrB,MAAM5oC,MAAKgqC,YAAAA,IAAgBhqC,MAAKiqC,SAAAA;AAAAA,IAClD,KAAK;AAAM,aAAOrB,MAAMl4C,OAAMsP,KAAK+oC,SAAS/oC,MAAKgqC,YAAAA,CAAAA,IAAiBt5C,OAAMsP,KAAK+oC,SAAS/oC,MAAKiqC;IAC3F,KAAK;AAAM,aAAOrB,MAAMl4C,OAAMsP,KAAK+oC,SAAS/oC,MAAKkqC,cAAAA,CAAAA,IAAmBx5C,OAAMsP,KAAK+oC,SAAS/oC,MAAKmqC;IAC7F,KAAK;AAAa,aAAAvB,MAAO5oC,MAAKgqC,gBAAgB,KAAK,OAAO,OAAShqC,MAAKiqC,SAAa,IAAA,KAAK,OAAO;AAAA,IACjG,KAAK;AAAa,aAAArB,MAAO5oC,MAAKgqC,YAAgB,IAAA,KAAK,OAAO,OAAShqC,MAAKiqC,SAAAA,IAAa,KAAK,OAAO;AAAA,IACjG,KAAK;AAAM,aAAOrB,MAAMl4C,OAAMsP,KAAK+oC,SAAS/oC,MAAKoqC,cAAmB15C,CAAAA,IAAAA,OAAMsP,KAAK+oC,SAAS/oC,MAAKqqC,WAC7F,CAAA;AAAA,IAAA,KAAK;AAAM,aAAOzB,MAAMl4C,OAAMsP,KAAK+oC,SAASr4C,OAAMsP,KAAKsqC,cAActqC,UAAStP,OAAMsP,KAAK+oC,SAASr4C,OAAMsP,KAAKgpC,WAAWhpC,KACxH,CAAA;AAAA,IAAA;AAAgB,aAAA9X;AAAAA,EAAAA;AACjB,CAIH;AAAA,MAAMghD,YAAY,CAAC77B,QAAgBu7B,KAAcl4C,WACxCsP,CAAAA,UACP;AAAA,QAAMuqC,MAA4B,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG;AAC5C,QAAAC,OAAOxqC,MAAKoJ,MAAM,mBAAA;AAClB,QAAAwmB,OAAOviB,OAAOjE,MAAM,YAAA;AAE1B,WAAS3f,IAAI,GAAGA,IAAImmC,KAAKlmC,QAAQD,KAAK;AAC7B,YAAAmmC,KAAKnmC,CAAAA,GAAAA;AAAAA,MACZ,KAAK;AAAA,MACL,KAAK;AACJ8gD,YAAI,CAAKC,IAAAA,KAAK/gD,MAA2B;AACzC;AAAA,MACD,KAAK;AAAA,MACL,KAAK;AACJ8gD,YAAI,CAAMC,KAAAA,KAAK/gD,MAA2B,KAAK;AAC/C;AAAA,MACD,KAAK;AACA8gD,YAAA,CAAKC,IAAAA,KAAK/gD,CAA0B,IAAA,KAAM+gD,KAAK/gD,CAAAA,IAA2B,KAAK,OAAO;AAC1F;AAAA,MACD,KAAK;AAAA,MACL,KAAK;AAAA,MACL,KAAK;AAAA,MACL,KAAK;AACJ8gD,YAAI,KAAKC,KAAK/gD,CAAAA,KAA2B;AACzC;AAAA,MACD,KAAK;AACJ8gD,YAAI,CAAKC,IAAAA,KAAK/gD,CAA2B,KAAA;AACzC;AAAA,MACD,KAAK;AACJ8gD,YAAI,CAAA,IAAKC,KAAK/gD,CAA2B,KAAA;AACzC;AAAA,MACD,KAAK;AAAA,MACL,KAAK;AACJ8gD,YAAI,CAAA,IAAKA,IAAI,CAAe,IAAA,OAAOC,KAAK/gD,CAAM,KAAA,IAAIZ,kBAAkB,OAAO,IAAI;AAC/E;AAAA,MACD,KAAK;AACJ0hD,YAAI,CAAKC,IAAAA,KAAK/gD,MAAM;AACpB;AAAA,MACD,KAAK;AACA8gD,YAAA,CAAK75C,IAAAA,OAAMoT,OAAO9D,KAAKyqC,iBAAiBD,KAAK/gD,CAAAA,CAAAA,KAAO;AACxD;AAAA,MACD,KAAK;AACA8gD,YAAA,CAAK75C,IAAAA,OAAMoT,OAAO9D,KAAK0qC,gBAAgBF,KAAK/gD,OAAO;AACvD;AAAA,IAAA;AAAA,EAIH;AAEA,MAAIm/C,KAAK;AACD,WAAA,IAAIviC,KAAKA,KAAKskC,IACpBJ,IAAI,IACJA,IAAI,CAAA,GACJA,IAAI,CACJA,GAAAA,IAAI,IACJA,IAAI,CAAA,GACJA,IAAI,CAAA,CAAA,CAAA;AAAA,EAEN;AACA,SAAO,IAAIlkC,KACVkkC,IAAI,IACJA,IAAI,CAAA,GACJA,IAAI,CACJA,GAAAA,IAAI,CACJA,GAAAA,IAAI,CACJA,GAAAA,IAAI;AACL;AAMF,MAAMK,aAAa,EAClBvnC,aAAaslC,WACb1oC,aAAaipC,UC/EC;AAAA,SAAQlpC,KAACtP,QAAAA;AACvB,MAAIm6C,YAAY;AAChB,WAASC,eAAAA;AACR;AACC,UAAIhC,SAAS;IACb,SAAOj8C,GACPg+C;AAAAA,kBAAY;AAAA,IACZ;AAAA,EACD;AACD,WAASE,SAAAA;AACR,QAAIp5C,SAAS;AACb,QAAIjB,OAAMuC,OAAOiyC,QAAQ,QAAQ;AAChC,UAAG2F,cAAc,MAAM;AACtBC,qBAAAA;AAAAA,MACA;AACDn5C,eAASk5C;AAAAA,IACZ,OAAS;AACNl5C,eAASjB,OAAMuC,OAAOiyC;AAAAA,IACtB;AACD,WAAOvzC;AAAAA,EACP;AAED,MAAIq5C,aAAa,EAChBC,MAAM;AACL,QAAInnC,UAASpT,OAAMoT;AAEnB,QAAIonC,IAAIpnC,QAAO9D,KAAK8pC;AACpB,QAAIjjC,KAAI/C,QAAO9D,KAAKyqC,mBAAmB,CAAA;AACvC,aAAShhD,IAAI,GAAGA,IAAIyhD,EAAExhD,QAAQD,IAC7Bod,CAAAA,GAAEqkC,EAAEzhD,CAAMA,CAAAA,IAAAA;AAEX,QAAIyhD,IAAIpnC,QAAO9D,KAAK+pC;AACpB,QAAIljC,KAAI/C,QAAO9D,KAAK0qC,kBAAkB,CAAA;AACtC,aAASjhD,IAAI,GAAGA,IAAIyhD,EAAExhD,QAAQD,IAC7Bod,CAAAA,GAAEqkC,EAAEzhD,CAAMA,CAAAA,IAAAA;AAAAA,EACX,GACD0hD,WAAW,SAAUnrC,OACpB;AAAA,QAAI+5B,MAAM,IAAI1zB,KAAKrG,KACnBA;AAAAA,IAAAA,MAAKorC,SAAS,CACdz9C;AAAAA,SAAK09C,WAAWrrC,KAChB;AAAA,QAAIA,MAAKiqC,SAAAA,MACPjqC,MAAKlI,QAAAA,IAAYiiC,IAAIjiC,QAAakI,KAAAA,MAAKnI,SAAakiC,IAAAA,IAAIliC,SAAcmI,KAAAA,MAAKpI,gBAAgBmiC,IAAIniC,YAAAA,GAChGoI,CAAAA,MAAKsrC,QAAQtrC,MAAKhI,QAAAA,IAAY,KAAK,KAAK,OAAQ,KAAKgI,MAAKiqC,SAAAA,EAAAA;AAC3D,WAAOjqC;AAAAA,EACP,GACDurC,WAAW,SAAUvrC,OACpB;AAAA,YAAQA,MAAK5E,QAAY,IAAA,MAAO4E,MAAKwrC,kBAAAA,IAAsB,MAAM;AAAA,EACjE,GACDC,YAAY,SAAUzrC,OACrB;AAAA,QAAIwU,QAAQxU,MAAK4pC;AACjB,QAAIl5C,OAAMuC,OAAO0tC,iBAAiB;AACjC,UAAInsB,UAAU,EAAGA,SAAQ;AAAA,UACpBA;AAAAA,IACL;AACD,WAAO7mB,KAAKw9C,UAAUx9C,KAAKsM,IAAI+F,OAAAA,KAAWwU,OAAO,KAAA,CAAA;AAAA,EACjD,GACDk3B,aAAa,SAAU1rC,OAAAA;AACtBA,IAAAA,MAAK2rC,QAAQ,CAAA;AACb,WAAOh+C,KAAKw9C,UAAUnrC;EACtB,GACD4rC,eAAe,SAAU5rC,OAAAA;AACxBrS,SAAK+9C,YAAY1rC;AACjB,QAAI6rC,IAAI7rC,MAAKnI,SAAAA,GACZi0C;AAED,QAAID,KAAK,GAAG;AACXC,kBAAY;AAAA,IAChB,WAAcD,KAAK,GAAG;AAClBC,kBAAY;AAAA,IAChB,WAAcD,KAAK,GAAG;AAClBC,kBAAY;AAAA,IAChB,OAAU;AACNA,kBAAY;AAAA,IACZ;AAED9rC,IAAAA,MAAK+rC,SAASD,SAAAA;AACd,WAAO9rC;AAAAA,EACP,GACDgsC,YAAY,SAAUhsC,OACrBA;AAAAA,IAAAA,MAAK+rC,SAAS,CACd;AAAA,WAAOp+C,KAAK+9C,YAAY1rC,KAAAA;AAAAA,EACxB,GACDisC,WAAW,SAAUjsC,OACpB;AAAA,WAAOrS,KAAKw9C,UAAUnrC;EACtB,GACDqrC,YAAY,SAAUrrC,OAAAA;AACrB,QAAIA,MAAKmqC,aACRnqC,CAAAA,MAAKksC,WAAW,CACjBv+C;AAAAA,SAAKw+C,aAAansC,KAAAA;AAElB,WAAOA;AAAAA,EACP,GACDmsC,cAAc,SAAUnsC,OAAAA;AACvB,QAAIA,MAAKqqC,WAAAA,EACRrqC,CAAAA,MAAKosC,WAAW,CACjB;AAAA,QAAIpsC,MAAKqsC,gBACRrsC,EAAAA,CAAAA,MAAKssC,gBAAgB,CACtB;AAAA,WAAOtsC;AAAAA,EACP,GACDusC,WAAW,SAAUC,cAAcC,KAAKC,cAAAA;AAEvCF,iBAAab,QAAQa,aAAa10C,YAAY20C,GAC9C;AAAA,QAAIE,eAAeF,OAAO;AAC1B,QAAIG,oBAAAA,CAAqBF,aAAazC,SAAAA,KAAcuC,aAAavC,SACjE;AAAA,QAAI4C,mBAAoBL,aAAa10C,QAAa40C,KAAAA,aAAa50C,aAAa00C,aAAa30C,SAAAA,IAAa60C,aAAa70C,SAAAA,KAAc20C,aAAa50C,YAAAA,IAAgB80C,aAAa90C,YAC3K;AAAA,QAAI+0C,gBAAgBC,qBAAqBC,kBAAiB;AACzDL,mBAAalB,QAAQkB,aAAax0C,QAAAA,IAAY,KAAK,KAAK,OAAQ,KAAKw0C,aAAavC;IAClF;AACD,QAAI6C,sBAAsBL,MAAM;AAChC,QAAIK,uBAAuBF,mBAAkB;AAE5CJ,mBAAapB,SAAS,CAAA;AAAA,IACtB;AACD,WAAOoB;AAAAA,EACP,GAEDvyC,KAAK,SAAU+F,OAAMysC,KAAKvnB,MAEzB;AAAA,QAAI6nB,QAAQ,IAAI1mC,KAAKrG,MAAK5E,QAAAA,CAAAA;AAC1B,YAAQ8pB,MAAAA;AAAAA,MACP,KAAK;AACJ6nB,gBAAQp/C,KAAK4+C,UAAUQ,OAAON,KAAKzsC;AACnC;AAAA,MACD,KAAK;AACJ+sC,gBAAQp/C,KAAK4+C,UAAUQ,OAAON,MAAM,GAAGzsC,KAAAA;AACvC;AAAA,MACD,KAAK;AACJ+sC,cAAMhB,SAASgB,MAAMl1C,SAAa40C,IAAAA,GAAAA;AAClC;AAAA,MACD,KAAK;AACJM,cAAMC,QAAQD,MAAMn1C,YAAAA,IAAgB60C;AACpC;AAAA,MACD,KAAK;AAWJM,cAAMzB,QAAQyB,MAAM/0C,QAAYy0C,IAAAA,MAAM,KAAK,KAAK,GAChD;AAAA;AAAA,MACD,KAAK;AAEJM,cAAMzB,QAAQyB,MAAM/0C,QAAYy0C,IAAAA,MAAM,KAAK,GAE3C;AAAA;AAAA,MACD;AACC,eAAO9+C,KAAK,SAASu3B,MAAMllB,OAAMysC,KAAKvnB;;AAExC,WAAO6nB;AAAAA,EAEP,GACDE,aAAa,SAAUjtC,OAAMysC,KAAAA;AAC5B,WAAO9+C,KAAKsM,IAAI+F,OAAMysC,MAAM,GAAG,OAAA;AAAA,EAC/B,GAED1D,UAAU,SAAUmE,KACnB;AAAA,QAAIA,MAAM,GAAI,QAAO,MAAMA;AAC3B,WAAOA;AAAAA,EACP,GACDl7C,MAAM,SAAUgO;AACf,WAAO,IAAIqG,KAAKrG,MAAK5E,QACrB,CAAA;AAAA,EAAA,GACDiI,aAAa,SAAUgK,QAAQu7B,KAC9B;AAAA,QAAIj3C,SAAS23C;AACb,QAAIyB,OAAU,GAAA;AACbp5C,eAASw7C;AAAAA,IACT;AACD,WAAOx7C,OAAO0R,YAAYgK,QAAQu7B,KAAKl4C,MACvC;AAAA,EAAA,GACDuP,aAAa,SAAUoN,QAAQu7B,KAC9B;AAAA,QAAIj3C,SAAS23C;AACb,QAAIyB,OAAU,GAAA;AACbp5C,eAASw7C;AAAAA,IACT;AACD,WAAOx7C,OAAOsO,YAAYoN,QAAQu7B,KAAKl4C,MACvC;AAAA,EAAA,GACDs4C,YAAY,SAAU+D,OAAAA;AACrB,WAAOr8C,OAAMsP,KAAKotC,eAAeL,OAAO,IAAA;AAAA,EACxC,GACDK,gBAAgB,SAASL,OAAOM;AAC/B,QAAKN,CAAAA,MAAO,QAAO;AACnB,QAAIO,OAAOP,MAAMnD,OACjB;AAAA,QAAGyD,SAAQ;AACV,UAAIC,SAAS,GAAG;AACfA,eAAO;AAAA,MACP;AAAA,IACD;AACD,QAAIC,iBAAiB,IAAIlnC,KAAK0mC,MAAM3xC,QACpCmyC,CAAAA;AAAAA,mBAAe5B,QAAQoB,MAAMj1C,QAAAA,KAAa,IAAIw1C,KAAAA;AAC9C,QAAIE,cAAcD,eAAe31C,YACjC;AAAA,QAAI61C,eAAexmD,KAAKC,OAAOqmD,eAAev1C,YAAY,IAAIqO,KAAKmnC,aAAa,GAAG,CAAA,EAAGx1C,aAAa,KACnG;AAAA,QAAI01C,cAAc,IAAIzmD,KAAKkS,MAAMs0C,eAAe,CAChD;AAAA,WAAOC;AAAAA,EACP,GAEDzE,SAAS,SAAS8D;AACjB,WAAOr8C,OAAMsP,KAAKotC,eAAeL,OAAOr8C,OAAMuC,OAAO0tC,eACrD;AAAA,EAAA,GACD2J,eAAe,SAAUyC,OAAAA;AACxB,WAAOr8C,OAAMsP,KAAKgpC,WAAW+D,KAAAA;AAAAA,EAC7B,GACDY,gBAAgB,SAAU3tC,OACzB;AAAA,WAAO,IAAIqG,KAAKrG,MAAKypC,kBAAkBzpC,MAAKwpC,YAAAA,GAAexpC,MAAKupC,WAAAA,GAAcvpC,MAAKgqC,YAAAA,GAAehqC,MAAKkqC,cAAiBlqC,GAAAA,MAAKoqC;EAC7H,GACDwD,WAAW,SAAU5tC,OAAMqN,QAAAA;AAG1B,QAAIrN,SAAAA,CAASA,MAAKpI,aAAa;AAC9B,UAAW,OAAA,WAAY,YAAY;AAClC,YAAW,OAAA,WAAY,UAAU;AAChC,cAAIyV,WAAW,gBAAgBA,WAAW,YAAY;AACrDA,qBAAS3c,OAAMugC,QAAQvgC,OAAMmS,UAAUK,YAAYxS,OAAMmS,UAAUK,WAAWxS,OAAMmS,UAAUgrC;AAAAA,UACrG,OAAa;AACNxgC,qBAAS3c,OAAMugC,QAAQvgC,OAAMmS,UAAUwK,WAAW3c,OAAMmS,UAAUwK,MAAU3c,IAAAA,OAAMsP,KAAKC,YAAYoN;UACnG;AAAA,QACP,OAAY;AACNA,mBAAS3c,OAAMugC,QAAQvgC,OAAMmS,UAAUK,QAAYxS,IAAAA,OAAMmS,UAAUK,WAAWxS,OAAMmS,UAAUgrC;AAAAA,QAC9F;AAAA,MACD;AACD,UAAI7tC,OAAM;AACTA,QAAAA,QAAOqN,OAAOrN,KACnB;AAAA,MAAA,OAAW;AACNA,QAAAA,QAAO;AAAA,MACP;AAAA,IACD;AACD,WAAOA;AAAAA,EACP,EAAA;AAEF,SAAOgrC;AACR;ACjQA,MAAMnkC,EAAAA;AAAAA,EAAE,YAAYA;AAAG,UAAM7C,EAAAA,KAAInX,GAAEihD,OAAM5C,EAAAA,IAAGrkC;AAAElZ,SAAKogD,OAAKlhD,GAAEc,KAAKqgD,SAAO9C,GAAEv9C,KAAKsgD,QAAM,GAAEtgD,KAAKugD,QAAM,GAAEvgD,KAAKwgD,SAAO,CAAA,GAAGxgD,KAAKyS,OAAK,CAAE,GAACzS,KAAKygD,MAAI,CAAE,GAACzgD,KAAK0gD,UAAQ,CAAA;AAAA,EAAE;AAAA,EAAC,UAAU;AAAA,WAAM,EAACC,QAAO,oBAAmB,gBAAe,oBAAmB,gBAAe3gD,KAAKqgD,OAAAA;AAAAA,EAAO;AAAA,EAAC,MAAMnnC,IAAEha,GAAAA;AAAG,UAAMq+C,IAAE,EAACqD,aAAY,WAAUhI,SAAQ54C,KAAK44C,QAAAA,EAAAA;AAAW,WAAO15C,MAAIq+C,EAAE/7C,SAAO,QAAO+7C,EAAEplD,OAAK+G,IAAG2hD,MAAM3nC,IAAEqkC,GAAGuD,KAAK5nC,CAAAA,OAAGA,GAAEiC,KAAO,CAAA;AAAA,EAAA;AAAA,EAAC,KAAKjC,IAAG;AAAA,WAAOA,OAAIlZ,KAAKogD,OAAKlnC,KAAGlZ,KAAK6gD,MAAM7gD,KAAKogD,MAAMU,KAAK5nC,CAAAA,OAAGlZ,KAAK0X,MAAMwB,EAAG,CAAA;AAAA,EAAA;AAAA,EAAC,MAAMA,IAAAA;AAAG,YAAMG,KAAIna,GAAE6hD,WAAUxD,EAAGrkC,IAAAA;AAAEha,UAAIc,KAAKqgD,SAAOnnC,GAAEG;AAAK,eAAUna,MAAKga,GAAEzG,KAAKzS,MAAKyS,KAAKvT,EAAAA,IAAGga,GAAEzG,KAAKvT,EAAG;AAAA,eAAUA,MAAKga,GAAEunC,KAAI;AAAC,YAAMlD,KAAEv9C,KAAKygD,IAAIvhD,EAAG,IAAA,IAAGpD,IAAEod,GAAEunC,IAAIvhD,EAAAA;AAAG,iBAAUga,MAAKpd,EAAEyhD,CAAAA,GAAErkC,EAAGlZ,IAAAA,KAAKghD,SAAS9hD,KAAE,MAAIga,EAAAA;AAAAA,IAAE;AAAC,WAAOqkC,KAAGv9C,KAAKihD,QAAUjhD,GAAAA;AAAAA,EAAI;AAAA,EAAC,UAAAihD;AAAU,UAAM/nC,KAAElZ,KAAKkhD;AAAQhoC,IAAAA,OAAIlZ,KAAKkhD,UAAQ,MAAKhoC,GAAEioC,UAAQ,WAAA;AAAA,IAAY,GAACjoC,GAAE6X,MAAAA,IAAS/wB,KAAKsgD,QAAM,GAAEtgD,KAAKkhD,UAAQ,SAAShoC,IAAEha,GAAEq+C,GAAEzhD,GAAAA;AAAG,UAAIslD,IAAEliD;AAAE,cAAMkiD,EAAE,CAAKA,MAAAA,IAAEhpD,SAASipD,SAASC,WAAS,OAAKlpD,SAASipD,SAAS7+C,OAAKtD;AAAGkiD,UAAEA,EAAE3jD,QAAQ,cAAa,OAAS;AAAA,YAAM8jD,UAAMH,EAAEnkD,QAAQ,GAAK,IAAA,MAAI;AAAImkD,UAAE,GAAGA,CAAIG,GAAAA,CAAAA,SAAUhE,CAAS;AAAA,YAAMiE,IAAE,IAAIC,UAAUL;AAAG,aAAOI,EAAEL,UAAQ,MAAIv2C,WAAW,MAAIsO,GAAE+nC,QAAU,GAAA,GAAA,GAAKO,EAAEE,YAAUxiD,CAAAA,OAAAA;AAAI,cAAMq+C,KAAExmC,KAAKW,MAAMxY,GAAEuT,IAAAA;AAAM,gBAAO8qC,GAAEzkC,QAAQ;AAAA,UAAA,KAAI;AAASI,YAAAA,GAAElV,OAAOu5C,GAAEplD,MAAK,CAAI,CAAA;AAAA;AAAA,UAAM,KAAI;AAAQ+gB,YAAAA,GAAEyoC,KAAKpE,GAAEplD,KAAKkF,MAAKkgD,GAAEplD,KAAK4gB,KAAAA;AAAO;AAAA,UAAM,KAAI;AAAQjd;AAAI;AAAA,UAAM;AAAQod,YAAAA,GAAE0oC,QAAQrE,GAAE9qC,IAAAA;AAAAA,QAAAA;AAAAA,MAAK,GAAG+uC;AAAAA,IAAC,EAAExhD,MAAKA,KAAKogD,MAAKpgD,KAAKqgD,QAAO,OAAKrgD,KAAKsgD,QAAM,GAAEtgD,KAAK6hD,MAAQ7hD,GAAAA,KAAK8hD,gBAAe9hD,KAAM;AAAA,EAAA;AAAA,EAAC,SAASkZ,IAAAA;AAAG,YAAO,WAAA;AAAW,YAAMha,IAAE,GAAGtD,MAAMC,KAAK+K,SAAW;AAAA,UAAI22C,IAAE;AAAK,YAAMzhD,IAAE,IAAI0+C,QAAQ,CAAC1+C,IAAEslD,MAAAA;AAAK7D,YAAE,EAAC9qC,MAAK,EAACxL,IAAGjH,KAAK+hD,QAAO1kD,MAAK6b,IAAEvO,MAAKzL,EAAAA,GAAGoY,QAAO,GAAEmjC,SAAQ3+C,IAAE4+C,QAAO0G,KAAGphD,KAAKwgD,OAAOxhD,KAAKu+C,CAAC;AAAA,MAAA,CAAA;AAAI,aAAOv9C,KAAKgiD,OAAOzE,GAAEzhD,IAAG,MAAIkE,KAAKsgD,QAAMtgD,KAAK6hD,MAAMtE,KAAG3yC,WAAW,MAAI5K,KAAK6hD,MAAAA,GAAQ,CAAG/lD,GAAAA;AAAAA,IAAC,GAAE6L,KAAK3H,IAAAA;AAAAA,EAAK;AAAA,EAAC,OAAO;AAAA,YAAOA,KAAKugD,SAAS7kC,SAAAA;AAAAA,EAAU;AAAA,EAAC,MAAMxC,IAAAA;AAAG,QAAG,KAAGlZ,KAAKsgD,MAAM,QAAY11C,KAAAA,WAAW,MAAI5K,KAAK6hD,MAAAA,GAAQ,GAAK;AAAA,UAAM3iD,IAAEga,KAAE,CAACA,EAAGlZ,IAAAA,KAAKwgD,OAAOyB,OAAO/oC,CAAAA,OAAG,MAAIA,GAAE5B,MAAQ;AAAA,QAAA,CAAIpY,EAAEnD,OAAO;AAAO,UAAMwhD,IAAEr+C,EAAEqK,IAAI2P,CAAAA,QAAIA,GAAE5B,SAAO,GAAE4B,GAAEzG,KAAAA;AAAO,UAAIzS,KAAKsgD,QAAMtgD,KAAK6gD,MAAM7gD,KAAKogD,MAAKrpC,KAAKC,UAAUumC,CAAI2E,CAAAA,EAAAA,MAAMhpC,CAAAA,OAAGlZ,KAAK4hD,QAAQ1oC,EAAI4nC,CAAAA,EAAAA,KAAK5nC,CAAAA,OAAGlZ,KAAKgE,OAAOkV,IAAEqkC,CAAAA,CAAAA,IAAIv9C,KAAKkhD,QAAQppC,KAAKf,KAAKC,UAAU,EAAC8B,QAAO,QAAO3gB,MAAKolD,EAAAA,CAAAA,CAAAA;AAAAA,EAAI;AAAA,EAAC,OAAOrkC,IAAEha,GAAG;AAAA,UAAMq+C,IAAE,CAAA;AAAG,QAAGrkC,GAAE,UAAQha,KAAE,GAAEA,KAAEga,GAAEnd,QAAOmD,KAAIq+C,GAAErkC,GAAEha,EAAAA,EAAG+H,EAAIiS,IAAAA,GAAEha,EAAQ;AAAA,QAAA,UAAQga,KAAE,GAAEA,KAAEha,EAAEnD,QAAOmd,KAAIqkC,GAAEr+C,EAAEga,EAAAA,EAAGjS,EAAI,IAAA,EAACA,IAAG/H,EAAEga,IAAGjS,IAAGrF,OAAM,iBAAgB6Q,MAAK,KAAA;AAAM,aAAQyG,KAAElZ,KAAKwgD,OAAOzkD,SAAO,GAAEmd,MAAG,GAAEA,MAAI;AAAC,YAAMha,KAAEc,KAAKwgD,OAAOtnC,EAAAA,GAAGpd,IAAEyhD,EAAEr+C,GAAEuT,KAAKxL;AAAInL,YAAIkE,KAAKmiD,WAAWjjD,IAAEpD,CAAAA,GAAGA,EAAE8F,QAAM1C,GAAEw7C,OAAO5+C,EAAE8F,KAAO1C,IAAAA,GAAEu7C,QAAQ3+C,EAAE2W,IAAAA,GAAMzS,KAAKwgD,OAAOnkD,OAAO6c,IAAE;IAAG;AAAA,EAAC;AAAA,EAAC,GAAGA,IAAEha,GAAAA;AAAG,UAAMq+C,IAAEv9C,KAAK+hD;AAAO,QAAIjmD,IAAEkE,KAAK0gD,QAAQxnC,EAAAA;AAAG,UAAMkoC,IAAAA,CAAAA,CAAItlD;AAAE,WAAOslD,MAAItlD,IAAEkE,KAAK0gD,QAAQxnC,EAAG,IAAA,CAAA,IAAIpd,EAAEkD,KAAK,EAACiI,IAAGs2C,GAAEz2C,SAAQ5H,EAAAA,CAAAA,GAAIkiD,KAAG,KAAGphD,KAAKsgD,SAAOtgD,KAAKkhD,QAAQppC,KAAKf,KAAKC,UAAU,EAAC8B,QAAO,aAAYzb,MAAK6b,QAAK,EAAC7b,MAAK6b,IAAEjS,IAAGs2C,EAAE;AAAA,EAAA;AAAA,EAAC,eAAe;AAAA,QAAG,KAAGv9C,KAAKsgD,MAAM,YAAUpnC,MAAKlZ,KAAK0gD,QAAQ1gD,MAAKkhD,QAAQppC,KAAKf,KAAKC,UAAU,EAAC8B,QAAO,aAAYzb,MAAK6b;EAAI;AAAA,EAAC,OAAOA,IAAAA;AAAG,QAAIA,CAAAA,IAAE;AAAC,UAAG,KAAGlZ,KAAKsgD,MAAM,YAAUpnC,MAAKlZ,KAAK0gD,QAAQ1gD,MAAKkhD,QAAQppC,KAAKf,KAAKC,UAAU,EAAC8B,QAAO,eAAcO,KAAIH,GAAAA,CAAAA,CAAAA;AAAK,mBAAYlZ,KAAK0gD,UAAQ,CAAA;AAAA,IAAG;AAAC,UAAA,EAAMz5C,IAAG/H,GAAE7B,MAAKkgD,EAAGrkC,IAAAA,IAAEpd,IAAEkE,KAAK0gD,QAAQnD,CAAG;AAAA,QAAGzhD,GAAE;AAAC,YAAMod,KAAEpd,EAAEmmD,OAAO/oC,CAAAA,OAAGA,GAAEjS,MAAI/H,CAAAA;AAAGga,MAAAA,GAAEnd,SAAOiE,KAAK0gD,QAAQnD,CAAGrkC,IAAAA,MAAAA,OAAUlZ,KAAK0gD,QAAQnD,CAAAA,GAAG,KAAGv9C,KAAKsgD,SAAOtgD,KAAKkhD,QAAQppC,KAAKf,KAAKC,UAAU,EAAC8B,QAAO,eAAczb,MAAKkgD,EAAAA,CAAAA,CAAAA;AAAAA,IAAK;AAAA,EAAC;AAAA,EAAC,KAAKrkC,IAAEha,GAAG;AAAA,UAAMq+C,IAAEv9C,KAAK0gD,QAAQxnC,EAAAA;AAAG,QAAGqkC,EAAE,UAAQrkC,KAAE,GAAEA,KAAEqkC,EAAExhD,QAAOmd,KAAIqkC,GAAErkC,EAAGpS,EAAAA,QAAQ5H;EAAE;AAAA,EAAC,QAAQga,IAAAA;AAAG,WAAO;AAAA,EAAI;AAAA,EAAC,OAAOA,IAAEha,GAAAA;AAAAA;EAAI,WAAWga,IAAEha,GAAAA;AAAAA,EAAI;ACC5oG;AAAA,MAAMkjD,eAAe,SAAS/rC,KAAK8pC,OACtC;AAAA,QAAMkC,SAAS,IAAIC,EAAqB,EACtCjsC,KACA8pC,MAAAA,CAAAA;AAIFkC,SAAOxB,QAAQ,SAAUxqC,MAAKle;AAC5B,UAAMoqD,MAAM,EACV3J,SAAS54C,KAAK44C,QAAAA,EAAAA;AAEhB,QAAIzgD,MAAM;AACRoqD,UAAI/gD,SAAS;AACb+gD,UAAIpqD,OAAOA;AAAAA,IACZ;AAED,WAAO0oD,MAAMxqC,MAAKksC,KAAKzB,KAAMv+B,SAAQA,IAAIpH,KAAAA,CAAAA;AAAAA,EAC/C;AAEInb,OAAKwiD,SAASH,OAAOI,KAAAA,EAAO3B,KAAM4B,UAAU1iD,KAAK2iD,UAAUD,IAE3D;AAAA,WAASE,QACP;AAAA,WAAO5iD,KAAKwiD;AAAAA,EACb;AAED,WAASK,GAAGxlD,MAAMyJ,SAChB9G;AAAAA,SAAK4iD,QAAQ9B,KAAM4B,UAAAA;AACjB,UAAWrlD,OAAAA,SAAS,SAAUqlD,MAAKG,GAAGxlD,MAAMyJ,OAAAA;AAAAA,WACvC;AACH,mBAAWuS,OAAOhc,MAAM;AACtBqlD,eAAKG,GAAGxpC,KAAKhc,KAAKgc,GAAAA,CAAAA;AAAAA,QACnB;AAAA,MACF;AAAA,IAEJ,CAAA;AAAA,EAAA;AAEDrZ,OAAK4iD,QAAQA;AACb5iD,OAAK6iD,KAAKA;AACX;ACvCH,SAASC,aAAatgD,MAAMugD;AAC3B,MAAKA,CAAAA,aACJ,QAAO;AAER,MAAIvgD,KAAKwgD,YACR,QAAO;AAER,MAAIz4C,UAAUjR,KAAK2pD,KAAK,MAAKF,YAC7B;AAAA,MAAIx4C,UAAU,EAAG,QAAO;AAExBK,aAAW,WAAA;AAAA,WACHpI,KAAKwgD;AAAAA,EACZ,GAAEz4C,OAAAA;AAEH/H,OAAKwgD,cAAc;AACnB,SAAO;AACR;ACVe,SAAQE,IAACngD,QAEvB;AAAA,WAASogD,aAAajkD,GAAAA;AACrB,WAAO,EACNI,QAAQJ,EAAEI,UAAUJ,EAAEK,YACtB6jD,OAAOlkD,EAAEkkD,OACTC,OAAOnkD,EAAEmkD,OACT1iD,SAASzB,EAAEyB,SACXC,SAAS1B,EAAE0B,SACXqnB,SAAS/oB,EAAE+oB,SACXH,UAAU5oB,EAAE4oB,UACZE,SAAS9oB,EAAE8oB,SACXD,QAAQ7oB,EAAE6oB,OAAAA;AAAAA,EAEX;AAED,WAASm7B,KAAInkD,KAAKuG,SACjBtF;AAAAA,SAAKsjD,OAAOvkD;AACZiB,SAAKujD,YAAYj+C,WAAU;AAC3BoH,kBAAU1M,IAAAA;AAEV,QAAIwjD,eAAexjD,KAAKyjD,gBAExBzjD;AAAAA,SAAK0jD,oBAAoB;AACzB3gD,IAAAA,OAAMyE,YAAY,iBAAiBm8C,KAAW,SAAU7rD,MAAMD,KAC7DmI;AAAAA,WAAK4jD;IACR,GAAK5jD,IAAAA,CAAAA;AAEH,QAAI6jD,WAAW;AACf,QAAIC,cAAc,EAACC,SAAS;AAC5B,aAAQjoD,IAAI,GAAGA,IAAI0nD,aAAaznD,QAAQD,KAAI;AAC1C6nD,WAAW,SAAS9oD,OAAAA;AAEpBkI,QAAAA,OAAM1D,MAAMN,KAAKlE,MAAMouB,MAAM06B,KAAW,SAAUzkD,GAAAA;AACjD,cAAIrE,CAAAA,MAAMmpD,SAAS9kD,CAAG,GAAA;AACrB;AAAA,UACA;AAED,cAAWA,OAAAA,EAAElE,WAAW,eAAekE,EAAElE,WAAW,GAAG;AACtD;AAAA,UACA;AAED,cAAGsK,QAAOslB,kBAAkBtlB,QAAOnE,YAAY8zB,QAAmB/1B,EAAEI,QAAQgG,QAAOnE,QAAAA,GAAU;AAC5FjC,cAAE0rB;UACF;AAED,cAAI7nB,OAAMuC,OAAO0hC,SAAS9nC,EAAE+kD,aAAa/kD,EAAE+kD,YAAYJ,WAAW,KAAK;AACtE;AAAA,UACA;AAED7jD,eAAKujD,UAAUW,kBAAkBf,aAAajkD;AAE9Cc,eAAKujD,UAAUY,yBAAyB,EAAA,GACpChf,yBAAoCjmC,GAAGklD,uBAAkCrlD,GAC5EtF,CAAAA,GAAAA,OAAOyF,EAAEI,OAAOvG,aAChBW,QAAQwF,EAAEI,OAAOtG,aAAAA;AAGlB,cAAI+J,OAAMuC,OAAO0hC,OAAO;AACvBhnC,iBAAK4jD,eAAAA;AACL5jD,iBAAK0jD,oBAAoB94C,WAAW+4C,KAAW,WAC9C;AAAA,kBAAG5gD,OAAMwK,SAAAA,EAAW0nC,UAAS;AAC5B;AAAA,cACA;AACDj1C,mBAAKqkD,UAAUtlD,KAAKG,GAAGrE,KAAAA;AAAAA,YACvB,GAAEmF,IAAO+C,GAAAA,OAAMuC,OAAOg/C,UAAAA;AAAAA,UACvB,OACI;AACJtkD,iBAAKqkD,UAAUtlD,KAAKG,GAAGrE,KACvB;AAAA,UAAA;AAAA,QACN,GAAOmF,IAAO8jD,GAAAA,WAAAA;AACV,YAAIj/C,eAAezM,SAASD;AAC5B4K,QAAAA,OAAM1D,MAAMwF,cAAchK,MAAMmuB,IAAI26B,KAAW,SAAUzkD;AACxD,cAAIrE,CAAAA,MAAMmpD,SAAS9kD,CAAAA,GAAG;AACrB;AAAA,UACA;AACDc,eAAK4jD,eAAAA;AAAAA,QACV,GAAO5jD,IAAO8jD,GAAAA,WAAAA;AAAAA,MAEV,GAAE9jD,IAhDH,EAgDUwjD,aAAa1nD,CAAAA,CAAAA;AAAAA,IACvB;AAAA,EACD;AAEDonD,EAAAA,KAAIvnD,YAAY,EACf4oD,iBAAiB,SAAU1vB,YAAY2vB;AACtC,QAAIC,YAAYd,KAAW,SAAUzkD,GACpC;AAAA,aAAOc,KAAK0kD,SAAS7vB,YAAY31B,GAAGslD,YAAYR,QAAAA;AAAAA,IAChD,GAAEhkD,IACH2jD;AAAAA,SAAW,SAAUzkD,GAAAA;AACpB,aAAOc,KAAK2kD,WAAW9vB,YAAY31B,CAAAA;AAAAA,IACnC,GAAEc,IAAAA;AAEH,QAAI4kD,oBAAoBjB,KAAW,SAAUzkD,GAAAA;AAC5C,UAAIc,KAAKsF,OAAOu/C,WAAWC,QAAc9kD,KAAKsF,OAAOy/C,qBAAqB;AACzE,YAAA,CAAKx6C,aAAQvK,MAAMA,KAAKsF,OAAOy/C,kBAAAA,EAC9B;AAAA,MACD;AAED,UAAIC,YAAYP,UAAUvlD,CAE1B;AAAA,UAAI8lD,WAAW;AACd;AACC,cAAI9lD,KAAKA,EAAE0rB,kBAAkB1rB,EAAE+lD,YAAW;AACzC/lD,cAAE0rB,eAAAA;AAAAA,UACF;AAAA,QACD,SAAO1rB;QAEP;AAAA,MAGD;AAED,aAAO8lD;AAAAA,IACP,GAAEhlD,IAAAA;AACH,QAAI6E,eAAeC,YAAuB/B,OAAMgC,KAAAA;AAChD,QAAImgD,qBAAqBllD,KAAKsF,OAAO4/C,sBAAsBpgD,YAAuB/B,OAAMgC,KAExF;AAAA,QAAI++C,cAAc,EAACC,SAAS;AAC5B,QAAIoB,UAAUxB,KAAW,SAAUzkD,GAAAA;AAClC6D,MAAAA,OAAMqvB,YAAY8yB,oBAAoBV,YAAYtb,MAAM0b,iBACxD7hD;AAAAA,MAAAA,OAAMqvB,YAAYvtB,cAAc2/C,YAAYx7B,IAAIm8B,SAASrB,WAAAA;AACzD,aAAO9jD,KAAKiF,QAAQ4vB,UAAAA;AAAAA,IACpB,GAAE70B,IAEH+C;AAAAA,IAAAA,OAAM1D,MAAM6lD,oBAAoBV,YAAYtb,MAAM0b,mBAAmBd,WAAAA;AACrE/gD,IAAAA,OAAM1D,MAAMwF,cAAc2/C,YAAYx7B,IAAIm8B,SAASrB,WAAAA;AAAAA,EACnD,GACDsB,qBAAqB,SAAUn5C,KAAAA;AAC9B,QAAIo5C,SAASp5C,IAAIzS,IAAIwG,KAAKsF,OAAO2G,IAAIzS;AACrC,QAAI8rD,SAASr5C,IAAI5S,IAAI2G,KAAKsF,OAAO2G,IAAI5S;AACrC,QAAIksD,WAAWjsD,KAAKyW,KAAKzW,KAAKksD,IAAIlsD,KAAKkM,IAAI6/C,MAAAA,GAAS,CAAK/rD,IAAAA,KAAKksD,IAAIlsD,KAAKkM,IAAI8/C,MAAS,GAAA,CAAA,CAAA;AAEpF,QAAIC,WAAWvlD,KAAKsF,OAAOmgD,aAAa;AACvC,aAAO;AAAA,IACX,OAAU;AACN,aAAO;AAAA,IACP;AAAA,EACD,GACDC,eAAe;AAEd,QAAIrtB,UAASr4B,KAAKsF,OAAO+yB,SAASjgC,SAASoE,cAAc,KACzD67B;AAAAA,IAAAA,QAAOt7B,YAAY;AAEnBs7B,IAAAA,QAAOh6B,YAAY;AACnBjG,aAASD,KAAKuE,YAAY27B,OAC1B;AAAA,EAAA,GACDstB,mBAAmB,SAAU99B,UAAU+9B,UACtC;AAAA,QAAA,CAAK7iD,OAAMuC,OAAO0hC,OAAO;AACxB;AAAA,IACA;AAGD,QAAI9nC,IAAI0mD,SAAS/9B,QAEjB;AAAA,QAAItmB,KAAKrC,EAAEI,UAAUJ,EAAEK;AACvB,QAAI8E,QAAO9C,GAAGskD,UAAU,IAAA;AAExB7lD,SAAKsF,OAAO4+C,kBAAkBf,aAAajkD,CAAAA;AAC3Cc,SAAKsF,OAAO4+C,gBAAgB5kD,SAAS+E;AACrCrE,SAAKsF,OAAOwgD,iBAAiBvkD;AAC7BA,OAAGhJ,WAAWmE,YAAY2H,KAE1B9C;AAAAA,OAAGvH,MAAMH,UAAU;AACnB,QAAIqrD,qBAAqBllD,KAAKsF,OAAO4/C,sBAAsB9sD,SAASD;AACpE+sD,uBAAmBxoD,YAAY6E,EAAAA;AAAAA,EAC/B,GACDkiD,iBAAiB;AAEhB,QAAID,eAAe;AAEnBA,iBAAaxkD,KAAK,EACjBkqC,MAAQ,aACRjgB,MAAQ,aACRD,IAAM,WACNg7B,UAAY,SAAU9kD,GAAAA;AACrB,aAAOA;AAAAA,IACP,EAAA,CAAA;AAGF,QAAI6D,OAAMuC,OAAO0hC,OAAO;AAEvB,UAAI+e,uBAAuB;AAC3B,UACC3tD;AAAAA,iBAASouC,YAAY,YAAA;AAAA,MACrB,SAAOtnC;AACP6mD,+BAAuB;AAAA,MACvB;AAED,UAAGA,sBAAqB;AACvBvC,qBAAaxkD,KAAK,EACjBkqC,MAAQ,aACRjgB,MAAQ,cACRD,IAAM,YACNg7B,UAAY,SAAUvjD,IACrB;AAAA,cAAIA,GAAGulD,WAAWvlD,GAAGulD,QAAQjqD,SAAS,EAAG,QAAO;AAChD,cAAI0E,GAAGulD,QAAQ,CACd,EAAA,QAAO,EACN1mD,QAAQlH,SAAS6tD,iBAAiBxlD,GAAGulD,QAAQ,GAAGrlD,SAASF,GAAGulD,QAAQ,CAAA,EAAGplD,OACvEwiD,GAAAA,OAAO3iD,GAAGulD,QAAQ,CAAA,EAAG5C,OACrBC,OAAO5iD,GAAGulD,QAAQ,GAAG3C,OACrB1iD,SAASF,GAAGulD,QAAQ,CAAGrlD,EAAAA,SACvBC,SAASH,GAAGulD,QAAQ,GAAGplD,QAGxB;AAAA,cAAA,QAAOH;AAAAA,QACR,EAEP,CAAA;AAAA,MAAA,WAAakC,MAAOg1C,UAAUuO,gBAAe;AACxC1C,qBAAaxkD,KAAK,EACjBkqC,MAAQ,eACRjgB,MAAQ,eACRD,IAAM,aACNg7B,UAAY,SAAUvjD,IACrB;AAAA,cAAIA,GAAG0lD,eAAe,QAAS,QAAO;AACtC,iBAAO1lD;AAAAA,QACP,EAGP,CAAA;AAAA,MAAA,WAAckC,MAAOg1C,UAAUyO,kBAAiB;AAC3C5C,qBAAaxkD,KAAK,EACjBkqC,MAAQ,iBACRjgB,MAAQ,iBACRD,IAAM,eACNg7B,UAAY,SAAUvjD,IACrB;AAAA,cAAIA,GAAG0lD,eAAe1lD,GAAG4lD,qBAAsB,QAAO;AACtD,iBAAO5lD;AAAAA,QACP,EAAA,CAAA;AAAA,MAEF;AAAA,IACD;AAED,WAAO+iD;AAAAA,EACP,GACDI,gBAAgB,WAAA;AACf,QAAI5jD,KAAK0jD,mBAAmB;AAC3B74C,mBAAa7K,KAAK0jD,iBAClB1jD;AAAAA,WAAK0jD,oBAAoB;AAAA,IACzB;AAAA,EACD,GACDW,WAAW,SAAUtlD,KAAKG,GAAGslD;AAC5B,QAAIxkD,KAAKsF,UAAUtF,KAAKsF,OAAOu/C,SAAS;AACvC;AAAA,IACA;AACD7kD,SAAKsF,SAAS,EACbvG,KACAs5B,QAAQ,MACRwsB,SAAS,OACT54C,KAAKjM,KAAKsmD,YAAYpnD,CACtBumD,GAAAA,aAAa;AAEd,QAAIzlD,KAAKujD,UACRgD,OAAYvmD,KAAKsF,QAAQtF,KAAKujD,WAAW,IAAA;AAG1CvjD,SAAKukD,gBAAgBxlD,KAAKylD,WAE1BzhD;AAAAA,IAAAA,OAAMyjD,wBAAwB;AAC9BpuD,aAASD,KAAKyF,UAAU0O,IAAI,gBAAA;AAE5B,QAAIvJ,OAAMuC,OAAO0hC,OAAO;AACvBhnC,WAAK0kD,SAAS3lD,KAAKG,GAAGslD,YAAYR,QAAAA;AAAAA,IAClC;AAAA,EAED,GACDU,UAAU,SAAU3lD,KAAKG,GAAG0mD,UAAAA;AAC3B,QAAIllC,SAASklC,SAAS1mD,CAAAA;AACtB,SAAKwhB,OAAQ,QAAO;AAEpB,QAAA,CAAK1gB,KAAKsF,OAAO+yB,WAAWr4B,KAAKsF,OAAOu/C,SAAS;AAChD,UAAI54C,MAAMjM,KAAKsmD,YAAY5lC,MAE3B;AAAA,UAAI3d,OAAMuC,OAAO0hC,SAAShnC,KAAKolD,oBAAoBn5C,MAAM;AAGxDjM,aAAKsF,OAAOu/C,UAAU;AACtB7kD,aAAKsF,OAAOhC,SAAS;AACrBP,QAAAA,OAAM0jD,cAAc;AACpB,YAAIzmD,KAAK+H,UAAU,qBAAqB,CAAChJ,KAAKiB,KAAKsF,OAAO4+C,eAAsB,CAAA,MAAA,OAAO;AACtFlkD,eAAKsF,OAAOhC,SAAS;AACrB,iBAAO;AAAA,QACP;AACDtD,aAAK2lD,kBAAkBzmD,GAAG0mD,QAAAA;AAC1B5lD,aAAK0lD,cAAAA;AACL3iD,QAAAA,OAAM2jD,gBACN1mD;AAAAA,aAAK+H,UAAU,oBAAoB,CAAChJ,KAAKiB,KAAKsF,OAAO4+C,eAC1D,CAAA;AAAA,MAAA,OAAW;AACNlkD,aAAKsF,OAAOhC,SAAS;AAAA,MACrB;AAAA,IACD;AAED,QAAKtD,CAAAA,KAAKsF,OAAOhC,QAAQ;AAExB,UAAIpE,EAAEynD,iBAAkBjmC,CAAAA,OAAOphB,OAAQ;AAEvCohB,aAAOzU,MAAMjM,KAAKsmD,YAAY5lC;AAC9B1gB,WAAKsF,OAAO+yB,OAAOr+B,MAAMlC,OAAO4oB,OAAOzU,IAAIzS,IAAI;AAC/CwG,WAAKsF,OAAO+yB,OAAOr+B,MAAMnC,MAAM6oB,OAAOzU,IAAI5S,IAAI;AAC9C2G,WAAK+H,UAAU,cAAc,CAAChJ,KAAK2hB;AACnC,aAAO;AAAA,IACP;AACD,WAAO;AAAA,EACP,GAEDzb,SAAS,SAAUlG,KAAAA;AAClB,QAAIO,SAASU,KAAKsF,OAAOwgD;AACzB,QAAIxmD,UAAUA,OAAO/G,YAAY;AAChC+G,aAAO/G,WAAWqE,YAAY0C;IAC9B;AACDyD,IAAAA,OAAMyjD,wBAAwB;AAC9B,QAAIxmD,KAAKsF,OAAO+yB,QAAQ;AACvBr4B,WAAKsF,OAAO+yB,OAAO9/B,WAAWqE,YAAYoD,KAAKsF,OAAO+yB,MAAAA;AACtDr4B,WAAKsF,OAAO+yB,SAAS;AAErBr4B,WAAK+H,UAAU,aAAa,CAC5B,CAAA;AAAA,IAAA;AACD/H,SAAKsF,OAAOu/C,UAAU;AACtB9hD,IAAAA,OAAM0jD,cAAc;AACpBruD,aAASD,KAAKyF,UAAU2S,OAAO,gBAC/B;AAAA,EAAA,GAED+1C,aAAa,SAAUpnD,GAAAA;AACtB,QAAI1F,IAAI,GAAGH,IAAI;AACf,QAAI6F,EAAEkkD,SAASlkD,EAAEmkD,OAAO;AACvB7pD,UAAI0F,EAAEkkD;AACN/pD,UAAI6F,EAAEmkD;AAAAA,IACN,WAAUnkD,EAAEyB,WAAWzB,EAAE0B,SAAS;AAClCpH,UAAI0F,EAAEyB,UAAUvI,SAASD,KAAKQ,aAAaP,SAASE,gBAAgBK;AACpEU,UAAI6F,EAAE0B,UAAUxI,SAASD,KAAKK,YAAYJ,SAASE,gBAAgBE;AAAAA,IACnE;AACD,WAAO,EAACgB,GAAMH,EACd;AAAA,EAAA,EAAA;AAGF,SAAO6pD;AACR;ACpVe,SAAQhuC,UAACnS,QAAAA;AAEvB,MAAI6jD,eAAe,CAAA;AAEnB,WAASC,aAAaxpD,MAAMypD,SAASC,eACpCA;AAAAA,oBAAgBA,iBAAiB1pD;AACjC,QAAIiI,UAASvC,OAAMuC,QAClB4P,aAAYnS,OAAMmS;AAEnB,QAAInS,OAAMuC,OAAOjI,IAAAA,KAASupD,aAAaG,aAAAA,KAAkBzhD,QAAOjI,IAAAA,GAAO;AACtE,UAAMypD,EAAAA,WAAW5xC,WAAU6xC,aAAAA,IAAiB;AAC3C7xC,QAAAA,WAAU6xC,iBAAiBhkD,OAAMsP,KAAKqD,YAAYpQ,QAAOjI,IAAAA,CAAAA;AACzDupD,qBAAaG,aAAiBzhD,IAAAA,QAAOjI,IACrC;AAAA,MAAA;AAAA,IACD;AAAA,EACD;AAED,WAAS2pD,gBACR;AAAA,QAAI30C,QAAOtP,OAAMsP;AAGjB,QAAI3R,IAAI2R,MAAKqD;AACb,QAAIuxC,IAAIlkD,OAAMuC;AACd,QAAI+P,cAAc3U,EAAEumD,EAAE1xC,YAAY0xC,EAAE10C,aAAa00C,EAAEhU,UAAAA;AACnD,QAAIiN,aAAa7tC,MAAKC,YAAY20C,EAAE1xC,YAAY0xC,EAAE10C,aAAa00C,EAAEhU,UAEjE4T;AAAAA,iBAAa,cAAc,MAAMxmD,QAAW0C,OAAMuC,QAAQvC,OAAMmS,SAAAA;AAChE2xC,iBAAa,aAAa,MAAM,oBAAoB9jD,OAAMuC,QAAQvC,OAAMmS,SACxE2xC;AAAAA,iBAAa,aAAa,MAAMxmD,QAAW0C,OAAMuC,QAAQvC,OAAMmS,SAAAA;AAE/DnS,IAAAA,OAAMyP,MAAMzP,OAAMmS,WAAW,EAC5BC,YAAY9U,QACZgV,aAEAE,UAAUlV,QACV6/C,YAEAgH,eAAe,SAAUr7C,OAAOC,KAAKqC,MACpC;AAAA,aAAO;AAAA,IACP,GACDg5C,mBAAmB,SAAUxxB,QAAQrwB,SACpC;AAAA,aAAO;AAAA,IACP,GAEDgW,WAAW,SAAUzP,OAAOC,KAAKqC,MAAAA;AAChC,aAAOA,KAAKkN;AAAAA,IACZ,GACD+rC,YAAY,SAAUv7C,OAAOC,KAAKqC,MACjC;AAAA,aAAO;AAAA,IACP,GACDk5C,eAAe,SAAUh1C,OAAAA;AACxB,aAAOtP,OAAMmS,UAAUq/B,UAAUliC,KAAAA;AAAAA,IACjC,GACDi1C,gBAAgB,SAAUz7C,OAAOC,KAAKqC,MAAAA;AACrC,aAAO;AAAA,IACP,GACDo5C,gBAAgB,SAAU17C,OAAOC,KAAKqC;AACrC,aAAO;AAAA,IACP,GACD0Q,qBAAqB,SAAUjV,MAAMyI,OAAAA;AACpC,aAAO;AAAA,IACP,GACDm1C,uBAAuB,SAAU59C,MAAMyI,OAAAA;AACtC,aAAO;AAAA,IACP,GACDo1C,kBAAkB,SAAUp1C,OAC3B;AAAA,aAAO;AAAA,IACP,GACDq1C,iBAAiB,SAAUr1C,OAAAA;AAC1B,aAAO;AAAA,IACP,GAEDs1C,aAAa,SAAU/9C,MAAAA;AACtB,aAAO;AAAA,IACP,GACDg+C,aAAa,SAAUh+C,MACtB;AAAA,aAAO,+CAA+CA,KAAKyT,QAAQ,SAAS,YAAY;AAAA,IACxF,GACDwqC,WAAW,SAAUj+C,MAAAA;AACpB,aAAO;AAAA,IACP,GACDk+C,WAAW,SAAUl+C,MAAAA;AACpB,aAAO,wCAAwCA,KAAKyT,QAAQ,UAAU,UAAU;AAAA,IAChF,GACD0qC,YAAY,SAAUn+C,MACrB;AAAA,aAAO;AAAA,IACP,GACDwT,WAAW,SAAU/K,OAAMzI,MAAM+rB,QAAAA;AAChC,UAAI/rB,QAAQ7G,OAAMilD,kBAAkBp+C,IAAAA,KAAS7G,OAAMuC,OAAO+wC,kBAAkB;AAC3E,eAAOtzC,OAAMmS,UAAU+yC,sBAAsBr+C,IAClD;AAAA,MAAA,OAAW;AACN,eAAO7G,OAAMmS,UAAUgzC,iBAAiB71C,OAAMsjB,MAAAA;AAAAA,MAC9C;AAAA,IACD,GAED4M,WAAW,SAAU12B,OAAOC,KAAKrL,IAAAA;AAChC,UAAIsC,OAAMilD,kBAAkBvnD,OAAOsC,OAAMuC,OAAO+wC,kBAAkB;AACjE,eAAOtzC,OAAMmS,UAAU+yC,sBAAsBxnD,EAAAA;AAAAA,MAClD,OAAW;AACN,eAAOsC,OAAMmS,UAAUq/B,UAAU1oC,KAAAA,IAAS,QAAQ9I,OAAMmS,UAAUmyC,cAAcv7C,GAAAA;AAAAA,MAChF;AAAA,IACD,GAEDm8C,uBAAuB,SAAU95C,MAAAA;AAChC,aAAO;AAAA,IACP,GAEDqmC,aAAa9zC,EAAEumD,EAAEzS,WACjB2T,GAAAA,YAAY,SAAU3nC,MAAAA;AACrB,aAAO;AAAA,IACP,GACD4nC,kBAAkB,SAAU5nC,MAAAA;AAC3B,UAAI6nC,OAAOtlD,OAAMmc,QAAQsB,KAAKE,MAC7B4nC,GAAAA,KAAKvlD,OAAMmc,QAAQsB,KAAKlhB;AAEzB,aAAO,QAAQ+oD,KAAKhtC,OAAO,sBAAsBitC,GAAGjtC,OAAO;AAAA,IAC3D,GAEDktC,WAAW,SAAUF,MAAMG,YAAYF,IAAIG,UAC1CJ;AAAAA,aAAOtlD,OAAMmc,QAAQmpC,IAAAA;AACrB,UAAIjyC,SAASrT,OAAMoT,OAAOC;AAE1B,UAAIiF,OAAO,QAAQgtC,KAAKhtC,OAAO,WAAWmtC,aAAapyC,OAAOsyC,aAAatyC,OAAOuyC,YAAY;AAC9F,UAAIL,IAAI;AACPA,aAAKvlD,OAAMmc,QAAQopC;AACnBjtC,gBAAQ,SAASitC,GAAGjtC,OAAO,WAAWotC,WAAWryC,OAAOsyC,aAAatyC,OAAOuyC,YAAY;AAAA,MACxF;AACD,aAAOttC;AAAAA,IACP,GACDutC,iBAAiB,SAAUP,MAAMG,YAAYF,IAAIG,UAChD;AAAA,UAAIn8C,MAAM;AAEV,UAAI+7C,QAAQC,IAAI;AACf,YAAIO,UAAU9lD,OAAM+lD,cAAcT,MAAMC,IAAIE,YAAYC,QAAAA;AACxDn8C,cAAM,OAAOu8C,UAAU,qBAAqB;AAAA,MAC5C;AAED,aAAO,uBAAuBv8C;AAAAA,IAC9B,GAGDy8C,qBAAqB12C,MAAKqD,YAAY,aACtCyxB,cAAc,SAAUt7B,OAAOC,KAAKzM,QAAAA;AACnC,aAAO,cAAcA,OAAMgc,IAAAA;AAAAA,uBACRtY,OAAMmS,UAAU6zC,oBAAoBl9C;qBACtC9I,OAAMmS,UAAU6zC,oBAAoBj9C,GACrD,CAAA;AAAA,IAAA,GACDk9C,eAAe,SAAU76C,MAAM86C,UAAUziD;AACxC,aAAO;AAAA,IACP,EAEF,CAAA;AAAA,EAAA;AAED,SAAO,EACNwgD,eACAH,aAGF;AAAA;AC5JA,IAAIqC;AACH,MAAIC,iBAAiB,CAAA;AAErB,WAAS57C,SAASlQ,MACjB;AAAA,QAAI+rD,WAAWD,eAAe9rD,IAC9B;AAAA,QAAG+rD,UAAS;AACX,aAAOD,eAAe9rD,IAAAA,EAAMmE,OAC/B;AAAA,IAAA,OAAO;AACJ,UAAI+gB,MAAM,CAAA;AACV,eAAQzmB,KAAKqtD,gBAAe;AAC3B,aAAIA,eAAertD,CAAAA,EAAGutD,SACrB9C,OAAYhkC,KAAK4mC,eAAertD,CAAAA,EAAG0F,OAAU,GAAA,IAAA;AAAA,MAC9C;AACD,aAAO+gB;AAAAA,IACP;AAAA,EACD;AAED,WAASxe,iBAAiB1G,MAAM+rD,UAAUC,UAAAA;AACzCF,mBAAe9rD,IAAAA,IAAQ,EAAEmE,QAAQ4nD,UAAUC,SAAUA;AAAAA,EACrD;AAED,WAASxjD,mBAAmBxI;WACpB8rD,eAAe9rD,IAAAA;AAAAA,EACtB;AAED,SAAO,EACNkQ,UACAxJ,kBACA8B,mBAED;AAAA;AC/BD,MAAAyjD,YAAe9O;ACEf,IAAI+O,6BAA6B,WAChC;AAAA,SAAO,EACPrqC,SAAS,SAAUjY;AAClBA,SAAK+D,mBAAmB/D,IAAIjH,KAAKsF,OAAOuV,OACxC7a;AAAAA,SAAKotC,OAAOnmC,IAAI;AAChB,QAAIkH,OAAOnO,KAAK81B,MAAMC,WAAW4D,QAAQ1yB;AACzCjH,SAAKotC,OAAOj/B,MAAM,uBAAuBlH,EACzC;AAAA,WAAOkH;AAAAA,EACP,GACDR,eAAe,SAAU06C,MAAMC,IAAAA;AAC9B,QAAIp0B,IAAIl0B,KAAK81B,MAAMC,WAAWqE,SAE9B;AAAA,QAAI7X,MAAM,CAEV;AAAA,QAAA,EAAM8lC,QAAQC,KAAK;AAClB/lC,YAAM2R;AAAAA,IACT,OAAS;AACNm0B,aAAQA,CAAAA,QAAAA;AACRC,WAAAA,CAAMA,MAAMhpC;AACZ,eAASpG,KAAI,GAAGA,KAAIgb,EAAEn4B,QAAQmd,MAAI;AACjC,YAAI/K,OAAO+lB,EAAEhb,EACb;AAAA,YAAA,CAAK/K,KAAKgE,aAAam2C,MAAOn6C,CAAAA,KAAKiE,WAAWi2C,KAC7C9lC,KAAIvjB,KAAKmP,IAAAA;AAAAA,MACV;AAAA,IACD;AACD,WAAOoU;AAAAA,EACP,GACD9B,cAAc,SAAUxZ,IAAAA;AACvB,SAAIjH,KAAK81B,SAAAA,CAAU91B,KAAK81B,MAAMC,YAAW;AACxC,aAAO;AAAA,IACP;AACD,WAAO/1B,KAAK81B,MAAMC,WAAWgE,OAAO9yB,EAAAA;AAAAA,EACpC,GACDkqB,YAAY,SAAUlqB,IAAI2C;AACzB,QAAKk7C,CAAAA,QAAcl7C,MAAOA,QAAO5J,KAAKkf,QAAQjY,EAC9CjH;AAAAA,SAAK81B,MAAMC,WAAWyzB,WAAWviD,IAAI2C;AACrC,QAAG5J,KAAKygB,aAAaxZ,EAAAA,EACpBjH,MAAKi8B,YAAYh1B;EAClB,GACDwiD,SAAS,SAAU7/C,MAAM9I,QAAQ0F,OAAAA;AAChC,SAAKs+C,QAAcl7C,KAAK3C,IACvB2C,MAAK3C,KAAKyiD;AAGX,QAAI1pD,KAAKygB,aAAa7W,KAAK3C,EAAI,GAAA;AAC9B,UAAIkH,OAAOnO,KAAKkf,QAAQtV,KAAK3C,EAC7B;AAAA,UAAIkH,KAAK07B,UAAUjgC,KAAKigC,QAAQ;AAG/B,YAAIjgC,KAAKuI,qBAAqBvI,KAAKuI,eAAe,UAAS;AAC1DvI,eAAKuI,aAAanS,KAAKqS,KAAK4tC,UAAUr2C,KAAKuI,YAAY,YAAA;AAAA,QACvD;AACD,YAAIvI,KAAKwI,YAAmBxI,OAAAA,KAAKwI,aAAa,UAAS;AACtDxI,eAAKwI,WAAWpS,KAAKqS,KAAK4tC,UAAUr2C,KAAKwI,UAAU,YACnD;AAAA,QAAA;AAED,eAAOpS,KAAK81B,MAAMC,WAAWyzB,WAAW5/C,KAAK3C,IAAI2C,IAAAA;AAAAA,MACjD;AAAA,IACD;AAGD,SAAKk7C,QAAchkD,MAAAA,EAASA,UAASd,KAAK8uB,UAAUllB,SAAS;AAC7D,QAAA,CAAK5J,KAAKygB,aAAa3f,MAASA,EAAAA,UAASd,KAAKsF,OAAOuV;AACrD7a,SAAK2pD,UAAU//C,MAAM9I;AAGrB,QAAId,KAAKuN,SAAW0nC,EAAAA,YAAYj1C,KAAKygB,aAAa3f,SAAS;AAC1D,UAAI8oD,YAAY5pD,KAAKkf,QAAQpe,MAAAA;AAC7Bd,WAAK+H,UAAU,uBAAuB,CAACjH,QAAQ8oD,SAC/C,CAAA;AAAA,IAAA;AACD,WAAO5pD,KAAK81B,MAAMC,WAAW8D,QAAQjwB,MAAMpD,OAAO1F,MAClD;AAAA,EAAA,GACD+oD,YAAY,SAAU5iD,IACrBA;AAAAA,SAAK+D,mBAAmB/D,IAAIjH,KAAKsF,OAAOuV,OACxC;AAAA,WAAO7a,KAAK81B,MAAMC,WAAWiE,WAAW/yB,EAAAA;AAAAA,EACxC,GACD2H,cAAc;AACb,WAAO5O,KAAK81B,MAAMC,WAAW+zB,MAAAA;AAAAA,EAC7B,GACDz8B,qBAAqB,WAAA;AACpB,WAAOrtB,KAAK81B,MAAMC,WAAWg0B;EAC7B,GACDv7B,cAAc,SAAUvnB,IAAAA;AACvB,WAAOjH,KAAK81B,MAAMC,WAAWi0B,eAAe/iD,EAC5C;AAAA,EAAA,GACDynB,oBAAoB,SAAUznB;AAC7BA,SAAK+D,mBAAmB/D,IAAIjH,KAAKsF,OAAOuV;AACxC7a,SAAKotC,OAAOnmC,IAAI,kBAAA;AAChB,WAAOjH,KAAK81B,MAAMC,WAAWk0B,aAAahjD;EAC1C,GACD2M,UAAU,SAAU+G,MAAM7Z,QAAQ8Z,QACjC;AAAA,WAAO5a,KAAK81B,MAAMC,WAAWm0B,SAASvG,KAAWhpC,MAAMC,UAAQ5a,IAAAA,GAAOc;EACtE,GACDqpD,YAAY,SAAUriD,UAAUsiD,WAAWxvC,QAAAA;AAC1C,WAAO5a,KAAK81B,MAAMC,WAAWo0B,WAAWxG,KAAW77C,UAAU8S,UAAU5a,IAAOoqD,GAAAA,SAAAA;AAAAA,EAC9E,GACDC,cAAc,SAAUC,OAAOC;AAC9BvqD,SAAK81B,MAAMC,WAAWy0B,SAASF,OAAOC;AACtC,QAAIp8C,OAAOnO,KAAK81B,MAAMC,WAAW4D,QAAQ4wB;AAEzC,QAAI5sC,QAAQ,CAEZ;AAAA,QAAIxP,KAAKs+B,SAAS;AACjB9uB,cAAQA,MAAMzV,OAAOiG,KAAKs+B,OAC1B;AAAA,IAAA;AACD,QAAIt+B,KAAKu+B,SAAS;AACjB/uB,cAAQA,MAAMzV,OAAOiG,KAAKu+B,OAAAA;AAAAA,IAC1B;AAED,aAAS5wC,IAAI,GAAGA,IAAI6hB,MAAM5hB,QAAQD,KAAK;AACtC,UAAI0kB,OAAOxgB,KAAKgqC,QAAQrsB,MAAM7hB,CAAAA,CAAAA;AAC9B,UAAI0kB,KAAKE,UAAU4pC,OAAO;AACzB9pC,aAAKE,SAAS6pC;AAAAA,MACd;AACD,UAAI/pC,KAAKlhB,UAAUgrD,OAAO;AACzB9pC,aAAKlhB,SAASirD;AAAAA,MACd;AAAA,IACD;AAAA,EACD,GACDxuB,oBAAoB,SAAUnyB,MAC7B;AAAA,WAAO5J,KAAK81B,MAAMC,WAAW00B,mBAAmB7gD;EAChD,GACDknB,SAAS,SAAU7pB,IAClB;AAAA,WAAOjH,KAAK81B,MAAMC,WAAWjF,QAAQ7pB,EAAAA;AAAAA,EACrC,GACD2pB,SAAS,SAAU3pB,IAClB;AAAA,WAAOjH,KAAK81B,MAAMC,WAAWnF,QAAQ3pB;EACrC,GACD6nB,WAAW,SAAU7nB,IAAAA;AACpB,WAAOjH,KAAK81B,MAAMC,WAAWjH,UAAU7nB;EACvC,GACD0iD,WAAW,SAAUx7C,MAAMu8C,SAASpvB,QACnC;AAAA,WAAOt7B,KAAK81B,MAAMC,WAAW4zB,UAAUx7C,MAAMu8C,SAASpvB,MAAAA;AAAAA,EACtD,GACDqvB,aAAa,SAAU1jD,IACtB;AAAA,WAAOjH,KAAK81B,MAAMC,WAAW40B,YAAY1jD,IAAIrL,MAC7C;AAAA,EAAA,GACDgvD,gBAAgB,SAAU3jD,IAAAA;AACzB,WAAOjH,KAAK81B,MAAMC,WAAW60B,eAAe3jD,EAC5C;AAAA,EAAA,GACDgqB,gBAAgB,SAAUhqB,IAAAA;AACzB,WAAOjH,KAAK81B,MAAMC,WAAW9E,eAAehqB,EAC5C;AAAA,EAAA,GACDmH,gBAAgB,SAAS5H,OACxB;AAAA,QAAIS,KAAKjH,KAAK81B,MAAMC,WAAW80B,aAAarkD,KAAAA;AAC5C,QAAGxG,KAAKygB,aAAaxZ,EAAI,GAAA;AACxB,aAAOjH,KAAKkf,QAAQjY,EACvB;AAAA,IAAA,OAAO;AACJ,aAAO;AAAA,IACP;AAAA,EACD,GACD8T,aAAa,SAAU9T,IAAAA;AACtB,QAAIjH,CAAAA,KAAKib,SAAShU,EAAI,GAAA;AACrB,aAAO,CACV;AAAA,IAAA,OAAO;AACJ,aAAOjH,KAAK81B,MAAMC,WAAWhb,YAAY9T,EAAAA,EAAIrL;IAC7C;AAAA,EACD,GACDqf,UAAU,SAAUhU,IACnB;AAAA,WAAOjH,KAAK81B,MAAMC,WAAW9a,SAAShU,EAAAA;AAAAA,EACtC,GACD2Q,MAAM,SAAU3Q,IACfjH;AAAAA,SAAK81B,MAAMC,WAAWne,KAAK3Q;EAC3B,GACD8pB,OAAO,SAAU9pB,IAAAA;AAChBjH,SAAK81B,MAAMC,WAAWhF,MAAM9pB,EAAAA;AAAAA,EAC5B,GACDiqB,UAAU,SAAU45B,KAAKxf,QAAQxqC,QAChCA;AAAAA,aAASkK,mBAAmBlK,QAAQd,KAAKsF,OAAOuV;AAChD,WAAO7a,KAAK81B,MAAMC,WAAWmT,KAAKjpC,MAAMD,KAAK81B,MAAMC,YAAYnvB,SAAAA;AAAAA,EAC/D,GACD3K,MAAM,SAAS8uD,OAAOC,MAAMlqD,QAAQw6B,QAAAA;AACnC,QAAI51B,SAAAA,CAAU41B;AAEdt7B,SAAK81B,MAAMC,WAAW95B,KAAK8uD,OAAOC,MAAMlqD;AACxCd,SAAK+H,UAAU,eAAe,CAACgjD,OAAOC,MAAMlqD,MAE5C,CAAA;AAAA,QAAI4E,QAAQ;AACX1F,WAAK0F,OAAAA;AAAAA,IACL;AAAA,EACD,EAEF;AAAA;ACtLA,IAAIulD,yBAAyB,WAAA;AAC5B,SAAO,EACPC,cAAc,WACb;AAAA,WAAOlrD,KAAK81B,MAAMq1B,WAAWrB,MAC7B;AAAA,EAAA,GAED9f,SAAU,SAAU/iC,IAAAA;AACnB,WAAOjH,KAAK81B,MAAMq1B,WAAWxxB,QAAQ1yB,EACrC;AAAA,EAAA,GAEDmjC,UAAW,WACV;AAAA,WAAOpqC,KAAK81B,MAAMq1B,WAAW/wB,SAAAA;AAAAA,EAC7B,GAEDgxB,cAAe,SAAUnkD,IACxB;AAAA,WAAOjH,KAAK81B,MAAMq1B,WAAWpxB,OAAO9yB,EAAAA;AAAAA,EACpC,GAEDokD,SAAU,SAAU7qC;AACnB,UAAM8qC,UAAUtrD,KAAK81B,MAAMq1B,WAAWtxB,QAAQrZ;AAE9C,QAAIxgB,KAAK81B,MAAMq1B,WAAWI,SAAAA,GAAW;AACpCvrD,WAAK81B,MAAMq1B,WAAWK,UAAUxsD,KAAKssD,OAAAA;AAAAA,IACrC;AACD,WAAOA;AAAAA,EACP,GAEDG,YAAa,SAAUxkD,IAAIwL,OAC1B;AAAA,QAAA,CAAKqyC,QAAcryC,KAAAA,EAClBA,CAAAA,QAAOzS,KAAKgqC,QAAQ/iC,EACrBjH;AAAAA,SAAK81B,MAAMq1B,WAAW3B,WAAWviD,IAAIwL;EACrC,GAEDi5C,YAAa,SAAUzkD,IAAAA;AACtB,WAAOjH,KAAK81B,MAAMq1B,WAAWnxB,WAAW/yB;EACxC,GAED0kD,cAAe,SAAUrB,OAAOC,OAAAA;AAC/B,WAAOvqD,KAAK81B,MAAMq1B,WAAWX,SAASF,OAAOC,KAAAA;AAAAA,EAC7C;AAEF;AC1CA,IAAIqB,cAAe,EAClBC,SAAS,SAASzgD,OAAAA;AACjB,SAAOm7C,MAAYn7C,SAAS,CAAIpL,GAAAA,IAAAA;AAChC,GAED8rD,WAAU,SAAS7/C,KAAIpN,KACtB;AAAA,MAAIoN,OAAK,EAAGjM,MAAK3D,OAAO4P,KAAKpN,OAAK,CAAA;AAClC,GAEDktD,SAAQ,SAAShzC,OAAAA;AAChB/Y,OAAK8rD,UAAU9rD,KAAKgsD,MAAMjzC,KAAAA,CAAAA;AAC1B,GAEDkzC,WAAU,SAASx5C,OAAKxG,KAAAA;AACvB,OAAKA,OAAOA,QAAM,EACjBjM,MAAKhB,KAAKyT,KACN;AAAA,OAAA;AACJ,QAAIvW,IAAI8D,KAAK3D,OAAO4P,KAAKjM,KAAKjE,SAAOkQ,GACrCjM;AAAAA,SAAKiM,OAAOwG;AACZzS,SAAKhB,KAAKiB,MAAMD,MAAK9D,CAAAA;AAAAA,EACrB;AACD,GAED8vD,OAAM,SAASv5C,OACd;AAAA,WAAS3W,IAAE,GAAGA,IAAEkE,KAAKjE,QAAQD,IAC5B,KAAI2W,SAAMzS,KAAKlE,CAAI,EAAA,QAAOA;AAC3B,SAAA;AACA,GAEDowD,OAAM,SAAS1oB,SAAQ5oB,QACtB;AAAA,WAAS9e,IAAE,GAAGA,IAAIkE,KAAKjE,QAAQD,IAC9B0nC,SAAQ3nC,KAAM+e,UAAQ5a,MAAMA,KAAKlE,CAAAA,CAAAA;AAClC,GAEDqwD,MAAK,SAAS3oB,SAAQ5oB,QACrB;AAAA,WAAS9e,IAAE,GAAGA,IAAIkE,KAAKjE,QAAQD,IAC9BkE,MAAKlE,CAAG0nC,IAAAA,QAAQ3nC,KAAM+e,UAAQ5a,MAAMA,KAAKlE,CAC1C,CAAA;AAAA,SAAOkE;AACP,GACDosD,SAAQ,SAAS5oB,SAAS5oB,QACzB;AAAA,WAAS9e,IAAE,GAAGA,IAAIkE,KAAKjE,QAAQD,IAC9B,KAAK0nC,CAAAA,QAAQ3nC,KAAM+e,UAAQ5a,MAAMA,KAAKlE,CAAAA,CAAAA,GAAI;AACzCkE,SAAK3D,OAAOP,GAAE,CACdA;AAAAA;AAAAA,EACA;AACF,SAAOkE;AACP,EAAA;AC5Ca,SAASqsD,kBAAkBplD,IAAIlE,QAAO+T,OAAOxR,SAE3D;AAAA,MAAIA,UAASvC,SAAQA,OAAMuC,SAASA;AACpC,MAAIA,WAAUA,QAAOwxB,kBAAkB;AACtC,QAAIhgB,MAAMijB,OAAO9yB,KAAI;AACpB,UAAI2C,OAAOkN,MAAM6iB,QAAQ1yB,EAAAA;AACzB,aAAO2C,KAAKqI,SAAS3M,QAAOqxB,MAAMC;AAAAA,IAClC;AAAA,EACD;AACD,SAAO;AACR;ACTA,IAAI01B,YAAY,SAAShnD;AACxBtF,OAAKusD,OAAO;AACZvsD,OAAKwsD,YAAYlnD,QAAOkzB;AACxBx4B,OAAKysD,eAAeC,YAAWb,QAAAA;AAC/B7rD,OAAKwrD,YAAYkB,YAAWb;AAC5B7rD,OAAK2sD,gBAAgB;AACrB3sD,OAAK4sD,cAAc;AACnB5sD,OAAK6sD,sBAAsB;AAC3B7sD,OAAK8sD,mBAAmB;AACxB9sD,OAAK+sD,iBAAiB;AACtB/sD,OAAKyQ,UAAUnL;AACfoH,gBAAU1M,IAAAA;AAEVA,OAAKgtD,kBAAkB,WAAA;AACtBhtD,SAAK8sD,mBAAmB;AACxB9sD,SAAK+sD,iBAAiB;AACtB,WAAO;AAAA,EACT,CACC;AAAA,SAAO/sD;AACR;AACAssD,UAAU3wD,YAAY,EAErBqxD,mBAAmB,SAASllD,UAC3B9H;AAAAA,OAAKwH,YAAY,cAAcM,QAC/B9H;AAAAA,OAAKwH,YAAY,iBAAiBM,QAAAA;AAClC9H,OAAKwH,YAAY,kBAAkBM,QAAAA;AACnC9H,OAAKwH,YAAY,kBAAkBM,QACnC9H;AAAAA,OAAKwH,YAAY,eAAeM;AAChC9H,OAAKwH,YAAY,WAAWM,QAC5B9H;AAAAA,OAAKwH,YAAY,kBAAkBM,QAAAA;AACnC,GACDmlD,aAAa,SAASx6C,OAAAA;AACrB,MAAI7I,OAAO,MACVsjD,SAAS,CAAA;AACV,WAAQpxD,IAAI,GAAG+C,MAAM4T,MAAK1W,QAAQD,IAAG+C,KAAK/C,KAAI;AAC7C8N,WAAO6I,MAAK3W,CACZ;AAAA,QAAGkE,KAAKwsD,WAAU;AACjB,UAAGxsD,KAAKyQ,QAAQ08C,YAAAA,GAAc;AAC7BvjD,eAAOwjD,KAAWxjD;MAClB;AACDA,aAAO5J,KAAKwsD,UAAU5iD,IAAAA;AAAAA,IACtB;AAED,QAAG5J,KAAK+H,UAAU,iBAAiB,CAAC6B,IAAAA,CAAAA,GAAO;AAC1C,UAAK5J,CAAAA,KAAKusD,KAAKppB,eAAev5B,KAAK3C,EAAK,GAAA;AACvCjH,aAAKwrD,UAAUxsD,KAAK4K,KAAK3C,EAAAA;AAAAA,MACzB;AACDimD,aAAOluD,KAAK4K,IAAAA;AACZ5J,WAAKusD,KAAK3iD,KAAK3C,EAAM2C,IAAAA;AAAAA,IACrB;AAAA,EACD;AACD,SAAOsjD;AACP,GACDx1C,OAAO,SAASjF,OAAAA;AACf,OAAKzS,KAAKurD,SAAAA,GAAY;AACrBvrD,SAAK+H,UAAU,iBAAiB,CAAC0K,KACjC,CAAA;AAAA,EAAA;AACD,MAAIy6C,SAASltD,KAAKitD,YAAYx6C,KAC9B;AAAA,MAAA,CAAKzS,KAAKurD,SAAAA,GAAY;AACrBvrD,SAAKk6B;AACLl6B,SAAK+H,UAAU,WAAW,CAACmlD,MAAAA,CAAAA;AAAAA,EAC3B;AACD,GACDvzB,SAAS,SAAS1yB,IAAAA;AACjB,SAAOjH,KAAKusD,KAAKtlD,EACjB;AAAA,GAEDomD,cAAc,SAAS1yC,MACtBA;AAAAA,OAAK9e,KAAKmE,KAAKysD,YAAAA;AACf9xC,OAAK9e,KAAKmE,KAAKwrD,SAAAA;AACf,GACDhC,YAAY,SAASviD,IAAI2C,MACxB;AAAA,MAAA,CAAKk7C,QAAcl7C,IAAOA,EAAAA,QAAO5J,KAAK25B,QAAQ1yB,EAE9C;AAAA,MAAA,CAAKjH,KAAKurD,SAAY,GAAA;AACrB,QAAIvrD,KAAK+H,UAAU,kBAAkB,CAAC6B,KAAK3C,IAAI2C,IAAAA,CAAAA,MAAW,MAAO,QAAO;AAAA,EACxE;AAGD28C,QAAYvmD,KAAKusD,KAAKtlD,EAAAA,GAAI2C,MAAM,IAChC;AAAA,MAAA,CAAK5J,KAAKurD,SAAAA,GAAY;AACrBvrD,SAAK+H,UAAU,iBAAiB,CAAC6B,KAAK3C,IAAI2C,IAC1C5J,CAAAA;AAAAA,SAAK+H,UAAU,kBAAkB,CAAC6B,KAAK3C,IAAI2C,MAAM,QAAA,CAAA;AAAA,EACjD;AACD,GAED0jD,kBAAkB,SAASrmD,IAG1BjH;AAAAA,OAAKqtD,aAAa,WAAYrtD;AAAAA,SAAK+rD,QAAQ9kD,EAAAA;AAAAA,EAAI,CACxCjH;AAAAA,SAAAA,KAAKusD,KAAKtlD,EACjB;AAAA,GAED+yB,YAAY,SAAS/yB,IAGpB;AAAA,MAAIlI,MAAMiB,KAAK25B,QAAQ1yB,EACvB;AAAA,MAAA,CAAKjH,KAAKurD,SAAAA,GAAY;AACrB,QAAIvrD,KAAK+H,UAAU,kBAAkB,CAAChJ,IAAIkI,IAAIlI,GAAAA,CAAAA,MAAU,MAAO,QAAO;AAAA,EACtE;AAEDiB,OAAK+H,UAAU,0BAA0B,CAAChJ,IAAIkI,IAAIlI,GAAAA,CAAAA;AAClDiB,OAAKstD,iBAAiBrmD,EAAAA;AAEtB,MAAIjH,KAAKurD,SAAY,GAAA;AACpBvrD,SAAK+H,UAAU,uBAAuB,CAAChJ,IAAIkI,IAAIlI;EAC/C;AAED,MAAA,CAAKiB,KAAKurD,SAAAA,GAAY;AACrBvrD,SAAKiiD;AACLjiD,SAAK+H,UAAU,iBAAiB,CAAChJ,IAAIkI,IAAIlI,GAEzCiB,CAAAA;AAAAA,SAAK+H,UAAU,kBAAkB,CAAChJ,IAAIkI,IAAIlI,KAAK,QAAA,CAAA;AAAA,EAC/C;AACD,GAEDwuD,eAAe,SAAS3jD,MAAMpD,OAAAA;AAI7B,MAAGxG,KAAK+5B,OAAOnwB,KAAK3C,KAAI;AACvBjH,SAAKs7B,OAAO,WAAA;AAAWt7B,WAAKwpD,WAAW5/C,KAAK3C,IAAI2C,IAAAA;AAAAA,IAAM,CACzD;AAAA,EAAA,OAAO;AACJ,QAAI4jD,QAAQxtD,KAAKysD;AAGjB,QAAIgB,YAAYD,MAAMzxD;AAEtB,QAAK+oD,CAAAA,QAAct+C,KAAUA,KAAAA,QAAQ,EACpCA,SAAQinD;AAET,QAAIjnD,QAAQinD,WAAU;AAErBjnD,cAAQlN,KAAKyS,IAAIyhD,MAAMzxD,QAAOyK,KAC9B;AAAA,IAAA;AAAA,EACD;AAKDxG,OAAKusD,KAAK3iD,KAAK3C,EAAAA,IAAI2C;AACnB5J,OAAKqtD,aAAa;AACjB,QAAGrtD,KAAKgsD,MAAMpiD,KAAK3C,EAAS,MAAA,GAC3BjH,MAAKisD,UAAUriD,KAAK3C,IAAGT,KAAAA;AAAAA,EAC3B,CACExG;AAAAA,OAAKiiD;AAEL,GAGDtoD,WAAW,SAASsN,IAAAA;AACnB,SAAOjH,KAAKysD,aAAaT,MAAM/kD,EAAAA,IAAAA;AAC/B,GACDymD,iBAAiB;AAChB,SAAO1tD,KAAK2tD,cACZ;AAAA,GAED9zB,SAAS,SAASjwB,MAAMpD,OACvB;AAAA,MAAA,CAAKs+C,QAAcl7C,KAAK3C,EAAAA,EACvB2C,MAAK3C,KAAKyiD,IAAAA;AAEX,MAAG1pD,KAAKwsD,WAAU;AACjB5iD,WAAO5J,KAAKwsD,UAAU5iD;EACtB;AAED,MAAA,CAAK5J,KAAKurD,SAAW,GAAA;AACpB,QAAIvrD,KAAK+H,UAAU,eAAe,CAAC6B,KAAK3C,IAAI2C,IAAW,CAAA,MAAA,MAAO,QAAO;AAAA,EACrE;AAGD5J,OAAKutD,cAAc3jD,MAAMpD,KAAAA;AAEzB,MAAKxG,CAAAA,KAAKurD,YAAW;AACpBvrD,SAAK+H,UAAU,cAAa,CAAC6B,KAAK3C,IAAI2C,IAAAA,CAAAA;AAEtC5J,SAAK+H,UAAU,kBAAiB,CAAC6B,KAAK3C,IAAG2C,MAAK,KAC9C,CAAA;AAAA,EAAA;AACD,SAAOA,KAAK3C;AACZ,GAED2mD,gBAAgB,SAAS52B,OAAOC,OAC/B;AAAA,MAAGj3B,KAAKusD,KAAKv1B,KAAAA,EACZh3B,MAAKusD,KAAKt1B,KAAAA,IAASj3B,KAAKusD,KAAKv1B,KAAAA;AAE9B,MAAIy1B,eAAezsD,KAAK6sD,oBAAoB71B;AAC5Ch3B,OAAKusD,KAAKt1B,KAAOhwB,EAAAA,KAAKgwB;AACtBj3B,OAAKqtD,aAAa,WACjBrtD;AAAAA,SAAKA,KAAKgsD,MAAMh1B,KAAUC,CAAAA,IAAAA;AAAAA,EAC7B;AACEj3B,OAAK6sD,oBAAoB51B,SAASw1B;AAC3BzsD,SAAAA,KAAK6sD,oBAAoB71B,KAGzBh3B;AAAAA,SAAAA,KAAKusD,KAAKv1B,KAAAA;AACjB,GACDwzB,UAAU,SAASxzB,OAAOC,OAAAA;AACzBj3B,OAAK4tD,eAAe52B,OAAOC;AAE3Bj3B,OAAK+H,UAAU,cAAc,CAACivB,OAAOC,KAAAA,CAAAA;AAErC,GACD8C,QAAQ,SAAS9yB;AAChB,SAAUjH,CAAAA,CAAAA,KAAKusD,KAAKtlD,EACpB;AAAA,GAED4mD,YAAY,SAASC,QAAQxiB,QAAAA;AAC5B,MAAIrkC,KAAKjH,KAAK6qD,aAAaiD,MAAAA;AAE3B9tD,OAAKqtD,aAAa;AACjBrtD,SAAK8rD,UAAUgC,MACf9tD;AAAAA,SAAKisD,UAAUhlD,IAAG3N,KAAKyS,IAAI/L,KAAKjE,QAAQuvC,MAC3C,CAAA;AAAA,EAAA,CAAA;AAIE,GAEDpC,MAAM,SAAS4kB,QAAQxiB,QAAAA;AAGtB,MAAIrkC,KAAKjH,KAAK6qD,aAAaiD,MAAAA;AAC3B,MAAI/uD,MAAMiB,KAAK25B,QAAQ1yB,EACvBjH;AAAAA,OAAK6tD,WAAWC,QAAQxiB,MAExB;AAAA,MAAA,CAAKtrC,KAAKurD,SAAY,GAAA;AAErBvrD,SAAK+H,UAAU,kBAAkB,CAAChJ,IAAIkI,IAAIlI,KAAK,MAAA,CAAA;AAAA,EAC/C;AACD,GACDgvD,UAAU,WACT;AAAA,MAAG/tD,KAAKkyB,YAAW;AAClB;AAAA,EACA;AAEDlyB,OAAKs7B,OAAO,WACXt7B;AAAAA,SAAKu7B,SACR;AAAA,EAAA,CAAA;AACEv7B,OAAKusD,OAAO;AACZvsD,OAAKysD,eAAeC,YAAWb,QAC/B7rD;AAAAA,OAAKwrD,YAAYkB,YAAWb,QAC5B;AAAA,MAAI7rD,KAAKurD,SAAY,EAAA;AACrBvrD,OAAK+H,UAAU,cAAa;AAC5B/H,OAAKk6B,QAAAA;AACL,GAEDoB,QAAO,SAAS3gB,MAAMC;AACrB,MAAIozC,gBAAgB;AACpB,MAAGhuD,KAAKurD,YAAY;AACnByC,oBAAgB;AAAA,EAChB;AACDhuD,OAAK2sD,gBAAgB;AACrBhyC,OAAK9e,KAAK+e,UAAQ5a,IAAAA;AAElB,MAAKguD,CAAAA,eAAe;AACnBhuD,SAAK2sD,gBAAgB;AAAA,EACrB;AACD,GACDpB,UAAU;AACT,SAASvrD,CAAAA,CAAAA,KAAK2sD;AACd,GAEDsB,aAAa,SAAUC,MAAMC,MAAAA;AAC5B,MAAGD,KAAKnyD,WAAWoyD,KAAKpyD,OACvB,QAAO;AACR,WAAQD,IAAI,GAAGA,IAAIoyD,KAAKnyD,QAAQD,KAAK;AACpC,QAAGoyD,KAAKpyD,OAAOqyD,KAAKryD,CAAAA,EACnB,QAAO;AAAA,EACR;AAED,SAAO;AACP,GAEDo+B,SAAS,SAASjzB,IAAImnD,OAAAA;AACrB,MAAIpuD,KAAKurD,SAAAA,EAAY;AAErB,MAAI3hD;AACJ,MAAG3C,IAAG;AACL2C,WAAO5J,KAAK25B,QAAQ1yB,EACpB;AAAA,EAAA;AAED,MAAI0D;AACJ,MAAI1D,IAAG;AACN0D,WAAO,CAAC1D,IAAI2C,MAAM,OACrB;AAAA,EAAA,OAAO;AACJe,WAAO,CAAC,MAAK,MAAK;EAClB;AAED,MAAG3K,KAAK+H,UAAU,uBAAuB4C,IAAU,MAAA,OAAM;AACxD;AAAA,EACA;AAED,MAAI0jD,aAAaruD,KAAKsuD,kBAAmBtuD,CAAAA,KAAKuuD;AAC9CvuD,OAAKuuD,kBAAkB;AACvB,MAAGtnD,IAAG;AAEL,SAAImnD,SAAUC,CAAAA,YAAW;AACxB,UAAIG,WAAWxuD,KAAKysD;AACpBzsD,WAAKiiD,OAAAA;AACL,UAAIjiD,CAAAA,KAAKiuD,YAAYO,UAAUxuD,KAAKysD,YAAc,GAAA;AACjDxlD,aAAK5G;AAAAA,MACL;AAAA,IACD;AAAA,EAEJ,WAAQ,CAAIguD,YAAW;AACpBruD,SAAKiiD,OAAAA;AAAAA,EACL;AAED,MAAIh7C,IAAG;AACN0D,WAAO,CAAC1D,IAAI2C,MAAM,OACrB;AAAA,EAAA,OAAO;AACJe,WAAO,CAAC,MAAK,MAAK,IAClB;AAAA,EAAA;AAED3K,OAAK+H,UAAU,kBAAiB4C;AAChC,GAEDm/C,OAAO,WACN;AAAA,SAAO9pD,KAAKwrD,UAAUzvD;AACtB,GACDguD,cAAc,WACb;AAAA,SAAO/pD,KAAKysD,aAAa1wD;AACzB,GAEDE,MAAM,SAASA,MAAAA;AAAO,GAEtBokB,WAAW;AAAY,GAEvB6pC,UAAU,SAASvvC,MAClB;AAAA,WAAS7e,IAAE,GAAGA,IAAEkE,KAAKwrD,UAAUzvD,QAAQD,KAAK;AAC3C,QAAI8N,OAAO5J,KAAK25B,QAAQ35B,KAAKwrD,UAAU1vD,CAAAA,CAAAA;AACvC6e,SAAK9e,KAAKmE,MAAM4J,IAAAA;AAAAA,EAChB;AACD,GAEDF,MAAM,SAASu4C,QACd;AAAA,MAAIj+C,SAAS,CACbhE;AAAAA,OAAKkqD,SAAS,SAAStgD,MACtB;AAAA,QAAGq4C,OAAOr4C,IAAM,GAAA;AACf5F,aAAOhF,KAAK4K,IACZ;AAAA,IAAA;AAAA,EACJ;AACE,SAAO5F;AACP,GAEDi+C,QAAQ,SAASwM,MAAAA;AAChB,OAAKzuD,KAAKurD,SAAAA,GAAY;AACrBvrD,SAAK+H,UAAU,kBAAkB,CACjC,CAAA;AAAA,EAAA;AACD/H,OAAK+H,UAAU,eAAe,CAAA,CAAA;AAC9B,MAAI2mD,gBAAgBhC,YAAWb,QAC/B;AAAA,MAAI8C,iBAAiB,CAAA;AACrB3uD,OAAKkqD,SAAS,SAAStgD,MACtB;AAAA,QAAG5J,KAAK+H,UAAU,gBAAgB,CAAC6B,KAAK3C,IAAI2C,IAAO,CAAA,GAAA;AAClD,UAAGyiD,kBAAkBziD,KAAK3C,IAAI,MAAMjH,MAAMA,KAAK4uD,eAAc;AAC5DD,uBAAe3vD,KAAK4K,KAAK3C,EAC9B;AAAA,MAAA,OAAW;AACNynD,sBAAc1vD,KAAK4K,KAAK3C,EAAAA;AAAAA,MACxB;AAAA,IACD;AAAA,EACJ;AAEE,WAAQnL,IAAI,GAAGA,IAAI6yD,eAAe5yD,QAAQD,KAAI;AAC7C4yD,kBAAc1vD,KAAK2vD,eAAe7yD;EAClC;AAEDkE,OAAKysD,eAAeiC;AACpB1uD,OAAK6sD,sBAAsB;AAC3B,WAAQ/wD,IAAI,GAAGA,IAAIkE,KAAKysD,aAAa1wD,QAAQD,KAAI;AAChDkE,SAAK6sD,oBAAoB7sD,KAAKysD,aAAa3wD,CAAAA,CAAAA,IAAMA;AAAAA,EACjD;AACD,OAAKkE,KAAKurD,SAAAA,GAAY;AACrBvrD,SAAK+H,UAAU,YAAY;EAC3B;AACD,GAED4lD,eAAe,SAAStF,MAAMC,IAAAA;AAC7B,MAAIzrD,MAAMvD,KAAKyS,IAAKu8C,MAAIhpC,UAAUtf,KAAK+pD,aAAe,IAAA,CAAA;AACtD,MAAIh+C,MAAMs8C,QAAM;AAEhB,MAAIwG,WAAW9iD,MAAM,MAAMlP;AAC3B,MAAGmD,KAAK8sD,iBAAiB+B,QAAAA,GAAU;AAClC,WAAO7uD,KAAK8sD,iBAAiB+B,UAAUjzD,MACvC;AAAA,EAAA;AAED,MAAIkzD,MAAK,CAAA;AACT,WAAShzD,IAAEiQ,KAAKjQ,KAAKe,KAAKf,IACzBgzD,KAAI9vD,KAAKgB,KAAK25B,QAAQ35B,KAAKysD,aAAa3wD,CAAAA,CAAAA,CAAAA;AAEzCkE,OAAK8sD,iBAAiB+B,QAAAA,IAAYC,IAAIlzD,MAAAA;AACtC,SAAOkzD;AACP,GACD10B,UAAU,WAAA;AACT,MAAGp6B,KAAK+sD,gBAAe;AACtB,WAAO/sD,KAAK+sD,eAAenxD,MAAAA;AAAAA,EAC3B;AAED,MAAI2mB,MAAM,CACV;AAAA,WAAQzmB,KAAKkE,KAAKusD,MAAK;AACtBhqC,QAAIvjB,KAAKgB,KAAKusD,KAAKzwD,CAAAA,CAAAA;AAAAA,EACnB;AACDkE,OAAK+sD,iBAAiBxqC,IAAI3mB,MAE1B;AAAA,SAAO2mB;AACP,GAEDsoC,cAAc,SAASrkD,OAAAA;AACtB,SAAOxG,KAAKysD,aAAajmD,KACzB;AAAA,GACDyjD,cAAc,SAAShjD,IACtB;AAAA,MAAIsb,MAAMviB,KAAK6sD,oBAAoB5lD,EACnC;AAAA,MAAGsb,QAAQliB,QAAU;AACpBkiB,UAAO;AAAA,EACP;AACD,SAAOA;AACP,GACDwsC,qBAAqB,SAASh2C,OAC7B;AAAA,MAAGA,UAAU1Y,QAAU;AACtB,WAAO;AAAA,EACV,OAAO;AACJ,WAAO0Y;AAAAA,EACP;AACD,GACDi2C,UAAU,WACT;AAAA,SAAOhvD,KAAK+uD,oBAAoB/uD,KAAKysD,aAAa,CAAA,CAAA;AAClD,GACDwC,SAAS,WAAA;AACR,SAAOjvD,KAAK+uD,oBAAoB/uD,KAAKysD,aAAazsD,KAAKysD,aAAa1wD,SAAO,CAC3E,CAAA;AAAA,GACD+0B,SAAS,SAAS7pB,IACjB;AAAA,SAAOjH,KAAK+uD,oBAAoB/uD,KAAKysD,aAAazsD,KAAKiqD,aAAahjD,EAAAA,IAAM;AAC1E,GACD2pB,SAAS,SAAS3pB,IACjB;AAAA,SAAOjH,KAAK+uD,oBAAoB/uD,KAAKysD,aAAazsD,KAAKiqD,aAAahjD,EAAAA,IAAM;AAC1E,GACDgI,YAAY;AACXjP,OAAK+H,UAAU,aAAa,CAC5B/H,CAAAA;AAAAA,OAAKuI,gBACLvI;AAAAA,OAAKkyB,aAAa;AAClBlyB,OAAKusD,OAAO;AACZvsD,OAAKwsD,YAAY;AACjBxsD,OAAKysD,eAAe;AACpBzsD,OAAKwrD,YAAY;AACjBxrD,OAAK2sD,gBAAgB;AACrB3sD,OAAK4sD,cAAc;AACnB5sD,OAAK6sD,sBAAsB;AAC3B7sD,OAAK8sD,mBAAmB;AACxB,EC5bF;AAAA,IAAIoC,gBAAgB,SAAS5pD,SAAAA;AAC5BgnD,YAAUrsD,MAAMD,MAAM,CAACsF,OACvBtF,CAAAA;AAAAA,OAAKmvD,YAAY;AAEjBnvD,OAAKusD,OAAO;AAEZvsD,OAAKwsD,YAAY,SAAU5iD,MAAAA;AAC1B,QAAIwlD,aAAaxlD;AACjB,QAAGtE,QAAOkzB,UAAS;AAClB42B,mBAAa9pD,QAAOkzB,SAAS42B;IAC7B;AACD,QAAIC,eAAervD,KAAK25B,QAAQ/vB,KAAK3C,EAAAA;AACrC,QAAGooD,gBAAAA,CAAiB9f,WAAW8f,aAAavuD,QAAOsuD,WAAWtuD,MAAAA,GAAQ;AACrEd,WAAKkpC,KAAKkmB,WAAWnoD,IAAImoD,WAAWvlB,UAAAA,IAAculB,WAAWtuD,UAAUd,KAAK4uD,aAAa/zC;IACzF;AACD,WAAOu0C;AAAAA,EACT;AACCpvD,OAAKsvD,kBAAkBhqD,QAAOiqD,kBAAkB;AAEhD,aAAUjqD,QAAO2F,WAAW,YAAW;AACtCjL,SAAKwvD,aAAa,yBAAUryC,KAAAA;AAC3B,aAAO,WAAA;AAAW,eAAOA;AAAAA,MAAI;AAAA,IAC7B,EAAE7X,QAAO2F,UAAU,CAAA;AAAA,EACtB,OAAM;AACJjL,SAAKwvD,aAAalqD,QAAO2F;AAAAA,EACzB;AAGDjL,OAAKyvD,iBAAiBnqD,QAAOoqD;AAE7B1vD,OAAKysD,eAAeC,YAAWb;AAC/B7rD,OAAKwrD,YAAYkB,YAAWb,QAAAA;AAC5B7rD,OAAK6sD,sBAAsB;AAC3B7sD,OAAK8sD,mBAAmB;AACxB9sD,OAAK2vD,0BAA0B;AAC/B3vD,OAAK+sD,iBAAiB;AACtB/sD,OAAK2sD,gBAAgB;AAErB3sD,OAAK4uD,eAAe;AACpB,MAAGtpD,QAAOsqD,WAAU;AACnB5vD,SAAK4uD,eAAetpD,QAAOsqD,UAC3B;AAAA,EAAA;AAED,MAAIC,eAAe,CAAA;AACnB,MAAIC,aAAa,CAAA;AAEjB,MAAIC,gBAAgB,CAAA;AACpB,MAAIC,iBAAiB,CAAA;AACrB,MAAIC,iBAAiB;AAErBjwD,OAAKgtD,kBAAkB,WACtBhtD;AAAAA,SAAK8sD,mBAAmB;AACxB9sD,SAAK2vD,0BAA0B;AAC/B3vD,SAAK+sD,iBAAiB;AACtB,WAAO;AAAA,EACT,CAEC/sD;AAAAA,OAAKwH,YAAY,eAAe,WAC/BxH;AAAAA,SAAK8sD,mBAAmB;AACxB9sD,SAAK2vD,0BAA0B;AAE/BE,mBAAe,CAAA;AACfC,iBAAa,CAAA;AACbC,oBAAgB,CAAA;AAChBC,qBAAiB,CAAA;AACjBC,qBAAiB;AAEjBjwD,SAAKkqD,SAAS,SAAStgD,MAAAA;AACtB,UAAI9I,SAASd,KAAK8uB,UAAUllB,KAAK3C,EACjC;AAAA,UAAG2C,KAAKyT,SAAS0yC,cAAcjvD,MAAY,MAAA,OAAM;AAChDivD,sBAAcnmD,KAAK3C,EAAAA,IAAM;AAAA,MAC7B,OAAQ;AACJ8oD,sBAAcnmD,KAAK3C,EAAAA,IAAM;AAAA,MACzB;AAED,UAAGjH,KAAKkwD,aAAatmD,IAAM,GAAA;AAC1BqmD,yBAAiB;AACjBJ,qBAAajmD,KAAK3C,EAAM,IAAA;AACxB6oD,mBAAWlmD,KAAK3C,EAAAA,IAAM;AAAA,MACtB;AAGD,UAAGgpD,kBAAkBH,WAAWhvD,MAAQ,GAAA;AACvCgvD,mBAAWlmD,KAAK3C,EAAAA,IAAM;AAAA,MACtB;AAGD,UAAG8oD,cAAcjvD,MAAAA,KAAWivD,cAAcjvD,MAAAA,MAAYT,QAAU;AAC/D2vD,uBAAepmD,KAAK3C,EAAAA,IAAM;AAAA,MAC9B,OAAQ;AACJ+oD,uBAAepmD,KAAK3C,EAAM,IAAA;AAAA,MAC1B;AAAA,IACJ,CAAA;AAAA,EACA;AAECjH,OAAKwH,YAAY,gBAAgB,SAASP,IAAI2C;AAE7C,QAAIumD,oBAAoB;AACxB,QAAGnwD,KAAK4uD,cAAa;AACpB,UAAIuB,oBAAoBnwD,KAAK4uD,aAAawB;AAAAA,IAC1C;AAED,QAAIx4C,OAAOo4C,eAAepmD,KAAK3C,EAE/B;AAAA,QAAGgpD,gBAAe;AACjB,UAAGr4C,QAAQk4C,WAAWlmD,KAAK3C,QAAQ4oD,aAAajmD,KAAK3C,EAAI,GAAA;AACxD2Q,eAASu4C,CAAAA,CAAAA;AAAAA,MACT;AAED,UAAGL,WAAWlmD,KAAK3C,EAAAA,KAAAA,CAAQ4oD,aAAajmD,KAAK3C,KAAI;AAChD2C,aAAKglB,iBAAiB;AAAA,MACtB;AAAA,IACD;AAEDhlB,SAAKymD,mBAAqBL,CAAAA,CAAAA,eAAepmD,KAAK3C,EAE9C;AAAA,WAAA,CAAA,CAAS2Q;AAAAA,EACX,CAEC5X;AAAAA,OAAKwH,YAAY,YAAY,WAC5BqoD;AAAAA,mBAAe,CAAA;AACfC,iBAAa,CAAA;AAEbC,oBAAgB,CAAA;AAChBC,qBAAiB,CAAA;AAAA,EACnB,CAAA;AAEC,SAAOhwD;AACR;AAEAkvD,cAAcvzD,YAAY4qD,MAAY,EAEpC+J,YAAY,SAAS79C,OACpB;AAAA,MAAI7I,OAAO;AACX,MAAIqB,SAASjL,KAAKwvD,WAClB;AAAA,WAAS1zD,IAAI,GAAG+C,MAAM4T,MAAK1W,QAAQD,IAAI+C,KAAK/C,KAAI;AAC/C8N,WAAO6I,MAAK3W,CACZkE;AAAAA,SAAK2pD,UAAU//C,MAAMoB,mBAAmBhL,KAAK8uB,UAAUllB,IAAAA,GAAOqB,MAAWA,KAAAA,MAAAA;AAAAA,EACzE;AAGD,WAASnP,IAAI,GAAG+C,MAAM4T,MAAK1W,QAAQD,IAAI+C,KAAK/C,KAAI;AAC/C8N,WAAO6I,MAAK3W,CAAAA;AACZkE,SAAKuwD,YAAY3mD,IAAAA;AACjBA,SAAK0S,SAAStc,KAAKyqD,mBAAmB7gD,IACtCA;AAAAA,SAAKm/B,eAAe/oC,KAAKgqD,eAAepgD,KAAK3C;AAE7C,QAAK69C,CAAAA,QAAcl7C,KAAKyT,KAAAA,GAAQ;AAC/BzT,WAAKyT,QAAQynC,QAAcl7C,KAAKgO,IAAQhO,IAAAA,KAAKgO,OAAO5X,KAAKyvD;IACzD;AAAA,EAED;AACDzvD,OAAKqtD,aACL;AAAA,GACD6C,cAAc,SAAStmD,MAAAA;AACtB,SAAQA,KAAKlE,UAAU,WAAW1F,KAAKib,SAASrR,KAAK3C,EACrD;AAAA,GACDyQ,OAAO,SAASjF;AACf,MAAKzS,CAAAA,KAAK2sD,eAAe;AACxB3sD,SAAK+H,UAAU,iBAAiB,CAAC0K,KAAAA,CAAAA;AAAAA,EACjC;AACD,MAAIy6C,SAASltD,KAAKitD,YAAYx6C,KAAAA;AAC9BzS,OAAKswD,WAAWpD,MAChBltD;AAAAA,OAAKiiD;AACL,MAAKjiD,CAAAA,KAAK2sD,eAAe;AACxB3sD,SAAK+H,UAAU,WAAW,CAACmlD,MAAAA,CAAAA;AAAAA,EAC3B;AACD,GAEDK,eAAe,SAAS3jD,MAAMpD,OAE7B;AAAA,MAAI1F,SAASd,KAAK8uB,UAAUllB;AAE5B,MAAIk7C,CAAAA,QAAchkD,MAAQ,GAAA;AACzBA,aAASd,KAAKwvD;AACdxvD,SAAK2pD,UAAU//C,MAAM9I,MACrB;AAAA,EAAA;AAED,MAAI0vD,cAAcxwD,KAAKiqD,aAAanpD,MAAAA;AACpC,MAAI2vD,cAAcD,cAAcl3D,KAAKyS,IAAIzS,KAAKuD,IAAI2J,OAAO,IAAIxG,KAAKysD,aAAa1wD,MAE/E;AAAA,MAAG00D,cAAY,MAAMA,aAAY;AAChCA,kBAAcpwD;AAAAA,EACd;AACDisD,YAAU3wD,UAAU4xD,cAAc1xD,KAAKmE,MAAM4J,MAAM6mD,WAAAA;AACnDzwD,OAAK2pD,UAAU//C,MAAM9I,MAErB;AAAA,MAAG8I,KAAKu5B,eAAe,kBAAA,GAAoB;AAC1CnjC,SAAK0wD,aAAa9mD,MAAMA,KAAK+mD,gBAC7B;AAAA,EAAA;AACD3wD,OAAKuwD,YAAY3mD,MAAMpD,KACvB;AAAA,GACDonD,gBAAgB,SAAS52B,OAAOC,OAC/B;AAAA,MAAImS,WAAWppC,KAAK+a,YAAYic,KAAAA;AAChC,MAAIy1B,eAAezsD,KAAK6sD,oBAAoB71B,KAE5Cs1B;AAAAA,YAAU3wD,UAAUiyD,eAAe/xD,KAAKmE,MAAMg3B,OAAOC,KAErD;AAAA,MAAIn2B,SAASd,KAAK8uB,UAAUmI,KAE5Bj3B;AAAAA,OAAK4wD,sBAAsB9vD,QAAQk2B,OAAOC,KAE1C;AAAA,MAAGj3B,KAAKmvD,UAAUn4B,KAAO,GAAA;AACxBh3B,SAAKmvD,UAAUl4B,KAAAA,IAASj3B,KAAKmvD,UAAUn4B,KAAAA;AAAAA,EACvC;AACD,WAAQl7B,IAAI,GAAGA,IAAIstC,SAASrtC,QAAQD,KAAI;AACvC,QAAIwC,QAAQ0B,KAAK25B,QAAQyP,SAASttC,CAAAA,CAAAA;AAClCwC,UAAM0B,KAAKsvD,eAAmBr4B,IAAAA;AAC9B34B,UAAMqyD,mBAAmB15B;AAAAA,EACzB;AAEDj3B,OAAK6sD,oBAAoB51B,SAASw1B;AAC3BzsD,SAAAA,KAAKmvD,UAAUn4B,KAAAA;AACtB,GAED65B,mBAAmB,SAASl2C,MAAM7Z,QAAAA;AACjC,MAAKgkD,CAAAA,QAAchkD,MAAS,GAAA;AAC3BA,aAASd,KAAKwvD,WAAAA;AAAAA,EACd;AACD,MAAI10C,SAAS9a,KAAKmvD,UAAUruD,MAC5B;AAAA,MAAIga,QAAQ;AACX,aAAShf,IAAI,GAAGA,IAAIgf,OAAO/e,QAAQD,KAAK;AACvC,UAAIg1D,SAASh2C,OAAOhf,CACpB6e;AAAAA,WAAK9e,KAAKmE,MAAM8wD,MAAAA;AAChB,UAAI9wD,KAAKmvD,UAAU2B,MAAAA,EAClB9wD,MAAK6wD,kBAAkBl2C,MAAMm2C;IAC9B;AAAA,EACD;AACD,GAEDzD,cAAc,SAAS1yC,MAEtB3a;AAAAA,OAAKwrD,YAAYkB,YAAWb;AAC5B7rD,OAAK6wD,kBAAkB,SAASviC,QAAAA;AAC/BtuB,SAAKwrD,UAAUxsD,KAAKsvB,MACxB;AAAA,EAAA,CAAA;AAEG,MAAG3T,KACF2xC,WAAU3wD,UAAU0xD,aAAaxxD,KAAKmE,MAAM2a;AAC7C,GAED2yC,kBAAkB,SAASrmD,IAE1B;AAAA,MAAIsvB,QAAQ,CAAA;AACZv2B,OAAKkqD,SAAS,SAAS5rD,OACtBi4B;AAAAA,UAAMv3B,KAAKV,KACX;AAAA,EAAA,GAAE2I;AAEHsvB,QAAMv3B,KAAKgB,KAAK25B,QAAQ1yB,EAExB,CAAA;AAAA,WAAQnL,IAAI,GAAGA,IAAIy6B,MAAMx6B,QAAQD,KAAI;AAEpCkE,SAAK0wD,aAAan6B,MAAMz6B,CAAIkE,GAAAA,KAAK8uB,UAAUyH,MAAMz6B,CAAAA,CAAAA,GAAK,IACtDwwD;AAAAA,cAAU3wD,UAAU2xD,iBAAiBzxD,KAAKmE,MAAMu2B,MAAMz6B,CAAGmL,EAAAA,EAAAA;AACzDjH,SAAK0wD,aAAan6B,MAAMz6B,CAAIkE,GAAAA,KAAK8uB,UAAUyH,MAAMz6B,CAAAA,CAAAA,GAAK;EACtD;AACD,GAEDotC,MAAM,SAAS4hB,KAAKxf,QAAQxqC;AAE3B,MAAImG,KAAKL,UAAU,CAAA;AACnB,MAAItB,UAAStF,KAAK4uD,gBAAgB;AAClC,MAAI/zC,UAAUvV,QAAOuV,WAAW;AAChC5T,OAAK+D,mBAAmB/D,IAAI4T,OAAAA;AAC5B,MAAI5T,IAAI;AACP,QAAIA,OAAO6jD,IAAK;AAEhBhqD,aAASd,KAAK8uB,UAAU7nB,EACxBqkC;AAAAA,aAAStrC,KAAKgqD,eAAe/iD;EAC7B;AACD,MAAGsoC,WAAWub,KAAKhqD,MAAQ,GAAA;AAC1B;AAAA,EACA;AACD,MAAA,CAAKgkD,QAAchkD,MAAS,GAAA;AAC3BA,aAASd,KAAKwvD,WAAAA;AAAAA,EACd;AACD,MAAI9uC,SAAS1gB,KAAK25B,QAAQmxB,GAC1B;AAAA,MAAIiG,aAAa/wD,KAAK8uB,UAAUpO,OAAOzZ,EAEvC;AAAA,MAAI+pD,UAAUhxD,KAAK+a,YAAYja,MAAAA;AAE/B,MAAIwqC,UAAW,GACdA,UAAS0lB,QAAQj1D,SAAS;AAC3B,MAAIwzC,WAAWwhB,YAAYjwD,MAAAA,GAAS;AACnC,QAAIgtD,SAAS9tD,KAAKgqD,eAAec,GACjC;AAAA,QAAIgD,UAAUxiB,OAAQ;AAAA,EACtB;AAED,MAAGtrC,KAAK+H,UAAU,oBAAoB,CAAC+iD,KAAKhqD,QAAQwqC,MAAAA,CAAAA,MAAa,MAChE,QAAO;AAER,MAAIqjB,iBAAiB,CAAA;AACrB,WAAQ7yD,IAAI,GAAGA,IAAIk1D,QAAQj1D,QAAQD,KAAI;AACtC,QAAIuwD,kBAAkB2E,QAAQl1D,CAAAA,GAAI,MAAMkE,MAAMA,KAAK4uD,YAAAA,GAAc;AAChED,qBAAe3vD,KAAKgyD,QAAQl1D,CAC5Bk1D,CAAAA;AAAAA,cAAQ30D,OAAOP,GAAG,CAAA;AAClBA;AAAAA,IACA;AAAA,EACD;AAEDkE,OAAK4wD,sBAAsBG,YAAYjG,GAAAA;AACvCkG,YAAUhxD,KAAK+a,YAAYja,MAAAA;AAE3B,MAAImwD,MAAMD,QAAQ1lB,MAClB2lB;AAAAA,QAAMjmD,mBAAmBimD,KAAKp2C;AAC9B,MAAKo2C,CAAAA,IACJD,SAAQhyD,KAAK8rD,GAAAA;AAAAA,MAEbkG,WAAUA,QAAQp1D,MAAM,GAAG0vC,MAAAA,EAAQpjC,OAAO,CAAE4iD,MAAO5iD,OAAO8oD,QAAQp1D,MAAM0vC,MAEzE,CAAA;AAAA,MAAIqjB,eAAe5yD,QAAO;AACzBi1D,cAAUA,QAAQ9oD,OAAOymD,cAAAA;AAAAA,EACzB;AAED,MAAKpf,CAAAA,WAAW7uB,OAAOiwC,kBAAkBI,UAAAA,KAAAA,CAAgBxhB,WAAWwhB,YAAYjwD,MAAAA,GAAQ;AACvF4f,WAAOiwC,mBAAmBI;AAAAA,EAC1B;AACD/wD,OAAK2pD,UAAUjpC,QAAQ5f,MAAAA;AACvBd,OAAKmvD,UAAUruD,UAAUkwD;AAEzB,MAAIE,OAAOlxD,KAAKyqD,mBAAmB/pC,MAAAA,IAAUA,OAAOpE;AACpDoE,SAAOpE,UAAU40C;AACjBlxD,OAAKkqD,SAAS,SAAStgD,MAAAA;AACtBA,SAAK0S,UAAU40C;AAAAA,EACnB,GAAMxwC,OAAOzZ,IAAIjH,IAAAA;AAGdA,OAAK6tD,WAAW7tD,KAAKiqD,aAAaa,MAAM9qD,KAAKiqD,aAAanpD,MAAUwqC,IAAAA,MAAAA;AAEpEtrC,OAAK+H,UAAU,mBAAmB,CAAC+iD,KAAKhqD,QAAQwqC,MAChDtrC,CAAAA;AAAAA,OAAKk6B;AACL,GAED8vB,gBAAgB,SAAS/iD,IAAAA;AACxB,MAAI6T,SAAS9a,KAAK+a,YAAY/a,KAAK8uB,UAAU7nB,EAAAA,CAAAA;AAC7C,MAAIT,QAAQsU,OAAO7d,QAAQgK,KAAK,EAChC;AAAA,MAAIT,SAAU,IAAE;AACfA,YAAQsU,OAAO7d,SAASgK,EACxB;AAAA,EAAA;AACD,SAAOT;AACP,GACDyU,UAAU,SAAShU,IAClB;AAAA,MAAI6T,SAAS9a,KAAKmvD,UAAUloD;AAC5B,SAAO6T,UAAUA,OAAO/e;AACxB,GACDgf,aAAa,SAAS9T,IACrB;AAAA,MAAI6T,SAAS9a,KAAKmvD,UAAUloD;AAC5B,SAAO6T,SAASA,SAAS4xC,YAAWb,QAAAA;AACpC,GAED5qD,WAAW,SAASkwD,SAAStiC;AAC5B,MAAK7uB,CAAAA,KAAK+5B,OAAOo3B,OAAAA,EAChB,QAAO;AACR,MAAItiC,aAAa7uB,KAAKwvD,WACrB,EAAA,QAAO;AAER,MAAA,CAAKxvD,KAAKib,SAAS4T,QAAAA,EAClB,QAAO;AAER,MAAIjlB,OAAO5J,KAAK25B,QAAQw3B,OACxB;AAAA,MAAIC,MAAMpxD,KAAK8uB,UAAUqiC,OAEzB;AAAA,MAAIrwD,SAASd,KAAK25B,QAAQ9K;AAC1B,MAAG/tB,OAAOwb,UAAU1S,KAAK0S,QAAO;AAC/B,WAAO;AAAA,EACP;AAED,SAAO1S,QAAQ5J,KAAK+5B,OAAOq3B,GAAM,GAAA;AAChCxnD,WAAO5J,KAAK25B,QAAQy3B,GAAAA;AAEpB,QAAIxnD,QAAQ2lC,WAAW3lC,KAAK3C,IAAI4nB,QAC/B,EAAA,QAAO;AACRuiC,UAAMpxD,KAAK8uB,UAAUllB,IAAAA;AAAAA,EACrB;AACD,SAAO;AACP,GAED+gD,aAAa,SAAS1jD,IACrB;AAAA,MAAA,CAAIjH,KAAK+5B,OAAO9yB,EAAAA,GAAI;AACnB,WAAOylD,YAAWb,QAAAA;AAAAA,EAClB;AACD,MAAI/qD,SAASd,KAAK8uB,UAAU7nB,EAAAA;AAC5B,SAAOjH,KAAK+a,YAAYja,MAExB;AAAA,GACD8pD,gBAAgB,SAAS3jD;AACxB,MAAIoqD,WAAWrxD,KAAK2qD,YAAY1jD,EAAAA;AAChC,WAAQnL,IAAG,GAAG+C,MAAMwyD,SAASt1D,QAAQD,IAAI+C,KAAK/C,KAAI;AACjD,QAAGyzC,WAAW8hB,SAASv1D,IAAImL,EAAI,GAAA;AAC9B,UAAIqqD,cAAcD,SAASv1D,IAAE;AAC7B,UAAIw1D,gBAAgB,KAAKx1D,IAAI,GAAE;AAC9Bw1D,sBAAc;AAAA,MACd;AACD,aAAOA,eAAe;AAAA,IACtB;AAAA,EACD;AACD,SAAO;AACP,GACDrgC,gBAAgB,SAAShqB;AACxB,MAAIoqD,WAAWrxD,KAAK2qD,YAAY1jD,EAChC;AAAA,WAAQnL,IAAG,GAAG+C,MAAMwyD,SAASt1D,QAAQD,IAAI+C,KAAK/C,KAAI;AACjD,QAAGyzC,WAAW8hB,SAASv1D,IAAImL,EAAI,GAAA;AAC9B,UAAI2mB,kBAAkByjC,SAASv1D,IAAE;AACjC,UAAI8xB,oBAAoB,KAAK9xB,IAAI,GAAE;AAClC8xB,0BAAkB;AAAA,MAClB;AACD,aAAOA,mBAAmB;AAAA,IAC1B;AAAA,EACD;AACD,SAAO;AACP,GACDkB,WAAW,SAAS7nB;AACnB,MAAI2C,OAAO;AACX,MAAG3C,GAAGA,OAAO5G,QAAU;AACtBuJ,WAAO3C;AAAAA,EACX,OAAQ;AACJ2C,WAAO5J,KAAK25B,QAAQ1yB;EACpB;AAED,MAAInG;AACJ,MAAG8I,MAAK;AACP9I,aAAS8I,KAAK5J,KAAKsvD;EACvB,OAAQ;AACJxuD,aAASd,KAAKwvD,WACd;AAAA,EAAA;AACD,SAAO1uD;AAEP,GAEDitD,UAAU,WAAA;AACT/tD,OAAKmvD,YAAY;AACjB7C,YAAU3wD,UAAUoyD,SAASlyD,KAAKmE;AAClC,GAEDyqD,oBAAoB,SAAS7gD,MAAAA;AAC5B,MAAI2nD,QAAQ;AACZvxD,OAAKmqD,WAAW,WACfoH;AAAAA;AAAAA,EACA,GAAE3nD,IAAAA;AACH,SAAO2nD;AACP,GAEDC,iBAAiB,SAAS5nD,MAAM8gD,SAASpvB;AACxC,MAAIA,CAAAA,QAAO;AACV,QAAG1xB,KAAKu5B,eAAe,kBAAoB,GAAA;AAC1CnjC,WAAK0wD,aAAa9mD,MAAMA,KAAK+mD,kBAAkBjG,OACpD;AAAA,IAAA,OAAS;AACJ1qD,WAAK0wD,aAAa9mD,MAAMA,KAAK5J,KAAKsvD,eAAAA,GAAkB5E,OACpD;AAAA,IAAA;AAAA,EACD;AACD,GACDf,WAAW,SAAS//C,MAAM8gD,SAASpvB,QAClCt7B;AAAAA,OAAKwxD,gBAAgB5nD,MAAM8gD,SAASpvB,MAEpC1xB;AAAAA,OAAK5J,KAAKsvD,eAAAA,IAAmB5E;AAC7B,GAED+G,iBAAiB,SAAS92C,MAAMk+B,OAAAA;AAC/B,WAAQ/8C,IAAI,GAAG+C,MAAMg6C,MAAM98C,QAAQD,IAAI+C,KAAK/C,KAAI;AAC/C6e,SAAK9e,KAAKmE,MAAM64C,MAAM/8C,CAAAA,CAAAA;AAAAA,EACtB;AACD,GACD41D,kBAAkB,SAAS/2C,MAAMg3C,SAAS9Y,OAAAA;AACzC,MAAI+Y,aAAa5xD,KAAK+a,YAAY42C;AAClC,MAAGC,WAAW71D,QAAO;AACpB61D,iBAAaA,WAAWh2D,QAAQi2D,QAChC;AAAA,EAAA;AACD,SAAMD,WAAW71D,QAAO;AACvB,QAAI+0D,SAASc,WAAW7nD,IAAAA;AACxB,QAAIH,OAAO5J,KAAK25B,QAAQm3B,MAAAA;AACxBn2C,SAAK9e,KAAKmE,MAAM4J,IAAAA;AAChB,QAAGivC,OAAM;AACRA,YAAM75C,KAAK4K,IACX;AAAA,IAAA;AAED,QAAG5J,KAAKib,SAASrR,KAAK3C,EAAI,GAAA;AACzB,UAAImiC,WAAWppC,KAAK+a,YAAYnR,KAAK3C,EACrC;AAAA,UAAIpI,MAAMuqC,SAASrtC;AACnB,eAAQD,IAAI+C,MAAM,GAAG/C,KAAK,GAAGA,KAAI;AAChC81D,mBAAW5yD,KAAKoqC,SAASttC,CACzB,CAAA;AAAA,MAAA;AAAA,IACD;AAAA,EAED;AACD,GAEDouD,UAAU,SAASvvC,MAAM7Z,QACxB;AAAA,MAAImK,SAASjL,KAAKwvD;AAClB,MAAK1K,CAAAA,QAAchkD,SAAS;AAC3BA,aAASmK;AAAAA,EACT;AACD,MAAI0mD,UAAU3mD,mBAAmBlK,QAAQmK,MAAAA,KAAWA;AAEpD,MAAI6mD,WAAW;AACf,MAAIC,aAAa;AACjB,MAAIlZ,QAAQ;AACZ,MAAG8Y,YAAY1mD,QAAO;AACrB,QAAGjL,KAAK2vD,yBAAwB;AAC/BmC,iBAAW;AACXjZ,cAAQ74C,KAAK2vD;AAAAA,IAClB,OAAS;AACJoC,mBAAa;AACblZ,cAAQ74C,KAAK2vD,0BAA0B;IACvC;AAAA,EACD;AACD,MAAGmC,UAAS;AACX9xD,SAAKyxD,gBAAgB92C,MAAMk+B,KAAAA;AAAAA,EAC/B,OAAQ;AACJ74C,SAAK0xD,iBAAiB/2C,MAAMg3C,SAASI,aAAalZ,QAAQ,IAAA;AAAA,EAC1D;AACD,GACDsR,YAAY,SAASxvC,MAAMq3C,WAC1B;AAAA,MAAIC,cAAc,CAAA;AAClB,MAAIroD,OAAOooD;AACX,MAAIlxD,SAASd,KAAK8uB,UAAUllB;AAE5B,SAAO5J,KAAK+5B,OAAOj5B,MAAAA,GAAS;AAC3B,QAAImxD,YAAYnxD,MAAS,GAAA;AACxB,YAAM,IAAI43C,MAAM,oEAAoE53C;IACpF;AACDmxD,gBAAYnxD,UAAU;AACtB8I,WAAO5J,KAAK25B,QAAQ74B,MAAAA;AACpB6Z,SAAK9e,KAAKmE,MAAM4J,IAAAA;AAChB9I,aAASd,KAAK8uB,UAAUllB;EACxB;AACD,GACD2mD,aAAa,SAAS3mD,MAAMpD,OAAO1F,QAAAA;AAClC,MAAIswD,MAAMtwD,WAAWT,SAAYL,KAAK8uB,UAAUllB,IAAQ9I,IAAAA;AACxD,OAAKd,KAAKib,SAASm2C,GAClBpxD,EAAAA,MAAKmvD,UAAUiC,GAAAA,IAAO1E,YAAWb,QAClC;AAAA,MAAI/wC,SAAS9a,KAAK+a,YAAYq2C,GAAAA;AAC9B,MAAIc,gBAAgBp3C,OAAO7d,QAAQ2M,KAAK3C,KAAK,EAAA,IAAA,MAAY6T,OAAO7d,QAAAA,CAAS2M,KAAK3C,EAAO,IAAA;AACrF,OAAIirD,eAAc;AACjB,QAAG1rD,QAAM,KAAKA,OAAM;AAEnBsU,aAAOze,OAAOmK,OAAO,GAAGoD,KAAK3C,EAAAA;AAAAA,IAClC,OAAS;AACJ6T,aAAO9b,KAAK4K,KAAK3C,EACjB;AAAA,IAAA;AAED2C,SAAK+mD,mBAAmBS;AAAAA,EACxB;AACD,GACDV,cAAc,SAAS9mD,MAAMuoD,YAAYC,YACxCpyD;AAAAA,OAAK2vD,0BAA0B;AAG/B3vD,OAAK4wD,sBAAsBuB,YAAYvoD,KAAK3C,EAAAA;AAC5C,MAAGjH,KAAK+5B,OAAOq4B,UAAe7iB,KAAAA,WAAW6iB,YAAYpyD,KAAKwvD,WAAc,CAAA,GAAA;AAEvExvD,SAAKuwD,YAAY3mD,MAAMvJ,QAAW+xD,UACtC;AAAA,EAAA,OAAQ;WACGpyD,KAAKmvD,UAAUvlD,KAAK3C,EAAAA;AAAAA,EAC3B;AACD2C,OAAK0S,SAAUtc,KAAKyqD,mBAAmB7gD;AACvC5J,OAAKkqD,SAAS,SAAS5rD,OACtBA;AAAAA,UAAMge,SAAStc,KAAKyqD,mBAAmBnsD,KAAAA;AAAAA,EAC3C,GAAMsL,KAAK3C,EAAAA;AACR,GAED2pD,uBAAuB,SAASh3D,MAAMy4D,QAAQz0B,QAAAA;AAC7C,MAAI9iB,SAAS9a,KAAK+a,YAAYnhB;AAC9B,MAAIkhB,UAAUlhB,SAASyG,QAAU;AAChC,QAAIiyD,YAAY5F,YAAWb,QAAAA;AAE3B,QAAIrlD,QAAQsU,OAAO7d,QAAQo1D,SAAS,EACpC;AAAA,QAAI7rD,eAAgBrM,CAAAA,MAAAA,CAAOk4D,SAAQ;AAClC7rD,cAAQsU,OAAO7d,QAAAA,CAASo1D,MACxB;AAAA,IAAA;AAED,QAAI7rD,QAAS,IAAE;AACd,UAAIo3B,QAAO;AACV9iB,eAAOze,OAAOmK,OAAO,GAAGo3B,MAAAA;AAAAA,MAC9B,OAAY;AACN9iB,eAAOze,OAAOmK,OAAO;MACrB;AAAA,IACD;AACD8rD,gBAAYx3C;AAEZ9a,SAAKmvD,UAAUv1D,IAAAA,IAAQ04D;AAAAA,EACvB;AAED,GAEDr2D,MAAM,SAAS8uD,OAAOC,MAAMlqD,QAC3B;AAAA,MAAA,CAAKd,KAAK+5B,OAAOj5B,MAAAA,GAAS;AACzBA,aAASd,KAAKwvD,WAAAA;AAAAA,EACd;AAED,MAAKzE,CAAAA,MAAOA,SAAQ;AACpB,MAAIwH,2BAA6B,WAAa,SAASh4D,GAAG2B,GACzD;AAAA,QAAI3B,EAAEwwD,KAAU7uD,KAAAA,EAAE6uD,UAChB9nB,OAAe1oC,EAAEwwD,WAAW9nB,OAAe/mC,EAAE6uD,KAAWxwD,CAAAA,KAAAA,EAAEwwD,KAAOt9C,EAAAA,QAAAA,KAAavR,EAAE6uD,KAAOt9C,EAAAA,QAAAA,GACzF;AACC,aAAO;AAAA,IACP;AAED,QAAIzJ,SAASzJ,EAAEwwD,KAAAA,IAAS7uD,EAAE6uD,KAAAA;AAC1B,WAAO/mD,SAAS,IAAA;AAAA,EAChB,IAAI+mD;AAEL,MAAIC,MAAM;AACT,QAAIwH,oBAAoBD;AACxBA,eAAW,SAAUh4D,GAAG2B,GACvB;AAAA,aAAOs2D,kBAAkBt2D,GAAG3B,CAAAA;AAAAA,IACjC;AAAA,EACI;AAED,MAAIk4D,MAAMzyD,KAAK+a,YAAYja,MAAAA;AAE3B,MAAI2xD,KAAI;AACP,QAAI5V,OAAO,CACX;AAAA,aAAS/gD,IAAI22D,IAAI12D,SAAS,GAAGD,KAAK,GAAGA,IACpC+gD,MAAK/gD,CAAAA,IAAKkE,KAAK25B,QAAQ84B,IAAI32D;AAE5B+gD,SAAK5gD,KAAKs2D,QAEV;AAAA,aAASz2D,IAAI,GAAGA,IAAI+gD,KAAK9gD,QAAQD,KAAK;AACrC22D,UAAI32D,KAAK+gD,KAAK/gD,CAAAA,EAAGmL;AACjBjH,WAAK/D,KAAK8uD,OAAOC,MAAMyH,IAAI32D,CAAAA,CAAAA;AAAAA,IAC3B;AAAA,EACD;AACD,GAEDmmD,QAAQ,SAASwM,MAAAA;AAChB,WAAQ3yD,KAAKkE,KAAKusD,MAAK;AACtB,UAAMmG,iBAAiB1yD,KAAKusD,KAAKzwD,GAAG60D;AACpC,UAAMgC,eAAe3yD,KAAK8uB,UAAU9uB,KAAKusD,KAAKzwD,CAE9C,CAAA;AAAA,QAAA,CAAIyzC,WAAWmjB,gBAAeC,YAAAA,GAAc;AAC3C3yD,WAAK0wD,aAAa1wD,KAAKusD,KAAKzwD,CAAI42D,GAAAA,gBAAgBC;IAChD;AAAA,EACD;AACD,SAAOrG,UAAU3wD,UAAUsmD,OAAOhiD,MAAMD,MAAM4G,SAAAA;AAC9C,GAEDgR,MAAM,SAAS3Q,IAAAA;AACd,MAAGjH,KAAK+5B,OAAO9yB,KAAI;AAClBjH,SAAK25B,QAAQ1yB,EAAIoW,EAAAA,QAAQ;AAEzBrd,SAAK4yD,yBAAyB;AAC9B5yD,SAAK+H,UAAU,cAAc,CAACd,EAC9B,CAAA;AAAA,EAAA;AACD,GAED8pB,OAAO,SAAS9pB,IACf;AAAA,MAAGjH,KAAK+5B,OAAO9yB,KAAI;AAClBjH,SAAK25B,QAAQ1yB,EAAIoW,EAAAA,QAAQ;AAEzBrd,SAAK4yD,yBAAyB;AAC9B5yD,SAAK+H,UAAU,eAAe,CAACd,EAC/B,CAAA;AAAA,EAAA;AACD,GAEDgI,YAAY,WACXq9C;AAAAA,YAAU3wD,UAAUsT,WAAWpT,KAAKmE,IACpCA;AAAAA,OAAKmvD,YAAY;AACjBnvD,OAAK8sD,mBAAmB;AACxB9sD,OAAK2vD,0BAA0B;AAC/B,EAEFrD,GAAAA,UAAU3wD,SAGX;AAAA,SAAS4zC,WAAWC,OAAO/mC;AAC1B,SAAO3I,OAAO0vC,WAAW1vC,OAAO2I,MAAAA;AACjC;ACjqBA,SAASoqD,2BAA2B/7C,OACnC;AAAA,MAAIg8C,aAAa;AAEjB,MAAIC,aAAaj8C,MAAMw2C;AAEvB,WAAS/xB,SAASt0B;AACjB6rD,iBAAa;AACb9yD,SAAK+H,UAAU,mBAAmB,CAACd;EACnC;AAED6P,QAAMw2C,mBAAmB,SAASrmD,IACjC;AAAA,QAAG6rD,cAAc7rD,IAAG;AACnBs0B,eAAS1/B,KAAKmE,MAAMiH,EAAAA;AAAAA,IACpB;AAED,QAAG6rD,cAAc9yD,KAAKkqD,UAAS;AAC9BlqD,WAAKkqD,SAAS,SAAS8I,SACtB;AAAA,YAAGA,QAAQ/rD,MAAM6rD,YAAW;AAC3Bv3B,mBAAS1/B,KAAKmE,MAAMgzD,QAAQ/rD,EAAAA;AAAAA,QAC5B;AAAA,MACD,GAAEA,EAAAA;AAAAA,IACH;AAED,WAAO8rD,WAAW9yD,MAAMD,MAAM4G,SAChC;AAAA,EAAA;AAECkQ,QAAMtP,YAAY,cAAc,SAASwvB,OAAOC,OAAAA;AAC/C,QAAIngB,MAAM4kB,cAAmB1E,KAAAA,OAAO;AACnClgB,YAAMwkB,OAAO,WACZxkB;AAAAA,cAAMykB,SAASvE,KAAAA;AACflgB,cAAMhc,OAAOm8B,KAAAA;AAAAA,MACjB,CACG;AAAA,IAAA;AAAA,EACH,CAEC;AAAA,SAAO,EACNn8B,QAAQ,SAASmM;AAChB,QAAIA,IAAG;AAEN,UAAG6rD,cAAc7rD,GAChB,QAAO6rD;AAER,UAAA,CAAI9yD,KAAK2sD,eAAe;AACvB,aAAK3sD,KAAK+H,UAAU,kBAAkB,CAACd,EAAAA,CAAAA,GAAM;AAC5C,iBAAO;AAAA,QACP;AAAA,MACD;AAEDjH,WAAKu7B,SAAAA;AAELu3B,mBAAa7rD;AAEb,UAAA,CAAIjH,KAAK2sD,eAAe;AACvB3sD,aAAKk6B,QAAQjzB,EACbjH;AAAAA,aAAK+H,UAAU,iBAAiB,CAACd,EACjC,CAAA;AAAA,MAAA;AAAA,IACD;AACD,WAAO6rD;AAAAA,EACP,GACDp3B,eAAe,WACd;AAAA,WAAOo3B;AAAAA,EACP,GACDl3B,YAAY,SAAS30B,IAAAA;AACpB,WAAOA,MAAM6rD;AAAAA,EACb,GACDv3B,UAAU,SAASt0B,IAClB;AAAA,QAAIA,KAAKA,MAAM6rD;AACf,QAAI7rD,CAAAA,GACH;AACD6rD,iBAAa;AACb,QAAA,CAAI9yD,KAAK2sD,eAAc;AACtB3sD,WAAKk6B,QAAQjzB,EACbs0B;AAAAA,eAAS1/B,KAAKmE,MAAMiH,EAAAA;AAAAA,IACpB;AAAA,EACD,EAEH;AAAA;AC1Ee,SAAQgsD,WAAClwD,QAAAA;AACvB,SAAO00C,IAAIc,UAAWx1C,CAAAA,OAAMgC;AAC7B;ACFA,MAAMmuD,qBAAqB,SAAS71D,MAAM0F,QAAAA;AAEzC,QAAM+T,QAAQ/T,OAAMsoC,aAAahuC,IAAAA;AAEjC,QAAM81D,gBAAgB,EACrBC,YAAY,SAASnsD,IAAIosD,UAExB;AAAA,UAAMC,UAAUD,SAASE,UAAAA;AAEzB,UAAM3pD,OAAOkN,MAAM6iB,QAAQ1yB;AAC3B,QAAG2C,QAAQkN,MAAMnd,UAAUsN,EAAAA,GAAK;AAC/B,eAASnL,IAAI,GAAGA,IAAIw3D,QAAQv3D,QAAQD,IACnCw3D,SAAQx3D,GAAG03D,YAAY5pD,IAAAA;AAAAA,IACxB;AAAA,EACD,GACD6pD,aAAa,SAASJ,UAAAA;AACrB,UAAM/8B,YAAY+8B,SAASE,UAC3B;AAAA,aAASz3D,IAAI,GAAGA,IAAIw6B,UAAUv6B,QAAQD,KAAK;AAC1Cw6B,gBAAUx6B,CAAGuL,EAAAA,MAAAA;AAAAA,IACb;AAED,QAAIqsD,UAAU;AAEd,UAAMC,eAAe,CAAA;AACrB,aAAS73D,IAAI,GAAGA,IAAIw6B,UAAUv6B,QAAQD,KAAK;AAC1C,YAAM83D,QAAQt9B,UAAUx6B;AACxB,UAAI+3D;AACJ,UAAGD,MAAME,mBAAkB;AAE1B,YAAIh6C,QAAQ85C,MAAME,kBAAkBh9C,KACpC;AAAA,YAAGgD,MAAMjO,UAAUxL,UAAayZ,MAAMhO,QAAQzL,QAAU;AACvD,cAAIgZ,MAAMS,MAAMjO,QAAQ,QAAQiO,MAAMhO;AACtC,cAAG6nD,aAAat6C,GAAAA,GAAK;AACpBw6C,wBAAYF,aAAat6C,GAAAA;AAAAA,UAChC,OAAW;AACJw6C,wBAAY/8C,MAAM62C,cAAc7zC,MAAMjO,OAAOiO,MAAMhO,GAAAA;AACnD6nD,yBAAat6C,GAAAA,IAAOw6C;AAAAA,UACpB;AAAA,QACP,WAAc/5C,MAAMi6C,QAAQ1zD,QAAU;AAChCwzD,sBAAY/5C,MAAMi6C,IAAIxqD,IAAI,SAAStC,IAClC;AAAA,mBAAO6P,MAAM6iB,QAAQ1yB,EAAAA;AAAAA,UAC5B;QACA,OAAU;AACJ,gBAAM,IAAIyxC,MAAM,4DAChB;AAAA,QAAA;AAAA,MACN,OAAS;AACJ,aAAIgb,SAAQ;AACXA,oBAAU58C,MAAM42C,gBAChB;AAAA,QAAA;AACDmG,oBAAYH;AAAAA,MACZ;AAED,UAAIE,MAAMI,cAAc;AAEvBJ,cAAMI,aAAaH,SAAAA;AAAAA,MACnB;AAEDv9B,gBAAUx6B,CAAAA,EAAGm4D,aAAaJ,SAC1B;AAAA,IAAA;AAAA,EACD,GACDK,aAAa,SAASN,OAAAA;AACrB,QAAGA,MAAMO,cAAa;AACrB,UAAI1hD,QAAO;AACX,UAAGmhD,MAAME,mBAAkB;AAE1B,YAAIh6C,QAAQ85C,MAAME,kBAAkBh9C,KAAAA;AACpC,YAAGgD,MAAMjO,UAAUxL,UAAayZ,MAAMhO,QAAQzL,QAAU;AACvDoS,UAAAA,QAAOqE,MAAM62C,cAAc7zC,MAAMjO,OAAOiO,MAAMhO,GAAAA;AAAAA,QAC9C;AACD,YAAGgO,MAAMi6C,QAAQ1zD,QAAU;AAC1B,cAAI+zD,eAAet6C,MAAMi6C,IAAIxqD,IAAI,SAAStC;AACzC,mBAAO6P,MAAM6iB,QAAQ1yB,EAC5B;AAAA,UAAA,CAAA;AAEM,cAAGmtD,aAAar4D,SAAS,GAAE;AAC1Bq4D,2BAAeA,aAAanS,OAAOtkD,aAAWA,YAAY0C;AAC1DoS,YAAAA,QAAOA,MAAKvK,OAAOksD,YAAAA;AAAAA,UACnB;AAAA,QACD;AACD,aAAIt6C,MAAMjO,SAASxL,UAAayZ,MAAMhO,OAAOzL,WAAcyZ,MAAMi6C,OAAO1zD,QAAY;AACnF,gBAAM,IAAIq4C,MAAM,4DAChB;AAAA,QAAA;AAAA,MACN,OAAS;AACJjmC,QAAAA,QAAOqE,MAAM42C;MACb;AAED,UAAIkG,MAAMI,cAAc;AAEvBJ,cAAMI,aAAavhD,OAAMmhD,KAAAA;AAAAA,MACzB;AACDA,YAAMO,aAAa1hD;IACnB;AAAA,EACD,EAAA;AAGFqE,QAAMtP,YAAY,kBAAkB,SAASP,IAAI2C,MAAMkP,QAAAA;AACtD,QAAGm6C,WAAWlwD,MAAO,GAAA;AACpB,aAAO;AAAA,IACP;AAED,UAAMswD,WAAWtwD,OAAMc,UAAUC,WAAW,QAAUuwD,EAAAA,cAAch3D;AACpE,QAAGg2D,UAAS;AACXA,eAASiB,kBAAkB,SAASV,OAAAA;AACnCT,sBAAce,YAAYN;MAC9B;AAAA,IACG;AAAA,EACH,CAEC;AAAA,WAASW,YAAYxxD,QAAAA;AACpB,UAAMa,QAAQb,OAAMc,UAAUC,WAAW,OACzC;AAAA,QAAGF,MAAM2J,SAAS,aAAA,EAAeinD,cAAa;AAC7C,aAAO;AAAA,IACV,OAAO;AACJ,aAAO;AAAA,IACP;AAAA,EACD;AAED19C,QAAMtP,YAAY,kBAAkB,SAASP,IAAI2C,MAAMkP;AACtD,QAAGy7C,YAAYxxD,MAAO,GAAA;AACrB;AAAA,IACA;AACD,SAAIkE,MAAM6R,UAAU,UAAUA,UAAU,UAAS;AAChDhC,YAAM/O,UAAU,sBAAsB,CAAA,CAAA;AACtC+O,YAAM/O,UAAU,qBAAqB,CACxC,CAAA;AAAA,IAAA,OAAO;AACJ+O,YAAM/O,UAAU,uBAAuB,CAAC6B,KAAK3C,EAAAA,CAAAA;AAC7C6P,YAAM/O,UAAU,sBAAsB,CAAC6B,KAAK3C,EAC5C,CAAA;AAAA,IAAA;AAAA,EACH;AAEC6P,QAAMtP,YAAY,qBAAqB,WACtC;AAAA,QAAGyrD,WAAWlwD,MAAAA,GAAO;AACpB,aAAO;AAAA,IACP;AAED,UAAMswD,WAAWtwD,OAAMc,UAAUC,WAAW,QAAUuwD,EAAAA,cAAch3D,IACpE;AAAA,QAAGg2D,YAAakB,CAAAA,YAAYxxD,SAAO;AAClCowD,oBAAcM,YAAYJ,QAC1B;AAAA,IAAA;AAAA,EACH;AACCv8C,QAAMtP,YAAY,sBAAsB,SAASP,IAChD;AAAA,QAAGgsD,WAAWlwD,MAAO,GAAA;AACpB,aAAO;AAAA,IACP;AAED,UAAMswD,WAAWtwD,OAAMc,UAAUC,WAAW,QAAA,EAAUuwD,cAAch3D,IAAAA;AACpE,QAAGg2D,UAAS;AACXF,oBAAcC,WAAWnsD,IAAIosD;IAC7B;AAAA,EACH,CAAA;AAGCv8C,QAAMtP,YAAY,cAAc,WAAA;AAC/B,QAAGyrD,WAAWlwD,MAAAA,GAAO;AACpB,aAAO;AAAA,IACP;AAEDA,IAAAA,OAAM2C,OAAAA;AAAAA,EACR,CAECoR;AAAAA,QAAMtP,YAAY,eAAe;AAChC,QAAGyrD,WAAWlwD,SAAO;AACpB,aAAO;AAAA,IACP;AAEDA,IAAAA,OAAM2C,OACR;AAAA,EAAA,CAAA;AAEC,WAAS+uD,UAAUnB,SAASt8B,OAAOC,OAAOrtB,MACzC;AAAA,aAAS9N,IAAI,GAAGA,IAAIw3D,QAAQv3D,QAAQD,KAAK;AACxCw3D,cAAQx3D,GAAG44D,UAAU19B,OAAOC;IAC5B;AAAA,EACD;AAEDngB,QAAMtP,YAAY,cAAc,SAASwvB,OAAOC,OAC/C;AAAA,QAAGg8B,WAAWlwD,MAAO,GAAA;AACpB,aAAO;AAAA,IACP;AAKD+T,UAAM/O,UAAU,oBAAoB,CAACivB,OAAOC,KAAAA,CAAAA;AAE5C,QAAGs9B,YAAYxxD,SAAO;AACrB;AAAA,IACA;AACD,QAAI+T,CAAAA,MAAMy0C,YAAW;AACpB,YAAM8H,WAAWtwD,OAAMc,UAAUC,WAAW,UAAUuwD,cAAch3D,IAAAA;AACpE,UAAGg2D,UAAS;AACXoB,kBAAUpB,SAASE,UAAav8B,GAAAA,OAAOC,OAAOngB,MAAM6iB,QAAQ1C,KAAAA,CAAAA;AAC5Dk8B,sBAAcC,WAAWn8B,OAAOo8B;MACpC,OAAQ;AAEJtwD,QAAAA,OAAM2C,OACN;AAAA,MAAA;AAAA,IACD;AAAA,EACH,CAAA;AAEA;AAEA,MAAeivD,kBAAA,EACdC,eAAe1B;AClMhB,SAAS2B,gBAAAA;AACR,MAAIC,aAAa90D,KAAK6D,UAAUC,WAAW,YAC3C;AAAA,MAAIye,MAAM,CACV;AAAA,WAAQzmB,IAAI,GAAGA,IAAIg5D,WAAW/4D,QAAQD,KAAI;AACzC,QAAIgb,QAAQ9W,KAAKqrC,aAAaypB,WAAWh5D,CACzC,CAAA;AAAA,QAAA,CAAIgb,MAAMob,YAAW;AACpB3P,UAAIvjB,KAAK8X,KACT;AAAA,IAAA;AAAA,EACD;AACD,SAAOyL;AACR;AAEA,IAAIwyC,wBAAwB,WAC3B;AAAA,SAAO,EACPx8B,iBAAiB,SAASjzB,SAEzB;AAAA,QAAI0vD,cAAc1vD,QAAO2M,QAAQ,IAAI/W,YAAAA,KAAiB,kBAAkBg0D,gBAAgB5C;AAExF,QAAIhnD,SAAQ;AACX,UAAI2vD,OAAOj1D;AACXsF,MAAAA,QAAOoqD,gBAAgB,WAAY;AAAA,eAAOuF,KAAK3vD,OAAO0xC;AAAAA;AACtD1xC,MAAAA,QAAO6nD,cAAc,WAAY;AAAA,eAAO8H,KAAK3vD,OAAOitC;AAAAA;IACpD;AAED,QAAIz7B,QAAQ,IAAIk+C,WAAW1vD;AAC3BtF,SAAKwS,MAAMsE,OAAOo+C,2BAAsBp+C,KAExC,CAAA;AAAA,QAAIxR,QAAOjI,MAAM;AAChB,UAAI83D,gBAAgB;AACpB,UAAIC,kBAAkBD,gBAAgB7vD,QAAOjI;AAE7CyZ,YAAMtP,YAAY,cAAa,WAC9BxH;AAAAA,aAAK6D,UAAUwtC,YAAY+jB,eAAAA;AAC3B,YAAIC,aAAYr1D,KAAK6D,UAAUC,WAAW,YAC1C;AAAA,iBAAQhI,IAAI,GAAGA,IAAIu5D,WAAUt5D,QAAQD,KAAI;AACxC,cAAGu5D,WAAUv5D,CAAAA,MAAOwJ,QAAOjI,MAAK;AAC/Bg4D,YAAAA,WAAUh5D,OAAOP,GAAG,CAAA;AACpB;AAAA,UACA;AAAA,QACD;AAAA,MACL,GAAK6L,KAAK3H,IAEPA,CAAAA;AAAAA,WAAK6D,UAAUwtC,YAAY+jB;AAC3Bp1D,WAAK6D,UAAU0tC,WAAW6jB,iBAAiB,WAAA;AAAa,eAAOt+C;AAAAA,MAAM,CAAA;AAErE,UAAIu+C,YAAYr1D,KAAK6D,UAAUC,WAAW,YAC1C;AAAA,UAAA,CAAKuxD,WAAW;AACfA,oBAAY,CAAA;AACZr1D,aAAK6D,UAAU0tC,WAAW,cAAc,WAAA;AAAa,iBAAO8jB;AAAAA,QAAU;AACtEA,kBAAUr2D,KAAKsG,QAAOjI,IAC1B;AAAA,MAAA,WAAcg4D,UAAUp4D,QAAQqI,QAAOjI,IAAAA,IAAQ,GAAG;AAC9Cg4D,kBAAUr2D,KAAKsG,QAAOjI,IACtB;AAAA,MAAA;AAEDs3D,sBAAgBC,cAActvD,QAAOjI,MAAM2C,IAAAA;AAAAA,IAE3C;AAED,WAAO8W;AAAAA,EACP,GACDu0B,cAAc,SAAShuC,MAAAA;AACtB,WAAO2C,KAAK6D,UAAUC,WAAW,eAAezG,IAAAA;AAAAA,EAChD,GACDi4D,gBAAgBT,eAEhBU,aAAa;AACZ,QAAIC;AACJ,SAAIvC,WAAWjzD,IAAAA,GAAM;AACpBw1D,oBAAcx1D,KAAK2Q,eACnB;AAAA,IAAA;AAED3Q,SAAK+H,UAAU,sBAAsB,CAErC,CAAA;AAAA,QAAI0tD,SAASZ,cAAch5D,KAAKmE;AAChC,aAAQlE,IAAI,GAAGA,IAAI25D,OAAO15D,QAAQD,KAAI;AACrC25D,aAAO35D,CAAAA,EAAGo+B,QACV;AAAA,IAAA;AAED,QAAGl6B,KAAKsF,OAAO8tC,mBAAoB6f,CAAAA,WAAWjzD,IAAUw1D,MAAAA,YAAYh8D,KAAKg8D,YAAYn8D,IAAG;AACvF2G,WAAKsU,SAASkhD,YAAYh8D,GAAGg8D,YAAYn8D,CACzC;AAAA,IAAA;AACD2G,SAAK+H,UAAU,gBAAgB,CAE/B,CAAA;AAAA,EAAA,GAED9G,WAAW,SAASkwD,SAAStiC,UAAAA;AAC5B,WAAO7uB,KAAK81B,MAAMC,WAAW90B,UAAUkwD,SAAStiC,QAAAA;AAAAA,EAChD,GAEDoN,aAAa,SAAU3N,QAAQonC,eAC9B;AAAA,QAAIvnD,OAAOnO,KAAKkf,QAAQoP,MACxB;AAAA,QAAI2mC,OAAOj1D;AACX,aAAS21D,eACR;AAAA,UAAID,kBAAkBr1D,UAAAA,CAAcq1D,cACnC;AACD,eAAS55D,IAAI,GAAGA,IAAIqS,KAAKs+B,QAAQ1wC,QAAQD,KAAK;AAC7Cm5D,aAAKW,YAAYznD,KAAKs+B,QAAQ3wC,CAC9B,CAAA;AAAA,MAAA;AACD,eAASA,IAAI,GAAGA,IAAIqS,KAAKu+B,QAAQ3wC,QAAQD,KAAK;AAC7Cm5D,aAAKW,YAAYznD,KAAKu+B,QAAQ5wC,CAAAA,CAAAA;AAAAA,MAC9B;AAAA,IACD;AAED,QAAIqS,QAAQnO,KAAKivB,cAAcX,MAAS,GAAA;AACvCtuB,WAAK81B,MAAMC,WAAWmE,QAAQ5L,QAAAA,CAAAA,CAAUtuB,KAAKuN,SAAS,YAAYm+B,WAAWgqB,kBAAkB,KAC/FC;AAAAA,mBAAAA;AAAAA,IACA,WAAQ31D,KAAKygB,aAAa6N,MAAAA,KAAWtuB,KAAKygB,aAAazgB,KAAK8uB,UAAUR,aAAatuB,KAAK61D,WAAU;AAClG71D,WAAKi8B,YAAYj8B,KAAK8uB,UAAUR,MAAAA,CAAAA;AAEhC,UAAIwnC,iBAAiB;AACrB91D,WAAKmqD,WAAW,SAASrpD,QAAAA;AACxB,YAAGg1D,kBAAkB91D,KAAK+1D,YAAYj1D,SAAQ;AAC7Cg1D,2BAAiB;AAAA,QACjB;AAAA,MACD,GAAExnC,MAAAA;AACH,UAAGwnC,gBAAe;AACjBH;MACA;AAAA,IACD;AAAA,EAED,GACDC,aAAa,SAAUjpB,QACtB3sC;AAAAA,SAAK81B,MAAMq1B,WAAWjxB,QAAQyS,QAAU3sC,CAAAA,CAAAA,KAAKuN,SAAS,UAAA,EAAYm+B,OAClE;AAAA,EAAA,GAEDpQ,QAAQ,SAAS3gB,MAAAA;AAChB,QAAI5X,SAAQ/C;AACZ+C,IAAAA,OAAM+yB,MAAMC,WAAWuF,OAAO;AAC7Bv4B,MAAAA,OAAM+yB,MAAMq1B,WAAW7vB,OAAO,WAAA;AAC7B3gB,aACJ;AAAA,MAAA,CAAA;AAAA,IACA,CACE;AAAA,EAAA,GAEDozC,UAAU,WACT;AAAA,QAAI0H,SAASZ,cAAch5D,KAAKmE;AAIhC,aAAQlE,IAAI,GAAGA,IAAI25D,OAAO15D,QAAQD,KAAI;AACrC25D,aAAO35D,CAAGw/B,EAAAA,OAAO;AAChBm6B,eAAO35D,CAAAA,EAAGiyD,SACd;AAAA,MAAA,CAAA;AAAA,IACG;AAED,aAAQjyD,IAAI,GAAGA,IAAI25D,OAAO15D,QAAQD,KAAI;AACrC25D,aAAO35D,CAAAA,EAAGiyD,SACV;AAAA,IAAA;AAED/tD,SAAKg2D,cAAAA;AACLh2D,SAAKi2D,WAAW;AAChBj2D,SAAK+H,UAAU,WAAW,CAC1B/H,CAAAA;AAAAA,SAAK0F,OACL;AAAA,EAAA,GACDwwD,aAAa,WAAA;AACZl2D,SAAK81B,MAAMC,WAAWg4B;AACtB/tD,SAAK81B,MAAMq1B,WAAW4C,SACtB/tD;AAAAA,SAAKg2D,cACLh2D;AAAAA,SAAKi2D,WAAW;EAChB,GAED5kC,YAAY,SAASpqB,IACpB;AAAA,QAAI6P,QAAQ9W,KAAK81B,MAAMC;AACvB,QAAA,CAAI/1B,KAAKsF,OAAO61B,YACf,QAAO;AACRl0B,SAAK+D,mBAAmB/D,IAAIjH,KAAKsF,OAAOuV,OACxC;AAAA,QAAI5T,IAAG;AACN,UAAIkvD,cAAcn2D,KAAK07B,cAEvB5kB;AAAAA,YAAMs/C,uBAAuB;AAC7Bt/C,YAAMhc,OAAOmM,EACb6P;AAAAA,YAAMs/C,uBAAuB;AAG7B,UAAID,eAAer/C,MAAMy1C,KAAK4J,WAAAA,EAAavnC,kBAAkBunC,eAAelvD,IAAI;AAC/EjH,aAAKi8B,YAAYk6B,WACjB;AAAA,MAAA;AACD,UAAIr/C,MAAMy1C,KAAKtlD,EAAI2nB,EAAAA,kBAAkBunC,eAAelvD,IAAI;AACvDjH,aAAKi8B,YAAYh1B,EAAAA;AAAAA,MACjB;AAAA,IACD;AACD,WAAO6P,MAAM4kB;EACb,GACDpK,cAAc,SAASrqB,IAAAA;AACtB,QAAI6P,QAAQ9W,KAAK81B,MAAMC;AACvBjf,UAAMykB,SAASt0B,EAGf;AAAA,QAAIA,MAAM6P,MAAMy1C,KAAKtlD,IAAI2nB,gBAAgB;AACxC5uB,WAAKi8B,YAAYh1B,EAAAA;AAAAA,IACjB;AAAA,EACD,GACDmqB,gBAAgB,SAASnqB;AACxB,WAAOjH,KAAK81B,MAAMC,WAAW6F,WAAW30B,EAAAA;AAAAA,EACxC,GACDy0B,eAAe,WAAA;AACd,WAAO17B,KAAK81B,MAAMC,WAAW2F;EAC7B,EAEF;AAAA;AAEA,SAAS26B,eACR;AAAA,MAAI9zC,MAAMgkC,MAAY,IAAIwO,sBAAAA,CAAAA;AAC1BxO,QAAYhkC,KAAK+zC;AACjB/P,QAAYhkC,KAAKg0C,uBACjB,CAAA;AAAA,SAAOh0C;AACR;AAKA,MAAAi0C,gBAAe,EAAC9kD,QAAQ2kD,aAAAA;AC3NxB,SAASI,YAAY1zD;AACpB,MAAIs6C,aAAat6C,OAAMsP;AACvB,MAAI6+B,YAAWnuC,OAAMc;AAErB,SAAO,EACN6yD,QAAQ,SAAUC,OAAOtO,MAAMC,IAAAA;AAC9B,QAAIA,OAAOjoD,OACVioD,MAAKqO,MAAM56D,SAAS;AACrB,QAAIssD,SAAShoD,OACZgoD,QAAO;AAER,QAAIuO,OAAO;AACX,aAAS96D,IAAIusD,MAAMvsD,KAAKwsD,IAAIxsD,IAC3B86D,SAAQD,MAAM76D,CAEf;AAAA,WAAO86D;AAAAA,EACP,GACDC,aAAa,SAAUC,WAAW7qC,OAAOo8B,MAAMC,IAC9C;AAAA,QAAI//B,QAAQ0D,MAAMxyB;AAElB,QAAI6uD,OAAOjoD,OACVioD,MAAK//B,MAAMxsB,SAAS;AACrB,QAAIssD,SAAShoD,OACZgoD,QAAO;AACR,QAAItsD,SAASusD,KAAKD,OAAO;AAEzB,QAAIA,OAAO9/B,MAAMxsB,SAAS,KAAKA,UAAU,KAAKusD,KAAK//B,MAAMxsB,SAAS,EACjE;AAED,QAAIg7D,WAAW/2D,KAAK02D,OAAOnuC,OAAO8/B,MAAMC,EAExC;AAAA,QAAI4I,OAAO4F,YAAYC;AAEvB/2D,SAAKg3D,WAAW9F,MAAM3oC,OAAO8/B,MAAMC,EAAAA;AACnCtoD,SAAKg3D,WAAY9F,CAAAA,MAAM3oC,OAAO+/B,KAAK,CAEnCr8B;AAAAA,UAAMgrC,aAAaj3D,KAAK02D,OAAOnuC;EAC/B,GACD2uC,WAAW,SAAUz9D,OAAOqwD,OAAAA;AAC3B,QAAI1gD,MAAM,CACV;AAAA,aAAStN,IAAI,GAAGA,IAAIguD,OAAOhuD,IAAKsN,KAAItN,CAAK,IAAA;AAEzCkE,SAAKg3D,WAAWv9D,OAAO2P,GAAAA;AACvB,WAAOA;AAAAA,EAEP,GACD4tD,YAAY,SAAUv9D,OAAO8uB,OAAO8/B,MAAMC,IAAAA;AACzC,QAAKD,CAAAA,KACJA,QAAO;AACR,QAAIC,OAAOjoD,OACVioD,MAAK//B,MAAMxsB,SAAS;AAErB,QAAIA,SAASusD,KAAKD,OAAO;AAEzB,QAAI8O,OAAOn3D,KAAK02D,OAAOnuC,OAAO8/B,MAAMC,EAEpC;AAAA,aAASxsD,IAAIusD,MAAMvsD,KAAKwsD,IAAIxsD,KAAK;AAChC,UAAIs7D,QAAQ99D,KAAKkS,MAAM/R,SAAS09D,OAAQ5uC,MAAMzsB,KAAKq7D,OAAS,IAAIp7D,OAEhEo7D;AAAAA,cAAQ5uC,MAAMzsB,CAAAA;AACdrC,eAAS29D;AACTr7D;AAEAwsB,YAAMzsB,CAAMs7D,KAAAA;AAAAA,IACZ;AACD7uC,UAAMA,MAAMxsB,SAAS,CAAA,KAAMtC;AAAAA,EAC3B,GACD49D,YAAY,SAAUljD,QAAAA;AACrB,aAASmjD,SAASpuD,MAAMuW,MAAAA;AACvB,UAAI/e,IAAI,IAAIgY,KAAK,MAAM,GAAG,CAAA;AAC1B,aAAO2kC,WAAW/wC,IAAI5L,GAAG+e,MAAMvW,IAAAA,IAAQxI;AAAAA,IACvC;AAEDyT,WAAOlY,KAAK,SAAU1B,GAAG2B,GAAAA;AACxB,UAAIo7D,SAAS/8D,EAAE2O,MAAM3O,EAAEklB,IAAAA,IAAQ63C,SAASp7D,EAAEgN,MAAMhN,EAAEujB,IAAAA,GAAO;AACxD,eAAO;AAAA,MACP,WAAU63C,SAAS/8D,EAAE2O,MAAM3O,EAAEklB,IAAQ63C,IAAAA,SAASp7D,EAAEgN,MAAMhN,EAAEujB,IAAAA,GAAO;AAC/D,eAAQ;AAAA,MACb,OAAW;AACN,eAAO;AAAA,MACP;AAAA,IACL,CAEG;AAAA,aAAS3jB,IAAI,GAAGA,IAAIqY,OAAOpY,QAAQD,KAAK;AACvCqY,aAAOrY,CAAAA,EAAG0K,QAAQ1K;AAAAA,IAClB;AAAA,EACD,GACDy7D,eAAe,SAASjyD,SAAAA;AACvB,QAAIkyD,cAAclyD,WAAUvC,OAAMuC;AAClC,WAAOkyD,YAAYC,cAAcD,YAAY73C,cAAc63C,YAAYE;AAAAA,EACvE,GACDC,qBAAqB,SAAS1rC,OAAAA;AAC7B,QAAIvM,SAASuM,MAAMvM;AACnB,QAAIA,CAAAA,QAAO;AACVA,eAASuM,MAAMtV,YAAYsV,MAAM5Z,QAAQ;AAAA,IACzC;AAED,QAAA,OAAUqN,WAAW,UAAS;AAC7BA,eAAS3c,OAAMsP,KAAKqD,YAAYgK,MAChC;AAAA,IAAA;AACD,WAAO,EACNxW,MAAM+iB,MAAM/iB,QAAQ,OACpBuW,MAAMwM,MAAMxM,QAAQ,GACpBC,QACAhhB,KAAKutB,MAAMvtB,IAEZ;AAAA,EAAA,GACDk5D,cAAc,SAAStyD,SAAAA;AACtB,QAAI4P,aAAYg8B,UAASptC,WAAW,gBAAA;AACpC,QAAI+zD,aAAa73D,KAAKu3D,cAAcjyD,OAAAA;AAEpC,QAAIkyD,cAAclyD,WAAUvC,OAAMuC;AAElC,QAAItB;AACJ,QAAG6zD,YAAW;AACb3iD,MAAAA,WAAU2xC,aAAa,cAAcxmD,QAAWA,QAAWm3D,aAAaz0D,OAAMuC,OAAO4P,SACrFlR;AAAAA,eAAS,EACRkF,MAAMnG,OAAMuC,OAAOmyD,YACnBh4C,MAAM1c,OAAMuC,OAAOma,MACnB9I,UAAU5T,OAAMmS,UAAUyK,YAC1BtN,MAAMtP,OAAMuC,OAAOqa,YACnBjhB,KAAKqE,OAAMmS,UAAUuyC,iBAE1B;AAAA,IAAA,OAAQ;AACJ,UAAImQ,eAAeJ,YAAYrjD,OAAO,CACtCnQ;AAAAA,eAAS,EACRkF,MAAM0uD,aAAa1uD,MACnBuW,MAAMm4C,aAAan4C,MACnB9I,UAAUihD,aAAajhD,UACvB+I,QAAQk4C,aAAal4C,QACrBrN,MAAMulD,aAAavlD,MACnB3T,KAAKk5D,aAAal5D,OAAOqE,OAAMmS,UAAUuyC,iBAAAA;AAAAA,IAE1C;AAED,WAAOznD,KAAK23D,oBAAoB3zD,MAAAA;AAAAA,EAChC,GACD8zD,cAAc,SAASxyD,SACtB;AAAA,QAAIuyD,aAAa73D,KAAKu3D,cAAcjyD;AACpC,QAAIkyD,cAAclyD,WAAUvC,OAAMuC;AAClC,QAAI6O;AACJ,QAAG0jD,YAAW;AACb,UAAIE,UAAU;AACd,UAAIh1D,OAAM00C,IAAIU,MAAK;AAClB4f,kBAAU;AAAA,MACV;AAEDp2D,cAAQq2D,KAAK;AAAA;AAAA;AAAA,EAGfD,OAAAA,EAAAA;AACE5jD,eAASqjD,YAAYE,aAAa,CACtC;AAAA,IAAA,OAAQ;AACJvjD,eAASqjD,YAAYrjD,OAAOvY,MAAM,CAClC;AAAA,IAAA;AAED,WAAOuY,OAAO5K,KAAI,SAAS0iB,OAAAA;AAC1B,aAAOjsB,KAAK23D,oBAAoB1rC,KAAAA;AAAAA,IACpC,GAAKtkB,KAAK3H,IAAAA,CAAAA;AAAAA,EACP,GAEDqe,gBAAgB,SAAUlK,QAAQ8jD,gBAAgBC,iBAAiB95C,cAAc+5C,SAASC,SAAS35C,KAAAA;AAClG,QAAI45C,UAAUr4D,KAAKk3D,UAAU94C,cAAcjK,OAAOpY,MAAAA;AAClD,QAAIk7D,aAAaiB;AAEjB,QAAII,UAAU,CACd;AAAA,aAASx8D,IAAIqY,OAAOpY,SAAS,GAAGD,KAAK,GAAGA,KAAK;AAC5C,UAAIy8D,aAAcz8D,KAAKqY,OAAOpY,SAAS;AACvC,UAAIy8D,MAAMx4D,KAAKy4D,gBAAgBtkD,OAAOrY,IAAIq8D,SAASC,OAAAA;AACnD,UAAIG,YAAY;AACfv4D,aAAK04D,eAAeF,GACpB;AAAA,MAAA;AAEDx4D,WAAK24D,aAAaH,KAAKP,gBAAgBhB,YAAYoB,QAAQv8D,CAC3DkE,CAAAA;AAAAA,WAAK44D,kBAAkBJ,GAAAA;AAEvB,UAAID,YAAY;AACftB,qBAAauB,IAAIvB;AAAAA,MACjB;AAEDqB,cAAQO,QAAQL,GAChB;AAAA,IAAA;AAGD,aAAS18D,IAAI,GAAGA,IAAIw8D,QAAQv8D,SAAS,GAAGD,KAAK;AAC5CkE,WAAK84D,kBAAkBR,QAAQA,QAAQv8D,SAAS,IAAIu8D,QAAQx8D,CAAAA,CAAAA;AAAAA,IAC5D;AACD,aAASA,IAAI,GAAGA,IAAIw8D,QAAQv8D,QAAQD,KAAK;AAExC,UAAG2iB,KAAI;AACNze,aAAK+4D,aAAaT,QAAQx8D,CAAAA,CAAAA;AAAAA,MAC1B;AACDkE,WAAKg5D,eAAeV,QAAQx8D,CAAAA,CAAAA;AAAAA,IAC5B;AACD,WAAOw8D;AAAAA,EAEP,GAEDS,cAAc,SAAS9sC,OAAAA;AACtBA,UAAMxyB,QAAQwyB,MAAMxyB,MAAMo4D,QAAAA;AAC1B5lC,UAAMjN,UAAUiN,MAAMjN,QAAQ6yC;AAE9B,QAAIoH,UAAUhtC,MAAMitC;AACpBjtC,UAAMitC,gBAAgB;AACtBjtC,UAAMktC,yBAAyB;AAC/BltC,UAAMxN,MAAM;AACZ,aAAQ3iB,IAAI,GAAGA,IAAImwB,MAAMjN,QAAQjjB,QAAQD,KAAI;AAC5CmwB,YAAMitC,cAAcjtC,MAAMjN,QAAQljB,GAAG2R,QAAa3R,CAAAA,IAAAA;AAClDmwB,YAAMktC,uBAAuBF,QAAQhtC,MAAMjN,QAAQljB,CAAG2R,EAAAA,QAAAA,CAAAA,CAAAA,IAAc3R;AAAAA,IACpE;AACD,WAAOmwB;AAAAA,EACP,GAED+sC,gBAAgB,SAAU1zD,SACzB;AAAA,aAASxJ,IAAI,GAAG+C,MAAMyG,QAAO0Z,QAAQjjB,QAAQD,IAAI+C,KAAK/C,KAAK;AAC1DwJ,MAAAA,QAAOxN,KAAKkH,MAAMsG,QAAO7L,MAAMqC,IAAI,MAAM,MAAMwJ,QAAOxN,KAAKgE,IAAI,CAAM,KAAA,EAAA;AAAA,IACrE;AAAA,EACD,GAEDs9D,qBAAqB,SAAU/mD,OAAM4Z,OAEpC;AAAA,QAAIlpB,OAAMuC,OAAO8sC,eAAe;AAC/B,UAAIinB,OAAO;AACX,UAAIC,QAAQjnD;AAGZ,eAASvW,IAAI,GAAGA,IAAImwB,MAAMxM,MAAM3jB,KAAK;AACpC,YAAIA,GAAG;AACNw9D,kBAAQjc,WAAW/wC,IAAI+F,OAAMvW,GAAGmwB,MAAM/iB,IAAAA;AAAAA,QACtC;AAEDmwD,eAAOA,QAAAA,CAASr5D,KAAKu5D,WAAWD,OAAOrtC,MAAM/iB,IAAAA;AAAAA,MAC7C;AAED,aAAOmwD;AAAAA,IACP;AACD,WAAO;AAAA,EACP,GAEDX,gBAAgB,SAAUpzD;AACzBA,IAAAA,QAAOk0D,WAAW;AAClBl0D,IAAAA,QAAOm0D,gBAAgBn0D,QAAOwkD;AAAAA,EAC9B,GACD6O,cAAc,SAAUrzD,SAAQo0D,eAAezC,YAAY0C,aAAAA;AAC1D,QAAIC,aAAa3C;AAEjB3xD,IAAAA,QAAO5L,SAASigE;AAEhB,QAAIE,eAAev0D,QAAOm0D,kBAAkBp5D,SAAYiF,QAAOwkD,QAAQxkD,QAAOm0D;AAE9E,QAAKI,CAAAA,aACJA,gBAAe;AAEhBv0D,IAAAA,QAAOia,YAAYjmB,KAAKkS,MAAMouD,aAAaC,YAE3C;AAAA,QAAIH,eAAe;AAClB,UAAIp0D,QAAOia,YAAYm6C,eAAe;AACrCp0D,QAAAA,QAAOia,YAAYm6C;AACnBE,qBAAat0D,QAAOia,YAAYs6C;AAAAA,MAChC;AAAA,IACD;AACDv0D,IAAAA,QAAO7L,QAAQ;AACf,QAAIqgE,UAAUx0D,QAAOk0D,YAAY;AACjC,aAAS19D,IAAI,GAAGA,IAAIwJ,QAAO0Z,QAAQjjB,QAAQD,KAAK;AAC/C,UAAIg+D,QAAQx0D,QAAO0Z,QAAQljB,CAAG2R,EAAAA,QAAAA,CAAAA,KAAenI,QAAOm0D,iBAAiBn0D,QAAOwkD,OAAQ;AACnFxkD,QAAAA,QAAO7L,MAAMqC,KAAK;AAAA,MACvB,OAAW;AAEN,YAAIrC,QAAQ;AACZ,YAAI6L,QAAO4D,QAAQ,SAAS;AAC3B,cAAI6wD,OAAOzgE,KAAKC,OAAO8jD,WAAW/wC,IAAIhH,QAAO0Z,QAAQljB,CAAIwJ,GAAAA,QAAOma,MAAMna,QAAO4D,QAAQ5D,QAAO0Z,QAAQljB,OAAO,MAAO,KAAK,KAAK,GAC5HrC;AAAAA,kBAAQsgE;AAAAA,QACR;AACDz0D,QAAAA,QAAO7L,MAAMqC,KAAKrC;AAAAA,MAClB;AAAA,IACD;AAEDuG,SAAKg3D,WAAW4C,aAAa55D,KAAK02D,OAAOpxD,QAAO7L,KAAAA,GAAoD6L,QAAO7L,KAAAA;AAC3G6L,IAAAA,QAAO2xD,aAAaj3D,KAAK02D,OAAOpxD,QAAO7L,KAAAA;AAAAA,EACvC,GACDg/D,iBAAiB,SAAUnzD,SAAQ+O,UAAU7G,UAC5C;AAAA,QAAIgrD,MAAMjS,MAAY,EACrBuD,OAAO,GACPvqC,WAAW,GACX03C,YAAY,GACZv9D,QAAQ,GACRD,OAAO,CACP3B,GAAAA,MAAM,IACNknB,SAAS,CAAA,GACTk6C,eAAe,CAAE,GACjB7kD,UAAU,IAAIqE,KAAKrE,QACnB7G,GAAAA,UAAU,IAAIkL,KAAKlL,aACjBlI,OAEHtF;AAAAA,SAAKg6D,WAAW10D,QAAO4D,MAAM5D,QAAOma,MAAMpL,UAAU7G,UAAU,SAAU6E,OACvEmmD;AAAAA,UAAI1O;AACJ0O,UAAIx5C,QAAQhgB,KAAK,IAAI0Z,KAAKrG;AAC1BmmD,UAAIU,cAAc7mD,MAAK5E,QAAAA,CAAAA,IAAa+qD,IAAIx5C,QAAQjjB,SAAS;AAAA,IAC7D,CAAA;AAEGy8D,QAAIyB,oBAAoBzB,IAAIx5C,QAAQpjB;AACpC,WAAO48D;AAAAA,EACP,GACD0B,eAAe,SAAUC,aAAaC,aAAa/R,MAAMC,IAAIxgD;AAC5D,QAAIuyD,cAAcD,YAAYp7C;AAC9B,QAAIs7C,cAAcH,YAAYn7C;AAE9B,QAAIzT,OAAO88C,QAAQ;AACnB,QAAIv8C,MAAMw8C,MAAOgS,YAAYv+D,SAAS;AACtC,QAAIw+D,YAAY;AAGhB,aAASvxC,KAAK,GAAGA,KAAKqxC,YAAYt+D,QAAQitB,MAAM;AAC/C,UAAIwxC,eAAgBL,YAAYjB,cAAemB,CAAAA,YAAYrxC;AAC3D,UAAIwxC,iBAAiBn6D,UAAam6D,gBAAgB1uD,KAAK;AACtD,YAAIhE,UAAU;AACbA,mBAAS7H,MAAMD,MAAM,CAACu6D,WAAWvxC,IAAIzd,MAAMivD;QAC3C;AACDjvD,eAAOivD;AACPD,oBAAYvxC;AACZ;AAAA,MACA;AAAA,IACD;AAAA,EACD,GACD8vC,mBAAmB,SAAUqB,aAAaC,aAAa/R,MAAMC,IAC5DtoD;AAAAA,SAAKk6D,cAAcC,aAAaC,aAAa/R,MAAMC,IAAI,SAAUmS,aAAaC,WAAWC,aAAaC,WAAAA;AACrG,UAAIC,cAAc76D,KAAK02D,OAAOyD,YAAY1gE,OAAOkhE,aAAaC,YAAY,CAC1E;AAAA,UAAIE,cAAc96D,KAAK02D,OAAO0D,YAAY3gE,OAAOghE,aAAaC,YAAY;AAC1E,UAAII,eAAeD,aAAa;AAC/B76D,aAAK62D,YAAYgE,aAAaT,aAAaK,aAAaC,YAAY,CACpE;AAAA,MAAA;AAAA,IAEL;EACG,GAEDV,YAAY,SAAU9wD,MAAMuW,MAAMpL,UAAU7G,UAAU1F,UACrD;AAAA,QAAI+D,QAAQ,IAAI6M,KAAKrE,WACpBvI,MAAM,IAAI4M,KAAKlL,QAAAA;AAChB,QAAI6vC,WAAWn0C,OAAO,QAAW,GAAA;AAChC2C,cAAQwxC,WAAWn0C,OAAO,UAAU2C,KACpC;AAAA,IAAA;AAED,QAAIkvD,OAAO,IAAIriD,KAAK7M;AACpB,QAAKkvD,CAAAA,QAAAA,CAASjvD,KAAK;AAClBA,YAAMuxC,WAAW/wC,IAAIyuD,MAAMt7C,MAAMvW,IACjC;AAAA,IAAA;AACD,WAAQ6xD,CAAAA,OAAAA,CAAQjvD,KAAK;AACpBhE,eAASjM,KAAKmE,MAAM,IAAI0Y,KAAKqiD,IAC7B,CAAA;AAAA,UAAIC,WAAWD,KAAKld,kBACpBkd;AAAAA,aAAO1d,WAAW/wC,IAAIyuD,MAAMt7C,MAAMvW,IAClC6xD;AAAAA,aAAOh4D,OAAMk4D,oBAAoBF,MAAMC,UAAUv7C,MAAMvW,IACvD;AAAA,UAAIm0C,WAAWn0C,OAAO,QAAA,EACrB6xD,QAAO1d,WAAWn0C,OAAO,UAAU6xD,IACpC;AAAA,IAAA;AAAA,EACD,GACDnC,mBAAmB,SAAUJ,KAAAA;AAC5B,QAAIllD,QAAQklD,IAAIx5C;AAEhB,QAAIlnB,OAAO,GAAGC,QAAQygE,IAAI/+D,MAAMsC,SAAS;AACzC,QAAIm1D,OAAO;AACX,QAAK59C,CAAAA,MAAM,MAAMklD,IAAInkD,YAAYvc,QAAQC,OAAO;AAC/C,UAAI0B,QAAQH,KAAKkS,MAAMgtD,IAAI/+D,MAAM,CAAA,MAAO6Z,MAAM,CAAKklD,IAAAA,IAAInkD,aAAaf,MAAM,CAAA,IAAKA,MAAM,CAAA,GAAA;AACrF49C,cAAQsH,IAAI/+D,MAAM,CAAKA,IAAAA;AACvB++D,UAAI/+D,MAAM,CAAA,IAAKA;AAEf6Z,YAAM,CAAA,IAAK,IAAIoF,KAAK8/C,IAAInkD,QAAAA;AAAAA,IACxB;AAED,QAAIonB,OAAOnoB,MAAMvX,SAAS;AAC1B,QAAIm/D,WAAW5nD,MAAMmoB,IAAAA;AACrB,QAAI0/B,UAAU9d,WAAW/wC,IAAI4uD,UAAU1C,IAAI/4C,MAAM+4C,IAAItvD,IACrD;AAAA,QAAA,CAAKiyD,WAAW3C,IAAIhrD,YAAYiuB,OAAO,GAAG;AACzC,UAAIhiC,QAAQ++D,IAAI/+D,MAAMgiC,IAAQniC,IAAAA,KAAKkS,MAAMgtD,IAAI/+D,MAAMgiC,IAAU0/B,MAAAA,UAAU3C,IAAIhrD,aAAa2tD,UAAUD,UAAAA;AAClGhK,cAAQsH,IAAI/+D,MAAMgiC,QAAQhiC;AAC1B++D,UAAI/+D,MAAMgiC,IAAQhiC,IAAAA;AAAAA,IAClB;AAED,QAAIy3D,MAAM;AACT,UAAIiG,OAAOn3D,KAAK02D,OAAO8B,IAAI/+D,KAC3B;AAAA,UAAI2hE,SAAS;AACb,eAASt/D,IAAI,GAAGA,IAAI08D,IAAI/+D,MAAMsC,QAAQD,KAAK;AAC1C,YAAIs7D,QAAQ99D,KAAKkS,MAAM0lD,QAAQsH,IAAI/+D,MAAMqC,CAAAA,IAAKq7D;AAC9CqB,YAAI/+D,MAAMqC,MAAMs7D;AAChBgE,kBAAUhE;AAAAA,MACV;AACDp3D,WAAKg3D,WAAW9F,OAAOkK,QAAQ5C,IAAI/+D;IACnC;AAAA,EAED,EAAA;AAEH;ACrYA,SAAS4hE,mBAAmBnyD,MAAMnG,QACjC;AAAA,MAAI+W,QAAQ,EACX3H,YAAW,MACXC,UAAS,KAGV;AAAA,MAAIrP,OAAMuC,OAAO6M,cAAcpP,OAAMuC,OAAO8M,UAAU;AACrD0H,UAAM3H,aAAapP,OAAMsP,KAAKnJ,OAAO,QAAU,EAAA,IAAIwP,KAAK3V,OAAMuC,OAAO6M;AAErE,QAAIrG,MAAM,IAAI4M,KAAK3V,OAAMuC,OAAO8M;AAChC,QAAIkpD,iBAAiBv4D,OAAMsP,KAAKnJ,OAAO,QAAA,EAAU,IAAIwP,KAAK5M,GAAAA,CAAAA;AAC1D,QAAKA,CAAAA,OAAAA,CAAQwvD,gBAAgB;AAC5BxvD,YAAM/I,OAAMsP,KAAK/F,IAAIgvD,gBAAgB,GAAGpyD;IAC3C,OAAS;AACN4C,YAAMwvD;AAAAA,IACN;AAEDxhD,UAAM1H,WAAWtG;AAAAA,EACjB;AACD,SAAOgO;AACR;AAEA,SAASyhD,kBAAkBx4D,QAC1B;AAAA,MAAI60D,eAAe,IAAK4D,YAAmBz4D,MAAAA,EAAQ60D;AACnD,MAAI1uD,OAAO0uD,aAAa1uD;AACxB,MAAIuW,OAAOm4C,aAAan4C;AACxB,MAAI1c,OAAMuC,OAAO6uC,sBAAsB;AAEtC,QAAIsnB,SAAS,IAAIhF,YAAY1zD,MAAAA;AAC7B,QAAIoR,SAAS,CAACsnD,OAAO7D,aAAAA,CAAAA,EAAgB1vD,OAAOuzD,OAAO3D;AAEnD2D,WAAOpE,WAAWljD;AAClBjL,WAAOiL,OAAOA,OAAOpY,SAAS,CAAA,EAAGmN;AACjCuW,WAAOtL,OAAOA,OAAOpY,SAAS,CAAG0jB,EAAAA,QAAQ;AAAA,EACzC;AACD,SAAO,EAAEvW,MAAWuW,KACrB;AAAA;AAEA,SAASi8C,kBAAkB34D;AAC1B,MAAIy1D,MAAM+C,kBAAkBx4D,MAC5B;AAAA,MAAImG,OAAOsvD,IAAItvD,MACduW,OAAO+4C,IAAI/4C;AACZ,MAAI3F,QAAQuhD,mBAAmBnyD,MAAMnG,MAGrC;AAAA,MAAA,EAAK+W,MAAM3H,cAAc2H,MAAM1H,WAAU;AACxC,QAAIupD,mBAAmB;AACvB,QAAItoD,SAAQtQ,OAAM4K,cAAAA;AAClB,aAAS7R,IAAI,GAAGA,IAAIuX,OAAMtX,QAAQD,KAAK;AACtC,UAAIqS,OAAOkF,OAAMvX,CAAAA;AACjB,UAAIqS,KAAK8D,SAASlP,OAAMuC,OAAOqxB,MAAM3U,SAAQ;AAC5C25C,2BAAmB;AACnB;AAAA,MACA;AAAA,IACD;AACD,QAAItoD,OAAMtX,UAAU4/D,kBAAiB;AACpC,UAAIxpD,aAAakB,OAAM,CAAA,EAAGlB;AAC1B,UAAIC,WAAWrP,OAAMsP,KAAK/F,IAAI6F,YAAY,GAAGpP,OAAMuC,OAAO4sC,aAAAA;AAC1Dp4B,cAAQ,EACP3H,YAAY,IAAIuG,KAAKvG,UACrBC,GAAAA,UAAU,IAAIsG,KAAKtG,QAAAA,EAAAA;AAAAA,IAEvB,OAAQ;AACL0H,cAAQ/W,OAAMof,gBAAAA;AAAAA,IACd;AAED,QAAA,CAAIrI,MAAM3H,cAAe2H,CAAAA,MAAM1H,UAAS;AACvC0H,cAAQ,EACP3H,YAAY,oBAAIuG,QAChBtG,UAAU,oBAAIsG,OAEf;AAAA,IAAA;AAED3V,IAAAA,OAAM6Q,SAAS,SAASzF;AACvB,UAAIpL,OAAMuC,OAAOguC,aAAanlC,MAAKiL,UAAS;AAC3CwiD,4BAAoB9hD,OAAO3L,MAAKiL,UAAUjL,MAAKiL;MAC/C;AACD,UAAIjL,MAAKgL,mBAAmBhL,MAAK0tD,iBAAgB;AAChD,YAAI94D,OAAMuC,OAAOw2D,oBAAoB3tD,MAAK0tD,oBAAoB94D,OAAMuC,OAAOw2D,iBAAiBC,QAAQ5tD,MAAK0tD,oBAAoB94D,OAAMuC,OAAOw2D,iBAAiBE,MAAK;AAC/JJ,8BAAoB9hD,OAAO3L,MAAKgL,iBAAiBhL,MAAKgL;QACtD;AAAA,MACD;AACD,UAAIpW,OAAMuC,OAAO22D,aAAa9tD,MAAK8tD,WAAU;AAC5C9tD,QAAAA,MAAK8tD,UAAU9yD,QAAQ,SAAS8/C,UAC/B2S;AAAAA,8BAAoB9hD,OAAOmvC,SAAS92C,YAAY82C,SAAS72C;QAC9D,CACI;AAAA,MAAA;AAAA,IACJ;AAEE0H,UAAM3H,aAAapP,OAAMsP,KAAKnJ,OAAO,QAAU4Q,EAAAA,MAAM3H,UACrD2H;AAAAA,UAAM3H,aAAapP,OAAMm5D,iBAAiB,EACzC/pD,YAAYpP,OAAMsP,KAAKnJ,OAAO,QAAA,EAAU4Q,MAAM3H,UAAAA,GAC9CgqD,UAAW,IACXjzD,MACAuW,KAGD3F,CAAAA;AAAAA,UAAM1H,WAAWrP,OAAMsP,KAAKnJ,OAAO,QAAA,EAAU4Q,MAAM1H,QAAAA;AACnD0H,UAAM1H,WAAWrP,OAAMm5D,iBAAiB,EAAC/pD,YAAY2H,MAAM1H,UAAU+pD,UAAU,GAAGjzD,MAAYuW,KAC9F,CAAA;AAAA,EAAA;AAED1c,EAAAA,OAAMq5D,YAAYtiD,MAAM3H;AACxBpP,EAAAA,OAAMs5D,YAAYviD,MAAM1H;AACzB;AAEA,SAASwpD,oBAAoB9hD,OAAO3H,YAAYC,UAAAA;AAC/C,MAAID,aAAa2H,MAAM3H,YAAW;AACjC2H,UAAM3H,aAAa,IAAIuG,KAAKvG,UAC5B;AAAA,EAAA;AACD,MAAIC,WAAW0H,MAAM1H,UAAS;AAC7B0H,UAAM1H,WAAW,IAAIsG,KAAKtG;EAC1B;AACF;AAEA,SAASkqD,eAAev5D,QACvB;AAAA,MAAIA,OAAMuC,OAAO6tC,WAAW;AAC3B,QAAIopB,UAAAA,CAAWx5D,OAAMq5D,WACpBI,UAAAA,CAAWz5D,OAAMs5D;AAElB,QAAKt5D,CAAAA,OAAMq5D,aAAaG,WAAYx5D,CAAAA,OAAMs5D,aAAaG,SAAS;AAC/Dz5D,MAAAA,OAAM2C,OAEN3C;AAAAA,MAAAA,OAAMgF,UAAU,mBAAmB,CACnC,CAAA;AAAA,aAAO;AAAA,IACP;AAAA,EACD;AACD,SAAO;AACR;AAEe,SAAS00D,iBAAiB15D,QAAAA;AACxC24D,oBAAkB34D,MAAAA;AAClBu5D,iBAAev5D,MAAAA;AAChB;ACvIA,SAAS25D,iBAAiB35D,QAAOymC,SAASmzB,YACzC;AAAA,WAAQ7gE,IAAI,GAAGA,IAAI0tC,QAAQztC,QAAQD,KAAK;AACvC,QAAGiH,OAAMqoD,aAAa5hB,QAAQ1tC,CAAAA,CAAAA,GAAI;AACjC6gE,iBAAWnzB,QAAQ1tC,CAAMiH,CAAAA,IAAAA,OAAMinC,QAAQR,QAAQ1tC;IAC/C;AAAA,EACD;AACF;AAEA,SAAS8gE,YAAY75D,QAAOoL,MAAMwuD,YACjCD;AAAAA,mBAAiB35D,QAAOoL,KAAKs+B,SAASkwB,UAAAA;AACtCD,mBAAiB35D,QAAOoL,KAAKu+B,SAASiwB,UACvC;AAAA;AAEA,SAASE,gBAAgB95D,QAAOkI,QAC/B;AAAA,MAAIsX,MAAM,CAAA;AAEV,MAAGxf,OAAM0d,aAAaxV,MAAAA,GAAQ;AAC7B2xD,gBAAY75D,QAAOA,OAAMmc,QAAQjU,MAASsX,GAAAA,GAAAA;AAAAA,EAC1C;AAEDxf,EAAAA,OAAM6Q,SAAS,SAAStV,OAAAA;AACvBs+D,gBAAY75D,QAAOzE,OAAOikB;EAC1B,GAAEtX,MAAAA;AAEH,SAAOsX;AACR;AAEA,SAASu6C,gBAAgB/5D,QAAOkI,QAAAA;AAC/B,MAAIsX,MAAM,CAAA;AAEVxf,EAAAA,OAAM6Q,SAAS,SAAStV,OAAAA;AACvBikB,QAAIjkB,MAAM2I,MAAM3I;AAAAA,EAChB,GAAE2M;AAEH,SAAOsX;AACR;AAEA,MAAew6C,aAAA,EACdF,iBACAC;AChCD,SAASE,eAAej6D,QAEvB;AAAA,MAAI4nB,SAAS6rC,cAAc9kD;AAC3B60C,QAAYxjD,QAAO4nB,MACnB;AAAA,MAAIoL,aAAahzB,OAAMw1B,gBAAgB,EACtCl7B,MAAM,QACN4U,MAAM,iBACNhH,QAAQ,WAAa;AAAA,WAAOlI,OAAMuC,OAAOuV;AAAAA,EAAU,GACnD2d,UAAUmrB,KAAWsZ,YAAYl6D,MACjC6sD,GAAAA,WAAW,WAAa;AAAA,WAAO7sD,OAAMuC;AAAAA,EAAS,EAAA,CAAA;AAG/C,MAAI6lD,aAAapoD,OAAMw1B,gBAAgB,EACtCl7B,MAAM,QACNm7B,UAAUmrB,KAAWuZ,YAAYn6D;AAGlCA,EAAAA,OAAMyE,YAAY,aAAa,WAAA;AAC9BuuB,eAAW9mB,WAAAA;AACXk8C,eAAWl8C,WACb;AAAA,EAAA,CAAA;AAEClM,EAAAA,OAAMyE,YAAY,oBAAoB,SAASgZ;AAC9C,QAAGzd,OAAMqoD,aAAa5qC,KAAKvZ,EAAOuZ,KAAAA,KAAKvZ,OAAO,yBAAwB;AAErE,aAAO;AAAA,IACP;AACD,QAAIyZ,SAAS3d,OAAMmc,QAAQsB,KAAKE,MAChC;AAAA,QAAIy8C,YAAYz8C,OAAO+rB;AACvB,aAAS3wC,IAAI,GAAGA,IAAIqhE,UAAUphE,QAAQD,KAAK;AAC1C,UAAIshE,eAAer6D,OAAMinC,QAAQmzB,UAAUrhE,CAE3C,CAAA;AAAA,UAAIuhE,cAAc78C,KAAKE,UAAU08C,aAAa18C;AAC9C,UAAI48C,cAAc98C,KAAKlhB,UAAU89D,aAAa99D;AAC9C,UAAIi+D,YAAY/8C,KAAKvO,QAAQmrD,aAAanrD;AAG1C,UAAIorD,eAAeC,eAAeC,WAAW;AAC5C,eAAO;AAAA,MACP;AAAA,IACD;AAED,WAAO;AAAA,EACT,CAECxnC;AAAAA,aAAWvuB,YAAY,sBAAsB,WAG5C;AAAA,QAAIuuB,WAAW68B,wBAAuB;AACrC;AAAA,IACA;AAED,QAAIpF,QAAQz3B,WAAW23B,gBAAAA;AAEvB,aAAQ5xD,IAAE,GAAGA,IAAI0xD,MAAMzxD,QAAQD,KAAI;AAClC,UAAI8N,OAAO4jD,MAAM1xD,CAAAA;AACjB8N,WAAKigC,SAAS/tC;AACd8N,WAAKm/B,eAAehmC,OAAMyrB,aAAa5kB,KAAK3C,EAAAA;AAC5ClE,MAAAA,OAAMy6D,kBAAkB5zD;IACxB;AAAA,EAEH,CAAA;AAECmsB,aAAWvuB,YAAY,gBAAgB,SAASP,IAAIkH,MACnD;AAAA,QAAIpL,OAAMuC,OAAOusB,8BAA8B;AAC9C,aAAO;AAAA,IACP;AACD,QAAI9lB,MAAM,MAAMlP,MAAM;AACtB,QAAIkG,OAAMuC,OAAO6M,cAAcpP,OAAMuC,OAAO8M,UAAU;AACrD,UAAIrP,OAAM06D,0BAA0BtvD,MAAO,QAAO;AAClDpC,YAAMhJ,OAAMuC,OAAO6M,WAAW1E,QAC9B5Q;AAAAA,YAAMkG,OAAMuC,OAAO8M,SAAS3E,QAAAA;AAE5B,WAAKU,KAAKgE,aAAatV,OAAQsR,CAAAA,KAAKiE,WAAYrG,CAAAA,IAC/C,QAAO;AAAA,IACR;AACD,WAAO;AAAA,EACT,CAECgqB;AAAAA,aAAWvuB,YAAY,cAAc,SAASwvB,OAAOC,OACpDl0B;AAAAA,IAAAA,OAAMizD,cAAch/B,OAAOC,KAAAA;AAE3B,QAAIymC,cAAc36D,OAAMmc,QAAQ+X;AAChC,QAAIlB,CAAAA,WAAWw1B,SAAW,GAAA;AACzB,UAAGmS,YAAY9uC,kBAAkB8uC,YAAYC,QAAO;AACnD56D,QAAAA,OAAMonD,WAAW,SAASrpD;AACzBiC,UAAAA,OAAMk5B,YAAYn7B,OAAOmG,EACzB;AAAA,QAAA,GAAEgwB;MACH;AAAA,IACD;AAAA,EACH,CAEClB;AAAAA,aAAWvuB,YAAY,iBAAiB,SAASP,IAChDlE;AAAAA,IAAAA,OAAM66D,gBAAgB32D,EAAAA;AACtB,QAAGlE,OAAMwK,SAAS,aAAeinD,EAAAA,cAAa;AAC7C,aAAO;AAAA,IACP;AAED,QAAIrmD,OAAO4nB,WAAW4D,QAAQ1yB,EAC9B;AAAA,QAAA,CAAKkH,KAAKs+B,QAASt+B,MAAKs+B,UAAU,CAAA;AAClC,aAAS3wC,IAAI,GAAGA,IAAIqS,KAAKs+B,QAAQ1wC,QAAQD,KAAK;AAC7CqvD,iBAAWjxB,QAAQ/rB,KAAKs+B,QAAQ3wC,CAAAA,CAAAA;AAAAA,IAChC;AACD,QAAKqS,CAAAA,KAAKu+B,QAASv+B,MAAKu+B,UAAU;AAClC,aAAS5wC,IAAI,GAAGA,IAAIqS,KAAKu+B,QAAQ3wC,QAAQD,KAAK;AAC7CqvD,iBAAWjxB,QAAQ/rB,KAAKu+B,QAAQ5wC,CAChC,CAAA;AAAA,IAAA;AAAA,EACH,CAECi6B;AAAAA,aAAWvuB,YAAY,oBAAoB,SAASsjD,KAAKhqD,QAAQwqC;AAEhE,QAAI+gB,kBAAkBvB,KAAK/nD,QAAOgzB,UAAAA,GAAY;AAE7Cp0B,cAAQ6jB,IAAI,2DAAA;AACZ,aAAO;AAAA,IACP;AAED,WAAO;AAAA,EACT,CAECuQ;AAAAA,aAAWvuB,YAAY,mBAAmB,SAASsjD,KAAKhqD,QAAQwqC,QAC/D;AAAA,QAAI5qB,SAAS3d,OAAMmc,QAAQ4rC;AAE3B,QAAG9qD,KAAK4qD,eAAeE,GAAS,MAAA,MAAK;AACpCpqC,aAAOm9C,eAAe79D,KAAK4qD,eAAeE,GAC1C;AAAA,IAAA,WAAS9qD,KAAKixB,eAAe65B,GAAAA,MAAS,MAAK;AAC3CpqC,aAAOm9C,eAAe,UAAU79D,KAAKixB,eAAe65B;IACvD,OAAO;AACJpqC,aAAOm9C,eAAe;AAAA,IACtB;AAAA,EAEH,CAEC9nC;AAAAA,aAAWvuB,YAAY,kBAAkB,SAASP,IAAI2C,MAAMkP,QAC3D;AAAA,QAAGA,UAAU,UAAS;AACrB/V,MAAAA,OAAMizD,cAAc/uD,IAAI,IACxB;AAAA,IAAA;AAED,QAAIrD,QAAQb,OAAMc,UAAUC,WAAW;AACvC,QAAGF,MAAM2J,SAAS,aAAeinD,EAAAA,cAAa;AAC7C;AAAA,IACA;AAED,QAAGzxD,OAAMuC,OAAO6tC,aAAar6B,WAAW,SAAQ;AAC/C,UAAIglD,WAAW/6D,OAAMwK,SAAAA;AACrBwwD,uBAAoBh7D,MAAAA;AACpB,UAAIi7D,WAAWj7D,OAAMwK,SAGrB;AAAA,UAAA,CAAKuwD,SAASzpD,YAAa2pD,CAAAA,SAAS3pD,aAAaypD,SAAStwD,YAAAA,CAAawwD,SAASxwD,UAAU;AACzFzK,QAAAA,OAAM2C;AAEN3C,QAAAA,OAAMgF,UAAU,mBAAmB,CAAA,CAAA;AACnC,eAAO;AAAA,MACP;AAAA,IAED;AAED,QAAG+Q,UAAU,SAASA,UAAU,UAAUA,UAAU,UAAS;AAC5D,UAAG/V,OAAMm/B,SAAQ;AAIhB,YAAIliC,KAAKyQ,QAAQpT,QAAQ,WAAWyb,UAAU,SAASA,UAAU,WAAU;AAC1E,cAAI9Y,KAAK4yD,0BAA0B,YAAW;AAC7C5yD,iBAAK4yD,yBAAyB;AAAA,UAC9B;AAAA,QACD;AACD7vD,QAAAA,OAAMm/B,QAAQ0R,OAAAA;AAAAA,MACd;AAAA,IAEJ,WAAQ,CAAI3sC,IAAG;AACZkkD,iBAAWjxB,QACX;AAAA,IAAA;AAAA,EAEH,CAECixB;AAAAA,aAAW3jD,YAAY,cAAc,SAASP,IAAIuZ,MACjDy9C;AAAAA,cAAUz9C;EACZ,CACC2qC;AAAAA,aAAW3jD,YAAY,iBAAiB,SAASP,IAAIuZ;AACpD09C,eACF;AAAA,EAAA,CAAA;AACC/S,aAAW3jD,YAAY,iBAAiB,SAASP,IAAIuZ,MAAAA;AACpD29C,qBAAiB39C,IAAAA;AAAAA,EACnB,CACC2qC;AAAAA,aAAW3jD,YAAY,uBAAuB,SAASP,IAAIuZ,MAAAA;AAC1D29C,qBAAiB39C,IAAAA;AAAAA,EACnB;AACC2qC,aAAW3jD,YAAY,oBAAoB,SAASwvB,OAAOC,OAAAA;AAC1DknC,qBAAiBp7D,OAAMyP,MAAM,EAACvL,IAAG+vB,MAAAA,GAAQj0B,OAAM+yB,MAAMq1B,WAAWxxB,QAAQ1C,KAAAA,CAAAA,CAAAA;AACxEgnC,cAAUl7D,OAAM+yB,MAAMq1B,WAAWxxB,QAAQ1C;EAC3C,CAEC;AAAA,WAASmnC,0BAA0B9vC,QAClC;AAAA,QAAI30B,aAAYoJ,OAAMksB,cAAcX,MAAAA;AACpC,SAAI30B,cAAaoJ,OAAM0d,aAAa6N,MAAQ,GAAA;AAC3C,UAAIxtB,SAASiC,OAAM+rB,UAAUR,MAAAA;AAC7B,UAAGvrB,OAAM0d,aAAa3f,MAAWiC,KAAAA,OAAMksB,cAAcnuB,MAAAA,GAAQ;AAC5DA,iBAASiC,OAAMmc,QAAQpe,MAAAA;AACvB,YAAGiC,OAAMgzD,YAAYj1D,MAAAA,GAAQ;AAC5BnH,UAAAA,aAAY;AAAA,QACZ;AAAA,MACD;AAAA,IACD;AACD,WAAOA;AAAAA,EACP;AAEDwxD,aAAW3jD,YAAY,gBAAgB,SAASP,IAAIuZ,MACnD;AAAA,QAAA,CAAKzd,OAAMuC,OAAOktC,YAAY;AAC7B,aAAO;AAAA,IACP;AAED,QAAI6rB,gBAAgBD,0BAA0B59C,KAAKE,MACnD;AAAA,QAAI49C,gBAAgBF,0BAA0B59C,KAAKlhB;AAEnD,QAAM++D,EAAAA,iBAAiBC,kBACtBv7D,OAAM06D,0BAA0B16D,OAAMmc,QAAQsB,KAAKE,MAAAA,CAAAA,KAAY3d,OAAM06D,0BAA0B16D,OAAMmc,QAAQsB,KAAKlhB,MAClH,CAAA,EAAA,QAAO;AAER,WAAOyD,OAAMgF,UAAU,uBAAuB,CAACd,IAAIuZ;EACrD,CAGC;AAAA,GAAA,WAAA;AAEC,QAAI+9C,eAAe,CAAA;AAEnBx7D,IAAAA,OAAMyE,YAAY,sBAAsB,SAASP,IAAI2C,MAAAA;AACpD20D,mBAAat3D,EAAAA,IAAM81D,WAAWF,gBAAgB95D,QAAOkE,EACrD;AAAA,aAAO;AAAA,IACV,CAAA;AAEElE,IAAAA,OAAMyE,YAAY,qBAAqB,SAASP,IAAI2C;AACnD,UAAG20D,aAAat3D,KAAI;AACnBlE,QAAAA,OAAM+yB,MAAMq1B,WAAW7vB,OAAO,WAAA;AAC7B,mBAAQx/B,KAAKyiE,aAAat3D,EAAAA,GAAI;AAC7B,gBAAIlE,OAAMqoD,aAAatvD,CAAAA,GAAG;AACzBiH,cAAAA,OAAM+yB,MAAMq1B,WAAWnxB,WAAWl+B,CAClC;AAAA,YAAA;AACDqiE,6BAAiBI,aAAat3D,EAAAA,EAAInL;UAClC;AAEDyiE,uBAAat3D,EAAM,IAAA;AAAA,QACxB,CACI;AAAA,MAAA;AAAA,IACJ;EACE,GAvBD;AAyBAlE,EAAAA,OAAMyE,YAAY,qBAAqB,SAASP,IAAIuZ,MAAAA;AAEnD,QAAGzd,OAAM0d,aAAaD,KAAKE,SAAQ;AAClC3d,MAAAA,OAAMk5B,YAAYzb,KAAKE,MAAAA;AAAAA,IACvB;AACD,QAAG3d,OAAM0d,aAAaD,KAAKlhB,MAAQ,GAAA;AAClCyD,MAAAA,OAAMk5B,YAAYzb,KAAKlhB,MACvB;AAAA,IAAA;AAAA,EACH,CAECyD;AAAAA,EAAAA,OAAMyE,YAAY,WAAW02D,UAAAA;AAE7BM,YAAU,EACT99C,QAAQyqC,YACR7rD,QAAQyD,QACRy/B,QAAO,EACNi8B,eAAgB,iBAChBC,aAAc,mBACdC,YAAa,kBACbC,gBAAiB,sBACjBC,eAAgB,qBAChBC,gBAAiB,sBACjBC,eAAgB,qBAChBC,YAAa;AAIfR,YAAU,EACT99C,QAAQqV,YACRz2B,QAAQyD,QACRy/B,QAAO,EACNi8B,eAAgB,iBAChBC,aAAc,mBACdC,YAAa,kBACbC,gBAAiB,sBACjBC,eAAgB,qBAChBC,gBAAiB,sBACjBC,eAAgB,qBAChBC,YAAa,kBACbC,kBAAmB,oBACnBC,iBAAkB,mBAClBC,cAAe,uBACfC,YAAa,gBACbC,aAAc,gBACdC,gBAAiB,wBACjBC,eAAgB,kBAChBC,iBAAkB;AAIpBz8D,EAAAA,OAAM+yB,QAAQ,EACbC,YACAo1B;AAGD,WAAS8S,UAAUz9C;AAClB,QAAGzd,OAAM0d,aAAaD,KAAKE,MAAAA,GAAQ;AAClC,UAAI++C,aAAa18D,OAAMmc,QAAQsB,KAAKE,MAAAA;AACpC++C,iBAAWhzB,UAAUgzB,WAAWhzB,WAAW,CAC3CgzB;AAAAA,iBAAWhzB,QAAQztC,KAAKwhB,KAAKvZ,EAAAA;AAAAA,IAC7B;AACD,QAAGlE,OAAM0d,aAAaD,KAAKlhB,MAAQ,GAAA;AAClC,UAAImiB,aAAa1e,OAAMmc,QAAQsB,KAAKlhB,MACpCmiB;AAAAA,iBAAWirB,UAAUjrB,WAAWirB,WAAW;AAC3CjrB,iBAAWirB,QAAQ1tC,KAAKwhB,KAAKvZ,EAAAA;AAAAA,IAC7B;AAAA,EACD;AAED,WAASk3D,iBAAiB39C;AACzB,QAAGzd,OAAM0d,aAAaD,KAAKE,MAAQ,GAAA;AAClC,UAAI++C,aAAa18D,OAAMmc,QAAQsB,KAAKE,MACpC;AAAA,eAAQ5kB,IAAI,GAAGA,IAAI2jE,WAAWhzB,QAAQ1wC,QAAQD,KAAI;AACjD,YAAG2jE,WAAWhzB,QAAQ3wC,CAAAA,KAAM0kB,KAAKvZ,IAAG;AACnCw4D,qBAAWhzB,QAAQpwC,OAAOP,GAAG;AAC7B;AAAA,QACA;AAAA,MACD;AAAA,IACD;AACD,QAAGiH,OAAM0d,aAAaD,KAAKlhB,MAAAA,GAAQ;AAClC,UAAImiB,aAAa1e,OAAMmc,QAAQsB,KAAKlhB,MACpC;AAAA,eAAQxD,IAAI,GAAGA,IAAI2lB,WAAWirB,QAAQ3wC,QAAQD,KAAI;AACjD,YAAG2lB,WAAWirB,QAAQ5wC,CAAAA,KAAM0kB,KAAKvZ,IAAG;AACnCwa,qBAAWirB,QAAQrwC,OAAOP,GAAG,CAAA;AAC7B;AAAA,QACA;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAED,WAASoiE,aAAAA;AACR,QAAI/vD,OAAO;AACX,QAAIkF,SAAQtQ,OAAM+yB,MAAMC,WAAWqE,SAEnC;AAAA,aAAQt+B,IAAI,GAAG+C,MAAMwU,OAAMtX,QAAQD,IAAI+C,KAAK/C,KAAI;AAC/CqS,aAAOkF,OAAMvX,CAAAA;AACbqS,WAAKs+B,UAAU,CACft+B;AAAAA,WAAKu+B,UAAU,CACf;AAAA,IAAA;AAED,QAAI/uB,QAAQ5a,OAAM+yB,MAAMq1B,WAAW/wB,SAAAA;AACnC,aAASt+B,IAAI,GAAG+C,MAAM8e,MAAM5hB,QAAQD,IAAI+C,KAAK/C,KAAK;AAEjD,UAAI0kB,OAAO7C,MAAM7hB,CAAAA;AACjBmiE,gBAAUz9C,IAAAA;AAAAA,IACV;AAAA,EACD;AAED,WAASg+C,UAAUkB,MAAAA;AAClB,QAAIC,UAAUD,KAAKh/C;AACnB,QAAIk/C,QAAQF,KAAKpgE;AACjB,aAAQxD,KAAK4jE,KAAKl9B,QAAO;AACxB,OAAA,SAAUq9B,aAAaC,aACtBH;AAAAA,gBAAQn4D,YAAYq4D,aAAa,WAChC;AAAA,iBAAOD,MAAM73D,UAAU+3D,aAAapkE,MAAMC,UAAUC,MAAMC,KAAK+K,SAC/D,CAAA;AAAA,QAAA,GAAEk5D,WACH;AAAA,MAAA,GAAEhkE,GAAG4jE,KAAKl9B,OAAO1mC,CAAAA,CAAAA;AAAAA,IAClB;AAAA,EACD;AAED,WAASmhE,WAAW9uD,MACnB;AAAA,QAAA,CAAKnO,KAAKsjC,QAAQn1B,KAAKlH,EAAAA,EACtBkH,MAAKlH,KAAKjH,KAAKy4B,IAEhB;AAAA,QAAItqB,KAAKgE,WACRhE,MAAKgE,aAAapP,OAAMsP,KAAK4tC,UAAU9xC,KAAKgE,YAAY;AACzD,QAAIhE,KAAKiE,SACRjE,MAAKiE,WAAWrP,OAAMsP,KAAK4tC,UAAU9xC,KAAKiE,UAAU,YAGrD;AAAA,QAAI+pD,WAAW;AACf,QAAIhuD,KAAKguD,YAAYhuD,KAAKguD,aAAa,GAAG;AACzChuD,WAAKguD,WAAWA,WAAWhuD,KAAKguD,WAAW;AAAA,IAC3C;AAED,QAAIA,UAAU;AACb,UAAIhuD,KAAKgE,cAAehE,CAAAA,KAAKiE,UAAU;AACtCjE,aAAKiE,WAAWpS,KAAKk8D,iBAAiB/tD,IAAAA;AAAAA,MACtC,WAAM,CAAKA,KAAKgE,cAAchE,KAAKiE,UAAU;AAC7CjE,aAAKgE,aAAanS,KAAKk8D,iBAAiB,EACvC/pD,YAAYhE,KAAKiE,UACjB+pD,UAAWhuD,CAAAA,KAAKguD,UAChBhuD,KAAMA,CAAAA;AAAAA,MAEP;AAAA,IAED;AAED,QAAIpL,OAAMuC,OAAOguC,cAAc,SAASnlC,KAAKiL,UAAS;AACrDjL,WAAKiL,WAAWrW,OAAMsP,KAAK4tC,UAAU9xC,KAAKiL,UAAU;IACpD;AAEDjL,SAAK0lC,WAAWksB,OAAO5xD,KAAK0lC,aAAa;AAEzC,QAAI7zC,KAAKy9D,0BAA0BtvD,IAAO,GAAA;AACzCnO,WAAKggE,yBAAyB7xD,IAAAA;AAAAA,IAC9B;AACDnO,SAAKigE,kBAAkB9xD,IAAAA;AACvB,QAAIA,KAAKgE,cAAchE,KAAKiE,SAC3BpS,MAAKkgE,oBAAoB/xD;AAE1BA,SAAKs+B,UAAU;AACft+B,SAAKu+B,UAAU;AAEf,QAAIyzB,eAAengE,KAAK81B,MAAMC,WAAW4D,QAAQxrB,KAAKlH,EACtD;AAAA,QAAIk5D,gBAAiBrb,CAAAA,QAAc32C,KAAKyJ,IAAAA,GAAO;AAG9CzJ,WAAKkP,QAAQ8iD,aAAa9iD;AAAAA,IAC1B;AAED,QAAIlP,KAAKrN,WAAWT,QAAW;AAC9B8N,WAAKrN,SAASd,KAAKsF,OAAOuV;AAAAA,IAC1B;AACD,QAAG1M,KAAKyJ,MAAK;AACZzJ,WAAKkP,QAAQ;AAAA,IACb;AACD,WAAOlP;AAAAA,EACP;AAED,WAAS+uD,WAAW18C,MACnB;AAAA,QAAA,CAAKxgB,KAAKsjC,QAAQ9iB,KAAKvZ,EACtBuZ,EAAAA,MAAKvZ,KAAKjH,KAAKy4B,IAAAA;AAChB,WAAOjY;AAAAA,EACP;AACF;ACpbA,MAAqB4/C,oBAKpB;AAAA,EAAA,YAAYr9D,QAAYs9D,IAAAA;AACvBrgE,SAAKsgE,SAASv9D;AACd/C,SAAKugE,MAAMF;AACXrgE,SAAKwgE,yBAAyB,CAC/B;AAAA,EAAA;AAAA,EAEA,SACC;AAAA,UAAMH,KAAKrgE,KAAKugE;AAChB,UAAMx9D,SAAQ/C,KAAKsgE;AACnB,UAAMG,gBAAgB,CAAA;AAEhB,UAAAC,mBAAoBz5D,QAClBjH,KAAK0gE,iBAAiBz5D,IAAIo5D,IAAIt9D,MAGtC;AAAA,aAAS49D,aAAaxyD,MAAAA;AACrB,UAAIyyD,SAAS;AAEb,UAAIzyD,KAAKs+B,SAAS;AACRm0B,iBAAAA,OAAO14D,OAAOiG,KAAKs+B,OAC7B;AAAA,MAAA;AACA,UAAIt+B,KAAKu+B,SAAS;AACRk0B,iBAAAA,OAAO14D,OAAOiG,KAAKu+B,OAAAA;AAAAA,MAC7B;AAEO,aAAAk0B;AAAAA,IACR;AAEA5gE,SAAKwgE,uBAAuBxhE,KAAK+D,OAAMyE,YAAY,kBAAkB,SAASP,IAAI2C,MAAAA;AAC7E,UAAA7G,OAAM0d,aAAaxZ,EAAK,GAAA;AAC3Bo5D,WAAGQ,aAAa;AACbR,WAAAS,WAAW75D,IAAI,MAAM,UACzB;AAAA,MAAA;AAAA,IACA;AAEDjH,SAAKwgE,uBAAuBxhE,KAAK+D,OAAMyE,YAAY,qBAAqB,SAASP,IAAI2C,MAAAA;AAChF,UAAA7G,OAAM0d,aAAaxZ,KAAK;AAC3Bo5D,WAAGQ,aAAa,OAAA;AACbR,WAAAS,WAAW75D,IAAI,IAGlB;AAAA,YAAGlE,OAAMg+D,gBAAe;AACjBh+D,UAAAA,OAAAg+D,eAAe95D,IAAI2C,IAC1B;AAAA,QAAA;AAAA,MACD;AAAA,IACA,CAAA,CAAA;AAED5J,SAAKwgE,uBAAuBxhE,KAAK+D,OAAMyE,YAAY,sBAAsB,SAASP,IAAI2C,MAAAA;AACjF,UAAA7G,OAAMuC,OAAO+sC,gBAAgB;AAChCouB,sBAAcx5D,EAAAA,IAAM,EACnBoM,OAAO0pD,WAAWD,gBAAgB/5D,QAAOkE,EACzC0W,GAAAA,OAAOo/C,WAAWF,gBAAgB95D,QAAOkE,EAAAA,EAAAA;AAAAA,MAE3C;AAEA,UAAIo5D,GAAGW,yBAAyB;AAC/BX,WAAGQ,aAAa,OACbR;AAAAA,WAAAS,WAAW75D,IAAI,MAAM,SAAA;AACjB,eAAA;AAAA,MACR;AACO,aAAA;AAAA,IACP,CAAA,CAAA;AAEDjH,SAAKwgE,uBAAuBxhE,KAAK+D,OAAMyE,YAAY,qBAAqB,SAASP,IAAI2C,MACpFy2D;AAAAA,SAAGQ,aAAa,OAGV;AAAA,YAAAI,gBAAgBP,iBAAiBz5D,EAAAA;AACvC,YAAMi6D,oBAAoBn+D,OAAMuC,OAAO+sC,kBAAkBouB,cAAcx5D,EAAAA;AACnE,UAACg6D,CAAAA,gBAAAA,CAAiBC,mBAAmB;AACxC;AAAA,MACD;AAEA,UAAIA,mBAAmB;AACtB,cAAMC,SAASd,GAAGe;AAClBf,WAAGgB,cAAc,KAEX;AAAA,cAAAC,UAAUb,cAAcx5D,EAAAA;AACnB,mBAAAnL,KAAKwlE,QAAQjuD,OAAO;AAC1B,cAAA,CAACqtD,iBAAiB5kE,CAAI,GAAA;AACzBukE,eAAGkB,UAAUD,QAAQjuD,MAAMvX,CAAAA,CAAAA;AACxBukE,eAAAS,WAAWhlE,GAAG,MAAM,SAAA;AAAA,UACxB;AAAA,QACD;AACAukE,WAAGQ,aAAa,OACL;AAAA,mBAAA/kE,KAAKwlE,QAAQ3jD,OAAO;AAC1B,cAAC+iD,CAAAA,iBAAiB5kE,CAAI,GAAA;AACzBukE,eAAGkB,UAAUD,QAAQ3jD,MAAM7hB,CAAAA,CAAAA;AACxBukE,eAAAS,WAAWhlE,GAAG,MAAM;UACxB;AAAA,QACD;AACA2kE,sBAAcx5D,EAAM,IAAA;AAEpB,YAAIk6D,WAAW,OAAO;AACrBd,aAAGmB,YACJ;AAAA,QAAA;AACAnB,WAAGQ,aAAa,OAAA;AAChBR,WAAGgB,cAAcF,MAClB;AAAA,MAAA;AAEA,UAAIF,cAAa;AAChBZ,WAAGkB,UAAU33D,IACT;AAAA,YAAA,CAACy2D,GAAGW,yBAAwB;AAC5BX,aAAAS,WAAW75D,IAAI,MAAM,SACzB;AAAA,QAAA;AAAA,MACD;AAGA,UAAIo5D,GAAGe,eAAe,UAAUf,GAAGoB,QAAQ;AAC1CpB,WAAGmB,YACJ;AAAA,MAAA;AAAA,IACA;AAEDxhE,SAAKwgE,uBAAuBxhE,KAAK+D,OAAMyE,YAAY,qBAAqB,SAASP,IAAI2C,MAAAA;AAChF,UAAA7G,OAAMqoD,aAAankD,KAAK;AAC3Bo5D,WAAGQ,aAAa,OAAA;AACbR,WAAAS,WAAW75D,IAAI,IACnB;AAAA,MAAA;AAAA,IACA;AAEDjH,SAAKwgE,uBAAuBxhE,KAAK+D,OAAMyE,YAAY,kBAAkB,SAASP,IAAI2C,MAAAA;AAC7E,UAAA7G,OAAMqoD,aAAankD,KAAK;AAC3Bo5D,WAAGQ,aAAa,OACbR;AAAAA,WAAAS,WAAW75D,IAAI,MAAK,UAAA;AAAA,MACxB;AAAA,IACA,CAEDjH,CAAAA;AAAAA,SAAKwgE,uBAAuBxhE,KAAK+D,OAAMyE,YAAY,qBAAqB,SAASP,IAAI2C,MACpFy2D;AAAAA,SAAGQ,aAAa,OAAA;AAEV,YAAAI,eAAgBP,CAAAA,iBAAiBz5D;AACvC,UAAKg6D,CAAAA,cAAc;AAClB;AAAA,MACD;AACAZ,SAAGkB,UAAU33D,IACVy2D;AAAAA,SAAAS,WAAW75D,IAAI,MAAK,SACvB;AAAA,IAAA,CAAA,CAAA;AAEDjH,SAAKwgE,uBAAuBxhE,KAAK+D,OAAMyE,YAAY,gBAAgB,SAASP,IAAI3H,QAAAA;AAC/EyD,MAAAA,OAAMg+D,eAAe95D,IAAIlE,OAAMmc,QAAQjY,EAAAA,CAAAA;AAAAA,IACvC;AAED,QAAIoM,SAAQ;AACZ,QAAIsK,QAAQ;AAEZ3d,SAAKwgE,uBAAuBxhE,KAAK+D,OAAMyE,YAAY,kBAAkB,SAASwvB,OAAOC,OAChF;AAAA,UAAA,CAACopC,GAAGqB,WAAW;AAClB;AAAA,MACD;AAEM,YAAAt4B,WAAWrmC,OAAMgY,YAAYkc,KAAAA;AACnC,UAAImS,SAASrtC,QAAQ;AACpBsX,QAAAA,SAAQA,UAAS;AAEjB,iBAASvX,IAAI,GAAGA,IAAIstC,SAASrtC,QAAQD,KAAK;AACzC,gBAAM6C,KAAKqB,KAAKkf,QAAQkqB,SAASttC,CAAAA,CAAAA;AAC3BuX,UAAAA,OAAA1U,GAAGsI,EAAAA,IAAMtI;AAAAA,QAChB;AAAA,MACD;AAEM,YAAAiL,OAAO5J,KAAKkf,QAAQ+X;AACpB,YAAA0qC,YAAYhB,aAAa/2D,IAAAA;AAE/B,UAAI+3D,UAAU5lE,QAAQ;AACrB4hB,gBAAQA,SAAS;AAEjB,iBAAS7hB,IAAI,GAAGA,IAAI6lE,UAAU5lE,QAAQD,KAAK;AAC1C,gBAAM0kB,OAAOxgB,KAAKgqC,QAAQ23B,UAAU7lE;AAC9B6hB,gBAAA6C,KAAKvZ,EAAMuZ,IAAAA;AAAAA,QAClB;AAAA,MACD;AAAA,IACA;AAEE6/C,OAAA74D,YAAY,uBAAuB,WAAA;AACrC,UAAI6L,UAASsK,OAAO;AACnB5a,QAAAA,OAAMyrC,YAAY,WACjB;AAAA,qBAAWvnC,MAAMoM,QAAO;AACvBtQ,YAAAA,OAAMouB,WAAW9d,OAAMpM,IAAIA,EAC5B;AAAA,UAAA;AAEA,qBAAWA,MAAM0W,OAAO;AACvB5a,YAAAA,OAAM0oD,WAAW9tC,MAAM1W,EAAAA,EAAIA,EAC5B;AAAA,UAAA;AACQoM,UAAAA,SAAA;AACAsK,kBAAA;AAAA,QAAA,CAET;AAAA,YAAItK,QAAO;AACJtQ,UAAAA,OAAA6+D,IAAIf,aAAa,OAAO;AAAA,QAAA,OACxB;AACA99D,UAAAA,OAAA6+D,IAAIf,aAAa,OACxB;AAAA,QAAA;AAAA,MACD;AAAA,IAAA,CAGER;AAAAA,OAAA74D,YAAY,uBAAuB,WACjC;AAAA,UAAAxH,KAAK6hE,WAAW,UAAU;AACtB,eAAA;AAAA,MACR;AACA,UAAIxrD,MAAMrW,KAAK8hE;AACf,UAAI9hE,KAAK6hE,WAAW,eAAe7hE,KAAK6hE,WAAW,QAAQ;AAC1D,cAAMtqC,OAAOv3B,KAAK+hE;AAElB1rD,cAAMA,IAAI2rD,UAAU,GAAG3rD,IAAIpZ,QAAQ,GAAA,IAAA,KAAYoZ,IAAIpZ,QAAQ,OAAOoZ,IAAIta,MAAAA;AAEjEiE,aAAAiiE,kBAAkB5rD,OAAOA,IAAIza,QAAc,MAAA,MAAM,KAAK,OAAO27B;AAAAA,MAAA,OAC5D;AACA,cAAA2qC,iBAAiBliE,KAAK+hE,aAAa;AACzC/hE,aAAKiiE,kBAAkB5rD,MAAMtT,OAAMyT,KAAKukC,aAAa1kC,OAAO,gBAAgB6rD;AAAAA,MAC7E;AAEO,aAAA;AAAA,IAAA,CAAA;AAGR7B,OAAG74D,YAAY,kBAAkB,SAAS26D,eAAeC,KAAKn7D,IAAInG,QAAQy2B,MACzE;AAAA,YAAM9kB,QAAO2vD,IAAI3vD,QAAQ1P,OAAMq2C,IAAIipB,eAAeD,IAAI7jE;AACtD,YAAM8vC,UAAU,EACf/hC,KAAKvJ,OAAM0mD,SACX6Y,SAASv/D,OAAM0d,aAAAA;AAEhB,UAAI8W,SAAS,SAAS;AACrB8W,gBAAQ/hC,MAAMvJ,OAAMsoD;AACpBhd,gBAAQi0B,UAAUv/D,OAAMqoD;AAAAA,MACzB;AACA,UAAI/c,QAAQi0B,QAAQzmE,KAAKkH,QAAOkE,EAAAA,GAAK;AACpC;AAAA,MACD;AACAwL,MAAAA,MAAKxL,KAAKA;AACFonC,cAAA/hC,IAAIzQ,KAAKkH,QAAO0P,KAAI;AAAA,IAAA,CAAA;AAG7B4tD,OAAG74D,YAAY,kBAAkB,SAAS+6D,eAAeH,KAAKn7D,IAAAA;AAC7D,YAAMwL,QAAO2vD,IAAI3vD,QAAQ1P,OAAMq2C,IAAIipB,eAAeD,IAAI7jE;AACtD,UAAKwE,CAAAA,OAAM0d,aAAaxZ,EAAAA,GAAK;AAC5B;AAAA,MACD;AACM,YAAAu7D,UAAUz/D,OAAMmc,QAAQjY,EAC9B;AAAA,iBAAWoS,OAAO5G,OAAM;AACnB,YAAAgwD,WAAWhwD,MAAK4G;AACpB,gBAAQA,KAAAA;AAAAA,UACP,KAAK;AACJ;AAAA,UACD,KAAK;AAAA,UACL,KAAK;AACJopD,uBAAW1/D,OAAMugC,QAAQvgC,OAAMmS,UAAUK,QAAAA,IAAYxS,OAAMmS,UAAUK,SAASktD,QAAAA,IAAY1/D,OAAMmS,UAAUgrC,WAAWuiB,QACrH;AAAA;AAAA,UACD,KAAK;AACID,oBAAApwD,WAAWrP,OAAMm5D,iBAAiB,EAAC/pD,YAAYqwD,QAAQrwD,YAAYgqD,UAAUsG,UAAUt0D,MAAKq0D,QACpG,CAAA;AAAA;AAAA,QAAA;AAEFA,gBAAQnpD,GAAOopD,IAAAA;AAAAA,MAChB;AACA1/D,MAAAA,OAAMouB,WAAWlqB;AACjBlE,MAAAA,OAAMwyD,YAAAA;AAAAA,IAAY,CAEnB8K;AAAAA,OAAG74D,YAAY,kBAAkB,SAASk7D,eAAeN,KAAKn7D,IAAInG,QAAQy2B,MAAAA;AACzE,YAAM8W,UAAU,EACfhlB,QAAQtmB,OAAM8mD,YACdyY,SAASv/D,OAAM0d,aAEhB;AAAA,UAAI8W,SAAS,SAAS;AACrB8W,gBAAQhlB,SAAStmB,OAAM2oD;AACvBrd,gBAAQi0B,UAAUv/D,OAAMqoD;AAAAA,MAAA,WACf7zB,SAAS,cAAc;AACxB8W,gBAAAhlB,SAAS,SAASlM,KAAAA;AACnBpa,UAAAA,OAAA+yB,MAAM6sC,iBAAiBpyD,OAAO4M;QAAG;AAEhCkxB,gBAAAi0B,UAAU,SAASnlD,KAC1B;AAAA,iBAAOpa,OAAM+yB,MAAM6sC,iBAAiB5oC,OAAO5c,GAAAA;AAAAA,QAAG;AAAA,MAEhD;AACA,UAAIkxB,QAAQi0B,QAAQzmE,KAAKkH,QAAOkE,EAAAA,GAAK;AAC5BonC,gBAAAhlB,OAAOxtB,KAAKkH,QAAOkE,EAC5B;AAAA,MAAA;AAAA,IAAA;AAGIjH,SAAA4iE,mBAAmBvC,IAAIt9D,MAAAA;AACvB/C,SAAA6iE,6BAA6BxC,IAAIt9D,MACjC/C;AAAAA,SAAA8iE,mBAAmBzC,IAAIt9D,MAC7B;AAAA,EAAA;AAAA,EAEA,iBAAiBkE,IAAIo5D,IAAIt9D,QAClB;AAAA,UAAAggE,UAAU1C,GAAG2C,YAAYpnE,MAC/B;AAAA,QAAIqnE,aAAa;AAEjB,QAAGlgE,OAAMmgE,YAAYj8D,IAAI,wBAAwBo5D,GAAG0B,gBAAgB,gBAAe;AACrEkB,mBAAA;AACV5C,SAAAS,WAAW75D,IAAG,KAClB;AAAA,IAAA;AAES,aAAAnL,IAAI,GAAGA,IAAIinE,QAAQhnE,UAAWskE,CAAAA,GAAG8C,aAAal8D,EAAAA,GAAKnL,KAAK;AAC5D,UAAAinE,QAAQjnE,CAAAA,MAAOmL,IAAI;AACtB,YAAIlE,OAAMmgE,YAAYj8D,IAAI,wBAAwBo5D,GAAG0B,UAAAA,MAAgB,YAAY;AACnEkB,uBAAA;AAAA,QACd;AACG5C,WAAAS,WAAW75D,IAAG,KAAA;AAAA,MAClB;AAAA,IACD;AACO,WAAAg8D;AAAAA,EACR;AAAA,EAEA,6BAA6B5C,IAAIt9D,QAAAA;AAC7B,QAACA,CAAAA,OAAMuC,OAAO89D,aAAargE,OAAMuC,OAAO89D,UAAUC,8BAA8B,MAAK;AACvF;AAAA,IACD;AAEA,UAAMV,mBAAmB5/D,OAAMsoC,aAAatoC,OAAMuC,OAAOg+D,yBACzD;AAAA,UAAMC,gBAAgB,CAAA;AACtB,UAAMC,qBAAqB,CAAA;AAE3BzgE,IAAAA,OAAMyE,YAAY,mBAAmB,SAASP,IAAIkH,MACjDo1D;AAAAA,oBAAct8D,EAAM,IAAA;AACb,aAAA;AAAA,IAAA,CAAA;AAGR,aAASw8D,qBAAqB75D,MAAAA;AACV45D,yBAAA55D,KAAK3C,EAAAA,IAAM2C;AAChB25D,oBAAA35D,KAAKi0B,OAAAA,IAAW;AAAA,IAC/B;AAEA,aAAS6lC,yBAAyBC,YACjC;AAAA,YAAM18D,KAAK08D,WAAW18D;AAClB,UAAA07D,iBAAiB5oC,OAAO9yB,EAAAA,GAAK;AAChCo5D,WAAGQ,aAAa;AACbR,WAAAS,WAAW75D,IAAI,MAAK,UAAA;AAAA,MACxB;AACOu8D,aAAAA,mBAAmBv8D,EAC3B;AAAA,IAAA;AAEAlE,IAAAA,OAAMyE,YAAY,kBAAkB,SAASP,IAAIgwB,OACzCssC;AAAAA,aAAAA,cAAct8D;IAAE,CAGxB07D;AAAAA,qBAAiBn7D,YAAY,cAAc,CAACP,IAAI2C;AAC5C,UAAA25D,cAAc35D,KAAKi0B,OAAS,GAAA;AAG9B4lC,6BAAqB75D,IAAI;AAAA,MAAA,OACrB;AACJ85D,iCAAyB95D,IAC1B;AAAA,MAAA;AAAA,IAAA,CAAA;AAGD+4D,qBAAiBn7D,YAAY,iBAAiB,CAACP,IAAI2C,SAAAA;AAC9C,UAAA+4D,iBAAiB5oC,OAAO9yB,EAAK,GAAA;AAC7B,YAAAu8D,mBAAmBv8D,KAAI;AACzBy8D,mCAAyB95D;QAAI,OACzB;AACJy2D,aAAGQ,aAAa,YAAA;AACbR,aAAAS,WAAW75D,IAAI,IAAA;AAAA,QACnB;AAAA,MACD;AAAA,IAGD07D,CAAAA;AAAAA,qBAAiBn7D,YAAY,iBAAiB,CAACP,IAAI2C;AAClDy2D,SAAGQ,aAAa,YAEhB;AAAA,YAAMI,eAAgBjhE,CAAAA,KAAK0gE,iBAAiBz5D,IAAIo5D,IAAIt9D;AACpD,UAAKk+D,CAAAA,cAAc;AAClB;AAAA,MACD;AACAZ,SAAGkB,UAAU33D,IACVy2D;AAAAA,SAAAS,WAAW75D,IAAI,MAAK;IAAS,CAGlC;AAAA,EAAA;AAAA,EAEA,mBAAmBo5D,IAAIt9D,QACnB;AAAA,QAAA,CAACA,OAAMuC,OAAO89D,aAAargE,OAAMuC,OAAO89D,UAAUQ,4BAA4B,MAAK;AACrF;AAAA,IACD;AAEA,UAAMC,iBAAiB9gE,OAAMsoC,aAAatoC,OAAMuC,OAAOw+D,cAAAA;AAEvD,aAASC,eAAeC,UACvB;AAAA,YAAM/8D,KAAK+8D,SAAS/8D;AAChB,UAAA48D,eAAe9pC,OAAO9yB,EAAAA,GAAK;AAC9Bo5D,WAAGQ,aAAa;AACbR,WAAAS,WAAW75D,IAAI,MAAK,UAAA;AAAA,MACxB;AAAA,IACD;AAEA48D,mBAAer8D,YAAY,cAAc,CAACP,IAAI2C,SAC7Cm6D;AAAAA,qBAAen6D,IAAI;AAAA,IAAA,CAAA;AAGpBi6D,mBAAer8D,YAAY,iBAAiB,CAACP,IAAI2C,SAC5C;AAAA,UAAAi6D,eAAe9pC,OAAO9yB,EAAAA,GAAK;AAC9Bo5D,WAAGQ,aAAa;AACbR,WAAAS,WAAW75D,IAAI,IAAA;AAAA,MACnB;AAAA,IAGD48D,CAAAA;AAAAA,mBAAer8D,YAAY,iBAAiB,CAACP,IAAI2C,SAAAA;AAChDy2D,SAAGQ,aAAa;AAEhB,YAAMI,eAAAA,CAAgBjhE,KAAK0gE,iBAAiBz5D,IAAIo5D,IAAIt9D;AACpD,UAAKk+D,CAAAA,cAAc;AAClB;AAAA,MACD;AACAZ,SAAGkB,UAAU33D,IAAAA;AACVy2D,SAAAS,WAAW75D,IAAI,MAAK;IAAS,CAGlC;AAAA,EAAA;AAAA,EAEA,mBAAmBo5D,IAAIt9D;AACnB,QAACA,CAAAA,OAAMuC,OAAO22D,aAAal5D,OAAMuC,OAAO22D,UAAUgI,4BAA4B,MAAK;AACrF;AAAA,IACD;AAEA,UAAMC,gBAAgBnhE,OAAMsoC,aAAatoC,OAAMuC,OAAO22D,UAAU7wB;AAEhE,aAAS24B,eAAeC,UACvB;AAAA,YAAM/8D,KAAK+8D,SAAS/8D;AAChB,UAAAi9D,cAAcnqC,OAAO9yB,EAAAA,GAAK;AAC7Bo5D,WAAGQ,aAAa,UACbR;AAAAA,WAAAS,WAAW75D,IAAI,MAAK;MACxB;AAAA,IACD;AAEAi9D,kBAAc18D,YAAY,cAAc,CAACP,IAAI2C,SAC5Cm6D;AAAAA,qBAAen6D;IAAI,CAGpBs6D;AAAAA,kBAAc18D,YAAY,iBAAiB,CAACP,IAAI2C,SAAAA;AAC3C,UAAAs6D,cAAcnqC,OAAO9yB,EAAK,GAAA;AAC7Bo5D,WAAGQ,aAAa,UAAA;AACbR,WAAAS,WAAW75D,IAAI,IACnB;AAAA,MAAA;AAAA,IAAA,CAAA;AAGDi9D,kBAAc18D,YAAY,iBAAiB,CAACP,IAAI2C,SAC/Cy2D;AAAAA,SAAGQ,aAAa,UAAA;AAEhB,YAAMI,eAAgBjhE,CAAAA,KAAK0gE,iBAAiBz5D,IAAIo5D,IAAIt9D,MAAAA;AACpD,WAAKk+D,cAAc;AAClB;AAAA,MACD;AACAZ,SAAGkB,UAAU33D,IACVy2D;AAAAA,SAAAS,WAAW75D,IAAI,MAAK,SAAA;AAAA,IAAS;EAElC;AAAA,EAEA;AACCk9D,YAAgBnkE,KAAKwgE,wBAAyBthE,OACxCc;AAAAA,WAAAsgE,OAAOl4D,YAAYlJ,CAAC;AAAA,IAAA,CAAA;AAE1Bc,SAAKwgE,yBAAyB,CAAA;AAAA,EAC/B;;ACxcuB,SAAA4D,YAAYrhE,QAAYs9D,IAC/Ct9D;AAAAA,EAAAA,OAAMmgE,cAAc,SAASj8D,IAAI5J,MAAMyZ;AAClC,QAAC9W,CAAAA,KAAKi2D,UAAU;AACnBj2D,WAAKi2D,WAAW;IACjB;AACAj2D,SAAKi2D,SAASn/C,KAAS9W,IAAAA,KAAKi2D,SAASn/C,KAAU,KAAA;AAC/C,QAAI9W,KAAKi2D,SAASn/C,KAAO7P,EAAAA,EAAAA,KAAOjH,KAAKi2D,SAASn/C,KAAO7P,EAAAA,EAAAA,EAAI5J,OAAO;AAC/D,aAAO2C,KAAKi2D,SAASn/C,KAAO7P,EAAAA,EAAAA,EAAI5J;IACjC;AACO,WAAA;AAAA,EAAA;AAER0F,EAAAA,OAAMshE,cAAc,SAASp9D,IAAI5J,MAAM0b,OAAOjC,OACzC;AAAA,QAAA,CAAC9W,KAAKi2D,UAAU;AACnBj2D,WAAKi2D,WAAW;IACjB;AACAj2D,SAAKi2D,SAASn/C,KAAS9W,IAAAA,KAAKi2D,SAASn/C,KAAAA,KAAU;AAC1C9W,SAAAi2D,SAASn/C,KAAAA,EAAO7P,EAAMjH,IAAAA,KAAKi2D,SAASn/C,KAAO7P,EAAAA,EAAAA,KAAO,CAAA;AACvDjH,SAAKi2D,SAASn/C,KAAO7P,EAAAA,EAAAA,EAAI5J,IAAQ0b,IAAAA;AAAAA,EAAA;AAG5BhW,EAAAA,OAAAuhE,aAAa,SAASttC,OAAOC;AAC1B,YAAAj3B,KAAK4hE,IAAIG,YAChB;AAAA,MAAA,KAAK;AACC/hE,aAAAqqD,aAAarzB,OAAOC;AACzB;AAAA,MACD,KAAK;AACCj3B,aAAA2rD,aAAa30B,OAAOC,KACzB;AAAA;AAAA,MACD,KAAK;AACJj3B,aAAK81B,MAAM6sC,iBAAiBnY,SAASxzB,OAAOC,KAC5C;AAAA;AAAA,MACD,KAAK;AACJj3B,aAAK81B,MAAM+tC,eAAerZ,SAASxzB,OAAOC,KAC1C;AAAA;AAAA,MACD,KAAK;AACJj3B,aAAK81B,MAAMouC,cAAc1Z,SAASxzB,OAAOC,KACzC;AAAA;AAAA,MACD;AACO,cAAA,IAAIyhB,MAAM,oEAAoE14C,KAAK4hE,IAAIG,uBAAuB9qC,KACtH,EAAA;AAAA,IAAA;AAAA,EAAA;AAGKl0B,EAAAA,OAAAwhE,aAAa,SAASC,OAAOrkE,WAAAA;AAC9B,QAAAH,KAAK4hE,IAAIG,eAAe,QAAQ;AACnC;AAAA,IACD;AACA,SAAKh/D,OAAM0d,aAAa+jD,KAAQ,GAAA;AAC/B;AAAA,IACD;AAEM,UAAAr2D,OAAOpL,OAAMmc,QAAQslD,KAAAA;AAC3Br2D,SAAKs2D,uBAAuBtkE;AAC5B4C,IAAAA,OAAMk5B,YAAYuoC,KAAK;AAAA,EAAA;AAIlBzhE,EAAAA,OAAA2hE,eAAe,SAASF,OAAO5qE,MAAAA;AAAAA,EAAM;AAErCmJ,EAAAA,OAAAg+D,iBAAiB,SAAS95D,IAAI2C,MAAAA;AACnC,QAAIA,KAAKi0D,cAAc;AACjB79D,WAAA4hE,IAAIf,aAAa;AACtB7gE,WAAKkf,QAAQjY,IAAI3H,SAASsK,KAAKi0D;AAC/B79D,WAAK4hE,IAAId,WAAW75D,IAAI,MAAK,OAAA;AAAA,aACtBjH,KAAKkf,QAAQjY,EAAAA,EAAI42D;AAAAA,IACzB;AAAA,EAAA;AAGD96D,EAAAA,OAAM4hE,QAAQ,WACb3kE;AAAAA,SAAK4hE,MAAMvB;AAAAA,EAAA;AAGZt9D,EAAAA,OAAM4hE,MAAAA;AACP;ACvEA,MAAqBC,iBAArB,MAAqBA;EAOV,cAAAzsC;AAIVn4B,SAAOqH,QAAQ,MACdrH;AAAAA,WAAK6kE,WAAW;IAAC;AAGX7kE,SAAAuhE,YAAa33D;AACnB5J,WAAK6kE,SAASj7D,KAAK3C,EAAAA,IAAMmmD,KAAWxjD,IAAAA;AAAAA,IAAI;AAGlC5J,SAAA8kE,gBAAiB79D,QAChBjH,KAAK6kE,SAAS59D,EAAAA,KAAO;AAZ5BjH,SAAK6kE,WAAW;EACjB;ACcM;ADtBN7kE,eAAc0R,SAAS,MACf,IAAIkzD;AAFb,IAAqBA,gBAArB;ACuBO,SAASG,oBAAoBz/D,SAC/B;AAAA,MAAA0/D;AACA,MAAAC;AACA,MAAArsB;AACJ,MAAItzC,mBAAkB61C,UAAU;AACtB6pB,aAAA1/D;AAAAA,EACC,WAAAA,QAAO69B,eAAe,QAAA,GAAW;AAC3C6hC,aAAS1/D,QAAO0/D;AAAAA,EAAA,WACN1/D,QAAO69B,eAAe,iBAAiB79B,QAAO69B,eAAe,UAAe79B,KAAAA,QAAO69B,eAAe,MAAA,KAAW79B,QAAO69B,eAAe,MAAA,GAAS;AAC7I6hC,aAAA1/D;AAAAA,EACA,WAAAA,QAAO69B,eAAe,SAAA,GAAW;AAE1CyV,cAAUtzC,QAAOszC;AAAAA,EAClB;AACA,MAAIosB,QAAQ;AACHC,YAAA;AAAA,EAAA,OACF;AACNA,YAAQ3/D,QAAOiyB,QAAQ;AAAA,EACxB;AACA,QAAMx0B,SAAQ/C;AACd,QAAMqgE,KAAK,IAAI6E,gBAAc5/D,QAAO+Q,GAGpCgqD;AAAAA,KAAG/iB,KAAKv6C,MAAAA;AACRs9D,KAAG8E,mBAAmB,EACrB5tC,MAAM0tC,OACND,QACApsB,WACEtzC,QAAOkpC,WAAAA;AACV,MAAGlpC,QAAO07D,yBAAwB;AACjCX,OAAGW,0BAA0B17D,QAAO07D;AAAAA,EACrC;AACO,SAAAX;AACR;AAEO,IAAA+E,kBAAA,MAAMF,cAAAA;AAAAA,EAmCZ,YAAYG;AACXrlE,SAAKiiE,kBAAkBoD;AACvBrlE,SAAKslE,eAAe;AAEpBtlE,SAAKgjE,cAAc,CAEnBhjE;AAAAA,SAAKulE,aAAa;AAClBvlE,SAAKohE,aAAa;AAClBphE,SAAKwlE,WAAW;AAChBxlE,SAAKylE,WAAW;AAChBzlE,SAAK0lE,aAAa;AAClB1lE,SAAK2lE,0BAA0B;AAE/B3lE,SAAK0hE,YAAY;AACjB1hE,SAAKmjE,eAAe;AACfnjE,SAAA6kE,WAAWD,cAAclzD,OAC9B1R;AAAAA,SAAK4lE,WAAW;AAChB5lE,SAAK6lE,WAAW,CAAA;AAEhB7lE,SAAKif,SAAS,EACb8jD,SAAS,qBACT+C,UAAU,qBACVC,SAAS,mCACTC,SAAS,4BACTC,cAAc,gCACdrkE,OAAO,cACPyF,OAAO,2CAERrH;AAAAA,SAAKkmE,kBAAkB,IAAA;AACvBx5D,kBAAU1M,IACX;AAAA,EAAA;AAAA,EAEA,mBAAmBu3B,MAAU4uC,OAAAA;AACxB,eAAO5uC,SAAS,UAAU;AACxBv3B,WAAA6hE,SAAStqC,KAAKA,QAAQv3B,KAAK6hE;AAEhC,UAAI/c,QAAcvtB,KAAKqhB,UAAU;AAChC54C,aAAKwlE,WAAWjuC,KAAKqhB;AAAAA,MACtB;AAEA,UAAIkM,QAAcvtB,KAAK6uC,OAAU,GAAA;AAChCpmE,aAAKylE,WAAWluC,KAAK6uC;AAAAA,MACtB;AACKpmE,WAAAyhE,SAAAA,CAAAA,CAAW0E;AAAAA,IAAA,OACV;AACNnmE,WAAK6hE,SAAStqC;AACdv3B,WAAKyhE,SAAS0E;AAAAA,IACf;AAEI,QAAAnmE,KAAK6hE,WAAW,QAAQ;AAC3B7hE,WAAKyhE,SAAS;AAAA,IACf;AAEA,QAAIzhE,KAAK6hE,WAAW,UAAU7hE,KAAK6hE,WAAW,aAAa;AAC1D7hE,WAAKyhE,SAAS;AACdzhE,WAAKqmE,mBAAmB;AACnBrmE,WAAAwlE,WAAWxlE,KAAKwlE,YAAY,CAAA;AAC5BxlE,WAAAwlE,SAAS,cAAA,IAAkB;AAAA,IAAA,OAC5B;AACJ,UAAGxlE,KAAKwlE,YAAAA,CAAaxlE,KAAKwlE,SAAS,cAAA,GAAgB;AAC7CxlE,aAAAwlE,SAAS,cAAA,IAAkB;AAAA,MACjC;AAAA,IACD;AAEI,QAAAxlE,KAAK6hE,WAAW,UAAU;AAC7B7hE,WAAKyhE,SAAS;AACdzhE,WAAKsmE,UAAU/uC,KAAKytC;AAAAA,IACrB;AAAA,EACD;AAAA,EAEA,OAAOvyD,OAAAA;AACN,QAAIzS,KAAKumE,MAAM;AACd,aAAOxuD,mBAAmBtF,KAAAA;AAAAA,IAAI,OACxB;AACN,aAAO+zD,OAAO/zD,KACf;AAAA,IAAA;AAAA,EACD;AAAA,EAOA,kBAAkB8kB,MACZv3B;AAAAA,SAAAumE,OAAShvC,CAAAA,CAAAA;AAAAA,EACf;AAAA,EAOA,eAAAkvC;AACQ,YAACzmE,KAAKgjE,YAAYjnE;AAAAA,EAC1B;AAAA,EAOA,cAAcw7B,MAAcmvC,KAC3B1mE;AAAAA,SAAKulE,aAAchuC,SAAS;AAC5Bv3B,SAAKohE,aAAa7pC;AAClBv3B,SAAK0mE,MAAMA;AAAAA,EACZ;AAAA,EAEA,OAAO/rD,MAAWC;AACjB5a,SAAKkG,eAAe;AACfyU,SAAA9e,KAAK+e,UAAUjY;AACpB3C,SAAKkG,eAAe;AAAA,EACrB;AAAA,EASA,WAAWs+D,OAAqB5gE,OAAgB2zB,MAAAA;AAC/C,QAAIv3B,KAAKkG,cAAc;AACtB;AAAA,IACD;AAEM,UAAA5F,MAAMN,KAAK2mE,QAAQnC;AAEzBjtC,WAAOA,QAAQ;AACT,UAAAqvC,WAAW5mE,KAAKsgE,OAAO4C,YAAYsB,OAAOxkE,KAAKslE,cAActlE,KAAK+hE;AACpE,QAAA6E,YAAYrvC,SAAS,WAAW;AAC5BA,aAAAqvC;AAAAA,IACR;AACA,QAAIhjE,OAAO;AACL5D,WAAA6mE,YAAYrC,OAAO,KAAA;AACnBxkE,WAAAgjE,YAAY1iE,GAAOkkE,IAAAA;AACxBxkE,WAAKsgE,OAAO+D,YAAYG,OAAOxkE,KAAKslE,cAAc/tC,MAAMv3B,KAAK+hE,UACzD;AAAA,UAAA/hE,KAAKmjE,aAAaqB,KAAAA,GAAQ;AACxBxkE,aAAAmjE,aAAaqB,KAAS,IAAA;AAAA,MAC5B;AAAA,IAAA,OACM;AACN,UAAKxkE,CAAAA,KAAK8mE,WAAWtC,KAAAA,GAAQ;AACvBxkE,aAAAgjE,YAAY3mE,OAAOiE,KAAK,CAC7BN;AAAAA,aAAKsgE,OAAO+D,YAAYG,OAAOxkE,KAAKslE,cAAc,IAAItlE,KAAK+hE,UAAAA;AAAAA,MAC5D;AAAA,IACD;AAEK/hE,SAAA+mE,QAAQvC,OAAO5gE,OAAO2zB,IAAAA;AACvB,QAAA3zB,SAAS5D,KAAKulE,YAAY;AAC7BvlE,WAAKgnE,SAASxC;IACf;AAAA,EACD;AAAA,EAEA,QAAQv9D,IAAqBrD,OAAgB2zB;AAC5C,QAAI33B,MAAM;AACJ,UAAAomE,UAAUhmE,KAAK8mE,WAAW7/D,EAAAA;AAChC,QAAI++D,SAAS;AACNpmE,YAAAI,KAAKif,OAAO+mD,OAAAA;AACVpiE,cAAA;AAAA,IACT;AACI,QAAA5D,KAAK+H,UAAU,aAAa,CAACd,IAAIrD,OAAO2zB,MAAMyuC,OAAW,CAAA,GAAA;AAE5DpmE,YAAMI,KAAKif,OAAOrb,QAAQ2zB,OAAO,OAAA,IAAW,MAAM33B;AAElDI,WAAKsgE,OAAOtgE,KAAKinE,SAAS,CAAA,CAAA,EAAIhgE,IAAIrH,GAAAA;AAE9B,UAAAomE,WAAWA,QAAQ1jC,SAAS;AACxB1iC,eAAAI,KAAKif,OAAO+mD,UAAU;AAC7B,iBAASlqE,IAAI,GAAGA,IAAIkqE,QAAQ1jC,QAAQvmC,QAAQD,KAAK;AAC5C,cAAAkqE,QAAQ1jC,QAAQxmC,CAAI,GAAA;AAClBkE,iBAAAsgE,OAAOtgE,KAAKinE,SAAS,IAAIhgE,IAAInL,GAAG8D,GACtC;AAAA,UAAA;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA,EAEA,iBAAiBgE,OAChB;AAAA,QAAIA,UAAU,YAAY;AAClB,aAAA;AAAA,IACR;AAEA,QAAIA,UAAU,WAAW;AACjB,aAAA;AAAA,IACR;AAEA,QAAIA,UAAU,WAAW;AACjB,aAAA;AAAA,IACR;AAGO,WAAA;AAAA,EACR;AAAA,EAEA,SAASqD,IACR;AAAA,WAAOjH,KAAKsgE,OAAO4C,YAAYj8D,IAAIjH,KAAKslE,cAActlE,KAAK+hE;EAC5D;AAAA,EAEA,WAAW96D,IACH;AAAA,WAAAjH,KAAK4lE,SAAS3+D,EAAAA;AAAAA,EACtB;AAAA,EAEA,YAAYA,IAAqBswB,MAAW+K,SAC3C;AAAA,QAAIA,SAAS;AACL/K,aAAA,EACNxe,OAAOwe,MACP+K,SACA5mB,UAAU,WACF;AAAA,eAAA1b,KAAK+Y,MAAM2C,SAAAA;AAAAA,MACnB,EAEF;AAAA,IAAA;AACK1b,SAAA4lE,SAAS3+D,MAAMswB;AAAAA,EACrB;AAAA,EAQA,kBAAkBitC,OACV;AAAA,WAAA;AAAA,EACR;AAAA,EAOA,SAASA,OACJ;AAAA,QAAAxkE,KAAKsgE,OAAO4G,UAAU;AACzBlnE,WAAKsgE,OAAO4G,SAAAA;AAAAA,IACb;AAEA,QAAW1C,OAAAA,UAAU,eAAexkE,KAAKyhE,QAAQ;AAEhD,YAAM0F,qBAAqB,CAAA;AAC3B,UAAGnnE,KAAKonE,OAAM;AACb,cAAMC,aAAa,CAAC,QAAQ,QAAQ,cAAc;AACvCA,mBAAAl+D,QAASouB,UAChB;AAAA,cAAAv3B,KAAKonE,MAAM7vC,SAASv3B,KAAKonE,MAAM7vC,IAAMyrC,EAAAA,YAAYjnE,QAAO;AAC1DorE,+BAAmBnoE,KAAKu4B,IAAAA;AAAAA,UACzB;AAAA,QAEF,CAAA;AAAA,MAAA;AAEA,UAAI4vC,mBAAmBprE,QAAO;AAC7B,iBAAQD,IAAI,GAAGA,IAAIqrE,mBAAmBprE,QAAQD,KAAI;AAC5CkE,eAAA6gE,aAAasG,mBAAmBrrE,CACrCkE,CAAAA;AAAAA,eAAKwhE;QACN;AACA;AAAA,MAAA,OACM;AACN,eAAOxhE,KAAKwhE,YAAAA;AAAAA,MACb;AAAA,IACD;AACI,QAAAxhE,KAAKmjE,aAAaqB,QAAQ;AACtB,aAAA;AAAA,IACR;AAEAxkE,SAAK6lE,WAAW,CAAA;AAChB,QAAK7lE,CAAAA,KAAKsnE,kBAAkB9C,KAAUxkE,KAAAA,KAAK+H,UAAU,qBAAqB,CAACy8D,OAAOxkE,KAAK6lE,QAAY,CAAA,GAAA;AAC3F,aAAA;AAAA,IACR;AACA7lE,SAAKunE,gBAAgBvnE,KAAKwnE,YAAYhD,QAAQA,KAC/C;AAAA,EAAA;AAAA,EAEA,UAAU/xD,OAAWxL,IACpB;AAAA,QAAIjH,KAAKqmE,kBAAkB;AAClB,aAAArmE,KAAKynE,iBAAiBh1D,KAC/B;AAAA,IAAA;AAEI,eAAOA,UAAS,UAAU;AACtB,aAAAA;AAAAA,IACR;AACI,eAAOxL,OAAO,aAAa;AACvB,aAAAjH,KAAK0nE,cAAcj1D,OAAM,EAAA;AAAA,IAAE,OAC5B;AACN,YAAM86B,QAAQ;AACd,YAAMxsB,OAAO,CACb;AAAA,iBAAW1H,OAAO5G,OAAM;AACnB,YAAAA,MAAK0wB,eAAe9pB,GAAM,GAAA;AACvBk0B,gBAAAvuC,KAAKgB,KAAK0nE,cAAcj1D,MAAK4G,GAAAA,GAAMA,MAAMrZ,KAAK0lE,UAAAA,CAAAA;AACpD3kD,eAAK/hB,KAAKqa,GACX;AAAA,QAAA;AAAA,MACD;AACMk0B,YAAAvuC,KAAK,SAASgB,KAAKwmE,OAAOzlD,KAAKvlB,KAAK,GAAA,CAAA,CAAA;AACtC,UAAAwE,KAAKsgE,OAAOqH,cAAc;AAC7Bp6B,cAAMvuC,KAAK,kBAAkBgB,KAAKsgE,OAAOqH;MAC1C;AACO,aAAAp6B,MAAM/xC,KAAK,GACnB;AAAA,IAAA;AAAA,EACD;AAAA,EAEA,cAAciX,OAAWm1D,MAAAA;AACpB,QAAOn1D,OAAAA,UAAS,UAAU;AACtB,aAAAA;AAAAA,IACR;AACA,UAAM86B,QAAQ;AACd,QAAIiL,aAAa;AACjB,eAAWn/B,OAAO5G,MACb,KAAAA,MAAK0wB,eAAe9pB,GAAM,GAAA;AACxB,WAAAA,QAAQ,QACZA,OAAOrZ,KAAKslE,iBACZtlE,KAAK6hE,WAAW,QAAQ;AACxB;AAAA,MACD;AACI,UAAOpvD,OAAAA,MAAK4G,SAAS,YAAmB5G,OAAAA,MAAK4G,SAAS,UAAU;AACtDm/B,qBAAA14C,OAAO2S,MAAK4G,GAAI,CAAA;AAAA,MAAA,OACvB;AACNm/B,qBAAazhC,KAAKC,UAAUvE,MAAK4G,GAClC,CAAA;AAAA,MAAA;AACMk0B,YAAAvuC,KAAKgB,KAAKwmE,QAAQoB,QAAQ,MAAMvuD,GAAAA,IAAO,MAAMrZ,KAAKwmE,OAAOhuB,UAChE,CAAA;AAAA,IAAA;AACM,WAAAjL,MAAM/xC,KAAK;EACnB;AAAA,EAEA,cACK;AAAA,QAAA,CAACwE,KAAKgjE,YAAYjnE,QAAQ;AAC7B;AAAA,IACD;AAEAiE,SAAK6lE,WAAW;AAChB,QAAIgC,QAAa;AAEZ7nE,SAAA8nE,mBAAmB,SAAStD;AACxBqD,cAAAA,SAAS7nE,KAAKsnE,kBAAkB9C,KAAAA;AAAAA,IAAK;AAG1C,QAACqD,CAAAA,SAAAA,CAAU7nE,KAAK+H,UAAU,qBAAqB,CAAC,IAAI/H,KAAK6lE,QAAAA,CAAAA,GAAY;AACjE,aAAA;AAAA,IACR;AAEA,QAAI7lE,KAAKyhE,QAAQ;AACXzhE,WAAA+nE,UAAU/nE,KAAKgoE;IAAa,OAC3B;AAGDhoE,WAAA8nE,mBAAmB,SAAStD;AAChC,YAAKxkE,CAAAA,KAAKmjE,aAAaqB,KAAAA,GAAQ;AAC1B,cAAAxkE,KAAK8mE,WAAWtC,KAAAA,GAAQ;AAC3B;AAAA,UACD;AACAxkE,eAAKunE,gBAAgBvnE,KAAKwnE,YAAYhD,KAAQA,GAAAA,KAAAA;AAAAA,QAC/C;AAAA,MAAA,CAAA;AAAA,IAEF;AAAA,EACD;AAAA,EAEA,QAAQyD,SACP;AAAA,QAAInsE,IAAI;AACR,SAAKA,IAAI,GAAGA,IAAIkE,KAAKgjE,YAAYjnE,QAAQD,KAAK;AAC7C,UAAImsE,WAAWjoE,KAAKgjE,YAAYlnE,CAAI,GAAA;AACnC;AAAA,MACD;AAAA,IACD;AACO,WAAAA;AAAAA,EACR;AAAA,EAQA,aAAauB,MAAcyJ,SAAAA;AACtB,SAAC9G,KAAKkoE,WAAW;AACpBloE,WAAKkoE,YAAY;IAClB;AACKloE,SAAAkoE,UAAU7qE,IAAQyJ,IAAAA;AAAAA,EACxB;AAAA,EAUA,oBAAoBgkD,KAAsBmG,KAAsBn4C,QAAgBqvD,MAAWC;AACvF,QAACpoE,CAAAA,KAAKsgE,QAAO;AAEf;AAAA,IACD;AAEAtgE,SAAK6gE,aAAauH,SAElB;AAAA,UAAM/vC,UAASyyB;AACT,UAAAud,UAAWvvD,WAAW,WAAWA,WAAW;AAClD,QAAA,CAAKuvD,SAAS;AACRroE,WAAA6mE,YAAY/b,KAAKhyC,MACvB;AAAA,IAAA;AACA,QAAK9Y,KAAKkoE,aAAeloE,KAAKkoE,UAAUpvD,MAAAA,KAAAA,CAAc9Y,KAAKkoE,UAAUpvD,MAAAA,EAAQqvD,IAAQ,GAAA;AAC5E,aAAOnoE,OAAAA,KAAKmjE,aAAa9qC,OAClC;AAAA,IAAA;AAEA,QAAIr4B,KAAKmjE,aAAa9qC,OAAAA,MAAY,QAAQ;AACpCr4B,WAAA8gE,WAAWhW,KAAK,KACtB;AAAA,IAAA;AAEA,UAAMwd,cAAcxd;AAEpB,YAAQhyC,QACP;AAAA,MAAA,KAAK;AAAA,MACL,KAAK;AACJ,YAAIm4C,OAAOnG,KAAK;AACV9qD,eAAA8gE,WAAWhW,KAAK,KACrB9qD;AAAAA,eAAKsgE,OAAOtgE,KAAKinE,SAAS,CAAInc,CAAAA,EAAAA,KAAKmG,GAC7BnG;AAAAA,gBAAAmG;AAAAA,QACP;AACA;AAAA,MACD,KAAK;AAAA,MACL,KAAK;AACJ,YAAA,CAAIjxD,KAAKghE,2BAA2BhhE,KAAK+hE,eAAe,QAAO;AAC9D/hE,eAAKsgE,OAAO+D,YAAYvZ,KAAK9qD,KAAKslE,cAAc,gBAAgBtlE,KAAK+hE,UACrE/hE;AAAAA,eAAKsgE,OAAOtgE,KAAKinE,SAAS,CAAA,CAAA,EAAInc;iBACvB9qD,KAAKmjE,aAAa9qC;AAClB,iBAAAr4B,KAAK+H,UAAU,iBAAiB,CAAC+iD,KAAKhyC,QAAQm4C,KAAKkX,IAAAA,CAAAA;AAAAA,QAAK,OAC3D;AACJ,cAAInoE,KAAK+hE,eAAe,UAAU/hE,KAAKsgE,OAAO7/C,aAAaqqC,GAAAA,GAAM;AAChE9qD,iBAAKsgE,OAAO+D,YAAYvZ,KAAK9qD,KAAKslE,cAAc,gBAAgBtlE,KAAK+hE,UAAAA;AACrE,kBAAM5zD,OAAOnO,KAAKsgE,OAAOphD,QAAQ4rC,GAC5B9qD;AAAAA,iBAAAsgE,OAAOhlC,OAAO,MAAA;AACbt7B,mBAAAsgE,OAAOzW,WAAWiB;YAAG,CAE3B9qD;AAAAA,iBAAKsgE,OAAOv4D,UAAU,qBAAqB,CAAC+iD,KAAK38C,IACjDnO,CAAAA;AAAAA,iBAAKsgE,OAAO56D,OACL1F;AAAAA,mBAAAA,KAAKmjE,aAAa9qC,OAC1B;AAAA,UAAA;AACO,iBAAAr4B,KAAK+H,UAAU,iBAAiB,CAAC+iD,KAAKhyC,QAAQm4C,KAAKkX,IAAAA,CAAAA;AAAAA,QAC3D;AAAA,IAIF;AAAA,QAAInoE,KAAKmjE,aAAa9qC,OAAAA,MAAY,QAAQ;AACzC,UAAIgwC,SAAS;AACZroE,aAAKsgE,OAAO+D,YAAYvZ,KAAK9qD,KAAKslE,cAAc,IAAItlE,KAAK+hE,UAC1D;AAAA,MAAA;AAAA,aACO/hE,KAAKmjE,aAAa9qC;IAAM,OACzB;AAAA,aACCr4B,KAAKmjE,aAAa9qC,OAAAA;AACpBr4B,WAAA8gE,WAAW7P,KAAK,MAAMjxD,KAAKsgE,OAAO4C,YAAYpY,KAAK9qD,KAAKslE,cAActlE,KAAK+hE,UACjF,CAAA;AAAA,IAAA;AAEA/hE,SAAK+H,UAAU,iBAAiB,CAACugE,aAAaxvD,QAAQm4C,KAAKkX;EAC5D;AAAA,EAOA,YAAYI,MAAWnvB,KAAUnyC,IAAAA;AAC5B,QAAAuhE;AACA,QAAA5hE,UAAU7K,WAAW,GAAG;AAC3BysE,aAAO5hE,UAAU,CAAA;AAAA,IAAC,OACZ;AAEN4hE,aAAO5hE,UAAU,CAClB;AAAA,IAAA;AACI,QAAA2wB,OAAOv3B,KAAKyoE,aAAAA;AACV,UAAAC,SAASF,KAAK5tB,YAAY4tB,KAAKnyD;AAErC,QAAIrW,KAAK6hE,WAAW,UAAU7hE,KAAK6hE,WAAW,aAAa;AAC1D,UAAI6G,OAAOzrE,QAAQ,4BAA4B;AACvCs6B,eAAA;AAAA,MACG,WAAAmxC,OAAOzrE,QAAQ,wBAAA,MAAA,IAAkC;AACpDs6B,eAAA;AAAA,MACG,WAAAmxC,OAAOzrE,QAAQ,sBAAgC,MAAA,IAAA;AAClDs6B,eAAA;AAAA,MAAA,OACD;AACCA,eAAA;AAAA,MACR;AAAA,IAAA,OACM;AACN,UAAImxC,OAAOzrE,QAAQ,OAAY,KAAA,GAAG;AAC1Bs6B,eAAA;AAAA,MACE,WAAAmxC,OAAOzrE,QAAQ,aAAA,KAAkB,GAAE;AACrCs6B,eAAA;AAAA,MACE,WAAAmxC,OAAOzrE,QAAQ,WAAgB,KAAA,GAAE;AACnCs6B,eAAA;AAAA,MAAA,OACD;AACCA,eAAA;AAAA,MACR;AAAA,IACD;AACAv3B,SAAK6gE,aAAatpC,IAEZ;AAAA,UAAA/gB,QAAOxW,KAAKsgE,OAAO9pD;AAErB,QAAAmyD;AAEA,QAAA;AACHA,YAAM5xD,KAAKW,MAAM0hC,IAAIlhC,OAAOP;aAEpBzY,GAGR;AAAA,UAAA,CAAKk6C,IAAIlhC,OAAOP,aAAa5b,QAAQ;AACpC4sE,cAAM,CAAA;AAAA,MACP;AAAA,IACD;AAEM,UAAAC,kBAAmB9X,YAAAA;AACxB,YAAMh4C,SAAS6vD,IAAI7vD,UAAU9Y,KAAKuN,SAASujD,MAAAA,KAAW;AACtD,YAAMhG,MAAM6d,IAAI7d,OAAOgG,OAAO;AAC9B,YAAMG,MAAM0X,IAAI1X,OAAOH,OAAO,CAAA;AAC9ByX,WAAKM,oBAAoB/d,KAAKmG,KAAKn4C,QAAQ6vD,KAAKpxC,IAAAA;AAAAA,IAAI;AAErD,QAAIoxC,KAAK;AAER,UAAIjtE,MAAMoO,QAAQ7C,OAAOA,GAAGlL,SAAS,GAAG;AACvCkL,WAAGkC,QAASmlB,YAAWs6C,gBAAgBt6C,MAAO,CAAA;AAAA,MAAA,OACxC;AACNs6C,wBAAgB3hE;MACjB;AACAshE,WAAKO;AACL9oE,WAAK6gE,aAAatpC;AAClB;AAAA,IACD;AAGA,UAAM1/B,MAAM2e,MAAK0iC,OAAO,QAAQE,IAAIlhC,MAAAA;AACpC,SAAKrgB,KAAK;AACF,aAAAmI,KAAK+oE,YAAY9hE,EACzB;AAAA,IAAA;AACA,UAAM+hE,OAAOxyD,MAAK+iC,MAAM,iBAAiB1hD,GACrC;AAAA,QAAA,CAACmxE,KAAKjtE,QAAQ;AACV,aAAAiE,KAAK+oE,YAAY9hE,EAAAA;AAAAA,IACzB;AAEA,aAASnL,IAAI,GAAGA,IAAIktE,KAAKjtE,QAAQD,KAAK;AAC/B,YAAAqsE,OAAOa,KAAKltE,CACZ;AAAA,YAAAgd,SAASqvD,KAAK/tE,aAAa,MAC3B;AAAA,YAAA0wD,MAAMqd,KAAK/tE,aAAa,KACxB;AAAA,YAAA62D,MAAMkX,KAAK/tE,aAAa,KAAA;AAE9BmuE,WAAKM,oBAAoB/d,KAAKmG,KAAKn4C,QAAQqvD,MAAM5wC;IAClD;AACAgxC,SAAKO,eACN;AAAA,EAAA;AAAA,EAEA,YAAY7hE;AACX,QAAIA,IAAI;AACP,eAASnL,IAAI,GAAGA,IAAImL,GAAGlL,QAAQD,KAAK;AAC5BkE,eAAAA,KAAKmjE,aAAal8D,GAAGnL,CAAAA,CAAAA;AAAAA,MAC7B;AAAA,IACD;AAAA,EACD;AAAA,EAEA,iBACC;AAAA,QAAIkE,KAAK0hE,WAAW;AACd1hE,WAAA0hE;AAAAA,IACN;AAEK1hE,SAAA+H,UAAU,uBAAuB,CAAA,CAAA;AAClC,SAAC/H,KAAKgjE,YAAYjnE,QAAQ;AACxBiE,WAAA+H,UAAU,cAAc,CAC9B,CAAA;AAAA,IAAA;AAAA,EACD;AAAA,EAOA,KAAKhF;AACJ,QAAI/C,KAAKipE,cAAc;AACtB;AAAA,IACD;AACAjpE,SAAKsgE,SAASv9D;AACV,QAAA/C,KAAKsgE,OAAO4I,UAAU;AACpBlpE,WAAAsgE,OAAO4I,SAASlpE,IAAAA;AAAAA,IACtB;AAEAA,SAAKmpE;AAELnpE,SAAKif,SAAS,EACb8jD,SAAQ,iBACRvV,OAAM,iBACNsY,UAAS,kBACTC,SAAQ,iBACRqD,qBAAoB,iBACpBpD,SAAQ,iBACRpkE,OAAM,eACNyF,OAAM;AAGPrH,SAAKinE,WAAS,CAAC,cAAa,oBAAmB,cAAa;AAChD7C,gBAAApkE,KAAKsgE,QAAQtgE,IACzB;AAAA,UAAMqpE,sBAAsB,IAAIjJ,oBAAoBpgE,KAAKsgE,QAAQtgE,IACjEqpE;AAAAA,wBAAoB7kE;AACfxE,SAAAwH,YAAY,aAAa,WAAA;AAAA,aACtBxH,KAAK6gE;AAAAA,aACL7gE,KAAKwnE;AAELxnE,aAAAA,KAAKsgE,OAAOsB;AAAAA,aACZ5hE,KAAKsgE,OAAOgE;aACZtkE,KAAKsgE,OAAOiE;aACZvkE,KAAKsgE,OAAOoE;aACZ1kE,KAAKsgE,OAAOS;AACZ/gE,aAAAA,KAAKsgE;AAEZ+I,0BAAoB1jE;IAAO,CAE5B3F;AAAAA,SAAKsgE,OAAOv4D,UAAU,wBAAwB,CAAC/H,IAC/CA,CAAAA;AAAAA,SAAKipE,eAAe;AAAA,EACrB;AAAA,EAEA,iBAAiBniE,SACX9G;AAAAA,SAAAwH,YAAY,iBAAiBV,OAAAA;AAAAA,EACnC;AAAA,EAEA,yBAAyBA,SACnB9G;AAAAA,SAAAwH,YAAY,uBAAuBV;EACzC;AAAA,EAKA,cAAcowB,UAAUoyC,MACvBpyC;AAAAA,eAAWA,YAAY;AAEvBl3B,SAAKupE,QAAQD,SAAA,oBAAa5wD,QAAQjL;AAClCzN,SAAKwpE,cAAc;AAEnBxpE,SAAKypE,cAAc;AAEdzpE,SAAAwH,YAAY,iBAAiBxH,KAAK0pE,eAElC1pE;AAAAA,SAAAwH,YAAY,cAAcxH,KAAK2pE,QAEpCxyC;AAAAA,gBAAY,MACXn3B;AAAAA,WAAK4pE;IAAW,GACd1yC,QAAAA;AAAAA,EACJ;AAAA,EAMA,gBAAgB4zB,KAAKhyC,QAAQm4C,KAAK4Y,UAAAA;AACjC,QAAI/wD,WAAW,aAAa;AAC3B9Y,WAAKwpE,cAAc;AACZ,aAAA;AAAA,IAAA,OACD;AACC,aAAA;AAAA,IACR;AAAA,EACD;AAAA,EAKA,WAAAG;AACC,QAAI3pE,KAAKwpE,aAAa;AACrBxpE,WAAKwpE,cAAc;AACnBxpE,WAAK4pE,WACN;AAAA,IAAA;AACO,WAAA;AAAA,EACR;AAAA,EAIA,WAAWvzD,KAAKvO,UACT;AAAA,UAAA0O,QAAOxW,KAAKsgE,OAAO9pD;AACzB,QAAIxW,KAAKypE,aAAa;AACd,aAAA;AAAA,IAAA,OACD;AACNzpE,WAAKypE,cAAc;AAAA,IACpB;AAEKjzD,IAAAA,MAAA83B,IAAIj4B,KAAKvO,QAEf;AAAA,EAAA;AAAA,EAIA,aACO;AAAA,UAAA0O,QAAOxW,KAAKsgE,OAAO9pD;AACzB,UAAMvD,UAAUjT,KAAKsgE,OAAO4C,YAAY,GAAG,WAAWljE,KAAK+hE,UAC3D;AAAA,QAAI1rD,MAAMrW,KAAKiiE,kBAAkBzrD,MAAKukC,aAAa/6C,KAAKiiE,eAAAA,IAAmB,CAAC,cAAcjiE,KAAKupE,OAAO,iBAAiBt2D,OAAAA,EAASzX,KAAK,GAAA;AAC/H6a,UAAAA,IAAI5Y,QAAQ,iBAAiB,EAAA;AAC9BuC,SAAA8pE,WAAWzzD,KAAM+iC,SAAAA;AACrB,YAAM2wB,OAAOvzD,MAAK+iC,MAAM,cAAcH,GACjCp5C;AAAAA,WAAAsgE,OAAO+D,YAAY,GAAG,WAAWrkE,KAAKgqE,iBAAiBD,KAAK,CAAK/pE,CAAAA,GAAAA,KAAK+hE,UAE3E;AAAA,YAAMkI,UAAUzzD,MAAK+iC,MAAM,YAAYH,GAAAA;AACvC,UAAI6wB,QAAQluE,QAAQ;AACnBiE,aAAKkG,eAAe;AAEpB,iBAASpK,IAAI,GAAGA,IAAImuE,QAAQluE,QAAQD,KAAK;AACxC,gBAAMwb,SAAS2yD,QAAQnuE,CAAAA,EAAG1B,aAAa,QAAA;AACvC,gBAAM6M,KAAKgjE,QAAQnuE,CAAG1B,EAAAA,aAAa;AACnC,gBAAM0G,SAASmpE,QAAQnuE,CAAG1B,EAAAA,aAAa,QACvC;AAAA,kBAAQkd,QACP;AAAA,YAAA,KAAK;AACCtX,mBAAA+H,UAAU,kBAAkB,CAACkiE,QAAQnuE,IAAImL,IAAInG,MAAAA,CAAAA;AAClD;AAAA,YACD,KAAK;AACCd,mBAAA+H,UAAU,kBAAkB,CAACkiE,QAAQnuE,CAAAA,GAAImL,IAAInG,MAAAA,CAAAA;AAClD;AAAA,YACD,KAAK;AACCd,mBAAA+H,UAAU,kBAAkB,CAACkiE,QAAQnuE,CAAImL,GAAAA,IAAInG;AAClD;AAAA,UAEH;AAAA,QAAA;AAEAd,aAAKkG,eAAe;AAAA,MACrB;AAEAlG,WAAKypE,cAAc;AAAA,IAAA;EAErB;AAAA,EAEA,aACMzpE;AAAAA,SAAA+H,UAAU,aAAa;AAC5B/H,SAAKuI,gBAAAA;AAELvI,SAAKgjE,cAAc,CACnBhjE;AAAAA,SAAKmjE,eAAe;AACpBnjE,SAAK4lE,WAAW;AAChB5lE,SAAK6kE,SAASx9D,MACdrH;AAAAA,SAAK6kE,WAAW;AAChB7kE,SAAKwlE,WAAW;AAChBxlE,SAAKylE,WAAW;AACTzlE,WAAAA,KAAKipE;AAAAA,EACb;AAAA,EAEA,aAAa1xC,MAAAA;AACZ,QAAIA,SAAS,SAAS;AACdA,aAAA;AAAA,IAAA,WACGA,SAAS,SAAS;AACrBA,aAAA;AAAA,IACR;AAEM,UAAA6vC,QAAQpnE,KAAKonE,SAAS;AACtB,UAAAgB,YAAYpoE,KAAKyoE,aAAAA;AACvB,QAAIL,WAAW;AACdhB,YAAMgB,aAAa,EAClBjF,cAAenjE,KAAKmjE,cACpByC,UAAU5lE,KAAK4lE,UACff,UAAU7kE,KAAK6kE,UACf7B,aAAchjE,KAAKgjE;IAErB;AAEI,QAAAhF,WAAWoJ,MAAM7vC,IACrB;AAAA,QAAA,CAAKymC,UAAU;AACHA,iBAAAoJ,MAAM7vC,IAAAA,IAAQ,EACxB4rC,cAAe,CAAC,GAChByC,UAAW,CAAC,GACZf,UAAWD,cAAclzD,OACzBsxD,GAAAA,aAAc,CAEhB,EAAA;AAAA,IAAA;AACAhjE,SAAKmjE,eAAenF,SAASmF;AAC7BnjE,SAAK4lE,WAAW5H,SAAS4H;AACzB5lE,SAAK6kE,WAAW7G,SAAS6G;AACzB7kE,SAAKgjE,cAAchF,SAASgF;AAC5BhjE,SAAKonE,QAAQA;AACbpnE,SAAK+hE,aAAaxqC;AAAAA,EACnB;AAAA,EACA,eACC;AAAA,WAAOv3B,KAAK+hE;AAAAA,EACb;AAAA,EAEA,UAAUn4D,MACJ5J;AAAAA,SAAA6kE,SAAStD,UAAU33D;EACzB;AAAA,EAEA,IAAIyM,KAAAA;AACErW,SAAAiiE,kBAAkBjiE,KAAK8hE,mBAAmBzrD;AAAAA,EAChD;AAAA,EAEU,gBAAgB5D,OAAW+xD,OACpC;AAAA,QAAA,CAAKxkE,KAAK+H,UAAU,kBAAkB,CAACy8D,OAAOxkE,KAAKuN,SAASi3D,QAAQ/xD,KAAQ,CAAA,GAAA;AACpE,aAAA;AAAA,IACR;AACKzS,SAAA+nE,UAAUt1D,OAAM+xD,KAAAA;AAAAA,EACtB;AAAA,EAEU,iBAAiB/xD;AACtB,QAAOA,OAAAA,UAAS,UAAU;AACtB,aAAAA;AAAAA,IACR;AAEM,UAAApO,SAAO+oD,KAAW36C,KACpB;AAAA,QAAAzS,KAAK6hE,WAAW,aAAa;AAAA,aACzBx9D,OAAK4C;AACL5C,aAAAA,OAAKrE,KAAKslE,YAAAA;AAAAA,IAClB;AAEO,WAAAvuD,KAAKC,UAAU3S,MAAAA;AAAAA,EACvB;AAAA,EAEU,cAAcgS;AACjB,UAAAG,QAAOxW,KAAKsgE,OAAO9pD;AACzB,QAAIxW,KAAKylE,UAAU;AACP,iBAAApsD,OAAOrZ,KAAKylE,UAAU;AAChCpvD,cAAMA,MAAMG,MAAKukC,aAAa1kC,GAAAA,IAAOrW,KAAKwmE,OAAOntD,GAAAA,IAAO,MAAMrZ,KAAKwmE,OAAOxmE,KAAKylE,SAASpsD,GAAAA,CAAAA;AAAAA,MACzF;AAAA,IACD;AACO,WAAAhD;AAAAA,EACR;AAAA,EAIU,4BAA4B6zD,YACjC;AAAA,QAAAC;AACJ,QAAGD,WAAWlqE,KAAKslE,YAAAA,MAAAA,QAA4B;AAC9C6E,sBAAgB,CAAA;AAChB,iBAAUruE,KAAKouE,YAAY;AAC1BC,sBAAcruE,CAAKkE,IAAAA,KAAKoqE,4BAA4BF,WAAWpuE,CAChE,CAAA;AAAA,MAAA;AAAA,IAAA,OACM;AACUquE,sBAAAnqE,KAAKqqE,uBAAuBH,UAAAA;AAAAA,IAC7C;AACO,WAAAC;AAAAA,EACR;AAAA,EACU,uBAAuBG,aAAAA;AAChC,QAAIC,SAAS;AACb,QAAGD,aAAY;AACd,UAAGA,YAAYtqE,KAAKslE,YAAkB,MAAA,WAAU;AAC/CiF,iBAAS,CAAA;AACTA,eAAOtjE,KAAKqjE,YAAYrjE;AACxBsjE,eAAOvqE,KAAKslE,YAAgBgF,IAAAA,YAAYtqE,KAAKslE,YAAAA;AAAAA,MAAY,OACrD;AACKiF,iBAAAD;AAAAA,MACV;AAAA,IACD;AAEO,WAAAC;AAAAA,EACR;AAAA,EAEU,UAAUL,YAAiB1F,OAAAA;AACpC,QAAK0F,CAAAA,YAAY;AAChB;AAAA,IACD;AACA,QAAKlqE,CAAAA,KAAK+H,UAAU,uBAAuBy8D,QAAQ,CAACA,OAAOxkE,KAAKuN,SAASi3D,KAAQ0F,GAAAA,UAAAA,IAAc,CAAC,MAAM,MAAMA,cAAc;AAClH,aAAA;AAAA,IACR;AAEA,QAAI1F,OAAO;AACVxkE,WAAKmjE,aAAaqB,UAAK,oBAAS9rD,QAAQjL,QACzC;AAAA,IAAA;AAEM,UAAA+I,QAAOxW,KAAKsgE,OAAO9pD;AAErB,QAAAxW,KAAK6hE,WAAW,UAAU;AACvB,YAAA2I,YAAYxqE,KAAKuN,SAASi3D,KAAAA;AAC1B,YAAAiG,aAAazqE,KAAK0qE,iBAAiBF,SAAAA;AACnC,YAAApC,YAAYpoE,KAAKyoE,aACjB;AAAA,YAAAkC,0BAA2BhC,SAChC;AAAA,YAAI7vD,SAAS0xD,aAAa;AAC1B,YAAI1f,MAAM0Z;AACV,YAAIvT,MAAMuT;AAEV,YAAImE,KAAK;AACR7vD,mBAAS6vD,IAAI7vD,UAAU0xD;AACvB1f,gBAAM6d,IAAI7d,OAAOA;AACXmG,gBAAA0X,IAAI1hE,MAAM0hE,IAAI1X,OAAOA;AAAAA,QAC5B;AACAjxD,aAAK6oE,oBAAoB/d,KAAKmG,KAAKn4C,QAAQ6vD,KAAKP,SAAAA;AAAAA,MAAS;AAGtD,UAAAwC;AACA,UAAA5qE,KAAKsmE,mBAAmBnrB,UAAU;AAClC,YAAAn7C,KAAK2lE,4BAA4B,UAAS;AAC5C,gBAAM5mE,MAAM,EACXoqC,QAAQi/B,WACRtvD,QAAQ2xD,YACRh4D,MAAMy3D,YACNjjE,IAAIu9D,MAEWoG;AAAAA,0BAAA5qE,KAAKsmE,QAAQvnE;QAAG,OAC1B;AACN6rE,0BAAgB5qE,KAAKsmE,QAAQ8B,WAAWqC,YAAYP,YAAY1F,KACjE;AAAA,QAAA;AAAA,MACU,WAAAxkE,KAAKsmE,QAAQ8B,SAAAA,aAAsBjtB,UAAU;AACvDyvB,wBAAgB5qE,KAAKsmE,QAAQ8B,SAAWqC,EAAAA,YAAYP,YAAY1F,KAAAA;AAAAA,MAAK,OAC/D;AAEN,cAAMqG,gBAAgB;AACtB,cAAMC,cAAc;AAAA;AAAA;AAIpB,aAAI9qE,KAAKsmE,QAAQ8B,SAAW,GAAA;AACrB,gBAAA,IAAI1vB,MAAM,GAAGmyB,aAAAA,sBAAmCzC,sCAAsC0C,WAC7F,EAAA;AAAA,QAAA;AACA,gBAAQN,WACP;AAAA,UAAA,KAAK;AACJ,gBAAA,CAAIxqE,KAAKsmE,QAAQ8B,WAAW12D,QAAO;AAC5B,oBAAA,IAAIgnC,MAAM,GAAGmyB,aAA8CzC,iCAAAA,SAAAA,6BAAsC0C,WACxG,EAAA;AAAA,YAAA;AACAF,4BAAgB5qE,KAAKsmE,QAAQ8B,SAAW12D,EAAAA,OAAOw4D,UAC/C;AAAA;AAAA,UACD,KAAK;AACJ,iBAAIlqE,KAAKsmE,QAAQ8B,SAAW/+C,EAAAA,QAAO;AAC5B,oBAAA,IAAIqvB,MAAM,GAAGmyB,8CAA8CzC,SAAsC0C,6BAAAA,WAAAA,EAAAA;AAAAA,YACxG;AACAF,4BAAgB5qE,KAAKsmE,QAAQ8B,SAAAA,EAAW/+C,OAAOm7C,KAAAA;AAC/C;AAAA,UACD;AACC,gBAAA,CAAIxkE,KAAKsmE,QAAQ8B,SAAAA,EAAWt/B,QAAO;AAC5B,oBAAA,IAAI4P,MAAM,GAAGmyB,aAAAA,kCAA+CzC,sCAAsC0C,WACzG,EAAA;AAAA,YAAA;AACAF,4BAAgB5qE,KAAKsmE,QAAQ8B,WAAWt/B,OAAOohC,YAAY1F,KAC3D;AAAA;AAAA,QAAA;AAAA,MAEH;AAEA,UAAGoG,eAAc;AAEb,YAAA,CAACA,cAAc9pB,SAChB8pB,cAAc3jE,OAAAA,UAAoB2jE,cAAc3Z,QAAAA,UAAqB2Z,cAAc9xD,WAAsB,SAAA;AACpG,gBAAA,IAAI4/B,MAAM,2EACjB;AAAA,QAAA;AAEA,YAAGkyB,cAAc9pB,MAAK;AACrB8pB,wBAAc9pB,KAAK6pB,uBAAAA,EAAyBzoB,MAAOtgD,WAC/C;AAAA,gBAAAA,SAASA,MAAMkX,QAAO;AACxB6xD,sCAAwB/oE,KAAAA;AAAAA,YAAK,OACzB;AACJ+oE,sCAAwB,EAAE7xD,QAAQ,SAASC,OAAOnX;YACnD;AAAA,UACA,CAAA;AAAA,QAAA,OACG;AAEJ+oE,kCAAwBC,aAAAA;AAAAA,QACzB;AAAA,MAAA,OACI;AACJD,gCAAwB;MACzB;AACA;AAAA,IACD;AAEI,QAAAI;AACUA,kBAAA,EACbjjE,UAAWsxC,SAAAA;AACV,YAAM2a,MAAM,CAEZ;AAAA,UAAIyQ,OAAO;AACVzQ,YAAI/0D,KAAKwlE;iBACC0F,YAAY;AACtB,mBAAW7wD,OAAO6wD,YAAY;AAC7BnW,cAAI/0D,KAAKqa,GACV;AAAA,QAAA;AAAA,MACD;AAEA,aAAOrZ,KAAKgrE,YAAYhrE,MAAMo5C,KAAK2a,GAAAA;AAAAA,IAAG,GAEvCnb,SAAS54C,KAAKwlE,SAGT;AAAA,UAAAyF,aAAa,iBAAiBjrE,KAAKsgE,OAAO4C,YAAY,GAAG,WAAWljE,KAAK+hE,UAC/E;AAAA,UAAMmJ,YAAYlrE,KAAKiiE,mBAAmBjiE,KAAKupE,QAAS/yD,MAAKukC,aAAa/6C,KAAKiiE,eAAmB,IAAA,CAAC,cAAcjiE,KAAKupE,OAAO0B,UAAAA,EAAYzvE,KAAK,GAAQ,IAAA;AAClJ,QAAA6a,MAAWrW,KAAKmrE,cAAcD,SAC9B;AAAA,QAAAz4D;AAEJ,YAAQzS,KAAK6hE,QAAAA;AAAAA,MACZ,KAAK;AACGpvD,QAAAA,QAAAzS,KAAKoqE,4BAA4BF,UAAAA;AAC5Ba,oBAAA10D,MAAMA,MAAMG,MAAKukC,aAAa1kC,GAAOrW,IAAAA,KAAKqgB,UAAU5N,OAAM+xD,KAAAA;AACtEuG,oBAAYvpE,SAAS;AACrB;AAAA,MACD,KAAK;AACGiR,QAAAA,QAAAzS,KAAKoqE,4BAA4BF,UAAAA;AACxCa,oBAAY10D,MAAMA;AAClB00D,oBAAYvpE,SAAS;AACrBupE,oBAAYt4D,OAAOzS,KAAKqgB,UAAU5N,OAAM+xD,KAAAA;AACxC;AAAA,MACD,KAAK;AACJ/xD,QAAAA,QAAO,CAAA;AACD,cAAA24D,mBAAmBprE,KAAKqqE,uBAAuBH,UAAAA;AACrD,mBAAW7wD,OAAO+xD,kBAAkB;AACnC,cAAI/xD,QAAQrZ,KAAKslE,gBAAgBjsD,QAAQ,QAAQA,QAAQ,SAAS;AACjE;AAAA,UACD;AACK5G,UAAAA,MAAA4G,GAAAA,IAAO+xD,iBAAiB/xD,GAC9B;AAAA,QAAA;AAEA0xD,oBAAY10D,MAAMA;AAClB00D,oBAAYvpE,SAAS;AACTupE,oBAAAt4D,OAAOsE,KAAKC,UAAU,EACjC/P,IAAIu9D,OACJ1rD,QAAQoxD,WAAWlqE,KAAKslE,YAAAA,GACxB7yD;AAED;AAAA,MACD,KAAK;AAAA,MACL,KAAK;AACE4D,cAAA60D,UAAUztE,QAAQ,sBAAsB;AACvCgV,QAAAA,QAAA;AAEC,gBAAAzS,KAAKuN,SAASi3D,KACrB,GAAA;AAAA,UAAA,KAAK;AACJuG,wBAAYvpE,SAAS;AACrBupE,wBAAYt4D,OAAOzS,KAAKqgB,UAAU6pD,YAAY1F,KAC9C;AAAA;AAAA,UACD,KAAK;AACJuG,wBAAYvpE,SAAS;AACrB6U,kBAAMA,OAAOA,IAAIza,cAAc,MAAM,KAAK,OAAO4oE;AACjD;AAAA,UACD;AACCuG,wBAAYvpE,SAAS;AACrBupE,wBAAYt4D,OAAOzS,KAAKqgB,UAAU6pD,YAAY1F;AAC9CnuD,kBAAMA,OAAOA,IAAIza,MAAAA,EAAc,MAAA,MAAM,KAAK,OAAO4oE;AACjD;AAAA;AAEUuG,oBAAA10D,MAAMrW,KAAKmrE,cAAc90D,GAAAA;AACrC;AAAA,IAGGrW;AAAAA,SAAA0hE;AACE,WAAAlrD,MAAKwjC,MAAM+wB,WAAAA;AAAAA,EACnB;AAAA,EAEU,mBAAmBpwD,MAAAA;AACtB,UAAAqoD,cAAchjE,KAAKgjE,YAAYpnE,MAAAA;AACrC,aAASE,IAAI,GAAGA,IAAIknE,YAAYjnE,QAAQD,KAAK;AACtC,YAAA0oE,QAAQxB,YAAYlnE,CAAAA;AACtB,UAAAkE,KAAKsgE,OAAO4C,YAAYsB,OAAOxkE,KAAKslE,cAActlE,KAAK+hE,UAAAA,GAAa;AAClEpnD,aAAA9e,KAAKmE,MAAMwkE,KAAAA;AAAAA,MACjB;AAAA,IACD;AAAA,EACD;AAAA,EAEU,6BAAA2E;AACT,QAAInpE,KAAKiiE,iBAAiB;AACpBjiE,WAAAmlE,mBAAmB,QAAQ,IAAA;AAC3BnlE,WAAAiiE,oBAAoBjiE,KAAKiiE,gBAAgBhlE,QAAQ,cAAc,MAAM,OAAO;AACjF+C,WAAK8hE,mBAAmB9hE,KAAKiiE;AAAAA,IAC9B;AAAA,EACD;AAAA,EAMU,iBAAiBroE;AAC1B,QAAIA,KAAK2E,YAAY;AACpB,aAAO3E,KAAK2E,WAAW8sE;AAAAA,IACxB;AACO,WAAA;AAAA,EACR;AAAA,EAEU,cAAArD;AACT,UAAMlpE,MAAM,CAAA;AACZ,QAAIwsE,SAAS;AAERtrE,SAAA8nE,mBAAmB,SAAS7gE,IAChC;AAAA,UAAIjH,KAAKmjE,aAAal8D,EAAAA,KAAOjH,KAAK8mE,WAAW7/D,EAAAA,GAAI;AAChD;AAAA,MACD;AACM,YAAAuY,MAAMxf,KAAKwnE,YAAYvgE;AAC7B,UAAKjH,CAAAA,KAAK+H,UAAU,kBAAkB,CAACd,IAAIjH,KAAKuN,SAAStG,EAAAA,GAAKuY,OAAO;AACpE;AAAA,MACD;AACA1gB,UAAImI,EAAAA,IAAMuY;AACD8rD,eAAA;AACTtrE,WAAKmjE,aAAal8D,EAAE,KAAA,oBAASyR,QAAQjL,QAAQ;AAAA,IAAA,CAAA;AAG9C,WAAO69D,SAASxsE,MAAM;AAAA,EACvB;AAAA,EAEU,aAAaia,OACtB;AAAA,WAAO/Y,KAAKsgE,OAAOh9B,QAAQtjC,KAAKsgE,OAAOprD,UAAUC,UAAcnV,IAAAA,KAAKsgE,OAAOprD,UAAUC,WAAW4D,KAAS/Y,IAAAA,KAAKsgE,OAAOprD,UAAUG,YAAY0D,KAC5I;AAAA,EAAA;AAAA,EAEU,cAAcA,OAAcwyD;AACrCA,qBAAiBvsE,KAAK+Z,KAEf;AAAA,WAAAA,MAAMxP,IAAKK;AACd,UAAAq5B,OAAer5B,OAAM;AAChB,eAAA5J,KAAKwrE,aAAa5hE,IAAAA;AAAAA,MAAI,WACnBlO,MAAMoO,QAAQF,UAAU6hE,cAAsBF,kBAAkB3hE,IAAM,GAAA;AACzE,eAAA5J,KAAK0rE,cAAc9hE,MAAM2hE,gBAAAA;AAAAA,MAAgB,WACtC3hE,QAAeA,OAAAA,SAAS,aAAa6hE,cAAsBF,kBAAkB3hE,OAAO;AACvF,eAAA5J,KAAK2rE,eAAe/hE,MAAM2hE,gBAAgB;AAAA,MAAA,OAC3C;AACC,eAAA3hE;AAAAA,MACR;AAAA,IAEF,CAAA;AAAA,EAAA;AAAA,EAEU,eAAegiE,SAAcL,kBAAAA;AACtC,UAAMM,gBAAgB,CAAA;AACtBN,qBAAiBvsE,KAAK4sE,OAAAA;AAEtB,eAAWvyD,OAAOuyD,SAAS;AAC1B,UAAIvyD,IAAIgpB,OAAO,GAAG,CAAO,MAAA,KAAK;AAC7B;AAAA,MACD;AAEM,YAAAtpB,QAAQ6yD,QAAQvyD,GAAAA;AAClB,UAAA4pB,OAAelqB,QAAQ;AAC1B8yD,sBAAcxyD,GAAOrZ,IAAAA,KAAKwrE,aAAazyD,KAAAA;AAAAA,MAAK,WACnCA,UAAU,MAAM;AACzB8yD,sBAAcxyD,OAAO;AAAA,MAAA,WACX3d,MAAMoO,QAAQiP,KAAAA,KAAAA,CAAW0yD,cAAsBF,kBAAkBxyD,KAAAA,GAAO;AAClF8yD,sBAAcxyD,GAAAA,IAAOrZ,KAAK0rE,cAAc3yD,OAAOwyD,gBAAgB;AAAA,MAAA,WACrDxyD,SAAAA,OAAgBA,UAAU,YAAa0yD,CAAAA,cAAsBF,kBAAkBxyD,KAAQ,GAAA;AACjG8yD,sBAAcxyD,GAAOrZ,IAAAA,KAAK2rE,eAAe5yD,OAAOwyD,gBAAgB;AAAA,MAAA,OAC1D;AACNM,sBAAcxyD,GAAAA,IAAON;AAAAA,MACtB;AAAA,IACD;AACO,WAAA8yD;AAAAA,EACR;AAAA,EAEU,iBAAiBD,SAAAA;AAC1B,UAAMC,gBAAgB7rE,KAAK2rE,eAAeC,SAAS;AAErCC,kBAAA7rE,KAAKslE,gBAAgBtlE,KAAKsgE,OAAO4C,YAAY0I,QAAQ3kE,IAAIjH,KAAKslE,cAActlE,KAAK+hE,UAAAA;AACxF,WAAA8J;AAAAA,EACR;AAAA,EAEU,cAAc5kE,IAAAA;AAChB,WAAAjH,KAAK6kE,SAASC,cAAc79D;EACpC;AAAA,EAEU,YAAYA,IACjB;AAAA,QAAA6kE;AACJ,UAAM/oE,SAAQ/C,KAAKsgE;AACf,QAAAtgE,KAAKyoE,mBAAmB,QAAQ;AAChC,UAAA1lE,OAAM0d,aAAaxZ,EAAAA,GAAI;AACf6kE,mBAAA9rE,KAAKsgE,OAAOphD,QAAQjY,EAC/B;AAAA,MAAA;AAAA,IACU,WAAAjH,KAAKyoE,mBAAmB,cAAc;AAChD,UAAGzoE,KAAKsgE,OAAOxqC,MAAM6sC,iBAAiB5oC,OAAO9yB,EAAAA,GAAI;AAChD6kE,mBAAU9rE,KAAKsgE,OAAOxqC,MAAM6sC,iBAAiBhpC,QAAQ1yB,EACtD;AAAA,MAAA;AAAA,IACU,WAAAjH,KAAKyoE,aAAAA,MAAmB,YAAY;AAC9C,UAAGzoE,KAAKsgE,OAAOxqC,MAAMouC,cAAcnqC,OAAO9yB,EAAAA,GAAI;AAC7C6kE,mBAAU9rE,KAAKsgE,OAAOxqC,MAAMouC,cAAcvqC,QAAQ1yB,EACnD;AAAA,MAAA;AAAA,IAAA,OACM;AACH,UAAAlE,OAAMqoD,aAAankD,EAAI,GAAA;AACf6kE,mBAAA9rE,KAAKsgE,OAAOt2B,QAAQ/iC,EAAAA;AAAAA,MAC/B;AAAA,IACD;AAEA,QAAA,CAAK6kE,UAAU;AACHA,iBAAA9rE,KAAK8kE,cAAc79D,EAC/B;AAAA,IAAA;AAEA,SAAK6kE,UAAU;AACdA,iBAAW,EAAE7kE,GACd;AAAA,IAAA;AAEO,WAAAjH,KAAK+rE,iBAAiBD,QAC9B;AAAA,EAAA;AAAA;AC9tCD,MAAe5G,iBAAA,EACd8G,gBAAgB,SAASn1D;AACxB,SAAO,IAAKo1D,gBAA6Bp1D,MACzC;AAAA,GACDkuD,oBAAqBmH;ACHtB,SAASC,aAAappE;AACrB,MAAIsrC,UAAU,CAAA;AACd,MAAIvb,WAAW;AACf,WAASs5C,cAAcC,YAAYC,aAAAA;AAClCA,kBAAqBA,OAAAA,eAAe,aAAaA,cAAc,WAAA;AAAA,IAAU;AAEzE,QAAIj+B,CAAAA,QAAQg+B,aAAY;AACvBh+B,cAAQg+B,UAAcrsE,IAAAA,KAAKqsE,UAC3BrsE;AAAAA,WAAKqsE,cAAcC;AAAAA,IACnB;AAAA,EACD;AACD,WAASC,cAAcF;AACtB,QAAGh+B,QAAQg+B,UAAY,GAAA;AACtBrsE,WAAKqsE,UAAAA,IAAch+B,QAAQg+B,UAC3Bh+B;AAAAA,cAAQg+B,cAAc;AAAA,IACtB;AAAA,EACD;AACD,WAASG,eAAeC,aACvB;AAAA,aAAQ3wE,KAAK2wE,aAAY;AACxBL,oBAAcvwE,KAAKmE,MAAMlE,GAAG2wE,YAAY3wE;IACxC;AAAA,EACD;AACD,WAAS4wE,iBAAAA;AACR,aAAQ5wE,KAAKuyC,SAAQ;AACpBk+B,oBAAc1wE,KAAKmE,MAAMlE;IACzB;AAAA,EACD;AAED,WAAS6wE,mBAAmB7kE,UAC3B;AAAA,QAAA;AACCA;IACA,SAAM5I;AACNyD,YAAOhB,QAAQC,MAAM1C,CACrB;AAAA,IAAA;AAAA,EACD;AAED,MAAI0E,QAAQb,OAAMc,UAAUC,WAAW,OAAA;AACvCF,QAAMG,iBAAiB,eAAe;AACrC,WAAO,EACNywD,cAAc1hC,SAAAA;AAAAA,EAEf,GAAE,KAAA;AAEH,SAAO,SAAS0b,YAAY1mC,UAAU8kE,UAAAA;AACrC,QAAG95C,UAAS;AAEX65C,yBAAmB7kE,QAAAA;AACnB;AAAA,IACA;AAED,QAAI+kE,UAAW7sE,KAAK4hE,OAAO5hE,KAAK4hE,IAAIR,cAAc;AAClD,QAAI0L;AACJ,QAAID,SAAQ;AACXC,gBAAU9sE,KAAK4hE,IAAIR;AACnBphE,WAAK4hE,IAAIP,cAAc,KAAA;AAAA,IACvB;AAGD,QAAI0L,gBAAgB,CAAA;AACpB,QAAI1+B,WAAU,EACb3oC,QAAS,MACT6vD,aAAc,MACdt5B,aAAc,MACd25B,aAAc,MACd4H,mBAAoB,SAASrvD,MAC5B4+D;AAAAA,oBAAc5+D,KAAKlH,EAAMkH,IAAAA;AAAAA,IACzB,EAGFq+D;AAAAA,mBAAe3wE,KAAKmE,MAAMquC;AAE1Bvb,eAAW;AACX9yB,SAAK+H,UAAU,uBAAuB,CAAA,CAAA;AAEtC4kE,uBAAmB7kE,QAEnB9H;AAAAA,SAAK+H,UAAU,sBAAsB,CAAA,CAAA;AAErC2kE,mBAAe7wE,KAAKmE,IAAAA;AAGpB,aAAQlE,KAAKixE,eAAc;AAC1B/sE,WAAKw9D,kBAAkBuP,cAAcjxE,CAAAA,CAAAA;AAAAA,IACrC;AAEDg3B,eAAW;AAEX,QAAI85C,CAAAA,UAAS;AACZ5sE,WAAK0F,OACL;AAAA,IAAA;AAED,QAAImnE,SAAS;AACZ7sE,WAAK4hE,IAAIP,cAAcyL;AACvB9sE,WAAK4hE,IAAIf,aAAa,MAAA;AACtB7gE,WAAK4hE,IAAIoF;AACThnE,WAAK4hE,IAAIf,aAAa,MAAA;AACtB7gE,WAAK4hE,IAAIoF;IACT;AAAA,EACH;AAIA;AAEe,SAAQxS,aAACzxD,QAAAA;AACvBA,EAAAA,OAAMyrC,cAAc29B,aAAappE;AAClC;AC5GA,MAAMiqE,YAAS,SAAajqE,QAAAA;AAC3B,SAAO,EACPkqE,aAAa,MACb7xC,OAAO,WACNp7B;AAAAA,SAAKitE,cAAc;AAAA,EACnB,GACDC,iBAAiB,WAChB;AAAA,WAAA,CAASltE,KAAKmtE,aAAAA,KAAkBntE,KAAKitE;AAAAA,EACrC,GACDE,cAAc,WAAA;AACb,aAAUpqE,OAAMwK,SAAAA,EAAqB;AAAA,EACrC,GACD6/D,aAAa,SAASj/D,MAAAA;AACrB,QAAIA,CAAAA,KAAM,QAAO;AAEjB,QAAGnO,KAAKktE,gBAAAA,GAAkB;AACzBltE,WAAKqtE;IACL;AAED,QAAGl/D,KAAKm/D,SAAU,QAAO;AACzB,QAAGttE,KAAKmtE,aAAAA,EAAgB,QAAOh/D,KAAKo/D,QAAQ;AAE5C,QAAIp/D,CAAAA,KAAKo/D,MAAM;AACdvtE,WAAKo7B,MAAAA;AACLp7B,WAAKqtE,SACL;AAAA,IAAA;AACD,WAAOl/D,KAAKo/D;AAAAA,EACZ,GACDC,aAAa,SAASr/D,MAAM4K,OAC3B5K;AAAAA,SAAKo/D,OAAOx0D;AAAAA,EACZ,GACD00D,YAAY,SAASt/D;AACpB,WAAOnO,KAAKotE,YAAYj/D,IACxB;AAAA,EAAA,GACDu/D,cAAc,SAAS/yD,MACtB;AAAA,QAAI4N,QAAQ5N,KAAKrd,MAAM,GACvB;AAAA,QAAI04B,cAAcjzB,OAAMuC,OAAOuV;AAC/B,aAAQ/e,IAAI,GAAGA,IAAIysB,MAAMxsB,QAAQD,KAAI;AACpC,YAAMstC,WAAWrmC,OAAMgY,YAAYib,WAAAA;AACnC,UAAIxvB,QAAQ+hB,MAAMzsB,CAAAA,IAAG,IAAI;AACzB,UAAGiH,OAAM0d,aAAa2oB,SAAS5iC,SAAQ;AACtCwvB,sBAAcoT,SAAS5iC,KAAAA;AAAAA,MAC3B,OAAQ;AACJ,eAAO;AAAA,MACP;AAAA,IACD;AACD,QAAGzD,OAAM0d,aAAauV,WAAa,GAAA;AAClC,aAAOjzB,OAAMmc,QAAQ8W,WAAAA;AAAAA,IACxB,OAAO;AACJ,aAAO;AAAA,IACP;AAAA,EACD,GACDq3C,UAAU;AACT,QAAIrtE,CAAAA,KAAKktE,gBAAmB,EAAA;AAE5B,QAAIS,WAAW;AACf5qE,IAAAA,OAAM6Q,SAAS,SAASjV,IACvB;AAAA,UAAGA,GAAGsT,QAAQlP,OAAMuC,OAAOqxB,MAAMC,YAAa;AAC9C,UAAG+2C,UAAU;AACZA,mBAAW;AACX3tE,aAAKwtE,YAAY7uE,IAAI,GACrB;AAAA;AAAA,MACA;AACD,YAAMivE,eAAe5tE,KAAK6tE,8BAA8BlvE,GAAGsI,EAAAA;AAC3D,UAAI2mE,iBAAiB,MAAM;AAC1B5tE,aAAK8tE,aAAanvE,IAAIivE,YAAAA;AAAAA,MAC1B,OAAU;AACN,YAAIG,UAAUhrE,OAAM+rB,UAAUnwB,GAAGsI,EACjCjH;AAAAA,aAAKwtE,YAAY7uE,IAAIoE,OAAMmc,QAAQ6uD,OAAAA,EAASR,OAAO,IAAA;AAAA,MACnD;AAAA,IACD,GAAExqE,OAAMuC,OAAOuV,SAAS7a,IAAAA;AAEzBA,SAAKitE,cAAc;AAAA,EACnB,GACDa,cAAc,SAAS3/D,MAAM6/D;AAC5B,QAAIC,OAAOlrE,OAAMmc,QAAQ8uD,UAAAA,EAAYT;AACrC,QAAGU,MAAM;AACRA,aAAOA,KAAK3wE,MAAM;AAClB2wE,WAAKA,KAAKlyE,SAAO,CACjBiE;AAAAA,WAAKwtE,YAAYr/D,MAAM8/D,KAAKzyE,KAAK,GAAA,CAAA;AAAA,IACjC;AAAA,EACD,GACDqyE,+BAA+B,SAAS1c,SAAAA;AACvC,QAAI+c;AACJ,QAAIC,YAAYhd;AAChB,OAAG;AACF+c,oBAAcnrE,OAAMkuB,eAAek9C,SAAAA;AACnCA,kBAAYD;AAAAA,IACZ,SAAQA,gBAAgB,QAAQnrE,OAAMmc,QAAQgvD,WAAaj8D,EAAAA,QAAQlP,OAAMuC,OAAOqxB,MAAMC;AACvF,WAAOs3C;AAAAA,EACL,EAAA;AAEH;AAEc,SAAQE,IAACrrE;AACvB,QAAMqrE,OAAMpB,UAAUjqE,MAAAA;AACtBA,EAAAA,OAAM0qE,aAAa,SAASA,WAAWt/D,MAAAA;AACtC,WAAOigE,KAAIX,WAAWt/D;EACxB;AAECpL,EAAAA,OAAMsrE,mBAAmB,SAAS1zD,MACjC;AAAA,WAAOyzD,KAAIV,aAAa/yD,IAAAA;AAAAA,EAC1B;AAEC,WAAS2zD,aACRF;AAAAA,IAAAA,KAAIhzC;AACJ,WAAO;AAAA,EACP;AAEDr4B,EAAAA,OAAMyE,YAAY,mBAAmB8mE;AACrCvrE,EAAAA,OAAMyE,YAAY,iBAAiB8mE,UACnCvrE;AAAAA,EAAAA,OAAMyE,YAAY,qBAAqB8mE,UAAAA;AACvCvrE,EAAAA,OAAMyE,YAAY,kBAAkB8mE,UAAAA;AACpCvrE,EAAAA,OAAMyE,YAAY,eAAe8mE;AAElC;ACjHA,SAASC,sBAAsBxrE,QAE9B;AAAA,MAAIyrE,oBAAoB,CAAA;AACxB,MAAIC,2BAA2B;AAE/B1rE,EAAAA,OAAM+yB,MAAMC,WAAWvuB,YAAY,kBAAkB,WACpDgnE;AAAAA,wBAAoB,CAAA;AACpBC,+BAA2B;AAAA,EAC7B;AACC1rE,EAAAA,OAAMyE,YAAY,uBAAuB,WAAA;AACxCgnE,wBAAoB,CAAA;AAAA,EACtB,CAEC;AAAA,WAASE,UAAUC,cAAcC,eAAeC,YAAAA;AAC/C,eAAWF,gBAAgB,YAAY;AACtC,aAAOG,oBAAoBH;IAC9B,OAAS;AACN,UAAIzrC,QAAgB0rC,aAAgB,GAAA;AACnC,eAAOG,iBAAiBJ,cAAcC,eAAeC,UAAAA;AAAAA,MACzD,OAAU;AACN,eAAOE,iBAAiBJ,cAAc,CAACC,aAAAA,GAAgBC,UACvD;AAAA,MAAA;AAAA,IACD;AAAA,EACD;AAED,WAASC,oBAAoB7sB,QAC5B;AAAA,QAAI1/B,MAAM,CACVxf;AAAAA,IAAAA,OAAM6Q,SAAS,SAAUzF,MACxB;AAAA,UAAI8zC,OAAO9zC,IAAO,GAAA;AACjBoU,YAAIvjB,KAAKmP,IACT;AAAA,MAAA;AAAA,IACJ;AACE,WAAOoU;AAAAA,EACP;AAED,MAAIysD,mBAAmBlvE,OAAOxG,KAAK21E,OACnC,CAAA;AAAA,WAASC,qBAAqBn2D,OAC7B;AAAA,QAAIA,UAAU,MAAK;AAClB,aAAOi2D,mBAAmBlvE,OAAOiZ,KAAAA;AAAAA,IACjC;AACD,WAAOjZ,OAAOiZ;EACd;AAED,WAASo2D,YAAYC,aAAa3M,UAAUoM,YAC3C;AAAA,QAAInzE,MAAMoO,QAAQslE,cAAc;AAC/B,aAAOA,YAAY7lE,IAAI,SAAUwP;AAChC,eAAOm2D,qBAAqBn2D,KAChC;AAAA,MAAA,CAAA,EAAMvd,KAAK,GAAA,IAAO,IAAIinE,QAAYoM,IAAAA,UAAAA;AAAAA,IAClC,OAAS;AACN,aAAOK,qBAAqBE,eAAe,IAAI3M,QAAAA,IAAYoM,UAC3D;AAAA,IAAA;AAAA,EACD;AAED,WAASE,iBAAiBtM,UAAU2M,aAAaP;AAChD,QAAItsD;AACJ,QAAIssC,WAAWsgB,YAAYC,aAAa3M,UAAU1rD,KAAKC,UAAU63D;AACjE,QAAIQ,oBAAoB,CAAA;AACxBlL,YAAgBiL,aAAa,SAASE,YACrCD;AAAAA,wBAAkBH,qBAAqBI,UAAAA,CAAAA,IAAe;AAAA,IACzD,CAAA;AAEE,SAAKd,kBAAkB3f,QAAAA,GAAW;AACjCtsC,YAAMisD,kBAAkB3f,YAAY,CACpC9rD;AAAAA,MAAAA,OAAM6Q,SAAS,SAAUzF,MACxB;AAAA,YAAI0gE,YAAY;AACf,cAAA,CAAKA,WAAW9rE,OAAMo+B,YAAYhzB,IAAAA,CAAAA,GAAQ;AACzC;AAAA,UACA;AAAA,QACN,WAAeA,KAAK8D,QAAQlP,OAAMuC,OAAOqxB,MAAM3U,SAAS;AACnD;AAAA,QACA;AACD,YAAIygD,YAAYt0D,MAAM;AACrB,cAAIohE;AACJ,eAAKrsC,QAAgB/0B,KAAKs0D,YAAY;AACrC8M,4BAAgB,CAACphE,KAAKs0D,QAAAA,CAAAA;AAAAA,UAC5B,OAAY;AACN8M,4BAAgBphE,KAAKs0D;UACrB;AAED0B,kBAAgBoL,eAAe,SAASx2D,OAAAA;AACvC,gBAAIw2D,iBAAiBx2D,SAASA,MAAMy2D,cAAez2D,MAAMy2D,cAAcz2D;AAEvE,gBAAIs2D,kBAAkBH,qBAAqBK,cAAAA,CAAAA,GAAiB;AAC3DhtD,kBAAIvjB,KAAKmP,IAChB;AAAA,YAAA,WAAgBsgE,CAAAA,0BAAyB;AAElC,kBAAIp1D,MAAM81D,YAAYp2D,OAAO0pD;AAC7B,kBAAI+L,CAAAA,kBAAkBn1D,MAAK;AAC1Bm1D,kCAAkBn1D,GAAO,IAAA,CAAA;AAAA,cACzB;AACDm1D,gCAAkBn1D,KAAKra,KAAKmP,IAAAA;AAAAA,YAC5B;AAAA,UACP,CAAA;AAAA,QAEK;AAAA,MACL,CAAA;AAEGsgE,iCAA2B;AAAA,IAC9B,OAAS;AACNlsD,YAAMisD,kBAAkB3f,QAAAA;AAAAA,IACxB;AAED,WAAOtsC;AAAAA,EACP;AAED,WAASktD,kBAAkBH,YAAYhhD,QAAQtqB,QAAAA;AAC9C,QAAIy+D,WAAW1/D,OAAMuC,OAAOoqE;AAC5B,QAAIC,SAAS,CACb;AAAA,QAAI5sE,OAAMsoC,aAAa,QAAQtR,OAAOzL,MAAAA,GAAS;AAC9C,UAAIngB,OAAOpL,OAAMmc,QAAQoP,MACzBqhD;AAAAA,eAASxhE,KAAKs0D,QAAa,KAAA,CAAA;AAAA,IAC3B;AAED,QAAK/mE,CAAAA,MAAMoO,QAAQ6lE,MAAAA,GAAS;AAC3BA,eAAS,CAACA,MACV;AAAA,IAAA;AACD,aAAS7zE,IAAI,GAAGA,IAAI6zE,OAAO5zE,QAAQD,KAAK;AACvC,UAAI6zE,OAAO7zE,CAAG0zE,EAAAA,eAAeF,YAAY;AACxCtrE,eAAOhF,KAAK,EAAC6+B,SAAS1vB,KAAKlH,IAAIuoE,aAAYG,OAAO7zE,GAAG0zE,aAAaz2D,OAAM42D,OAAO7zE,CAAAA,EAAGid,MAClF,CAAA;AAAA,MAAA;AAAA,IACD;AAAA,EACD;AAED,WAAS62D,uBAAuBN,YAAYhhD,QAI3C;AAAA,QAAIuhD,cAAc,CAClB;AAAA,QAAIpN,WAAW1/D,OAAMuC,OAAOoqE;AAC5B,QAAGphD,WAAWjuB,QAAU;AACvBovE,wBAAkBH,YAAYhhD,QAAQuhD,WACzC;AAAA,IAAA,OAAO;AACJ,UAAIx8D,SAAQtQ,OAAM2rE,UAAUjM,UAAU6M,UACtCj8D;AAAAA,MAAAA,OAAMlK,QAAQ,SAASgF;AACtBshE,0BAAkBH,YAAYnhE,KAAKlH,IAAI4oE,WAAAA;AAAAA,MAC3C;IACG;AACD,WAAOA;AAAAA,EACP;AAED,SAAO,EACNnB,WACAkB,uBAEF;AAAA;AAEA,SAASE,eAAa/sE;AACrB,QAAMgtE,iBAAiB,EACtBC,qBAAqB,SAAS79D,YAAYC,UAAU4xD,UAAU3wD,QAAOw8D;AACpE,UAAMI,WAAWltE,OAAMuC,OAAOiM,WAAW,KAAK;AAC9C,QAAGY,aAAa6xD,SAAS5xD,YAAYA,WAAW4xD,SAAS7xD,YAAW;AACnE,eAAQrW,IAAI,GAAGA,IAAI+zE,YAAY9zE,QAAQD,KAAI;AAC1C,cAAMvB,IAAIs1E,YAAY/zE,CAAAA;AACrB,eAAO,UAAQm0E,WAAS,+CAA6C11E,EAAE0M,KAAG,oBACzD+8D,SAAS/8D,KAAG,kBACd+8D,SAASkM,WAAS,wBACZntE,OAAMmS,UAAUG,YAAYlD,UAAY,IAAA,sBAC1CpP,OAAMmS,UAAUG,YAAYjD,QAAU,IAAA,OAAO7X,EAAEwe,QAAQ;AAAA,MAC3E;AACD,aAAO,UAAQk3D,WAAS,oDACLjM,SAAS/8D,KAAG,yBACP+8D,SAASmM,eAAa,kBAC7BnM,SAASkM,WAAS,wBACZntE,OAAMmS,UAAUG,YAAYlD,cAAY,wBACxCpP,OAAMmS,UAAUG,YAAYjD,QAAU,IAAA;AAAA,IAC7D;AACD,WAAO;AAAA,EACP,GACDg+D,oBAAoB,SAASj+D,YAAYC,UAAU4xD,UAAU3wD,QAAOw8D,aACnE;AAAA,QAAIQ,MAAMR,YAAYS,OAAO,SAASnK,OAAOxC,YAC5C;AAAA,aAAOwC,QAAQpG,OAAO4D,WAAW5qD;IACjC,GAAE,CAAA;AAEH,QAAGs3D,MAAM,GAAE;AACVA,YAAM/2E,KAAKC,MAAM82E,MAAM,EAAI,IAAA;AAAA,IAC3B;AAED,QAAGA,KAAI;AACN,aAAO,UAAUA,MAAM;AAAA,IACvB;AACD,WAAO;AAAA,EACP,GACDE,8BAA8B,SAASp+D,YAAYC,UAAU4xD,UAAU3wD,QAAOw8D,aAC7E;AAAA,QAAG7L,SAASwM,UAAU,QAAO;AAC5B,aAAOT,eAAeC,oBAAoB79D,YAAYC,UAAU4xD,UAAU3wD,QAAOw8D,WAAAA;AAAAA,IACrF,OAAQ;AACJ,aAAOE,eAAeK,mBAAmBj+D,YAAYC,UAAU4xD,UAAU3wD,QAAOw8D,WAChF;AAAA,IAAA;AAAA,EAED,GAEDY,2BAA2B,SAASt+D,YAAYC,UAAU4xD,UAAU3wD,QAAOw8D,aAC1E;AAAA,UAAMnxE,MAAM,CAAA;AACZA,QAAIM,KAAK,iBAAA;AAET,QAAGglE,SAASwM,UAAU,QAAO;AAC5B9xE,UAAIM,KAAK;IACb,OAAQ;AACJN,UAAIM,KAAK,eAAA;AAAA,IACT;AAED,UAAMqxE,MAAMR,YAAYS,OAAO,SAASnK,OAAOxC,YAC9C;AAAA,aAAOwC,QAAQpG,OAAO4D,WAAW5qD,KACjC;AAAA,IAAA,GAAE,CAEH;AAAA,QAAI23D,WAAW3Q,OAAOiE,SAAS0M,QAC/B;AAAA,QAAGv2E,MAAMu2E,QAAU,GAAA;AAClBA,iBAAW;AAAA,IACX;AACD,QAAIL,OAAOK,UAAU;AACpBhyE,UAAIM,KAAK,YAAA;AAAA,IACb,OAAU;AACNN,UAAIM,KAAK,cACT;AAAA,IAAA;AACD,WAAON,IAAIlD,KAAK,GAAA;AAAA,EAChB,GACDm1E,+BAA+B,SAASf,uBAAuBN,YAC9D;AAAA,QAAIO;AACJ,UAAM/4D,QAAQ/T,OAAMsoC,aAAatoC,OAAMuC,OAAOw+D;AAC9C,UAAME,WAAWltD,MAAM6iB,QAAQ21C,UAE/B;AAAA,QAAGtL,SAASwM,UAAU,QAAO;AAC5BX,oBAAc9sE,OAAM6sE,uBAAuB5L,SAASmM,cAAcnM,SAASkM;IAC/E,OAAQ;AACJL,oBAAc9sE,OAAM6sE,uBAAuBN,UAC3C;AAAA,UAAGx4D,MAAMozC,UAAS;AACjBpzC,cAAMozC,SAAS,SAAS0mB,eAAAA;AACvB,cAAGA,cAAcJ,UAAU,QAAO;AACjCX,0BAAcA,YAAY3nE,OAAOnF,OAAM6sE,uBAAuBgB,cAAc3pE,EAAAA,CAAAA;AAAAA,UAC5E;AAAA,QACD,GAAEqoE,UAAAA;AAAAA,MACH;AAAA,IACD;AACD,WAAOO;AAAAA,EACP,GAEDgB,qBAAqB,WAAA;AACpB9tE,IAAAA,OAAMuC,OAAOwrE,8BAA8B;AAG3C,KAAA,WAAA;AAIC,UAAIC,YAAY;AAChB,eAASC,eAAAA;AACR,YAAID,WAAW;AACdE,+BAAqBF;QACrB;AACDA,oBAAYjkE,sBAAsB,WACjC;AAAA,cAAI/J,OAAMsM,YAAW;AACpB,gBAAIye,QAAQpyB,MAAMC,UAAUC,MAAMC,KAAKkH,OAAMsM,WAAW9T,iBAAiB,+CAAA,CAAA;AACzEuyB,kBAAM3kB,QAAQ,SAAUwzB,MACvBA;AAAAA,mBAAKu0C,kBAAkB;AAAA,YAC/B;UACO;AAAA,QACP,CAAA;AACK,eAAO;AAAA,MACP;AAEDnuE,MAAAA,OAAMyE,YAAY,gBAAgB,WACjCzE;AAAAA,QAAAA,OAAMsoC,aAAatoC,OAAMuC,OAAOg+D,yBAA2B97D,EAAAA,YAAY,kBAAkBwpE,YAAAA;AACzFjuE,QAAAA,OAAMsoC,aAAatoC,OAAMuC,OAAOw+D,cAAAA,EAAgBt8D,YAAY,kBAAkBwpE,YACnF;AAAA,MAAA,GAAO,EAAC9pE,MAAM,KAAA,CAAA;AACVnE,MAAAA,OAAMyE,YAAY,sBAAsB;AACvC,cAAM2pE,aAAapuE,OAAMm/B,QAAQkvC,eAAe,UAAA;AAChDD,mBAAWhoE,QAAQ,SAASuC;AAC3B,cAAGA,KAAK+E,WAAW/E,KAAK+E,QAAQ/E,SAAS,sBAAsBA,KAAK2lE,UAAS;AAC5E3lE,iBAAK2lE,SAAS7pE,YAAY,YAAYwpE,YAAAA;AAAAA,UACtC;AAAA,QACP,CACA;AAAA,MAAA,CAAA;AAAA,IACI,GAhCD;AAkCA,QAAIM,oBAAoB;AACxB,aAASC,eAAAA;AACR3mE,iBAAW,WAAA;AACV,cAAM4mE,+BAA+BC,kBAA8B1uE,OAAMsM,UAAAA;AACzE,YAAGiiE,oBAAAA,IAAuB;AACzBE,uCAA6BF,oBAAmB,CAAA,EAAG7lD;QACnD;AAAA,MACD,GAAE;IAEP;AACG1oB,IAAAA,OAAMyE,YAAY,gBAAgB,WACjC;AAAA,UAAIkqE,0BAA0B;AAC9B3uE,MAAAA,OAAM1D,MAAM0D,OAAMsM,YAAY,YAAY,SAASnQ,GAAAA;AAClD,YAAII,SAASJ,EAAEI,OAAO4B,QAAQ,+CAC9B;AAAA,YAAG5B,QAAO;AACT,cAAIJ,EAAE+nB,YAAY,MAAM/nB,EAAE+nB,YAAY,IAAI;AACzC3nB,mBAAOwsB,KACP;AAAA,UAAA;AAAA,QACD;AAAA,MACN,CAAA;AAEI/oB,MAAAA,OAAM1D,MAAM0D,OAAMsM,YAAY,WAAW,SAAShQ,QAAAA;AACjD,YAAIA,OAAMga,QAAQ,OAAO;AACxB,gBAAMs4D,oBAAoBF,kBAA8B1uE,OAAMsM,UAC9DiiE;AAAAA,8BAAoBK,kBAAkB10E,QAAQ7E,SAAS+J,aAAAA;AAAAA,QACvD;AAAA,MACN,CAEIY;AAAAA,MAAAA,OAAM1D,MAAM0D,OAAMsM,YAAY,YAAY,SAASnQ,GAClD;AAAA,YAAIwyE,yBAAwB;AAC3B;AAAA,QACA;AACDA,kCAA0B;AAC1B9mE,mBAAW;AACV8mE,oCAA0B;AAAA,QAC1B,GAAE,GACH;AAAA,YAAIpyE,SAASJ,EAAEI,OAAO4B,QAAQ;AAC9B,YAAG5B,QAAO;AACT,cAAIsyE,YAAYtyE,OAAOuyE,aAAa,IAAI9xE,KAAAA;AACxC,cAAG6xE,YAAY,KAAI;AAClBA,uBAAW;AAAA,UACX;AACD,cAAI74D,QAAQgnD,OAAO6R;AACnB,cAAIpN,QAAQllE,OAAOlF,aAAa,aAChC;AAAA,cAAI03E,eAAexyE,OAAOlF,aAAa;AACvC,cAAIk0B,SAAShvB,OAAOlF,aAAa,WAAA;AACjC,cAAIk1E,aAAahwE,OAAOlF,aAAa;AACrC,cAAI23E,YAAYhvE,OAAMmS,UAAUgrC,WAAW5gD,OAAOlF,aAAa,iBAAA,CAAA;AAC/D,cAAI43E,UAAUjvE,OAAMmS,UAAUgrC,WAAW5gD,OAAOlF,aAAa,eAE7D,CAAA;AAAA,cAAI63E,kBAAkBlvE,OAAMsoC,aAAatoC,OAAMuC,OAAOg+D,yBACtD;AAAA,cAAGnpE,MAAM4e,KAAAA,GAAO;AACfhW,YAAAA,OAAMsoC,aAAatoC,OAAMuC,OAAOw+D,cAAAA,EAAgB5pC,QAAQsqC,KAC/D;AAAA,UAAA,OAAW;AACJ,gBAAIr2D,OAAOpL,OAAMmc,QAAQoP,MAEzB;AAAA,gBAAIvrB,OAAM8oC,QAAUzf,EAAAA,MAAK;AACxBrpB,cAAAA,OAAMoC,IAAIinB,KAAKijB,UAAU/gB,QAAQ,MAAA;AAAA,YACjC;AACD,gBAAGwjD,cAAa;AAEf,kBAAInO,aAAasO,gBAAgBt4C,QAAQm4C,YAAAA;AACzC,kBAAG/4D,UAAU4qD,WAAW5qD,OAAM;AAC7B;AAAA,cACA;AACD,kBAAG4qD,WAAWxxD,WAAW1E,QAAAA,MAAcskE,UAAUtkE,QAAak2D,KAAAA,WAAWvxD,SAAS3E,QAAAA,MAAcukE,QAAQvkE,QAAAA,GAAU;AACjHk2D,2BAAW5qD,QAAQA;AACnB,oBAAIA,CAAAA,OAAM;AACTk5D,kCAAgBj4C,WAAW2pC,WAAW18D,EAAAA;AAAAA,gBAChD,OAAc;AACJgrE,kCAAgBzoB,WAAWma,WAAW18D;gBACtC;AAAA,cACV,OAAe;AACN,oBAAG08D,WAAWvxD,SAAS3E,QAAAA,IAAYukE,QAAQvkE,QAAAA,GAAU;AACpD,sBAAIykE,YAAYnvE,OAAMsB,KAAKs/D,UAAAA;AAC3BuO,4BAAUjrE,KAAKlE,OAAM01B,IACrBy5C;AAAAA,4BAAU//D,aAAa6/D;AACvBE,4BAAU/V,WAAWp5D,OAAMovE,kBAAkB,EAC5ChgE,YAAY+/D,UAAU//D,YACtBC,UAAU8/D,UAAU9/D,UACpBjE,KAED+jE,CAAAA;AAAAA,4BAAU5nE,QAAQvH,OAAMovE,kBAAkB,EACzChgE,YAAYhE,KAAKgE,YACjBC,UAAU8/D,UAAU//D,YACpBhE,KAED+jE,CAAAA;AAAAA,4BAAU36C,OAAOosC,WAAWpsC,QAAQ;AACpC,sBAAG26C,UAAU/V,aAAa,GAAE;AAC3B8V,oCAAgBp4C,QAAQq4C,SAAAA;AAAAA,kBACxB;AAAA,gBACD;AAED,oBAAGvO,WAAWxxD,WAAW1E,YAAYskE,UAAUtkE,QAAAA,GAAU;AACxDk2D,6BAAWvxD,WAAW2/D;AACtBpO,6BAAWxH,WAAWp5D,OAAMovE,kBAAkB,EAC7ChgE,YAAYwxD,WAAWxxD,YACvBC,UAAUuxD,WAAWvxD,UACrBjE,KAAMA,CAAAA;AAEPw1D,6BAAWpsC,OAAO;AAElB,sBAAGosC,WAAWxH,aAAa,GAAE;AAC5B8V,oCAAgBj4C,WAAW2pC,WAAW18D,EACjD;AAAA,kBAAA,OAAe;AACJgrE,oCAAgBzoB,WAAWma,WAAW18D;kBACtC;AAAA,gBACX,OAAc;AACJgrE,kCAAgBj4C,WAAW2pC,WAAW18D,EACtC;AAAA,gBAAA;AAED,oBAAG8R,OAAM;AACRk5D,kCAAgBp4C,QAAQ,EACvBgE,SAAS8lC,WAAW9lC,SACpB2xC,aAAa7L,WAAW6L,aACxBz2D,OACA5G,YAAY4/D,WACZ3/D,UAAU4/D,SACV7V,UAAUp5D,OAAMovE,kBAAkB,EACjChgE,YAAY4/D,WACZ3/D,UAAU4/D,SACV7jE,KAED7D,CAAAA,GAAAA,OAAOvH,OAAMovE,kBAAkB,EAC9BhgE,YAAYhE,KAAKgE,YACjBC,UAAU2/D,WACV5jE,KAEDopB,CAAAA,GAAAA,MAAM,gBAEP,CAAA;AAAA,gBAAA;AAAA,cACD;AAEDx0B,cAAAA,OAAMqvE,sBAAsBjkE,KAAKlH,EAAAA;AACjClE,cAAAA,OAAMouB,WAAWhjB,KAAKlH;AACtBsqE,2BAEA;AAAA,YAAA,WAAQx4D,OAAM;AACd,kBAAI4qD,aAAa,EAChB9lC,SAASvP,QACTkhD,aAAaF,YACbv2D,OACA5G,YAAY4/D,WACZ3/D,UAAU4/D,SACV7V,UAAUp5D,OAAMovE,kBAAkB,EACjChgE,YAAY4/D,WACZ3/D,UAAU4/D,SACV7jE,KAED7D,CAAAA,GAAAA,OAAOvH,OAAMovE,kBAAkB,EAC9BhgE,YAAYhE,KAAKgE,YACjBC,UAAU2/D,WACV5jE,KAAMA,CAAAA,GAEPopB,MAAM,gBAGP06C;AAAAA,8BAAgBp4C,QAAQ8pC,UAAAA;AACxB5gE,cAAAA,OAAMqvE,sBAAsBjkE,KAAKlH,EACjClE;AAAAA,cAAAA,OAAMouB,WAAWhjB,KAAKlH,EAAAA;AACtBsqE;YAEA;AAAA,UACD;AAAA,QACD;AAAA,MACN,CAAA;AAAA,IACA,GAAM,EAACrqE,MAAM,KACV,CAAA;AAAA,EAAA,EAAA;AAEF,SAAO6oE;AACR;AAEe,SAAQ3M,UAACrgE,QAAAA;AACvB,MAAIsrC,UAAUkgC,sBAAsBxrE,MAAAA;AAEpCA,EAAAA,OAAMoC,IAAIi+D,YAAY0M,eAAa/sE,MAAAA;AAEnCA,EAAAA,OAAMuC,OAAO89D,YAAY,EACxBC,2BAA2B,OAC3BO,yBAAyB,OACzByO,2BAA2B,OAC3BvO,gBAAgB,EACf7xD,MAAM,iBACNqgE,YAAY,OACZ95C,UAAU,SAAS5uB,MAClBA;AAAAA,SAAK9I,SAAS8I,KAAK9I,UAAUiC,OAAMuC,OAAOuV;AAC1CjR,SAAK7G,OAAMuC,OAAOoqE,qBAAqB9lE,KAAK9I;AAC5C8I,SAAKgO,OAAO;AACZ,WAAOhO;AAAAA,EACP,EAEF2oE,GAAAA,oBAAoB,SAASC,6BAA6BpP,YAAAA;AACzD,UAAMqP,kBAAkB,CAAA;AACxB,UAAM37D,QAAQ/T,OAAMsoC,aAAatoC,OAAMuC,OAAOw+D,cAAAA;AAC9CV,IAAAA,WAAUj6D,QAAQ,SAASoZ,KAAAA;AAC1B,WAAKzL,MAAMmE,SAASsH,IAAItb,EAAAA,GAAK;AAC5B,cAAM5C,QAAOtB,OAAMsB,KAAKke;AACxBle,QAAAA,MAAKgV,MAAMkJ,IAAItb;AACf5C,QAAAA,MAAK6R,QAAQqM,IAAIlH;AACjBo3D,wBAAgBzzE,KAAKqF,KACrB;AAAA,MAAA;AAAA,IACL;AACG,WAAOouE;AAAAA,EACP;AAGF1vE,EAAAA,OAAMyE,YAAY,sBAAsB,WAAA;AACvC,QAAGzE,OAAMsoC,aAAatoC,OAAMuC,OAAOw+D,iBAAgB;AAClD;AAAA,IACA;AAED,UAAM4O,sBAAsB3vE,OAAMuC,OAAO89D,YAAYrgE,OAAMuC,OAAO89D,UAAUU,iBAAiBzjE;AAC7F,QAAIiyE,aAAaI,sBAAsBA,oBAAoBJ,aAAajyE;AACxE,QAAG0C,OAAMuC,OAAO89D,aAAargE,OAAMuC,OAAO89D,UAAUiP,2BAA0B;AAC7EC,mBAAa;AAAA,IACb;AAED,QAAIK,YAAY,SAAS/oE,MACxBA;AAAAA,WAAK9I,SAAS8I,KAAK9I,UAAUiC,OAAMuC,OAAOuV;AAC1CjR,WAAK7G,OAAMuC,OAAOoqE,iBAAAA,IAAqB9lE,KAAK9I;AAC5C8I,WAAKgO,OAAO;AACZ,aAAOhO;AAAAA,IACV;AAEE,QAAG8oE,uBAAuBA,oBAAoBl6C,UAAS;AACtDm6C,kBAAYD,oBAAoBl6C;AAAAA,IAChC;AAED,UAAMo6C,YAAYF,uBAAuBA,oBAAoBzgE,OAAOygE,oBAAoBzgE,OAAO;AAE/FlP,IAAAA,OAAM8vE,kBAAkB9vE,OAAMw1B,gBAAgB,EAC7Cl7B,MAAM0F,OAAMuC,OAAOw+D,gBACnB7xD,MAAM2gE,WACNN,YAAYA,eAAejyE,SAAYiyE,aAAa,OACpD95C,UAAUm6C,UAGX5vE,CAAAA;AAAAA,IAAAA,OAAM+yB,MAAM+tC,iBAAiB9gE,OAAM8vE;AAEnC9vE,IAAAA,OAAM8vE,gBAAgBrrE,YAAY,WAAW,WAAA;AAC5C,eAASgrE,6BAA6BpP,YACrC;AAAA,cAAMqP,kBAAkB,CACxBrP;AAAAA,QAAAA,WAAUj6D,QAAQ,SAASoZ,KAAAA;AAC1B,gBAAMle,QAAOtB,OAAMsB,KAAKke,GAAAA;AACxBle,UAAAA,MAAKgV,MAAMkJ,IAAItb;AACf5C,UAAAA,MAAK6R,QAAQqM,IAAIlH;AACjBo3D,0BAAgBzzE,KAAKqF,KAC1B;AAAA,QAAA,CAAA;AACI,eAAOouE;AAAAA,MACP;AAED,UAAIK,qBAAqBN;AACzB,UAAIO;AACJ,UAAGhwE,OAAMuC,OAAO89D,aAAargE,OAAMuC,OAAO89D,UAAUmP,oBAAmB;AACtEO,6BAAqB/vE,OAAMuC,OAAO89D,UAAUmP;AAAAA,MAC5C;AACD,UAAGxvE,OAAMuC,OAAO89D,aAAargE,OAAMuC,OAAO89D,UAAUiP,2BAA0B;AAG7E,cAAMjP,aAAYrgE,OAAM8vE,gBAAgBz4C,SAAAA;AACxC,cAAM44C,oBAAoB5P,WAAUnhB,OAAO+hB,cAAAA;AAC1C,cAAI6L,cAAc9sE,OAAM6sE,uBAAuB5L,SAAS/8D,EACxD;AAAA,cAAA,CAAIlE,OAAM8vE,gBAAgB53D,SAAS+oD,SAAS/8D,EAAAA,KAAQ4oE,eAAeA,YAAY9zE,QAAQ;AACtF,gBAAGioE,SAASmM,gBAAgBnM,SAASkM,UAAS;AAC7C,qBAAO;AAAA,YACP;AACD,mBAAO;AAAA,UACP;AAAA,QAEF6C,CAAAA;AAAAA,kBAAUD,mBAAmBE,iBACjC;AAAA,MAAA,OAAU;AACND,kBAAUD,mBAAmB/vE,OAAM8vE,gBAAgBz4C,SAAAA,CAAAA;AAAAA,MACnD;AACDr3B,MAAAA,OAAMkwE,iBAAiB,mBAAmBF;IAC7C,CACA;AAAA,EAAA,CAAA;AAEChwE,EAAAA,OAAM2rE,YAAYrgC,QAAQqgC;AAC1B3rE,EAAAA,OAAM6sE,yBAAyBvhC,QAAQuhC;AACvC7sE,EAAAA,OAAMuC,OAAOoqE,oBAAoB;AACjC3sE,EAAAA,OAAMuC,OAAOw+D,iBAAiB;AAC9B/gE,EAAAA,OAAMuC,OAAOwrE,8BAA8B;AAK3C/tE,EAAAA,OAAMmS,UAAUg+D,uBAAuB,SAAS/gE,YAAYC,UAAU4xD,UAAU3wD,QAAOw8D;;AACvF9sE,EAAAA,OAAMmS,UAAUi+D,uBAAuB,SAAShhE,YAAYC,UAAU4xD,UAAU3wD,QAAOw8D,aACtF;AAAA,WAAOx8D,OAAMtX,SAAS;AAAA,EACxB;AACCgH,EAAAA,OAAMmS,UAAUk+D,2BAA2B,SAASjhE,YAAYC,UAAU4xD,UAAU3wD,QAAOw8D,aAAAA;AAC1F,WAAOx8D,OAAMtX,SAAS;AAAA,EACxB;AACCgH,EAAAA,OAAMmS,UAAUm+D,0BAA0B,SAASlhE,YAAYC,UAAU4xD,UAAU3wD,QAAOw8D,aACzF;AAAA,WAAO;AAAA,EACT;AAGC,QAAMyD,2BAA2B,SAASznE,OAAOC,KAAKk4D,UAAU3wD,QAAOw8D;AACtE,QAAInxE,MAAM;AACV,QAAI2U,OAAMtX,UAAU,GAAG;AACtB2C,YAAM;AAAA,IACT,OAAS;AACNA,YAAM;AAAA,IACN;AACD,WAAOA;AAAAA,EACT;AAEC,QAAM60E,8BAA8B,SAAS1nE,OAAOC,KAAKk4D,UAAU3wD,QAAOw8D;AACzE,WAAOx8D,OAAMtX,SAAS;AAAA,EACxB;AAECgH,EAAAA,OAAMmS,UAAUs+D,sBAAsBD;AACtCxwE,EAAAA,OAAMmS,UAAUu+D,sBAAsBH;AAGtCvwE,EAAAA,OAAMyE,YAAY,sBAAsB,WAAA;AACvC,QAAGzE,OAAMuC,OAAO89D,aAAargE,OAAMuC,OAAO89D,UAAUiP,2BAA0B;AAE7EtvE,MAAAA,OAAMuC,OAAOwrE,8BAA8B;AAC3C,UAAG/tE,OAAMmS,UAAUs+D,wBAAwBD,6BAA4B;AACtExwE,QAAAA,OAAMmS,UAAUs+D,sBAAsBzwE,OAAMoC,IAAIi+D,UAAUmN;AAAAA,MAC1D;AACD,UAAGxtE,OAAMmS,UAAUu+D,wBAAwBH,0BAAyB;AACnEvwE,QAAAA,OAAMmS,UAAUu+D,sBAAsB1wE,OAAMoC,IAAIi+D,UAAUqN;AAAAA,MAC1D;AAED1tE,MAAAA,OAAMoC,IAAIi+D,UAAUyN,oBAAoB9tE,MACxC;AAAA,IAAA;AAAA,EACH,CACA;AAAA;AC9lBe,SAAQ2wE,qBAAE3wE,QAAAA;AACxB,MAAI4wE,8BAA8B;AAClC5wE,EAAAA,OAAMuC,OAAOg+D,4BAA4B;AACzCvgE,EAAAA,OAAMuC,OAAOsuE,+BAA+B;AAE5C,MAAIC,4BAA4B,EAC/BC,MAAM,QACNC,aAAa,eACbC,YAAY,cACZC,oBAAoB,sBACpBC,kBAAkB,mBAAA;AAEnB,MAAIC,2BAA2BN,0BAA0BC;AAEzD,MAAIM,kBAAkB,EACrBC,YAAY,cACZC,eAAe,iBACfC,SAAS,UAAA;AAIV,WAASC,qBAAqB5qE,MAAMuE;AACnC,QAAIvE,KAAKuI,YAAY;AACpBvI,WAAKuI,aAAapP,OAAMsP,KAAK4tC,UAAUr2C,KAAKuI,YAAY,YAAA;AAAA,IAC3D,OAAS;AACNvI,WAAKuI,aAAa;AAAA,IAClB;AAED,QAAIvI,KAAKwI,UAAU;AAClBxI,WAAKwI,WAAWrP,OAAMsP,KAAK4tC,UAAUr2C,KAAKwI,UAAU;IACvD,OAAS;AACNxI,WAAKwI,WAAW;AAAA,IAChB;AAED,QAAI9H,SAAQy1D,OAAOn2D,KAAKU,KAAAA;AACxB,QAAImqE,YAAY;AAChB,QAAKt6E,CAAAA,MAAMmQ,MAAQ,GAAA;AAClBV,WAAKU,QAAQA;AAAAA,IAChB,OAAS;AACNV,WAAKU,QAAQ;AACbmqE,kBAAY;AAAA,IACZ;AAED,QAAK1xE,CAAAA,OAAMugC,QAAQ15B,KAAKmP,QAAQ;AAC/BnP,WAAKmP,QAAQ;AAAA,IACb;AAED,QAAA,CAAKnP,KAAKi0B,WAAYj0B,CAAAA,KAAK4lE,aAAa;AACvC,aAAO;AAAA,IACP;AAED5lE,SAAK2tB,OAAO3tB,KAAK2tB,QAAQ68C,gBAAgBG;AAEzC,QAAG3qE,KAAK2tB,SAAS68C,gBAAgBE,eAAc;AAC9C,UAAGn6E,MAAM4lE,OAAOn2D,KAAKuyD,QAAW,CAAA,GAAA;AAC/BhuD,eAAOA,QAAQpL,OAAMmc,QAAQtV,KAAKi0B,OAClCj0B;AAAAA,aAAKuyD,WAAWp5D,OAAMovE,kBAAkB,EACvChgE,YAAYvI,KAAKuI,YACjBC,UAAUxI,KAAKwI,UACfnL,IAAIkH,KAEL,CAAA;AAAA,MAAA;AACD,UAAGsmE,WAAU;AACZtmE,eAAOA,QAAQpL,OAAMmc,QAAQtV,KAAKi0B,OAClCj0B;AAAAA,aAAKU,QAAQvH,OAAMovE,kBAAkB,EACpChgE,YAAYhE,KAAKgE,YACjBC,UAAUxI,KAAKuI,YACflL,IAAIkH,KAEL,CAAA;AAAA,MAAA;AAAA,IACD;AAED,QAAIvE,KAAK2tB,SAAS68C,gBAAgBC,eAAelmE,QAAQpL,OAAM0d,aAAa7W,KAAKi0B,OAAAA,IAAW;AAC3F1vB,aAAOA,QAAQpL,OAAMmc,QAAQtV,KAAKi0B,OAAAA;AAClC,UAAI62C,SAASC,wBAAwB/qE,MAAMuE,IAC3CvE;AAAAA,WAAKuI,aAAauiE,OAAOviE;AACzBvI,WAAKwI,WAAWsiE,OAAOtiE;AACvBxI,WAAKuyD,WAAWuY,OAAOvY;AAAAA,IACvB;AAAA,EACD;AAED,MAAIyY,2BAA2B7xE,OAAMw1B,gBAAgB,EACpDl7B,MAAM0F,OAAMuC,OAAOg+D,2BACnB9qC,UAAU,SAAU5uB;AACnB,QAAKA,CAAAA,KAAK3C,IAAI;AACb2C,WAAK3C,KAAKlE,OAAM01B,IAChB;AAAA,IAAA;AAED+7C,yBAAqB5qE,IAErB;AAAA,WAAOA;AAAAA,EACP,EAGF7G,CAAAA;AAAAA,EAAAA,OAAM+yB,MAAM6sC,mBAAmBiS;AAE/B,WAASD,wBAAwBhR,YAAYx1D,MAAAA;AAE5C,QAAIw1D,WAAWpsC,SAAS68C,gBAAgBC,YAAY;AACnD,aAAO,EACNliE,YAAYwxD,WAAWxxD,YACvBC,UAAUuxD,WAAWvxD,UACrB+pD,UAAUwH,WAAWxH,SAEzB;AAAA,IAAA,OAAS;AACN,UAAItwD,QAAQ83D,WAAWr5D,QAAQvH,OAAMm5D,iBAAiB,EACrD/pD,YAAYhE,KAAKgE,YACjBgqD,UAAUwH,WAAWr5D,OACrB6D,UACI,IAAIuK,KAAKvK,KAAKgE,UAAAA;AAEnB,UAAIrG;AACJ,UAAIqwD;AACJ,UAAIwH,WAAWpsC,SAAS68C,gBAAgBE,eAAe;AACtDxoE,cAAM/I,OAAMm5D,iBAAiB,EAC5B/pD,YAAYtG,OACZswD,UAAUwH,WAAWxH,UACrBhuD,KAAMA,CAAAA;AAEPguD,mBAAWwH,WAAWxH;AAAAA,MAC1B,OAAU;AACNrwD,cAAM,IAAI4M,KAAKvK,KAAKiE,QAAAA;AACpB+pD,mBAAWhuD,KAAKguD,WAAWwH,WAAWr5D;AAAAA,MACtC;AAAA,IACD;AAED,WAAO,EACN6H,YAAYtG,OACZuG,UAAUtG,KACVqwD;EAED;AAID,WAAS0Y,yBAAyB1mE,MACjC;AAAA,UAAMs0D,WAAW1/D,OAAMuC,OAAOoqE;AAC9B,QAAIG,cAAc1hE,KAAKs0D;AACvB,UAAMqS,sBAAsB;AAC5B,QAAIC,eAAeZ,6BAA6BN,0BAA0BC;AAE1E,QAAI/wE,OAAMugC,QAAQusC,WAAAA,KAAgBA,aAAa;AAC9C,UAAA,CAAKn0E,MAAMoO,QAAQ+lE,WAAAA,GAAc;AAChCA,sBAAc,CAACA,WAAAA;AACf,YAAIkF,cAAc;AACjBZ,qCAA2BN,0BAA0BE;AACrDgB,yBAAe;AAAA,QACf;AAAA,MACD;AAED,YAAMC,UAAU,CAAA;AAChBnF,kBAAY1mE,QAAQ,SAAUoZ;AAC7B,YAAKA,CAAAA,IAAIitD,aAAa;AACrBjtD,gBAAM,EAAEitD,aAAajtD,IACrB;AAAA,cAAIwyD,cAAc;AACjBZ,uCAA2BN,0BAA0BG;AACrDe,2BAAe;AAAA,UACf;AAAA,QAED;AAED,YAAIA,cAAc;AACjB,cAAIxyD,IAAItb,MAAMsb,IAAIitD,aAAa;AAC9B2E,uCAA2BN,0BAA0BK;AACrDa,2BAAe;AAAA,UACrB,OAAY;AACNZ,uCAA2BN,0BAA0BI;AACrDc,2BAAe;AAAA,UACf;AAAA,QACD;AAED,YAAIE,cAAcb,gBAAgBG;AAClC,YAAA,CAAIhyD,IAAIgV,MAAK;AACZ,cAAIhV,IAAIpQ,cAAcoQ,IAAInQ,YAAcmQ,IAAIpQ,cAAcoQ,IAAI45C,UAAU;AACvE8Y,0BAAcb,gBAAgBE;AAAAA,UAC9B;AAAA,QACD;AAED,YAAIrtE;AACJ,aAAIsb,IAAItb,MAAMsb,IAAInR,OAAQ4jE,CAAAA,QAAQzyD,IAAInR,GAAAA,GAAK;AAC1CnK,eAAKsb,IAAInR;AAAAA,QACd,WAAcmR,IAAItb,MAAAA,CAAO+tE,QAAQzyD,IAAItb,EAAAA,GAAI;AACpCA,eAAKsb,IAAItb;AAAAA,QACd,OAAU;AACLA,eAAKlE,OAAM01B,IAAAA;AAAAA,QACX;AACDu8C,gBAAQ/tE,MAAM;AAEd,cAAM08D,aAAa,EAClB18D,IACAkL,YAAYoQ,IAAIpQ,YAChBgqD,UAAU55C,IAAI45C,UACd/pD,UAAUmQ,IAAInQ,UACd9H,OAAOiY,IAAIjY,OACXuzB,SAAS1vB,KAAKlH,IACduoE,aAAajtD,IAAIitD,aACjBz2D,OAAOwJ,IAAIxJ,OACXwe,MAAMhV,IAAIgV,QAAQ09C,YAAAA;AAInBn0D,eAAOC,KAAKwB,KAAKpZ,QAAQkQ,SAAAA;AACxB,cAAGA,OAAO,OAAO;AAChBsqD,uBAAWtqD,GAAAA,IAAOkJ,IAAIlJ,GAAAA;AAAAA,UACtB;AAAA,QAGF,CAAA;AAAA,YAAA,EAAKsqD,WAAWxxD,cAAcwxD,WAAWxxD,WAAWjI,YAChDy5D,WAAWvxD,YAAYuxD,WAAWvxD,SAASlI,YAAAA,OAAmBy5D,WAAWxH,aAAa,WAAU;AACnGqY,+BAAqB7Q,YAAYx1D,IAAAA;AAAAA,QACjC;AAED2mE,4BAAoB91E,KAAK2kE;MAC7B,CACG;AAAA,IAAA;AACD,WAAOmR;AAAAA,EACP;AAED,WAASI,gBAAgB5mD,QAExB;AAAA,QAAA,CAAKvrB,OAAM0d,aAAa6N,MAAAA,GAAQ;AAC/B;AAAA,IACA;AAED,QAAIngB,OAAOpL,OAAMmc,QAAQoP;AACzB,QAAIuhD,cAAc9sE,OAAMoyE,mBAAmBhnE,KAAKlH;AAChDmuE,uBAAmBjnE,MAAM0hE,WACzB;AAAA,EAAA;AAED,WAASuF,mBAAmBjnE,MAAM0hE,aACjCA;AAAAA,gBAAY5zE,KAAK,SAAS1B,GAAG2B,GAAAA;AAC5B,UAAG3B,EAAE4X,cAAcjW,EAAEiW,cAAc5X,EAAE4X,WAAW1E,aAAavR,EAAEiW,WAAW1E,WAAU;AACnF,eAAOlT,EAAE4X,aAAajW,EAAEiW;AAAAA,MAC5B,OAAQ;AACJ,eAAO;AAAA,MACP;AAAA,IACJ,CAAA;AACE,QAAIgiE,4BAA4BN,0BAA0BK,kBAAkB;AAC3E/lE,WAAKpL,OAAMuC,OAAOoqE,iBAAAA,IAAqBG;AAAAA,IAC1C,WAAasE,4BAA4BN,0BAA0BI,oBAAoB;AACpF9lE,WAAKpL,OAAMuC,OAAOoqE,iBAAAA,IAAqBG,YAAYtmE,IAAI,SAAUhP,GAAAA;AAChE,eAAO,EACN6W,KAAK7W,EAAE0M,IACPkL,YAAY5X,EAAE4X,YACdgqD,UAAU5hE,EAAE4hE,UACZ/pD,UAAU7X,EAAE6X,UACZ9H,OAAO/P,EAAE+P,OACTklE,aAAaj1E,EAAEi1E,aACfz2D,OAAOxe,EAAEwe,OACTwe,MAAMh9B,EAAEg9B,KAEb;AAAA,MAAA,CAAA;AAAA,IACG;AAEDppB,SAAKwlE,2BAAAA,IAA+B9D;AAAAA,EACpC;AAED,WAASwF,yBAAyBlnE,MACjC;AAAA,QAAI0hE,cAAcgF,yBAAyB1mE,IAE3C0hE;AAAAA,gBAAY1mE,QAAQ,SAAU5O,GAAAA;AAC7BA,QAAE0M,KAAK1M,EAAE0M,MAAMlE,OAAM01B,IAAAA;AAAAA,IAGxB,CAEE;AAAA,WAAOo3C;AAAAA,EACP;AAED,WAASyF,gBAAgBC,YAAYC,wBACpC;AAAA,QAAIxxE,SAAS,EACZyxE,QAAQ,CACRC,GAAAA,kBAAkB,CAClBC,GAAAA,kBAAkB,CAGnB,EAAA;AAAA,QAAIxB,4BAA4BN,0BAA0BE,aAAa;AACtE,UAAI6B,YAAYL,WAAW,CAC3B;AAAA,UAAIM,UAAUD,YAAYA,UAAUpG,cAAc;AAClD,UAAIsG,uBAAuB;AAC3BN,6BAAuBrsE,QAAQ,SAAU5O,GACxC;AAAA,YAAIA,EAAEi1E,eAAeqG,SAAS;AAC7B7xE,iBAAO2xE,iBAAiB32E,KAAKzE;QAClC,WAAeA,EAAEi1E,eAAeqG,SAAS;AACpC7xE,iBAAOyxE,OAAOz2E,KAAK,EAAE8X,OAAOvc,GAAG4T,MAAMynE,UAAAA,CAAAA;AACrCE,iCAAuB;AAAA,QACvB;AAAA,MACL,CACG;AAAA,UAAA,CAAKA,wBAAwBF,WAAW;AACvC5xE,eAAO0xE,iBAAiB12E,KAAK42E,SAAAA;AAAAA,MAC7B;AAAA,IAGJ,WAAazB,4BAA4BN,0BAA0BG,YAAW;AAE3E,UAAI+B,aAAa,CAAA;AACjB,UAAIC,cAAc,CAAA;AAClB,UAAIC,eAAe,CAAA;AACnBV,iBAAWpsE,QAAQ,SAAU5O,GAAAA;AAC5Bw7E,mBAAWx7E,EAAEi1E,WAAAA,IAAej1E;AAAAA,MAChC,CACGi7E;AAAAA,6BAAuBrsE,QAAQ,SAAU5O,GAAAA;AACxCy7E,oBAAYz7E,EAAEi1E,WAAej1E,IAAAA;AAAAA,MACjC;AACGg7E,iBAAWrtE,OAAOstE,sBAAwBrsE,EAAAA,QAAQ,SAAU5O,GAAAA;AAC3D,YAAI07E,aAAa17E,EAAEi1E,WAAc,GAAA;AAChC;AAAA,QACA;AACDyG,qBAAa17E,EAAEi1E,WAAAA,IAAe;AAC9B,YAAI0G,SAASH,WAAWx7E,EAAEi1E,WAAAA;AAC1B,YAAI2G,UAAUH,YAAYz7E,EAAEi1E;AAE5B,YAAI0G,UAAUC,SAAS;AACtBnyE,iBAAOyxE,OAAOz2E,KAAK,EAAE8X,OAAOq/D,SAAShoE,MAAM+nE,OAChD,CAAA;AAAA,QAAA,WAAeA,UAAWC,CAAAA,SAAS;AAC9BnyE,iBAAO0xE,iBAAiB12E,KAAKk3E,MAClC;AAAA,QAAA,WAAgBA,CAAAA,UAAUC,SAAS;AAC9BnyE,iBAAO2xE,iBAAiB32E,KAAKm3E,OAC7B;AAAA,QAAA;AAAA,MACL,CACA;AAAA,IAAA,WAAchC,4BAA4BN,0BAA0BK,oBAC7DC,4BAA4BN,0BAA0BI,oBAAqB;AAC/E,UAAI8B,aAAa,CAAA;AACjB,UAAIC,cAAc,CAAA;AAClB,UAAIC,eAAe,CAAA;AACnBV,iBAAWpsE,QAAQ,SAAU5O;AAC5Bw7E,mBAAWx7E,EAAE0M,MAAM1M,EAAE6W,GAAAA,IAAO7W;AAAAA,MAChC,CAAA;AACGi7E,6BAAuBrsE,QAAQ,SAAU5O,GACxCy7E;AAAAA,oBAAYz7E,EAAE0M,EAAM1M,IAAAA;AAAAA,MACxB;AACGg7E,iBAAWrtE,OAAOstE,sBAAwBrsE,EAAAA,QAAQ,SAAU5O,GAAAA;AAC3D,YAAI0M,KAAK1M,EAAE0M,MAAM1M,EAAE6W;AACnB,YAAI6kE,aAAahvE,EAAK,GAAA;AACrB;AAAA,QACA;AAEDgvE,qBAAahvE,EAAAA,IAAM;AACnB,YAAIivE,SAASH,WAAW9uE,EACxB;AAAA,YAAIkvE,UAAUH,YAAY/uE,EAAAA;AAE1B,YAAIivE,UAAUC,SAAS;AACtBnyE,iBAAOyxE,OAAOz2E,KAAK,EAAE8X,OAAOq/D,SAAShoE,MAAM+nE,OAChD,CAAA;AAAA,QAAA,WAAeA,UAAAA,CAAWC,SAAS;AAC9BnyE,iBAAO0xE,iBAAiB12E,KAAKk3E;QAClC,WAAW,CAAKA,UAAUC,SAAS;AAC9BnyE,iBAAO2xE,iBAAiB32E,KAAKm3E,OAAAA;AAAAA,QAC7B;AAAA,MACL,CACG;AAAA,IAAA;AACD,WAAOnyE;AAAAA,EACP;AAED,WAASoyE,qBAAqB11D,QAAQphB,QAAAA;AACrC,QAAI+2E,eAAe,EAClBpvE,IAAI;AAGL,aAASnL,KAAK4kB,QAAQ;AACrB,WAAK21D,aAAav6E,CAAAA,GAAI;AACrB,YAAIgE,OAAO4gB,OAAO5kB,QAAQgE,OAAOR,OAAOxD,KAAK;AAC5C,iBAAO;AAAA,QACP;AAAA,MACD;AAAA,IACD;AACD,WAAO;AAAA,EACP;AACD,WAASw6E,iBAAiB51D,QAAQphB;AACjC,QAAI+2E,eAAe,EAClBpvE,IAAI,KAAA;AAGL,aAASnL,KAAK4kB,QAAQ;AACrB,UAAK21D,CAAAA,aAAav6E,CAAI,GAAA;AACrBwD,eAAOxD,CAAAA,IAAK4kB,OAAO5kB,CACnB;AAAA,MAAA;AAAA,IACD;AAAA,EACD;AAED,WAASy6E,iBAAiBpoE,MAAMqoE,kBAC/B;AAAA,QAAIC,mBAAmB5B,yBAAyB1mE,IAAAA;AAEhD,QAAI+iD,OAAOokB,gBAAgBmB,kBAAkBD,gBAAAA;AAC7CtlB,SAAKykB,iBAAiBxsE,QAAQ,SAAU5O,GAAAA;AACvCq6E,+BAAyB56C,WAAWz/B,EAAE0M,EAAAA;AAAAA,IACzC;AACEiqD,SAAKwkB,iBAAiBvsE,QAAQ,SAAU5O,GACvCq6E;AAAAA,+BAAyB/6C,QAAQt/B,CACpC;AAAA,IAAA,CAAA;AAEE22D,SAAKukB,OAAOtsE,QAAQ,SAAU5O,GAC7B;AAAA,UAAI67E,qBAAqB77E,EAAE4T,MAAM5T,EAAEuc,QAAQ;AAC1Cw/D,yBAAiB/7E,EAAE4T,MAAM5T,EAAEuc,KAAAA;AAC3B89D,iCAAyBprB,WAAWjvD,EAAEuc,MAAM7P,EAAAA;AAAAA,MAChD,OAAU;AACN,YAAI1M,EAAE4T,KAAKgE,cAAc5X,EAAE4T,KAAKiE,YAAY7X,EAAE4T,KAAKopB,SAAS68C,gBAAgBC,YAAY;AACvF,cAAIK,SAASC,wBAAwBp6E,EAAEuc,OAAO3I,IAAAA;AAC9C,cAAI5T,EAAEuc,MAAM3E,WAAW1E,QAAAA,KAAainE,OAAOviE,WAAW1E,aAAalT,EAAEuc,MAAM1E,SAAS3E,QAAainE,KAAAA,OAAOtiE,SAAS3E,QAAW,GAAA;AAC3HlT,cAAEuc,MAAM3E,aAAauiE,OAAOviE;AAC5B5X,cAAEuc,MAAM1E,WAAWsiE,OAAOtiE;AAC1B7X,cAAEuc,MAAMqlD,WAAWuY,OAAOvY;AAC1ByY,qCAAyBprB,WAAWjvD,EAAEuc,MAAM7P,EAC5C;AAAA,UAAA;AAAA,QACD;AAAA,MACD;AAAA,IACJ,CAAA;AAEEiuE,oBAAgB/mE,KAAKlH,EAAAA;AAAAA,EACrB;AAED,WAASyvE,kBAAkBvoE,MAAAA;AAC1B,QAAIqoE,mBAAmBroE,KAAKwlE,gCAAgCiB,yBAAyBlrE,KAAK,SAAUnP,GACnG;AAAA,aAAOA,EAAEsjC,WAAW1vB,KAAKlH;AAAAA,IAC5B;AAEEsvE,qBAAiBpoE,MAAMqoE;EACvB;AAED,WAASG,kBAAkB5iB,KAC1B;AAAA,QAAI6iB,YAAY,CAAA;AAChB7iB,QAAI5qD,QAAQ,SAAUlC,IAAAA;AACrB2vE,gBAAU3vE,EAAAA,IAAM;AAAA,IACnB,CAAA;AACE,QAAI4vE,gBAAgBjC,yBAAyBlrE,KAAK,SAAUnP,GAC3D;AAAA,aAAOq8E,UAAUr8E,EAAEsjC,OAAAA;AAAAA,IACtB;AACEg5C,kBAAc1tE,QAAQ,SAAU5O,GAC/Bq6E;AAAAA,+BAAyB56C,WAAWz/B,EAAE0M,EACzC;AAAA,IAAA,CAAA;AAAA,EACE;AAEDlE,EAAAA,OAAMyE,YAAY,gBAAgB,WAEjC;AAAA,QAAIzE,OAAMuC,OAAOsuE,8BAA8B;AAC9C7wE,MAAAA,OAAMyE,YAAY,WAAW;AAC5BzE,QAAAA,OAAMu4B,OAAO;AACZs5C,mCAAyB7mB,SAAAA;AACzB,cAAI+oB,mBAAmB,CAAA;AACvB/zE,UAAAA,OAAM6Q,SAAS,SAAUzF,MAAAA;AACxB,gBAAIA,KAAK8D,SAASlP,OAAMuC,OAAOqxB,MAAM3U,SAAS;AAC7C;AAAA,YACA;AACD,gBAAI6tD,cAAcwF,yBAAyBlnE,IAAAA;AAC3CinE,+BAAmBjnE,MAAM0hE,WAAAA;AAEzBA,wBAAY1mE,QAAQ,SAAU5O;AAC7Bu8E,+BAAiB93E,KAAKzE,CAC7B;AAAA,YAAA,CAAA;AAAA,UACA,CACKq6E;AAAAA,mCAAyBl9D,MAAMo/D,gBACpC;AAAA,QAAA,CAAA;AAAA,MAEA,CAEG;AAAA,UAAItoC,cAAc;AAClB,UAAIuoC,aAAa;AACjB,UAAIC,gBAAgB,CAAA;AACpB,UAAIC,kBAAkB;AACtBl0E,MAAAA,OAAMyE,YAAY,uBAAuB;AACxCgnC,sBAAc;AAAA,MAClB,CACGzrC;AAAAA,MAAAA,OAAMyE,YAAY,sBAAsB;AAEvC,YAAGuvE,YAAW;AACb,cAAIG,kBAAkB,CAAA;AACtB,mBAAQp7E,KAAKk7E,eAAc;AAC1BE,4BAAgBp7E,KAAKiH,OAAMoyE,mBAAmB6B,cAAcl7E,CAAGmL,EAAAA,EAAAA;AAAAA,UAC/D;AAID,cAAIlE,OAAMuC,OAAOsuE,gCAAgCO,6BAA6B,sBAAqB;AAClGgD,mCAAuB;AAAA,UACvB;AACD,mBAAQr7E,KAAKk7E,eAAc;AAC1BT,6BAAiBS,cAAcl7E,CAAIo7E,GAAAA,gBAAgBp7E;UACnD;AAAA,QACD;AACDi7E,qBAAa;AACbvoC,sBAAc;AACdwoC,wBAAgB,CAAA;AAAA,MACpB,CAAA;AAEGj0E,MAAAA,OAAMyE,YAAY,iBAAiB,SAAUoC,MAAAA;AAC5C,YAAIimE,cAAcwF,yBAAyBzrE,IAAAA;AAC3CgrE,iCAAyBl9D,MAAMm4D,WAAAA;AAC/BuF,2BAAmBxrE,MAAMimE,WACzB;AAAA,eAAO;AAAA,MACX,CACG9sE;AAAAA,MAAAA,OAAMyE,YAAY,qBAAqB,SAAUP,IAAI2C,MACpD;AAAA,YAAG4kC,aAAY;AACduoC,uBAAa;AACbC,wBAAc/vE,EAAM2C,IAAAA;AAAAA,QACzB,WAAU,CAAKA,KAAKwtE,aAAY;AAC3BV,4BAAkB9sE,IAAAA;AAAAA,QAClB;AAAA,MACL,CAAA;AACG7G,MAAAA,OAAMyE,YAAY,kBAAkB,SAAUP,IAAI2C;AACjD,YAAG4kC,aAAY;AACduoC,uBAAa;AACbC,wBAAc/vE,EAAAA,IAAM2C;AAAAA,QACzB,OAAS;AACJ8sE,4BAAkB9sE,IAAAA;AAAAA,QAClB;AAAA,MACL,CAAA;AAKG7G,MAAAA,OAAMyE,YAAY,gBAAgB,SAAUP,IAAAA;AAC3CyvE,0BAAkB3zE,OAAMmc,QAAQjY,EAAAA,CAAAA;AAAAA,MACpC;AACGlE,MAAAA,OAAM+yB,MAAMC,WAAWvuB,YAAY,0BAA0B,SAAUP,IAAI2C,MAAAA;AAC1E,YAAIytE,YAAY,CAACpwE,EAAAA;AACjBlE,QAAAA,OAAM6Q,SAAS,SAAUzF;AACxBkpE,oBAAUr4E,KAAKmP,KAAKlH,EACpB;AAAA,QAAA,GAAEA,EACH0vE;AAAAA,0BAAkBU,SACtB;AAAA,MAAA,CAAA;AACGt0E,MAAAA,OAAM+yB,MAAMC,WAAWvuB,YAAY,cAAc,WAAA;AAChD8vE,mCAA2B;AAC3BC,uCAA+B;AAC/BJ,+BAAuB;AACvBvC,iCAAyB7mB;AACzB,eAAO;AAAA,MACX,CACGhrD;AAAAA,MAAAA,OAAMyE,YAAY,kBAAkB,SAAUP,IAAI22B,QAAAA;AACjD,YAAIi5C,gBAAgBjC,yBAAyBlrE,KAAK,SAAUnP,GAC3D;AAAA,iBAAOA,EAAEsjC,WAAW52B;AAAAA,QACzB;AACI4vE,sBAAc1tE,QAAQ,SAAU5O,GAAAA;AAC/BA,YAAEsjC,UAAUD;AACZg3C,mCAAyBprB,WAAWjvD,EAAE0M,EAAAA;AAAAA,QAC3C,CACIiuE;AAAAA,wBAAgBt3C;MAEpB,CAGG76B;AAAAA,MAAAA,OAAMyE,YAAY,gBAAgB,SAAUsR,QAAAA;AAC3Cm+D,0BAAkB;AAClB,eAAO;AAAA,MACX,CACGl0E;AAAAA,MAAAA,OAAMyE,YAAY,eAAe,SAAUsR,QAC1Cm+D;AAAAA,0BAAkB;AAAA,MACtB,CAAA;AAGG,UAAIK,2BAA2B;AAC/B,UAAIC,+BAA+B;AACnC,UAAIJ,uBAAuB;AAE3BvC,+BAAyBptE,YAAY,kBAAkB,SAAS8mE,aAAAA;AAC/D,YAAG9/B,eAAgByoC,CAAAA,iBAAgB;AAClC,iBAAO;AAAA,QACP;AACDK,mCAA2B;AAC3BC,uCAA+B;AAC/BJ,+BAAuB;AACvB,eAAO;AAAA,MACX,CAAA;AAEGp0E,MAAAA,OAAM6sE,yBAAyB,SAAUN,YAAYhhD,QACpD;AAAA,YAAIkpD,eAAez0E,OAAMugC,QAAQhV,MAAAA,KAAWA,WAAW;AAEvD,YAAGgpD,6BAA6B,MAAK;AACpCA,qCAA2B,CAAA;AAC3BC,yCAA+B,CAAA;AAE/B3C,mCAAyB1qB,SAAS,SAAU3vD,GAAAA;AAC3C,gBAAI+8E,CAAAA,yBAAyB/8E,EAAEi1E,WAAAA,GAAa;AAC3C8H,uCAAyB/8E,EAAEi1E,WAAe,IAAA,CAAA;AAAA,YAC1C;AACD8H,qCAAyB/8E,EAAEi1E,WAAaxwE,EAAAA,KAAKzE;AAE7C,gBAAIk9E,uBAAuBl9E,EAAEi1E,cAAc,MAAMj1E,EAAEsjC;AACnD,gBAAI05C,CAAAA,6BAA6BE,uBAAsB;AACtDF,2CAA6BE,wBAAwB,CACrD;AAAA,YAAA;AACDF,yCAA6BE,oBAAsBz4E,EAAAA,KAAKzE,CAC9D;AAAA,UAAA,CAAA;AAAA,QACK;AAGD,YAAGi9E,cAAa;AACf,kBAAQD,6BAA6BjI,aAAa,MAAMhhD,WAAW,CAAI1yB,GAAAA,MAAAA;AAAAA,QAC5E,OAAS;AACJ,kBAAQ07E,yBAAyBhI,eAAe,CAAI1zE,GAAAA,MAAAA;AAAAA,QACpD;AAAA,MACL;AAGGmH,MAAAA,OAAMoyE,qBAAqB,SAAU7mD,QACpC;AAAA,YAAG6oD,yBAAyB,MAAK;AAChC,cAAInzE,SAAS,CACbmzE;AAAAA,iCAAuB,CAAA;AACvBvC,mCAAyB1qB,SAAS,SAAU3vD,GAAAA;AAC3C,gBAAI48E,CAAAA,qBAAqB58E,EAAEsjC,OAAAA,GAAS;AACnCs5C,mCAAqB58E,EAAEsjC,WAAW,CAClC;AAAA,YAAA;AACDs5C,iCAAqB58E,EAAEsjC,OAAAA,EAAS7+B,KAAKzE,CAAAA;AACrC,gBAAIA,EAAEsjC,WAAWvP,QAAQ;AACxBtqB,qBAAOhF,KAAKzE,CAAAA;AAAAA,YACZ;AAAA,UACP,CACK;AAAA,QAAA;AACD,gBAAQ48E,qBAAqB7oD,MAAW,KAAA,CAAA,GAAI1yB;MAChD;AAEGmH,MAAAA,OAAM20E,mBAAmB,SAAUppD,QAClC;AAAA,cAAMxX,QAAQ/T,OAAMsoC,aAAa,UACjC;AAAA,cAAMwkC,cAAc9sE,OAAMoyE,mBAAmB7mD,MAE7C;AAAA,cAAMqpD,kBAAkB,CAAA;AACxB9H,oBAAY1mE,QAAQ,SAAS5O,GAC5B;AAAA,cAAA,CAAIo9E,gBAAgBp9E,EAAEi1E,cAAa;AAClCmI,4BAAgBp9E,EAAEi1E,WAAAA,IAAej1E,EAAEi1E;AAAAA,UACnC;AAAA,QACN,CAEI;AAAA,cAAMpM,aAAY,CAAA;AAClB,mBAAUtnE,KAAK67E,iBAAgB;AAC9B,gBAAMp1D,MAAMzL,MAAM6iB,QAAQg+C,gBAAgB77E,CAAAA,CAAAA;AAC1C,cAAGymB,KAAI;AACN6gD,YAAAA,WAAUpkE,KAAKujB,GACf;AAAA,UAAA;AAAA,QACD;AACD,eAAO6gD;AAAAA,MACX;AAEGrgE,MAAAA,OAAMqvE,wBAAwB8C;AAAAA,IAC9B;AAAA,EACH,GAAI,EAAChuE,MAAM;AACX;ACznBe,SAAS0wE,eAAe70E,QACtC;AAAA,WAASpI;AACR,WAAOoI,OAAMuC,OAAOwxB;AAAAA,EACpB;AAED,WAAS+gD,cAAc/vE,UACtB;AAAA,WAAO;AACN,UAAInN,CAAAA,WAAAA,GAAY;AACf,eAAO;AAAA,MACP;AACD,aAAOmN,SAAS7H,MAAMD,MAAM4G,SAC/B;AAAA,IAAA;AAAA,EACE;AAED,WAASkxE,qBAAqBC;AAC7B,QAAGA,iBAAAA,CAAkBA,cAAcC,sBAAqB;AACvDD,oBAAcC,uBAAuB;AACrCD,oBAAcvwE,YAAY,kBAAkBqwE,cAAc,SAAS5wE,IAAIrD,OAAO6O,OAAAA;AAC7E,YAAGA,MAAKR,QAAQlP,OAAMuC,OAAOqxB,MAAMC,aAAY;AAC9CmhD,wBAAcjX,WAAW75D,IAAI,KAC7B;AAAA,iBAAO;AAAA,QACP;AACD,eAAO;AAAA,MACP;IACD;AAAA,EACD;AAED,WAASgxE,oBAAAA;AACR,QAAIC,eAAen1E,OAAM2rE,UAAU,QAAQ3rE,OAAMuC,OAAOqxB,MAAMC,WAAAA;AAC9D,SAAIshD,aAAan8E,UAAAA,CAAWgH,OAAM0d,aAAay3D,aAAa,GAAGjxE,EAAI,GAAA;AAClE,UAAI2vB,cAAc,EACjBwgD,aAAa,MACbnlE,MAAMlP,OAAMuC,OAAOqxB,MAAMC,aACzBulC,UAAS,GACT9gD,MAAMtY,OAAMoT,OAAOC,OAAO+hE,SAE3B;AAAA,UAAGp1E,OAAMgF,UAAU,iBAAiB,CAAC6uB,WAAkB,CAAA,MAAA,OAAM;AAC5D;AAAA,MACA;AAED7zB,MAAAA,OAAM0mD,QAAQ7yB,WAEd;AAAA,IAAA;AAAA,EACD;AAED,WAASwhD,UAAUnxE;AAClB,QAAI2C,OAAO7G,OAAMmc,QAAQjY,EAAAA;AACzB,QAAG2C,KAAKqI,QAAQlP,OAAMuC,OAAOqxB,MAAMC,aAAa;AAC/C,UAAGhtB,KAAKuI,cAAcvI,KAAKwI,YAAYxI,KAAKwtE,aAAY;AACvDxtE,aAAKwtE,cAAc;AAAA,MACnB;AAEDr0E,MAAAA,OAAMyrC,YAAY,WACjB;AAAA,YAAI6pC,UAAUt1E,OAAMsB,KAAKuF,IACzB7G;AAAAA,QAAAA,OAAMu4B,OAAO,WAAA;AACZv4B,UAAAA,OAAM8mD,WAAWjgD,KAAK3C;QAC3B,CAEWoxE;AAAAA,eAAAA,QAAQ;AACfA,gBAAQpmE,OAAOlP,OAAMuC,OAAOqxB,MAAMxoB;AAClCkqE,gBAAQpxE,KAAKlE,OAAM01B,IACnB11B;AAAAA,QAAAA,OAAM0mD,QAAQ4uB,OAAAA;AAAAA,MAGlB;IAEG;AAAA,EACD;AAEDt1E,EAAAA,OAAMuC,OAAOqxB,MAAMC,cAAc;AACjC7zB,EAAAA,OAAMyE,YAAY,wBAAwBqwE,cAAcC,oBAAAA,CAAAA;AAExD,MAAIl1B,QAAQ;AACZ7/C,EAAAA,OAAMyE,YAAY,gBAAgB,WAAA;AACjC,QAAGo7C,OAAM;AACR;AAAA,IACA;AACDA,YAAQ;AACR7/C,IAAAA,OAAMyE,YAAY,qBAAqBqwE,cAAcO,SAAAA,CAAAA;AACrDr1E,IAAAA,OAAMyE,YAAY,kBAAkBqwE,cAAc,SAAS5wE,IAAIkH,MAC9D;AAAA,UAAGA,KAAK8D,QAAQlP,OAAMuC,OAAOqxB,MAAMC,aAAY;AAC9C,YAAIshD,eAAen1E,OAAM2rE,UAAU,QAAQ3rE,OAAMuC,OAAOqxB,MAAMC,WAAAA;AAC9DshD,qBAAa/uE,QAAQ,SAAS+qB,GAAAA;AAC7BnxB,UAAAA,OAAMu4B,OAAO,WAAA;AACZ,gBAAGv4B,OAAM0d,aAAayT,EAAEjtB,EACvBlE,EAAAA,CAAAA,OAAM8mD,WAAW31B,EAAEjtB,EAC1B;AAAA,UAAA,CAAA;AAAA,QACA;AACIgxE,0BACA;AAAA,MAAA;AAAA,IACD,CACDl1E,CAAAA;AAAAA,IAAAA,OAAMyE,YAAY,WAAWqwE,cAAcI,iBAC7C,CAAA;AAAA,EAAA,CAAA;AAEC,WAAS5rB,mBAAkB/9B,QAC1B;AAAA,QAAGvrB,OAAMuC,OAAOqxB,MAAMC,eAAe7zB,OAAM0d,aAAa6N,SAAQ;AAC/D,UAAIngB,OAAOpL,OAAMmc,QAAQoP,MAAAA;AACzB,UAAGngB,KAAK8D,QAAQlP,OAAMuC,OAAOqxB,MAAMC,aAAY;AAC9C,eAAO;AAAA,MACP;AAAA,IACD;AACD,WAAO;AAAA,EACP;AACD,WAAS0hD,kBAAkB93D,MAC1B;AAAA,QAAG6rC,mBAAkB7rC,KAAKE,MAAAA,KAAW2rC,mBAAkB7rC,KAAKlhB,MAAQ,GAAA;AACnE,aAAO;AAAA,IACP;AACD,WAAO;AAAA,EACP;AACDyD,EAAAA,OAAMyE,YAAY,oBAAoB,SAASgZ,MAC9C;AAAA,QAAG83D,kBAAkB93D,IAAAA,GAAM;AAC1B,aAAO;AAAA,IACP;AACD,WAAO;AAAA,EACT;AACCzd,EAAAA,OAAMyE,YAAY,mBAAmB,SAASP,IAAGuZ,MAAAA;AAChD,QAAG83D,kBAAkB93D,IAAAA,GAAM;AAC1B,aAAO;AAAA,IACP;AACD,WAAO;AAAA,EACT,CAECzd;AAAAA,EAAAA,OAAMyE,YAAY,qBAAqB,SAASsR,QAC/C;AAAA,aAAQhd,IAAI,GAAGA,IAAIgd,OAAOqO,SAASprB,QAAQD,KAAI;AAC9C,UAAI0rB,UAAU1O,OAAOqO,SAASrrB,CAC9B;AAAA,UAAG0rB,QAAQ2hB,WAAW,UAAU3hB,QAAQzO,MAAM9G,SAASlP,OAAMuC,OAAOqxB,MAAMC,aAAY;AACrF9d,eAAOqO,SAAS9qB,OAAOP,GAAE;AACzBA;AAAAA,MACA;AAAA,IACD;AACD,WAAO;AAAA,EACT,CAAA;AAEA;ACrIe,SAAQy8E,gBAACx1E,QACvB;AAAA,WAASpI,aACR;AAAA,WAAOoI,OAAMuC,OAAO2sC,cAClBlvC,OAAMo+B,YAAYp+B,OAAMuC,OAAOqxB,MAAM3U,OAAYjf,KAAAA,OAAMuC,OAAOqxB,MAAM3U;AAAAA,EACtE;AAED,WAAS61D,cAAc/vE,UACtB;AAAA,WAAO,WACN;AAAA,UAAA,CAAKnN,cAAa;AACjB,eAAO;AAAA,MACP;AACD,aAAOmN,SAAS7H,MAAMD,MAAM4G,SAAAA;AAAAA,IAC/B;AAAA,EACE;AAED,WAAS4xE,cAAcvxE,IAAIwxE,cAC1B;AAAA,QAAItqE,OAAOpL,OAAMmc,QAAQjY;AACzB,QAAIyxE,aAAaC,oBAAoBxqE,IAAAA;AACrC,QAAIuqE,eAAe,SAAS31E,OAAMo+B,YAAYhzB,UAAUuqE,YAAY;AACnED,mBAAaG,eAAe;AAC5BH,mBAAatqE,KAAKlH,EAAM,IAAA,EAACkH,MAAY8D,MAAMymE;IAC3C;AAAA,EACD;AAED,WAASG,gBAAgB5xE,IAAIwxE,cAC5BA;AAAAA,mBAAeA,gBAAgB;AAE/BD,kBAAcvxE,IAAIwxE,YAClB11E;AAAAA,IAAAA,OAAMonD,WAAW,SAASrpD;AACzB03E,oBAAc13E,OAAOmG,IAAIwxE,YAAAA;AAAAA,IACzB,GAAExxE,EAAAA;AAEH,WAAOwxE;AAAAA,EACP;AAED,WAASK,aAAaL,cAAAA;AACrB,aAAS38E,KAAK28E,cAAc;AAC3B,UAAGA,aAAa38E,MAAM28E,aAAa38E,CAAAA,EAAGqS,MAAK;AAC1C,YAAIA,OAAOsqE,aAAa38E,CAAGqS,EAAAA;AAC3BA,aAAK8D,OAAOwmE,aAAa38E,CAAAA,EAAGmW;AAC5BlP,QAAAA,OAAMouB,WAAWhjB,KAAKlH,EACtB;AAAA,MAAA;AAAA,IACD;AAAA,EACD;AAED,WAAS8xE,kBAAkBpnB,SAAAA;AAC1B,QAAI5uD,OAAMwK,WAAWyrE,YAAY;AAChC;AAAA,IACA;AAED,QAAIP,eAAeI,gBAAgBlnB,OACnC;AAAA,QAAI8mB,aAAaG,cAAc;AAC9B71E,MAAAA,OAAMyrC,YAAY,WACjBsqC;AAAAA,qBAAaL;MACjB,CACG;AAAA,IAAA;AAAA,EACD;AAED,MAAIQ;AAEJ,WAASC,eAAe/qE,MAAMuqE,YAAAA;AAC7B,SAAI31E,OAAMwK,SAAAA,EAAWyrE,YAAW;AAC/B7qE,WAAK8D,OAAOymE;AACZ31E,MAAAA,OAAMouB,WAAWhjB,KAAKlH,EACtB;AAAA,IAAA;AAAA,EACD;AAED,WAAS0xE,oBAAoBxqE;AAC5B,QAAIgrE,WAAWp2E,OAAMuC,OAAOqxB;AAC5B,QAAIyiD,cAAcr2E,OAAMkY,SAAS9M,KAAKlH,EACtC;AAAA,QAAIi6B,WAAWn+B,OAAMo+B,YAAYhzB,KAAK8D;AAEtC,QAAImnE,eAAel4C,aAAai4C,SAAShrE,MAAM;AAC9C,aAAOgrE,SAASn3D;AAAAA,IAChB;AAED,QAAKo3D,CAAAA,eAAel4C,aAAai4C,SAASn3D,SAAS;AAClD,aAAOm3D,SAAShrE;AAAAA,IAChB;AAED,WAAO;AAAA,EACP;AAED,MAAIkrE,gBAAgB;AAEpBt2E,EAAAA,OAAMyE,YAAY,WAAWqwE,cAAc,WAAA;AAC1CwB,oBAAgB;AAChB,QAAGt2E,OAAMwK,SAAAA,EAAWyrE,YAAW;AAC9B;AAAA,IACA;AAEDj2E,IAAAA,OAAMyrC,YAAY,WACjBzrC;AAAAA,MAAAA,OAAM6Q,SAAS,SAASzF;AACvB,YAAIuqE,aAAaC,oBAAoBxqE,IAAAA;AACrC,YAAIuqE,eAAe,OAAO;AACzBQ,yBAAe/qE,MAAMuqE,UAAAA;AAAAA,QACrB;AAAA,MACL,CAAA;AAAA,IACA;AAEEW,oBAAgB;AAAA,EAChB;AAEDt2E,EAAAA,OAAMyE,YAAY,kBAAkBqwE,cAAc,SAAS5wE,IAC1D;AAAA,QAAIoyE,eAAe;AAClBN,wBAAkB9xE,EAClB;AAAA,IAAA;AAAA,EACD;AAEDlE,EAAAA,OAAMyE,YAAY,qBAAqBqwE,cAAc,SAAS5wE,IAC7D;AAAA,QAAIoyE,eAAe;AAClBN,wBAAkB9xE,EAClB;AAAA,IAAA;AAAA,EACD;AAED,WAASqyE,uBAAuBryE;AAC/B,QAAIA,MAAMlE,OAAMuC,OAAOuV,WAAW9X,OAAM0d,aAAaxZ,EAAK,GAAA;AACzD8xE,wBAAkB9xE,EAAAA;AAAAA,IAClB;AAAA,EACD;AAEDlE,EAAAA,OAAMyE,YAAY,sBAAsBqwE,cAAc,SAAS5wE,IAAIkH,MAAAA;AAClE8qE,oBAAgBl2E,OAAM+rB,UAAU7nB;AAChC,WAAO;AAAA,EACP;AAEDlE,EAAAA,OAAMyE,YAAY,qBAAqBqwE,cAAc,SAAS5wE,IAAIkH;AACjEmrE,2BAAuBL,aAAAA;AAAAA,EACvB;AAGD,MAAIM;AAEJx2E,EAAAA,OAAMyE,YAAY,kBAAkBqwE,cAAc,SAAS5wE,IAAI3H,QAAQJ;AACtEq6E,2BAAuBx2E,OAAM+rB,UAAU7nB,EACvC;AAAA,WAAO;AAAA,EACP,CAEDlE,CAAAA;AAAAA,EAAAA,OAAMyE,YAAY,gBAAgBqwE,cAAc,SAAS5wE,IAAI3H,QAC5Dg6E;AAAAA,2BAAuBC,oBACvBR;AAAAA,sBAAkB9xE,EAClB;AAAA,EAAA,CAAA,CAAA;AAED,MAAIuyE;AAEJz2E,EAAAA,OAAMyE,YAAY,oBAAoBqwE,cAAc,SAAS/sB,KAAKhqD,QAAQwqC,QAAAA;AACzEkuC,6BAAyBz2E,OAAM+rB,UAAUg8B;AACzC,WAAO;AAAA,EACP,CAED/nD,CAAAA;AAAAA,EAAAA,OAAMyE,YAAY,mBAAmBqwE,cAAc,SAAS5wE,IAAInG,QAAQwqC,QACvE;AAAA,QAAIlzC,SAAS6F,cAAc,oBAAA,GAAuB;AAEjD;AAAA,IACA;AACDq7E,2BAAuBE;AACvBT,sBAAkB9xE,EAAAA;AAAAA,EAClB;AACF;AC9JA,MAAqBwyE,4BAArB,MAAqBA;EAArB,cAAAthD;AAICn4B,SAAA05E,WAAY3gE,WACH5e,CAAAA,MAAM6F,KAAK0X,MAAMqB,KAAAA,CAAAA;AAE1B/Y,SAAA0f,SAAU3G,WACFjZ,OAAOiZ;AAEf/Y,SAAA0X,QAASqB,WACD9f,SAAS8f,OAAO,EAAA;AAAA,EACxB;AATA;AAFO/Y,0BAAA0R,SAAS,CAAC3K,WAAqC,SAC9C,IAAI0yE;AAFb,IAAqBA,2BAArB;ACAA,MAAqBE,uBAArB,MAAqBA,qBAAAA;AAAAA,EAOpB,YAAY52E;AAKZ/C,SAAA0f,SAAUc,UACT;AAAA,YAAM4tD,OAAMpuE,KAAKotE,YAAY5sD,KAAKE,MAAAA;AAC3B,aAAA0tD;AAAAA,IAAA;AAGRpuE,SAAA05E,WAAY3gE,WACJ/Y,KAAK45E,SAAS97E,KAAKib,KAAAA;AAE3B/Y,SAAA0X,QAASqB,WAAAA;AACR,UAAI/Y,CAAAA,KAAK05E,SAAS3gE,KAAAA,GAAO;AACjB,eAAA;AAAA,MACR;AAEM,YAAA8gE,WAAW75E,KAAK45E,SAASE,KAAK/gE,KAAAA,EAAO,CAAGhZ,EAAAA,KAAAA;AAE9C,YAAM2gB,SAAS1gB,KAAK+5E,YAAYF,QAAAA,KAAa;AAEtC,aAAA,EACN5yE,YACAyZ,QACAphB,QAAQ,MACR2S,MAAMjS,KAAKiD,OAAOqC,OAAOqY,MAAMi0B,iBAC/BooC,KAAK,EAAA;AAAA,IACN;AAGSh6E,SAAAotE,cAAe1sD,YACxB;AAAA,YAAMu5D,OAAOj6E,KAAKiD,OAAOic,QAAQwB,MAAAA;AAC1B,aAAA1gB,KAAKiD,OAAOwqE,WAAWwM,IAAI;AAAA,IAAA;AAGzBj6E,SAAA+5E,cAAehhE,WACxB;AAAA,YAAMmhE,cAAc,IAAI18E,OAAO,YAAa,GAAA;AACzC,UAAA08E,YAAYJ,KAAK/gE,KAAO,GAAA;AAC1B,cAAMq1D,OAAM8L,YAAYJ,KAAK/gE,OAAO,CACpC;AAAA,cAAM5K,OAAOnO,KAAKiD,OAAOorE,iBAAiBD,IAC1C;AAAA,YAAGjgE,MAAK;AACP,iBAAOA,KAAKlH;AAAAA,QACb;AAAA,MACD;AACO,aAAA;AAAA,IAAA;AA5CPjH,SAAK45E,WAAW;AAChB55E,SAAKiD,SAASF;AAAAA,EACf;ACNc;ADHd/C,qBAAO0R,SAAS,CAAC3K,WAAiC,MAAMhE,WAChD,IAAI42E,qBAAoB52E,MAAAA;AAFjC,IAAqB42E,sBAArB;ACIe,SAAQQ,WAACp3E,QAAAA;AACvBA,EAAAA,OAAMoC,IAAIg1E,aAAa,EACtBC,mBAAmB,SAASrzE,UAAAA;AAC3B,SAAIA,UAAS;AACZA,iBAAW,CAAA;AAAA,IACX;AACD,SAAIA,SAAS+P,OAAM;AAClB/P,eAAS+P,QAAQ/T,OAAMuC,OAAO4sC;AAAAA,IAC9B;AACD,QAAA,CAAInrC,SAAS8hB,OAAM;AAClB9hB,eAAS8hB,QAAQ9lB,OAAMuC,OAAO4sC;AAAAA,IAC9B;AACD,WAAOmoC,yBAAkB3oE,OAAO3K,UAAUhE,MAC1C;AAAA,EAAA,GACDu3E,eAAe,SAASvzE,UAAAA;AACvB,WAAOwzE,oBAAc7oE,OAAO3K,UAAUhE,MACtC;AAAA,EAAA,EAAA;AAEH;ACtBA,SAAAy3E,mBAAwBz3E,QAAAA;AAEjBA,EAAAA,OAAAoC,MAAMpC,OAAMoC,OAAO,CAAA;AACzBpC,EAAAA,OAAMuC,OAAOm1E,mBAAmB;AAEhC13E,EAAAA,OAAMoC,IAAIu1E,oBAAoB33E,OAAMoC,IAAIu1E,qBAAqB,EAC5D,YACQ;AAAA,WAAA33E,OAAMuC,OAAOm1E,qBAAqB;AAAA,EAC1C,GACA,eAAAE;AACQ,YAAC53E,OAAM4K,cAAAA,EAAgB5R;AAAAA,EAC/B,GACA,cAAc8iC;AACb,UAAM+7C,yBAAyB;AAAA,4EAC0C73E,OAAMoT,OAAOC,OAAOykE;sDAC1C93E,OAAMoT,OAAOC,OAAO0kE,4BAEvE;AAAA;AAAA,UAAMC,0BAA0B;AAEhC,UAAMC,uBAAuB,kCAAkCD,uBAA0BH,GAAAA,sBAAAA;AACzF/7C,cAAUxgC,YAAY28E;AAAAA,EACvB,GAEAC,aAAa,CACb,GAAA;AACC,UAAMh0E,KAAKlE,OAAMyE,YAAY,gBAAgB,SAAStI;AAC/C,YAAAg8E,cAAan4E,OAAM2B,MAAMC;AAC/B,YAAMw2E,kBAAkBD,YAAWh6E,QAAQhC,EAAEI,QAAQ,gCAAA;AACrD,UAAI67E,iBAAgB;AACnBp4E,QAAAA,OAAMsrB,WAAW,EAChBpnB,IAAIlE,OAAM01B,IAAAA,GACVpd,MAAM,WAAA,CAAA;AAAA,MAER;AAAA,IAAA,CAAA;AAEIrb,SAAAi7E,YAAYj8E,KAAKiI;EACvB,GACA;AACMjH,SAAAi7E,YAAY9xE,QAAQ,SAAS9J,QACjC0D;AAAAA,MAAAA,OAAMqF,YAAY/I,MAAK;AAAA,IAAA,CAAA;AAExBW,SAAKi7E,cAAc,CACpB;AAAA,EAAA,GAEA,eACC;AAAA,QAAIl4E,OAAMsM,YAAY;AACf,YAAA6rE,cAAan4E,OAAM2B,MAAMC;AAC/B,UAAI5B,OAAMsM,WAAWxR,SAASkF,OAAM4sB,UAAa,GAAA;AAChD,eAAOurD,YAAWh6E,QAAQ6B,OAAM4sB,YAAY;MAC7C;AACA,UAAI5sB,OAAMsM,WAAWxR,SAASkF,OAAMiM,UAAAA,GAAY;AAC/C,eAAOksE,YAAWh6E,QAAQ6B,OAAMiM,YAAY,uBAC7C;AAAA,MAAA;AAAA,IACD;AAEO,WAAA;AAAA,EACR,GAEA,UACO;AAAA,UAAA6vB,YAAY7+B,KAAKo7E,aAAAA;AACvB,QAAKv8C,CAAAA,WAAU;AACP,aAAA;AAAA,IACR;AACM,UAAAw8C,wBAAwBx8C,UAAU5gC,cAAc,4BAAA;AAC/C,WAAAo9E;AAAAA,EACR,GAEA,OACO;AAAA,UAAAx8C,YAAY7+B,KAAKo7E,aAAAA;AACvB,QAAKv8C,CAAAA,aAAa7+B,KAAK26E,aAAAA,GAAe;AAC9B,aAAA;AAAA,IACR;AAEM,UAAAW,UAAUljF,SAASoE,cAAc,KAAA;AACvC8+E,YAAQv+E,YAAY;AACpBu+E,YAAQthF,MAAMuhF,YAAax4E,OAAMuC,OAAO8Y,eAAeygB,UAAU7lC,eAAgB;AACjF,UAAMwiF,WAAWz4E,OAAMsM,WAAW9T,iBAAiB;AAEnDG,UAAMC,UAAUwN,QAAQtN,KAAK2/E,UAAU,SAAS5hF;AAC1CA,WAAArB,WAAWqE,YAAYhD,IAAAA;AAAAA,IAAI,CAGjCoG;AAAAA,SAAKy7E;AACLz7E,SAAK07E,mBAAAA;AAEL78C,cAAUniC,YAAY4+E,OAAAA;AACtBt7E,SAAK27E,cAAcL,OAAAA;AAAAA,EACpB,GACA,OACO;AAAA,UAAAD,wBAAwBr7E,KAAK+sB,QAAAA;AACnC,QAAIsuD,uBAAsB;AACHA,4BAAA9iF,WAAWqE,YAAYy+E,qBAAAA;AAAAA,IAAqB,OAC7D;AACE,aAAA;AAAA,IACR;AAAA,EAED,GACA;EAAQ,EAGHt4E;AAAAA,EAAAA,OAAAyE,YAAY,gBAAgB,WAAA;AAC3B,UAAAkzE,oBAAoB33E,OAAMoC,IAAIu1E;AACpC,QAAIA,kBAAkB//E,UAAe+/E,KAAAA,kBAAkBC,aAAgB,GAAA;AACtED,wBAAkBv8C,KAAK;AAAA,IAAA,OACjB;AACNu8C,wBAAkB9kD,KACnB;AAAA,IAAA;AAAA,EAAA;AAMF;AChHO,MAAMgmD,oBAAoB,SAAU74E,QAAOoL;AAChD,QAAM8tD,aAAY9tD,KAAK8tD,aAAa9tD,KAAK8tD,UAAUlgE;AACnD,QAAM8/E,0BAA0B94E,OAAMuC,OAAO22D,UAAU6f,eAAe,iBAAiB/4E,OAAMuC,OAAO22D,UAAU6f,eAAe;AAC7H,MAAI7f,cAAa4f,yBAAyB;AACxC,WAAO;AAAA,EACR;AACH;AAEO,MAAME,wBAAwB,SAAUh5E,QAAOurB,QAAAA;AACpD,MAAI0tD,eAAe;AACnBj5E,EAAAA,OAAM6Q,SAAS,SAAUtV,OAAAA;AACvB,QAAI09E,cAAc;AAChB;AAAA,IACD;AACDA,mBAAeJ,kBAAkB74E,QAAOzE,KACzC;AAAA,EAAA,GAAEgwB;AACH,SAAO0tD;AACT;AAYO,MAAMC,gBAAgB,SAAU9tE,MAAAA;AACrC,SAAOA,KAAKzI,UAAUyI,KAAKzI,UAAU,WAAYyI,CAAAA,KAAKkP;AACxD;AAEO,MAAM6+D,qBAAqB,SAAUn5E,QAAO2I,MAAMyC,MAAMguE,aAAAA;AAC7D,MAAIC,YAAYD,eAAezwE,KAAKsD,WAAWgqB;AAC/C,MAAIqjD,eAAe;AACnB,MAAIC,aAAa;AAEjBv5E,EAAAA,OAAMonD,WAAW,SAAUrpD,QAAAA;AACzB,QAAIm7E,cAAcn7E,MAAS,GAAA;AACzBw7E,mBAAa;AACb,YAAMC,cAAc7wE,KAAK8wE,gBAAgB17E,MAAAA;AACzC,YAAM27E,eAAeF,YAAYG;AACjC,UAAID,eAAeL,WAAW;AAC5BA,oBAAYK;AACZJ,uBAAe;AAAA,MAChB;AAAA,IACF;AAAA,EACL,GAAKluE,KAAKlH;AAER,SAAO,EAAEm1E,WAAWC,cAAcC,WAAAA;AACpC;AChDe,SAAQrgB,UAAEl5D,QAAAA;AACvBA,EAAAA,OAAMuC,OAAO22D,YAAY,EACvB7wB,WAAW,aACX0wC,aAAa,OACb7X,yBAAyB,OACzBt1D,YAAY,IACZmnC,YAAY;AAGd,WAAS6mC,mBAAmB/yE,MAAMuE,MAAAA;AAGhC,QAAKvE,CAAAA,KAAKi0B,YAAaj0B,KAAKuI,cAAAA,CAAevI,KAAKwI,UAAW;AACzD,aAAO;AAAA,IACR;AAED,QAAIxI,KAAKuI,YAAY;AACnBvI,WAAKuI,aAAapP,OAAMsP,KAAK4tC,UAAUr2C,KAAKuI,YAAY;IAC9D,OAAW;AACLvI,WAAKuI,aAAa;AAAA,IACnB;AAED,QAAIvI,KAAKwI,UAAU;AACjBxI,WAAKwI,WAAWrP,OAAMsP,KAAK4tC,UAAUr2C,KAAKwI,UAAU,YAC1D;AAAA,IAAA,OAAW;AACLxI,WAAKwI,WAAW;AAAA,IACjB;AAGDxI,SAAKuyD,WAAWvyD,KAAKuyD,YAAY;AAGjC,QAAIvyD,KAAKuI,cAAevI,CAAAA,KAAKwI,UAAS;AACpCxI,WAAKwI,WAAWrP,OAAMm5D,iBAAiBtyD,KAAKuI,YAAYvI,KAAKuyD,QAAAA;AAAAA,IAC9D,WAAUvyD,KAAKwI,aAAaxI,KAAKuI,YAAW;AAC3CvI,WAAKuI,aAAapP,OAAMm5D,iBAAiBtyD,KAAKwI,UAAAA,CAAWxI,KAAKuyD,QAC/D;AAAA,IAAA;AAAA,EACF;AAED,QAAM+H,gBAAgBnhE,OAAMw1B,gBAAgB,EAC1Cl7B,MAAM0F,OAAMuC,OAAO22D,UAAU7wB,WAC7B5S,UAAU,SAAU5uB;AAClB,QAAKA,CAAAA,KAAK3C,IAAI;AACZ2C,WAAK3C,KAAKlE,OAAM01B,IACjB;AAAA,IAAA;AAEDkkD,uBAAmB/yE,IAAAA;AAEnB,WAAOA;AAAAA,EACR;AAGH7G,EAAAA,OAAM+yB,MAAMouC,gBAAgBA;AAE5B,WAAS0Y,eAAezuE;AACtB,QAAI0uE,gBAAgB;AACpB,UAAMC,oBAAoB,CAAA;AAE1B,UAAMC,gBAAgB5uE,KAAK8tD,aAAa,CAAA;AACxC,UAAM+gB,mBAAmBj6E,OAAMk6E,iBAAiB9uE,KAAKlH,EAAAA;AAErD,QAAI81E,cAAchhF,UAAUihF,iBAAiBjhF,QAAQ;AACnD8gF,sBAAgB;AAAA,IACjB;AAEDE,kBAAc5zE,QAAQ,SAAU8/C,UAAAA;AAC9B6zB,wBAAkB7zB,SAAShiD,EAAAA,IAAM;AACjC,YAAMi2E,kBAAkBhZ,cAAcvqC,QAAQsvB,SAAShiD,EAAAA;AACvD,UAAIi2E,iBAAiB;AACnB,cAAMrxE,SAASqxE,gBAAgB/qE,eAAAA,CAAgB82C,SAAS92C;AACxD,cAAMrG,MAAAA,CAAOoxE,gBAAgB9qE,aAAc62C,CAAAA,SAAS72C;AACpD,YAAIvG,SAASC,KAAK;AAChBo4D,wBAAc1a,WAAWP,SAAShiD,IAAIgiD,QAAAA;AAAAA,QACvC;AAAA,MACT,OAAa;AACLib,sBAAcrqC,QAAQovB,QAAAA;AAAAA,MACvB;AAAA,IACP,CAEI+zB;AAAAA,qBAAiB7zE,QAAQ,SAAU8/C,UACjC;AAAA,UAAA,CAAK6zB,kBAAkB7zB,SAAShiD,EAAAA,GAAK;AACnCi9D,sBAAclqC,WAAWivB,SAAShiD,EACnC;AAAA,MAAA;AAAA,IACP,CAEI;AAAA,QAAI41E,eAAe;AACjB,UAAIZ,cAAc9tE,IAAAA,GAAM;AAEtBgvE,iCAA0BhvE,IAClC;AAAA,MAAA,OAAa;AACLpL,QAAAA,OAAMq6E,6BAA6BjvE,IACpC;AAAA,MAAA;AACDpL,MAAAA,OAAM2C,OAAAA;AAAAA,IACP;AAAA,EACF;AAED,WAAS23E;AACPnZ,kBAAcha,SAAS,SAAUjB,UAC/B;AAAA,UAAA,CAAKlmD,OAAM0d,aAAawoC,SAASprB,OAAAA,GAAU;AACzCqmC,sBAAclqC,WAAWivB,SAAShiD,EAAAA;AAAAA,MACnC;AAAA,IACP,CAAA;AAAA,EACG;AAED,WAASk2E,yBAA0BhvE,MACjC;AAAA,QAAImvE,kBAAkB;AAEtBv6E,IAAAA,OAAMq6E,6BAA6BjvE,IAAAA;AAEnCpL,IAAAA,OAAM6Q,SAAS,SAAStV;AACtB,UAAIi/E,cAAcj/E,MAAMqQ,cAAc5L,OAAMuC,OAAOqJ;AAEnD2uE,wBAAkBA,mBAAmBC;AACrC,UAAIA,cAAcD,iBAAgB;AAChCA,0BAAkBC;AAAAA,MACnB;AAAA,IACP,GAAOpvE,KAAKlH,EAAAA;AAER,QAAIkH,KAAKQ,aAAa2uE,iBAAgB;AACpCnvE,WAAKQ,aAAa2uE;AAAAA,IACnB;AAAA,EACF;AAEDv6E,EAAAA,OAAMq6E,+BAA+B,SAAUjvE;AAC1C,QAACzU,QAAQ8jF;AACZ,QAAIC,UAAU;AACd,QAAIC,iBAAiBvvE,KAAK8tD,aAAa9tD,KAAK8tD,UAAUlgE,UAAU;AAChE,UAAM4hF,eAAe56E,OAAMuC,OAAO22D,UAAUttD;AAG5C,UAAMivE,eAAe76E,OAAM86E,cAAc,UAAA;AACzC,SAAKD,gBAAiB76E,CAAAA,OAAMuC,OAAOwqB,YAAW;AAC5C;AAAA,IACD;AAED,YAAQ/sB,OAAMuC,OAAO22D,UAAU6f,aAC7B;AAAA,MAAA,KAAK;AACH3tE,aAAKQ,aAAaR,KAAK2nC,aAAa;AACpC;AAAA,MAEF,KAAK;AACHp8C,iBAASkkF,aAAaE,aAAa3vE,KAAKlH;AACxC,YAAIy2E,gBAAgB;AAClBvvE,eAAK2nC,aAAa3nC,KAAK2nC,cAAcp8C;AAErC,cAAIyU,KAAK2nC,aAAap8C,QAAO;AAC3BA,qBAASyU,KAAK2nC;AAAAA,UACf;AAED3nC,eAAKQ,aAAajV,SAASikF;AAAAA,QACrC,WAAmBxvE,KAAK2nC,YAAY;AAC1B3nC,eAAKQ,aAAaR,KAAK2nC,aAAa;AAAA,QACrC;AAEDioC,mCAA2B5vE;AAC3B;AAAA,MAEF,KAAK;AACHzU,iBAASkkF,aAAaE,aAAa3vE,KAAKlH,EAExC;AAAA,YAAIy2E,gBAAgB;AAClBvvE,eAAK2nC,aAAa3nC,KAAK2nC,cAAcp8C;AAErC,cAAIyU,KAAK2nC,aAAap8C,QAAO;AAC3BA,qBAASyU,KAAK2nC;AAAAA,UACf;AAED0nC,yBAAeG,eAAeD;AAG9BvvE,eAAKQ,aAAajV,SAAS8jF,eAAeC;AAAAA,QACpD,WAAmBtvE,KAAK2nC,YAAW;AACzB3nC,eAAKQ,aAAaR,KAAK2nC,aAAa;AAAA,QACrC;AAEDioC,mCAA2B5vE;;EAEnC;AAEE,WAAS4vE,2BAA2B5vE,MAAAA;AAClCpL,IAAAA,OAAMonD,WAAW,SAAUrpD,QACzB;AAAA,UAAIm7E,cAAcn7E,MAAAA,GAAS;AACzB,cAAM27E,eAAe37E,OAAO6N,cAAc5L,OAAM86E,cAAc,UAAA,EAAYC,aAAah9E,OAAOmG,EAAAA;AAC9F,YAAIm1E,YAAYjuE,KAAKQ;AAGrB,cAAMqvE,WAAWj7E,OAAMgY,YAAYja,OAAOmG,EAC1C+2E;AAAAA,iBAAS70E,QAAQ,SAAU80E,WAAAA;AACzB,gBAAMC,UAAUn7E,OAAMmc,QAAQ++D;AAC9B,cAAIC,QAAQj3E,MAAMkH,KAAKlH,IAAI;AACzB;AAAA,UACD;AACD,gBAAMk3E,gBAAgBD,QAAQvvE,cAAc5L,OAAM86E,cAAc,UAAA,EAAYC,aAAaI,QAAQj3E,EACjGm1E;AAAAA,sBAAYA,aAAa+B;AACzB,cAAIA,gBAAgB/B,WAAW;AAC7BA,wBAAY+B;AAAAA,UACb;AAAA,QACX,CAAA;AAEQr9E,eAAO6N,aAAaytE;AACpBt7E,eAAOg1C,aAAah1C,OAAOg1C,cAAc2mC;AAAAA,MAC1C;AAAA,IACP,GAAOtuE,KAAKlH,EACT;AAAA,EAAA;AAEDlE,EAAAA,OAAMyE,YACJ,gBACA;AAEE,QAAIzE,CAAAA,OAAMuC,OAAO22D,WAAU;AACzB;AAAA,IACD;AAEDl5D,IAAAA,OAAMyE,YAAY,WAAW,WAC3B08D;AAAAA,oBAAcha,SAAS,SAAUjB,UAAAA;AAC/B,cAAM36B,SAAS26B,SAASprB;AACxB,YAAI96B,OAAM0d,aAAa6N,MAAS,GAAA;AAC9B,gBAAMngB,OAAOpL,OAAMmc,QAAQoP,MAAAA;AAE3BngB,eAAK8tD,YAAY9tD,KAAK8tD,aAAa;AAEnC,cAAImiB,cAAc;AAClB,mBAAStiF,IAAI,GAAGA,IAAIqS,KAAK8tD,UAAUlgE,QAAQD,KAAK;AAC9C,gBAAIuiF,mBAAmBlwE,KAAK8tD,UAAUngE,CAAAA;AACtC,gBAAIuiF,iBAAiBp3E,MAAMgiD,SAAShiD,IAAG;AACrCm3E,4BAAc;AACdr7E,cAAAA,OAAMyP,MAAM6rE,kBAAkBp1B,UAAU,IAAA;AACxC;AAAA,YACD;AAAA,UACF;AACD,cAAIm1B,aAAY;AACdjwE,iBAAK8tD,UAAUj9D,KAAKiqD,QAAAA;AAAAA,UACrB;AAED,cAAA,CAAIgK,WAAWlwD,MAAAA,GAAO;AACpB,gBAAIk5E,cAAc9tE,IAAM,GAAA;AACtBgvE,uCAA0BhvE,IAAAA;AAAAA,YAC1C,OAAqB;AACLpL,cAAAA,OAAMq6E,6BAA6BjvE,IACpC;AAAA,YAAA;AAAA,UACF;AAAA,QACF;AAAA,MACX,CAAA;AAAA,IACA,CAEMpL;AAAAA,IAAAA,OAAMyE,YAAY,sBAAsB,SAAUP,IAAIkH,MAAAA;AACpDyuE,qBAAezuE,IACf;AAAA,aAAO;AAAA,IACf,CAEMpL;AAAAA,IAAAA,OAAMyE,YAAY,eAAe,SAASsR,QAAAA;AACxC,YAAMwlE,yBAAyBv7E,OAAMuC,OAAO22D,UAAU6f,eAAe,iBAAiB/4E,OAAMuC,OAAO22D,UAAU6f,eAAe;AAC5H,UAAIwC,0BAA0BxlE,QAAO;AACnC,YAAIylE,UAAU;AACdzlE,eAAOqO,SAAShe,QAAQ,SAASqe,SAC/B;AAAA,cAAIA,QAAQ2hB,UAAU,QAAO;AAC3B,kBAAM7a,SAAS9G,QAAQzO,MAAM9R;AAC7B,gBAAIlE,OAAM0d,aAAa6N,MAAAA,GAAQ;AAC7B,oBAAMngB,OAAOpL,OAAMmc,QAAQoP,MAC3B;AAAA,kBAAIngB,KAAKrN,UAAUiC,OAAM0d,aAAatS,KAAKrN,MAAQ,GAAA;AACjD,sBAAMA,SAASiC,OAAMmc,QAAQ/Q,KAAKrN;AAClC,oBAAIm7E,cAAcn7E,SAAQ;AACxBq8E,2CAA0Br8E,MAC1By9E;AAAAA,4BAAU;AAAA,gBACX;AAAA,cACF;AAAA,YACF;AAAA,UACF;AAAA,QACb,CACU;AAAA,YAAIA,SAAQ;AACVx7E,UAAAA,OAAM2C,OACP;AAAA,QAAA;AAAA,MACF;AAAA,IACT,CAAA;AAEM3C,IAAAA,OAAMyE,YAAY,qBAAqB,SAAUP,IAAIkH;AACnD,UAAIytE,mBAAkB;AACpB,YAAIztE,KAAKrN,UAAUiC,OAAM0d,aAAatS,KAAKrN,SAAQ;AACjD,gBAAMA,SAASiC,OAAMmc,QAAQ/Q,KAAKrN,MAClC;AAAA,cAAIm7E,cAAcn7E,MAAAA,GAAQ;AACxBq8E,qCAA0Br8E;UAC3B;AAAA,QACF;AAAA,MACF;AACDu8E,6BACR;AAAA,IAAA,CAAA;AAEMt6E,IAAAA,OAAMk6E,mBAAmB,SAAU3uD,QACjC;AAAA,YAAM2tC,aAAY,CAAA;AAClBiI,oBAAcha,SAAS,SAAUjB,UAC/B;AAAA,YAAIA,SAASprB,WAAWvP,QAAQ;AAC9B2tC,UAAAA,WAAUj9D,KAAKiqD,QAAAA;AAAAA,QAChB;AAAA,MACX,CAAA;AACQ,aAAOgT;AAAAA,IACf;AACMl5D,IAAAA,OAAM+yB,MAAMouC,cAAc18D,YAAY,cAAc,WAAA;AAClDzE,MAAAA,OAAM6Q,SAAS,SAASzF,MAAAA;AACtB,YAAIA,KAAK8tD,WAAU;AACV9tD,iBAAAA,KAAK8tD;AAAAA,QACb;AAAA,MACX;AAIQ,aAAO;AAAA,IACf,CAEMl5D;AAAAA,IAAAA,OAAM+yB,MAAMC,WAAWvuB,YAAY,cAAc,WAAA;AAC/C08D,oBAAcnW,SACd;AAAA,aAAO;AAAA,IACf,CACMhrD;AAAAA,IAAAA,OAAMyE,YAAY,kBAAkB,SAAUP,IAAI22B;AAChD,YAAMq+B,aAAYiI,cAAcx6D,KAAK,SAAUnP,GAAAA;AAC7C,eAAOA,EAAEsjC,WAAW52B;AAAAA,MAC9B,CAAA;AACQg1D,MAAAA,WAAU9yD,QAAQ,SAAU5O,GAC1BA;AAAAA,UAAEsjC,UAAUD;AACZsmC,sBAAc1a,WAAWjvD,EAAE0M,EAAAA;AAAAA,MACrC,CACA;AAAA,IAAA,CAAA;AAAA,EACK,GACD,EAAEC,MAAM,KAEZ,CAAA;AAAA;AC7Te,SAAQs3E,UAACz7E,QAAAA;AACvB,OAAIA,OAAMoC,KAAI;AACbpC,IAAAA,OAAMoC,MAAM;EACZ;AAED,MAAIs5E,UAAU,CACbjqB,cACA4Z,KACAhL,WACAsQ,sBACAgL,gBACAnG,iBACA4B,YACAK,oBACAve;AAGD,WAAQngE,IAAI,GAAGA,IAAI2iF,QAAQ1iF,QAAQD,KAAI;AACtC,QAAG2iF,QAAQ3iF,CACV2iF,EAAAA,SAAQ3iF,GAAGiH,MACZ;AAAA,EAAA;AACF;AC/Be,SAAQ47E,gBAAC57E;AACvBA,EAAAA,OAAM67E,gBAAgB,SAASvhF,MAAAA;AAC9B,QAAIwV,UAAU9P,OAAMuC,OAAOuN;AAE3B,aAAS/W,IAAI,GAAGA,IAAI+W,QAAQ9W,QAAQD,KAAK;AACxC,UAAI+W,QAAQ/W,GAAGuB,QAAQA,KACtB,QAAOwV,QAAQ/W,CAAAA;AAAAA,IAChB;AAED,WAAO;AAAA,EACT;AAECiH,EAAAA,OAAMuqB,iBAAiB,WAAA;AACtB,WAAOvqB,OAAMuC,OAAOuN,QAAQjX,MAAAA;AAAAA,EAC9B;AACA;ACfe,SAAQyX,MAACtQ,QAAAA;AACvBA,EAAAA,OAAMqrB,aAAa,SAAUxkB,MAAAA;AAE5B,gBAAWA,QAAQ,YAAA,OAAmBA,QAAQ,aAAa7G,OAAM0d,aAAa7W,IAAM,GAAA;AACnFA,aAAO7G,OAAMmc,QAAQtV,IAAAA;AAAAA,IACrB;AACD,QAAIA,QAAQA,KAAK5J,KAAKsF,OAAOoxC,oBAAoB;AAChD,aAAO;AAAA,IACV,OAAS;AACN,aAAQ9sC,QAAQA,KAAK5J,KAAKsF,OAAOmxC,iBAAuBz2C,KAAAA,KAAKsF,OAAOiM;AAAAA,IACpE;AAAA,EACH;AACA;ACVe,SAAQstE,QAAC97E;AACvBA,EAAAA,OAAM0/C,OAAO,WACZ;AAAA,UAAM,IAAI/J,MAAM;EAClB;AACC31C,EAAAA,OAAM2U,QAAQ,SAAUjF,OAAMR,MAAAA;AAC7BjS,SAAK8+E,QAAQ,EAAC5mE,QAAQ,EAACP,cAAclF,WAAQR,IAC/C;AAAA,EAAA;AAEClP,EAAAA,OAAMsd,YAAY,SAAUpO,MAAAA;AAC3BA,WAAOA,QAAQ;AACf,WAAOjS,KAAKiS,IAAAA,EAAMoO;EACpB;AAgCCtd,EAAAA,OAAM+7E,UAAU,SAAUC,MAAM9sE,MAAAA;AAC/B,QAAG8sE,KAAK7mE,UAAU6mE,KAAK7mE,OAAOZ,WAAW,KAAI;AAC5CtX,WAAKotC,OAAO,OAAO,2CAA2C2xC,KAAK7mE,OAAO8mE,cAAc,uBACrFD,KAAK7mE,OAAO8mE,cAAc,0BAAA;AAC7B;AAAA,IACA;AACD,QAAGj8E,OAAMmvB,YAAW;AACnB;AAAA,IACA;AACDlyB,SAAK+H,UAAU,iBAAiB,CAChC,CAAA;AAAA,QAAA,CAAKkK,KACJA,QAAO;AACRjS,SAAKotC,OAAOptC,KAAKiS,IAAAA,GAAO,wBAAwBA,OAAO,GAAA;AAEvD,QAAIa,MAAMisE,KAAK7mE,OAAOP;AAEtB,QAAIlF,QAAOzS,KAAKiS,IAAMyF,EAAAA,MAAM5E,KAAKisE,IACjC/+E;AAAAA,SAAKi/E,iBAAiBxsE,KACxB;AAAA,EAAA;AAEC,WAASysE,yBAAyB7rE,QAAOw8D,aACxC;AAAA,UAAMsP,qBAAqB,CAAA;AAC3BtP,gBAAY1mE,QAAS5O,OACpB;AAAA,UAAA,CAAI4kF,mBAAmB5kF,EAAEsjC,UAAU;AAClCshD,2BAAmB5kF,EAAEsjC,OAAAA,IAAW,CAChC;AAAA,MAAA;AACDshD,yBAAmB5kF,EAAEsjC,OAAAA,EAAS7+B,KAAKzE,CAAE;AAAA,IAAA,CAAA;AAEtC8Y,IAAAA,OAAMlK,QAAS+P,CAAAA,OAAAA;AACdA,MAAAA,GAAEnW,OAAMuC,OAAOoqE,iBAAAA,IAAqByP,mBAAmBjmE,GAAEjS,EAAAA,KAAO,CAAE;AAAA,IAAA,CAAA;AAAA,EAEnE;AAEDlE,EAAAA,OAAMk8E,mBAAmB,SAAUxsE,OAAAA;AAClC,QAAGA,MAAK2sE,YACPp/E,MAAKq/E,kBAAkB5sE,MAAK2sE,WAAAA;AAE7B,QAAG3sE,MAAK2wD,aAAapjE,KAAK81B,MAAM+tC,gBAAe;AAC9C7jE,WAAK81B,MAAM+tC,eAAensD,MAAMjF,MAAK2wD,SAAAA;AAAAA,IACrC;AACD,QAAGrgE,OAAMuC,OAAO22D,aAAaxpD,MAAKwpD,aAAaj8D,KAAK81B,MAAMouC,eAAc;AACvElkE,WAAK81B,MAAMouC,cAAcxsD,MAAMjF,MAAKwpD,SAAAA;AAAAA,IACpC;AAED,UAAM5oD,SAAQZ,MAAKA,QAAQA,MAAKY;AAChC,QAAGZ,MAAKo9D,aAAY;AACnBqP,+BAAyB7rE,QAAOZ,MAAKo9D,WACrC;AAAA,IAAA;AAED7vE,SAAK81B,MAAMC,WAAWre,MAAMrE;AAC5B,QAAIsK,QAAQlL,MAAKkL,UAAWlL,MAAK2sE,eAAe3sE,MAAK2sE,YAAYzhE,QAASlL,MAAK2sE,YAAYzhE,QAAQ;AACnG3d,SAAK81B,MAAMq1B,WAAWzzC,MAAMiG,KAG5B3d;AAAAA,SAAK+H,UAAU,WAAW,CAAA,CAAA;AAC1B/H,SAAK0F,OAAAA;AAAAA,EACP;AAEC3C,EAAAA,OAAMs8E,oBAAoB,SAAUD,aAAAA;AACnC,QAAIE,qBAAqB;AACzB,aAASjmE,OAAO+lE,aAAa;AAC5B,UAAIA,YAAYj8C,eAAe9pB,GAAM,GAAA;AACpCimE,6BAAqB;AACrB,YAAIC,aAAaH,YAAY/lE,GAAAA;AAE7BrZ,aAAKw/E,WAAWnmE,GAAOrZ,IAAAA,KAAKw/E,WAAWnmE,GAAQ,KAAA,CAAA;AAC/C,YAAIjQ,MAAMpJ,KAAKw/E,WAAWnmE,GAC1B;AAAA,YAAA,CAAKjQ,IAAK;AACVA,YAAI/M,OAAO,GAAG+M,IAAIrN,MAAAA;AAClB,iBAASojB,IAAI,GAAGA,IAAIogE,WAAWxjF,QAAQojB,KAAK;AAC3C,cAAIsgE,SAASF,WAAWpgE,CACxB;AAAA,cAAIpgB,MAAMiB,KAAKqE,KAAKo7E;AACpB1gF,cAAIsa,MAAMta,IAAIga;AAEd,mBAAS2mE,cAAcD,QAAQ;AAC9B,gBAAIA,OAAOt8C,eAAeu8C,aAAa;AACtC,kBAAIA,cAAc,WAAWA,cAAc,QAC1C;AACD3gF,kBAAI2gF,UAAAA,IAAcD,OAAOC,UACzB;AAAA,YAAA;AAAA,UACD;AACDt2E,cAAIpK,KAAKD,GACT;AAAA,QAAA;AAAA,MACD;AAAA,IACD;AACD,QAAIugF,mBACHt/E,MAAK+H,UAAU,iBAAiB,CACnC,CAAA;AAAA,EAAA;AAEChF,EAAAA,OAAMyE,YAAY,uBAAuB,SAAUP,IAAIkH,MACtD;AAAA,WAAA,CAAQA,KAAKwxE;AAAAA,EACf,CAAA;AAEC,WAASC,eAAentE,OAAAA;AACvB1P,IAAAA,OAAMqqC,OAAO,OAAO,mGACWr2B,KAAKC,UAAUvE;AAC9C,UAAM,IAAIimC,MAAM,sMACb3hC,KAAKC,UAAUvE;EAClB;AAED1P,EAAAA,OAAMoY,OAAO,EACZzD,OAAO,SAAUjF;AAChB,QAAIA,CAAAA,OAAK;AACRmtE,qBAAentE,KAAAA;AAAAA,IACf;AAED,QAAWA,OAAAA,SAAQ,UAAU;AAC5B,UAAWsE,OAAAA,QAAQ1W,QAAU;AAC5B,YAAA;AACCoS,UAAAA,QAAOsE,KAAKW,MAAMjF,KAAAA;AAAAA,QAClB,SACKvT,GAAAA;AACL0gF,yBAAentE,KAAAA;AAAAA,QACf;AAAA,MACN,OAAW;AACN1P,QAAAA,OAAMqqC,OAAO,OAAO,uBACpB;AAAA,MAAA;AAAA,IACD;AAED,QAAI36B,CAAAA,MAAKA,QAASA,CAAAA,MAAKY,OAAM;AAC5BusE,qBAAentE,KACf;AAAA,IAAA;AAED,QAAIA,MAAKotE,aACR98E,CAAAA,OAAM4kE,eAAel1D,MAAKotE;AAC3B,WAAOptE;AAAAA,EACP,GACDqtE,eAAe,SAAU3xE,MAAAA;AACxB,WAAOnO,KAAKob,YAAYjN;EACxB,GACD4xE,eAAe,SAAUv/D,MAAAA;AACxB,WAAOxgB,KAAKggF,UAAUx/D,IACtB;AAAA,EAAA,GACDw/D,WAAW,SAAUjhF,KACpB;AAAA,QAAIsF,QAAO,CAAA;AACX,aAASgV,OAAOta,IACfsF,CAAAA,MAAKgV,GAAOta,IAAAA,IAAIsa;AACjB,WAAOhV;AAAAA,EACP,GACD+W,aAAa,SAAUrc,KACtB;AAAA,QAAIsF,QAAO,CAAA;AACX,aAASgV,OAAOta,KAAK;AACpB,UAAIsa,IAAI9Y,OAAO,CAAM,KAAA,IACpB;AACD8D,MAAAA,MAAKgV,OAAOta,IAAIsa,GAAAA;AAEhB,UAAI4pB,OAAe5+B,MAAKgV,OAAO;AAC9BhV,QAAAA,MAAKgV,GAAOtW,IAAAA,OAAMugC,QAAQvgC,OAAMmS,UAAUC,UAAcpS,IAAAA,OAAMmS,UAAUC,WAAW9Q,MAAKgV,GAAAA,CAAAA,IAAQtW,OAAMmS,UAAUG,YAAYhR,MAAKgV,GAAAA,CAAAA;AAAAA,MACjI;AAAA,IACD;AACD,WAAOhV;AAAAA,EACP,GACDgc,WAAW,WACV;AAAA,QAAIhN,SAAQ,CACZ;AAAA,QAAIsK,QAAQ,CAAA;AACZ,QAAIs+C,aAAY;AAEhBl5D,IAAAA,OAAM6Q,SAAS,SAAU7U,KACxBgE;AAAAA,MAAAA,OAAMy6D,kBAAkBz+D,GACxBsU;AAAAA,MAAAA,OAAMrU,KAAKgB,KAAK8/E,cAAc/gF,GAAAA,CAAAA;AAAAA,IAC9B,GAAEgE,OAAMuC,OAAOuV,SAAS7a,IAEzB;AAAA,QAAIigF,WAAWl9E,OAAMqnC,SAAAA;AACrB,aAAStuC,IAAI,GAAGA,IAAImkF,SAASlkF,QAAQD,KAAK;AACzC6hB,YAAM3e,KAAKgB,KAAK+/E,cAAcE,SAASnkF,CACvC,CAAA,CAAA;AAAA,IAAA;AAED,UAAMooE,gBAAgBnhE,OAAMsoC,aAAa,WAAA;AACzC64B,kBAAcha,SAAS,SAASjB;AAC/B,YAAMi3B,eAAen9E,OAAMoY,KAAK2kE,cAAc72B,QAAAA;AAC9CgT,MAAAA,WAAUj9D,KAAKkhF,YAAAA;AAAAA,IACnB,CAEG;AAAA,WAAO,EACNztE,MAAMY,QACNsK,OACAs+C,WAAAA,WAAAA;AAAAA,EAED,EAkBF;AAAA,WAASkkB,cAAc1tE,OAAAA;AACtB1P,IAAAA,OAAMqqC,OAAO,OAAO,mGACWr2B,KAAKC,UAAUvE,KAC9C,CAAA;AAAA,UAAM,IAAIimC,MAAM,8LACb3hC,KAAKC,UAAUvE,KAClB,CAAA;AAAA,EAAA;AAED1P,EAAAA,OAAMq2C,MAAM,EACXipB,gBAAgB,SAAUzoE,MAAMwmF,YAAAA;AAC/B,QAAIlnE,KAAI,CAAA;AACR,aAASpd,IAAI,GAAGA,IAAIlC,KAAKymF,WAAWtkF,QAAQD,IAC3Cod,CAAAA,GAAEtf,KAAKymF,WAAWvkF,CAAAA,EAAGuB,QAAQzD,KAAKymF,WAAWvkF,GAAGid;AAEjD,QAAA,CAAKqnE,YAAY;AAChB,eAAStkF,IAAI,GAAGA,IAAIlC,KAAKgF,WAAW7C,QAAQD,KAAK;AAChD,YAAIwC,QAAQ1E,KAAKgF,WAAW9C,CAC5B;AAAA,YAAIwC,MAAMoD,YAAY,EACrBwX,CAAAA,GAAE5a,MAAMc,OAAWd,IAAAA,MAAMC,aAAaD,MAAMC,WAAW8sE,YAAY;AAAA,MACpE;AAED,UAAA,CAAKnyD,GAAEmC,KAAMnC,CAAAA,GAAEmC,OAAOzhB,KAAK2E,aAAa3E,KAAK2E,WAAW8sE,YAAY;AAAA,IACpE;AAED,WAAOnyD;AAAAA,EACP,GACDonE,iBAAiB,SAAUtoE,QAC1B;AAAA,QAAIunE,aAAa,CAAA;AACjB,QAAIgB,OAAOx9E,OAAMyT,KAAK+iC,MAAM,kBAAkBvhC,MAC9C;AAAA,aAASlc,IAAI,GAAGA,IAAIykF,KAAKxkF,QAAQD,KAAK;AACrC,UAAI6L,QAAO44E,KAAKzkF,CAAG1B,EAAAA,aAAa;AAChC,UAAIgP,MAAMm2E,WAAW53E,KAAAA,IAAQ,CAC7B;AAAA,UAAI64E,OAAOz9E,OAAMyT,KAAK+iC,MAAM,WAAWgnC,KAAKzkF,CAAAA,CAAAA;AAC5C,eAASqjB,IAAI,GAAGA,IAAIqhE,KAAKzkF,QAAQojB,KAAK;AACrC,YAAIshE,MAAMD,KAAKrhE,CAAAA;AACf,YAAIuhE,QAAQD,IAAIJ;AAChB,YAAIthF,MAAM,EAACsa,KAAKmnE,KAAKrhE,CAAG/kB,EAAAA,aAAa,OAAU8b,GAAAA,OAAOsqE,KAAKrhE,CAAG/kB,EAAAA,aAAa;AAC3E,iBAASumF,IAAI,GAAGA,IAAID,MAAM3kF,QAAQ4kF,KAAK;AACtC,cAAIC,OAAOF,MAAMC,CACjB;AAAA,cAAIC,KAAKnmF,YAAY,WAAWmmF,KAAKnmF,YAAY,QAChD;AACDsE,cAAI6hF,KAAKnmF,YAAYmmF,KAAKvV;AAAAA,QAC1B;AACDjiE,YAAIpK,KAAKD;MACT;AAAA,IACD;AACD,WAAOwgF;AAAAA,EACP,GACDsB,SAAS,SAAUxlE,MAAMrD,QAAQ8oE,QAChCA;AAAAA,aAASA,UAAU;AACnB,SAAK9oE,OAAO+oE,eAAe;AAC1B/oE,eAASjV,OAAMyT,KAAKkB,MAAMM,MAC1B;AAAA,IAAA;AAED,QAAIohC,MAAMr2C,OAAMyT,KAAK0iC,OAAO4nC,QAAQ9oE,OAAOE,MAAAA;AAC3C,QAAKkhC,CAAAA,OAAOA,IAAIh6C,WAAW0hF,QAAQ;AAClCX,oBAAc9kE,IACd;AAAA,IAAA;AAED,QAAI2lE,OAAO5nC,IAAIh/C,aAAa,cAAA;AAC5B,QAAI4mF,KACHj+E,CAAAA,OAAM4kE,eAAeqZ;AAEtB,WAAO5nC;AAAAA,EACP,GACD1hC,OAAO,SAAU2D,MAAMrD,QACtBA;AAAAA,aAAShY,KAAK6gF,QAAQxlE,MAAMrD,MAC5B;AAAA,QAAIvF,QAAO,CAAA;AAEX,QAAIwuE,MAAMxuE,MAAKA,OAAO,CAAA;AACtB,QAAI2mC,MAAMr2C,OAAMyT,KAAK+iC,MAAM,UAAUvhC,MAErC;AAAA,aAASlc,IAAI,GAAGA,IAAIs9C,IAAIr9C,QAAQD,IAC/BmlF,KAAInlF,CAAKkE,IAAAA,KAAKqiE,eAAejpB,IAAIt9C,CAElC2W,CAAAA;AAAAA,IAAAA,MAAK2sE,cAAcp/E,KAAKsgF,gBAAgBtoE,MACxC;AAAA,WAAOvF;AAAAA,EACP,GACDutE,WAAW,SAAUjhF,KAAAA;AACpB,WAAO,eAAeA,IAAIkI,KAAK,eAAelI,IAAI2hB,SAAS,eAAe3hB,IAAIO,SAAS,aAAaP,IAAIkT,OAAO;AAAA,EAC/G,GACDmJ,aAAa,SAAUrc,KACtB;AAAA,WAAO,eAAeA,IAAIkI,KAAK,gBAAgBlI,IAAI+B,UAAU,MAAM,mBAAmB/B,IAAIoT,aAAa,iBAAiBpT,IAAIo9D,WAAW,aAAgBp9D,CAAAA,CAAAA,IAAI6Y,OAAQ,iBAAiB7Y,IAAI80C,WAAW,iBAAiB90C,IAAIqT,WAAW,gBAAgBrT,IAAIsc,OAAO;AAAA,EAC9P,GACDgF,WAAW,WAAA;AACV,QAAIhN,SAAQ;AACZ,QAAIsK,QAAQ;AAEZ,QAAIxC,OAAOpY,OAAMoY,KAAKkF,UAAAA;AACtB,aAASvkB,IAAI,GAAG+C,MAAMsc,KAAK1I,KAAK1W,QAAQD,IAAI+C,KAAK/C,KAAK;AACrDuX,MAAAA,OAAMrU,KAAKgB,KAAKob,YAAYD,KAAK1I,KAAK3W,CACtC,CAAA,CAAA;AAAA,IAAA;AACD,aAASA,IAAI,GAAG+C,MAAMsc,KAAKwC,MAAM5hB,QAAQD,IAAI+C,KAAK/C,KAAK;AACtD6hB,YAAM3e,KAAKgB,KAAKggF,UAAU7kE,KAAKwC,MAAM7hB,CACrC,CAAA,CAAA;AAAA,IAAA;AACD,WAAO,WAAWuX,OAAM7X,KAAK,MAAM,+BAA+BmiB,MAAMniB,KAAK,EAAM,IAAA;AAAA,EACnF;AAIFuH,EAAAA,OAAMm+E,SAAS,EACdxpE,OAAO,SAAU2D,MAAMrD;AACtBA,aAASjV,OAAMq2C,IAAIynC,QAAQxlE,MAAMrD,QAAQ;AACzC,QAAIvF,QAAO,EAAC2sE,aAAa,EAACzhE,OAAO;AAEjC,QAAIsjE,MAAMxuE,MAAKA,OAAO,CAAA;AACtB,QAAI2mC,MAAMr2C,OAAMyT,KAAK+iC,MAAM,UAAUvhC,MAAAA;AAErC,aAASlc,IAAI,GAAGA,IAAIs9C,IAAIr9C,QAAQD,KAAK;AACpCmlF,UAAInlF,CAAKiH,IAAAA,OAAMq2C,IAAIipB,eAAejpB,IAAIt9C,CACtC,CAAA;AAAA,UAAIgF,SAASs4C,IAAIt9C,CAAAA,EAAGvD;AAEpB,UAAIuI,OAAO1B,WAAW,UACrB6hF,KAAInlF,CAAAA,EAAGgF,SAAS,aAAaA,OAAO1G,aAAa,IAEjD6mF;AAAAA,UAAAA,KAAInlF,GAAGgF,SAASA,OAAOvI,WAAW6B,aAAa,IAChD;AAAA,IAAA;AAEDg/C,UAAMr2C,OAAMyT,KAAK+iC,MAAM,aAAavhC,MAAAA;AACpC,aAASlc,IAAI,GAAGA,IAAIs9C,IAAIr9C,QAAQD,KAAK;AACpC,UAAI2E,KAAKsC,OAAMq2C,IAAIipB,eAAejpB,IAAIt9C,CAAI,GAAA,IAAA;AAC1C2E,SAAGwG,KAAK,aAAaxG,GAAGwG;AACxBg6E,UAAIjiF,KAAKyB;IACT;AAED,aAAS3E,IAAI,GAAGA,IAAImlF,IAAIllF,QAAQD,KAAK;AACpC,UAAI2E,KAAKwgF,IAAInlF,CAAAA;AACb2E,SAAG0R,aAAa1R,GAAG0gF,aAAa1gF,GAAG2gF;AACnC3gF,SAAG2R,WAAW3R,GAAG4gF;AACjB5gF,SAAG4a,OAAO5a,GAAGpD;AACboD,SAAG07D,WAAW17D,GAAG07D,WAAW;AAC5B17D,SAAGmX,OAAO;AACV,WAAKnX,GAAG07D,YAAAA,CAAa17D,GAAG2R,SAAU3R,IAAG07D,WAAW;AAChD,UAAI17D,GAAG6gF,iBACN7uE,CAAAA,MAAK2sE,YAAYzhE,MAAM3e,KAAK,EAC3BM,QAAQmB,GAAGwG,IACXyZ,QAAQjgB,GAAG6gF,kBACXrvE,MAAMlP,OAAMuC,OAAOqY,MAAMi0B,gBAAAA,CAAAA;AAAAA,IAE3B;AAED,WAAOn/B;AAAAA,EACP,GACD4N,WAAW,WAAA;AACVtd,IAAAA,OAAMw+E,QAAQ,+CAAA;AAAA,EACd,EAGFx+E;AAAAA,EAAAA,OAAMy8E,aAAa,SAAUniF,MAAM+N,OAClC;AAAA,QAAIA,OAAO;AACVpL,WAAKw/E,WAAWniF,IAAQ+N,IAAAA,MAAMxP,MAAM,CAAA;AAAA,IACpC,WAAM,CAAKoE,KAAKw/E,WAAWniF,IAAAA,GAAO;AAClC2C,WAAKw/E,WAAWniF,IAAAA,IAAQ;IACxB;AACD,WAAO2C,KAAKw/E,WAAWniF,IACzB;AAAA,EAAA;AAEA;ACzYA,SAASmkF,mBAAmBnvE,OAAMnJ,MAAMiF,MAAMlH,IAAIw6E,UACjDzhF;AAAAA,OAAKqS,OAAOA;AACZrS,OAAKkJ,OAAOA;AACZlJ,OAAKmO,OAAOA;AACZnO,OAAKiH,KAAKA;AACVjH,OAAKyhF,WAAWA;AAChB,SAAOzhF;AACR;AAEA,SAAS0hF,wBAAwBrvE,OAAM2Z,KAAK9iB,MAAMiF,MAAMlH,IAAIw6E;AAC3DzhF,OAAKqS,OAAOA;AACZrS,OAAKgsB,MAAMA;AACXhsB,OAAKkJ,OAAOA;AACZlJ,OAAKmO,OAAOA;AACZnO,OAAKiH,KAAKA;AACVjH,OAAKyhF,WAAWA;AAChB,SAAOzhF;AACR;AAEA,SAAS2hF,yBAAyBxvE,YAAYgqD,UAAUjzD,MAAMuW,MAAMtR,MAAMlH,IAAIw6E,UAC7EzhF;AAAAA,OAAKmS,aAAaA;AAClBnS,OAAKm8D,WAAWA;AAChBn8D,OAAKkJ,OAAOA;AACZlJ,OAAKyf,OAAOA;AACZzf,OAAKmO,OAAOA;AACZnO,OAAKiH,KAAKA;AACVjH,OAAKyhF,WAAWA;AAChB,SAAOzhF;AACR;AAEA,SAAS4hF,oBAAoB/1E,OAAOC,KAAKqC,MAAMszE;AAC9CzhF,OAAKmS,aAAatG;AAClB7L,OAAKoS,WAAWtG;AAChB9L,OAAKmO,OAAOA;AACZnO,OAAKyhF,WAAWA;AAChBzhF,OAAKkJ,OAAO;AACZlJ,OAAKyf,OAAO;AACZ,SAAOzf;AACR;AAEA,IAAI6hF,0BAA0B,SAAS9+E,QACtC;AAAA,SAAO,EACN++E,uBAAuB,WAAA;AACtB,QAAIx8E,UAASsB,UAAU;AACvB,QAAIq8B,OAAe39B,OAAS,GAAA;AAC3BA,MAAAA,UAAS,EACR+M,MAAM/M,QAEX;AAAA,IAAA,OAAU;AACNA,MAAAA,UAASihD,MAAY,IAAIjhD,OAAAA;AAAAA,IACzB;AAED,QAAA,CAAIy8E,YAAoBz8E,QAAO+M,OAAM;AACpCtP,MAAAA,OAAMqqC,OAAO,OAAO,+CACpB;AAAA,YAAM,IAAIsL,MAAM,+CAAA;AAAA,IAChB;AAED,WAAOpzC;AAAAA,EACP,GACD08E,sBAAsB,WACrB;AAAA,WAAOp7E,UAAU,CACjB;AAAA,EAAA,GACDq7E,wBAAwB,WACvB;AAAA,WAAOr7E,UAAU,CAAA;AAAA,EACjB,GACDs7E,qBAAqB;AACpB,QAAI58E,UAASsB,UAAU,CACvB;AAAA,QAAGtB,mBAAkBk8E,oBAAmB;AACvC,aAAOl8E;AAAAA,IACP;AAED,QAAI68E;AACJ,QAAK78E,CAAAA,QAAO+M,MAAM;AAEjB8vE,wBAAkB,IAAIX,mBAAmB56E,UAAU,CAAIA,GAAAA,UAAU,CAAIA,GAAAA,UAAU,IAAI,MAAMA,UAAU,CACvG,CAAA;AAAA,IAAA,OAAU;AACNu7E,wBAAkB,IAAIX,mBAAmBl8E,QAAO+M,MAAM/M,QAAO4D,MAAM5D,QAAO6I,MAAM,MAAM7I,QAAOm8E;IAC7F;AAEDU,oBAAgBj5E,OAAOi5E,gBAAgBj5E,QAAQnG,OAAMuC,OAAO4sC;AAE5D,QAAA,CAAI6vC,YAAoBI,gBAAgB9vE,IAAAA,GAAM;AAC7CtP,MAAAA,OAAMqqC,OAAO,OAAO;AACpB,YAAM,IAAIsL,MAAM,6CAAA;AAAA,IAChB;AAED,WAAOypC;AAAAA,EACP,GACDC,6BAA6B,SAAUC,KACtC;AAAA,QAAI/8E,UAASsB,UAAU,CAAA;AACvB,QAAItB,mBAAkBo8E,wBACrB,QAAOp8E;AAER,QAAI68E;AACJ,QAAIl/C,OAAe39B,OAAS,GAAA;AAC3B68E,wBAAkB,IAAIT,wBAAwBp8E,OAElD;AAAA,IAAA,OAAU;AACN68E,wBAAkB,IAAIT,wBACrBp8E,QAAO+M,MACP/M,QAAO0mB,KACP1mB,QAAO4D,MACP5D,QAAO6I,MACP,MACA7I,QAAOm8E,QAAAA;AAAAA,IAER;AAED,QAAGn8E,QAAO2B,IAAG;AACZk7E,sBAAgBh0E,OAAO7I;AAAAA,IACvB;AACD68E,oBAAgBn2D,MAAM1mB,QAAO0mB,OAAO;AACpCm2D,oBAAgBj5E,OAAO5D,QAAO4D,QAAQnG,OAAMuC,OAAO4sC;AAEnD,QAAA,CAAI6vC,YAAoBI,gBAAgB9vE,IAAM,GAAA;AAC7CtP,MAAAA,OAAMqqC,OAAO,OAAO,qDACpB;AAAA,YAAM,IAAIsL,MAAM;IAChB;AACD,WAAOypC;AAAAA,EACP,GAEDG,oBAAoB,SAAUC;AAC7B,QAAIC,eAAeZ;AACnB,QAAIt8E;AACJ,QAAIi9E,iBAAiBC,aACpB,QAAOD;AAER,QAAIt/C,OAAes/C,QAAQ;AAC1Bj9E,MAAAA,UAAS,IAAIk9E,aAAa57E,UAAU,CAAA,GAAIA,UAAU,CAAIA,GAAAA,UAAU,CAAIA,GAAAA,UAAU,CAClF,CAAA;AAAA,IAAA,OAAU;AACNtB,MAAAA,UAAS,IAAIk9E,aAAaD,MAAMpwE,YAAYowE,MAAMnwE,UAAUmwE,MAAMp0E,IAClE;AAAA,UAAIo0E,MAAMt7E,OAAO,QAAQs7E,MAAMt7E,OAAO5G,QAAW;AAChDiF,QAAAA,QAAO6I,OAAOo0E;AAAAA,MACd;AAAA,IACD;AAEDj9E,IAAAA,QAAO4D,OAAO5D,QAAO4D,QAAQnG,OAAMuC,OAAO4sC;AAC1C5sC,IAAAA,QAAOma,OAAOna,QAAOma,QAAQ1c,OAAMuC,OAAOgvC;AAC1ChvC,IAAAA,QAAO6M,aAAa7M,QAAO6M,cAAc7M,QAAOuG,SAASvG,QAAO+M;AAEhE,QAAA,CAAI0vE,YAAoBz8E,QAAO6M,UAAAA,GAAY;AAC1CpP,MAAAA,OAAMqqC,OAAO,OAAO;AACpB,YAAM,IAAIsL,MAAM,oDAChB;AAAA,IAAA;AAED,SAAIqpC,YAAoBz8E,QAAO8M,QAAU,GAAA;AACxCrP,MAAAA,OAAMqqC,OAAO,OAAO,kDACpB;AAAA,YAAM,IAAIsL,MAAM,kDAChB;AAAA,IAAA;AAED,WAAOpzC;AAAAA,EACP,GAEDm9E,sBAAsB,SAAU52E,OAAOC,KAAK5C,MAAMuW,MACjD;AAAA,WAAOzf,KAAKsiF,mBAAmBriF,MAAMD,MAAM4G,SAC3C;AAAA,EAAA,GAED87E,sBAAsB,SAAU72E,OAAOC,KAAK5C,MAAMuW,MACjD;AAAA,WAAOzf,KAAKsiF,mBAAmBriF,MAAMD,MAAM4G;EAC3C,GAED+7E,2BAA2B,SAAU92E,OAAOswD,UAAUjzD,MAAMuW;AAC3D,QAAIna,UAASsB,UAAU,CACvB;AAAA,QAAItB,mBAAkBq8E,yBACrB,QAAOr8E;AAER,QAAI68E;AAEJ,QAAIl/C,OAAe39B,OAAS,GAAA;AAC3B68E,wBAAkB,IAAIR,yBACrB/6E,UAAU,IACVA,UAAU,CAAA,GACVA,UAAU,CAAA,GACVvG,QACAuG,UAAU,IACVvG,QACAuG,UAAU;IAGf,OAAU;AACNu7E,wBAAkB,IAAIR,yBACrBr8E,QAAO6M,YACP7M,QAAO62D,UACP72D,QAAO4D,MACP5D,QAAOma,MACPna,QAAO6I,MACP,MACA7I,QAAOm8E,QAAAA;AAAAA,IAER;AACD,QAAGn8E,QAAO2B,OAAO,QAAQ3B,QAAO2B,OAAO5G,QAAU;AAChD8hF,sBAAgBh0E,OAAO7I;AAIvB68E,sBAAgBj5E,OAAO;AACvBi5E,sBAAgB1iE,OAAO;AAAA,IACvB;AAED0iE,oBAAgBj5E,OAAOi5E,gBAAgBj5E,QAAQnG,OAAMuC,OAAO4sC;AAC5DiwC,oBAAgB1iE,OAAO0iE,gBAAgB1iE,QAAQ1c,OAAMuC,OAAOgvC;AAE5D,QAAA,CAAIytC,YAAoBI,gBAAgBhwE,UAAAA,GAAY;AACnDpP,MAAAA,OAAMqqC,OAAO,OAAO,yDAAA;AACpB,YAAM,IAAIsL,MAAM,yDAChB;AAAA,IAAA;AAED,WAAOypC;AAAAA,EACP,EAAA;AAEH;ACrNA,SAASS,yBAAAA;AACT;AAEAA,uBAAuBjnF,YAAY,EAOlCknF,eAAe,SAASC,YAAAA;AACvB,MAAI9+E,SAAS,CAAA;AACb,WAAQlI,IAAI,GAAGA,IAAIgnF,WAAW/mF,QAAQD,KAAK,GAAE;AAE5CkI,WAAOhF,KAAK,EACX6M,OAAOi3E,WAAWhnF,CAClBgQ,GAAAA,KAAKg3E,WAAWhnF,IAAE,CAEnB,EAAA,CAAA;AAAA,EAAA;AACD,SAAOkI;AACP,GAOD++E,eAAe,SAASC,gBAAAA;AACvB,MAAIh/E,SAAS,CAAA;AAEb,WAASi/E,QAAQlqE,OAChB;AAAA,QAAInZ,MAAME,OAAOiZ,KAAAA;AACjB,QAAGnZ,IAAI7D,SAAS,GAAE;AACjB6D,YAAM,MAAMA;AAAAA,IACZ;AACD,WAAOA;AAAAA,EACP;AACD,WAASsjF,WAAWC,cACnB;AAAA,QAAIjpE,QAAQ5gB,KAAKkS,MAAM23E,gBAAgB,KAAG,GAC1C;AAAA,QAAIC,aAAaD,eAAejpE,QAAQ,KAAK;AAE7C,QAAIL,UAAUvgB,KAAKkS,MAAM43E,aAAc,EACvC;AAAA,WAAOlpE,QAAQ,MAAM+oE,QAAQppE,OAC7B;AAAA,EAAA;AACD,WAAQ/d,IAAI,GAAGA,IAAIknF,eAAejnF,QAAQD,KAAI;AAC7CkI,WAAOhF,KACNkkF,WAAWF,eAAelnF,CAAG+P,EAAAA,KAAAA,IAC7B,MACAq3E,WAAWF,eAAelnF,CAAGgQ,EAAAA,GAAAA,CAAAA;AAAAA,EAE9B;AACD,SAAO9H;AACP,GAUDq/E,sBAAsB,SAAS7zC,OAAO/mC;AACrC,MAAIzE,SAAS;AAEb,MAAIs/E,YAAY9zC,MAAMzzC,SAAS0M,OAAO1M,SAASyzC,QAAQ/mC;AACvD,MAAI86E,iBAAiB/zC,UAAU8zC,YAAY76E,SAAQ+mC;AACnD8zC,cAAYA,UAAU1nF,MACtB2nF;AAAAA,mBAAiBA,eAAe3nF,MAAAA;AAEhC,MAAIoI,SAAS,CAAA;AACb,WAAQlI,IAAI,GAAGA,IAAIwnF,UAAUvnF,QAAQD,KAAI;AACxC,QAAI4a,QAAO4sE,UAAUxnF,CAAAA;AAErB,aAAQqjB,IAAI,GAAGA,IAAIokE,eAAexnF,QAAQojB,KAAI;AAC7C,UAAIqkE,UAAUD,eAAepkE,CAAAA;AAC7B,UAAGqkE,QAAQ33E,QAAQ6K,MAAK5K,OAAO03E,QAAQ13E,MAAM4K,MAAK7K,OAAM;AACvD7H,eAAOhF,KAAK,EACX6M,OAAOvS,KAAKuD,IAAI6Z,MAAK7K,OAAO23E,QAAQ33E,KAAAA,GACpCC,KAAKxS,KAAKyS,IAAI2K,MAAK5K,KAAK03E,QAAQ13E,GAAAA,EAAAA,CAAAA;AAEjC,YAAG4K,MAAK5K,MAAM03E,QAAQ13E,KAAI;AACzBy3E,yBAAelnF,OAAO8iB,GAAG,CAAA;AACzBA;AACArjB;AAAAA,QACA;AAAA,MACD;AAAA,IACD;AAAA,EACD;AACD,SAAOkI;AACP,GASDy/E,yBAAyB,SAASl7D,OACjC;AAAA,MAAIvkB,SAASukB,MAAM3sB,MAAAA;AACnBoI,SAAO/H,KAAK,SAAS1B,GAAG2B,GACvB;AAAA,WAAO3B,EAAEsR,QAAQ3P,EAAE2P;AAAAA,EACtB;AACE,MAAI6K,QAAO1S,OAAO,CAAA;AAClB,WAAQlI,IAAI,GAAGA,IAAIkI,OAAOjI,QAAQD,KAAI;AACrC,QAAI0nF,UAAUx/E,OAAOlI;AACrB,QAAG0nF,QAAQ33E,SAAS6K,MAAK5K,KAAI;AAC5B,UAAG03E,QAAQ13E,MAAM4K,MAAK5K,KAAI;AACzB4K,QAAAA,MAAK5K,MAAM03E,QAAQ13E;AAAAA,MACnB;AACD9H,aAAO3H,OAAOP,GAAG,CACjBA;AAAAA;AAAAA,IACJ,OAAQ;AACJ4a,MAAAA,QAAO8sE;AAAAA,IACP;AAAA,EACD;AACD,SAAOx/E;AACP,GAED0/E,mBAAmB,SAASC,YAAYC,aAAAA;AAIvC,SAAO5jF,KAAKyjF,wBACXzjF,KAAKqjF,qBAAqBM,YAAYC,WAAAA,CAAAA;AAEvC,GAEDC,OAAO,SAASr0C,OAAO/mC,QAAAA;AACtB,MAAIq7E,cAAc12B,KAAW5d,MAAMogB,UAAAA,EAAYn1C;AAE/C,MAAIspE,eAAe32B,KAAW3kD,OAAOmnD,UAAAA,EAAYn1C,MAEjD;AAAA,MAAIupE,iBAAiB,EACpB9pE,OAAOla,KAAK+iF,cAAc/iF,KAAK0jF,kBAAkBI,YAAY5pE,OAAO6pE,aAAa7pE,KACjF5G,CAAAA,GAAAA,OAAO,CAAE,GACT2wE,aAAa,CAAE;AAGhB,QAAMC,kBAAkB,CAACC,SAASC,YAAAA;AACjC,aAAStoF,MAAKqoF,QAAQ7wE,OAAO;AAC5B,YAAM+wE,QAAQF,QAAQ7wE,MAAMxX,EAG5B;AAAA,UAAA,CAAKA,KAAI,KAAM;AACdkoF,uBAAe1wE,MAAMxX,EAAK,IAAA;AAAA,MAC1B;AAED,iBAAWud,OAAO+qE,QAAQ9wE,OAAO;AAChC,cAAMgxE,QAAQF,QAAQ9wE,MAAM+F,GAG5B;AAAA,YAAIA,OAAOvd,IAAG;AACbkoF,yBAAe1wE,MAAMxX,SAAQuoF,SAASC;AAAAA,QACtC;AAGD,YAAI5oF,MAAMoO,QAAQu6E,KAAAA,GAAQ;AACzB,gBAAME,SAAS7oF,MAAMoO,QAAQw6E,SAASA,QAAQF,QAAQlqE;AACtD8pE,yBAAe1wE,MAAMxX,EAAKkE,IAAAA,KAAK+iF,cAAc/iF,KAAK0jF,kBAAkBW,OAAOE,MAAAA,CAAAA;AAAAA,QAC3E;AAAA,MACD;AAAA,IACD;AAAA,EAIFL;AAAAA,kBAAgBJ,aAAaC,YAC7BG;AAAAA,kBAAgBH,cAAcD,WAAAA;AAG9B,MAAGA,YAAYG,aAAY;AAC1B,aAAQnoF,KAAKgoF,YAAYG,aAAY;AACpCD,qBAAeC,YAAYnoF,CAAAA,IAAKgoF,YAAYG,YAAYnoF;IACxD;AAAA,EACD;AACD,MAAGioF,aAAaE,aAAY;AAC3B,aAAQnoF,KAAKioF,aAAaE,aAAY;AACrCD,qBAAeC,YAAYnoF,CAAAA,IAAKioF,aAAaE,YAAYnoF,CAAAA;AAAAA,IACzD;AAAA,EACD;AAED,SAAOkoF;AAEP,EAAA;ACrLK,MAAMQ,kBAAAA;AAAAA,EAEZ,cACCxkF;AAAAA,SAAKqH,MACN;AAAA,EAAA;AAAA,EAEA,QAAQ6B,MAAcu7E,WAAmB1rE,OAAAA;AACxC,QAAI/Y,KAAK0kF,OAAOC,IAAIz7E,OAAO;AAC1B,YAAM07E,YAAY5kF,KAAK0kF,OAAOp2C,IAAIplC,IAElC;AAAA,YAAM27E,WAAWD,UAAU7rE,MAAM9O,YAAAA,CAAAA;AACjC,UAAI46E,YAAYA,SAASF,IAAIF,SAAY,GAAA;AACjC,eAAAI,SAASv2C,IAAIm2C,SACrB;AAAA,MAAA;AAAA,IACD;AAEO,WAAA;AAAA,EACR;AAAA,EACA,QAAQv7E,MAAcu7E,WAAmB1rE,OAAgB+rE,UACpD;AAAA,QAAA,CAAC57E,QAASu7E,CAAAA,WAAW;AACxB;AAAA,IACD;AAEA,UAAM5rC,QAAQ74C,KAAK0kF;AACb,UAAA17E,OAAO87E,SAAS76E,YAElB;AAAA,QAAA26E;AACJ,QAAA,CAAK/rC,MAAM8rC,IAAIz7E,OAAO;AACrB07E,kBAAY;AACN/rC,YAAA+D,IAAI1zC,MAAM07E,SAAS;AAAA,IAAA,OACnB;AACMA,kBAAA/rC,MAAMvK,IAAIplC;IACvB;AAEI,QAAA67E,YAAYH,UAAU57E,IAC1B;AAAA,QAAA,CAAI+7E,WAAU;AACbA,kBAAYH,UAAU57E,IAAAA,IAAQ,oBAAIg8E;AAAAA,IACnC;AAGUD,cAAAnoC,IAAI6nC,WAAW1rE,KAC1B;AAAA,EAAA;AAAA,EACA,QACM/Y;AAAAA,SAAA0kF,6BAAaM;AAAAA,EACnB;AAAA;AC9CM,MAAMC,qBAEZ;AAAA,EAAA,cACCjlF;AAAAA,SAAKqH,MACN;AAAA,EAAA;AAAA,EAEA,QAAQ6B,MAAcu7E,WAAmB1rE,OAAAA;AACxC,UAAM8/B,QAAQ74C,KAAK0kF;AACf,QAAA7rC,SAASA,MAAM3vC,IAAAA,GAAO;AACnB,YAAAV,SAAQqwC,MAAM3vC,IAAAA;AACpB,UAAGV,WAAAA,QAAoB;AACf,eAAA;AAAA,MACR;AACA,YAAMq8E,WAAWr8E,OAAMuQ,MAAM9O,YAC7B,CAAA;AAAA,UAAI46E,YAAYA,SAASJ,uBAA0B;AAClD,eAAOI,SAASJ,SAAAA;AAAAA,MACjB;AAAA,IACD;AAEO,WAAA;AAAA,EACR;AAAA,EACA,QAAQv7E,MAAcu7E,WAAmB1rE,OAAgB+rE,UACpD;AAAA,QAAA,CAAC57E,QAASu7E,CAAAA,WAAW;AACxB;AAAA,IACD;AAEA,UAAM5rC,QAAQ74C,KAAK0kF;AAEnB,SAAK7rC,OAAO;AACX;AAAA,IACD;AACI,QAAA,CAACA,MAAM3vC,IAAO,GAAA;AACX2vC,YAAA3vC,IAAAA,IAAQ,CACf;AAAA,IAAA;AACM,UAAA07E,YAAY/rC,MAAM3vC,IAElB;AAAA,UAAAF,OAAO87E,SAAS76E;AAClB,QAAA86E,YAAYH,UAAU57E,IAAAA;AAC1B,QAAI+7E,CAAAA,WAAU;AACDA,kBAAAH,UAAU57E,QAAQ;IAC/B;AACA+7E,cAAUN,SAAAA,IAAa1rE;AAAAA,EACxB;AAAA,EACA,QAAA1R;AACCrH,SAAK0kF,SAAS;EACf;AAAA;AC7CM,MAAMQ,iBAAAA;AAAAA,EAIZ,YAAYzD,UAAAA;AAKZzhF,SAAAmlF,oBAAqBC,eACd;AAAA,YAAA/rE,MAAM+rE,UAAU33E,QAAAA;AAEtB,UAAGzN,KAAKqlF,WAAWV,IAAItrE,GAAK,GAAA;AACpB,eAAArZ,KAAKqlF,WAAW/2C,IAAIj1B;MAC5B;AAEA,YAAMooE,YAAWzhF,KAAKslF;AAChB,YAAAviF,SAAQ/C,KAAKslF,UAAUhlB;AAE7B,UAAIilB,iBAAiB;AACrB,UAAI15E,QAAQ9I,OAAMsP,KAAKyrC,WAAW,IAAIplC,KAAK0sE,SAAAA,CAAAA;AAC3C,eAAQtpF,IAAI,GAAGA,IAAI,GAAGA,KAAI;AACPypF,0BAAA9D,UAAS+D,eAAe35E,SAAS;AACnDA,gBAAQ9I,OAAMsP,KAAK/F,IAAIT,OAAO,GAAG,KAClC;AAAA,MAAA;AAEK7L,WAAAqlF,WAAWzoC,IAAIvjC,KAAKksE,cAClB;AAAA,aAAAA;AAAAA,IAAA;AAGRvlF,SAAAylF,qBAAsBC;AACf,YAAArsE,MAAMqsE,WAAWj4E,QAAAA;AAEvB,UAAGzN,KAAK2lF,YAAYhB,IAAItrE,GAAAA,GAAK;AACrB,eAAArZ,KAAK2lF,YAAYr3C,IAAIj1B,GAC7B;AAAA,MAAA;AAEA,YAAMooE,YAAWzhF,KAAKslF;AAChB,YAAAviF,SAAQ/C,KAAKslF,UAAUhlB;AAE7B,UAAIslB,kBAAkB;AACtB,UAAI/5E,QAAQ9I,OAAMsP,KAAKyrC,WAAW,IAAIplC,KAAKgtE,UAAAA,CAAAA;AACrC,YAAAG,YAAY9iF,OAAMsP,KAAK/F,IAAIT,OAAO,GAAG,SAAS4B,QAC9C;AAAA,aAAA5B,MAAM4B,QAAYo4E,IAAAA,WAAU;AACdD,2BAAAnE,UAAS+D,eAAe35E,SAAS;AACpDA,gBAAQ9I,OAAMsP,KAAK/F,IAAIT,OAAO,GAAG,KAAA;AAAA,MAClC;AAEK7L,WAAA2lF,YAAY/oC,IAAIvjC,KAAKusE,eACnB;AAAA,aAAAA;AAAAA,IAAA;AAGR5lF,SAAAqH,QAAQ,MACFrH;AAAAA,WAAAqlF,iCAAiBL;AACjBhlF,WAAA2lF,kCAAkBX;AAAAA,IAAoB;AAjD3ChlF,SAAKqH,MACLrH;AAAAA,SAAKslF,YAAY7D;AAAAA,EAClB;AAAA;ACJM,SAASqE,oBAAAA;AAIX,MAAOd,OAAAA,QAAQ,aAAa;AAC/B,WAAO,IAAIR;AAAAA,EAAkB,OACvB;AACN,WAAO,IAAIS;AAAAA,EACZ;AACD;ACdO,MAAMc;EAEZ,cAAA5tD;AACCn4B,SAAKqH,MACN;AAAA,EAAA;AAAA,EAEA,gBAAgB0qE,WAAiB7oE,MAAcuW,MAAAA;AAC9C,UAAMo5B,QAAQ74C,KAAK0kF;AACf,QAAA,CAAC7rC,MAAM3vC,IAAO,GAAA;AACX2vC,YAAA3vC,IAAQ,IAAA,CAAA;AAAA,IACf;AACI,QAAA07E,YAAY/rC,MAAM3vC;AACtB,QAAI07E,CAAAA,WAAW;AACFA,kBAAA/rC,MAAM3vC,IAAAA,IAAQ;IAC3B;AAEI,QAAA88E,YAAYpB,UAAUnlE,IAAAA;AAC1B,SAAIumE,WAAW;AACFA,kBAAApB,UAAUnlE,IAAAA,IAAQ;IAC/B;AAEM,UAAAzW,OAAO+oE,UAAU9nE,YAAAA;AACnB,QAAA86E,YAAYiB,UAAUh9E;AAC1B,QAAI+7E,CAAAA,WAAU;AACDA,kBAAAiB,UAAUh9E,IAAQ,IAAA,EAACi9E,WAAW,IAAIC,UAAU,CAAA;IACzD;AAEO,WAAAnB;AAAAA,EACR;AAAA,EACA,iBAAiBhT,WAAmB5V,UACnC;AAAA,WAAOr8D,OAAOiyE,SAAa,IAAA,MAAMjyE,OAAOq8D,QAAAA;AAAAA,EACzC;AAAA,EACA,kBAAkB4V,WAAmBC,SAAAA;AACpC,WAAOlyE,OAAOiyE,SAAa,IAAA,MAAMjyE,OAAOkyE,OACzC;AAAA,EAAA;AAAA,EACA,WAAWD,WAAiB5V,UAAkBjzD,MAAcuW,MAAc0mE,SACzE;AAAA,UAAMttC,QAAQ74C,KAAKomF,gBAAgBrU,WAAW7oE,MAAMuW,IAE9C;AAAA,UAAA4mE,qBAAqBtU,UAAUtkE;AACrC,UAAM4L,MAAMrZ,KAAKsmF,iBAAiBD,oBAAoBlqB,QAAAA;AAClD,QAAA6V;AACJ,QAAGn5B,MAAMqtC,SAAS7sE,GAAAA,MAAAA,QAAmB;AACpC,YAAMrV,SAASmiF,QAAAA;AACT,YAAAI,kBAAkBviF,OAAOyJ,QACzBorC;AAAAA,YAAAqtC,SAAS7sE,GAAAA,IAAOktE;AACtB1tC,YAAMotC,UAAUjmF,KAAKwmF,kBAAkBH,oBAAoBE,eAAAA,CAAAA,IAAoBpqB;AACrE6V,gBAAAhuE;AAAAA,IAAA,OACN;AACJguE,gBAAU,IAAIt5D,KAAKmgC,MAAMqtC,SAAS7sE,GAAAA,CAAAA;AAAAA,IACnC;AAEO,WAAA24D;AAAAA,EACR;AAAA,EAEA,YAAYD,WAAiBC,SAAe9oE,MAAcuW,MAAc0mE;AACvE,UAAMttC,QAAQ74C,KAAKomF,gBAAgBrU,WAAW7oE,MAAMuW;AAE9C,UAAA4mE,qBAAqBtU,UAAUtkE,QAC/B;AAAA,UAAAg5E,mBAAmBzU,QAAQvkE,QAAAA;AACjC,UAAM4L,MAAMrZ,KAAKwmF,kBAAkBH,oBAAoBI,gBACnD;AAAA,QAAAtqB;AACJ,QAAGtjB,MAAMotC,UAAU5sE,iBAAmB;AACrC,YAAMrV,SAASmiF,QACfttC;AAAAA,YAAMotC,UAAU5sE,GAAOrV,IAAAA,OAAOyJ;AAInB0uD,iBAAAn4D;AAAAA,IAAA,OACP;AACOm4D,iBAAAtjB,MAAMotC,UAAU5sE,GAC5B;AAAA,IAAA;AAEO,WAAA8iD;AAAAA,EACR;AAAA,EAEA,QAAA90D;AACCrH,SAAK0kF,SAAS;EACf;AAAA;ACxED,SAASgC,yBAAyB3jF,QAAO4jF,iBAAAA;AACxC3mF,OAAK2mF,kBAAkBA;AACvB3mF,OAAKsgE,SAASv9D;AACd/C,OAAK4mF,qBAAqBd,kBAAAA;AAC1B9lF,OAAK6mF,mBAAmB,IAAI3B,iBAAiBllF;AAC7CA,OAAK8mF,qBAAqB,IAAIf;AAC9B/lF,OAAK+mF,YAAY;AACjB/mF,OAAKgnF,qBAAqB;AAC1BhnF,OAAKinF,2BAA2B;AACjC;AAEAP,yBAAyB/qF,YAAY,EACpC6M,OAAO,CACN,QACA,SACA,QACA,OACA,QACA,QAAA,GAED0+E,cAAc,WACblnF;AAAAA,OAAK4mF,mBAAmBv/E,MACxBrH;AAAAA,OAAK6mF,iBAAiBx/E,MACtBrH;AAAAA,OAAK8mF,mBAAmBz/E,MAAAA;AACxB,GAED8/E,eAAe,SAAUj+E,MACxB;AAAA,WAASpN,IAAI,GAAG+C,MAAMmB,KAAKwI,MAAMzM,QAAQD,IAAI+C,KAAK/C,KAAK;AACtD,QAAIkE,KAAKwI,MAAM1M,CAAAA,KAAMoN,KACpB,QAAOpN;AAAAA,EACR;AACD,GACDsrF,sBAAsB,WAAA;AACrBpnF,OAAKgnF,qBAAqB;AAC1BhnF,OAAKinF,2BAA2B;AAChC,GACDI,YAAY,SAAUtgF,UAAAA;AAGrB,MAAG/G,KAAKinF,2BAA2B,KAAQ;AAC1CjnF,SAAKonF,qBAAAA;AAAAA,EACL;AAED,MAAI3C,YAAY;AAChB,MAAK19E,SAAS6B,OAAO7B,SAAS6B,QAAQ,GAAI;AACzC67E,gBAAY19E,SAAS6B;AAAAA,EACxB,WAAa7B,SAASsL,MAAM;AACzB,QAAI0G,QAAQjZ,OAAOiH,SAASsL,KAAK5E;AACjC,QAAGzN,KAAKgnF,mBAAmBjuE,KAAAA,GAAO;AACjC0rE,kBAAYzkF,KAAKgnF,mBAAmBjuE,KAAAA;AAAAA,IACxC,OAAQ;AAEJ0rE,kBAAY/rE,KAAKskC,IAAIj2C,SAASsL,KAAKpI,eAAelD,SAASsL,KAAKnI,YAAYnD,SAASsL,KAAKlI,QAC1FnK,CAAAA;AAAAA,WAAKgnF,mBAAmBjuE,KAAAA,IAAS0rE;AACjCzkF,WAAKinF;AAAAA,IACL;AAAA,EAED;AACD,SAAOxC;AACP,GACD6C,qBAAqB,SAAUj1E,OAAMnJ,MAEpC;AAAA,MAAA,CAAKlJ,KAAK,cAAckJ,IAAAA,GAAO;AAC9B,UAAMm/C,OAAOroD,KAAKsgE,OAAOjuD,KAAK,GAAGnJ,IAAAA,QAAAA,EAAc,IAAIwP,KAAKrG;AACxD,UAAMi2C,KAAKtoD,KAAKsgE,OAAOjuD,KAAK/F,IAAI+7C,MAAM,GAAGn/C,IAAAA;AACzC,WAAOlJ,KAAKunF,YAAYl/B,MAAMC;EAC9B;AACD,SAAOtoD,KAAK,cAAckJ,IAAAA,EAAMmJ;AAChC,GAGDm1E,cAAc,SAAUn1E,OAAAA;AACvB,MAAI8K,MAAMnd,KAAKynF,cAAcp1E,KAAAA;AAE7B,MAAI3W,MAAMoO,QAAQqT,MAAM;AACvB,WAAOA,IAAIphB,SAAS;AAAA,EACpB;AACD,SAAO;AACP,GACD2rF,eAAe,SAAUr1E,OAAAA;AACxB,MAAI6H,QAAQla,KAAKynF,cAAcp1E,KAAAA;AAC/B,MAAI0G,QAAQ1G,MAAKiqC,SACjB;AAAA,WAASxgD,IAAI,GAAGA,IAAIoe,MAAMne,QAAQD,KAAK;AACtC,QAAGid,SAASmB,MAAMpe,GAAG6rF,aAAa5uE,QAAQmB,MAAMpe,CAAG8rF,EAAAA,SAAQ;AAC1D,aAAO;AAAA,IACP;AAAA,EACD;AACD,SAAO;AACP,GAEDC,oBAAoB,SAASx1E,OAAMy1E,QAClC;AAAA,MAAI5tE,QAAQ7H,MAAKiqC,SAAAA;AACjB,MAAIjqC,CAAAA,MAAKiqC,SAAejqC,KAAAA,CAAAA,MAAKmqC,gBAAgBsrC,QAAO;AACnD5tE,YAAQ;AAAA,EACR;AACD,SAAOA,QAAQ,KAAK,KAAK7H,MAAKmqC,WAAe,IAAA;AAC7C,GAEDurC,iBAAiB,SAAS11E,OACzB;AAAA,MAAI6H,QAAQla,KAAKynF,cAAcp1E,KAC/B;AAAA,MAAI21E,YAAYhoF,KAAK6nF,mBAAmBx1E,KAAAA;AACxC,WAASvW,IAAI,GAAGA,IAAIoe,MAAMne,QAAQD,KAAK;AACtC,QAAGksF,aAAa9tE,MAAMpe,CAAAA,EAAG+P,SAASm8E,YAAY9tE,MAAMpe,CAAGgQ,EAAAA,KAAI;AAC1D,aAAO;AAAA,IACP;AAAA,EACD;AACD,SAAO;AACP,GAEDm8E,WAAW,SAAUp8E,OAAO3C,MAAMuW;AACjC,SAAOzf,KAAKsgE,OAAOjuD,KAAK/F,IAAIT,OAAO4T,MAAMvW,IACzC;AAAA,GACDg/E,6BAA6B,SAAU7/B,MAAMC,IAAIp/C,MAAMuW,MACtD;AAAA,MAAI49B,aAAar9C,KAAKsgE,OAAOjuD;AAC7B,MAAIxG,QAAQ,IAAI6M,KAAK2vC,IACpBv8C,GAAAA,MAAM,IAAI4M,KAAK4vC,EAAAA;AAChB7oC,SAAOA,QAAQ;AACf,MAAIjX,SAAQ;AAGZ,MAAI2/E,OAAO;AACX,MAAIC,WACHC;AAKD,MAAIC,aAAa;AACjBF,cAAY/qC,WAAWn0C,OAAO,QAAU,EAAA,IAAIwP,KAAK7M,KACjD,CAAA;AAAA,MAAIu8E,UAAU36E,QAAa5B,KAAAA,MAAM4B,WAAW;AAC3C66E,iBAAa;AAAA,EACb;AACD,MAAIC,YAAY;AAChBF,YAAUhrC,WAAWn0C,OAAO,QAAA,EAAU,IAAIwP,KAAK4vC;AAC/C,MAAI+/B,QAAQ56E,QAAa66C,KAAAA,GAAG76C,QAAW,GAAA;AACtC86E,gBAAY;AAAA,EACZ;AAED,MAAIC,aAAa;AACjB,SAAO38E,MAAM4B,QAAAA,IAAY3B,IAAI2B,QAAAA,GAAW;AACvC06E,WAAOnoF,KAAKioF,UAAUp8E,OAAO3C,MAAMuW,IAAAA;AACnC+oE,iBAAcL,KAAK16E,YAAY3B,IAAI2B,QAAAA;AAEnC,QAAIzN,KAAKyoF,YAAY58E,OAAO3C,OAAO;AAClC,UAAIo/E,cAAeC,aAAaC,YAAa;AAC5CJ,oBAAY/qC,WAAWn0C,OAAO,QAAA,EAAU,IAAIwP,KAAK7M;AACjDw8E,kBAAUhrC,WAAW/wC,IAAI87E,WAAW3oE,MAAMvW,IAAAA;AAAAA,MAC1C;AAED,UAAIo/E,YAAY;AACfA,qBAAa;AACbH,eAAOnoF,KAAKioF,UAAUG,WAAWl/E,MAAMuW,IACvCjX;AAAAA,QAAAA,WAAW6/E,QAAQ56E,QAAY5B,IAAAA,MAAM4B,QAAc46E,MAAAA,QAAQ56E,QAAY26E,IAAAA,UAAU36E;MACtF,WAAe86E,aAAaC,YAAY;AACnCD,oBAAY;AACZ//E,QAAAA,WAAWsD,IAAI2B,QAAAA,IAAY5B,MAAM4B,QAAAA,MAAc46E,QAAQ56E,QAAY26E,IAAAA,UAAU36E;MAElF,OAAW;AACNjF,QAAAA;AAAAA,MACA;AAAA,IACL,OAAQ;AACJ,UAAIkgF,YAAY1oF,KAAKmnF,cAAcj+E,IACnC;AAAA,UAAIy/E,iBAAiB3oF,KAAKwI,MAAMkgF,YAAY;AAC5C,UAAGC,kBAAAA,CAAmB3oF,KAAKyoF,YAAY58E,OAAO88E,cAAAA,GAAgB;AAC7DR,eAAOnoF,KAAK4oF,0BAA0B/8E,OAAO88E,cAAAA;AAAAA,MAC7C;AAAA,IACD;AACD98E,YAAQs8E;AAAAA,EACR;AACD,SAAO3/E;AACP,GAEDqgF,oBAAoB,SAAUx2E,OAC7B;AAAA,MAAIy2E,YAAY9oF,KAAK6nF,mBAAmBx1E,KACxC;AAAA,MAAI02E,UAAU/oF,KAAK6nF,mBAAmB7nF,KAAKioF,UAAU51E,OAAM,QAAQ;AACnE,MAAI02E,YAAY,GAAE;AACjBA,cAAU,KAAK,KAAK;AAAA,EACpB;AACD,MAAIvuE,YAAYxa,KAAKynF,cAAcp1E,KAAAA;AAEnC,WAAQvW,IAAI,GAAGA,IAAI0e,UAAUze,QAAQD,KAAI;AACxC,QAAIo7B,WAAW1c,UAAU1e;AACzB,QAAGgtF,aAAa5xD,SAASrrB,SAASk9E,WAAW7xD,SAASprB,KAAI;AACzD,aAAO;AAAA,IACX,WAAYg9E,YAAY5xD,SAASprB,OAAOi9E,UAAU7xD,SAASrrB,OAAM;AAE7D,UAAIswD,WAAW7iE,KAAKyS,IAAIg9E,SAAS7xD,SAASprB,OAAOxS,KAAKuD,IAAIisF,WAAW5xD,SAASrrB,KAAAA;AAC9E,aAAOswD,WAAW;AAAA,IAClB;AAAA,EACD;AAED,SAAO;AACP,GAED6sB,mBAAmB,SAAU32E,OAAAA;AAC5B,MAAI6H,QAAQla,KAAKynF,cAAcp1E,KAAAA;AAC/B,MAAIkQ,MAAM;AACVrI,QAAM/Q,QAAQ,SAAS+tB,UACtB3U;AAAAA,WAAM2U,SAAS+xD;AAAAA,EAClB,CAAA;AACE,SAAO1mE;AACP,GACDijE,gBAAgB,SAAUnzE,OACzB;AAAA,MAAI6H,QAAQla,KAAKynF,cAAcp1E;AAC/B,MAAIkQ,MAAM;AACVrI,QAAM/Q,QAAQ,SAAS+tB;AACtB3U,WAAM2U,SAASgyD;AAAAA,EAClB,CACE;AAAA,SAAO3mE;AACP,GACD4mE,uBAAuB,SAAU9gC,MAAMC,IAAIp/C,MAAMuW;AAChD,MAAI0mD,QAAQ;AACZ,MAAIt6D,QAAQ,IAAI6M,KAAK2vC,IACpBv8C,GAAAA,MAAM,IAAI4M,KAAK4vC,EAEhB;AAAA,MAAI8gC;AACJ,MAAIlgF,QAAQ,UAAU;AACrBkgF,qBAAiBzlC,KAAW3jD,KAAKgpF,mBAAmBhpF,IACvD;AAAA,EAAA,OAAS;AACNopF,qBAAiBzlC,KAAW3jD,KAAKwlF,gBAAgBxlF;EACjD;AAED,SAAO6L,MAAM4B,QAAY3B,IAAAA,IAAI2B,QAAW,GAAA;AACvC,QAAG3B,MAAMD,QAAQ,MAAK,KAAG,KAAG,KAAG,MAAMA,MAAM1B,QAAc,MAAA,GAAG;AAC3D,UAAI3B,SAAQxI,KAAK6mF,iBAAiBpB,mBAAmB55E,KAAAA;AACrD,UAAG3C,QAAQ,QAAO;AACjBV,QAAAA,SAAQA,SAAQ;AAAA,MAChB;AACD29D,eAAS39D;AACTqD,cAAQ7L,KAAKsgE,OAAOjuD,KAAK/F,IAAIT,OAAO,GAAG;AACvC;AAAA,IACJ,WAAYC,MAAMD,QAAQ,MAAK,KAAG,KAAG,KAAG,IAAI;AACxC,UAAIu5E,YAAYplF,KAAKsgE,OAAOjuD,KAAKyrC,WAAW,IAAIplC,KAAK7M,KAAAA,CAAAA;AACrD,UAAGA,MAAM4B,QAAAA,MAAc23E,UAAU33E,QAAU,GAAA;AAC1C,YAAIjF,SAAQxI,KAAK6mF,iBAAiB1B,kBAAkBt5E,KACpD;AAAA,YAAG3C,QAAQ,QAAO;AACjBV,UAAAA,SAAQA,SAAQ;AAAA,QAChB;AACD29D,iBAAS39D;AACTqD,gBAAQ7L,KAAKsgE,OAAOjuD,KAAK/F,IAAIT,OAAO,GAAG,KAAA;AACvC;AAAA,MACA;AAAA,IACD;AAGDs6D,aAASijB,eAAev9E,KAAAA;AAExBA,YAAQ7L,KAAKioF,UAAUp8E,OAAO,OAAO,CACrC;AAAA,EAAA;AAED,SAAOs6D,QAAQ1mD;AACf,GAGD4pE,6BAA6B,SAAShhC,MAAMC,IAAAA;AAC3C,MAAIxuC,QAAQ9Z,KAAKspF,sBAAsBjhC,MAAMC;AAC7C,MAAI9tC,YAAYxa,KAAKynF,cAAcp/B,IAAAA;AACnC,MAAIrkD,SAAS;AAEb,WAAQlI,IAAI,GAAGA,IAAI0e,UAAUze,QAAQD,KAAI;AACxC,QAAIo7B,WAAW1c,UAAU1e,CAAAA;AACzB,QAAGge,MAAMhO,OAAOorB,SAASrrB,SAASiO,MAAMjO,SAASqrB,SAASprB,KAAI;AAC7D,UAAIy9E,aAAajwF,KAAKuD,IAAIq6B,SAASrrB,OAAOiO,MAAMjO,KAAAA;AAChD,UAAI29E,WAAWlwF,KAAKyS,IAAImrB,SAASprB,KAAKgO,MAAMhO,GAAAA;AAE5C9H,iBAAWwlF,WAAWD,cAAc;AACpCzvE,YAAMjO,QAAQ29E;AAAAA,IACd;AAAA,EACD;AAED,SAAOlwF,KAAKkS,MAAMxH,MAAAA;AAClB,GAEDylF,oBAAoB,SAASphC,MAAMC,IAAIp/C,MAAMuW,MAAAA;AAC5C,MAAI5T,QAAQ,IAAI6M,KAAK2vC,IAAAA,GACpBv8C,MAAM,IAAI4M,KAAK4vC,EAAAA;AAChB7oC,SAAOA,QAAQ;AAEf,MAAIiqE,gBAAgB,IAAIhxE,KAAK7M,KAC7B;AAAA,MAAI89E,cAAc3pF,KAAKsgE,OAAOjuD,KAAK/F,IAAItM,KAAKsgE,OAAOjuD,KAAKisC,UAAU,IAAI5lC,KAAK7M,KAAS,CAAA,GAAA,GAAG,KAEvF;AAAA,MAAIC,IAAI2B,QAAAA,KAAak8E,YAAYl8E,QAAW,GAAA;AAC3C,WAAOzN,KAAKqpF,4BAA4BhhC,MAAMC,EACjD;AAAA,EAAA,OAAS;AAEN,QAAIshC,eAAe5pF,KAAKsgE,OAAOjuD,KAAKisC,UAAU,IAAI5lC,KAAK5M,GACvD,CAAA;AAAA,QAAI+9E,aAAa/9E;AAEjB,QAAIg+E,YAAY9pF,KAAKqpF,4BAA4BK,eAAeC;AAChE,QAAII,UAAU/pF,KAAKqpF,4BAA4BO,cAAcC;AAE7D,QAAIG,YAAYhqF,KAAKmpF,sBAAsBQ,aAAaC,cAAc1gF,MAAMuW,IAC5E;AAAA,QAAI0mD,QAAQ2jB,YAAYE,YAAYD;AAEpC,WAAO5jB;AAAAA,EACP;AACD,GAGD8jB,kBAAkB,SAAU5hC,MAAMC,IAAIp/C,MAAMuW,MAAAA;AAC3C,MAAI5T,QAAQ,IAAI6M,KAAK2vC,IACpBv8C,GAAAA,MAAM,IAAI4M,KAAK4vC,EAChB7oC;AAAAA,SAAOA,QAAQ;AAEf,MAAIiqE,gBAAgB,IAAIhxE,KAAK7M,KAAAA;AAC7B,MAAI89E,cAAc3pF,KAAKsgE,OAAOjuD,KAAK/F,IAAItM,KAAKsgE,OAAOjuD,KAAKisC,UAAU,IAAI5lC,KAAK7M,KAAAA,CAAAA,GAAS,GAAG,KAEvF;AAAA,MAAIC,IAAI2B,QAAAA,KAAak8E,YAAYl8E,QAAAA,GAAW;AAC3C,WAAOnU,KAAKC,MAAMyG,KAAKqpF,4BAA4BhhC,MAAMC,EAAM,IAAA,EAAA;AAAA,EAClE,OAAS;AAEN,QAAIshC,eAAe5pF,KAAKsgE,OAAOjuD,KAAKisC,UAAU,IAAI5lC,KAAK5M;AACvD,QAAI+9E,aAAa/9E;AAEjB,QAAIg+E,YAAY9pF,KAAKqpF,4BAA4BK,eAAeC,aAAazgF,MAAMuW,IAAAA,IAAQ;AAC3F,QAAIsqE,UAAU/pF,KAAKqpF,4BAA4BO,cAAcC,YAAY3gF,MAAMuW,IAAAA,IAAQ;AAEvF,QAAIuqE,YAAYhqF,KAAKmpF,sBAAsBQ,aAAaC,cAAc1gF,MAAMuW,IAAAA;AAC5E,QAAI0mD,QAAQ2jB,YAAYE,YAAYD;AAEpC,WAAOzwF,KAAKC,MAAM4sE,KAClB;AAAA,EAAA;AACD,GAEDvW,WAAW,WAAA;AACV,SAAO5vD,KAAK+mF;AACZ,GACDmD,YAAY,SAAUnjF,UAAAA;AACrB/G,OAAK+mF,YAAYhgF;AACjB/G,OAAKmqF,eACLnqF;AAAAA,OAAKknF,aACL;AAAA,GACDiD,gBAAgB,WAAA;AACf,MAAIpjF,WAAW/G,KAAK4vD,UACpB7oD;AAAAA,WAAS0T,SAAS,EACjBnH,OAAO,CAAE,GACT4G,OAAO,MACPkwE,iBAAiB,OACjBnG,aAAa,CAAE,GACfoG,uBAAuB,MACvBC,qBAAqB,MACrBC,uBAAuB,CAAA,EAAA;AAGxBxjF,WAAS0T,OAAOP,QAAQla,KAAKwqF,YAAYzjF,SAASmT,KAAAA;AAClD,WAAQpe,KAAKiL,SAASuM,OAAM;AAC3BvM,aAAS0T,OAAOnH,MAAMxX,CAAAA,IAAKkE,KAAKwqF,YAAYzjF,SAASuM,MAAMxX,CAC3D,CAAA;AAAA,EAAA;AAED,MAAGiL,SAASk9E,aAAa;AACxB,QAAIwG,sBAAsB;AAC1B,QAAIC,oBAAoB;AACxB,aAAQ5uF,KAAKiL,SAASk9E,aAAY;AACjC,UAAI0G,aAAa5jF,SAASk9E,YAAYnoF,CAAAA;AAEtC,UAAG6uF,WAAWtiC,QAAQsiC,WAAWriC,IAAG;AACnC,YAAIsiC,aAAaD,WAAWtiC;AAC5B,YAAIwiC,WAAWF,WAAWriC;AAC1B,YAAImiC,CAAAA,uBAAuBA,sBAAsBG,WAAWn9E,QAAU,GAAA;AACrEg9E,gCAAsBG,WAAWn9E,QAAAA;AAAAA,QACjC;AACD,YAAA,CAAIi9E,qBAAqBA,oBAAoBG,SAASp9E,QAAU,GAAA;AAC/Di9E,8BAAoBG,SAASp9E,QAAAA;AAAAA,QAC7B;AAED1G,iBAAS0T,OAAO8vE,sBAAsBvrF,KAAK,EAC1CqpD,MAAMuiC,WAAWn9E,QACjBq9E,GAAAA,cAAc,IAAIpyE,KAAKkyE,UACvBtiC,GAAAA,IAAIuiC,SAASp9E,QACbs9E,GAAAA,YAAY,IAAIryE,KAAKmyE,QACrBxtF,GAAAA,MAAMvB;AAGPiL,iBAAS0T,OAAO2vE,kBAAkB;AAClC,YAAIY,cAAcjkF,SAAS0T,OAAOwpE,YAAYnoF,CAAAA,IAAK,EAClDusD,MAAMsiC,WAAWtiC,MACjBC,IAAIqiC,WAAWriC,IACfpuC,OAAOla,KAAKwqF,YAAYG,WAAWzwE,KACnC5G,GAAAA,OAAO,CAAE,EAAA;AAGV,iBAAQ5S,KAAKiqF,WAAWr3E,OAAM;AAC7B03E,sBAAY13E,MAAM5S,CAAAA,IAAKV,KAAKwqF,YAAYG,WAAWr3E,MAAM5S;QACzD;AAAA,MACD;AAAA,IACD;AAEDqG,aAAS0T,OAAO4vE,wBAAwBI;AACxC1jF,aAAS0T,OAAO6vE,sBAAsBI;AAAAA,EAEtC;AACD,GAEDO,4BAA4B,SAAU7kB,SAAAA;AACrC,MAAI8kB,SAASn0E,KAAKC,UAAUhX,KAAK4vD,UAAAA,CAAAA;AACjCwW,UACA;AAAA,MAAA,CAAKpmE,KAAKmrF,YAAAA,GAAe;AAExBnrF,SAAKkqF,WAAWnzE,KAAKW,MAAMwzE,MAC3BlrF,CAAAA;AAAAA,SAAKknF;AACL,WAAO;AAAA,EACP;AACD,SAAO;AAEP,GAEDkE,cAAc,SAAS7wF,GAAG2B;AACzB,MAAI3B,MAAM2B,EAAG,QAAO;AACpB,MAAK3B,CAAAA,KAAAA,CAAM2B,EAAG,QAAO;AACrB,MAAI3B,EAAEwB,UAAUG,EAAEH,OAAQ,QAAO;AAEjC,WAASD,IAAI,GAAGA,IAAIvB,EAAEwB,UAAUD,GAAG;AAClC,QAAIvB,EAAEuB,CAAAA,MAAOI,EAAEJ,CAAI,EAAA,QAAO;AAAA,EAC1B;AACD,SAAO;AACP,GAGDuvF,kBAAkB,SAAUC,YAAYC,cACvC;AAAA,MAAA,CAAKvrF,KAAKorF,aAAaE,WAAWpxE,OAAOqxE,aAAarxE,KAAQ,GAAA;AAC7D,WAAO;AAAA,EACP;AAED,MAAIsxE,SAAS1qE,OAAOC,KAAKuqE,WAAWh4E,KAAAA;AACpC,MAAIm4E,aAAa3qE,OAAOC,KAAKwqE,aAAaj4E,KAC1Ck4E;AAAAA,SAAOvvF,KACPwvF;AAAAA,aAAWxvF,KAEX;AAAA,MAAA,CAAK+D,KAAKorF,aAAaI,QAAQC,UAAa,GAAA;AAC3C,WAAO;AAAA,EACP;AAED,WAAQ3vF,IAAI,GAAGA,IAAI0vF,OAAOzvF,QAAQD,KAAI;AACrC,QAAI2oF,YAAY+G,OAAO1vF;AACvB,QAAI4vF,UAAUJ,WAAWh4E,MAAMmxE,SAC/B;AAAA,QAAIkH,aAAaL,WAAWh4E,MAAMmxE,SAGlC;AAAA,QAAGiH,YAAYC,cAAAA,EAEZjwF,MAAMoO,QAAQ4hF,OAAAA,KAAYhwF,MAAMoO,QAAQ6hF,UAAAA,KAAe3rF,KAAKorF,aAAaM,SAASC,UACnF,IAAA;AACD,aAAO;AAAA,IACP;AAAA,EACD;AAED,SAAO;AACP,GAEDC,QAAQ,SAAUnK;AACjB,MAAKA,EAAAA,oBAAoBiF,2BAA0B;AAClD,WAAO;AAAA,EACP;AAED,MAAI4E,aAAatrF,KAAK4vD,UACtB;AAAA,MAAI27B,eAAe9J,SAAS7xB,UAAAA;AAE5B,MAAI5vD,CAAAA,KAAKqrF,iBAAiBC,YAAYC,eAAc;AACnD,WAAO;AAAA,EACP;AAED,MAAGD,WAAW7wE,OAAO2vE,mBAAmBmB,aAAa9wE,OAAO2vE,iBAAgB;AAC3E,QAAGkB,WAAW7wE,OAAO8vE,sBAAsBxuF,UAAUwvF,aAAa9wE,OAAO8vE,sBAAsBxuF,QAAO;AACrG,aAAO;AAAA,IACP;AAED,aAAQD,KAAKwvF,WAAW7wE,OAAOwpE,aAAY;AAC1C,UAAI4H,SAASP,WAAW7wE,OAAOwpE,YAAYnoF,CAC3C;AAAA,UAAIgwF,WAAWP,aAAa9wE,OAAOwpE,YAAYnoF,CAC/C;AAAA,UAAA,CAAIgwF,UAAS;AACZ,eAAO;AAAA,MACP;AAED,UAAI9rF,CAAAA,KAAKqrF,iBAAiBQ,QAAQC,QAAAA,GAAU;AAC3C,eAAO;AAAA,MACP;AAAA,IACD;AAAA,EACJ,WAAWR,WAAW5zE,MAAM0yE,oBAAoBmB,aAAa9wE,OAAO2vE,iBAAgB;AACjF,WAAO;AAAA,EACP;AAED,SAAO;AACP,GAED2B,cAAc,WACb;AAAA,MAAIzmF,UAAStF,KAAK2mF,gBAAgB7E,sBAAsB7hF,MAAMD,KAAK2mF,iBAAiB//E;AACpF,SAAO5G,KAAKynF,cAAcniF,QAAO+M,MAAM,KAAA;AACvC,GACDo1E,eAAe,SAAUp1E,OAAMoI,QAC9B;AAAA,MAAIgnE,WAAWzhF,KAAK4vD,UAAAA;AACpB,MAAGn1C,WAAW,OAAM;AACnBgnE,eAAWA,SAAShnE;AAAAA,EACpB;AAED,MAAIpI,CAAAA,OAAK;AACR,WAAOovE,SAASvnE;AAAAA,EAChB;AAED,MAAI8xE,YAAYhsF,KAAKqnF,WAAW,EAACh1E,MAAMA,MAEvC,CAAA;AAAA,MAAGovE,SAAS2I,iBAAgB;AAC3B,QAAG3I,SAAS4I,yBAAyB2B,aAAavK,SAAS6I,sBAAsB0B,WAAU;AAC1F,eAAQlwF,IAAI,GAAGA,IAAI2lF,SAAS8I,sBAAsBxuF,QAAQD,KAAI;AAC7D,YAAG2lF,SAAS8I,sBAAsBzuF,GAAGusD,QAAQ2jC,aAAavK,SAAS8I,sBAAsBzuF,CAAAA,EAAGwsD,KAAK0jC,WAAU;AAC1GvK,qBAAWA,SAASwC,YAAYxC,SAAS8I,sBAAsBzuF,CAAAA,EAAGuB,IAClE;AAAA;AAAA,QACA;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAED,MAAI6c,QAAQ;AAEZ,MAAIunE,SAASnuE,MAAM04E,eAAe3rF,QAAW;AAC5C6Z,YAAQunE,SAASnuE,MAAM04E,SAC1B;AAAA,EAAA,WAAavK,SAASnuE,MAAMjB,MAAK4pC,OAAAA,CAAAA,MAAc57C,QAAW;AACvD6Z,YAAQunE,SAASnuE,MAAMjB,MAAK4pC,OAAAA,CAAAA;AAAAA,EAC5B;AACD,MAAI/hC,UAAU,MAAM;AACnB,WAAOunE,SAASvnE;AAAAA,EAChB,WAAUA,OAAO;AACjB,WAAOA;AAAAA,EACP;AACD,SAAO,CAAA;AACP,GAEDovE,uBAAuB,SAASjhC,MAAMC,IACrC;AAAA,MAAI/lC,MAAM,EACT1W,OAAO,GACPC,KAAK,EAGNyW;AAAAA,MAAI1W,QAAQw8C,KAAK/L,SAAAA,IAAa,KAAK,KAAK+L,KAAK7L,eAAe,KAAK6L,KAAK3L,WACtE;AAAA,MAAIuvC,WAAW3jC,GAAGhM;AAClB,MAAI2vC,CAAAA,YAAAA,CAAa3jC,GAAG9L,WAAAA,KAAAA,CAAiB8L,GAAG5L,WAAAA,KAAgB2L,KAAK56C,QAAY66C,IAAAA,GAAG76C,QAAU,GAAA;AACrFw+E,eAAW;AAAA,EACX;AACD1pE,MAAIzW,MAAMmgF,WAAW,KAAK,KAAK3jC,GAAG9L,WAAe,IAAA,KAAK8L,GAAG5L,WAAAA;AACzD,SAAOn6B;AACP,GAEDioE,aAAa,SAAStwE,OACrB;AAAA,MAAGxe,MAAMoO,QAAQoQ,QAAO;AAEvB,QAAIgyE,kBAAkB,CAAA;AACtBhyE,UAAM/Q,QAAQ,SAASR,MACtB;AAAA,UAAA,OAAUA,SAAS,UAAS;AAC3BujF,wBAAgBltF,KAAK2J,OAAK,KAAG,EAAA;AAAA,MAClC,WAAU,OAAUA,SAAS,UAAU;AAElCA,aAAKrL,MAAM,GAAKiM,EAAAA,IAAI,SAAS4Q,MAC5B;AAAA,iBAAOA,KAAKpa,KAAAA;AAAAA,QAClB,CAAQoJ,EAAAA,QAAQ,SAASgjF,MACnB;AAAA,cAAI1xE,SAAS0xE,KAAK7uF,MAAM,KAAKiM,IAAI,SAAS4Q,MACzC;AAAA,mBAAOA,KAAKpa,KAAAA;AAAAA,UACnB;AAEM,cAAIgZ,QAAQ9f,SAASwhB,OAAO,CAAA,IAAG,KAAG,EAClC;AAAA,cAAGA,OAAO,CAAA,GAAG;AACZ1B,qBAAS9f,SAASwhB,OAAO,CAAA,IAAG;UAC5B;AACD,cAAGA,OAAO,CAAG,GAAA;AACZ1B,qBAAS9f,SAASwhB,OAAO,CAAA,CAAA;AAAA,UACzB;AAEDyxE,0BAAgBltF,KAAK+Z,KAC3B;AAAA,QAAA,CAAA;AAAA,MAEK;AAAA,IACL,CAAA;AAEG,QAAIqzE,kBAAkB,CAAA;AACtB,aAAStwF,IAAI,GAAGA,IAAIowF,gBAAgBnwF,QAAQD,KAAK,GAAG;AACnD,UAAI+P,QAAQqgF,gBAAgBpwF,CAC5B;AAAA,UAAIgQ,MAAMogF,gBAAgBpwF,IAAI,CAC9B;AAAA,UAAIqgE,WAAWrwD,MAAMD;AAErBugF,sBAAgBptF,KAAK,EACpB6M,OACAC,KACA67E,WAAWruF,KAAKkS,MAAMK,SAAS,KAAG,GAClCkO,GAAAA,aAAazgB,KAAKkS,MAAMK,QAAK,EAC7B+7E,GAAAA,SAAStuF,KAAK2pD,KAAKn3C,OAAO,KAAG,GAAA,GAC7BkO,WAAW1gB,KAAK2pD,KAAKn3C,MAAG,KACxBugF,iBAAiBlwB,UACjB8sB,iBAAiB9sB,WAAS,IAC1B+sB,eAAe/sB,YAAU,KAAK,IAAA,CAAA;AAAA,IAE/B;AAED,WAAOiwB;AAAAA,EACV,OAAS;AACN,WAAOlyE;AAAAA,EACP;AACD,GAEDoyE,aAAa,SAAUvlF,UACtB;AAAA,SAAO/G,KAAKirF,2BAA2BtnC,KAAW;AACjD,QAAIzpC,QAAQnT,SAASmT,UAAU7Z,SAAY0G,SAASmT,QAAQ;AAC5D,QAAIuqE,YAAYzkF,KAAKqnF,WAAWtgF;AAChC,QAAIwlF,iBAAiBvsF,KAAK4vD,UAAAA;AAC1B,QAAI60B,cAAc,MAAM;AACvB8H,qBAAej5E,MAAMmxE,SAAAA,IAAavqE;AAAAA,IACtC,YAAcnT,SAASk9E,aAAa;AAChCsI,qBAAeryE,QAAQA;AAAAA,IACvB;AAED,QAAGnT,SAASk9E,aAAY;AACvB,UAAA,CAAIsI,eAAetI,aAAY;AAC9BsI,uBAAetI,cAAc;MAC7B;AAED,UAAWl9E,OAAAA,SAASk9E,eAAe,UAAS;AAC3C,YAAIQ,cAAc,MAAM;AACvB8H,yBAAetI,YAAYl9E,SAASk9E,aAAa3wE,MAAMmxE,SAAAA,IAAavqE;AAAAA,QAC1E,WAAY,CAAInT,SAASk9E,aAAa;AAChCsI,yBAAetI,YAAYl9E,SAASk9E,WAAAA,EAAa/pE,QAAQA;AAAAA,QACzD;AAAA,MACN,WAAW,OAAWnT,SAASk9E,gBAAgB,YACxC9oC,SAASx/C,UAAU+f,SAAS7f,KAAKkL,SAASk9E,YAAY9rD,iBAAiB,uCAAsC;AAC/G,iBAAQr8B,KAAKiL,SAASk9E,aAAY;AACjCsI,yBAAetI,YAAYnoF,CAAKiL,IAAAA,SAASk9E,YAAYnoF,CACrD;AAAA,QAAA;AAAA,MACD;AAAA,IACD;AAEDkE,SAAKmqF;AACLnqF,SAAKknF,aAAAA;AAAAA,EACR,GAAKlnF,IAAAA,CAAAA;AACH,GAEDwsF,eAAe,SAAUzlF,UACxB;AAAA,SAAO/G,KAAKirF,2BAA2BtnC,KAAW;AACjD,QAAK58C,CAAAA,UAAU;AACd/G,WAAKysF,eACT;AAAA,IAAA,OAAU;AAEN,UAAIhI,YAAYzkF,KAAKqnF,WAAWtgF,QAEhC;AAAA,UAAI09E,cAAc,MAAM;AAAA,eAChBzkF,KAAK4vD,UAAAA,EAAYt8C,MAAMmxE,SAAAA;AAAAA,MAC9B;AAAA,IACD;AAEDzkF,SAAKmqF;AACLnqF,SAAKknF,aAAAA;AAAAA,EACR,GAAKlnF,IACH,CAAA;AAAA,GAEDyoF,aAAa,SAAUp2E,OAAMnJ,MAAAA;AAI5B,MAAIwjF,aAAc;AAClB,MAAIC,UAAU;AAEF;AAEXA,cAAU7sF,OAAOuS,MAAK5E,QACtBi/E,CAAAA;AAAAA,iBAAa1sF,KAAK4mF,mBAAmBjtD,QAAQzwB,MAAMyjF,SAASt6E;EAC5D;AAED,MAAIq6E,kBAAkB;AAErBA,iBAAa1sF,KAAKsnF,oBAAoBj1E,OAAMnJ;AAChC;AACXlJ,WAAK4mF,mBAAmBgG,QAAQ1jF,MAAMyjF,SAASD,YAAYr6E,KAC3D;AAAA,IAAA;AAAA,EACD;AAED,SAAOq6E;AACP,GAEDnzB,YAAY,WACX;AAAA,MAAIj0D,UAAUtF,KAAK2mF,gBAAgBzE,oBAAoBjiF,MAAOD,KAAK2mF,iBAAiB//E,SAAAA;AACpF,SAAO5G,KAAKyoF,YAAYnjF,QAAO+M,MAAM/M,QAAO4D,IAC5C;AAAA,GAEDipE,mBAAmB,WAClB;AAAA,MAAI7sE,UAAUtF,KAAK2mF,gBAAgBlE,qBAAqBxiF,MAAOD,KAAK2mF,iBAAiB//E;AAErF,MAAKtB,CAAAA,QAAO4D,MAAM;AACjB,WAAO;AAAA,EACP;AAGD,MAAI+rD,OAAOj1D;AACX,SAAOA,KAAK8mF,mBAAmB+F,YAAYvnF,QAAO6M,YAAY7M,QAAO8M,UAAU9M,QAAO4D,MAAM5D,QAAOma,MAAM,WAAA;AACxG,WAAOw1C,KAAK63B,mBAAmBxnF,QAAO6M,YAAY7M,QAAO8M,UAAU9M,QAAO4D,MAAM5D,QAAOma,IAAAA;AAAAA,EAC1F,CACE;AAAA,GAEDqtE,oBAAoB,SAAUzkC,MAAMC,IAAIp/C,MAAMuW,MAC7C;AAAA,MAAI8C,MAAM;AAEV,MAAIwqE,OAAO;AACX,MAAG1kC,KAAK56C,YAAY66C,GAAG76C,QAAAA,GAAU;AAChC,QAAI2vB,MAAMkrB;AACVA,SAAKD;AACLA,WAAOjrB;AACP2vD,WAAQ;AAAA,EACR;AAED,MAAI7jF,QAAQ,UAAUuW,QAAQ,GAAG;AAChC8C,UAAMviB,KAAKiqF,iBAAiB5hC,MAAMC,IAAIp/C,MAAMuW,IAAAA;AAAAA,EAC5C,WAASvW,QAAQ,YAAYuW,QAAQ,GAAE;AAEvC8C,UAAMviB,KAAKypF,mBAAmBphC,MAAMC,IAAIp/C,MAAMuW;EACjD,OAAS;AACN8C,UAAMviB,KAAKkoF,4BAA4B7/B,MAAMC,IAAIp/C,MAAMuW,IACvD;AAAA,EAAA;AAGD,SAAOstE,OAAOzzF,KAAKC,MAAMgpB,GAAAA;AACzB,GACDglE,aAAa,WAAA;AACZ,MAAIjiF,UAAUtF,KAAK2mF,gBAAgBlE,qBAAqBxiF,MAAOD,KAAK2mF,iBAAiB//E,SAErF;AAAA,MAAIyhD,OAAO/iD,QAAO6M,YACjBm2C,KAAKhjD,QAAO8M,UACZlJ,OAAO5D,QAAO4D,MACduW,OAAOna,QAAOma;AAEf,MAAKvW,CAAAA,MAAM;AACV,WAAO;AAAA,EACP;AACD,MAAI2C,QAAQ,IAAI6M,KAAK2vC,IACpBv8C,GAAAA,MAAM,IAAI4M,KAAK4vC,EAAAA;AAChB7oC,SAAOA,QAAQ;AAEf,SAAO5T,MAAM4B,QAAY3B,IAAAA,IAAI2B,QAAW,GAAA;AACvC,QAAIzN,KAAKyoF,YAAY58E,OAAO3C,IAAAA,EAC3B,QAAO;AACR2C,YAAQ7L,KAAKioF,UAAUp8E,OAAO3C,MAAMuW,IAAAA;AAAAA,EACpC;AACD,SAAO;AACP,GAEDy8C,kBAAkB,WACjB;AAAA,MAAI52D,UAAUtF,KAAK2mF,gBAAgBhE,0BAA0B1iF,MAAOD,KAAK2mF,iBAAiB//E,SAE1F;AAAA,MAAIyhD,OAAO/iD,QAAO6M,YACjBgqD,WAAW72D,QAAO62D,UAClBjzD,OAAO5D,QAAO4D,MACduW,OAAOna,QAAOma;AAEf,MAAA,CAAKvW,KACJ,QAAO;AAER,MAAI8jF,OAAQ1nF,QAAO62D,YAAY,IAAK,IAAA;AACpCA,aAAW7iE,KAAKkM,IAAI22D,WAAW,CAG/B;AAAA,MAAIlH,OAAOj1D;AACX,SAAOA,KAAK8mF,mBAAmBmG,WAAW5kC,MAAM8T,UAAUjzD,MAAMuW,OAAOutE,MAAM,WAC5E;AAAA,WAAO/3B,KAAKi4B,kBAAkB7kC,MAAM8T,UAAUjzD,MAAMuW,OAAOutE,IAAAA;AAAAA,EAC9D,CACE;AAAA,GAEDE,mBAAmB,SAAU7kC,MAAM8T,UAAUjzD,MAAMuW;AAClD,MAAKvW,CAAAA,KACJ,QAAO;AAER,MAAIuW,QAAQ,KAAKvW,QAAQ,UAAU;AAClC,WAAOlJ,KAAKmtF,wBAAwB9kC,MAAM8T,UAAU18C;EACpD,WAASA,QAAS,MAAKvW,QAAQ,UAAU;AACzC,WAAOlJ,KAAKotF,oBAAoB/kC,MAAM8T,UAAU18C;EAChD,WAAUA,QAAQ,KAAKvW,QAAQ,QAAQ;AACvC,WAAOlJ,KAAKqtF,sBAAsBhlC,MAAM8T,UAAU18C,IAAAA;AAAAA,EACrD,OAAS;AACN,QAAIyX,WAAWl3B,KAAKstF,aAAajlC,MAAM8T,UAAUjzD,MAAMuW,MAAM;AAC7D,WAAOyX,SAASprB;AAAAA,EAChB;AACD,GAEDwhF,cAAc,SAAUzhF,OAAOswD,UAAUjzD,MAAMuW,MAAM8tE,YAAAA;AACpD,MAAIC,QAAQ;AACZ,MAAIhK,UAAU33E;AACd,MAAI4hF,WAAW;AAEf,SAAOD,QAAQrxB,YAAcoxB,EAAAA,cAAcA,WAAW/J,OAAW,IAAA;AAChE,QAAI2E,OAAOnoF,KAAKioF,UAAUzE,SAASt6E,MAAMuW,IAAAA;AAGzC,QAAIvW,QAAQ,OAAM;AACjBukF,iBAAWA,YAAajK,CAAAA,QAAQlnC,cAAc6rC,KAAK7rC,SAAAA;AAEnD,UAAImxC,UAAS;AACZtF,aAAK1qC,SAAS,CACd;AAAA,YAAI0qC,KAAK7rC,SAEF,EAAA;AAAA,aAAA;AACNmxC,qBAAW;AAAA,QACX;AAAA,MACD;AAAA,IACD;AAED,QAAIzB,YAAY,IAAItzE,KAAKyvE,KAAK16E,QAAY,IAAA,CAAA;AAC1C,QAAIgS,OAAO,GAAG;AACbusE,kBAAY,IAAItzE,KAAKyvE,KAAK16E,QAAAA,IAAY;IACtC;AACD,QAAIigF,gBAAgB1tF,KAAKyoF,YAAYuD,WAAW9iF,IAEhD;AAAA,QAAIwkF,iBAAkBD,CAAAA,UAAU;AAC/BD;AAAAA,IACA;AACDhK,cAAU2E;AAAAA,EACV;AACD,SAAO,EACNr8E,KAAK03E,SACL33E,OACA2hF,MAAOA;AAER,GAEDG,sBAAsB,SAAStlC,MAAM8T,UAAAA;AACpC,MAAI2rB,SAAS9nF,KAAKsgE,OAAOjuD,KAAK/F,IAAItM,KAAKsgE,OAAOjuD,KAAKisC,UAAU,IAAI5lC,KAAK2vC,IAAAA,CAAAA,GAAQ,GAAG,KACjF;AAAA,MAAImlC,QAAQ;AACZ,MAAI11F,OAAOqkE;AAEX,MAAIriD,QAAQ9Z,KAAKspF,sBAAsBjhC,MAAMy/B;AAC7C,MAAIttE,YAAYxa,KAAKynF,cAAcp/B,IAAAA;AACnC,WAAQvsD,IAAI,GAAGA,IAAI0e,UAAUze,UAAUyxF,QAAQrxB,UAAUrgE,KAAI;AAC5D,QAAIo7B,WAAW1c,UAAU1e,CACzB;AAAA,QAAGge,MAAMhO,OAAOorB,SAASrrB,SAASiO,MAAMjO,SAASqrB,SAASprB,KAAI;AAC7D,UAAIy9E,aAAajwF,KAAKuD,IAAIq6B,SAASrrB,OAAOiO,MAAMjO,KAChD;AAAA,UAAI29E,WAAWlwF,KAAKyS,IAAImrB,SAASprB,KAAKgO,MAAMhO,GAC5C;AAAA,UAAI8hF,cAAcpE,WAAWD,eAAe,KAAK;AACjD,UAAGqE,aAAa91F,MAAK;AACpB81F,qBAAa91F;AACb0xF,mBAAWD,aAAczxF,OAAO,KAAK;AAAA,MACrC;AAED,UAAI+1F,WAAWv0F,KAAKC,OAAOiwF,WAAWD,eAAe,KAAK,GAAA;AAC1DiE,eAASK;AACT/1F,cAAQ+1F;AACR/zE,YAAMjO,QAAQ29E;AAAAA,IACd;AAAA,EACD;AAED,MAAIsE,cAAchG;AAClB,MAAG0F,UAAUrxB,UAAS;AACrB2xB,kBAAc,IAAIp1E,KAAK2vC,KAAKp+C,eAAeo+C,KAAKn+C,SAAAA,GAAYm+C,KAAKl+C,QAAW,GAAA,GAAG,GAAG2P,MAAMjO,KACxF;AAAA,EAAA;AACD,SAAO,EACN2hF,OACA1hF,KAAKgiF,YAAAA;AAEN,GAEDT,uBAAuB,SAAUhlC,MAAM8T,UAAW18C,MACjD;AAAA,MAAI5T,QAAQ,IAAI6M,KAAK2vC,IACrBmlC,GAAAA,QAAQ;AACR/tE,SAAOA,QAAQ;AACf08C,aAAW7iE,KAAKkM,IAAI22D,WAAW,CAAA;AAE/B,MAAIjlC,WAAWl3B,KAAK2tF,qBAAqB9hF,OAAOswD,QAAAA;AAChDqxB,UAAQt2D,SAASs2D;AACjB3hF,UAAQqrB,SAASprB;AAEjB,MAAIiiF,eAAe5xB,WAAWqxB;AAE9B,MAAIO,cAAc;AACjB,QAAIvK,UAAU33E;AACd,WAAO2hF,QAAQrxB,UAAU;AACxB,UAAIgsB,OAAOnoF,KAAKioF,UAAUzE,SAAS,OAAO/jE,IAAAA;AAE1C0oE,WAAK1qC,SAAS,CAAA;AACd0qC,WAAK5pC,WAAW,CAChB4pC;AAAAA,WAAK1pC,WAAW,CAEhB;AAAA,UAAIuvC,cAAc;AAClB,UAAGvuE,OAAO,GAAE;AACXuuE,sBAAchuF,KAAKwlF,eAAe,IAAI9sE,KAAKyvE,KAAK16E,QAAY,IAAA,CAAA,CAAA;AAAA,MACjE,OAAS;AACJugF,sBAAchuF,KAAKwlF,eAAe,IAAI9sE,KAAKyvE,KAAK16E,QAAY,IAAA,CAAA,CAAA;AAAA,MAC5D;AAED,UAAI+/E,QAAQQ,eAAe7xB,UAAU;AACpC;AAAA,MACL,OAAW;AACNqxB,iBAASQ;AAAAA,MACT;AAEDxK,gBAAU2E;AAAAA,IACV;AACDt8E,YAAQ23E;AAAAA,EACR;AAED,MAAIgK,QAAQrxB,UAAU;AACrB,QAAI4xB,eAAe5xB,WAAWqxB;AAC9Bt2D,eAAWl3B,KAAK2tF,qBAAqB9hF,OAAOkiF,YAAAA;AAC5CliF,YAAQqrB,SAASprB;AAAAA,EACjB;AAED,SAAOD;AACP,GAEDoiF,yBAAyB,SAAS5lC,MAAM8T,UACvC;AAAA,MAAG9T,KAAK7L,WAAiB,MAAA,GAAG;AAE3B,WAAO,EACNgxC,OAAO,GACP1hF,KAAK,IAAI4M,KAAK2vC,IAEf,EAAA;AAAA,EAAA;AACD,MAAI0gC,UAAU/oF,KAAKsgE,OAAOjuD,KAAK/F,IAAItM,KAAKsgE,OAAOjuD,KAAKqrC,WAAW,IAAIhlC,KAAK2vC,IAAAA,CAAAA,GAAQ,GAAG,MACnF;AAAA,MAAImlC,QAAQ;AACZ,MAAI11F,OAAOqkE;AAEX,MAAIriD,QAAQ9Z,KAAKspF,sBAAsBjhC,MAAM0gC,OAC7C;AAAA,MAAIvuE,YAAYxa,KAAKynF,cAAcp/B,IACnC;AAAA,WAAQvsD,IAAI,GAAGA,IAAI0e,UAAUze,UAAUyxF,QAAQrxB,UAAUrgE,KAAI;AAC5D,QAAIo7B,WAAW1c,UAAU1e,CACzB;AAAA,QAAGge,MAAMhO,OAAOorB,SAASrrB,SAASiO,MAAMjO,SAASqrB,SAASprB,KAAI;AAC7D,UAAIy9E,aAAajwF,KAAKuD,IAAIq6B,SAASrrB,OAAOiO,MAAMjO,KAChD;AAAA,UAAI29E,WAAWlwF,KAAKyS,IAAImrB,SAASprB,KAAKgO,MAAMhO,GAC5C;AAAA,UAAIoiF,gBAAgB1E,WAAWD,cAAc;AAC7C,UAAG2E,eAAep2F,MAAK;AACtBo2F,uBAAep2F;AACf0xF,mBAAWD,aAAczxF,OAAO;AAAA,MAChC;AAQD,UAAIq2F,aAAa70F,KAAKC,OAAOiwF,WAAWD,cAAc,EAAA;AACtDzxF,cAAQq2F;AACRX,eAASW;AACTr0E,YAAMjO,QAAQ29E;AAAAA,IACd;AAAA,EACD;AAED,MAAIsE,cAAc/E;AAClB,MAAGyE,UAAUrxB,UAAS;AACrB2xB,kBAAc,IAAIp1E,KAAK2vC,KAAKp+C,YAAAA,GAAeo+C,KAAKn+C,SAAYm+C,GAAAA,KAAKl+C,WAAW,GAAG,GAAG2P,MAAMjO,KACxF;AAAA,EAAA;AACD,SAAO,EACN2hF,OACA1hF,KAAKgiF,YAEN;AAAA,GAEDM,gCAAgC,SAAS/lC,MAAM8T,UAAAA;AAC9C,MAAI2sB,YAAY9oF,KAAKsgE,OAAOjuD,KAAKqrC,WAAW,IAAIhlC,KAAK2vC,IACrD,CAAA;AAAA,MAAImlC,QAAQ;AACZ,MAAI11F,OAAOqkE;AAEX,MAAIkyB,qBAAqBvF,UAAUxsC,SAAa,IAAA,KAAK,KAAKwsC,UAAUtsC,WAAAA,IAAe,KAAKssC,UAAUpsC,WAAAA;AAClG,MAAI4xC,uBAAuBjmC,KAAK/L,SAAa,IAAA,KAAK,KAAK+L,KAAK7L,eAAe,KAAK6L,KAAK3L;AAErF,MAAIliC,YAAYxa,KAAKynF,cAAcp/B,IAAAA;AACnC,WAAQvsD,IAAI0e,UAAUze,SAAS,GAAGD,KAAK,KAAK0xF,QAAQrxB,UAAUrgE,KAAI;AACjE,QAAIo7B,WAAW1c,UAAU1e,CAAAA;AACzB,QAAGwyF,uBAAuBp3D,SAASrrB,SAASwiF,sBAAsBn3D,SAASprB,KAAI;AAC9E,UAAIy9E,aAAajwF,KAAKyS,IAAIuiF,sBAAsBp3D,SAASprB,GAAAA;AACzD,UAAI09E,WAAWlwF,KAAKuD,IAAIwxF,oBAAoBn3D,SAASrrB,KAAAA;AAIrD,UAAIqiF,gBAAgB3E,aAAaC,YAAY;AAC7C,UAAG0E,eAAep2F,MAAK;AACtBo2F,uBAAep2F;AACf0xF,mBAAWD,aAAczxF,OAAO;AAAA,MAChC;AAQD,UAAIq2F,aAAa70F,KAAKkM,IAAIlM,KAAKC,OAAOgwF,aAAaC,YAAY,EAAA,CAAA;AAC/D1xF,cAAQq2F;AACRX,eAASW;AACTG,6BAAuB9E;AAAAA,IACvB;AAAA,EACD;AAED,MAAIsE,cAAchF;AAClB,MAAG0E,UAAUrxB,UAAS;AACrB2xB,kBAAc,IAAIp1E,KAAK2vC,KAAKp+C,YAAAA,GAAeo+C,KAAKn+C,SAAAA,GAAYm+C,KAAKl+C,QAAW,GAAA,GAAG,GAAGmkF,oBAClF;AAAA,EAAA;AACD,SAAO,EACNd,OACA1hF,KAAKgiF,YAEN;AAAA,GAEDV,qBAAqB,SAAU/kC,MAAM8T,UAAU18C,MAG9C;AAAA,MAAI5T,QAAQ7L,KAAKuuF,mBAAmB,EAAEl8E,MAAMg2C,MAAMr8B,KAAK,QAAQ9iB,MAAM,SAAA,CAAA,GACpEskF,QAAQ;AACT/tE,SAAOA,QAAAA;AACP08C,aAAW7iE,KAAKkM,IAAI22D,WAAW,CAC/BA;AAAAA,aAAW7iE,KAAKC,MAAM4iE,QAAAA;AAEtB,QAAMqyB,kBAAkBxuF,KAAKyuF,mBAAmB5iF,KAEhD;AAAA,MAAI6iF,gBAAgB1uF,KAAKouF,+BAA+BviF,OAAOswD;AAC/DqxB,WAASkB,cAAclB;AAEvB3hF,UAAQ6iF,cAAc5iF;AAEtB,MAAI6iF,gBAAgB;AACpB,MAAIC,cAAc,CAClB;AAAA,MAAIC,eAAe;AAEnB,SAAOrB,QAAQrxB,UAAU;AACxB,QAAI2yB,WAAW9uF,KAAKsgE,OAAOjuD,KAAKisC,UAAU,IAAI5lC,KAAK7M,KAEnD,CAAA;AAAA,QAAIkjF,oBAAoB;AACxB,QAAGljF,MAAM4B,cAAcqhF,SAASrhF,QAAAA,GAAU;AACzCqhF,iBAAW9uF,KAAKsgE,OAAOjuD,KAAK/F,IAAIwiF,UAAAA,IAAc,KAC9CC;AAAAA,0BAAoB;AAAA,IACpB;AAED,QAAIjH,SAAS,IAAIpvE,KAAKo2E,SAAS7kF,eAAe6kF,SAAS5kF,SAAAA,GAAY4kF,SAAS3kF,QAAW,GAAA,IAAI,IAAG,IAAG,GAAA,EAAKsD,QAEtG;AAAA,QAAGq6E,WAAW6G,eAAc;AAC3BC,oBAAc5uF,KAAKynF,cAAcqH,QACjCD;AAAAA,qBAAe7uF,KAAKgpF,kBAAkB8F,QAAAA;AACtCH,sBAAgB7G;AAAAA,IAChB;AAED,QAAIhwF,OAAOqkE,WAAWqxB;AACtB,QAAI/I,YAAYzkF,KAAK6nF,mBAAmBh8E,OAAOkjF,iBAE/C;AAAA,QAAA,CAAIH,YAAY7yF,UAAAA,CAAW8yF,cAAa;AACvChjF,cAAQ7L,KAAKsgE,OAAOjuD,KAAK/F,IAAIT,OAAAA,IAAW,KACxC;AAAA;AAAA,IACA;AAED,QAAG+iF,YAAYA,YAAY7yF,SAAS,CAAG+P,EAAAA,OAAO24E,WAAU;AACvD,UAAG3sF,OAAO+2F,cAAa;AACtBrB,iBAASqB;AACThjF,gBAAQ7L,KAAKsgE,OAAOjuD,KAAK/F,IAAIT,WAAW,KAAA;AACxC;AAAA,MACA;AAAA,IACD;AAED,QAAImjF,aAAa;AACjB,QAAIC,eAAe;AACnB,QAAIC,eAAe;AACnB,aAAQpzF,IAAI8yF,YAAY7yF,SAAS,GAAGD,KAAK,GAAGA,KAAI;AAC/C,UAAG8yF,YAAY9yF,GAAG+P,QAAQ44E,YAAY,KAAKmK,YAAY9yF,CAAAA,EAAGgQ,OAAO24E,YAAY,GAAE;AAC9EuK,qBAAa;AACbC,uBAAeL,YAAY9yF,CAC3BozF;AAAAA,uBAAeN,YAAY9yF,IAAE,CAAA;AAC7B;AAAA,MACA;AAAA,IACD;AAED,QAAGkzF,YAAW;AAIb,UAAGvK,cAAcwK,aAAanjF,OAAOhU,QAAQm3F,aAAahG,iBAAgB;AACzEuE,iBAASyB,aAAahG;AACtBp9E,gBAAQ7L,KAAKsgE,OAAOjuD,KAAK/F,IAAIT,OAAQojF,CAAAA,aAAahG,iBAAiB,QACnE;AAAA,MAAA,WAEQuF,CAAAA,mBAAmB12F,QAAS2sF,YAAU,KAAKwK,aAAal1E,aAAa;AAC7EyzE,iBAAS11F;AACT+T,gBAAQ7L,KAAKsgE,OAAOjuD,KAAK/F,IAAIT,OAAQ/T,CAAAA,MAAM;MAC3C,WAAS02F,iBAAgB;AAIzB,YAAG12F,QAAS2sF,YAAU,KAAKwK,aAAal1E,aAAa;AACpDyzE,mBAAS11F;AACT+T,kBAAQ7L,KAAKsgE,OAAOjuD,KAAK/F,IAAIT,OAAAA,CAAQ/T,MAAM,QACjD;AAAA,QAAA,OAAW;AAEL01F,mBAAU/I,YAAU,KAAKwK,aAAal1E;AACtC,cAAGm1E,cAAa;AACfrjF,oBAAQ,IAAI6M,KAAK7M,MAAM5B,YAAAA,GAAe4B,MAAM3B,SAAAA,GAAY2B,MAAM1B,QAAAA,GAAW,GAAG,GAAG+kF,aAAapjF;UACnG,OAAW;AACJD,oBAAQ7L,KAAKsgE,OAAOjuD,KAAKisC,UAAUzyC,KACnC;AAAA,UAAA;AAAA,QACD;AAAA,MAGN,OAAS;AACJ,YAAIsjF,gBAAgBnvF,KAAK6oF,mBAAmBh9E,KAC5C;AAAA,YAAGsjF,iBAAiBr3F,MAAK;AACxB01F,mBAAS2B;AACTtjF,kBAAQ7L,KAAKioF,UAAUp8E,OAAO,QAAQ4T;QAC5C,OAAU;AACJivE,0BAAgB1uF,KAAKouF,+BAA+BviF,OAAO/T;AAC3D01F,mBAASkB,cAAclB;AACvB3hF,kBAAQ6iF,cAAc5iF;AAAAA,QACtB;AAAA,MACD;AAAA,IACL,OAAQ;AACJ,UAAGD,MAAMywC,SAAAA,MAAe,KAAKzwC,MAAM2wC,WAAAA,MAAiB,KAAK3wC,MAAM6wC,WAAAA,MAAiB,GAAE;AACjF,YAAInxC,OAAOvL,KAAKovF,wBAAwBvjF,OAAO;AAC/C,YAAGN,KAAKkC,QAAc5B,MAAAA,MAAM4B,QAAU,GAAA;AACrC,cAAIlC,OAAOvL,KAAKsgE,OAAOjuD,KAAK/F,IAAIT,OAAAA,IAAW,KAC3C;AAAA,cAAIwjF,QAAQrvF,KAAKynF,cAAcl8E;AAC/B,cAAG8jF,MAAMtzF,QAAO;AACf,gBAAIuzF,eAAeD,MAAMA,MAAMtzF,SAAS,CACxCwP;AAAAA,iBAAKkzC,WAAW6wC,aAAajD;UAC7B;AAAA,QACD;AACDxgF,gBAAQN;AAAAA,MAEb,OAAU;AACLM,gBAAQ7L,KAAKovF,wBAAwB,IAAI12E,KAAK7M,QAAQ,IAAI,MAC1D;AAAA,MAAA;AAAA,IAED;AAAA,EACD;AAED,MAAI2hF,QAAQrxB,UAAU;AACrB,QAAI4xB,eAAe5xB,WAAWqxB;AAC9BkB,oBAAgB1uF,KAAKouF,+BAA+BviF,OAAOkiF,YAAAA;AAC3DP,aAASkB,cAAclB;AACvB3hF,YAAQ6iF,cAAc5iF;AAAAA,EACtB;AAED,SAAOD;AACP,GACDshF,yBAAyB,SAAU9kC,MAAM8T,UAAU18C,MAAAA;AAClD,MAAI5T,QAAQ,IAAI6M,KAAK2vC,IAAAA,GACpBmlC,QAAQ;AACT/tE,SAAOA,QAAQ;AACf08C,aAAW7iE,KAAKkM,IAAI22D,WAAW;AAC/BA,aAAW7iE,KAAKC,MAAM4iE,QAEtB;AAAA,MAAIuyB,gBAAgB1uF,KAAKiuF,wBAAwBpiF,OAAOswD,QAAAA;AACxDqxB,WAASkB,cAAclB;AAEvB3hF,UAAQ6iF,cAAc5iF;AAEtB,MAAI6iF,gBAAgB;AACpB,MAAIC,cAAc,CAAA;AAClB,MAAIC,eAAe;AAEnB,MAAIL,kBAAkBxuF,KAAKyuF,mBAAmB5iF;AAE9C,SAAO2hF,QAAQrxB,UAAU;AACxB,QAAI2yB,WAAW9uF,KAAKsgE,OAAOjuD,KAAKisC,UAAU,IAAI5lC,KAAK7M,KAAQ4B,CAAAA,EAAAA,QAAAA;AAC3D,QAAGqhF,aAAaH,eAAc;AAC7BC,oBAAc5uF,KAAKynF,cAAc57E,KACjCgjF;AAAAA,qBAAe7uF,KAAKgpF,kBAAkBn9E,KAAAA;AACtC8iF,sBAAgBG;AAAAA,IAEhB;AAED,QAAIh3F,OAAOqkE,WAAWqxB;AACtB,QAAI/I,YAAYzkF,KAAK6nF,mBAAmBh8E,KAExC;AAAA,QAAA,CAAI+iF,YAAY7yF,UAAW8yF,CAAAA,cAAa;AACvChjF,cAAQ7L,KAAKsgE,OAAOjuD,KAAK/F,IAAItM,KAAKsgE,OAAOjuD,KAAKisC,UAAUzyC,QAAQ,GAAG,KAAA;AACnE;AAAA,IACA;AAED,QAAG+iF,YAAY,CAAA,EAAG/iF,SAAS44E,WAAU;AACpC,UAAG3sF,QAAQ+2F,cAAa;AACvBrB,iBAASqB;AACT,YAAI/2F,QAAQ+2F,cAAc;AACzBhjF,kBAAQ,IAAI6M,KAAK7M,MAAM5B,YAAe4B,GAAAA,MAAM3B,YAAY2B,MAAM1B,QAAAA,GAAW,GAAG,GAAGykF,YAAYA,YAAY7yF,SAAS,CAAG+P,EAAAA,GAAAA;AACnH;AAAA,QACN,OAAU;AACJD,kBAAQ7L,KAAKsgE,OAAOjuD,KAAK/F,IAAIT,OAAO,GAAG,KAAA;AACvCA,kBAAQ7L,KAAKsgE,OAAOjuD,KAAKisC,UAAUzyC;QACnC;AACD;AAAA,MACA;AAAA,IACD;AAED,QAAImjF,aAAa;AACjB,QAAIC,eAAe;AACnB,aAAQnzF,IAAI,GAAGA,IAAI8yF,YAAY7yF,QAAQD,KAAI;AAC1C,UAAG8yF,YAAY9yF,CAAG+P,EAAAA,SAAS44E,aAAamK,YAAY9yF,CAAAA,EAAGgQ,MAAM24E,WAAU;AACtEuK,qBAAa;AACbC,uBAAeL,YAAY9yF,CAAAA;AAC3B;AAAA,MACA;AAAA,IACD;AACD,QAAGkzF,YAAW;AAEb,UAAGvK,cAAcwK,aAAapjF,SAAS/T,QAAQm3F,aAAahG,iBAAgB;AAC3EuE,iBAASyB,aAAahG;AACtBp9E,gBAAQ7L,KAAKsgE,OAAOjuD,KAAK/F,IAAIT,OAAOojF,aAAahG,iBAAiB,QAAA;AAAA,MACvE,WAAanxF,QAASm3F,aAAaj1E,YAAYyqE,YAAU,IAAI;AACxD+I,iBAAS11F;AACT+T,gBAAQ7L,KAAKsgE,OAAOjuD,KAAK/F,IAAIT,OAAO/T,MAAM,QAC/C;AAAA,MAAA,OAAS;AACJ,YAAIq3F,gBAAgBnvF,KAAK6oF,mBAAmBh9E,KAAAA;AAC5C,YAAGsjF,iBAAiBr3F,MAAK;AACxB01F,mBAAS2B;AAET,cAAIX,iBAAiB;AACpB3iF,oBAAQ7L,KAAKsgE,OAAOjuD,KAAK/F,IAAIT,OAAOsjF,eAAe,QAC1D;AAAA,UAAA,OAAa;AACNtjF,oBAAQ7L,KAAKioF,UAAUp8E,OAAO,QAAQ4T;UACtC;AAAA,QACP,OAAU;AACJivE,0BAAgB1uF,KAAKiuF,wBAAwBpiF,OAAO/T,IACpD01F;AAAAA,mBAASkB,cAAclB;AACvB3hF,kBAAQ6iF,cAAc5iF;AAAAA,QACtB;AAAA,MACD;AAAA,IACL,OAAQ;AACJD,cAAQ7L,KAAK4oF,0BAA0B/8E,OAAO,MAAA;AAAA,IAC9C;AAAA,EACD;AAED,MAAI2hF,QAAQrxB,UAAU;AACrB,QAAI4xB,eAAe5xB,WAAWqxB;AAC9BkB,oBAAgB1uF,KAAKiuF,wBAAwBpiF,OAAOkiF,YACpDP;AAAAA,aAASkB,cAAclB;AACvB3hF,YAAQ6iF,cAAc5iF;AAAAA,EACtB;AAED,SAAOD;AACP,GAED0iF,oBAAoB;AACnB,MAAIxnF,WAAY/G,KAAK2mF,gBAAgBvE,4BAA4BniF,MAAOD,KAAK2mF,iBAAiB//E,SAAAA;AAC9F,SAAO5G,KAAKuvF,oBAAoBxoF,SAASsL,MAAMtL,SAASmC,MAAMnC,SAASilB,GACvE;AAAA,GAEDujE,qBAAqB,SAAUC,WAAWtmF,MAAMumF;AAC/C,MAAIzrF,SAAS,IAAI0U,KAAK82E,SAAAA;AAEtB,MAAIxvF,KAAKyoF,YAAYzkF,QAAQkF,IAAAA,GAAO;AACnC,WAAOlF;AAAAA,EACP;AAEDA,WAAShE,KAAKsgE,OAAOjuD,KAAKnJ,OAAO,UAAUlF,MAE3C;AAAA,MAAIyrF,aAAa,SAAA,CAAUA,WAAW;AACrC,QAAIC,gBAAgB1vF,KAAK4oF,0BAA0B5kF,QAAQkF,IAAAA;AAC3D,QAAIymF,cAAc3vF,KAAKovF,wBAAwBprF,QAAQkF,IACvD;AAAA,QAAI5P,KAAKkM,IAAIkqF,gBAAgBF,SAAcl2F,KAAAA,KAAKkM,IAAIgqF,YAAYG,cAAc;AAC7E3rF,eAAS0rF;AAAAA,IACb,OAAU;AACN1rF,eAAS2rF;AAAAA,IACT;AAAA,EACJ,WAAaF,aAAa,QAAQ;AAC/BzrF,aAAShE,KAAKovF,wBAAwBprF,QAAQkF,IACjD;AAAA,EAAA,OAAS;AACNlF,aAAShE,KAAK4oF,0BAA0B5kF,QAAQkF,IAAAA;AAAAA,EAChD;AACD,SAAOlF;AACP,GAED4kF,2BAA2B,SAAUv2E,OAAMnJ;AAC1C,SAAOlJ,KAAK4vF,2BAA2Bv9E,OAAMnJ,MAAM;AACnD,GAEDkmF,yBAAyB,SAAU/8E,OAAMnJ,MACxC;AAAA,MAAIlF,SAAShE,KAAK4vF,2BAA2Bv9E,OAAMnJ,MAAAA,EAEnD;AAAA,SAAOlJ,KAAKsgE,OAAOjuD,KAAK/F,IAAItI,QAAQ,GAAGkF,IAAAA;AACvC,GAED2mF,uBAAuB,SAASx9E,OAAMo9E,WAAWj1E,WAAAA;AAChD,MAAI3O,QAAQ,IAAI6M,KAAKrG,KAAAA;AACrB,MAAIy9E,aAAa;AACjB,MAAIC,aAAa;AACjB,MAAA,CAAI/vF,KAAKynF,cAAc57E,OAAO9P,QAAO;AACpC8P,YAAQ7L,KAAKuvF,oBAAoB1jF,OAAO,OAAO4jF,YAAY,IAAI,SAAS,QACxE;AAAA,QAAGA,YAAY,GAAE;AAChB5jF,cAAQ,IAAI6M,KAAK7M,MAAM4B,YAAY,CACnCsiF;AAAAA,mBAAa;AAAA,IACb;AACDv1E,gBAAYxa,KAAKynF,cAAc57E,KAC/B;AAAA,EAAA;AAED,MAAIkN,QAAQ/Y,KAAK6nF,mBAAmBh8E;AACpC,MAAGkkF,YAAW;AACbh3E,YAAQ/Y,KAAK6nF,mBAAmB,IAAInvE,KAAK7M,MAAM4B,QAAAA,IAAY,CAAIsiF,GAAAA,UAAAA;AAAAA,EAC/D;AACD,MAAGN,YAAY,GAAE;AAChB,aAAQ3zF,IAAI,GAAGA,IAAI0e,UAAUze,QAAQD,KAAI;AACxC,UAAG0e,UAAU1e,GAAG+P,SAASkN,OAAM;AAC9B+2E,qBAAa,IAAIp3E,KAAK7M,MAAM5B,YAAe4B,GAAAA,MAAM3B,YAAY2B,MAAM1B,QAAAA,GAAW,GAAG,GAAGqQ,UAAU1e,CAAAA,EAAG+P;AACjG;AAAA,MACA;AAAA,IACD;AAAA,EACJ,OAAO;AACJ,aAAQ/P,IAAI0e,UAAUze,SAAS,GAAGD,KAAK,GAAGA,KAAI;AAC7C,UAAG0e,UAAU1e,CAAGgQ,EAAAA,OAAOiN,OAAM;AAC5B+2E,qBAAa,IAAIp3E,KAAK7M,MAAM5B,eAAe4B,MAAM3B,SAAAA,GAAY2B,MAAM1B,QAAAA,GAAW,GAAG,GAAGqQ,UAAU1e,CAAGgQ,EAAAA,GAAAA;AACjG;AAAA,MACL,WAAa0O,UAAU1e,CAAGgQ,EAAAA,MAAMiN,SAASyB,UAAU1e,CAAG+P,EAAAA,SAASkN,OAAO;AACjE+2E,qBAAa,IAAIp3E,KAAK7M,MAAM5B,YAAAA,GAAe4B,MAAM3B,SAAY2B,GAAAA,MAAM1B,QAAW,GAAA,GAAG,GAAG4O,KAAAA;AACpF;AAAA,MACA;AAAA,IACD;AAAA,EACD;AAED,SAAO+2E;AACP,GACDE,uBAAuB,SAAS39E,OAAMnJ,MAAMumF,WAC3C;AAAA,MAAI5jF,QAAQ,IAAI6M,KAAKrG;AACrB,MAAImI,YAAYxa,KAAKynF,cAAc57E,KAAAA;AACnC,MAAIikF,aAAa9vF,KAAK6vF,sBAAsBhkF,OAAO4jF,WAAWj1E,SAAAA;AAC9D,OAAIs1E,YAAW;AACd,QAAGL,YAAY,GAAE;AAChB5jF,cAAQ7L,KAAKk8D,iBAAiBrwD,OAAO4jF,WAAWvmF,IAAAA;AAChD2C,cAAQ7L,KAAKsgE,OAAOjuD,KAAKisC,UAAUzyC,KACvC;AAAA,IAAA,OAAQ;AACJA,cAAQ7L,KAAKk8D,iBAAiBrwD,OAAO4jF,WAAW,KAAA;AAChD5jF,cAAQ7L,KAAKsgE,OAAOjuD,KAAKisC,UAAUzyC,KAAAA;AACnCA,cAAQ7L,KAAKsgE,OAAOjuD,KAAK/F,IAAIT,OAAO,GAAG,KACvCA;AAAAA,cAAQ,IAAI6M,KAAK7M,MAAM4B,QAAY,IAAA,CAAA;AAAA,IACnC;AACD+M,gBAAYxa,KAAKynF,cAAc57E;AAC/BikF,iBAAa9vF,KAAK6vF,sBAAsBhkF,OAAO4jF,WAAWj1E;EAC1D;AACD,MAAGi1E,YAAY,GAAE;AAEhBK,iBAAa9vF,KAAKsgE,OAAOjuD,KAAK/F,IAAIwjF,YAAAA,IAAgB5mF,IAAAA;AAAAA,EAClD;AACD,SAAO4mF;AACP,GAEDF,4BAA4B,SAAUv9E,OAAMnJ,MAAM+mF,WACjD;AAAA,MAAG/mF,SAAS,UAAUA,SAAS,UAAS;AACvC,WAAOlJ,KAAKgwF,sBAAsB39E,OAAMnJ,MAAM+mF;EAC9C;AAED,MAAIvH,YAAY1oF,KAAKmnF,cAAcj+E,OAClCy/E,iBAAiB3oF,KAAKwI,MAAMkgF,YAAY,CAEzC;AAAA,MAAI1kF,SAASqO;AAGb,MAAI69E,cAAc,KACjBpmC,QAAQ;AAET,SAAQ9pD,CAAAA,KAAKyoF,YAAYzkF,QAAQkF,IAAO,GAAA;AACvC,QAAIy/E,kBAAmB3oF,CAAAA,KAAKyoF,YAAYzkF,QAAQ2kF,cAAiB,GAAA;AAGhE,UAAIsH,YAAY,GAAG;AAClBjsF,iBAAShE,KAAK4oF,0BAA0B5kF,QAAQ2kF,cACrD;AAAA,MAAA,OAAW;AACN3kF,iBAAShE,KAAKovF,wBAAwBprF,QAAQ2kF,cAAAA;AAAAA,MAC9C;AAED,UAAI3oF,KAAKyoF,YAAYzkF,QAAQkF,IAAO,GAAA;AACnC;AAAA,MACA;AAAA,IACD;AAED4gD;AACA,QAAIA,QAAQomC,aAAa;AACxBlwF,WAAKsgE,OAAOlzB,OAAO,OAAO,4BAAA;AAC1B,aAAO;AAAA,IACP;AAED,QAAI4tB,WAAWh3D,OAAO65C,kBACtB75C;AAAAA,aAAShE,KAAKsgE,OAAOjuD,KAAK/F,IAAItI,QAAQisF,WAAW/mF,IAAAA;AAEjDlF,aAAShE,KAAKsgE,OAAOrF,oBAAoBj3D,QAAQg3D,UAAUi1B,WAAW/mF,IACtE;AAAA,QAAIlJ,KAAKsgE,OAAOjuD,KAAKnJ,OAAO,QAAW,GAAA;AACtClF,eAAShE,KAAKsgE,OAAOjuD,KAAKnJ,OAAO,QAAUlF,EAAAA,MAAAA;AAAAA,IAC3C;AAAA,EACD;AACD,SAAOA;AACP,GAMDmnF,aAAa;AACZ,MAAI52E,WAAWvU,KAAK4vD,UAAAA;AACpB,MAAIt8C,QAAQiB,SAASjB;AAErB,MAAI68E,aAAa,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,CAEpC;AAAA,WAAQr0F,KAAKyY,SAASjB,OAAM;AAAA,EAI3B;AAED,MAAI88E,kBAAkBpwF,KAAKqwF,gBAAgB97E,SAAS2F,KAAAA;AAEpD,MAAIlW,SAAS;AACbmsF,aAAWhnF,SAAQ,SAAUP,KAC5B;AAAA,QAAG5E,QAAO;AACT;AAAA,IACA;AAED,QAAIssF,YAAYh9E,MAAM1K;AACtB,QAAG0nF,cAAc,MAAK;AAErBtsF,eAASosF;AAAAA,IACT,WAAQ10F,MAAMoO,QAAQwmF,SAAAA,GAAW;AAEjCtsF,eAAShE,KAAKqwF,gBAAgBC,SAAAA;AAAAA,IAC9B;AAAA,EACD,GAAE3oF,KAAK3H;AAER,SAAOgE;AAEP,GAEDqsF,iBAAiB,SAASvN,YAAAA;AACzB,MAAIA,WAAW/mF,WAAW,GAAG;AAC5B,WAAO;AAAA,EACP;AACD,MAAIiI,SAAS;AACb,WAASlI,IAAI,GAAGA,IAAIgnF,WAAW/mF,QAAQD,KAAK,GAAG;AAC9C,QAAIgnF,WAAWhnF,CAAOgnF,MAAAA,WAAWhnF,IAAI,CAAA,GAAI;AACxCkI,eAAS;AAAA,IACT;AAAA,EACD;AACD,SAAOA;AACP,GAEDyqF,oBAAoB,SAAUp8E,OAAAA;AAC7B,MAAIm8E,kBAAkB;AACtBxuF,OAAKynF,cAAcp1E,OAAMlJ,QAAQ,SAAS+tB;AACzC,QAAIA,SAASnd,cAAc,MAAMmd,SAASld,YAAY,IAAG;AACxDw0E,wBAAkB;AAAA,IAClB;AAAA,EACJ,CACE;AAAA,SAAOA;AACP,EC55CF;AAAA,MAAe+B,+BAAA,EACdC,gCAAgC,SAASC;AAiBxC,MAAIA,CAAAA,2BAA0B;AAC7B,WAAO;AAAA,EACP;AACD,WAAQ30F,KAAK20F,2BAA0B;AACtC,QAAGA,0BAA0B30F,CAAa20F,KAAAA,OAAAA,0BAA0B30F,OAAO,UAAS;AACnF,aAAO;AAAA,IACP;AAAA,EACD;AAED,SAAO;AACP,GACD40F,qBAAqB,SAASprF,SAAAA;AAC7B,MAAIqrF,0BAA0BrrF,QAAOsxC;AACrC,MAAI+3B,eAAerpE,QAAOoqE;AAC1B,MAAG1vE,KAAKwwF,+BAA+BG,uBAAyB,GAAA;AAC/D,aAAQ70F,KAAKwJ,SAAO;AACnBqpE,qBAAe7yE;AACf;AAAA,IACA;AAAA,EACD;AACD,SAAO6yE;AACP,GACDiiB,+BAA+B,SAASziF,MAAM7I,SAAAA;AAC7C,MAAIA,SAAQ;AACX,aAASylD,SAASzlD,SAAQ;AACzB,UAAI0+D,WAAW1+D,QAAOylD,KACtB;AAAA,UAAI58C,KAAK48C,KAAQ,GAAA;AAChB,YAAI8lC,aAAa7sB,SAAS71D,KAAK48C;AAC/B,YAAI8lC,YAAY;AACf,iBAAOA;AAAAA,QACP;AAAA,MACD;AAAA,IACD;AAAA,EACD;AACD,SAAO;AACP,EAAA;ACrDa,SAAAC,kCACd;AAAA,WAASC,wBAAwBjc,qBAAAA;AAChC,WAAOA,oBAAoBvrE,IAAI,SAASgZ,KAAAA;AACvC,UAAGA,OAAOA,IAAIitD,aAAY;AACzB,eAAOjtD,IAAIitD;AAAAA,MACf,OAAU;AACN,eAAOjtD;AAAAA,MACP;AAAA,IACD,CAAEtmB,EAAAA,KAAAA,EAAOT,KAAK,GAAA;AAAA,EACf;AAED,MAAIw1F,mBAAmB,CAAA;AAEvB,WAASC,uBAAuBnc,qBAAqBoc,SACpD;AAAA,WAAOA,QAAQC,eAAerc,oBAAoBvrE,IAAI,SAASo6D,YAC9D;AAAA,UAAI2L,aAAc3L,cAAcA,WAAW6L,cAAe7L,WAAW6L,cAAc7L;AACnF,aAAOutB,QAAQE,oBAAoB9hB;IACnC,CACD,CAAA;AAAA,EAAA;AACD,WAAS+hB,mCAAmCvc,qBAAqBoc,SAAAA;AAChE,QAAI73E,MAAM03E,wBAAwBjc,mBAClC;AAAA,QAAA,CAAIA,oBAAoB/4E,QAAO;AAC9B,aAAO;AAAA,IACV,WAAW+4E,oBAAoB/4E,WAAW,GAAE;AACzC,aAAOm1F,QAAQE,oBAAoB/3E,GAAAA,EAAKpS;AAAAA,IAC3C,WAAY+pF,iBAAiB33E,GAAK,GAAA;AAC/B,aAAO23E,iBAAiB33E,GAAAA,EAAKpS;AAAAA,IAChC,OAAS;AACN,UAAIqqF,eAAeL,uBAAuBnc,qBAAqBoc;AAE/DF,uBAAiB33E,GAAAA,IAAOi4E;AACxB,aAAOJ,QAAQK,YAAYD,YAAAA;AAAAA,IAC3B;AAAA,EACD;AAED,SAAO,EACND,mCAEF;AAAA;AC/BA,MAAMG,2BAA2BV;AAEjC,SAASW,gBAAiB1uF,QACzB/C;AAAAA,OAAKsgE,SAASv9D;AACd/C,OAAK0xF,aAAa;AAClB1xF,OAAK2xF,gBAAgBtxF;AACrBL,OAAKsgE,OAAO94D,YAAY,iBAAgB,WACvC;AAAA,QAAGxH,KAAKsgE,OAAOh7D,OAAOsxC,oBAAmB;AACxC52C,WAAK4xF,kBAAkBrB,6BAA6BC,+BAA+BxwF,KAAKsgE,OAAOh7D,OAAOsxC,kBACtG;AAAA,IAAA;AAAA,EACH,GAAGjvC,KAAK3H,IAAAA,CAAAA;AAEPA,OAAKsgE,OAAO94D,YAAY,uBAAsB,WAC7CxH;AAAAA,SAAK6xF,uBACP;AAAA,EAAA,GAAGlqF,KAAK3H,IAAAA,CAAAA;AACPA,OAAKsgE,OAAO94D,YAAY,wBAAuB,WAAA;AAC9CxH,SAAK6xF,uBAAAA;AAAAA,EACP,GAAGlqF,KAAK3H,IAAAA,CAAAA;AACR;AAEAyxF,gBAAgB91F,YAAY,EAC3B+1F,YAAY,CAAE,GACdI,0BAA0B,SAAU/qF,UAAAA;AACnC,MAAIgzD,OAAOhzD,SAASgzD;AACpB,MAAIA,QAAShzD,CAAAA,SAASuM,OAAO;AAC5BvM,aAASuM,QAAQvM,SAASuM,SAAS,CAAA;AACnC,aAASxX,IAAI,GAAGA,IAAIi+D,KAAKh+D,QAAQD,KAAK;AACrCiL,eAASuM,MAAMxX,KAAKi+D,KAAKj+D,CAAAA;AACzB,UAAMi+D,EAAAA,KAAKj+D,CAAcJ,aAAAA,QAAQ;AAChCqL,iBAASuM,MAAMxX,CAAOi+D,IAAAA,CAAAA,CAAAA,KAAKj+D,CAC3B;AAAA,MAAA;AAAA,IACD;AAAA,EACD;AACMiL,SAAAA,SAASgzD;AAChB,SAAOhzD;AACP,GACDoqF,gBAAgB,WACf;AAAA,MAAIY,YAAY,CAChB;AAAA,MAAIpnF,OAAO/D;AACX,MAAGlL,MAAMoO,QAAQa,KAAK,CAAA,CAAA,GAAI;AACzBonF,gBAAYpnF,KAAK,CAAG/O,EAAAA,MAAAA;AAAAA,EACvB,OAAO;AACJ,aAAQE,IAAI,GAAGA,IAAI8K,UAAU7K,QAAQD,KAAI;AACxCi2F,gBAAU/yF,KAAK4H,UAAU9K,CAAAA,CAAAA;AAAAA,IACzB;AAAA,EACD;AAED,MAAIk2F,cAAc,IAAIC;AAEtB,MAAIjuF;AACJ+tF,YAAU5oF,SAAQ,SAASs4E,UAAAA;AAC1B,QAAIz9E,CAAAA,QAAO;AACVA,eAASy9E;AAAAA,IACb,OAAS;AACLz9E,eAAShE,KAAKkyF,0BAA0BF,YAAYnO,MAAM7/E,QAAQy9E,QAClE,CAAA;AAAA,IAAA;AAAA,EAEJ,GAAI95E,KAAK3H,IAAAA,CAAAA;AACP,SAAOA,KAAKmyF,eAAenuF,MAAAA;AAC3B,GAEDkuF,2BAA2B,SAAS5sF;AACnC,MAAI8sF,UAAU,IAAI1L,yBAAyB1mF,KAAKsgE,QAAQ+xB,wBAAsBryF,KAAKsgE,MAAAA,CAAAA;AACnF8xB,UAAQnrF,KAAKnH,OAAO4pD;AAEpB,MAAI4oC,iBAAiBtyF,KAAK8xF,yBAAyBxsF,OAAAA;AACnD,MAAGgtF,eAAerO,aAAY;AAC7B,aAAQnoF,KAAKw2F,eAAerO,aAAY;AACvCqO,qBAAerO,YAAYnoF,CAAKkE,IAAAA,KAAK8xF,yBAAyBQ,eAAerO,YAAYnoF,CAAAA,CAAAA;AAAAA,IACzF;AAAA,EACD;AACDs2F,UAAQlI,WAAWoI,cAEnB;AAAA,SAAOF;AACP,GAEDD,gBAAgB,SAAUI,gBAAAA;AACzB,MAAIxrF;AAEJ,OAAKwrF,gBAAgB;AACpBA,qBAAiB,CAAA;AAAA,EACjB;AAED,MAAIA,eAAe3iC,WAAU;AAC5B7oD,eAAWqmD,KAAWmlC,eAAe3iC,UACxC,CAAA;AAAA,EAAA,WAAa2iC,eAAeh+E,UAAU;AACnCxN,eAAWqmD,KAAWmlC,eAAeh+E,QAAAA;AAAAA,EACxC,OAAS;AACNxN,eAAWqmD,KAAWmlC,cAAAA;AAAAA,EACtB;AAED,MAAIC,WAAWplC,KAAWptD,KAAKwyF,SAASC,SAASl+E,QACjDgyC;AAAAA,QAAYx/C,UAAUyrF,QAAAA;AAEtB,SAAOxyF,KAAKkyF,0BAA0BnrF;AACtC,GAED2rF,aAAa,SAAUzrF,IACtBA;AAAAA,OAAKA,MAAM;AACX,MAAIw6E,WAAWzhF,KAAK0xF,WAAWzqF,EAAAA;AAC/B,OAAIw6E,UAAS;AACZzhF,SAAK6xF,uBACLpQ;AAAAA,eAAWzhF,KAAK0xF,WAAWzqF,EAC3B;AAAA,EAAA;AAED,SAAOw6E;AACP,GAEDkR,cAAc,WACb;AAAA,MAAIpwE,MAAM,CACV;AAAA,WAASzmB,KAAKkE,KAAK0xF,YAAY;AAC9BnvE,QAAIvjB,KAAKgB,KAAK0yF,YAAY52F,CAC1B,CAAA;AAAA,EAAA;AACD,SAAOymB;AACP,GAEDqwE,iBAAiB,SAASzkF,MACzB;AAAA,MAAI7I,UAAStF,KAAKsgE,OAAOh7D;AACzB,MAAI6I,KAAK7I,QAAOqxC,iBAAoB,GAAA;AACnC,WAAO32C,KAAK0yF,YAAYvkF,KAAK7I,QAAOqxC,iBACpC,CAAA;AAAA,EAAA;AAED,MAAIrxC,QAAOsxC,oBAAoB;AAC9B,QAAI6qC;AACJ,QAAIoP;AACJ,QAAIgC;AACJ,QAAG7yF,KAAK2xF,kBAAkB,OAAM;AAC/BkB,yBAAmBvtF,QAAOoqE;AAAAA,IAC9B,OAAQ;AACJmjB,yBAAmBtC,6BAA6BG,oBAAoBprF,OAAAA;AAAAA,IACpE;AACD,QAAG5J,MAAMoO,QAAQqE,KAAK0kF,gBAAmB,CAAA,GAAA;AAExC,UAAGvtF,QAAOuxC,4BAA2B;AACpCg6C,qBAAaW,yBAAyBH,mCAAmCljF,KAAK0kF,gBAAmB7yF,GAAAA,IAAAA;AAAAA,MACtG,OAAW;AACNyhF,mBAAWzhF,KAAKoxF,oBAAoBjjF,KAAK0kF,gBACzC,CAAA;AAAA,MAAA;AAAA,IACL,OAAQ;AACJ,UAAG7yF,KAAK2xF,kBAAkBtxF,QAAU;AACnCL,aAAK2xF,gBAAgBpB,6BAA6BC,+BAA+BlrF,QAAOsxC,kBAAAA;AAAAA,MACxF;AAED,UAAG52C,KAAK2xF,eAAc;AACrB,YAAId,aAAaN,6BAA6BK,8BAA8BziF,MAAM7I,QAAOsxC,kBAC9F;AAAA,MAAA,WAAai8C,oBAAoB1kF,KAAK0kF,gBAAqBvtF,KAAAA,QAAOsxC,mBAAmBzoC,KAAK0kF,gBAAmB,CAAA,GAAA;AACxG,YAAIpR,WAAWzhF,KAAKoxF,oBAAoBjjF,KAAK0kF,gBAC7C,CAAA;AAAA,MAAA;AAAA,IACD;AAED,QAAGhC,YAAW;AACbpP,iBAAWzhF,KAAK0yF,YAAY7B,UAC5B;AAAA,IAAA;AAED,QAAGpP,UAAS;AACX,aAAOA;AAAAA,IACP;AAAA,EACD;AACD,SAAO;AACP,GAQD2P,qBAAqB,SAASptB,UAC7B;AAAA,MAAIA,aAAa,QAAQA,aAAa3jE,QAAW;AAChD,WAAOL,KAAK0yF;EACZ;AAED,MAAIpjB,aAAa;AAEjB,MAAA,OAAWtL,aAAa,YAAA,OAAmBA,aAAa,UAAU;AACjEsL,iBAAatL;AAAAA,EAChB,OAAO;AACJsL,iBAAatL,SAAS/8D,MAAM+8D,SAAS3qD;AAAAA,EACrC;AAED,MAAI/T,UAAStF,KAAKsgE,OAAOh7D;AACzB,MAAIwtF,kBAAkBxtF,QAAOsxC;AAC7B,MAAIi6C,aAAa;AAGjB,MAAIn1F,MAAMoO,QAAQk6D,QAAAA,GAAU;AAC3B,QAAIA,SAASjoE,WAAW,GAAE;AACzB,iBAAWioE,SAAS,CAAA,MAAO,UAAS;AACnCsL,qBAAatL,SAAS,GAAGwL;AAAAA,MAC9B,OAAW;AACNF,qBAAatL,SAAS;MACtB;AAAA,IACD;AAAA,EACD;AAED,MAAI8uB,iBAAiB;AACpB,QAAG9yF,KAAK2xF,kBAAkBtxF,QAAU;AACnCL,WAAK2xF,gBAAgBpB,6BAA6BC,+BAA+BlrF,QAAOsxC,kBACxF;AAAA,IAAA;AAED,QAAG52C,KAAK2xF,eAAc;AACrB,eAAQ5mC,SAAS+nC,iBAAgB;AAChC,YAAGA,gBAAgB/nC,KAAOukB,EAAAA,UAAAA,GAAY;AACrCuhB,uBAAaiC,gBAAgB/nC,KAAOukB,EAAAA,UAAAA;AACpC;AAAA,QACA;AAAA,MACD;AAAA,IACL,OAAQ;AACJ,UAAIuhB,aAAaiC,gBAAgBxjB,UAAAA;AAAAA,IACjC;AAED,QAAGuhB,YAAW;AACb,aAAO7wF,KAAK0yF,YAAY7B,UAAAA;AAAAA,IACxB;AAAA,EAED;AACD,SAAO7wF,KAAK0yF,YAAAA;AACZ,GAUDK,iBAAiB,SAAU5kF,MAC1B;AAAA,MAAIpL,SAAQ/C,KAAKsgE;AACjB,MAAI0yB;AACJ,MAAI7kF,SAAS,QAAQA,SAAS9N,QAAW;AACxC,WAAOL,KAAK0yF,YAAAA;AAAAA,EACZ;AAGD,OAAWvkF,OAAAA,SAAS,mBAAmBA,SAAS,aAAapL,OAAM0d,aAAatS,IAAM,GAAA;AACrF6kF,iBAAajwF,OAAMmc,QAAQ/Q;EAC9B,OAAO;AACJ6kF,iBAAa7kF;AAAAA,EACb;AAED,MAAI6kF,CAAAA,YAAW;AACd,WAAOhzF,KAAK0yF,YACZ;AAAA,EAAA;AAED,MAAIjR,WAAWzhF,KAAK4yF,gBAAgBI,UACpC;AAAA,MAAIC,YAAclwF,CAAAA,CAAAA,OAAMwK,SAAWyrE,EAAAA;AAEnC,OAAKyI,YAAY1+E,OAAMuC,OAAOwxC,oBAAoB/zC,OAAM0d,aAAauyE,WAAWlyF,MAAQ,GAAA;AAEvF,QAAIoyF,cAAcF;AAClB,WAAMjwF,OAAM0d,aAAayyE,YAAYpyF,SAAQ;AAC5CoyF,oBAAcnwF,OAAMmc,QAAQg0E,YAAYpyF,MACxC;AAAA,UAAGiC,OAAM4oC,cAAcunD,cAAa;AACnCzR,mBAAWzhF,KAAK4yF,gBAAgBM,WAAAA;AAChC,YAAGzR,UAAS;AACX;AAAA,QACA;AAAA,MACD;AAAA,IACD;AACD,QAAGwR,aAAcxR,CAAAA,UAAS;AAGzB,UAAGtzE,KAAKglF,qBAAoB;AAC3B1R,mBAAWzhF,KAAK0yF,YAAYvkF,KAAKglF,mBAAAA;AAAAA,MACjC;AAAA,IACD;AAAA,EACD;AAED,SAAO1R,YAAYzhF,KAAK0yF,YAAAA;AACxB,GAEDnB,aAAa,SAAS9P,UACrB;AAAA,MAAA,CAAMzhF,KAAKozF,WAAW3R,WAAY;AACjC,QAAIx6E,KAAKw6E,SAASx6E;AAClBw6E,eAAWzhF,KAAKmyF,eAAe1Q,QAC/BA;AAAAA,aAASx6E,KAAKA;AAAAA,EACd;AAGD,MAAKw6E,CAAAA,SAASwJ,2BAA2B,WAC3C;AAAA,EAAA,CAAA,GAAO;AAEJjrF,SAAKsgE,OAAOv4D,UAAU,mBAAmB,CAAC,EAACw5E,SAAS,mDAAqDE,GAAAA,QAAAA,CAAAA;AACzG,WAAO;AAAA,EACV,OAAS;AACN,QAAIn8E,UAAStF,KAAKsgE,OAAOh7D;AAEzBm8E,aAASx6E,KAAKw6E,SAASx6E,MAAMyiD,IAC7B1pD;AAAAA,SAAK0xF,WAAWjQ,SAASx6E,MAAMw6E;AAC/B,QAAA,CAAKn8E,QAAOkV,UACXlV,CAAAA,QAAOkV,YAAY;AACpBlV,IAAAA,QAAOkV,UAAUinE,SAASx6E,EAAAA,IAAMw6E,SAAS7xB,UACzC;AAAA,WAAO6xB,SAASx6E;AAAAA,EAChB;AACD,GAEDosF,gBAAgB,SAAU5R,UAAAA;AACzB,MAAIn8E,UAAStF,KAAKsgE,OAAOh7D;AACzB,MAAKm8E,CAAAA,SAAU,QAAO;AACtB,MAAIzhF,KAAK0xF,WAAWjQ,QAAW,GAAA;AAAA,WACvBzhF,KAAK0xF,WAAWjQ,QAAAA;AACvB,QAAIn8E,QAAOkV,aAAalV,QAAOkV,UAAUinE,QACjCn8E,EAAAA,QAAAA,QAAOkV,UAAUinE,QACzB;AAAA,WAAO;AAAA,EACV,OAAS;AACN,WAAO;AAAA,EACP;AACD,GAED6R,wBAAwB,SAAUh7B,SACjC;AAAA,WAASx8D,KAAKw8D,SAAS;AACtB,QAAIt4D,KAAK0xF,WAAW51F,CACnB,EAAA;AAED,QAAIiL,WAAWuxD,QAAQx8D,CAAAA;AACvB,QAAI2lF,WAAWzhF,KAAKmyF,eAAeprF,QACnC06E;AAAAA,aAASx6E,KAAKnL;AACdkE,SAAKuxF,YAAY9P,QAAAA;AAAAA,EACjB;AACD,GAED+Q,UAAU,EACT7vF,QAAQ,EACPsE,IAAI,UACJsN,UAAU,EACT2F,OAAO,CAAC,GAAG,IAAI,IAAI,KACnB6/C,MAAM,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,CAAA,EAAA,EAAA,GAG3B04B,UAAU,EACTxrF,IAAI,YACJsN,UAAU,EACT2F,OAAO,CAAC,GAAG,EAAA,GACX6/C,MAAM,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,CAK5B83B,EAAAA,EAAAA,EAAAA,GAAAA,wBAAwB,WACvB;AAAA,MAAIvsF,UAAStF,KAAKsgE,OAAOh7D;AACzBtF,OAAKszF,uBAAuBtzF,KAAKwyF,QACjCxyF;AAAAA,OAAKszF,uBAAuBhuF,QAAOkV,SAAAA;AACnC,GAED44E,YAAY,SAASG;AAEpB,MAAIC,QAAQ,CACXD,iBAAiBh6B,YACjBg6B,iBAAiBjH,aACjBiH,iBAAiBxH,cACjBwH,iBAAiB/G,eACjB+G,iBAAiBhF,oBACjBgF,iBAAiBphB,mBACjBohB,iBAAiBhM,aACjBgM,iBAAiBr3B,gBAElB;AAAA,SAAOs3B,MAAMC,MAAM,SAASzjD;AAC3B,WAAOA,iBAAiBmL;AAAAA,EAC3B,CACE;AAAA,EAAA;AC/WF,SAASu4C,6BAA6B3wF,QAAO4jF,iBAAAA;AAC5C3mF,OAAK2mF,kBAAkBA;AACvB3mF,OAAKsgE,SAASv9D;AACf;AAEA2wF,6BAA6B/3F,YAAY,EACxCowF,cAAc,WACb;AAAA,SAAO,CAAC,GAAG,EAAA;AACX,GACDO,aAAa,WAAA;AACZ,SAAO;AACP,GACDE,eAAe,WAAA;AACd,SAAO;AACP,GACDjzB,YAAY,WAAA;AACX,SAAO;AACP,GACDg1B,oBAAoB,SAAUjpF,SAC7B;AAAA,MAAIA,UAAStF,KAAK2mF,gBAAgBvE,4BAA4BniF,MAAMD,KAAK2mF,iBAAiB//E;AAC1F,SAAOtB,QAAO+M;AACd,GAED8/D,mBAAmB,WAClB;AAAA,MAAI7sE,UAAStF,KAAK2mF,gBAAgBlE,qBAAqBxiF,MAAMD,KAAK2mF,iBAAiB//E,SACnF;AAAA,MAAIyhD,OAAO/iD,QAAO6M,YACjBm2C,KAAKhjD,QAAO8M,UACZlJ,OAAO5D,QAAO4D,MACduW,OAAOna,QAAOma;AAEf,SAAOzf,KAAK8sF,mBAAmBzkC,MAAMC,IAAIp/C,MAAMuW,IAC/C;AAAA,GACDqtE,oBAAoB,SAAUjhF,OAAOC,KAAK5C,MAAMuW,MAC/C;AAAA,MAAI49B,aAAar9C,KAAKsgE,OAAOjuD;AAC7B,MAAIshF,aAAa,EAChB9qF,MAAQ,MAAO,KAAK,KAAK,KAAK,GAC9BD,KAAO,MAAO,KAAK,KAAK,IACxBD,MAAQ,MAAO,KAAK,IACpBD,QAAU,MAAO,GAGlB;AAAA,MAAI6Z,MAAM;AACV,MAAIoxE,WAAWzqF,IAAAA,GAAO;AACrBqZ,UAAMjpB,KAAKC,OAAOuS,MAAMD,UAAU4T,OAAOk0E,WAAWzqF;EACvD,OAAS;AACN,QAAIm/C,OAAO,IAAI3vC,KAAK7M,QACnBy8C,KAAK,IAAI5vC,KAAK5M,GAAAA;AACf,WAAOu8C,KAAK56C,YAAY66C,GAAG76C,QAAAA,GAAW;AACrC8U,aAAO;AACP8lC,aAAOhL,WAAW/wC,IAAI+7C,MAAM5oC,MAAMvW,IAClC;AAAA,IAAA;AAED,QAAIm/C,KAAK56C,QAAAA,KAAa3B,IAAI2B,QAAAA,GAAW;AACpC8U,cAAQ+lC,KAAKD,SAAShL,WAAW/wC,IAAI+7C,MAAM5oC,MAAMvW,QAAQm/C;AAAAA,IACzD;AAAA,EACD;AAED,SAAO/uD,KAAKC,MAAMgpB;AAClB,GAEDglE,aAAa;AACZ,MAAIjiF,UAAStF,KAAK2mF,gBAAgBlE,qBAAqBxiF,MAAMD,KAAK2mF,iBAAiB//E,SAAAA;AACnF,MAAIyhD,OAAO/iD,QAAO6M,YACjBm2C,KAAKhjD,QAAO8M,UACZlJ,OAAO5D,QAAO4D;AAEf,MAAKA,CAAAA,MAAM;AACV,WAAO;AAAA,EACP;AACDm/C,SAAO,IAAI3vC,KAAK2vC,IAAAA;AAChBC,OAAK,IAAI5vC,KAAK4vC,EAEd;AAAA,SAAQD,KAAK56C,QAAAA,IAAY66C,GAAG76C,QAC5B;AAAA,GAED09E,aAAa,WACZ;AAAA,SAAO;AACP,GAEDS,QAAQ,SAASnK,UAAAA;AAChB,MAAKA,EAAAA,oBAAoBiS,+BAA8B;AACtD,WAAO;AAAA,EACP;AACD,SAAO;AACP,GAEDx3B,kBAAkB,WACjB;AAAA,MAAI52D,UAAStF,KAAK2mF,gBAAgBhE,0BAA0B1iF,MAAMD,KAAK2mF,iBAAiB//E,SAExF;AAAA,MAAIiF,QAAQvG,QAAO6M,YAClBgqD,WAAW72D,QAAO62D,UAClBjzD,OAAO5D,QAAO4D,MACduW,OAAOna,QAAOma;AAEf,SAAOzf,KAAKsgE,OAAOjuD,KAAK/F,IAAIT,OAAO4T,OAAO08C,UAAUjzD;AACpD,EC5FF;AAAA,SAAS0qF,eAAeC,iBAAAA;AAEvB7zF,OAAKsgE,SAASuzB,gBAAgBvzB;AAC9BtgE,OAAK2mF,kBAAkB0L,wBAAsBryF,KAAKsgE,MAAAA;AAClDtgE,OAAK6zF,kBAAkBA;AACvB7zF,OAAK8zF,oBAAoB,IAAIC,6BAAmB/zF,KAAKsgE,QAAQtgE,KAAK2mF,eAAAA;AACnE;AAEAiN,eAAej4F,YAAY,EAC1Bq4F,cAAc,SAAU1uF,SAAAA;AACvB,MAAIm8E;AACJ,OAAKzhF,KAAKsgE,OAAOh7D,OAAO8U,WAAW;AAClCqnE,eAAWzhF,KAAK8zF;AAAAA,EACnB,OAAS;AACN,QAAI5C,UAAUlxF,KAAK6zF;AACnB,QAAIvuF,QAAO6I,MAAM;AAChBszE,iBAAWyP,QAAQ6B,gBAAgBztF,QAAO6I;IAC9C,WAAc7I,QAAO2B,IAAI;AACrBw6E,iBAAWyP,QAAQ6B,gBAAgBztF,OAAAA;AAAAA,IACvC,WAAcA,QAAOm8E,UAAU;AAC3BA,iBAAWn8E,QAAOm8E;AAAAA,IAClB;AACD,QAAKA,CAAAA,UAAU;AACdA,iBAAWyP,QAAQ6B,gBACnB;AAAA,IAAA;AAAA,EACD;AACD,SAAOtR;AACP,GAEDsK,cAAc,SAAUzmF,SAAAA;AACvBA,EAAAA,UAAStF,KAAK2mF,gBAAgB7E,sBAAsB7hF,MAAMD,KAAK2mF,iBAAiB//E;AAEhF,MAAI66E,WAAWzhF,KAAKg0F,aAAa1uF,OAAAA;AAEjC,SAAOm8E,SAASsK,aAAazmF,QAAO+M;AACpC,GAEDi6E,aAAa,SAAUhnF,SAAQm8E,UAC9Bn8E;AAAAA,EAAAA,UAAStF,KAAK2mF,gBAAgB3E,qBAAqB/hF,MAAMD,KAAK2mF,iBAAiB//E,SAAAA;AAE/E,OAAK66E,SACJA,YAAWzhF,KAAK6zF,gBAAgBnB,YAAAA;AACjC,SAAOjR,SAAS6K,YAAYhnF,OAC5B;AAAA,GAEDknF,eAAe,SAAUlnF,SAAQm8E,UAChCn8E;AAAAA,EAAAA,UAAStF,KAAK2mF,gBAAgB1E,uBAAuBhiF,MAAMD,KAAK2mF,iBAAiB//E,SAAAA;AAEjF,MAAK66E,CAAAA,SACJA,YAAWzhF,KAAK6zF,gBAAgBnB,YACjC;AAAA,SAAOjR,SAAS+K,cAAclnF,OAAAA;AAC9B,GACDi0D,YAAY,SAAUlnD,OAAMnJ,MAAMiF,MAAMszE,UAAAA;AACvC,MAAIn8E,UAAStF,KAAK2mF,gBAAgBzE,oBAAoBjiF,MAAMD,KAAK2mF,iBAAiB//E,SAAAA;AAElF66E,aAAWzhF,KAAKg0F,aAAa1uF,OAAAA;AAC7B,SAAOm8E,SAASloB,WAAWj0D;AAC3B,GACDipF,oBAAoB,SAAUjpF,SAC7BA;AAAAA,EAAAA,UAAStF,KAAK2mF,gBAAgBvE,4BAA4BniF,MAAMD,KAAK2mF,iBAAiB//E,SAAAA;AAEtF,MAAI66E,WAAWzhF,KAAKg0F,aAAa1uF;AAEjC,SAAOm8E,SAAS8M,mBAAmBjpF,OAAAA;AACnC,GAED6sE,mBAAmB;AAClB,MAAI7sE,UAAStF,KAAK2mF,gBAAgBlE,qBAAqBxiF,MAAMD,KAAK2mF,iBAAiB//E,SAGnF;AAAA,MAAI66E,WAAWzhF,KAAKg0F,aAAa1uF,OACjC;AAAA,SAAOm8E,SAAStP,kBAAkB7sE,OAClC;AAAA,GACDiiF,aAAa,WACZ;AAAA,MAAIjiF,UAAStF,KAAK2mF,gBAAgBjE,qBAAqBziF,MAAMD,KAAK2mF,iBAAiB//E;AAEnF,MAAI66E,WAAWzhF,KAAKg0F,aAAa1uF,OAAAA;AAEjC,SAAOm8E,SAAS8F,YAAYjiF,OAAAA;AAC5B,GACD42D,kBAAkB,SAAU52D,SAC3B;AAAA,MAAIA,UAAStF,KAAK2mF,gBAAgBhE,0BAA0B1iF,MAAMD,KAAK2mF,iBAAiB//E,SAExF;AAAA,MAAI66E,WAAWzhF,KAAKg0F,aAAa1uF;AACjC,SAAOm8E,SAASvlB,iBAAiB52D,OACjC;AAAA,EAAA;ACrFF,IAAI2uF,uBAAuB,SAASJ,iBAAiBK;AACpD,SAAO,EACNnI,cAAc,SAAU15E,OAAAA;AACvB,WAAO6hF,eAAenI,aAAa15E,KACnC;AAAA,EAAA,GAEDi6E,aAAa,SAAUhnF;AACtB,WAAO4uF,eAAe5H,YAAYhnF,OAClC;AAAA,EAAA,GAEDknF,eAAe,SAAUlnF,SAAAA;AACxB4uF,mBAAe1H,cAAclnF,OAC7B;AAAA,EAAA,GAEDi0D,YAAY,SAAUlnD,OAAMnJ,MAAMiF,MAAAA;AACjC,WAAO+lF,eAAe36B,WAAWlnD,OAAMnJ,MAAMiF,IAC7C;AAAA,EAAA,GAEDogF,oBAAoB,SAAUjpF;AAC7B,WAAO4uF,eAAe3F,mBAAmBjpF,OACzC;AAAA,EAAA,GAED6sE,mBAAmB,SAAUhgE,YAAYC,UAAUjE,MAAAA;AAClD,WAAO+lF,eAAe/hB,kBAAkBhgE,YAAYC,UAAUjE;EAC9D,GACDgmF,cAAc,SAAUhiF,YAAYC,UAAUjE,MAC7C;AAAA,WAAO+lF,eAAe3M,YAAYp1E,YAAYC,UAAUjE,IAAAA;AAAAA,EACxD,GAED+tD,kBAAkB,SAAUrwD,OAAOswD,UAAUjzD,MAAMiF,MAClD;AAAA,WAAO+lF,eAAeh4B,iBAAiBrwD,OAAOswD,UAAUjzD,MAAMiF,IAC9D;AAAA,EAAA,GAEDgjF,gBAAgBxtC,KAAWkwC,gBAAgB1C,gBAAgB0C,eAAAA,GAC3D1B,gBAAgBxuC,KAAWkwC,gBAAgB1B,gBAAgB0B,kBAC3DtC,aAAa5tC,KAAWkwC,gBAAgBtC,aAAasC,eAAAA,GACrDnB,aAAa/uC,KAAWkwC,gBAAgBnB,aAAamB,eAAAA,GACrDlB,cAAchvC,KAAWkwC,gBAAgBlB,cAAckB,eAAAA,GACvDzC,qBAAqBztC,KAAWkwC,gBAAgBzC,qBAAqByC,eACrEd,GAAAA,iBAAiBpvC,KAAWkwC,gBAAgBd,iBAAiBc,eAAAA,GAC7DR,gBAAgB1vC,KAAWkwC,gBAAgBR,gBAAgBQ,eAE7D,EAAA;AAAA;AAGA,MAAAO,wBAAe,EAAE1iF,QAAQuiF,qBAAAA;AC3CV,SAAQ75E,UAAErX;AACxB,MAAImuF,UAAU,IAAIO,gBAAgB1uF,MAClCmxF,GAAAA,iBAAiB,IAAIN,eAAe1C,OAAAA;AACpC,MAAIvmE,SAASypE,sBAAsB1iF,OAAOw/E,SAASgD,cACnD3tC;AAAAA,QAAYxjD,QAAO4nB,MACpB;AAAA;ACRe,SAAQlY,KAAC1P,QAAAA;AAEvBA,EAAAA,OAAMilD,oBAAoB,SAAU75C,MAAAA;AACnCpL,IAAAA,OAAMqqC,OAAOj/B,QAAQA,gBAAgB2S,QAAQ,kCAAgC3S,OAAK;AAClF,WAAUA,CAAAA,CAAAA,KAAKipE,eAAgBjpE,CAAAA,KAAKgE;AAAAA,EACtC;AAECpP,EAAAA,OAAM06D,4BAA4B,SAAUtvD;AAC3C,WAAUA,CAAAA,EAAAA,KAAKipE,eAAer0E,OAAMuC,OAAO+wC;AAAAA,EAC7C;AAECtzC,EAAAA,OAAMsxF,0BAA0B,SAASlmF,MACxC;AAAA,QAAImmF,YAAYnmF,KAAKgE,aAAahE,KAAKgE,WAAW1E,QAAY,IAAA;AAC9D,QAAI8mF,UAAUpmF,KAAKiE,WAAWjE,KAAKiE,SAAS3E,QAAAA,IAAY;AACxD,WAAU6mF,CAAAA,EAAAA,aAAaC,WAAWD,aAAat0F,KAAKq8D,UAAU5uD,QAAAA,KAAa8mF,WAAWv0F,KAAKo8D,UAAU3uD,QACvG;AAAA,EAAA;AACC1K,EAAAA,OAAMksB,gBAAgB,SAAUhoB;AAC/B,QAAKjH,CAAAA,KAAKygB,aAAaxZ,EAAAA,GAAK;AAC3B,aAAO;AAAA,IACP;AAED,QAAIkH,OAAOnO,KAAKkf,QAAQjY;AACxB,QAAMjH,EAAAA,KAAKy9D,0BAA0BtvD,IAAAA,KAASnO,KAAKq0F,wBAAwBlmF,QAAQ;AAClF,aAAO;AAAA,IACP;AAED,WAAUnO,CAAAA,EAAAA,KAAK0uB,mBAAmBznB,EAAO,KAAA;AAAA,EAC3C;AAEClE,EAAAA,OAAMyxF,iBAAiB,WAAA;AACtB,QAAGzxF,OAAMuC,OAAOmvF,aAAY;AAC3B,aAAO1xF,OAAMuC,OAAOmvF;AAAAA,IACvB,OAAO;AACJ,UAAIphF,SAAQtQ,OAAM4K,cAClB0F;AAAAA,MAAAA,SAAQA,OAAMpX,KAAK,SAAU1B,GAAG2B;AAC/B,eAAQ3B,CAAAA,EAAE6X,WAAYlW,CAAAA,EAAEkW,WAAW,IAAA;AAAA,MACvC,CACG;AAAA,aAAOiB,OAAMtX,SAASsX,OAAMA,OAAMtX,SAAS,CAAA,EAAGqW,WAAW;AAAA,IACzD;AAAA,EACH;AACCrP,EAAAA,OAAM2xF,mBAAmB,WAAA;AACxB,QAAI3xF,OAAMuC,OAAOqvF,eAAe;AAC/B,aAAO5xF,OAAMuC,OAAOqvF;AAAAA,IACpB;AAGD,QAAI5xF,OAAMuC,OAAO6M,YAAY;AAC5B,aAAOpP,OAAMuC,OAAO6M;AAAAA,IACpB;AACD,QAAIpP,OAAMwK,SAAW8G,EAAAA,UAAU;AAC9B,aAAOtR,OAAMwK,WAAW8G;AAAAA,IACxB;AAGD,QAAIhB,SAAQtQ,OAAM4K,cAClB0F;AAAAA,IAAAA,SAAQA,OAAMpX,KAAK,SAAU1B,GAAG2B,GAAAA;AAC/B,cAAQ3B,EAAE4X,aAAAA,CAAcjW,EAAEiW,aAAa,IAAA;AAAA,IAC1C,CAAA;AACE,WAAOkB,OAAMtX,SAASsX,OAAM,CAAA,EAAGlB,aAAa;AAAA,EAC9C;AAEC,MAAIyiF,qBAAqB,SAAUhrF,MAAMirF,WACxC;AAAA,QAAIC,eAAeD,aAAaA,aAAa9xF,OAAMuC,OAAOuV,WAAW9X,OAAM0d,aAAao0E;AACxF,QAAI/zF,SAASg0F,eAAe/xF,OAAMmc,QAAQ21E,SAAAA,IAAa,OACtD9iB,YAAY;AACb,QAAIjxE,QAAQ;AACX,UAAGiC,OAAMuC,OAAOyvF,mBAAkB;AACjChjB,oBAAYhvE,OAAMm5D,iBAAiB,EAClC/pD,YAAYrR,OAAOsR,UACnB+pD,UAAYp5D,CAAAA,OAAMuC,OAAOgvC,eACzBnmC,MAAKvE,KAEV,CAAA;AAAA,MAAA,OAAQ;AACJ,YAAA,CAAI9I,OAAOqR,YAAW;AACrB,iBAAOyiF,mBAAmB9zF,QAAQiC,OAAM+rB,UAAUhuB,MAClD,CAAA;AAAA,QAAA;AACDixE,oBAAYjxE,OAAOqR;AAAAA,MACnB;AAAA,IAEJ,WAAYpP,OAAMuC,OAAOyvF,mBAAmB;AACzChjB,kBAAYhvE,OAAMm5D,iBAAiB,EAClC/pD,YAAYpP,OAAMyxF,eAAAA,GAClBr4B,WAAYp5D,OAAMuC,OAAOgvC,eACzBnmC,MAAKvE,KAAAA,CAAAA;AAAAA,IAET,OAAS;AACN,YAAM4lC,QAAQzsC,OAAMqL,eAAe,CAAA;AACnC,YAAM+pD,UAAUp1D,OAAMuC,OAAO6M,cAAcpP,OAAMwK,WAAW8G;AAE5D,UAAIm7B,OAAM;AACT,YAAIA,MAAMr9B,YAAW;AACpB4/D,sBAAYviC,MAAMr9B;AAAAA,QAClB,WACQq9B,MAAMp9B,UAAS;AACvB2/D,sBAAYhvE,OAAMm5D,iBAAiB,EAClC/pD,YAAYq9B,MAAMp9B,UAClB+pD,WAAWp5D,OAAMuC,OAAOgvC,eACxBnmC,MAAKvE,KAAAA,CAAAA;AAAAA,QAEN,OACI;AACJmoE,sBAAY5Z;AAAAA,QACZ;AAAA,MACL,OAAU;AACN4Z,oBAAY5Z;AAAAA,MACZ;AAAA,IACD;AACDp1D,IAAAA,OAAMqqC,OAAO2kC,WAAW,eAAA;AACxB,WAAO,IAAIr5D,KAAKq5D,SAClB;AAAA,EAAA;AAEChvE,EAAAA,OAAMi9D,2BAA2B,SAAU7xD;AAC1CA,SAAKgE,aAAahE,KAAKgE,cAAcyiF,mBAAmBzmF,MAAMpL,OAAM+rB,UAAU3gB,IAAAA,CAAAA;AAC9EA,SAAKguD,WAAWhuD,KAAKguD,YAAYp5D,OAAMuC,OAAOgvC;AAC9CnmC,SAAKiE,WAAWjE,KAAKiE,YAAYrP,OAAMm5D,iBAAiB/tD,IAAAA;AAAAA,EAC1D;AAECpL,EAAAA,OAAMsrB,aAAa,SAAUzkB,MAAM9I,QAAQ0F,OAC1CoD;AAAAA,WAAOA,QAAQ;AAEf,QAAK7G,CAAAA,OAAMugC,QAAQ15B,KAAK3C,EAAAA,EACvB2C,MAAK3C,KAAKlE,OAAM01B,IAEjB;AAAA,QAAA,CAAK7uB,KAAKuI,YAAY;AACrBvI,WAAKuI,aAAayiF,mBAAmBhrF,MAAM9I,MAAAA;AAAAA,IAC3C;AACD,QAAI8I,KAAKyR,SAAShb,QAAW;AAC5BuJ,WAAKyR,OAAOtY,OAAMoT,OAAOC,OAAO+hE;AAAAA,IAChC;AACD,QAAIvuE,KAAKuyD,aAAa97D,QAAW;AAChCuJ,WAAKuyD,WAAW;AAAA,IAChB;AAED,QAAIn8D,KAAKygB,aAAa3f,MAAS,GAAA;AAC9Bd,WAAK2pD,UAAU//C,MAAM9I,QAAQ,IAAA;AAC7B,UAAI8oD,YAAY5pD,KAAKkf,QAAQpe,MAAAA;AAC7B8oD,gBAAUvsC,QAAQ;AAElB,UAAA,CAAKrd,KAAKsF,OAAOkwC,mBAAkB;AAClCx1C,aAAK+H,UAAU,uBAAuB,CAACjH,QAAQ8oD,SAAAA,CAAAA;AAAAA,MAC/C;AAAA,IACD;AAED,QAAA,CAAK5pD,KAAK+H,UAAU,iBAAiB,CAAC6B,IAAAA,CAAAA,GAAQ;AAC7C,aAAO;AAAA,IACP;AACD,QAAI5J,KAAKsF,OAAOkwC,mBAAmB;AAElC,UAAIzyC,OAAM0d,aAAa7W,KAAK3C,EAAAA,GAAI;AAC/B,YAAIkH,OAAOpL,OAAMmc,QAAQtV,KAAK3C,EAC9B;AAAA,YAAIkH,KAAK07B,UAAUjgC,KAAKigC,QAAQ;AAG/B,cAAIjgC,KAAKuI,qBAAqBvI,KAAKuI,eAAe,UAAS;AAC1DvI,iBAAKuI,aAAanS,KAAKqS,KAAK4tC,UAAUr2C,KAAKuI,YAAY,YAAA;AAAA,UACvD;AACD,cAAIvI,KAAKwI,mBAAmBxI,KAAKwI,aAAa,UAAS;AACtDxI,iBAAKwI,WAAWpS,KAAKqS,KAAK4tC,UAAUr2C,KAAKwI,UAAU,YAAA;AAAA,UACnD;AACDpS,eAAK81B,MAAMC,WAAWyzB,WAAW5/C,KAAK3C,IAAI2C,IAC1C;AAAA,QAAA;AAAA,MACD,OACI;AACJA,aAAKorF,OAAO;AACZh1F,aAAKs7B,OAAO,WAAA;AACXv4B,UAAAA,OAAM+yB,MAAMC,WAAW8D,QAAQjwB,MAAMpD,KAC1C;AAAA,QAAA,CAAA;AAAA,MACI;AACDxG,WAAKqxB,WAAWznB,KAAK3C,EAAAA;AACrBjH,WAAKu1D,YAAAA;AACLv1D,WAAKyxB,aAAa7nB,KAAK3C,EAC1B;AAAA,IAAA,OAAS;AACN,UAAIjH,KAAKypD,QAAQ7/C,MAAM9I,QAAQ0F,KAAQ,GAAA;AACtCxG,aAAKi1F,SAASrrF,KAAK3C,EACnBjH;AAAAA,aAAKqxB,WAAWznB,KAAK3C;MACrB;AAAA,IACD;AACD,WAAO2C,KAAK3C;AAAAA,EACd;AAEClE,EAAAA,OAAMizD,gBAAgB,SAAU1L,OAAOC,OAAAA;AAEtC,QAAIzzC,QAAQ/T,OAAM+yB,MAAMC;AACxB,QAAIu0B,UAAUjqD,QAAW;AACxBL,WAAKk1F,eAAe;AAEpBp+E,YAAMwkB,OAAO,WAAA;AACZxkB,cAAMykB,SACV;AAAA,MAAA,CAAA;AAEG,UAAIv7B,KAAKw9B,kBAAkB;AAC1Bx9B,aAAKu6B,aAAaa,MAClB;AAAA,MAAA;AAED,UAAIp7B,KAAKm1F,cAAcn1F,KAAKm1F,WAAWC,MAAM;AAC5Cp1F,aAAKm1F,WAAWC,KAAKnuF,KAAK;AAAA,MAC1B;AAAA,IACJ,OAAS;AACN,UAAIjH,KAAKk1F,gBAAgB5qC,MACxBtqD,MAAKk1F,eAAe3qC;AAGrB,UAAIzzC,MAAM4kB,cAAAA,KAAmB4uB,OAAO;AACnCxzC,cAAMwkB,OAAO;AACZxkB,gBAAMykB,SAAS+uB;AACfxzC,gBAAMhc,OAAOyvD;QAClB,CACI;AAAA,MAAA;AACD,UAAIvqD,KAAKm1F,cAAcn1F,KAAKm1F,WAAWC,QAAQp1F,KAAKm1F,WAAWC,KAAKnuF,MAAMqjD,OAAO;AAChFtqD,aAAKm1F,WAAWC,KAAKnuF,KAAKsjD;AAAAA,MAC1B;AAAA,IACD;AAAA,EACH;AAEC,MAAI8qC,oBAAoB,SAAUlnF,MAAMi1B;AACvC,QAAIkyD,YAAYvyF,OAAMo+B,YAAYhzB,KAAK8D,IAAAA;AAEvC,QAAIrO,QAAQ,EACXqO,MAAMqjF,WACNC,WAAW,OACXC,SAAS,OACTC,mBAAmB,MAGpB;AAAA,QAAGH,cAAcvyF,OAAMuC,OAAOqxB,MAAM3U,WAAW7T,KAAKmU,oBAAoB,OAAM;AAC7E1e,YAAM6xF,oBAAoB;AAAA,IAC1B;AAED,QAAKryD,CAAAA,SAASkyD,aAAannF,KAAKqO,gBAAgB;AAC/C5Y,YAAM2xF,YAAYpnF,KAAKonF;AACvB3xF,YAAM4xF,UAAUrnF,KAAKqnF;AACrB,aAAO5xF;AAAAA,IACP;AAED,QAAI0xF,aAAavyF,OAAMuC,OAAOqxB,MAAM3U,SAAS;AAE5Cpe,YAAM4xF,UAAU5xF,MAAM2xF,YAAY;AAAA,IAClC,WAAUD,aAAavyF,OAAMuC,OAAOqxB,MAAMqb,WAAW;AAErDpuC,YAAM4xF,UAAYrnF,EAAAA,KAAKiE,YAAYjE,KAAKguD;AACxCv4D,YAAM2xF,YAAAA,CAAapnF,KAAKgE;AAExB,UAAIpP,OAAM06D,0BAA0BtvD,IAAAA,GAAO;AAC1CvK,cAAM4xF,UAAU5xF,MAAM2xF,YAAY;AAAA,MAClC;AAAA,IACD;AAED,WAAO3xF;AAAAA,EACT;AAECb,EAAAA,OAAMk9D,oBAAoB,SAAU9xD,MAAAA;AACnC,QAAIunF,YAAYL,kBAAkBlnF,MAAM,IAAA;AAExC,QAAIwnF,QAAQxnF,KAAKqO,kBAAkBk5E,UAAUzjF;AAE7C,QAAIqjF,YAAYI,UAAUzjF;AAE1B,QAAI0jF,OAAO;AACVxnF,WAAKonF,YAAYG,UAAUH;AAC3BpnF,WAAKqnF,UAAUE,UAAUF;AACzBrnF,WAAKqO,iBAAiBk5E,UAAUzjF;AAAAA,IAChC;AAED,QAAI0jF,SAASL,aAAat1F,KAAKsF,OAAOqxB,MAAMqb,WAAW;AACtD,UAAIsjD,aAAat1F,KAAKsF,OAAOqxB,MAAM3U,SAAS;AAE3ChiB,aAAKggE,yBAAyB7xD;AAC9BA,aAAKynF,sBAAsB;AAAA,MAC3B;AAAA,IACD;AAED,QAAIN,aAAat1F,KAAKsF,OAAOqxB,MAAMqb,WAAW;AAC7C7jC,WAAKiE,WAAWjE,KAAKgE;AAAAA,IACrB;AACD,QAAIhE,KAAKgE,cAAchE,KAAKiE,YAAYjE,KAAKynF,wBAAwB,OAAO;AAC3EznF,WAAKguD,WAAWn8D,KAAKmyE,kBAAkBhkE,IAAAA;AAAAA,IACvC;AAED,QAAA,CAAIA,KAAKynF,qBAAoB;AAC5BznF,WAAKynF,sBAAsB;AAAA,IAC3B;AAED,QAAKznF,CAAAA,KAAKiE,UAAU;AACnBjE,WAAKiE,WAAWjE,KAAKgE;AAAAA,IACrB;AAEDhE,SAAKguD,WAAWhuD,KAAKguD,YAAY;AAEjC,QAAIn8D,KAAKsF,OAAOytC,iBAAiB,KAAK5kC,KAAKguD,aAAa,GAAE;AACzDhuD,WAAKqnF,UAAU;AAAA,IACf;AAGD,QAAIK,oBAAoB71F,KAAK+yF,gBAAgB5kF,IAC7C;AAAA,QAAGA,KAAKglF,uBAAuBhlF,KAAKglF,wBAAwB0C,kBAAkB5uF,IAAG;AAChF6uF,uBAAiB3nF,IACjB;AAAA,UAAGnO,KAAKsF,OAAOwxC,oBAAoB92C,KAAK2rC,cAAcx9B,IAAM,GAAA;AAC3DnO,aAAK4T,SAAS,SAAStV;AACtBw3F,2BAAiBx3F,KAAAA;AAAAA,QACtB,GAAO6P,KAAKlH,EACR;AAAA,MAAA;AAAA,IACD;AAEDkH,SAAKglF,sBAAsB0C,kBAAkB5uF;AAAAA,EAC/C;AAEC,WAAS6uF,iBAAiB3nF,MAAAA;AACzBA,SAAKglF,sBAAsBpwF,OAAMgwF,gBAAgB5kF,MAAMlH;AACvDkH,SAAKgE,aAAapP,OAAMwrF,mBAAmB,EAC1CviE,KAAK,UACL3Z,MAAMlE,KAAKgE,YACXjJ,MAAMnG,OAAMuC,OAAO4sC,eACnB/jC,KAAMA,CAAAA;AAEPA,SAAKiE,WAAWrP,OAAMm5D,iBAAiB/tD,IAAAA;AAAAA,EACvC;AAEDpL,EAAAA,OAAM4oC,gBAAgB,SAAUx9B;AAC/BpL,IAAAA,OAAMqqC,OAAOj/B,QAAQA,gBAAgB2S,QAAQ,kCAAgC3S,OAAK,mDAAA;AAElF,QAAIopB,OAAO89D,kBAAkBlnF,IAAAA;AAE7B,cAAUopB,KAAKi+D,WAAWj+D,KAAKg+D;AAAAA,EACjC;AAGCxyF,EAAAA,OAAMy6D,oBAAoB,SAAUrvD,MAAAA;AACnC,QAAI4nF,WAAWV,kBAAkBlnF,IAAAA;AACjC,QAAI4nF,SAASP,WAAWO,SAASR,WAAW;AAC3C,UAAI99E,OAAOu+E,eAAe7nF,KAAKlH,EAAAA;AAC/BgvF,yBAAmBp6F,KAAKmE,MAAMmO,MAAM4nF,UAAUt+E,KAAKtF,YAAYsF,KAAKrF,QAAAA;AACpEjE,WAAK+nF,UAAUz+E,KAAKkmD;AAAAA,IACpB;AAAA,EACH;AAEC,WAASs4B,mBAAmB9nF,MAAMgoF,YAAY9tC,MAAMC,IAEnD;AAAA,UAAM8tC,oBAAoB,EACzBvqF,OAAO,cACPC,KAAK,WAEN;AAAA,UAAMuqF,qCAAqC,EAC1CxqF,OAAO,oBACPC,KAAK,iBAAA;AAGN,QAAIwqF;AACJ,QAAGnoF,KAAK8D,SAASlP,OAAMuC,OAAOqxB,MAAM3U,WAAW7T,KAAKmU,oBAAoB,OAAM;AAC7Eg0E,mBAAaD;AAAAA,IAChB,OAAO;AACJC,mBAAaF;AAAAA,IACb;AAED,QAAID,WAAWZ,WAAW;AACzB,UAAIltC,MAAM;AACTl6C,aAAKmoF,WAAWzqF,KAAAA,IAAS,IAAI6M,KAAK2vC,IACtC;AAAA,MAAA,OAAU;AACNl6C,aAAKmoF,WAAWzqF,SAAS+oF,mBAAmBzmF,MAAMnO,KAAK8uB,UAAU3gB,IAAAA,CAAAA;AAAAA,MACjE;AAAA,IACD;AAED,QAAIgoF,WAAWX,SAAS;AACvB,UAAIltC,IAAI;AACPn6C,aAAKmoF,WAAWxqF,OAAO,IAAI4M,KAAK4vC,EACpC;AAAA,MAAA,OAAU;AACNn6C,aAAKmoF,WAAWxqF,GAAO9L,IAAAA,KAAKk8D,iBAAiB,EAC5C/pD,YAAYhE,KAAKmoF,WAAWzqF,KAAAA,GAC5BswD,UAAUn8D,KAAKsF,OAAOgvC,eACtBnmC,KAED,CAAA;AAAA,MAAA;AAAA,IACD;AACD,QAAIgoF,WAAWZ,aAAaY,WAAWX,SAAS;AAC/Cx1F,WAAKigE,kBAAkB9xD,IACvB;AAAA,IAAA;AAAA,EACD;AAEDpL,EAAAA,OAAMwzF,qBAAqB,SAAUjoE,QACpC;AAAA,QAAI/L,MAAM,GACTlnB,OAAOizB,WAAWjuB,SAAYiuB,SAASvrB,OAAMuC,OAAOuV;AAErD7a,SAAK4T,SAAS,SAAUtV,OAAAA;AACvB,UAAI0B,KAAKmhC,YAAY7iC,MAAM2T,IAAAA,KAASlP,OAAMuC,OAAOqxB,MAAM3U,WAAWhiB,KAAKgoD,kBAAkB1pD,KACxF,EAAA;AAEDikB,aAAOjkB,MAAM69D;AAAAA,IACb,GAAE9gE,IAAAA;AAEH,WAAOknB;AAAAA,EACT;AAEC,WAASyzE,eAAgB1nE,QACxB;AAAA,QAAIviB,MAAM,MACTlP,MAAM,MACNxB,OAAOizB,WAAWjuB,SAAYiuB,SAASvrB,OAAMuC,OAAOuV,SACpD8iD,SAAS;AAEV56D,IAAAA,OAAM6Q,SAAS,SAAUtV,OACxB;AAAA,YAAMk4F,qBAAsBzzF,OAAMo+B,YAAY7iC,MAAM2T,SAASlP,OAAMuC,OAAOqxB,MAAM3U,WAAY1jB,MAAMgkB,oBAAoB;AACtH,UAAKvf,OAAMo+B,YAAY7iC,MAAM2T,IAAAA,KAASlP,OAAMuC,OAAOqxB,MAAM3U,YAAYw0E,sBAAuBzzF,OAAMilD,kBAAkB1pD,KACnH,EAAA;AAED,UAAGA,MAAMq/D,QAAO;AACfA,eAAO3+D,KAAKV,MAAM2I,EAClB;AAAA,MAAA;AAED,UAAK3I,MAAM6T,gBAAgB7T,MAAMi3F,aAAaiB,wBAA0BzqF,CAAAA,OAAOA,MAAMzN,MAAM6T,WAAW1E,QACrG1B,GAAAA,OAAMzN,MAAM6T,WAAW1E,QAAAA;AACxB,UAAKnP,MAAM8T,aAAAA,CAAc9T,MAAMk3F,WAAWgB,wBAA0B35F,CAAAA,OAAOA,MAAMyB,MAAM8T,SAAS3E,WAC/F5Q,OAAMyB,MAAM8T,SAAS3E,QACtB;AAAA,IAAA,GAAEpS,IAEH;AAAA,WAAO,EACN8W,YAAYpG,MAAM,IAAI2M,KAAK3M,OAAO,MAClCqG,UAAUvV,MAAM,IAAI6b,KAAK7b,GAAO,IAAA,MAChC8gE,OAAQA;AAAAA,EAET;AAED56D,EAAAA,OAAMof,kBAAkB,SAAU0b,SAAAA;AACjC,QAAIpmB,OAAOu+E,eAAen4D,OAC1B;AAAA,WAAO,EACN1rB,YAAYsF,KAAKtF,YACjBC,UAAUqF,KAAKrF,SAAAA;AAAAA,EAElB;AAICrP,EAAAA,OAAM66D,kBAAkB,SAAUtvC,QAAQgN,QAAQm7D,WACjD;AAAA,QAAA,CAAKnoE,OAAQ;AAEb,QAAIngB,OAAOnO,KAAKkf,QAAQoP,MAAAA;AACxB,QAAGngB,KAAKwvD,QAAO;AACd84B,kBAAY;AAAA,IACZ;AACD,QAAIrlC,MAAMpxD,KAAK8uB,UAAU3gB,IAAAA;AAEzB,QAAIgoF,aAAad,kBAAkBlnF;AAEnC,QAAIuoF,cAAc;AAElB,QAAID,aAActoF,KAAKgE,cAAchE,KAAKiE,aAAa+jF,WAAWZ,aAAaY,WAAWX,UAAW;AAEpG,YAAMmB,iBAAiBxoF,KAAKyoF,mBAAmB,qBAAqB;AACpE,YAAMC,eAAe1oF,KAAK2oF,iBAAiB,mBAAmB;AAE9D,UAAIC,WAAW5oF,KAAKwoF,cAAgBlpF,EAAAA,QAAAA,GACnCupF,SAAS7oF,KAAK0oF,cAAcppF,QAE7B1K;AAAAA,MAAAA,OAAMy6D,kBAAkBrvD,IAGxB;AAAA,UAAA,CAAKsoF,aAAaM,YAAY5oF,KAAKwoF,cAAgBlpF,EAAAA,QAAAA,KAAaupF,UAAU7oF,KAAK0oF,cAAcppF,QAAW,GAAA;AACvGipF,sBAAc;AAAA,MACd;AAED,UAAIA,eAAgBp7D,CAAAA,QAAQ;AAC3Bt7B,aAAKi8B,YAAY9tB,KAAKlH,IAAI,IAC1B;AAAA,MAAA;AAED,UAAGkvF,WAAWV,mBAAkB;AAC/BiB,sBAAc;AAAA,MACd;AAAA,IACD;AAGD,QAAIA,eAAetlC,OAAOpxD,KAAKygB,aAAa2wC,GAAAA,GAAM;AACjDpxD,WAAK49D,gBAAgBxM,KAAK91B,QAAQm7D,SAAAA;AAAAA,IAClC;AAAA,EACH;AAEC1zF,EAAAA,OAAMk0F,YAAY,SAAU3xF,SAC3B;AAAA,QAAI2mB,QAAQlpB,OAAMsZ,SAAAA;AAElB,QAAI4mB,OAAe39B,OAAAA,GAAS;AAC3BA,MAAAA,UAAS,EACR+M,MAAM/M,SACN4D,MAAM+iB,QAAQA,MAAM/iB,OAAOnG,OAAMuC,OAAO4sC,eACxCzyB,MAAMwM,QAASA,MAAMxM,OAAO1c,OAAMuC,OAAOgvC,cAE1C;AAAA,IAAA;AACD,QAAIjiC,QAAO/M,QAAO+M,MACjB0M,QAAQzZ,QAAOma,MACfvW,OAAO5D,QAAO4D;AAEf,QAAA,CAAI+iB,OAAM;AACT,aAAO5Z;AAAAA,IACP;AAED,QAAI6kF,OAAOC,OAAOC;AAClB,QAAIluF,QAAQ+iB,MAAM/iB,QAAQ6V,SAASkN,MAAMxM,QAAAA,CACvCpN,UAAS4Z,MAAM5X,YAAAA,CAAahC,UAAS4Z,MAAMze,UAAU;AAEtD4pF,iBAAW99F,KAAKkS,MAAMzI,OAAMiZ,kBAAkB3J,KAAAA,CAAAA;AAE9C,WAAK4Z,MAAMjN,QAAQo4E,WAAW;AAC7BA,oBAAY;AACZ,YAAGnrE,MAAMxN,KAAI;AACZ24E,qBAAW;AAAA,QACX;AAAA,MACD;AACDD,cAAQ,IAAIz+E,KAAKuT,MAAMjN,QAAQo4E,QAC/BF,CAAAA;AAAAA,cAAQn0F,OAAMsP,KAAK/F,IAAI6qF,OAAOp4E,OAAO7V;IACxC,OAAS;AACNkuF,iBAAW99F,KAAKkS,MAAMzI,OAAMiZ,kBAAkB3J,KAE9C6kF,CAAAA;AAAAA,cAAQn0F,OAAMsP,KAAKnJ,OAAO,QAAU,EAAA,IAAIwP,KAAKuT,MAAM5X;AACnD,UAAI4X,MAAMjN,QAAQo4E,QAAAA,GAAW;AAC5BF,gBAAQn0F,OAAMsP,KAAKnJ,OAAO,UAAU+iB,MAAMjN,QAAQo4E;MAClD;AAED,aAAA,CAAQF,QAAS7kF,CAAAA,OAAM;AACtB6kF,gBAAQn0F,OAAMsP,KAAKnJ,OAAO,QAAUnG,EAAAA,OAAMsP,KAAK/F,IAAI4qF,OAAOn4E,OAAO7V,IAAAA,CAAAA;AAEjE,YAAI8xD,WAAWk8B,MAAMr5C,kBAAAA;AAErBq5C,gBAAQn0F,OAAMk4D,oBAAoBi8B,OAAOl8B,UAAUk8B,OAAOhuF;AAC1D,YAAInG,OAAMsP,KAAKnJ,OAAO,QACrBguF,EAAAA,SAAQn0F,OAAMsP,KAAKnJ,OAAO,UAAUguF,KACrC;AAAA,MAAA;AAEDC,cAAQp0F,OAAMsP,KAAK/F,IAAI4qF,OAAAA,KAAYn4E,OAAO7V;IAE1C;AACD,QAAI5D,QAAO0mB,OAAO1mB,QAAO0mB,OAAO,SAC/B,QAAOkrE;AACR,QAAI5xF,QAAO0mB,OAAO1mB,QAAO0mB,OAAO,OAC/B,QAAOmrE;AAER,QAAI79F,KAAKkM,IAAI6M,QAAO8kF,KAAAA,IAAS79F,KAAKkM,IAAI0xF,QAAQ7kF,KAAAA,GAAO;AACpD,aAAO8kF;AAAAA,IACV,OAAS;AACN,aAAOD;AAAAA,IACP;AAAA,EAEH;AAECn0F,EAAAA,OAAMm9D,sBAAsB,SAAU/xD,MAAAA;AACrC,QAAIpL,OAAMuC,OAAO8U,aAAarX,OAAMuC,OAAO6sC,mBAAmB;AAC7D,UAAA,CAAKnyC,KAAKu5D,WAAWprD,KAAKgE,YAAY9R,QAAW8N,IAAO,GAAA;AACvDA,aAAKgE,aAAanS,KAAKuuF,mBAAmB,EAACl8E,MAAMlE,KAAKgE,YAAY6Z,KAAK,UAAU7d,KACjFA,CAAAA;AAAAA,aAAKiE,WAAWpS,KAAKk8D,iBAAiB/tD,IAAAA;AAAAA,MACtC,WAAWnO,CAAAA,KAAKu5D,WAAW,IAAI7gD,KAAMvK,CAAAA,KAAKiE,WAAW,CAAI/R,GAAAA,QAAW8N,OAAO;AAC3EA,aAAKiE,WAAWpS,KAAKk8D,iBAAiB/tD,IACtC;AAAA,MAAA;AAAA,IACD;AAAA,EACH;AAECpL,EAAAA,OAAMyE,YAAY,sBAAsB,SAAUP,IAAIkH,MAAAA;AACrDpL,IAAAA,OAAMk9D,kBAAkB9xD,IAAAA;AACxB,WAAO;AAAA,EACT,CACCpL;AAAAA,EAAAA,OAAMyE,YAAY,mBAAmB,SAAUP,IAAIkH,MAClDpL;AAAAA,IAAAA,OAAMk9D,kBAAkB9xD,IACxB;AAAA,WAAO;AAAA,EACT,CAAA;AAECpL,EAAAA,OAAMyE,YAAY,mBAAmB,SAAUP,IAAInG,QAAQwqC,QAAAA;AAC1DvoC,IAAAA,OAAMk9D,kBAAkBl9D,OAAMmc,QAAQjY,EAAAA,CAAAA;AACtC,WAAO;AAAA,EACT,CAEA;AAAA;ACrjBe,SAAQowF,gBAACt0F,QAAAA;AAEvBA,EAAAA,OAAMo+B,cAAc,SAAUlvB;AAC7B,WAAO;AAAA,EACT;AACA;ACCe,SAAQqlF,iBAACv0F;AAExBA,EAAAA,OAAMw0F,oBAAoB,EACzB1+C,OAAO,CAAE,GACTthB,MAAM,OACNigE,oBAAoB,OACpBC,cAAe,SAASppD,SAASpzC;AAChC,QAAGA,OAAOy8F,qBAAoB;AAC7B,eAAQ57F,KAAKb,OAAOy8F,qBAAoB;AACvCz8F,eAAOa,CAAAA,IAAKb,OAAOy8F,oBAAoB57F,CAAAA;AAAAA,MACvC;AAAA,IACD;AACDb,WAAOy8F,sBAAsB;AAC7B,aAAQ57F,IAAI,GAAGA,IAAIuyC,QAAQtyC,QAAQD,IAClCkE,MAAK23F,SAAStpD,QAAQvyC,IAAIb,MAE3B;AAAA,EAAA,GACD08F,UAAW,SAASC,YAAYp1F,MAAAA;AAC/B,QAAIq1F,WAAWr1F,KAAKo1F;AACpB,QAAGC,UAAS;AACX,UAAIC,YAAY93F;AAEhBwC,WAAKk1F,oBAAoBE,UAAAA,IAAcC;AACvCr1F,WAAKo1F,UAAAA,IAAc,SAASG,uBAE3B;AAAA,YAAIC,iBAAiB,IAAIt8F,MAAMkL,UAAU7K,MAAAA;AACzC,iBAASD,IAAI,GAAGm8F,IAAIrxF,UAAU7K,QAAQD,IAAIm8F,GAAGn8F,KAAK;AACjDk8F,yBAAel8F,CAAK8K,IAAAA,UAAU9K,CAC9B;AAAA,QAAA;AAED,YAAGg8F,UAAU58D,QAAO;AACnB,cAAIvwB,OAAOmtF,UAAUI,mBAAmBx8F,MAAMC,UAAUC,MAAMC,KAAKm8F,cAAAA,CAAAA;AACnE,eAAIF,UAAUj/C,MAAM++C,UAAY,GAAA;AAC/BE,sBAAUj/C,MAAM++C,cAAc;UAC9B;AAED,cAAIO,gBAAgBL,UAAUj/C,MAAM++C,UAEpC;AAAA,cAAGE,UAAUM,iBAAiBD,eAAextF,OAAM;AAClD,mBAAOmtF,UAAUO,iBAAiBF,eAAextF,IAAAA;AAAAA,UACvD,OAAU;AACJ,gBAAIoO,QAAQ8+E,SAAS53F,MAAMD,MAAMg4F;AACjCF,sBAAUQ,YAAYH,eAAextF,MAAMoO,KAC3C;AAAA,mBAAOA;AAAAA,UACP;AAAA,QACD;AAED,eAAO8+E,SAAS53F,MAAMD,MAAMg4F,cAChC;AAAA,MAAA;AAAA,IACG;AACD,WAAOH;AAAAA,EACP,GACDS,aAAa,SAASz/C,OAAO0/C,gBAAgBx/E,OAC5C;AAAA,QAAG/Y,KAAKw4F,QAAQz/E,KAAAA,EACfA,SAAQ,IAAIL,KAAKK,KAAAA;AAClB8/B,UAAM0/C,cAAkBx/E,IAAAA;AAAAA,EACxB,GACDq/E,kBAAkB,SAASv/C,OAAO0/C,gBACjC;AAAA,WAAO1/C,MAAM1V,eAAeo1D,cAC5B;AAAA,EAAA,GACDF,kBAAkB,SAASx/C,OAAO0/C,gBACjC;AAAA,QAAI9lF,QAAOomC,MAAM0/C;AAGjB,QAAGv4F,KAAKw4F,QAAQ/lF,KAAAA,GAAM;AACrBA,MAAAA,QAAO,IAAIiG,KAAKjG,KAAAA;AAAAA,IAChB;AACD,WAAOA;AAAAA,EACP,GACD+lF,SAAS,SAASz/E,OACjB;AAAA,WAAQA,SAASA,MAAM6iC;AAAAA,EACvB,GACDs8C,oBAAmB,SAASvtF,MAAAA;AAC3B,QAAI8tF,SAAS;AACb,aAAQ38F,IAAI,GAAGA,IAAI6O,KAAK5O,QAAQD,KAAI;AACnC28F,aAAOz5F,KAAKgB,KAAK04F,mBAAmB/tF,KAAK7O,CAAAA,CAAAA,CAAAA;AAAAA,IACzC;AACD,WAAO,MAAM28F,OAAOj9F,KAAK,GAAO,IAAA;AAAA,EAChC,GACDk9F,oBAAoB,SAAS3/E,OAAAA;AAE5B,QAAI+1C,MAAM;AACV,QAAG/1C,MAAM9R,IAAG;AACX6nD,YAAM/1C,MAAM9R;AAAAA,IACZ,WAAQjH,KAAKw4F,QAAQz/E,KAAO,GAAA;AAC5B+1C,YAAM/1C,MAAMtL,QACf;AAAA,IAAA,OAAO;AACJqhD,YAAM/1C;AAAAA,IACN;AACD,WAAO+1C,MAAM;AAAA,EACb,GACD6pC,UAAU,WACT34F;AAAAA,SAAKqH,MACLrH;AAAAA,SAAKk7B,SAAS;AAAA,EACd,GACD09D,YAAY,WACX54F;AAAAA,SAAKqH;AACLrH,SAAKk7B,SAAS;AAAA,EACd,GACD7zB,OAAO,WAAA;AACNrH,SAAK64C,QAAQ;EACb,GAEDggD,OAAO,SAAS91F;AACf,QAAI+1F,iBAAiB,CAErB;AAAA,QAAIC,gBAAiB,CACpB,iBACA,kBACA,WAAA;AAKD,QAAG/4F,KAAKu3B,QAAQ,QAAO;AACtB,UAAGx0B,OAAMuC,OAAO0zF,yBAAwB;AACvCF,yBAAiBC;AAAAA,MACjB;AAAA,IACJ,WAAW/4F,KAAKu3B,SAAS,MAAK;AAC3BuhE,uBAAiBC;AAAAA,IACjB;AAED/4F,SAAKy3F,aAAaqB,gBAAgB/1F,MAAAA;AAAAA,EAElC,GACDk2F,mBAAmB,SAASl2F;AAC3B,QAAIm2F,UAAWl5F,KAAKw3F,sBAAsBz0F,OAAMuC,OAAO0zF,2BACnDh5F,KAAKu3B,SAASx0B,OAAMuC,OAAO2xC;AAC/B,QAAGiiD,SAAQ;AACVl5F,WAAKw3F,qBAAqBz0F,OAAMuC,OAAO0zF;AACvCh5F,WAAKu3B,OAAOx0B,OAAMuC,OAAO2xC;AACzBj3C,WAAK64F,MAAM91F,MACX;AAAA,IAAA;AAAA,EACD,EAGF;AAAA,WAAS41F,WACR51F;AAAAA,IAAAA,OAAMw0F,kBAAkB0B,kBAAkBl2F,MAAAA;AAC1C,SAAIA,OAAMw0F,kBAAkBr8D,QAAO;AAClCn4B,MAAAA,OAAMw0F,kBAAkBoB,SAAAA;AAAAA,IACxB;AACD,WAAO;AAAA,EACR;AACA51F,EAAAA,OAAMyE,YAAY,uBAAuBmxF,QAAAA;AACzC51F,EAAAA,OAAMyE,YAAY,sBAAsBmxF,QACxC51F;AAAAA,EAAAA,OAAMyE,YAAY,uBAAwB;AACzCmxF,aACD;AAAA,EAAA,CAAA;AACA51F,EAAAA,OAAMyE,YAAY,iBAAiBmxF,QAAAA;AACnC51F,EAAAA,OAAMyE,YAAY,gBAAgB,WACjCzE;AAAAA,IAAAA,OAAMw0F,kBAAkBqB,WAAAA;AAAAA,EACzB;AACA,MAAIO,iBAAiB;AACrBp2F,EAAAA,OAAMyE,YAAY,iBAAiB,WAClC;AAAA,QAAG2xF,eACFtuF,cAAasuF,cACdA;AAAAA,qBAAiBvuF,WAAW,WAC3B7H;AAAAA,MAAAA,OAAMw0F,kBAAkBqB,WAAAA;AAAAA,IACxB,GAAE,GAAA;AAAA,EACJ;AAEA71F,EAAAA,OAAMyE,YAAY,sBAAsB,WAAA;AACvCzE,IAAAA,OAAMw0F,kBAAkB0B,kBAAkBl2F,MAC1C;AAAA,WAAO;AAAA,EACR,CAEA;AAAA;AC5KA,SAASq2F,kBAAkBr2F,QAAAA;AAC1B,MAAIs2F,kBAAkB5gG,OAAOsB,iBAAiBgJ,OAAMgC,KACpD;AAAA,MAAGs0F,gBAAgBC,iBAAiB,UAAe,KAAA,UAAS;AAC3Dv2F,IAAAA,OAAMgC,MAAM/K,MAAM2J,WAAW;AAAA,EAC7B;AAED,MAAI41F,gBAAgBnhG,SAASoE,cAAc,QAC3C+8F;AAAAA,gBAAcx8F,YAAY;AAC1Bw8F,gBAAcp9F,WAAY;AAC1B,MAAG4G,OAAMuC,OAAO8xC,qBAAoB;AACnCmiD,kBAAcvsE,aAAa,QAAQ;AACnCusE,kBAAcvsE,aAAa,eAAe,IAAA;AAAA,EAC1C;AAED,MAAIwsE,2BAA2B/gG,OAAO,MAAA,KAAA,CAAA,CAAaA,OAAO,IAASA,KAAAA,OAAO;AAC1E,MAAI+gG,wBAAuB;AAC1Bz2F,IAAAA,OAAMuC,OAAOm0F,0BAA0B;AAAA,EACvC;AAGD12F,EAAAA,OAAMgC,MAAMrI,YAAY68F,aACxB;AAAA,MAAIA,cAAcG,eAAe;AAChCC,uBAAmB52F,QAAOw2F,cAAcG,aAAAA;AAAAA,EAC1C,OAAQ;AAEN32F,IAAAA,OAAMgC,MAAMnI,YAAY28F,aAAAA;AACxBI,uBAAmB52F,QAAOtK,MAAAA;AAAAA,EAC1B;AACF;AAEA,SAASkhG,mBAAmB52F,QAAOtK,SAClC;AAAA,MAAImhG,gBAAgB72F,OAAMuC,OAAO+tC,4BAA4B;AAC7D,MAAIwmD;AACJ,MAAIC,eAAeC,iBAAiBh3F,MAAAA;AAEpC,MAAIA,OAAMuC,OAAOm0F,2BAA2B,WAAU;AACrDO;EACA,OACI;AACJ,QACCj3F;AAAAA,MAAAA,OAAM1D,MAAM5G,SAAQ,UAAU,WAC7B;AAAA,YAAIsK,OAAMk3F,mBAAmB;AAC5Bl3F,UAAAA,OAAMk3F,oBAAoB;AAAA,QAC1B,OACI;AAEJ,cAAIC,cAAcH,iBAAiBh3F;AACnC,cAAI+2F,aAAatgG,KAAK0gG,YAAY1gG,KAAKsgG,aAAazgG,KAAK6gG,YAAY7gG,GAAE;AACtE;AAAA,UACA;AACDygG,yBAAeI;AACfC,uBAAAA;AAAAA,QACA;AAAA,MACL,CACG;AAAA,IAAA,SACMj7F,GACN86F;AAAAA,4BAAAA;AAAAA,IACA;AAAA,EACD;AAED,WAASG,eAAAA;AACRtvF,iBAAagvF,WACbA;AAAAA,kBAAcjvF,WAAW,WACxB;AAAA,UAAA,CAAI7H,OAAMmvB,YAAW;AACpBnvB,QAAAA,OAAM2C,OAAAA;AAAAA,MACN;AAAA,IACD,GAAEk0F;EACH;AAED,MAAIQ,iBAAiBr3F,OAAMgC,MAAM/L;AACjC,MAAIqhG,gBAAgBt3F,OAAMgC,MAAMhM;AAEhC,WAASihG,wBAAAA;AACR,QAAIj3F,OAAMgC,MAAM/L,gBAAgBohG,kBAC9Br3F,OAAMgC,MAAMhM,eAAeshG,eAAc;AACzCF,mBAAAA;AAAAA,IACD;AAEDC,qBAAiBr3F,OAAMgC,MAAM/L;AAC7BqhG,oBAAgBt3F,OAAMgC,MAAMhM;AAE5B6R,eAAWovF,uBAAuBJ,aAAAA;AAAAA,EAClC;AACF;AAEA,SAASG,iBAAiBh3F;AACzB,SAAO,EACNvJ,GAAGuJ,OAAMgC,MAAMhM,aACfM,GAAG0J,OAAMgC,MAAM/L,aAAAA;AAEjB;ACrFe,SAAQo0C,OAACrqC,QACvB;AAAA,SAAO,SAASqqC,QAAOsB,OAAO6yC,SAAAA;AAC7B,SAAK7yC,OAAM;AACV,UAAG3rC,OAAMuC,OAAO6xC,eAAep0C,OAAMgF,UAAU,WAAU,CAACw5E,OAAc,CAAA,MAAA,OAAO;AAC9E,YAAIx+E,OAAMw+E,SAAS;AAClBx+E,UAAAA,OAAMw+E,QAAQ,EAACtvE,MAAM,SAASoJ,MAAMkmE,SAAS+Y,QAAAA;QAC7C,OACI;AAEJ34F,kBAAQ6jB,IAAI+7D,OACZ;AAAA,QAAA;AAGD;AAAA,MACA;AAAA,IACD;AAAA,EACH;AACA;ACfe,SAAQgZ,WAACx3F,QAGvBA;AAAAA,EAAAA,OAAMqqC,SAASA,OAAOrqC,MAEtB;AAAA,WAASy3F,cAAc5gG,MACtB;AAAA,QAAA;AACCA,WAAKisD,UAAU,KACf;AAAA,IAAA,SACM3mD,GACN;AAAA,aAAO;AAAA,IACP;AAED,WAAO;AAAA,EAEP;AAED,MAAIu7F,0BAA0B;AAG9B,WAASC,aAAa9gG,MACrB;AAAA,QAAA,CAAKA,QAAgBA,OAAAA,QAAQ,YAAYxB,SAAS4F,eAAepE,IAAQ,EAAA,QAAO;AAChF,QAAI4gG,cAAc5gG,MAAO,QAAO;AAEhCmJ,IAAAA,OAAMqqC,OAAO,OAAOqtD,uBAAAA;AACpB,UAAM,IAAI/hD,MAAM+hD;EAChB;AAGD13F,EAAAA,OAAMu6C,OAAO,SAAS1jD,MAAMyuD,MAAMC,IAAAA;AACjC,QAAIvlD,OAAM00C,IAAIc,QAAQ;AACrB3+C,aAAO;AAAA,IACV,OAAS;AACN8gG,mBAAa9gG,IACb;AAAA,IAAA;AAED,QAAGyuD,QAAQC,IAAG;AACbtoD,WAAKsF,OAAO6M,aAAanS,KAAKo8D,YAAY,IAAI1jD,KAAK2vC,IACnDroD;AAAAA,WAAKsF,OAAO8M,WAAWpS,KAAKq8D,YAAY,IAAI3jD,KAAK4vC,EAAAA;AAAAA,IACjD;AACDtoD,SAAKqS,KAAKirC;AAGVt9C,SAAKs9C,OAAO,SAAS1jD,OAAAA;AACpB,UAAImJ,OAAM00C,IAAIc,QAAQ;AACrB3+C,QAAAA,QAAO;AAAA,MACX,OAAU;AACN8gG,qBAAa9gG,KAAAA;AAAAA,MACb;AAED,UAAIoG,KAAKqP,cAAcrP,KAAKqP,WAAW9W,YAAW;AACjDyH,aAAKqP,WAAW9W,WAAWqE,YAAYoD,KAAKqP,UAAAA;AAC5CrP,aAAKqP,aAAa;AAAA,MAClB;AAED,UAAGrP,KAAKkiC,SAAQ;AACfliC,aAAKkiC,QAAQ76B;MACb;AACDrH,WAAK26F,QAAQ/gG,KAAAA;AAAAA,IAChB;AACEoG,SAAK26F,QAAQ/gG,IACf;AAAA,EAAA;AAECmJ,EAAAA,OAAMi5B,gBAAgB,SAASrhB,MAAAA;AAC9B,QAAI86C,SAASz1D,KAAKs1D,eAAez5D,KAAKmE,IACtC;AAAA,aAAQlE,IAAI,GAAGA,IAAI25D,OAAO15D,QAAQD,KAAI;AACrC25D,aAAO35D,CAAGwyD,EAAAA,iBAAiB;AAAA,IAC3B;AAED3zC;AAEA,aAAQ7e,IAAI,GAAGA,IAAI25D,OAAO15D,QAAQD,KAAI;AACrC25D,aAAO35D,CAAAA,EAAGwyD,iBAAiB;AAAA,IAC3B;AAAA,EACH;AAEC,MAAIssC,cAAa,SAAUA,cAAAA;AAC1B,QAAG56F,KAAK66F,kBAAiB;AACxB76F,WAAK66F,iBACL;AAAA,IAAA;AAED,QAAG76F,KAAK86F,kBAAiB;AACxB96F,WAAK86F,iBAAAA;AAAAA,IACL;AAED,QAAG96F,KAAKkiC,SAAQ;AACfliC,WAAKkiC,QAAQjzB;AACbjP,WAAKkiC,UAAU;AACfliC,WAAKmP,IAAIisB;IACT;AAAA,EACD,GAAEzzB,KAAK5E,MAAAA;AAER,MAAIg4F,iBAAgB,SAAUA,iBAC7B;AAAA,QAAG9nC,WAAWlwD,MAAAA,GAAO;AACpB;AAAA,IACA;AAED/C,SAAK+E,MAAM1G,YAAY;AAEvB2B,SAAK+E,MAAMhC,QAAQ/C;AACnB+9D,qBAAoB/9D;AACpBA,SAAKsF,OAAOmsC,OAAOxqC,KAAK;AACxBjH,SAAKkiC,UAAUliC,KAAKmP,IAAI6rF,WAAW,UAAUh7F,KAAK+E,OAAO/E,KAAKsF,OAAOmsC,MAAAA;AAErEzxC,SAAKkiC,QAAQ16B,YAAY,kBAAkB,WAAA;AAC1C,UAAIstD,aAAa/xD,OAAMc,UAAUC,WAAW;AAC5C,eAAQhI,IAAI,GAAGA,IAAIg5D,WAAW/4D,QAAQD,KAAI;AACzCiH,QAAAA,OAAMsoC,aAAaypB,WAAWh5D,CAAImmD,CAAAA,EAAAA,OAAAA;AAClC,YAAIl/C,OAAM+yB,MAAMC,WAAW68B,wBAAuB;AAEjD,cAAI7vD,OAAM+yB,MAAMC,WAAW68B,0BAA0B,YAAW;AAC/D7vD,YAAAA,OAAM+yB,MAAMC,WAAW68B,yBAAyB;AAAA,UAChD;AAAA,QAEN,OAAW;AACN7vD,UAAAA,OAAMsoC,aAAaypB,WAAWh5D,CAAAA,CAAAA,EAAIiM,UAAU,sBAAsB,CAAA,CAAA;AAAA,QAClE;AAAA,MACD;AAAA,IACJ,CAAA;AAEE/H,SAAKkiC,QAAQ16B,YAAY,YAAY;AACpCzE,MAAAA,OAAMi5B,cAAc;AACnBj5B,QAAAA,OAAMwyD,YAAAA;AAAAA,MACV;IACA,CAEEv1D;AAAAA,SAAK+H,UAAU,sBAAsB,CACrC/H,CAAAA;AAAAA,SAAKkiC,QAAQx8B,OAEb1F;AAAAA,SAAKqP,aAAarP,KAAKkiC,QAAQ7yB,WAAW9Q;AAE1C66F,sBAAkBp5F,IAAAA;AAAAA,EAClB,GAAE2H,KAAK5E,MAERA;AAAAA,EAAAA,OAAMk4F,cAAc,WACnBL;AAAAA,eAAAA;AACAG;AACA/6F,SAAK0F,OAAAA;AAAAA,EACP;AAEC3C,EAAAA,OAAM43F,UAAU,SAAS/gG,MAAAA;AACxBoG,SAAK+H,UAAU,sBAAsB,CACrC/H,CAAAA;AAAAA,SAAKg2D,cAEL;AAAA,QAAI1wD,UAAStF,KAAK6D,UAAUC,WAAW,gBAAA;AACvCwB,IAAAA,QAAO0hD,cAAchnD,IAErB46F;AAAAA,eAAAA;AAEA56F,SAAK+E,QAAQ;AACb,QAAGnL,MAAK;AACPoG,WAAK+E,QAAQm2F,OAAkBthG,IAC/BmhG;AAAAA,oBAAAA;AACA/6F,WAAKm7F,aAAa//D,MAAMp7B,KAAK+E,KAAAA;AAC7Bq2F,sBAAgBr4F,MAAAA;AAAAA,IAChB;AAED/C,SAAK+H,UAAU,oBAAmB,CAAA,CAAA;AAElC/H,SAAK+H,UAAU,gBAAgB,CAAA,CAAA;AAE/B/H,SAAK0F,OACP;AAAA,EAAA;AAEC,WAAS01F,gBAAgBr4F,QAAAA;AACxB,QAAIA,OAAMsM,cAAAA,CAAetM,OAAMuC,OAAOiZ,UAAU;AAC/C,UAAIxb,OAAMgC,MAAM/L,eAAe,IAAI;AAElC2I,gBAAQq2D,KAAK;AAAA,0EAAA;AAAA,MAEb;AAAA,IACD;AAAA,EACD;AAEDj1D,EAAAA,OAAMwuB,SAAO,EACZC,SAAQ,EACP6pE,MAAQ,SAASp0F;AAChB,QAAIlE,OAAMqrB,WAAWrrB,OAAMmc,QAAQjY,EAAAA,CAAAA,GAAM;AACxC;AAAA,IACA;AACDlE,IAAAA,OAAM0uB,aAAaxqB,EACnB;AAAA,EAAA,GACDoiB,QAAU,SAASpiB,IAAAA;AAClB,QAAIkH,OAAOpL,OAAMmc,QAAQjY;AACzB,QAAIlE,OAAMqrB,WAAWjgB,IAAO,GAAA;AAC3B;AAAA,IACA;AACD,QAAImtF,WAAWv4F,OAAMoT,OAAOC,OAAOmlF;AACnC,QAAIxnF,QAAQhR,OAAMoT,OAAOC,OAAOolF;AAEhCz4F,IAAAA,OAAM04F,gBAAgBH,UAAUvnF,OAAO,WACtC;AAAA,UAAA,CAAIhR,OAAM0d,aAAaxZ,EAAAA,GAAI;AAC1BlE,QAAAA,OAAM24F,aAAAA;AACN;AAAA,MACA;AAED,UAAGvtF,KAAK6mF,MAAK;AAGZjyF,QAAAA,OAAM+yB,MAAMC,WAAW68B,yBAAyB;AAChD7vD,QAAAA,OAAMu4B,OAAO,WAAA;AACZv4B,UAAAA,OAAM8mD,WAAW5iD,IAAI,IAC5B;AAAA,QAAA,CAAA;AACMlE,QAAAA,OAAM+yB,MAAMC,WAAW68B,yBAAyB;AAChD7vD,QAAAA,OAAMwyD,YACZ;AAAA,MAAA,OAAU;AACJxyD,QAAAA,OAAM+yB,MAAMC,WAAW68B,yBAAyB;AAChD7vD,QAAAA,OAAM8mD,WAAW5iD,EACjB;AAAA,MAAA;AAEDlE,MAAAA,OAAM24F,aACX;AAAA,IAAA,CAAA;AAAA,EACI;AAKH34F,EAAAA,OAAM2C,SAAS,WACd1F;AAAAA,SAAK+H,UAAU,uBAAuB;AAEtC,QAAI4zF;AACJ,SAAI1oC,WAAWlwD,MAAAA,GAAO;AACrB,UAAK/C,CAAAA,KAAKsF,OAAOrJ,QAAQ+D,KAAK47F,OAAO;AACpC57F,aAAK47F,QAAQv7F;AAAAA,MACb;AAED,UAAGL,KAAK+E,OAAM;AACb,YAAG/E,KAAKsF,OAAOmZ,KAAI;AAClBze,eAAK+E,MAAMnH,UAAU0O,IAAI,WACzBtM;AAAAA,eAAK+E,MAAMxG,WAAWX,UAAU0O,IAAI,WAAA;AAAA,QACzC,OAAS;AACJtM,eAAK+E,MAAMnH,UAAU2S,OAAO,WAAA;AAC5BvQ,eAAK+E,MAAMxG,WAAWX,UAAU2S,OAAO,WACvC;AAAA,QAAA;AAAA,MACD;AAED,UAAItE,MAAMjM,KAAK2Q,eAAAA;AACf,UAAIkrF,OAAO5vF,MAAMA,IAAIzS,IAAI;AACzB,UAAGwG,KAAK87F,wBAA0B,GAAA;AACjC,YAAIC,YAAY/7F,KAAK87F,wBACrBD;AAAAA,eAAOE,UAAUtrF,QAAQurF,kBAAkBH,QAAQ;AAAA,MACnD;AAGDF,oBAAc;AACd,UAAGE,MAAK;AACPF,sBAAc54F,OAAMmK,YAAY2uF,OAAO77F,KAAKsF,OAAO0qB,kBAAAA;AAAAA,MACnD;AAAA,IACD;AAED+tC,qBAAoB/9D,IAAAA;AAEpB,SAAIizD,WAAWlwD,MAAAA,GAAO;AACrB/C,WAAKkiC,QAAQzxB,QAAQ8N,WAAWve,KAAKsF,OAAOiZ;AAC5C,UAAI09E,iBAAiBj8F,KAAKsF,OAAO8tC;AACjCpzC,WAAKsF,OAAO8tC,kBAAkB;AAC9BpzC,WAAKkiC,QAAQ0R,OACb5zC;AAAAA,WAAKsF,OAAO8tC,kBAAkB6oD;AAE9B,UAAGj8F,KAAKsF,OAAO8tC,mBAAmBnnC,KAAI;AAGrC,YAAI4vF,QAAQ5vF,IAAI5S,GAAG;AAClB,cAAI6iG,UAAUn5F,OAAM4N,eACpB;AAAA,cAAIwrF,WAAWp5F,OAAMmK,YAAYgvF,QAAQ1iG,CACzC;AAAA,cAAA,EAAA,CAAMmiG,eAAgBQ,CAAAA,YAAYD,QAAQ7iG,KAAK4S,IAAI5S,IAAG;AACrD,gBAAIwiG,OAAO;AACX,gBAAIO,OAAO;AACX,gBAAGT,aAAY;AACd,kBAAIE,OAAOviG,KAAKuD,IAAIkG,OAAMmpB,YAAYyvE,WAAAA,IAAe54F,OAAMuC,OAAO0qB,oBAAoB,CACtF;AAAA,YAAA;AACD,gBAAG/jB,IAAI5S,GAAE;AACR+iG,qBAAOnwF,IAAI5S;AAAAA,YACX;AACD0J,YAAAA,OAAMuR,SAASunF,MAAMO,IAAAA;AAAAA,UACrB;AAAA,QACD;AAMD,cAAMC,iBAAiBr8F,KAAKkiC,QAAQo6D,kBAAAA;AACpCD,uBAAelzF,QAASozF,iBAAAA;AACvB,gBAAMhpF,SAASxQ,OAAMoM,IAAIC,QAAQmtF,YAAYt1F,EAAAA;AAC7C,gBAAMu1F,uBAAuBz5F,OAAM2B,MAAMC,IAAI1D,UAAUsS,OAAOkpF,OAAO15F,OAAMsM,UAC3EktF;AAAAA,sBAAYG,WAAWvzF,QAASwzF;AAC/B,kBAAMjxF,OAAO3I,OAAMoM,IAAIC,QAAQutF;AAC/B,gBAAGJ,YAAYljG,KAAKkjG,YAAYljG,KAAK4S,IAAI5S,GAAE;AAC1C,kBAAGqS,QAAS8wF,CAAAA,sBAAqB;AAChC9wF,qBAAK4I,SAASjU,QAAW,CAAA;AAAA,cACzB;AAAA,YACD;AAED,gBAAGk8F,YAAYK,SAASL,YAAYK,SAAS3wF,IAAIzS,GAAE;AAClD,kBAAGkS,QAAQ8wF,sBAAqB;AAC/B9wF,qBAAK4I,SAASioF,YAAYK,OAAOv8F,MACjC;AAAA,cAAA;AAAA,YACD;AAAA,UACA,CAAA;AAAA,QAAA,CAAA;AAAA,MAEH;AAAA,IAEJ,OAAO;AACJ0C,MAAAA,OAAMwyD,YAAAA;AAAAA,IACN;AACDv1D,SAAK+H,UAAU,iBAAiB;EAClC;AAGChF,EAAAA,OAAM85F,WAAW95F,OAAM2C;AAGvB3C,EAAAA,OAAM69B,iBAAiB,SAAS35B,IAC/B;AAAA,QAAIwrD,MAAMzyD,KAAK2vB,WAAW/wB;AAC1B,QAAIe,YAAYK,KAAKsF,OAAO6pB;AAC5B,aAASrzB,IAAI,GAAGA,IAAI22D,IAAI12D,QAAQD,KAAK;AACpC,UAAI22D,IAAI32D,CAAG1B,EAAAA,cAAc;AACxB,YAAI2e,QAAQ05C,IAAI32D,CAAAA,EAAG1B,aAAauF,SAAAA;AAChC,YAAIoZ,SAAS9R,GAAI,QAAOwrD,IAAI32D,CAAAA;AAAAA,MAC5B;AAAA,IACD;AACD,WAAO;AAAA,EACT;AAECiH,EAAAA,OAAM+5F,qBAAqB,SAAS7qF,MACnC;AAAA,QAAGjS,KAAK+8F,gBAAqB9qF,KAAAA,KAC5B,QAAO;AACRlP,IAAAA,OAAMi6F,wBAAwB/qF,IAAAA;AAAAA,EAChC;AAEClP,EAAAA,OAAMk6F,iBAAiB,SAAUz0C,YAAYC,UAC5C;AAAA,QAAIx2C,OAAO;AACX,QAAIu2C,cAAcC,UAAU;AAC3Bx2C,aAAOlP,OAAMuC,OAAOqY,MAAMk0B;AAAAA,IAC7B,YAAc2W,cAAcC,UAAU;AACnCx2C,aAAOlP,OAAMuC,OAAOqY,MAAMi0B;AAAAA,IAC7B,YAAc4W,cAAeC,CAAAA,UAAU;AACpCx2C,aAAOlP,OAAMuC,OAAOqY,MAAMm0B;AAAAA,IAC7B,WAAa0W,cAAeC,CAAAA,UAAU;AACnCx2C,aAAOlP,OAAMuC,OAAOqY,MAAMo0B;AAAAA,IAC1B;AACD,WAAO9/B;AAAAA,EACT;AAEClP,EAAAA,OAAM+lD,gBAAgB,SAAUT,MAAMC,IAAIE,YAAYC,UACrD;AAAA,QAAIjoC,OAAO;AACX,eAAW,QAAS,UAAU;AAC7BA,aAAO6nC;AAAAA,IACV,OAAS;AACN7nC,aAAO,EAACE,QAAQ2nC,MAAM/oD,QAAQgpD,IAAIr2C,MAAMjS,KAAKi9F,eAAez0C,YAAYC,QACxE,EAAA;AAAA,IAAA;AAED,SAAKjoC,KAAM,QAAO;AAClB,QAAMA,EAAAA,KAAKE,UAAUF,KAAKlhB,UAAUkhB,KAAKvO,MAAO,QAAO;AACvD,QAAIuO,KAAKE,UAAUF,KAAKlhB,OAAQ,QAAO;AAEvC,QAAIijB,MAAM;AAEV,QAAIviB,KAAKmI,WAAW,oBACnBoa,OAAMviB,KAAK+H,UAAU,oBAAoB,CAACyY,IAAAA,CAAAA;AAE3C,WAAO+B;AAAAA,EACT;AAGCxf,EAAAA,OAAMk4D,sBAAsB,SAAS5oD,OAAM6qF,YAAYz9E,MAAMvW,MAAAA;AAC5D,QAAIi0F,YAAYC,iBAAyBl0F,QAAQuW;AACjD,QAAG09E,YAAY,KAAG,MAAMA,YAAY,KAAG,KAAG,IAAG;AAE5C,UAAIE,gBAAgBhrF,MAAKwrC,sBAAsBq/C;AAC/C,UAAGG,eAAc;AAChBhrF,QAAAA,QAAOtP,OAAMsP,KAAK/F,IAAI+F,OAAMgrF,eAAe,QAC3C;AAAA,MAAA;AAAA,IACD;AACD,WAAOhrF;AAAAA,EACT;AAECtP,EAAAA,OAAMgzD,cAAc,SAAS5nD;AAC5BpL,IAAAA,OAAMqqC,OAAOj/B,QAAQA,gBAAgB2S,QAAQ,kCAAgC3S,OAAK,iDAClF;AAAA,WAAOnO,KAAK81B,MAAMC,WAAWm6B,aAAa/hD;EAC5C;AAECpL,EAAAA,OAAMo5B,sBAAsB,SAASj9B,GAAAA;AACpC,SAAKA,EACJ,QAAO;AACR,QAAII,SAASJ,EAAEI,UAAUJ,EAAEK;AAC3B,UAAMD,UAAUA,OAAOvC,WACtB,QAAO;AACR,QAAIA,YAAYugG,aAAwBh+F,MAAAA;AACxC,QAAIvC,UAAUE,QAAQ,8BAA8BF,UAAUE,QAAQ,aAAoB,MAAA,MAAKF,UAAUE,QAAQ,YAAmB,MAAA,IACnI,QAAO;AACR,WAAO;AAAA,EACT;AAEA;AClZA,SAASgnC,OAAOlhC,QAEfA;AAAAA,EAAAA,OAAMkM,aAAa,WAAA;AAClBjP,SAAK+tD,SAAAA;AACL/tD,SAAK+H,UAAU,aAAa;AAE5B,QAAG/H,KAAK+E,OAAM;AACN/E,aAAAA,KAAK+E,MAAMhC;AAAAA,IAClB;AAED,QAAG/C,KAAKu9F,iBAAgB;AACvBv9F,WAAKu9F,gBAAAA;AAAAA,IACL;AAED,QAAGv9F,KAAKkiC,SAAQ;AACfliC,WAAKkiC,QAAQjzB,WACb;AAAA,IAAA;AAED,QAAGjP,KAAKw9F,eAAc;AACrBx9F,WAAKw9F,cAAAA;AAAAA,IACL;AAGD,QAAIx9F,KAAKmF,IAAIu3B,eAAe;AAC3B18B,WAAKmF,IAAIu3B,cAAcztB,WAAAA;AAAAA,IACvB;AAED,QAAGjP,KAAK4hE,OAAO5hE,KAAK4hE,IAAI3yD,YAAW;AAClCjP,WAAK4hE,IAAI3yD,WAAAA;AAAAA,IACT;AACDjP,SAAK6D,UAAUoL;AAGfjP,SAAKuI,gBAAAA;AAEL,aAAQzM,KAAKkE,MAAK;AACjB,UAAGlE,EAAEmB,QAAQ,GAAS,MAAA,GAAE;eAChB+C,KAAKlE,CAAAA;AAAAA,MACZ;AAAA,IACD;AACDkE,SAAKkyB,aAAa;AAAA,EACpB;AACA;AC1CA,MAAM/b,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,gBAAgB,QAAQ,QAAQ,SAAS,QAAQ,UAAU,QAAQ,MAAM,SAAS,eAAe,gBAAgB,aAC9HD,GAAAA,aAAa,CAAC,SAAS,UAAU,QAAQ,SAAS,QAAQ,SAAS,SAAS,SAAS,UAAU,UAAU,UAAU,QAAA,GACnHD,UAAU,CAAC,SAAS,WAAW,YAAY,YAAY,UAAU,UAAU,OAC3EH,GAAAA,WAAW,CAAC,OAAO,SAAS,UAAU,UAAU,QAAQ,QAAQ,KAEjE3lC,EAAAA,GAAAA,QAAQ,EACP+hE,UAAU,aACVslB,WAAW,QACXC,aAAa,SACbC,cAAc,UACdn8D,WAAW,SACXD,aAAa,OACbq8D,iBAAiB,qCACjBrC,kBAAkB,2CAClBsC,qBAAqB,SACrBC,cAAc,kBACdC,cAAc,QACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,aACbC,mBAAmB,cACnBC,iBAAiB,YACjBC,YAAY,IAGZ99E,MAAM,QACN+9E,uBAAuB,mBACvB71C,YAAY,YACZC,UAAU,UAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,aAEhB7kF,SAAS,WACTK,OAAO,SACP6/C,MAAM,QACN4kC,OAAO,QACPC,QAAQ,UACRC,OAAO,SAGPC,YAAY,MACZC,gBAAgB,SAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB;AC/E3B,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,YAAY,QAAQ,WAAW,YAAY,OAAO,WAAW,UAAU,WAAW,YAAY,cAAc,YAAY,SAAA,GACrID,aAAa,CAAC,SAAS,OAAO,OAAO,QAAQ,OAAO,OAAO,OAAO,QAAQ,OAAO,QAAQ,QAAQ,SACjGD,UAAU,CAAC,WAAW,cAAc,WAAW,UAAU,UAAU,WAAW,QAAA,GAC9EH,WAAW,CAAC,MAAM,MAAM,OAAO,MAAM,OAAO,MAAM,IAEnD3lC,EAAAA,GAAAA,QAAQ,EACP+hE,UAAU,iBACVslB,WAAW,YACXC,aAAa,YACbC,cAAc,UACdn8D,WAAW,WACXD,aAAa,YACbq8D,iBAAiB,IACjBrC,kBAAkB,iDAClBsC,qBAAqB,YACrBC,cAAc,eACdC,cAAc,OACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,UACbC,mBAAmB,WACnBC,iBAAiB,UACjBC,YAAY,IAGZ99E,MAAM,UACN+9E,uBAAuB,kBACvB71C,YAAY,aACZC,UAAU,WAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,aAGhB7kF,SAAS,WACTK,OAAO,WACP6/C,MAAM,SACN4kC,OAAO,WACPC,QAAQ,SACRC,OAAO,OAGPC,YAAY,MACZC,gBAAgB,YAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SC5E3B,EAAA;AAAA,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,SAAS,UAAU,QAAQ,SAAS,QAAQ,QAAQ,UAAU,SAAS,YAAY,WAAW,YAAY,aACvHD,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAC3FD,GAAAA,UAAU,CAAC,YAAY,WAAW,WAAW,YAAY,UAAU,aAAa,UAChFH,GAAAA,WAAW,CAAC,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,IAEjD3lC,EAAAA,GAAAA,QAAQ,EACP+hE,UAAU,cACVslB,WAAW,WACXC,aAAa,cACbC,cAAc,WACdn8D,WAAW,UACXD,aAAa,YACbq8D,iBAAiB,IACjBrC,kBAAkB,0DAClBsC,qBAAqB,cACrBC,cAAc,oBACdC,cAAc,QACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,aACbC,mBAAmB,cACnBC,iBAAiB,YACjBC,YAAY,IAGZ99E,MAAM,QACN+9E,uBAAuB,mBACvB71C,YAAY,YACZC,UAAU,UAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,aAGhB7kF,SAAS,WACTK,OAAO,SACP6/C,MAAM,QACN4kC,OAAO,QACPC,QAAQ,UACRC,OAAO,SAGPC,YAAY,MACZC,gBAAgB,cAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SC3E3B,EAAA;AAAA,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,OAAO,QAChFD,aAAa,CAAC,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,OAAO,OAAO,KAClFD,GAAAA,UAAU,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,QACrDH,WAAW,CAAC,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,GAAA,EAAA,GAE3C3lC,QAAQ,EACP+hE,UAAU,OACVslB,WAAW,MACXC,aAAa,MACbC,cAAc,MACdn8D,WAAW,MACXD,aAAa,MACbq8D,iBAAiB,cACjBrC,kBAAkB,WAClBsC,qBAAqB,MACrBC,cAAc,QACdC,cAAc,MACdC,kBAAkB,YAClBC,mBAAmB,aAInBC,YAAY,UACZC,aAAa,OACbC,mBAAmB,QACnBC,iBAAiB,QACjBC,YAAY,IAIZ99E,MAAM,MACN+9E,uBAAuB,QACvB71C,YAAY,SACZC,UAAU,SAEV61C,WAAW,MACXC,cAAc,MACdC,gBAAgB,OAEhB7kF,SAAS,MACTK,OAAO,MACP6/C,MAAM,KACN4kC,OAAO,KACPC,QAAQ,KACRC,OAAO,KAGPC,YAAY,MACZC,gBAAgB,MAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB;AC1F3B,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,SAAS,QAAQ,UAAU,SAAS,UAAU,UAAU,YAAY,SAAS,QAAQ,SAAS,YAAY,UAAA,GACvHD,aAAa,CAAC,OAAO,MAAM,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,QAAQ,OAAO,QAAQ,KAC5FD,GAAAA,UAAU,CAAC,UAAU,WAAW,SAAS,UAAU,WAAW,SAAS,QACvEH,GAAAA,WAAW,CAAC,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,SAEjD3lC,QAAQ,EACP+hE,UAAU,cACVslB,WAAW,UACXC,aAAa,QACbC,cAAc,UACdn8D,WAAW,UACXD,aAAa,UACbq8D,iBAAiB,IACjBrC,kBAAkB,yCAClBsC,qBAAqB,YACrBC,cAAc,kBACdC,cAAc,QACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,aACbC,mBAAmB,cACnBC,iBAAiB,YACjBC,YAAY,IAGZ99E,MAAM,QACN+9E,uBAAuB,mBACvB71C,YAAY,YACZC,UAAU,UAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,aAGhB7kF,SAAS,WACTK,OAAO,SACP6/C,MAAM,QACN4kC,OAAO,QACPC,QAAQ,UACRC,OAAO,SAGPC,YAAY,MACZC,gBAAgB,QAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB;AChF3B,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,UAAU,WAAW,SAAS,SAAS,OAAO,QAAQ,QAAQ,UAAU,aAAa,WAAW,YAAY,UAAA,GACzHD,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAC3FD,GAAAA,UAAU,CAAC,UAAU,UAAU,WAAW,UAAU,WAAW,UAAU,QAAA,GACzEH,WAAW,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAEvD3lC,EAAAA,GAAAA,QAAQ,EACP+hE,UAAU,aACVslB,WAAW,OACXC,aAAa,WACbC,cAAc,YACdn8D,WAAW,UACXD,aAAa,QACbq8D,iBAAiB,8CACjBrC,kBAAkB,2DAClBsC,qBAAqB,eACrBC,cAAc,eACdC,cAAc,QACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,aACbC,mBAAmB,cACnBC,iBAAiB,YACjBC,YAAY,IAGZ99E,MAAM,QACN+9E,uBAAuB,mBACvB71C,YAAY,YACZC,UAAU,UAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,aAGhB7kF,SAAS,WACTK,OAAO,SACP6/C,MAAM,QACN4kC,OAAO,QACPC,QAAQ,UACRC,OAAO,SAGPC,YAAY,MACZC,gBAAgB,WAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SChF3B,EAAA;AAAA,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,WAAW,YAAY,UAAU,UAAU,QAAQ,SAAS,SAAS,WAAW,eAAe,YAAY,cAAc,WACtID,GAAAA,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAAA,GAC3FD,UAAU,CAAC,WAAW,UAAU,YAAY,aAAa,eAAe,WAAW,YACnFH,WAAW,CAAC,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,IAAA,EAAA,GAEjD3lC,QAAQ,EACP+hE,UAAU,gBACVslB,WAAW,aACXC,aAAa,aACbC,cAAc,WACdn8D,WAAW,UACXD,aAAa,WACbq8D,iBAAiB,IACjBrC,kBAAkB,6BAClBsC,qBAAqB,gBACrBC,cAAc,cACdC,cAAc,QACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,cACbC,mBAAmB,aACnBC,iBAAiB,SACjBC,YAAY,IAGZ99E,MAAM,QACN+9E,uBAAuB,mBACvB71C,YAAY,aACZC,UAAU,UAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,aAGhB7kF,SAAS,WACTK,OAAO,WACP6/C,MAAM,QACN4kC,OAAO,UACPC,QAAQ,UACRC,OAAO,SAGPC,YAAY,MACZC,gBAAgB,aAGhBC,oBAAoB,SACpBnjC,iBAAiB,SACjB1iD,iBAAiB,iBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,oBACNC,MAAM,2BACNC,MAAM,4BACNC,MAAM,mCACNC,KAAK,oBACLC,KAAK,uBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SAAA,EAAA;AChF3B,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,cAAc,eAAe,WAAW,YAAY,SAAS,WAAW,WAAW,aAAa,eAAe,aAAa,aAAa,YAAA,GACtJD,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,QAAQ,QAAQ,OAAO,OAAO,OAAO,OAAO,KAC7FD,GAAAA,UAAU,CAAC,WAAW,WAAW,SAAS,WAAW,UAAU,aAAa,SAC5EH,GAAAA,WAAW,CAAC,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,SAEjD3lC,QAAQ,EACP+hE,UAAU,eACVslB,WAAW,cACXC,aAAa,SACbC,cAAc,gBACdn8D,WAAW,eACXD,aAAa,YACbq8D,iBAAiB,IACjBrC,kBAAkB,wDAClBsC,qBAAqB,aACrBC,cAAc,oBACdC,cAAc,QACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,aACbC,mBAAmB,cACnBC,iBAAiB,YACjBC,YAAY,IAGZ99E,MAAM,QACN+9E,uBAAuB,mBACvB71C,YAAY,YACZC,UAAU,UAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,aAGhB7kF,SAAS,WACTK,OAAO,SACP6/C,MAAM,QACN4kC,OAAO,QACPC,QAAQ,UACRC,OAAO,SAGPC,YAAY,MACZC,gBAAgB,SAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SChF3B,EAAA;AAAA,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,WAAW,YAAY,SAAS,SAAS,OAAO,QAAQ,QAAQ,UAAU,aAAa,WAAW,YAAY,UAAA,GAC3HD,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,QAC3FD,UAAU,CAAC,UAAU,UAAU,WAAW,aAAa,YAAY,UAAU,UAAA,GAC7EH,WAAW,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAEvD3lC,EAAAA,GAAAA,QAAQ,EACP+hE,UAAU,YACVslB,WAAW,QACXC,aAAa,UACbC,cAAc,WACdn8D,WAAW,QACXD,aAAa,UACbq8D,iBAAiB,IACjBrC,kBAAkB,mDAClBsC,qBAAqB,eACrBC,cAAc,eACdC,cAAc,QACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,aACbC,mBAAmB,cACnBC,iBAAiB,YACjBC,YAAY,IAGZ99E,MAAM,QACN+9E,uBAAuB,mBACvB71C,YAAY,YACZC,UAAU,UAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,aAEhB7kF,SAAS,WACTK,OAAO,SACP6/C,MAAM,QACN4kC,OAAO,QACPC,QAAQ,UACRC,OAAO,SAGPC,YAAY,MACZC,gBAAgB,UAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SAAA,EAAA;ACvE3B,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,SAAS,WAAW,SAAS,SAAS,QAAQ,SAAS,SAAS,UAAU,cAAc,WAAW,aAAa,cAC7HD,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAC3FD,GAAAA,UAAU,CAAC,WAAW,SAAS,UAAU,aAAa,UAAU,WAAW,QAAA,GAC3EH,WAAW,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,UAEvD3lC,QAAQ,EACP+hE,UAAU,eACVslB,WAAW,WACXC,aAAa,YACbC,cAAc,YACdn8D,WAAW,UACXD,aAAa,YACbq8D,iBAAiB,IACjBrC,kBAAkB,qDAClBsC,qBAAqB,eACrBC,cAAc,WACdC,cAAc,QACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,SACbC,mBAAmB,UACnBC,iBAAiB,YACjBC,YAAY,IAGZ99E,MAAM,UACN+9E,uBAAuB,gBACvB71C,YAAY,aACZC,UAAU,UAEV61C,WAAW,SACXC,cAAc,YACdC,gBAAgB,QAGhB7kF,SAAS,WACTK,OAAO,SACP6/C,MAAM,QACN4kC,OAAO,WACPC,QAAQ,SACRC,OAAO,QAGPC,YAAY,MACZC,gBAAgB,YAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SCpF3B,EAAA;AAAA,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CACX,UACA,SACA,QACA,SACA,MACA,QACA,SACA,OACA,WACA,SACA,UACA,QAEDD,GAAAA,aAAa,CAAC,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,MAAM,MAAM,IAAA,GACvED,UAAU,CACT,UACA,UACA,WACA,YACA,WACA,QACA,MAAA,GAEDH,WAAW,CACV,KACA,KACA,KACA,KACA,KACA,KACA,QAGF3lC,QAAQ,EACP+hE,UAAU,cACVslB,WAAW,SACXC,aAAa,OACbC,cAAc,UACdn8D,WAAW,UACXD,aAAa,OACbq8D,iBAAiB,iDACjBrC,kBAAkB,sDAClBsC,qBAAqB,WACrBC,cAAc,YACdC,cAAc,OACdC,kBAAkB,YAClBC,mBAAmB,aAInBC,YAAY,OACZC,aAAa,SACbC,mBAAmB,aACnBC,iBAAiB,OACjBC,YAAY,IAGZ99E,MAAM,UACN+9E,uBAAuB,gBACvB71C,YAAY,WACZC,UAAU,YAEV61C,WAAW,SACXC,cAAc,SACdC,gBAAgB,SAEhB7kF,SAAS,SACTK,OAAO,SACP6/C,MAAM,SACN4kC,OAAO,QACPC,QAAQ,UACRC,OAAO,UAGPC,YAAY,SACZC,gBAAgB,OAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SCjH3B,EAAA;AAAA,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,YAAY,YAAY,aAAa,YAAY,YAAY,gBAAgB,iBAAiB,UAAU,WAAW,WAAW,aAAa,UACxJD,GAAAA,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAAA,GAC3FD,UAAU,CAAC,aAAa,aAAa,WAAW,eAAe,WAAW,aAAa,UACvFH,GAAAA,WAAW,CAAC,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,IAEjD3lC,EAAAA,GAAAA,QAAQ,EACP+hE,UAAU,gBACVslB,WAAW,YACXC,aAAa,QACbC,cAAc,UACdn8D,WAAW,WACXD,aAAa,UACbq8D,iBAAiB,IACjBrC,kBAAkB,yCAClBsC,qBAAqB,UACrBC,cAAc,aACdC,cAAc,QACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,aACbC,mBAAmB,cACnBC,iBAAiB,YACjBC,YAAY,IAGZ99E,MAAM,QACN+9E,uBAAuB,mBACvB71C,YAAY,YACZC,UAAU,UAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,aAGhB7kF,SAAS,WACTK,OAAO,SACP6/C,MAAM,QACN4kC,OAAO,QACPC,QAAQ,UACRC,OAAO,SAGPC,YAAY,MACZC,gBAAgB,QAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SChF3B,EAAA;AAAA,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,WAAW,WAAW,QAAQ,SAAS,OAAO,QAAQ,WAAW,QAAQ,aAAa,WAAW,YAAY,aAC1HD,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,QAAQ,QAAQ,OAAO,OAAO,OAAO,OAAO,KAAA,GAC7FD,UAAU,CAAC,YAAY,SAAS,SAAS,YAAY,SAAS,YAAY,QAAA,GAC1EH,WAAW,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAAA,EAAA,GAEvD3lC,QAAQ,EACP+hE,UAAU,kBACVslB,WAAW,eACXC,aAAa,WACbC,cAAc,WACdn8D,WAAW,YACXD,aAAa,WACbq8D,iBAAiB,IACjBrC,kBAAkB,uDAElBsC,qBAAqB,eACrBC,cAAc,WACdC,cAAc,QACdC,kBAAkB,YAClBC,mBAAmB,aAInBC,YAAY,OACZC,aAAa,mBACbC,mBAAmB,iBACnBC,iBAAiB,SACjBC,YAAY,IAIZ99E,MAAM,WACN+9E,uBAAuB,iBACvB71C,YAAY,WACZC,UAAU,SAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,aAGhB7kF,SAAS,WACTK,OAAO,UACP6/C,MAAM,SACN4kC,OAAO,YACPC,QAAQ,QACRC,OAAO,UAGPC,YAAY,MACZC,gBAAgB,WAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SCnF3B,EAAA;AAAA,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,SAAS,UAAU,OAAO,SAAS,OAAO,QAAQ,QAAQ,UAAU,UAAU,WAAW,UAAU,UAChHD,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAC3FD,GAAAA,UAAU,CAAC,SAAS,OAAO,SAAS,SAAS,SAAS,QAAQ,QAC9DH,WAAW,CAAC,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,GAE3C3lC,EAAAA,GAAAA,QAAQ,EACP+hE,UAAU,aACVslB,WAAW,QACXC,aAAa,OACbC,cAAc,SACdn8D,WAAW,QACXD,aAAa,OACbq8D,iBAAiB,IACjBrC,kBAAkB,2BAClBsC,qBAAqB,QACrBC,cAAc,SACdC,cAAc,QACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,aACbC,mBAAmB,cACnBC,iBAAiB,YACjBC,YAAY,IAGZ99E,MAAM,QACN+9E,uBAAuB,mBACvB71C,YAAY,YACZC,UAAU,UAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,aAGhB7kF,SAAS,WACTK,OAAO,SACP6/C,MAAM,QACN4kC,OAAO,QACPC,QAAQ,UACRC,OAAO,SAGPC,YAAY,MACZC,gBAAgB,OAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SAAA,EAAA;AC3E3B,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,YAAY,WAAW,UAAU,WAAW,WAAW,UAAU,UAAU,WAAW,SAAS,YAAY,WAAW,UACnID,GAAAA,aAAa,CAAC,OAAO,QAAQ,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAAA,GAC5FD,UAAU,CAAC,YAAY,eAAe,UAAU,WAAW,YAAY,SAAS,QAChFH,GAAAA,WAAW,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAAA,EAAA,GAEvD3lC,QAAQ,EACP+hE,UAAU,gBACVslB,WAAW,UACXC,aAAa,YACbC,cAAc,WACdn8D,WAAW,WACXD,aAAa,UACbq8D,iBAAiB,IACjBrC,kBAAkB,sDAClBsC,qBAAqB,QACrBC,cAAc,oBACdC,cAAc,OACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,iBACbC,mBAAmB,mBACnBC,iBAAiB,YACjBC,YAAY,IAGZ99E,MAAM,aACN+9E,uBAAuB,oBACvB71C,YAAY,cACZC,UAAU,WAEV61C,WAAW,WACXC,cAAc,WACdC,gBAAgB,aAEhB7kF,SAAS,UACTK,OAAO,QACP6/C,MAAM,QACN4kC,OAAO,UACPC,QAAQ,WACRC,OAAO,UAGPC,YAAY,MACZC,gBAAgB,YAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB;ACpF3B,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,UAAU,WAAW,WAAW,WAAW,SAAS,UAAU,UAAU,aAAa,cAAc,WAAW,YAAY,UAAA,GACvID,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,QAC3FD,UAAU,CAAC,YAAY,SAAS,QAAQ,UAAU,aAAa,UAAU,SAAA,GACzEH,WAAW,CAAC,MAAM,MAAM,MAAM,OAAO,OAAO,MAAM,KAEnD3lC,EAAAA,GAAAA,QAAQ,EACP+hE,UAAU,cACVslB,WAAW,UACXC,aAAa,SACbC,cAAc,aACdn8D,WAAW,eACXD,aAAa,UACbq8D,iBAAiB,IACjBrC,kBAAkB,gDAClBsC,qBAAqB,UACrBC,cAAc,WACdC,cAAc,QACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,aACbC,mBAAmB,cACnBC,iBAAiB,YACjBC,YAAY,IAGZ99E,MAAM,QACN+9E,uBAAuB,mBACvB71C,YAAY,YACZC,UAAU,UAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,aAGhB7kF,SAAS,WACTK,OAAO,SACP6/C,MAAM,QACN4kC,OAAO,QACPC,QAAQ,UACRC,OAAO,SAGPC,YAAY,MACZC,gBAAgB,SAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SChF3B,EAAA;AAAA,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,WAAW,YAAY,SAAS,SAAS,OAAO,QAAQ,QAAQ,WAAW,aAAa,WAAW,YAAY,aAC5HD,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,QAC3FD,UAAU,CAAC,UAAU,SAAS,UAAU,QAAQ,SAAS,SAAS,OAAA,GAClEH,WAAW,CAAC,QAAQ,OAAO,OAAO,OAAO,OAAO,OAAO,KAExD3lC,EAAAA,GAAAA,QAAQ,EACP+hE,UAAU,cACVslB,WAAW,UACXC,aAAa,SACbC,cAAc,UACdn8D,WAAW,QACXD,aAAa,SACbq8D,iBAAiB,IACjBrC,kBAAkB,sBAClBsC,qBAAqB,cACrBC,cAAc,WACdC,cAAc,QACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,aACbC,mBAAmB,cACnBC,iBAAiB,YACjBC,YAAY,IAGZ99E,MAAM,QACN+9E,uBAAuB,mBACvB71C,YAAY,YACZC,UAAU,UAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,aAGhB7kF,SAAS,WACTK,OAAO,SACP6/C,MAAM,QACN4kC,OAAO,QACPC,QAAQ,UACRC,OAAO,SAGPC,YAAY,MACZC,gBAAgB,SAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SAAA,EAAA;AC1E3B,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,WAAW,YAAY,SAAS,UAAU,UAAU,UAAU,UAAU,UAAU,aAAa,WAAW,YAAY,UACnID,GAAAA,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAAA,GAC3FD,UAAU,CAAC,YAAY,UAAU,WAAW,aAAa,WAAW,WAAW,QAC/EH,GAAAA,WAAW,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,UAEvD3lC,QAAQ,EACP+hE,UAAU,iBACVslB,WAAW,SACXC,aAAa,UACbC,cAAc,YACdn8D,WAAW,YACXD,aAAa,WACbq8D,iBAAiB,IACjBrC,kBAAkB,4CAClBsC,qBAAqB,eACrBC,cAAc,oBACdC,cAAc,QACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,iBACbC,mBAAmB,UACnBC,iBAAiB,UACjBC,YAAY,IAGZ99E,MAAM,QACN+9E,uBAAuB,kBACvB71C,YAAY,aACZC,UAAU,WAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,aAGhB7kF,SAAS,UACTK,OAAO,OACP6/C,MAAM,UACN4kC,OAAO,aACPC,QAAQ,QACRC,OAAO,QAGPC,YAAY,MACZC,gBAAgB,UAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SClF3B,EAAA;AAAA,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,OAAO,OAAO,KAAA,GACjFD,aAAa,CAAC,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,OAAO,OAAO,KAClFD,GAAAA,UAAU,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAAA,GACrDH,WAAW,CAAC,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,GAE3C3lC,EAAAA,GAAAA,QAAQ,EACP+hE,UAAU,SACVslB,WAAW,MACXC,aAAa,SACbC,cAAc,MACdn8D,WAAW,MACXD,aAAa,MACbq8D,iBAAiB,IACjBrC,kBAAkB,yBAClBsC,qBAAqB,YACrBC,cAAc,MACdC,cAAc,QACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,aACbC,mBAAmB,cACnBC,iBAAiB,YACjBC,YAAY,IAGZ99E,MAAM,QACN+9E,uBAAuB,mBACvB71C,YAAY,YACZC,UAAU,UAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,aAGhB7kF,SAAS,WACTK,OAAO,SACP6/C,MAAM,QACN4kC,OAAO,QACPC,QAAQ,UACRC,OAAO,SAGPC,YAAY,MACZC,gBAAgB,SAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SAAA,EAAA;AChF3B,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,OAAO,OAAO,KACjFD,GAAAA,aAAa,CAAC,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,OAAO,OAAO,KAAA,GAClFD,UAAU,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,QACrDH,WAAW,CAAC,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,GAAA,EAAA,GAE3C3lC,QAAQ,EACP+hE,UAAU,WACVslB,WAAW,MACXC,aAAa,MACbC,cAAc,SACdn8D,WAAW,MACXD,aAAa,MACbq8D,iBAAiB,IACjBrC,kBAAkB,iBAClBsC,qBAAqB,MACrBC,cAAc,MACdC,cAAc,QACdC,kBAAkB,YAClBC,mBAAmB,aACnBC,YAAY,OACZC,aAAa,OACbC,mBAAmB,OACnBC,iBAAiB,MACjBC,YAAY,IACZ99E,MAAM,MACN+9E,uBAAuB,cACvB71C,YAAY,YACZC,UAAU,UACV61C,WAAW,MACXC,cAAc,QACdC,gBAAgB,QAChB7kF,SAAS,KACTK,OAAO,MACP6/C,MAAM,KACN4kC,OAAO,KACPC,QAAQ,KACRC,OAAO,KAGPC,YAAY,MACZC,gBAAgB,MAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SAAA,EAAA;AC7E3B,MAAqBC,cAGpB;AAAA,EAAA,YAAY36F,SAAAA;AAOAtF,SAAAkgG,YAAA,CAAC7iG,MAAc8Y,YAAAA;AACrBnW,WAAAmgG,SAAS9iG,IAAAA,IAAQ8Y;AAAAA,IAAA;AAGvBnW,SAAAogG,YAAa/iG,UACL2C,KAAKmgG,SAAS9iG;AAXrB2C,SAAKmgG,WAAW;AAChB,eAAUrkG,KAAKwJ,SAAO;AACrBtF,WAAKmgG,SAASrkG,CAAKwJ,IAAAA,QAAOxJ;IAC3B;AAAA,EACD;AAAA;ACRD,MAAMqa,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,UAAU,WAAW,QAAQ,SAAS,OAAO,QAAQ,QAAQ,UAAU,aAAa,WAAW,YAAY,UACxHD,GAAAA,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAAA,GAC3FD,UAAU,CAAC,UAAU,UAAU,WAAW,UAAU,WAAW,UAAU,QACzEH,GAAAA,WAAW,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,UAEvD3lC,QAAQ,EACP+hE,UAAU,cACVslB,WAAW,SACXC,aAAa,UACbC,cAAc,YACdn8D,WAAW,WACXD,aAAa,SACbq8D,iBAAiB,IACjBrC,kBAAkB,sDAClBsC,qBAAqB,eACrBC,cAAc,eACdC,cAAc,QACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,aACbC,mBAAmB,cACnBC,iBAAiB,YACjBC,YAAY,IAGZ99E,MAAM,QACN+9E,uBAAuB,mBACvB71C,YAAY,YACZC,UAAU,UAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,aAGhB7kF,SAAS,WACTK,OAAO,SACP6/C,MAAM,QACN4kC,OAAO,QACPC,QAAQ,UACRC,OAAO,SAGPC,YAAY,MACZC,gBAAgB,UAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB;AChF3B,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,WAAW,YAAY,SAAS,SAAS,OAAO,QAAQ,QAAQ,YAAY,aAAa,WAAW,YAAY,UAAA,GAC7HD,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAC3FD,GAAAA,UAAU,CAAC,UAAU,WAAW,WAAW,YAAY,aAAa,WAAW,UAC/EH,GAAAA,WAAW,CAAC,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,SAEjD3lC,QAAQ,EACP+hE,UAAU,eACVslB,WAAW,WACXC,aAAa,aACbC,cAAc,WACdn8D,WAAW,YACXD,aAAa,eACbq8D,iBAAiB,IACjBrC,kBAAkB,mDAClBsC,qBAAqB,gBACrBC,cAAc,gBACdC,cAAc,QACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,qBACbC,mBAAmB,cACnBC,iBAAiB,QACjBC,YAAY,IAGZ99E,MAAM,aACN+9E,uBAAuB,yBACvB71C,YAAY,YACZC,UAAU,WAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,aAGhB7kF,SAAS,WACTK,OAAO,QACP6/C,MAAM,SACN4kC,OAAO,SACPC,QAAQ,WACRC,OAAO,SAGPC,YAAY,MACZC,gBAAgB,aAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SChF3B,EAAA;AAAA,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,UAAU,WAAW,QAAQ,SAAS,OAAO,QAAQ,QAAQ,UAAU,aAAa,WAAW,YAAY,UACxHD,GAAAA,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAAA,GAC3FD,UAAU,CAAC,UAAU,UAAU,WAAW,UAAU,WAAW,UAAU,WACzEH,WAAW,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAAA,EAAA,GAEvD3lC,QAAQ,EACP+hE,UAAU,cACVslB,WAAW,SACXC,aAAa,UACbC,cAAc,YACdn8D,WAAW,SACXD,aAAa,SACbq8D,iBAAiB,6CACjBrC,kBAAkB,8CAClBsC,qBAAqB,eACrBC,cAAc,eACdC,cAAc,QACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,aACbC,mBAAmB,cACnBC,iBAAiB,YACjBC,YAAY,IAGZ99E,MAAM,QACN+9E,uBAAuB,mBACvB71C,YAAY,YACZC,UAAU,UAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,aAGhB7kF,SAAS,WACTK,OAAO,SACP6/C,MAAM,QACN4kC,OAAO,QACPC,QAAQ,UACRC,OAAO,SAGPC,YAAY,MACZC,gBAAgB,UAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SAAA,EAAA;AChF3B,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,WAAW,QAAQ,UAAU,YAAY,OAAO,YAAY,UAAU,YAAY,YAAY,eAAe,YAAY,UAAA,GACtID,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAC3FD,GAAAA,UAAU,CAAC,aAAa,gBAAgB,UAAU,SAAS,YAAY,UAAU,WACjFH,WAAW,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAAA,EAAA,GAEvD3lC,QAAQ,EACP+hE,UAAU,gBACVslB,WAAW,UACXC,aAAa,UACbC,cAAc,aACdn8D,WAAW,UACXD,aAAa,QACbq8D,iBAAiB,IACjBrC,kBAAkB,uDAClBsC,qBAAqB,QACrBC,cAAc,eACdC,cAAc,OACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,iBACbC,mBAAmB,YACnBC,iBAAiB,gBACjBC,YAAY,IAGZ99E,MAAM,QACN+9E,uBAAuB,qBACvB71C,YAAY,eACZC,UAAU,aAEV61C,WAAW,WACXC,cAAc,WACdC,gBAAgB,aAGhB7kF,SAAS,UACTK,OAAO,WACP6/C,MAAM,OACN4kC,OAAO,WACPC,QAAQ,YACRC,OAAO,QAGPC,YAAY,MACZC,gBAAgB,UAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SAAA,EAAA;AC7D3B,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,WAAW,aAAa,SAAS,SAAS,QAAQ,SAAS,SAAS,UAAU,YAAY,WAAW,YAAY,UAAA,GAC9HD,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAC3FD,GAAAA,UAAU,CAAC,WAAW,WAAW,SAAS,UAAU,UAAU,SAAS,QACvEH,GAAAA,WAAW,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,UAEvD3lC,QAAQ,EACP+hE,UAAU,eACVslB,WAAW,UACXC,aAAa,YACbC,cAAc,YACdn8D,WAAW,UACXD,aAAa,WACbq8D,iBAAiB,IACjBrC,kBAAkB,yDAClBsC,qBAAqB,aACrBC,cAAc,WACdC,cAAc,QACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,eACbC,mBAAmB,eACnBC,iBAAiB,WACjBC,YAAY,IAGZ99E,MAAM,QACN+9E,uBAAuB,kBACvB71C,YAAY,aACZC,UAAU,UAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,SAGhB7kF,SAAS,WACTK,OAAO,SACP6/C,MAAM,QACN4kC,OAAO,WACPC,QAAQ,SACRC,OAAO,QAGPC,YAAY,MACZC,gBAAgB,YAGhBC,oBAAoB,aACpBnjC,iBAAiB,kBACjB1iD,iBAAiB,kBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,wBACNC,MAAM,yBACNC,MAAM,yBACNC,MAAM,0BACNC,KAAK,sBACLC,KAAK,uBAGLC,8BAA8B,mBAC9BC,wBAAwB,kBAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SC/F3B,EAAA;AAAA,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,YAAY,aAAa,UAAU,WAAW,OAAO,SAAS,SAAS,UAAU,cAAc,aAAa,YAAY,UAAA,GACrID,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,QAC3FD,UAAU,CAAC,YAAY,QAAQ,SAAS,YAAY,OAAO,UAAU,SAAA,GACrEH,WAAW,CAAC,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,IAEjD3lC,EAAAA,GAAAA,QAAQ,EACP+hE,UAAU,gBACVslB,WAAW,YACXC,aAAa,YACbC,cAAc,WACdn8D,WAAW,YACXD,aAAa,UACbq8D,iBAAiB,8CACjBrC,kBAAkB,kDAClBsC,qBAAqB,aACrBC,cAAc,YACdC,cAAc,QACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,aACbC,mBAAmB,cACnBC,iBAAiB,YACjBC,YAAY,IAGZ99E,MAAM,QACN+9E,uBAAuB,mBACvB71C,YAAY,YACZC,UAAU,UAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,aAGhB7kF,SAAS,WACTK,OAAO,SACP6/C,MAAM,QACN4kC,OAAO,QACPC,QAAQ,UACRC,OAAO,SAGPC,YAAY,MACZC,gBAAgB,YAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SCpF3B,EAAA;AAAA,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,UAAU,WAAW,QAAQ,UAAU,OAAO,QAAQ,QAAQ,UAAU,YAAY,WAAW,UAAU,SAAA,GACtHD,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,QAC3FD,UAAU,CAAC,eAAe,eAAe,WAAW,SAAS,WAAW,WAAW,SACnFH,GAAAA,WAAW,CAAC,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,IAAA,EAAA,GAEjD3lC,QAAQ,EACP+hE,UAAU,iBACVslB,WAAW,aACXC,aAAa,YACbC,cAAc,UACdn8D,WAAW,YACXD,aAAa,WACbq8D,iBAAiB,IACjBrC,kBAAkB,mDAClBsC,qBAAqB,YACrBC,cAAc,kBACdC,cAAc,OACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,UACbC,mBAAmB,UACnBC,iBAAiB,gBACjBC,YAAY,IAGZ99E,MAAM,SACN+9E,uBAAuB,iBACvB71C,YAAY,aACZC,UAAU,YAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,aAGhB7kF,SAAS,UACTK,OAAO,OACP6/C,MAAM,QACN4kC,OAAO,UACPC,QAAQ,SACRC,OAAO,OAGPC,YAAY,MACZC,gBAAgB,YAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,wCAC9BC,wBAAwB,6BAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SAAA,EAAA;AChF3B,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,UAAU,WAAW,SAAS,SAAS,OAAO,SAAS,SAAS,UAAU,aAAa,WAAW,YAAY,aAC3HD,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAC3FD,GAAAA,UAAU,CAAC,WAAW,cAAc,SAAS,SAAS,WAAW,SAAS,QAAA,GAC1EH,WAAW,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,UAEvD3lC,QAAQ,EACP+hE,UAAU,eACVslB,WAAW,UACXC,aAAa,YACbC,cAAc,eACdn8D,WAAW,SACXD,aAAa,WACbq8D,iBAAiB,IACjBrC,kBAAkB,4CAClBsC,qBAAqB,QACrBC,cAAc,iBACdC,cAAc,QACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,aACbC,mBAAmB,cACnBC,iBAAiB,YACjBC,YAAY,IAGZ99E,MAAM,QACN+9E,uBAAuB,mBACvB71C,YAAY,YACZC,UAAU,UAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,aAGhB7kF,SAAS,WACTK,OAAO,SACP6/C,MAAM,QACN4kC,OAAO,QACPC,QAAQ,UACRC,OAAO,SAGPC,YAAY,MACZC,gBAAgB,YAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SChF3B,EAAA;AAAA,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,UAAU,WAAW,SAAS,SAAS,OAAO,OAAO,OAAO,UAAU,aAAa,WAAW,YAAY,UACvHD,GAAAA,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,QAAQ,OAAO,OAAO,KAAA,GAC5FD,UAAU,CAAC,UAAU,YAAY,UAAU,UAAU,WAAW,UAAU,QAC1EH,GAAAA,WAAW,CAAC,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,IAEjD3lC,EAAAA,GAAAA,QAAQ,EACP+hE,UAAU,cACVslB,WAAW,UACXC,aAAa,QACbC,cAAc,UACdn8D,WAAW,UACXD,aAAa,UACbq8D,iBAAiB,wCACjBrC,kBAAkB,6CAClBsC,qBAAqB,YACrBC,cAAc,kBACdC,cAAc,QACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,aACbC,mBAAmB,cACnBC,iBAAiB,YACjBC,YAAY,IAGZ99E,MAAM,QACN+9E,uBAAuB,mBACvB71C,YAAY,YACZC,UAAU,UAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,aAGhB7kF,SAAS,WACTK,OAAO,SACP6/C,MAAM,QACN4kC,OAAO,QACPC,QAAQ,UACRC,OAAO,SAGPC,YAAY,MACZC,gBAAgB,QAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SC7E3B,EAAA;AAAA,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,WAAW,YAAY,QAAQ,SAAS,OAAO,QAAQ,QAAQ,WAAW,aAAa,WAAW,YAAY,aAC3HD,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAAA,GAC3FD,UAAU,CAAC,UAAU,UAAU,UAAU,UAAU,WAAW,UAAU,QAAA,GACxEH,WAAW,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAAA,EAAA,GAEvD3lC,QAAQ,EACP+hE,UAAU,cACVslB,WAAW,SACXC,aAAa,UACbC,cAAc,WACdn8D,WAAW,SACXD,aAAa,WACbq8D,iBAAiB,IACjBrC,kBAAkB,2DAClBsC,qBAAqB,eACrBC,cAAc,OACdC,cAAc,OACdC,kBAAkB,YAClBC,mBAAmB,aAInBC,YAAY,OACZC,aAAa,gBACbC,mBAAmB,YACnBC,iBAAiB,eACjBC,YAAY,IAIZ99E,MAAM,QACN+9E,uBAAuB,mBACvB71C,YAAY,YACZC,UAAU,WACV61C,WAAW,WACXC,cAAc,WACdC,gBAAgB,aAEhB7kF,SAAS,WACTK,OAAO,UACP6/C,MAAM,SACN4kC,OAAO,UACPC,QAAQ,WACRC,OAAO,MAGPC,YAAY,MACZC,gBAAgB,UAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB,SAAA,EAAA;AChF3B,MAAM7pF,WAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,QAAQ,SAAS,QAAQ,SAAS,SAAS,WAAW,UAAU,WAAW,SAAS,QAAQ,SAAS,QAClHD,GAAAA,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAAA,GAC3FD,UAAU,CAAC,SAAS,aAAa,QAAQ,YAAY,YAAY,QAAQ,WACzEH,GAAAA,WAAW,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAAA,EAAA,GAEvD3lC,QAAQ,EACP+hE,UAAU,cACVslB,WAAW,UACXC,aAAa,SACbC,cAAc,YACdn8D,WAAW,WACXD,aAAa,OACbq8D,iBAAiB,IACjBrC,kBAAkB,kCAClBsC,qBAAqB,YACrBC,cAAc,iBACdC,cAAc,OACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,aACbC,mBAAmB,aACnBC,iBAAiB,QACjBC,YAAY,IAGZ99E,MAAM,YACN+9E,uBAAuB,aACvB71C,YAAY,gBACZC,UAAU,YAEV61C,WAAW,SACXC,cAAc,SACdC,gBAAgB,iBAGhB7kF,SAAS,UACTK,OAAO,QACP6/C,MAAM,OACN4kC,OAAO,SACPC,QAAQ,MACRC,OAAO,OAGPC,YAAY,MACZC,gBAAgB,SAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB;ACnF3B,MAAM7pF,SAAuB,EAC5B9D,MAAM,EACL+pC,YAAY,CAAC,UAAU,SAAS,YAAY,WAAW,WAAW,WAAW,UAAU,WAAW,YAAY,WAAW,YAAY,SAAA,GACrID,aAAa,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAAA,GAC3FD,UAAU,CAAC,UAAU,aAAa,YAAY,UAAU,UAAU,YAAY,QAC9EH,GAAAA,WAAW,CAAC,OAAO,OAAO,OAAO,OAAO,OAAO,OAAO,KAAA,EAAA,GAEvD3lC,QAAQ,EACP+hE,UAAU,iBACVslB,WAAW,YACXC,aAAa,WACbC,cAAc,UACdn8D,WAAW,cACXD,aAAa,YACbq8D,iBAAiB,IACjBrC,kBAAkB,2CAClBsC,qBAAqB,QACrBC,cAAc,oBACdC,cAAc,OACdC,kBAAkB,YAClBC,mBAAmB,aAGnBC,YAAY,OACZC,aAAa,aACbC,mBAAmB,cACnBC,iBAAiB,YACjBC,YAAY,IAGZ99E,MAAM,QACN+9E,uBAAuB,mBACvB71C,YAAY,YACZC,UAAU,UAEV61C,WAAW,QACXC,cAAc,WACdC,gBAAgB,aAGhB7kF,SAAS,WACTK,OAAO,SACP6/C,MAAM,QACN4kC,OAAO,QACPC,QAAQ,UACRC,OAAO,SAGPC,YAAY,MACZC,gBAAgB,WAGhBC,oBAAoB,cACpBnjC,iBAAiB,mBACjB1iD,iBAAiB,mBACjB8lF,MAAM,uBACNC,MAAM,uBACNC,MAAM,yBACNC,MAAM,uBACNC,MAAM,0BACNC,MAAM,wBACNC,KAAK,iBACLC,KAAK,kBAGLC,8BAA8B,kBAC9BC,wBAAwB,cAGxB7kB,uBAAuB,cACvBC,8BAA8B,6BAG9B6kB,+BAA+B,+BAC/BC,sBAAsB,gBACtBC,yBAAyB,UACzBC,6BAA6B,cAG7BC,wBAAwB,OACxBC,yBAAyB;AC5CF,SAAAK,cAAAA;AACxB,SAAO,IAAIJ,cAAc,EAAAK,IACxBA,UAAAC,IACAA,UAAAC,IACAA,UAAAC,IACAA,UAAAC,IACAA,UAAAC,IACAA,UAAAC,IACAA,UAAAC,IACAA,UAAAt/F,IACAA,UAAAu/F,IACAA,UAAAC,IACAA,UAAAC,IACAA,UAAAC,IACAA,UAAAC,IACAA,UAAAC,IACAA,UAAAC,IACAA,UAAAn6F,IACAA,UAAAo6F,IACAA,UAAAC,IACAA,UAAAC,IACAA,UAAAC,IACAA,UAAAC,IACAA,UAAAC,IACAA,UAAAC,IACAA,UAAAC,IACAA,UAAAC,IACAA,UAAAC,IACAA,UAAAC,IACAA,UAAAC,IACAA,UAAAC,IACAA,UAAAC,IACAA,UAAAC,IACAA;AAEF;AC/BA,SAASC;AACRpiG,OAAKmwC,YAAYA;AACjBnwC,OAAKiT,UAAU;AACfjT,OAAKqiG,UAAU;AACfriG,OAAKkV,YAAY;AACjBlV,OAAKmF,MAAM;AACXnF,OAAK+gB,OAAO,EACXuhF,WAAWtiG,KAAKmwC,UAAUC,UAAUM,OACpC6xD,aAAaviG,KAAKmwC,UAAUC,UAAUQ,IAAAA;AAExC;AAEA,SAAA4xD,QAAwBC,qBAEnB;AAAA,MAAA1/F,SAAQ,IAAIq/F;AAEZ,MAAAM,mBAAmB,IAAIC,kBAAiBF,mBAC5C;AAAA,MAAIG,gBAAgB,CAAA;AACd7/F,EAAAA,OAAA8oC,UAAU,SAASvmC,SACxB;AAAA,aAAQxJ,KAAKwJ,SAAO;AACnB,UAAGA,QAAOxJ,CAAAA,KAAAA,CAAO8mG,cAAc9mG,CAAG,GAAA;AAC7B,YAAA+mG,SAASH,iBAAiBzxD,aAAan1C,CAC3C;AAAA,YAAG+mG,QAAO;AACTA,iBAAO9/F,MAAAA;AACP6/F,wBAAc9mG,CAAK,IAAA;AAAA,QACpB;AAAA,MACD;AAAA,IACD;AACO,WAAA8mG;AAAAA,EAAA;AAGR7/F,EAAAA,OAAMc,YAAYqtC,SAClBnuC;AAAAA,EAAAA,OAAMuC,SAASA,OACTvC;AAAAA,EAAAA,OAAAyT,OAAQA,KAAKzT,MACbA;AAAAA,EAAAA,OAAAsP,OAAOA,KAAKtP,MAAAA;AAClBA,EAAAA,OAAM+/F,eAAe1gD;AAEjB,MAAAskB,MAAMxjB,IAAIngD,MAAAA;AACRA,EAAAA,OAAAc,UAAU0tC,WAAW,OAAO,WAAkB;AAAA,WAAAm1B;AAAAA,EAAA,CAAA;AAEhD,MAAAq8B,kBAAkB7tF,UAAUnS,MAC1BA;AAAAA,EAAAA,OAAAc,UAAU0tC,WAAW,kBAAkB,WAAA;AACrC,WAAAwxD;AAAAA,EAAA,CAAA;AAGRr2F,gBAAU3J,MAAAA;AAGN,MAAAigG,eAAe,IAAI95C;AAEV85C,eAAAj/F,iBAAiB,UAAU,WAAA;AACvC,QAAIwe,MAAM,EACTlO,UAAUtR,OAAMq5D,WAChB5uD,UAAUzK,OAAMs5D,WAChB4mC,eAAe,KAIhB;AAAA,QAAGlgG,OAAM+yB,SAAS/yB,OAAM+yB,MAAMC,YAAW;AACxCxT,UAAI0gF,gBAAgBlgG,OAAM+yB,MAAMC,WAAW2F,cAAAA;AAAAA,IAC5C;AACO,WAAAnZ;AAAAA,EAAA;AAERxf,EAAAA,OAAMwK,WAAWy1F,aAAaz1F;AACxBxK,EAAAA,OAAAc,UAAU0tC,WAAW,SAAS,WAAA;AAC5B,WAAAyxD;AAAAA,EAAA,CAAA;AAGFz8C,QAAMxjD,QAAO2B,KAAAA;AAEnB3B,EAAAA,OAAMy3C,UAAUA;AAChBz3C,EAAAA,OAAM00C,MAAMA;AAEZyrD,iBAAengG;AAEfA,EAAAA,OAAMg1E,gBAAgB7S,eAAc8G;AACpCjpE,EAAAA,OAAMgiE,sBAAsBG,eAAcH;AAE1Cl5B,YAAQ9oC;AAER47E,kBAAgB57E,MAAAA;AAChBsQ,QAAMtQ,MAAAA;AACN87E,UAAQ97E,MAAAA;AACRqX,YAAUrX,MACV0P;AAAAA,OAAK1P,MAILs0F;AAAAA,kBAAgBt0F,MAChBu0F;AAAAA,mBAAiBv0F;AAEjBw3F,aAAWx3F,MAAAA;AACXkM,SAAWlM,MAGX;AAAA,MAAIogG,OAAO9C,YACXt9F;AAAAA,EAAAA,OAAMogG,OAAO,EACZjD,WAAWiD,KAAKjD,WAChBkD,WAAW,SAASjtF,SAChB;AAAA,QAAA,OAAOA,YAAW,UAAS;AACzB,UAAAktF,eAAeF,KAAK/C,UAAUjqF,OAClC;AAAA,UAAA,CAAIktF,cAAa;AACDA,uBAAAF,KAAK/C,UAAU,IAAA;AAAA,MAC/B;AAEAr9F,MAAAA,OAAMoT,SAASktF;AAAAA,eACPltF,SAAO;AACZ,UAACpT,CAAAA,OAAMoT,QAAO;AAChBpT,QAAAA,OAAMoT,SAASA;AAAAA,MAAA,OACX;AACJ,iBAAQra,KAAKqa,SAAO;AACnB,cAAGA,QAAOra,aAAaqa,QAAOra,CAAAA,MAAO,UAAS;AAC7C,gBAAA,CAAIiH,OAAMoT,OAAOra,CAAG,GAAA;AACbiH,cAAAA,OAAAoT,OAAOra,CAAAA,IAAK;YACnB;AAEMiH,YAAAA,OAAAyP,MAAMzP,OAAMoT,OAAOra,CAAAA,GAAIqa,QAAOra,CAAAA,GAAI;UAAI,OACxC;AACJiH,YAAAA,OAAMoT,OAAOra,CAAAA,IAAKqa,QAAOra,CAC1B;AAAA,UAAA;AAAA,QACD;AAAA,MACD;AAAA,IACD;AACM,UAAAsa,SAASrT,OAAMoT,OAAOC;AACrBA,WAAAktF,iBAAiBltF,OAAOktF,kBAAkBltF,OAAOqnF;AACjDrnF,WAAAmtF,mBAAmBntF,OAAOmtF,oBAAoBntF,OAAOsnF;AACrDtnF,WAAAotF,mBAAmBptF,OAAOotF,oBAAoBptF,OAAOmrB;AAAAA,EAC7D,GACA6+D,WAAW+C,KAAK/C,UAEXr9F;AAAAA,EAAAA,OAAAogG,KAAKC,UAAU,IAAA;AACd,SAAArgG;AACR;ACzKe,SAAQ8iE,SAAC9iE,QAEvB;AAAA,MAAI0gG,eAAe;AAEnB,MAAIC,eAAe;AAEnB,WAAS57F,SAASxC,SAAQtB,QACzB;AAAA,QAAI2/F,WAAWr+F,QAAOwC;AACtB87F,aAAShuE,KAAKtwB,QAAOpN,GAAAA;AAErBwrG,mBAAep+F,QAAOpN,MAAM;AAC5B,QAAIyrG,SACHA,UAAS3/F;EACV;AAED,WAAS6/F,UAAUxkG,QAAAA;AAClB,QAAIqkG,cAAc;AAEjB,UAAI/oF,OAAOtb,OAAM6oB,SAAS7oB,OAAM4nB;AAChC,UAAI2D,iBAAiB;AAErB,UAAIk5E,WAAWC,UAAU;AACxB,YAAIppF,QAAQ,MAAMA,QAAQ,IAAI;AAG7B,cAAIrb,SAASD,OAAMC,UAAUD,OAAME;AACnC,cAAI+9F,aAAwBh+F,MAAAA,EAAQrC,QAAQ,oBAAyB,IAAA,MAAKqC,OAAO6uB,OAAO;AACvF7uB,mBAAO6uB,MAAAA;AAAAA,UACb,OAAY;AACNrmB,qBAAS47F,cAAc,IAAA;AACvB94E,6BAAiB;AAAA,UACjB;AAAA,QACD;AAED,YAAIjQ,QAAQ,IAAI;AACf7S,mBAAS47F,cAAc,KAAA;AACvB94E,2BAAiB;AAAA,QACjB;AAAA,MACD;AAED,UAAIA,gBAAgB;AACnB,YAAIvrB,OAAMurB,gBAAe;AACxBvrB,UAAAA,OAAMurB,eAAAA;AAAAA,QACN;AACD,eAASvrB,EAAAA,OAAM2kG,eAAe;AAAA,MAC9B;AACD;AAAA,IACA;AAAA,EACD;AACD,MAAIn/F,eAAeC,YAAuB/B,OAAMgC,UAAU3M;AAC1D2K,EAAAA,OAAM1D,MAAMwF,cAAc,WAAWg/F,WAAW,IAEhD;AAAA,WAASI,SAAS1sE,MAAAA;AACjB,QAAK0sE,CAAAA,SAASC,OAAO;AACpBD,eAASC,QAAQ9rG,SAASoE,cAAc,KAAA;AAExCynG,eAASC,MAAMC,YAAYN;AAC3BI,eAASC,MAAMnnG,YAAY;AAC3B3E,eAASD,KAAKuE,YAAYunG,SAASC,KAAAA;AAAAA,IACnC;AAEDD,aAASC,MAAMlqG,MAAMH,UAAU09B,OAAO,iBAAiB;AAAA,EACvD;AAED,WAASv8B,OAAOqgB,MAAMte,WAAWiH;AAChC,QAAIogG,kBAAkBrhG,OAAM08B,SAAS4kE,wBAAwBhpF,IAAAA;AAC7D,QAAIhe,OAAON,UAAU7B,cAAcuC,QAAQ,MAAM;AACjD,QAAI6mG,aAAa,WAAWjnG,OAAO;AACnC,WAAO,UAAU+mG,kBAAkB,gCAAgCE,aAAa,oBAAoBtgG,SAAS,eAAeA,SAAS,aAAaqX,OAAO;AAAA,EACzJ;AAED,WAAS5D,KAAK4D;AACb,QAAKyoF,CAAAA,WAAWtpG,MAAM;AACrBspG,iBAAWtpG,OAAOpC,SAASoE,cAAc,KACzCsnG;AAAAA,iBAAWtpG,KAAKuC,YAAY;AAC5B+mG,iBAAWtpG,KAAKR,MAAM8pG,WAAWngG,QAAY,IAAA;AAC7CvL,eAASD,KAAKuE,YAAYonG,WAAWtpG,IAAAA;AAAAA,IACrC;AAEDspG,eAAWluE,KAAKva,KAAKpU,EAAAA;AACrB,QAAIs6E,UAAUnpF,SAASoE,cAAc,KACrC+kF;AAAAA,YAAQljF,YAAY,UAAUgd,KAAKA,OAAO;AAC1CkmE,YAAQxkF,YAAY,sBAAsBse,KAAKpJ;AAC/CsvE,YAAQgjB,UAAU,WACjBT;AAAAA,iBAAWluE,KAAKva,KAAKpU,EACrBoU;AAAAA,aAAO;AAAA,IACV;AAEEtY,IAAAA,OAAM08B,SAAS+kE,gBAAgBjjB,OAAAA;AAE/B,QAAIuiB,WAAWngG,YAAY,YAAYmgG,WAAWtpG,KAAK+D,WACtDulG,YAAWtpG,KAAKiqG,aAAaljB,SAASuiB,WAAWtpG,KAAK+D;QAEtDulG,YAAWtpG,KAAKkC,YAAY6kF,OAAAA;AAE7B,QAAIlmE,KAAKi/E,SAAS,EACjBwJ,YAAWY,OAAOrpF,KAAKpU,EAAAA,IAAMxO,OAAOmS,WAAW,WAAA;AAE9C,UAAIk5F,WAAYA,YAAWluE,KAAKva,KAAKpU,EACzC;AAAA,IAAA,GAAMoU,KAAKi/E,MAAAA;AAETwJ,eAAWv3C,KAAKlxC,KAAKpU,EAAMs6E,IAAAA;AAC3BA,cAAU;AAEV,WAAOlmE,KAAKpU;AAAAA,EACZ;AAED,WAAS09F;AACR,QAAIlM,SAAS,GAAG78F,MAAMqE,MAAM2G,WAAW,CAAC,CAExC,CAAA;AAAA,aAAS9K,IAAI,GAAGA,IAAI28F,OAAO18F,QAAQD,KAAK;AACvC,UAAI28F,OAAO38F,CAAI,GAAA;AACd,eAAO28F,OAAO38F;MACd;AAAA,IACD;AAAA,EAED;AAED,WAAS8oG,cAAct/F,SAAQu/F,IAAIC,QAAAA;AAClC,QAAI5sG,MAAME,SAASoE,cAAc;AAEjC,QAAIuoG,YAAYr7C,IAChB3mD;AAAAA,IAAAA,OAAM08B,SAASulE,iBAAiB9sG,KAAK6sG,SAGrC7sG;AAAAA,QAAI6E,YAAY,4BAA4BuI,QAAO2M;AACnD/Z,QAAI80B,aAAay2E,cAAc;AAE/B,QAAIwB,QAAQ;AAEZ,QAAI3/F,QAAO7L,MACVvB,KAAI8B,MAAMP,QAAQ6L,QAAO7L;AAC1B,QAAI6L,QAAO5L,OACVxB,KAAI8B,MAAMN,SAAS4L,QAAO5L;AAC3B,QAAI4L,QAAOyO,MACVkxF,UAAS,oCAAoC3/F,QAAOyO,QAAQ;AAC7DkxF,aAAS,uCAAuCF,YAAY,cAAcz/F,QAAO05B,UAAU,KAAK15B,QAAO+V,QAAQ;AAC/G,QAAIwpF,GACHI,UAASjqG,OAAO2pG,gBAAgBr/F,QAAOu/F,IAAI9hG,OAAMoT,OAAOC,OAAO0oF,YAAY,IAAA,GAAO,MAAM,IACzF;AAAA,QAAIgG,OACHG,UAASjqG,OAAO2pG,gBAAgBr/F,QAAOw/F,QAAQ/hG,OAAMoT,OAAOC,OAAO2oF,gBAAgB,WAAW,UAAU,KAAA;AAEzG,QAAIz5F,QAAOksB,SAAS;AACnB,eAAS11B,IAAI,GAAGA,IAAIwJ,QAAOksB,QAAQz1B,QAAQD,KAAK;AAC/C,YAAIopG,MAAM5/F,QAAOksB,QAAQ11B,CACzB;AAAA,YAAA,OAAWopG,OAAO,UAAU;AAE3B,cAAIhvF,QAAQgvF,IAAIhvF;AAChB,cAAIxX,MAAMwmG,IAAIxmG,OAAQ,WAAWwmG,IAAIhvF,MAAMhb,YAAgB,IAAA;AAC3D,cAAI6d,QAAQmsF,IAAInsF,SAASjd;AACzBmpG,mBAASjqG,OAAOkb,OAAOxX,KAAKqa,KACjC;AAAA,QAAA,OAAW;AACNksF,mBAASjqG,OAAOkqG,KAAKA,KAAKppG,CAC1B;AAAA,QAAA;AAAA,MACD;AAAA,IACD;AAEDmpG,aAAS;AACT/sG,QAAImG,YAAY4mG;AAEhB,QAAI3/F,QAAO05B,SAAS;AACnB,UAAIplC,OAAO0L,QAAO05B;AAClB,UAAA,OAAWplC,QAAQ,SAClBA,QAAOxB,SAAS4F,eAAepE,IAChC;AAAA,UAAIA,KAAKI,MAAMH,WAAW,OACzBD,MAAKI,MAAMH,UAAU;AACtB3B,UAAI0G,WAAW0G,QAAOyO,QAAQ,IAAI,CAAA,EAAGrX,YAAY9C,IACjD;AAAA,IAAA;AAED1B,QAAIqsG,UAAU,SAAUllG;AACvB,UAAIqhB,SAASrhB,OAAMC,UAAUD,OAAME;AACnC,WAAKmhB,OAAO3jB,UAAW2jB,UAASA,OAAOnoB;AACvC,UAAI08B,QAAmBvU,QAAQ,qBAAwB,GAAA;AACtD,YAAI1c,SAAS0c,OAAOtmB,aAAa,aAAA;AACjC4J,iBAAUA,UAAU,WAAYA,UAAU,UAAU,QAAQA;AAC5D8D,iBAASxC,SAAQtB,MAAAA;AAAAA,MACjB;AAAA,IACJ;AACEsB,IAAAA,QAAOpN,MAAMA;AACb,QAAI2sG,MAAMC,OACTpB,gBAAep+F;AAEhB,WAAOpN;AAAAA,EACP;AAED,WAASitG,WAAW7/F,SAAQu/F,IAAIC;AAC/B,QAAI5sG,MAAMoN,QAAOlG,UAAUkG,UAASs/F,cAAct/F,SAAQu/F,IAAIC,MAAAA;AAE9D,SAAKx/F,QAAO8/F,OACXnB,UAAS,IACV7rG;AAAAA,aAASD,KAAKuE,YAAYxE,GAAAA;AAC1B,QAAIsB,IAAIF,KAAKkM,IAAIlM,KAAKkS,QAAQ/S,OAAO4sG,cAAcjtG,SAASE,gBAAgBS,eAAeb,IAAIa,eAAe,CAC9G,CAAA;AAAA,QAAIM,IAAIC,KAAKkM,IAAIlM,KAAKkS,QAAQ/S,OAAO6sG,eAAeltG,SAASE,gBAAgBU,gBAAgBd,IAAIc,gBAAgB,CACjH,CAAA;AAAA,QAAIsM,QAAO3B,YAAY,MACtBzL,KAAI8B,MAAMnC,MAAM;AAAA,QAEhBK,KAAI8B,MAAMnC,MAAMwB,IAAI;AACrBnB,QAAI8B,MAAMlC,OAAO0B,IAAI;AAErBtB,QAAIisG,YAAYN;AAEhBD,aAASn4E,MAAMvzB;AAEf,QAAIoN,QAAO8/F,OACVxB,UAAShuE,KAAK19B,GAAAA;AAEf6K,IAAAA,OAAMgF,UAAU,kBAAkB,CAAC7P,GACnC,CAAA;AAAA,WAAOA;AAAAA,EACP;AAED,WAASqtG,WAAWjgG,SAAAA;AACnB,WAAO6/F,WAAW7/F,SAAQ,MAAM,KAAA;AAAA,EAChC;AAED,WAASkgG,aAAalgG,SAAAA;AACrB,WAAO6/F,WAAW7/F,SAAQ,MAAM,IAAA;AAAA,EAChC;AAED,WAASmgG,SAASngG,SACjB;AAAA,WAAO6/F,WAAW7/F,OAClB;AAAA,EAAA;AAED,WAASogG,WAAWrqF,MAAMpJ,MAAMnK,WAAAA;AAC/B,QAAWuT,OAAAA,QAAQ,UAAU;AAC5B,UAAA,OAAWpJ,QAAQ,YAAY;AAC9BnK,QAAAA,YAAWmK;AACXA,eAAO;AAAA,MACP;AACDoJ,aAAO,EAACA,MAAYpJ,MAAYnK,UAAUA,UAAAA;AAAAA,IAC1C;AACD,WAAOuT;AAAAA,EACP;AAED,WAASsqF,OAAOtqF,MAAMpJ,MAAMqoF,QAAQrzF,IAAAA;AACnC,QAAWoU,OAAAA,QAAQ,SAClBA,QAAO,EAACA,MAAYpJ,MAAYqoF,QAAgBrzF,GACjDoU;AAAAA,SAAKpU,KAAKoU,KAAKpU,MAAMyiD;AACrBruC,SAAKi/E,SAASj/E,KAAKi/E,UAAUwJ,WAAWxJ;AACxC,WAAOj/E;AAAAA,EACP;AAED,MAAIuqF,WAAW,WAAA;AACd,QAAIvqF,OAAOqqF,WAAWzlG,MAAMD,MAAM4G,SAClCyU;AAAAA,SAAKpJ,OAAOoJ,KAAKpJ,QAAQ;AACzB,WAAOszF,WAAWlqF;EACpB;AACC,MAAIwqF,aAAa,WAAA;AAChB,QAAIxqF,OAAOqqF,WAAWzlG,MAAMD,MAAM4G,SAClCyU;AAAAA,SAAKpJ,OAAOoJ,KAAKpJ,QAAQ;AACzB,WAAOuzF,aAAanqF,IAAAA;AAAAA,EACtB;AACC,MAAIuoF,WAAW,WACd;AAAA,QAAIvoF,OAAOqqF,WAAWzlG,MAAMD,MAAM4G,SAClCyU;AAAAA,SAAKpJ,OAAOoJ,KAAKpJ,QAAQ;AACzB,WAAOwzF,SAASpqF,IAAAA;AAAAA,EAClB;AACCuoF,WAAShuE,OAAO,SAAUh8B,MACzB;AAAA,WAAOA,QAAQA,KAAKQ,gBAAiBR,CAAAA,KAAKQ,aAAaqpG,YACtD7pG,EAAAA,QAAOA,KAAKrB;AACb,QAAIqB,MAAM;AACTA,WAAKrB,WAAWqE,YAAYhD,IAC5BqqG;AAAAA,eAAS;AAETlhG,MAAAA,OAAMgF,UAAU,uBAAuB,CAACnO,IACxC,CAAA;AAAA,IAAA;AAAA,EACH;AAECgqG,WAASn4E,QAAQ,SAAU7xB,MAAAA;AAC1BgR,eAAW,WAAA;AACV,UAAIwgB,YAAYF,kBAA6BtxB;AAC7C,UAAIwxB,UAAUrvB,QAAQ;AACrB,YAAIqvB,UAAU,CAAA,EAAGK,MAAOL,WAAU,GAAGK,MACrC;AAAA,MAAA;AAAA,IACD,GAAE,CAAA;AAAA,EACL;AAEC,MAAIq4E,aAAa,SAAUzoF,MAAMpJ,MAAMqoF,QAAQrzF,IAC9CoU;AAAAA,WAAOsqF,OAAO1lG,MAAMD,MAAM4G;AAC1ByU,SAAKpJ,OAAOoJ,KAAKpJ,QAAQ;AAEzB,QAAI6zF,UAAUzqF,KAAKpJ,KAAK3U,MAAM,GAAK,EAAA,CAAA;AACnC,YAAQwoG,SAAAA;AAAAA,MACP,KAAK;AACJ,eAAOP,WAAWlqF,IAAAA;AAAAA,MACnB,KAAK;AACJ,eAAOmqF,aAAanqF;MACrB,KAAK;AACJ,eAAOoqF,SAASpqF,IAAAA;AAAAA,MACjB;AACC,eAAO5D,KAAK4D,IAEhB;AAAA,IAAA;AAAA,EAAA;AAECyoF,aAAWvgE,QAAO,oBAAK7qB,QAAQjL,QAAAA;AAC/Bq2F,aAAWrrE,MAAMixB;AACjBo6C,aAAWxJ,SAAS;AACpBwJ,aAAWC,WAAW;AACtBD,aAAWngG,WAAW;AACtBmgG,aAAWv3C,OAAO;AAClBu3C,aAAWY,SAAS;AAEpBZ,aAAWiC,UAAU,WAAA;AACpB,aAAS1sF,OAAOyqF,WAAWv3C,KAC1Bu3C,YAAWluE,KAAKvc;EACnB;AACCyqF,aAAWluE,OAAO,SAAU3uB,IAC3B;AAAA,QAAIlI,MAAM+kG,WAAWv3C,KAAKtlD;AAC1B,QAAIlI,OAAOA,IAAIxG,YAAY;AAC1BE,aAAOmS,WAAW,WACjB7L;AAAAA,YAAIxG,WAAWqE,YAAYmC,GAAAA;AAC3BA,cAAM;AAAA,MACN,GAAE;AACHA,UAAIhC,aAAa;AAEjB,UAAI+mG,WAAWY,OAAOz9F,IACrBxO,QAAOoS,aAAai5F,WAAWY,OAAOz9F,EAAAA,CAAAA;AAAAA,aAChC68F,WAAWv3C,KAAKtlD,EAAAA;AAAAA,IACvB;AAAA,EACH;AAEC,MAAI++F,SAAS;AACbjjG,EAAAA,OAAMyE,YAAY,kBAAkB,SAAStP,KAC5C8tG;AAAAA,WAAOhnG,KAAK9G,GACd;AAAA,EAAA,CAAA;AACC6K,EAAAA,OAAMyE,YAAY,uBAAuB,SAAStP;AACjD,aAAQ4D,IAAI,GAAGA,IAAIkqG,OAAOjqG,QAAQD,KAAI;AACrC,UAAGkqG,OAAOlqG,CAAAA,MAAO5D,KAAI;AACpB8tG,eAAO3pG,OAAOP,GAAG,CAAA;AACjBA;AAAAA,MACA;AAAA,IACD;AAAA,EACH,CAECiH;AAAAA,EAAAA,OAAMyE,YAAY,aAAa;AAC9B,QAAGy8F,SAASC,SAASD,SAASC,MAAM3rG,YAAW;AAC9C0rG,eAASC,MAAM3rG,WAAWqE,YAAYqnG,SAASC;IAC/C;AAED,aAAQpoG,IAAI,GAAGA,IAAIkqG,OAAOjqG,QAAQD,KAAI;AACrC,UAAGkqG,OAAOlqG,CAAAA,EAAGvD,YAAW;AACvBytG,eAAOlqG,GAAGvD,WAAWqE,YAAYopG,OAAOlqG,CACxC,CAAA;AAAA,MAAA;AAAA,IACD;AACDkqG,aAAS;AAET,QAAGlC,WAAWtpG,QAAQspG,WAAWtpG,KAAKjC,YAAW;AAChDurG,iBAAWtpG,KAAKjC,WAAWqE,YAAYknG,WAAWtpG,IAAAA;AAAAA,IAClD;AACDspG,iBAAa;AAAA,EACf,CAEC;AAAA,SAAO,EACNmC,OAAOL,UACPM,SAASL,YACTtkB,SAASuiB,YACTqC,UAAUvC,SAEZ;AAAA;ACtWA,SAASwC,eAAgBtvF,OAAOuvF,gBAC/B;AAAA,MAAIC,MAAMtmG,KAAKyQ,QAAQqG,KAEvB;AAAA,MAAGwvF,KAAI;AACN,QAAIA,CAAAA,IAAIC,iBAAgB;AACvBD,UAAIC,kBAAkB;AACtBzlF,aAAO0lF,eAAeF,KAAKD,cAAAA;AAAAA,IAC3B;AACD,WAAOC;AAAAA,EACT,OAAM;AACJ,WAAOD;AAAAA,EACP;AACF;AAEA,IAAII,eAAe,SAASC,YAAAA;AAC3B,MAAIC,cACHC;AAED,SAAO,EACNC,YAAY,WAAA;AACX,SAAIF,cAAa;AAChBA,qBAAeD,aAAaA,WAAWG,WAAe7mG,IAAAA,KAAKsgE,OAAOh7D;AAAAA,IAClE;AACD,QAAItF,CAAAA,KAAKyQ,QAAQnL,QAAO;AACvB,aAAOqhG;AAAAA,IACX,OAAQ;AACJ,aAAOP,eAAevqG,KAAKmE,MAAM,UAAU2mG,YAC3C;AAAA,IAAA;AAAA,EACD,GACDG,eAAe,WAAA;AACd,SAAIF,iBAAgB;AACnBA,wBAAkBF,aAAaA,WAAWI,cAAAA,IAAkB9mG,KAAKsgE,OAAOprD;AAAAA,IACxE;AACD,QAAA,CAAIlV,KAAKyQ,QAAQyE,WAAU;AAC1B,aAAO0xF;AAAAA,IACX,OAAQ;AACJ,aAAOR,eAAevqG,KAAKmE,MAAM,aAAa4mG,eAC9C;AAAA,IAAA;AAAA,EACD;AAEH;AAEe,SAAAG,eAAShoG,KAAK+B,QAC5BylD;AAAAA,QAAYxnD,KAAK0nG,aAAa3lG,MAAAA,CAAAA;AAC/B;AC3CA,IAAIkmG,YAAY,SAASC,cAAclkG,QACtC;AAAA,MAAImkG,QAAQ,CAAA;AAEZ,WAASC,IAAGxqE,MAAM+pE,YAAAA;AACjB,QAAI1nE;AACJ,QAAItzB,OAAO;AACX,QAAIixB,KAAKjxB,MAAK;AACbA,aAAO;AAAA,IACV,WAAYixB,KAAKgV,SAAS;AACvBjmC,aAAO;AAAA,IACP,WACQixB,KAAK+U,QAAQ/U,KAAK3c,MAAM;AAChCtU,aAAO;AAAA,IACP,WACQixB,KAAKuqE,OAAO;AACpBx7F,aAAO;AAAA,IACP;AAEDszB,cAAUg8D,WAAWn/F,KAAKmE,MAAM0L,MAAM,MAAMixB,MAAM+pE,UAAAA;AAClD,WAAO1nE;AAAAA,EACP;AAED,MAAIooE,eAAe,CAAA;AAEnB,WAASpM,WAAW39F,MAAMyD,QAAQwE,SAAQohG,YAAAA;AACzC,QAAIW,UAAUH,MAAM7pG,IAEpB;AAAA,QAAA,CAAIgqG,WAAYA,CAAAA,QAAQ31F,OACvB,QAAO;AAER,QAAGrU,QAAQ,aAAciI,CAAAA,QAAOiyB,MAAK;AACpC,UAAGmvE,WAAWj2F,QAAQuP,MAAK;AAC1B1a,QAAAA,QAAOiyB,OAAO;AAAA,MAClB,OAAQ;AACJjyB,QAAAA,QAAOiyB,OAAO;AAAA,MACd;AAAA,IACD;AAED,QAAGl6B,QAAQ,cAAciI,QAAOoG,QAAQ,eAAA,CAAgBpG,QAAOiO,QAAO;AACrE,UAAGmzF,WAAWj2F,QAAQuP,MAAK;AAC1B1a,QAAAA,QAAOiO,SAAS;AAAA,MACpB,OAAQ;AACJjO,QAAAA,QAAOiO,SAAS;AAAA,MAChB;AAAA,IACD;AAED,QAAIjO,UAAS8nD,KAAW9nD,OAAAA;AAExB,QAAIA,CAAAA,QAAO2B,OAAOmgG,aAAa9hG,QAAOoG,OAAM;AAC3CpG,MAAAA,QAAO2B,KAAK3B,QAAOoG;AAAAA,IACnB;AAED,QAAGpG,QAAO2B,MAAAA,CAAO3B,QAAO5G,KAAI;AAC3B4G,MAAAA,QAAO5G,MAAM4G,QAAO2B,KAAG;AAAA,IACvB;AAED,QAAIyE,OAAO,IAAI27F,QAAQ31F,OAAO5Q,QAAQwE,SAAQtF,MAAM+C,MAAAA;AAEpD,QAAGskG,QAAQC,WAAU;AACpBD,cAAQC,UAAU57F,IAAAA;AAAAA,IAClB;AAED+6F,mBAAa/6F,MAAMg7F,UACnB;AAAA,QAAA,CAAIh7F,KAAK0F,KAAI;AACZ1F,WAAK0F,MAAM9L,QAAO2B,MAAMlE,OAAM01B,IAC9B;AAAA,IAAA;AAED,SAAI/sB,KAAK67F,WAAAA,OAAkBzmG,UAAU,UAAS;AAC7C4K,WAAK67F,UAAUzmG;AAAAA,IACf;AACD,QAAA,CAAI4K,KAAK+E,SAAQ;AAChB/E,WAAK+E,UAAUnL;AAAAA,IACf;AAED,QAAG8hG,aAAa17F,KAAK0F,GAAAA,GAAK;AACzB1F,WAAK0F,MAAMrO,OAAM01B;IACjB;AAED2uE,iBAAa17F,KAAK0F,GAAAA,IAAO1F;AAEzB,WAAOA;AAAAA,EACP;AAED,WAAS0vB,QACRgsE;AAAAA,mBAAe,CAAA;AAAA,EACf;AAED,WAASj2D,SAAS9zC,MAAMmqG,iBAAiBF,WAAAA;AACxCJ,UAAM7pG,IAAQ,IAAA,EAACqU,QAAQ81F,iBAAiBF,UAAWA;AAAAA,EACnD;AAED,WAASl4F,QAAQnI;AAChB,WAAOmgG,aAAangG;EACpB;AAED,MAAIu7F,WAAU,EACbiF,QAAON,KACP/rE,OACAssE,cAAcv2D,UACd6pD,YACA5rF,QAGD;AAAA,SAAOozF;AACR;AAEA,MAAemF,cAAA,EACdV,eAAeD,UAAAA;AC5GhB,IAAIY,qBAAqB,yBAAU1sB,aAAAA;AAClC,SAAO,SAAUn4E,QAAAA;AAChB,QAAI8kG,gBAAgB,EACnB15E,OAAS,CAAE,GACX25E,aAAe,CAAE,GACjBC,aAAe,CAAE,EAGlB;AAAA,aAASC,eAAe3oG,QAAOtC,WAAW+J,SAASzL;AAClD,UAAIwsG,CAAAA,cAAcxoG,MAAOtC,EAAAA,SAAAA,GAAW;AACnC8qG,sBAAcxoG,QAAOtC,SAAa,IAAA,CAAA;AAAA,MAClC;AAED8qG,oBAAcxoG,MAAOtC,EAAAA,SAAAA,EAAWiC,KAAK,EACpC8H,SACAzL,KAAMA,CAAAA;AAAAA,IAEP;AAED,aAAS4sG,YAAYxgG,WAAW1K,WAAW1B,MAAMsP,MAAAA;AAChD,UAAIpE,WAAWshG,cAAcpgG,SAAW1K,EAAAA,SAAAA;AACxC,UAAGwJ,UAAS;AACX,iBAAQzK,IAAI,GAAGA,IAAIyK,SAASxK,QAAQD,KAAI;AACvC,gBAAKT,QAAQkL,SAASzK,GAAGT,SAASkL,SAASzK,CAAGT,EAAAA,SAASA,MAAK;AAC3DkL,qBAASzK,CAAGgL,EAAAA,QAAQ7G,MAAMD,MAAM2K,IAAAA;AAAAA,UAChC;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAED,aAASu9F,QAAQhpG,GAAAA;AAChBA,UAAIA,KAAKzG,OAAO4G;AAChB,UAAI4H,KAAKlE,OAAMisB,OAAO9vB,CAAAA;AAEtB,UAAIqH,WAAW4hG,kBAAkBjpG,GAAG2oG,cAAc15E,KAClD;AAAA,UAAI5L,MAAM;AACV,UAAItb,OAAO,MAAM;AAChBsb,cAAAA,CAAOxf,OAAMoF,WAAW,aAAkBpF,KAAAA,OAAMgF,UAAU,eAAe,CAACd,IAAI/H,CAClF,CAAA;AAAA,MAAA,OAAU;AACN6D,QAAAA,OAAMgF,UAAU,gBAAgB,CAAC7I,CACjC,CAAA;AAAA,MAAA;AAED,UAAIqjB,KAAK;AACR,YAAI6lF,iBAAiBC,kBAAkB9hG,UAAUrH,GAAG+H,EACpD;AAAA,YAAA,CAAKmhG,eACJ;AAID,gBAAOlpG,EAAEI,OAAO7E,UACf;AAAA,UAAA,KAAK;AAAA,UACL,KAAK;AACJ;AAAA;AAIF,YAAIwM,MAAMlE,OAAMmc,QAAQjY,EAAQlE,KAAAA,CAAAA,OAAMw3B,gBAAgBx3B,OAAMuC,OAAO61B,aAAa;AAC/Ep4B,UAAAA,OAAMsuB,WAAWpqB;QACjB;AAAA,MACD;AAAA,IACD;AAED,aAASqhG,cAAcppG,GAAAA;AACtBA,UAAIA,KAAKzG,OAAO4G;AAChB,UAAIkpG,MAAMrpG,EAAEI,UAAUJ,EAAEK,YACvB+uB,SAASvrB,OAAMisB,OAAOu5E,MACtB57D,SAAS5pC,OAAMisB,OAAOu5E,KAAKxlG,OAAMuC,OAAOmvC,cAEzC;AAAA,UAAIlyB,MAAOxf,CAAAA,OAAMoF,WAAW,eAAA,KAAoBpF,OAAMgF,UAAU,iBAAiB,CAACumB,QAAQqe,QAAQztC;AAClG,UAAKqjB,CAAAA,KAAK;AACT,YAAIrjB,EAAE0rB,eACL1rB,GAAE0rB,eAEF1rB;AAAAA,YAAAA,GAAE2rB,cAAc;AAAA,MACjB;AACD,aAAOtI;AAAAA,IACP;AAED,aAAS4lF,kBAAkBjpG,GAAGsrB,MAC7B;AAAA,UAAIrrB,MAAMD,EAAEI,UAAUJ,EAAEK;AACxB,UAAIgH,WAAW,CACf;AAAA,aAAOpH,KAAK;AACX,YAAIT,MAAMw8E,YAAWp+E,aAAaqC,GAAAA;AAClC,YAAIT,KAAK;AACRA,gBAAMA,IAAIpB,MAAM,GAAA;AAChB,mBAASxB,IAAI,GAAGA,IAAI4C,IAAI3C,QAAQD,KAAK;AACpC,gBAAA,CAAK4C,IAAI5C,CAAI,EAAA;AACb,gBAAI0uB,KAAK9rB,IAAI5C,CAAAA,CAAAA,GAAK;AACjB,kBAAI0sG,mBAAmBh+E,KAAK9rB,IAAI5C,CAEhC,CAAA;AAAA,uBAAQ2sG,IAAI,GAAGA,IAAID,iBAAiBzsG,QAAQ0sG,KAAI;AAC/C,oBAAGD,iBAAiBC,GAAGptG,MAAK;AAC3B,uBAAI6/E,YAAWj6E,UAAU9B,KAAKqpG,iBAAiBC,CAAGptG,EAAAA,IAAAA,GAAM;AACvD;AAAA,kBACA;AAAA,gBACD;AACDkL,yBAASvH,KAAKwpG,iBAAiBC,CAAG3hG,EAAAA,OAAAA;AAAAA,cAClC;AAAA,YACD;AAAA,UACD;AAAA,QACD;AACD3H,cAAMA,IAAI5G;AAAAA,MACV;AACD,aAAOgO;AAAAA,IACP;AAED,aAAS8hG,kBAAkB9hG,UAAUrH,GAAG+H,IACvC;AAAA,UAAIsb,MAAM;AAEV,eAAQzmB,IAAI,GAAGA,IAAIyK,SAASxK,QAAQD,KAAI;AACvC,YAAI6K,gBAAiBJ,SAASzK,GAAGD,KAAKkH,QAAO7D,GAAG+H,IAAI/H,EAAEI,UAAUJ,EAAEK,UAAAA;AAClEgjB,cAAMA,OAAAA,EAAAA,OAAgB5b,iBAAiB,eAAeA,kBAAkB;AAAA,MACxE;AAED,aAAO4b;AAAAA,IACP;AAGD,aAASmmF,cAAcxpG,GAAAA;AACtBA,UAAIA,KAAKzG,OAAO4G;AAChB,UAAI4H,KAAKlE,OAAMisB,OAAO9vB,CAEtB;AAAA,UAAIqH,WAAW4hG,kBAAkBjpG,GAAG2oG,cAAcC,WAAAA;AAElD,UAAIvlF,MAAAA,CAAOxf,OAAMoF,WAAW,gBAAA,KAAqBlB,OAAO,QAAQlE,OAAMgF,UAAU,kBAAkB,CAACd,IAAI/H,CACvG,CAAA;AAAA,UAAIqjB,KAAK;AACR,YAAI6lF,iBAAiBC,kBAAkB9hG,UAAUrH,GAAG+H,EAAAA;AACpD,aAAKmhG,eACJ;AAED,YAAInhG,OAAO,QAAQlE,OAAMmc,QAAQjY,EAAK,GAAA;AACrC,cAAIsb,OAAOxf,OAAMuC,OAAOmwC,uBAAwB1yC,CAAAA,OAAMqrB,WAAWnnB,EAAAA,GAAK;AACrElE,YAAAA,OAAM0uB,aAAaxqB,EACnB;AAAA,UAAA;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAED,aAAS0hG,YAAYzpG,GAAAA;AACpB,UAAI6D,OAAMoF,WAAW,aAAA,GAAgB;AACpC,YAAIlB,KAAKlE,OAAMisB,OAAO9vB,CACtB6D;AAAAA,QAAAA,OAAM6lG,mBAAmB1pG;AACzB6D,QAAAA,OAAMgF,UAAU,eAAe,CAACd,IAAI/H;MACpC;AAAA,IACD;AAED,aAASyG,OAAO8B,WAAW1K,WAAW+J,SAASzL,MAAAA;AAC9C,UAAIwsG,cAAcpgG,SAAcogG,KAAAA,cAAcpgG,WAAW1K,SAAY,GAAA;AACpE,YAAIwJ,WAAWshG,cAAcpgG,SAAAA;AAC7B,YAAIohG,kBAAkBtiG,SAASxJ,SAC/B;AAAA,iBAAQjB,IAAI,GAAGA,IAAI+sG,gBAAgB9sG,QAAQD,KAAI;AAC9C,cAAG+sG,gBAAgB/sG,CAAAA,EAAGT,QAAQA,MAAK;AAClCwtG,4BAAgBxsG,OAAOP,GAAG,CAAA;AAC1BA;AAAAA,UACA;AAAA,QACD;AACD,YAAA,CAAI+sG,gBAAgB9sG,QAAO;AAAA,iBACnBwK,SAASxJ,SAAAA;AAAAA,QAChB;AAAA,MAED;AAAA,IACD;AAED,QAAI+rG,YAAY/lG,OAAMI,qBAEtB;AAAA,aAASi4B,MAAMxhC,MAEdkvG;AAAAA,gBAAUljG,UAEV;AAAA,UAAGhM,MAAK;AACPkvG,kBAAUtkG,OAAO5K,MAAM,SAASsuG,OAChCY;AAAAA,kBAAUtkG,OAAO5K,MAAM,YAAY8uG,aACnCI;AAAAA,kBAAUtkG,OAAO5K,MAAM,aAAa+uG,WACpCG;AAAAA,kBAAUtkG,OAAO5K,MAAM,eAAe0uG;MACtC;AAAA,IACD;AAID,WAAO,EACNltE,OACAz4B,QAAQ,SAAStD,QAAOc,WAAW2G,SAAAA;AAClCkhG,qBAAe3oG,QAAOc,WAAW2G,SAAS,IAAA;AAAA,IAC1C,GACDiiG,UAAUf,gBACVriG,QACAsiG,aACAS,eACAC,aACAL,eACAJ,SACAj5F,YAAY,WAAA;AACXmsB;AACAysE,sBAAgB;AAChBiB,kBAAY;AAAA,IACZ,EAGJ;AAAA,EAAA;AAEC,EAAE5tB,UAAAA;AAGH,MAAe8tB,cAAA,EACd1rD,MAAKsqD;AC9MS,SAAAqB,uBAASvkE,UAAUxsC,KAAK6K,QAAAA;AACtC,OAAI7K,KAAI;AACP,WAAO;AAAA,EACP;AAED,MAAGA,IAAIJ,OAAO4sC,SAASwkE,SAAShxG,IAAIJ,OAAOI,IAAIuB,QAAQirC,SAASlrC,GAAE;AACjE,WAAO;AAAA,EACP;AAED,MAAGtB,IAAIL,MAAM6sC,SAASykE,SAASjxG,IAAIL,MAAMK,IAAIwB,SAASgrC,SAASrrC,GAAE;AAChE,WAAO;AAAA,EACP;AAED,SAAO;AACR;ACde,SAAQ+vG,eAACrmG,QACvB;AAAA,SAAOA,OAAMuC,OAAOmO,mBAAmB1Q,OAAMozB;AAC9C;ACFe,SAAAkzE,gBAASz/F,MAAM8B,MAAMpG;AACnC,SAAO,EACNzN,KAAK6T,KAAK8C,WAAW5E,KAAK3C,KAC1BvN,QAAQgS,KAAK4C,cAAc1E,KAAK3C,EAChCnP,GAAAA,MAAM,GACNC,OAAOunB,SAAAA;AAET;ACPe,SAASgqF,qBAAqBvmG,QAAO2I,MAAMpG,SAAQ8lC,WAAW1G;AAC5E,MAAI6kE,SAAS;AACb,MAAI19F,QAAQH,KAAK2C,0BAA0Bq2B,SAASrrC,CAAAA,KAAM;AAC1D,MAAIyS,MAAMJ,KAAK2C,0BAA0Bq2B,SAASykE,KAAAA,KAAU/9D,UAAU0e,MACtE;AAAA,MAAI0/C,aAAalwG,KAAKuD,IAAI,GAAGgP,QAAQ09F,MACrC;AAAA,MAAIE,WAAYnwG,KAAKyS,IAAIq/B,UAAU0e,MAASh+C,GAAAA,MAAMy9F,MAElD;AAAA,QAAMG,gBAAe,CAAA;AACrB,MAAI3mG,OAAMuC,OAAO0uB,uBAAuBjxB,OAAM24B,cAAiB,GAAA;AAC9D,QAAIvtB,OAAOpL,OAAMmc,QAAQnc,OAAM24B,cAE/B,CAAA;AAAA,QAAGvtB,KAAKkiD,kBAAkB;AACzBq5C,oBAAc1qG,KAAK+D,OAAM24B;IACzB;AAAA,EACD;AACD,MAAI34B,OAAMoM,IAAIC,QAAQ,WAAWrM,OAAMoC,IAAIu3B,iBAAiB35B,OAAMoC,IAAIu3B,cAAcnvB,SAAWtG,EAAAA,IAAI;AAClG,QAAI0iG,iBAAiB5mG,OAAMoC,IAAIu3B,cAAcnvB,SAAAA,EAAWtG;AACxD,QAAImkC,UAAUrR,OAAO4vE,cAAgB,GAAA;AACpCD,oBAAc1qG,KAAK2qG,cACnB;AAAA,IAAA;AAAA,EACD;AACD,SAAO,EACN99F,OAAO29F,YACP19F,KAAK29F,UACL11C,KAAK21C,cAEP;AAAA;ACtBA,IAAIE,kBAAkB,SAAS7mG,QAAAA;AAG9B,MAAI8mG,kBAAkB,CAAE,GACvBC,sBAAsB,CAAA;AAEvB,WAAS16F,QAAQwkD,OAChB;AAAA,QAAIloD,OAAO;AACX,eAAWkoD,MAAMloD,SAAS,UAAU;AACnCA,aAAO3I,OAAMoM,IAAIC,QAAQwkD,MAAMloD,IAAAA;AAAAA,IAClC,WAAakoD,MAAMloD,MAAM;AACtBA,aAAOkoD,MAAMloD;AAAAA,IACb;AACD,WAAOA;AAAAA,EACP;AAED,WAASq+F,YAAY9iG,IAAI2sD,OAAOh6D,MAE/B;AAAA,QAAIkwG,oBAAoB7iG,EAAAA,EACvB,QAAO6iG,oBAAoB7iG;AAE5B,QAAK2sD,CAAAA,MAAMP,SACVtwD,CAAAA,OAAMqqC,OAAO,OAAO;AAErB,QAAI48D,eAAe;AACnB,QAAIC,eAAe;AACnB,QAAIC,gBAAe;AACnB,QAAIC,uBAAuB;AAC3B,QAAIC,6BAA6B;AAEjC,eAAUx2C,MAAMP,aAAa,YAAW;AACvC22C,qBAAep2C,MAAMP;AACrB62C,MAAAA,gBAAeG;AAAAA,IAClB,OAAO;AACJL,qBAAep2C,MAAMP,SAAS3tD;AAC9BukG,qBAAer2C,MAAMP,SAASvqB;AAC9BqhE,6BAAuBv2C,MAAMP,SAASi3C;AAEtC,UAAG12C,MAAMP,SAASk3C,cAAa;AAC9BH,qCAA6Bx2C,MAAMP,SAASk3C;AAAAA,MAChD,OAAQ;AACJL,QAAAA,gBAAet2C,MAAMP,SAAS62C;AAAAA,MAC9B;AAED,WAAKA,iBAAgBA,kBAAiB,MAAM;AAC3CA,QAAAA,gBAAeG;AAAAA,MACf;AAAA,IACD;AAED,QAAIpoD,SAAS2R,MAAM3R;AAEnB,QAAIroD,KACHA,MAAKozB,aAAajqB,OAAMuC,OAAOovC,iBAAiB,IAEjDo1D;AAAAA,wBAAoB7iG,EAAM,IAAA,EACzBusD,aAAa,SAAU5pD,MAAMi1B,WAAW/4B,UAAU0kG,WAAWC;AAC5D5rE,kBAAYA,aAAajlC;AACzB,UAAIqoD,QAAQ;AACX,aAAKA,OAAOr4C,IAAAA,GAAO;AAClB5J,eAAK0qG,YAAY9gG,KAAK3C;AACtB;AAAA,QACA;AAAA,MACD;AAED,UAAIyE,OAAO8+F,aAAap7F,QAAQwkD,KAChC;AAAA,UAAItuD,UAASmlG,eAAe/+F,OAAOA,KAAKm7F,WAAe,IAAA;AACvD,UAAI8D,mBAAmB7kG;AACvB,UAAA,CAAI6kG,oBAAoBrlG,WAAUA,QAAOmO,iBAAgB;AACxDk3F,2BAAmBj/F,KAAKlI,YACxB;AAAA,MAAA;AAED,UAAImB,MAAM;AACV,UAAA,CAAIykG,eAAermG,MAAWmnG,MAAAA,iBAAgBE,+BAA+BO,kBAAiB;AAC7F,YAAIhxG,aAAY;AAChB,YAAGywG,4BAA2B;AAC7BzwG,UAAAA,aAAYywG,2BAA2BxgG,MAAM+gG,kBAAkBj/F,MAAMpG,SAAQvC,MACnF;AAAA,QAAA,OAAU;AACJpJ,UAAAA,aAAYsvG,uBAAuB0B,kBAAkBT,cAAatgG,MAAM8B,MAAMpG,SAAQvC,MACtF,CAAA;AAAA,QAAA;AACD,YAAGpJ,YAAU;AACZgL,gBAAMqlG,aAAanuG,KAAKkH,QAAO6G,MAAM8B,MAAMpG,SAAQqlG;QACnD;AAAA,MACN,OAAS;AACJhmG,cAAMqlG,aAAanuG,KAAKkH,QAAO6G,MAAM8B,MAAMpG,SAAQqlG,gBACnD;AAAA,MAAA;AACD3qG,WAAK4U,OAAOhL,MAAMjF,KAAKk6B,SAEvB;AAAA,UAAI+rE,YAAY/rE,UAAUn9B,YAAY;AACtC,UAAGyoG,wBAAyBS,CAAAA,aAAajmG,KAAK;AAC7CwlG,6BAAqBtuG,KAAKkH,QAAO6G,MAAMjF,KAAK+G;MAC5C;AAAA,IACD,GAEDrE,OAAO,SAAUw3B,WAEhB7+B;AAAAA,WAAK6qG,WAAWhB,gBAAgB5iG,EAAAA,IAAM,CAAA;AACtC,UAAA,CAAI2sD,MAAMh/C,OACT5U,MAAK8qG,gBAAgBjsE,SAAAA;AAAAA,IACtB,GACDisE,iBAAiB,SAAUjsE,WAC1BA;AAAAA,kBAAYA,aAAajlC;AACzB,UAAIilC,WAAU;AACbA,kBAAUxgC,YAAY;AAAA,MACtB;AAAA,IACD,GACDy1D,mBAAmB,SAAS1oB,WAAAA;AAC3B,UAAI1/B,OAAO0D,QAAQwkD;AACnB,UAAIlvB;AACJ,UAAI+lE,aAAa/+F,OAAOA,KAAKm7F,eAAe;AAC5C,UAAG4D,cAAcA,WAAWh3F,iBAAgB;AAC3CixB,mBAAWh5B,KAAKlI,YAAAA;AAAAA,MAChB;AAED,UAAIsW;AACJ,UAAGpO,QAAQg5B,UAAS;AACnB,mBAAUkvB,MAAMP,aAAa,YAAW;AACvCv5C,kBAAQixF,qBAAchoG,QAAO2I,MAAM++F,YAAYr/D,WAAW1G,QAC1D;AAAA,QAAA,WAAQkvB,MAAMP,YAAYO,MAAMP,SAAS23C,iBAAgB;AACzDlxF,kBAAQ85C,MAAMP,SAAS23C,gBAAgBjoG,QAAO2I,MAAM++F,YAAYr/D,WAAW1G,QAC3E;AAAA,QAAA;AAAA,MACD;AACD,UAAI5qB,CAAAA,OAAM;AACTA,gBAAQ,EACPjO,OAAO,GACPC,KAAKs/B,UAAU0e,MAEhB,EAAA;AAAA,MAAA;AAED,aAAOhwC;AAAAA,IACP,GACDk6C,cAAc,SAASz9B,OACtB;AAAA,UAAGq9B,MAAMP,YAAYO,MAAMP,SAAS43C,aAAY;AAC/C,eAAOr3C,MAAMP,SAAS43C,YAAY10E,OAAOxzB,QAAO6wD,KAAAA;AAAAA,MAChD;AAAA,IACD,GACDK,cAAc,SAAU19B,OAAOsI;AAC9BA,kBAAYA,aAAajlC;AAEzB,UAAI2vG,SAASnxG,SAAS8yG,uBAAAA;AACtBlrG,WAAKqH,MAAMw3B;AAEX,UAAI/4B,WAAW;AACf,UAAI4F,OAAO0D,QAAQwkD,KACnB;AAAA,UAAI62C,aAAa/+F,OAAOA,KAAKm7F,WAAAA,IAAe;AAC5C,UAAG4D,cAAcA,WAAWh3F,iBAAgB;AAC3C3N,mBAAW4F,KAAKlI,YAChB;AAAA,MAAA;AAED,eAAS1H,IAAI,GAAGqvG,MAAM50E,MAAMx6B,QAAQD,IAAIqvG,KAAKrvG,KAAK;AACjDkE,aAAKwzD,YAAYj9B,MAAMz6B,CAAAA,GAAIytG,QAAQzjG,UAAU4F,MAAM++F,UACnD;AAAA,MAAA;AAED5rE,gBAAUniC,YAAY6sG,QAAQ1qE;AAE9B,UAAIusE,cAAc,CAAA;AAClB70E,YAAMptB,QAAQ,SAASS,MACtBwhG;AAAAA,oBAAYxhG,KAAK3C,EAAM2C,IAAAA;AAAAA,MAC5B;AACI,UAAIyhG,gBAAgB,CAAA;AACpB,UAAIlB,sBAAsB;AACzB,YAAImB,cAAc,CAAA;AAClB,iBAAQxvG,KAAKkE,KAAK6qG,UAAU;AAC3B,cAAA,CAAIQ,cAAcvvG,CAAAA,GAAG;AACpBwvG,wBAAYxvG,CAAAA,IAAKkE,KAAK6qG,SAAS/uG,CAAAA;AAC/BquG,iCAAqBtuG,KAAKkH,QAAOqoG,YAAYtvG,CAAAA,GAAIkE,KAAK6qG,SAAS/uG,IAAI4P,IACnE;AAAA,UAAA;AAAA,QACD;AAAA,MAED;AAAA,IACD,GACDyoD,cAAc,SAAU59B,OAAOsI,WAC9B;AAAA,UAAInzB,OAAO0D,QAAQwkD;AACnB,UAAI62C,aAAa/+F,OAAOA,KAAKm7F,WAAAA,IAAe;AAC5C,UAAIn7F,CAAAA,QAAAA,CAASA,KAAKm7F,WAAAA,EAAapzF,mBAAmB21F,eAAermG,SAAO;AACvE;AAAA,MACA;AAED,UAAA,CAAI/C,KAAK6qG,UAAS;AACjB;AAAA,MACA;AAED,UAAKX,EAAAA,iBAAgBE,6BAA4B;AAChD;AAAA,MACA;AAEDvrE,kBAAYA,aAAajlC;AAEzB,UAAI2vG,SAASnxG,SAAS8yG,uBAAAA;AAEtB,UAAIplG,WAAW;AACf,UAAG4F,MAAK;AACP5F,mBAAW4F,KAAKlI,YAAAA;AAAAA,MAChB;AAED,UAAI4nG,cAAc,CAAA;AAClB70E,YAAMptB,QAAQ,SAASS,OAAAA;AACtBwhG,oBAAYxhG,MAAK3C,EAAAA,IAAM2C;AAAAA,MAC5B,CACI;AAAA,UAAIyhG,gBAAgB,CAAA;AAEpB,UAAIE,gBAAgB,CAAA;AACpB,eAAQzvG,KAAKkE,KAAK6qG,UAAS;AAC1BU,sBAAczvG,KAAK;AACnBuvG,sBAAcvvG,CAAK,IAAA;AAAA,MACnB;AAED,UAAI0vG,kBAAkB,CAAA;AACtB,eAAS1vG,IAAI,GAAGqvG,MAAM50E,MAAMx6B,QAAQD,IAAIqvG,KAAKrvG,KAAK;AACjD,YAAI8N,OAAO2sB,MAAMz6B,CACjB;AAAA,YAAI2vG,WAAWzrG,KAAK6qG,SAASjhG,KAAK3C,EAAAA;AAClCskG,sBAAc3hG,KAAK3C,MAAM;AACzB,YAAIwkG,YAAYA,SAASlzG,YAAY;AACpC,cAAIoB,aAAY;AAChB,cAAGywG,4BAA2B;AAC7BzwG,YAAAA,aAAYywG,2BAA2BxgG,MAAM9D,UAAU4F,MAAM++F,YAAY1nG,MAAAA;AAAAA,UAChF,OAAW;AACJpJ,YAAAA,aAAYsvG,uBAAuBnjG,UAAUokG,cAAatgG,MAAM8B,MAAM++F,YAAY1nG,MAAAA,CAAAA;AAAAA,UAClF;AACD,cAAKpJ,CAAAA,YAAW;AACf4xG,0BAAc3hG,KAAK3C,EAAM,IAAA;AAAA,UAChC,OAAa;AACN,gBAAGgjG,cAAa;AACfA,2BAAapuG,KAAKkH,QAAO6G,MAAM6hG,UAAU//F,MAAM++F,YAAY3kG,QAC3D;AAAA,YAAA;AACD9F,iBAAK0rG,QAAQ9hG,MAAM2/F,MACnB;AAAA,UAAA;AAAA,QACP,OAAY;AACNiC,0BAAgBj1E,MAAMz6B,CAAGmL,EAAAA,EAAAA,IAAM;AAC/BjH,eAAKwzD,YAAYj9B,MAAMz6B,IAAIytG,QAAQzjG,UAAU4F,MAAM++F,UAAAA;AAAAA,QACnD;AAAA,MACD;AAED,eAAQ3uG,KAAKyvG,eAAc;AAC1B,YAAGA,cAAczvG,IAAG;AACnBkE,eAAK41B,KAAK95B,CACV;AAAA,QAAA;AAAA,MACD;AACD,UAAGytG,OAAO3qG,WAAW7C,QAAO;AAC3B8iC,kBAAUniC,YAAY6sG,QAAQ1qE,SAAAA;AAAAA,MAC9B;AAED,UAAIsrE,sBAAsB;AACzB,YAAImB,cAAc,CAAA;AAClB,iBAAQxvG,KAAKkE,KAAK6qG,UAAU;AAC3B,cAAIQ,CAAAA,cAAcvvG,MAAM0vG,gBAAgB1vG,CAAAA,GAAG;AAC1CwvG,wBAAYxvG,CAAKkE,IAAAA,KAAK6qG,SAAS/uG,CAC/BquG;AAAAA,iCAAqBtuG,KAAKkH,QAAOqoG,YAAYtvG,CAAAA,GAAIkE,KAAK6qG,SAAS/uG,CAAAA,GAAI4P,IACnE;AAAA,UAAA;AAAA,QACD;AAAA,MAED;AAAA,IACD,GACDkJ,QAAQ,SAAUhL,MAAMhQ,OAAMilC,WAAAA;AAC7B,WAAI7+B,KAAK6qG,UAAS;AACjB;AAAA,MACA;AAED,UAAA,CAAKjxG,OAAM;AACV,YAAIoG,KAAK6qG,SAASjhG,KAAK3C,EAAAA,GAAK;AAC3BjH,eAAK0qG,YAAY9gG,KAAK3C,EAAAA;AAAAA,QACtB;AACD;AAAA,MACA;AAED,UAAIjH,KAAK6qG,SAASjhG,KAAK3C,EAAAA,KAAOjH,KAAK6qG,SAASjhG,KAAK3C,EAAI1O,EAAAA,YAAY;AAChEyH,aAAK2rG,aAAa/hG,KAAK3C,IAAIrN,KAChC;AAAA,MAAA,OAAW;AACNilC,kBAAUniC,YAAY9C,KACtB;AAAA,MAAA;AACDoG,WAAK6qG,SAASjhG,KAAK3C,EAAAA,IAAMrN;AAAAA,IACzB,GACD+xG,cAAc,SAAUC,SAASC,SAAAA;AAChC,UAAIjiG,OAAO5J,KAAK6qG,SAASe,OAAAA;AACzB,UAAIhiG,QAAQA,KAAKrR,YAAY;AAC5BqR,aAAKrR,WAAWuzG,aAAaD,SAASjiG,IAEtC;AAAA,MAAA;AACD5J,WAAK6qG,SAASe,OAAWC,IAAAA;AAAAA,IACzB,GACDnB,aAAa,SAAUkB;AACtB5rG,WAAK41B,KAAKg2E;aACH5rG,KAAK6qG,SAASe,OACrB;AAAA,IAAA,GACDh2E,MAAM,SAAUg2E;AACf,UAAIhiG,OAAO5J,KAAK6qG,SAASe,OACzB;AAAA,UAAIhiG,QAAQA,KAAKrR,YAAY;AAC5BqR,aAAKrR,WAAWqE,YAAYgN;MAC5B;AAAA,IACD,GACD8hG,SAAS,SAAU9hG,MAAMi1B;AACxB,UAAIl6B,MAAM3E,KAAK6qG,SAASjhG,KAAK3C,EAAAA;AAC7B,UAAItC,KAAK;AACR,aAAKA,IAAIpM,YAAY;AACpByH,eAAK4U,OAAOhL,MAAMjF,KAAKk6B,aAAajlC,IAAAA;AAAAA,QACpC;AAAA,MACN,OAAW;AACNoG,aAAKwzD,YAAY5pD,MAAMi1B,aAAajlC,IACpC;AAAA,MAAA;AAAA,IACD,GACD86D,WAAW,SAAUpK,OAAOC;AAC3BvqD,WAAK6qG,SAAStgD,KAASvqD,IAAAA,KAAK6qG,SAASvgD,KAAAA;AAAAA,aAC9BtqD,KAAK6qG,SAASvgD,KAAAA;AAAAA,IACrB,GACDugD,UAAUhB,gBAAgB5iG,EAAAA,GAC1BrN,MACAqV,YAAY;AACXjP,WAAKqH,MAAAA;AAAAA,aACEyiG,oBAAoB7iG,EACpB4iG;AAAAA,aAAAA,gBAAgB5iG,EACvB;AAAA,IAAA,EAAA;AAGF,WAAO6iG,oBAAoB7iG;EAC3B;AAGD,WAAS8kG;AACR,aAASjwG,KAAKguG,qBAAqB;AAClCC,kBAAYjuG,CAAAA,EAAGmT,WACf;AAAA,IAAA;AAAA,EACD;AAED,SAAO,EACN86F,aACAgC;AAGF;ACtUA,IAAIC,eAAe,SAASjpG,QAE3B;AAAA,MAAIkpG,gBAAgBC,gBAAsBnpG,MAAAA;AAC1C,SAAO,EACPopG,aAAa,SAAU/wB,cAAcgxB,cAAcC,gBAAgBC,YAElE;AAAA,QAAIC,cAAc,EACjBC,gBAAgB,CAChBl2E,GAAAA,WAAW,CAAE,GACbuI,WAAWu8C,cACXqxB,SAAS,CAAA,GACTl5C,WAAW,WAAA;AACVvzD,WAAK0sG,KAAAA;AAEL,UAAInqF,MAAM,CAAA;AACV,eAASzmB,KAAKkE,KAAKs2B,WAAW;AAC7B/T,YAAIvjB,KAAKgB,KAAKs2B,UAAUx6B,CAAAA,CAAAA;AAAAA,MACxB;AACD,aAAOymB;AAAAA,IACP,GACDoqF,UAAU,SAAU1lG;AACnB,aAAOjH,KAAKs2B,UAAUrvB,EAAAA;AAAAA,IACtB,GACDylG,MAAM,SAAU94C,OACf;AAAA,UAAIA,OAAO;AACVA,cAAM3sD,KAAK2sD,MAAM3sD,MAAMyiD,IAAAA;AACvB1pD,aAAKwsG,eAAextG,KAAK40D,KAAAA;AAAAA,MACzB;AAED,UAAI/0B,YAAY7+B,KAAK6+B,UAErB;AAAA,UAAI+tE,UAAU5sG,KAAKwsG;AACnB,eAAS1wG,IAAI,GAAGA,IAAI8wG,QAAQ7wG,QAAQD,KAAK;AACxC83D,gBAAQg5C,QAAQ9wG,CAEhB;AAAA,YAAA,CAAKkE,KAAK6+B,UAAAA,KAAAA,EAAiB+0B,SAASA,MAAM/0B,aAAalK,UAAqBi/B,MAAM/0B,WAAWzmC,SAASD,IAAAA,GAAQ;AAE9G,YAAIyB,OAAOg6D,MAAM/0B,WAChB53B,KAAK2sD,MAAM3sD,IACX4lG,UAAUj5C,MAAMi5C;AACjB,YAAA,CAAKjzG,KAAKrB,YAAY;AAErB,cAAIs0G,SAAS;AACZhuE,sBAAUniC,YAAY9C,IAAAA;AAAAA,UAC7B,OAAa;AACN,gBAAIkzG,MAAMV,eAAeA,aAAAA,IAAiBvtE,UAAUtgC;AAGpD,gBAAIuuG,OAAOA,IAAIv0G,cAAcsmC,UAC5BA,WAAU4lE,aAAa7qG,MAAMkzG,GAE7BjuE;AAAAA,gBAAAA,WAAUniC,YAAY9C,IAAAA;AAAAA,UACvB;AAAA,QACD;AACDoG,aAAKs2B,UAAUrvB,EAAAA,IAAMglG,cAAclC,YAClC9iG,IACA2sD,OACAh6D,IAAAA;AAGD,YAAI0yG,YAAW;AACdA,UAAAA,WAAU14C,OAAO7wD,MAAAA;AAAAA,QACjB;AAED/C,aAAKwsG,eAAenwG,OAAOP,GAAG,CAC9BA;AAAAA;AAAAA,MACA;AAAA,IACD,GACD29B,UAAU,SAAUn0B;AACnB,UAAGA,SAAO;AACT,YAAA,OAAUA,WAAU,YAAW;AAC9BA,UAAAA,UAAS,EAAC+tD,UAAU/tD,QACpB;AAAA,QAAA;AAED,YAAGA,QAAO28C,WAAW5hD,QAAU;AAC9BiF,UAAAA,QAAO28C,SAAS8qD,aAAaV,kBAAkB,CAAA,CAAA;AAAA,QACrD,WAAc/mG,QAAO28C,kBAAkBvmD,OAAM;AACvC4J,UAAAA,QAAO28C,OAAOjjD,KAAKqtG,cAAAA;AACnB/mG,UAAAA,QAAO28C,SAAS8qD,aAAaznG,QAAO28C,MACpC;AAAA,QAAA;AAED,aAAI38C,QAAOu5B,WAAU;AACpBv5B,UAAAA,QAAOu5B,YAAYzmC,SAASoE,cAAc,KAC1C;AAAA,QAAA;AACD,YAAIy4D,OAAOj1D;AACXsF,QAAAA,QAAO0nG,gBAAgB,WACtB;AAAA,cAAGjqG,OAAMuC,OAAOmO,mBAAoB21F,CAAAA,eAAermG,SAAO;AACzD,gBAAGkyD,KAAK3+B,UAAUhxB,QAAO2B,KAAI;AAC5BguD,mBAAKX,gBAAgBW,KAAK3+B,UAAUhxB,QAAO2B;YAC3C;AAAA,UACD;AAAA,QAEP;AAAA,MACK;AAEDjH,WAAK0sG,KAAKpnG;AACV,aAAQA,UAASA,QAAO2B,KAAK5G;AAAAA,IAC7B,GACDi0D,iBAAiB,SAASV,OAAAA;AAAAA,IAEzB,GAEDq5C,WAAW,SAAStyF;AACnB,eAAS7e,KAAKkE,KAAKs2B,WAAW;AAC7B3b,aAAK3a,KAAKs2B,UAAUx6B,CACpB,CAAA;AAAA,MAAA;AAAA,IACD,GACDoxG,aAAa,SAAUjmG,IACtB;AAAA,UAAA,CAAIjH,KAAKs2B,UAAUrvB,EAClB,EAAA;AACDjH,WAAKs2B,UAAUrvB,EAAAA,EAAIgI;aACZjP,KAAKs2B,UAAUrvB;IACtB,GACDI,OAAO,WACN;AAAA,eAASvL,KAAKkE,KAAKs2B,WAAW;AAC7Bt2B,aAAKs2B,UAAUx6B,CAAAA,EAAGmT;MAClB;AACDjP,WAAKs2B,YAAY;IACjB,EAAA;AAIFvzB,IAAAA,OAAMyE,YAAY,aAAa;AAC9B+kG,kBAAYllG,MAAAA;AACZklG,oBAAc;AAAA,IACjB,CAAA;AAEE,WAAOA;AAAAA,EACP,EACA;AAAA;AAGF,SAASQ,aAAaI,gBAAAA;AACrB,MAAKA,EAAAA,0BAA0BzxG,QAAO;AACrCyxG,qBAAiBzxG,MAAMC,UAAUC,MAAMC,KAAK+K,WAAW,CAAA;AAAA,EACvD;AAED,SAAO,SAAS7H;AACf,QAAIwjB,MAAM;AACV,aAAQzmB,IAAI,GAAG+C,MAAMsuG,eAAepxG,QAAQD,IAAI+C,KAAK/C,KAAI;AACxD,UAAIsxG,gBAAgBD,eAAerxG,CAAAA;AACnC,UAAGsxG,eAAc;AAChB7qF,cAAMA,OAAQ6qF,cAAcruG,IAAIkI,IAAIlI,GAAS,MAAA;AAAA,MAC7C;AAAA,IACD;AAED,WAAOwjB;AAAAA,EACT;AACA;ACzJe,SAAA8qF,aAASzjG,MAAM8B,MAAMpG,SACnC;AAAA,MAAA,CAAIsE,KAAKuI,cAAAA,CAAevI,KAAKwI,UAAS;AACrC,WAAO;AAAA,EACP;AACD,MAAI4R,UAAU;AACd,MAAIspF,aAAa5hG,KAAKwgB,YAAYtiB,KAAKuI,UACvC;AAAA,MAAIo7F,WAAW7hG,KAAKwgB,YAAYtiB,KAAKwI;AACrC,MAAIta,OAAOwB,KAAKyS,IAAIuhG,YAAYC,YAAYvpF;AAC5C,MAAIjsB,QAAQuB,KAAKuD,IAAIywG,YAAYC,YAAYvpF;AAC7C,SAAO,EACNnsB,KAAK6T,KAAK8C,WAAW5E,KAAK3C,EAAAA,GAC1BvN,QAAQgS,KAAK4C,cAAc1E,KAAK3C,KAChCnP,MACA2B,OAAO1B,QAAQD,KAEjB;AAAA;ACXe,SAAS01G,WAAW5jG,MAAM8B,MAAMpG,SAAQvC,QACtD;AAAA,MAAA,CAAIA,OAAM0d,aAAa7W,KAAK8W,SAAQ;AACnC,WAAO;AAAA,EACP;AAED,MAAA,CAAI3d,OAAM0d,aAAa7W,KAAKtK,MAAAA,GAAQ;AACnC,WAAO;AAAA,EACP;AACD,MAAImuG,YAAYJ,aAAatqG,OAAMmc,QAAQtV,KAAK8W,MAAShV,GAAAA,IAAAA;AACzD,MAAIgiG,YAAYL,aAAatqG,OAAMmc,QAAQtV,KAAKtK,MAASoM,GAAAA,IAAAA;AAEzD,OAAI+hG,aAAcC,CAAAA,WAAU;AAC3B,WAAO;AAAA,EACP;AAED,MAAI1pF,UAAU;AACd,MAAIlsB,OAAOwB,KAAKyS,IAAI0hG,UAAU31G,MAAM41G,UAAU51G,IAAQksB,IAAAA;AACtD,MAAIjsB,QAAQuB,KAAKuD,IAAI4wG,UAAU31G,OAAO21G,UAAUh0G,OAAOi0G,UAAU51G,OAAO41G,UAAUj0G,KAASuqB,IAAAA;AAC3F,MAAInsB,MAAMyB,KAAKyS,IAAI0hG,UAAU51G,KAAK61G,UAAU71G,GAAAA,IAAOmsB;AACnD,MAAIhsB,SAASsB,KAAKuD,IAAI4wG,UAAU51G,MAAM41G,UAAU/zG,QAAQg0G,UAAU71G,MAAM61G,UAAUh0G,MAAAA,IAAUsqB;AAE5F,SAAO,EACNnsB,KACA6B,QAAQ1B,SAASH,KACjBG,QACAF,MACA2B,OAAO1B,QAAQD,MACfC;AAEF;AC/Be,SAAAizG,kBACd;AAAA,MAAIhmG,cAAc,CAAA;AAClB,MAAI2oG,aAAa;AAEjB,WAASC,aACR5oG;AAAAA,kBAAc;AACd2oG,iBAAa;AAAA,EACb;AAED,WAAS57C,WAAW3mB,WAAW1/B,MAAM3I,QACpC;AAAA,QAAIuC,UAASoG,KAAKm7F,WAClB;AAAA,QAAIgH,eAAeziE,UAAUsiB,gBAAAA;AAE7BmgD,iBAAa1kG,QAAQ,SAASqX,MAAAA;AAC7B,UAAIstF,MAAMC,WAAiBvtF,MAAM9U,MAAMpG,SAAQvC;AAC/C,UAAI+qG,CAAAA,KAAI;AACP;AAAA,MACA;AAED9oG,kBAAYhG,KAAK,EAACiI,IAAIuZ,KAAKvZ,IAAI6mG,IAAKA,CAAAA;AAAAA,IACvC;AAEE9oG,gBAAY/I,KAAK,SAAS1B,GAAG2B,GAC5B;AAAA,UAAG3B,EAAEuzG,IAAI/1G,QAAQmE,EAAE4xG,IAAI/1G,OAAM;AAC5B,eAAQ;AAAA,MACZ,OAAS;AACL,eAAO;AAAA,MACP;AAAA,IACJ,CAEE41G;AAAAA,iBAAa;AAAA,EACb;AAED,MAAIK,cAAc;AAClB,WAAS1wD,KAAKlS,WAAAA;AACb,QAAG4iE,aAAY;AACd;AAAA,IACA;AACDA,kBAAc;AACd5iE,cAAU5jC,YAAY,eAAeomG,UAAAA;AACrCxiE,cAAU5jC,YAAY,kBAAkBomG,UAAAA;AACxCxiE,cAAU5jC,YAAY,cAAcomG,UACpCxiE;AAAAA,cAAU5jC,YAAY,uBAAuBomG;EAC7C;AAED,SAAO,SAASK,qBAAqBlrG,QAAO2I,MAAMpG,SAAQ8lC,WAAW1G,UAAAA;AACpE4Y,SAAKlS,SACL;AAAA,QAAA,CAAIuiE,YAAW;AACd57C,iBAAW3mB,WAAW1/B,MAAM3I,MAC5B;AAAA,IAAA;AAED,QAAImrG,eAAe,CAAA;AACnB,aAAQpyG,IAAI,GAAGA,IAAIkJ,YAAYjJ,QAAQD,KAAI;AAC1C,UAAI8N,OAAO5E,YAAYlJ,CACvB;AAAA,UAAI5D,MAAM0R,KAAKkkG;AACf,UAAG51G,IAAIH,QAAQ2sC,SAASlrC,GAAE;AACzB;AAAA,MACA;AACD,UAAGtB,IAAIJ,OAAO4sC,SAASwkE,SAAShxG,IAAIH,QAAQ2sC,SAASlrC,KAAKtB,IAAIL,MAAM6sC,SAASykE,SAASjxG,IAAIF,SAAS0sC,SAASrrC,GAAE;AAC7G60G,qBAAalvG,KAAK4K,KAAK3C,EAAAA;AAAAA,MACvB;AAAA,IACD;AAED,WAAO,EACN8sD,KAAKm6C,aAER;AAAA,EAAA;AACA;AChEe,SAASC,iBAAiBvkG,MAAM86B,UAAUh5B,MAAMpG,SAAQvC,QAAAA;AACtE,MAAI2d,SAAShV,KAAK40D,OAAOphD,QAAQtV,KAAK8W,MACtC;AAAA,MAAIphB,SAASoM,KAAK40D,OAAOphD,QAAQtV,KAAKtK,MAEtC;AAAA,MAAI8uG,YAAY1iG,KAAK8C,WAAWkS,OAAOzZ,EAAAA;AACvC,MAAIonG,eAAe3iG,KAAK4C,cAAcoS,OAAOzZ,EAE7C;AAAA,MAAIqnG,YAAY5iG,KAAK8C,WAAWlP,OAAO2H,EAAAA;AACvC,MAAIsnG,eAAe7iG,KAAK4C,cAAchP,OAAO2H,EAAAA;AAE7C,MAAGy9B,SAASrrC,IAAI+0G,YAAYC,gBAC3B3pE,SAASrrC,IAAIi1G,YAAYC,cAAa;AACtC,WAAO;AAAA,EACP;AAED,MAAG7pE,SAASykE,QAAQmF,aACnB5pE,SAASykE,QAAQiF,WAAU;AAC3B,WAAO;AAAA,EACP;AAED,MAAIpqF,UAAU;AACd,MAAIwqF,aAAa9iG,KAAKwgB,YAAYxL,OAAOvO,UAAAA;AACzC,MAAIs8F,cAAc/iG,KAAKwgB,YAAYxL,OAAOtO,QAC1C;AAAA,MAAIs8F,aAAahjG,KAAKwgB,YAAY5sB,OAAO6S;AACzC,MAAIw8F,cAAcjjG,KAAKwgB,YAAY5sB,OAAO8S;AAE1C,MAAGo8F,aAAaC,aAAY;AAE3B,QAAIrxE,MAAMqxE;AACVA,kBAAcD;AACdA,iBAAapxE;AAAAA,EACb;AACD,MAAGsxE,aAAaC,aAAY;AAE3B,QAAIvxE,MAAMuxE;AACVA,kBAAcD;AACdA,iBAAatxE;AAAAA,EACb;AACDoxE,gBAAAA,CAAexqF;AACfyqF,iBAAezqF;AACf0qF,gBAAe1qF,CAAAA;AACf2qF,iBAAe3qF;AAEf,MAAG0gB,SAASlrC,IAAIi1G,eACf/pE,SAASlrC,IAAIm1G,aAAY;AACzB,WAAO;AAAA,EACP;AAED,MAAGjqE,SAASwkE,QAAQsF,cACnB9pE,SAASwkE,QAAQwF,YAAW;AAC5B,WAAO;AAAA,EACP;AACD,SAAO;AACR;ACnDA,SAASpC,UAAU14C,OAAO7wD,QACzB;AAAA,MAAA,CAAI6wD,MAAMloD,MAAK;AACd;AAAA,EACA;AAED,MAAIA,OAAOkoD,MAAMloD;AACjB,MAAUA,OAAAA,SAAS,UAAS;AAC3BA,WAAO3I,OAAMoM,IAAIC,QAAQ1D;EACzB;AAED,MAAGA,QAAQA,KAAKlE,aAAY;AAC3BkE,SAAKlE,YAAY,YAAY,WAC5B;AAAA,UAAI5D,QAAQb,OAAMc,UAAUC,WAAW,OAAA;AAEvC,UAAIF,CAAAA,MAAM2J,SAAS,aAAA,EAAeinD,iBAAiB9oD,KAAK+E,QAAQm+F,0BAAyB;AACxF,YAAGh7C,MAAMo5C,eAAc;AACtBp5C,gBAAMo5C,cAAAA;AAAAA,QACN;AAAA,MACD;AAAA,IACJ;EACE;AACF;AAEA,IAAI6B,oBAAoB,SAAS9rG;AAChC,MAAIy/F,WAAUsM,aAAmB/rG,MAAAA;AACjC,SAAO,EACNsxD,eAAe,SAASh3D,MAAAA;AACvB,WAAO0F,OAAMc,UAAUC,WAAW,WAAWzG,IAAAA,KAAS;AAAA,EACtD,GACDk8B,kBAAkB,SAASj0B;AAC1B,QAAIjI,OAAOiI,QAAOjI,MACjBm8B,mBAAmBl0B,QAAOk0B,kBAC1Bu1E,0BAA0BzpG,QAAO0pG;AAElC,QAAI31E,SAASmpE,SAAQ2J,YACpB3yE,kBACAu1E,yBACA,SAASj+C,QAAQlnD,MAAAA;AAChB,UAAGyvB,OAAOozE,SAAQ;AACjB,iBAAQ3wG,IAAI,GAAGA,IAAIu9B,OAAOozE,QAAQ1wG,QAAQD,KAAI;AAC7C,cAAGu9B,OAAOozE,QAAQ3wG,CAAAA,EAAGg1D,QAAQlnD,IAAAA,MAAU,OAAM;AAC5C,mBAAO;AAAA,UACP;AAAA,QACD;AAAA,MACP,OAAU;AACJ,eAAO;AAAA,MACP;AAAA,IACD,GACD0iG,SAAAA;AAGDvpG,IAAAA,OAAMc,UAAU0tC,WAAW,WAAWl0C,MAAM,WAC3C;AAAA,aAAOg8B;AAAAA,IACX,CAEGt2B;AAAAA,IAAAA,OAAMyE,YAAY,gBAAgB,WACjC6xB;AAAAA,aAAOI;IACX,CAEG;AAAA,WAAOJ;AAAAA,EACP,GACDikB,MAAM;AACL,QAAI2xD,cAAajvG,KAAKu5B,iBAAiB,EACtCl8B,MAAM,QACNm8B,kBAAkB,WAAA;AACjB,UAAGz2B,OAAMiM,YAAW;AACnB,eAAOjM,OAAMiM;AAAAA,MACb,WAAQjM,OAAMoM,IAAIC,QAAQ,UAAA,GAAY;AACtC,eAAOrM,OAAMoM,IAAIC,QAAQ,UAAA,EAAYJ;AAAAA,MACrC;AAAA,IACD,GACDggG,yBAAyB;AACxB,UAAGjsG,OAAMmsG,aAAY;AACpB,eAAOnsG,OAAMmsG;AAAAA,MACb,WAAQnsG,OAAMoM,IAAIC,QAAQ,UAAA,GAAY;AACtC,eAAOrM,OAAMoM,IAAIC,QAAQ,UAAA,EAAY8/F;AAAAA,MACrC;AAAA,IACD,GACDjtD,QAAQ,SAASr4C,MAEhB;AAAA,IAAA,EAAA,GACC7G;AAEH,QAAIosG,aAAanvG,KAAKu5B,iBAAiB,EACtCl8B,MAAM,QACNm8B,kBAAkB,WAAA;AACjB,UAAGz2B,OAAMiM,YAAW;AACnB,eAAOjM,OAAMiM;AAAAA,MACb,WAAQjM,OAAMoM,IAAIC,QAAQ,UAAA,GAAY;AACtC,eAAOrM,OAAMoM,IAAIC,QAAQ,UAAYJ,EAAAA;AAAAA,MACrC;AAAA,IACD,EAAA,GACCjM,MAEH;AAAA,WAAO,EACNqsG,cAAc,SAAS9pG,SACtB;AAAA,YAAM+pG,gBAAgBC;AACtB,iBAAUhqG,YAAW,YAAW;AAC/BA,QAAAA,UAAS,EACR+tD,UAAU,EACT3tD,QAAQJ,SACR0lG,iBAAiBqE,cAGzB,EAAA;AAAA,MAAA,OAAU;AACJ,YAAG/pG,QAAO+tD,aAAa/tD,QAAO+tD,SAAS23C,iBAAgB;AACtD1lG,UAAAA,QAAO+tD,SAAS23C,kBAAkBqE;AAAAA,QAClC;AAAA,MACD;AACD/pG,MAAAA,QAAOoG,OAAO;AAEd,aAAOujG,YAAWx1E,SAASn0B,OAC3B;AAAA,IAAA,GAEDiqG,gBAAgB,WAAA;AACf,aAAON,YAAW17C;IAClB,GACDi8C,iBAAiB,SAASvoG,IAAAA;AACzBgoG,MAAAA,YAAW/B,YAAYjmG;IACvB,GAED4zF,kBAAkB,WACjBoU;AAAAA,MAAAA,YAAW5nG,MACX;AAAA,IAAA,GACDooG,cAAc,SAASnqG,SAAAA;AACtB,YAAM+pG,gBAAgBK,gBAAAA;AACtB,iBAAUpqG,YAAW,YAAW;AAC/BA,QAAAA,UAAS,EACR+tD,UAAU,EACT3tD,QAAQJ,SACR0lG,iBAAiBqE,cAGzB,EAAA;AAAA,MAAA,OAAU;AACJ,YAAG/pG,QAAO+tD,YAAa/tD,CAAAA,QAAO+tD,SAAS23C,iBAAgB;AACtD1lG,UAAAA,QAAO+tD,SAAS23C,kBAAkBqE;AAAAA,QAClC;AAAA,MACD;AACD/pG,MAAAA,QAAOoG,OAAO;AACd,UAAGpG,WAAUA,QAAO+tD,UAAS;AAC5B,YAAA,CAAI/tD,QAAO+tD,SAAS62C,gBAAiB5kG,CAAAA,QAAO+tD,SAASk3C,cAAa;AACjEjlG,UAAAA,QAAO+tD,SAASk3C,eAAeoF;AAAAA,QAC/B;AAAA,MACD;AACD,aAAOR,WAAW11E,SAASn0B,OAAAA;AAAAA,IAC3B,GAEDsqG,gBAAgB,WAAA;AACf,aAAOT,WAAW57C,UAClB;AAAA,IAAA,GACDs8C,iBAAiB,SAAS5oG,IAAAA;AACzBkoG,iBAAWjC,YAAYjmG,EAAAA;AAAAA,IACvB,GAED6zF,kBAAkB,WAAA;AACjBqU,iBAAW9nG,MAAAA;AAAAA,IACX,EAEF;AAAA,EAAA,EAAA;AAEH;ACnKA,IAAIyoG,OAAQ;AAGX,WAASA,MAAKhvG,QAAQwE,SAAQk9F,UAASz/F,QACtC;AAAA,QAAIjC,QAAQ;AACXd,WAAKqP,aAAa6rF,OAAkBp6F,MACpCd;AAAAA,WAAKunG,UAAUzmG;AAAAA,IACf;AAEDd,SAAKyQ,UAAU81C,MAAYjhD,SAAQ,EAClCyqG,cAAc;AAEf/vG,SAAKsgE,SAASv9D;AACd/C,SAAKgwG,aAAajtG,OAAMI,qBAExBnD;AAAAA,SAAKoR,MAAM9L,QAAO2B,MAAM,MAAMyiD;AAE9B1pD,SAAKiwG,QAAQ;AACbjwG,SAAKkwG,WAAW1N;AAEhB91F,kBAAU1M,IAEV;AAAA,EAAA;AAED8vG,EAAAA,MAAKn0G,UAAUsT,aAAa,WAAA;AAC3BjP,SAAKunG,UAAUvnG,KAAKqP,aAAarP,KAAKy8F,QAAQ;AAC9C,QAAIv3D,QAAQllC,KAAKsgE,OAAOz8D,UAAUC,WAAW;AAC7CohC,UAAMv/B,OAAO,SAAS,sBAAsB3F,KAAKmwG,mBAAAA;AACjDnwG,SAAKgwG,WAAWpqG,UAAAA;AAChB5F,SAAK+H,UAAU,aAAa,CAAA,CAAA;AAC5B/H,SAAKuI,gBACP;AAAA,EAAA;AACCunG,EAAAA,MAAKn0G,UAAUghC,OAAO,SAAU11B,IAC/B;AAAA,WAAO;AAAA,EACT;AAEC6oG,EAAAA,MAAKn0G,UAAU2Y,WAAW,SAASxc,MAAMD;AAGxC,QAAI8kC,OAAO38B,KAAKy8F;AAChB,QAAIz8F,KAAKyQ,QAAQ+M,KAAMmf,QAAO38B,KAAKy8F,MAAMl+F;AAEzC,QAAIzG,OAAK,KAAKA,MAAK;AAClB6kC,WAAKhkC,aAAab;AAAAA,IAClB;AACD,QAAGD,MAAI,KAAKA,KAAI;AACf8kC,WAAKnkC,YAAYX;AAAAA,IACjB;AAAA,EACH;AAECi4G,EAAAA,MAAKn0G,UAAU0L,QAAQ,WACtBrH;AAAAA,SAAK+sB,UAAU1uB,YAAY;AAC3B2B,SAAK+sB,QAAUhwB,EAAAA,YAAY;AAC3BiD,SAAK+sB,QAAAA,EAAU/yB,MAAMgqB,UAAU;AAAA,EACjC;AAEC8rF,EAAAA,MAAKn0G,UAAUi4C,SAAS,SAAUw8D,OAAAA;AACjC,QAAIpwG,KAAKunG,SAAS;AACjB,aAAOvnG,KAAKunG,QAAQ3zD,OAAOw8D,KAAAA;AAAAA,IAC3B;AAED,QAAGA,UAAU,OAAM;AAClBpwG,WAAKqwG,aAAa;AAAA,IAClB;AAED,QAAIC,UAAUtwG,KAAKqP;AACnB,QAAI7V,IAAI82G,QAAQv3G;AAChB,QAAIM,IAAIi3G,QAAQt3G;AAChB,QAAIu3G,UAAUvwG,KAAKwwG,QAAAA;AACnB,QAAIF,YAAYl4G,SAASD,MAAM;AAC9BqB,UAAIpB,SAASD,KAAKY;AAClBM,UAAIjB,SAASD,KAAKa;AAAAA,IAClB;AACD,QAAIQ,IAAI+2G,QAAQxyF,UAAU;AACzBvkB,UAAI+2G,QAAQxyF;AAAAA,IACZ;AACD,QAAIvkB,IAAI+2G,QAAQE,UAAU;AACzBj3G,UAAI+2G,QAAQE;AAAAA,IACZ;AACD,QAAIp3G,IAAIk3G,QAAQG,WAAW;AAC1Br3G,UAAIk3G,QAAQG;AAAAA,IACZ;AACD,QAAIr3G,IAAIk3G,QAAQn0B,WAAW;AAC1B/iF,UAAIk3G,QAAQn0B;AAAAA,IACZ;AACDp8E,SAAK2wG,QAAQn3G,GAAGH,CAEhB;AAAA,QAAA,CAAI2G,KAAKqwG,WAGTrwG;AAAAA,SAAKqwG,aAAa;AAAA,EACpB;AAECP,EAAAA,MAAKn0G,UAAUi6B,OAAO,WACrB51B;AAAAA,SAAK4wG,MAAM,IAAA;AACX5wG,SAAK4zC,OACP;AAAA,EAAA;AACCk8D,EAAAA,MAAKn0G,UAAUwiC,OAAO,SAAUiF;AAC/BpjC,SAAK4wG,MAAM,KACX;AAAA,QAAIxtE,SAASpjC,KAAKunG,SAAS;AAC1BvnG,WAAKunG,QAAQppE,KACb;AAAA,IAAA;AACDn+B,SAAK4zC,OACP;AAAA,EAAA;AACCk8D,EAAAA,MAAKn0G,UAAUi1G,QAAQ,SAAUr5E;AAChC,QAAIA,SAAS,QAAQv3B,KAAKy8F,MAAMlkG,YAAY;AAC3CyH,WAAKy8F,MAAMlkG,WAAWqE,YAAYoD,KAAKy8F,KAAAA;AAAAA,IACvC,WACQllE,SAAS,UAAUv3B,KAAKy8F,MAAMlkG,YAAY;AAClD,UAAIiO,QAAQxG,KAAKunG,QAAQsJ,UAAU7wG,KAAKoR,GACxCpR;AAAAA,WAAKunG,QAAQuJ,SAAS9wG,MAAMwG;IAC5B;AACDxG,SAAKyQ,QAAQ20F,SAAS7tE;AAAAA,EACxB;AACCu4E,EAAAA,MAAKn0G,UAAUo1G,UAAU,SAAU/xE,SAAStgC,KAAAA;AAC3C,QAAIsgC,YAAiB,QAAG;AAAEA,gBAAU;AAAA,IAAK;AACzCtgC,UAAM,CAAEA,OAAO,IAAMsB,KAAKyQ,QAAQ/R,OAAO,IAAKlD,KAAK,GAAA;AACnD,QAAIuD,MAAMiB,KAAKyQ;AACf,QAAIyP,SAAS;AACb,QAAInhB,IAAI+T,KAAK;AACZksB,gBAAiBjgC,OAAAA,IAAI+T,QAAQ,WAAW/T,IAAI+T,MAAM;AAAA,IAClD,OACI;AACJ,WAAKksB,SAAS;AACbA,kBAAU,wCAAsCtgC,MAAM,aAAWA,MAAI,OAAO,MAAI,QAAQK,IAAIye,QAAQ,MAAM;AAAA,MAC1G;AACD,UAAIze,IAAImhB,QAAQ;AACf,YAAI8wF,eAAejyG,IAAIkyG,cAAc,kDAAkD;AACvF/wF,iBAAS,sCAAsC8wF,eAAe,8CAA8CjyG,IAAImhB,SAAS;AAAA,MACzH;AAAA,IACD;AACD,WAAO,mCAAmCxhB,MAAM,qBAAqBsB,KAAKoR,MAAM,OAAO8O,SAAS8e,UAAU;AAAA,EAC5G;AACC8wE,EAAAA,MAAKn0G,UAAUu1G,QAAQ,SAAUt3G,MAAMkH,QACtCd;AAAAA,SAAKy8F,QAAQ7iG;AACboG,SAAKunG,UAAUzmG;AACfd,SAAKs9C,KACP;AAAA,EAAA;AACCwyD,EAAAA,MAAKn0G,UAAUoxB,UAAU,WACxB;AAAA,WAAQ/sB,KAAKy8F,MAAMx+F,cAAc,wBAAwB+B,KAAKy8F;AAAAA,EAChE;AACCqT,EAAAA,MAAKn0G,UAAU2hD,OAAO;AAGrB,QAAI2X,OAAOj1D;AAEXA,SAAKmwG,sBAAsB,SAASjxG;AACnC,UAAIiyG,SAASv/E,gBAA2B1yB,GAAG,cAC3C;AAAA,UAAGiyG,UAAUl8C,KAAK7jD,KAAI;AACrB6jD,aAAK3uC,OAAAA;AAAAA,MACL;AAAA,IACJ;AAEE,QAAI4e,QAAQllC,KAAKsgE,OAAOz8D,UAAUC,WAAW,aAC7CohC;AAAAA,UAAM6jE,SAAS,SAAS,sBAAsB/oG,KAAKmwG;AAEnDnwG,SAAK+H,UAAU,WAAW,CAAA,CAAA;AAAA,EAC5B;AACC+nG,EAAAA,MAAKn0G,UAAU2qB,SAAS,WAAA;AACvBtmB,SAAKyQ,QAAQ2gG,YAAAA,CAAapxG,KAAKyQ,QAAQ2gG;AACvCpxG,SAAK4zC,OAAAA;AAAAA,EACP;AACCk8D,EAAAA,MAAKn0G,UAAU60G,UAAU,WAAA;AACxB,QAAIa,OAAO,EACV33G,QAAQsG,KAAKyQ,QAAQ/W,UAAU,GAC/BD,OAAOuG,KAAKyQ,QAAQhX,SAAS,GAC7B63G,SAAStxG,KAAKyQ,QAAQ6gG,WAAW,GACjCZ,WAAW1wG,KAAKyQ,QAAQigG,aAAa,GACrC3yF,UAAU/d,KAAKyQ,QAAQsN,YAAY,GACnCq+D,WAAWp8E,KAAKyQ,QAAQ2rE,aAAa,MACrCq0B,UAAUzwG,KAAKyQ,QAAQggG,YAAY;AAEpC,QAAIzwG,KAAKyQ,QAAQ2gG,WAAW;AAC3B,UAAI75E,OAAOv3B,KAAKyQ,QAAQ8mB,SAAS;AACjC85E,WAAK95E,OAAO,UAAU,QAAA,IAAY85E,KAAK95E,OAAO,aAAa,WAAA,IAAev3B,KAAKyQ,QAAQs/F;AAAAA,IACvF;AACD,WAAOsB;AAAAA,EACT;AAECvB,EAAAA,MAAKn0G,UAAU41G,iBAAiB;AAE/B,QAAI93G,QAAQuG,KAAKwxG,UAAUC;AAC3B,QAAGh4G,UAAUA,QAAM,GAAE;AACpBA,cAAQuG,KAAKwxG,UAAU/3G;AAAAA,IACvB;AAED,QAAIC,SAASsG,KAAKwxG,UAAUE;AAC5B,QAAGh4G,WAAWA,SAAO,GAAE;AACtBA,eAASsG,KAAKwxG,UAAU93G;AAAAA,IACxB;AAED,WAAO,EACND,OACAC,OAAQA;AAAAA,EAEX;AAECo2G,EAAAA,MAAKn0G,UAAUg2G,kBAAkB,WAAA;AAChC,QAAIC,UAAU,EACb/5G,KAAK,GACLE,OAAO,GACPC,QAAQ,GACRF,MAAM,GACN+5G,YAAY,GACZC,UAAU,EAAA;AAEX,QAAG9xG,KAAK+xG,iBAAgB;AACvB,UAAG/xG,KAAK+xG,gBAAgB/xG,KAAKgyG,SAASl6G,IAAAA,GAAM;AAC3C85G,gBAAQ95G,OAAO;AACf85G,gBAAQC;AAAAA,MACR;AAED,UAAG7xG,KAAK+xG,gBAAgB/xG,KAAKgyG,SAASj6G,KAAAA,GAAO;AAC5C65G,gBAAQ75G,QAAQ;AAChB65G,gBAAQC;AAAAA,MACR;AAED,UAAG7xG,KAAK+xG,gBAAgB/xG,KAAKgyG,SAASn6G,GAAAA,GAAK;AAC1C+5G,gBAAQ/5G,MAAM;AACd+5G,gBAAQE;AAAAA,MACR;AAED,UAAG9xG,KAAK+xG,gBAAgB/xG,KAAKgyG,SAASh6G,MAAQ,GAAA;AAC7C45G,gBAAQ55G,SAAS;AACjB45G,gBAAQE;AAAAA,MACR;AAAA,IACD;AAED,WAAOF;AAAAA,EAET;AAEC9B,EAAAA,MAAKn0G,UAAUg1G,UAAU,SAAUn3G,GAAGH,GACrC2G;AAAAA,SAAKy8F,MAAMziG,MAAMP,QAAQD,IAAI;AAC7BwG,SAAKy8F,MAAMziG,MAAMN,SAASL,IAAI;AAE9B,QAAIu4G,UAAU5xG,KAAK2xG,gBACnB;AAAA,QAAID,WAAWr4G,IAAIu4G,QAAQE;AAC3B,QAAIL,WAAWj4G,IAAIo4G,QAAQC;AAE3B7xG,SAAKwxG,YAAY,EAAEh4G,GAAMH,GAAMo4G,UAAoBC,SACnD;AAAA,QAAI1xG,KAAKyQ,QAAQyP,QAAQ;AACxBlgB,WAAKiyG,YAAAA;AAAAA,IACR,OAAO;AACJjyG,WAAKkyG,aAAAA;AAAAA,IACL;AAAA,EACH;AAECpC,EAAAA,MAAKn0G,UAAUq2G,WAAW,EACzBl6G,MAAO,iCACPC,OAAQ,kCACRF,KAAM,gCACNG,QAAS;AAGV83G,EAAAA,MAAKn0G,UAAUw2G,cAAc,SAASzzG,KAAKgN;AAC1C,QAAIA,CAAAA,MAAM;AACTA,aAAO1L;AAAAA,IACP;AACD,QAAIpG,OAAO8R,KAAK+wF;AAEhB,aAAS3gG,KAAKkE,KAAKgyG,UAAS;AAC3BI,sBAA2Bx4G,MAAMoG,KAAKgyG,SAASl2G;IAC/C;AAED,QAAA,OAAU4C,OAAO,UAAS;AACzBA,YAAM,CAACA,GAAAA;AAAAA,IACP;AAED,QAAI2zG,UAAU,CAAA;AAEd,aAAQv2G,IAAI,GAAGA,IAAI4C,IAAI3C,QAAQD,KAAI;AAClCw2G,mBAAwB14G,MAAM8E,IAAI5C;AAClCu2G,cAAQ3zG,IAAI5C,MAAM;AAAA,IAClB;AAED4P,SAAKqmG,kBAAkBM;AAAAA,EACzB;AAGCvC,EAAAA,MAAKn0G,UAAUu2G,eAAe;AAC7B,QAAIlzE,UAAUh/B,KAAKy8F,MAAM79F,WAAW,CAAA;AACpC,QAAGogC,WAAWA,QAAQjiC,aAAa,wBAAuB;AACzDiiC,cAAQhlC,MAAMN,SAASsG,KAAKwxG,UAAUE,WAAW;AAAA,IACjD;AAAA,EACH;AAEC5B,EAAAA,MAAKn0G,UAAUs2G,cAAc,WAC5B;AAAA,QAAIZ,OAAOrxG,KAAKwxG;AAChBH,SAAKK,YAAY1xG,KAAKyQ,QAAQs/F;AAC9B,QAAI7vF,SAASlgB,KAAKy8F,MAAM79F,WAAW;AACnC,QAAIogC,UAAUh/B,KAAKy8F,MAAM79F,WAAW;AACpC,QAAI2zG,UAAUvyG,KAAKyQ,QAAQ8mB,SAAS;AACpC,QAAIv3B,KAAKyQ,QAAQ2gG,WAAW;AAC3BpyE,cAAQhlC,MAAMH,UAAU;AACxB,UAAI04G,SAAS;AACZryF,eAAOnjB,YAAY;AACnBmjB,eAAOlmB,MAAMP,QAAQ43G,KAAKh4G,IAAI;AAC9B,YAAIqH,IAAIpH,KAAKkS,MAAM6lG,KAAKh4G,IAAI,IAAIg4G,KAAK73G,IAAI,CACzC0mB;AAAAA,eAAOlmB,MAAMw4G,YAAY,6BAA6B9xG,IAAI,SAASA,IAAI;AACvEs+B,gBAAQhlC,MAAMH,UAAU;AAAA,MACxB,OACI;AACJqmB,eAAOnjB,YAAY;AAAA,MACnB;AAAA,IACD,OACI;AACJ,UAAIw1G,SAAS;AACZryF,eAAOnjB,YAAY;AAAA,MACnB,OACI;AACJmjB,eAAOnjB,YAAY;AAAA,MACnB;AACDmjB,aAAOlmB,MAAMP,QAAQ;AACrBymB,aAAOlmB,MAAMw4G,YAAY;AACzBxzE,cAAQhlC,MAAMH,UAAU;AACxBmlC,cAAQhlC,MAAMN,SAAS23G,KAAKK,WAAW;AAAA,IACvC;AACDxxF,WAAOlmB,MAAMN,SAASsG,KAAKyQ,QAAQs/F,eAAe;AAAA,EACpD;AACC,SAAOD;AACR;ACrUe,SAAA2C,UAAU/xG,GAAGxE;AAC3B,WAASg4B,KAAKh4B,EAAG,KAAIA,EAAEinC,eAAejP,CAAIxzB,EAAAA,GAAEwzB,KAAKh4B,EAAEg4B,CAAAA;AACnD,WAASw+E,KAAAA;AAAO1yG,SAAKm4B,cAAcz3B;AAAAA,EAAI;AACvCA,IAAE/E,YAAYO,MAAM,OAAO4kB,OAAOpP,OAAOxV,CAAMw2G,KAAAA,GAAG/2G,YAAYO,EAAEP,WAAW,IAAI+2G;AAChF;ACAA,IAAIC,SAAU,SAAUC,QAAAA;AAGvBH,YAAUE,SAAQC,MAAAA;AAClB,WAASD,QAAO7xG,QAAQwE,SAAQk9F;AAC/B,QAAIqQ,QAAQD,OAAO3yG,MAAMD,MAAM4G,SAAAA,KAAc5G;AAE7C,QAAGc,OACF+xG,OAAM9tG,QAAQ;AAEf8tG,UAAMC,aAAaxtG,OAAAA;AACnButG,UAAM5C,QAAQ;AACd,WAAO4C;AAAAA,EACP;AAEDF,EAAAA,QAAOh3G,UAAUsT,aAAa,WAC7B;AAAA,QAAIjP,KAAKqP,cAAcrP,KAAKy8F,OAAO;AAClCsW,iBAAsB/yG,KAAKy8F;IAC3B;AAED,aAAS3gG,IAAI,GAAGA,IAAIkE,KAAKgzG,OAAOj3G,QAAQD,KAAK;AAC5C,UAAIwC,QAAQ0B,KAAKgzG,OAAOl3G;AACxBwC,YAAM2Q,WAAAA;AAAAA,IACN;AACDjP,SAAKgzG,SAAS,CAEdJ;AAAAA,WAAOj3G,UAAUsT,WAAWpT,KAAKmE,IACnC;AAAA,EAAA;AAEC2yG,EAAAA,QAAOh3G,UAAUs3G,oBAAoB,SAAS10F,UAAU20F,YAAAA;AACvD,QAAIC,gBAAgB;AACpB,QAAIC,oBAAoB,CACvBC,GAAAA,mBAAmB,CAEpB;AAAA,UAAMC,mBAAmB,CAAA;AAEzB,aAASC,cAAcxX,YAAAA;AACtBA,MAAAA,WAAUwL,QAAQppE,KAClBg1E;AAAAA,sBAAgB;AAChBC,wBAAkBp0G,KAAK+8F;IACvB;AACD,aAASyX,cAAczX,YACtBA;AAAAA,MAAAA,WAAUwL,QAAQ3xE,KAAAA;AAClBu9E,sBAAgB;AAChBE,uBAAiBr0G,KAAK+8F,UAAAA;AAAAA,IACtB;AAED,QAAIA;AACJ,aAAQjgG,IAAI,GAAGA,IAAIo3G,WAAWn3G,QAAQD,KAAI;AACzCigG,kBAAYmX,WAAWp3G;AAEvB,UAAGyiB,SAASw9E,UAAUtrF,QAAQ8C,MAAAA,GAAS;AACtCigG,sBAAczX,SAClB;AAAA,MAAA,WAAYA,UAAU0X,WAAAA,GAAa;AAE/BH,yBAAiBt0G,KAAK+8F,SAAAA;AAAAA,MAC1B,WAAYA,UAAU2X,WAAa,GAAA;AAC/BH,sBAAcxX,SAAAA;AAAAA,MAClB,OAAQ;AACJ,YAAGA,UAAUpiG,UAAY,GAAA;AACxBy5G,4BAAkBp0G,KAAK+8F,SAAAA;AAAAA,QAC5B,OAAS;AACJsX,2BAAiBr0G,KAAK+8F;QACtB;AAAA,MACD;AAAA,IACD;AAED,QAAI4X,gBAAgB,CAAA;AACpB,aAAQ73G,IAAI,GAAGA,IAAIs3G,kBAAkBr3G,QAAQD,KAAI;AAChD,UAAGs3G,kBAAkBt3G,GAAG2U,QAAQmjG,OAAM;AACrCD,sBAAcP,kBAAkBt3G,CAAAA,EAAG2U,QAAQmjG,KAAS,IAAA;AAAA,MACpD;AAAA,IACD;AAGDN,qBAAiBnqG,QAAQ,SAAS4yF,YACjC;AAAA,UAAA,EAAKA,WAAUtrF,QAAQmjG,SAASD,cAAc5X,WAAUtrF,QAAQmjG,KAAAA,IAAQ;AACvEJ,sBAAczX,UAAAA;AAAAA,MACd;AAAA,IACJ,CAEE;AAAA,aAAQjgG,IAAI,GAAGA,IAAIu3G,iBAAiBt3G,QAAQD,KAAI;AAC/CigG,kBAAYsX,iBAAiBv3G;AAE7B,UAAGigG,UAAUtrF,QAAQmjG,SAASD,cAAc5X,UAAUtrF,QAAQmjG,KAAO,GAAA;AACpEL,sBAAcxX,SAEd;AAAA,iBAAQ58E,IAAI,GAAGA,IAAIi0F,kBAAkBr3G,QAAQojB,KAAI;AAChD,cAAGi0F,kBAAkBj0F,CAAM48E,KAAAA,WAAU;AACpC/7F,iBAAKsgE,OAAO25B,oBAAoB;AAChC;AAAA,UACA;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAED,WAAOkZ;AAAAA,EACT;AAECR,EAAAA,QAAOh3G,UAAU2gG,oBAAoB,WACpC;AAAA,UAAM4W,aAAalzG,KAAKoxE,eAAe,UAAA;AACvC,UAAMirB,iBAAiB,CAAA;AACvB6W,eAAW/pG,QAAQ4yF,eAAAA;AAClB,UAAIh9F,MAAM,CAAA;AACV,YAAA,EAAM80G,SAAQpkB,WAAW4hB,MAAMyC,YAAYnwG,SAAco4F,IAAAA,UAAUprF,eACnE;AAAA,UAAIojG,cAAchY,UAAUiY;AAC5B,UAAItX,aAAaqX,YAAYxqG,IAAImC,UAAQA,KAAK+E,QAAQxJ,EAEtDlI;AAAAA,UAAIkI,KAAK80F,UAAU3qF;AACnBrS,UAAI80G,UAAUA;AACd90G,UAAI29F,aAAaA;AACjB,UAAGjN,cAAc,KAAI;AACpB1wF,YAAIvF,IAAI63G;AACRtyG,YAAIk1G,UAAUH;AACd/0G,YAAI69F,QAAQj5F,YAAY;AAAA,MAC5B,OAAU;AACN5E,YAAI1F,IAAIg4G;AACRtyG,YAAIm1G,UAAUJ;AACd/0G,YAAIo1G,QAAQxwG,YAAY;AAAA,MACxB;AACD04F,qBAAer9F,KAAKD,GAAI;AAAA,IAAA,CAAA;AAEzB,WAAOs9F;AAAAA,EACT;AAECsW,EAAAA,QAAOh3G,UAAUy4G,iBAAiB,SAASC,WAAWC,SAAAA;AACrD,QAAID,CAAAA,UACH;AAED,QAAIE,SAAS,CAAA;AAEbv0G,SAAKw0G,WAAW,SAAS73E,MACxB;AAAA,UAAGA,KAAKlsB,QAAQmjG,SAASj3E,KAAKszE,SAAS,eAAetzE,KAAKszE,SAAS,WAAU;AAC7E,aAAIsE,OAAO53E,KAAKlsB,QAAQmjG,KAAO,GAAA;AAC9BW,iBAAO53E,KAAKlsB,QAAQmjG,KAAS,IAAA,CAAA;AAAA,QAC7B;AACDW,eAAO53E,KAAKlsB,QAAQmjG,KAAAA,EAAO50G,KAAK29B,IAChC;AAAA,MAAA;AAAA,IACJ;AAEE,QAAG43E,OAAOF,SAAW,GAAA;AACpBr0G,WAAKy0G,eAAeF,OAAOF,SAAYC,GAAAA,OAAAA;AAAAA,IACvC;AACD,WAAOC,OAAOF,SAAAA;AAAAA,EAChB;AAEC1B,EAAAA,QAAOh3G,UAAU84G,iBAAiB,SAAS3mF,OAAOwmF,SAAAA;AACjD,SAAIxmF,MAAM/xB,OAAQ;AAElB,QAAI0mE,WAAW30C,MAAM,CAAGy5E,EAAAA,QAAQmN,WAAW,UAAU;AACrD,QAAIjlB,YAAY3hE,MAAM,CAAA,EAAGy5E,QAAQ38C,eAAe98B,MAAM,GAAG1c,GAAO,IAAA,IAAA;AAEhE,QAAIujG,eAAeL,QAAQv7F;AAC3B,QAAI67F,YAAYN,QAAQM;AACxB,aAAQ94G,IAAI,GAAGA,IAAIgyB,MAAM/xB,QAAQD,KAAI;AACpC,UAAI+4G,UAAU/mF,MAAMhyB,CAAAA,EAAG00G,QAEvB;AAAA,UAAIsE,gBAAgBrlB,YAAY,IAAI3hE,MAAMhyB,CAAAA,EAAGyrG,QAAQ38C,eAAe98B,MAAMhyB,CAAGsV,EAAAA,GAAAA,IAAO0c,MAAMhyB,CAAGyrG,EAAAA,QAAQt2E,eAAenD,MAAMhyB,CAAAA,EAAGsV,GAC7H;AAAA,UAAG0jG,cAAc7E,SAAS,WAAU;AACnC6E,wBAAgBrlB,YAAY,IAAIqlB,cAAcvN,QAAQ38C,eAAekqD,cAAc1jG,GAAO0jG,IAAAA,cAAcvN,QAAQt2E,eAAe6jF,cAAc1jG,GAC7I;AAAA,MAAA;AACD,UAAI2jG,cAAcD,cAActE;AAEhC,UAAIoE,CAAAA,WAAW;AACd,YAAGE,cAAcryC,QAAAA,GAAU;AAC1B,cAAIuyC,eAAeH,QAAQvD,UAAUyD,YAAYzD;AACjD,cAAI2D,YAAYJ,QAAQpyC,QAAYsyC,IAAAA,YAAYtyC,QAChD;AAAA,cAAIke,IAAIq0B,eAAeC;AACvBnnF,gBAAMhyB,CAAG2U,EAAAA,QAAQ6gG,UAAU3wB,IAAIg0B;AAE/BG,wBAAcrkG,QAAQgyD,QAAYwyC,IAAAA,YAAYN;AAC9CG,wBAAcrkG,QAAQ6gG,UAAU0D,eAAer0B,IAAIg0B;AAAAA,QACxD,OAAS;AACJ7mF,gBAAMhyB,CAAG2U,EAAAA,QAAQgyD,QAAYkyC,IAAAA;AAAAA,QAC7B;AAAA,MACL,OAAQ;AACJ7mF,cAAMhyB,CAAG2U,EAAAA,QAAQ6gG,UAAUqD;AAAAA,MAC3B;AAED,UAAIO,WAAWl1G,KAAKsgE,OAAOnxD,IAAIC,QAAQ,MAAA;AACvC,UAAG8lG,YAAYpnF,MAAMhyB,CAAAA,EAAGu1E,aAAa6jC,YAAaA,CAAAA,SAASzkG,QAAQ6f,cAAAA,CAAeskF,WAAU;AAC3F50G,aAAKsgE,OAAOh7D,OAAO6vG,aAAaR;AAAAA,MAChC;AAAA,IACD;AAAA,EACH;AAEChC,EAAAA,QAAOh3G,UAAUi4C,SAAS,SAASwhE,YAAAA;AAClC,QAAIC,WAAW;AACf,QAAGr1G,KAAK+E,SAAAA,CAAU/E,KAAKs1G,mBAAkB;AACxCt1G,WAAK+H,UAAU,kBAAkB,CAAA,CAAA;AACjCstG,iBAAW;AACXr1G,WAAKs1G,oBAAoB;AAAA,IACzB;AAED1C,WAAOj3G,UAAUi4C,OAAO/3C,KAAKmE,MAAM,IACnC4yG;AAAAA,WAAOj3G,UAAUi4C,OAAO/3C,KAAKmE,MAAM,KAAA;AAEnC,QAAGq1G,UAAS;AAEX,UAAIE,eAAe,CACnBA;AAAAA,qBAAeA,aAAartG,OAAOlI,KAAKoxE,eAAe,UAAA,CAAA;AACvDmkC,qBAAeA,aAAartG,OAAOlI,KAAKoxE,eAAe,YAAA,CAAA;AACvDmkC,qBAAeA,aAAartG,OAAOlI,KAAKoxE,eAAe,UAEvD,CAAA;AAAA,UAAI8hC,aAAalzG,KAAKoxE,eAAe;AAErC,eAAQt1E,IAAI,GAAGA,IAAIy5G,aAAax5G,QAAQD,KAAI;AAC3C,aAAIy5G,aAAaz5G,CAAAA,EAAG2U,QAAQ20F,OAC3BmQ,cAAaz5G,CAAG05G,EAAAA,eAAAA;AAAAA,MACjB;AAED,UAAIj3F,WAAWve,KAAKy1G,iBAAiBz1G,KAAKyQ,QAAQ8N,QAsBlD;AAAA,UAAI40F,gBAAgBnzG,KAAKizG,kBAAkB10F,UAAU20F,UAAAA;AAErD,UAAGlzG,KAAKyQ,QAAQ8N,UAAS;AACxBve,aAAKue,SAASve,KAAKyQ,QAAQ8N,QAC3Bg3F;AAAAA,qBAAapsG,QAAQ,SAASuC,MAC7B;AAAA,gBAAM5K,SAAS4K,KAAK67F;AACpB,gBAAM5wC,QAAQ71D,OAAOywG,eAAehzF,QACpC;AAAA,cAAGA,SAAS/kB,GAAE;AACb,gBAAA,CAAIsH,OAAO2P,QAAQilG,sBAAqB;AACvC50G,qBAAO2P,QAAQilG,uBAAuB;AACtC50G,qBAAO2P,QAAQklG,iBAAiB70G,OAAO2P,QAAQhX;AAAAA,YAC/C;AACDqH,mBAAO2P,QAAQhX,QAAQk9D,MAAMl9D;AAAAA,UAC7B;AACD,cAAG8kB,SAASllB,GAAE;AACb,gBAAIyH,CAAAA,OAAO2P,QAAQmlG,uBAAsB;AACxC90G,qBAAO2P,QAAQmlG,wBAAwB;AACvC90G,qBAAO2P,QAAQolG,kBAAkB/0G,OAAO2P,QAAQ/W;AAAAA,YAChD;AACDoH,mBAAO2P,QAAQ/W,SAASi9D,MAAMj9D;AAAAA,UAC9B;AAAA,QACN;AACIy5G,wBAAgB;AAAA,MAChB;AAED,UAAGA,eAAc;AAChBnzG,aAAK4zC,OACL;AAAA,iBAAQ93C,IAAI,GAAGA,IAAIy5G,aAAax5G,QAAQD,KAAI;AAC3C,cAAIy5G,CAAAA,aAAaz5G,GAAG2U,QAAQ20F,OAC3BmQ,cAAaz5G,CAAAA,EAAG05G,eACjB;AAAA,QAAA;AAAA,MACD;AAEDx1G,WAAK+H,UAAU,YAAY,CAAA,CAAA;AAAA,IAC3B;AACD,QAAGstG,UAAS;AACXr1G,WAAKs1G,oBAAoB;AAAA,IACzB;AAAA,EACH;AAEC3C,EAAAA,QAAOh3G,UAAU64G,aAAa,SAAS75F,MAAMgiB,MAAAA;AAC5CA,WAAOA,QAAQ38B;AACf2a,SAAKgiB,IACL;AAAA,QAAGA,KAAKq2E,QAAO;AACd,eAAQl3G,IAAI,GAAGA,IAAI6gC,KAAKq2E,OAAOj3G,QAAQD,KAAI;AAC1CkE,aAAKw0G,WAAW75F,MAAMgiB,KAAKq2E,OAAOl3G,CAClC,CAAA;AAAA,MAAA;AAAA,IACD;AAAA,EACH;AAEC62G,EAAAA,QAAOh3G,UAAUm6G,UAAU,SAASpqG,MAAAA;AACnC,QAAI6W,MAAM;AACVviB,SAAKw0G,WAAW,SAASl2G,OAAAA;AACxB,UAAGA,UAAUoN,QAAQpN,MAAM+yE,aAAa3lE,MAAK;AAC5C6W,cAAM;AAAA,MACN;AAAA,IACJ,CAAA;AACE,WAAOA;AAAAA,EACT;AAECowF,EAAAA,QAAOh3G,UAAUy1E,iBAAiB,SAASn/D,MAC1C;AAAA,QAAIsQ,MAAM,CACV;AAAA,QAAGtQ,SAASjS,KAAKiwG,OAAM;AACtB1tF,UAAIvjB,KAAKgB,IAAAA;AAAAA,IACT;AAED,QAAGA,KAAKqxE,YAAYrxE,KAAKqxE,SAAS4+B,SAASh+F,MAAK;AAC/CsQ,UAAIvjB,KAAKgB,KAAKqxE,QAAAA;AAAAA,IACd;AAED,QAAGrxE,KAAKgzG,QAAO;AACd,eAAQl3G,IAAI,GAAGA,IAAIkE,KAAKgzG,OAAOj3G,QAAQD,KAAI;AAC1C,YAAIstC,WAAWupE,QAAOh3G,UAAUy1E,eAAev1E,KAAKmE,KAAKgzG,OAAOl3G,CAAAA,GAAImW;AACpE,YAAGm3B,SAASrtC,QAAO;AAClBwmB,cAAIvjB,KAAKiB,MAAMsiB,KAAK6mB,QACpB;AAAA,QAAA;AAAA,MACD;AAAA,IACD;AACD,WAAO7mB;AAAAA,EACT;AAECowF,EAAAA,QAAOh3G,UAAUivD,iBAAiB,SAASumD,QAC1C;AAAA,QAAI3qG,QAAQxG,KAAK6wG,UAAUM,MAAAA;AAC3B,QAAG3qG,SAAS,KAAKxG,KAAKgzG,OAAOxsG,QAAQ,CAAA,GAAG;AACvC,aAAOxG,KAAKgzG,OAAOxsG,QAAQ,CAC9B;AAAA,IAAA,OAAO;AACJ,aAAO;AAAA,IACP;AAAA,EACH;AAECmsG,EAAAA,QAAOh3G,UAAUs1B,iBAAiB,SAASkgF,QAC1C;AAAA,QAAI3qG,QAAQxG,KAAK6wG,UAAUM,MAC3B;AAAA,QAAG3qG,SAAS,KAAKxG,KAAKgzG,OAAOxsG,QAAQ,CAAG,GAAA;AACvC,aAAOxG,KAAKgzG,OAAOxsG,QAAQ;IAC9B,OAAO;AACJ,aAAO;AAAA,IACP;AAAA,EACH;AAGCmsG,EAAAA,QAAOh3G,UAAUghC,OAAO,SAAU11B,IACjC;AAAA,aAASnL,IAAI,GAAGA,IAAIkE,KAAKgzG,OAAOj3G,QAAQD,KAAK;AAC5C,UAAIwC,QAAQ0B,KAAKgzG,OAAOl3G,CAAAA;AACxB,UAAIwC,MAAM8S,QAAQnK,IAAI;AACrB,eAAO3I;AAAAA,MACP;AACD,UAAIy3G,MAAMz3G,MAAMq+B,KAAK11B,EAAAA;AACrB,UAAI8uG,KAAK;AACR,eAAOA;AAAAA,MACP;AAAA,IACD;AAAA,EACH;AACCpD,EAAAA,QAAOh3G,UAAUk1G,YAAY,SAAU5pG,IAAAA;AACtC,aAASnL,IAAI,GAAGA,IAAIkE,KAAKgzG,OAAOj3G,QAAQD,KAAK;AAC5C,UAAIkE,KAAKgzG,OAAOl3G,GAAGsV,QAAQnK,IAAI;AAC9B,eAAOnL;AAAAA,MACP;AAAA,IACD;AACD,WAAQ;AAAA,EACV;AACC62G,EAAAA,QAAOh3G,UAAUm1G,WAAW,SAAUplG,MAAMpL,KAAAA;AAC3C,QAAIN,KAAKgzG,OAAO1yG,SAASoL,MAAM;AAC9B,aAAOjT,OAAOwtG,MAAM,iBAAA;AAAA,IACpB,OACI;AACJ3lG,aAAON,KAAKyQ,QAAQyP,SAAS,IAAI;AACjC,UAAItmB,OAAOoG,KAAKy8F;AAChB,UAAIn8F,OAAO1G,KAAKgF,WAAW7C,QAAQ;AAClCnC,aAAK8C,YAAYgP,KAAK+wF,KAAAA;AAAAA,MACtB,OACI;AACJ7iG,aAAK6qG,aAAa/4F,KAAK+wF,OAAO7iG,KAAKgF,WAAW0B,GAAAA,CAAAA;AAAAA,MAC9C;AAAA,IACD;AAAA,EACH;AACCqyG,EAAAA,QAAOh3G,UAAUm3G,eAAe,SAAUxtG,SACzCtF;AAAAA,SAAKgzG,SAAS,CACdhzG;AAAAA,SAAK00G,YAAYpvG,QAAOosC;AACxB,QAAI5jB,QAAQxoB,QAAOosC,QAAQpsC,QAAO0a,QAAQ1a,QAAO4hG;AACjD,aAASprG,IAAI,GAAGA,IAAIgyB,MAAM/xB,QAAQD,KAAK;AACtC,UAAI6gC,OAAO7O,MAAMhyB;AACjB6gC,WAAKpF,OAAOv3B,KAAK00G,WAAW,MAAM;AAClC,UAAIrjC,WAAWrxE,KAAKkwG,SAASzI,OAAO9qE,MAAM38B;AAC1C,UAAIqxE,CAAAA,UAAS;AACZvjD,cAAMzxB,OAAOP,GAAG;AAChBA;AAAAA,MACJ,OAAQ;AACJu1E,iBAASk2B,UAAUvnG;AACnBA,aAAKgzG,OAAOh0G,KAAKqyE;MACjB;AAAA,IACD;AAAA,EACH;AACCshC,EAAAA,QAAOh3G,UAAUq6G,WAAW,WAAA;AAC3B,WAAOh2G,KAAKgzG;AAAAA,EACd;AACCL,EAAAA,QAAOh3G,UAAU+J,SAAS,WACzB;AAAA,QAAIgG,OAAOuqG,WAAsBj2G,KAAKqP,YAAYrP,KAAK+wG,QACvD/wG,CAAAA;AAAAA,SAAKkxG,MAAMxlG,MAAM,IAAA;AACjB1L,SAAK+H,UAAU,WAAW;AAC1B/H,SAAK4zC,OAAAA;AAGL5zC,SAAK0F,SAAS1F,KAAK4zC;AAAAA,EACrB;AACC++D,EAAAA,QAAOh3G,UAAUu1G,QAAQ,SAAUt3G,MAAMkH,QAAAA;AACxCd,SAAKy8F,QAAQ7iG;AACboG,SAAKunG,UAAUzmG;AACf,QAAIgtB,QAAQooF,cAAyBt8G,MAAM;AAC3C,aAASkC,IAAIgyB,MAAM/xB,SAAS,GAAGD,KAAK,GAAGA,KAAK;AAC3C,UAAIi6G,MAAM/1G,KAAKgzG,OAAOl3G,CAAAA;AACtBi6G,UAAI7E,MAAMpjF,MAAMhyB,CAAIkE,GAAAA,IAAAA;AAEpB,UAAI+1G,IAAItlG,QAAQ20F,QAAQ;AACvB2Q,YAAItZ,MAAMlkG,WAAWqE,YAAYm5G,IAAItZ,KAAAA;AAAAA,MACrC;AAAA,IACD;AAAA,EACH;AACCkW,EAAAA,QAAOh3G,UAAUo1G,UAAU,WAAA;AAC1B,QAAIx5E,OAAOv3B,KAAK00G,WAAW,MAAM;AACjC,QAAIl3F,OAAO,CAAA;AACX,aAAS1hB,IAAI,GAAGA,IAAIkE,KAAKgzG,OAAOj3G,QAAQD,KAAK;AAC5C0hB,WAAKxe,KAAKgB,KAAKgzG,OAAOl3G,CAAAA,EAAGi1G;IACzB;AACD,WAAO6B,OAAOj3G,UAAUo1G,QAAQl1G,KAAKmE,MAAMwd,KAAKhiB,KAAK,EAAMwE,IAAAA,KAAK+E,QAAQ,uBAAuB,MAAM,+BAA+BwyB,IAAAA;AAAAA,EACtI;AAECo7E,EAAAA,QAAOh3G,UAAU41G,iBAAiB,SAASh6E,MAAAA;AAC1C,QAAI4+E,eAAe,GAClBC,gBAAgB;AAEjB,QAAI9+C,UAAU36B,MAAMi1E;AACpB,aAAS91G,IAAI,GAAGA,IAAIkE,KAAKgzG,OAAOj3G,QAAQD,KAAK;AAC5C6gC,aAAO38B,KAAKgzG,OAAOl3G,CACnB;AAAA,UAAG6gC,KAAKlsB,QAAQ20F,OACf;AAED9tC,iBAAW36B,KAAK40E,eAAeh6E;AAE/B,UAAGoF,KAAKlsB,QAAQ/E,SAAS,eAAe6rB,KAAKoF,KAAKlsB,QAAQ8C,MAAQ,GAAA;AACjE+jD,iBAAS59D,SAAS;AAClB49D,iBAAS79D,QAAQ;AAAA,MACjB;AAED,UAAGkjC,KAAKlsB,QAAQkhC,SAAQ;AACvB,YAAG3xC,KAAK00G,UAAS;AAChBp9C,mBAAS59D,SAAS;AAAA,QACvB,OAAS;AACJ49D,mBAAS79D,QAAQ;AAAA,QACjB;AAAA,MACD;AAEDm4G,gBAAUj1E,KAAKg1E,gBAAAA;AAEf,UAAG3xG,KAAK00G,UAAS;AAChByB,wBAAiB7+C,SAAS79D,QAAQm4G,QAAQC;AAC1CuE,wBAAgB98G,KAAKuD,IAAIu5G,eAAgB9+C,SAAS59D,SAASk4G,QAAQE,QACvE;AAAA,MAAA,OAAQ;AACJqE,uBAAe78G,KAAKuD,IAAIs5G,cAAc7+C,SAAS79D,QAAQm4G,QAAQC,UAAAA;AAC/DuE,yBAAiB9+C,SAAS59D,SAASk4G,QAAQE;AAAAA,MAC3C;AAAA,IACD;AAEDF,cAAU5xG,KAAK2xG,gBACfwE;AAAAA,oBAAgBvE,QAAQC;AACxBuE,qBAAiBxE,QAAQE;AAUzB,WAAO,EACNr4G,OAAO08G,cACPz8G,QAAQ08G,cAEX;AAAA,EAAA;AAECzD,EAAAA,QAAOh3G,UAAU06G,eAAe,SAASt9F;AACxC,YAASA,SAAS,IAAI2C,SAAWje,EAAAA,QAAQ,MAAM,EAAM,IAAA,KAAK;AAAA,EAC5D;AACCk1G,EAAAA,QAAOh3G,UAAU26G,gBAAgB,SAAS/5G,KAAAA;AACzC,QAAIg6G,WAAW;AACf,QAAG99G,OAAOsB,kBAAiB;AAC1Bw8G,iBAAW99G,OAAOsB,iBAAiBwC,KAAK,IAC3C;AAAA,IAAA,OAAO;AAEJg6G,iBAAW,EACV98G,OAAQ8C,IAAII,aACZjD,QAAS6C,IAAIi6G,aAEd;AAAA,IAAA;AACD,QAAIC,aAAa,CAChB,SACA,UAEA,cACA,iBACA,eACA,gBAEA,mBACA,oBACA,kBACA,mBAED;AAAA,QAAIx3F,SAAS,EACZy3F,WAAWH,SAASG,aAAa,aAAA;AAGlC,QAAGH,SAASI,cAAa;AACxB13F,aAAOy3F,YAAaH,SAASI,gBAAgB;AAAA,IAC7C;AACD,aAAQ76G,IAAG,GAAGA,IAAI26G,WAAW16G,QAAQD,KAAI;AACxCmjB,aAAOw3F,WAAW36G,CAAMy6G,CAAAA,IAAAA,SAASE,WAAW36G,CAAMkE,CAAAA,IAAAA,KAAKq2G,aAAaE,SAASE,WAAW36G,CAAO,CAAA,CAAA,IAAA;AAAA,IAC/F;AAGD,QAAI5D,MAAM,EACT0+G,aAAe33F,OAAOmF,cAAcnF,OAAOiF,eAAejF,OAAO43F,kBAAkB53F,OAAO63F,kBAC1FC,cAAgB93F,OAAOgF,aAAahF,OAAOkF,gBAAgBlF,OAAO+3F,iBAAiB/3F,OAAOg4F,mBAC1FC,WAAWj4F,OAAOy3F,WAClBrR,YAAapmF,OAAOxlB,OACpB6rG,aAAcrmF,OAAOvlB,QACrBy9G,YAAal4F,OAAOxlB,OACpB29G,aAAcn4F,OAAOvlB,OAItB;AAAA,QAAGxB,IAAIg/G,WAAU;AAChBh/G,UAAImtG,cAAcntG,IAAI0+G;AACtB1+G,UAAIotG,eAAeptG,IAAI6+G;AAAAA,IAC1B,OAAO;AACJ7+G,UAAIi/G,cAAcj/G,IAAI0+G;AACtB1+G,UAAIk/G,eAAel/G,IAAI6+G;AAAAA,IACvB;AAED,WAAO7+G;AAAAA,EACT;AAECy6G,EAAAA,QAAOh3G,UAAU85G,mBAAmB,SAASnwG,SAC5C;AAAA,QAAIid,MAAM,EAAC/oB,GAAE,OAAOH,GAAE,MAAA;AACtB,QAAGiM,YAAW,MAAK;AAClBid,UAAI/oB,IAAI+oB,IAAIlpB,IAAI;AAAA,IAChB,WAAQiM,YAAW,OAAOA,YAAW,MAAK;AAC1Cid,UAAIlpB,IAAI;AAAA,IACX,WAAWiM,YAAW,KAAI;AACvBid,UAAI/oB,IAAI;AAAA,IACR;AACD,WAAO+oB;AAAAA,EACT;AAECowF,EAAAA,QAAOh3G,UAAU4iB,WAAW,SAASgZ,MACpC;AAAA,QAAIhV,MAAMviB,KAAKy1G,iBAAiBl+E,IAAAA;AAChC,QAAI8/E,WAAWr3G,KAAKs2G,cAAct2G,KAAKqP,UACvC;AAAA,QAAIioG,eAAet3G,KAAKuxG,eAAeh6E;AAEvC,QAAI39B,OAAOoG,KAAKqP;AAChB,QAAGkT,IAAI/oB,GAAE;AACR,UAAG69G,SAASH,WAAU;AACrBI,qBAAa79G,SAAS49G,SAAST;AAAAA,MAC/B;AACDh9G,WAAKI,MAAMP,QAAQ69G,aAAa79G,QAAQ;AAAA,IACxC;AACD,QAAG8oB,IAAIlpB,GAAE;AACR,UAAGg+G,SAASH,WAAU;AACrBI,qBAAa59G,UAAU29G,SAASN;AAAAA,MAChC;AACDn9G,WAAKI,MAAMN,SAAS49G,aAAa59G,SAAS;AAAA,IAC1C;AAAA,EACH;AAECi5G,EAAAA,QAAOh3G,UAAU60G,UAAU,WAAA;AAC1BxwG,SAAKu3G,SAAS,CAAA;AACd,QAAI99G,QAAQ;AACZ,QAAIskB,WAAW;AACf,QAAI0yF,WAAW;AACf,QAAI/2G,SAAS;AACb,QAAI0iF,YAAY;AAChB,QAAIs0B,YAAY;AAEhB,aAAS50G,IAAI,GAAGA,IAAIkE,KAAKgzG,OAAOj3G,QAAQD,KAAK;AAE5C,UAAIu1G,OAAOrxG,KAAKu3G,OAAOz7G,CAAAA,IAAKkE,KAAKgzG,OAAOl3G,CAAG00G,EAAAA,QAAAA;AAC3C,UAAIxwG,KAAKgzG,OAAOl3G,CAAG2U,EAAAA,QAAQ20F,QAAQ;AAClC;AAAA,MACA;AACD,UAAIplG,KAAK00G,UAAU;AAClB,YAAA,CAAKrD,KAAK53G,SAAS43G,KAAKtzF,UAAU;AACjCtkB,mBAAS43G,KAAKtzF;AAAAA,QACd,OACI;AACJtkB,mBAAS43G,KAAK53G;AAAAA,QACd;AACDg3G,oBAAYY,KAAKZ;AACjB1yF,oBAAYszF,KAAKtzF;AACjBrkB,iBAASJ,KAAKuD,IAAInD,QAAQ23G,KAAK33G,MAAAA;AAC/B0iF,oBAAY9iF,KAAKyS,IAAIqwE,WAAWi1B,KAAKj1B,SAAAA;AACrCs0B,oBAAYp3G,KAAKuD,IAAI6zG,WAAWW,KAAKX,SACrC;AAAA,MAAA,OACI;AACJ,YAAKW,CAAAA,KAAK33G,UAAU23G,KAAKX,WAAW;AACnCh3G,oBAAU23G,KAAKX;AAAAA,QACf,OACI;AACJh3G,oBAAU23G,KAAK33G;AAAAA,QACf;AACD0iF,qBAAai1B,KAAKj1B;AAClBs0B,qBAAaW,KAAKX;AAClBj3G,gBAAQH,KAAKuD,IAAIpD,OAAO43G,KAAK53G;AAC7Bg3G,mBAAWn3G,KAAKyS,IAAI0kG,UAAUY,KAAKZ,QAAAA;AACnC1yF,mBAAWzkB,KAAKuD,IAAIkhB,UAAUszF,KAAKtzF,QACnC;AAAA,MAAA;AAAA,IACD;AACD,QAAIk3C,OAAO29C,OAAOj3G,UAAU60G,QAAQ30G,KAAKmE,IAEzC;AAAA,QAAIi1D,KAAKw7C,YAAY,KAAQ;AAC5Bx7C,WAAKw7C,WAAWA;AAAAA,IAChB;AAED,QAAIx7C,KAAKmnB,aAAa,KAAQ;AAC7BnnB,WAAKmnB,YAAYA;AAAAA,IACjB;AAEDnnB,SAAKl3C,WAAWk3C,KAAKl3C,aAAak3C,KAAKl3C,WAAW,IAAIk3C,KAAKl3C;AAE3Dk3C,SAAKy7C,YAAYz7C,KAAKy7C,cAAcz7C,KAAKy7C,YAAY,IAAIz7C,KAAKy7C;AAE9D,QAAI1wG,KAAK00G,UAAU;AAClBz/C,WAAKl3C,YAAY/d,KAAKyQ,QAAQ+mG,SAAUx3G,KAAKgzG,OAAa,UAAK;AAC/D/9C,WAAKl3C,YAAY/d,KAAKyQ,QAAQuT,UAAU,KAAK;AAC7CixC,WAAKy7C,aAAc1wG,KAAKyQ,QAAQuT,UAAU,KAAM;AAAA,IAChD,OACI;AACJixC,WAAKy7C,aAAa1wG,KAAKyQ,QAAQ+mG,SAAUx3G,KAAKgzG,OAAa,UAAK;AAChE/9C,WAAKy7C,aAAc1wG,KAAKyQ,QAAQuT,UAAU,KAAM;AAAA,IAChD;AAED,WAAOixC;AAAAA,EACT;AAEC09C,EAAAA,QAAOh3G,UAAU87G,iBAAiB,SAAUl6D,GAAG5gB,MAAM41E;AACpD,QAAIxmG,MAAMwmG,UAAU51E,KAAK5e,WAAW4e,KAAK+zE;AACzC,QAAI7zG,MAAM01G,UAAU51E,KAAK8zE,WAAW9zE,KAAK8zE;AACzC,QAAIiH,OAAOn6D;AACX,QAAKm6D,CAAAA,MAAM;AACVA,aAAOp+G,KAAKkS,MAAMxL,KAAK23G,QAAQ33G,KAAK43G,WAAWj7E,KAAK20E,OAAAA;AACpD,UAAIoG,OAAO76G,KAAK;AACf66G,eAAO76G;AACPmD,aAAK23G,SAASD;AACd13G,aAAK43G,YAAYj7E,KAAK20E;AAAAA,MACtB;AACD,UAAIoG,OAAO3rG,KAAK;AACf2rG,eAAO3rG;AACP/L,aAAK23G,SAASD;AACd13G,aAAK43G,YAAYj7E,KAAK20E;AAAAA,MACtB;AAAA,IACD,OACI;AACJ,UAAIoG,OAAO76G,KAAK;AACf66G,eAAO76G;AAAAA,MACP;AACD,UAAI66G,OAAO3rG,KAAK;AACf2rG,eAAO3rG;AAAAA,MACP;AACD/L,WAAK23G,SAASD;AAAAA,IACd;AACD,WAAOA;AAAAA,EACT;AACC/E,EAAAA,QAAOh3G,UAAUk8G,YAAY,SAAUt6D,GAAG8zD,MAAMkB;AAC/C,QAAImF,OAAOn6D;AACX,QAAIxxC,MAAMwmG,UAAUlB,KAAKtzF,WAAWszF,KAAKX;AACzC,QAAI7zG,MAAM01G,UAAUlB,KAAKZ,WAAWY,KAAKj1B;AACzC,QAAKs7B,CAAAA,MAAM;AACVA,aAAOp+G,KAAKkS,MAAMxL,KAAK23G,QAAQ33G,KAAK43G,WAAWvG,KAAKC,OAAAA;AAAAA,IACpD;AACD,QAAIoG,OAAO76G,KAAK;AACf66G,aAAO76G;AAAAA,IACP;AACD,QAAI66G,OAAO3rG,KAAK;AACf2rG,aAAO3rG;AAAAA,IACP;AACD,WAAO2rG;AAAAA,EACT;AAEC/E,EAAAA,QAAOh3G,UAAUm8G,oBAAoB,WAAA;AACpC,QAAG93G,KAAK+E,OAAM;AACb/E,WAAKmyG,YAAY,CAChBnyG,KAAKgyG,SAASl6G,MACdkI,KAAKgyG,SAASn6G,KACdmI,KAAKgyG,SAASj6G,OACdiI,KAAKgyG,SAASh6G,SAEfgI,IACA;AAAA,IAAA;AAED,QAAI+3G,cAAc/3G,KAAK00G,WAAW10G,KAAKgyG,SAASj6G,QAAQiI,KAAKgyG,SAASh6G;AAEtE,QAAI81B,QAAQ9tB,KAAKgzG;AAEjB,QAAIgF,mBAAmBlqF,MAAM/xB,SAAS;AACtC,aAAQD,IAAIk8G,kBAAkBl8G,KAAK,GAAGA,KAAI;AACzC,WAAKgyB,MAAMhyB,CAAAA,EAAG2U,QAAQ20F,QAAQ;AAC7B4S,2BAAmBl8G;AACnB;AAAA,MACA;AAAA,IACD;AAED,aAASA,IAAI,GAAGA,IAAIgyB,MAAM/xB,QAAQD,KAAK;AACtC,UAAIgyB,MAAMhyB,CAAAA,EAAG2U,QAAQ20F,QAAQ;AAC5B;AAAA,MACA;AAED,UAAI6S,WAAWn8G,KAAKk8G;AACpB,UAAIE,mBAAmB;AACvB,UAAA,CAAID,YAAYnqF,MAAMhyB,IAAI,IAAG;AAC5B,YAAGgyB,MAAMhyB,IAAI,CAAG2U,EAAAA,QAAQ/E,QAAQ,aAAY;AAC3C,cAAG1L,KAAK00G,UAAS;AAChBuD,uBAAW;AAAA,UACjB,OAAU;AACJC,+BAAmB;AAAA,UACnB;AAAA,QAED;AAAA,MACD;AAGDl4G,WAAKmyG,YAAY8F,WAAW,CAAA,IAAK,CAACF,aAAaG,gBAAAA,GAAmBpqF,MAAMhyB,CAAAA,CAAAA;AAAAA,IACxE;AAAA,EACH;AAEC62G,EAAAA,QAAOh3G,UAAUw8G,wBAAwB;AACxC,QAAIC,kBAAkBp4G,KAAKq4G,iBAAiB;AAC5C,QAAIC,YAAat4G,CAAAA,KAAKq4G;AACtB,QAAIE,eAAe,CAAA;AACnB,QAAI57E,OAAO;AACX,QAAI67E,mBAAmB,CAAA;AACvB,aAAS18G,IAAI,GAAGA,IAAIkE,KAAKu3G,OAAOx7G,QAAQD,KAAK;AAC5C6gC,aAAO38B,KAAKgzG,OAAOl3G,CAAAA;AACnB,UAAI6gC,KAAKlsB,QAAQgoG,YAAW;AAC3BD,yBAAiBx5G,KAAK29B,IAAAA;AAAAA,MACtB;AAED,UAAK27E,CAAAA,aAAa37E,KAAKlsB,QAAQ20F,UAAUgT,gBAAgBz7E,KAAKvrB,GAAM,GAAA;AACnEurB,aAAKi0E,MAAM,IACf;AAAA,MAAA,YAAaj0E,KAAKlsB,QAAQ20F,UAAWgT,CAAAA,gBAAgBz7E,KAAKvrB,GAAAA,GAAK;AAC3DurB,aAAKi0E,MAAM;MACX;AAED,UAAA,CAAIj0E,KAAKlsB,QAAQ20F,QAAO;AACvBmT,qBAAa57E,KAAKvrB,GAAAA,IAAO;AAAA,MACzB;AAAA,IACD;AACDpR,SAAKq4G,gBAAgBE;AAGrB,aAASz8G,IAAI,GAAGA,IAAI08G,iBAAiBz8G,QAAQD,KAAK;AACjD,UAAI6gC,OAAO67E,iBAAiB18G,CAC5B;AAAA,UAAIstC,WAAWzM,KAAKq2E;AACpB,UAAI0F,WAAW;AACftvE,eAASjgC,QAAQ,SAAS7K,OAAAA;AACzB,aAAKA,MAAMmS,QAAQ20F,WAAW9mG,MAAMmS,QAAQkhC,SAAQ;AACnD+mE,qBAAW;AAAA,QACX;AAAA,MACL,CAEG/7E;AAAAA,WAAKlsB,QAAQ20F,SAASsT;AAAAA,IACtB;AAAA,EACH;AAEC/F,EAAAA,QAAOh3G,UAAUg1G,UAAU,SAAUn3G,GAAGH;AACvC2G,SAAK83G,kBAAAA;AACLlF,WAAOj3G,UAAUg1G,QAAQ90G,KAAKmE,MAAMxG,GAAGH,CAAAA;AACvCA,QAAI2G,KAAKwxG,UAAUE;AACnBl4G,QAAIwG,KAAKwxG,UAAUC;AAEnB,QAAIztF,UAAWhkB,KAAKyQ,QAAQuT,WAAW;AACvChkB,SAAKy8F,MAAMziG,MAAMgqB,UAAUA,UAAU;AACrChkB,SAAK43G,WAAW;AAChB53G,SAAK23G,QAAQ33G,KAAK00G,WAAWl7G,IAAIH;AACjC2G,SAAK23G,SAAS3zF,UAAU;AAGxB,QAAI2Y,MACH00E;AAEDrxG,SAAKm4G,sBAEL;AAAA,aAASr8G,IAAI,GAAGA,IAAIkE,KAAKu3G,OAAOx7G,QAAQD,KAAK;AAC5C6gC,aAAO38B,KAAKgzG,OAAOl3G,CAEnB;AAAA,UAAI6gC,KAAKlsB,QAAQ20F,QAAQ;AACxB;AAAA,MACA;AACD,UAAIoS,SAAUx3G,KAAKyQ,QAAQ+mG,UAAU;AACrC,UAAG76E,KAAKszE,SAAS,aAAcuH,CAAAA,QAAO;AACrCA,iBAAU;AAAA,MACV;AAGD,UAAImB,WAAWh8E,KAAK8/D;AAEpB,UAAImc,aAAa54G,KAAK00G,WAAW,gBAAgB;AACjD,UAAI54G,MAAMkE,KAAKgzG,OAAOj3G,SAAS,GAAG;AACjC48G,iBAAS3+G,MAAM4+G,UAAAA,IAAcpB,SAAS;AACtCx3G,aAAK23G,SAASH;AAAAA,MACd;AACDnG,aAAOrxG,KAAKu3G,OAAOz7G;AACnB,UAAIkE,KAAK00G,UAAU;AAClB,YAAKrD,CAAAA,KAAK53G,OAAO;AAChBuG,eAAK43G,YAAYvG,KAAKC;AAAAA,QACtB;AAAA,MACD,OACI;AACJ,YAAKD,CAAAA,KAAK33G,QAAQ;AACjBsG,eAAK43G,YAAYvG,KAAKC;AAAAA,QACtB;AAAA,MACD;AAAA,IACD;AACD,aAASx1G,IAAI,GAAGA,IAAIkE,KAAKu3G,OAAOx7G,QAAQD,KAAK;AAC5C6gC,aAAO38B,KAAKgzG,OAAOl3G;AAEnB,UAAI6gC,KAAKlsB,QAAQ20F,QAAQ;AACxB;AAAA,MACA;AACDiM,aAAOrxG,KAAKu3G,OAAOz7G,CAAAA;AACnB,UAAIrC,QAAQ43G,KAAK53G;AACjB,UAAIC,SAAS23G,KAAK33G;AAClB,UAAIsG,KAAK00G,UAAU;AAClB10G,aAAKy3G,eAAeh+G,OAAO43G,MAAM,IACjC;AAAA,MAAA,OACI;AACJrxG,aAAKy3G,eAAe/9G,QAAQ23G,MAAM,KAClC;AAAA,MAAA;AAAA,IACD;AACD,aAASv1G,IAAI,GAAGA,IAAIkE,KAAKgzG,OAAOj3G,QAAQD,KAAK;AAC5C6gC,aAAO38B,KAAKgzG,OAAOl3G,CAEnB;AAAA,UAAI6gC,KAAKlsB,QAAQ20F,QAAQ;AACxB;AAAA,MACA;AACDiM,aAAOrxG,KAAKu3G,OAAOz7G,CAAAA;AACnB,UAAI+kC,KAAAA;AACJ,UAAIC;AACJ,UAAI9gC,KAAK00G,UAAU;AAClB7zE,aAAK7gC,KAAK63G,UAAUxG,KAAK53G,OAAO43G,MAAM,IAAA;AACtCvwE,aAAKznC,IAAI2qB,UAAU;AAAA,MACnB,OACI;AACJ6c,aAAKrnC,IAAIwqB,UAAU;AACnB8c,aAAK9gC,KAAK63G,UAAUxG,KAAK33G,QAAQ23G,MAAM,KAAA;AAAA,MACvC;AAED10E,WAAKg0E,QAAQ9vE,IAAIC;IACjB;AAAA,EAEH;AAEC,SAAO6xE;AACR,EAAE7C,ICt1BF;AAAA,IAAI+I,aAAc,SAAUjG,QAG3BH;AAAAA,YAAUoG,aAAYjG,MACtB;AAAA,WAASiG,YAAW/3G,QAAQwE,SAAQk9F,UAAAA;AACnC,QAAIqQ,QAAQD,OAAO3yG,MAAMD,MAAM4G,SAAc5G,KAAAA;AAC7C,aAASlE,IAAI,GAAGA,IAAI+2G,MAAMG,OAAOj3G,QAAQD,KAAK;AAC7C+2G,YAAMG,OAAOl3G,CAAAA,EAAG2U,QAAQ20F,SAAUtpG,MAAM;AAAA,IACxC;AACD+2G,UAAMiG,QAAQjG,MAAMG,OAAO,CAC3BH;AAAAA,UAAM5C,QAAQ;AAEd,WAAO4C;AAAAA,EACP;AACDgG,EAAAA,YAAWl9G,UAAUghC,OAAO,SAAU11B,IACrC;AAAA,QAAI01B,OAAOi2E,OAAOj3G,UAAUghC,KAAK9gC,KAAKmE,MAAMiH,EAAAA;AAC5C,QAAK01B,CAAAA,KAAK8/D,OAAO;AAChBz8F,WAAKkxG,MAAM,MAAMlxG,IACjB;AAAA,IAAA;AACD,WAAO28B;AAAAA,EACT;AACCk8E,EAAAA,YAAWl9G,UAAUm1G,WAAW,SAAUplG,MAAAA;AACzC,QAAIvT,OAAO6H,KAAKy8F;AAChB,QAAIz8F,KAAK84G,OAAO;AACf94G,WAAK84G,MAAMroG,QAAQ20F,SAAS;AAC5BjtG,WAAKyE,YAAYoD,KAAK84G,MAAMrc,KAC5B;AAAA,IAAA;AACDz8F,SAAK84G,QAAQptG;AACbvT,SAAKuE,YAAYgP,KAAK+wF,KACxB;AAAA,EAAA;AACCoc,EAAAA,YAAWl9G,UAAUg1G,UAAU,SAAUn3G,GAAGH,GAC3Cy2G;AAAAA,SAAKn0G,UAAUg1G,QAAQ90G,KAAKmE,MAAMxG,GAAGH,CACvC;AAAA,EAAA;AAECw/G,EAAAA,YAAWl9G,UAAU65G,iBAAiB,WACrC;AAAA,QAAInE,OAAOrxG,KAAKwxG;AAChBxxG,SAAK84G,MAAMnI,QAAQU,KAAKI,UAAUJ,KAAKK,QACzC;AAAA,EAAA;AAECmH,EAAAA,YAAWl9G,UAAU60G,UAAU,WAAA;AAC9B,QAAI75C,QAAQi8C,OAAOj3G,UAAU60G,QAAQ30G,KAAKmE;AAC1C,QAAIA,KAAK84G,OAAO;AACf,UAAIxhD,WAAWt3D,KAAK84G,MAAMtI,QAAAA;AAC1B,UAAIxwG,KAAKyQ,QAAQsoG,WAAW;AAC3B,iBAASj9G,IAAI,GAAGA,IAAIkE,KAAKgzG,OAAOj3G,QAAQD,KAAK;AAC5C,cAAIk9G,YAAYh5G,KAAKgzG,OAAOl3G,CAAAA,EAAG00G,QAC/B;AAAA,mBAAS7zE,QAAQ26B,UAAU;AAC1BA,qBAAS36B,QAAQrjC,KAAKuD,IAAIy6D,SAAS36B,IAAOq8E,GAAAA,UAAUr8E,IACpD,CAAA;AAAA,UAAA;AAAA,QACD;AAAA,MACD;AACD,eAAS00E,QAAQ16C,OAAO;AACvBA,cAAM06C,QAAQ16C,MAAM06C,IAAAA,KAAS/5C,SAAS+5C,IAAAA;AAAAA,MACtC;AACD16C,YAAM26C,UAAUh4G,KAAKuD,IAAI85D,MAAM26C,SAASh6C,SAASg6C;IACjD;AACD,WAAO36C;AAAAA,EACT;AACC,SAAOkiD;AACR,EAAElG,MAAAA;AC3DF,IAAIsG,WAAY,SAAUrG,QAAAA;AAGzBH,YAAUwG,WAAUrG,MAAAA;AACpB,WAASqG,UAASn4G,QAAQwE,SAAQk9F;AAEjC,QAAIqQ,QAAQD,OAAO3yG,MAAMD,MAAM4G,cAAc5G;AAE7C,QAAGsF,QAAOoG,MAAK;AACd,UAAGpG,QAAO2B,IAAG;AAEZjH,aAAKoR,MAAMs4C,IAAAA;AAAAA,MACX;AACD,UAAIwvD,cAAc9rD,KAAW9nD,OAAAA;AAAAA,aACtB4zG,YAAY5zG;AAAAA,aACZ4zG,YAAYhkG;AAEnBlV,WAAKqxE,WAAWrxE,KAAKkwG,SAASlV,WAAW11F,QAAOoG,MAAM1L,MAAMk5G,aAAal5G,IACzE;AAAA,UAAA,CAAIA,KAAKqxE,SACR,QAAO;AAAA,IACR;AAEDwhC,UAAM5C,QAAQ;AACd,WAAO4C;AAAAA,EACP;AAEDoG,EAAAA,UAASt9G,UAAUsT,aAAa;AAC/BjP,SAAKqH,MAAAA;AACLurG,WAAOj3G,UAAUsT,WAAWpT,KAAKmE,IACnC;AAAA,EAAA;AAECi5G,EAAAA,UAASt9G,UAAU0L,QAAQ,WAAA;AAE1BrH,SAAKm5G,eAAe;AAGpB,QAAIn5G,KAAKqxE,UAAS;AACjB,UAAI7vE,SAASxB,KAAKqxE,SAAS+nC,UAAUp5G,KAAKqxE,SAASpiE;AACnD,UAAIzN,QAAO;AACVA,eAAO3F,KAAKmE,KAAKqxE,QACjB;AAAA,MAAA;AAAA,IACD;AAEDuhC,WAAOj3G,UAAU0L,MAAMxL,KAAKmE,IAE9B;AAAA,EAAA;AAECi5G,EAAAA,UAASt9G,UAAU2Y,WAAW,SAASxc,MAAMD,KAE5C;AAAA,QAAGmI,KAAKqxE,YAAYrxE,KAAKqxE,SAAS/8D,UAAS;AAC1CtU,WAAKqxE,SAAS/8D,SAASxc,MAAMD;IAChC,OAAO;AACJ+6G,aAAOj3G,UAAU2Y,SAASzY,KAAKmE,MAAMlI,MAAMD,GAAAA;AAAAA,IAC3C;AAAA,EACH;AAECohH,EAAAA,UAASt9G,UAAU09G,kBAAkB,SAAS7/G,GAAGH,GAAAA;AAChD,QAAIu4G,UAAU5xG,KAAK2xG,gBACnB;AAAA,QAAA,OAAUn4G,MAAM,UAAS;AACxB,UAAI8/G,SAAS9/G,IAAIo4G,QAAQC;AACzB7xG,WAAKyQ,QAAQhX,QAAQ6/G;AAAAA,IACrB;AACD,QAAUjgH,OAAAA,MAAM,UAAS;AACxB,UAAIkgH,SAASlgH,IAAIu4G,QAAQE;AACzB9xG,WAAKyQ,QAAQ/W,SAAS6/G;AAAAA,IACtB;AAAA,EACH;AAECN,EAAAA,UAASt9G,UAAUg1G,UAAU,SAASn3G,GAAGH,GACxCu5G;AAAAA,WAAOj3G,UAAUg1G,QAAQ90G,KAAKmE,MAAMxG,GAAGH,CAEvC;AAAA,QAAA,CAAI2G,KAAKqwG,cAAcrwG,KAAKqxE,UAAU;AACrC,UAAKrxE,CAAAA,KAAKm5G,cAAc;AACvBn5G,aAAKm5G,eAAe;AACpB,YAAIj5F,SAASlgB,KAAKy8F,MAAM79F,WAAW,CAAA;AACnC,YAAIogC,UAAUh/B,KAAKy8F,MAAM79F,WAAW,CACpC;AAAA,YAAA,CAAIogC,QAASA,WAAU9e;AAMvBlgB,aAAKqxE,SAAS/zB,KAAKte,OAAAA;AAAAA,MACnB;AAAA,IACD;AAAA,EACH;AAECi6E,EAAAA,UAASt9G,UAAU65G,iBAAiB,WAAA;AACnC,SAAIx1G,KAAKqwG,cAAcrwG,KAAKqxE,UAAU;AACrC,UAAIrxE,KAAKm5G,cAAc;AACtBn5G,aAAKqxE,SAASs/B,QAAQ3wG,KAAKwxG,UAAUC,UAAUzxG,KAAKwxG,UAAUE,QAAAA;AAAAA,MAC9D;AAAA,IACD;AAAA,EACH;AAGCuH,EAAAA,UAASt9G,UAAU41G,iBAAiB,WAAA;AACnC,QAAIF,OAAOuB,OAAOj3G,UAAU41G,eAAe11G,KAAKmE,IAEhD;AAAA,QAAGA,KAAKqxE,YAAYrxE,KAAKm5G,cAAa;AACrC,UAAIK,YAAYx5G,KAAKqxE,SAASm/B;AAC9Ba,WAAK53G,QAAQ+/G,UAAU/H,aAAapxG,SAAYm5G,UAAU//G,QAAQ+/G,UAAU/H;AAC5EJ,WAAK33G,SAAS8/G,UAAU9H,aAAarxG,SAAYm5G,UAAU9/G,SAAS8/G,UAAU9H;AAAAA,IAC9E;AAED,QAAIE,UAAU5xG,KAAK2xG,gBACnBN;AAAAA,SAAK53G,SAASm4G,QAAQC;AACtBR,SAAK33G,UAAUk4G,QAAQE;AAEvB,WAAOT;AAAAA,EACT;AAEC,SAAO4H;AACR,EAAEnJ,IAAAA;ACrHF,MAAA2J,UAAe;ACMf,IAAIC,gBAAgB,SAAW9G,QAAAA;AAG9B,MAAI+G,uBAAuB,CAAC,UAAU,YAAY,SAClDlH;AAAAA,YAAUiH,gBAAe9G,MACzB;AAAA,WAAS8G,eAAc54G,QAAQwE,SAAQk9F,UAASz/F;AAE/C,QAAI8vG,QAAQD,OAAO3yG,MAAMD,MAAM4G,cAAc5G;AAC7CA,SAAKyQ,UAAU81C,MAAYjhD,SAAQ,EAACiO,QAAQ,IAC5Cs/F,CAAAA;AAAAA,UAAM+G,2BAA2Bj2D,KAAWkvD,MAAM+G,0BAA0B/G,KAC5EA;AAAAA,UAAMgH,yBAAyBl2D,KAAWkvD,MAAMgH,wBAAwBhH;AACxEA,UAAMiH,8BAA8Bn2D,KAAWkvD,MAAMiH,6BAA6BjH;AAClFA,UAAMkH,gCAAgCp2D,KAAWkvD,MAAMkH,+BAA+BlH,KAAAA;AACtFA,UAAMmH,qBAAqBr2D,KAAWkvD,MAAMmH,oBAAoBnH,KAEhE7yG;AAAAA,SAAKyQ,QAAQ20F,SAAS;AACtB,QAAIiM,OAAOtuG,OAAMuC,OAAO20G;AAExB,QAAGl3G,OAAM00C,IAAIC,MAAK;AAGjB25D,cAAQ;AAAA,IACR;AAED,QAAGrxG,KAAKk6G,cAAgB,GAAA;AACvBrH,YAAMpiG,QAAQ/W,SAAS23G;AACvBwB,YAAMtL,QAAQ92F,QAAQ/W,SAAS23G;AAAAA,IAClC,OAAO;AACJwB,YAAMpiG,QAAQhX,QAAQ43G;AACtBwB,YAAMtL,QAAQ92F,QAAQhX,QAAQ43G;AAAAA,IAC9B;AAEDrxG,SAAKyQ,QAAQoB,iBAAiB;AAE9BghG,UAAM5C,QAAQ;AACd,WAAO4C;AAAAA,EACP;AAED6G,EAAAA,eAAc/9G,UAAU2hD,OAAO,SAASze,WAAAA;AACvCA,cAAUxgC,YAAY2B,KAAK+wG,QAAAA;AAC3B/wG,SAAKy8F,QAAQ59D,UAAUtgC;AAEvB,QAAIyB,CAAAA,KAAKy8F,OAAM;AACdz8F,WAAKs9C,KACL;AAAA,IAAA;AACD,QAAGt9C,KAAKm6G,eAAc;AACrBn6G,WAAKo6G;IACR,OAAO;AACJp6G,WAAKq6G,gBACL;AAAA,IAAA;AACDr6G,SAAKs6G,gBAAAA;AACLt6G,SAAKu6G,iBAAAA;AAAAA,EACP;AAECb,EAAAA,eAAc/9G,UAAUo1G,UAAU,WACjC;AAAA,QAAIh0G,YAAYiD,KAAKk6G,cAAAA,IAAkB,qBAAqB;AAC5D,WAAO,mCAAiCn9G,YAAU,oBAAkBiD,KAAKk6G,cAAkB,IAAA,iBAAiB,mBAAiB;AAAA,EAC/H;AAECR,EAAAA,eAAc/9G,UAAU6+G,iBAAiB,WAAA;AACxC,QAAI15G,SAASd,KAAKunG;AAClB,WAAMzmG,UAAUA,OAAOymG,SAAQ;AAC9BzmG,eAASA,OAAOymG;AAAAA,IAChB;AACD,QAAGzmG,QAAO;AACT,aAAOA;AAAAA,IACP;AAAA,EACH;AAGC,WAAS25G,SAASp/G,MAAMknB,KACvBA;AAAAA,QAAIvjB,KAAK3D,IAAAA;AACT,QAAGA,KAAK23G,QAAO;AACd,eAAQl3G,IAAI,GAAGA,IAAIT,KAAK23G,OAAOj3G,QAAQD,KAAI;AAC1C2+G,iBAASp/G,KAAK23G,OAAOl3G,CAAAA,GAAIymB,GACzB;AAAA,MAAA;AAAA,IACD;AAAA,EACD;AACDm3F,EAAAA,eAAc/9G,UAAU++G,YAAY,WACnC;AAAA,QAAIn4F,MAAM,CAAA;AACVk4F,aAASz6G,KAAKw6G,eAAAA,GAAkBj4F;AAChC,WAAOA;AAAAA,EACT;AAECm3F,EAAAA,eAAc/9G,UAAUq4G,kBAAkB,WAAA;AACzC,QAAI9M,QAAQlnG,KAAK06G,UACjB;AAAA,QAAIn4F,MAAM,CACV;AAAA,aAAQzmB,IAAI,GAAGA,IAAIorG,MAAMnrG,QAAQD,KAAI;AACpC,UAAGorG,MAAMprG,GAAG2U,YAAazQ,KAAKm6G,iBAAiBjT,MAAMprG,CAAAA,EAAG2U,QAAQG,WAAW5Q,KAAKoR,OAASpR,KAAKk6G,cAAmBhT,KAAAA,MAAMprG,CAAG2U,EAAAA,QAAQC,WAAW1Q,KAAKoR,MAAO;AACxJmR,YAAIvjB,KAAKkoG,MAAMprG,CACf,CAAA;AAAA,MAAA;AAAA,IACD;AACD,WAAOymB;AAAAA,EACT;AAGCm3F,EAAAA,eAAc/9G,UAAU0+G,kBAAkB,WACzCr6G;AAAAA,SAAK26G,cAAc36G,KAAKy8F;AACxBz8F,SAAKgwG,WAAWxrG,OAAOxE,KAAKy8F,OAAO,UAAUz8F,KAAK45G,wBAAAA;AAAAA,EAEpD;AAECF,EAAAA,eAAc/9G,UAAU4+G,mBAAmB,WAAA;AAC1C,QAAIrT,QAAQlnG,KAAKg0G,gBACjB;AAAA,QAAIt1G,MAAMsB,KAAKm6G,YAAAA,IAAe,iEAAiE;AAC/F,aAAQr+G,IAAI,GAAGA,IAAIorG,MAAMnrG,QAAQD,KAAI;AAEpCw2G,mBAAwBpL,MAAMprG,CAAAA,EAAG2gG,SAASyK,MAAMprG,CAAAA,EAAGixB,QAAWruB,GAAAA,GAAAA;AAAAA,IAC9D;AAAA,EACH;AAECg7G,EAAAA,eAAc/9G,UAAUy+G,gBAAgB;AACvCp6G,SAAK46G,cAAc56G,KAAKy8F;AACxBz8F,SAAKgwG,WAAWxrG,OAAOxE,KAAKy8F,OAAO,UAAUz8F,KAAK65G,sBAAAA;AAAAA,EACpD;AAECH,EAAAA,eAAc/9G,UAAUk/G,qBAAqB,WAC9C;AAAA,EAAA;AAECnB,EAAAA,eAAc/9G,UAAU2+G,kBAAkB,WAAA;AACzC,QAAIQ,KAAKrjE,IAAIU;AACb,QAAI2iE,GACH96G,MAAKgwG,WAAWxrG,OAAOxE,KAAKw6G,eAAAA,EAAiB/d,OAAO,SAASz8F,KAAKg6G,oBAAoB,EAACj2D,SAAS,MAAA,CAAA;AAAA,QAEhG/jD,MAAKgwG,WAAWxrG,OAAOxE,KAAKw6G,eAAAA,EAAiB/d,OAAO,cAAcz8F,KAAKg6G,oBAAoB,EAACj2D,SAAS,MAAA,CAAA;AAAA,EACxG;AAKC21D,EAAAA,eAAc/9G,UAAUo/G,qBAAqB,SAASjjH,MAAAA;AACrD,QAAGkI,KAAKg7G,WAAY;AACpBh7G,SAAKg7G,aAAa;AAElBh7G,SAAK26G,YAAYhiH,aAAab;AAC9BkI,SAAKyQ,QAAQurF,iBAAiBlkG;AAC9BA,WAAOkI,KAAK26G,YAAYhiH;AAExB,QAAIuuG,QAAQlnG,KAAKg0G,gBACjB;AAAA,aAAQl4G,IAAI,GAAGA,IAAIorG,MAAMnrG,QAAQD,KAAI;AACpC,UAAGorG,MAAMprG,CAAGwY,EAAAA,UAAS;AACpB4yF,cAAMprG,GAAGwY,SAASxc,MAAMuI,MACxB;AAAA,MAAA;AAAA,IACD;AACD,QAAI46G,UAAUj7G,KAAKyQ,QAAQoB;AAC3B7R,SAAKyQ,QAAQoB,iBAAiB/Z;AAC9BkI,SAAK+H,UAAU,YAAY,CAACkzG,SAASnjH,MAAMkI,KAAKyQ,QAAQ8C;AACxDvT,SAAKg7G,aAAa;AAAA,EACpB;AACCtB,EAAAA,eAAc/9G,UAAUu/G,mBAAmB,SAASrjH,KAAAA;AACnD,QAAGmI,KAAKg7G,WAAY;AACpBh7G,SAAKg7G,aAAa;AAElBh7G,SAAK46G,YAAYpiH,YAAYX;AAC7BA,UAAMmI,KAAK46G,YAAYpiH;AAEvB,QAAI0uG,QAAQlnG,KAAKg0G,gBAEjB;AAAA,aAAQl4G,IAAI,GAAGA,IAAIorG,MAAMnrG,QAAQD,KAAI;AACpC,UAAGorG,MAAMprG,GAAGwY,UAAS;AACpB4yF,cAAMprG,CAAGwY,EAAAA,SAASjU,QAAWxI,GAAAA;AAAAA,MAC7B;AAAA,IACD;AACD,QAAIojH,UAAUj7G,KAAKyQ,QAAQoB;AAC3B7R,SAAKyQ,QAAQoB,iBAAiBha;AAC9BmI,SAAK+H,UAAU,YAAY,CAACkzG,SAASpjH,KAAKmI,KAAKyQ,QAAQ8C,MACvDvT,CAAAA;AAAAA,SAAKg7G,aAAa;AAAA,EACpB;AAECtB,EAAAA,eAAc/9G,UAAUw+G,cAAc,WAAA;AACrC,WAAOn6G,KAAKyQ,QAAQ8C,UAAU;AAAA,EAChC;AACCmmG,EAAAA,eAAc/9G,UAAUu+G,gBAAgB,WAAA;AACvC,WAAOl6G,KAAKyQ,QAAQ8C,UAAU;AAAA,EAChC;AACCmmG,EAAAA,eAAc/9G,UAAUi+G,2BAA2B,SAAU16G;AAC5D,QAAGc,KAAKm6G,YAAiBn6G,KAAAA,KAAKg7G,YAAW;AACxC;AAAA,IACA;AAID,QAAI,oBAAKtiG,UAAY1Y,KAAKm7G,eAAe,KAAM,IAAK,QAAO;AAE3D,QAAIrjH,OAAOkI,KAAK26G,YAAYhiH;AAE5BqH,SAAK+6G,mBAAmBjjH,IAAAA;AAExBkI,SAAKo7G,WAAWp7G,KAAK26G,YAAYhiH;AAAAA,EACnC;AACC+gH,EAAAA,eAAc/9G,UAAUo+G,gCAAgC,SAAS76G,GAChE;AAAA,QAAGc,KAAKm6G,YAAAA,GAAc;AACrB;AAAA,IACA;AAAA,EACH;AAECT,EAAAA,eAAc/9G,UAAUwiC,OAAO;AAC9Bn+B,SAAKunG,QAAQppE;EACf;AACCu7E,EAAAA,eAAc/9G,UAAUi6B,OAAO,WAAA;AAC9B51B,SAAKunG,QAAQ3xE,KACf;AAAA,EAAA;AAEC8jF,EAAAA,eAAc/9G,UAAU0/G,iBAAiB,WACxC;AAAA,QAAIvH,aAAa;AACjB,QAAIwH,YAAY;AAChB,QAAIC,eAAev7G,KAAKk6G,cAAAA;AAExB,QAAIsB,SAASx7G,KAAKg0G;AAClB,QAAItoG;AACJ,QAAI+vG,iBAAiBF,eAAe,gBAAgB,gBACnDG,oBAAoBH,eAAe,aAAa;AACjD,QAAII,gBAAgBJ,eAAe,MAAM;AACzC,QAAIr7E,SAASlgC,KAAK47G,iBAElB;AAAA,aAAQ9/G,IAAI,GAAGA,IAAI0/G,OAAOz/G,QAAQD,KAAI;AACrC4P,aAAO8vG,OAAO1/G,CAAAA;AACd,UAAK4P,EAAAA,QAAQA,KAAK2lE,YAAY3lE,KAAK2lE,SAASm/B,WAAAA,CAAY9kG,KAAK+E,QAAQ20F,QAAS;AAE9E,UAAIzuC,QAAQjrD,KAAK2lE,SAASm/B,QAC1B;AAAA,UAAIqL;AACJ,UAAGllD,MAAMxzB,eAAes4E,cAAgB,GAAA;AACvCI,yBAAiBllD,MAAM8kD,cAAAA;AAAAA,MAC3B,OAAQ;AACJI,yBAAiBllD,MAAM+kD;MACvB;AAED,UAAGx7E,QAAO;AAET,YAAGy2B,MAAM+kD,qBAAqB/kD,MAAMglD,aAAAA,KAAkBhlD,MAAM+kD,iBAAAA,IAAqB5H,cAAe+H,iBAAkBllD,MAAMglD,aAAiBz7E,IAAAA,SAAS,GAAI;AACrJ4zE,uBAAa+H,kBAAkBN,eAAe,IAAI;AAClDD,sBAAY3kD,MAAMglD,aAAAA;AAAAA,QAClB;AAAA,MACL,OAAQ;AACJ,YAAIG,oBAAoBxiH,KAAKuD,IAAI85D,MAAM+kD,iBAAAA,IAAqBG,gBAAgB,CAAA;AAC5E,YAAIE,yBAAyBziH,KAAKuD,IAAI85D,MAAMglD,iBAAiBG,mBAAmB,CAAA;AAChFD,yBAAiBA,iBAAiBC;AAElC,YAAGD,iBAAiBE,0BAA2BF,iBAAiB/H,YAAa;AAG5EA,uBAAa+H;AACbP,sBAAY3kD,MAAMglD,aAAAA;AAAAA,QAClB;AAAA,MACD;AAAA,IACD;AAED,WAAO,EACNK,aAAaV,WACbW,aAAanI,WAEhB;AAAA,EAAA;AAEC4F,EAAAA,eAAc/9G,UAAU4X,SAAS,SAAS5P,UACzC;AAAA,QAAG3D,KAAKk6G,cAAAA,GAAgB;AACvBl6G,WAAK+6G,mBAAmBp3G,QAC3B;AAAA,IAAA,OAAO;AACJ3D,WAAKk7G,iBAAiBv3G;IACtB;AAAA,EACH;AAEC+1G,EAAAA,eAAc/9G,UAAUgV,iBAAiB,WAAA;AACxC,WAAO,EACNkjG,SAAS7zG,KAAKrG,UACd81F,GAAAA,WAAWzvF,KAAKyQ,QAAQ8C,QACxB89F,MAAMrxG,KAAKyQ,QAAQ6qG,WACnBxH,YAAY9zG,KAAKyQ,QAAQqjG,cAAc,GACvCnwG,UAAU3D,KAAKyQ,QAAQoB,kBAAkB,EAAA;AAAA,EAE5C;AAEC6nG,EAAAA,eAAc/9G,UAAUg1G,UAAU,SAASl3G,OAAOC,QAAAA;AACjDk5G,WAAOj3G,UAAUg1G,QAAQ1wG,MAAMD,MAAM4G,SAAAA;AAErC,QAAIs1G,cAAcl8G,KAAKq7G,eAAAA;AAEvB,QAAIxG,WAAW70G,KAAKm6G,YAAgBzgH,IAAAA,SAASD,SAASuG,KAAK47G,sBAAsB57G,KAAKk6G,cAAAA,IAAkB,IAAI;AAE5G,QAAGgC,YAAYD,eAAepH,UAAUqH,YAAYF,aAAY;AAC/DE,kBAAYD,eAAgBpH,UAAUqH,YAAYF;AAAAA,IAClD;AACDh8G,SAAKyQ,QAAQqjG,aAAaoI,YAAYD;AAEtCj8G,SAAKyQ,QAAQhX,QAAQA;AACrBuG,SAAKyQ,QAAQ/W,SAASA;AACtBsG,SAAKm8G,eAAeD,YAAYD;EAClC;AAECvC,EAAAA,eAAc/9G,UAAUhC,YAAY,WAAA;AACnC,cAAUqG,KAAKunG,WAAWvnG,KAAKunG,QAAQ9K,MAAMlkG;AAAAA,EAC/C;AAECmhH,EAAAA,eAAc/9G,UAAU+3G,aAAa,WACpC;AAAA,QAAIwI,cAAcl8G,KAAKq7G,eAAAA;AACvB,QAAIa,CAAAA,YAAYD,gBAAgBj8G,KAAKunG,WAAWvnG,KAAKunG,QAAQ9K,MAAMlkG,aAAY;AAC9E,aAAO;AAAA,IACV,WAAW2jH,YAAYD,eAAiBj8G,EAAAA,KAAKunG,WAAWvnG,KAAKunG,QAAQ9K,MAAMlkG,aAAY;AACpF,aAAO;AAAA,IACV,OAAO;AACJ,aAAO;AAAA,IACP;AAAA,EACH;AAECmhH,EAAAA,eAAc/9G,UAAU83G,aAAa;AACpC,QAAIyI,cAAcl8G,KAAKq7G,eACvB;AAAA,QAAA,CAAIa,YAAYD,gBAAgBj8G,KAAKunG,WAAWvnG,KAAKunG,QAAQ9K,MAAMlkG,aAAY;AAC9E,aAAO;AAAA,IACV,OAAO;AACJ,aAAO;AAAA,IACP;AAAA,EACH;AAGCmhH,EAAAA,eAAc/9G,UAAUygH,mBAAmB;AAC1C,QAAGp8G,KAAKyzG,cAAa;AACpBzzG,WAAK41B,KACR;AAAA,IAAA,WAAW51B,KAAK0zG,cAAa;AAC1B1zG,WAAKm+B,KACL;AAAA,IAAA;AAAA,EACH;AAECu7E,EAAAA,eAAc/9G,UAAU0gH,kBAAkB,SAAS3wG,MAClD;AAAA,QAAIw0B,SAAS;AACb,QAAGx0B,SAASA,KAAK+E,QAAQ/E,QAAQ,cAAcA,KAAK+E,QAAQ/E,QAAQ,SAAQ;AAC3Ew0B,eAASx0B,KAAK2lE,SAASw1B,WAAazoF,EAAAA;AAAAA,IACpC;AACD,WAAO8hB;AAAAA,EACT;AAECw5E,EAAAA,eAAc/9G,UAAUigH,mBAAmB,WAAA;AAC1C,QAAI17E,SAAS;AACb,QAAGlgC,KAAKm6G,eAAc;AACrB,UAAImC,eAAet8G,KAAKunG,QAAQA;AAChCrnE,eAAS5mC,KAAKuD,IACbmD,KAAKq8G,gBAAgBC,aAAarrF,eAAejxB,KAAKunG,QAAQn2F,GAAAA,CAAAA,GAC9DpR,KAAKq8G,gBAAgBC,aAAa1xD,eAAe5qD,KAAKunG,QAAQn2F,GAAAA,CAAAA,CAAAA;AAAAA,IAElE,OAAO;AACJ,UAAIoqG,SAASx7G,KAAKg0G,gBAAAA;AAElB,eAASl4G,IAAI,GAAGA,IAAI0/G,OAAOz/G,QAAQD,KAAK;AACvC,YAAI4P,OAAO8vG,OAAO1/G,CACjBygH,GAAAA,UAAU7wG,KAAK67F;AAChB,YAAIz5E,QAAQyuF,QAAQvJ;AAEpB,YAAIv3E,OAAO3N,MAAMA,MAAM/xB,SAAS,CAEhC;AAAA,YAAI0/B,QAAQA,KAAKhrB,QAAQ/E,QAAQ,eAAe+vB,KAAKhrB,QAAQ20F,WAAW,OAAO;AAC9EllE,mBAASzE,KAAKhrB,QAAQhX;AACtB;AAAA,QACA;AAAA,MAED;AAAA,IACD;AACD,WAAOymC,UAAU;AAAA,EACnB;AAECw5E,EAAAA,eAAc/9G,UAAUwgH,iBAAiB,SAAS9K,MAAAA;AACjD,QAAI5uC,WAAWziE,KAAKk6G,cAAkB,IAAA,UAAU;AAChD,QAAIne,YAAY/7F,KAAKk6G,cAAAA,IAAkBl6G,KAAK26G,cAAc36G,KAAK46G;AAE/D,QAAI16E,SAASlgC,KAAK47G,iBAAAA;AAElB,QAAIhiH,OAAOmiG,UAAUx9F;AAErB,QAAG2hC,QAAO;AACT,UAAGlgC,KAAKm6G,YAAc,GAAA;AAErBn6G,aAAKyQ,QAAQ6qG,YAAat7G,KAAKyQ,QAAQ/W,SAASwmC,SAAS;AACzD67D,kBAAU/hG,MAAMN,SAASsG,KAAKyQ,QAAQ6qG,YAAY;AAClDvf,kBAAU/hG,MAAMnC,MAAOqoC,SAAO,IAAK;AACnCoyE,qBAAwBvW,WAAW/7F,KAAKunG,QAAQyK,SAASn6G,GAAAA;AACzDy6G,qBAAwBvW,UAAUxjG,YAAY,oBAAA;AAAA,MAClD,OAAQ;AACJyH,aAAKyQ,QAAQ6qG,YAAat7G,KAAKyQ,QAAQhX,QAAQymC,SAAS;AACxD67D,kBAAU/hG,MAAMP,QAAQuG,KAAKyQ,QAAQ6qG,YAAY;AAAA,MAEjD;AAAA,IACJ,OAAO;AACJvf,gBAAU/hG,MAAMnC,MAAM;AACtBu6G,sBAA2BrW,WAAW/7F,KAAKunG,QAAQyK,SAASn6G,GAAAA;AAC5Du6G,sBAA2BrW,UAAUxjG,YAAY,oBAAA;AACjDyH,WAAKyQ,QAAQ6qG,YAAYt7G,KAAKyQ,QAAQ/W;AAAAA,IACtC;AAEDE,SAAKI,MAAMyoE,QAAAA,IAAY4uC,OAAO;AAAA,EAChC;AAECqI,EAAAA,eAAc/9G,UAAUk+G,yBAAyB,SAAU36G,GAAAA;AAC1D,QAAGc,KAAK45G,8BAA8B55G,KAAKg7G,YAAW;AACrD;AAAA,IACA;AAGD,QAAInjH,MAAMmI,KAAK46G,YAAYpiH;AAC3B,QAAI+S,OAAOvL,KAAKw8G;AAChB,QAAG3kH,OAAO0T,KAAM;AAEhBvL,SAAKk7G,iBAAiBrjH,GAAAA;AAEtBmI,SAAKw8G,UAAUx8G,KAAK46G,YAAYpiH;AAAAA,EAElC;AACCkhH,EAAAA,eAAc/9G,UAAUm+G,8BAA8B,SAAS56G,GAAAA;AAC9D,QAAGc,KAAK45G,yBAAAA,GAA2B;AAClC;AAAA,IACA;AAAA,EACH;AAECF,EAAAA,eAAc/9G,UAAU8gH,oBAAoB,SAASz2E,YACpD;AAAA,QAAI02E,iBAAiB18G,KAAKg0G,gBAAAA,EAAkB9rG,OAAOlI,IAAAA;AAEnD,aAAQlE,IAAI,GAAGA,IAAI4gH,eAAe3gH,QAAQD,KAAI;AAC7C,UAAIlC,OAAO8iH,eAAe5gH,CAAG2gG,EAAAA;AAC7B,UAAG9nE,UAAqBqR,YAAYpsC,IAAM,GAAA;AACzC,eAAO;AAAA,MACP;AAAA,IACD;AAED,WAAO;AAAA,EACT;AAEC8/G,EAAAA,eAAc/9G,UAAUq+G,qBAAqB,SAAS96G,GACrD;AAAA,QAAII,SAASJ,EAAEI,UAAUJ,EAAEK;AAE3B,QAAIS,CAAAA,KAAKy8G,kBAAkBn9G,MAAAA,EAC1B;AAEDU,SAAKm7G,cAAc,oBAAIziG;AAEvB,QAAI6J,MAAM,CAAA;AAEV,QAAIo6F,aAAa,EAACnjH,GAAG,GAAGH,GAAG;AAC3B,QAAIujH,mBAAmB58G,KAAKsgE,OAAOh7D,OAAOu3G;AAE1C,QAAWD,OAAAA,oBAAoB,YAAcA,CAAAA,CAAAA,kBAAkB;AAC9DD,mBAAa,EAACnjH,GAAGojH,kBAAkBvjH,GAAGujH,iBACtC;AAAA,IAAA,WACQ,CAAG,EAAElhG,SAASzb,MAAM28G,gBAAqB,KAAA,mBAAmB;AACpED,mBAAa,EAACnjH,GAAGojH,iBAAiBpjH,GAAGH,GAAGujH,iBAAiBvjH,EACzD;AAAA,IAAA;AAED,QAAIyhH,KAAKrjE,IAAIU;AACb,QAAI2kE,SAAShC,KAAM57G,EAAQ,SAAIA,EAAE69G;AACjC,QAAIC,SAASlC,KAAM57G,EAAQ,SAAIA,EAAE+9G;AAEjC,QAAIC,aAAAA;AACJ,QAAIpC,IAAI;AACP,UAAI57G,EAAEi+G,cAAc,GAAG;AACtBD,qBAAAA;AAAAA,MACJ,OAAU;AACNA;MACA;AAAA,IACD;AAED,QAAIE,KAAKtC,KAAMgC,SAASI,aAAaP,WAAWnjH,IAAKsjH,SAAS,IAAIH,WAAWnjH;AAC7E,QAAI6jH,KAAKvC,KAAMkC,SAASE,aAAaP,WAAWtjH,IAAK2jH,SAASL,WAAWtjH;AAEzE,QAAIikH,2BAA2Bt9G,KAAKsgE,OAAOh7D,OAAO+xC;AAElD,QAAIimE,6BAA6B,OAAO;AACvC,UAAI3D,qBAAqB18G,QAAQqgH,wBAA6B,KAAA,GAAG;AAChE,YAAGp+G,EAAEo+G,+BAA+Bp+G,EAAE49G,UAAU59G,EAAE69G,cAAa;AAE9DK,eAAKC,KAAG;AACRA,eAAK;AAAA,QACL;AAAA,MACD;AAAA,IACD;AAGD,QAAID,MAAM9jH,KAAKkM,IAAI43G,EAAM9jH,IAAAA,KAAKkM,IAAI63G,EAAI,GAAA;AACrC,UAAGr9G,KAAKm6G,YAAc,GAAA;AACrB;AAAA,MACA;AAED,UAAG53F,IAAI/oB,EAAG,QAAO;AACjB,WAAIwG,KAAK26G,eAAAA,CAAgB36G,KAAK26G,YAAY5hH,YAAa,QAAO;AAE9D,UAAIizB,MAAOoxF,KAAAA;AACX,UAAIG,UAAUv9G,KAAKo7G;AACnB,UAAItjH,OAAOylH,UAAQvxF,MAAI;AACvBhsB,WAAK+6G,mBAAmBjjH,IACxBkI;AAAAA,WAAK26G,YAAYhiH,aAAab;AAE9B,UAAGylH,WAAWv9G,KAAK26G,YAAYhiH,YAAW;AACzC,eAAO;AAAA,MACP;AAEDqH,WAAKo7G,WAAWp7G,KAAK26G,YAAYhiH;AAAAA,IACpC,OAAS;AACN,UAAGqH,KAAKk6G,cAAAA,GAAgB;AACvB;AAAA,MACA;AAED,UAAG33F,IAAIlpB,EAAG,QAAO;AACjB,UAAI2G,CAAAA,KAAK46G,gBAAgB56G,KAAK46G,YAAY5hH,aAAc,QAAO;AAE/D,UAAIgzB,MAAOqxF,KAAI;AACf,iBAAWA,MAAM,YAChBrxF,OAAM9sB,EAAEs+G;AAET,UAAIC,SAASz9G,KAAKw8G;AAClB,UAAI3kH,MAAMmI,KAAK46G,YAAYpiH,YAAUwzB,MAAI;AAMzChsB,WAAKk7G,iBAAiBrjH;AACtBmI,WAAK46G,YAAYpiH,YAAYX;AAG7B,UAAG4lH,UAAUz9G,KAAK46G,YAAYpiH,WAAU;AACvC,eAAO;AAAA,MACP;AACDwH,WAAKw8G,UAAUx8G,KAAK46G,YAAYpiH;AAAAA,IAChC;AAED,QAAI0G,EAAE0rB,eACL1rB,GAAE0rB;AACH1rB,MAAE8kG,eAAa;AACf,WAAO;AAAA,EACT;AAEC,SAAO0V;AACP,EAAE5J,ICphBH;AAAA,SAAShgC,aAAapkE,MAAAA;AACrB,MAAIgyG,kBAAAA;AACJ,MAAIC,mBAAAA;AACJ,SAAO,EACNrvC,YAAY;AACXovC,sBAAmB;AACnBC;EACA,GACDC,eAAe,WACd;AAAA,QAAGF,oBAAqB,IAAE;AACzBA,wBAAkBhyG,KAAKm7F,WAAal4F,EAAAA;AAAAA,IACpC;AACD,WAAO+uG;AAAAA,EACP,GACDG,eAAe,WACd79G;AAAAA,SAAKsuE,WACLqvC;AAAAA,uBAAmB;AACnB,QAAI7mG,QAAQpL,KAAK+E,QAAQqtG;AACzB,QAAIhnG,CAAAA,OAAM;AACT;AAAA,IACA;AAED,QAAIinG,kBAAkB/9G,KAAK49G,cAAAA;AAC3B,aAAS9hH,IAAE,GAAGA,IAAEgb,MAAM00C,UAAUzvD,QAAQD,KAAK;AAC5C,UAAI8N,OAAOkN,MAAM6iB,QAAQ7iB,MAAM00C,UAAU1vD;AAEzC,UAAK8N,CAAAA,MAAM;AACV;AAAA,MACA;AACD,UAAGA,KAAK+E,cAAc/E,KAAK+E,eAAeovG,iBAAgB;AACzDJ,2BAAmB;AACnB;AAAA,MACA;AAAA,IACD;AAAA,EAGD,GACDK,yBAAyB,WACxB;AAAA,QAAGL,qBAAsB,IAAE;AAC1B39G,WAAK69G,cAAAA;AAAAA,IACL;AACD,WAAOF;AAAAA,EACP,GAMD7kF,WAAW,SAAStyB,OACnB;AAAA,QAAIsQ,QAAQpL,KAAK+E,QAAQqtG;AACzB,QAAA,CAAIhnG,OAAM;AACT,aAAO;AAAA,IACP;AACD,WAAOtQ,QAAQxG,KAAK49G,cAAAA;AAAAA,EACpB,GAMDtvG,eAAe,SAAUwiD,QACxB;AAAA,WAAO9wD,KAAK49G,cACZ;AAAA,EAAA,GAKDlvG,gBAAgB,WACf;AAAA,QAAGhD,KAAK+E,QAAQqtG,UAAS;AACxB,UAAIhnG,QAAQpL,KAAK+E,QAAQqtG;AACzB,aAAOhnG,MAAMizC,iBAAiB/pD,KAAK49G,cAAAA;AAAAA,IACvC,OAAQ;AACJ,aAAO;AAAA,IACP;AAAA,EACD,GAMDvvG,2BAA2B,SAAUxW,KACpC;AAAA,QAAG6T,KAAK+E,QAAQqtG,UAAS;AACxB,aAAOxkH,KAAKkS,MAAM3T,MAAMmI,KAAK49G,cAAAA,CAAAA;AAAAA,IACjC,OAAQ;AACJ,aAAO;AAAA,IACP;AAAA,EACD,EAAA;AAEH;ACtFA,SAASK,YAAYvyG,MAAAA;AACpB,MAAIwyG,kBAAkB,CAAA;AACtB,MAAIC,iBAAiB,CAAA;AACrB,MAAIC,qBAAqB;AACzB,MAAIC,mBAAAA;AACJ,MAAIC,0BAA0B;AAE9B,MAAIC,gBAAgBC,aAA2B9yG;AAE/C,SAAO,EACN+yG,yBAAyB,WAAA;AACxBP,sBAAkB,CAAA;AAClBC,qBAAiB,CAAA;AACjBI,kBAAcjwC,WAAAA;AAAAA,EACd,GACDowC,cAAc,WAAA;AACb,QAAI5nG,QAAQ9W,KAAKyQ,QAAQqtG;AACzB,QAAI9/C,WAAWh+D,KAAK2+G,yBAAyB7nG,KAAAA;AAC7C,SAAIwnG,yBAAwB;AAC3BA,gCAA0BtgD;AAAAA,IAC1B,WAAQh+D,KAAK4+G,uBAAuBN,yBAAyBtgD,WAAU;AACvEsgD,gCAA0BtgD;AAC1BogD,2BAAqB;AAAA,IACrB;AAEDC,uBAAAA;AACAE,kBAAcjwC;EACd,GAMDx1C,WAAW,SAAStyB,OAAAA;AACnB,QAAG+3G,cAAcP,2BAA0B;AAC1C,aAAOO,cAAczlF,UAAUtyB,KAC/B;AAAA,IAAA;AAED,QAAIsQ,QAAQ9W,KAAKyQ,QAAQqtG;AACzB,QAAA,CAAIhnG,OAAM;AACT,aAAO;AAAA,IACP;AACD,QAAGqnG,eAAe33G,WAAWnG,QAAU;AACtC,aAAO89G,eAAe33G,KAAAA;AAAAA,IAC1B,OAAS;AACL,UAAIq4G,MAAM/nG,MAAM62C,cAChB;AAAA,UAAI91D,MAAM;AACV,UAAImM,SAAS;AACb,eAAQlI,IAAI,GAAGA,IAAI+iH,IAAI9iH,QAAQD,KAAI;AAClCqiH,uBAAeriH,CAAAA,IAAKjE;AACpBA,eAAOmI,KAAKsO,cAAcuwG,IAAI/iH,CAAGmL,EAAAA,EAAAA;AACjC,YAAGnL,IAAI0K,OAAM;AACZxC,mBAASnM;AAAAA,QACT;AAAA,MACD;AACD,aAAOmM;AAAAA,IACP;AAAA,EACD,GAMDwK,YAAY,SAAU8f,QAAAA;AACrB,QAAGtuB,KAAKyQ,QAAQqtG,UAAS;AACxB,UAAGI,gBAAgB5vF,MAAYjuB,MAAAA,QAAU;AACxC,eAAO69G,gBAAgB5vF,MACvB;AAAA,MAAA;AACD,UAAIxX,QAAQ9W,KAAKyQ,QAAQqtG;AACzB,WAAIhnG,MAAO,QAAO;AAElB,UAAIgoG,YAAYhoG,MAAMmzC,aAAa37B,MAEnC;AAAA,UAAIwwF,oBAAoBhoG,MAAMgY,aAAahY,MAAMijB,OAAOzL,MAAAA,GAAS;AAChE,YAAIO,WAAW/X,MAAMgY,UAAUR,MAC/B;AAAA,YAAIxX,MAAMijB,OAAOlL,QAAAA,GAAW;AAE3B,cAAI/tB,SAASgW,MAAM6iB,QAAQ9K,QAAAA;AAC3B,cAAI7uB,KAAKsgE,OAAOvK,YAAYj1D,SAAS;AACpC,mBAAOd,KAAKwO,WAAWqgB,QAAAA;AAAAA,UACvB;AAAA,QACD;AAAA,MACD;AACDqvF,sBAAgB5vF,MAAAA,IAAUtuB,KAAK84B,UAAUgmF;AACzC,aAAOZ,gBAAgB5vF;IAC3B,OAAQ;AACJ,aAAO;AAAA,IACP;AAAA,EAED,GAMDhgB,eAAe,SAAUwiD,QAAAA;AACxB,QAAGytD,cAAcP,wBAAAA,GAA0B;AAC1C,aAAOO,cAAcjwG,cAAcwiD;IACnC;AAED,QAAA,CAAIstD,sBAAsBp+G,KAAKyQ,QAAQqtG,UAAS;AAC/C99G,WAAK++G,iBAAiB/+G,KAAKyQ,QAAQqtG,QAAAA;AAAAA,IACnC;AAED,QAAGM,mBAAmBttD,MAAYzwD,MAAAA,QAAU;AAC3C,aAAO+9G,mBAAmBttD,MAC1B;AAAA,IAAA;AAED,QAAIkuD,gBAAgBh/G,KAAK6mG,WAAAA,EAAal4F;AAEtC,QAAG3O,KAAKyQ,QAAQqtG,UAAS;AACxB,UAAIhnG,QAAQ9W,KAAKyQ,QAAQqtG;AACzB,UAAIhnG,CAAAA,MAAO,QAAOkoG;AAElB,UAAIp1G,OAAOkN,MAAM6iB,QAAQm3B,MAAAA;AAEzB,aAAOstD,mBAAmBttD,MAAAA,IAAUlnD,QAAQA,KAAK+E,cAAcqwG;AAAAA,IACnE,OAAQ;AACJ,aAAOA;AAAAA,IACP;AAAA,EACD,GAEDD,kBAAkB,SAASjoG,OAC1B;AAAA,QAAA,CAAIA,OAAM;AACT;AAAA,IACA;AACDsnG,yBAAqB,CAAA;AACrB,QAAIY,gBAAgBh/G,KAAK6mG,aAAal4F;AACtCmI,UAAMozC,SAAS,SAAStgD,MAAAA;AACvB,aAAOw0G,mBAAmBx0G,KAAK3C,EAAM2C,IAAAA,QAAQA,KAAK+E,cAAcqwG;AAAAA,IACpE,CACG;AAAA,EAAA,GAEDL,0BAA0B,SAAS7nG,OAAAA;AAElC,QAAImoG,eAAej/G,KAAK6mG,WAAal4F,EAAAA;AACrC,QAAIuwG,kBAAkB,CAAA;AACtB,QAAI3oF,QAAQ,CAAA;AACZ,QAAI4oF,YAAY;AAChB,QAAGroG,OAAM;AACRA,YAAMozC,SAAS,SAAStgD;AACvB2sB,cAAMv3B,KAAK4K;AACXs1G,wBAAgBt1G,KAAK3C,MAAM2C,KAAK+E;AAChCwwG,qBAAav1G,KAAK+E,cAAcswG;AAAAA,MACrC;IACI;AAGD,WAAO,EACNA,cACA1oF,OACAuzB,OAAOvzB,MAAMx6B,QACbojH,UAED;AAAA,EAAA,GACDP,wBAAwB,SAAS9gD,UAAUE;AAE1C,QAAGF,SAAShU,SAASkU,SAASlU,OAAM;AACnC,aAAO;AAAA,IACP;AACD,QAAGgU,SAASmhD,gBAAgBjhD,SAASihD,cAAa;AACjD,aAAO;AAAA,IACP;AAED,QAAGnhD,SAASqhD,aAAanhD,SAASmhD,WAAU;AAC3C,aAAO;AAAA,IACP;AAED,aAAQrjH,KAAKgiE,SAASvnC,OAAM;AAC3B,UAAIkS,WAAWu1B,SAASznC,MAAMz6B,CAC9B;AAAA,UAAG2sC,aAAapoC,UAAaooC,YAAYq1B,SAASvnC,MAAMz6B,CAAAA,GAAG;AAC1D,eAAO;AAAA,MACP;AAAA,IACD;AAED,WAAO;AAAA,EACP,GAID4S,gBAAgB,WAAA;AACf,QAAG6vG,cAAcP,wBAAAA,GAA0B;AAC1C,aAAOO,cAAc7vG,eAAAA;AAAAA,IACrB;AAED,QAAG2vG,oBAAAA,IAAuB;AACzB,aAAOA;AAAAA,IACP;AAED,QAAGr+G,KAAKyQ,QAAQqtG,UAAS;AACxB,UAAIhnG,QAAQ9W,KAAKyQ,QAAQqtG;AACzB99G,WAAK++G,iBAAiBjoG;AACtB,UAAIsoG,YAAYp/G,KAAKsO,cAAc3G,KAAK3H,IAAAA;AACxC,UAAI6tG,eAAe/2F,MAAM42C;AACzB,UAAI2xD,cAAc;AAElBxR,mBAAa1kG,QAAQ,SAASS,MAAAA;AAC7By1G,uBAAeD,UAAUx1G,KAAK3C,EACnC;AAAA,MAAA,CAAA;AAEIo3G,yBAAmBgB;AACnB,aAAOA;AAAAA,IACX,OAAQ;AACJ,aAAO;AAAA,IACP;AAAA,EACD,GAMDhxG,2BAA2B,SAAUxW,KAAAA;AACpC,QAAGmI,KAAKyQ,QAAQqtG,UAAS;AACxB,UAAGS,cAAcP,wBAA0B,GAAA;AAC1C,eAAOO,cAAclwG,0BAA0BxW,GAC/C;AAAA,MAAA;AAED,UAAIif,QAAQ9W,KAAKyQ,QAAQqtG;AACzB,eAAQhiH,IAAI,GAAGA,IAAIgb,MAAMizC,aAAgBjuD,GAAAA,KAAI;AAC5C,YAAI0nF,UAAUxjF,KAAK84B,UAAUh9B,CAAAA;AAC7B,YAAIqsF,OAAOnoF,KAAK84B,UAAUh9B,IAAE,CAC5B;AAAA,YAAA,CAAIqsF,MAAK;AACR,cAAI75D,SAASxX,MAAM+zC,aAAa/uD,CAChCqsF;AAAAA,iBAAO3E,UAAUxjF,KAAKsO,cAAcggB,MACpC;AAAA,QAAA;AACD,YAAGz2B,OAAO2rF,WAAW3rF,MAAMswF,MAAK;AAC/B,iBAAOrsF;AAAAA,QACP;AAAA,MACD;AAED,aAAOgb,MAAMizC,aAAiB,IAAA;AAAA,IAClC,OAAQ;AACJ,aAAO;AAAA,IACP;AAAA,EACD,EAAA;AAEH;AC9OA,IAAIu1D,uBAAuB,WAAA;AAC1B,SAAO,EACN55G,QAAQ,WAAe;AAAA,EAAA,GACvB65G,SAAS,WAAA;AAAA,EAAe;AAE1B;AAEA,MAAeC,eAAA,EACd9tG,QAAQ,WAAA;AACP,SAAO4tG,qBACP;AAAA,EAAA;ACTa,SAAAG,oBACd;AAAA,MAAIxqD,OAAOj1D;AACX,MAAI0/G,aAAa,WAAA;AAChB,WAAOzqD,KAAKt7D;EACd;AAEC,MAAIgmH,aAAa,SAAS14G,IAAIkH,MAAAA;AAC7B,YAAQA,KAAKyxG;AAAAA,EACf;AAEe5/G,OAAKsgE;AAEnB,MAAI2uC,cAAa,CAChB,EACC4Q,QAAQ,MACRxsD,UAAUrzD,KAAKsgE,OAAOnxD,IAAIkqB,OAAOjE,QAAAA,GACjCyJ,WAAW7+B,KAAK8/G,YAChB79D,QAAQ,CAACy9D,YAAYC,UAIvB1Q,EAAAA,CAAAA;AAAAA,EAAAA,YAAWjwG,KAAK,EACfq0D,UAAUrzD,KAAKsgE,OAAOnxD,IAAIkqB,OAAO0mF,UACjClhF,WAAW7+B,KAAKggH,UAChB/9D,QAAQ,CAIPy9D;AAIF,MAAIvQ,aAAa,CAChB,EACC0Q,QAAQ,MACRxsD,UAAUrzD,KAAKsgE,OAAOnxD,IAAIkqB,OAAO7Y,KACjCqe,GAAAA,WAAW7+B,KAAKkvG,aAChBjtD,QAAQ,CAACy9D,UAAAA,EAAAA,CAAAA;AAIX,SAAO,EACNrsG,OAAO47F,aACPtxF,OAAOwxF;AAGT;ACvCA,IAAI8Q,WAAW,SAASn/G,QAAQwE,SAAQk9F,UAASz/F,QAChD/C;AAAAA,OAAKyQ,UAAU81C,MAAY,CAAE,GAAEjhD,WAAU,CAAE;AAC3CtF,OAAK0e,eAAe,IAAI+3C,YAAY1zD,MACpC/C;AAAAA,OAAKsgE,SAASv9D;AACd/C,OAAKkgH,oBAAoB;AACzBlgH,OAAKmgH,sBAAsB;AAC3B55D,QAAYvmD,MAAMogH,YAAiBpgH,IAAAA,CAAAA;AACnC0M,gBAAU1M,IACX;AAAA;AAEAigH,SAAStkH,YAAY,EACpB2hD,MAAM,SAASze,WACdA;AAAAA,YAAUxgC,aAAa;AACvB2B,OAAKqQ,QAAQwuB,UAAUjgC,WAAW,CAAA;AAElCoB,OAAKqQ,MAAMhS,YAAY;AACvB2B,OAAKqgH,cAAcrgH,KAAKqQ,MAAMzR,WAAW,CAAA;AAEzCoB,OAAKgP,aAAahP,KAAKqQ,MAAMzR,WAAW,CAAA;AACxC,QAAMmhH,SAAS;AACf,QAAMpiG,QAAQ;AACd,QAAM2iG,WAAW;AAEjB,QAAMC,kBAAkB;AACxB,QAAMC,gBAAgB;AACtB,QAAMzjC,gBAAgB;AAEtB/8E,OAAKgP,WAAW3Q,YAAY0hH,SAAShjC,gBAAgBp/D,QAAQ2iG,WAAWC,kBAAkBC;AAE1FxgH,OAAKggH,WAAWhgH,KAAKgP,WAAWpQ,WAAW,CAC3CoB;AAAAA,OAAKygH,kBAAkBzgH,KAAKgP,WAAWpQ,WAAW,CAClDoB;AAAAA,OAAKkvG,cAAclvG,KAAKgP,WAAWpQ,WAAW,CAAA;AAC9CoB,OAAK8/G,aAAa9/G,KAAKgP,WAAWpQ,WAAW,CAC7CoB;AAAAA,OAAK0gH,oBAAoB1gH,KAAKgP,WAAWpQ,WAAW,CAAA;AACpDoB,OAAK2gH,kBAAkB3gH,KAAKgP,WAAWpQ,WAAW,CAElDoB;AAAAA,OAAK4gH,SAAS,EACbrhG,WAAW,GACX9lB,OAAO,CAAA,GACPw9D,YAAY,GACZj4C,SAAS,CAAA,GACT6rF,UAAU,CAAE,EAAA;AAGb,MAAIvlG,UAAStF,KAAK6mG,WAAAA;AAClB,MAAIjmB,OAAOt7E,QAAOtF,KAAKyQ,QAAQ9I,OAAO,YAAA;AACtC,MAAIk5G,YAAYv7G,QAAOtF,KAAKyQ,QAAQqwG,YAAY;AAChD,MAAIlgC,CAAAA,QAAQ5gF,KAAKyQ,QAAQ9I,MAAK;AAC7Bi5E,WAAO,UAAU5gF,KAAKyQ,QAAQ9I,OAAO;AAAA,EACrC;AACD,MAAIk5G,CAAAA,aAAa7gH,KAAKyQ,QAAQqwG,WAAU;AACvCD,gBAAY,UAAU7gH,KAAKyQ,QAAQqwG,YAAY;AAAA,EAC/C;AACD9gH,OAAKyQ,QAAQswG,iBAAiBngC,QAAQ;AACtC5gF,OAAKyQ,QAAQgkC,iBAAiBosE,aAAa;AAE3C,MAAIxnF,SAASr5B,KAAKghH;AAClB,MAAIhhH,CAAAA,KAAKyQ,QAAQ4oB,QAAO;AACvBr5B,SAAKyQ,QAAQ4oB,SAASA,OAAOhmB;AAAAA,EAC7B;AACD,MAAA,CAAIrT,KAAKyQ,QAAQ0+F,YAAW;AAC3BnvG,SAAKyQ,QAAQ0+F,aAAa91E,OAAO1b;AAAAA,EACjC;AAED3d,OAAKihH,cAAcjhH,KAAKsgE;AAExBtgE,OAAK+H,UAAU,WAAW,CAAA,CAAA;AAE1B,MAAI/H,KAAKsgE,OAAOn7D,IAAID,cAAc;AACjClF,SAAKmgH,sBAAsBngH,KAAKsgE,OAAOn7D,IAAID,aAAawM,OAAAA;AACxD1R,SAAKmgH,oBAAoB37G,OAAOxE,IAChC;AAAA,EAAA;AACD,GAED2wG,SAAS,SAASl3G,OAAOC;AACxB,MAAI4L,UAAStF,KAAK6mG,WAAAA;AAElB,MAAGptG,QAAM,MAAMA,OAAM;AACpBuG,SAAKyQ,QAAQhX,QAAQA;AAAAA,EACrB;AACD,MAAGC,SAAO,MAAMA,QAAO;AAEtBsG,SAAKyQ,QAAQ/W,SAASA;AACtB,QAAI+U,aAAanV,KAAKuD,IAAImD,KAAKyQ,QAAQ/W,SAAS4L,QAAO8Y,YAAAA;AACvDpe,SAAKgP,WAAWhV,MAAMN,SAAS+U,aAAa;AAAA,EAC5C;AAEDzO,OAAKk6B,QAAAA;AACLl6B,OAAKggH,SAAShmH,MAAMknH,kBAAkB;AAEtC,MAAG57G,QAAOmO,mBAAmBzT,KAAKyQ,QAAQqtG,UAAS;AAClD99G,SAAKggH,SAAShmH,MAAMN,SAASsG,KAAK0O,eAAAA,IAAkB;AAAA,EACvD,OAAO;AACJ1O,SAAKggH,SAAShmH,MAAMN,SAAS;AAAA,EAC7B;AAED,MAAIuyB,QAAQjsB,KAAK4gH;AAEjB,MAAIO,WAAWnhH,KAAKgP,WAAWpQ;AAC/B,WAAQ9C,IAAG,GAAG+C,MAAMsiH,SAASplH,QAAQD,IAAI+C,KAAK/C,KAAI;AACjD,QAAIyF,KAAK4/G,SAASrlH,CAAAA;AAClB,QAAGyF,GAAGpG,aAAa,YAAiBoG,KAAAA,GAAGvH,MACtCuH,IAAGvH,MAAMP,QAAQwyB,MAAMgrC,aAAa;AAAA,EACrC;AACD,GAEDt9D,WAAW,WACV;AAAA,MAAGqG,KAAKunG,WAAWvnG,KAAKunG,QAAQ92F,SAAQ;AACvC,WAAA,CAAQzQ,KAAKunG,QAAQ92F,QAAQ20F;AAAAA,EAChC,OAAO;AACJ,WAAOplG,KAAKqQ,MAAMtX;AAAAA,EAClB;AACD,GAEDy3G,SAAS;AACR,MAAIlrG,UAAStF,KAAK6mG,WAClB;AAAA,MAAI/vF,QAAQ9W,KAAKyQ,QAAQqtG;AAEzB,MAAI1H,gBAAgBt/F,QAAQ9W,KAAK0O,eAAmB,IAAA,GACnDynG,eAAen2G,KAAKrG,UAAAA,IAAcqG,KAAK4gH,OAAO3pD,aAAa;AAE5D,SAAO,EACNz9D,GAAGwG,KAAKrG,UAAAA,IAAcqG,KAAKyQ,QAAQhX,QAAQ,GAC3CJ,GAAG2G,KAAKrG,UAAAA,IAAcqG,KAAKyQ,QAAQ/W,SAAS,GAC5C+3G,UAAUzxG,KAAKrG,UAAcw8G,IAAAA,eAAe,GAC5CzE,UAAU1xG,KAAKrG,UAAe2L,IAAAA,QAAO8Y,eAAeg4F,gBAAiB,GACrEp9E,cAAch5B,KAAKrG,UAAcy8G,IAAAA,gBAAgB,GACjDgL,aAAaphH,KAAKrG,UAAcw8G,IAAAA,eAAe,EAEhD;AAAA,GAED7hG,UAAU,SAASxc,MAAMD,KACxB;AAAA,MAAA,CAAImI,KAAKrG,UACR,EAAA;AAED,MAAI0nH,WAAW;AAEfrhH,OAAKyQ,QAAQjY,YAAYwH,KAAKyQ,QAAQjY,aAAa;AACnDwH,OAAKyQ,QAAQ9X,aAAaqH,KAAKyQ,QAAQ9X,cAAc;AACrD,MAAGd,MAAI,MAAMA,KAAI;AAChBmI,SAAKyQ,QAAQjY,YAAYX;AACzBmI,SAAKgP,WAAWxW,YAAYwH,KAAKyQ,QAAQjY;AACzC6oH,eAAW;AAAA,EACX;AACD,MAAIvpH,OAAK,MAAMA,MAAK;AACnBkI,SAAKqQ,MAAM1X,aAAab;AACxBkI,SAAKyQ,QAAQ9X,aAAaqH,KAAKqQ,MAAM1X;AACrCqH,SAAKshH,eACLD;AAAAA,eAAW;AAAA,EACX;AAED,MAAGA,UAAS;AACXrhH,SAAK+H,UAAU,YAAY,CAAC/H,KAAKyQ,QAAQ9X,YAAYqH,KAAKyQ,QAAQjY;EAClE;AACD,GAED8oH,gBAAgB,SAASA,iBACxB;AAAA,MAAA,CAAIthH,KAAKrG,UACR,EAAA;AAED,MAAI2L,UAAStF,KAAK6mG;AAClB,MAAKvhG,CAAAA,QAAOiY,aAAc;AAE1B,MAAIzX,WAAW9F,KAAKwD,YAEpB;AAAA,MAAI2Q,SAASnU,KAAKuhH;AAClBvhH,OAAKqgH,YAAYhiH,YAAY2B,KAAKwhH,mBAAmBrtG,QAAQrO,SAAStM,GAAGsM,SAASojG,KAClF;AAAA,GAED1lG,aAAa,WACZ;AAAA,MAAI7K,aAAaqH,KAAKyQ,QAAQ9X,cAAc;AAC5C,MAAIH,YAAYwH,KAAKyQ,QAAQjY,aAAa;AAC1C,MAAIkB,SAASsG,KAAKyQ,QAAQ/W,UAAU;AACpC,MAAID,QAAQuG,KAAKyQ,QAAQhX,SAAS;AAClC,SAAO,EACNJ,GAAGb,WACH2wG,OAAO3wG,YAAYkB,QACnBF,GAAGb,YACHuwG,OAAOvwG,aAAac,OACpBC,QACAD,MAED;AAAA,GAEDunH,oBAAoBvB,mBAEpBwB,eAAe,SAASl+G,QAAAA;AACvB/C,OAAKyhH,cAAc;AACnBzhH,OAAK0hH,cAAc;AAEnB,MAAIzsD,OAAOj1D;AAEX,MAAIq5B,SAASr5B,KAAKsgE,OAAOz8D,UAAUC,WAAW;AAE9C,MAAG9D,KAAKyQ,QAAQ9I,MAAK;AAEpB3H,SAAK2hH;AACL,QAAIC,eAAevoF,OAAOg7B,cAAcr0D,KAAKyQ,QAAQ9I;AAErD,QAAIi6G,CAAAA,cAAa;AAChBA,qBAAevoF,OAAOE,iBAAiB,EACtCl8B,MAAM2C,KAAKyQ,QAAQ9I,MACnB6xB,kBAAkB;AAAY,eAAOy7B,KAAKjmD;AAAAA,MAAW,EAEtD,CAAA;AAAA,IAAA;AAED4yG,iBAAa/iF,YAAY,WAAA;AAAY,aAAOo2B,KAAKjmD;AAAAA,IAAW;AAE5D,QAAIigG,cAAajvG,KAAKyQ,QAAQ4oB;AAC9B,aAAQv9B,IAAI,GAAGmzG,eAAcnzG,IAAImzG,YAAWlzG,QAAQD,KAAI;AACvD,UAAI83D,QAAQq7C,YAAWnzG,CAEvB;AAAA,UAAA,OAAU83D,SAAS,UAAS;AAC3BA,gBAAQ5zD,KAAKsgE,OAAOnxD,IAAIkqB,OAAOu6B,KAC/B,EAAA;AAAA,MAAA;AAED,iBAAUA,SAAS,cAAeA,SAASA,MAAMluD,UAAUkuD,MAAM9qB,QAAQ;AACxE8qB,gBAAQ,EAACP,UAAUO,MAAAA;AAAAA,MACnB;AAEDA,YAAMloD,OAAO1L;AAEb,UAAI6hH,YAAYD,aAAanoF,SAASm6B,KACtC5zD;AAAAA,WAAKyhH,YAAYziH,KAAK6iH,SAAAA;AACtB,UAAGjuD,MAAMisD,QAAO;AACf7/G,aAAK8hH,gBAAgBF,aAAajV,SAASkV,SAC3C;AAAA,MAAA;AAAA,IACD;AAED7hH,SAAK+hH,4BAAAA;AAAAA,EACL;AAED,MAAG/hH,KAAKyQ,QAAQqwG,WAAU;AACzB7rD,SAAKxkD,QAAQuxG,YAAY/sD,KAAKqL,OAAOj1B,aAAa4pB,KAAKxkD,QAAQqwG;AAE/D,QAAImB,eAAe5oF,OAAOg7B,cAAcr0D,KAAKyQ,QAAQqwG,SAAAA;AAErD,QAAImB,CAAAA,cAAa;AAChBA,qBAAe5oF,OAAOE,iBAAiB,EACtCl8B,MAAM2C,KAAKyQ,QAAQqwG,WACnBtnF,kBAAkB,WAAY;AAAA,eAAOy7B,KAAKjmD;AAAAA,MAAW;IAEtD;AACD,QAAImgG,aAAanvG,KAAKyQ,QAAQ0+F;AAC9B,aAAQrzG,IAAI,GAAGqzG,cAAcrzG,IAAIqzG,WAAWpzG,QAAQD,KAAI;AAEvD,UAAA,OAAU83D,SAAS,UAAS;AAC3BA,gBAAQ5zD,KAAKsgE,OAAOnxD,IAAIkqB,OAAOu6B,KAAAA,EAAAA;AAAAA,MAC/B;AAED,UAAIA,QAAQu7C,WAAWrzG,CACvB83D;AAAAA,YAAMloD,OAAO1L;AAGb,UAAIkiH,YAAYD,aAAaxoF,SAASm6B,KAAAA;AACtC5zD,WAAKyhH,YAAYziH,KAAKkjH;AACtB,UAAG/S,WAAWrzG,GAAG+jH,QAAO;AACvB7/G,aAAKmiH,gBAAgBF,aAAatV,SAASuV;MAC3C;AAAA,IACD;AAAA,EACD;AACD,GAEDH,6BAA6B;AAC5B,MAAI9sD,OAAOj1D;AACX,MAAIoiH,eAAe5C,aAAa9tG;AAChC,MAAIoF,QAAQm+C,KAAKxkD,QAAQqtG;AACzB,MAAA,CAAIhnG,MAAO;AAEX9W,OAAKqiH,mBAAmBvrG,MAAMtP,YAAY,kBAAkB,SAASP,IAAI2C,MAAM2tB;AAC9E,QAAGtwB,OAAO,MAAM;AACf;AAAA,IACA;AAED,QAAA,CAAIguD,KAAKt7D,UAAAA,EACR;AACD,QAAI2L,UAAS2vD,KAAK4xC,WAAAA;AAClB,QAAGvhG,QAAOotC,qBAAqBptC,QAAOyzB,sBAAsB;AAC3D,UAAIjiB,SAAQm+C,KAAKqL,OAAOj1B,aAAa4pB,KAAKxkD,QAAQ9I,IAClD;AAAA,UAAI26G,oBAAoBrtD,KAAKstD;AAC7B,UAAID,CAAAA,mBAAkB;AACrBA,4BAAoBlqH,SAASoE,cAAc,KAAA;AAC3C8lH,0BAAkBvlH,YAAY;AAC9Bk4D,aAAKstD,kBAAkBD;AACvB,YAAGrtD,KAAK+qD,SAAS1uD,aAAY;AAC5B2D,eAAKjmD,WAAWy1F,aAAa6d,mBAAmBrtD,KAAK+qD,SAAS1uD;QACpE,OAAU;AACJ2D,eAAKjmD,WAAWtS,YAAY4lH,iBAAAA;AAAAA,QAC5B;AAAA,MACD;AACD,UAAIxrG,QAAO;AACV,YAAI0rG,yBAAyBvtD,KAAKvmD,eAAAA;AAClC,YAAIpJ,QAAOyzB,sBAAqB;AAC/BypF,mCAAyBl9G,QAAOyzB,qBAAqBr/B,UAAUu7D,KAAKjmD,WAAWhW,gBAAgB;AAAA,QAC/F;AACDopH,qBAAa18G,OAAO48G,mBAAmBh9G,SAAQ2vD,KAAK54C,SAAYmmG,GAAAA,wBAAwBvtD,KAAK3mD,cAAc1E,OAAOA,KAAK3C,KAAK,IAC5H,CAAA;AAAA,MAAA;AAAA,IACL,WAAY3B,QAAOotC,mBAAkB;AACjC,UAAGuiB,KAAKstD,mBAAmBttD,KAAKstD,gBAAgBhqH,YAAW;AAC1D08D,aAAKstD,gBAAgBhqH,WAAWqE,YAAYq4D,KAAKstD;MACjD;AAAA,IACD;AAAA,EACJ,CACEviH;AAAAA,OAAKwH,YAAY,aAAa;EAEhC,CACExH;AAAAA,OAAK+hH,8BAA8B,WAAA;AAAA;AACnC,GAEDU,cAAc,SAAS1/G,QAAAA;AACtB,MAAIs2B,SAASr5B,KAAKsgE,OAAOz8D,UAAUC,WAAW,QAC9C;AAAA,MAAI89G,eAAevoF,OAAOg7B,cAAcr0D,KAAKyQ,QAAQ9I,IACrD;AAAA,MAAIs6G,eAAe5oF,OAAOg7B,cAAcr0D,KAAKyQ,QAAQqwG,SAErD;AAAA,MAAI9gH,KAAKyhH,aAAa;AACrB,aAAQ3lH,IAAI,GAAGA,IAAIkE,KAAKyhH,YAAY1lH,QAAQD,KAAI;AAC/C8lH,mBAAa1U,YAAYltG,KAAKyhH,YAAY3lH,CAAAA,CAAAA;AAAAA,IAC1C;AAAA,EACD;AACD,MAAIkE,KAAK0hH,aAAa;AACrB,aAAQ5lH,IAAI,GAAGA,IAAIkE,KAAK0hH,YAAY3lH,QAAQD,KAAI;AAC/CmmH,mBAAa/U,YAAYltG,KAAK0hH,YAAY5lH,CAAAA,CAAAA;AAAAA,IAC1C;AAAA,EACD;AAEDkE,OAAK0hH,cAAc,CAAA;AACnB1hH,OAAKyhH,cAAc,CACnB;AAAA,GAEDiB,sBAAsB,SAASA,uBAAAA;AAC9B,MAAIp9G,UAAStF,KAAK6mG,WAAAA;AAElB,MAAI8b,cAAc,IACjBC,cAAc,GACdxkG,eAAe;AAEhB,MAAIxa,QAAQ5D,KAAKsgE,OAAO/yD,SAExB;AAAA,MAAIvN,KAAKrG,UAAa,GAAA;AACrB,QAAIkpH,UAAU7iH,KAAK0e;AACnB,QAAIvK,SAASnU,KAAKwe,WAAAA;AAClBJ,mBAAe9Y,QAAO8Y;AAEtB,QAAIE,aAAate,KAAKyQ,QAAQhX;AAC9B,QAAG6L,QAAOiZ,YAAY,OAAOjZ,QAAOiZ,YAAY,MAAK;AACpDD,mBAAahlB,KAAKuD,IAAIyI,QAAO6Y,oBAAoB,CAAA;AAAA,IACjD;AAED,QAAI2kG,OAAOD,QAAQxkG,eAAelK,QAAQ7O,QAAO0Y,kBAAkBM,YAAYF,eAAe,GAAGxa,MAAMyQ,UAAUzQ,MAAM4J,UAAUlI,QAAOmZ,GACxI;AAAA,QAAI+5C,MAAMx4D,KAAK4gH,SAASkC,KAAKA,KAAK/mH,SAAS,CAC3CiE;AAAAA,SAAKuhH,UAAUuB;AACf9iH,SAAKkgH,oBAAoB;AAEzByC,kBAAc3iH,KAAKwhH,mBAAmBsB,MAAM,GAAG9iH,KAAKyQ,QAAQhX;AAE5DmpH,kBAAcpqD,IAAIvB,aAAa;AAC/B74C,oBAAgB;AAAA,EAChB;AAEDpe,OAAKqgH,YAAYrmH,MAAMN,SAAS0kB;AAEhCpe,OAAKgP,WAAWhV,MAAMP,QACrBuG,KAAKqgH,YAAYrmH,MAAMP,QAAQmpH;AAEhC5iH,OAAKqgH,YAAYhiH,YAAYskH;AAE7B,GAEDnB,oBAAoB,SAASuB,sBAAuB5uG,QAAQ6uG,SAASC,OACpE;AAAA,MAAI/tG,aAAYlV,KAAKsgE,OAAOprD;AAC5B,MAAIsI,OAAO,CAAA;AAEX,MAAI9e,MAAMwW,WAAUwyC;AACpB,WAAS5rD,IAAI,GAAGA,IAAIqY,OAAOpY,QAAQD,KAAK;AACvC,QAAIonH,WAAW;AACf,QAAIC,WAAWzkH,IAAIyV,OAAOrY;AAC1B,QAAIqnH,UAAU;AACbD,kBAAY,MAAMC;AAAAA,IAClB;AAED3lG,SAAKxe,KAAK,iBAAkBkkH,WAAW,qBAAwB/uG,OAAOrY,GAAS,SAC9E,sCAAuCqY,OAAOrY,CAAS,EAAA,SAAI,SAAUkE,KAAKojH,kBAAkBjvG,OAAOrY,CAAAA,GAAIknH,SAASC,OAAOnnH,KAAK,QAC7H;AAAA,EAAA;AAED,SAAO0hB,KAAKhiB,KAAK;AACjB,GACD4nH,mBAAmB,SAASC,oBAAoB/9G,SAAQ09G,SAASC,OAAOz8G,OACvE;AAAA,MAAI88G,eAAetjH,KAAK6mG,WAAAA;AACxB,MAAI0c,kBAAkBvjH,KAAKsgE,OAAOprD;AAElC,MAAI4Y,QAAQ;AACZ,MAAIzb,QAAO,MAAM3T,MAAM;AAEvB,MAAIsgC,UAAU15B,QAAOoa,UAAUpa,QAAOqR,YAAYrR,QAAO+M;AAEzD,aAAU2sB,YAAY,UAAS;AAC9BA,cAAUh/B,KAAKsgE,OAAOjuD,KAAKqD,YAAYspB,OACvC;AAAA,EAAA;AAED,MAAI/wB,aAAa,GAChBC,WAAW5I,QAAOwkD;AAEnB,MAAIw5D,aAAa/lG,iBAAAA,CAAkBpjB,MAAM6oH,OAAa7oH,KAAAA,CAAAA,MAAM8oH,KAAS,IAAA;AACpEh1G,iBAAau1G,WAAmBl+G,QAAOxN,MAAMkrH,OAAAA;AAC7C90G,eAAWs1G,WAAmBl+G,QAAOxN,MAAMmrH,KAAS,IAAA;AAAA,EACpD;AAEDvkH,QAAM4G,QAAO5G,OAAO;EACtB;AACE,MAAA,CAAK4G,QAAO5G,OAAO4kH,aAAalvE,qBAAqB;AACpD11C,UAAM6kH,gBAAgB97D;AAAAA,EACtB;AAED,WAAS3rD,IAAImS,YAAYnS,IAAIoS,UAAUpS,KAAK;AAC3C,SAAKwJ,QAAO0Z,QAAQljB,CAAI,EAAA;AAExBuW,IAAAA,QAAO,IAAIqG,KAAKpT,QAAO0Z,QAAQljB;AAC5B,QAACid,QAAQimB,QAAQnjC,KAAKmE,MAAMqS,KAC9B5Y,GAAAA,QAAQ6L,QAAO7L,MAAMqC;AACZwJ,IAAAA,QAAO5L;AAChB,QAAA5B,OAAOwN,QAAOxN,KAAKgE,CACnB9B,GAAAA,QAAQ,IACR2c,WAAW,IACX8sG,WAAW;AAEZ,QAAIhqH,OAAO;AACV,UAAIkK,WAAW2/G,aAAa/lG,eAAgB,4BAA4BzlB,OAAO,OAAQ;AAEvFkC,cAAQ,WAAY,QAAS,QAAQ2J;AAErC,YAAMmC,WAAW9F,KAAKwD;AACtB,YAAMkgH,eAAeJ,aAAanvG,OAAO3N,KAAU,KAAA,CAAE,GAAEm9G;AAEvD,UAAIC,gBAAgB;AACpB,YAAMC,mBAAmB;AAEzB,UAAKH,gBAAgB,SAASjqH,QAAQoqH,oBAAqBH,gBAAgB,MAAM;AAEhF,YAAI5rH,OAAOgO,SAAStM,KAAK1B,OAAO2B,QAAM,IAAIoqH,mBAAiB,IAAI/9G,SAAStM,GAAE;AACzEoqH,0BAAgB,mCAAmC99G,SAAStM,IAAK1B,OAAO,EAAA;AAAA,QAC9E,WAAeA,OAAO2B,QAAM,IAAIoqH,mBAAiB,IAAI/9G,SAASojG,SAASzvG,QAAQoqH,kBAAiB;AAC1F,cAAIC,WAAWh+G,SAASojG,QAAQpxG,OAAO;AACvC,cAAIisH,iBAAiB;AACrB,cAAGD,WAAWD,kBAAkB;AAC/BC,uBAAWD;AACXE,6BAAiB,IAAID,QACrB;AAAA,UAAA;AACDF,0BAAgB,mCAAmCE,mCAAmCC,cACtF;AAAA,QAAA;AAAA,MACD;AACDN,iBAAW,sBAAsB3nH,KAAKwJ,QAAOwkD,QAAQ,IAAI,qBAAqB;AAE9EnzC,iBAAWjY,IAAI7C,KAAKmE,MAAMqS,KAC1B;AAAA,UAAIsE,SAAU8sG,aAAY,MAAM9sG;AAEhC,UAAIgpB,WAAW3/B,KAAKsgE,OAAO7gC,SAASukF,oBAAoBjrG,KACxD;AAAA,UAAI4jB,OAAO,eAAe8mF,QAAAA,KAAa9jF,mBAAmB3lC,KAAgB4pH,WAAAA,aAAAA,IAAiB7qG,KAC3F+U;AAAAA,YAAM9uB,KAAK29B,IAAAA;AAAAA,IAGX;AAAA,EAED;AACD,SAAO7O,MAAMtyB,KAAK,EAAA;AAClB,GACD0R,aAAa,SAASA,YAAY1T,GAAAA;AACjC,MAAIyyB,QAAQjsB,KAAK4gH;AACjB,MAAIpnH,IAAI,KAAKA,IAAIyyB,MAAMgrC,cAAehrC,CAAAA,MAAMgrC,YAAY;AACvD,WAAO;AAAA,EACP;AAED,MAAI32D,MAAMkjH,WAAmBxjH,KAAK4gH,OAAO9oH,MAAM0B;AAC/C,MAAIo9D,OAAO52D,KAAK4gH,OAAO9oH,KAAKwI,GAAAA;AAE5B,MAAIif,YAAY0M,MAAMxyB,MAAM6G,GAAQ2rB,KAAAA,MAAM1M;AAC1C,MAAI4sE,OAAO;AACX,MAAI5sE,WAAW;AACd4sE,YAAQ3yF,IAAIo9D,QAAQr3C;AACpB,QAAG0M,MAAMxN,KAAI;AACZ0tE,aAAO,IAAIA;AAAAA,IACX;AAAA,EAED;AAED,MAAIjjF,OAAO;AACX,MAAIijF,MAAM;AACTjjF,WAAOlJ,KAAKikH,mBAAmBh4F,OAAOA,MAAMjN,QAAQ1e,GAAAA,CAAAA;AAAAA,EACpD;AAED,MAAI+R,QAAO,IAAIqG,KAAKuT,MAAMjN,QAAQ1e,KAAKmN,QAAYnU,IAAAA,KAAKC,MAAM4yF,OAAOjjF,IACrE,CAAA;AAAA,SAAOmJ;AACP,GACD6Z,aAAa,SAASA,YAAY7Z,OAAAA;AACjC,OAAKrS,KAAKrG,UAAAA,EACT,QAAO;AAER,MAAI0Y,CAAAA,OAAK;AACR,WAAO;AAAA,EACP;AAED,MAAI25E,YAAYlsF,OAAOuS,MAAK5E,QAE5B,CAAA;AAAA,MAAGzN,KAAKkgH,kBAAkBl0B,SAAe3rF,MAAAA,QAAU;AAClD,WAAOL,KAAKkgH,kBAAkBl0B,SAC9B;AAAA,EAAA;AACD,MAAI1rF,MAAMN,KAAKgc,kBAAkB3J,KAAAA;AACjCrS,OAAKsgE,OAAOlzB,OAAO9sC,OAAO,GAAG,mBAE7B;AAAA,MAAI4jH,aAAa5qH,KAAKkS,MAAMlL,GAC5B;AAAA,MAAI6jH,WAAW7jH,MAAM;AAErB,MAAI2L,MAAMjM,KAAK4gH,OAAO9oH,KAAKwB,KAAKyS,IAAIm4G,YAAYlkH,KAAK4gH,OAAOnnH,MAAMsC,SAAS,CAC3E,CAAA;AAAA,MAAImoH,cAAclkH,KAAK4gH,OAAOnnH,MAAMsC,OACnCkQ,QAAOjM,KAAK4gH,OAAOnnH,MAAMuG,KAAK4gH,OAAOnnH,MAAMsC,SAAS;AAIrD,MAAIooH,UAAU;AACb,QAAID,aAAalkH,KAAK4gH,OAAOnnH,MAAMsC,QAAQ;AAC1CkQ,aAAOjM,KAAK4gH,OAAOnnH,MAAMyqH,UAAAA,KAAeC,WAAW;AAAA,IACvD,OAAU;AACNl4G,aAAO;AAAA,IACP;AAAA,EAED;AAED,MAAIm4G,WAAW9qH,KAAKC,MAAM0S,GAC1BjM;AAAAA,OAAKkgH,kBAAkBl0B,SAAao4B,IAAAA;AACpC,SAAO9qH,KAAKC,MAAM6qH,QAClB;AAAA,GAEDC,uBAAuB,SAAUp2G,YAAY4E,SAASinD,SAAAA;AAErD,MAAIznD,QAAQQ,CAAAA,QAAQ5E;AACpB,MAAIq2G,mBAAmBr2G;AACvB,SAAO6rD,QAAQznD,KAAAA,GAAO;AACrBiyG;AACAjyG,IAAAA,QAAAA,CAAQQ,QAAQyxG,gBAChB;AAAA,EAAA;AAED,SAAOA;AACP,GACDC,uBAAuB,SAAUt2G,YAAY4E,SAASinD;AAErD,MAAIznD,QAAAA,CAAQQ,QAAQ5E,UAAAA;AACpB,MAAIq2G,mBAAmBr2G;AACvB,SAAO6rD,QAAQznD,KAAO,GAAA;AACrBiyG;AACAjyG,IAAAA,QAAAA,CAAQQ,QAAQyxG,gBAChB;AAAA,EAAA;AACD,SAAOA;AACP,GACDE,0BAA0B,SAAUv2G,YAAY4E,SAASinD,SAAAA;AACxD,MAAIwqD,mBAAmBtkH,KAAKqkH,sBAAsBp2G,YAAY4E,SAASinD,OACvE;AAAA,MAAA,CAAKjnD,QAAQyxG,gBAAmB,GAAA;AAC/BA,uBAAoBtkH,KAAKukH,sBAAsBt2G,YAAY4E,SAASinD,OACpE;AAAA,EAAA;AACD,SAAOwqD;AACP,GACDtoG,mBAAmB,SAASA,kBAAkB3J,OAC7C;AAAA,MAAIpG,MAAM,IAAIyM,KAAKrG,KAAM5E,EAAAA,QAAAA;AACzB,MAAIssD,OAAO/5D,KAAK4gH,OAAO3mD,mBACtBH,UAAU95D,KAAK4gH,OAAOpnD;AAEvB,MAAI51D,QAAQ5D,KAAKsgE,OAAO/yD,SAAAA;AAExB,MAAItB,OAAOrI,MAAMyQ,UAAU;AAC1B,QAAGrU,KAAK4gH,OAAOniG,KAAI;AAClB,aAAOs7C,KAAKh+D;AAAAA,IAChB,OAAQ;AACJ,aAAO;AAAA,IACP;AAAA,EAED;AAED,MAAIkQ,OAAOrI,MAAM4J,UAAU;AAC1B,QAAGxN,KAAK4gH,OAAOniG,KAAI;AAClB,aAAO;AAAA,IACX,OAAQ;AACJ,aAAOs7C,KAAKh+D;AAAAA,IACZ;AAAA,EACD;AAED,MAAI0oH,YAAYjB,WAAmBzpD,MAAM9tD,GAEzC;AAAA,MAAIy4G,eAAe1kH,KAAKwkH,yBAAyBC,WAAW1qD,MAAMD,OAClE;AAAA,MAAI6hC,cAAc5hC,KAAK2qD,YAAAA;AACvB,MAAIC,aAAa3kH,KAAK4gH,OAAOznD;AAE7B,MAAA,CAAIwiC,aAAY;AACf,QAAGgpB,YAAW;AACb,aAAOA,WAAW;IACtB,OAAQ;AACJ,aAAO;AAAA,IACP;AAAA,EACD;AAED,MAAIx4B,QAAS95E,QAAO0nD,KAAK2qD,YAAiB1kH,KAAAA,KAAKikH,mBAAmBjkH,KAAK4gH,QAAQ7mD,KAAK2qD,YACpF,CAAA;AAAA,MAAGC,YAAW;AACb,WAAOA,WAAWD,iBAAiB,IAAIv4B;AAAAA,EAC1C,OAAO;AACJ,WAAOu4B,eAAev4B;AAAAA,EACtB;AACD,GACD3P,iBAAgB,SAAUruE,MAAMgE,YAAYC;AAC3C,MAAIwyG,OAAOC,QAAQprH;AAEnB,MAAIqrH,eAAe3yG,cAAchE,KAAKgE,cAAchE,KAAKyoF;AACzD,MAAImuB,aAAa3yG,YAAYjE,KAAKiE,YAAYjE,KAAK2oF;AACnD,MAAG92F,KAAK4gH,OAAOniG,KAAI;AAClBomG,aAAS7kH,KAAKksB,YAAY44F,YAC1BF;AAAAA,YAAQ5kH,KAAKksB,YAAY64F,UAAAA;AAAAA,EAC5B,OAAO;AACJH,YAAQ5kH,KAAKksB,YAAY44F,YACzBD;AAAAA,aAAS7kH,KAAKksB,YAAY64F,UAAAA;AAAAA,EAC1B;AACDtrH,UAASH,KAAKuD,IAAKgoH,SAASD,OAAQ,CAAA;AAEpC,MAAIvrH,IAAI2G,KAAKwO,WAAWL,KAAKlH,EAE7B;AAAA,MAAIvN,SAASsG,KAAK89E,aAAa3vE,KAAKlH,EACpC;AAAA,MAAIy1E,YAAY18E,KAAKsO,cAAcH,KAAKlH;AACxC,SAAO,EACNnP,MAAM8sH,OACN/sH,KAAKwB,GACLK,QACAD,OACAijF,UAAWA;AAEZ,GAEDoB,cAAc,SAASxvD,QAAQ02F,mBAC9B;AAAA,MAAI1/G,UAAStF,KAAK6mG,WAAAA;AAElB,MAAI14F,OAAOnO,KAAKyQ,QAAQqtG,SAASnkF,QAAQrL,MAAAA;AAEzC,MAAI50B,SAASyU,KAAK0nC,eAAe1nC,KAAK2nC,cAAcxwC,QAAOwwC,cAAcxwC,QAAOuwC;AAChF,MAAI6mC,YAAY18E,KAAKsO,cAAcggB;AAEnC,MAAI50B,UAAU,QAAQ;AACrB,QAAIwmC,SAAS56B,QAAOywC,sBAAsB;AAC1Cr8C,aAASgjF,YAAYx8C;AAAAA,EACrB;AAEDxmC,WAASJ,KAAKyS,IAAIrS,QAAQgjF,SAC1B;AAAA,MAAIsoC,mBAAmB;AACtBtrH,aAASJ,KAAKC,MAAMG,SAASJ,KAAKyW,KAAK,CACvC,CAAA;AAAA,EAAA;AACD,SAAOzW,KAAKuD,IAAInD,QAAQ,CAAA;AACxB,GAED2iB,UAAU;AACT,SAAOrc,KAAK4gH;AACZ,GAEDpiG,YAAY,SAASV;AACpB,MAAIxY,UAAStF,KAAK6mG,WAAAA;AAClB,MAAIgc,UAAU7iH,KAAK0e;AACnB,MAAIvK,SAAS,CAAC0uG,QAAQjrD,aAAatyD,OAAS4C,CAAAA,EAAAA,OAAO26G,QAAQ/qD,aAAaxyD,OAExEu9G,CAAAA;AAAAA,UAAQxrD,WAAWljD,MACnB;AAAA,SAAOA;AACP,GAED8vG,oBAAoB,SAASgB,mBAAmBh5F,OAAO5Z,OACtD;AAAA,SAAOrS,KAAKsgE,OAAOjuD,KAAK/F,IAAI+F,OAAM4Z,MAAMxM,MAAMwM,MAAM/iB,QAAQmJ;AAC5D,GACDsvG,YAAY,WAAA;AACX,MAAI3hH,KAAKyQ,QAAQ9I,MAAK;AACrB,QAAIm2G,WAAW99G,KAAKsgE,OAAOj1B,aAAarrC,KAAKyQ,QAAQ9I,IACrD3H;AAAAA,SAAKyQ,QAAQqtG,WAAWA;AACxB,QAAGA,YAAAA,CAAaA,SAASoH,wBAAuB;AAC/C,UAAIjwD,OAAOj1D;AACX89G,eAASoH,yBAAyBpH,SAASt2G,YAAY,kBAAkB,WACxEytD;AAAAA,aAAKwpD,wBACV;AAAA,MAAA,CAAA;AAAA,IACI;AAAA,EACD;AACD,GACD0G,cAAc,WAAA;AACb,MAAInlH,KAAKyQ,QAAQ9I,MAAK;AACrB,QAAIm2G,WAAW99G,KAAKsgE,OAAOj1B,aAAarrC,KAAKyQ,QAAQ9I,IAAAA;AACrD,QAAGm2G,YAAYA,SAASoH,wBAAuB;AAC9CpH,eAAS11G,YAAY01G,SAASoH,sBAAAA;AAC9BpH,eAASoH,yBAAyB;AAAA,IAClC;AAAA,EACD;AACD,GACDhrF,SAAS,WACRl6B;AAAAA,OAAK2hH;AAEL,MAAG3hH,KAAKyQ,QAAQqwG,WAAW;AAC1B9gH,SAAKyQ,QAAQuxG,YAAYhiH,KAAKsgE,OAAOj1B,aAAarrC,KAAKyQ,QAAQqwG,SAC/D;AAAA,EAAA;AAED9gH,OAAKy+G,wBACLz+G;AAAAA,OAAK0+G;AACL1+G,OAAK+hH,4BAAAA;AACL/hH,OAAK0iH,qBAAAA;AACL,GAEDzzG,YAAY;AACX,MAAIlM,SAAQ/C,KAAKsgE;AACjBtgE,OAAKyiH,aAAa1/G,MAClB/C;AAAAA,OAAKmlH,aACLnlH;AAAAA,OAAKqQ,QAAQ;AACbrQ,OAAKqgH,cAAc;AACnBrgH,OAAKgP,aAAa;AAClBhP,OAAKggH,WAAW;AAChBhgH,OAAKkvG,cAAc;AACnBlvG,OAAK8/G,aAAa;AAElB9/G,OAAKsgE,SAAS;AAEd,MAAGtgE,KAAKyQ,QAAQqtG,UAAS;AACxB99G,SAAKyQ,QAAQqtG,SAAS11G,YAAYpI,KAAKqiH,gBACvCriH;AAAAA,SAAKyQ,QAAQqtG,WAAW;AAAA,EACxB;AACD,MAAG99G,KAAKyQ,QAAQuxG,WAAU;AACzBhiH,SAAKyQ,QAAQuxG,YAAY;AAAA,EACzB;AAED,MAAGhiH,KAAKmgH,qBAAqB;AAC5BngH,SAAKmgH,oBAAoBlxG,WACzBjP;AAAAA,SAAKmgH,sBAAsB;AAAA,EAC3B;AAEDngH,OAAK+H,UAAU,aAAa,CAAA,CAAA;AAC5B/H,OAAKuI,gBAAAA;AAEL;ACluBF,SAAS68G,cAAcriH,QAAOmtB,MAAAA;AAC7B,SAAO,EACNotB,MAAM,WAAY;AAAA,EAAA,GAClB+nE,YAAY,WAAY;AAAA,EAAA,EAAA;AAE1B;ACHA,SAASC,iBAAiBviH,QAAOmtB,MAAAA;AAEhC,MAAIq1F,wBAAwB,EAC3BC,kBAAkBziH,OAAM4E,KAAK,SAAU++D,KAAK3nE,KAAKG,GAChD;AAAA,QAAIoG,UAAS4qB,KAAK22E,WAClB;AAAA,QAAI/vF,QAAQoZ,KAAKzf,QAAQqtG;AAEzB,QAAIv8G,KAAKqwB,gBAA2B1yB,GAAGoG,QAAOixC,+BAC9C;AAAA,QAAA,CAAKh1C,GAAI,QAAO;AAEhB,QAAIkkH,SAASzlH,KAAKgvB,OAAO9vB,GAAGoG,QAAOixC,kCAClC/2B,MAAM1I,MAAM6iB,QAAQ8rF,MAAAA;AAErB,QAAIv1F,KAAKnoB,UAAU,qBAAqB,CAACyX,UAAU,MAClD,QAAO;AAAA,EACR,GAAEzc,MAAAA,GAEH2iH,iBAAiB3iH,OAAM4E,KAAK,SAAU++D,KAAK3nE,KAAKG,GAAAA;AAC/C,QAAIoG,UAAS4qB,KAAK22E;AAElB,QAAI4e,SAASzlH,KAAKgvB,OAAO9vB,GAAGoG,QAAOixC;AACnCmwB,QAAIphE,OAAO+yB,OAAOh6B,YAAY;AAE9BqoE,QAAIphE,OAAO+yB,OAAOt7B,aAAa;AAC/B2pE,QAAIphE,OAAO+yB,OAAOr+B,MAAMP,QAAQy2B,KAAKhB,MAAMn2B,cAAc;AACzD2tE,QAAIphE,OAAOomC,UAAU+5E;AAAAA,EAErB,GAAE1iH,MAEH4iH,GAAAA,eAAe5iH,OAAM4E,KAAK,SAAU++D,KAAK3nE,KAAKG,GAAAA;AAC7C,QAAI4X,QAAQoZ,KAAKzf,QAAQqtG;AACzB,QAAIx4G,UAAS4qB,KAAK22E,WAClB;AAAA,QAAI+e,KAAKl/C,IAAIphE;AACb,QAAI2B,KAAK2+G,GAAGl6E,SACXm6E,aAAa31F,KAAK5hB,cAAcrH,KAChCsH,UAAU2hB,KAAK1hB,WAAWvH,EAAMlI,IAAAA,IAAIvG;AACrC,QAAIyT,MAAMo5B,gBAA2BnV,KAAKP,UACzCm2F,GAAAA,kBAAkB7sH,SAAS2sH,GAAGvtF,OAAOr+B,MAAMnC,KAAK,EAChDkuH,GAAAA,sBAAsBx3G,UAAUtC,IAAI5S,GACpC2sH,gBAAgB,GAChBC,qBAAqB3gH,QAAOkxC;AAE7BwvE,oBAAgBF,kBAAkBC;AAClC,QAAGC,gBAAgBC,oBAAmB;AACrCD,sBAAgBC;AAAAA,IAChB;AAEDL,OAAGvtF,OAAOr+B,MAAMlC,OAAOmU,IAAIzS,IAAI;AAC/BosH,OAAGvtF,OAAOr+B,MAAMnC,MAAMkuH,sBAAsB,IAAI;AAChDH,OAAGvtF,OAAOr+B,MAAMN,SAASJ,KAAKkM,IAAIwgH,aAAiB,IAAA,IAAI;AAEvDJ,OAAGI,gBAAgBA;AAEnB91F,SAAKnoB,UAAU,eAAe,CAACd,IAAI6P,MAAM6iB,QAAQ1yB,EAAAA,GAAK++G,gBAAgBH,UAAAA,CAAAA;AACtE,WAAO;AAAA,EACP,GAAE9iH,MAEHmjH,GAAAA,cAAcnjH,OAAM4E,KAAK,SAAU++D,KAAK3nE,KAAKG;AAC5C,QAAI4X,QAAQoZ,KAAKzf,QAAQqtG;AACzB,QAAI8H,KAAKl/C,IAAIphE;AACb,QAAI2B,KAAK2+G,GAAGl6E,SACX9hC,OAAOkN,MAAM6iB,QAAQ1yB,EACrBk/G,GAAAA,gBAAgBj2F,KAAK5hB,cAAcrH,EAEpC;AAAA,QAAIm/G,cAAcR,GAAGI;AAErB,QAAI91F,KAAKnoB,UAAU,wBAAwB,CAACd,IAAI2C,MAAMw8G,WAAAA,CAAAA,MAAkB,MACvE;AAED,QAAIx8G,KAAK+E,cAAcy3G,YACtB;AAEDx8G,SAAK+E,aAAay3G;AAElBtvG,UAAM0yC,WAAWviD,EACjBipB;AAAAA,SAAKnoB,UAAU,oBAAoB,CAACd,IAAI2C,MAAMu8G,eAAeC,WAE7DpmH,CAAAA;AAAAA,SAAK0F;EACL,GAAE3C,MAAAA,EAAAA;AAIJ,MAAIsjH,eAAe,WAElB;AAAA,QAAInjE,OAAMngD,OAAMc,UAAUC,WAAW,KAAA;AAErC,QAAIwB,UAAS4qB,KAAK22E,WAElB;AAAA,QAAIngC,MAAM,IAAIxjB,KAAIhzB,KAAKP,YAAY,EAACo1B,oBAAoB;AACxD,QAAIhiD,OAAMugC,QAAQh+B,QAAOghH,eAAAA,EACxB5/C,KAAIphE,OAAOmgD,cAAcngD,QAAOghH;AAEjC5/C,QAAIl/D,YAAY,qBAAqB,SAAUzI,KAAKG,GAAAA;AACnD,aAAOqmH,sBAAsBC,iBAAiB9+C,KAAK3nE,KAAKG,CAC3D;AAAA,IAAA,CAAA;AACEwnE,QAAIl/D,YAAY,oBAAoB,SAAUzI,KAAKG,GAAAA;AAClD,aAAOqmH,sBAAsBG,gBAAgBh/C,KAAK3nE,KAAKG,CAC1D;AAAA,IAAA,CAAA;AACEwnE,QAAIl/D,YAAY,cAAc,SAAUzI,KAAKG,GAAAA;AAC5C,aAAOqmH,sBAAsBI,cAAcj/C,KAAK3nE,KAAKG,CACxD;AAAA,IAAA,CAAA;AACEwnE,QAAIl/D,YAAY,aAAa,SAAUzI,KAAKG,GAAAA;AAC3C,aAAOqmH,sBAAsBW,aAAax/C,KAAK3nE,KAAKG,CACvD;AAAA,IAAA,CAAA;AAAA,EAEA;AAEC,SAAO,EACNo+C,MAAM+oE,aAAAA;AAER;AChHA,MAAME,cAAc;AACpB,MAAMC,UAAU;AAChB,MAAMC,aAAa;AAEnB,MAAqBC,eAAAA;AAAAA,EAQpB,YAAY/gB,QAAAA;AAFZ3lG,SAAQ2mH,eAA2B;AAGlC,UAAM5jH,EAAAA,OAACA,QAAAmtB,MAAaw2C,KAAAkgD,YAAKA,IAAejhB;AACxC3lG,SAAKsgE,SAASv9D;AACd/C,SAAKkvB,QAAQgB;AACblwB,SAAK6mH,OAAOngD;AACZ1mE,SAAK4mH,cAAcA;AACd5mH,SAAA8mH,cAAc9mH,KAAKsgE,OAAOnxD,IAAIC,QAAQpP,KAAKkvB,MAAMze,QAAQC;AAC9D1Q,SAAK+mH,aAAAA;AAAAA,EACN;AAAA,EACA,eACK;AAAA,QAAA/mH,KAAKgnH,aAAgB,GAAA;AACxBhnH,WAAK6mH,KAAKr/G,YAAY,cAAc,CAACzI,KAAKG,MAAAA;AACzC,cAAM+nH,mBAAmBjnH,KAAKkvB,MAAMA,MAAMj3B,sBAAAA;AAC1C,cAAMivH,UAAUD,iBAAiBlvH;AACjC,cAAMovH,UAAUF,iBAAiBnvH;AACjC,cAAMsvH,WAAWpnH,KAAK4mH,YAAY1nH,EAAEyB,OAEhC;AAAA,YAAAymH,YAAYF,UAAUX,aAAa;AACtCvmH,eAAKqnH;AACLrnH,eAAKsnH,gBAAAA;AAAAA,QACN;AACI,YAAAF,YAAYD,UAAUZ,aAAa;AACtCvmH,eAAKunH;AACLvnH,eAAKsnH,gBAAAA;AAAAA,QACN;AACA,YAAIF,WAAWF,UAAUX,eAAea,WAAWD,UAAUZ,aAAa;AACzEvmH,eAAKwnH,eAAAA;AAAAA,QACN;AACO,eAAA;AAAA,MAAA;AAEHxnH,WAAA6mH,KAAKr/G,YAAY,aAAa,MAAA;AAClCxH,aAAKwnH,eAAAA;AAAAA,MAAe,CAEtB;AAAA,IAAA;AAAA,EACD;AAAA,EACA,kBAAAF;AACK,QAAAtnH,KAAK2mH,iBAAiB,GAAG;AAC5B;AAAA,IACD;AACM,UAAAc,aAAahB,aAAazmH,KAAK2mH;AAC/B,UAAAnxD,cAAcx1D,KAAK8mH,YAAYn2G;AACrC3Q,SAAK8mH,YAAYxyG,SAASkhD,YAAY7xD,WAAW8jH,UAAAA;AACjD78G,eAAW,MAAQ5K;AAAAA,WAAKsnH,gBAAgB;AAAA,IAAA,GAAMd,OAC/C;AAAA,EAAA;AAAA,EACA,kBACCxmH;AAAAA,SAAK2mH,eAAe;AAAA,EACrB;AAAA,EACA;AACC3mH,SAAK2mH,eAAAA;AAAAA,EACN;AAAA,EACA;AACC3mH,SAAK2mH,eAAe;AAAA,EACrB;AAAA,EACA,gBAAAe;AACK,SAAC1nH,KAAKgnH,aAAAA,GAAgB;AAClB,aAAA;AAAA,IACR;AACO,WAAAhnH,KAAK8mH,YAAYn2G,eAAAA,EAAiBhN;AAAAA,EAC1C;AAAA,EACA,eACC;AAAA,WAAA,CAAA,CAAS3D,KAAKkvB,MAAMze,QAAQ6f;AAAAA,EAC7B;ACtED;AAAA,MAAMq3F,sBAAsB;AAErB,MAAMC,eAAAA;AAAAA,EAUZ,YAAY7kH,QAAOmtB,MAFnBlwB;AAAAA,SAAQ6nH,gBAAgB;AA6KxB7nH,SAAA8nH,2BAA4BC,YAAAA;AAC3B,YAAMd,mBAAmBjnH,KAAKkvB,MAAMA,MAAMj3B,sBAC1C;AAAA,YAAMivH,UAAUD,iBAAiBlvH;AACjC,YAAMovH,UAAUF,iBAAiBnvH;AACjC,UAAI0B,IAAIuuH;AACR,UAAIvuH,IAAI0tH,SAAS;AACZ1tH,YAAA0tH;AAAAA,MACL;AACA,UAAI1tH,IAAI2tH,SAAS;AACZ3tH,YAAA2tH;AAAAA,MACL;AACO,aAAA3tH;AAAAA,IAAA;AArLPwG,SAAKsgE,SAASv9D;AACd/C,SAAKkvB,QAAQgB;AAAAA,EACd;AAAA,EACA,OACC;AAAA,UAAM83F,MAAMhoH,KAAKsgE,OAAOz8D,UAAUC,WAAW,KACxC9D;AAAAA,SAAA6mH,OAAO,IAAImB,IAAIhoH,KAAKkvB,MAAMrB,aAAa,EAAEk3B,oBAAoB,GAC7D/kD,CAAAA;AAAAA,SAAAioH,kBAAkB,IAAIvB,eAAe,EACzC3jH,OAAO/C,KAAKsgE,QACZpwC,MAAMlwB,KAAKkvB,OACXw3C,KAAK1mE,KAAK6mH,MACVD,aAAa5mH,KAAK8nH,yBAAAA,CAAAA;AAEnB9nH,SAAK+mH,aACN;AAAA,EAAA;AAAA,EACA,eAAAA;AACC/mH,SAAK6mH,KAAKr/G,YAAY,qBAAqB,CAACzI,KAAKG,MAC3Cc;AAAAA,WAAAkoH,eAAeloH,KAAKsgE,OAAO57D,MAAMC,IAAIzD,QAAQhC,EAAEI,QAAQ,uBACzD;AAAA,UAAA,CAACU,KAAKkoH,cAAa;AACrB;AAAA,MACD;AAEA,YAAMr1G,UAAU7S,KAAKkvB,MAAM23E,WAAah0F,EAAAA;AACxC,YAAM+kB,aAAa53B,KAAKkoH,aAAa9tH,aAAautH,mBAAAA;AAC9C,UAAAQ;AACA,UAAAC;AACIv1G,cAAAtJ,IAAI,SAASosB,QAAQnvB,OACzB;AAAA,YAAAmvB,OAAOt4B,SAASu6B,YAAW;AACbuwF,0BAAAxyF;AACDyyF,yBAAA5hH;AAAAA,QAChB;AAAA,MAAA,CAGG;AAAA,UAAAxG,KAAKkvB,MAAMnnB,UAAU,2BAA2B,CAAC,EAAEogH,eAAeC,aAAoB,CAAA,CAAA,MAAA,OAAO;AACzF,eAAA;AAAA,MACR;AAEA,WAAKpoH,KAAKkoH,gBAAAA,CAAiBC,eAAe;AAClC,eAAA;AAAA,MACR;AAEKnoH,WAAAqoH,cAAcroH,KAAKkvB,MAAM23E,WACzB7mG;AAAAA,WAAAwR,oBAAoBxR,KAAKsgE,OAAOh7D,OAAOrB;AACvCjE,WAAAsgE,OAAOh7D,OAAOrB,aAAa;AACzB,aAAA;AAAA,IAAA,CAAA;AAGRjE,SAAK6mH,KAAKr/G,YAAY,oBAAoB,CAACzI,KAAKG;AAC3C,UAACc,CAAAA,KAAKkoH,cAAc;AACvB;AAAA,MACD;AACAloH,WAAK6mH,KAAKvhH,OAAOqwB,SAAS31B,KAAKkoH,aAAa9tH,aAAautH,mBACzD3nH;AAAAA,WAAK6mH,KAAKvhH,OAAO+yB,OAAOh6B,YAAY2B,KAAKkoH,aAAaI;AACtDtoH,WAAK6mH,KAAKvhH,OAAO+yB,OAAOz6B,UAAU0O,IAAI,0BAAA;AACtCtM,WAAK6mH,KAAKvhH,OAAO+yB,OAAOr+B,MAAMN,SAASsG,KAAKqoH,YAAYjqG,eAAe;AACvEpe,WAAK6mH,KAAKvhH,OAAO+yB,OAAOr+B,MAAMuuH,aAAavoH,KAAKqoH,YAAYjqG,eAAe;AACtEpe,WAAAkoH,aAAatqH,UAAU0O,IAAI;IAA8B,CAG/DtM;AAAAA,SAAK6mH,KAAKr/G,YAAY,cAAc,CAACzI,KAAKG,MACtC;AAAA,UAAA,CAACc,KAAKkoH,cAAa;AACrB;AAAA,MACD;AAEAloH,WAAKwoH,SAAStpH,EAAEyB;AAChB,YAAMnH,IAAIwG,KAAK8nH,yBAAyB5oH,EAAEyB,OAAAA;AACpC,YAAA8nH,gBAAgBzoH,KAAK0oH,mBAC3B1oH;AAAAA,WAAK2oH,kBAAkBnvH,CAAAA;AACvBwG,WAAK4oH,iBAAiBH;AACf,aAAA;AAAA,IAAA;AAGHzoH,SAAA6mH,KAAKr/G,YAAY,aAAa,MAAA;AAC9B,UAACxH,CAAAA,KAAKkoH,cAAc;AACvB;AAAA,MACD;AACM,YAAAO,gBAAgBzoH,KAAK0oH,mBAAAA;AAC3B,YAAMj4D,cAAcg4D,cAAch4D;AAClC,YAAM23D,eAAeK,cAAcL;AACnC,YAAMv1G,UAAU7S,KAAKkvB,MAAM23E,WAAAA,EAAah0F;AAElC,YAAAs1G,gBAAgBt1G,QAAQu1G,YAAAA;AACxB,YAAAS,eAAeh2G,QAAQ49C,WAC7B;AAAA,UAAIzwD,KAAKkvB,MAAMnnB,UAAU,oBAAoB,CAAC,EAAEogH,eAAeU,cAAcT,cAAc33D,YAAoB,CAAA,CAAA,MAAA,OAAO;AACrHzwD,aAAK8oH,kBAAAA;AACL9oH,aAAKsgE,OAAO56D,OAAAA;AACZ;AAAA,MACD;AACK1F,WAAAsgE,OAAOh7D,OAAOrB,aAAajE,KAAKwR;AAChCxR,WAAAkoH,aAAatqH,UAAU2S,OAAO,8BAAA;AACnCvQ,WAAK8oH,kBACL9oH;AAAAA,WAAK+oH,eAAe;AAAA,IAAA,CAAA;AAAA,EAGtB;AAAA,EACA;AACC,UAAMt4D,EAAAA,aAAE23D,aAAaA,IAAiBpoH,KAAK0oH,mBAE3C;AAAA,UAAM71G,UAAU7S,KAAKkvB,MAAM23E,WAAAA,EAAah0F;AAClC,UAAAs1G,gBAAgBt1G,QAAQu1G,YAAAA;AACxB,UAAAS,eAAeh2G,QAAQ49C,WAE7B;AAAA,QAAIzwD,KAAKkvB,MAAMnnB,UAAU,yBAAyB,CAAC,EAAEogH,eAAeU,cAAcT,cAAc33D,YAAAA,CAAAA,CAAAA,MAAoB,OAAO;AAC1H;AAAA,IACD;AACA,QAAIA,gBAAgB23D,cAAc;AACjC;AAAA,IACD;AACQv1G,YAAAxW,OAAO+rH,cAAc;AACrBv1G,YAAAxW,OAAOo0D,aAAa,GAAG03D,aAC/BnoH;AAAAA,SAAKsgE,OAAO56D,OACP1F;AAAAA,SAAAkvB,MAAMnnB,UAAU,wBAAwB,CAAC,EAAEogH,eAAeU,cAAcT,cAAc33D,YAC5F,CAAA,CAAA;AAAA,EAAA;AAAA,EACA,qBACO;AAAA,UAAAu4D,YAAYhpH,KAAK6mH,KAAKvhH,OAAOqwB;AACnC,UAAM9iB,UAAU7S,KAAKkvB,MAAM23E,WAAah0F,EAAAA;AACpC,QAAA49C;AACA,QAAA23D;AACA,QAAAa;AACA,QAAAC;AACJ,UAAMC,gBAAgB,EAAEC,QAAQ,GAAGC,MAAM,EAEzC;AAAA,QAAIx9G,QAAQ;AACR,QAAAC,MAAM+G,QAAQ9W,SAAS;AAC3B,QAAIutH,UAAU,CAAC/uH,GAAG2B,MAAM3B,KAAK2B;AACzB,QAAAisF,OAAQ3hF,WAAAA,EAAYA;AACpB,QAAAxG,KAAKsgE,OAAOh7D,OAAOmZ,KAAK;AAC3B5S,cAAQgH,QAAQ9W,SAAS;AACnB+P,YAAA;AACIw9G,gBAAA,CAAC/uH,GAAG2B,MAAM3B,KAAK2B;AAClBisF,aAAC3hF,WAAAA,EAAYA;AAAAA,IACrB;AAEI,QAAA+iH;AAEE,UAAAC,YAAYxpH,KAAKwoH,SAASxoH,KAAKkvB,MAAMA,MAAMj3B,sBAAwBH,EAAAA,OAAOkI,KAAKioH,gBAAgBP,cAAAA;AAC5F,aAAA5rH,IAAI+P,OAAOy9G,QAAQxtH,GAAGgQ,GAAMhQ,GAAAA,IAAIqsF,KAAKrsF,CAAAA,GAAI;AAC7C,UAAA20D,gBAAAA,UAA6B23D,iBAA4B,QAAA;AAC5D;AAAA,MACD;AACA,UAAIv1G,CAAAA,QAAQ/W,CAAG85B,EAAAA,MAAM;AACpBuzF,sBAAcC,SAASD,cAAcE;AACvBF,sBAAAE,QAAQx2G,QAAQ/W,CAAGrC,EAAAA;AAGjC,YAAI+vH,aAAaL,cAAcC,WAAWI,aAAaL,cAAcE,QAAAA,CAASC,QAAQnhC,KAAKrsF,CAAAA,GAAIgQ,OAAO;AACvF2kD,wBAAA30D;AACdmtH,oBAAUE,cAAcC;AACxBF,mBAASC,cAAcE;AACvBE,+BAAqBC,YAAYL,cAAcC,WAAWD,cAAcE,OAAOF,cAAcC;AAAAA,QAC9F;AACA,YAAIJ,cAAcn2G,QAAQ/W,CAAAA,EAAGuB,MAAM;AACnB+qH,yBAAAtsH;AAAAA,QAChB;AAAA,MACD;AAAA,IACD;AAEO,WAAA,EACN20D,aACA23D,cACAa,SACAC,QACAK,kBAEF;AAAA,EAAA;AAAA,EACA,kBAAkB/vH,GAAWH,IAAY,IAAA;AACxC,UAAMg/B,EAAAA,QAAEA,QAAWr4B,IAAAA,KAAK6mH,KAAKvhH;AAC7B,UAAMmkH,aAAazpH,KAAK6mH,KAAKvjE,KAAKrrD,sBAClCogC;AAAAA,IAAAA,QAAOr+B,MAAMnC,MAAM,GAAG4xH,WAAWpwH,IAAIA,CAC9Bg/B;AAAAA,IAAAA,QAAAr+B,MAAMlC,OAAO,GAAG0B;EACxB;AAAA,EAcA,iBAAiBi3D,EAAAA,aAAE23D,uBAAoCc,QAAAK;AAClD,QAACvpH,CAAAA,KAAK6nH,eAAe;AACnB7nH,WAAA6nH,gBAAgBzvH,SAASoE,cAAc,KAAA;AACjC81G,mBAAatyG,KAAK6nH,eAAe,0BAAA;AACvC7nH,WAAA6nH,cAAc7tH,MAAMH,UAAU;AACnCmG,WAAK6nH,cAAc7tH,MAAMN,SAAS,GAAGsG,KAAKqoH,YAAYjqG,YAAAA;AAAAA,IACvD;AAGG,QAACpe,CAAAA,KAAK6nH,cAActvH,YAAW;AACjCyH,WAAKkvB,MAAMrB,YAAYnxB,YAAYsD,KAAK6nH,aAAAA;AAAAA,IACzC;AAEI,QAAA6B;AACJ,QAAIj5D,cAAc23D,cAAc;AAChBsB,qBAAAR;AAAAA,IAAA,WACLz4D,cAAc23D,cAAc;AACvBsB,qBAAAT;AAAAA,IAAA,OACT;AACN,UAAGM,oBAAoB,KAAI;AACXG,uBAAAR;AAAAA,MAAA,OACX;AACWQ,uBAAAT;AAAAA,MAChB;AAAA,IACD;AAEAjpH,SAAK6nH,cAAc7tH,MAAMlC,OAAO,GAAG4xH,YAAAA;AAC9B1pH,SAAA6nH,cAAc7tH,MAAMH,UAAU;AAAA,EACpC;AAAA,EACA,oBACC;AAAA,QAAImG,KAAK6nH,iBAAiB7nH,KAAK6nH,cAActvH,YAAY;AACxDyH,WAAKkvB,MAAMrB,YAAYjxB,YAAYoD,KAAK6nH,aACzC;AAAA,IAAA;AACA7nH,SAAK6nH,gBAAgB;AAAA,EACtB;AAAA;ACzOD,SAASn2G,SAAO3O,QAAAA;AACf,MAAIy/B,SAAS,CAAA;AAEb,SAAO,EACNumE,UAAS,SAAS1pG,QAAOtC,WAAW+J,SAASzL;AAC5CmnC,WAAOxjC,KAAK,CAACK,QAAOtC,WAAW+J,SAASzL;AAExC,QAAIogE,SAAS14D,OAAMc,UAAUC,WAAW,aAAA;AACxC23D,WAAOstC,SAAS1pG,QAAOtC,WAAW+J,SAASzL,IAAAA;AAAAA,EAC3C,GACD4T,YAAY,WAAA;AACX,QAAI+5F,eAAcjmG,OAAMc,UAAUC,WAAW,aAC7C;AAAA,aAAQhI,IAAI,GAAGA,IAAI0mC,OAAOzmC,QAAQD,KAAI;AACrC,UAAI2sG,IAAIjmE,OAAO1mC,CACfktG;AAAAA,MAAAA,aAAYrjG,OAAO8iG,EAAE,CAAA,GAAIA,EAAE,CAAIA,GAAAA,EAAE,CAAIA,GAAAA,EAAE,CACvC,CAAA;AAAA,IAAA;AACDjmE,aAAS,CACT;AAAA,EAAA,EAAA;AAEH;ACRA,IAAImnF,OAAO,SAAU7oH,QAAQwE,SAAQk9F,UAASz/F,QAC7C/C;AAAAA,OAAKyQ,UAAU81C,MAAY,CAAE,GAAEjhD,WAAU,CAAE,CAC3CtF;AAAAA,OAAKsgE,SAASv9D;AACd/C,OAAKunG,UAAUzmG;AACf4L,gBAAU1M,IAAAA;AACVA,OAAK4pH,SAAS;AACdrjE,QAAYvmD,MAAMogH,YAAiBpgH,IACpC,CAAA;AAAA;AAGA2pH,KAAKhuH,YAAY,EAChB2hD,MAAM,SAASze,WACd;AAAA,MAAI97B,SAAQ/C,KAAKsgE;AACjB,MAAIupD,eAAe9mH,OAAM08B,SAASqqF,eAAAA;AAClC,MAAIC,mBAAmBhnH,OAAM08B,SAASuqF,mBAAAA;AACtC,MAAIp7D,eAAe5uD,KAAK6mG,WAAAA;AACxB,MAAIkiB,iBAAiBn6D,aAAaq7D,wBAAwB;AAC1D,MAAIjqH,KAAKyQ,QAAQw5G,yBAAyB5pH,QAAW;AACpD0oH,qBAAiB/oH,KAAKyQ,QAAQw5G;AAAAA,EAC9B;AAGDprF,YAAUxgC,YAAY,mEAAmEwrH,eAAe;AACxG7pH,OAAKkvB,QAAQ2P,UAAUjgC,WAAW,CAElCoB;AAAAA,OAAKkvB,MAAM7wB,YAAY,mCACtB0E,OAAM08B,SAASyqF,uBAA2B,IAAA,yCAAyCH,mBAAmB;AAEvG/pH,OAAK6tB,cAAc7tB,KAAKkvB,MAAMtwB,WAAW,CACzCoB;AAAAA,OAAK2vB,aAAa3vB,KAAKkvB,MAAMtwB,WAAW;AAExC,MAAIgiF,OAAOhyB,aAAa5uD,KAAKyQ,QAAQ9I,OAAO;AAC5C,MAAKi5E,CAAAA,QAAQ5gF,KAAKyQ,QAAQ9I,MAAM;AAC/Bi5E,WAAO,UAAU5gF,KAAKyQ,QAAQ9I,OAAO;AAAA,EACrC;AACD3H,OAAKyQ,QAAQswG,iBAAiBngC,QAAQ;AAEtC,MAAA,CAAK5gF,KAAKyQ,QAAQ4oB,QAAQ;AACzB,QAAIA,SAASr5B,KAAKghH,mBAClBhhH;AAAAA,SAAKyQ,QAAQ4oB,SAASA;AAAAA,EACtB;AAED,MAAIsY,UAAUw4E,cAAAA;AAEdnqH,OAAKoqH,wBAAwBz4E,QAAQ0zE;AACrCrlH,OAAKqqH,kBAAkBC,SAAoBvnH,MAAAA;AAE3C,MAAIwnH,aAAaC,iBAAUznH,QAAO/C,IAAAA;AAClCuqH,aAAWjtE,KAAAA;AAEXt9C,OAAKyqH,WAAWzqH,KAAKsgE,MACrBtgE;AAAAA,OAAK0qH,YAEL;AAAA,MAAI3B,gBAAgB;AACnB/oH,SAAK2qH,aAAa,IAAIC,eAAU7nH,QAAO/C,IAAAA;AACvCA,SAAK2qH,WAAWrtE,KAAAA;AAAAA,EAChB;AAEDt9C,OAAK+H,UAAU,WAAW;AAE1B,GAED8iH,sBAAsB,SAAUl1F,QAAQ8sC,UAGvC;AAAA,MAAI1pD,QAAQ4c,OAAO8sC,QAAAA;AACnB,MAAI1pD,SAASA,SAAS,KAAK;AAC1B,QAAIhW,SAAQ/C,KAAKsgE;AACjB,QAAIwqD,eAAe/xG,QAAQ;AAC3B,QAAI5e,MAAM2wH,YAAe,GAAA;AACxB/nH,MAAAA,OAAMqqC,OAAO,OAAO,WAAWq1B,WAAW,sBAAsB9sC,OAAOt4B;IAC3E,OAAU;AACNs4B,aAAO8sC,QAAAA,IAAYqoD;AAAAA,IACnB;AAAA,EACD;AACD,GAEDna,SAAS,SAAUl3G,OAAOC,QAAAA;AACzBsG,OAAKyQ,QAAQhX,QAAQuG,KAAK4pH,OAAOnwH,QAAQA;AACzCuG,OAAKyQ,QAAQ/W,SAASsG,KAAK4pH,OAAOlwH,SAASA;AAI3C,MAAImZ,UAAU7S,KAAKstB,eAAAA,GAClB+3E,aAAa;AAEd,MAAI//F,UAAStF,KAAK6mG;AAClB,MAAIkkB,iBAAiBzlH,QAAO8wC;AAE5B,WAASt6C,IAAI,GAAGm8F,IAAIplF,QAAQ9W,QAAQD,IAAIm8F,GAAGn8F,KAAK;AAC/CkE,SAAK6qH,qBAAqBh4G,QAAQ/W,CAAAA,GAAI,WACtCkE;AAAAA,SAAK6qH,qBAAqBh4G,QAAQ/W,IAAI,WACtCkE;AAAAA,SAAK6qH,qBAAqBh4G,QAAQ/W,CAAAA,GAAI;AAEtCupG,kBAAcxyF,QAAQ/W,CAAGrC,EAAAA,QAAQ;AAAA,EACjC;AAED,MAAI09G;AACJ,MAAIh9G,MAAMkrG,UAAAA,KAAAA,CAAgBrlG,KAAKyQ,QAAQ6f,YAAY;AAClD6mF,iBAAan3G,KAAKgrH,iBAAiBvxH,QAAQ,CAAA;AAC3C4rG,iBAAa8R;AAAAA,EACb;AAED,MAAGn3G,KAAKyQ,QAAQ6f,cAAcy6F,kBAAmB5wH,CAAAA,MAAMkrG,UAAY,GAAA;AAGlE,QAAI4lB,iBAAiB;AACrB,QAAIF,kBAAkB,aAAY;AACjCE,uBAAiB;AAAA,IACjB;AACD,QAAIC,iBAAiB;AACrBr4G,YAAQ1J,QAAQ,SAASiP;AACxB8yG,wBAAkB9yG,IAAI6yG,mBAAmB3lH,QAAO0wC;AAAAA,IACpD;AAEG,QAAIm1E,eAAe7xH,KAAKuD,IAAIquH,gBAAgBzxH,KAAAA;AAC5C4rG,iBAAarlG,KAAKgrH,iBAAiBG;AACnChU,iBAAa19G;AAAAA,EACb;AAED,MAAIuG,KAAKyQ,QAAQ6f,YAAY;AAC5BtwB,SAAK6tB,YAAY7zB,MAAMP,QAAQ4rG,aAAa;AAC5CrlG,SAAK2vB,WAAW31B,MAAMP,QAAQ4rG,aAAa;AAAA,EAC9C,OAAS;AACNrlG,SAAK6tB,YAAY7zB,MAAMP,QAAQ;AAC/BuG,SAAK2vB,WAAW31B,MAAMP,QAAQ;AAAA,EAC9B;AACDuG,OAAKyQ,QAAQhX,SAAS;AAEtB,MAAI6L,UAAStF,KAAK6mG,WAClB;AAAA,MAAIsQ,eAAe19G,OAAO;AACzB,QAAG09G,eAAe92G,QAAU;AAC3BiF,MAAAA,QAAO6vG,aAAagC;AACpBn3G,WAAKyQ,QAAQhX,QAAQ09G,aAAa;AAAA,IACtC,OAAQ;AACJ,UAAA,CAAIh9G,MAAMkrG,UAAAA,GAAY;AACrBrlG,aAAKgrH,iBAAiB3lB;AACtB//F,QAAAA,QAAO6vG,aAAa9P;AACpBrlG,aAAKyQ,QAAQhX,QAAQ4rG,aAAa;AAAA,MAClC;AAAA,IACD;AAAA,EACD;AAED,MAAI52F,aAAanV,KAAKuD,IAAImD,KAAK4pH,OAAOlwH,SAAS4L,QAAO8Y,cAAc,CAAA;AACpEpe,OAAK2vB,WAAW31B,MAAMN,SAAS+U,aAAa;AAC5CzO,OAAKk6B,QAAAA;AACL,GACDs2E,SAAS,WAAA;AAER,MAAIlrG,UAAStF,KAAK6mG,WAAAA;AAElB,MAAI/vF,QAAQ9W,KAAKyQ,QAAQqtG;AAEzB,MAAI1H,gBAAgBt/F,QAAQ9W,KAAK0O,eAAmB,IAAA,GACnDynG,eAAen2G,KAAKorH;AAErB,MAAI/Z,OAAO,EACV73G,GAAGwG,KAAK4pH,OAAOnwH,OACfJ,GAAG2G,KAAK4pH,OAAOlwH,QACf+3G,UAAUzxG,KAAKrG,UAAcw8G,IAAAA,eAAe,GAC5CzE,UAAU1xG,KAAKrG,UAAAA,IAAe2L,QAAO8Y,eAAeg4F,gBAAiB,GACrEp9E,cAAch5B,KAAKrG,UAAAA,IAAcy8G,gBAAgB,GACjDgL,aAAaphH,KAAKrG,UAAcw8G,IAAAA,eAAe;AAGhD,SAAO9E;AACP,GAEDsQ,YAAY,WACX;AAAA,MAAI3hH,KAAKyQ,QAAQ9I,MAAK;AACrB,QAAIm2G,WAAW99G,KAAKsgE,OAAOj1B,aAAarrC,KAAKyQ,QAAQ9I,IAAAA;AACrD3H,SAAKyQ,QAAQqtG,WAAWA;AACxB,QAAGA,aAAaA,SAASuN,oBAAmB;AAC3C,UAAIp2D,OAAOj1D;AACX89G,eAASuN,qBAAqBvN,SAASt2G,YAAY,kBAAkB,WAAA;AACpEytD,aAAKwpD,wBAAAA;AAAAA,MACV,CACI;AAAA,IAAA;AAAA,EACD;AACD,GACD0G,cAAc,WACb;AAAA,MAAInlH,KAAKyQ,QAAQ9I,MAAK;AACrB,QAAIm2G,WAAW99G,KAAKsgE,OAAOj1B,aAAarrC,KAAKyQ,QAAQ9I,IACrD;AAAA,QAAGm2G,YAAYA,SAASuN,oBAAmB;AAC1CvN,eAAS11G,YAAY01G,SAASuN,kBAAAA;AAC9BvN,eAASuN,qBAAqB;AAAA,IAC9B;AAAA,EACD;AACD,GAEDnxF,SAAS;AACRl6B,OAAK2hH,WAAAA;AAEL3hH,OAAKy+G,wBACLz+G;AAAAA,OAAK0+G;AACL1+G,OAAKsrH,+BAAAA;AAELtrH,OAAKurH,oBAAAA;AACLvrH,OAAKwrH,kBAAAA;AACL,GAEDhoH,aAAa,WAAA;AACZ,MAAI7K,aAAaqH,KAAKyQ,QAAQ9X,cAAc;AAC5C,MAAIH,YAAYwH,KAAKyQ,QAAQjY,aAAa;AAC1C,MAAIkB,SAASsG,KAAKyQ,QAAQ/W,UAAU;AACpC,MAAID,QAAQuG,KAAKyQ,QAAQhX,SAAS;AAClC,SAAO,EACNJ,GAAGb,WACH2wG,OAAO3wG,YAAYkB,QACnBF,GAAGb,YACHuwG,OAAOvwG,aAAac,OACpBC,QACAD,MAED;AAAA,GAED6a,UAAU,SAAUxc,MAAMD;AACzB,MAAKmI,CAAAA,KAAKrG,UACT,EAAA;AAED,MAAI0nH,WAAW;AAEfrhH,OAAKyQ,QAAQjY,YAAYwH,KAAKyQ,QAAQjY,aAAa;AACnDwH,OAAKyQ,QAAQ9X,aAAaqH,KAAKyQ,QAAQ9X,cAAc;AAErD,MAAIb,OAAO,KAAKA,MAAM;AACrBkI,SAAKyQ,QAAQ9X,aAAaqH,KAAK4pH,OAAOjxH,aAAaqH,KAAKkvB,MAAMv2B,aAAab;AAC3EupH,eAAW;AAAA,EACX;AAGD,MAAIxpH,MAAM,KAAKA,KAAK;AACnBmI,SAAKyQ,QAAQjY,YAAYwH,KAAK4pH,OAAOpxH,YAAYwH,KAAK2vB,WAAWn3B,YAAYX;AAC7EwpH,eAAW;AAAA,EACX;AAED,MAAGA,UAAS;AACXrhH,SAAK+H,UAAU,YAAY,CAAC/H,KAAKyQ,QAAQ9X,YAAYqH,KAAKyQ,QAAQjY,SAClE,CAAA;AAAA,EAAA;AACD,GAEDizH,gBAAgB,SAAUpuH,MAAMquH,eAAAA;AAC/B,MAAI74G,UAAU7S,KAAK6mG,aAAah0F;AAChC,MAAI84G,mBAAmB;AAEvB,WAAS7vH,IAAI,GAAGA,IAAI+W,QAAQ9W,QAAQD,KAAK;AAExC,QAAI4vH,iBAAiB74G,QAAQ/W,CAAG85B,EAAAA,MAAK;AACpC+1F;AAAAA,IACA;AACD,QAAI94G,QAAQ/W,GAAGuB,QAAQA,MAAM;AAC5B,aAAOvB,IAAI6vH;AAAAA,IACX;AAAA,EACD;AACD,SAAO;AACP,GAEDC,WAAW,SAAUvuH,MAAAA;AACpB,MAAImJ,QAAQxG,KAAKyrH,eAAepuH,IAAAA;AAChC,MAAImJ,UAAU,MAAM;AACnB,WAAO;AAAA,EACP;AACD,SAAOxG,KAAK6mG,WAAAA,EAAah0F,QAAQrM,KACjC;AAAA,GAED8mB,gBAAgB,WAAA;AACf,MAAIhoB,UAAStF,KAAK6mG,WAClB;AAAA,SAAOvhG,QAAOuN,QAAQjX,MAAAA;AACtB,GACDjC,WAAW,WAAA;AACV,MAAIqG,KAAKunG,WAAWvnG,KAAKunG,QAAQ92F,SAAS;AACzC,YAAQzQ,KAAKunG,QAAQ92F,QAAQ20F;AAAAA,EAChC,OAAS;AACN,WAAOplG,KAAKkvB,MAAMn2B;AAAAA,EAClB;AACD,GAODioH,oBAAoB,WAAA;AACnB,MAAIj+G,SAAQ/C,KAAKsgE;AACjB,MAAIrL,OAAOj1D;AACX,MAAIq5B,SAAS,CACZ,EACCg6B,UAAUtwD,OAAMoM,IAAIkqB,OAAOwyF,YAC3BhtF,WAAW7+B,KAAK2vB,YAChBsyB,QAAQ,CAAC,WAAA;AACR,WAAOgT,KAAKt7D,UAAAA;AAAAA,EACjB,MAEG,EACC05D,UAAUtwD,OAAMoM,IAAIkqB,OAAOyyF,mBAC3BjtF,GAAAA,WAAW7+B,KAAK2vB,YAChB/a,QAAQ,MACRqtC,QAAQ,CAAC,WACR;AAAA,WAAOl/C,OAAMuC,OAAOgxC;AAAAA,EACzB,CAGE,EAAA,CAAA;AAAA,SAAOjd;AACP,GAEDoxF,YAAY,SAAU1nH,QAAAA;AACrB,MAAK/C,CAAAA,KAAKyQ,QAAQ9I,KACjB;AAED3H,OAAKyhH,cAAc,CAEnB;AAAA,MAAIxsD,OAAOj1D;AAEX,MAAIq5B,SAASr5B,KAAKsgE,OAAOz8D,UAAUC,WAAW;AAC9C,MAAI89G,eAAevoF,OAAOg7B,cAAcr0D,KAAKyQ,QAAQ9I;AAErD,MAAKi6G,CAAAA,cAAc;AAClBA,mBAAevoF,OAAOE,iBAAiB,EACtCl8B,MAAM2C,KAAKyQ,QAAQ9I,MACnB6xB,kBAAkB;AAAc,aAAOy7B,KAAKtlC;AAAAA,IAAa,EAE1D,CAAA;AAAA,EAAA;AAED,MAAIs/E,cAAajvG,KAAKyQ,QAAQ4oB;AAC9B,WAASv9B,IAAI,GAAGmzG,eAAcnzG,IAAImzG,YAAWlzG,QAAQD,KAAK;AACzD,QAAI83D,QAAQq7C,YAAWnzG,CAAAA;AACvB83D,UAAMloD,OAAO1L;AAEb,QAAI6hH,YAAYD,aAAanoF,SAASm6B,KAAAA;AACtC5zD,SAAKyhH,YAAYziH,KAAK6iH,SACtB;AAAA,EAAA;AAED7hH,OAAK2hH,WAAAA;AAEL3hH,OAAKsrH,+BACL;AAAA,GAEDS,kCAAkC,SAAU9kH,IAC3C;AAAA,MAAI3B,UAAStF,KAAK6mG,WAAAA,GACjB/vF,QAAQ9W,KAAKyQ,QAAQqtG;AAEtB,OAAKhnG,SAAS7P,OAAO,SAASjH,KAAKrG,UAAAA,KAAAA,CAAgB2L,QAAOmO,iBAAiB;AAC1E;AAAA,EACA;AAED,MAAI2iG;AACJ,MAAIp2G,KAAKyQ,QAAQG,SAAS;AACzB,QAAI2C,SAASvT,KAAKsgE,OAAOnxD,IAAIC,QAAQpP,KAAKyQ,QAAQG,OAAAA;AAClD,QAAI2C,OACH6iG,iBAAgB7iG,OAAO5C,eAAiBmjG,EAAAA;AAAAA,EACzC;AAED,MAAKsC,CAAAA,eAAe;AACnBA,oBAAgBt/F,QAAQ9W,KAAK0O,mBAAmB;AAAA,EAChD;AAED,MAAI0nG,eAAe;AAClB,QAAIp2G,KAAKgsH,oBAAoBhsH,KAAKgsH,iBAAiBzzH,YAAY;AAC9DyH,WAAKgsH,iBAAiBzzH,WAAWqE,YAAYoD,KAAKgsH,gBAAAA;AAAAA,IAClD;AAED,QAAIp1F,cAAc52B,KAAKgsH,mBAAmB5zH,SAASoE,cAAc;AACjEo6B,gBAAY58B,MAAMF,aAAa;AAC/B88B,gBAAY58B,MAAMN,SAAS08G,gBAAgB;AAC3Cx/E,gBAAY58B,MAAMP,QAAQ;AAC1BuG,SAAK2vB,WAAWjzB,YAAYk6B;EAC5B;AACD,GAED00F,gCAAgC,WAC/B;AAAA,MAAIx0G,QAAQ9W,KAAKyQ,QAAQqtG;AACzB,OAAKhnG,OAAO;AACX;AAAA,EACH,OAAS;AACN9W,SAAKsrH,iCAAiC;;EACtC;AACDtrH,OAAKqiH,mBAAmBvrG,MAAMtP,YAAY,kBAAkBm8C,KAAW3jD,KAAK+rH,kCAAkC/rH,IAAAA,CAAAA;AAC9G,GAED0qH,aAAa,WAAA;AACZ,MAAI3nH,SAAQ/C,KAAKsgE;AACjBtgE,OAAKqqH,gBAAgBthB,SAAS,SAAS,eAAehmG,OAAM4E,KAAK,SAAUzI,GAAG+H,IAAI9H,KACjF;AAAA,QAAI2X,QAAQ9W,KAAKyQ,QAAQqtG;AACzB,QAAA,CAAKhnG,MAAO,QAAO;AAEnB,QAAIxX,SAASsyB,gBAA2B1yB,GAAGc,KAAKyQ,QAAQswG,cAAAA;AACxD,QAAIzhH,QAAQ;AACXwX,YAAMia,MAAMzxB,OAAOlF,aAAa4F,KAAKyQ,QAAQswG,cAE7C,CAAA;AAAA,IAAA;AACD,WAAO;AAAA,EACP,GAAE/gH,IAAOA,GAAAA,KAAKkvB;AAEflvB,OAAKqqH,gBAAgBthB,SAAS,SAAS,cAAchmG,OAAM4E,KAAK,SAAUzI,GAAG+H,IAAI9H,KAChF;AAAA,QAAI2X,QAAQ9W,KAAKyQ,QAAQqtG;AACzB,SAAKhnG,MAAO,QAAO;AAEnB,QAAIxX,SAASsyB,gBAA2B1yB,GAAGc,KAAKyQ,QAAQswG;AACxD,QAAIzhH,QAAQ;AACXwX,YAAMc,KAAKtY,OAAOlF,aAAa4F,KAAKyQ,QAAQswG;IAE5C;AACD,WAAO;AAAA,EACP,GAAE/gH,IAAOA,GAAAA,KAAKkvB;AACf,GAEDuzF,cAAc,SAAU1/G,QAAAA;AACvB,MAAIs2B,SAASr5B,KAAKsgE,OAAOz8D,UAAUC,WAAW,QAC9C;AAAA,MAAI89G,eAAevoF,OAAOg7B,cAAcr0D,KAAKyQ,QAAQ9I,IAErD;AAAA,MAAI3H,KAAKyhH,aAAa;AACrB,aAAS3lH,IAAI,GAAGA,IAAIkE,KAAKyhH,YAAY1lH,QAAQD,KAAK;AACjD8lH,mBAAa1U,YAAYltG,KAAKyhH,YAAY3lH;IAC1C;AAAA,EACD;AAEDkE,OAAKyhH,cAAc,CAAA;AACnB,GAEDwK,iBAAiB,SAAUt2F,QAAQrwB,SAAQ7L,OAC1C;AAAA,MAAIyyH,YAAYv2F,OAAOu2F,aAAa5mH,QAAO0wC;AAC3C,MAAIm2E,YAAY7yH,KAAKuD,IAAIpD,OAAOyyH,aAAa,EAC7C;AAAA,MAAIv2F,OAAOy2F,UACVD,aAAY7yH,KAAKyS,IAAIogH,WAAWx2F,OAAOy2F,SAAAA;AACxC,SAAOD;AACP,GAEDE,gCAAgC,SAAUx5G,SAASvN,SAAAA;AAClD,WAASxJ,IAAI,GAAGm8F,IAAIplF,QAAQ9W,QAAQD,IAAIm8F,GAAGn8F,KAAK;AAC/C,QAAIrC,QAAQoZ,QAAQ/W,CAAAA,EAAGrC,QAAQ;AAC/B,QAAA,CAAKoZ,QAAQ/W,CAAAA,EAAGowH,aAAazyH,QAAQ6L,QAAO0wC,uBAAsB;AACjEnjC,cAAQ/W,CAAGowH,EAAAA,YAAYzyH;AAAAA,IACvB;AAAA,EACD;AACD,GAED6yH,qBAAqB,WACpB;AAAA,MAAIhnH,UAAStF,KAAK6mG,WAAAA,GACjBh0F,UAAU7S,KAAKstB,eAAAA,GACfi/F,YAAY,GACZC,YAAY;AAEb,WAAS1wH,IAAI,GAAGA,IAAI+W,QAAQ9W,QAAQD,KAAK;AACxCywH,iBAAa15G,QAAQ/W,CAAGowH,EAAAA,YAAYr5G,QAAQ/W,CAAAA,EAAGowH,YAAY5mH,QAAO0wC;AAClE,QAAIw2E,cAAcnsH,QAAW;AAC5BmsH,kBAAY35G,QAAQ/W,CAAGswH,EAAAA,YAAaI,YAAY35G,QAAQ/W,CAAGswH,EAAAA,YAAa/rH;AAAAA,IACxE;AAAA,EACD;AACDL,OAAKqsH,+BAA+Bx5G,SAASvN;AAC7C,SAAO,CAACinH,WAAWC,SAAAA;AACnB,GAEDxB,kBAAkB,SAAUyB,UAAUC,aAAAA;AACrC,MAAIpnH,UAAStF,KAAK6mG;AAClB,MAAIh0F,UAAU7S,KAAKstB,eAAAA,GAClBq/F,gBAAgB,GAChBC,cAAcH;AAEfC,gBAAAA,CAAej0H,OAAO0B,MAAMuyH,WAAeA,IAAAA,cAAAA;AAE3C,WAAS5wH,IAAI,GAAGm8F,IAAIplF,QAAQ9W,QAAQD,IAAIm8F,GAAGn8F,KAAK;AAC/C6wH,qBAAiB95G,QAAQ/W,CAAGrC,EAAAA,QAAQ;AAAA,EACpC;AAED,MAAIhB,OAAO0B,MAAMwyH,aAAgB,GAAA;AAChC3sH,SAAKurH,oBAAAA;AACLoB,oBAAgB;AAChB,aAAS7wH,IAAI,GAAGm8F,IAAIplF,QAAQ9W,QAAQD,IAAIm8F,GAAGn8F,KAAK;AAC/C6wH,uBAAiB95G,QAAQ/W,GAAGrC,QAAQ;AAAA,IACpC;AAAA,EACD;AAED,MAAIozH,cAAcD,cAAcD;AAEhC,MAAIG,cAAc;AAClB,WAAShxH,IAAI,GAAGA,IAAI4wH,cAAc,GAAG5wH,KAAK;AACzCgxH,mBAAej6G,QAAQ/W,CAAAA,EAAGrC;AAAAA,EAC1B;AAEDkzH,mBAAiBG;AAEjB,WAAShxH,IAAI4wH,cAAc,GAAG5wH,IAAI+W,QAAQ9W,QAAQD,KAAK;AAEtD,QAAIsc,MAAMvF,QAAQ/W,CAClB;AAAA,QAAIs7D,QAAQ99D,KAAKC,MAAMszH,eAAez0G,IAAI3e,QAAQkzH,cAAAA;AAGlD,QAAIE,cAAc,GAAG;AACpB,UAAIz0G,IAAI8zG,aAAa9zG,IAAI3e,QAAQ29D,QAAQh/C,IAAI8zG,UAC5C90D,SAAQh/C,IAAI8zG,YAAY9zG,IAAI3e;AAAAA,gBACnB2e,IAAI8zG,aAAa5mH,QAAO0wC,yBAAyB59B,IAAI3e,QAAQ29D,QAAQ9xD,QAAO0wC,sBACrFohB,SAAQ9xD,QAAO0wC,wBAAwB59B,IAAI3e;AAAAA,IAChD,WAAc2e,IAAIg0G,aAAah0G,IAAI3e,QAAQ29D,QAAQh/C,IAAIg0G,UACnDh1D,SAAQh/C,IAAIg0G,YAAYh0G,IAAI3e;AAE7BkzH,qBAAiBv0G,IAAI3e;AACrB2e,QAAI3e,SAAS29D;AACby1D,mBAAez1D;AAAAA,EAEf;AAED,MAAI21D,WAAWF,cAAc,IAAI,IAAK;AACtC,SAAQA,cAAc,KAAKE,aAAa,KAAOF,cAAc,KAAKE,aAAc,IAAI;AACnF,QAAIC,WAAWH;AACf,SAAK/wH,IAAI4wH,cAAc,GAAG5wH,IAAI+W,QAAQ9W,QAAQD,KAAK;AAClD,UAAIqwH,YAAYt5G,QAAQ/W,CAAGrC,EAAAA,QAAQszH;AAEnC,UAAIZ,aAAansH,KAAKisH,gBAAgBp5G,QAAQ/W,CAAIwJ,GAAAA,SAAQ6mH,YAAY;AACrEU,uBAAeE;AACfl6G,gBAAQ/W,CAAGrC,EAAAA,QAAQ0yH;AAAAA,MACnB;AAED,UAAA,CAAKU,YACJ;AAAA,IAED;AAED,QAAIG,YAAYH,YACf;AAAA,EACD;AAGD,MAAIA,eAAeH,kBAAkB;AACpC,QAAIP,YAAYt5G,QAAQ65G,WAAAA,EAAajzH,QAAQozH;AAC7C,QAAIV,aAAansH,KAAKisH,gBAAgBp5G,QAAQ65G,cAAcpnH,SAAQ6mH,SAAAA,EACnEt5G,SAAQ65G,WAAajzH,EAAAA,QAAQ0yH;AAAAA,EAC9B;AAKD,SAAOnsH,KAAKitH,mBAAAA;AACZ,GAEDA,oBAAoB;AACnB,MAAIp6G,UAAU7S,KAAKstB,eAAAA;AACnB,MAAI4/F,aAAa;AAEjB,WAASpxH,IAAI,GAAGA,IAAI+W,QAAQ9W,QAAQD,KAAK;AACxC,QAAIqxH,IAAIC,WAAWv6G,QAAQ/W,CAAGrC,EAAAA,KAAAA;AAC9B,QAAIhB,OAAO0B,MAAMgzH,CAAAA,GAAI;AACpB,aAAO;AAAA,IACP;AACDD,kBAAcC;AAAAA,EACd;AACD,SAAOD;AACP,GACD3B,qBAAqB,WAAA;AACpB,MAAIjmH,UAAStF,KAAK6mG,WAClB;AAAA,MAAIh0F,UAAU7S,KAAKstB,eAAAA;AACnB,MAAI4/F,aAAa;AACjB,MAAIG,UAAU,CACd;AAAA,MAAI5zH,QAAQ,CAEZ;AAAA,WAASqC,IAAI,GAAGA,IAAI+W,QAAQ9W,QAAQD,KAAK;AACxC,QAAIqxH,IAAIC,WAAWv6G,QAAQ/W,CAAAA,EAAGrC;AAC9B,QAAIhB,OAAO0B,MAAMgzH,CAAI,GAAA;AACpBA,UAAI7nH,QAAO0wC,yBAAyB;AACpCq3E,cAAQruH,KAAKlD,CAAAA;AAAAA,IACb;AACDrC,UAAMqC,CAAKqxH,IAAAA;AACXD,kBAAcC;AAAAA,EACd;AACD,MAAIG,YAAYttH,KAAKorH,cAAAA,IAAkB;AACvC,MAAI9lH,QAAO2uC,WAAWo5E,QAAQtxH,QAAQ;AACrC,QAAIm1D,OAAOo8D,YAAYJ;AAKvB,QAAI5nH,QAAO2uC,YAAY3uC,QAAO8wC,sBAAsB;AAEnD,eAASt6C,IAAI,GAAGA,IAAIrC,MAAMsC,QAAQD,KAAK;AACtC,YAAIyxH,QAAQj0H,KAAKC,MAAM23D,QAAQz3D,MAAMsC,SAASD,EAC9CrC;AAAAA,cAAMqC,CAAMyxH,KAAAA;AACZ,YAAIpB,YAAYnsH,KAAKisH,gBAAgBp5G,QAAQ/W,CAAIwJ,GAAAA,SAAQ7L,MAAMqC,CAAAA,CAAAA;AAE/D,YAAIqwH,aAAa1yH,MAAMqC,CAAI,GAAA;AAC1ByxH,kBAAQpB,YAAY1yH,MAAMqC,CAC1BrC;AAAAA,gBAAMqC,KAAKqwH;AAAAA,QACX;AACDj7D,gBAAQq8D;AAAAA,MACR;AAAA,IACL,WAAcF,QAAQtxH,QAAQ;AAE1B,eAASD,IAAI,GAAGA,IAAIuxH,QAAQtxH,QAAQD,KAAK;AACxC,YAAIyxH,QAAQj0H,KAAKC,MAAM23D,QAAQm8D,QAAQtxH,SAASD,EAChD;AAAA,YAAI0K,QAAQ6mH,QAAQvxH,CAAAA;AACpBrC,cAAM+M,KAAAA,KAAU+mH;AAChB,YAAIpB,YAAYnsH,KAAKisH,gBAAgBp5G,QAAQrM,KAAAA,GAAQlB,SAAQ7L,MAAM+M;AACnE,YAAI2lH,aAAa1yH,MAAM+M,KAAAA,GAAQ;AAC9B+mH,kBAAQpB,YAAY1yH,MAAM+M,KAAAA;AAC1B/M,gBAAM+M,KAAS2lH,IAAAA;AAAAA,QACf;AACDj7D,gBAAQq8D;AAAAA,MACR;AAAA,IACD;AAED,aAASzxH,IAAI,GAAGA,IAAIrC,MAAMsC,QAAQD,KAAK;AACtC+W,cAAQ/W,CAAGrC,EAAAA,QAAQA,MAAMqC,CAAAA;AAAAA,IACzB;AAAA,EACJ,OAAS;AACN,QAAIo9F,UAAWo0B,aAAaJ;AAC5BltH,SAAKyQ,QAAQhX,QAAQyzH,aAAa;AAClC5nH,IAAAA,QAAO6vG,aAAa+X;AACpB,QAAIh0B,SAAS;AACZl5F,WAAKunG,QAAQ8R,gBAAgBr5G,KAAKyQ,QAAQhX,OAAO,IAAA;AAAA,IACjD;AAAA,EACD;AAED,GAED+xH,mBAAmB;AAClB,MAAIzoH,SAAQ/C,KAAKsgE;AACjB,MAAIh7D,UAAStF,KAAK6mG,WAAAA;AAClB,MAAI1wF,UAASnW,KAAKsgE,OAAOnqD;AACzB,MAAIjB,aAAYlV,KAAKsgE,OAAOprD;AAE5B,MAAIrC,UAAU7S,KAAKstB,eACnB;AAAA,MAAIhoB,QAAOmZ,KAAK;AACf5L,cAAUA,QAAQg/C;EAClB;AACD,MAAI/jC,QAAQ,CACZ;AAAA,MAAIr0B,QAAQ,GACX2c,SAASD,QAAOC;AAEjB,MAAIo3G,aAAaloH,QAAO8Y,eAAe;AAEvC,WAAStiB,IAAI,GAAGA,IAAI+W,QAAQ9W,QAAQD,KAAK;AACxC,QAAI2/B,OAAO3/B,KAAK+W,QAAQ9W,SAAS;AACjC,QAAIqc,MAAMvF,QAAQ/W,CAAAA;AAGlB,QAAKsc,CAAAA,IAAI/a,MAAM;AACd+a,UAAI/a,OAAO0F,OAAM01B,IAAQ,IAAA;AAAA,IACzB;AAED,QAAIg1F,WAAWr1G,IAAI3e,QAAQ;AAE3B,QAAI6zH,YAAYttH,KAAKorH,cAAAA;AACrB,QAAI3vF,QAAQ6xF,YAAY7zH,QAAQg0H,SAC/Br1G,KAAI3e,QAAQg0H,WAAWH,YAAY7zH;AACpCA,aAASg0H;AACT,QAAIxxH,OAAQ8G,OAAM64F,SAASxjF,IAAI/a,QAAQ0F,OAAM64F,MAAMv+F,OAAI,wBAA6B+a,IAAI/a,IAAAA,6BAAiC0F,OAAM64F,MAAMnM,SAAAA,aAAuB;AAC5J,QAAIyzB,WAAW,CAAC,wBACd,qBAAqB9qG,IAAI/a,MACzBo+B,OAAO,oBAAoB,IAC5BvmB,WAAUiyC,kBAAkB/uC,IAAI/a,MAAM+a,GAAAA,CAAAA,EAAM5c,KAAK,GAElD;AAAA,QAAIxB,QAAQ,YAAYyzH,YAAYhyF,OAAO,IAAI,MAAM;AACrD,QAAIvlB,QAASkC,IAAIlC,SAASE,OAAO,YAAYgC,IAAI/a,IAAAA,KAAS+Y,OAAOgC,IAAI/a;AACrE6Y,YAAQA,SAAS;AAEjB,QAAIw3G,YAAY3qH,OAAM08B,SAASkuF,wBAAwBv1G,KAAKlC,KAE5D;AAAA,QAAIymB,OAAO,iBAAiBumF,WAAW,cAAclpH,QAAQ,OAAO0zH,YACnE,sBAAsBt1G,IAAI/a,OAAO,kBAAkB+a,IAAI/a,OAAO,yBACtC+a,IAAI/a,OAAO,0BAA0BvB,IAAI,OAC3Doa,QAAQja,OAAO;AACtB6xB,UAAM9uB,KAAK29B,IAAAA;AAAAA,EACX;AACD38B,OAAK6tB,YAAY7zB,MAAMN,SAAU4L,QAAmB,eAAI;AACxDtF,OAAK6tB,YAAY7zB,MAAMuuH,aAAaiF,aAAa;AAEjDxtH,OAAK6tB,YAAYxvB,YAAYyvB,MAAMtyB,KAAK,EAAA;AAExC,MAAIwE,KAAKoqH,uBAAuB;AAC/BpqH,SAAKoqH,sBACL;AAAA,EAAA;AACD,GAEDgB,eAAe;AAEd,SAAOprH,KAAKyQ,QAAQhX;AACpB,GAEDwV,YAAY,WACXjP;AAAAA,OAAKyiH,aAAaziH,KAAKsgE,MACvB;AAAA,MAAItgE,KAAKqqH,iBAAiB;AACzBrqH,SAAKqqH,gBAAgBp7G,WAAAA;AACrBjP,SAAKqqH,kBAAkB;AAAA,EACvB;AACDrqH,OAAKmlH,aACLnlH;AAAAA,OAAKkvB,QAAQ;AACblvB,OAAK6tB,cAAc;AACnB7tB,OAAK2vB,aAAa;AAClB3vB,OAAKsgE,SAAS;AACd,MAAItgE,KAAKyQ,QAAQqtG,UAAU;AAC1B99G,SAAKyQ,QAAQqtG,SAAS11G,YAAYpI,KAAKqiH,gBACvCriH;AAAAA,SAAKyQ,QAAQqtG,WAAW;AAAA,EACxB;AAED99G,OAAK+H,UAAU,aAAa;AAC5B/H,OAAKuI,gBAAAA;AACL;ACjsBF,MAAeqlH,iBAAA,EACdtwE,MAAM,SAAU7gB,YAAYvM;AAC3B,MAAIntB,SAAQmtB,KAAKowC;AAEjBv9D,EAAAA,OAAMyE,YAAY,eAAe,SAAUP,IAAI/H,GAAAA;AAC9C,QAAI6D,OAAMo5B,oBAAoBj9B,CAC7B,EAAA,QAAO;AACR,QAAI0E,QAAQ64B,WAAWlvB,SACvB;AAAA,QAAIovB,OAAOF,WAAWG,WAAW19B,EAAEI;AAEnC,QAAIq9B,QAAQF,WAAWK,gBAAgBH,KAAK/E,UAAAA,GAAa;AACxD,UAAI6E,WAAW9iC,UAAeiK,KAAAA,MAAMqD,MAAM01B,KAAK11B,MAAMrD,MAAMg0B,cAAc+E,KAAK/E,WAEvE;AAAA,WAAA;AACN6E,mBAAWM,UAAUJ,KAAK11B,IAAI01B,KAAK/E,UACnC;AAAA,MAAA;AACD,aAAO;AAAA,IACP;AACD,WAAO;AAAA,EACV,CAAA;AAEE70B,EAAAA,OAAMyE,YAAY,gBAAgB,WACjC;AAAA,QAAIi1B,WAAW9iC,UAAAA,KAAe8iC,WAAWoxF,UAAa,GAAA;AACrDpxF,iBAAWqxF,KACf;AAAA,IAAA,OAAU;AACNrxF,iBAAW7G,KAAAA;AAAAA,IACX;AACD,WAAO;AAAA,EACV,CAAA;AAEE7yB,EAAAA,OAAMyE,YAAY,kBAAkB,SAAUP,IAAI/H,GACjD;AAAA,QAAI0E,QAAQ64B,WAAWlvB,SAAAA;AACvB,QAAIovB,OAAOF,WAAWG,WAAW19B,EAAEI,MACnC;AAAA,QAAIq9B,QAAQF,WAAW9iC,UAAAA,KAAegjC,KAAK/E,cAAch0B,MAAMg0B,YAAY;AAI1E,aAAO;AAAA,IACP;AACD,WAAO;AAAA,EACV,CACE;AAAA,GAEDm2F,QAAQ,SAAUtxF,YAAY7F,aAAa1G,MAAAA;AAC1C,MAAIntB,SAAQmtB,KAAKowC;AAGjB,MAAGv9D,OAAMoC,OAAOpC,OAAMoC,IAAIizB,oBAAmB;AAC5C,QAAI41F,SAASjrH,OAAMoC,IAAIizB;AACvB41F,WAAOxmH,YAAY,aAAa,SAASggB,SAAStoB,GAAAA;AACjD,UAAI6kG,WAAWhhG,OAAMotC,UAAUC;AAC/B,UAAInpB,UAAU/nB,EAAE+nB;AAChB,UAAIgnG,gBAAgB;AAEpB,cAAQhnG,SACP;AAAA,QAAA,KAAK88E,SAAStzD;AACb,cAAGhU,WAAW9iC,UAAAA,GAAY;AACzBs0H,4BAAgB;AAAA,UAChB;AACD;AAAA,MAAA;AAEF,UAAIA,eAAc;AACjB,eAAO;AAAA,MACZ,OAAU;AACL,eAAO;AAAA,MACP;AAAA,IACL;EACG;AAEDr3F,cAAYutE,YAAY,SAAUjlG,GAAAA;AACjCA,QAAIA,KAAKzG,OAAO4G;AAEhB,QAAI0kG,WAAWhhG,OAAMotC,UAAUC;AAC/B,QAAIlxC,EAAEy0B,oBAAqBz0B,EAAE4oB,YAAY5oB,EAAE+nB,WAAW88E,SAASlzD,KAAM;AACpE;AAAA,IACA;AAED,QAAIq9E,gBAAgB;AACpB,YAAQhvH,EAAE+nB,SAAAA;AAAAA,MACT,KAAKlkB,OAAMge,KAAKuhF;AACf7lE,mBAAWqxF,KACX;AAAA;AAAA,MACD,KAAK/qH,OAAMge,KAAKwhF;AACf9lE,mBAAW7G,KACX;AAAA;AAAA,MACD,KAAKmuE,SAAS1zD;AAAAA,MACd,KAAK0zD,SAASzzD;AACb,YAAI7T,WAAW9iC,UAAa,GAAA;AAC3B8iC,qBAAW7G,KACXs4F;AAAAA,0BAAgB;AAAA,QAChB;AACD;AAAA,MACD,KAAKnqB,SAASlzD;AACb,YAAI3xC,EAAE4oB,UAAU;AACf2U,qBAAW0xF,aAAa,IAC9B;AAAA,QAAA,OAAY;AACN1xF,qBAAW2xF,aAAa,IACxB;AAAA,QAAA;AACD;AAAA,MACD;AACCF,wBAAgB;AAChB;AAAA,IAAA;AAGF,QAAIA,eAAe;AAClBhvH,QAAE0rB,eACF;AAAA,IAAA;AAAA,EACJ;AACE,GACDyjG,QAAQ,WAAA;AAEP,GAED9O,SAAS,WAAA;AAER;ACnHF,MAAe+O,iBAAA,EACdhxE,MAAM,SAAS7gB,YAAYvM,MAAAA;AAC1B,MAAI+kC,OAAOx4B;AACX,MAAI15B,SAAQmtB,KAAKowC;AAEjB,MAAIiuD,cAAc;AAClB,MAAIP,SAASjrH,OAAMoC,IAAIizB;AACvB41F,SAAOxmH,YAAY,iBAAiB,SAAU5N,MAAAA;AAC7C,QAAI40H,aAAa/xF,WAAWG,WAAWhjC,IAAAA;AACvCiR,iBAAa0jH,WAAAA;AACb,QAAIC,YAAY;AACf,UAAI52F,aAAa42F,WAAW52F;AAC5B,UAAI3wB,KAAKunH,WAAWvnH;AAEpB,UAAIwnH,cAAcx5D,KAAK1nD,SAAAA;AACvB,UAAG0nD,KAAKt7D,UAAAA,GAAY;AACnB,YAAG80H,YAAYxnH,MAAMA,MAAMwnH,YAAY72F,eAAeA,YAAY;AACjE,iBAAO;AAAA,QACP;AAAA,MACD;AAAA,IACD;AACD,WAAO;AAAA,EACV,CAAA;AAEEo2F,SAAOxmH,YAAY,WAAW,SAAU5N,MAAAA;AACvC,QAAI40H,aAAa/xF,WAAWG,WAAWhjC,IAAAA;AACvC,QAAIgK,QAAQ64B,WAAWlvB,SAAAA;AACvB1C,iBAAa0jH,WACb;AAAA,QAAIC,cAAgBA,EAAAA,WAAWvnH,MAAMrD,MAAMqD,MAAMunH,WAAW52F,cAAch0B,MAAMg0B,aAAa;AAC5F,UAAGq9B,KAAKt7D,UAAAA,GAAY;AACnBs7D,aAAK64D,KACL;AAAA,MAAA;AAAA,IACD;AACD,WAAO;AAAA,EACV;AAEErxF,aAAWj1B,YAAY,UAAU,WAChCqD;AAAAA,iBAAa0jH,WAChB;AAAA,EAAA,CAAA;AAEEP,SAAOxmH,YAAY,UAAU,WAC5B+mH;AAAAA,kBAAc3jH,WAAW,WACxBqqD;AAAAA,WAAK64D;IACT,CAEG;AAAA,WAAO;AAAA,EACV,CAAA;AAEE/qH,EAAAA,OAAMyE,YAAY,kBAAkB,SAASP,IAAG/H,GAE/C;AAAA,QAAI0E,QAAQ64B,WAAWlvB;AACvB,QAAIovB,OAAOF,WAAWG,WAAW19B,EAAEI,MAAAA;AACnC,QAAGq9B,QAAQF,WAAW9iC,eAAegjC,KAAK/E,cAAch0B,MAAMg0B,YAAW;AACxE,aAAO;AAAA,IACP;AACD,WAAO;AAAA,EACV,CAEE70B;AAAAA,EAAAA,OAAMyE,YAAY,eAAe,SAAUP,IAAI/H,GAC9C;AAAA,QAAG6D,OAAMo5B,oBAAoBj9B,CAC5B,EAAA,QAAO;AAER,QAAI0E,QAAQ64B,WAAWlvB,SACvB;AAAA,QAAIovB,OAAOF,WAAWG,WAAW19B,EAAEI,MAAAA;AAEnC,QAAIq9B,QAAQF,WAAWK,gBAAgBH,KAAK/E,UAAa,GAAA;AACxD,UAAG6E,WAAW9iC,eAAeiK,MAAMqD,MAAM01B,KAAK11B,MAAMrD,MAAMg0B,cAAc+E,KAAK/E,WAExE;AAAA,WAAA;AACJ6E,mBAAWM,UAAUJ,KAAK11B,IAAI01B,KAAK/E,UAAAA;AAAAA,MACnC;AACD,aAAO;AAAA,IACP;AACD,WAAO;AAAA,EACV,CAAA;AACE70B,EAAAA,OAAMyE,YAAY,gBAAgB;AACjCytD,SAAK64D,KAAAA;AACL,WAAO;AAAA,EACV,CAEEE;AAAAA,SAAOxmH,YAAY,aAAa,SAASggB,SAAStoB,GACjD;AAAA,QAAIsvH,aAAa/xF,WAAWG,WAAW19B,EAAEI,MAAAA;AACzC,QAAIovH,YAAYF,aAAa/xF,WAAWK,gBAAgB0xF,WAAW52F,UAAAA,IAAc;AAEjF,QAAIh0B,QAAQ64B,WAAWlvB,SAAAA;AACvB,QAAIw2F,WAAWhhG,OAAMotC,UAAUC;AAC/B,QAAInpB,UAAU/nB,EAAE+nB;AAChB,QAAIgnG,gBAAgB;AAEpB,YAAQhnG,SACP;AAAA,MAAA,KAAK88E,SAASrzD;AACb,YAAGjU,WAAW9iC,UAAAA,GAAY;AACzB8iC,qBAAWqxF,KACX5uH;AAAAA,YAAE0rB;AACFqjG,0BAAgB;AAAA,QACtB,WAAcS,aAAexvH,EAAAA,EAAE8oB,WAAW9oB,EAAE+oB,WAAW/oB,EAAE4oB,WAAU;AAC7DmtC,eAAKl4B,UAAUyxF,WAAWvnH,IAAIunH,WAAW52F,UACzC14B;AAAAA,YAAE0rB;AACFqjG,0BAAgB;AAAA,QAChB;AACD;AAAA,MACD,KAAKlqB,SAASnzD;AACb,YAAGnU,WAAW9iC,UAAY,GAAA;AACzB8iC,qBAAW7G,KAAAA;AACX12B,YAAE0rB,eACFqjG;AAAAA,0BAAgB;AAAA,QAChB;AACD;AAAA,MACD,KAAKlqB,SAAS1zD;AAAAA,MACd,KAAK0zD,SAASzzD;AACb;AAAA,MACD,KAAKyzD,SAASxzD;AAAAA,MACd,KAAKwzD,SAASvzD;AACb,YAAIk+E,aAAajyF,WAAW9iC,UAAgBiK,KAAAA,MAAM+qH,eAAe,QAAO;AACvEV,0BAAgB;AAAA,QAChB;AACD;AAAA,MACD,KAAKlqB,SAAStzD;AACb,YAAGhU,WAAW9iC,UAAAA,GAAY;AACzBs0H,0BAAgB;AAAA,QAChB;AAED,YAAGS,aAAcjyF,CAAAA,WAAW9iC,UAAY,GAAA;AACvCs7D,eAAKl4B,UAAUyxF,WAAWvnH,IAAIunH,WAAW52F,UACzC14B;AAAAA,YAAE0rB;AACFqjG,0BAAgB;AAAA,QAChB;AACD;AAAA,MACD,KAAKlqB,SAASpzD;AACb,YAAG+9E,aAAcjyF,CAAAA,WAAW9iC,UAAY,GAAA;AACvCs7D,eAAKl4B,UAAUyxF,WAAWvnH,IAAIunH,WAAW52F,UACzCq2F;AAAAA,0BAAgB;AAAA,QAChB,WAASS,aAAajyF,WAAW9iC,UAAY,GAAA;AAC7Cs0H,0BAAgB;AAAA,QAChB;AACD;AAAA,MACD,KAAKlqB,SAASlzD;AACb,YAAGpU,WAAW9iC,UAAY,GAAA;AAEzB,cAAGuF,EAAE4oB,UAAS;AACb2U,uBAAW0xF,aAAa,IAAA;AAAA,UAC/B,OAAW;AACJ1xF,uBAAW2xF,aAAa,IAAA;AAAA,UACxB;AACD,cAAIpwD,WAAWvhC,WAAWlvB;AAC1B,cAAGywD,SAAS/2D,IAAG;AACd+mH,mBAAOviG,MAAM,EAACxZ,MAAK,YAAYhL,IAAI+2D,SAAS/2D,IAAI0uB,QAAOqoC,SAASpmC,WAAAA,CAAAA;AAAAA,UAChE;AACD14B,YAAE0rB,eAAAA;AACFqjG,0BAAgB;AAAA,QAChB;AACD;AAAA,MACD;AACC,YAAGxxF,WAAW9iC,YACbs0H,iBAAgB;AAAA,aACb;AAGH,cAAIhnG,WAAW,MAAMA,WAAW,MAC9BA,UAAU,MAAMA,UAAU,OAC1BA,WAAW,MAAMA,WAAW,MAC5BA,UAAU,OAAOA,UAAU,OAC3BA,UAAU,OAAQA,UAAU,KAC7B;AACA,gBAAIL,YAAYY,QAAQZ;AAExB,gBAAIgoG,cAAchoG,UAAUE,OAAOF,UAAUG,QAAQH,UAAUI,QAAQJ,UAAUC;AACjF,gBAAGD,UAAUE,IAAAA;AAAAA,qBAEH8nG,eAAeZ,OAAO/1F,kBAAkBzQ,SAAS,UAErD,EAAA;AAAA,qBAAGknG,aAAcjyF,CAAAA,WAAW9iC,UAAY,GAAA;AAC7Cs7D,mBAAKl4B,UAAUyxF,WAAWvnH,IAAIunH,WAAW52F,UAAAA;AACzCq2F,8BAAgB;AAAA,YAChB;AAAA,UACD;AAAA,QACD;AAED;AAAA,IAGF;AAAA,QAAIA,eAAc;AACjB,aAAO;AAAA,IACX,OAAS;AACL,aAAO;AAAA,IACP;AAAA,EAEJ,CAAA;AACE,GACDF,QAAQ,SAAStxF,YAAY7F,aAAa1G,MAAO;AAAA,GACjDm+F,QAAQ,SAAS5xF,YAAY7F,aAAa1G,MACzC;AAAA,QAAMntB,SAAQmtB,KAAKowC;AACnB,MAAIv9D,QAAM;AACTA,IAAAA,OAAM0oB;EACN;AAED,GACD8zF,SAAS,WAAY;AAAA,EAAA;AClMP,SAAQsP,mBAAC9rH,QAEvB;AAAA,MAAI+rH,UAAU;AAEd,SAAO,EACNC,YAAY,SAASxlH;AACpBulH,cAAUvlH;AAAAA,EACV,GACDylH,YAAY,WAEX;AAAA,QAAGF,SAAQ;AACV,aAAOA;AAAAA,IACX,WAAY/rH,OAAMuC,OAAO2oB,6BAA6BlrB,OAAMoC,IAAIizB,oBAAmB;AAC/E,aAAOk2F;AAAAA,IACX,OAAQ;AACJ,aAAOV;AAAAA,IACP;AAAA,EACD;AAEH;ACtBe,SAAQqB,YAAElsH,QAAAA;AAExB,MAAImsH,aAAa;EAClB;AAECA,aAAWvzH,YAAY,EACtBwiC,MAAM,SAAUl3B,IAAI0uB,QAAQrwB,SAAQsxB,aAAAA;AAAAA,EACnC,GACDhB,MAAM;EACL,GACDu5F,WAAW,SAAUp2G,OAAO9R,IAAI0uB,QAAQ/7B,MACvCoG;AAAAA,SAAKovH,UAAUx1H,IAAAA,EAAMmf,QAAQA;AAAAA,EAC7B,GACDs2G,WAAW,SAAUpoH,IAAI0uB,QAAQ/7B,MAChC;AAAA,WAAOoG,KAAKovH,UAAUx1H,IAAAA,EAAMmf,SAAS;AAAA,EACrC,GACDu2G,YAAY,SAAUv2G,OAAO9R,IAAI0uB,QAAQ/7B,MACxC;AAAA,QAAI21H,eAAevvH,KAAKqvH,UAAUpoH,IAAI0uB,QAAQ/7B,IAC9C;AAAA,QAAI21H,gBAAgBx2G,SAASw2G,aAAa9hH,WAAWsL,MAAMtL,SAAS;AACnE,aAAO8hH,aAAa9hH,QAAasL,KAAAA,MAAMtL,QAC3C;AAAA,IAAA,OAAU;AACN,aAAO8hH,gBAAgBx2G;AAAAA,IACvB;AAAA,EACD,GACDy2G,UAAU,SAAUz2G,OAAO9R,IAAI0uB,QAAQ/7B,MACtC;AAAA,WAAO;AAAA,EACP,GAEDk0H,MAAM,SAAU7mH,IAAI0uB,QAAQ/7B,MAAAA;AAAAA,EAE3B,GACDw1H,WAAW,SAAUx1H,MACpB;AAAA,WAAOA,KAAKqE,cAAc;EAC1B,GACDwtB,OAAO,SAAU7xB,MAChB;AAAA,QAAIiB,QAAQmF,KAAKovH,UAAUx1H,IAC3B;AAAA,QAAA,CAAKiB,OAAO;AACX;AAAA,IACA;AACD,QAAIA,MAAM4wB,OAAO;AAChB5wB,YAAM4wB;IACN;AAED,QAAI5wB,MAAMC,QAAQ;AACjBD,YAAMC;IACN;AAAA,EACD,EAAA;AAEF,SAAOo0H;AACR;AC5Ce,SAAQO,kBAAC1sH,QAAAA;AAEvB,MAAImsH,aAAaD,YAEjB;AAAA,WAASS;AACR,QAAIz6D,OAAOi6D,WAAWjvH,MAAMD,MAAM4G,SAAAA,KAAc5G;AAChD,WAAOi1D;AAAAA,EACP;AAEDw9C,YAAUid,YAAYR,UAAAA;AAEtB3oE,QAAYmpE,WAAW/zH,WAAW,EACjCwiC,MAAM,SAAUl3B,IAAI0uB,QAAQrwB,SAAQsxB,aACnC;AAAA,QAAIpZ,OAAO,6CAA6CmY,OAAOt4B,IAAgBs4B,YAAAA,OAAOt4B;AACtFu5B,gBAAYv4B,YAAYmf;AAAAA,EACxB,EACC,GAAA,IAAA;AAEH,SAAOkyG;AACR;ACnBe,SAAQC,oBAAC5sH,QAEvB;AAAA,MAAImsH,aAAaD,YAEjB;AAAA,WAASW;AACR,QAAI36D,OAAOi6D,WAAWjvH,MAAMD,MAAM4G,SAAAA,KAAc5G;AAChD,WAAOi1D;AAAAA,EACP;AAEDw9C,YAAUmd,cAAcV,UAAAA;AAExB3oE,QAAYqpE,aAAaj0H,WAAW,EACnCwiC,MAAM,SAAUl3B,IAAI0uB,QAAQrwB,SAAQsxB,aAAAA;AACnC,QAAI7qB,MAAMzG,QAAOyG,OAAO,GACvBlP,MAAMyI,QAAOzI,OAAO;AAErB,QAAI2gB,OAAO,8CAA8CzR,GAAAA,UAAalP,GAAc84B,WAAAA,OAAOt4B,IAAgBs4B,YAAAA,OAAOt4B;AAClHu5B,gBAAYv4B,YAAYmf;AAGxBoZ,gBAAYi5F,UAAU,SAAU3wH;AAC/B,UAAKA,CAAAA,EAAEI,OAAOyZ,QAAQhN,KAAK;AAC1B7M,UAAEI,OAAOyZ,QAAQhN;AAAAA,MACjB;AACD,UAAA,CAAK7M,EAAEI,OAAOyZ,QAAQlc,KAAK;AAC1BqC,UAAEI,OAAOyZ,QAAQlc;AAAAA,MACjB;AAAA,IACL;AAAA,EACG,GACDwyH,WAAW,SAAUpoH,IAAI0uB,QAAQ/7B,MAAAA;AAChC,WAAOoG,KAAKovH,UAAUx1H,MAAMmf,SAAS;AAAA,EACrC,GACDy2G,UAAU,SAAUz2G,OAAO9R,IAAI0uB,QAAQ/7B,MAAAA;AACtC,YAAQO,MAAMlB,SAAS8f,OAAO,EAC9B,CAAA;AAAA,EAAA,EAAA,GACC,IAEH;AAAA,SAAO62G;AACR;ACtCe,SAAQE,oBAAC/sH,QAAAA;AAEvB,MAAImsH,aAAaD,YAAAA;AAEjB,WAASc,eACR;AAAA,QAAI96D,OAAOi6D,WAAWjvH,MAAMD,MAAM4G,cAAc5G;AAChD,WAAOi1D;AAAAA,EACP;AAEDw9C,YAAUsd,cAAcb;AAExB3oE,QAAYwpE,aAAap0H,WAAW,EACnCwiC,MAAM,SAAUl3B,IAAI0uB,QAAQrwB,SAAQsxB;AACnC,QAAIpZ,OAAO,kCAAkCmY,OAAOt4B,IAAAA,YAAgBs4B,OAAOt4B,IAAAA;AAC3E,QAAI2yH,cAAc,IACjBj9C,UAAUztE,QAAOytE,WAAW,CAAA;AAE7B,aAASj3E,IAAI,GAAGA,IAAIi3E,QAAQh3E,QAAQD,KAAK;AACxCk0H,kBAAYhxH,KAAK,oBAAoBsG,QAAOytE,QAAQj3E,CAAAA,EAAGud,MAAM,OAAO05D,QAAQj3E,CAAGoa,EAAAA,QAAQ,WACvF;AAAA,IAAA;AAEDsH,YAAQwyG,YAAYx0H,KAAK,EAAM,IAAA;AAC/Bo7B,gBAAYv4B,YAAYmf;AAAAA,EACxB,GACD4xG,WAAW,SAAUx1H,MAAAA;AACpB,WAAOA,KAAKqE,cAAc,QAC1B;AAAA,EAAA,EAAA,GACC;AAEH,SAAO8xH;AACR;AC/Be,SAAQE,kBAAEltH,QACxB;AAAA,MAAImsH,aAAaD,YAAAA;AAIjB,MAAIiB,kBAAkB;AAEtB,MAAIl1E,aAAY;AAChB,MAAIO,aAAY;AAEhB,WAAS+B,OAAAA;AACR,QAAKtC,CAAAA,YAAW;AACfA,MAAAA,aAAYj4C,OAAMsP,KAAKqD,YAAYw6G,eAAAA;AAAAA,IACnC;AACD,QAAK30E,CAAAA,YAAW;AACfA,MAAAA,aAAYx4C,OAAMsP,KAAKC,YAAY49G,eACnC;AAAA,IAAA;AAAA,EACD;AAED,WAASC,aACR;AAAA,QAAIl7D,OAAOi6D,WAAWjvH,MAAMD,MAAM4G,SAAAA,KAAc5G;AAEhD,WAAOi1D;AAAAA,EACP;AAEDw9C,YAAU0d,YAAYjB,UAEtB3oE;AAAAA,QAAY4pE,WAAWx0H,WAAW,EACjCwiC,MAAM,SAAUl3B,IAAI0uB,QAAQrwB,SAAQsxB,aACnC0mB;AAAAA,SAAAA;AACA,QAAI8yE,WAAW;AACf,QAAIC,WAAW;AAEf,QAAU/qH,OAAAA,QAAOyG,QAAQ,YAAW;AACnCqkH,iBAAW9qH,QAAOyG,IAAI9E,IAAI0uB,MAAAA;AAAAA,IAC9B,OAAQ;AACJy6F,iBAAW9qH,QAAOyG;AAAAA,IAClB;AAED,QAAA,OAAUzG,QAAOzI,QAAQ,YAAW;AACnCwzH,iBAAW/qH,QAAOzI,IAAIoK,IAAI0uB,MAC9B;AAAA,IAAA,OAAQ;AACJ06F,iBAAW/qH,QAAOzI;AAAAA,IAClB;AAED,QAAIyzH,UAAUF,WAAW,WAAWp1E,WAAUo1E,YAAU,OAAQ;AAChE,QAAIG,UAAUF,WAAW,WAAWr1E,WAAUq1E,QAAU,IAAA,OAAQ;AAChE,QAAI7yG,OAAO,2DAA2D8yG,OAAWC,IAAAA,OAAAA,UAAiB56F,OAAOt4B,IAAAA,YAAgBs4B,OAAOt4B,IAAAA;AAChIu5B,gBAAYv4B,YAAYmf;AAGxBoZ,gBAAYi5F,UAAU,SAAU3wH;AAC/B,UAAIA,EAAEI,OAAOyZ,UAAUq3G,YAAYC,WAAU;AAC5C,YAAKttH,CAAAA,OAAMsP,KAAKC,YAAY,UAAvBvP,EAAmC7D,EAAEI,OAAOyZ,KAAAA,IAAAA,CAAUq3G,UAAU;AACpElxH,YAAEI,OAAOyZ,QAAQhW,OAAMsP,KAAKqD,YAAY,UAAvB3S,EAAmCqtH;QACpD;AACD,YAAA,CAAKrtH,OAAMsP,KAAKC,YAAY,UAAA,EAAYpT,EAAEI,OAAOyZ,KAAUs3G,IAAAA,CAAAA,UAAU;AACpEnxH,YAAEI,OAAOyZ,QAAQhW,OAAMsP,KAAKqD,YAAY,UAAvB3S,EAAmCstH;QACpD;AAAA,MACD;AAAA,IACL;AAAA,EACG,GACDlB,WAAW,SAAUp2G,OAAO9R,IAAI0uB,QAAQ/7B,MAAAA;AACvC,QAAImf,SAASA,MAAM9O,aAAa;AAC/BjK,WAAKovH,UAAUx1H,IAAMmf,EAAAA,QAAQiiC,WAAUjiC,KAC3C;AAAA,IAAA,OAAU;AACN/Y,WAAKovH,UAAUx1H,IAAAA,EAAMmf,QAAQA;AAAAA,IAC7B;AAAA,EACD,GACDy2G,UAAU,SAAUz2G,OAAO9R,IAAI0uB,QAAQ/7B,MACtC;AAAA,QAAA,CAAKmf,SAAS5e,MAAM4e,MAAM1O,QACzB,CAAA,EAAA,QAAO;AACR,WAAO;AAAA,EACP,GACDglH,WAAW,SAAUpoH,IAAI0uB,QAAQ/7B,MAChC;AAAA,QAAI6gB;AACJ,QACCA;AAAAA,eAAS8gC,WAAUv7C,KAAKovH,UAAUx1H,MAAMmf,SAAS,EAAA;AAAA,IACjD,SAAQ7Z,GACRub;AAAAA,eAAS;AAAA,IACT;AAED,WAAOA;AAAAA,EACP,EAAA,GACC,IAEH;AAAA,SAAO01G;AACR;ACtFe,SAAQK,yBAACztH,QAAAA;AAEvB,MAAImsH,aAAaD;AAEjB,WAASwB,oBAAAA;AACR,QAAIx7D,OAAOi6D,WAAWjvH,MAAMD,MAAM4G,SAAAA,KAAc5G;AAChD,WAAOi1D;AAAAA,EACP;AAEDw9C,YAAUge,mBAAmBvB,UAAAA;AAE7B,WAASwB,aAAaprH,SACrB;AAAA,WAAOA,QAAOqrH,aAAa5tH,OAAMoC,IAAIg1E,WAAWG,cAChD;AAAA,EAAA;AAED,WAASs2C,iBAAiB73G,OAAOzT;AAChC,QAAIurH,gBAAgB93G,SAAS,IAAIzb,MAAMgI,QAAOwrH,aAAa,GAC3D;AAAA,aAASh1H,IAAI,GAAGA,IAAI+0H,aAAa90H,QAAQD,KAAK;AAC7C,UAAIqhB,MAAM0zG,aAAa/0H,CAAAA,EAAGiE,KAC1B;AAAA,UAAIod,KAAK;AACR0zG,qBAAa/0H,KAAKqhB;AAAAA,MACtB,OAAU;AACN0zG,qBAAax0H,OAAOP,GAAG,CAAA;AACvBA;AAAAA,MACA;AAAA,IACD;AACD+0H,iBAAa50H,KAAAA;AACb,WAAO40H;AAAAA,EACP;AAED,WAASE,mBAAmB5iH,MAAM7I,SAAQvC,QAAAA;AACzC,QAAI4a,QAAQxP,KAAKu+B;AACjB,QAAIt2B,SAAS,CACb;AAAA,aAASta,IAAI,GAAGA,IAAI6hB,MAAM5hB,QAAQD,KAAK;AACtC,UAAI0kB,OAAOzd,OAAMinC,QAAQrsB,MAAM7hB,CAAAA,CAAAA;AAC/Bsa,aAAOpX,KAAK0xH,aAAaprH,OAAQoa,EAAAA,OAAOc,IACxC,CAAA;AAAA,IAAA;AACD,WAAOpK,OAAO5a,MAAM8J,QAAOwrH,aAAa,OAAO;EAC/C;AAED,WAASE,iBAAiB1iG,QAAQ2iG,kBAAkB3rH,SAAAA;AACnD,QAAIqY,QAAQ,CAAA;AAEZ,KAAI,GAAA,IAAIuzG,IAAID,gBAAAA,CAAAA,EAAmB9nH,QAAQ,SAAUwR,MAAAA;AAChD,UAAI6F,OAAOkwG,aAAaprH,OAAAA,EAAQoS,MAAMiD,IACtC;AAAA,UAAG6F,MAAK;AACPA,aAAKlhB,SAASgvB;AAGd9N,aAAKvZ,KAAK;AACV,YAAIlE,OAAM+lD,cAActoC,IAAO,GAAA;AAC9BA,eAAKvZ,KAAK5G;AACVsd,gBAAM3e,KAAKwhB,IACX;AAAA,QAAA;AAAA,MACD;AAAA,IACJ,CAAA;AACE,WAAO7C;AAAAA,EACP;AAED,WAASwzG,cAAc3wG;AACtB,WAAOA,KAAKE,SAAS,MAAMF,KAAKlhB,SAAS,MAAMkhB,KAAKvO,OAAO,OAAOuO,KAAKw5D,OAAK;AAAA,EAC5E;AAED,WAASo3C,aAAajjH,MAAM8iH,kBAAkB3rH,SAC7C;AAAA,QAAI+rH,gBAAgBL,iBAAiB7iH,KAAKlH,IAAIgqH,kBAAkB3rH;AAChE,QAAIgsH,sBAAsB,CAAA;AAC1BnjH,SAAKu+B,QAAQvjC,QAAQ,SAAUwjC,QAAAA;AAC9B,UAAInsB,OAAOzd,OAAMinC,QAAQ2C,MAAAA;AACzB2kF,0BAAoBH,cAAc3wG,SAASA,KAAKvZ;AAAAA,IACnD,CAEE;AAAA,QAAIsqH,aAAa,CAAA;AACjBF,kBAAcloH,QAAQ,SAAUqX;AAC/B,UAAIgxG,UAAUL,cAAc3wG,IAC5B;AAAA,UAAA,CAAK8wG,oBAAoBE,OAAAA,GAAU;AAClCD,mBAAWvyH,KAAKwhB,IACpB;AAAA,MAAA,OAAU;eACC8wG,oBAAoBE,OAAAA;AAAAA,MAC3B;AAAA,IACJ,CAEE;AAAA,QAAIC,gBAAgB,CAAA;AACpB,aAAS31H,KAAKw1H,qBAAqB;AAClCG,oBAAczyH,KAAKsyH,oBAAoBx1H;IACvC;AAED,WAAO,EACNwQ,KAAKilH,YACLhhH,QAAQkhH;EAET;AAEDlrE,QAAYkqE,kBAAkB90H,WAAW,EACxCwiC,MAAM,SAAUl3B,IAAI0uB,QAAQrwB,SAAQsxB,aAAAA;AACnC,QAAIpZ,OAAO,6CAA6CmY,OAAOt4B,IAAAA,YAAgBs4B,OAAOt4B,IACtFu5B;AAAAA,gBAAYv4B,YAAYmf;AAAAA,EACxB,GACDoY,MAAM,WAAA;AAAA,EACL,GACDu5F,WAAW,SAAUp2G,OAAO9R,IAAI0uB,QAAQ/7B,MACvCoG;AAAAA,SAAKovH,UAAUx1H,IAAMmf,EAAAA,QAAQg4G,mBAAmBh4G,OAAO4c,OAAOtd,QAAQtV;EACtE,GACDssH,WAAW,SAAUpoH,IAAI0uB,QAAQ/7B;AAChC,WAAOg3H,iBAAkB5wH,KAAKovH,UAAUx1H,IAAMmf,EAAAA,SAAS,IAAK4c,OAAOtd,MAAAA;AAAAA,EACnE,GACDy1G,MAAM,SAAU7mH,IAAI0uB,QAAQ/7B,MAC3B;AAAA,QAAIuU,OAAOpL,OAAMmc,QAAQjY,EAAAA;AAEzB,QAAIyqH,YAAYN,aAAajjH,MAAMnO,KAAKqvH,UAAUpoH,IAAI0uB,QAAQ/7B,IAAAA,GAAO+7B,OAAOtd,MAAAA;AAE5E,QAAIq5G,UAAUplH,IAAIvQ,UAAU21H,UAAUnhH,OAAOxU,QAAQ;AACpDgH,MAAAA,OAAMyrC,YAAY,WACjBkjF;AAAAA,kBAAUplH,IAAInD,QAAQ,SAAUqX,MAAAA;AAC/Bzd,UAAAA,OAAMsoD,QAAQ7qC,IAAAA;AAAAA,QACpB;AACKkxG,kBAAUnhH,OAAOpH,QAAQ,SAAUwjC,QAAAA;AAClC5pC,UAAAA,OAAM2oD,WAAW/e,MACvB;AAAA,QAAA,CAAA;AAEK,YAAI5pC,OAAM4uH,aACT5uH,CAAAA,OAAM4uH,aAAAA;AAAAA,MACZ,CACI;AAAA,IAAA;AAAA,EACD,GACDrC,YAAY,SAAUv2G,OAAO9R,IAAI0uB,QAAQ/7B,MAAAA;AACxC,QAAIg4H,oBAAoB5xH,KAAKqvH,UAAUpoH,IAAI0uB,QAAQ/7B;AACnD,QAAIi4H,mBAAmBjB,iBAAiBG,mBAAmBh4G,OAAO4c,OAAOtd,QAAQtV,MAAQ4yB,GAAAA,OAAOtd;AAEhG,WAAOu5G,kBAAkBp2H,WAAWq2H,iBAAiBr2H,KAAAA;AAAAA,EACrD,EACC,GAAA,IAAA;AAEH,SAAOi1H;AACR;ACrIe,SAAQqB,sBAAC/uH;AAEvB,MAAImsH,aAAaD;AAEjB,WAASS,aAAAA;AACR,QAAIz6D,OAAOi6D,WAAWjvH,MAAMD,MAAM4G,SAAc5G,KAAAA;AAChD,WAAOi1D;AAAAA,EACP;AAEDw9C,YAAUid,YAAYR,UAEtB;AAAA,WAASwB,aAAaprH,SAAAA;AACrB,WAAOA,QAAOqrH,aAAa5tH,OAAMoC,IAAIg1E,WAAWC,kBAChD;AAAA,EAAA;AACD7zB,QAAYmpE,WAAW/zH,WAAW,EACjCwiC,MAAM,SAAUl3B,IAAI0uB,QAAQrwB,SAAQsxB,aAAAA;AACnC,QAAIpZ,OAAO,6CAA6CmY,OAAOt4B,gBAAgBs4B,OAAOt4B,IAAAA;AACtFu5B,gBAAYv4B,YAAYmf;AAAAA,EACxB,GACD2xG,WAAW,SAAUp2G,OAAO9R,IAAI0uB,QAAQ/7B,MAAAA;AACvCoG,SAAKovH,UAAUx1H,IAAAA,EAAMmf,QAAQ23G,aAAa/6F,OAAOtd,MAAAA,EAAQqH,OAAO3G,KAChE;AAAA,EAAA,GACDs2G,WAAW,SAAUpoH,IAAI0uB,QAAQ/7B;AAChC,WAAO82H,aAAa/6F,OAAOtd,MAAAA,EAAQX,MAAM1X,KAAKovH,UAAUx1H,IAAMmf,EAAAA,SAAS;EACvE,EACC,GAAA,IAAA;AAEH,SAAO22G;AACR;ACjCe,SAAQqC,0BAAEhvH,QACxB;AAAA,SAAO,SAASivH,0BAA0BpoH,MAAMg2D,OAAOroC,MACtD;AAAA,QAAIA,QAAQ,aAAa;AACxB06F,sBAAgBroH,MAAMg2D,KACzB;AAAA,IAAA,WAAaroC,QAAQ,gBAAgB;AAClC26F,yBAAmBtoH,MAAMg2D;IAC5B,OAAS;AACNuyD,0BAAoBvoH,MAAMg2D,KAC1B;AAAA,IAAA;AAAA,EACH;AAIC,WAASqyD,gBAAgBroH,MAAMg2D,OAAAA;AAC9B,QAAIA,SAAS,YAAY;AACxBh2D,WAAKwI,WAAWrP,OAAMm5D,iBAAiBtyD,IAAAA;AAAAA,IACvC,WAAUg2D,SAAS,cAAcA,SAAS,cAAc;AACxDh2D,WAAKuyD,WAAWp5D,OAAMovE,kBAAkBvoE,IACxC;AAAA,IAAA;AAAA,EACD;AAKD,WAASsoH,mBAAmBtoH,MAAMg2D,OAAAA;AACjC,QAAIA,SAAS,YAAY;AACxBh2D,WAAKuI,aAAaigH,kBAAkBxoH,IACpC;AAAA,IAAA,WAAUg2D,SAAS,gBAAgBA,SAAS,YAAY;AACxDh2D,WAAKwI,WAAWrP,OAAMm5D,iBAAiBtyD,IAAAA;AAAAA,IACvC;AAAA,EACD;AAKD,WAASuoH,oBAAoBvoH,MAAMg2D,OAClC;AAAA,QAAI78D,OAAMuC,OAAOyvF,mBAAkB;AAClC,UAAIn1B,SAAS,cAAcA,SAAS,YAAY;AAC/Ch2D,aAAKuI,aAAaigH,kBAAkBxoH,IACxC;AAAA,MAAA,WAAcg2D,SAAS,cAAc;AACjCh2D,aAAKuyD,WAAWp5D,OAAMovE,kBAAkBvoE,IACxC;AAAA,MAAA;AAAA,IACJ,OAAS;AACN,UAAIg2D,SAAS,gBAAgBA,SAAS,YAAY;AACjDh2D,aAAKwI,WAAWrP,OAAMm5D,iBAAiBtyD,IAAAA;AAAAA,MAC3C,WAAcg2D,SAAS,YAAY;AAC/Bh2D,aAAKuyD,WAAWp5D,OAAMovE,kBAAkBvoE,IAAAA;AAAAA,MACxC;AAAA,IACD;AAAA,EACD;AAED,WAASwoH,kBAAkBxoH,MAC1B;AAAA,WAAO7G,OAAMm5D,iBAAiB,EAC7B/pD,YAAYvI,KAAKwI,UACjB+pD,UAAAA,CAAWvyD,KAAKuyD,UAChBhuD,MAAMvE;EAEP;AACF;AC9CA,SAASyoH,YAAYtvH,QAAAA;AACpBA,EAAAA,OAAMuC,OAAOgT,eAAe,EAC3B+C,MAAM,KAAKo0G,kBAAAA,MACX6C,QAAQ,KAAK3C,oBAAAA,MACb70H,QAAQ,KAAKg1H,oBAAAA,MACbz9G,MAAM,KAAK49G,kBAAkBltH,MAAAA,MAC7BwvH,aAAa,KAAK/B,yBAAyBztH,YAC3Co5D,UAAU,KAAK21D,sBAAsB/uH,MAEvC,KAAA;AAAA;AAEA,SAAS2O,OAAO3O,QACf;AAAA,MAAIyvH,kBAAkB3D,mBAAmB9rH,MAAAA;AAEzC,MAAI0vH,WAAW,CAAA;AACf/lH,gBAAU+lH,QAEV;AAAA,WAASC,kBAAkBxiG,MAAAA;AAE1B,aAASyiG,qBAAqB/4H;AAC7B,UAAI+6B,CAAAA,UAAqB/6B,MAAMs2B,KAAKhB,KAAAA,GAAO;AAC1C,eAAO;AAAA,MACP;AAED,UAAI1P,MAAMoS,gBAA2Bh4B,MAAMs2B,KAAKzf,QAAQswG;AACxD,UAAIpkF,OAAO/K,gBAA2Bh4B,MAAM,kBAAA;AAC5C,UAAG4lB,OAAOmd,MAAK;AACd,YAAI/E,aAAa+E,KAAKviC,aAAa,kBACnC;AAAA,YAAI6M,KAAKuY,IAAIplB,aAAa81B,KAAKzf,QAAQswG,cACvC;AAAA,eAAO,EACN95G,IACA2wB,WAAYA;AAAAA,MAEb;AACD,aAAO;AAAA,IAEP;AAED,aAASg7F,mBAAmB9hE,QAAQl5B,YACnC;AAAA,UAAItyB,UAAS4qB,KAAK22E,WAAAA;AAClB,UAAIhvG,MAAMq4B,KAAK1hB,WAAWsiD,MAC1B;AAAA,UAAIp3D,SAASw2B,KAAK5hB,cAAcwiD,MAAAA;AAChC,UAAI9wC,OAAOkQ,KAAK5C,eAChB;AAAA,UAAIx1B,OAAO,GACVC,QAAQ,GACR0B,QAAQ;AAET,eAASqC,IAAI,GAAGA,IAAIkkB,KAAKjkB,QAAQD,KAAK;AACrC,YAAIkkB,KAAKlkB,CAAAA,EAAGuB,QAAQu6B,YAAY;AAC/Bn+B,kBAAQumB,KAAKlkB,CAAGrC,EAAAA;AAChB;AAAA,QACA;AACD,YAAI6L,QAAOmZ,KAAK;AACf1mB,mBAASioB,KAAKlkB,CAAAA,EAAGrC;AAAAA,QACtB,OAAW;AACN3B,kBAAQkoB,KAAKlkB,GAAGrC;AAAAA,QAChB;AAAA,MAED;AACD,UAAI6L,QAAOmZ,KAAK;AACf,eAAO,EACN5mB,KACAE,OACA2B,QACAD,MAEL;AAAA,MAAA,OAAU;AACN,eAAO,EACN5B,KACAC,MACA4B,QACAD;MAED;AAAA,IAED;AAED,aAASo5H,iBAAiB3iG,OAAM0H,YAAAA;AAC/B,UAAI/kB,UAAUqd,MAAK5C,eACnB;AAAA,eAASxxB,IAAI,GAAGA,IAAI+W,QAAQ9W,QAAQD,KAAI;AACvC,YAAG+W,QAAQ/W,CAAGuB,EAAAA,QAAQu6B,YAAW;AAChC,iBAAO97B;AAAAA,QACP;AAAA,MACD;AACD,aAAO;AAAA,IACP;AAED,aAASg3H,mBAAmBhiE,QAAQl5B,YAAAA;AACnC,UAAItyB,UAAS4qB,KAAK22E,WAAAA;AAClB,UAAI56F,MAAM2mH,mBAAmB9hE,QAAQl5B,UAAAA;AACrC,UAAIr2B,KAAKnJ,SAASoE,cAAc,KAAA;AAChC+E,SAAGxE,YAAY;AACfwE,SAAGyrB,aAAakD,KAAKzf,QAAQswG,gBAAgBjwD,MAC7CvvD;AAAAA,SAAGyrB,aAAakD,KAAKzf,QAAQ9I,OAAO,OAAOmpD,MAE3CvvD;AAAAA,SAAGyrB,aAAa,oBAAoB4K,UAAAA;AAEpC,UAAI8sF,eAAemO,iBAAiB3iG,MAAM0H;AAC1Cr2B,SAAGyrB,aAAa,qBAAqB03F,YAErC3hH;AAAAA,MAAAA,OAAM08B,SAASszF,iBAAiBxxH,EAAAA;AAEhC,UAAI+D,QAAOmZ,KAAK;AACfld,WAAGvH,MAAMyC,UAAU,CAClB,SAASwP,IAAIpU,MAAM,MACnB,WAAWoU,IAAIlU,QAAQ,MACvB,WAAWkU,IAAIxS,QAAQ,MACvB,YAAYwS,IAAIvS,SAAS,MACxB8B,KAAK,GAAA;AAAA,MACX,OAAU;AACN+F,WAAGvH,MAAMyC,UAAU,CAClB,SAASwP,IAAIpU,MAAM,MACnB,UAAUoU,IAAInU,OAAO,MACrB,WAAWmU,IAAIxS,QAAQ,MACvB,YAAYwS,IAAIvS,SAAS,MACxB8B,KAAK,GAAA;AAAA,MACP;AAED,aAAO+F;AAAAA,IACP;AAED,QAAIyxH,2BAA2BjB,0BAA0BhvH;AAEzD,QAAIwD,WAAW,CACf;AAAA,QAAI0sH,gBAAgB,CAAA;AACpB,QAAIn8G,QAAQ;AACZ,QAAI2lB,aAAa,EAChBy2F,SAAS,MACTC,aAAa,MACbC,SAAS,MACTC,aAAa,MACbC,cAAc,MAEd12F,YAAY+1F,sBACZ71F,iBAAiB,SAAUlF;AAC1B,UAAIjC,SAASzF,KAAK07F,UAAUh0F,UAC5B;AAAA,aAAOjC,OAAOtd;AAAAA,IACd,GAEDilC,MAAM,WAAA;AACL,UAAIwxE,UAAU0D,gBAAgBxD,WAC9B;AAAA,UAAGF,QAAQxxE,MAAK;AACfwxE,gBAAQxxE,KAAKt9C,MAAMkwB,IACnB;AAAA,MAAA;AAEDpZ,cAAQoZ,KAAKowC,OAAOj1B,aAAanb,KAAKzf,QAAQ9I,IAE9C;AAAA,UAAIstD,OAAOj1D;AAEXuG,eAASvH,KAAK8X,MAAMtP,YAAY,cAAc,SAASwvB,OAAOC,OAAAA;AAC7D,YAAGg+B,KAAKi+D,WAAWl8F,OAAM;AACxBi+B,eAAKi+D,UAAUj8F;AAAAA,QACf;AAAA,MACD,CAAA,CAAA;AACD1wB,eAASvH,KAAK8X,MAAMtP,YAAY,kBAAkB,WACjD;AAAA,YAAG0oB,KAAKowC,OAAO/yD,SAAS,aAAeinD,EAAAA,cAAa;AACnD;AAAA,QACA;AAED,YAAGS,KAAKt7D,gBAAgBmd,MAAMnd,UAAUs7D,KAAKi+D,OAAS,GAAA;AACrDj+D,eAAKr/B,KAAAA;AAAAA,QACL;AAAA,MACD,CAAA,CAAA;AAEDq9F,oBAAcj0H,KAAK+D,OAAMyE,YAAY,gBAAgB,WAAA;AACpD,YAAGytD,KAAKm+D,WAAWn+D,KAAKq+D,gBAAAA,CAAiB3+F,UAAqBsgC,KAAKq+D,cAAcvwH,OAAMgC,KAAAA,GAAO;AAC7FmrB,eAAKP,WAAWjzB,YAAYu4D,KAAKq+D,YAAAA;AAAAA,QACjC;AAAA,MACD,CAAA,CAAA;AAEDtzH,WAAKs9C,OAAO;;IACZ,GAED/vC,UAAU,WAAA;AACT,aAAO,EACN8K,QAAQrY,KAAKozH,SACbzE,YAAY3uH,KAAKqzH,aACjBz8F,aAAa52B,KAAKszH,cAClBrsH,IAAIjH,KAAKkzH,SACTt7F,YAAY53B,KAAKmzH,YAElB;AAAA,IAAA,GAEDp2F,WAAW,SAAS+zB,QAAQl5B,YAAAA;AAC3B,UAAI53B,KAAKrG,UAAAA,GAAa;AACrBqG,aAAK8tH,KAAAA;AAAAA,MACL;AAED,UAAIh3G,CAAAA,MAAMijB,OAAO+2B,MAAAA,GAAQ;AACxB;AAAA,MACA;AAED,UAAI29D,cAAc,EAACxnH,IAAI6pD,QAAQl5B,WAC/B;AAAA,UAAI70B,OAAMqrB,WAAWtX,MAAM6iB,QAAQm3B,UAAU;AAC5C9wD,aAAK+H,UAAU,iBAAiB,CAAC0mH,WAAAA,CAAAA;AACjC;AAAA,MACA;AAED,UAAIzuH,KAAK+H,UAAU,qBAAqB,CAAC0mH,kBAAkB,OAAO;AACjEzuH,aAAK+H,UAAU,iBAAiB,CAAC0mH,WACjC,CAAA;AAAA;AAAA,MACA;AAEDzuH,WAAKm+B,KAAKswF,YAAYxnH,IAAIwnH,YAAY72F,UAAAA;AACtC53B,WAAKuzH,SAAAA;AAELvzH,WAAK+H,UAAU,eAAe,CAAC0mH,WAAAA,CAAAA;AAAAA,IAC/B,GACD90H,WAAW,WACV;AAAA,aAAA,CAAA,EAAUqG,KAAKozH,WAAWz+F,UAAqB30B,KAAKszH,cAAcvwH,OAAMgC;IACxE,GACDo5B,MAAM,SAAU2yB,QAAQl5B,YACvB;AAAA,UAAI53B,KAAKrG,UAAa,GAAA;AACrBqG,aAAK8tH,KAAAA;AAAAA,MACL;AACD,UAAIW,cAAc,EAACxnH,IAAI6pD,QAAQl5B,WAE/B;AAAA,UAAIjC,SAASzF,KAAK07F,UAAU6C,YAAY72F,UACxC;AAAA,UAAI47F,eAAexzH,KAAK88B,gBAAgBnH,OAAOt4B,IAAAA;AAC/C,UAAIm2H,CAAAA,aACH;AAED,UAAIn7G,SAAS6X,KAAK22E,WAAavuF,EAAAA,aAAak7G,aAAavhH,IAEzD;AAAA,UAAI2kB,cAAck8F,mBAAmBrE,YAAYxnH,IAAIwnH,YAAY72F,UACjE1H;AAAAA,WAAKP,WAAWjzB,YAAYk6B,WAAAA;AAC5Bve,aAAO8lB,KAAKswF,YAAYxnH,IAAI0uB,QAAQ69F,cAAc58F,WAAAA;AAClD52B,WAAKozH,UAAU/6G;AACfrY,WAAKszH,eAAe18F;AACpB52B,WAAKkzH,UAAUzE,YAAYxnH;AAC3BjH,WAAKmzH,cAAc1E,YAAY72F;AAC/B53B,WAAKqzH,cAAcG,aAAavhH;AAEhC,UAAI68G,UAAU0D,gBAAgBxD,WAC9B;AAAA,UAAGF,QAAQf,QAAO;AACjBe,gBAAQf,OAAO/tH,MAAM42B,aAAa1G;MAClC;AAAA,IACD,GAEDqjG,UAAU,WACT;AAAA,UAAI3vH,QAAQ5D,KAAKuN,SACjB;AAAA,UAAIujD,SAASltD,MAAMqD,IAClB2wB,aAAah0B,MAAMg0B;AAEpB,UAAIjC,SAASzF,KAAK07F,UAAUh0F,UAAAA;AAC5B,UAAIhuB,OAAOkN,MAAM6iB,QAAQm3B,MAAAA;AACzB,UAAI0iE,eAAexzH,KAAK88B,gBAAgBlF;AAExC,UAAI47F,CAAAA,aACH;AAED,UAAIz6G,QAAQnP,KAAK4pH,aAAar+E,MAC9B;AAAA,UAAGq+E,aAAar+E,UAAU,QAAO;AAChCp8B,gBAAQjC,MAAM6iB,QAAQm3B,MAAAA;AAAAA,MACtB;AAED9wD,WAAKozH,QAAQjE,UAAUp2G,OAAO+3C,QAAQn7B,QAAQ31B,KAAKszH;AACnDtzH,WAAKyrB,MAAAA;AAAAA,IACL,GAEDA,OAAO,WACNzrB;AAAAA,WAAKozH,QAAQ3nG,MAAMzrB,KAAKszH;IACxB,GAEDG,UAAU;AACT,UAAI99F,SAASzF,KAAK07F,UAAU5rH,KAAKmzH,WAAAA;AACjC,aAAOnzH,KAAKozH,QAAQ/D,UAAUrvH,KAAKkzH,SAASv9F,QAAQ31B,KAAKszH,YACzD;AAAA,IAAA,GAEDI,eAAe,WAAA;AACd,UAAIF,eAAexzH,KAAK88B,gBAAgB98B,KAAKmzH;AAE7C,UAAIK,CAAAA,aACH;AAED,UAAI5pH,OAAO7G,OAAMmc,QAAQlf,KAAKkzH,OAAAA;AAC9B,UAAIn6G,QAAQnP,KAAK4pH,aAAar+E,MAAAA;AAC9B,UAAGq+E,aAAar+E,UAAU,QAAO;AAChCp8B,gBAAQjC,MAAM6iB,QAAQ35B,KAAKkzH;MAC3B;AACD,aAAOn6G;AAAAA,IACP,GAED80G,WAAW;AAEV,UAAIl4F,SAASzF,KAAK07F,UAAU5rH,KAAKmzH,WAAAA;AAEjC,UAAIp6G,QAAQ/Y,KAAK0zH,cAEjB;AAAA,aAAO1zH,KAAKozH,QAAQ9D,WAAWv2G,OAAO/Y,KAAKkzH,SAASv9F,QAAQ31B,KAAKszH,YAAAA;AAAAA,IACjE,GAED19F,MAAM,WAAA;AACL,WAAI51B,KAAKkzH,QACR;AAED,UAAIpiE,SAAS9wD,KAAKkzH,SACjBt7F,aAAa53B,KAAKmzH;AAEnB,UAAIrE,UAAU0D,gBAAgBxD,WAC9B;AAAA,UAAGF,QAAQT,QAAO;AACjBS,gBAAQT,OAAOruH,MAAMA,KAAKszH,cAAcpjG,IACxC;AAAA,MAAA;AAEDlwB,WAAKkzH,UAAU;AACflzH,WAAKmzH,cAAc;AACnBnzH,WAAKqzH,cAAc;AACnB,UAAA,CAAKrzH,KAAKszH,aAAc;AAExB,UAAItzH,KAAKozH,WAAWpzH,KAAKozH,QAAQx9F,MAAM;AACtC51B,aAAKozH,QAAQx9F,KAAK51B,KAAKszH;MACvB;AACDtzH,WAAKozH,UAAU;AACf,UAAIpzH,KAAKszH,aAAa/6H,YAAY;AACjCyH,aAAKszH,aAAa/6H,WAAWqE,YAAYoD,KAAKszH,YAAAA;AAAAA,MAC9C;AACDtzH,WAAKszH,eAAe;AAEpBtzH,WAAK+H,UAAU,aAAa,CAAC,EAACd,IAAI6pD,QAAQl5B,WAAYA,CAAAA,CAAAA;AAAAA,IACtD,GACDk2F,MAAM,WAAA;AACL,YAAK9tH,KAAKrG,UAAAA,KAAemd,MAAMijB,OAAO/5B,KAAKkzH,OAAAA,KAAYlzH,KAAK6tH,UAAc,IAAA;AACzE7tH,aAAK41B,KAAAA;AACL;AAAA,MACA;AAED,UAAIk7B,SAAS9wD,KAAKkzH,SACjBt7F,aAAa53B,KAAKmzH;AAEnB,WAAIr8G,MAAMijB,OAAO+2B,SAAS;AACzB;AAAA,MACA;AAED,UAAIlnD,OAAOkN,MAAM6iB,QAAQm3B,MACzB;AAAA,UAAI0iE,eAAexzH,KAAK88B,gBAAgBlF;AACxC,UAAI62F,cAAc,EACjBxnH,IAAI6pD,QACJl5B,YACA6Q,UAAUzoC,KAAKyzH,YACfvmF,UAAUltC,KAAK0zH;AAEhB,UAAI1zH,KAAK+H,UAAU,gBAAgB,CAAC0mH,WAAkB,CAAA,MAAA,OAAO;AAC5D,YAAA,CAAKzuH,KAAKozH,QAAQ5D,YAAYxvH,KAAKozH,QAAQ5D,SAASf,YAAYhmF,UAAUgmF,YAAYxnH,IAAIipB,KAAK07F,UAAUh0F,UAAa53B,GAAAA,KAAKszH,eAAe;AAEzI,cAAI1zD,QAAQ4zD,aAAar+E;AACzB,cAAIp8B,QAAQ01G,YAAYhmF;AACxB,cAAIm3B,SAAS,QAAQ;AACpBh2D,iBAAKg2D,KAAAA,IAAS7mD;AACdi6G,qCAAyBppH,MAAMg2D,OAAO78D,OAAMuC,OAAOquH,8BAAAA;AAEnD78G,kBAAM0yC,WAAWsH,MACxB;AAAA,UAAA,OAAa;AACN9wD,iBAAKozH,QAAQtF,KAAKh9D,QAAQ5gC,KAAK07F,UAAUh0F,UAAa53B,GAAAA,KAAKszH,YAC3D;AAAA,UAAA;AACDtzH,eAAK+H,UAAU,UAAU,CAAC0mH,WAAAA,CAAAA;AAAAA,QAC1B;AAAA,MACD;AACDzuH,WAAK41B,KAAAA;AAAAA,IACL,GAEDg+F,mBAAmB,SAASC,iBAAiBhoH,OAAO4jF,WACnD;AAAA,UAAI1gE,YAAYljB;AAChB,UAAIgH,UAAUqd,KAAK5C,eAAAA;AACnB,UAAIwmG,aAAajhH,QAAQkc,SAEzB;AAAA,UAAI6I,aAAak8F,aAAaA,WAAWz2H,OAAO;AAChD,UAAGu6B,YAAW;AACb,eAAMA,cAAe53B,CAAAA,KAAK88B,gBAAgBlF,UAAAA,GAAY;AACrDA,uBAAa53B,KAAK4zH,kBAAkB/nH,QAAQ4jF,WAAWA,SACvD;AAAA,QAAA;AACD,eAAO73D;AAAAA,MACP;AACD,aAAO;AAAA,IACP,GAEDm8F,aAAa,SAASC,SAAShoG,KAAAA;AAE9B,aAAOhsB,KAAK4zH,kBAAkB1jG,KAAKu7F,eAAezrH,KAAKmzH,aAAa,IAAQnnG,IAAAA,KAAKA,GACjF;AAAA,IAAA,GAEDioG,cAAc,SAASA,eAAAA;AACtB,aAAOj0H,KAAK4zH,kBAAkB,GAAG,CACjC;AAAA,IAAA,GAEDM,aAAa,SAASA,cACrB;AAAA,aAAOl0H,KAAK4zH,kBAAkB1jG,KAAK5C,eAAiBvxB,EAAAA,SAAS,GAAI,EAAA;AAAA,IACjE,GAEDqyH,cAAc,SAAS+F,SAASC,cAAAA;AAC/B,UAAIz3F,OAAO38B,KAAK+zH,YAAY,CAAA;AAC5B,UAAGp3F,MAAK;AACP,YAAIm3F,aAAa9zH,KAAK+zH,YAAY,CAAA;AAClC,YAAGD,cAAc9zH,KAAK88B,gBAAgBg3F,UAAAA,GAAY;AACjD9zH,eAAK+8B,UAAU/8B,KAAKkzH,SAASY,UAC7B;AAAA,QAAA;AAAA,MACD,WAAQM,gBAAgBp0H,KAAKq0H,QAAQ,CAAG,GAAA;AACxC,YAAIlmH,OAAOnO,KAAKq0H,QAAQ,CACxB13F;AAAAA,eAAO38B,KAAKi0H,aAAAA;AACZ,YAAGt3F,QAAQ38B,KAAK88B,gBAAgBH,IAAAA,GAAM;AACrC38B,eAAK+8B,UAAU5uB,MAAMwuB,IACrB;AAAA,QAAA;AAAA,MACD;AAAA,IACD,GAEDwxF,cAAc,SAASmG,SAASF,cAC/B;AAAA,UAAIz3F,OAAO38B,KAAK+zH,YAAAA;AAChB,UAAGp3F,MAAK;AACP,YAAIm3F,aAAa9zH,KAAK+zH,cACtB;AAAA,YAAGD,cAAc9zH,KAAK88B,gBAAgBg3F,UAAAA,GAAY;AACjD9zH,eAAK+8B,UAAU/8B,KAAKkzH,SAASY,UAC7B;AAAA,QAAA;AAAA,MACD,WAAQM,gBAAgBp0H,KAAKq0H,QAAS,EAAA,GAAG;AACzC,YAAIlmH,OAAOnO,KAAKq0H,QAAAA,EAChB13F;AAAAA,eAAO38B,KAAKk0H,YACZ;AAAA,YAAGv3F,QAAQ38B,KAAK88B,gBAAgBH,IAAAA,GAAM;AACrC38B,eAAK+8B,UAAU5uB,MAAMwuB,IAAAA;AAAAA,QACrB;AAAA,MACD;AAAA,IACD,GAED03F,SAAS,SAASA,QAAQroG,KACzB;AAAA,UAAIkF,WAAWlF,MAAM,IAAIjpB,OAAM+tB,UAAU/tB,OAAM6tB;AAC/CM,iBAAWnuB,OAAM4E,KAAKupB,UAAUnuB,MAAAA;AAEhC,UAAIwxH,WAAWrjG,SAASlxB,KAAKkzH,OAAAA;AAE7B,aAAOnwH,OAAM0d,aAAa8zG,QAAAA,KAAaxxH,OAAMqrB,WAAWrrB,OAAMmc,QAAQq1G,QAAY,CAAA,GAAA;AACjFA,mBAAWrjG,SAASqjG,QAAAA;AAAAA,MACpB;AACD,aAAOA;AAAAA,IACP,GAEDC,aAAa,SAASC,QAAQC;AAC7B,UAAIztH,KAAKjH,KAAKuN,SAAWtG,EAAAA;AACzB,UAAKlE,CAAAA,OAAM0d,aAAaxZ,EAAAA,EAAK;AAE7B,UAAIkhF,OAAO;AACX,UAAIusC,cAAa;AAChBvsC,eAAOnoF,KAAKq0H,QAAQ,CAAA;AAAA,MACpB,OACG;AACHlsC,eAAOplF,OAAM+tB,QAAQ7pB,EACrB;AAAA,MAAA;AAED,UAAIlE,OAAM0d,aAAa0nE,IAAM,GAAA;AAC5BnoF,aAAK+8B,UAAUorD,MAAMnoF,KAAKmzH;MAC1B;AAAA,IACD,GAEDwB,aAAa,SAASC,QAAQF;AAC7B,UAAIztH,KAAKjH,KAAKuN,SAAAA,EAAWtG;AACzB,UAAA,CAAKlE,OAAM0d,aAAaxZ,EAAAA,EAAK;AAE7B,UAAIsE,OAAO;AACX,UAAImpH,cAAa;AAChBnpH,eAAOvL,KAAKq0H,QAAAA;MACZ,OACG;AACH9oH,eAAOxI,OAAM6tB,QAAQ3pB;MACrB;AAED,UAAIlE,OAAM0d,aAAalV,IAAM,GAAA;AAC5BvL,aAAK+8B,UAAUxxB,MAAMvL,KAAKmzH,WAAAA;AAAAA,MAC1B;AAAA,IACD,GACD0B,aAAa,WACZtuH;AAAAA,eAAS4C,QAAQ,SAASnC,WACzB8P;AAAAA,cAAM1O,YAAYpB,SACvB;AAAA,MAAA,CAAA;AAEIisH,oBAAc9pH,QAAQ,SAASnC;AAC9BjE,QAAAA,OAAMqF,YAAYpB,SACvB;AAAA,MAAA,CAAA;AACIT,iBAAW,CAAA;AACX0sH,sBAAgB,CAEhBn8G;AAAAA,cAAQ;AACR9W,WAAK41B,KAAAA;AAAAA,IACL,GACD3mB,YAAY,WAAA;AACXjP,WAAK60H,YAAAA;AACL70H,WAAKuI,gBAAAA;AAAAA,IACL;AAGFg+C,UAAY9pB,YAAY+1F;AACxBjsE,UAAY9pB,YAAYg2F;AAExB,WAAOh2F;AAAAA,EACP;AAGD,MAAIq4F,uBAAuB,EAC1Bx3E,MAAM+0E,aACN0C,eAAerC,kBAGhBnsE;AAAAA,QAAYuuE,sBAAsBtC,eAAAA;AAClCjsE,QAAYuuE,sBAAsBrC,QAAAA;AAElC,SAAOqC;AACR;AC9fe,SAASE,gBAAgBprH,MAAM86B,UAAUh5B,MAAMpG,SAAQvC,QAAAA;AACrE,OAAI6G,KAAKuI,cAAAA,CAAevI,KAAKwI,UAAS;AACrC,WAAO;AAAA,EACP;AAED,MAAIva,MAAM6T,KAAK8C,WAAW5E,KAAK3C;AAC/B,MAAIvN,SAASgS,KAAK4C,cAAc1E,KAAK3C,EAAAA;AAErC,MAAGpP,MAAM6sC,SAASykE,SAAStxG,MAAM6B,SAASgrC,SAASrrC,GAAE;AACpD,WAAO;AAAA,EACP;AAED,MAAI2qB,UAAU;AACd,MAAIspF,aAAa5hG,KAAKwgB,YAAYtiB,KAAKuI;AACvC,MAAIo7F,WAAW7hG,KAAKwgB,YAAYtiB,KAAKwI,QAAAA;AACrC,MAAIta,OAAOwB,KAAKyS,IAAIuhG,YAAYC,QAAAA,IAAYvpF;AAC5C,MAAIjsB,QAAQuB,KAAKuD,IAAIywG,YAAYC,QAAAA,IAAYvpF;AAE7C,MAAGlsB,OAAO4sC,SAASwkE,SAASnxG,QAAQ2sC,SAASlrC,GAAE;AAC9C,WAAO;AAAA,EACP;AAED,SAAO;AACR;AC1BA,SAASy7H,qBAAmBlyH,QAE3B;AAAA,WAASmyH,qBAAqB/mH,MAAMzC,MAAMpG,SACzC;AAAA,QAAIA,UAASoG,KAAKm7F;AAClB,QAAIsuB,WAAW7vH,QAAOyxC;AACtB,QAAIsc,WAAW8hE,SAASpyH,OAAMo+B,YAAYhzB,KAAK8D,IAAAA,CAAAA,GAC9CmjH,kBAAkBC;AAEnB,SAAKhiE,UAAU;AACd,aAAO+hE,gBAAgBv5H,KAAKkH,QAAOoL,MAAMzC,MAAMpG,OAClD;AAAA,IAAA,OAAO;AACJ,aAAO+tD,SAASx3D,KAAKkH,QAAOoL,MAAM,SAASA,OAAO;AAAA,eAAOinH,gBAAgBv5H,KAAKkH,QAAOoL,OAAMzC,MAAMpG,OAAQ;AAAA,MAAA,GAAGoG;IAC5G;AAAA,EACD;AAED,WAAS2pH,qBAAqBlnH,MAAMzC,MAAMpG,SACzC;AAAA,QAAIvC,OAAM06D,0BAA0BtvD,IACnC,EAAA;AAED,SAAKpL,OAAMsxF,wBAAwBlmF,IAAO,GAAA;AACzC;AAAA,IACA;AAED,QAAIlC,MAAMP,KAAK8wE,gBAAgBruE,IAAAA;AAE/B,QAAIqqD,MAAMlzD,SACT4P,aAAYxJ,KAAKo7F;AAElB,QAAI5lE,WAAWn+B,OAAMo+B,YAAYhzB,KAAK8D,IACtC;AAAA,QAAIvY,SAASgS,KAAKoyE,aAAa3vE,KAAKlH,IAAIi6B,YAAYs3B,IAAI7hC,MAAMqb;AAE9D,QAAIsjF,iBAAiB;AACrB,QAAIp0F,YAAYs3B,IAAI7hC,MAAMqb,WAAW;AACpCsjF,wBAAkB57H,SAASuS,IAAIvS,UAAQ;AAAA,IACvC;AAED,QAAI67H,OAAOj8H,KAAKkS,OAAOE,KAAK4C,cAAcH,KAAKlH,EAAMvN,IAAAA,UAAU,CAC/D;AAAA,UAAMsiF,eAAej5E,OAAMuC,OAAO22D,aAAa9tD,KAAK8tD,aAAa9tD,KAAK8tD,UAAUlgE;AAChF,UAAM8/E,0BAA0B94E,OAAMuC,OAAO22D,cAAcl5D,OAAMuC,OAAO22D,UAAU6f,eAAe,iBAAiB/4E,OAAMuC,OAAO22D,UAAU6f,eAAe;AACxJ,QAAIE,gBAAgBH,yBAAwB;AAC3C,UAAI1tE,KAAK2nC,eAAe,UAAU3nC,KAAK2nC,aAAa3nC,KAAKQ,YAAW;AACnE,YAAIuyB,aAAas3B,IAAI7hC,MAAMqb,WAAU;AACpC,cAAIwjF,kBAAkB9pH,KAAKoyE,aAAa3vE,KAAKlH,IAAI,IAAA;AACjD,cAAIwuH,iBAAiBn8H,KAAKyW,KAAK,IAAIylH,kBAAkBA,eAAAA;AACrDD,iBAAOj8H,KAAKkS,OAAOiqH,iBAAiB/7H,UAAU,CAAK,IAAA;AAAA,QACxD,OAAW;AACN67H,iBAAO;AAAA,QACP;AAAA,MACD;AAAA,IACD;AASD,QAAIr0F,YAAYs3B,IAAI7hC,MAAMqb,WAAW;AACpC/lC,UAAInU,QAAQwB,KAAKC,MAAMG,SAAS,CAAA;AAChCuS,UAAIxS,QAAQC;AAAAA,IACZ;AAED,QAAI6C,MAAMnE,SAASoE,cAAc,KAEjC;AAAA,QAAI/C,QAAQH,KAAKC,MAAM0S,IAAIxS,KAAAA;AAE3B,QAAGiS,KAAK+E,QAAQswG,gBAAgB;AAC/BxkH,UAAIywB,aAAathB,KAAK+E,QAAQswG,gBAAgB5yG,KAAKlH,EAAAA;AACnD1K,UAAIywB,aAAathB,KAAK+E,QAAQ9I,OAAO,OAAOwG,KAAKlH;IACjD;AAED,QAAIuxD,IAAItlB,iBAAiBhS,YAAYs3B,IAAI7hC,MAAMqb,WAAW;AACzD0jF,4BAAsBvnH,MAAM5R,KAAK9C,OAAO++D,KAAKtjD,UAAAA;AAAAA,IAC7C;AAGD,QAAI8pB,UAAU22F,qBAAqBxnH,MAAM1U,OAAOyb,UAAAA;AAEhD3Y,QAAIG,YAAYsiC,OAAAA;AAEhB,QAAItgC,MAAMk3H,oBAAoB,mBAC7B1gH,WAAUkyC,WAAWj5C,KAAKgE,YAAYhE,KAAKiE,UAAUjE,OACrDA,KAAKlH,IACLyE,IACD;AAAA,QAAIyC,KAAKsL,SAAStL,KAAK0nH,iBAAiB1nH,KAAK2nH,WAAW;AACvDp3H,aAAO;AAAA,IACP;AACD,QAAIuN,IAAIxS,QAAQ,IAAG;AAClBiF,aAAO;AAAA,IACP;AACDnC,QAAIQ,YAAY2B;AAEhB,QAAIugB,SAAS,CACZ,UAAUhT,IAAInU,OAAO,MACrB,UAAUy9H,OAAOtpH,IAAIpU,OAAO,MAC5B,YAAS,SAAc,MACvB,iBAAkByB,KAAKuD,IAAInD,SAAS,KAAKA,SAAS,IAAIA,QAAQ,CAAM,IAAA,MACpE,WAAWD,QAAQ;AAGpB8C,QAAIvC,MAAMyC,UAAUwiB,OAAOzjB,KAAK,GAAA;AAChC,QAAI2S,KAAKsL,OAAO;AACfld,UAAIvC,MAAM+7H,YAAY,+BAA+B5nH,KAAKsL,KAAAA;AAAAA,IAC1D;AACD,QAAItL,KAAK2nH,WAAW;AACnBv5H,UAAIvC,MAAM+7H,YAAY,0BAA0B5nH,KAAK2nH;IACrD;AAED,QAAI3nH,KAAK0nH,eAAe;AACvBt5H,UAAIvC,MAAM+7H,YAAY,mCAAmC5nH,KAAK0nH,aAAAA;AAAAA,IAC9D;AAGD,QAAIne,OAAOse,yBAAyB7nH,MAAMqqD,KAAKtjD,YAAWogH,cAAAA;AAC1D,QAAI5d,KAAMn7G,KAAIG,YAAYg7G,IAAAA;AAE1BA,WAAOue,0BAA0B9nH,MAAMqqD,KAAKtjD,YAAWogH,cACvD;AAAA,QAAI5d,KAAMn7G,KAAIG,YAAYg7G,IAE1B30G;AAAAA,IAAAA,OAAM08B,SAASy2F,eAAe/nH,MAAM5R,GAAAA;AAEpC,QAAIqH,QAAQb,OAAMwK;AAClB,UAAM4oH,eAAAA,CAAgBpzH,OAAMqrB,WAAWjgB,IAAAA;AACvC,UAAMioH,eAAerzH,OAAMoC,IAAID,gBAAgBnC,OAAMoC,IAAID,aAAa4M,kBAEtE;AAAA,QAAIqkH,gBAAgBC,cAAc;AACjC,UAAI59D,IAAI/kB,eAAgB1wC,CAAAA,OAAM4oC,cAAcx9B,IAAS+yB,KAAAA,YAAYs3B,IAAI7hC,MAAMqb,WAAW;AACrFqkF,qBAAa95H,KAAK,mBAAmB4R,MAAM,SAAUzP,MAAAA;AACpD,cAAI6C,KAAKnJ,SAASoE,cAAc,KAAA;AAChC+E,aAAGxE,YAAY2B;AACf,iBAAO6C;AAAAA,QACP,GAAEi3D,GAAAA;AAAAA,MACH;AACD,UAAIA,IAAIjlB,cAAcilB,IAAIhmB,YAAY;AACrC6jF,qBAAa95H,KAAK,sBAAsB4R,MAAM,SAAUzP,MAAAA;AACvD,cAAI43H,QAAQl+H,SAASoE,cAAc,KAAA;AACnC85H,gBAAMv5H,YAAY2B;AAClB43H,gBAAMt8H,MAAMyC,UAAU,CACrB,YAAY/C,SAAS,MACrB,iBAAiBA,SAAS,IACzB8B,EAAAA,KAAK;AACP,cAAIypG,QAAQ7sG,SAASoE,cAAc,KAAA;AACnCyoG,gBAAMloG,YAAY;AAElB,cAAIw5H,iBAAiB;AACrB,cAAG3yH,MAAMyjC,kBAAkBmxB,IAAIxxB,OAAM;AACpCuvF,6BAAiB;AAAA,UACjB;AAEDtxB,gBAAMjrG,MAAMH,UAAU08H,iBAAiB,UAAU;AACjDD,gBAAM55H,YAAYuoG,KAAAA;AAClB,iBAAOqxB;AAAAA,QACZ,GAAO99D,KAAK88D,cAAAA;AAAAA,MACR;AAAA,IACD;AACD,WAAO/4H;AAAAA,EACP;AAED,WAASi6H,qBAAqBroH,MAAMwI,UAAUusG,UAAUuT,aAAAA;AACvD,QAAK9/G,CAAAA,SAAU,QAAO;AAEtB,QAAI0E,OAAO1E,SAASxI,KAAKgE,YAAYhE,KAAKiE,UAAUjE,IACpD;AAAA,QAAA,CAAKkN,KAAM,QAAO;AAClB,QAAI2jB,UAAU5mC,SAASoE,cAAc,KACrCwiC;AAAAA,YAAQjiC,YAAY,wBAAwBmmH;AAC5ClkF,YAAQ3gC,YAAYgd;AACpB,QAAGo7G,aAAY;AACdz3F,cAAQhlC,MAAMy8H,YAAYxkH,QAAQ3Y,KAAKkM,IAAIixH,YAAY19G,KAAS,IAAA;AAAA,IAChE;AACD,WAAOimB;AAAAA,EACP;AAED,WAASg3F,yBAAyB7nH,MAAMqqD,KAAKtjD,YAAWsiG,QACvD;AAAA,QAAI94G,MAAM,gBAAgBg4H,uBAAAA,CAAwBl+D,IAAI/5C,MAAM,OAAO,OAAOtQ;AAC1E,QAAIsoH,cAAc;AAClB,QAAGjf,QAAO;AACTif,oBAAc,EAAExkH,MAAM,eAAe8G,OAAOy+F,OAAAA;AAAAA,IAC5C;AACD,WAAOgf,qBAAqBroH,MAAM+G,WAAU0H,eAAele,KAAK+3H;EAChE;AAED,WAASR,0BAA0B9nH,MAAMqqD,KAAKtjD,YAAWsiG;AACxD,QAAI94G,MAAM,iBAAiBg4H,uBAAwBl+D,CAAAA,IAAI/5C,MAAM,QAAQ,MAAMtQ,IAC3E;AAAA,QAAIsoH,cAAc;AAClB,QAAGjf,QAAO;AACTif,oBAAc,EAAExkH,MAAM,cAAc8G,OAAOy+F,OAAAA;AAAAA,IAC3C;AACD,WAAOgf,qBAAqBroH,MAAM+G,WAAU4H,gBAAgBpe,KAAK+3H;EACjE;AAED,WAASC,uBAAuB5+H,MAAMqW,MAAAA;AACrC,QAAIwoH,OAAOC,gBAAgB9+H,IAAAA;AAE3B,aAASgE,KAAK66H,MAAM;AACnB,UAAIh5G,QAAQxP,KAAKrS,CACjB;AAAA,eAAS+6H,KAAK,GAAGA,KAAKl5G,MAAM5hB,QAAQ86H,MAAM;AACzC,YAAIr2G,OAAOzd,OAAMinC,QAAQrsB,MAAMk5G,EAE/B,CAAA;AAAA,iBAASC,KAAK,GAAGA,KAAKH,KAAK76H,GAAGC,QAAQ+6H,MAAM;AAC3C,cAAIt2G,KAAKvO,QAAQ0kH,KAAK76H,CAAGg7H,EAAAA,EAAAA,GAAK;AAC7B,mBAAO;AAAA,UACP;AAAA,QACD;AAAA,MACD;AAAA,IACD;AACD,WAAO;AAAA,EACP;AAGD,WAASnB,qBAAqBxnH,MAAM1U,OAAOyb,YAC1C;AAAA,QAAI8pB,UAAU5mC,SAASoE,cAAc,KAAA;AACrC,QAAIuG,OAAMo+B,YAAYhzB,KAAK8D,IAAAA,KAASlP,OAAMuC,OAAOqxB,MAAMqb,WAAU;AAChEhT,cAAQ3gC,YAAY6W,WAAUoG,UAAUnN,KAAKgE,YAAYhE,KAAKiE,UAAUjE,IACxE;AAAA,IAAA,WAASpL,OAAMo+B,YAAYhzB,KAAK8D,IAASlP,KAAAA,OAAMuC,OAAOqxB,MAAMqb,aAAav4C,OAAO;AAChFulC,cAAQhlC,MAAMN,SAASslC,QAAQhlC,MAAMP,QAAQA,QAAQ;AAAA,IACrD;AACDulC,YAAQjiC,YAAY;AAEpB,WAAOiiC;AAAAA,EACP;AAED,WAAS02F,sBAAsBvnH,MAAMxQ,SAAS8yG,UAAUj4C,KAAKtjD,YAAAA;AAC5D,QAAI6hH,OAAO5oH,KAAK0lC,WAAW,KAAK;AAEhC48D,eAAWn3G,KAAKuD,IAAI4zG,WAAW,GAAG,CAClC;AAAA,QAAIumB,KAAK5+H,SAASoE,cAAc,KAChC;AAAA,QAAI/C,QAAQH,KAAKC,MAAMk3G,WAAWsmB,IAAAA;AAElCt9H,YAAQH,KAAKyS,IAAI0kG,UAAUh3G;AAE3Bu9H,OAAGh9H,MAAMP,QAAQA,QAAQ;AACzBu9H,OAAGj6H,YAAY;AACfi6H,OAAG34H,YAAY6W,WAAUgyC,cAAc/4C,KAAKgE,YAAYhE,KAAKiE,UAAUjE,IAAAA;AAEvE,QAAGqqD,IAAI/5C,KAAI;AACVu4G,SAAGh9H,MAAM2J,WAAW;AACpBqzH,SAAGh9H,MAAMjC,QAAQ;AAAA,IACjB;AAED,QAAIujF,UAAUljF,SAASoE,cAAc,KACrC8+E;AAAAA,YAAQv+E,YAAY;AACpBu+E,YAAQ5+E,YAAYs6H,EACpBr5H;AAAAA,YAAQjB,YAAY4+E,OAAAA;AAEpB,UAAM66C,eAAAA,CAAgBpzH,OAAMqrB,WAAWjgB,IAAAA;AACvC,UAAMioH,eAAerzH,OAAMoC,IAAID,gBAAgBnC,OAAMoC,IAAID,aAAa4M,kBAEtE;AAAA,QAAI/O,OAAMuC,OAAOkuC,kBAAkB2iF,gBAAgBC,eAAe;AACjE,UAAIhhC,OAAOh9F,SAASoE,cAAc,KAAA;AAElC,UAAIy6H,YAAYx9H;AAChB,UAAG++D,IAAI/5C,KAAI;AACVw4G,oBAAYxmB,WAAWh3G;AAAAA,MACvB;AAED27F,WAAKp7F,MAAMlC,OAAOm/H,YAAY;AAC9B7hC,WAAKr4F,YAAY;AACjBq4F,WAAK/2F,YAAY;AAAA;AAAA;AAGjB24H,SAAGt6H,YAAY04F,IAAAA;AACfz3F,cAAQjB,YAAY04F,IACpB;AAAA,IAAA;AAAA,EACD;AAED,WAASwhC,gBAAgBM;AACxB,QAAIA,UAAU;AACb,aAAO,EACNzqF,SAAS,CACR1pC,OAAMuC,OAAOqY,MAAMk0B,cAEpBnF,GAAAA,SAAS,CACR3pC,OAAMuC,OAAOqY,MAAMk0B,gBACnB9uC,OAAMuC,OAAOqY,MAAMi0B,eAGxB,EAAA;AAAA,IAAA,OAAS;AACN,aAAO,EACNnF,SAAS,CACR1pC,OAAMuC,OAAOqY,MAAMi0B,iBACnB7uC,OAAMuC,OAAOqY,MAAMm0B,gBAEpBpF,GAAAA,SAAS,CACR3pC,OAAMuC,OAAOqY,MAAMm0B,gBAGrB,EAAA;AAAA,IAAA;AAAA,EACD;AAED,WAAS8jF,oBAAoBuB,OAAOxgH,UAAUm6C,QAAQplD,MAAAA;AACrD,QAAI8sD,MAAM9sD,KAAKm7F;AACf,QAAInoG,MAAM,CAACy4H,KACX;AAAA,QAAIxgH,SACHjY,KAAIM,KAAK2X,QAAAA;AAEV,QAAI/S,QAAQb,OAAMwK;AAElB,QAAIY,OAAOpL,OAAMmc,QAAQ4xC,MAAAA;AAEzB,QAAI/tD,OAAMo+B,YAAYhzB,KAAK8D,SAASumD,IAAI7hC,MAAMqb,WAAW;AACxDtzC,UAAIM,KAAK;IACZ,WAAY+D,OAAMo+B,YAAYhzB,KAAK8D,IAAAA,KAASumD,IAAI7hC,MAAM3U,SAAS;AAC5DtjB,UAAIM,KAAK;IACT;AAEDN,QAAIM,KAAK,eAAe+D,OAAMo+B,YAAYhzB,KAAK8D,IAG/C,CAAA;AAAA,QAAIlP,OAAM4oC,cAAcx9B,IACvBzP,EAAAA,KAAIM,KAAK,sBAEV;AAAA,QAAI+D,OAAMgzD,YAAY5nD,IAAWqqD,MAAAA,IAAIpI,qBAAqBjiD,KAAKkP,SAAAA,CAAWm7C,IAAIpI,mBAAmB;AAChG1xD,UAAIM,KAAK,oBAAA;AAAA,IACT;AAED,QAAIw5D,IAAIr9B,eAAep4B,OAAMquB,eAAe0/B,MAAAA,GAAS;AACpDpyD,UAAIM,KAAK,gBAAA;AAAA,IACT;AAED,QAAI8xD,UAAUltD,MAAM8nC,SAAS;AAC5BhtC,UAAIM,KAAK,gBAAgB4E,MAAM+vC;AAC/B,UAAI/vC,MAAM0gD,YAAY;AACrB5lD,YAAIM,KAAK,iBAAiB4E,MAAM+vC,SAAAA;AAAAA,MAChC;AAAA,IACD;AAED,QAAI/vC,MAAMyjC,kBAAkBypB,QAAO;AAClCpyD,UAAIM,KAAK,mBACT;AAAA,UAAG4E,MAAMwzH,iBAAiB;AACzB14H,YAAIM,KAAK;MACb,OAAQ;AACJN,YAAIM,KAAK,qBAAA;AAAA,MACT;AAAA,IACD;AAED,QAAI4E,MAAMyzH,kBAAkBvmE,OAC3BpyD,KAAIM,KAAK,mBAAA;AAGV,QAAIw5D,IAAIwgC,2BAA2Bj2F,OAAMu0H,gBAAgB;AACxD,UAAIv0H,OAAMu0H,eAAenpH,MACxBzP,KAAIM,KAAK;IACV;AAED,QAAI4E,MAAM2zH,sBACR3zH,MAAMyzH,kBAAkBzzH,MAAMyjC,mBAC9BzjC,MAAMyzH,kBAAkBzzH,MAAMyjC,mBAC9BzjC,MAAMyzH,kBAAkBvmE,UAAUltD,MAAMyjC,kBAAkBypB,SAAS;AAEpE,UAAI0mE,UAAU5zH,MAAMyjC;AACpB,UAAImhB,aAAa5kD,MAAMwzH;AACvB,UAAI3uE,WAAW7kD,MAAM6zH;AAErB,UAAIC,YAAY30H,OAAM+lD,cAAc0uE,SAAS1mE,QAAQtI,YAAYC,QAEjE;AAAA,UAAIkvE,YAAY;AAChB,UAAID,WAAW;AACd,YAAIjvE,SACHkvE,aAAY;AAAA,YAEZA,aAAY;AAAA,MACjB,OAAU;AACN,YAAIlvE,SACHkvE,aAAY;AAAA,YAEZA,aAAY;AAAA,MACb;AACDj5H,UAAIM,KAAK24H;IACT;AACD,WAAOj5H,IAAIlD,KAAK,GAAA;AAAA,EAChB;AAED,WAAS66H,aAAav1H,QAAQpC,KAAKyP,MAAM6wB,SAAS15B,SAAQkyG,QACzD;AAAA,QAAI5zG,QAAQb,OAAMwK,SAAAA;AAClB,QAAIxQ,WAAWY;AACf,QAAKwQ,CAAAA,KAAKgE,cAAevO,CAAAA,MAAMyQ,UAAU;AACxCtX,kBAAY,CAAC2B,KAAK4G,QAAOmZ,MAAM,eAAe,aAAa,iBAAA;AAC3D9gB,gBAAUqhC,QAAQjiC,UAAUvB,KAAK;AACjCmC,cAAQqvB,aAAa,sBAAsB,YAC3C;AAAA,UAAGwqF,QAAO;AACT75G,gBAAQ3D,MAAM49H,aAAapgB,SAAS;AAAA,MACpC;AACD12G,aAAOpE,YAAYiB,OACnB;AAAA,IAAA;AAED,QAAKwQ,CAAAA,KAAKiE,aAAaxO,MAAM4J,UAAS;AACrCzQ,kBAAY,CAAC2B,KAAK4G,QAAOmZ,MAAM,cAAc,cAAc,eAC3D9gB;AAAAA,gBAAUqhC,QAAQjiC,UAAUvB,KAAK,GACjCmC,CAAAA;AAAAA,cAAQqvB,aAAa,sBAAsB;AAC3C,UAAGwqF,QAAO;AACT75G,gBAAQ3D,MAAM69H,cAAcrgB,SAAS;AAAA,MACrC;AACD12G,aAAOpE,YAAYiB,OACnB;AAAA,IAAA;AAAA,EAED;AAED,SAAOu3H;AACR;AC3Ye,SAASD,qBAAmBlyH;AAC1C,MAAI6I,gBAAgBksH,qBAAoB/0H,MAAAA;AACxC,SAAO,EACN2C,QAAQkG,eACRk9B,QAAQ,MAERyhE,cAAcA,iBACdS,iBAAiBA,qBAEnB;AAAA;ACb2B,SAAA+sB,4BAAAA;AAEzBp2H,UAAQC,MAAM;AACP,SAAA,EACL8D,QAAQ,WAAY;AAAA,EAAA,GACpB6kG,cAAc,WAAY;AAAA,EAAA,GAC1BS,iBAAiB,WAAA;AAAA,EAAY,EAEjC;AAAA;ACJA,SAASiqB,mBAAmBlyH,QAAAA;AAC3B,QAAM6I,gBAAgBksH,qBAAoB/0H,MAAAA;AAE1C,QAAMi1H,gBAAgB,CAAA;AAEtB,WAASC,gBAAgB35H,OAAOwH,UAAUoJ,UAAU5J,SAAQvC;AAC3D,QAAIpJ,aAAY;AAEhB,QAAI2L,QAAOmO,iBAAgB;AAC1B9Z,MAAAA,aAAY4wG,gBAAajsG,OAAOwH,UAAUoJ,QAAAA;AAAAA,IAC1C;AACD,WAAOvV;AAAAA,EACP;AAED,WAASu+H,qBAAqB/pH,MAAM7P,OAAO4Q,UAAUynD,OACpD;AAAA,UAAMwhE,YAAYp1H,OAAMsB,KAAKtB,OAAMmc,QAAQ5gB,MAAM2I;AACjDkxH,cAAUC,eAAejqH,KAAKlH;AAE9B,UAAMoxH,gBAAgBt1H,OAAMgF,UAAU,6BAA6B,CAACowH,UAAUlxH,IAAIkxH,WAAWhqH,KAAKlH,EAClG,CAAA;AAAA,QAAIoxH,kBAAkB,OAAM;AAC3B;AAAA,IACA;AAED,UAAM16H,UAAUiO,cAAcusH,WAAWjpH,QAAAA;AACzC,SAAIvR,SAAQ;AACX;AAAA,IACA;AAED,UAAMjE,SAASwV,SAAS4uE,aAAa3vE,KAAKlH,IAAI3I,MAAM2T,QAAQlP,OAAMuC,OAAOqxB,MAAMqb,SAC/E;AAAA,UAAMhuB,UAAU1qB,KAAKkS,OAAO0D,SAASZ,cAAcH,KAAKlH,EAAMvN,IAAAA,UAAU;AAExEiE,YAAQ3D,MAAMnC,MAAO8+D,MAAM9+D,MAAMmsB,UAAW;AAC5CrmB,YAAQC,UAAU0O,IAAI,oBAAA;AACtB3O,YAAQqvB,aAAa,yBAAyB7e,KAAKlH,EAAAA;AAEnD,WAAOtJ;AAAAA,EACP;AAED,WAAS26H,OAAOnnE,SAASonE,gBAAAA;AACxB,WAAOpnE,UAAU,MAAMonE;AAAAA,EACvB;AAGD,WAASC,iBAAiBrqH,MAAMe,UAAU5J,SAAQQ;AACjD,QAAIqI,KAAKwvD,WAAW,SAASxvD,KAAK+nF,WAAW/nF,KAAK+nF,QAAQn6F,QAAQ;AACjE,YAAMwF,KAAKnJ,SAASoE,cAAc,KACjCm6D,GAAAA,QAAQ5zD,OAAMusB,gBAAgBnhB,IAAAA;AAG/B,UAAIrI,UAAS;AACZA,iBAASzM,IAAI;AACbyM,iBAASqjG,QAAQpmG,OAAMi9G,SAAShnF;AAAAA,MAChC;AAED7qB,WAAK+nF,QAAQ/sF,QAAQ,SAAS2nD,QAAAA;AAC7B,YAAK/tD,CAAAA,OAAM0d,aAAaqwC,MAAAA,GAAQ;AAC/B;AAAA,QACA;AACD,cAAMxyD,QAAQyE,OAAMmc,QAAQ4xC,MAC5B;AAAA,YAAIn3D,aAAYs+H,gBAAgB35H,OAAOwH,UAAUoJ,UAAU5J,OAC3D;AAAA,YAAA,CAAK3L,YAAU;AACd;AAAA,QACA;AAED,cAAMgE,UAAUu6H,qBAAqB/pH,MAAM7P,OAAO4Q,UAAUynD;AAC5D,YAAIh5D,SAAS;AACZq6H,wBAAcM,OAAOh6H,MAAM2I,IAAIkH,KAAKlH,EAAOtJ,CAAAA,IAAAA;AAC3C4D,aAAG7E,YAAYiB;QACpB,OAAU;AACLq6H,wBAAcM,OAAOh6H,MAAM2I,IAAIkH,KAAKlH,EAAO,CAAA,IAAA;AAAA,QAC3C;AAAA,MAEL,CAAA;AAEG,aAAO1F;AAAAA,IACP;AACD,WAAO;AAAA,EACP;AAED,WAASk3H,kBAAkBtqH,MAAMs9F,UAAUv8F,UAAU5J,SAAQQ,UAAAA;AAC5D,UAAMvE,KAAKnJ,SAASoE,cAAc,KAAA,GAClCm6D,QAAQ5zD,OAAMusB,gBAAgBnhB;AAG9BrI,aAASzM,IAAI;AACbyM,aAASqjG,QAAQpmG,OAAMi9G,SAAShnF;AAEhC7qB,SAAK+nF,QAAQ/sF,QAAQ,SAAS2nD;AAC7B,YAAMxyD,QAAQyE,OAAMmc,QAAQ4xC,MAC5B;AAAA,YAAM4nE,YAAYJ,OAAOh6H,MAAM2I,IAAIkH,KAAKlH,EACxC;AAAA,UAAItN,aAAYs+H,gBAAgB35H,OAAOwH,UAAUoJ,UAAU5J,OAC3D;AAAA,UAAI3L,iBAAgBq+H,cAAcU,SAAAA,GAAY;AAE7C,YAAI/+H,YAAW;AACd,gBAAMgE,UAAUu6H,qBAAqB/pH,MAAM7P,OAAO4Q,UAAUynD;AAC5DqhE,wBAAcU,SAAAA,IAAa/6H,WAAW;AAAA,QAC3C,OAAW;AACNq6H,wBAAcU,SAAAA,IAAa;AAAA,QAC3B;AAAA,MACD;AACD,UAAA,CAAA,CAAMV,cAAcU,SAAY,GAAA;AAC/Bn3H,WAAG7E,YAAYs7H,cAAcU;MAC7B;AACDjtB,eAASptG,YAAY;AACrBotG,eAAS/uG,YAAY6E;IACxB,CACE;AAAA,EAAA;AAID,SAAO,EACNmE,QAAQ8yH,kBACR1vF,QAAQ2vF,mBAERluB,cAAcA,iBACdS,iBAAiBA,qBAEnB;AAAA;ACzHe,SAAAd,aAAStgG,MAAM8B,MAAMpG,SACnC;AAAA,SAAO,EACNzN,KAAK6T,KAAK8C,WAAW5E,KAAK3C,EAC1BvN,GAAAA,QAAQgS,KAAK4C,cAAc1E,KAAK3C,EAChCnP,GAAAA,MAAM,GACNC,OAAOunB;AAET;ACPe,SAASq5G,qBAAqB1sG,OAAOyY,UACnD;AAAA,MAAIk0F,iBAAiB;AACrB,MAAIC,gBAAgB5sG,MAAMn0B,KAAKiE,SAAS;AACxC,MAAG2oC,UAAS;AACX,aAAQ5oC,IAAI,GAAGA,IAAImwB,MAAMn0B,KAAKiE,QAAQD,KAAI;AACzC,UAAIhE,OAAOm0B,MAAMn0B,KAAKgE,CACtB;AAAA,UAAGhE,OAAO4sC,SAASlrC,GAAE;AACpBo/H,yBAAiB98H;AAAAA,MACjB;AACD,UAAGhE,OAAO4sC,SAASwkE,OAAM;AACxB2vB,wBAAgB/8H;AAChB;AAAA,MACA;AAAA,IACD;AAAA,EACD;AAED,SAAO,EACN+P,OAAO+sH,gBACP9sH,KAAK+sH,cAAAA;AAEP;AClBe,SAASC,gBAAgBnnG,aAAa1F,OAAOnmB,UAAU/C,QACrE;AAAA,MAAItJ,QAAQwyB,MAAMxyB,MAAMk4B,WACxB;AAAA,MAAGl4B,SAAS,GAAE;AACb,WAAO;AAAA,EACP;AACD,MAAA,CAAIsJ,OAAMuC,OAAOmO,mBAAmB21F,eAAermG,MAAAA,GAAO;AACzD,WAAO;AAAA,EACP;AACD,MAAIg2H,gBAAgB9sG,MAAMn0B,KAAK65B,WAAel4B,IAAAA;AAC9C,MAAIu/H,iBAAiB/sG,MAAMn0B,KAAK65B,WAAAA,IAAel4B;AAC/C,SAAQs/H,iBAAiBjzH,SAASojG,SAAS8vB,kBAAkBlzH,SAAStM;AACvE;ACbe,SAAAy/H,cAAU1iG,OAAOxzB,QAC/B;AAAA,MAAIm2H,oBAAoBn2H,OAAMuC,OAAOyzB;AACrCxC,UAAQA,SAAS,CACjB;AAAA,MAAI2iG,qBAAqB3iG,MAAM0rB,OAAO/iD,OAAKA,EAAE+H,OAAO,2BAAA,EAA6BlL,WAAW,GAAE;AAC7F,QAAI6H,QAAQb,OAAMwK,SAAAA;AAClB,QAAI4rH,aAAa;AACjB,QAAIhnH,aAAavO,MAAMyQ;AACvB,QAAIjC,WAAWxO,MAAM4J;AACrB,QAAI+oB,MAAMx6B,QAAO;AAChBo9H,mBAAa5iG,MAAMA,MAAMx6B,SAAQ,CAAA,EAAGkL;AAAAA,IACpC;AACD,QAAImyH,kBAAkB,EACrBjnH,YACAC,UACAzD,YAAYuqH,kBAAkBx/H,UAAU,GACxCuN,IAAI,6BACJmwE,aAAa,MACb+hD,YACAE,aAAaH,kBAAkBz3C,YAAY,UAC3Ch1C,SAAQ,CACRC,GAAAA,SAAS;AAEVnW,UAAMv3B,KAAKo6H,eACX;AAAA,EAAA;AACF;ACjBA,SAASE,mBAAmBv2H,QAC3B;AAAA,MAAIw2H,gBAAgB,CAAA;AACpB,MAAIhhB,eAAe,CAAA;AAEnB,WAASihB,WAAW5vH,MAAM+nB;AACzB,QAAG4nG,cAAc3vH,KAAK3C,EAAAA,EAAI0qB,WAAgB4nG,KAAAA,cAAc3vH,KAAK3C,EAAI0qB,EAAAA,WAAAA,EAAap5B,YAAW;AACxF,aAAO;AAAA,IACV,OAAO;AACJ,aAAO;AAAA,IACP;AAAA,EACD;AAED,WAASkhI,mBAAmB3oE,QAAQn/B,aAAAA;AACnC,QAAG4nG,cAAczoE,MAAAA,KAAWyoE,cAAczoE,MAAQn/B,EAAAA,WAAAA,KACjD4nG,cAAczoE,MAAAA,EAAQn/B,WAAap5B,EAAAA,YAClC;AACAghI,oBAAczoE,MAAAA,EAAQn/B,WAAap5B,EAAAA,WAAWqE,YAAY28H,cAAczoE,QAAQn/B,WAChF,CAAA;AAAA,IAAA;AAAA,EACF;AAED,WAAS+nG,qBAAqBhuH,MAAAA;AAC7B,QAAIwJ,aAAYxJ,KAAKo7F;AACrB,QAAI6yB;AACJ,eAAWzkH,WAAU4J,oBAAoB,aAAa;AACrD66G,oBAAczkH,WAAU4J;AAExB,UAAI0G,MAAM7jB,QAAQq2D,QAAQr2D,QAAQ6jB;AAClCA,UAAI,0IAAA;AAAA,IACP,OAAS;AACNm0G,oBAAczkH,WAAU2J;AAAAA,IACxB;AACD,WAAO86G;AAAAA,EACP;AACD,WAASC,uBAAuBluH,MAC/B;AAAA,QAAIwJ,aAAYxJ,KAAKo7F,cACrB;AAAA,QAAI+yB,kBAAkB3kH,WAAUsyC;AAChC,WAAOqyE;AAAAA,EACP;AAED,WAASC,YAAYlwH,MAAMhQ,MAAM8R,MAAMpG,SAAQQ,UAC9C;AAAA,QAAI0yD,MAAM9sD,KAAK2Q,SAAAA;AACf,QAAIytC,QAAQ0O,IAAI1O;AAChB,QAAI6vE,cAAcD,qBAAqBhuH,IAAAA;AACvC,QAAImuH,kBAAkBD,uBAAuBluH,IAE7C;AAAA,QAAIpG,QAAOmtC,iBAAiB;AAC3B,WAAI8mF,cAAc3vH,KAAK3C,EAAI,GAAA;AAC1BsyH,sBAAc3vH,KAAK3C,MAAM;MACzB;AACD,UAAIsxG,CAAAA,aAAa3uG,KAAK3C,EAAI,GAAA;AACzBsxG,qBAAa3uG,KAAK3C,EAAM,IAAA;MACxB;AAED,UAAI6S,QAAQ6+G,qBAAqBngE,KAAK1yD,QAAAA;AAEtC,eAAQhK,KAAKy8G,aAAa3uG,KAAK3C,EAAI,GAAA;AAClC,YAAIT,QAAQ+xG,aAAa3uG,KAAK3C,EAAInL,EAAAA,CAAAA;AAElC,YAAGikE,OAAOv5D,KAAAA,IAASsT,MAAMjO,SAASk0D,OAAOv5D,KAAAA,IAASsT,MAAMhO,KAAI;AAC3D2tH,6BAAmB7vH,KAAK3C,IAAIT;QAC5B;AAAA,MACD;AACD+xG,mBAAa3uG,KAAK3C,EAAM,IAAA;AAExB,eAAS0qB,cAAc7X,MAAMjO,OAAO8lB,eAAe7X,MAAMhO,KAAK6lB,eAAe;AAC5E,YAAIgL,OAAOo9F,cAAcvhE,KAAK7mC,aAAa/nB,MAAM9D,UAAUgkD,OAAO6vE,aAAaE,iBAAiBv0H,OAChG;AAAA,YAAA,CAAIq3B,QAAQ68F,WAAW5vH,MAAM+nB,WAAAA,GAAa;AACzC8nG,6BAAmB7vH,KAAK3C,IAAI0qB,WAC5B;AAAA,QAAA,WAASgL,QAASA,CAAAA,KAAKpkC,YAAW;AAClCqB,eAAK8C,YAAYigC;QACjB;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAED,WAASo9F,cAAc9tG,OAAO0F,aAAa/nB,MAAM9D,UAAUgkD,OAAO6vE,aAAaE,iBAAiBv0H;AAC/F,QAAI7L,QAAQwyB,MAAMxyB,MAAMk4B,WAAAA,GACvB8xF,WAAW;AAEZ,QAAIqV,gBAAgBnnG,aAAa1F,OAAOnmB,UAAU/C,SAAQ;AAEzD,UAAIi3H,qBAAqBL,YAAY/vH,MAAMqiB,MAAMjN,QAAQ2S,WACzD,CAAA;AAAA,UAAIsoG,sBAAsB;AAC1B,UAAIJ,iBAAiB;AACpBI,8BAAsBJ,gBAAgBjwH,MAAMqiB,MAAMjN,QAAQ2S;MAC1D;AAED,UAAGrsB,QAAOotC,mBAAkB;AAE3B,YAAIwnF,gBAAgBF,sBAAsBC;AAC1C,cAAK30H,QAAOqtC,2BAA2BunF,aAAY;AAClD,iBAAO;AAAA,QACP;AAAA,MACD;AAED,UAAGX,cAAc3vH,KAAK3C,EAAAA,EAAI0qB,cAAa;AACtC4mF,qBAAa3uG,KAAK3C,EAAI0qB,EAAAA,WAAAA,IAAeA;AACrC,eAAO4nG,cAAc3vH,KAAK3C,IAAI0qB,WAC9B;AAAA,MAAA;AACD,UAAIgL,OAAOvkC,SAASoE,cAAc;AAClCmgC,WAAK3iC,MAAMP,QAAQ,QAAU;AAE7BgqH,iBAAW,qBAAqB9xF,eAAem4B,QAAQ,IAAI,qBAAqB;AAChF,UAAIkwE,oBAAoB;AACvBvW,oBAAY,MAAMuW;AAAAA,MAClB;AACDr9F,WAAK5/B,YAAY0mH;AAEjB,UAAIwW,qBAAqB;AACxBt9F,aAAKt+B,YAAY47H;AAAAA,MACjB;AAEDt9F,WAAK3iC,MAAM2J,WAAW;AACtBg5B,WAAK3iC,MAAMlC,OAAOm0B,MAAMn0B,KAAK65B,WAAAA,IAAe;AAC5C4nG,oBAAc3vH,KAAK3C,EAAI0qB,EAAAA,WAAAA,IAAegL;AACtC47E,mBAAa3uG,KAAK3C,EAAI0qB,EAAAA,WAAAA,IAAeA;AAErC,aAAOgL;AAAAA,IACP;AACD,WAAO;AAAA,EACP;AAED,WAASw9F,gBAAgBvwH,MAAM8B,MAAMpG,SAAQQ,UAC5C;AAAA,QAAIoP,aAAYxJ,KAAKo7F,cAAAA;AACrB,QAAItuC,MAAM9sD,KAAK2Q,SACf;AAAA,QAAIytC,QAAQ0O,IAAI1O;AAEhB,QAAGxkD,QAAOotC,sBAAsBptC,QAAOqtC,yBAAwB;AAC9D,aAAO;AAAA,IACP;AAED,QAAInzB,MAAMpnB,SAASoE,cAAc,KAEjC;AAAA,QAAI49H,kBAAkBV,qBAAqBhuH,IAAAA;AAC3C,QAAI2uH,mBAAmBT,uBAAuBluH,IAE9C;AAAA,QAAIoO;AAEJ,QAAA,CAAIhU,aAAaR,QAAOmO,mBAAmB21F,eAAermG,MAAAA,GAAO;AAChE+W,cAAQ,EACPjO,OAAO,GACPC,KAAKg+C,QAAQ,EAEjB;AAAA,IAAA,OAAS;AACNhwC,cAAQ6+G,qBAAqBngE,KAAK1yD,SAAStM,CAAAA;AAAAA,IAC3C;AACD,QAAI8L,QAAOmtC,iBAAiB;AAC3B8mF,oBAAc3vH,KAAK3C,MAAM;AACzBsxG,mBAAa3uG,KAAK3C,EAAM,IAAA;AACxB,eAAS0qB,cAAc7X,MAAMjO,OAAO8lB,eAAe7X,MAAMhO,KAAK6lB,eAAe;AAC5E,YAAIgL,OAAOo9F,cAAcvhE,KAAK7mC,aAAa/nB,MAAM9D,UAAUgkD,OAAOswE,iBAAiBC,kBAAkB/0H,OACrG;AAAA,YAAGq3B,MAAK;AACPnd,cAAI9iB,YAAYigC;QAChB;AAAA,MACD;AAAA,IACD;AAED,UAAM7lB,QAAQpL,KAAK+E,QAAQqtG;AAC3B,UAAMwc,MAAMxjH,MAAMmzC,aAAargD,KAAK3C,EAAM,IAAA,MAAM;AAEhD,QAAI0yH,cAAczkH,WAAUqyC,eAAe39C,KAAKuI,YAAYvI,KAAKwI,UAAUxI,IAAAA;AAC3E,QAAIlL,MAAM,oBAAoB47H,MAAM,SAAS,OAAOX,cAAc,MAAMA,cAAc;AAEtF,QAAG7iH,MAAM8kB,WAAWhyB,KAAK3C,EAAK,GAAA;AAC7BvI,aAAO;AAAA,IACP;AAED8gB,QAAIziB,YAAY2B;AAEhB,QAAI4G,QAAOmO,iBAAiB;AAC3B+L,UAAIxlB,MAAM2J,WAAW;AACrB6b,UAAIxlB,MAAMnC,MAAM6T,KAAK8C,WAAW5E,KAAK3C,EAAAA,IAAM;AAC3CuY,UAAIxlB,MAAMP,QAAQ;AAAA,IACrB,OAAO;AACJ+lB,UAAIxlB,MAAM2J,WAAW;AAAA,IACrB;AACD6b,QAAIxlB,MAAMN,SAAUgS,KAAK4C,cAAc1E,KAAK3C,EAAAA,IAAO;AAEnD,QAAI2C,KAAK3C,MAAM,6BAA4B;AAC1C,UAAIszH,iBAAiB;AACrB,UAAI3wH,KAAKuvH,YAAW;AACnB,YAAIqB,cAAc9uH,KAAK8C,WAAW5E,KAAKuvH,UACvC;AAAA,YAAIsB,iBAAiB/uH,KAAK4C,cAAc1E,KAAKuvH;AAC7CoB,yBAAiBC,cAAcC;AAAAA,MAC/B;AAED,UAAIr+C,YAAYxyE,KAAK+E,cAAcjD,KAAKsD,WAAWhW;AAEnD,UAAI0hI,oBAAoBt+C,YAAYm+C;AAEpC,UAAIG,oBAAoB,GAAE;AACzBA,4BAAoB;AAAA,MACpB;AAED,UAAIp1H,QAAOmO,iBAAiB;AAC3B+L,YAAIxlB,MAAMnC,MAAM0iI,iBAAiB;AAAA,MACjC;AACD/6G,UAAIxlB,MAAMN,SAASghI,oBAAoB;AAAA,IACvC;AAGD,QAAGhvH,KAAK+E,QAAQswG,gBAAe;AAC9BvhG,UAAIwN,aAAathB,KAAK+E,QAAQswG,gBAAgBn3G,KAAK3C,EAAAA;AACnDuY,UAAIwN,aAAathB,KAAK+E,QAAQ9I,OAAO,OAAOiC,KAAK3C,EACjD;AAAA,IAAA;AAED,WAAOuY;AAAAA,EACP;AAED,SAAO,EACN9Z,QAAQy0H,iBACRrxF,QAAQgxF,aACR5vB,cACAc,iBAAiBA,sBACjBC,aAAaguB,cAEf;AAAA;AC1NA,SAAS0B,iBAAiB53H,QAE1B;AAAA,WAAS63H,qBAAqBp6G,MAAM9U,MAAMpG,SACzC;AAAA,QAAIob,SAAS3d,OAAMmc,QAAQsB,KAAKE,MAAAA;AAChC,QAAGA,OAAOk/F,UAAS;AAClB;AAAA,IACA;AAED,QAAItgH,SAASyD,OAAMmc,QAAQsB,KAAKlhB,MAChC;AAAA,QAAGA,OAAOsgH,UAAS;AAClB;AAAA,IACA;AAED,QAAIhe,KAAKi5B,aAAaC,aAAat6G,MAAM9U,MAAMgV,QAAQphB,MACvD;AAAA,QAAIwhC,KAAK8gE,GAAGm5B,MAAMn5B,GAAGvoG;AACrB,QAAIwnC,KAAK+gE,GAAGo5B,MAAMp5B,GAAGpoG;AACrB,QAAIqnC,CAAAA,MAAAA,CAAOC,IAAG;AACb,aAAO;AAAA,IACP;AAGD,QAAIpxB,OAAOmrH,aAAaI,WAAWz6G,MAAM9U,MAAMgV,QAAQphB,MAAAA;AACvD,UAAM47H,QAAQC,OAAOC,UAAU1rH,MAAMhE,IAAAA;AAErC,UAAM2vH,SAASC,0BAA0BJ,MAAMj5E,OAAOg2C,OAAKA,EAAEoZ,OAAO,CAAA,GAAI/rG,OAExE;AAAA,UAAM/I,MAAMg/H,cAAcF,QAAQ3vH,MAAM8U,MAAMlb,OAG9C;AAAA,QAAI5G,MAAM;AAEV,QAAI8hB,KAAK/G,OAAO;AACf/a,aAAO;AAAA,IACP;AACD,QAAIi7H,cAAc52H,OAAMmS,UAAUizC,aAAaplD,OAAMmS,UAAUizC,WAAW3nC,IAAQ,IAAA;AAClF,QAAIm5G,aAAa;AAChBj7H,aAAO,MAAMi7H;AAAAA,IACb;AAED,QAAIr0H,QAAO0zF,2BAA2Bj2F,OAAMy4H,gBAAgB;AAC3D,UAAIz4H,OAAMy4H,eAAeh7G,IACxB9hB,EAAAA,QAAO;AAAA,IACR;AAEDnC,QAAIQ,YAAY2B;AAEhB,QAAGgN,KAAK+E,QAAQgkC,gBAAe;AAC9Bl4C,UAAIywB,aAAathB,KAAK+E,QAAQgkC,gBAAgBj0B,KAAKvZ;AACnD1K,UAAIywB,aAAa,WAAWxM,KAAKvZ,EAAAA;AAAAA,IACjC;AACD,QAAIuZ,KAAK/G,OAAO;AACfld,UAAIvC,MAAM+7H,YAAY,+BAA+Bv1G,KAAK/G;IAC1D;AAED1W,IAAAA,OAAM08B,SAASg8F,SAASj7G,MAAMjkB,GAE9B;AAAA,WAAOA;AAAAA,EACR;AAEC,WAASg/H,cAAcF,QAAQ3vH,MAAM8U,MAAMlb,SAAAA;AAC1C,UAAMu5B,YAAYzmC,SAASoE,cAAc,KAAA;AAEzC6+H,WAAOlyH,QAAQuyH;AACd,UAAI/9H;AACJ,UAAI+9H,MAAMzpH,SAAS,QAAQ;AAC1BtU,kBAAUw9H,OAAOQ,YAAYD,MAAMjpH,MAAM,MAAM/G,MAAM8U,KAAKE,MAAAA;AAAAA,MAC9D,WAAcg7G,MAAMzpH,SAAS,UAAU;AACnCtU,kBAAUw9H,OAAOS,cAAcF,MAAMjpH,MAAM/G,IAC/C;AAAA,MAAA,WAAagwH,MAAMzpH,SAAS,SAAS;AACjCtU,kBAAUw9H,OAAOU,aAAaH,MAAMjpH,MAAMnN,OAAAA;AAAAA,MAC1C;AAEDu5B,gBAAUniC,YAAYiB;IAAQ,CAG/B;AAAA,WAAOkhC;AAAAA,EACP;AAED,WAASy8F,0BAA0BJ,OAAO51H,SACzC;AAAA,UAAMw2H,SAASx2H,QAAOy2H,eAAe;AACrC,UAAMC,YAAY12H,QAAO0uC,mBAAmB;AAC5C,UAAMqnF,SAAS,CAAA;AAEf,aAASv/H,IAAI,GAAGA,IAAIo/H,MAAMn/H,QAAQD,KAAK;AACtC,YAAMmgI,OAAOf,MAAMp/H,CAAAA;AACnB,YAAMogI,WAAWhB,MAAMp/H,IAAI,CAAA;AAE3B,WAAKogI,YAAY52H,QAAOy2H,eAAe,GAAG;AACzCV,eAAOr8H,KAAK,EAAEiT,MAAM,QAAQQ,MAAMwpH,KAAAA,CAAAA;AAClC;AAAA,MACA;AAED,UAAIA,KAAKxsC,cAAcysC,SAASzsC,WAAW;AAC1C,YAAGwsC,KAAK5qB,OAAOyqB,UAAUI,SAAS7qB,OAAOyqB,QAAO;AAC/CT,iBAAOr8H,KAAK,EAAEiT,MAAM,QAAQQ,MAAMwpH,KAClC,CAAA;AAAA;AAAA,QACA;AACDA,aAAK5qB,QAAQyqB;AACbT,eAAOr8H,KAAK,EAAEiT,MAAM,QAAQQ,MAAMwpH,KAAAA,CAAAA;AAElC,YAAIE,UAAUF,KAAKziI;AACnB,YAAI4iI,UAAUH,KAAK5iI,IAAIiM,QAAO+2H,kBAAkB;AAEhD,gBAAQJ,KAAKxsC,WACZ;AAAA,UAAA,KAAK;AACJ0sC,uBAAWF,KAAK5qB;AAChB;AAAA,UACD,KAAK;AACJ8qB,uBAAWF,KAAK5qB;AAChB;AAAA,UACD,KAAK;AACJ+qB,uBAAWH,KAAK5qB;AAChB;AAAA,UACD,KAAK;AACJ+qB,uBAAWH,KAAK5qB;AAChB;AAAA,QAAA;AAGF,cAAMirB,SAAS,EACd9iI,GAAG2iI,SACH9iI,GAAG+iI,SACH3sC,WAAW,EAAEpnC,MAAM4zE,KAAKxsC,WAAWnnC,IAAI4zE,SAASzsC,UAAAA,GAChDqsC,OAEDT;AAAAA,eAAOr8H,KAAK,EAAEiT,MAAM,UAAUQ,MAAM6pH,OAAAA,CAAAA;AAEpC,gBAAQJ,SAASzsC,WAAAA;AAAAA,UAChB,KAAK;AACJysC,qBAAS1iI,KAAKsiI;AACdI,qBAAS7qB,QAAQyqB;AACjB;AAAA,UACD,KAAK;AACJI,qBAAS1iI,KAAKsiI;AACdI,qBAAS7qB,QAAQyqB;AACjB;AAAA,UACD,KAAK;AACJI,qBAAS7iI,KAAKyiI;AACdI,qBAAS7qB,QAAQyqB;AACjB;AAAA,UACD,KAAK;AACJI,qBAAS7iI,KAAKyiI;AACdI,qBAAS7qB,QAAQyqB;AACjB;AAAA,QAEN;AAAA,MAAA,OAAU;AACNT,eAAOr8H,KAAK,EAAEiT,MAAM,QAAQQ,MAAMwpH;MAClC;AAAA,IACD;AAED,UAAMM,WAAWrB,MAAMA,MAAMn/H,SAAS,CAEtC;AAAA,QAAIwgI,SAAS9sC,cAAc,WAAW8sC,SAAS9sC,cAAc,QAAQ;AACpE8sC,eAASlrB,QAAQ2qB,YAAU,IAAE;AAE7B,UAAIQ,SAASD,SAAS9sC,cAAc,UAAW8sC,SAAS/iI,IAAI+iI,SAASlrB,OAAQkrB,SAAS/iI,IAAI+iI,SAASlrB,OAAO2qB,YAAU;AACpH,UAAIS,SAASF,SAASljI,IAAKiM,QAAO+2H,kBAAkB,IAAML,YAAY,IAAK;AAE3E,UAAGO,SAAS9sC,cAAc,QAAO;AAChCgtC,kBAAU;AACVD,kBAAU;AAAA,MACd,OAAQ;AACJA,kBAAU;AAAA,MACV;AACD,YAAME,QAAQ,EACbljI,GAAGgjI,QACHnjI,GAAGojI,QACHprB,MAAM2qB,WACNvsC,WAAW8sC,SAAS9sC,UAAAA;AAGrB4rC,aAAOr8H,KAAK,EAAEiT,MAAM,QAAQQ,MAAM8pH,SAAAA,CAAAA;AAClClB,aAAOr8H,KAAK,EAAEiT,MAAM,SAASQ,MAAMiqH,MAAAA,CAAAA;AAAAA,IACtC,OAAS;AACNrB,aAAOr8H,KAAK,EAAEiT,MAAM,QAAQQ,MAAM8pH,SAClC,CAAA;AAAA,IAAA;AAED,WAAOlB;AAAAA,EACP;AAIF,MAAIF,SAAS,EACZwB,aAAa,MACbC,MAAM,EAAC9kI,MAAQ,QAAQC,OAAS,SAASixB,IAAM,MAAMC,MAAQ,UAC7D4zG,MAAM,CAAA,GACNx1H,OAAO,WAAA;AACNrH,SAAK28H,cAAc;AACnB38H,SAAK68H,OAAO;EACZ,GACDC,OAAO,SAAU7wH,KAChBjM;AAAAA,SAAK28H,cAAc55H,OAAMsB,KAAK4H,GAAAA;AAAAA,EAC9B,GACDmvH,WAAW,SAAU1rH,MACpB1P;AAAAA,SAAKqH,MACLrH;AAAAA,SAAK88H,MAAMptH,KAAK,CAAA,CAAA;AAChB,aAAS5T,IAAI,GAAGA,IAAI4T,KAAK3T,QAAQD,KAAK;AACrCkE,WAAK+8H,QAAQrtH,KAAK5T,CAAAA,CAAAA;AAAAA,IAClB;AACD,WAAOkE,KAAKg9H,SAAAA;AAAAA,EACZ,GACDD,SAAS,SAAU9wH;AAClB,QAAIk8E,OAAOplF,OAAMsB,KAAK4H,GAAAA;AACtB,QAAIV,OAAOvL,KAAK28H;AAEhB,QAAIV,OAAOj8H,KAAKi9H,UAAU1xH,MAAM48E,IAAAA;AAChCnoF,SAAK68H,KAAK79H,KAAKi9H,IACfj8H;AAAAA,SAAK28H,cAAcx0C;AAAAA,EACnB,GACD60C,UAAU,WAAA;AACT,WAAOh9H,KAAK68H;AAAAA,EACZ,GACDK,mBAAmB,SAAU/P,GAAGzhH,MAAMolD,QAAAA;AACrC,QAAIxrD,UAASoG,KAAKm7F,WAClB;AAAA,QAAItkF,KACH46G,eAAe73H,QAAOyuC,oBACtB16C,IAAI8zH,EAAE9zH,IAAI,eAAiB;AAC5B,YAAQ8zH,EAAE19B,WACT;AAAA,MAAA,KAAKzvF,KAAK48H,KAAK9kI;AACdyqB,cAAM,EACL1qB,KAAKwB,GACLK,QAAQyjI,cACR5U,YAAY4U,cACZrlI,MAAMq1H,EAAE3zH,IAAI2zH,EAAE9b,OAAO8rB,eAAe,GACpC1jI,OAAO0zH,EAAE9b,OAAO8rB,aAAAA;AAEjB;AAAA,MACD,KAAKn9H,KAAK48H,KAAK7kI;AACdwqB,cAAM,EACL1qB,KAAKwB,GACLkvH,YAAY4U,cACZzjI,QAAQyjI,cACRrlI,MAAMq1H,EAAE3zH,IAAI2jI,eAAe,GAC3B1jI,OAAO0zH,EAAE9b,OAAO8rB,aAAAA;AAEjB;AAAA,MACD,KAAKn9H,KAAK48H,KAAK5zG;AACdzG,cAAM,EACL1qB,KAAKwB,IAAI8zH,EAAE9b,MACXkX,YAAY4E,EAAE9b,OAAO8rB,cACrBzjI,QAAQyzH,EAAE9b,OAAO8rB,cACjBrlI,MAAMq1H,EAAE3zH,IAAI2jI,eAAe,GAC3B1jI,OAAO0jI,aAAAA;AAER;AAAA,MACD,KAAKn9H,KAAK48H,KAAK3zG;AACd1G,cAAM,EACL1qB,KAAKwB,GACLkvH,YAAY4E,EAAE9b,OAAO8rB,cACrBzjI,QAAQyzH,EAAE9b,OAAO8rB,cACjBrlI,MAAMq1H,EAAE3zH,IAAI2jI,eAAe,GAC3B1jI,OAAO0jI,aAAAA;AAER;AAAA;AAKF,WAAO56G;AAAAA,EACP,GACD66G,gBAAgB,SAAUjQ,GAAGzhH,MAAAA;AAC5B,QAAIpG,UAASoG,KAAKm7F,WAClB;AAAA,QAAItkF,KACH86G,YAAY/3H,QAAO+2H,iBACnBc,eAAe73H,QAAOyuC,oBACtBs9D,OAAO8b,EAAE9b,OAAOgsB;AACjB,YAAQlQ,EAAE19B;MACT,KAAKzvF,KAAK48H,KAAK9kI;AAAAA,MACf,KAAKkI,KAAK48H,KAAK7kI;AACdwqB,cAAM,EACL7oB,QAAQ2jI,WACR5jI,OAAO43G,MACP91B,YAAY4hD,eAAeE,aAAa,GACxCzF,aAAauF,eAAeE,aAAa,EAE1C;AAAA;AAAA,MACD,KAAKr9H,KAAK48H,KAAK5zG;AAAAA,MACf,KAAKhpB,KAAK48H,KAAK3zG;AACd1G,cAAM,EACL7oB,QAAQ23G,MACR53G,OAAO4jI,WACP9hD,YAAY4hD,eAAeE,aAAa,GACxCzF,aAAauF,eAAeE,aAAa,EAAA;AAE1C;AAAA,IAMF;AAAA,WAAO96G;AAAAA,EACP,GACDo5G,aAAa,SAAUxO,GAAGrhH,KAAKJ,MAAMolD,QAAAA;AACpC,QAAI7kD,MAAMjM,KAAKk9H,kBAAkB/P,GAAGzhH,MAAMolD,MAAAA;AAC1C,QAAIwqB,UAAUljF,SAASoE,cAAc,KAAA;AACrC8+E,YAAQthF,MAAMyC,UAAU,CACvB,SAASwP,IAAIpU,MAAM,MACnB,UAAUoU,IAAInU,OAAO,MACrB,YAAYmU,IAAIvS,SAAS,MACzB,WAAWuS,IAAIxS,QAAQ,IAAA,EACtB+B,KAAK,GAAA;AACP8/E,YAAQv+E,YAAY;AAEpB,QAAIugI,WAAWt9H,KAAKo9H,eAAejQ,GAAGzhH,IACtC;AAAA,QAAIu5F,QAAQ7sG,SAASoE,cAAc,KAAA;AACnCyoG,UAAMjrG,MAAMyC,UAAU,CACrB,YAAY6gI,SAAS5jI,SAAS,MAC9B,WAAW4jI,SAAS7jI,QAAQ,MAC5B,gBAAgB6jI,SAAS/hD,YAAY,MACrC,iBAAiB+hD,SAAS1F,aAAa,IAAA,EACtCp8H,KAAK,GAEPypG;AAAAA,UAAMloG,YAAY,qBAAqBowH,EAAE19B;AACzCnU,YAAQ5+E,YAAYuoG,KAAAA;AAEpB,WAAO3pB;AAAAA,EACP,GAEDsgD,eAAe,SAAUU,QAAQ5wH,MAChC;AAAA,UAAMowH,SAASQ,OAAOR;AACtB,UAAMx2H,UAASoG,KAAKm7F,WACpB;AAAA,UAAM02B,YAAYj4H,QAAO+2H,mBAAmB;AAC5C,UAAMmB,YAAYplI,SAASoE,cAAc,KAEzCghI;AAAAA,cAAU5/H,UAAU0O,IAAI,mBAAA;AACxBkxH,cAAU5/H,UAAU0O,IAAI,qBAAqBgwH,OAAO7sC,UAAUpnC,IAAAA,IAAQi0E,OAAO7sC,UAAUnnC,EAAAA,EAAAA;AAEvFk1E,cAAUxjI,MAAMP,QAAQ,GAAGqiI;AAC3B0B,cAAUxjI,MAAMN,SAAS,GAAGoiI,MAE5B;AAAA,QAAI2B;AACJ,QAAIC;AAEJ,QAAIpB,OAAO7sC,UAAUpnC,SAAS,WAAWi0E,OAAO7sC,UAAUnnC,OAAO,QAAQ;AACxEm1E,uBAAiB;AACjBC,yBAAmB;AACnBF,gBAAUxjI,MAAMlC,OAAO,GAAGwkI,OAAO9iI,IAAI8L,QAAO+2H,kBAAgB,CAC5DmB;AAAAA,gBAAUxjI,MAAMnC,MAAM,GAAGykI,OAAOjjI,CACnC;AAAA,IAAA,WAAaijI,OAAO7sC,UAAUpnC,SAAS,UAAUi0E,OAAO7sC,UAAUnnC,OAAO,SAAS;AAC/Em1E,uBAAiB;AACjBC,yBAAmB;AACnBF,gBAAUxjI,MAAMlC,OAAO,GAAGwkI,OAAO9iI,IAAI8L,QAAO+2H,kBAAgB,CAC5DmB;AAAAA,gBAAUxjI,MAAMnC,MAAM,GAAGykI,OAAOjjI,CACnC;AAAA,IAAA,WAAaijI,OAAO7sC,UAAUpnC,SAAS,WAAWi0E,OAAO7sC,UAAUnnC,OAAO,MAAM;AAC7Em1E,uBAAiB;AACjBC,yBAAmB;AACnBF,gBAAUxjI,MAAMlC,OAAO,GAAGwkI,OAAO9iI,IAAI8L,QAAO+2H,kBAAgB,CAAA;AAC5DmB,gBAAUxjI,MAAMnC,MAAM,GAAGykI,OAAOjjI,IAAIyiI,MAAAA;AAAAA,IACvC,WAAaQ,OAAO7sC,UAAUpnC,SAAS,QAAQi0E,OAAO7sC,UAAUnnC,OAAO,SAAS;AAC7Em1E,uBAAiB;AACjBC,yBAAmB;AACnBF,gBAAUxjI,MAAMlC,OAAO,GAAGwkI,OAAO9iI,IAAI8L,QAAO+2H,kBAAgB,CAC5DmB;AAAAA,gBAAUxjI,MAAMnC,MAAM,GAAGykI,OAAOjjI,IAAIyiI,MACvC;AAAA,IAAA,WAAaQ,OAAO7sC,UAAUpnC,SAAS,UAAUi0E,OAAO7sC,UAAUnnC,OAAO,QAAQ;AAC9Em1E,uBAAiB;AACjBC,yBAAmB;AACnBF,gBAAUxjI,MAAMlC,OAAO,GAAGwkI,OAAO9iI,IAAIsiI,SAASx2H,QAAO+2H,kBAAgB,CACrEmB;AAAAA,gBAAUxjI,MAAMnC,MAAM,GAAGykI,OAAOjjI;IACnC,WAAaijI,OAAO7sC,UAAUpnC,SAAS,UAAUi0E,OAAO7sC,UAAUnnC,OAAO,QAAQ;AAC9Em1E,uBAAiB;AACjBC,yBAAmB;AACnBF,gBAAUxjI,MAAMlC,OAAO,GAAGwkI,OAAO9iI,IAAIsiI,SAASx2H,QAAO+2H,kBAAgB,CAAA;AACrEmB,gBAAUxjI,MAAMnC,MAAM,GAAGykI,OAAOjjI,CACnC;AAAA,IAAA,WAAaijI,OAAO7sC,UAAUpnC,SAAS,UAAUi0E,OAAO7sC,UAAUnnC,OAAO,MAAM;AAC5Em1E,uBAAiB;AACjBC,yBAAmB;AACnBF,gBAAUxjI,MAAMlC,OAAO,GAAGwkI,OAAO9iI,IAAIsiI,SAASx2H,QAAO+2H,kBAAgB,CACrEmB;AAAAA,gBAAUxjI,MAAMnC,MAAM,GAAGykI,OAAOjjI,IAAIyiI;IACvC,WAAaQ,OAAO7sC,UAAUpnC,SAAS,QAAQi0E,OAAO7sC,UAAUnnC,OAAO,QAAQ;AAC5Em1E,uBAAiB;AACjBC,yBAAmB;AACnBF,gBAAUxjI,MAAMlC,OAAO,GAAGwkI,OAAO9iI,IAAIsiI,SAASx2H,QAAO+2H,kBAAgB,CAAA;AACrEmB,gBAAUxjI,MAAMnC,MAAM,GAAGykI,OAAOjjI,IAAIyiI,MACpC;AAAA,IAAA;AAED0B,cAAUxjI,MAAM,SAAS0jI,gBAA2B,OAAA,IAAA,GAAGH,SACvDC;AAAAA,cAAUxjI,MAAM,SAASyjI,yBAAyB,GAAGF,SAAAA;AACrDC,cAAUxjI,MAAM,SAASyjI,cAAAA,OAAAA,IAAyB;AAClDD,cAAUxjI,MAAM,SAAS0jI,gBAA2B,OAAA,IAAA;AACpDF,cAAUxjI,MAAM,SAAS0jI,gBAAmBD,GAAAA,cAAAA,QAAAA,IAA0B,GAAG3B,MAAAA;AAGzE,WAAO0B;AAAAA,EACP,GAED,aAAad,OAAOp3H;AACnB,QAAI/I,MAAMnE,SAASoE,cAAc,KACjC;AAAA,QAAI3E,MAAM6kI,MAAMrjI;AAChB,QAAIvB,OAAO4kI,MAAMljI;AAEjB,QAAI63G,OAAO/rG,QAAO0uC;AAClBz3C,QAAIvC,MAAM+7H,YAAY,yBAAyB,GAAG1kB,IAElD,IAAA;AAAA,QAAIt0G,YAAY,uCAAuC2/H,MAAMjtC;AAE7DlzF,QAAIvC,MAAMnC,MAAMA,MAAM;AACtB0E,QAAIvC,MAAMlC,OAAOA,OAAO;AACxByE,QAAIQ,YAAYA;AAEhB,WAAOR;AAAAA,EACP,GAED0gI,WAAW,SAAU50E,MAAMC,IAC1B;AAAA,QAAImnC,YAAYzvF,KAAK29H,cAAct1E,MAAMC;AACzC,QAAIs1E,OAAO,EACVpkI,GAAG6uD,KAAK7uD,GACRH,GAAGgvD,KAAKhvD,GACRo2F,WAAWzvF,KAAK29H,cAAct1E,MAAMC,EAErC,EAAA;AAAA,QAAImnC,aAAazvF,KAAK48H,KAAK9kI,QAAQ23F,aAAazvF,KAAK48H,KAAK7kI,OAAO;AAChE6lI,WAAKvsB,OAAO/3G,KAAKkM,IAAI6iD,KAAK7uD,IAAI8uD,GAAG9uD,CACpC;AAAA,IAAA,OAAS;AACNokI,WAAKvsB,OAAO/3G,KAAKkM,IAAI6iD,KAAKhvD,IAAIivD,GAAGjvD,CAAAA;AAAAA,IACjC;AACD,WAAOukI;AAAAA,EACP,GACDD,eAAe,SAAUt1E,MAAMC;AAC9B,QAAImnC,YAAY;AAChB,QAAInnC,GAAG9uD,IAAI6uD,KAAK7uD,GAAG;AAClBi2F,kBAAYzvF,KAAK48H,KAAK9kI;AAAAA,IACtB,WAAUwwD,GAAG9uD,IAAI6uD,KAAK7uD,GAAG;AACzBi2F,kBAAYzvF,KAAK48H,KAAK7kI;AAAAA,IACtB,WAAUuwD,GAAGjvD,IAAIgvD,KAAKhvD,GAAG;AACzBo2F,kBAAYzvF,KAAK48H,KAAK3zG;AAAAA,IACzB,OAAS;AACNwmE,kBAAYzvF,KAAK48H,KAAK5zG;AAAAA,IACtB;AACD,WAAOymE;AAAAA,EACP,EAAA;AAIF,MAAIorC,eAAe,EAElBgC,MAAM,IACNx1H,OAAO,WAAA;AACNrH,SAAK68H,OAAO,CACZ;AAAA,EAAA,GACDr5C,SAAS,WACR;AAAA,WAAOxjF,KAAK68H,KAAK78H,KAAK68H,KAAK9gI,SAAS,CACpC;AAAA,EAAA,GACD+gI,OAAO,SAAU30C,MAAAA;AAChB,SAAKA,KACJ,QAAOnoF,KAAKwjF,QAAAA;AAEbxjF,SAAK68H,KAAK79H,KAAK+D,OAAMsB,KAAK8jF,IAC1B,CAAA;AAAA,WAAOA;AAAAA,EACP,GACD01C,UAAU,SAAUpuC,WAAWv+B,MAAM4rE,OAAAA;AACpC,QAAKA,CAAAA,MACJA,SAAQ/5H,OAAMsB,KAAKrE,KAAK88H,MAExBA,CAAAA;AAAAA,QAAAA,SAAQ,EAACtjI,GAAGsjI,MAAMtjI,GAAGH,GAAGyjI,MAAMzjI,EAAAA;AAC/B,QAAI2yB,MAAMmvG,OAAOyB;AACjB,YAAQntC,WAAAA;AAAAA,MACP,KAAMzjE,IAAQ;AACb8wG,cAAMtjI,KAAK03D;AACX;AAAA,MACD,KAAMllC,IAAS;AACd8wG,cAAMtjI,KAAK03D;AACX;AAAA,MACD,KAAMllC,IAAM;AACX8wG,cAAMzjI,KAAK63D;AACX;AAAA,MACD,KAAMllC,IAAQ;AACb8wG,cAAMzjI,KAAK63D;AACX;AAAA;AAIF,WAAOlxD,KAAK88H,MAAMA,KAAAA;AAAAA,EAClB,GACD7B,YAAY,SAAUz6G,MAAM9U,MAAMgV,QAAQphB,QACzC;AAAA,QAAIsiG,KAAK5hG,KAAK86H,aAAat6G,MAAM9U,MAAMgV,QAAQphB,MAAAA;AAC/C,QAAIw+H,KAAK/6H,OAAMuC;AAEf,QAAIw7B,KAAK8gE,GAAGm5B,MAAMn5B,GAAGvoG;AACrB,QAAIwnC,KAAK+gE,GAAGo5B,MAAMp5B,GAAGpoG;AAErB,QAAIwyB,MAAMmvG,OAAOyB;AAEjB,QAAIlgD,YAAYhxE,KAAK4C,cAAckS,KAAKE,MAExC1gB;AAAAA,SAAKqH;AACLrH,SAAK88H,MAAM,EAACtjI,GAAGooG,GAAGpoG,GAAGH,GAAGuoG,GAAGvoG,EAAAA,CAAAA;AAE3B,QAAI0X,SAAS,IAAI+sH,GAAG9pF;AACpB,QAAI+pF,WAAW/9H,KAAKg+H,cAAcx9G,MAAM9U,KAAKm7F,WAE7C,CAAA;AAAA,QAAIo3B,UAAWr8B,GAAGo5B,MAAMp5B,GAAGpoG;AAC3B,QAAIukI,SAASv1E,cAAcu1E,SAASt1E,UAAU;AAC7CzoD,WAAK69H,SAAS7xG,IAAIl0B,MAAMiZ,MACxB;AAAA,UAAIktH,SAAS;AACZj+H,aAAK69H,SAAS7xG,IAAI/C,MAAM6X;AACxB9gC,aAAK69H,SAAS7xG,IAAIj0B,OAAO8oC,EAC7B;AAAA,MAAA,OAAU;AACN7gC,aAAK69H,SAAS7xG,IAAIj0B,OAAO8oC,EACzB7gC;AAAAA,aAAK69H,SAAS7xG,IAAI/C,MAAM6X,EACxB;AAAA,MAAA;AACD9gC,WAAK69H,SAAS7xG,IAAIj0B,OAAOgZ,MAAAA;AAAAA,IAEzB,WAAWgtH,CAAAA,SAASv1E,cAAcu1E,SAASt1E,UAAU;AAErD,UAAI3nB,OAAO,GAAE;AACZm9F,kBAAWr8B,GAAGo5B,MAAOp5B,GAAGpoG,IAAI,IAAIuX;AAAAA,MAChC;AACD/Q,WAAK69H,SAAS7xG,IAAIj0B,OAAOgZ;AACzB,UAAIktH,SAAS;AACZp9F,cAAM9vB;AACN/Q,aAAK69H,SAAS7xG,IAAI/C,MAAM6X,EAAAA;AACxB9gC,aAAK69H,SAAS7xG,IAAIj0B,OAAO8oC,EAAAA;AAAAA,MAC7B,OAAU;AACNA,cAAM,IAAI9vB;AACV,YAAIg8E,OAAOjsD,KAAK,IAAI,IAAK;AAEzB9gC,aAAK69H,SAAS7xG,IAAI/C,MAAM8jE,QAAQrQ,YAAY;AAC5C18E,aAAK69H,SAAS7xG,IAAIj0B,OAAO8oC,EACzB7gC;AAAAA,aAAK69H,SAAS7xG,IAAI/C,MAAM8jE,QAASzzF,KAAKkM,IAAIs7B,MAAO47C,YAAY,EAAA;AAC7D18E,aAAK69H,SAAS7xG,IAAIj0B,OAAOgZ;MACzB;AAAA,IAED,YAAWgtH,SAASv1E,cAAAA,CAAeu1E,SAASt1E,UAAU;AACtDzoD,WAAK69H,SAAS7xG,IAAIj0B,OAAOgZ;AACzB,UAAIktH,SAAS;AACZj+H,aAAK69H,SAAS7xG,IAAIj0B,OAAO8oC,EACzB7gC;AAAAA,aAAK69H,SAAS7xG,IAAI/C,MAAM6X,EAAAA;AAAAA,MAC5B,OAAU;AACN9gC,aAAK69H,SAAS7xG,IAAI/C,MAAM6X;AACxB9gC,aAAK69H,SAAS7xG,IAAIj0B,OAAO8oC,EACzB;AAAA,MAAA;AACD7gC,WAAK69H,SAAS7xG,IAAIl0B,MAAMiZ,MAAAA;AAAAA,IACxB,WAAUgtH,SAASv1E,cAAeu1E,CAAAA,SAASt1E,UAAU;AAErD,UAAI3nB,OAAO,GAAE;AACZm9F,kBAAWr8B,GAAGo5B,MAAOp5B,GAAGpoG,IAAI,IAAIuX;AAAAA,MAChC;AACD/Q,WAAK69H,SAAS7xG,IAAIl0B,MAAMiZ,MAExB;AAAA,UAAA,CAAKktH,SAAS;AACbp9F,cAAM9vB;AACN/Q,aAAK69H,SAAS7xG,IAAI/C,MAAM6X,EAAAA;AACxB9gC,aAAK69H,SAAS7xG,IAAIj0B,OAAO8oC,EAAAA;AAAAA,MAC7B,OAAU;AACNA,cAAM,IAAI9vB;AACV,YAAIg8E,OAAOjsD,KAAK,IAAI,IAAA;AACpB9gC,aAAK69H,SAAS7xG,IAAI/C,MAAM8jE,QAAQrQ,YAAY,EAC5C18E;AAAAA,aAAK69H,SAAS7xG,IAAIj0B,OAAO8oC,EAAAA;AACzB7gC,aAAK69H,SAAS7xG,IAAI/C,MAAM8jE,QAASzzF,KAAKkM,IAAIs7B,EAAO47C,IAAAA,YAAY,EAC7D18E;AAAAA,aAAK69H,SAAS7xG,IAAIl0B,MAAMiZ,MACxB;AAAA,MAAA;AAAA,IAED;AAED,WAAO/Q,KAAK68H;AAAAA,EACZ,GACDmB,eAAe,SAASx9G,MAAMlb,SAAAA;AAC7B,QAAIqxB,QAAQrxB,QAAOqY;AACnB,QAAI6qC,aAAa,OAAOC,WAAW;AACnC,QAAIjoC,KAAKvO,QAAQ0kB,MAAMkb,gBAAgB;AACtC2W,mBAAaC,WAAW;AAAA,IACxB,WAAUjoC,KAAKvO,QAAQ0kB,MAAMmb,kBAAkB;AAC/C0W,mBAAaC,WAAW;AAAA,IACxB,WAAUjoC,KAAKvO,QAAQ0kB,MAAMib,iBAAiB;AAC9C4W,mBAAa;AACbC,iBAAW;AAAA,IACX,WAAUjoC,KAAKvO,QAAQ0kB,MAAMob,iBAAiB;AAC9CyW,mBAAa;AACbC,iBAAW;AAAA,IACd,OAAS;AACN1lD,MAAAA,OAAMqqC,OAAO,OAAO;IACpB;AAED,QAAG9nC,QAAOmZ,KAAI;AACb+pC,oBAAcA;AACdC,iBAAAA,CAAYA;AAAAA,IACZ;AAED,WAAO,EAACD,YAAwBC;EAChC,GAEDqyE,cAAc,SAAUt6G,MAAM9U,MAAMgV,QAAQphB,QAAAA;AAC3C,QAAIgG,UAASoG,KAAKm7F,WAElB;AAAA,QAAIk3B,WAAW/9H,KAAKg+H,cAAcx9G,MAAMlb,OACxC;AAAA,QAAIkjD,aAAau1E,SAASv1E,YACzBC,WAAWs1E,SAASt1E;AAErB,QAAIJ,OAAO61E,qBAAqBx9G,QAAQhV,MAAMpG,UAC7CgjD,KAAK41E,qBAAqB5+H,QAAQoM,MAAMpG,OAEzC;AAAA,WAAO,EACN9L,GAAGgvD,aAAaH,KAAKvwD,OAAQuwD,KAAKvwD,OAAOuwD,KAAK5uD,OAC9CuhI,KAAKvyE,WAAWH,GAAGxwD,OAAQwwD,GAAGxwD,OAAOwwD,GAAG7uD,OACxCJ,GAAGgvD,KAAKxwD,MAAOwwD,KAAKq0B,YAAU,IAAK,GACnCq+C,KAAKzyE,GAAGzwD,MAAOywD,GAAGo0B,YAAU,IAAK;EAElC,EAGF;AAAA,WAASwhD,qBAAqB/vH,MAAMzC,MAAMpG,SACzC;AAAA,QAAI2G,MAAMP,KAAK8wE,gBAAgBruE,IAG/B;AAAA,QAAIgwH,cAAcjiD,mBAAmBn5E,QAAO2I,MAAMyC;AAClD,QAAIiuE,YAAY+hD,YAAY/hD;AAE5B,QAAIE,aAAa6hD,YAAY7hD;AAC7B,UAAMT,0BAA0B94E,OAAMuC,OAAO22D,cAAcl5D,OAAMuC,OAAO22D,UAAU6f,eAAe,iBAAiB/4E,OAAMuC,OAAO22D,UAAU6f,eAAe;AACxJ,UAAM7f,aAAY4f,2BAA2B1tE,KAAK8tD,aAAa9tD,KAAK8tD,UAAUlgE;AAE9E,QAAIoiI,YAAY9hD,cAAa;AAC5BpwE,UAAIywE,YAAYN;AAAAA,IAChB;AAED,QAAIq5C;AACJ,QAAI2I,gBAAgBr7H,OAAMo+B,YAAYhzB,KAAK8D,IAAS3M,KAAAA,QAAOqxB,MAAMqb;AACjE,QAAGosF,eAAc;AAChB,UAAI5I,kBAAkB9pH,KAAKoyE,aAAa3vE,KAAKlH,IAAI;AACjDwuH,uBAAiBn8H,KAAKyW,KAAK,IAAEylH,kBAAgBA;AAC7C,UAAI2I,YAAY9hD,gBAAgBD,YAAYo5C,iBAAgB;AAC3DA,0BAAkBp5C;AAClBq5C,yBAAiBr5C;AAAAA,MACjB;AACDnwE,UAAInU,QAAQ29H,iBAAiB;AAC7BxpH,UAAIxS,QAAQg8H;AAAAA,IACZ;AACD,QAAIn5C,YAAW;AACd,UAAIF,aAAanwE,IAAIvS,QAAQ;AAC5B,cAAM2kI,mBAAmBtiD,sBAAsBh5E,QAAOoL,KAAKrN;AAC3D,YAAIm7D,cAAaoiE,kBAAiB;AACjC,cAAID,eAAc;AACjBnyH,gBAAIywE,YAAYzwE,IAAIvS,SAAS;AAC7BuS,gBAAInU,SAASmU,IAAIxS,QAAQwS,IAAIywE,YAAY,KAAK;AAC9CzwE,gBAAIxS,QAAQwS,IAAIywE,YAAY;AAAA,UAC5B,OACI;AACJzwE,gBAAIywE,YAAYzwE,IAAIvS,SAAS;AAAA,UAC7B;AAAA,QACD,WAAU0kI,eAAe;AACzBnyH,cAAInU,SAAS29H,iBAAiBxpH,IAAIvS,UAAU;AAAA,QAC5C;AAAA,MACJ,OAAS;AACNuS,YAAIywE,YAAYN,YAAY;AAC5B,YAAIgiD,eAAc;AACjBnyH,cAAInU,SAASmU,IAAIxS,QAAQwS,IAAIywE,YAAY,KAAK;AAC9CzwE,cAAIxS,QAAQwS,IAAIywE,YAAY;AAAA,QAC5B;AAAA,MACD;AAAA,IACD,WAAUzgB,YAAU;AACpBhwD,UAAIywE,YAAYzwE,IAAIvS,SAAS;AAAA,IAC7B;AAED,WAAOuS;AAAAA,EACR;AAGA,SAAO,EACNvG,QAAQk1H,sBACR9xF,QAAQ,MAERyhE,cAAcA,kBACdS,iBAAiBA,gBAAAA,EAAAA;AAElB;AC3pBe,SAAQT,aAAC3gG,MAAM86B,UAAUh5B,MAAMpG,SAAQvC,QAAAA;AAElD,MAAGA,OAAMoM,IAAIC,QAAQ,MAAA,MAAarM,OAAMuC,OAAO0uB,uBAAuBjxB,OAAM24B,cAAAA,KAAqB34B,OAAMoC,IAAIu3B,iBAAiB35B,OAAMoC,IAAIu3B,cAAcnvB,SAAAA,EAAWtG,KAAM;AAEvK,QAAI2C,CAAAA,KAAKymD,iBAAkB,QAAO;AAClC,WAAO;AAAA,EACP;AACE,MAAIx4D,MAAM6T,KAAK8C,WAAW5E,KAAK3C,EAClC;AAAA,MAAIvN,SAASgS,KAAK4C,cAAc1E,KAAK3C,EAErC;AAAA,MAAGpP,MAAM6sC,SAASykE,SAAStxG,MAAM6B,SAASgrC,SAASrrC,GAAE;AACpD,WAAO;AAAA,EACP;AAED,SAAO;AACR;ACVA,SAASilI,qBAAqBv7H,QAE7B;AAAA,WAASw7H,kBAAkB30H,MAAM8B,MAAMpG,SAAQo/B,UAAAA;AAC9C,QAAI7xB,UAAUnH,KAAK4hB,eAAAA;AACnB,QAAIpY,aAAYxJ,KAAKo7F,cAErB;AAAA,QAAIhwF,QAAQpL,KAAK+E,QAAQqtG;AAEzB,QAAIhwF,QAAQ,CACZ;AAAA,QAAI0wG;AACJ,aAAS1iI,IAAI,GAAGA,IAAI+W,QAAQ9W,QAAQD,KAAK;AACxC,UAAI2/B,OAAO3/B,KAAK+W,QAAQ9W,SAAS;AACjC,UAAIqc,MAAMvF,QAAQ/W,CAClB;AAAA,UAAI6gC;AAEJ,UAAI5jB;AACJ,UAAI0lH;AACJ,UAAIrmH,IAAI/a,QAAQ,OAAO;AACtB,YAAIqhI,OAAO37H,OAAM08B,SAASk/F,wBAAwBvmH,GAAAA;AAElDW,gBAAQ,UAAU2lH,OAAO;AACzBD,oBAAY;AAAA,MAChB,OAAU;AACN,YAAIrmH,IAAIzB,SACPoC,SAAQX,IAAIzB,SAAS/M;YAErBmP,SAAQnP,KAAKwO,IAAI/a,IAElB;AAAA,YAAI4lC,OAAelqB,KAAAA,GAAO;AACzBA,kBAAQ7D,WAAUkI,UAAUrE,OAAOnP,MAAMwO,IAAI/a,IAAAA;AAAAA,QAC7C;AAED,YAAI0b,UAAU,QAAQA,UAAU1Y,QAAW;AAC1C0Y,kBAAQ;AAAA,QACR;AAED0lH,oBAAY1lH;AACZA,gBAAQ,qCAAqCA,QAAQ;AAAA,MACrD;AACD,UAAIra,MAAM,gBAAgB+8B,OAAO,qBAAqB;AAEtD,UAAItb,OAAO,CACX;AAAA,UAAI/H,IAAI+H,MAAM;AACbzhB,eAAO;AACP,iBAASygB,IAAI,GAAGA,IAAIvV,KAAK0S,QAAQ6C,IAChCgB,MAAKnhB,KAAKkW,WAAUyyC,YAAY/9C,IAAAA,CAAAA;AAEjC40H,oBAAY1nH,MAAMmE,SAASrR,KAAK3C,EAAAA,KAAAA,EAASlE,OAAMgzD,YAAYnsD,IAAU7G,KAAAA,CAAAA,OAAMuC,OAAO8qD;AAClF,YAAIouE,WAAW;AACdr+G,eAAKnhB,KAAKkW,WAAU4yC,UAAUl+C,IAAAA,CAAAA;AAC9BuW,eAAKnhB,KAAKkW,WAAU0yC,YAAYh+C,IACrC,CAAA;AAAA,QAAA,OAAW;AACNuW,eAAKnhB,KAAKkW,WAAU6yC,WAAWn+C,IAC/BuW,CAAAA;AAAAA,eAAKnhB,KAAKkW,WAAU2yC,UAAUj+C,IAAAA,CAAAA;AAAAA,QAC9B;AAAA,MACD;AACD,UAAI5P,QAAQ,YAAYoe,IAAI3e,SAASgiC,OAAO,IAAI,MAAM;AACtD,UAAIz7B,KAAKsjC,QAAQlrB,IAAI87B,KAAAA,GAAO;AAC3B,YAAI0qF,YAAY,EACf7mI,OAAO,YACPD,MAAM,cACN+mI,QAAQ,SAAA;AAET,YAAIC,iBAAiBF,UAAUxmH,IAAI87B,KAAAA;AAEnCl6C,iBAAS,gBAAgBoe,IAAI87B,QAAQ,sBAAuB4qF,iBAAiB;AAAA,MAC7E;AAED,UAAIJ,OAAO37H,OAAM08B,SAASs/F,mBAAmB3mH,KAAKqmH,WAAW70H;AAE7DuW,WAAKnhB,KAAK+Z,KACV4jB;AAAAA,aAAO,iBAAiBj+B,MAAM,0BAAwB5C,IAAE,yBAAuBsc,IAAI/a,OAAK,cAAcrD,QAAQ,OAAO0kI,OAAO,MAAMv+G,KAAK3kB,KAAK,EAAA,IAAM;AAClJsyB,YAAM9uB,KAAK29B,IACX;AAAA,IAAA;AAEDj+B,UAAM;AACN,UAAMsgI,YAAYloH,MAAMrG,QAAQpT;AAChC,YAAQ2hI;MACP,KAAK;AACJtgI,cAAMqE,OAAM2rB,mBAAmB9kB,KAAK3C,MAAM,MAAM,IAAI,KAAK;AACzD;AAAA,MACD,KAAK;AACJvI,cAAMoY,MAAM21C,aAAaxvD,QAAQ2M,KAAK3C,MAAM,MAAM,IAAI,KAAK;AAC3D;AAAA,IAGFvI;AAAAA,WAAQkL,KAAiB,eAAI,uBAAuB;AAEpDlL,WAAQkL,KAAK66D,uBAAuB,MAAM76D,KAAK66D,uBAAuB;AAEtE,QAAIvvD,WAAUoyC,gBAAgB;AAC7B,UAAI23E,eAAe/pH,WAAUoyC,eAAezrD,KAAKkH,QAAO6G,KAAKuI,YAAYvI,KAAKwI,UAAUxI,IAAAA;AACxF,UAAIq1H,aACHvgI,QAAO,MAAMugI;AAAAA,IACd;AAED,QAAGnoH,MAAM8kB,WAAWhyB,KAAK3C,KAAK;AAC7BvI,aAAO;AAAA,IACP;AAED,QAAI6C,KAAKnJ,SAASoE,cAAc,KAAA;AAChC+E,OAAGxE,YAAY,cAAc2B,MAAM,gBAAgBqE,OAAMo+B,YAAYv3B,KAAKqI,IAC1E;AAAA,QAAIvY,SAASgS,KAAK4C,cAAc1E,KAAK3C;AACrC1F,OAAGvH,MAAMN,SAASA,SAAS;AAC3B6H,OAAGvH,MAAMuuH,aAAa7uH,SAAS;AAE/B,QAAG4L,QAAOmO,iBAAgB;AACzBlS,SAAGvH,MAAM2J,WAAW;AACpBpC,SAAGvH,MAAMlC,OAAO;AAChByJ,SAAGvH,MAAMnC,MAAM6T,KAAK8C,WAAW5E,KAAK3C,EAAAA,IAAM;AAAA,IAC1C;AAED,QAAGyE,KAAK+E,QAAQswG,gBAAe;AAC9Bx/G,SAAGyrB,aAAathB,KAAK+E,QAAQswG,gBAAgBn3G,KAAK3C,EAClD1F;AAAAA,SAAGyrB,aAAathB,KAAK+E,QAAQ9I,OAAO,OAAOiC,KAAK3C,EAAAA;AAAAA,IAChD;AAEDlE,IAAAA,OAAM08B,SAASy/F,YAAYt1H,MAAMrI;AAEjCA,OAAGlD,YAAYyvB,MAAMtyB,KAAK,EAAA;AAC1B,WAAO+F;AAAAA,EACP;AAED,WAAS+oG,SAAS1gG,MAAMu1H,SAASzzH;AAChC,QAAImH,UAAUnH,KAAK4hB,eACnB;AAAA,aAASxxB,IAAI,GAAGA,IAAI+W,QAAQ9W,QAAQD,KAAK;AACxC,UAAI65B,SAAS9iB,QAAQ/W,CACrB;AAAA,UAAI65B,OAAO20E,UAAS;AAGnB,YAAI80B,WAAWD,QAAQlhI,cAAc,uBAAuB03B,OAAOt4B,OAAO,GAAA;AAC1E,YAAI+hI,UAAU;AACb,cAAIpgG,UAAUrJ,OAAO20E,SAAS1gG,MAAMw1H,QACpC;AAAA,cAAIpgG,kBAAkBA,YAAY,UAAU;AAC3CogG,qBAAS/gI,YAAY2gC;AAAAA,UACrB,WAAUA,WAAAA,OAAkBA,YAAY,UAAU;AAElD,gBAAIj8B,OAAMuC,OAAO+5H,iBAAgB;AAChC,kBAAIC,UAAUv8H,OAAMuC,OAAO+5H;AAC3B,kBAAIC,QAAQC,UAAUvgG,OAAAA,GAAS;AAC9BsgG,wBAAQE,cAAcxgG,SAASogG,QAC/B;AAAA,cAAA;AAAA,YACD;AAAA,UACD;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAED,SAAO,EACN15H,QAAQ64H,mBACRz1F,QAAQ,MACRohE,cAAcb,iBACdkB,cACAS,iBAAiBA,sBACjBV,SAEF;AAAA;AChKe,SAASm1B,8BAA8B18H,QAAAA;AAErD,MAAIyrE,oBAAoB,CAAA;AAExBzrE,EAAAA,OAAM+yB,MAAMC,WAAWvuB,YAAY,kBAAkB,WAAA;AACpDgnE,wBAAoB,CAAA;AAAA,EACtB;AAEC,WAASkxD,gBAAgB17D,UAAU6uB,kBAAkB5mE,OAAO/c,UAAAA;AAC3D,UAAM2/C,WAAWmV,SAAS/8D,KAAK,MAAM4rF,mBAAoB,MAAM5mE,MAAM/iB,OAAO,MAAM+iB,MAAMxM;AACxF,QAAI8C;AACJ,QAAKisD,CAAAA,kBAAkB3f,QAAW,GAAA;AACjCtsC,YAAMisD,kBAAkB3f,YAAY8wE,sBAAsB37D,UAAU6uB,kBAAkB5mE,OAAO/c,QAEhG;AAAA,IAAA,OAAS;AACNqT,YAAMisD,kBAAkB3f;IACxB;AACD,WAAOtsC;AAAAA,EACP;AAED,WAASq9G,qCAAqCrpG,OAAOtK,OAAO4zG,mBAAAA;AAC3D,UAAMC,YAAY7zG,MAAM/iB;AACxB,UAAM62H,YAAY9zG,MAAMxM;AACxB,UAAMugH,WAAW,CAAA;AAEjB,UAAMC,qBAAqB,CAAA;AAC3B,aAASnkI,IAAI,GAAGA,IAAIy6B,MAAMx6B,QAAQD,KAAK;AACtC,YAAM8N,OAAO2sB,MAAMz6B,CACnB;AAAA,UAAIqS,OAAOvE;AACX,UAAGi2H,mBAAkB;AACpB1xH,eAAOpL,OAAMmc,QAAQtV,KAAKi0B,OAC1B;AAAA,MAAA;AACD,UAAI1vB,KAAKipE,aAAY;AACpB;AAAA,MACA;AACD,UAAIjf,UAAWvuD,KAAKuI,cAAchE,KAAKgE;AACvC,UAAIimD,UAAWxuD,KAAKwI,YAAYjE,KAAKiE;AACrC,UAAGytH,mBAAkB;AACpB,YAAGj2H,KAAKuI,YAAW;AAClBgmD,oBAAU,IAAIz/C,KAAKpf,KAAKuD,IAAI+M,KAAKuI,WAAW1E,WAAWU,KAAKgE,WAAW1E,QACvE,CAAA,CAAA;AAAA,QAAA;AACD,YAAG7D,KAAKwI,UAAS;AAChBgmD,oBAAU,IAAI1/C,KAAKpf,KAAKyS,IAAInC,KAAKwI,SAAS3E,QAAAA,GAAWU,KAAKiE,SAAS3E,QACnE,CAAA,CAAA;AAAA,QAAA;AAED,YAAG7D,KAAK2tB,QAAQ3tB,KAAK2tB,QAAQ,cAAa;AACzC4gC,oBAAUvuD,KAAKuI;AACfimD,oBAAUxuD,KAAKwI;AAAAA,QACf;AAAA,MACD;AAED,UAAI8tH,cAAc1c,WAAmBv3F,MAAMjN,SAASm5C,QAAQ1qD,QAAAA,CAAAA;AAC5D,UAAI0yH,eAAe,IAAIznH,KAAKuT,MAAMjN,QAAQkhH,WAAAA,KAAgBn9H,OAAMsP,KAAKytH,YAAY,UAAU,IAAIpnH,KAAKy/C,OAGpG,CAAA,CAAA;AAAA,UAAIioE,WAAW,IAAI1nH,KAAKpf,KAAKyS,IAAIosD,QAAQ1qD,QAAAA,GAAW0yH,aAAa1yH,QAAAA,CAAAA,CAAAA;AAEjE,UAAIg0E,WAAW1+E,OAAMuC,OAAO8U,YAAYrX,OAAMgwF,gBAAgB5kF,QAAQpL;AACtEk9H,yBAAmBx+C,SAASx6E,EAAM,IAAA;AAClC,aAAOm5H,WAAWhoE,SAAS;AAC1B,cAAMioE,cAAcJ,mBAAmBx+C,SAASx6E,EAAAA;AAEhD,YAAIoL,QAAO+tH;AACX,cAAM37C,YAAYpyE,MAAK5E,QAEvB2yH;AAAAA,mBAAWr9H,OAAMsP,KAAK/F,IAAI8zH,UAAUL,WAAWD;AAE/C,YAAGO,YAAY57C,eAAe,OAAM;AACnC;AAAA,QACA;AAED,YAAKu7C,CAAAA,SAASv7C,YAAW;AACxBu7C,mBAASv7C,SAAa,IAAA,EAACpxE,OAAO,CAAA,GAAIw8D,aAAa,CAC/C,EAAA;AAAA,QAAA;AAEDmwD,iBAASv7C,SAAAA,EAAWpxE,MAAMrU,KAAKmP;AAC/B,YAAG0xH,mBAAkB;AACpBG,mBAASv7C,SAAAA,EAAW5U,YAAY7wE,KAAK4K,IAAAA;AAAAA,QACrC;AAAA,MAED;AAAA,IACD;AACD,WAAOo2H;AAAAA,EACP;AAED,WAASL,sBAAsB37D,UAAU6uB,kBAAkB5mE,OAAO/c;AAEjE,QAAIqnB;AACJ,QAAIspG,oBAAoB;AACxB,QAAIG,WAAW,CAAA;AAEf,QAAGj9H,OAAMuC,OAAOsuE,gCAAgCif,qBAAqB9vF,OAAMuC,OAAOoqE,mBAAkB;AACnG,UAAG1L,SAASwM,SAAS,QAAO;AAC3Bj6C,gBAAQxzB,OAAM6sE,uBAAuB5L,SAASmM,cAAcnM,SAASkM,QACzE;AAAA,MAAA,OAAQ;AACJ35C,gBAAQxzB,OAAM6sE,uBAAuB5L,SAAS/8D;MAC9C;AAED44H,0BAAoB;AAAA,IACvB,WAAW77D,SAASwM,SAAS,QAAO;AACjCj6C,cAAQ,CACX;AAAA,IAAA,OAAO;AACJA,cAAQxzB,OAAM2rE,UAAUmkB,kBAAkB7uB,SAAS/8D,EACnD;AAAA,IAAA;AAED+4H,eAAWJ,qCAAqCrpG,OAAOtK,OAAO4zG,iBAAAA;AAC9D,UAAMC,YAAY7zG,MAAM/iB;AACxB,UAAM62H,YAAY9zG,MAAMxM;AAExB,UAAM6gH,YAAY;AAClB,QAAIz0H,OAAOC,KAAKuH,QAAOw8D,aAAalzC;AACpC,UAAMr3B,UAAS4J,SAAS23F,WAExB;AAAA,aAAQ/qG,IAAI,GAAGA,IAAImwB,MAAMjN,QAAQjjB,QAAQD,KAAI;AAC5C+P,cAAQ,IAAI6M,KAAKuT,MAAMjN,QAAQljB,CAAAA,CAAAA;AAC/BgQ,YAAM/I,OAAMsP,KAAK/F,IAAIT,OAAOk0H,WAAWD,SAAAA;AACvCnjG,aAAOqjG,SAASn0H,MAAM4B,QAAc,CAAA,KAAA,CAAA;AACpC4F,MAAAA,SAAQspB,KAAKtpB,SAAS,CAAA;AACtBw8D,oBAAclzC,KAAKkzC,eAAe;AAClC,UAAGx8D,OAAMtX,UAAUuJ,QAAOwrE,6BAA4B;AACrDwvD,kBAAUthI,KAAK,EACdmT,YAAYtG,OACZuG,UAAUtG,KACVuH,OAAOA,QACPw8D,YAEL,CAAA;AAAA,MAAA,OAAQ;AACJywD,kBAAUthI,KAAK,IACf;AAAA,MAAA;AAAA,IACD;AAED,WAAOshI;AAAAA,EACP;AAID,SAAOZ;AACR;ACrIA,SAASa,2BAA2Bx9H,QAAAA;AACnC,MAAI28H,kBAAkBc,8BAAkBz9H;AACxC,MAAI09H,wBAAwB,CAAA;AAE5B,WAASC,uBAAuB18D,UAAUp7D,KAAKsM,YAAW5P,SAAQ4J,UACjE;AAAA,QAAIxQ,MAAMwW,WAAUu+D,oBAAoB7qE,IAAIuJ,YAAYvJ,IAAIwJ,UAAU4xD,UAAUp7D,IAAIyK,OAAOzK,IAAIinE,WAC/F;AAAA,QAAI7wC,UAAU9pB,WAAUs+D,oBAAoB5qE,IAAIuJ,YAAYvJ,IAAIwJ,UAAU4xD,UAAUp7D,IAAIyK,OAAOzK,IAAIinE;AACnG,QAAIn2E,SAASwV,SAASZ,cAAc01D,SAAS/8D,MAAM;AAEnD,QAAIvI,OAAOsgC,SAAQ;AAClB,UAAI23B,QAAQznD,SAASstE,gBAAgBxY,UAAUp7D,IAAIuJ,YAAYvJ,IAAIwJ;AACnE,UAAI7Q,KAAKnJ,SAASoE,cAAc,KAChC+E;AAAAA,SAAGyrB,aAAa9d,SAASuB,QAAQswG,gBAAgB/8C,SAAS/8D,EAAAA;AAC1D1F,SAAGxE,YAAY,CAAC,yBAAyB2B,GAAAA,EAAKlD,KAAK,GAAA;AAEnD+F,SAAGvH,MAAMyC,UAAU,CAClB,UAAUk6D,MAAM7+D,OAAO,MACvB,WAAW6+D,MAAMl9D,QAAQ,MACzB,YAAS,SAAc,MACvB,iBAAc,SAAc,MAC5B,SAASk9D,MAAM9+D,MAAM,IACpB2D,EAAAA,KAAK,GAEP;AAAA,UAAGwjC,QACFz9B,IAAGlD,YAAY2gC;AAEhB,aAAOz9B;AAAAA,IACP;AACD,WAAO;AAAA,EACP;AAED,WAASo/H,2BAA2B15H,IAAIT,OACvC;AAAA,QAAGi6H,sBAAsBx5H,EAAOw5H,KAAAA,sBAAsBx5H,IAAIT,KACzDi6H,KAAAA,sBAAsBx5H,IAAIT,KAAOjO,EAAAA,YAChC;AACAkoI,4BAAsBx5H,EAAIT,EAAAA,KAAAA,EAAOjO,WAAWqE,YAAY6jI,sBAAsBx5H,EAAIT,EAAAA,KAAAA,CAAAA;AAAAA,IAClF;AAAA,EACF;AAED,WAASo6H,mBAAmB58D,UAAU90D,UAAU5J,SAAQo/B,UACvD;AAAA,QAAIxvB,aAAYhG,SAAS43F,cAAAA;AACzB,QAAI76E,QAAQ/c,SAASmN;AACrB,QAAIikH,YAAYZ,gBAAgB17D,UAAU1+D,QAAOoqE,mBAAmBxgE,SAASmN,SAAYnN,GAAAA,QAAAA;AACzF,QAAIsE,iBAAmBkxB,CAAAA,CAAAA;AACvB,QAAI5W,QAAQ,CAAA;AACZ2yG,0BAAsBz8D,SAAS/8D,EAAM,IAAA;AAErC,QAAI6S,QAAQ6+G,qBAAqB1sG,OAAOyY,QAAAA;AACxC,aAAS/S,cAAc7X,MAAMjO,OAAO8lB,eAAe7X,MAAMhO,KAAK6lB,eAAe;AAE5E,UAAI/oB,MAAM03H,UAAU3uG,WAAAA;AACpB,WAAI/oB,KAAI;AACP;AAAA,MACA;AAED,UAAG4K,kBAAAA,CAAmBslH,gBAAgBnnG,aAAa1F,OAAOyY,UAAU3hC,MAAO,GAAA;AAC1E;AAAA,MACA;AAED,UAAI45B,OAAO+jG,uBAAuB18D,UAAUp7D,KAAKsM,YAAW5P,SAAQ4J,QAAAA;AACpE,UAAGytB,MAAK;AACP7O,cAAM9uB,KAAK29B,IAAAA;AACX8jG,8BAAsBz8D,SAAS/8D,EAAI0qB,EAAAA,WAAAA,IAAegL;AAAAA,MAClD;AAAA,IACD;AAED,QAAInd,MAAM;AACV,QAAGsO,MAAM/xB,QAAO;AACfyjB,YAAMpnB,SAASoE,cAAc;AAC7B,eAAQV,IAAI,GAAGA,IAAIgyB,MAAM/xB,QAAQD,KAAI;AACpC0jB,YAAI9iB,YAAYoxB,MAAMhyB,CAAAA,CAAAA;AAAAA,MACtB;AAAA,IACD;AACD,WAAO0jB;AAAAA,EACP;AAED,WAASqhH,mBAAmB78D,UAAUpqE,MAAMsV,UAAU5J,SAAQo/B,UAC7D;AAAA,QAAIxvB,aAAYhG,SAAS43F,cAAAA;AACzB,QAAI76E,QAAQ/c,SAASmN,SAAAA;AACrB,QAAIikH,YAAYZ,gBAAgB17D,UAAU1+D,QAAOoqE,mBAAmBxgE,SAASmN,YAAYnN,QAEzF;AAAA,QAAI4K,QAAQ6+G,qBAAqB1sG,OAAOyY;AAExC,QAAIo8F,iBAAiB,CAAA;AACrB,QAAGL,yBAAyBA,sBAAsBz8D,SAAS/8D,EAAAA,GAAI;AAC9D,eAAQnL,KAAK2kI,sBAAsBz8D,SAAS/8D,EAAAA,GAAI;AAC/C65H,uBAAehlI,CAAKA,IAAAA;AAAAA,MACpB;AAAA,IACD;AAED,aAAS61B,cAAc7X,MAAMjO,OAAO8lB,eAAe7X,MAAMhO,KAAK6lB,eAAe;AAC5E,UAAI/oB,MAAM03H,UAAU3uG,WAAAA;AACpBmvG,qBAAenvG,WAAe,IAAA;AAC9B,WAAI/oB,KAAI;AACP;AAAA,MACA;AAED,UAAIkwH,CAAAA,gBAAgBnnG,aAAa1F,OAAOyY,UAAU3hC,SAAO;AACxD49H,mCAA2B38D,SAAS/8D,IAAI0qB,WAAAA;AACxC;AAAA,MACA;AAED,UAAI8uG,CAAAA,sBAAsBz8D,SAAS/8D,EAAQw5H,KAAAA,CAAAA,sBAAsBz8D,SAAS/8D,EAAAA,EAAI0qB,WAAa,GAAA;AAC1F,YAAIgL,OAAO+jG,uBAAuB18D,UAAUp7D,KAAKsM,YAAW5P,SAAQ4J;AACpE,YAAGytB,MAAK;AACP/iC,eAAK8C,YAAYigC;AACjB8jG,gCAAsBz8D,SAAS/8D,EAAI0qB,EAAAA,WAAAA,IAAegL;AAAAA,QAClD;AAAA,MACD,WACO8jG,sBAAsBz8D,SAAS/8D,EAAOw5H,KAAAA,sBAAsBz8D,SAAS/8D,EAAI0qB,EAAAA,WAAAA,KAAAA,CAAiB8uG,sBAAsBz8D,SAAS/8D,EAAI0qB,EAAAA,WAAAA,EAAap5B,YAAW;AAC5JqB,aAAK8C,YAAY+jI,sBAAsBz8D,SAAS/8D,IAAI0qB,WACpD,CAAA;AAAA,MAAA;AAAA,IACD;AAED,aAAQ71B,KAAKglI,gBAAe;AAC3B,UAAGA,eAAehlI,CAAAA,MAAO,OAAM;AAC9B6kI,mCAA2B38D,SAAS/8D,IAAInL,CACxC;AAAA,MAAA;AAAA,IACD;AAAA,EACD;AAED,SAAO,EACN4J,QAAQk7H,oBACR93F,QAAQ+3F,oBACR32B,cACAc,iBAAiBA,qBAEnB;AAAA;AClIA,SAAS+1B,+BAA+Bh+H;AAEvC,WAASw7H,kBAAkB30H,MAAM8B,MAAMg5B,UAAAA;AAEtC,QAAIp/B,UAASoG,KAAKm7F,WAClB;AAAA,QAAIm6B,YAAY5oI,SAASoE,cAAc,KACvCwkI;AAAAA,cAAUjkI,YAAY;AAEtBikI,cAAUhnI,MAAMnC,MAAO6T,KAAK8C,WAAW5E,KAAK3C,EAAMyE,IAAAA,KAAK4C,cAAc1E,KAAK3C,EAAAA,IAAO;AAEjF+5H,cAAU3iI,YAAY;AACtB2iI,cAAUh0G,aAAa1nB,QAAOixC,iCAAiC3sC,KAAK3C,EAEpElE;AAAAA,IAAAA,OAAM08B,SAASwhG,eAAeD,SAAAA;AAC9B,WAAOA;AAAAA,EACP;AAED,SAAO,EACNt7H,QAAQ64H,mBACRz1F,QAAQ,MACRohE,cAAcb,iBACd2B,iBAAiBA,qBAAAA;AAEnB;ACvBA,SAASk2B,YAAUn+H,QAAOmtB;AACzB,MAAIgzB,OAAMngD,OAAMc,UAAUC,WAAW,KAAA;AAErC,OAAIosB,KAAKzf,QAAQ9I,SAAS5E,OAAMsoC,aAAanb,KAAKzf,QAAQ9I,IAAAA,GAAM;AAC/D;AAAA,EACA;AAED,WAASqnB,OAAO9vB,GACf;AAAA,WAAO0yB,gBAA2B1yB,GAAGgxB,KAAKzf,QAAQswG;EAClD;AAED,WAASogB,WACR;AAAA,WAAOp+H,OAAMsoC,aAAanb,KAAKzf,QAAQ9I,IAAAA;AAAAA,EACvC;AAED,WAASy5H,qBAAqBn6H;AAC7B,WAAOolD,kBAAkBplD,IAAIlE,QAAOo+H,SACpC,CAAA;AAAA,EAAA;AAED,MAAIz6D,MAAM,IAAIxjB,KAAIhzB,KAAKP,YAAY,EAACo1B,oBAAoB,GAAA,CAAA;AACxD,MAAIhiD,OAAMugC,QAAQpT,KAAK22E,aAAayf,eACnC5/C,EAAAA,KAAIphE,OAAOmgD,cAAcv1B,KAAK22E,aAAayf;AAE5C5/C,MAAIl/D,YAAY,qBAAqBzE,OAAM4E,KAAK,SAAU5I,KAAKG,GAAAA;AAC9D,QAAIqC,KAAKytB,OAAO9vB,CAAAA;AAChB,SAAKqC,GAAI,QAAO;AAChB,QAAIwB,OAAM2/B,cAAe3/B,CAAAA,OAAM2/B,cAE/B;AAAA,QAAIzN,QAAmB/1B,EAAEI,QAAQ,mCAAkC;AAClE,aAAO;AAAA,IACP;AAED,QAAI2H,KAAK1F,GAAGnH,aAAa81B,KAAKzf,QAAQswG,cACtC;AAAA,QAAIqgB,qBAAqBn6H,EAAK,EAAA,QAAO;AAErC,QAAImkC,YAAY+1F,SAAAA;AAEhB,QAAIhzH,OAAOi9B,UAAUzR,QAAQ1yB,EAE7B;AAAA,QAAIlE,OAAMqrB,WAAWjgB,IAAAA,EACpB,QAAO;AAERu4D,QAAIphE,OAAO+7H,qBAAqBlzH,KAAKkP;AACrC,QAAKta,CAAAA,OAAMgF,UAAU,kBAAkB,CAACd,IAAI/H,EAAEI,UAAUJ,EAAEK,YAAYL,CAAAA,CAAAA,GAAK;AAC1E,aAAO;AAAA,IACP;AAAA,EAEH,GAAI6D,MAAAA,CAAAA;AAEH2jE,MAAIl/D,YAAY,oBAAoBzE,OAAM4E,KAAK,SAAU5I,KAAKG;AAC7D,QAAIqC,KAAKytB,OAAO9vB,CAChBwnE;AAAAA,QAAIphE,OAAO+yB,OAAOh6B,YAAYkD,GAAG+mH;AACjC,QAAI3qH,UAAU+oE,IAAIphE,OAAO+yB,OAAO95B;AAChC,QAAGZ,SAAQ;AACVA,cAAQ3D,MAAM2J,WAAW;AAAA,IACzB;AAED+iE,QAAIphE,OAAO2B,KAAK1F,GAAGnH,aAAa81B,KAAKzf,QAAQswG,cAAAA;AAE7C,QAAIjqG,QAAQqqH,SAAAA;AAEZ,QAAIhzH,OAAO2I,MAAM6iB,QAAQ+sC,IAAIphE,OAAO2B,EAAAA;AACpCy/D,QAAIphE,OAAOkB,QAAQsQ,MAAMkzC,eAAe0c,IAAIphE,OAAO2B,EAAAA;AACnDy/D,QAAIphE,OAAOxE,SAASqN,KAAKrN;AACzBqN,SAAKkP,QAAQ;AACblP,SAAKmzH,eAAe;AACpBthI,SAAKu1D,YACP;AAAA,EAAA,GAAIxyD,MAEH2jE,CAAAA;AAAAA,MAAI66D,kBAAkB,SAAUhwE,OAAAA;AAC/B,QAAIiwE,YAAY;AAChB,QAAI1qH,QAAQqqH,SAAAA;AACZ,QAAI9tH,SAAQyD,MAAMsjB,SAAAA;AAClB,aAASt+B,IAAI,GAAG+C,MAAMwU,OAAMtX,QAAQD,IAAI+C,KAAK/C,KAAK;AACjD,UAAIuX,OAAMvX,CAAAA,EAAGwgB,UAAUi1C,OAAO;AAC7BiwE,oBAAYnuH,OAAMvX,CAAAA;AAAAA,MAClB;AAAA,IACD;AACD,WAAO0lI,YAAYA,UAAUv6H,KAAK;AAAA,EACpC;AACCy/D,MAAI+6D,cAAc1+H,OAAM4E,KAAK,SAAUzI;AACtC,QAAI+M,MAAMo5B,gBAA2BnV,KAAKP,UAE1C;AAAA,QAAIn2B,IAAIyS,IAAIzS,IAAI02B,KAAKhB,MAAMv2B;AAC3B,QAAIU,IAAI6F,EAAE+M,IAAI5S,IAAI;AAElB,QAAIqjF,YAAYxsD,KAAK5hB,cAAco4D,IAAIphE,OAAO2B,EAE9C;AAAA,QAAI5N,IAAI4S,IAAI5S,EAAGA,KAAI4S,IAAI5S;AACvB,QAAIqoI,aAAaxxG,KAAKxhB,eAAAA;AACtB,QAAIrV,IAAI4S,IAAI5S,IAAIqoI,aAAahlD,UAAWrjF,KAAI4S,IAAI5S,IAAIqoI,aAAahlD;AACjE,UAAMilD,YAAY11H,IAAI5S,IAAI4S,IAAIvS;AAC9B,QAAIL,IAAIsoI,YAAYjlD,WAAW;AAC9BrjF,UAAIsoI,YAAYjlD;AAAAA,IAChB;AAEDzwE,QAAIzS,IAAIA;AACRyS,QAAI5S,IAAIA;AACR,WAAO4S;AAAAA,EACP,GAAElJ,MACH2jE;AAAAA,MAAIk7D,cAAc7+H,OAAM4E,KAAK,SAAUzI,GAAAA;AACtC,QAAI+M,MAAMo5B,gBAA2BnV,KAAKP,UAAAA;AAC1C,QAAIkyG,YAAY3xG,KAAK05F,OAAOpxH,aAAa;AACzC,QAAImpI,YAAY5+H,OAAM4sB,WAAW13B,wBAAwByB,SAASmoI;AAElE,QAAIxoI,IAAI6F,EAAEmkD,QAAQp3C,IAAI5S,IAAIwoI;AAC1B,QAAIxoI,IAAIsoI,WAAW;AAClBtoI,UAAIsoI;AAAAA,IACP,WAAatoI,IAAIwoI,WAAW;AACzBxoI,UAAIwoI;AAAAA,IACJ;AACD,WAAOxoI;AAAAA,EACP,GAAE0J,MACH2jE;AAAAA,MAAIo7D,cAAc/+H,OAAM4E,KAAK,SAAUtO,GAAG0oI,WAEzC;AAAA,QAAIjrH,QAAQqqH,SAAAA;AAEZ9nI,QAAIA,KAAK;AAET,QAAImN,QAAQ0pB,KAAK7hB,0BAA0BhV,CAC3CmN;AAAAA,YAAQu7H,YAAYv7H,QAAQA,QAAQ,IAAIA;AAExC,QAAIA,QAAQsQ,MAAMizC,aAAAA,IAAiB,EAClC,QAAO;AAER,WAAOjzC,MAAM+zC,aAAarkD,KAAAA;AAAAA,EAC1B,GAAEzD,MAAAA;AACH2jE,MAAIl/D,YAAY,cAAczE,OAAM4E,KAAK,SAAU5I,KAAKG,GACvD;AAAA,QAAI8iI,gBAAgBj/H,OAAM4sB,WAAW13B;AACrC,QAAI0pI,YAAYK,cAActoI,SAASsoI,cAAc3oI,KAAK62B,KAAK05F,OAAOpxH,aAAa,KAAKC,OAAOmY;AAC/F,QAAIg1G,KAAKl/C,IAAIphE;AACb,QAAI2G,MAAMy6D,IAAI+6D,YAAYviI,CAAAA;AAE1B6D,IAAAA,OAAM08B,SAASwiG,kBAAkBrc,GAAGvtF,MAAAA;AAEpC,QAAI/yB,UAAS4qB,KAAK22E,cACjB/vF,QAAQqqH,SAAAA;AAGT,QAAIl1H,IAAI5S,IAAIsoI,WAAW;AACtB/b,SAAGvtF,OAAOr+B,MAAMnC,MAAMoU,IAAI5S,IAAI;AAAA,IACjC,OAAS;AACNusH,SAAGvtF,OAAOr+B,MAAMnC,MAAM8pI,YAAY;AAAA,IAClC;AACD/b,OAAGvtF,OAAOr+B,MAAMlC,OAAOmU,IAAIzS,IAAI,KAAK;AACpC,UAAM0oI,gBAAgB78F,gBAA2BtiC,OAAMgC,KACvD;AAAA,QAAIkH,IAAIxS,QAAQyoI,cAAczoI,OAAM;AACnCmsH,SAAGvtF,OAAOr+B,MAAMP,QAAQyoI,cAAczoI,QAAQ,KAAK,IAAI;AACvDmsH,SAAGvtF,OAAOr+B,MAAM+pB,WAAW;AAAA,IAC3B;AAGD,QAAIna,OAAOkN,MAAM6iB,QAAQ+sC,IAAIphE,OAAO2B,EACpC;AAAA,QAAIk7H,UAAUz7D,IAAIk7D,YAAY1iI,CAC9B;AAAA,QAAIqC,KAAKmlE,IAAIo7D,YAAYK,SAASrrH,MAAMmzC,aAAargD,KAAK3C,EAAAA,CAAAA;AAE1D,SAAK6P,MAAMijB,OAAOx4B,EAAK,GAAA;AACtBA,WAAKmlE,IAAI66D,gBAAgBj8H,QAAOswC,oBAAoBhsC,KAAK0S,SAAS,CAClE;AAAA,UAAI/a,MAAMmlE,IAAIphE,OAAO2B,IAAI;AACxB1F,aAAK;AAAA,MACL;AAAA,IACD;AAED,aAAS6gI,aAAaj6C,OAAMv+E,OAAAA;AAC3B,cAAUkN,MAAM7V,UAAUohI,KAAKp7H,IAAI2C,MAAK3C,EAAAA,MAASkhF,MAAK7rE,UAAU1S,MAAK0S,UAAUhX,QAAOswC;AAAAA,IACtF;AAED,QAAI9+B,MAAMijB,OAAOx4B,EAAAA,GAAK;AACrB,UAAI8gI,OAAOvrH,MAAM6iB,QAAQp4B;AAEzB,UAAIgN,UAAU2hB,KAAK1hB,WAAW6zH,KAAKp7H,EACnC;AAAA,UAAI4+G,aAAa31F,KAAK5hB,cAAc+zH,KAAKp7H,EAAAA;AACzC,UAAIsH,UAAUs3G,aAAa,IAAIsc,SAAS;AAEvC,YAAI37H,QAAQsQ,MAAMmzC,aAAao4E,KAAKp7H;AACpC,YAAIq7H,SAASxrH,MAAMga,QAAQuxG,KAAKp7H;AAChC,YAAIkhF,OAAOrxE,MAAM6iB,QAAQ2oG,MACzB;AAAA,YAAIlB,qBAAqBkB,MAAQ,GAAA;AAChC,cAAItxG,SAASla,MAAM8Z,QAAQu3D,KAAKlhF,EAChCkhF;AAAAA,iBAAOrxE,MAAM6iB,QAAQ3I,MACrB;AAAA,QAAA;AACD,YAAIm3D,MAAM;AACT,cAAIA,KAAKlhF,MAAM2C,KAAK3C,IAAI;AACvBo7H,mBAAOl6C;AAAAA,UACP,OACI;AACJ,gBAAI7iF,QAAOswC,mBAAmB;AAC7B,kBAAA,EAAM9+B,MAAM7V,UAAU2I,KAAK3C,IAAIo7H,KAAKp7H,EAAO6P,KAAAA,MAAMiE,YAAYsnH,KAAKp7H,IAAIlL,UAAU,GAC/E;AAAA,mBACI;AACJ+a,sBAAMoyB,KAAKt/B,KAAK3C,IAAI6P,MAAMkzC,eAAeq4E,KAAKp7H,EAAAA,IAAM,GAAG6P,MAAMgY,UAAUuzG,KAAKp7H,EAC5E,CAAA;AAAA;AAAA,cACA;AAAA,YACD,OACI;AACJ;AAAA,YACA;AAAA,UACD;AAAA,QACN,OAAW;AAENq7H,mBAASxrH,MAAM+zC,aAAarkD,KAC5B2hF;AAAAA,iBAAOrxE,MAAM6iB,QAAQ2oG,MAAAA;AAErB,cAAIlB,qBAAqBkB,MAAQ,GAAA;AAChC,gBAAItxG,SAASla,MAAM8Z,QAAQu3D,KAAKlhF,EAChCkhF;AAAAA,mBAAOrxE,MAAM6iB,QAAQ3I,MAAAA;AAAAA,UACrB;AAED,cAAIoxG,aAAaj6C,MAAMv+E,SAASu+E,KAAKlhF,MAAM2C,KAAK3C,IAAI;AACnD6P,kBAAMoyB,KAAKt/B,KAAK3C,IAAK,IAAG6P,MAAMgY,UAAUq5D,KAAKlhF,EAC7C,CAAA;AAAA;AAAA,UACA;AAAA,QACD;AAAA,MACD,WACQ3B,QAAOswC,mBAAmB;AAClC,YAAIysF,KAAKp7H,MAAM2C,KAAK3C,MAAMm7H,aAAaC,MAAMz4H,UAAUw3H,qBAAqBiB,KAAKp7H,KAAK;AACrF,cAAA,CAAK6P,MAAMmE,SAASonH,KAAKp7H,EAAAA,GAAK;AAC7Bo7H,iBAAKhlH,QAAQ;AACbvG,kBAAMoyB,KAAKt/B,KAAK3C,QAAQo7H,KAAKp7H,EAC7B;AAAA;AAAA,UACA;AACD,cAAI6P,MAAMmzC,aAAao4E,KAAKp7H,OAAO4+G,aAAa,IAAIsc,QAAS;AAAA,QAC7D;AAAA,MACD;AAED,UAAI37H,QAAQsQ,MAAMmzC,aAAao4E,KAAKp7H,EAAAA,GACnC+pB,SAASla,MAAM+zC,aAAarkD,QAAQ,CAErC;AAAA,UAAI+E,OAAOuL,MAAM6iB,QAAQ3I,MAAAA;AAEzB,UAAInK,QAAQ;AACZ,eAAStb,QAAQA,KAAKtE,MAAMo7H,KAAKp7H,OAAOT,QAAQqgB,SAAS,GAAG;AAE3DmK,iBAASla,MAAM+zC,aAAarkD,QAAQqgB,KAAAA;AACpCtb,eAAOuL,MAAM6iB,QAAQ3I,MACrBnK;AAAAA;AAAAA,MACA;AAED,UAAIjd,KAAK3C,MAAMo7H,KAAKp7H,MAAMm6H,qBAAqBiB,KAAKp7H,EAAK,EAAA;AAEzD,UAAIm7H,aAAaC,MAAMz4H,IAASA,KAAAA,KAAK3C,MAAMo7H,KAAKp7H,IAAI;AACnD6P,cAAMoyB,KAAKt/B,KAAK3C,IAAI,GAAG,GAAGo7H,KAAKp7H,EAAAA;AAAAA,MAE/B,WAAUo7H,KAAK/lH,UAAU1S,KAAK0S,SAAS,KAAA,CAAMxF,MAAMiE,YAAYsnH,KAAKp7H,IAAIlL,QAAQ;AAChF+a,cAAMoyB,KAAKt/B,KAAK3C,IAAI,GAAGo7H,KAAKp7H,EAAAA;AAAAA,MAE5B,WAAUsE,QAAS62H,aAAa72H,MAAM3B,IAAWA,KAAAA,KAAK3C,MAAMsE,KAAKtE,IAAK;AACtE6P,cAAMoyB,KAAKt/B,KAAK3C,QAAQ6P,MAAMgY,UAAUvjB,KAAKtE,EAAAA,CAAAA;AAAAA,MAE7C;AAAA,IACD;AACD,WAAO;AAAA,EACT,GAAIlE,MAEH2jE,CAAAA;AAAAA,MAAIl/D,YAAY,aAAazE,OAAM4E,KAAK,WACvC;AAAA,QAAImP,QAAQqqH,SAAAA;AACZ,QAAIhzH,OAAO2I,MAAM6iB,QAAQ+sC,IAAIphE,OAAO2B,EACpCkH;AAAAA,SAAKmzH,eAAe;AACpBnzH,SAAKkP,QAAQqpD,IAAIphE,OAAO+7H;AAExB,QAAIrhI,KAAK+H,UAAU,sBAAsB,CAAC2+D,IAAIphE,OAAO2B,IAAIy/D,IAAIphE,OAAOxE,QAAQ4lE,IAAIphE,OAAOkB,KAAAA,CAAAA,MAAY,OAAO;AACzGsQ,YAAMoyB,KAAKw9B,IAAIphE,OAAO2B,IAAIy/D,IAAIphE,OAAOkB,OAAOkgE,IAAIphE,OAAOxE,MAAAA;AACvDqN,WAAK0vD,eAAe;AAAA,IACvB,OAAS;AACN79D,WAAK+H,UAAU,gBAAgB,CAAC2+D,IAAIphE,OAAO2B,IAAIkH,KAAK0vD;IACpD;AACD96D,IAAAA,OAAM2C;AACN1F,SAAKu1D,YAAAA;AAAAA,EACP,GAAIxyD,MACJ,CAAA;AAAA;AAEA,MAAew/H,SAAA,EACdjlF,MAAM4jF;AC7QP,MAAesB,aAAA,EACdC,wBAAwB,SAASA,uBAAuB3hI;AACvD,MAAIyhB,MAAM,EACTT,cAAc,MACd2uC,aAAa,GACbiyE,UAAU,MACVpkI,OAAO,OACPgzD,aAAa,OACb4c,aAAa,MAAA;AAGd,MAAIptE,QAAQ;AACXylD,UAAYhkC,KAAKzhB,QAAQ,IAAA;AAAA,EACzB;AACD,SAAOyhB;AACP,GACDogH,mBAAmB,SAASA,kBAAkBC,WAAW17F,cAAcpwB,OAAAA;AACtE,MAAI9S,SAAShE,KAAKyiI;AAClBz+H,SAAO0+H,WAAWx7F;AAClBljC,SAAOstD,cAAc;AACrBttD,SAAO8d,eAAehL,MAAMgY,UAAU9qB,OAAO0+H,QAAAA;AAC7C1+H,SAAOysD,cAAc35C,MAAMkzC,eAAehmD,OAAO0+H,QACjD;AAAA,MAAG5rH,MAAMgY,UAAU8zG,SAAc5+H,KAAAA,OAAO8d,gBAAgB9d,OAAOysD,cAAc35C,MAAMkzC,eAAe44E,SAAAA,GAAW;AAC5G5+H,WAAOysD,eAAe;AAAA,EACtB;AACD,SAAOzsD;AACP,GACD6+H,mBAAmB,SAASA,kBAAkBD,WAAW17F,cAAcpwB,OAAAA;AACtE,MAAI9S,SAAShE,KAAKyiI,uBAClBz+H;AAAAA,SAAO0+H,WAAWx7F;AAClBljC,SAAOkqE,cAAc;AACrBlqE,SAAO8d,eAAehL,MAAMgY,UAAU9qB,OAAO0+H,QAAAA;AAC7C1+H,SAAOysD,cAAc35C,MAAMkzC,eAAehmD,OAAO0+H,QACjD;AAAA,MAAG5rH,MAAMgY,UAAU8zG,SAAc5+H,KAAAA,OAAO8d,gBAAgB9d,OAAOysD,cAAc35C,MAAMkzC,eAAe44E,SAAW,GAAA;AAC5G5+H,WAAOysD,eAAe;AAAA,EACtB;AACD,SAAOzsD;AACP,GACD8+H,kBAAkB,SAASA,iBAAiBF,WAAW17F,cAAcpwB,OAAAA;AACpE,MAAI9S,SAAShE,KAAKyiI;AAClBz+H,SAAO0+H,WAAWx7F;AAClBljC,SAAO8d,eAAe9d,OAAO0+H;AAC7B1+H,SAAOysD,cAAc;AACrBzsD,SAAO1F,QAAQ;AACf,SAAO0F;AACP,GACD++H,iBAAiB,SAASA,gBAAgBH,WAAW17F,cAAcpwB,OAAAA;AAClE,MAAIsyB,WAAWtyB,MAAMiE,YAAYmsB,YAAAA;AACjC,MAAIljC,SAAShE,KAAKyiI,uBAClBz+H;AAAAA,SAAO0+H,WAAWt5F,SAASA,SAASrtC,SAAS;AAC7CiI,SAAO8d,eAAeolB;AACtBljC,SAAOysD,cAAcrnB,SAASrtC;AAC9BiI,SAAOstD,cAAc;AACrB,SAAOttD;AACP;ACtDF,SAASirD,QAAQn4C,OAChB;AAAA,MAAI0sE,UAAU1sE,MAAMga;AACpB,SAAMha,MAAMijB,OAAOypD,OAAAA,GAAS;AAE3B,QAAI2E,OAAOrxE,MAAMga,QAAQ0yD;AACzB,QAAI1sE,CAAAA,MAAMijB,OAAOouD,IAAM,GAAA;AACtB,aAAO3E;AAAAA,IACV,OAAO;AACJA,gBAAU2E;AAAAA,IACV;AAAA,EACD;AACD,SAAO;AACR;AAEA,SAAS66C,iBAAiBJ,WAAWt0G,QAAQ8zG,cAActrH,OAAOkS,IAAAA;AACjE,MAAIzd,OAAO+iB;AACX,SAAMxX,MAAMijB,OAAOxuB,OAAM;AACxB,QAAI03H,cAAcnsH,MAAM2zC,mBAAmB3zC,MAAM6iB,QAAQpuB,IACzD,CAAA;AAAA,SAAI03H,gBAAgBb,gBAAgBa,gBAAiBb,eAAe,MAAOtrH,MAAMkzC,eAAez+C,IAAAA,IAAAA,IAAW;AAC1G;AAAA,IACH,OAAQ;AACLA,aAAOyd,KAAKlS,MAAM8Z,QAAQrlB,IAAQuL,IAAAA,MAAMga,QAAQvlB,IAAAA;AAAAA,IAChD;AAAA,EACD;AAED,MAAGuL,MAAMijB,OAAOxuB,IAAM,GAAA;AACrB,QAAGuL,MAAM2zC,mBAAmB3zC,MAAM6iB,QAAQpuB,IAAW62H,CAAAA,MAAAA,cAAa;AACjE,aAAOp5G,KAAKw5G,WAAWG,kBAAkBC,WAAWr3H,MAAMuL,KAAAA,IAAS0rH,WAAWK,kBAAkBD,WAAWr3H,MAAMuL,KAAAA;AAAAA,IACpH,OAAO;AACJ,aAAO0rH,WAAWM,iBAAiBF,WAAWr3H,MAAMuL,KACpD;AAAA,IAAA;AAAA,EACD;AACD,SAAO;AACR;AAEA,SAASosH,gBAAgBN,WAAWt0G,QAAQ8zG,cAActrH,OAAAA;AACzD,SAAOksH,iBAAiBJ,WAAWt0G,QAAQ8zG,cAActrH,OAAO,IACjE;AAAA;AACA,SAASqsH,gBAAgBP,WAAWt0G,QAAQ8zG,cAActrH,OACzD;AAAA,SAAOksH,iBAAiBJ,WAAWt0G,QAAQ8zG,cAActrH,OAAO,KACjE;AAAA;AAEe,SAASssH,yBAAyBR,WAAW17F,cAAcm8F,cAAcC,UAAUxsH,OAAOy6C,OAAAA;AACxG,MAAIvtD;AACJ,MAAGkjC,iBAAiBpwB,MAAM04C,WAAa,GAAA;AACtC,QAAI/tC,aAAa3K,MAAM6iB,QAAQuN,YAC/B;AAAA,QAAI+7F,cAAcnsH,MAAM2zC,mBAAmBhpC,UAC3C;AAAA,QAAGwhH,gBAAgB1xE,OAAM;AACxB,UAAI2c,cAAcp3D,MAAMma,eAAeiW,YAAAA;AACvC,UAAGm8F,eAAe,OAAA,CAAQn1D,aAAY;AACrClqE,iBAASw+H,WAAWK,kBAAkBD,WAAW17F,cAAcpwB,KACnE;AAAA,MAAA,OAAQ;AACJ,YAAGusH,eAAe,KAAI;AACrBn8F,yBAAegnC;AAAAA,QACf;AACDlqE,iBAASw+H,WAAWG,kBAAkBC,WAAW17F,cAAcpwB,KAC/D;AAAA,MAAA;AAAA,IACJ,WAAWmsH,cAAc1xE,OAAM;AAC5Bz6C,YAAMqzC,WAAW,SAASrpD,QACzB;AAAA,YAAGgW,MAAM2zC,mBAAmB3pD,MAAAA,MAAYywD,OAAM;AAC7CrqB,yBAAepmC,OAAOmG;AAAAA,QACtB;AAAA,MACD,GAAEwa;AACHzd,eAASk/H,gBAAgBN,WAAW17F,cAAcqqB,OAAOz6C;IAC5D,OAAO;AACJ,UAAIysH,cAAcL,gBAAgBN,WAAW17F,cAAcqqB,OAAOz6C,KAAAA;AAClE,UAAI0sH,cAAcL,gBAAgBP,WAAW17F,cAAcqqB,OAAOz6C,KAAAA;AAClE9S,eAAUq/H,eAAe,MAAOE,cAAcC;AAAAA,IAC9C;AAAA,EACH,OAAM;AACJ,QAAIv4H,SAAS6L,MAAM04C,WACnB;AAAA,QAAIxhC,YAAYlX,MAAMiE,YAAY9P,MAAAA;AAClCjH,aAASw+H,WAAWC,uBAAAA;AACpB,QAAGz0G,UAAUjyB,UAAUunI,YAAY,GAAE;AACpCt/H,eAASk/H,gBAAgBN,WAAW3zE,QAAQn4C,QAAQy6C,OAAOz6C,KAAAA;AAAAA,IAC9D,OAAO;AACJ9S,eAASm/H,gBAAgBP,WAAW33H,QAAQsmD,OAAOz6C,KAAAA;AAAAA,IACnD;AAAA,EACD;AAED,SAAO9S;AACR;ACjFe,SAASy/H,0BAA0Bb,WAAW17F,cAAcm8F,cAAcC,UAAUxsH,OAAAA;AAClG,MAAI9S;AAEJ,MAAGkjC,iBAAiBpwB,MAAM04C,WAAa,GAAA;AACtC,QAAG6zE,eAAe,MAAK;AACtBr/H,eAASw+H,WAAWK,kBAAkBD,WAAW17F,cAAcpwB,KAAAA;AAAAA,IAC/D,WAAQusH,eAAe,OAAUvsH,EAAAA,MAAMmE,SAASisB,YAAAA,KAAiBpwB,MAAM6iB,QAAQuN,YAAAA,EAAc7pB,QAAO;AACpGrZ,eAASw+H,WAAWG,kBAAkBC,WAAW17F,cAAcpwB;IAClE,OAAQ;AACL9S,eAASw+H,WAAWM,iBAAiBF,WAAW17F,cAAcpwB,KAC9D;AAAA,IAAA;AAAA,EACH,OAAM;AACJ,QAAI7L,SAAS6L,MAAM04C,WACnB;AAAA,QAAG14C,MAAMmE,SAAShQ,MAAAA,KAAWq4H,YAAY,GAAE;AAC1Ct/H,eAASw+H,WAAWO,gBAAgBH,WAAW33H,QAAQ6L,KAC1D;AAAA,IAAA,OAAO;AACJ9S,eAASw+H,WAAWM,iBAAiBF,WAAW33H,QAAQ6L,KAAAA;AAAAA,IACxD;AAAA,EACD;AAED,SAAO9S;AACR;ACrBA,SAAS0/H,kBAAkBpkI,QAAQjE,MAAM60B,MACxC;AAAA,MAAI+mG,YAAY0M,sBAAsBrkI,QAAQ4wB,IAE9C70B;AAAAA,OAAKg9B,OAAOr+B,MAAMlC,OAAOm/H,UAAUz9H,IAAI,IAAI;AAC3C6B,OAAKg9B,OAAOr+B,MAAMP,QAAQw9H,UAAUx9H,QAAQ;AAC5C4B,OAAKg9B,OAAOr+B,MAAM+pB,WAAW;AAC7B,MAAI6/G,aAAavoI,KAAKuoI;AACtB,MAAA,CAAIA,YAAW;AACdA,iBAAaxrI,SAASoE,cAAc,KAAA;AACpConI,eAAW7mI,YAAY;AACvB6mI,eAAWvlI,YAAY;AACvBulI,eAAW5pI,MAAM6pI,gBAAgB;AAAA,EACjC;AAED,MAAGvkI,OAAOhB,OAAM;AACfwlI,oBAAgBxkI,QAAQskI,YAAY1zG,IACtC;AAAA,EAAA,OAAM;AACJ6zG,iBAAazkI,QAAQskI,YAAY1zG,IACjC;AAAA,EAAA;AAED,OAAI70B,KAAKuoI,YAAW;AACnBxrI,aAASD,KAAKuE,YAAYknI;AAC1BvoI,SAAKuoI,aAAaA;AAAAA,EAClB;AACF;AAEA,SAASI,oBAAoB3oI,MAC5B;AAAA,MAAGA,KAAKuoI,cAAcvoI,KAAKuoI,WAAWrrI,YAAW;AAChD8C,SAAKuoI,WAAWrrI,WAAWqE,YAAYvB,KAAKuoI,UAC5C;AAAA,EAAA;AACDvoI,OAAKuoI,aAAa;AACnB;AAEA,SAASG,aAAazkI,QAAQskI,YAAY1zG,MACzC;AAAA,MAAI+zG,UAAUC,sBAAsB5kI,QAAQ4wB,IAC5C;AAAA,MAAIyxG,YAAYzxG,KAAKP,WAAW13B,sBAAwBD,EAAAA,SAASS,OAAOmY;AAExEgzH,aAAWvlI,YAAY;AACvBulI,aAAW5pI,MAAMlC,OAAOmsI,QAAQzqI,IAAI;AACpCoqI,aAAW5pI,MAAMN,SAAS;AAE1B,MAAIyqI,gBAAgBF,QAAQ5qI,IAAI;AAChCuqI,aAAW5pI,MAAMnC,MAAMssI,gBAAgB;AACvCP,aAAW5pI,MAAMP,QAAQwqI,QAAQxqI,QAAQ;AAEzC,MAAI0qI,gBAAgBxC,WAAW;AAC9BiC,eAAW5pI,MAAMnC,MAAM8pI,YAAY;AAAA,EACnC;AAED,SAAOiC;AACR;AACA,SAASE,gBAAgBxkI,QAAQ8kI,cAAcl0G,MAAAA;AAC9C,MAAIjpB,KAAK3H,OAAOwiB;AAChB,MAAI7V,MAAMo4H,sBAAsB,EAAC7qI,GAAG,GAAGH,GAAG62B,KAAK1hB,WAAWvH,EAAMipB,EAAAA,GAAAA,IAAAA;AAChE,MAAIyxG,YAAYzxG,KAAKP,WAAW13B,sBAAAA,EAAwBD,SAASS,OAAOmY;AAExE,MAAI0zH,uBAAuBC,wBAAwBr0G,KAAKowC,QAAQpwC,KAAKP,WAAW52B,WAEhFqrI;AAAAA,eAAa/lI,YAAY;AACzB+lI,eAAapqI,MAAMP,QAAQ6qI,uBAAuB;AAClDF,eAAapqI,MAAMnC,MAAMoU,IAAI5S,IAAI;AACjC+qI,eAAapqI,MAAMlC,OAAOmU,IAAIzS,IAAK;AACnC4qI,eAAapqI,MAAMN,SAASw2B,KAAK5hB,cAAcrH,EAAM,IAAA;AACrD,MAAIgF,IAAI5S,IAAIsoI,WAAW;AACtByC,iBAAapqI,MAAMnC,MAAM8pI,YAAY;AAAA,EACrC;AAED,SAAOyC;AACR;AAEA,SAASF,sBAAsB5kI,QAAQ4wB;AACtC,MAAIpZ,QAAQoZ,KAAKzf,QAAQqtG;AACzB,MAAI7xG,MAAM,EAACzS,GAAE,GAAGH,GAAE,EAAA;AAClB,MAAImrI,aAAat0G,KAAKP,WAAW1xB,cAAc,oBAC/C;AAAA,MAAIwmI,SAAS;AACb,MAAIlzE,QAAQ;AACZ,MAAGizE,YAAW;AACbC,aAASD,WAAWzrI;AAAAA,EACpB;AACD,MAAI2rI,YAAY;AAChB,MAAGplI,OAAOojI,aAAa5rH,MAAM04C,cAAa;AACzC,QAAIjhD,UAAU2hB,KAAK1hB,WAAWlP,OAAOojI;AACrC,QAAI7c,aAAa31F,KAAK5hB,cAAchP,OAAOojI,QAAAA;AAC3CnxE,YAAQz6C,MAAMijB,OAAOz6B,OAAOojI,QAAAA,IAAY5rH,MAAM2zC,mBAAmB3zC,MAAM6iB,QAAQr6B,OAAOojI,aAAa;AAEnG,QAAGpjI,OAAO4uE,aAAY;AACrBjiE,UAAI5S,IAAIkV;AAAAA,IACX,WAAWjP,OAAOgyD,aAAY;AAC3B,UAAIqzE,aAAa;AACjB7tH,YAAMozC,SAAS,SAAS5rD,OAAAA;AACvB,YAAGwY,MAAMmzC,aAAa3rD,MAAM2I,EAAAA,MAAAA,GAC3B09H;AAAAA,MACL,GAAMrlI,OAAOojI,QAEVz2H;AAAAA,UAAI5S,IAAIkV,UAAUs3G,aAAa8e,aAAW9e;AAAAA,IAC7C,OAAQ;AACL55G,UAAI5S,IAAIkV,UAAUs3G;AAClBt0D,eAAS;AAAA,IACT;AAAA,EACD;AACDtlD,MAAIzS,IAAIkrI,YAAYnzE,QAAQkzE;AAC5Bx4H,MAAIxS,QAAQ8qI,wBAAwBr0G,KAAKowC,QAAQhnE,KAAKuD,IAAIqzB,KAAKP,WAAW52B,cAAckT,IAAIzS,GAAG,CAAIyS,GAAAA,IAAIzS,CACvG;AAAA,SAAO6qI,sBAAsBp4H,KAAKikB;AACnC;AAEA,SAASm0G,sBAAsBp4H,KAAKikB,MACnC;AAAA,MAAI00G,UAAUv/F,gBAA2BnV,KAAKP;AAC9C1jB,MAAIzS,KAAKorI,QAAQprI,IAAI02B,KAAKhB,MAAMv2B;AAChCsT,MAAI5S,KAAKurI,QAAQvrI,IAAI62B,KAAKP,WAAWn3B;AACrC,SAAOyT;AACR;AAEA,SAAS03H,sBAAsBzkI,GAAGgxB,MAAAA;AACjC,MAAIjkB,MAAMo5B,gBAA2BnV,KAAKP,UAAAA;AAC1C,MAAIk1G,OAAO1/F,yBAAoCjmC,GAAGgxB,KAAKP,UAAAA;AAEvD,MAAIn2B,IAAIyS,IAAIzS,IAAI02B,KAAKhB,MAAMv2B;AAC3B,MAAIU,IAAIwrI,KAAKxrI,IAAI;AAEjB,MAAIqjF,YAAYxsD,KAAK5hB,cAAcpP,EAAEwjI;AAErC,MAAIrpI,IAAI4S,IAAI5S,EAAGA,KAAI4S,IAAI5S;AACvB,MAAIqoI,aAAaxxG,KAAKxhB,eACtB;AAAA,MAAIrV,IAAI4S,IAAI5S,IAAIqoI,aAAahlD,UAAWrjF,KAAI4S,IAAI5S,IAAIqoI,aAAahlD;AAEjEzwE,MAAIzS,IAAIA;AACRyS,MAAI5S,IAAIA;AACR4S,MAAIxS,QAAQ8qI,wBAAwBr0G,KAAKowC,QAAQr0D,IAAIxS,OAAO,CAC5D;AAAA,SAAOwS;AACR;AAEA,SAASs4H,wBAAwBxhI,QAAOtJ,OAAOymC,SAAS,GACvD;AAAA,QAAMgiG,gBAAgB78F,gBAA2BtiC,OAAMgC,KACvD;AAAA,MAAItL,QAAQyoI,cAAczoI,OAAM;AAC/BA,YAAQyoI,cAAczoI,QAAQymC,SAAS;AAAA,EACvC;AACD,SAAOzmC;AACR;AAEA,MAAeqrI,aAAA,EACdd,qBACAN,kBAAmBA;AC5IpB,SAASxC,UAAUn+H,QAAOmtB,MACzB;AAAA,MAAIgzB,OAAMngD,OAAMc,UAAUC,WAAW;AAErC,MAAIosB,CAAAA,KAAKzf,QAAQ9I,QAAS5E,CAAAA,OAAMsoC,aAAanb,KAAKzf,QAAQ9I,IAAM,GAAA;AAC/D;AAAA,EACA;AAED,WAASqnB,OAAO9vB,GAAAA;AACf,WAAO0yB,gBAA2B1yB,GAAGgxB,KAAKzf,QAAQswG,cAAAA;AAAAA,EAClD;AAED,WAASogB,WACR;AAAA,WAAOp+H,OAAMsoC,aAAanb,KAAKzf,QAAQ9I,IACvC;AAAA,EAAA;AAED,WAASy5H,qBAAqBn6H,IAAAA;AAC7B,WAAOolD,kBAAkBplD,IAAIlE,QAAOo+H;EACpC;AAED,MAAIz6D,MAAM,IAAIxjB,KAAIhzB,KAAKP,YAAY,EAACo1B,oBAAoB,GACxD,CAAA;AAAA,MAAIhiD,OAAMugC,QAAQpT,KAAK22E,WAAayf,EAAAA,eAAAA,EACnC5/C,KAAIphE,OAAOmgD,cAAcv1B,KAAK22E,WAAayf,EAAAA;AAE5C5/C,MAAIl/D,YAAY,qBAAqBzE,OAAM4E,KAAK,SAAU5I,KAAKG,GAC9D;AAAA,QAAIqC,KAAKytB,OAAO9vB;AAChB,QAAKqC,CAAAA,GAAI,QAAO;AAChB,QAAIwB,OAAM2/B,cAAe3/B,CAAAA,OAAM2/B,cAAAA;AAC/B,QAAIzN,QAAmB/1B,EAAEI,QAAQ,gCAAkC,GAAA;AAClE,aAAO;AAAA,IACP;AAED,QAAI2H,KAAK1F,GAAGnH,aAAa81B,KAAKzf,QAAQswG,cACtC;AAAA,QAAI31E,YAAYlb,KAAKzf,QAAQqtG;AAC7B,QAAI3vG,OAAOi9B,UAAUzR,QAAQ1yB,EAE7B;AAAA,QAAIlE,OAAMqrB,WAAWjgB,IAAAA,KAASizH,qBAAqBn6H,EAClD,EAAA,QAAO;AAERy/D,QAAIphE,OAAO+7H,qBAAqBlzH,KAAKkP;AACrC,QAAA,CAAKta,OAAMgF,UAAU,kBAAkB,CAACd,IAAI/H,EAAEI,UAAUJ,EAAEK,YAAYL,CAAAA,CAAAA,GAAK;AAC1E,aAAO;AAAA,IACP;AAAA,EAEH,GAAI6D,MAAAA,CAAAA;AAEH2jE,MAAIl/D,YAAY,oBAAoBzE,OAAM4E,KAAK,SAAU5I,KAAKG;AAC7D,QAAIqC,KAAKytB,OAAO9vB,CAAAA;AAEhBwnE,QAAIphE,OAAO+yB,OAAOh6B,YAAYkD,GAAG+mH;AACjC,QAAI3qH,UAAU+oE,IAAIphE,OAAO+yB,OAAO95B;AAChC,QAAGZ,SAAQ;AACV+oE,UAAIphE,OAAO+yB,OAAOr+B,MAAM+qI,UAAU;AAClCpnI,cAAQ3D,MAAM2J,WAAW;AACzBhG,cAAQ3D,MAAM6pI,gBAAgB;AAAA,IAC9B;AAEDn9D,QAAIphE,OAAO2B,KAAK1F,GAAGnH,aAAa81B,KAAKzf,QAAQswG,cAAAA;AAE7C,QAAIjqG,QAAQoZ,KAAKzf,QAAQqtG;AAEzB,QAAI3vG,OAAO2I,MAAM6iB,QAAQ+sC,IAAIphE,OAAO2B,EACpCy/D;AAAAA,QAAIphE,OAAOisD,QAAQz6C,MAAM2zC,mBAAmBt8C;AAC5Cu4D,QAAIphE,OAAO0/H,cAAcxC,WAAWC,uBAAuB,EAC1D3gH,cAAchL,MAAMgY,UAAU3gB,KAAKlH,EACnCwpD,GAAAA,aAAa35C,MAAMkzC,eAAe77C,KAAKlH,EACvCy7H,GAAAA,UAAUv0H,KAAKlH,IACfqqD,aAAa,KAGdnjD,CAAAA;AAAAA,SAAKkP,QAAQ;AACblP,SAAKmzH,eAAe;AACpBthI,SAAKu1D,YACP;AAAA,EAAA,GAAIxyD,MAEH,CAAA;AAAA,WAASkiI,gBAAgB/lI,GACxB;AAAA,QAAI7F,IAAI8rC,yBAAoCjmC,GAAGgxB,KAAKP,UAAYt2B,EAAAA;AAChE,QAAIyd,QAAQoZ,KAAKzf,QAAQqtG;AAEzB,QAAK1lH,CAAAA,SAAS8sI,SAAQ;AACrB7rI,WAAKZ,OAAOmY;AAAAA,IACZ;AACDvX,QAAIA,KAAK;AAGT,QAAIwoI,YAAY3xG,KAAK05F,OAAOpxH,aAAa;AACzC,QAAImpI,YAAY5+H,OAAM4sB,WAAW13B,sBAAAA,EAAwByB,SAASmoI,YAAYppI,OAAOmY;AACrF,QAAIu0H,SAAStD;AAEb,QAAIuD,wBAAwBl1G,KAAK7hB,0BAA0B6hB,KAAK05F,OAAOpxH,SAAAA;AACvE,QAAKse,CAAAA,MAAMijB,OAAOqrG,qBAAAA,GAAuB;AACxCA,8BAAwBtuH,MAAMizC,iBAAiB;AAAA,IAC/C;AACD,QAAIq7E,wBAAwB,GAAG;AAC9B,aAAOtuH,MAAM04C,WAAAA;AAAAA,IACb;AAED,QAAI61E,qBAAqBvuH,MAAM+zC,aAAau6E,qBAE5C;AAAA,QAAIE,sBAAsBp1G,KAAK05F,OAAOpxH,YAAY03B,KAAK5hB,cAAc+2H,kBAAAA;AACrE,QAAIE,iBAAiBD,sBAAsBhsI,KAAKkS,MAAM85H,mBAAAA;AACtD,QAAIC,iBAAiB,OAAOA,iBAAiB,KAAK;AACjD5D,kBAAYA,YAAYzxG,KAAK5hB,cAAc+2H,sBAAsBE;AACjEJ,eAASA,SAASj1G,KAAK5hB,cAAc+2H,kBAAuB,KAAA,IAAIE;AAAAA,IAChE;AAGD,UAAMC,eAAengG,gBAA2BnV,KAAKP,UACrD;AAAA,UAAM81G,aAAaD,aAAansI,IAAImsI,aAAa9rI;AACjD,UAAMgsI,uBAAuBh/D,IAAIphE,OAAO+yB,OAAOr/B;AAC/C,QAAIK,IAAIqsI,uBAAuBjtI,OAAOmY,WAAW+wH,WAAU;AAC1Dj7D,UAAIphE,OAAO+yB,OAAOr+B,MAAMnC,MAAM4tI,aAAaC,uBAAuB;AAAA,IAClE;AAED,QAAIrsI,KAAKsoI,WAAW;AACnBtoI,UAAIsoI;AAAAA,IACP,WAAatoI,KAAK8rI,QAAQ;AACvB9rI,UAAI8rI;AACJz+D,UAAIphE,OAAO+yB,OAAOr+B,MAAMnC,MAAM2tI,aAAansI,IAAI;AAAA,IAC/C;AAED,QAAImN,QAAQ0pB,KAAK7hB,0BAA0BhV,CAAAA;AAE3C,QAAImN,QAAQsQ,MAAMizC,aAAiB,IAAA,KAAKvjD,QAAQ,GAAG;AAClD,aAAOsQ,MAAM04C,WACb;AAAA,IAAA;AAED,QAAIkzE,WAAW5rH,MAAM+zC,aAAarkD,KAAAA;AAClC,QAAI46H,qBAAqBsB,QAAW,GAAA;AACnC,aAAO5rH,MAAMma,eAAeyxG;IAC5B;AAED,WAAO5rH,MAAM+zC,aAAarkD,KAAAA;AAAAA,EAC1B;AAED,WAASm/H,gBAAgBzmI,GAAAA;AACxB,QAAIgoC,eAAe+9F,gBAAgB/lI;AACnC,QAAImkI,eAAe;AACnB,QAAIvsH,QAAQoZ,KAAKzf,QAAQqtG;AACzB,QAAIx4G,UAAS4qB,KAAK22E,WAAAA;AAClB,QAAI++B,YAAatgI,CAAAA,QAAOswC;AAExB,QAAI0tF,WAAWn+F,yBAAoCjmC,GAAGgxB,KAAKP,UAAAA,EAAYt2B;AACvE,QAAKjB,CAAAA,SAAS8sI,SAAQ;AACrB5B,kBAAY7qI,OAAOmY;AAAAA,IACnB;AAED,QAAGs2B,iBAAiBpwB,MAAM04C,WAAc,GAAA;AACvC,UAAIq2E,SAAS31G,KAAK1hB,WAAW04B,YAC7B;AAAA,UAAIw1C,YAAYxsD,KAAK5hB,cAAc44B,YACnCm8F;AAAAA,sBAAgBC,WAAWuC,UAAUnpD;AAAAA,IACrC;AAED,QAAI14E;AACJ,QAAA,CAAI4hI,WAAU;AACb5hI,eAAS8hI,0BAAoBp/D,IAAIphE,OAAO2B,IAAIigC,cAAcm8F,cAAcC,UAAUxsH,KACrF;AAAA,IAAA,OAAO;AACJ9S,eAAS+hI,yBAAqBr/D,IAAIphE,OAAO2B,IAAIigC,cAAcm8F,cAAcC,UAAUxsH,OAAO4vD,IAAIphE,OAAOisD,KAAAA;AACrG,UAAGvtD,UAAUA,OAAO8d,gBAAgBs/G,qBAAqBp9H,OAAO8d,YAAAA,GAAc;AAC7EolB,uBAAepwB,MAAMma,eAAejtB,OAAO8d,YAC3C9d;AAAAA,iBAAS+hI,yBAAqBr/D,IAAIphE,OAAO2B,IAAIigC,cAAcm8F,cAAcC,UAAUxsH,OAAO4vD,IAAIphE,OAAOisD;MACrG;AAAA,IACD;AAED,WAAOvtD;AAAAA,EACP;AAED0iE,MAAIl/D,YAAY,cAAczE,OAAM4E,KAAK,SAAU5I,KAAKG;AACvD,QAAII,SAASqmI,gBAAgBzmI,CAE7B;AAAA,QAAA,CAAII,UACHyD,OAAMgF,UAAU,uBAAuB,CAAC2+D,IAAIphE,OAAO2B,IAAI3H,OAAOwiB,cAAcxiB,OAAOmxD,WAAAA,CAAAA,MAAkB,OAAM;AAC1GnxD,eAASkjI,WAAWC,uBAAuB/7D,IAAIphE,OAAO0/H,WACtD;AAAA,IAAA;AAEFF,eAAWpB,kBAAkBpkI,QAAQonE,IAAIphE,QAAQ4qB,IAAAA;AACjDw2C,QAAIphE,OAAO0/H,cAAc1lI;AACzByD,IAAAA,OAAM08B,SAASwiG,kBAAkBv7D,IAAIphE,OAAO+yB,MAAAA;AAE5Cr4B,SAAK+H,UAAU,iBAAiB,CAAC2+D,IAAIphE,OAAO2B,IAAI3H,OAAOwiB,cAAcxiB,OAAOmxD;AAC5E,WAAO;AAAA,EACT,GAAI1tD,MAEH2jE,CAAAA;AAAAA,MAAIl/D,YAAY,aAAazE,OAAM4E,KAAK,WAAA;AACvC,QAAImP,QAAQoZ,KAAKzf,QAAQqtG;AACzB,QAAI3vG,OAAO2I,MAAM6iB,QAAQ+sC,IAAIphE,OAAO2B,EAAAA;AAEpC69H,eAAWd,oBAAoBt9D,IAAIphE,MAAAA;AAEnC6I,SAAKmzH,eAAe;AACpBnzH,SAAKkP,QAAQqpD,IAAIphE,OAAO+7H;AACxB,QAAI/hI,SAASonE,IAAIphE,OAAO0/H;AAExB,QAAIhlI,KAAK+H,UAAU,sBAAsB,CAAC2+D,IAAIphE,OAAO2B,IAAI3H,OAAOwiB,cAAcxiB,OAAOmxD,WAAkB,CAAA,MAAA,OAAO;AAC7GtiD,WAAK0vD,eAAe;AAAA,IACvB,OAAS;AACN/mD,YAAMoyB,KAAKw9B,IAAIphE,OAAO2B,IAAI3H,OAAOmxD,aAAanxD,OAAOwiB,YACrD/e;AAAAA,MAAAA,OAAM2C,OACN1F;AAAAA,WAAK+H,UAAU,gBAAgB,CAAC2+D,IAAIphE,OAAO2B,IAAI3H,OAAOwiB,cAAcxiB,OAAOmxD;IAC3E;AACD35C,UAAMojB,QAAQ/rB,KAAKlH,EAAAA;AAAAA,EACrB,GAAIlE,MACJ,CAAA;AAAA;AAEA,MAAeijI,eAAA,EACd1oF,MAAM4jF;AC9MP,IAAI+E,gBAAc,2BACjB;AAAA,SAAO,SAASljI,QAAAA;AACf,WAAO,EACNmjI,WAAW,SAAUh2G,MAAAA;AACpBA,WAAKzf,UAAU81C,MAAYr2B,KAAKzf,SAAS,EACxC9I,MAAM,OAAA,CAAA;AAEP,UAAGuoB,KAAKzf,QAAQxJ,MAAM,QAAQ;AAC7BjH,aAAKokE,YAAYl0C,IACjBntB;AAAAA,QAAAA,OAAMoC,IAAIu3B,gBAAgB35B,OAAMoC,IAAIghI,eAAepR,cAAc7kG,IAAAA;AACjEntB,QAAAA,OAAMoC,IAAIu3B,cAAc4gB,KAAAA;AAAAA,MACxB;AAEDt9C,WAAKqqH,kBAAkBC,SAAoBvnH,MAC3C;AAAA,IAAA,GACDqjI,eAAe,SAAUl2G,MAAAA;AACxB,UAAI5qB,UAAS4qB,KAAK22E,WAAAA;AAClB,UAAIvhG,QAAOqwC,cAAc;AACxB,YAAGrwC,QAAOqwC,gBAAgB,UAAS;AAClCqwF,uBAAa1oF,KAAKptB,KAAKowC,QAAQpwC;QACrC,OAAU;AACJqyG,iBAAOjlF,KAAKptB,KAAKowC,QAAQpwC,IACzB;AAAA,QAAA;AAAA,MACD;AAEDlwB,WAAKqmI,WAAWn2G,MAAMntB;AACtB,UAAGmtB,KAAKzf,QAAQxJ,MAAM,QAAQ;AAC7BjH,aAAKsmI,UAAUp2G,IAAAA;AAAAA,MACf;AAAA,IACD,GACDq2G,aAAa,SAAUr2G;AACtB,UAAGA,KAAKzf,QAAQxJ,MAAM,QAAQ;AAG7BlE,QAAAA,OAAMoC,IAAIu3B,cAAcm4F,YAAAA;AAAAA,MACxB;AACD70H,WAAKwmI,YAAYt2G,MAAMntB,MAAAA;AAAAA,IACvB,GAEDsjI,YAAY,SAAUn2G,MAAMntB;AAC3B/C,WAAKqqH,gBAAgBthB,SAAS,SAAS,aAAahmG,OAAM4E,KAAK,SAAUzI,GAAG+H,IAAI9H,KAC/E;AAAA,cAAMmG,UAAS4qB,KAAK22E,WAAAA;AACpB,YAAI5/F,OAAO,MAAM;AAChB,gBAAMkH,OAAOnO,KAAKkf,QAAQjY,EAAAA;AAC1B,cAAI3B,QAAOyqB,iBAAiB;AAC3B,kBAAM02G,cAAe1jI,CAAAA,OAAMo5B,oBAAoBj9B,CAAAA;AAC/C,kBAAM2wB,kBAAkB9sB,OAAMoM,IAAIC,QAAQ,UAAA;AAG1C,gBAAIq3H,eAAe52G,iBAAgB;AAClC7vB,mBAAK0mI,SAASv4H,KAAKgE;YACnB;AAAA,UACD;AACDpP,UAAAA,OAAMgF,UAAU,kBAAkB,CAACd,IAAI9H,GAAAA,CAAAA;AAAAA,QACvC;AAAA,MACD,GAAE4D,MAAQmtB,GAAAA,KAAKhB;AAEhBlvB,WAAKqqH,gBAAgBthB,SAAS,SAAS,wBAAwBhmG,OAAM4E,KAAK,SAAUzI,GAAG+H,IAAI9H,KAC1F;AAAA,YAAIw2B,SAASx2B,IAAI/E,aAAa,gBAE9B;AAAA,YAAA,CAAK2I,OAAMgF,UAAU,qBAAqB,CAAC4tB,QAAQz2B,CAClD,CAAA,EAAA;AAED,YAAIoG,UAAS4qB,KAAK22E,WAElB;AAAA,YAAIlxE,UAAU,OAAO;AACpB,cAAIqzE,eAAcjmG,OAAMc,UAAUC,WAAW,aAC7CklG;AAAAA,UAAAA,aAAYf,YAAY,SAAS,aAAa/3E,KAAKhB,OAAO,CAAChwB,GAAGoG,QAAOuV,OACrE,CAAA;AAAA;AAAA,QACA;AAED,YAAIvV,QAAOrJ,QAAQ05B,QAAQ;AAC1B,cAAIgxG,iBAAiBhxG,QACpB+pC;AAED,mBAAS5jE,IAAI,GAAGA,IAAIwJ,QAAOuN,QAAQ9W,QAAQD,KAAK;AAC/C,gBAAIwJ,QAAOuN,QAAQ/W,CAAAA,EAAGuB,QAAQs4B,QAAQ;AACrC+pC,qBAAOp6D,QAAOuN,QAAQ/W,CAAAA;AACtB;AAAA,YACA;AAAA,UACD;AAED,cAAI4jE,QAAQA,KAAKzjE,SAASoE,UAAaq/D,KAAKzjE,SAAS,MAAM;AAC1D0qI,6BAAiBjnE,KAAKzjE;AAEtB,gBAAA,CAAK0qI,gBAAgB;AACpB;AAAA,YACA;AAAA,UACD;AAED,cAAI1qI,OAAQ+D,KAAK47F,SAAS57F,KAAK47F,MAAMnM,aAAazvF,KAAK47F,MAAMv+F,QAAQs4B,SAAU31B,KAAK47F,MAAMnM,YAAY;AAEtGxzF,iBAAQA,QAAQ,SAAU,QAAQ;AAClC+D,eAAK47F,QAAQ,EACZv+F,MAAMs4B,QACN85D,WAAWxzF,KAEZ+D;AAAAA,eAAK/D,KAAK0qI,gBAAgB1qI,QAAQ,MAAA;AAAA,QAClC;AAAA,MACD,GAAE8G,MAAAA,GAAQmtB,KAAKhB,KAEhBlvB;AAAAA,WAAKqqH,gBAAgBthB,SAAS,SAAS,aAAahmG,OAAM4E,KAAK,SAAUzI,GAAG+H,IAAI9H,KAAAA;AAC/E,YAAImG,UAAS4qB,KAAK22E;AAClB,YAAIvhG,QAAOiM,SAAU;AAErB,YAAI3H,OAAO,CAAA;AACX5J,aAAKquB,WAAWzkB,MAAM3C,KAAKA,KAAKlE,OAAMuC,OAAOuV,OAE7C;AAAA,eAAO;AAAA,MACP,GAAE9X,SAAQmtB,KAAKhB,KAAAA;AAAAA,IAEhB,GAEDs3G,aAAa,SAASt2G,MAAMntB;AAC3B/C,WAAKqqH,gBAAgBp7G,WACrBjP;AAAAA,WAAKqqH,kBAAkB;AAAA,IACvB,GAEDic,WAAW,SAASp2G;AACnBntB,MAAAA,OAAMmsB,QAAQgB,KAAKhB;AACnBnsB,MAAAA,OAAM8qB,cAAcqC,KAAKrC;AACzB9qB,MAAAA,OAAM4sB,aAAaO,KAAKP;AAAAA,IACxB,GACDy0C,aAAa,SAASl0C;AACrBntB,MAAAA,OAAMuqB,iBAAiBvqB,OAAM4E,KAAKuoB,KAAK5C,gBAAgB4C;AAEvDA,WAAK1oB,YAAY,uBAAuB,WACvC;AAAA,eAAOzE,OAAMgF,UAAU,uBAAuBnB,SACnD;AAAA,MAAA,CAAA;AACIspB,WAAK1oB,YAAY,kBAAkB,WAClC;AAAA,eAAOzE,OAAMgF,UAAU,kBAAkBnB,SAAAA;AAAAA,MAC9C;AACIspB,WAAK1oB,YAAY,qBAAqB,WAAA;AACrC,eAAOzE,OAAMgF,UAAU,qBAAqBnB,SAAAA;AAAAA,MACjD;AAEIspB,WAAK1oB,YAAY,0BAA0B,SAASqL,SAAS+zH,YAC5D7jI;AAAAA,QAAAA,OAAMuC,OAAO6vG,aAAayxB;AAAAA,MAC/B,CAEI12G;AAAAA,WAAK1oB,YAAY,qBAAqB,WACrC;AAAA,eAAOzE,OAAMgF,UAAU,qBAAqBnB,SACjD;AAAA,MAAA,CAAA;AACIspB,WAAK1oB,YAAY,eAAe,WAC/B;AAAA,eAAOzE,OAAMgF,UAAU,eAAenB;MAC3C,CACIspB;AAAAA,WAAK1oB,YAAY,wBAAwB,WACxC;AAAA,eAAOzE,OAAMgF,UAAU,wBAAwBnB,SACpD;AAAA,MAAA,CAAA;AACIspB,WAAK1oB,YAAY,oBAAoB,WACpC;AAAA,eAAOzE,OAAMgF,UAAU,oBAAoBnB,SAAAA;AAAAA,MAChD;IACI,EAEJ;AAAA,EAAA;AACC,EC3JD;AAAA,SAASigI,cAAc33H,UAAUnM,QAAAA;AAChC,MAAImuC,YAAWnuC,OAAMc;AACrB,SAAO,EACNuxF,MAAM,MACN0xC,cAAc,CAAE,GAChBpmF,SAAS,EACRqmF,cAAc,CAAE,GAChBC,eAAe,CAAE,GACjBC,cAAc,CAAE,EAEjB38G,GAAAA,WAAW,CAAE,GACbgzB,MAAM,WACLt9C;AAAAA,SAAKkD,aAAaH,OAAMI;AACxBnD,SAAKknI,iBAAAA;AACL,QAAI9xC,OAAOryF,OAAMuC,OAAOquC;AACxB3zC,SAAKmnI,YAAAA;AAEL,QAAInkC,eAAe9xD,UAASptC,WAAW;AACvCk/F,iBAAaj/F,iBAAiB,YAAY4/C,KAAW,WAAA;AACpD,aAAO,EACNjY,SAAU1rC,KAAKo1F,OAAOp1F,KAAKo1F,KAAKnuF,KAAK5G,QACrCszC,WAAY3zC,KAAKo1F,OAAOp1F,KAAKo1F,KAAK79D,OAAOl3B,QACzC+mI,iBAAkBpnI,KAAKo1F,OAAOp1F,KAAKo1F,KAAKt9F,OAAOuI,OAAAA;AAAAA,IAEpD,GAAML,IAEH,CAAA;AAAA,QAAIihF,MAAM,EACT8lD,cAAgB,oBAChBC,eAAiB,uBACjBC,cAAgB;AAGjB,aAASI,SAASrnI,KAAK0gD,SAAS;AAC/B,eAASnpB,QAAQ69D,MAAM;AACtBp1F,aAAK0gD,QAAQ2mF,OAAO9vG,IAAQ0pD,IAAAA,IAAIomD;MAChC;AAAA,IACD;AAEDrnI,SAAKsqB,UAAU8qE,KAAKlsD,IAAQlpC,IAAAA,KAAKsnI;AACjCtnI,SAAKsqB,UAAU8qE,KAAKxhD,MAAAA,IAAU5zC,KAAKunI;AACnCvnI,SAAKsqB,UAAU8qE,KAAKvhD,QAAAA,IAAY7zC,KAAKwnI;AAAAA,EACrC,GACDL,aAAa;AACZ,QAAI10H,QAAOvD,SAASF;AACpBhP,SAAKkD,WAAWsB,OAAOiO,OAAM,aAAa1P,OAAM4E,KAAK,SAASzI;AAC7Dc,WAAKynI,cAAcvoI,CACvB;AAAA,IAAA,GAAMc,IACHA,CAAAA;AAAAA,SAAKkD,WAAWsB,OAAOiO,OAAM,aAAa1P,OAAM4E,KAAK,SAASzI;AAC7Dc,WAAK0nI,cAAcxoI;IACvB,GAAMc,IAAAA,CAAAA;AACHA,SAAKkD,WAAWsB,OAAOpM,SAASD,MAAM,WAAW4K,OAAM4E,KAAK,SAASzI,GAAAA;AACpEc,WAAK2nI,YAAYzoI,CACrB;AAAA,IAAA,GAAMc;EACH,GAEDknI,kBAAkB,WACjBlnI;AAAAA,SAAKo1F,OAAO,EACXnuF,IAAI,MACJswB,MAAM,MACNtrB,KAAK,MACL27H,SAAS,MACTC,SAAS,MACT9oI,KAAK,MACLjH,MAAM;AAEPkI,SAAK8mI,eAAe;EACpB,GACDS,SAAS,SAASp5H,MAAM0Y,OAAOuuE,MAC9B;AAAA,QAAI58B,MAAMtpD,SAAS23F;AACnB,QAAIihC,WAAW9nI,KAAK+nI,kBAAkB55H,MAAMinF;AAC5C,QAAIA,KAAKt9F,MAAM;AACdqW,WAAKgE,aAAapP,OAAMmK,YAAY46H,SAASj8H,QAAQgb,KACrD;AAAA,UAAA,CAAK1Y,KAAKgE,YAAY;AACrBhE,aAAKgE,aAAa,IAAIuG,KAAK3V,OAAMwK,SAAW8G,EAAAA,QAAAA;AAAAA,MAC5C;AAAA,IACL,OAAU;AACNlG,WAAKiE,WAAWrP,OAAMmK,YAAY46H,SAASh8H,MAAM+a,KAAAA;AACjD,WAAK1Y,KAAKiE,UAAU;AACnBjE,aAAKiE,WAAW,IAAIsG,KAAK3V,OAAMwK,SAAAA,EAAWC,QAC1C;AAAA,MAAA;AAAA,IACD;AAED,QAAIw6H,qBAAqBhoI,KAAKioI,sBAAsBzvE,IAAIzlB,cAAcylB,IAAItmB;AAC1E,QAAI/jC,KAAKiE,WAAWjE,KAAKgE,aAAaqmD,IAAIzlB,cAAc;AACvD,UAAIqiD,KAAKt9F,KACRqW,MAAKgE,aAAapP,OAAMm5D,iBAAiB/tD,KAAKiE,UAAAA,CAAW41H,oBAAoBxvE,IAAItmB,eAAe/jC,IAEhGA;AAAAA,UAAAA,MAAKiE,WAAWrP,OAAMm5D,iBAAiB/tD,KAAKgE,YAAY61H,oBAAoBxvE,IAAItmB,eAAe/jC,IAChG;AAAA,IAAA;AACDpL,IAAAA,OAAMk9D,kBAAkB9xD,IAAAA;AAAAA,EACxB,GACD85H,uBAAuB,SAAS9rE,UAAUjzD;AACzC,QAAIg/H,OAAO,EACVx/H,QAAU,KACVC,MAAQ,MACRC,KAAO,OACPC,MAAQ,QACRC,OAAS,SACTE,MAAQ,QAAA;AAET,WAAO1P,KAAK2pD,KAAKkZ,WAAW+rE,KAAKh/H,IACjC,CAAA;AAAA,EAAA,GACDs+H,kBAAkB,SAASr5H,MAAM0Y,OAAOuuE,MACvC;AAAA,QAAI0yC,WAAW9nI,KAAK+nI,kBAAkB55H,MAAMinF;AAE5C,QAAI9vF,UAAS4J,SAAS23F,WACtB;AAAA,QAAIshC,aAAa7iI,QAAOmZ,MAAO22E,KAAKnpF,IAAIzS,IAAIsuI,SAASj8H,QAAUi8H,SAASj8H,QAAQupF,KAAKnpF,IAAIzS;AAEzF,QAAI03D,OAAO53D,KAAKuD,IAAI,GAAGsrI,SAAAA;AACvBh6H,SAAK0lC,WAAWv6C,KAAKyS,IAAI,GAAGmlD,OAAO53D,KAAKkM,IAAIsiI,SAASh8H,MAAMg8H,SAASj8H,KACpE,CAAA;AAAA,EAAA,GACDu8H,iBAAiB,SAASC,WAAWxhH,OACpC;AAAA,QAAIyhH;AACJ,aAASxsI,KAAKusI,WAAW;AACxB,UAAIjzC,OAAOizC,UAAUvsI,CACrB;AAAA,UAAIqS,OAAOpL,OAAMmc,QAAQk2E,KAAKnuF,EAE9B;AAAA,UAAI6gI,WAAW9nI,KAAK+nI,kBAAkB55H,MAAMinF,IAAAA;AAC5C,UAAImzC,OAAOxlI,OAAMmpB,YAAY,IAAIxT,KAAK3V,OAAMwK,SAAW8G,EAAAA,QAAAA,CAAAA;AACvD,UAAIm0H,OAAOzlI,OAAMmpB,YAAY,IAAIxT,KAAK3V,OAAMwK,WAAWC,QAEvD,CAAA;AAAA,UAAIs6H,SAASh8H,MAAM+a,QAAQ2hH,MAAM;AAChC,YAAIC,WAAWD,OAAOV,SAASh8H;AAC/B,YAAI28H,WAAWH,gBAAgBA,iBAAiBjoI,QAAW;AAC1DioI,yBAAeG;AAAAA,QACf;AAAA,MACD,WAAUX,SAASj8H,QAAQgb,QAAQ0hH,MAAM;AACzC,YAAIG,WAAWH,OAAOT,SAASj8H;AAC/B,YAAI68H,WAAWJ,gBAAgBA,iBAAiBjoI,QAAW;AAC1DioI,yBAAeI;AAAAA,QACf;AAAA,MACD;AAAA,IACD;AACD,WAAOJ;AAAAA,EACP,GACDhB,OAAO,SAASn5H,MAAM0Y,OAAOuuE,MAAMuzC;AAClC,QAAIb,WAAW9nI,KAAK+nI,kBAAkB55H,MAAMinF;AAC5C,QAAIwzC,YAAY,MAChBC,UAAU;AAEV,QAAIF,mBAAkB;AACrBC,kBAAY,IAAIlwH,KAAAA,CAAM08E,KAAKr2F,IAAIoT,aAAaw2H,iBAC5CE,GAAAA,UAAU,IAAInwH,KAAAA,CAAM08E,KAAKr2F,IAAIqT,WAAWu2H,iBAC5C;AAAA,IAAA,OAAU;AACNC,kBAAY7lI,OAAMmK,YAAY46H,SAASj8H,QAAQgb,KAC/CgiH,GAAAA,UAAU9lI,OAAMmK,YAAY46H,SAASh8H,MAAM+a,KAAAA;AAAAA,IAC3C;AACD,QAAA,CAAK+hH,WAAW;AACfz6H,WAAKgE,aAAa,IAAIuG,KAAK3V,OAAMwK,SAAW8G,EAAAA,QAAAA;AAC5ClG,WAAKiE,WAAWrP,OAAMmK,YAAYnK,OAAMmpB,YAAY/d,KAAKgE,UAAe21H,KAAAA,SAASh8H,MAAMg8H,SAASj8H,MACpG;AAAA,IAAA,YAAeg9H,SAAS;AACpB16H,WAAKiE,WAAW,IAAIsG,KAAK3V,OAAMwK,SAAAA,EAAWC,QAC1CW;AAAAA,WAAKgE,aAAapP,OAAMmK,YAAYnK,OAAMmpB,YAAY/d,KAAKiE,QAAa01H,KAAAA,SAASh8H,MAAMg8H,SAASj8H,MAAAA;AAAAA,IACpG,OAAU;AACNsC,WAAKgE,aAAay2H;AAClBz6H,WAAKiE,WAAWy2H;AAAAA,IAChB;AAAA,EACD,GACDd,mBAAmB,SAAS7uH,IAAGk8E,MAAAA;AAC9B,QAAIvpF,QAAQupF,KAAK0zC,UAAU1zC,KAAK0zC,WAAW/lI,OAAMmpB,YAAYhT,GAAE/G,UAAAA;AAC/D,QAAIrG,MAAMspF,KAAK2zC,UAAU3zC,KAAK2zC,WAAWhmI,OAAMmpB,YAAYhT,GAAE9G,QAAAA;AAC7D,WAAO,EACNvG,OACAC,IAED;AAAA,EAAA,GACDk9H,wBAAwB,SAASC,QAAQC,QAAAA;AACxC,QAAIroG,KAAKooG,OAAOzvI,IAAI0vI,OAAO1vI,GAC1BsnC,KAAKmoG,OAAO5vI,IAAI6vI,OAAO7vI;AACxB,WAAOC,KAAKyW,KAAK8wB,KAAKA,KAAKC,KAAKA,EAAAA;AAAAA,EAChC,GACDqoG,YAAY,SAAS/nF,GACpB;AAAA,WAAA,CAAQjnD,MAAMizH,WAAWhsE,CAAOgoF,CAAAA,KAAAA,SAAShoF;EACzC,GAEDqmF,eAAe,SAASvoI,GACvB;AAAA,QAAIc,KAAKo1F,KAAKi0C,YAAY;AACzB,UAAIp9H,MAAMk5B,yBAAoCjmC,GAAG6D,OAAMiM,UAAAA;AAEvD,UAAIs6H,KAAKtpI,KAAKo1F,KAAKi0C,WAAWzB,SAC7B2B,KAAKvpI,KAAKo1F,KAAKi0C,WAAWxB;AAE3B,UAAKnvH,KAAK8wH,QAAQxpI,KAAKo1F,KAAK3Q,YAAY,MACtCzkF,KAAKmpI,WAAWG,EAAAA,KAAOtpI,KAAKmpI,WAAWI,OAAOvpI,KAAKgpI,uBAAuB,EAC1ExvI,GAAG8vI,IACHjwI,GAAGkwI,MACDt9H,GAAO,IAAA,IAAK;AACfjM,aAAKypI,WAAWvqI,CAAAA;AAAAA,MAChB;AAAA,IACD;AAED,QAAIk2F,OAAOp1F,KAAKo1F;AAEhB,QAAIA,KAAK79D,MAAM;AACd,UAAA,CAAKhtB,aAAQvK,MAAM,IAClB;AAEDA,WAAK0pI,gBAAgBxqI,CAErB;AAAA,IAAA;AAAA,EACD,GAEDyqI,sBAAsB,SAAS9iH,OAAO5f,IAAIswB,MAAM69D,MAAMl2F,GAAGypI,mBACxD;AAAA,QAAIx6H,OAAOpL,OAAMmc,QAAQjY;AACzB,QAAI4wF,WAAW90F,OAAMyP,MAAM,CAAE,GAAErE;AAC/B,QAAI9J,QAAOtB,OAAMyP,MAAM,CAAE,GAAErE;AAC3BnO,SAAKsqB,UAAUiN,IAAMt3B,EAAAA,MAAMD,MAAM,CAACqE,OAAMwiB,OAAOuuE,MAAMuzC;AACrD5lI,IAAAA,OAAMyP,MAAMrE,MAAM9J,OAAM,IAAA;AAExBtB,IAAAA,OAAMgF,UAAU,cAAc,CAACoG,KAAKlH,IAAIswB,MAAMlzB,OAAMwzF,UAAU34F,CAAAA,CAAAA;AAC9D6D,IAAAA,OAAMyP,MAAMrE,MAAM9J,OAAM,IAAA;AACxBtB,IAAAA,OAAMk5B,YAAYh1B;EAClB,GAEDyiI,iBAAiB,SAASxqI,GACzB;AAAA,QAAIk2F,OAAOp1F,KAAKo1F;AAChB,QAAI9vF,UAAS4J,SAAS23F,WAAAA;AACtB,QAAIzR,KAAK79D,MAAM;AACd,UAAItrB,MAAMk5B,yBAAoCjmC,GAAGgQ,SAASF,UAAAA;AAC1D,UAAIomF,KAAKnpF,OAAOmpF,KAAKnpF,IAAIzS,KAAKyS,IAAIzS,EACjC;AAED47F,WAAKnpF,MAAMA;AAEX,UAAI29H,YAAY7mI,OAAMmK,YAAYjB,IAAIzS;AACtC,UAAKowI,CAAAA,aAAazvI,MAAMyvI,UAAUv/H,QACjC,CAAA,EAAA;AAGD,UAAIwc,QAAQ5a,IAAIzS,IAAI47F,KAAKwyC;AACzB,UAAIz5H,OAAOpL,OAAMmc,QAAQk2E,KAAKnuF,EAC9B;AAAA,UAAIjH,KAAKsqB,UAAU8qE,KAAK79D,IAAO,GAAA;AAC9B,YAAI69D,KAAK79D,SAASjyB,QAAOquC,UAAUzK,MAAM;AACxC,cAAI2gG,WAAW,CAAA;AAEf,cAAI7pI,KAAK8pI,eAAAA,GAAkB;AAC1B,gBAAIC,mBAAmBhnI,OAAMy6B,iBAAAA;AAC7B,gBAAIusG,iBAAiB9sI,QAAQm4F,KAAKnuF,EAAO,KAAA,GAAG;AAC3C4iI,yBAAW7pI,KAAK8mI;AAAAA,YAChB;AAAA,UACD;AAED,cAAIkD,cAAc;AAClB,cAAIjnI,OAAM4oC,cAAcx9B,IAAAA,KAASpL,OAAMuC,OAAOsmC,cAAc;AAC3D,gBAAIq+F,cAAc,CAAA;AAClBA,wBAAY70C,KAAKnuF,MAAMmmD,KAAWgoC,IAAAA;AAClC40C,0BAAc;AACdH,uBAAWtjF,MAAY0jF,aAAajqI,KAAK8mI,YAAAA;AAAAA,UACzC;AAED,cAAI2B,WAAWzoI,KAAKooI,gBAAgByB,UAAUhjH,KAAAA;AAC9C,cAAI4hH,aAAapoI,QAAW;AAC3BwmB,oBAAQ4hH;AAAAA,UACR;AACDzoI,eAAK2pI,qBAAqB9iH,OAAOuuE,KAAKnuF,IAAImuF,KAAK79D,MAAM69D,MAAMl2F,CAE3D;AAAA,cAAIypI;AACJ,cAAIF,aAAapoI,QAAW;AAI3B,kBAAM6pI,cAAcnnI,OAAMmpB,YAAYkpE,KAAKr2F,IAAIoT,UAAAA;AAC/C,kBAAMg4H,YAAYpnI,OAAMmpB,YAAYkpE,KAAKr2F,IAAIqT,QAE7C;AAAA,gBAAIgjF,KAAKg1C,kBAAkB/pI,QAAU;AACpC,oBAAM5G,QAAQ0wI,YAAYD;AAC1B,oBAAMG,UAAUj1C,KAAKwyC,UAAUsC;AAC/B90C,mBAAKg1C,gBAAgBC,UAAU5wI;AAAAA,YAC/B;AACD,kBAAMgzH,WAAWnzH,KAAKkM,IAAI2kI,YAAYD,WAAAA;AACtC,gBAAII,QAAQJ,cAAczd,WAAWr3B,KAAKg1C;AAG1C,kBAAMG,YAAYxnI,OAAMmK,YAAYo9H;AACpC3B,gCAAoBiB,YAAYW;AAAAA,UAChC;AAED,mBAASzuI,KAAK+tI,UAAU;AACvB,gBAAIW,YAAYX,SAAS/tI;AACzB,gBAAGkuI,eAAeQ,UAAUvjI,MAAMmuF,KAAKnuF,IAAG;AACzClE,cAAAA,OAAM8yD,YAAY;AAAA,YAClB;AACD71D,iBAAK2pI,qBAAqB9iH,OAAO2jH,UAAUvjI,IAAIujI,UAAUjzG,MAAMizG,WAAWtrI,GAAGypI,iBAC7E;AAAA,UAAA;AACD5lI,UAAAA,OAAM8yD,YAAY;AAAA,QACxB,OAAY;AAEN71D,eAAK2pI,qBAAqB9iH,OAAOuuE,KAAKnuF,IAAImuF,KAAK79D,MAAM69D,MAAMl2F,CAC3D;AAAA,QAAA;AACD6D,QAAAA,OAAM66D,gBAAgBw3B,KAAKnuF,EAC3B;AAAA,MAAA;AAAA,IAED;AAAA,EACD,GAEDygI,eAAe,SAASxoI,GAAGqpG,KAG1B;AAAA,QAAIrpG,EAAElE,UAAU,KAAKkE,EAAElE,WAAWqF,OACjC;AAED,QAAIiF,UAAS4J,SAAS23F;AACtB,QAAI5/F,KAAKlE,OAAMisB,OAAO9vB,CACtB;AAAA,QAAIiP,OAAO;AACX,QAAIpL,OAAM0d,aAAaxZ,EAAK,GAAA;AAC3BkH,aAAOpL,OAAMmc,QAAQjY,EACrB;AAAA,IAAA;AAED,QAAIlE,OAAMqrB,WAAWjgB,IAASnO,KAAAA,KAAKo1F,KAAK79D,KAAM;AAE9Cv3B,SAAKknI,iBAEL3+B;AAAAA,UAAMA,QAAQrpG,EAAEI,UAAUJ,EAAEK;AAE5B,QAAIxC,YAAYugG,aAAwBiL,GACxC;AAAA,QAAInT,OAAOp1F,KAAKyqI,eAAe1tI,WAAWwrG,GAAAA;AAE1C,QAAKxrG,CAAAA,aAAAA,CAAcq4F,MAAM;AACxB,UAAImT,IAAIhwG,WACP,QAAOyH,KAAK0nI,cAAcxoI,GAAGqpG,IAAIhwG,UAAAA;AAAAA,UAEjC;AAAA,IACD;AAED,SAAK68F,MAAM;AACV,UAAIryF,OAAMoF,WAAW,aAAA,KAAkBpF,OAAMgF,UAAU,eAAe,CAAChL,UAAUO,MAAM,GAAA,EAAK,MAAM;AACjG,YAAIirG,IAAIhwG,WACP,QAAOyH,KAAK0nI,cAAcxoI,GAAGqpG,IAAIhwG,UAAAA;AAAAA,MAElC;AAAA,IACL,OAAU;AACN,UAAI68F,KAAK79D,QAAQ69D,KAAK79D,QAAQjyB,QAAOquC,UAAUrwC,UAAUgC,QAAO,UAAU8vF,KAAK79D,IAAAA,GAAO;AACrFtwB,aAAKlE,OAAMisB,OAAOu5E,GAClBp6F;AAAAA,eAAOpL,OAAMsB,KAAKtB,OAAMmc,QAAQjY,EAAAA,KAAO,CAAA,CAAA;AAEvC,YAAIlE,OAAMqrB,WAAWjgB,IAAO,GAAA;AAC3BnO,eAAKknI,iBAAAA;AACL,iBAAO;AAAA,QACP;AAED,YAAKnkI,OAAM4oC,cAAcx9B,IAAAA,KAAAA,EAAWA,KAAKmU,oBAAoB,UAAA,CAAWhd,QAAOsmC,gBAAiBwpD,KAAK79D,QAAQjyB,QAAOquC,UAAUE,UAAU;AACvI7zC,eAAKknI,iBAAAA;AACL;AAAA,QACA;AAED9xC,aAAKnuF,KAAKA;AACV,YAAIgF,MAAMk5B,yBAAoCjmC,GAAG6D,OAAMiM,UAAAA;AAEvDomF,aAAKwyC,UAAU37H,IAAIzS;AACnB47F,aAAKyyC,UAAU57H,IAAI5S;AACnB+7F,aAAKr2F,MAAMoP;AACXnO,aAAKo1F,KAAKi0C,aAAaj0C;AACvBp1F,aAAKo1F,KAAK3Q,YAAY/rE,KAAK8wH,IAAAA;AAAAA,MAE3B,MACAxpI,MAAKknI;IACN;AAAA,EACD,GACDwD,qBAAqB,SAASv8H,MAAMinF,MAAAA;AACnC,QAAI9vF,UAAS4J,SAAS23F;AACtB,QAAI39F,OAAOnG,OAAMsZ,SAAWnT,EAAAA,MAC3BuW,OAAO1c,OAAMsZ,SAAWoD,EAAAA;AACzB,SAAKna,QAAOwuC,iBAAiB;AAC5B5qC,aAAO;AACPuW,aAAOna,QAAO+uC;AAAAA,IACd;AAED,aAASs2F,SAASx8H,OACjB;AAAA,UAAA,CAAKpL,OAAMuC,OAAO6sC,kBACjB;AACD,UAAI7sC,UAAS4J,SAAS23F,WACtB;AAAA,UAAA,CAAK9jG,OAAMw2D,WAAWprD,MAAKgE,YAAY9R,QAAW8N,KACjDA,EAAAA,CAAAA,MAAKgE,aAAapP,OAAMm5D,iBAAiB,EACxC/pD,YAAYhE,MAAKgE,YACjBgqD,UAAW,IACXjzD,MAAM5D,QAAO4sC,eACb/jC,MAAMA,MAAAA,CAAAA;AAAAA,IAER;AAED,aAASy8H,OAAOz8H;AACf,UAAKpL,CAAAA,OAAMuC,OAAO6sC,kBACjB;AACD,UAAI7sC,UAAS4J,SAAS23F,WAAAA;AACtB,WAAK9jG,OAAMw2D,WAAW,IAAI7gD,KAAKvK,MAAKiE,WAAW,CAAA,GAAI/R,QAAW8N,KAAAA,EAC7DA,CAAAA,MAAKiE,WAAWrP,OAAMm5D,iBAAiB,EACtC/pD,YAAYhE,MAAKiE,UACjB+pD,UAAU,GACVjzD,MAAM5D,QAAO4sC,eACb/jC,MAAMA,MAER,CAAA;AAAA,IAAA;AAED,QAAIinF,KAAK79D,QAAQjyB,QAAOquC,UAAUC,QAAQ;AACzC,UAAIwhD,KAAKt9F,MAAM;AACdqW,aAAKgE,aAAapP,OAAMk0F,UAAU,EAAC5kF,MAAMlE,KAAKgE,YAAYjJ,MAAYuW,KACtEkrH,CAAAA;AAAAA,iBAASx8H;MACd,OAAW;AACNA,aAAKiE,WAAWrP,OAAMk0F,UAAU,EAAC5kF,MAAMlE,KAAKiE,UAAUlJ,MAAYuW;AAClEmrH,eAAOz8H,IAAAA;AAAAA,MACP;AAAA,IACD,WAAUinF,KAAK79D,QAAQjyB,QAAOquC,UAAUzK,MAAM;AAC9C/6B,WAAKgE,aAAapP,OAAMk0F,UAAU,EAAC5kF,MAAMlE,KAAKgE,YAAYjJ,MAAYuW,KACtEkrH,CAAAA;AAAAA,eAASx8H,IACTA;AAAAA,WAAKiE,WAAWrP,OAAMm5D,iBAAiB/tD;IACvC;AAAA,EACD,GACD08H,oBAAoB,SAAS18H,MAAMinF,MAClC;AAAA,QAAI9vF,UAAS4J,SAAS23F;AACtB,QAAIzR,OAAOA,QAAQ,EAAC79D,MAAMjyB,QAAOquC,UAAUzK,KAAAA;AAE3C,QAAIksD,KAAK79D,QAAQjyB,QAAOquC,UAAUC,QAAQ;AACzC,UAAIwhD,KAAKt9F,MAAM;AACdqW,aAAKgE,aAAapP,OAAMwrF,mBAAmB,EAACl8E,MAAMlE,KAAKgE,YAAY6Z,KAAK,UAAU7d,KACvF,CAAA;AAAA,MAAA,OAAW;AACNA,aAAKiE,WAAWrP,OAAMwrF,mBAAmB,EAACl8E,MAAMlE,KAAKiE,UAAU4Z,KAAK,QAAQ7d,KAAMA,CAAAA;AAAAA,MAClF;AAAA,IACD,WAAUinF,KAAK79D,QAAQjyB,QAAOquC,UAAUzK,MAAM;AAC9CnmC,MAAAA,OAAMm9D,oBAAoB/xD,IAAAA;AAAAA,IAC1B;AAAA,EACD,GAED28H,oBAAoB,SAASx8G,QAAQhpB,SAAQ8vF,MAAMl2F,GAClD;AAAA,QAAIiP,OAAOpL,OAAMmc,QAAQoP;AAEzB,QAAIhpB,QAAO8U,aAAa9U,QAAO6sC,mBAAmB;AACjDnyC,WAAK6qI,mBAAmB18H,MAAMinF;IAC9B;AAEDp1F,SAAK0qI,oBAAoBv8H,MAAMinF,IAE/B;AAAA,QAAA,CAAKp1F,KAAK+qI,WAAW,iBAAiB31C,KAAK79D,MAAM,CAACjJ,QAAQ8mE,KAAK79D,MAAMx0B,OAAMsB,KAAK+wF,KAAKr2F,GAAAA,GAAMG,KAAK;AAE/Fc,WAAKknI,iBACL;AAAA,UAAI54G,UAAU8mE,KAAKnuF,IAAI;AACtBmuF,aAAKr2F,IAAIisI,eAAe;AACxBjoI,QAAAA,OAAMyP,MAAMrE,MAAMinF,KAAKr2F,KAAK,IAC5B;AAAA,MAAA;AAGDgE,MAAAA,OAAMk5B,YAAY9tB,KAAKlH;IAC3B,OAAU;AACN,UAAIykC,UAAUpd;AAEdvrB,MAAAA,OAAMk9D,kBAAkB9xD,IAExBnO;AAAAA,WAAKknI;AACLnkI,MAAAA,OAAMouB,WAAWhjB,KAAKlH,EAAAA;AACtBjH,WAAK+qI,WAAW,gBAAgB31C,KAAK79D,MAAM,CAACmU,SAAS0pD,KAAK79D,MAAMr4B;IAChE;AAAA,EAED,GAEDyoI,aAAa,SAASzoI,GAAAA;AAErB,QAAIk2F,OAAOp1F,KAAKo1F;AAChB,QAAIA,KAAK79D,QAAQ69D,KAAKnuF,IAAI;AACzB,UAAI3B,UAAS4J,SAAS23F;AAEtB,UAAI14F,OAAOpL,OAAMmc,QAAQk2E,KAAKnuF,EAAAA;AAC9B,UAAI6/H,eAAe9mI,KAAK8mI;AAExB,UAAImE,qBAAqB;AACzB,UAAIC,YAAY;AAChB,UAAI91C,KAAK79D,SAASjyB,QAAOquC,UAAUzK,MAAM;AACxC,YAAKnmC,OAAM4oC,cAAcx9B,SAAS7I,QAAOsmC,gBAAkB5rC,KAAK8pI,eAAAA,GAAmB;AAClFmB,+BAAqB;AACrBC,sBAAYpqH,OAAOC,KAAK+lH,YAAc/qI,EAAAA;AAAAA,QACtC;AAAA,MACD;AAED,UAAIovI,aAAa,SAASA,cACzB;AAAA,YAAGF,oBAAmB;AACrB,mBAASnvI,KAAKgrI,cAAc;AAE3B,gBAAIA,aAAahrI,CAAGmL,EAAAA,MAAMmuF,KAAKnuF,IAAG;AACjCjH,mBAAK8qI,mBAAmBhE,aAAahrI,CAAGmL,EAAAA,IAAI3B,SAAQwhI,aAAahrI,CAAAA,GAAIoD,CACrE;AAAA,YAAA;AAAA,UACD;AAAA,QACD;AACDc,aAAK8qI,mBAAmB11C,KAAKnuF,IAAI3B,SAAQ8vF,MAAMl2F,CAAAA;AAAAA,MAEpD;AAEI,UAAG+rI,sBAAsBC,YAAY,IAAG;AACvCnoI,QAAAA,OAAMyrC,aAAY,WACjB28F;AAAAA,qBAAWtvI,KAAKmE,IACtB;AAAA,QAAA,GAAO2H,KAAK3H,IACZ,CAAA;AAAA,MAAA,OAAS;AACJmrI,mBAAWtvI,KAAKmE,IAAAA;AAAAA,MAChB;AAAA,IAED;AACDA,SAAKknI,iBACL;AAAA,EAAA,GACDuD,gBAAgB,SAAS1tI,WAAWwE,IACnC;AAAA,QAAI+D,UAAS4J,SAAS23F,WACtB;AAAA,QAAIz/B,QAAQ9hE,QAAOquC;AACnB,QAAIy3F,WAAWruI,aAAa,IAAIO,MAAM,GAAA;AACtC,QAAI6C,YAAYirI,QAAQ,CAAA;AACxB,QAAIh2C,OAAO,EAAC79D,MAAM,MAAMz/B,MAAM,KAAA;AAC9B,YAAQqI,WACP;AAAA,MAAA,KAAK;AAAA,MACL,KAAK;AACJi1F,aAAK79D,OAAO6vC,MAAMl+B;AAClB;AAAA,MACD,KAAK;AACJksD,aAAK79D,OAAO6vC,MAAMxzB;AAElB,YAAIy3F,eAAe9pI,GAAGnH,aAAa,oBAEnC;AAAA,YAAIixI,gBAAgB,cAAc;AACjCj2C,eAAKt9F,OAAO;AAAA,QAClB,OAAY;AACNs9F,eAAKt9F,OAAO;AAAA,QACZ;AACD;AAAA,MACD,KAAK;AACJs9F,aAAK79D,OAAO6vC,MAAMvzB;AAClB;AAAA,MACD,KAAK;AAAA,MACL,KAAK;AACJuhD,aAAK79D,OAAO6vC,MAAM9jE;AAClB;AAAA,MACD;AACC8xF,eAAO;AACP;AAAA,IAAA;AAEF,WAAOA;AAAAA,EAEP,GAEDq0C,YAAY,SAASvqI,GACpB;AAAA,QAAIk2F,OAAOp1F,KAAKo1F,OAAOp1F,KAAKo1F,KAAKi0C;AAAAA,WAC1Bj0C,KAAKi0C;AAEZ,QAAI7wE,MAAMtpD,SAAS23F,WACnB;AAAA,QAAI5/F,KAAKmuF,KAAKnuF;AAEd,QAAA,CAAKuxD,IAAI,UAAU48B,KAAK79D,IAAUx0B,KAAAA,CAAAA,OAAMgF,UAAU,gBAAgB,CAACd,IAAImuF,KAAK79D,MAAMr4B,CAAQc,CAAAA,KAAAA,CAAAA,KAAK+qI,WAAW,gBAAgB31C,KAAK79D,MAAM,CAACtwB,IAAImuF,KAAK79D,MAAMr4B,CAAK,CAAA,GAAA;AACzJc,WAAKknI,iBAAAA;AAAAA,IACT,OAAU;AAAA,aACC9xC,KAAKi0C;AACZ,UAAIl7H,OAAOpL,OAAMmc,QAAQjY,EAAAA;AACzB,UAAIlE,OAAMqrB,WAAWjgB,OAAM;AAC1BnO,aAAKknI;AACL;AAAA,MACA;AACD,UAAIlnI,KAAK8pI,eAAkB,GAAA;AAE1B,YAAIC,mBAAmBhnI,OAAMy6B;AAC7B,YAAIusG,iBAAiB9sI,QAAQm4F,KAAKnuF,EAAAA,KAAO,GAAG;AAC3Ck9D,kBAAgB4lE,kBAAkBhnI,OAAM4E,KAAK,SAAS2mB;AACrD,gBAAIg9G,eAAevoI,OAAMmc,QAAQoP,MAAAA;AACjC,gBAAIvrB,OAAM4oC,cAAc2/F,YAAAA,KAAiBvoI,OAAMuC,OAAOsmC,gBAAgBwpD,KAAK79D,QAAQihC,IAAI7kB,UAAUzK,MAAM;AACtGlpC,mBAAKurI,2BAA2BD,aAAarkI,EAC7C;AAAA,YAAA;AACDjH,iBAAK8mI,aAAax4G,MAAAA,IAAUvrB,OAAMyP,MAAM,EACvCvL,IAAIqkI,aAAarkI,IACjBlI,KAAKgE,OAAMsB,KAAKinI,YAAAA,EAAAA,GACdtrI,KAAKo1F,IACf;AAAA,UAAA,GAASp1F,IACH,CAAA;AAAA,QAAA;AAAA,MACD;AAED,UAAI+C,OAAM4oC,cAAcx9B,IAAAA,KAASpL,OAAMuC,OAAOsmC,gBAAgBwpD,KAAK79D,QAAQihC,IAAI7kB,UAAUzK,MAAM;AAC9FlpC,aAAKurI,2BAA2Bp9H,KAAKlH,EAAAA;AAAAA,MACrC;AACDlE,MAAAA,OAAMgF,UAAU,mBAAmB;IACnC;AAAA,EAED,GACDgjI,YAAY,SAAS1D,OAAO9vG,MAAMouE;AACjC5iG,IAAAA,OAAMqqC,OAAOptC,KAAK0gD,QAAQ2mF,KAAQ,GAAA,oBAAoBA,QAAQ,GAE9D;AAAA,QAAImE,UAAUxrI,KAAK0gD,QAAQ2mF,OAAO9vG,IAElCx0B;AAAAA,IAAAA,OAAMqqC,OAAOo+F,SAAS,8BAA8Bj0G,OAAO;AAC3Dx0B,IAAAA,OAAMqqC,OAAOu4D,QAAQ,yBAGrB;AAAA,QAAA,CAAK5iG,OAAMoF,WAAWqjI,OAAAA,EACrB,QAAO;AAER,WAAOzoI,OAAMgF,UAAUyjI,SAAS7lC,MAAAA;AAAAA,EAChC,GAED8lC,kBAAkB,SAASt9H;AAC1B,QAAIu9H,aAAa1rI,KAAKo1F;AACtB,QAAI9vF,UAAS4J,SAAS23F,WACtB;AAAA,QAAA,CAAK6kC,YAAY;AAChBA,mBAAa,EAACn0G,MAAMjyB,QAAOquC,UAAUzK,KACrC;AAAA,IAAA;AACDlpC,SAAK0qI,oBAAoBv8H,MAAMu9H,UAC/B;AAAA,EAAA,GACDz8H,YAAY,WACXjP;AAAAA,SAAKkD,WAAW0C,UAChB;AAAA,EAAA,GACDkkI,gBAAgB,WAAA;AACf,WAAO/mI,OAAMuC,OAAOgyC,iBAAoBv0C,CAAAA,EAAAA,OAAMy6B,oBAAoBz6B,OAAMy6B,iBAAAA,EAAmBzhC,SAAS;AAAA,EACpG,GACDwvI,4BAA4B,SAASI,WACpC5oI;AAAAA,IAAAA,OAAM6Q,SAAS,SAAStV,OAAAA;AACvB0B,WAAK8mI,aAAaxoI,MAAM2I,MAAMlE,OAAMyP,MAAM,EACzCvL,IAAI3I,MAAM2I,IACVlI,KAAKgE,OAAMsB,KAAK/F,KACd0B,EAAAA,GAAAA,KAAKo1F,IACZ;AAAA,IAAA,GAAMu2C,WAAW3rI,IACd;AAAA,EAAA,EAAA;AAEH;AAEA,SAAS4rI,cACR;AAAA,MAAIz2C;AACJ,SAAO,EACNlxD,QAAQ,SAAS/0B,UAAAA;AAChBA,aAAS28H,iBAAiB,SAAS19H,MAClCgnF;AAAAA,iBAAWs2C,iBAAiBt9H,IAAAA;AAAAA,IAChC;AAAA,EAEG,GACDmvC,MAAM,SAASpuC,UAAUnM,QAAAA;AACxBoyF,iBAAa0xC,cAAc33H,UAAUnM,MAErCmM;AAAAA,aAASimF,aAAaA;AACtB,WAAOA,WAAW73C,KAAKv6C;EACvB,GACDkM,YAAY;AACX,QAAIkmF,YAAY;AACfA,iBAAWlmF,WACXkmF;AAAAA,mBAAa;AAAA,IACb;AAAA,EACD,EAAA;AAEH;AAEA,MAAe22C,UAAA,EACdjF,eAAe+E,YChoBhB;AAAA,IAAIG,eAAe,SAAS78H,UAAUnM,QAAAA;AACrC,MAAIipI,eACHC,mBACAC,yBACAC,mBACAC,yBACAC,sBAAsB,IACtBC,oBAAoB;AAErB,WAASC,cACR;AAAA,WAAO,EACNllG,gBAAiB8kG,mBACjB9U,gBAAiB4U,mBACjB7U,iBAAkBgV,yBAClB3U,eAAgByU,yBAChB3U,mBAAoByU,cAErB;AAAA,EAAA;AAED,MAAI96F,YAAWnuC,OAAMc;AAErB,MAAID,QAAQstC,UAASptC,WAAW;AAChC,MAAIo/C,OAAMhS,UAASptC,WAAW,KAE9BF;AAAAA,QAAMG,iBAAiB,YAAYwoI,WAAAA;AAEnC,MAAIC,eAAe,mBAClBC,aAAa,iBACbC,mBAAmB,oBACnBC,0BAA0B;AAE3B,MAAIjmE,MAAM,IAAIxjB,KAAIh0C,SAAS4wG,YAAY,EACtCr6D,aAAc,GACdV,oBAAqB,IACrBG,oBAAoBniD,OAAMgC,OAC1B5D,UAAU,MAAMurI,kBAChB9hH,gBAAgB;AAGjB87C,MAAIl/D,YAAY,qBAAqBzE,OAAM4E,KAAK,SAAS5I,KAAIG,GAC5D;AAAA,QAAII,SAAUJ,EAAEI,UAAQJ,EAAEK;AAC1BqtI,kBAAAA;AACA,QAAG7pI,OAAMwK,SAAS,UAAYm+B,EAAAA,QAC7B,QAAO;AAER,QAAG/d,gBAA2BruB,QAAQotI,gBAAkB,GAAA;AACvD,UAAG/+G,gBAA2BruB,QAAQktI,YACrCJ,EAAAA,2BAA0B;AAE3B,UAAIthF,MAAM/nD,OAAMisB,OAAO9vB,CACvBitI;AAAAA,0BAAoBrhF;AAEpB,UAAI5xC,KAAInW,OAAMmc,QAAQ4rC,GAAAA;AACtB,UAAG/nD,OAAMqrB,WAAWlV,EAAAA,GAAG;AACtB0zH,sBACA;AAAA,eAAO;AAAA,MACP;AAED5sI,WAAK6sI,aAAa,EACjBrzI,GAAGktE,IAAIphE,OAAO6+C,uBAAuB3qD,IAAIktE,IAAIphE,OAAO6+C,uBAAuB1qD,QAAM,GACjFJ,GAAGqtE,IAAIphE,OAAO6+C,uBAAuB9qD,IAAIqtE,IAAIphE,OAAO6+C,uBAAuBzqD,SAAO;AAGnF,aAAO;AAAA,IACV,OAAO;AACJ,aAAO;AAAA,IACP;AAAA,EAEH,GAAIsG,IAAAA,CAAAA;AAEH0mE,MAAIl/D,YAAY,oBAAoBzE,OAAM4E,KAAK,SAAS5I,KAAIG;AAC3D,QAAG6D,OAAMuC,OAAO0hC,OAAO;AACtBjkC,MAAAA,OAAMwyD,YAAAA;AAAAA,IACN;AACDu3E,qBAAiBpmE,IAAIphE,OAAO+yB,MAAAA;AAAAA,EAC9B,GAAIr4B,IAEH,CAAA;AAAA,WAAS+sI;AACR,QAAI1xI,OAAO0H,OAAMgC;AACjB,WAAO,EAAEhN,OAAOsD,KAAKtC,aAAaf,QAAQqD,KAAKrC,aAAAA;AAAAA,EAC/C;AACD,WAASg0I,cAAe30G,SACvB;AAAA,QAAI5+B,QAAQ,GAAGC,SAAS;AACxB,QAAG2+B,SAAO;AACT5+B,cAAQ4+B,QAAOt/B,eAAe;AAC9BW,eAAS2+B,QAAOr/B,gBAAgB;AAAA,IAChC;AACD,WAAO,EAAES,OAAcC,OAAQA;AAAAA,EAC/B;AAED,WAAS4sD,YAAYpnD,GAAGm5B,SAAAA;AACvB,QAAI4wG,SAASviE,IAAIpgB,YAAYpnD,CAAAA;AAE7B,QAAI+tI,aAAaD,cAAc30G,OAAAA;AAC/B,QAAI60G,eAAeH,eAAAA;AAEnB,QAAIjoG,UAAU/hC,OAAMuC,OAAOy/B,oBAAoBsnG;AAC/C,QAAIrnG,UAAUjiC,OAAMuC,OAAO2/B,oBAAoBonG;AAE/C,QAAIv4B,aAAa/wG,OAAMuC,OAAO20G,eAAeqyB;AAG7C,QAAIa,eAAepqI,OAAMsM,WAAWpX,sBAAwBoB,EAAAA,IAAIZ,OAAOmY;AAEvE,QAAIjN,WAAW,EACdtK,GAAG4vI,OAAO5vI,IAAI2rC,SACdxrC,GAAGyvI,OAAOzvI,IAAIsrC,SACd9sC,QAAQixI,OAAO5vI,IAAI4zI,WAAWvzI,SAASsrC,UAAU8uE,YACjD/7G,OAAOkxI,OAAOzvI,IAAIyzI,WAAWxzI,QAAQqrC,UAAUgvE;AAGhD,QAAGnwG,SAAS3L,SAASk1I,aAAal1I,SAASm1I,cAAa;AACvDxpI,eAAStK,IAAI6zI,aAAal1I,SAASm1I,eAAeF,WAAWvzI,SAASsrC;AAAAA,IACtE;AAED,QAAGrhC,SAAS5L,QAAQm1I,aAAan1I,OAAM;AACtC4L,eAASnK,IAAI0zI,aAAan1I,QAAQk1I,WAAWxzI,QAAQqrC;AAAAA,IACrD;AACD,WAAOnhC;AAAAA,EACP;AAED+iE,MAAIl/D,YAAY,cAAczE,OAAM4E,KAAK,SAAS5I,KAAIG,GACrD;AAAA,QAAI0mH,KAAKl/C,IAAIphE;AACb,QAAI2G,MAAMq6C,YAAYpnD,GAAG0mH,GAAGvtF,MAC5B+0G;AAAAA,kBAAcxnB,GAAGvtF,QAAQpsB,GAAAA;AACzB,QAAIohI,UAAAA,CAAAA,CAAY1/G,gBAA2BzuB,GAAGytI;AAE9C,QAAIW,aAAarB;AACjB,QAAIsB,cAAcvB;AAClB,QAAIwB,cAActB;AAElB,QAAIuB,OAAO1qI,OAAMisB,OAAO9vB,CACvBupD,GAAAA,WAAW;AAGZ,QAAI3iB,cAAcC,cAAyB7mC;AAE3C,QAAIwuI,YAAY/4G,UAAqBmR,aAAa/iC,OAAMgC,KAAAA;AACxD,SAAI2oI,WAAU;AACbL,gBAAU;AACVI,aAAO;AAAA,IACP;AAED,QAAGJ,SAAQ;AAEV5kF,iBAAY96B,CAAAA,gBAA2BzuB,GAAGutI,UAC1CY;AAAAA,gBAAAA,CAAAA,CAAYI;AAAAA,IACZ;AAEDxB,wBAAoBwB;AACpBzB,oBAAgBqB;AAChBnB,8BAA0BzjF;AAE1B,QAAG4kF,SAAQ;AAEV,UAAIzzI,OAAO+zB,gBAA2BzuB,GAAGytI,uBAAAA;AAEzC,YAAM7P,QAAQljI,KAAKqE,cAAc,IAAIyuI,gBACrC,EAAA;AAAA,UAAG5P,OAAM;AACR,cAAM6Q,YAAYC,wBAAmC9Q,OAAO5tH,SAAS8wG;AACrEhgH,aAAK6tI,WAAW,EACfr0I,GAAGm0I,UAAUn0I,IAAIsjI,MAAM/jI,cAAY,GACnCM,GAAGs0I,UAAUt0I,IAAIyjI,MAAM9jI,eAAa,EAAA;AAAA,MAErC;AAAA,IAEJ,OAAO;AACJgH,WAAK6tI,WAAW1oG,yBAAoCjmC,GAAGgQ,SAASF,UAAAA;AAChE,UAAGjM,OAAM00C,IAAIa,QAAO;AACnBt4C,aAAK6tI,SAASx0I,KAAKZ,OAAOmY;AAAAA,MAC1B;AAAA,IACD;AAED,QAAIk9H,gBAAkBP,EAAAA,eAAeF,WAAWC,cAAcG,QAAQD,eAAe/kF;AACrF,QAAGqlF,eAAc;AAChB,UAAGR,WACFvqI,CAAAA,OAAMk5B,YAAYqxG,YAAY,KAAA;AAC/B,UAAGG,KACF1qI,CAAAA,OAAMk5B,YAAYwxG,MAAM,KACzB;AAAA,IAAA;AAED,QAAGK,eAAc;AAChBhB,uBAAiBlnB,GAAGvtF,MAAAA;AAAAA,IACpB;AAED01G,sBAAkB/tI,KAAK6sI,WAAWrzI,GAAGwG,KAAK6sI,WAAWxzI,GAAG2G,KAAK6tI,SAASr0I,GAAGwG,KAAK6tI,SAASx0I;AAEvF,WAAO;AAAA,EACT,GAAI2G,IAAAA,CAAAA;AAGH0mE,MAAIl/D,YAAY,aAAazE,OAAM4E,KAAK;AACvC,QAAIytF,OAAOm3C;AAEX,QAAGn3C,KAAK/tD,kBAAkB+tD,KAAKiiC,kBAAkBjiC,KAAK/tD,kBAAkB+tD,KAAKiiC,gBAAe;AAC3F,UAAIplH,OAAOlP,OAAMk6F,eAAe7H,KAAKgiC,iBAAiBhiC,KAAKqiC,aAAAA;AAE3D,UAAIj3G,OAAO,EAACE,QAAS00E,KAAK/tD,gBAAgB/nC,QAAQ81F,KAAKiiC,gBAAgBplH,KAAKA;AAC5E,UAAGuO,KAAKvO,QAAQlP,OAAM+lD,cAActoC,IAAO,GAAA;AAC1C,YAAGzd,OAAMgF,UAAU,iBAAiB,CAACyY,IAAO,CAAA,GAAA;AAC3Czd,UAAAA,OAAMsoD,QAAQ7qC,IACd;AAAA,QAAA;AAAA,MACD;AAAA,IACD;AAEDosH,kBAAAA;AAEA,QAAG7pI,OAAMuC,OAAO0hC,OAAO;AACtBjkC,MAAAA,OAAMwyD,YACN;AAAA,IAAA,OACI;AACJ,UAAI6/B,KAAK/tD,eACRtkC,CAAAA,OAAMk5B,YAAYm5D,KAAK/tD,gBAAgB,KAAA;AACxC,UAAI+tD,KAAKiiC,eACRt0H,CAAAA,OAAMk5B,YAAYm5D,KAAKiiC,gBAAgB;IACxC;AACD2W,wBAAAA;AAAAA,EACF,GAAIhuI,IAEH,CAAA;AAAA,WAAS8sI,iBAAiBz0G,SACzB;AAAA,QAAI7X,OAAO+rH,YAAAA;AAGX,QAAG/rH,KAAK6mB,kBAAkB7mB,KAAK62G,gBAAe;AAC7C,UAAGt0H,OAAM+lD,cAActoC,KAAK6mB,gBAAgB7mB,KAAK62G,gBAAgB72G,KAAK42G,iBAAiB52G,KAAKi3G,aAK5F,EAAA;AAAA,IAAA;AAED,QAAI16H,YAAYgG,OAAMmS,UAAU0zC,gBAAgBpoC,KAAK6mB,gBAAgB7mB,KAAK42G,iBAAiB52G,KAAK62G,gBAAgB72G,KAAKi3G,aAAAA;AAIrH,QAAIj6G,OAAO,iBAAezgB,YAAW,OACpCgG,OAAMmS,UAAUqzC,UAAU/nC,KAAK6mB,gBAAgB7mB,KAAK42G,iBAAiB52G,KAAK62G,gBAAgB72G,KAAKi3G,aAC/F,IAAA;AACDp/F,IAAAA,QAAOh6B,YAAYmf;AAAAA,EACnB;AAED,WAAS4vH,cAAc/0G,SAAQpsB;AAC9BosB,IAAAA,QAAOr+B,MAAMlC,OAAOmU,IAAIzS,IAAI;AAC5B6+B,IAAAA,QAAOr+B,MAAMnC,MAAMoU,IAAI5S,IAAI;AAAA,EAC3B;AAED,WAASuzI,gBACRT;AAAAA,wBACCC,0BACCH,oBAAoB;AACtBC,8BAA0B;AAAA,EAC1B;AACD,WAAS6B,kBAAkBE,KAAKC,KAAKlT,KAAKD,KACzC;AAAA,QAAIx+H,MAAM4xI,iBAAAA;AAEV,QAAI3tH,OAAO+rH;AAEX,QAAI7tI,MAAM,CAAC,sBAAA;AACX,QAAGqE,OAAMmS,UAAUk5H,sBAAqB;AACvC1vI,UAAIM,KAAK+D,OAAMmS,UAAUk5H,qBAAqB5tH,KAAK6mB,gBAAgB7mB,KAAK42G,iBAAiB52G,KAAK62G,gBAAgB72G,KAAKi3G,aAAAA,CAAAA;AAAAA,IACnH;AAED,QAAI4W,OAAM/0I,KAAKyW,KAAOzW,KAAKksD,IAAIw1E,MAAMiT,KAAK,CAAA,IAAO30I,KAAKksD,IAAIu1E,MAAMmT,KAAK,CACrEG,CAAAA;AAAAA,WAAO/0I,KAAKuD,IAAI,GAAGwxI,OAAO,CAAA;AAC1B,QAAIA,CAAAA,KACH;AAED9xI,QAAIQ,YAAY2B,IAAIlD,KAAK,GACzB;AAAA,QAAI8yI,OAAOvT,MAAMmT,QAAMlT,MAAMiT,MAC5BM,QAAQj1I,KAAKk1I,KAAKF,GAEnB;AAAA,QAAGG,wBAAwBR,KAAKjT,KAAKkT,KAAKnT,GAAQ,KAAA,GAAE;AACnDwT,eAASj1I,KAAK4W;AAAAA,IACjB,WAAWu+H,wBAAwBR,KAAKjT,KAAKkT,KAAKnT,QAAQ,GAAE;AACzDwT,eAASj1I,KAAK4W;AAAAA,IACd;AAID,QAAIw+H,MAAMp1I,KAAKo1I,IAAIH,KAClBI,GAAAA,MAAMr1I,KAAKq1I,IAAIJ,KAAAA,GACf12I,MAAMyB,KAAKC,MAAM20I,GAAAA,GACjBp2I,OAAOwB,KAAKC,MAAM00I,GAGnB;AAAA,QAAIj0I,QAAQ,CACX,+BAA6Bu0I,QAAM,QACnC,4BAA0BA,QAAM,QAChC,2BAAyBA,QAAM,QAC/B,0BAAwBA,QAAM,QAC9B,uBAAqBA,QAAM,QAC3B,WAAWj1I,KAAKC,MAAM80I,IAAQ,IAAA,IAAA;AAG/B,QAAG51I,OAAOk/C,UAAUC,UAAU36C,QAAQ,UAAA,KAAA,IAAkB;AAEvDjD,YAAMgF,KAAK,kBAAmB4vI,YAAYF,KAAKC,OAAO,GAEtD;AAAA,UAAIE,YAAYv1I,KAAKkM,IAAIlM,KAAKC,MAAM00I,MAAMjT,GACzC8T,CAAAA,GAAAA,WAAWx1I,KAAKkM,IAAIlM,KAAKC,MAAMwhI,MAAMmT,GAEtC,CAAA;AAAA,cAAOO,wBAAwBR,KAAKjT,KAAKkT,KAAKnT,GAAAA,GAAAA;AAAAA,QAC7C,KAAK;AACJljI,iBAAOi3I;AACP;AAAA,QACD,KAAK;AACJh3I,kBAAQ+2I;AACRh3I,iBAAOi3I;AACP;AAAA,QACD,KAAK;AACJh3I,kBAAQ+2I;AACR;AAAA,MAAA;AAAA,IAKF;AAED70I,UAAMgF,KAAK,SAAUnH,MAAM,IAC3BmC;AAAAA,UAAMgF,KAAK,UAAWlH,OAAO,IAE7ByE;AAAAA,QAAIvC,MAAMyC,UAAUzC,MAAMwB,KAAK,GAAA;AAAA,EAC/B;AAED,WAASozI,YAAYF,KAAKC,KACzB;AAAA,WAAO,oDACGA,MAAI,aACHD,MAAI,YACLA,MAAI,YACJC,MAAI;AAAA,EAGd;AACD,WAASF,wBAAwBnF,IAAIyF,IAAIxF,IAAIyF;AAC5C,QAAGD,MAAMzF,IAAG;AACX,UAAG0F,MAAMzF,IAAG;AACX,eAAO;AAAA,MACX,OAAQ;AACJ,eAAO;AAAA,MACP;AAAA,IACJ,OAAO;AACJ,UAAGyF,MAAMzF,IAAG;AACX,eAAO;AAAA,MACX,OAAQ;AACJ,eAAO;AAAA,MACP;AAAA,IACD;AAAA,EAED;AACD,WAAS4E,mBACR;AAAA,QAAA,CAAIznE,IAAIuoE,cAAAA,CAAevoE,IAAIuoE,WAAW12I,YAAW;AAChDmuE,UAAIuoE,aAAa72I,SAASoE,cAAc,KACxC0S;AAAAA,eAASggG,YAAYxyG,YAAYgqE,IAAIuoE,UAAAA;AAAAA,IACrC;AACD,WAAOvoE,IAAIuoE;AAAAA,EACX;AACD,WAASjB;AACR,QAAGtnE,IAAIuoE,YAAW;AACjB,UAAIvoE,IAAIuoE,WAAW12I,WAClBmuE,KAAIuoE,WAAW12I,WAAWqE,YAAY8pE,IAAIuoE;AAE3CvoE,UAAIuoE,aAAa;AAAA,IACjB;AAAA,EACD;AACDlsI,EAAAA,OAAMyE,YAAY,iBAAiBzE,OAAM4E,KAAK,WAC7C;AAAA,QAAG++D,IAAIuoE,YAAW;AACjBlB,wBAAkB/tI,KAAK6sI,WAAWrzI,GAAGwG,KAAK6sI,WAAWxzI,GAAG2G,KAAK6tI,SAASr0I,GAAGwG,KAAK6tI,SAASx0I,CACvF;AAAA,IAAA;AAAA,EACH,GAAI2G,IAAAA,CAAAA;AACJ;AAEA,MAAekvI,UAAA,EACdC,eAAe;AACd,SAAO,EACN7xF,MAAMyuF,aAEP;AAAA,EAAA;ACpXF,IAAI9F,gBAAc,2BACjB;AAAA,SAAO,SAASljI,QACf;AAAA,QAAImuC,YAAWnuC,OAAMc;AACrB,WAAO,EACNqiI,WAAW,SAAUh3H,UAAAA;AACpB,UAAI5J,UAAS4J,SAASuB;AACtBnL,MAAAA,QAAOqC,OAAOm9C,QAAcx/C,QAAOqC,QAAQrC,QAAOqC,OAAO;AACzDrC,MAAAA,QAAOw7G,YAAYh8D,QAAcx/C,QAAOw7G,SAAax7G,IAAAA,QAAOw7G,YAAY;AAExE5xG,eAASkgI,YAAYF,QAAQC,cAC7BjgI;AAAAA,eAASmgI,YAAYvD,QAAQjF,cAC7B33H;AAAAA,eAASmgI,UAAUprG,OAAO/0B,QAAAA;AAE1BlP,WAAKqqH,kBAAkBilB,SAAevsI;IACtC,GACDqjI,eAAe,SAAUl3H,UAAAA;AACxBlP,WAAKuvI,iBAAiBxsI;AAEtB/C,WAAKwvI,qBAAqBzsI,QAAOmM,QAAAA;AAEjCA,eAASmgI,UAAU/xF,KAAKpuC,UAAUnM,MAAAA;AAClCmM,eAASkgI,UAAU9xF,KAAKpuC,UAAUnM;AAElC,UAAGmM,SAASuB,QAAQxJ,MAAM,YAAW;AACpCjH,aAAKsmI,UAAUp3H,QACf;AAAA,MAAA;AAAA,IAED,GACDq3H,aAAa,SAAUr3H,UACtBlP;AAAAA,WAAKyvI,gBAAgB1sI,MAAAA;AACrB/C,WAAK0vI,oBAAoB3sI;AACzB,UAAImM,SAASmgI,WAAW;AACvBngI,iBAASmgI,UAAUpgI;MACnB;AAAA,IACD,GACDq3H,WAAW,SAASp3H,UAAAA;AACnBnM,MAAAA,OAAMsN,QAAQnB,SAASmB;AACvBtN,MAAAA,OAAMs9G,cAAcnxG,SAASmxG;AAC7Bt9G,MAAAA,OAAMiM,aAAaE,SAASF;AAC5BjM,MAAAA,OAAMi9G,WAAW9wG,SAAS8wG;AAC1Bj9G,MAAAA,OAAMmsG,cAAchgG,SAASggG;AAC7BnsG,MAAAA,OAAM+8G,aAAa5wG,SAAS4wG;AAAAA,IAC5B,GAED2vB,iBAAiB;AAChBzvI,WAAKqqH,gBAAgBp7G,WACrBjP;AAAAA,WAAKqqH,kBAAkB;AAAA,IACvB,GAEDklB,kBAAkB,SAASxsI,QAC1B;AAAA,eAAS4sI,qBAAqB1oI,IAAI/H;AACjC,YAAI+H,MAAMjH,KAAK+H,UAAU,kBAAkB,CAACd,IAAI/H,CAAK,CAAA,GAAA;AAEpD,cAAIshB,OAAOxgB,KAAKgqC,QAAQ/iC,EACxB;AAAA,cAAIjH,KAAKouB,WAAW5N,IAAO,EAAA;AAE3B,cAAIzM,QAAQ;AACZ,cAAIunF,WAAWt7F,KAAKmW,OAAOC,OAAOoK,OAAO,MAAMxgB,KAAKkV,UAAUkzC,iBAAiBpoD,KAAKgqC,QAAQ/iC,EAAAA,CAAAA,IAAO,MAAMjH,KAAKmW,OAAOC,OAAOmoF;AAE5H9lG,iBAAOmS,WAAW,WAAA;AACjB7H,YAAAA,OAAM04F,gBAAgBH,UAAUvnF,OAAO,WAAA;AACtChR,cAAAA,OAAM2oD,WAAWzkD,EACzB;AAAA,YAAA,CAAA;AAAA,UACO,GAAGjH,KAAKsF,OAAO0hC,QAAQ,MAAM,CAC9B;AAAA,QAAA;AAAA,MACD;AAEDhnC,WAAKqqH,gBAAgBthB,SAAS,SAAS,mBAAmBhmG,OAAM4E,KAAK,SAAUzI,GAAGC,KAAAA;AACjF,YAAI8H,KAAKjH,KAAKgvB,OAAO9vB,GAAGc,KAAKsF,OAAOmvC,cAAAA;AACpC,YAAIxtC,IAAI;AACPjH,eAAK+H,UAAU,eAAe,CAACd,IAAI/H,CACnC,CAAA;AAAA,QAAA;AAAA,MACD,GAAE6D,MAAQ/C,GAAAA,KAAKqQ;AAEhBrQ,WAAKqqH,gBAAgBthB,SAAS,SAAS,oBAAoBhmG,OAAM4E,KAAK,SAAUzI,GAAGC,KAClF;AAAA,YAAI8M,MAAMk5B,yBAAoCjmC,GAAG6D,OAAMiM,UAAAA;AACvD,YAAIqD,QAAOtP,OAAMmK,YAAYjB,IAAIzS,CACjC;AAAA,YAAIo2I,OAAOt2I,KAAKkS,MAAMzI,OAAMiZ,kBAAkB3J,KAAAA,CAAAA;AAE9C,YAAIw9H,YAAY9sI,OAAMsZ,SAAAA,EAAW2C,QAAQ4wH,IAEzC7sI;AAAAA,QAAAA,OAAMgF,UAAU,gBAAgB,CAAC7I,GAAG2wI;MACpC,GAAE9sI,MAAAA,GAAQ/C,KAAKqQ,KAAAA;AAEhBrQ,WAAKqqH,gBAAgBthB,SAAS,eAAe,mBAAmBhmG,OAAM4E,KAAK,SAAUzI,GAAG+H,IAAI9H,KAAAA;AAC3F,YAAI8H,KAAKjH,KAAKgvB,OAAO9vB,GAAG6D,OAAMuC,OAAOmvC,cACrCk7F;AAAAA,6BAAqB9zI,KAAKmE,MAAMiH,IAAI/H,CACpC;AAAA,MAAA,GAAE6D,MAAQ/C,GAAAA,KAAKqQ,KAEhBrQ;AAAAA,WAAKqqH,gBAAgBthB,SAAS,eAAe,oBAAoBhmG,OAAM4E,KAAK,SAAUzI,GAAG+H,IAAI9H,KAC5F;AAAA,YAAI8H,KAAKjH,KAAKgvB,OAAO9vB,CACpBiP,GAAAA,OAAOnO,KAAKkf,QAAQjY,EAAAA;AAErB,YAAIuZ,OAAO;AACX,YAAIrhB,IAAI5G,cAAc+kG,aAAwBn+F,IAAI5G,UAAa,GAAA;AAC9D,cAAI+kG,aAAwBn+F,IAAI5G,YAAY0E,QAAQ,OAAA,IAAA,IAAe;AAClEujB,mBAAOrS,KAAKu+B,QAAQ,CAC3B;AAAA,UAAA,OAAa;AACNlsB,mBAAOrS,KAAKs+B,QAAQ;UACpB;AAAA,QACD;AACD,YAAIjsB,KACHmvH,sBAAqB9zI,KAAKmE,MAAMwgB,MAAMthB,CAAAA;AACvC,eAAO;AAAA,MACP,GAAE6D,SAAQ/C,KAAKqQ,KAAAA;AAAAA,IAChB,GAEDm/H,sBAAsB,SAASzsI,QAAOmM;AACrC,UAAI+lD,OAAO/lD;AACX,UAAItL,QAAQstC,UAASptC,WAAW,OAAA;AAChCF,YAAMG,iBAAiB,iBAAiB,WAAA;AACvC,eAAO,EACN0zD,YAAYxC,KAAK2rD,SAAS3rD,KAAK2rD,OAAO13G,OAAO7I,QAC7CyvI,YAAa76E,KAAK2rD,SAAS3rD,KAAK2rD,OAAOnhG,OAAQpf,OAAAA;AAAAA,MAErD,CACI;AAAA,IAAA,GAEDqvI,qBAAqB,WAAA;AACpB,UAAI9rI,QAAQstC,UAASptC,WAAW,OAAA;AAChCF,YAAMiC,mBAAmB;IACzB,EAEJ;AAAA,EAAA;AAEC,ECjID;AAAA,IAAIogI,cAAc,2BACjB;AAAA,SAAO,SAAUljI,QAAAA;AAChB,WAAO,EAENgtI,sBAAsB,WACrB;AAAA,aAAOhtI,OAAMoM,IAAIC,QAAQ;IACzB,GACD4gI,wBAAwB,WACvB;AAAA,aAAOjtI,OAAMoM,IAAIC,QAAQ,WACzB;AAAA,IAAA,GAED6gI,yBAAyB,SAASx+F,QAAAA;AACjC,UAAIy+F,WAAWz+F,OAAO2/B,eAAe,SAAA;AACrC,eAAQt1E,IAAI,GAAGA,IAAIo0I,SAASn0I,QAAQD,KAAI;AACvC,YAAI0lD,IAAI0uF,SAASp0I,CACjB;AAAA,YAAIq0I,cAAc;AAElB,YAAI5kI,OAAOi2C,EAAE+lD,QAAQt2E,eAAeuwB,EAAEpwC;AACtC,YAAG7F,QAAQA,KAAKkF,WAAWlF,KAAKkF,QAAQxJ,OAAO,QAAO;AACrDkpI,wBAAa;AAAA,QACnB,OAAU;AACJ,cAAIhoD,OAAO3mC,EAAE+lD,QAAQ38C,eAAepJ,EAAEpwC,GAAAA;AACtC,cAAG+2E,QAAQA,KAAK13E,WAAW03E,KAAK13E,QAAQxJ,OAAO,QAAO;AACrDkpI,0BAAa;AAAA,UACb;AAAA,QACD;AAED,YAAGA,aAAY;AACd3uF,YAAE/wC,QAAQ/R,OAAO8iD,EAAE/wC,QAAQ/R,MAAM8iD,EAAE/wC,QAAQ/R,MAAM,MAAM,MAAM;AAAA,QAC7D;AAAA,MACD;AAAA,IACD,GAEDwnI,WAAW,SAASz0F;AACnB,UAAIjC,QAAQ;AAEZxvC,WAAKiwI,wBAAwBx+F,MAAAA;AAE7BA,aAAOjqC,YAAY,kBAAkB;AACpC,YAAI4oI,eAAertI,OAAMoM,IAAIC,QAAQ,UACrC;AAAA,YAAIghI,aACHA,cAAa3/H,QAAQ20F,SAASgrC,aAAa7oC,QAAQ92F,QAAQ20F,SAAAA,CAAUriG,OAAMuC,OAAOwqB;AAEnF,YAAIolF,WAAWnyG,OAAMoM,IAAIC,QAAQ,MAEjC;AAAA,YAAA,CAAI8lG,SACH;AAED,YAAIm7B,YAAYn7B,SAAS+X,mBACzB;AAAA,YAAIqjB,WAAYvtI,CAAAA,OAAMuC,OAAO8nB,aAAAA,CAAcrqB,OAAMuC,OAAO6vG,cAAck7B,cAAc;AACpF,YAAI7gG,UAAU8gG,YAAYD,cAAc,OAAM;AAC5CttI,UAAAA,OAAMuC,OAAO6vG,aAAak7B;AAAAA,QAC3B;AACDn7B,iBAASzkG,QAAQ20F,SAAS8P,SAAS3N,QAAQ92F,QAAQ20F,SAASkrC;AAE5D,YAAKp7B,CAAAA,SAASzkG,QAAQ20F,QAAQ;AAE7B,cAAImrC,cAAcr7B,SAASoX;AAC3B,cAAIikB,YAAY,CAAMxtI,KAAAA,OAAMuC,OAAO6vG,aAAao7B,YAAY,CAC3DxtI,EAAAA,CAAAA,OAAMuC,OAAO6vG,aAAao7B,YAAY,CAAA;AACvC,cAAIA,YAAY,CAAA,KAAMxtI,OAAMuC,OAAO6vG,aAAao7B,YAAY,GAC3DxtI,CAAAA,OAAMuC,OAAO6vG,aAAao7B,YAAY,CAAA;AACvC,cAAIH,gBAAgBrtI,OAAMuC,OAAOwqB,YAAW;AAE3ColF,qBAASzkG,QAAQhX,QAAQsJ,OAAMuC,OAAO6vG,aAAa;AAGnD,iBAAKD,SAASzkG,QAAQ6f,cAAc4kF,SAASzkG,QAAQG,WAAW7N,OAAMgC,MAAMhM,aAAY;AACvF,kBAAIy3I,sBAAsBt7B,SAAS50C,OAAOp+B,QAAQ7yB,WAAWtW;AAC7D,kBAAI03I,oBAAoB1tI,OAAMoM,IAAIC,QAAQ8lG,SAASzkG,QAAQG,OAC3D;AAAA,kBAAI8/H,yBAAyBD,kBAAkBhgI,QAAQhX;AAIvD,kBAAIk3I,eAAeH,uBAAuBt7B,SAASzkG,QAAQhX,QAAQi3I,0BAA0B;AAC7F,kBAAIC,eAAe,GAAE;AACpBz7B,yBAASzkG,QAAQhX,SAASk3I;AAC1B5tI,gBAAAA,OAAMuC,OAAO6vG,cAAcw7B;AAAAA,cAC3B;AAAA,YACD;AAED,gBAAA,CAAKnhG,OAAO;AACX,kBAAI4gG,gBAAiBz7G,CAAAA,UAAqBy7G,aAAa//H,OAAOohC,OAAOgrD,KAAQ,GAAA;AAE5E,qBAAKyY,SAASzkG,QAAQmgI,qBAAqB;AAC1C,sBAAIC,eAAe9tI,OAAM+tI,MAAM/tI,OAAMwV;AACrC,sBAAGs4H,gBAAgBA,aAAavrI,UAAUurI,aAAavrI,OAAO6vG,YAAW;AACxED,6BAASzkG,QAAQmgI,sBAAuBC,aAAavrI,OAAO6vG;AAAAA,kBACvE,OAAe;AACJD,6BAASzkG,QAAQmgI,sBAAsB;AAAA,kBACvC;AAAA,gBACD;AACD7tI,gBAAAA,OAAMuC,OAAO6vG,aAAaD,SAASzkG,QAAQmgI;AAC3C17B,yBAAS3N,QAAQ92F,QAAQhX,QAAQsJ,OAAMuC,OAAO6vG;AAAAA,cACvD,OAAe;AACND,yBAAS3N,QAAQ8R,gBAAgBnE,SAASzkG,QAAQhX,OAAO,IACzDsJ;AAAAA,gBAAAA,OAAMm/B,QAAQkyE,eAAec,SAAS3N,QAAQ92F,QAAQmjG,OAAO,EAAC76F,OAAOhW,OAAMuC,OAAO6vG,YAAYP,WAAW,MACzG,CAAA;AAAA,cAAA;AAAA,YACT,OAAc;AACNM,uBAAS3N,QAAQ92F,QAAQhX,QAAQsJ,OAAMuC,OAAO6vG;AAC9C,kBAAID,SAAS3N,QAAQ92F,QAAQmjG,OAAO;AACnC7wG,gBAAAA,OAAMm/B,QAAQkyE,eAAec,SAAS3N,QAAQ92F,QAAQmjG,OAAO,EAAC76F,OAAOm8F,SAAS3N,QAAQ92F,QAAQhX,OAAOm7G,WAAW,MAAA,CAAA;AAAA,cAChH;AAAA,YACD;AAAA,UACR,OAAa;AACN,gBAAIw7B,gBAAgBz7G,UAAqBy7G,aAAa//H,OAAOohC,OAAOgrD,QAAQ;AAE3EyY,uBAASzkG,QAAQmgI,sBAAsB7tI,OAAMuC,OAAO6vG;AAAAA,YACpD;AACD,gBAAA,CAAK3lE,OAAO;AACX0lE,uBAAS3N,QAAQ92F,QAAQhX,QAAQ;AAAA,YACjC;AAAA,UACD;AAAA,QACD;AAED+1C,gBAAQ;AAAA,MACb,CACIxvC;AAAAA,WAAK+wI,uBAAuBt/F,MAC5B;AAAA,IAAA,GAEDs/F,wBAAwB,SAASt/F,QAAAA;AAChC1uC,MAAAA,OAAMiuI,wBAAwBhxI,KAAK+vI;AACnChtI,MAAAA,OAAM+4F,0BAA0B97F,KAAKgwI;AAErC,UAAIl+B,WAAW9xG,KAAK+vI,qBACpB;AAAA,UAAIl+B,aAAa7xG,KAAKgwI,uBACtB;AAAA,UAAIl+B,UAAU;AACbA,iBAAStqG,YAAY,YAAY,SAASyhI,QAAQC,QAAQl9G,KAAAA;AACzD,cAAIwpC,cAAczyD,OAAM4N,eAAAA;AACxB5N,UAAAA,OAAMgF,UAAU,iBAAiB,CAACytD,YAAYh8D,GAAGyvI,QAAQzzE,YAAYh8D,GAAG0vI,MAAAA,CAAAA;AAAAA,QAC9E,CACK;AAAA,MAAA;AACD,UAAIr3B,YAAY;AACfA,mBAAWrqG,YAAY,YAAY,SAASyhI,QAAQC,QAAQl9G,KAC3D;AAAA,cAAIwpC,cAAczyD,OAAM4N,eACxB5N;AAAAA,UAAAA,OAAMgF,UAAU,iBAAiB,CAACkhI,QAAQzzE,YAAYn8D,GAAG6vI,QAAQ1zE,YAAYn8D,CAG7E,CAAA;AAAA,cAAI62B,OAAOntB,OAAMoM,IAAIC,QAAQ;AAC7B,cAAI8gB,QAAQA,KAAKP,cAAeO,CAAAA,KAAKzf,QAAQ6f,YAAW;AACvDJ,iBAAKP,WAAW31B,MAAMlC,OAAOo4B,KAAKhB,MAAMv2B,aAAa;AACrDu3B,iBAAKP,WAAWh3B,aAAau3B,KAAKhB,MAAMv2B;AAAAA,UACxC;AAAA,QACP,CAAA;AAAA,MACK;AAED84C,aAAOjqC,YAAY,YAAY,WAAA;AAC9B,YAAIsqG,YAAa/uG,CAAAA,OAAM63G,aAAY;AAClC73G,UAAAA,OAAM63G,cAAc9I,SAAS8I;AAAAA,QAC7B;AAED,YAAI/I,cAAe9uG,CAAAA,OAAM43G,aAAY;AACpC53G,UAAAA,OAAM43G,cAAc9I,WAAW8I;AAAAA,QAC/B;AAAA,MACN,CAAA;AAAA,IACI,GAEDs2B,kBAAkB,SAASx/F,QAAQvhB,MAAAA;AAClC,UAAIggH,WAAWz+F,OAAO2/B,eAAe,SAErC;AAAA,UAAI8/D,YAAY;AAChB,UAAIf;AACJ,eAAQr0I,IAAI,GAAGA,IAAIo0I,SAASn0I,QAAQD,KAAI;AACvC,YAAIymB,MAAM2tH,SAASp0I,CACnBymB;AAAAA,YAAI4uH;AACJ,YAAI5lI,OAAOgX,IAAI6uH;AACf,YAAIjpD,OAAO5lE,IAAI8uH;AACf,YAAG9lI,QAAQA,KAAK8lE,aAAanhD,QAAS3kB,KAAKuqG,WAAWvqG,KAAKuqG,QAAQ5lF,IAAAA,GAAO;AACzEigH,wBAAc5tH;AACd2uH,sBAAY;AACZ;AAAA,QACA,WAAQ/oD,QAAQA,KAAK9W,aAAanhD,QAASi4D,KAAK2tB,WAAW3tB,KAAK2tB,QAAQ5lF,IAAO,GAAA;AAC/EigH,wBAAc5tH;AACd2uH,sBAAY;AACZ;AAAA,QACA;AAAA,MACD;AACD,aAAO,EACNv/F,SAASw+F,aACTe,UAED;AAAA,IAAA,GAED9K,eAAe,SAAU30F;AACxB,UAAIvhB,OAAOntB,OAAMoM,IAAIC,QAAQ;AAE7B,UAAIkiI,aAAatxI,KAAKixI,iBAAiBx/F,QAAQvhB,IAAAA;AAG/C,UAAGohH,WAAW3/F,SAAQ;AACrB,YAAIu/F,YAAYI,WAAWJ,WAC1B/oD,OAAOmpD,WAAW3/F;AAEnB,YAAGw2C,KAAK13E,QAAQ8mB,SAAS,KAAI;AAC5B;AAAA,QACA;AAED,YAAIg6G;AACJppD,aAAK3gF,YAAY,iBAAiB,SAASgqI,eAAeC;AAEzD,cAAIvhH,QAAOntB,OAAMoM,IAAIC,QAAQ,MAAA;AAC7B,cAAIsiI,WAAWxhH,QAAOA,MAAKq3E,UAAU;AACrC,cAAGmqC,UAAS;AACX,gBAAIC,SAASzhH,MAAKo8F,oBAAAA;AAGlB,iBAAIp8F,MAAKzf,QAAQ6f,WAChBohH,UAASjhI,QAAQsN,WAAW4zH,OAAO,CAEpCD;AAAAA,qBAASjhI,QAAQggG,WAAWkhC,OAAO,CAAA;AAAA,UACnC;AACDJ,yBAAeL,YAAYM,gBAAgBC;AAC3C,iBAAO1uI,OAAMgF,UAAU,qBAAqB,CAACwpI;QACnD,CACKppD;AAAAA,aAAK3gF,YAAY,YAAY,SAASoqI,eAAeC,cAAAA;AACpD,cAAIv9B,UAAU48B,YAAYU,gBAAgBC;AAC1C,iBAAO9uI,OAAMgF,UAAU,gBAAgB,CAACwpI,cAAcj9B,OAAAA,CAAAA;AAAAA,QAC5D,CACKnsB;AAAAA,aAAK3gF,YAAY,eAAe,SAASsqI,aAAaC,cAAcC,aAAaH,cAEhF;AAAA,cAAI52B,UAAUi2B,YAAYY,cAAcC;AACxC,cAAIz9B,UAAU48B,YAAYc,cAAcH;AACxC,cAAI3hH,QAAOntB,OAAMoM,IAAIC,QAAQ,MAC7B;AAAA,cAAIsiI,WAAWxhH,QAAOA,MAAKq3E,UAAU;AACrC,cAAGmqC,UAAS;AACXA,qBAASjhI,QAAQsN,WAAW1d;AAAAA,UAC5B;AACD,cAAIkiB,MAAMxf,OAAMgF,UAAU,mBAAmB,CAACkzG,SAAS3G,OACvD,CAAA;AAAA,cAAG/xF,OAAO+xF,YAAY,GAAE;AACvBvxG,YAAAA,OAAMuC,OAAO6vG,aAAab;AAAAA,UAC1B;AAED,iBAAO/xF;AAAAA,QACb,CAAA;AAAA,MACK;AAAA,IAED,GACDgkH,aAAa,SAAUr3H,UAEtB;AAAA,IAAA,EAAA;AAAA,EAGJ;AACC,EClND;AAAA,SAASu4F,OAAO1kG,QACf;AAAA,WAASkvI,kBAAkBvmI,MAAMu6H,cAChC;AAAA,QAAI9gI,MAAM8gI,aAAYljI,MAAAA;AACtB,QAAGoC,IAAI+gI,UACN/gI,KAAI+gI,UAAUx6H,IACfA;AAAAA,SAAKlE,YAAY,WAAW,WAAA;AAC3B,UAAGrC,IAAIihI,cACNjhI,KAAIihI,cAAc16H,IACtB;AAAA,IAAA,CAAA;AACEA,SAAKlE,YAAY,aAAa,WAC7B;AAAA,UAAGrC,IAAIohI,YACNphI,KAAIohI,YAAY76H,IAAAA;AAAAA,IACpB,CACE;AAAA,EAAA;AAED,MAAI82F,WAAUwE,YAAUC,cAAclkG,MAAAA;AACtCy/F,EAAAA,SAAQkF,aAAa,QAAQoI;AAC7BtN,EAAAA,SAAQkF,aAAa,WAAW+R,OAAAA;AAChCjX,EAAAA,SAAQkF,aAAa,aAAawqC,aAClC1vC;AAAAA,EAAAA,SAAQkF,aAAa,UAAUiL,QAAQ,SAASjnG,MAC/C;AAAA,QAAIzE,KAAKyE,KAAK+E,UAAU/E,KAAK+E,QAAQxJ,KAAK;AAC1C,QAAGA,OAAO,QAAO;AAChBgrI,wBAAkBvmI,MAAMymI,WACxB;AAAA,IAAA;AAAA,EACH,CACC3vC;AAAAA,EAAAA,SAAQkF,aAAa,YAAYuR,QAAAA;AACjCzW,EAAAA,SAAQkF,aAAa,aAAamR,UAAAA;AAClCrW,EAAAA,SAAQkF,aAAa,YAAYuY,UAAU,SAASv0G,MACnD;AAAA,QAAIzE,KAAKyE,KAAK+E,UAAU/E,KAAK+E,QAAQxJ,KAAK;AAC1C,QAAGA,OAAO,cAAcyE,KAAK+E,QAAQ9I,QAAQ,QAAO;AACnDsqI,wBAAkBvmI,MAAM0mI,aAAAA;AAAAA,IACxB;AAAA,EACH,CAAA;AACC5vC,EAAAA,SAAQkF,aAAa,QAAQiiB,MAAM,SAASj+G,MAC3C;AAAA,QAAIzE,KAAKyE,KAAK+E,UAAU/E,KAAK+E,QAAQxJ,KAAK;AAC1C,QAAGA,OAAO,UAAUyE,KAAK+E,QAAQ9I,QAAQ,QAAO;AAC/CsqI,wBAAkBvmI,MAAM2mI,aAAAA;AAAAA,IACxB;AAAA,EACH,CAAA;AAEC7vC,EAAAA,SAAQkF,aAAa,gBAAgB4qC,IACrC9vC;AAAAA,EAAAA,SAAQkF,aAAa,oBAAoB6qC;AACzC/vC,EAAAA,SAAQkF,aAAa,qBAAqB8qC,QAE1C;AAAA,MAAIC,eAAeC,kBAAa3vI,MAAAA;AAEhC,MAAI25B,gBAAgBi2G,OAAmB5vI,MAAAA;AAEvCA,EAAAA,OAAMoC,IAAIu3B,gBAAgBA;AAC1B35B,EAAAA,OAAMoC,IAAIghI,iBAAiBzpG;AAC3BA,gBAAc4gB,KAAKv6C,MAAAA;AAEnB,SAAO,EACNy/F,SAAQA,UACRwG,aAAaA,YAAY1rD,KAAKv6C,MAAAA,GAC9B6vI,WAAWH,aAAan1F,KAAAA,GACxB53C,QAAO,EACNmmH,UAAU,WAAA;AACT,WAAOgnB,qBAAa9vI,MAAAA;AAAAA,EACpB,GACDg9G,QAAQ,WACP;AAAA,WAAO+yB,mBAAa/vI,MACpB;AAAA,EAAA,GACDqyB,SAAS,WAAA;AACR,WAAO29G,qBAAchwI;EACrB,GACDiwI,iBAAiB;AAChB,WAAOC,qBAAsBlwI;EAC7B,GACDmwI,eAAe,WACd;AAAA,WAAOC,mBAAoBpwI,MAAAA;AAAAA,EAC3B,GACDqwI,cAAc,WAAA;AACb,WAAOC,0BACP;AAAA,EAAA,GACD9yB,iBAAiB,WAChB;AAAA,WAAO+yB,0BACP;AAAA,EAAA,GACDC,cAAc,WAAA;AACb,WAAOC,0BACP;AAAA,EAAA,GACDz2D,eAAe,WACd;AAAA,WAAO02D;EACP,GACDjzH,MAAM,WACL;AAAA,WAAOkzH,iBAAW3wI,MAAAA;AAAAA,EAClB,GACD4wI,aAAa,WAAA;AACZ,WAAOC,2BAAuB7wI,MAC9B;AAAA,EAAA,GACD8wI,mBAAmB,WAClB;AAAA,WAAO9b,0BACP;AAAA,EAAA,GACDjM,oBAAoB,WAAA;AACnB,WAAOgoB,+BAA2B/wI,MAAAA;AAAAA,EAClC,KAEFgxI,eAAe,EACd1/E,eAAe,SAASh3D,MAAAA;AACvB,WAAOo1I,aAAap+E,cAAch3D,MAAM0F;EACxC,GACDw2B,kBAAkB,SAASj0B,SAC1B;AAAA,WAAOmtI,aAAal5G,iBAAiBj0B,SAAQvC,MAC7C;AAAA,EAAA,EAAA,EAAA;AAGJ;AAEA,MAAeixI,OAAA,EACd12F,MAAMmqD;AChJP,SAASwsC,qBAAAA;AAER,WAASC,YAAYnxI,QAAAA;AACpB,WAAOA,OAAMoM,IAAIC,QAAQ;EACzB;AAED,WAAS+kI,QAAQpxI,QAAAA;AAChB,WAAOA,OAAMoM,IAAIC,QAAQ,MAAA;AAAA,EACzB;AAED,WAASglI,YAAYrxI,QAAAA;AACpB,QAAImM,WAAWglI,YAAYnxI;AAC3B,QAAImM,YAAAA,CAAaA,SAASuB,QAAQ20F,QAAO;AACxC,aAAOl2F;AAAAA,IACV,OAAQ;AACL,UAAIghB,OAAOikH,QAAQpxI,MAAAA;AACnB,UAAImtB,QAAAA,CAASA,KAAKzf,QAAQ20F,QAAO;AAChC,eAAOl1E;AAAAA,MACX,OAAU;AACN,eAAO;AAAA,MACP;AAAA,IACD;AAAA,EACD;AAED,WAAS6/G,qBAAqBhtI,QAAAA;AAC7B,QAAIsxI,WAAW;AAEf,QAAIC,WAAW;AACf,QAAIC,cAAc,CACjB,6CACA,gDACA;AAEDA,gBAAYprI,QAAQ,SAAUhI,UAAAA;AAC7BmzI,iBAAWA,YAAAA,CAAAA,CAAcl8I,SAAS6F,cAAckD,QAAAA;AAAAA,IACnD;AACE,QAAImzI,UAAS;AACZD,iBAAWF,QAAQpxI,MACtB;AAAA,IAAA,OAAQ;AACLsxI,iBAAWD,YAAYrxI,MACvB;AAAA,IAAA;AAGD,SAAKsxI,UAAS;AACb,aAAO;AAAA,IACP;AAED,QAAI5D,oBAAoB+D,qBAAqBzxI,QAAOsxI,UAAU,SAC9D;AAAA,WAAO5D;AAAAA,EACP;AAED,WAAST,uBAAuBjtI,QAC/B;AAAA,QAAIsxI,WAAWD,YAAYrxI,MAC3B;AAAA,QAAA,CAAKsxI,YAAYA,SAASptI,MAAM,QAAO;AACtC,aAAO;AAAA,IACP;AACD,QAAIwtI,sBAAsBD,qBAAqBzxI,QAAOsxI,UAAU,SAAA;AAChE,WAAOI;AAAAA,EACP;AAED,WAASD,qBAAqBzxI,QAAO45B,MAAM1qB,MAC1C;AAAA,QAAIyiI,oBAAoB/3G,KAAKlsB,QAAQwB,IAAAA;AACrC,QAAI0iI,gBAAgB5xI,OAAMoM,IAAIC,QAAQslI,iBACtC;AAAA,WAAOC;AAAAA,EACP;AAED,MAAIC,gBAAgB;AAEpB,WAASC,QAAQzlI,SAAS5N,QAAQmJ,MAAM6hB;AACvC,QAAI9gB,OAAO0D,QAAQpP,IACnB;AAAA,QAAA,EAAM0L,QAAQA,KAAK/R,UAAc,IAAA;AAChC,UAAG6yB,UAAS;AACX,eAAOA,SAAAA;AAAAA,MACX,OAAQ;AACJ,eAAOooH;AAAAA,MACP;AAAA,IACJ,OAAS;AACN,aAAOlpI,KAAKlK,QAAQvB,MAAMyL,MAAMf;IAChC;AAAA,EACD;AAED,SAAO,EAEN8gH,gBAAgB,SAASpuH,MAAAA;AACxB,QAAIklB,MAAMsyH,QAAQh5I,KAAKmE,MAAMm0I,SAAS,kBAAkB,CAAC92I;AACzD,QAAGklB,QAAQqyH,eAAc;AACxB,aAAO;AAAA,IACX,OAAQ;AACJ,aAAOryH;AAAAA,IACP;AAAA,EACD,GAEDrV,aAAa,SAAS1T,GAAAA;AACrB,QAAI+oB,MAAMsyH,QAAQh5I,KAAKmE,MAAMk0I,aAAa,eAAex4I,MAAMC,UAAUC,MAAMC,KAAK+K;AACpF,QAAG2b,QAAQqyH,eAAc;AACxB,aAAO50I,KAAKuN,WAAW8G;AAAAA,IAC3B,OAAQ;AACJ,aAAOkO;AAAAA,IACP;AAAA,EACD,GAED2J,aAAa,SAAS7Z,OAAAA;AACrB,QAAIkQ,MAAMsyH,QAAQh5I,KAAKmE,MAAMk0I,aAAa,eAAe,CAAC7hI,KAAAA,CAAAA;AAC1D,QAAGkQ,QAAQqyH,eAAc;AACxB,aAAO;AAAA,IACX,OAAQ;AACJ,aAAOryH;AAAAA,IACP;AAAA,EACD,GAEDuW,WAAW,SAAStyB,OACnB;AAAA,QAAIyuD,OAAOj1D;AACX,QAAIuiB,MAAMsyH,QAAQh5I,KAAKo5D,MAAMi/E,aAAa,aAAa,CAAC1tI,KAAAA,GACvD;AAAY,aAAOquI,QAAQh5I,KAAKo5D,MAAMk/E,SAAS,aAAa,CAAC3tI,KAAQ,CAAA;AAAA,IAAA,CAAA;AAGtE,QAAG+b,QAAQqyH,eAAc;AACxB,aAAO;AAAA,IACX,OAAQ;AACJ,aAAOryH;AAAAA,IACP;AAAA,EACD,GAEDuyH,YAAY,SAAS7tI,IACpB;AAAA,QAAIguD,OAAOj1D;AACX,QAAIuiB,MAAMsyH,QAAQh5I,KAAKo5D,MAAMi/E,aAAa,cAAc,CAACjtI,KACxD,WAAY;AAAA,aAAO4tI,QAAQh5I,KAAKo5D,MAAMk/E,SAAS,cAAc,CAACltI,EAAAA,CAAAA;AAAAA,IAAK;AAGpE,QAAGsb,QAAQqyH,eAAc;AACxB,aAAO;AAAA,IACX,OAAQ;AACJ,aAAOryH;AAAAA,IACP;AAAA,EACD,GAGD+M,iBAAiB,SAASnhB,MAAMgE,YAAYC;AAC3C,QAAImQ,MAAMsyH,QAAQh5I,KAAKmE,MAAMk0I,aAAa,mBAAmB,CAAC/lI,MAAMgE,YAAYC,QAEhF,CAAA;AAAA,QAAGmQ,QAAQqyH,eAAc;AACxB,UAAI/8I,MAAMmI,KAAK80I,WAAW3mI,KAAKlH,EAC/B;AAAA,UAAIvN,SAASsG,KAAK+0I,iBAAiB5mI,KAAKlH,EAExC;AAAA,aAAO,EACNnP,MAAM,GACND,KACA6B,QACAD,OAAO,EAEZ;AAAA,IAAA,OAAQ;AACJ,aAAO8oB;AAAAA,IACP;AAAA,EACD,GAEDwyH,kBAAkB,SAASzmH,QAAQ02F,mBAAAA;AAClC,QAAI/vD,OAAOj1D;AACX,QAAIuiB,MAAMsyH,QAAQh5I,KAAKo5D,MAAMi/E,aAAa,gBAAgB,CAAC5lH,QAAQ02F,iBAAAA,GAClE,WAAY;AAAA,aAAO6vB,QAAQh5I,KAAKo5D,MAAMk/E,SAAS,iBAAiB,CAAC7lH;IAAS,CAG3E;AAAA,QAAG/L,QAAQqyH,eAAc;AACxB,aAAO;AAAA,IACX,OAAQ;AACJ,aAAOryH;AAAAA,IACP;AAAA,EACD,GAEDgN,eAAe,SAASjB,QACvB;AAAA,QAAI2mC,OAAOj1D;AACX,QAAIuiB,MAAMsyH,QAAQh5I,KAAKo5D,MAAMi/E,aAAa,iBAAiB,CAAC5lH,MAC3D,GAAA,WAAA;AAAY,aAAOumH,QAAQh5I,KAAKo5D,MAAMk/E,SAAS,iBAAiB,CAAC7lH;IAAS,CAG3E;AAAA,QAAG/L,QAAQqyH,eAAc;AACxB,aAAO;AAAA,IACX,OAAQ;AACJ,aAAOryH;AAAAA,IACP;AAAA,EACD,GAGDvG,mBAAmB,SAAS3J,OAAAA;AAC3B,QAAIkQ,MAAMsyH,QAAQh5I,KAAKmE,MAAMk0I,aAAa,qBAAqB,CAAC7hI,KAChE,CAAA;AAAA,QAAGkQ,QAAQqyH,eAAc;AACxB,aAAO;AAAA,IACX,OAAQ;AACJ,aAAOryH;AAAAA,IACP;AAAA,EACD,GAEDspH,gBAAgB,WAAA;AACfgJ,YAAQh5I,KAAKmE,MAAMk0I,aAAa,kBAAkB,CAClD,CAAA;AAAA,EAAA,GAED73H,UAAU,WAAA;AACT,QAAIkG,MAAMsyH,QAAQh5I,KAAKmE,MAAMk0I,aAAa,YAAY,CAAA,CAAA;AACtD,QAAG3xH,QAAQqyH,eAAc;AACxB,aAAO;AAAA,IACX,OAAQ;AACJ,aAAOryH;AAAAA,IACP;AAAA,EACD,GAEDvF,aAAa,SAAS/V,IACrB;AAAA,QAAIiI,WAAWglI,YAAYl0I,IAC3B;AAAA,QAAA,CAAKkP,aAAaA,SAASvV,UAAAA,GAAa;AACvC,aAAO;AAAA,IACX,OAAU;AACN,UAAIC,OAAOsV,SAAS4yG,cAAcjX,SAAS5jG;AAC3C,UAAIrN,CAAAA,MAAK;AACR,YAAIo7I,UAAU9lI,SAASuB,QAAQswG;AAC/BnnH,eAAOsV,SAAS4wG,WAAW7hH,cAAc,MAAK+2I,UAAS,OAAK/tI,KAAG;MAC/D;AAED,aAAOrN,QAAQ;AAAA,IACf;AAAA,EACD,GAGDq7I,aAAa,SAAShuI,IAAAA;AACrB,QAAIiI,WAAWglI,YAAYl0I;AAC3B,QAAKkP,CAAAA,SAASvV,aAAa;AAC1B,aAAO;AAAA,IACX,OAAU;AACN,aAAOuV,SAASizG,cAActX,SAAS5jG;IACvC;AAAA,EACD,GAEDqN,UAAU,SAASxc,MAAMD,KACxB;AAAA,QAAIi6G,WAAWi+B,qBAAqB/vI;AACpC,QAAI6xG,aAAam+B,uBAAuBhwI,IAAAA;AAExC,QAAIk1I,OAAO,EAACvxI,UAAU,EAAA,GACrBwxI,OAAO,EAACxxI,UAAU,EAAA;AAEnB,QAAGmuG,UAAS;AACXqjC,aAAOrjC,SAASnhG,eAAAA;AAAAA,IAChB;AACD,QAAGkhG,YAAW;AACbqjC,aAAOrjC,WAAWlhG,eAAAA;AAAAA,IAClB;AAED,QAAIob,mBAAoB8lF,cAAc/5G,OAAK,KAAKA;AAChD,QAAIq0B,iBAAkB2lF,YAAYj6G,MAAI,KAAKA;AAC3C,QAAIu9I,aAAarpH,oBAAoBI;AAErC,QAAGipH,YAAW;AAIb,UAAIC,gBAAgBvjC,SAASkC,gBAAAA;AAC7B,UAAIshC,kBAAkBzjC,WAAWmC,gBAEjC;AAAA,UAAIuhC,cAAc,CAAA;AAClB,eAAQz5I,IAAI,GAAGA,IAAIu5I,cAAct5I,QAAQD,KAAI;AAC5C,iBAAQqjB,IAAI,GAAGA,IAAIm2H,gBAAgBv5I,QAAQojB,KAAI;AAE9C,cAAGk2H,cAAcv5I,CAAG2U,EAAAA,QAAQxJ,MAAMquI,gBAAgBn2H,CAAAA,EAAG1O,QAAQxJ,MAAMouI,cAAcv5I,CAAAA,EAAG2U,QAAQxJ,OAAOquI,gBAAgBn2H,CAAG1O,EAAAA,QAAQxJ,IAAG;AAChIsuI,wBAAYv2I,KAAKq2I,cAAcv5I,GAAG2U,QAAQxJ,EAAAA;AAAAA,UAC1C;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAED,QAAI8kB,kBAAiB;AACpB,UAAGwpH,aAAY;AACdA,oBAAYpsI,SAAQ,SAAUqsI,QAAAA;AAC7Bx1I,eAAKmP,IAAIC,QAAQomI,MAAQ/kI,EAAAA,QAAQm+F,2BAA2B;AAAA,QAC5D,GAAEjnG,KAAK3H,IAAAA,CAAAA;AAAAA,MACR;AAED6xG,iBAAWt+F,OAAOzb;AAClB,UAAGy9I,aAAY;AACdA,oBAAYpsI,SAAQ,SAAUqsI;AAC7Bx1I,eAAKmP,IAAIC,QAAQomI,MAAQ/kI,EAAAA,QAAQm+F,2BAA2B;AAAA,QAC5D,GAAEjnG,KAAK3H,IAAAA,CAAAA;AAAAA,MACR;AAAA,IACD;AACD,QAAGmsB,gBAAe;AACjB2lF,eAASv+F,OAAO1b,GAAAA;AAAAA,IAChB;AAED,QAAI49I,OAAO,EAAC9xI,UAAU,EACrB+xI,GAAAA,OAAO,EAAC/xI,UAAU,EAAA;AACnB,QAAGmuG,UAAS;AACX2jC,aAAO3jC,SAASnhG,eAChB;AAAA,IAAA;AACD,QAAGkhG,YAAW;AACb6jC,aAAO7jC,WAAWlhG,eAClB;AAAA,IAAA;AAED3Q,SAAK+H,UAAU,iBAAiB,CAACmtI,KAAKvxI,UAAUwxI,KAAKxxI,UAAU+xI,KAAK/xI,UAAU8xI,KAAK9xI,QACnF,CAAA;AAAA,EAAA,GAED+iI,UAAU,SAASr0H,OAAAA;AAClB,QAAIsjI,SAAS31I,KAAKksB,YAAY7Z,KAAAA;AAC9B,QAAIujI,YAAYt8I,KAAKuD,IAAI84I,SAAS31I,KAAKsF,OAAO0qB,oBAAoB;AAClEhwB,SAAKsU,SAASshI,SACd;AAAA,EAAA,GACD3gD,UAAU,SAAShuF;AAClB,QAAIgF,MAAMjM,KAAKsvB,gBAAgBtvB,KAAKkf,QAAQjY;AAG5C,QAAI4uI,UAAU5pI,IAAInU;AAClB,QAAIkI,KAAKsF,OAAOmZ,IAAKo3H,WAAU5pI,IAAInU,OAAOmU,IAAIxS;AAE9C,QAAI3B,OAAOwB,KAAKuD,IAAIg5I,UAAU71I,KAAKsF,OAAO0qB,oBAAoB,CAAA;AAE9D,QAAIvhB,aAAazO,KAAK81I,gBAAgBz8I;AACtC,QAAIxB;AACJ,QAAA,CAAI4W,YAAW;AACd5W,YAAMoU,IAAIpU;AAAAA,IACd,OAAQ;AACJA,YAAMoU,IAAIpU,OAAO4W,aAAazO,KAAK+0I,iBAAiB9tI,EAAK,KAAA;AAAA,IACzD;AAEDjH,SAAKsU,SAASxc,MAAMD,GAAAA;AAEpB,QAAIk+I,WAAW5B,QAAQn0I,IACvB;AAAA,QAAIg2I,eAAe9B,YAAYl0I,IAC/B;AAAA,QAAI+1I,YAAYC,gBAAgBD,SAAStlI,QAAQG,WAAWolI,aAAavlI,QAAQG,SAAQ;AACxF,UAAIqlI,gBAAgBzB,qBAAqBx0I,MAAM+1I,UAAU,SACzDE;AAAAA,oBAAc3hI,SAAS,MAAMzc,GAC7B;AAAA,IAAA;AAAA,EACD,GACDi+I,eAAe,WAAA;AACd,QAAI9xI,SAAS,EACZxK,GAAG,OACHH,GAAG,OACHujG,OAAO,GACPuX,OAAO,GACP8F,aAAaj6G,KAAKsF,OAAO20G,cAAc,GACvChG,SAAS,GACTC,SAAS,EAAA;AAGV,QAAIgiC,YAAYnG,qBAAqB/vI,IAAAA,GACpCm2I,YAAYnG,uBAAuBhwI,IAAAA;AACpC,QAAGm2I,WAAU;AACZ,UAAIC,WAAWD,UAAUxlI,eAAAA;AACzB,UAAGylI,SAASviC,SAAQ;AACnB7vG,eAAOxK,IAAI48I,SAAS/kC;AACpBrtG,eAAOiwG,UAAUmiC,SAAStiC;AAAAA,MAC1B;AACD9vG,aAAO44F,QAAQw5C,SAASzyI,YAAY;AAAA,IACpC;AAED,QAAGuyI,WAAU;AACZ,UAAIG,WAAWH,UAAUvlI,eAAAA;AACzB,UAAG0lI,SAASxiC,SAAQ;AACnB7vG,eAAO3K,IAAIg9I,SAAShlC;AAEpBrtG,eAAOkwG,UAAUmiC,SAASviC;AAAAA,MAC1B;AACD9vG,aAAOmwG,QAAQkiC,SAAS1yI,YAAY;AAAA,IACpC;AAED,WAAOK;AAAAA,EACP,GACD2M,gBAAgB,WAAA;AACf,QAAI/M,QAAQ5D,KAAK81I;AACjB,WAAO,EAAEt8I,GAAEoK,MAAMg5F,OAAOvjG,GAAEuK,MAAMuwG,OAAO1kF,aAAY7rB,MAAMpK,GAAGo2B,cAAahsB,MAAMvK,GAAGI,OAAOmK,MAAMqwG,SAASv6G,QAAQkK,MAAMswG,QACtH;AAAA,EAAA,GAEDr2B,eAAe,SAASy4D;AACvB,WAAOt2I,KAAKmP,IAAIC,QAAQknI,QAAAA;AAAAA,EACxB,GAEDnlI,kBAAkB,SAASmlI,UAAUx+I,MAAMD,KAC1C;AAAA,UAAM8kC,OAAO38B,KAAKmP,IAAIC,QAAQknI,QAAAA;AAC9B,QAAK35G,CAAAA,MAAK;AACT,aAAO;AAAA,IACP;AACD,QAAI7kC,SAAS,MAAK;AACjB,YAAMy+I,mBAAmBv2I,KAAKmP,IAAIC,QAAQutB,KAAKlsB,QAAQC,OAAAA;AACvD,UAAI6lI,kBAAiB;AACpBA,yBAAiBjiI,SAASxc,MAAM,IAAA;AAAA,MAChC;AAAA,IACD;AACD,QAAID,QAAQ,MAAK;AAChB,YAAM2+I,iBAAiBx2I,KAAKmP,IAAIC,QAAQutB,KAAKlsB,QAAQG;AACrD,UAAI4lI,gBAAe;AAClBA,uBAAeliI,SAAS,MAAMzc,GAAAA;AAAAA,MAC9B;AAAA,IACD;AAAA,EACD;AAIH;ACtYe,SAAQo3G,WAAClsG,QAAAA;AAAAA,SAChBA,OAAMqsG;AAAAA,SACNrsG,OAAM0sG;AACd;ACHA,SAASgnC,WAAWr+H,KAAK3F,OAAM2wB;AAC9B,WAAS/pB,OAAO5G,MACf,KAAA,OAAW2F,IAAIiB,GAAQ,KAAA,eAAe+pB,MACrChrB,KAAIiB,GAAO5G,IAAAA,MAAK4G;AACnB;AAEA,SAASq9H,UAAUtzG,OAAOrgC,QAEzB;AAAA,QAAMkc,SAASllB,iBAAiBgJ,OAAMgC,KACtC;AAAA,QAAM4xI,WAAW13H,OAAOq6E,iBAAiB,mBACzC;AAAA,MAAIs9C,kBAAkBD;AACtB,MAAIE;AAGJ,MAAGD,eAAc;AAChBC,gBAAYF;AAAAA,EACd,OAAM;AACJ,QAAIp+H,QAAOxV,OAAMwV;AACjBs+H,gBAAYt+H;AACZ,SAAKA,SAAQ6qB,OAAO;AACnB,UAAIzlB,QAAQvlB,SAASkhD,qBAAqB,MAC1C;AAAA,eAASx9C,IAAI,GAAGA,IAAI6hB,MAAM5hB,QAAQD,KAAK;AACtC,YAAIymB,MAAM5E,MAAM7hB,CAAGg7I,EAAAA,KAAKr7H,MAAM,2BAC9B;AAAA,YAAI8G,KAAK;AACR,cAAIxf,OAAM+tI,MAAMvuH,IAAI,CAAA,CAAA,KAAA,CAAQhK,OAAM;AACjCs+H,wBAAYt0H,IAAI,CAChB;AAAA;AAAA,UACA;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAAA,EACD;AACDxf,EAAAA,OAAMg0I,cAAc,EACnBC,OAAOH,WACPI,aAAaL,cAAAA;AAKd7zI,EAAAA,OAAMwV,OAAOs+H,aAAa;AAC1B,MAAIK,UAAUn0I,OAAM+tI,MAAM/tI,OAAMwV,SAASxV,OAAM+tI,MAAM;AAGrD2F,aAAW1zI,OAAMuC,QAAQ4xI,QAAQ5xI,QAAQ89B,KAEzC;AAAA,MAAA,CAAIwzG,eAAc;AACjB7zI,IAAAA,OAAMuC,OAAOy2H,cAAc;AAAA,EAC3B;AAED,MAAIz2H,UAASvC,OAAMuqB,eAAAA;AACnB,MAAIhoB,QAAO,CAAOvC,KAAAA,CAAAA,OAAMugC,QAAQh+B,QAAO,CAAA,EAAG7L,OACzC6L,CAAAA,QAAO,CAAA,EAAG7L,QAAQy9I,QAAQC;AAC3B,MAAI7xI,QAAO,CAAOvC,KAAAA,CAAAA,OAAMugC,QAAQh+B,QAAO,CAAA,EAAG7L,KACzC6L,EAAAA,CAAAA,QAAO,CAAG7L,EAAAA,QAAQy9I,QAAQE;AAE3B,WAASt7I,IAAE,GAAGA,IAAEwJ,QAAOvJ,QAAQD,KAAK;AACnC,QAAI65B,SAASrwB,QAAOxJ,CACpB;AAAA,QAAI65B,OAAOt4B,QAAQ,OAAO;AACzB,WAAIs4B,OAAOl8B,OAAM;AAChBk8B,eAAOl8B,QAAQ;AAAA,MACf;AACD,UAAA,EAAMsJ,OAAMugC,QAAQ3N,OAAOu2F,SAAAA,KAAcnpH,OAAMugC,QAAQ3N,OAAOy2F,aAAa;AAC1Ez2F,eAAOu2F,YAAYv2F,OAAOu2F,aAAav2F,OAAOl8B;AAC9Ck8B,eAAOy2F,YAAYz2F,OAAOy2F,aAAaz2F,OAAOl8B;AAAAA,MAC9C;AACD,UAAIk8B,OAAOu2F,UACVv2F,QAAOu2F,YAAAA,CAAav2F,OAAOu2F;AAC5B,UAAIv2F,OAAOy2F,UACVz2F,QAAOy2F,YAAAA,CAAaz2F,OAAOy2F;AAC5B,UAAIz2F,OAAOl8B,OAAO;AACjBk8B,eAAOl8B,QAAAA,CAASk8B,OAAOl8B;AACvBk8B,eAAOl8B,QAASk8B,OAAOu2F,aAAav2F,OAAOu2F,YAAYv2F,OAAOl8B,QAASk8B,OAAOu2F,YAAYv2F,OAAOl8B;AACjGk8B,eAAOl8B,QAASk8B,OAAOy2F,aAAaz2F,OAAOy2F,YAAYz2F,OAAOl8B,QAASk8B,OAAOy2F,YAAYz2F,OAAOl8B;AAAAA,MACjG;AAAA,IACD;AAAA,EACD;AAED,MAAIy9I,QAAQ5xI,OAAOuwC,aAAY;AAC9B9yC,IAAAA,OAAMuC,OAAOuwC,cAAcqhG,QAAQ5xI,OAAOuwC,eAAe;AAAA,EACzD;AACD,MAAIqhG,QAAQ5xI,OAAOwwC,YAAW;AAC7B/yC,IAAAA,OAAMuC,OAAOwwC,aAAaohG,QAAQ5xI,OAAOwwC,cAAc;AAAA,EACvD;AAED,MAAIohG,QAAQG,mBACXt0I,CAAAA,OAAMs0I,qBAAqBH,QAAQG;AAEpC,MAAIH,QAAQI,4BAA4B;AACvCv0I,IAAAA,OAAMuC,OAAO0vC,gBAAgBkiG,QAAQI,2BAA2B,eAAA;AAChEv0I,IAAAA,OAAMuC,OAAOqvC,eAAeuiG,QAAQI,2BAA2B,cAAA;AAAA,EAC/D;AAGDv0I,EAAAA,OAAMy6F,cACP;AAAA;AAIe,SAAQjlF,KAACxV,QAAAA;AAEvB,MAAIA,CAAAA,OAAMw0I,WAAU;AACnBx0I,IAAAA,OAAMw0I,YAAY,WAAA;AACjBv3I,WAAKuY,OAAO;AACZm+H,gBAAU,MAAM12I,IACnB;AAAA,IAAA;AACE+C,IAAAA,OAAM+tI,QAAQ;AAEd/tI,IAAAA,OAAMyE,YAAY,sBAAsB,WAAA;AACvCkvI,gBAAU,OAAO12I;AACjBw3I,yBACH;AAAA,IAAA,CAAA;AAAA,EACE;AAEDz0I,EAAAA,OAAM00I,iBAAiB,WAAA;AACtBr/I,aAASE,gBAAgB00B,aAAa,oBAAoBjqB,OAAMwV,IAClE;AAAA,EAAA;AAECxV,EAAAA,OAAM20I,UAAU,SAAS3+H;AACxB/Y,SAAKuY,OAAOQ;AACZhW,IAAAA,OAAM00I,eAAAA;AACND,uBACA;AAAA,QAAGz0I,OAAMgC,OAAM;AACd2xI,gBAAU,MAAM3zI,MAChB/C;AAAAA,WAAK0F,OACL;AAAA,IAAA;AAAA,EAGH;AAGC,MAAIiyI,oBAAoB;AACxB,WAASH,qBACR;AAAA,UAAM34G,YAAY97B,OAAMgC;AAExB,QAAG4yI,mBAAkB;AACpBvgH,oBAAcugH,iBACd;AAAA,IAAA;AAED,QAAG94G,WAAU;AACZ84G,0BAAoBxgH,YAAY,MAC/B;AAAA,cAAMygH,WAAW79I,iBAAiB8kC,SAAAA,EAAWy6D,iBAAiB,mBAC9D;AAAA,YAAGs+C,YAAYA,aAAa70I,OAAMwV,MAAK;AACtCxV,UAAAA,OAAM20I,QAAQE;QACd;AAAA,MAEC,GAAA,GAAA;AAAA,IACH;AAAA,EACD;AACD70I,EAAAA,OAAMyE,YAAY,aAAa,WAC9B4vB;AAAAA,kBAAcugH;EAChB,CACA;AAAA;ACvJe,SAAQE,QAAC90I,QACxBA;AAAAA,EAAAA,OAAM+tI,MAAM+G,UAAU,EACrBvyI,QAAO,EACN6vG,YAAW,KACXxmG,YAAY,IACZonC,oBAAmB,GACnB33B,cAAc,IACdi+G,iBAAgB,GAChBroF,iBAAgB,GAChB+nF,aAAY,GACZ+b,4BAA2B,MAE5BX,sBAAqB,IACrBC,qBAAoB,GAAA;AAGrB;AChBe,SAAQW,OAACh1I,QACxBA;AAAAA,EAAAA,OAAM+tI,MAAMiH,SAAS,EACpBzyI,QAAO,EACN6vG,YAAW,KACXxmG,YAAY,IACZyP,cAAc,IACdi+G,iBAAgB,GAChBroF,iBAAgB,IAChB+B,oBAAmB,GACnB+hG,4BAA2B,GAE5BX,GAAAA,sBAAqB,IACrBC,qBAAoB,GAGrB;AAAA;ACfe,SAAQY,QAACj1I,QAAAA;AACxBA,EAAAA,OAAM+tI,MAAMkH,UAAU,EACrB1yI,QAAO,EACN6vG,YAAW,KACXxmG,YAAY,IACZyP,cAAc,IACdi+G,iBAAgB,GAChBroF,iBAAgB,IAChB+B,oBAAmB,GACnB+hG,4BAA2B,GAAA,GAE5BX,sBAAqB,KACrBC,qBAAoB;AAGrB;ACfe,SAAQa,SAACl1I,QAAAA;AACvBA,EAAAA,OAAM+tI,MAAMmH,WAAW,EACtB3yI,QAAQ,EACP6vG,YAAY,KACZxmG,YAAY,IACZyP,cAAc,IACdi+G,iBAAiB,GACjBroF,iBAAiB,GACjB+B,oBAAmB,GACnB+hG,4BAA4B,GAAA,GAE7BX,sBAAsB,KACtBC,qBAAqB,IAErBC,oBAAoB,sNACpBa,sBAAsB,CAAE,GACxBC,uBAAuB,EACtB30C,kBAAoB,eACpBF,gBAAkB,YAAA,EAAA;AAGrB;ACrBe,SAAQ80C,SAACr1I,QACvBA;AAAAA,EAAAA,OAAM+tI,MAAMsH,WAAW,EACtB9yI,QAAQ,EACP6vG,YAAY,KACZxmG,YAAY,IACZyP,cAAc,IACdi+G,iBAAiB,GACjBroF,iBAAiB,IACjB+B,oBAAmB,GACnB+hG,4BAA4B,MAE7BX,sBAAsB,KACtBC,qBAAqB,IACrBE,4BAA4B,EAC3B3iG,cAAgB,CAAC,gBAAA,GACjBK,eAAiB,CAAC,kBAAkB,cAItCjyC,EAAAA,EAAAA;AAAAA,EAAAA,OAAMyE,YAAY,mBAAmB,SAAUP,IAC9C;AAAA,QAAIiS,KAAInW,OAAMia,YAAY/V,EAAAA;AAC1B,QAAIiS,IAAG;AACNA,MAAAA,GAAEnc,aAAa;AACf6N,iBAAW,WACV;AAAA,YAAIytI,OAAOn/H,GAAEnc,UAAUE,QAAQ;AAC/B,YAAIo7I,OAAAA,IAAW;AACdn/H,UAAAA,GAAEnc,YAAYmc,GAAEnc,UAAUnB,MAAM,GAAGy8I,IACnC;AAAA,QAAA;AAAA,MACD,GAAE,GACH;AAAA,IAAA;AAAA,EACH;AAEA;AChCe,SAAQC,KAACv1I,QACxBA;AAAAA,EAAAA,OAAM+tI,MAAMwH,OAAO,EAClBhzI,QAAO,EACN6vG,YAAW,KACXxmG,YAAY,IACZyP,cAAc,IACdi+G,iBAAgB,GAChBroF,iBAAgB,IAChB+B,oBAAmB,GACnB+hG,4BAA2B,MAE5BX,sBAAqB,KACrBC,qBAAoB,GAGrB;AAAA;ACfe,SAAQmB,eAACx1I,QAAAA;AACxBA,EAAAA,OAAM+tI,MAAM,gBAAoB,IAAA,EAC/BxrI,QAAO,EACN6vG,YAAW,KACXxmG,YAAY,IACZyP,cAAc,IACdi+G,iBAAgB,GAChBroF,iBAAgB,IAChB8jG,4BAA2B,GAAA,GAE5BX,sBAAqB,KACrBC,qBAAoB;AAGrB;ACde,SAAQoB,eAACz1I,QACxBA;AAAAA,EAAAA,OAAM+tI,MAAM,gBAAA,IAAoB,EAC/BxrI,QAAO,EACN6vG,YAAW,KACXxmG,YAAY,IACZyP,cAAc,IACdi+G,iBAAgB,GAChBroF,iBAAgB,IAChB8jG,4BAA2B,GAE5BX,GAAAA,sBAAqB,KACrBC,qBAAoB,GAAA;AAGrB;ACXe,SAAQnzI,WAAClB;AAEvB,MAAI01I,cAAc,IACjBhxB,aAAa,IACbixB,cAAc,IACdC,cAAc;AAEf,MAAIzhH,WAAW,MACd0hH,SAAS,OACTC,eAAe,MACfC,WAAW,EACVj0F,SAAS,SAEVk0F,WAAW,CAAA;AAGZ,WAASC,YAAYr7I;AACpB,WAAOA,WACNg3B,UAAqBh3B,SAASoF,OAAMgC,KAAAA,KACpCpH,QAAQ3E;AAAAA,EACT;AAED,WAASigJ,yBAAAA;AACR,QAAIt7I;AACJ,QAAGq7I,YAAYj2I,OAAMsN,KAAO,GAAA;AAC3B1S,gBAAUoF,OAAMsN;AAAAA,IAChB,WAAQ2oI,YAAYj2I,OAAMmsB,KAAAA,GAAO;AACjCvxB,gBAAUoF,OAAMmsB;AAAAA,IACnB,OAAO;AACJvxB,gBAAUoF,OAAMgC;AAAAA,IAChB;AAED,WAAOpH;AAAAA,EACP;AAED,WAASu7I;AACR,QAAIC,aAAAA,CAAAA,CAAe/gJ,SAAS6F,cAAc,oBAC1C;AAAA,QAAIm7I,aAAahhJ,SAAS6F,cAAc,kDAClC7F,SAAS6F,cAAc;AAC7B,QAAIo7I,SAAAA,CAAAA,CAAWjhJ,SAAS6F,cAAc,uBACtC;AAAA,QAAI2F,QAAQb,OAAMwK,SAAAA;AAClB,QAAI+rI,cAAc11I,MAAMK;AACxB20I,aAASO,cAAeC,CAAAA,YAAAA,CAAaC;AAErC,WAAA,EAAA,CAAWz1I,MAAM+vC,aAAAA,CAAcwlG,cAAeC,aAAaE;AAAAA,EAC3D;AAED,WAASC,mBAAmB31I;AAC3B,QAAIi1I,cAAc;AACjBhuI,mBAAaguI,YACbA;AAAAA,qBAAe;AAAA,IACf;AACD,QAAIj1I,OAAO;AACV,UAAI41I,QAAQz2I,OAAMuC,OAAOgtC;AACzB,UAAIknG,SAASA,QAAQ,GACpBA,SAAQ;AAETX,qBAAejuI,WAAW,WAAA;AACzBssB,mBAAWC,YAAYsiH,MAAMD,SAASb,WAAAA;AAAAA,MACtC,GAAE51I,OAAMuC,OAAOo0I,oBAAoBhB,WAAAA;AAAAA,IACpC;AAAA,EACD;AAED,WAASiB,qBAAqB/1I;AAC7B,QAAIA,OAAO;AACV21I,yBAAmB,IACnB;AAAA,UAAA,CAAKT,SAASj0F,SAAS;AACtBi0F,iBAASt/I,IAAIu/I,SAASv/I;AACtBs/I,iBAASz/I,IAAI0/I,SAAS1/I;AACtBy/I,iBAASj0F,UAAU;AAAA,MACnB;AAAA,IACJ,OAAS;AACN,UAAI3tB,UAAU;AACbE,sBAAcF,QACdA;AAAAA,mBAAW;AAAA,MACX;AACDqiH,yBAAmB,KAAA;AACnBT,eAASj0F,UAAU;AAAA,IACnB;AAAA,EACD;AAED,WAAS+0F,mBAAmBv6I,QAC3B;AAAA,QAAIw6I,WAAWX,cAAAA;AAEf,SAAKhiH,YAAY2hH,kBAAkBgB,UAAU;AAC5CF,2BAAqB,KAAA;AAAA,IACrB;AAED,QAAA,CAAK52I,OAAMuC,OAAOrB,cAAAA,CAAe41I,UAAU;AAC1C,aAAO;AAAA,IACP;AAEDd,eAAW,EACVv/I,GAAG6F,OAAMsB,SACTtH,GAAGgG,OAAMuB,QAAAA;AAIV,QAAIvB,OAAM4S,QAAQ,aAAY;AAC7B8mI,eAASv/I,IAAI6F,OAAMsnD,cAAc,CAAA,EAAGhmD;AACpCo4I,eAAS1/I,IAAIgG,OAAMsnD,cAAc,CAAG/lD,EAAAA;AAAAA,IACpC;AAED,QAAKs2B,CAAAA,YAAY2iH,UAAU;AAC1BF,2BAAqB;IACrB;AAAA,EACD;AAED,WAASF,OAAAA;AAER,QAAKP,CAAAA,cAAAA,GAAiB;AACrBS,2BAAqB,KAAA;AACrB,aAAO;AAAA,IACP;AAED,QAAI96G,YAAYo6G,uBAChB;AAAA,QAAA,CAAIp6G,WAAU;AACb;AAAA,IACA;AAED,QAAIy1G,WAAW;AACf,QAAIC,cAAc,CACjB,6CACA,gDACA,0CAAA;AAEDA,gBAAYprI,QAAQ,SAAUhI,UAAAA;AAC7BmzI,iBAAWA,YAAcl8I,CAAAA,CAAAA,SAAS6F,cAAckD,QACnD;AAAA,IAAA,CAAA;AACE,QAAImzI,UAAS;AACZz1G,kBAAY97B,OAAMmsB;AAAAA,IAClB;AAED,QAAIh3B,MAAMmtC,gBAA2BxG;AAErC,QAAIg9D,OAAOk9C,SAASv/I,IAAItB,IAAIsB;AAC5B,QAAI4iG,OAAO28C,SAAS1/I,IAAInB,IAAImB,IAAIZ,OAAOmY;AAEvC,QAAIjY,aAAaigJ,SAAS,IAAIkB,YAAYj+C,MAAM3jG,IAAIuB,OAAOq/I,SAASt/I,IAAItB,IAAIsB,CAAAA;AAC5E,QAAIhB,YAAYshJ,YAAY19C,MAAMlkG,IAAIwB,QAAQo/I,SAASz/I,IAAInB,IAAImB,IAAIZ,OAAOmY,OAE1E;AAAA,QAAI4kD,cAAczyD,OAAM4N,eAAAA;AAExB,QAAIopI,mBAAmBvkF,YAAYn8D,GAClC2gJ,oBAAoBxkF,YAAY5lC,cAChCqqH,oBAAoBzkF,YAAY97D,QAChCwgJ,oBAAoB1kF,YAAYh8D,GAChC2gJ,mBAAmB3kF,YAAY/lC,aAC/B2qH,mBAAmB5kF,YAAY/7D;AAGhC,QAAIjB,cAAcwhJ,mBAAmB;AACpCxhJ,kBAAY;AAAA,IACZ,WAAUA,YAAY,KAAMuhJ,CAAAA,kBAAkB;AAC9CvhJ,kBAAY;AAAA,IACf,WAAaA,YAAY,KAAKuhJ,mBAAmBC,qBAAqBC,oBAAoB,GAAG;AAC1FzhJ,kBAAY;AAAA,IACZ;AAED,QAAIG,cAAAA,CAAewhJ,kBAAkB;AACpCxhJ,mBAAa;AAAA,IACb,WAAUA,aAAa,MAAMuhJ,mBAAmB;AAChDvhJ,mBAAa;AAAA,IACb,WAAUA,aAAa,KAAKuhJ,oBAAoBC,oBAAoBC,kBAAkB;AACtFzhJ,mBAAa;AAAA,IACb;AAED,QAAI8mB,OAAO1c,OAAMuC,OAAO+0I;AAExB,QAAI56H,QAAQA,OAAO,EAClBA,QAAO;AAER9mB,iBAAaA,cAAc8mB,QAAQgoG;AACnCjvH,gBAAYA,aAAainB,QAAQgoG;AAEjC,QAAI9uH,cAAcH,WAAW;AAC5B+a,aAAO5a,YAAYH,SACnB;AAAA,IAAA;AAAA,EACD;AAED,WAASshJ,YAAY7tI,KAAKquI,SAAShtC,YAClC;AAAA,QAAKrhG,MAAMwsI,cAAc,KAAOxsI,MAAMqhG,WACrC,QAAA;AAAA,aACSrhG,MAAMquI,UAAU7B,eAAiBxsI,MAAMqhG,WAChD,QAAO;AACR,WAAO;AAAA,EACP;AAED,WAAS/5F,OAAOzb,MAAMD,KACrB;AAAA,QAAI29D,cAAczyD,OAAM4N,eAAAA;AAExB,QAAIhY,aAAa,MAChBH,YAAY;AAEb,QAAIV,MAAM;AACTa,mBAAa68D,YAAYh8D,IAAI1B;AAC7Ba,mBAAaW,KAAKyS,IAAIypD,YAAY/7D,OAAOd;AACzCA,mBAAaW,KAAKuD,IAAI,GAAGlE,UACzB;AAAA,IAAA;AAED,QAAId,KAAK;AACRW,kBAAYg9D,YAAYn8D,IAAIxB;AAC5BW,kBAAYc,KAAKyS,IAAIypD,YAAY97D,QAAQlB,SAAAA;AACzCA,kBAAYc,KAAKuD,IAAI,GAAGrE,SACxB;AAAA,IAAA;AAEDuK,IAAAA,OAAMuR,SAAS3b,YAAYH,SAC3B;AAAA,EAAA;AAEDuK,EAAAA,OAAMyE,YAAY,gBAAgB,WACjC;AAAA,QAAA,CAAIyrD,WAAWlwD,MAAAA,GAAO;AACrB,UAAI8B,eAAeC,YAAuB/B,OAAMgC,KAAU3M,KAAAA,SAASD;AACnE4K,MAAAA,OAAMqvB,YAAYvtB,cAAc,aAAa+0I;AAC7C72I,MAAAA,OAAM1D,MAAMwF,cAAc,aAAa+0I,kBAAAA;AAEvC72I,MAAAA,OAAMqvB,YAAYvtB,cAAc,aAAa+0I;AAC7C72I,MAAAA,OAAM1D,MAAMwF,cAAc,aAAa+0I,kBAAAA;AAEvC72I,MAAAA,OAAMqvB,YAAYvtB,cAAc,eAAe+0I,kBAAAA;AAC/C72I,MAAAA,OAAM1D,MAAMwF,cAAc,eAAe+0I,kBAAAA;AAAAA,IACzC;AAAA,EACH,CAEC72I;AAAAA,EAAAA,OAAMyE,YAAY,aAAa,WAAA;AAC9BmyI,yBAAqB,KAAA;AAAA,EACvB,CAEA;AAAA;ACtOA,IAAIlhJ,OAAO8hJ,QAAO;AAEjB,GAAA,SAAWC,GAEV;AAAA,QAAInsG,UAAU,CACdmsG;AAAAA,MAAEC,GAAGC,YAAY,SAASp1I,SAAAA;AACzBA,MAAAA,UAASA,WAAU;AACnB,UAAW,OAAAA,YAAY,UAAU;AAChC,YAAI+oC,QAAQ/oC,OAAAA,GAAU;AACrB,iBAAO+oC,QAAQ/oC,OAAQrF,EAAAA,MAAMD,MAAM,CAAA,CAAA;AAAA,QACxC,OAAU;AACLw6I,YAAE54I,MAAM,YAAa0D,UAAS,qCAAA;AAAA,QAC9B;AAAA,MACL,OAAU;AACN,YAAI4hG,QAAQ;AACZlnG,aAAK26I,KAAK;AACT,cAAI36I,QAAQA,KAAK5F,cAAa;AAC7B,gBAAA,CAAK4F,KAAK+C,SAAWtK,EAAAA,OAAOsK,MAAMgC,SAAS/E,OAAM;AAEhD,kBAAI46I,WAAYniJ,OAAOsK,MAAMsM,cAAc5W,OAAOoiJ,QAASpiJ,OAAOoiJ,MAAMC,iBAAAA,IAAmBriJ,OAAOsK;AAClG,uBAASsW,OAAO/T,QACf,KAAI+T,OAAK,OACRuhI,UAASt1I,OAAO+T,GAAO/T,IAAAA,QAAO+T;AAEhCuhI,uBAASt9F,KAAKt9C;AACd,kBAAIsF,QAAOmN,KACVmoI,UAASljI,MAAMpS,QAAOmN;AAEvBy0F,oBAAMloG,KAAK47I;YACX,MACA1zC,OAAMloG,YAAYgB,KAAK+C,SAAS,WAAW/C,KAAK+C,QAAQtK,OAAOsK;UAChE;AAAA,QACN,CAAA;AAGI,YAAImkG,MAAMnrG,WAAW,EAAG,QAAOmrG,MAAM,CAAA;AACrC,eAAOA;AAAAA,MACP;AAAA,IACJ;AAAA,EAEE,GAAEzuG,OAAO8hJ;AAEX;AAGA,MAAAQ,eAAe;AC7Cf,IAAItiJ,OAAOuiJ,QAAO;AAEjB,MAAA,CAAKviJ,OAAOuiJ,OAAOC,SACnBxiJ,QAAOuiJ,OAAOC,WAAW;AAEzBxiJ,SAAOuiJ,OAAOC,SAASC,cAAY,SAASrvI,OAAOC,KAAK/I,QAAAA;AACvD,QAAIhE,MAAM3G,SAASoE,cAAc,KAEjCuG;AAAAA,IAAAA,SAAQA,UAAStK,OAAOsK;AAExBhE,QAAIkI,KAAK,WAAUlE,OAAM01B,IACzB15B;AAAAA,QAAI/E,MAAMP,QAAQ;AAClBsF,QAAI/E,MAAMN,SAAS;AACnBqF,QAAIo8I,MAAM;AAEV/iJ,aAASD,KAAKuE,YAAYqC,GAC1BiB;AAAAA,SAAKo7I,aAAar8I,IAAIkI,EAAAA;AACtBjH,SAAKq7I,WAAW;AAChBr7I,SAAKs7I,UAAUv4I;AAEf,QAAIwlE,OAAOvoE,KAAKu7I,GAAGv7I,KAAKw7I,EACxBjzE;AAAAA,SAAKr4C,OAAOntB;AAEZA,IAAAA,OAAMu6C,KAAKv+C,IAAIkI,IAAI4E,OAAOC;AAC1B/M,QAAIR,WAAWvE,MAAMyhJ,SAAS;AAE9BlzE,SAAKmzE,SAAS38I,IAAIkI;AAClBshE,SAAKozE,UAAU58I;AAEf,QAAI68I,cAAY;AAChB,WAAO57I,KAAKu7I,GAAGv7I,KAAK47I,WAAgB1rH,EAAAA,CAAAA,EAAAA;AAAAA,EACtC;AAEA;AACA,WAAWz3B,OAAuB,oBAAK,aAAa;AAEnDA,SAAOojJ,iBAAiBlgJ,UAAUu/I,cAAY,SAASrvI,OAAOC,KAAK/I,QAAAA;AAClEA,IAAAA,SAAQA,UAAStK,OAAOsK;AAExB,QAAIhE,MAAM3G,SAASoE,cAAc,KACjCuC;AAAAA,QAAIkI,KAAK,WAASlE,OAAM01B,IAAAA;AACxB15B,QAAI/E,MAAMP,QAAQ;AAClBsF,QAAI/E,MAAMN,SAAS;AACnBqF,QAAIo8I,MAAM;AAEV/iJ,aAASD,KAAKuE,YAAYqC,GAC1BiB;AAAAA,SAAKo7I,aAAar8I,IAAIkI,EAEtBjH;AAAAA,SAAKq7I,WAAW;AAChBr7I,SAAKs7I,UAAUv4I;AAEfA,IAAAA,OAAMu6C,KAAKv+C,IAAIkI,IAAI4E,OAAOC;AAC1B/M,QAAIR,WAAWvE,MAAMyhJ,SAAS;AAE9B18I,UAAM;AACNiB,SAAK+H,UAAU,oBAAmB,CAElC,CAAA;AAAA,WAAO/H,KAAKs7I;AAAAA,EACd;AACA;AAEA,MAAAQ,eAAe;AC3Cf,MAAMC,UAAU,CAAC,WAAW,UAAU,YAAY;AASlD,MAAMC,iBAAiB,CACtB,CACC,EACC9yI,MAAM,SACNmJ,MAAM,MACNoN,MAAM,EAEP,GAAA,EACCvW,MAAM,OACNmJ,MAAM,MACNoN,MAAM,EAGR,CAAA,GAAA,CACC,EACCvW,MAAM,OACNmJ,MAAM,SACNoN,MAAM,EAAA,CAAA,GAGR,CACC,EACCvW,MAAM,OACNmJ,MAAM,SACNoN,MAAM,EAAA,GAEP,EACCvW,MAAM,QACNmJ,MAAM,SACNoN,MAAM,EAAA,CAAA,GAGR,CACC,EACCvW,MAAM,OACNmJ,MAAM,SACNoN,MAAM,EAEP,GAAA,EACCvW,MAAM,QACNmJ,MAAM,SACNoN,MAAM,EAAA,CAAA,CAAA;AAKT,MAAqBw8H,aAkBpB;AAAA,EAAA,YAAYl5I,QAAAA;AA4CZ/C,SAAOk8I,SAAS;AACT,YAAA11I,QAAQxG,KAAKm8I,gBAAAA,IAAoB;AACvC,UAAG31I,QAAQ,GAAE;AACZ;AAAA,MACD;AACAxG,WAAKo8I,SAAS51I;IAAK;AAGpBxG,SAAOq8I,UAAU,MACV;AAAA,YAAA71I,QAAQxG,KAAKm8I,gBAAAA,IAAoB;AACvC,UAAG31I,QAAQxG,KAAKs8I,QAAQvgJ,SAAS,GAAE;AAClC;AAAA,MACD;AACAiE,WAAKo8I,SAAS51I,KAAAA;AAAAA,IAAK;AAGpBxG,SAAOm8I,kBAAkB,MACjBn8I,KAAKu8I;AAGbv8I,SAAOw8I,YAAY,MACXx8I,KAAKs8I;AAGNt8I,SAAAo8I,WAAY7qF,WACZ;AAAA,YAAAkrF,YAAYz8I,KAAK08I,oBAAoBnrF,KAE3C;AAAA,UAAGkrF,cAAiB,IAAA;AACnBz8I,aAAKsgE,OAAOlzB,OAAOqvG,cAAAA,IAAkB,qDAAqDlrF,QAAQ,4BAAA;AAAA,MACnG;AACKvxD,WAAAugB,UAAUk8H,WAAW,CAAC;AAAA,IAAA;AAGlBz8I,SAAA08I,sBAAuBC,eAAAA;AAChC,UAAIF,YAAAA;AACD,UAAA,OAAOE,cAAc,UAAS;AAC7B,YAACxiJ,CAAAA,MAAM4lE,OAAO48E,SAAAA,CAAAA,KAAgB38I,KAAKs8I,QAAQv8E,OAAO48E,SAAY,CAAA,GAAA;AAChEF,sBAAY18E,OAAO48E;QAAS,OACxB;AACJ,mBAAQ7gJ,IAAI,GAAGA,IAAIkE,KAAKs8I,QAAQvgJ,QAAQD,KAAI;AAC3C,gBAAGkE,KAAKs8I,QAAQxgJ,CAAGuB,EAAAA,SAASs/I,WAAU;AACzBF,0BAAA3gJ;AACZ;AAAA,YACD;AAAA,UACD;AAAA,QACD;AAAA,MAAA,OACI;AACQ2gJ,oBAAAE;AAAAA,MACb;AACO,aAAAF;AAAAA,IAAA;AAeRz8I,SAAU48I,kBAAkB,MAEvB;AAAA,UAAA,CAAC58I,KAAKsgE,OAAOjwD,OAAM;AACf,eAAA;AAAA,MACR;AACA,YAAMwxH,YAAY7hI,KAAKsgE,OAAO3vD,eAAiBnX,EAAAA;AACzC,YAAAsM,WAAW9F,KAAKsgE,OAAOjwD,MAAMtX;AACnCiH,WAAK68I,eAAe78I,KAAKsgE,OAAOpzD,YAAY20H,YAAY/7H,WAAS,CAAC;AAAA,IAAA;AAGzD9F,SAAAugB,YAAY,CAACgxC,OAAeurF,iBAAAA;AACrC98I,WAAKu8I,oBAAoBhrF;AAEzB,YAAMxuD,SAAQ/C,KAAKsgE;AACnB,YAAMy8E,aAAah6I,OAAMsB,KAAKrE,KAAKs8I,QAAQt8I,KAAKu8I,iBAAAA,CAAAA;AAC1C,YAAAS,cAAcj6I,OAAMsB,KAAK04I,UAAAA;AAAAA,aACxBC,YAAY3/I;AAEnB0F,MAAAA,OAAMyP,MAAMzP,OAAMuC,QAAQ03I,aAAa,IAAA;AAGvC,YAAMC,gBAAgB,CACrB,oBACA,mBAAA;AAGaA,oBAAA9zI,QAAQ,SAAS9L,MAC9B;AAAA,cAAM6/I,eAAen6I,OAAMoM,IAAIC,QAAQ/R,IACvC;AAAA,YAAI6/I,cAAa;AACV,gBAAAC,iBAAiBD,aAAar2C,WAChC;AAAA,cAAA,CAACs2C,eAAeC,cAAa;AAC1Br6I,YAAAA,OAAAyP,MAAM2qI,gBAAgBH,aAAa,IAC1C;AAAA,UAAA;AAAA,QACD;AAAA,MAAA,CAAA;AAGD,YAAMxjB,aAAez2H,CAAAA,CAAAA,OAAMgC,WAAWhC,OAAMsN;AAE5C,UAAGmpH,YAAW;AACb,YAAGsjB,cAAa;AACT,gBAAAO,aAAar9I,KAAKsgE,OAAOpzD,YAAY4vI,eAAe98I,KAAKsgE,OAAO3vD,eAAiBnX,EAAAA,CAAAA;AACvFwG,eAAKsgE,OAAO56D,OACZ;AAAA,gBAAM43I,cAAct9I,KAAKsgE,OAAOp0C,YAAYmxH,UACvCr9I;AAAAA,eAAAsgE,OAAOhsD,SAASgpI,cAAcR,YAAY;AAAA,QAAA,OAC3C;AACE,gBAAAh3I,WAAW9F,KAAKsgE,OAAOjwD,MAAMtX;AAChC,cAACiH,CAAAA,KAAK68I,cAAa;AACrB78I,iBAAK48I,gBACN;AAAA,UAAA;AACA,gBAAMW,aAAav9I,KAAK68I;AACxB78I,eAAKsgE,OAAO56D,OACZ;AAAA,gBAAM43I,cAAct9I,KAAKsgE,OAAOp0C,YAAYqxH,UAAAA;AAC5Cv9I,eAAKsgE,OAAOhsD,SAASgpI,cAAcx3I,WAAS,CAC7C;AAAA,QAAA;AAEA9F,aAAK+H,UAAU,eAAe,CAAC/H,KAAKu8I,mBAAmBQ,UAAAA,CAAAA;AAAAA,MACxD;AAAA,IAGO/8I;AAAAA,SAAAw9I,oBAAqBl4I,CAAAA,YACtB;AAAA,YAAAjG,SAAQo4C,IAAIU,OAAO,UAAU;AAC/B,UAAA52C;AACD,UAAA,OAAO+D,QAAO3H,YAAY,YAAW;AACvC4D,aAAK+D,QAAO3H,QAAAA;AAAAA,MAAQ,OAChB;AACJ4D,aAAK+D,QAAO3H;AAAAA,MACb;AACA,UAAA,CAAK4D,IAAG;AACP;AAAA,MACD;AAEKvB,WAAAkD,WAAWsB,OAAOjD,IAAIlC,QAAOW,KAAKsgE,OAAO34D,KAAK,SAASzI,GAC3D;AAAA,YAAIc,KAAKy9I,SAAS;AACjB,cAAI1B,QAAQ9+I,QAAQ+C,KAAKy9I,OAAW,IAAA,GAAG;AAC/B,mBAAA;AAAA,UACR;AACA,eAAKv+I,EAAEc,KAAKy9I,UAAU;AACd,mBAAA;AAAA,UACR;AAAA,QACD;AACI,YAAOz9I,OAAAA,KAAK09I,aAAa,YAAY;AACxC19I,eAAK09I,SAASz9I,MAAMD,MAAM,CAACd,CAAAA,CAAAA;AACpB,iBAAA;AAAA,QACR;AAAA,SACEc,IAAAA,GAAO,EAAC+jD,SAAS;IAAM;AAGnB/jD,SAAA29I,kBAAmBz+I,OAC1B;AAAA,YAAM0+I,iBAAiB59I,KAAKsgE,OAAOjwD,MAAMpY,sBAAAA,EAAwBuB;AAC3D,YAAAsjJ,eAAe59I,EAAEyB,UAAUi9I;AAC3B,YAAAC,SAAS79I,KAAKsgE,OAAO7oB,IAAIU,OAAQj5C,EAAE89G,SAAAA,MAAc99G,EAAE+9G;AACzD,UAAI6gC,UAAU;AACd,UAAID,SAAS,GAAG;AACLC,kBAAA;AAAA,MACX;AACA5+I,QAAE0rB,eAAAA;AACF1rB,QAAE6+I,gBACG/9I;AAAAA,WAAAg+I,kBAAkBF,SAAShB,YAAY;AAAA,IAAA;AAW7C98I,SAAQi+I,iBAAiB,MAAA;AACrB,UAAAj+I,KAAKk+I,qBAAqBl+I,KAAKm+I,iBAAgB;AAC5Cn+I,aAAAsgE,OAAOh7D,OAAO6M,aAAanS,KAAKk+I;AAChCl+I,aAAAsgE,OAAOh7D,OAAO8M,WAAWpS,KAAKm+I;AAAAA,MACpC;AAAA,IA3NAn+I;AAAAA,SAAKsgE,SAASv9D;AACT/C,SAAAkD,aAAalD,KAAKsgE,OAAOn9D,qBAC/B;AAAA,EAAA;AAAA,EAEO,KAAKmC;AAGR,QAAAtF,KAAKsgE,OAAO7oB,IAAIc,QAAO;AACzB;AAAA,IACD;AACAv4C,SAAKk+I,oBAAoB54I,QAAOysE;AAChC/xE,SAAKm+I,kBAAkB74I,QAAO0sE;AAC9BhyE,SAAKu8I,oBAAoBj3I,QAAO84I,mBAAmB94I,QAAO84I,mBAAmB;AAC7Ep+I,SAAKs8I,UAAUt8I,KAAKq+I,WAAW/4I,QAAOg5I,UAAUtC;AAC3Ch8I,SAAA09I,WAAWp4I,QAAOwB,WAAW9G,KAAK29I;AAClC39I,SAAAu+I,kBAAkBj5I,QAAOk5I,kBAAkB;AAC3Cx+I,SAAAy+I,kBAAkBn5I,QAAOo5I,kBAAkB;AAChD1+I,SAAK2+I,aAAar5I,QAAOs5I,aAAa,IAAE,IAAIt5I,QAAOk5I;AACnDx+I,SAAKy9I,UAAUn4I,QAAOjC;AAEnB,QAAA,CAACrD,KAAKipE,cAAa;AACrBv8D,oBAAU1M,IAAAA;AACLA,WAAAsgE,OAAO94D,YAAY,iBAAiB,MAAA;AACxCxH,aAAK48I,gBAAAA;AAAAA,MAAgB,CAEvB;AAAA,IAAA;AAEA58I,SAAKkD,WAAW0C,UAAAA;AAEb,QAAAN,QAAOkmI,YAAY,SAAQ;AAC1B,UAAAxrI,KAAKsgE,OAAOv7D,OAAM;AACpB/E,aAAKw9I,kBAAkBl4I,OAAAA;AAAAA,MAAM,OACzB;AACCtF,aAAAsgE,OAAO94D,YAAY,gBAAgB,MAAA;AACvCxH,eAAKw9I,kBAAkBl4I,OAAAA;AAAAA,QAAM;MAE/B;AAAA,IACD;AAEAtF,SAAKipE,eAAe;AACfjpE,SAAAo8I,SAASp8I,KAAKu8I,iBAAAA;AAAAA,EACpB;AAAA,EAsDU,WAAW+B;AACb,WAAAA,OAAO/0I,IAAK0uF,OAAAA;AACf,UAAAv8F,MAAMoO,QAAQmuF,CAAG,GAAA;AACZ,eAAA,EACN9jF,QAAQ8jF,EAAAA;AAAAA,MACT,OACI;AACG,eAAAA;AAAAA,MACR;AAAA,IAAA,CAAA;AAAA,EAEF;AAAA,EAsGQ,kBAAkB6lD,SAAkBhB,cAAAA;AAC3C,QAAIgB,SAAS;AACZ99I,WAAK6+I,QAAQ/B,YAAAA;AAAAA,IAAY,OACnB;AACN98I,WAAK8+I,UAAUhC;IAChB;AAAA,EACD;AAAA,EASQ,QAAQA,cAAAA;AACf,QAAI98I,KAAKu8I,qBAAqBv8I,KAAKs8I,QAAQvgJ,SAAS,GAAG;AACtD;AAAA,IACD;AAEA,QAAIgjJ,YAAY/+I,KAAKu8I;AACrBv8I,SAAKi+I,eAAAA;AAEL,QAAGj+I,KAAK2+I,YAAW;AAClB,UAAIzzB,iBAAiBlrH,KAAKsgE,OAAOh7D,OAAO0Y,mBAAmBhe,KAAK2+I;AAC5D,UAAAzzB,iBAAiBlrH,KAAKy+I,iBAAiB;AAC1CvzB,yBAAiBlrH,KAAKu+I;AACtBQ;AAAAA,MACD;AAEK/+I,WAAAsgE,OAAOh7D,OAAO0Y,mBAAmBktG;AAAAA,IAAA,OAClC;AACJ6zB;AAAAA,IACD;AACK/+I,SAAAugB,UAAUw+H,WAAWjC;EAC3B;AAAA,EACQ,UAAUA,cACb;AAAA,QAAA98I,KAAKu8I,oBAAoB,GAAG;AAC/B;AAAA,IACD;AAEA,QAAIwC,YAAY/+I,KAAKu8I;AACrBv8I,SAAKi+I,eAEL;AAAA,QAAGj+I,KAAK2+I,YAAW;AAClB,UAAIzzB,iBAAiBlrH,KAAKsgE,OAAOh7D,OAAO0Y,mBAAmBhe,KAAK2+I;AAC5D,UAAAzzB,iBAAiBlrH,KAAKu+I,iBAAiB;AAC1CrzB,yBAAiBlrH,KAAKy+I;AACtBM;AAAAA,MACD;AACK/+I,WAAAsgE,OAAOh7D,OAAO0Y,mBAAmBktG;AAAAA,IAAA,OAClC;AACJ6zB;AAAAA,IACD;AACK/+I,SAAAugB,UAAUw+H,WAAWjC,YAAAA;AAAAA,EAC3B;AC5Vc;AAAA,SAAQjxG,QAAC9oC,QAAAA;AACvB,OAAIA,OAAMoC,KAAI;AACbpC,IAAAA,OAAMoC,MAAM;EACZ;AAED,MAAIs5E,UAAU,CACbx6E,YACA82I,cACAe,YAGD;AAAA,WAAQhgJ,IAAI,GAAGA,IAAI2iF,QAAQ1iF,QAAQD,KAAI;AACtC,QAAG2iF,QAAQ3iF,CAAAA,EACV2iF,SAAQ3iF,CAAGiH,EAAAA,MAAAA;AAAAA,EACZ;AAEDA,EAAAA,OAAMoC,IAAI65I,OAAO,IAAI/C,aAAal5I,MAAAA;AACnC;ACvBe,SAAQikC,MAACjkC;AAEvBA,EAAAA,OAAMuC,OAAOg/C,aAAa;AAC1BvhD,EAAAA,OAAMuC,OAAO0hC,QAAQ;AACrBjkC,EAAAA,OAAMuC,OAAO25I,iBAAiB;AAC9Bl8I,EAAAA,OAAMuC,OAAO45I,0BAA0B;AACvCn8I,EAAAA,OAAMyjD,wBAAwB;AAG9BzjD,EAAAA,OAAM2jD,kBAAkB,WAAA;AACvB,QAAI3jD,OAAMuC,OAAO25I,gBAAgB;AAChC,UAAItnG,UAAUwnG,QACbxnG,WAAUwnG,QAAQp8I,OAAMuC,OAAO45I,uBAAAA;AAAAA,IAChC;AAAA,EACH;AAECn8I,EAAAA,OAAMyE,YAAY,gBAAgB,WACjC;AAAA,QAAIzE,OAAMsM,YAAY;AACrB+vI,qBAAAA;AAAAA,IACA;AAAA,EACH,CACCr8I;AAAAA,EAAAA,OAAMyE,YAAY,sBAAsB,WAAA;AACvC,QAAIzE,OAAMsM,YAAY;AACpBtM,MAAAA,OAAMyE,YAAY,iBAAiB43I,gBAAgB,EAACl4I,MAAM,KAC3D,CAAA;AAAA,IAAA;AAAA,EACH,CAEC;AAAA,WAASk4I;AACR,QAAIr8I,OAAMuC,OAAO0hC,SAAS,QACzBjkC,CAAAA,OAAMuC,OAAO0hC,QAAQjkC,OAAMuC,OAAO0hC,UAC/B2Q,UAAUC,UAAU36C,QAAQ,QAAA,KAAA,MAC5B06C,UAAUC,UAAU36C,QAAQ,iBAC5B06C,UAAUC,UAAU36C,QAAQ,SAAe,KAAA,MAC3C06C,UAAUC,UAAU36C,QAAQ,OAAa,KAAA,OACxC06C,UAAU0nG,aAAa,cAAc1nG,UAAU2nG,iBAAiB;AAErE,QAAIv8I,OAAMuC,OAAO0hC,OAAO;AAEvB,UAAI+e,uBAAuB;AAC3B,UAAA;AACC3tD,iBAASouC,YAAY,YAAA;AAAA,MACrB,SAAQtnC,GAAAA;AACR6mD,+BAAuB;AAAA,MACvB;AAED,UAAIA,sBAAsB;AACzBhjD,QAAAA,OAAMw8I,cAAc,CAAC,aAAa,cAAc,UAAa,GAAA,SAAU9+I;AACtE,cAAIA,GAAGulD,WAAWvlD,GAAGulD,QAAQjqD,SAAS,EAAG,QAAO;AAChD,cAAI0E,GAAGulD,QAAQ,CAAA,EACd,QAAO,EACN1mD,QAAQmB,GAAGnB,QACX8jD,OAAO3iD,GAAGulD,QAAQ,CAAG5C,EAAAA,OACrBC,OAAO5iD,GAAGulD,QAAQ,GAAG3C,OACrB1iD,SAASF,GAAGulD,QAAQ,CAAGrlD,EAAAA,SACvBC,SAASH,GAAGulD,QAAQ,CAAGplD,EAAAA,QAAAA;AAAAA,cAGxB,QAAOH;AAAAA,QACb,GAAO,WACF;AAAA,iBAAO;AAAA,QACZ,CAAA;AAAA,MACA,WAAchI,OAAOk/C,UAAUuO,gBAAgB;AAC3CnjD,QAAAA,OAAMw8I,cAAc,CAAC,eAAe,eAAe,WAAc,GAAA,SAAU9+I,IAC1E;AAAA,cAAIA,GAAG0lD,eAAe,QAAS,QAAO;AACtC,iBAAO1lD;AAAAA,QACP,GAAE,SAAUA,IAAAA;AACZ,iBAASA,CAAAA,MAAOA,GAAG0lD,eAAe;AAAA,QACvC,CACA;AAAA,MAAA,WAAc1tD,OAAOk/C,UAAUyO,kBAAkB;AAC7CrjD,QAAAA,OAAMw8I,cAAc,CAAC,iBAAiB,iBAAiB,gBAAgB,SAAU9+I,IAAAA;AAChF,cAAIA,GAAG0lD,eAAe1lD,GAAG4lD,qBAAsB,QAAO;AACtD,iBAAO5lD;AAAAA,QACP,GAAE,SAAUA,IACZ;AAAA,iBAAA,CAASA,MAAMA,GAAG0lD,eAAe1lD,GAAG4lD;AAAAA,QACzC,CAAA;AAAA,MACI;AAAA,IAED;AAAA,EACD;AAGD,WAASm5F,eAAengJ,QACvB;AAAA,QAAIogJ,WAAW18I,OAAMm/B,QAAQkvC,eAAe;AAE5C,aAAQt1E,IAAI,GAAGA,IAAI2jJ,SAAS1jJ,QAAQD,KAAI;AACvC,UAAI5D,MAAMunJ,SAAS3jJ,GAAG2gG,MAAMxkG,sBAAAA;AAC5B,UAAGoH,OAAMsB,WAAWzI,IAAIJ,QAAQuH,OAAMsB,WAAWzI,IAAIH,SACpDsH,OAAMuB,WAAW1I,IAAIF,UAAUqH,OAAMuB,WAAW1I,IAAIL,KAAI;AACvD,eAAO4nJ,SAAS3jJ;MAChB;AAAA,IACF;AAAA,EACD;AAED,WAAS6U,eAAejF,MACvB;AAAA,QAAIgF,UAAUhF,KAAK+E,QAAQC,UAAU3N,OAAMoM,IAAIC,QAAQ1D,KAAK+E,QAAQC,WAAW;AAC/E,QAAIE,UAAUlF,KAAK+E,QAAQG,UAAU7N,OAAMoM,IAAIC,QAAQ1D,KAAK+E,QAAQG,OAAAA,IAAW;AAE/E,QAAI4kD,cAAc,EAACh8D,GAAG,MAAMH,GAAG;AAC/B,QAAGqX,SAAQ;AACV,UAAI9M,QAAQ8M,QAAQC,eACpB;AAAA,UAAG/M,MAAMiwG,SAAQ;AAChBr+C,oBAAYh8D,IAAIkX,QAAQ+rF,MAAM9jG;AAAAA,MAC9B;AAAA,IACD;AACD,QAAGiY,SAAQ;AACV,UAAIhN,QAAQgN,QAAQD,eAAAA;AACpB,UAAG/M,MAAMiwG,SAAQ;AAChBr+C,oBAAYn8D,IAAIuX,QAAQ6rF,MAAMjkG;AAAAA,MAC9B;AAAA,IACD;AACD,WAAOg9D;AAAAA,EACP;AAED,WAASkqF,WAAWh0I,MAAM5T,MAAMD,KAC/B;AAAA,QAAI6Y,UAAUhF,KAAK+E,QAAQC,UAAU3N,OAAMoM,IAAIC,QAAQ1D,KAAK+E,QAAQC,OAAAA,IAAW;AAC/E,QAAIE,UAAUlF,KAAK+E,QAAQG,UAAU7N,OAAMoM,IAAIC,QAAQ1D,KAAK+E,QAAQG,WAAW;AAE/E,QAAGF,SAAQ;AACVA,cAAQ4D,SAASxc,MAAM,IAAA;AAAA,IACvB;AACD,QAAG8Y,SAAQ;AACVA,cAAQ0D,SAAS,MAAMzc,GACvB;AAAA,IAAA;AAAA,EACD;AAED,WAAS8nJ;AACR,QAAIC;AACJ,QAAG78I,OAAMoM,IAAIC,QAAQ,aAAY;AAChCwwI,iBAAW78I,OAAMoM,IAAIC,QAAQ,YAAY+lF;AAAAA,IACzC;AACD,WAAOyqD;AAAAA,EACP;AAED,MAAIC,gBAAgB,CAKpB98I;AAAAA,EAAAA,OAAMw8I,gBAAgB,SAAUO,OAAO97F,UAAU1gD,QAEhD;AAAA,QAAIy8I,eAAe;AACnB,QAAIC,aAAa;AACjB,QAAIC,aAAa;AACjB,QAAIC,cAAc;AAClB,QAAI1qF;AACJ,QAAI2qF,eAAe;AACnB,QAAIC,eAAe;AACnB,QAAIC,WAAW,CAAA;AACf,QAAIC,aAAa;AACjB,QAAIC,mBAAmB,CAAA;AAEvB,aAAQzkJ,IAAI,GAAGA,IAAI+jJ,cAAc9jJ,QAAQD,KAAI;AAC5CiH,MAAAA,OAAMqvB,YAAYytH,cAAc/jJ,CAAAA,EAAG,CAAI+jJ,GAAAA,cAAc/jJ,GAAG,CAAI+jJ,GAAAA,cAAc/jJ,GAAG,CAC7E,CAAA;AAAA,IAAA;AACD+jJ,oBAAgB,CAGhBA;AAAAA,kBAAc7gJ,KAAK,CAAC+D,OAAMsM,YAAYywI,MAAM,CAAI,GAAA,SAAU5gJ;AACzD,UAAI0gJ,WAAWD;AAEd,UAAIr8I,OAAOpE,CAAI,EAAA;AAGf,UAAK8gJ,CAAAA,WAAY;AAEjB,UAAIG,aAAct1I,cAAas1I,YAAAA;AAE/B,UAAIz/H,SAASsjC,SAAS9kD,CACtB;AAAA,UAAI0gJ,aAAaA,SAASxqD,KAAKnuF,MAAM24I,SAASxqD,KAAKi0C,aAAa;AAC/DuW,iBAASnY,cAAc/mH;AACvB,YAAIxhB,EAAE0rB,eACL1rB,GAAE0rB,eACH1rB;AAAAA,UAAE8kG,eAAe;AACjB,eAAO;AAAA,MACP;AACD,UAAA,CAAKjhG,OAAMyjD,uBAAuB;AACjC,YAAI9lC,UAAUw/H,aAAa;AAC1B,cAAIr/G,KAAKq/G,YAAY98F,QAAQ1iC,OAAO0iC;AACpC,cAAItiB,KAAKo/G,YAAY78F,QAAQ3iC,OAAO2iC;AACpC,cAAA,CAAK48F,eAAe3mJ,KAAKkM,IAAIq7B,EAAM,IAAA,KAAKvnC,KAAKkM,IAAIs7B,MAAM,IAAI;AAC1Dm/G,yBAAa;AAEbF,2BAAe;AAEf,gBAAGO,YAAW;AACb9qF,4BAAc7kD,eAAe2vI,UAAAA;AAAAA,YACrC,OAAY;AACJ9qF,4BAAczyD,OAAM4N,eAAAA;AAAAA,YACpB;AAAA,UACD;AAED,cAAIsvI,YAAY;AAEf,gBAAIO;AACJ,gBAAI9vI,UAAU8kD,YAAYh8D,IAAIqnC;AAC9B,gBAAIjwB,UAAU4kD,YAAYn8D,IAAIynC;AAC9B,gBAAGw/G,YAAW;AACbZ,yBAAWY,YAAY5vI,SAASE,OAChC4vI;AAAAA,+BAAiB7vI,eAAe2vI,UAAAA;AAAAA,YACxC,OAAY;AACJv9I,cAAAA,OAAMuR,SAAS5D,SAASE,OACxB4vI;AAAAA,+BAAiBz9I,OAAM4N,eAAAA;AAAAA,YACvB;AAED,gBAAK6kD,YAAYh8D,KAAKgnJ,eAAehnJ,KAAKsnC,KAAK,IAAID,MACjD20B,YAAYn8D,KAAKmnJ,eAAennJ,KAAKwnC,KAAK,IAAIC,IAAM;AACrD,qBAAO2/G,aAAavhJ,CAAAA;AAAAA,YACpB;AAAA,UACD;AAAA,QACD;AACD,eAAOuhJ,aAAavhJ,CAAAA;AAAAA,MACpB;AACD,aAAO;AAAA,IACP,CAGF,CAAA;AAAA,QAAA;AACC9G,eAASsrC,iBAAiB,aAAa,SAASxkC,GAAAA;AAC/C,YAAI6D,OAAM0jD,aAAa;AACtBg6F,uBAAavhJ,CAAAA;AAAAA,QACb;AAAA,MACL,GAAM,EAAE6kD,SAAS;IACd,SACK7kD,GAELyC;AAAAA,cAAQq2D,KAAK,8CAAA;AAAA,IACb;AAGD6nF,kBAAc7gJ,KAAK,CAACgB,KAAKqP,YAAY,eAAe,SAAUnQ,GAC7D;AAAA,UAAI8gJ,WACH,QAAOS,aAAavhJ;IACrB,CAGD2gJ,CAAAA;AAAAA,kBAAc7gJ,KAAK,CAACgB,KAAKqP,YAAYywI,MAAM,CAAI,GAAA,SAAU5gJ;AACxDqhJ,yBAAmBrhJ,EAAE8mD,QAAQjqD;AAE7B,UAAG3D,YAAYA,SAASD,MAAK;AAC5BC,iBAASD,KAAKyF,UAAU0O,IAAI,oBAC5B;AAAA,MAAA;AAED,UAAIhJ,OAAOpE,CAAAA,EAAI;AACf,UAAIA,EAAE8mD,WAAW9mD,EAAE8mD,QAAQjqD,SAAS,GAAG;AACtCikJ,qBAAa;AACb;AAAA,MACA;AAEDE,oBAAcl8F,SAAS9kD,CAAAA;AACvBohJ,mBAAad,eAAeU;AAC5B,UAAKn9I,CAAAA,OAAM29I,YAAYR,aAAa,kBAAA,KAAA,CAAwBn9I,OAAM29I,YAAYR,aAAa,kBAAqB,GAAA;AAC/GF,qBAAa;AAAA,MACb;AACD,UAAIJ,WAAWD;AAGfQ,qBAAev1I,WAAW;AACzB,YAAI0jB,SAASvrB,OAAMisB,OAAOkxH,WAC1B;AAAA,YAAIN,aAAatxH,UAAWvrB,CAAAA,OAAM29I,YAAYR,aAAa,oBAAA,KAAA,CAA0Bn9I,OAAM29I,YAAYR,aAAa,iBAAqB,IAAA;AACxIN,mBAASlY,cAAcwY;AAEvB,cAAIN,SAASxqD,QAAQwqD,SAASxqD,KAAKi0C,YAAY;AAE9CsX,8BAAkBryH,MAAAA;AAClBsxH,qBAASnW,WAAWyW,WACpBn9I;AAAAA,YAAAA,OAAM0jD,cAAc;AAEpB1jD,YAAAA,OAAMk5B,YAAY3N,MAElBvrB;AAAAA,YAAAA,OAAM2jD;UACN;AAAA,QAED;AAEDy5F,uBAAe;AAAA,MACnB,GAAMp9I,OAAMuC,OAAOg/C,UAChB;AAAA,IAAA,CAAA,CAAA;AAGDu7F,kBAAc7gJ,KAAK,CAACgB,KAAKqP,YAAYywI,MAAM,CAAA,GAAI,SAAU5gJ,GAAAA;AACxD,UAAG9G,YAAYA,SAASD,MAAK;AAC5BC,iBAASD,KAAKyF,UAAU2S,OAAO,oBAC/B;AAAA,MAAA;AACD,UAAIjN,OAAOpE,CAAI,EAAA;AACf,UAAIihJ,aAAct1I,cAAas1I,YAC/Bp9I;AAAAA,MAAAA,OAAM0jD,cAAc;AACpBu5F,mBAAa;AACb,UAAIt/H,SAASsjC,SAAS9kD,CAEtB;AAAA,UAAI0gJ,WAAWD,WAEf;AAAA,UAAGC,SACFA,UAASjY,YAAYjnH;AAEtB,UAAI0/H,gBAAgBr9I,OAAM0d,aAAa2/H,YAAe,GAAA;AACrDr9I,QAAAA,OAAMk5B,YAAYmkH,YAAAA;AAClB,YAAGC,SAAStkJ,QAAO;AAClBskJ,mBAASl3I,QAAQ,SAASvP,MAAAA;AACzB,gBAAGA,KAAKrB,YAAW;AAClBqB,mBAAKrB,WAAWqE,YAAYhD,IAAAA;AAAAA,YAC5B;AAAA,UACP,CACKmJ;AAAAA,UAAAA,OAAM2jD,gBACN;AAAA,QAAA;AAAA,MACD;AAGDs5F,mBAAaC,aAAa;AAC1BI,iBAAW,CACXD;AAAAA,qBAAe;AAGf,UAAIF,eAAeH,cAAc;AAChC,YAAIvW,MAAM,oBAAI9wH;AAEd,YAAK8wH,MAAMuW,eAAgB,OAAOQ,oBAAoB,GAAG;AAExD,cAAIv3C,eAAcjmG,OAAMc,UAAUC,WAAW,aAAA;AAC7CklG,UAAAA,aAAYN,cAAcw3C,WAAAA;AAC1BO,uBAAavhJ,CAAAA;AAAAA,QACb,MACA6gJ,gBAAevW;AAAAA,MACpB,OAAU;AACNuW,uBAAe,oBAAIrnI;AAAAA,MACnB;AAAA,IACD;AAED,aAAQ5c,IAAI,GAAGA,IAAI+jJ,cAAc9jJ,QAAQD,KAAI;AAC5CiH,MAAAA,OAAM1D,MAAMwgJ,cAAc/jJ,GAAG,CAAI+jJ,GAAAA,cAAc/jJ,CAAG,EAAA,CAAA,GAAI+jJ,cAAc/jJ,CAAAA,EAAG;IACvE;AAGD,aAAS2kJ,aAAavhJ,GAAAA;AACrB,UAAIA,KAAKA,EAAE0rB,kBAAkB1rB,EAAE+lD,YAAW;AACzC/lD,UAAE0rB;MACF;AACD1rB,QAAE8kG,eAAe;AACjB,aAAO;AAAA,IACP;AAED,aAAS28C,kBAAkBryH;AAC1B,YAAMglC,UAAUvwD,OAAMwsG,eACtB;AAAA,UAAIphG,OAAOpL,OAAMmc,QAAQoP,MAAAA;AACzB,UAAIngB,MAAM;AACT,YAAI0lG,UAAU9wG,OAAMksB,cAAcX,MAClC;AAAA,YAAIulF,SAAQ;AACXusC,yBAAe9xH;AACf,mBAASxyB,KAAI,GAAGA,KAAIw3D,QAAQv3D,QAAQD,MAAK;AACxCqS,mBAAOmlD,QAAQx3D,EAAAA,EAAG+uG,SAASv8E,MAAAA;AAC3B,gBAAIngB,QAAQA,KAAK/T,aAAa2I,OAAMuC,OAAO6pB,mBAAmBhhB,KAAK/T,aAAa2I,OAAMuC,OAAO6pB,cAAmBb,KAAAA,QAAQ;AACvH,oBAAMjqB,QAAO8J,KAAK03C,UAAU,IAC5Bw6F;AAAAA,uBAASrhJ,KAAKmP,IACdmlD;AAAAA,sBAAQx3D,EAAG+uG,EAAAA,SAASv8E,MAAUjqB,IAAAA;AAC9B8J,mBAAKnU,MAAMH,UAAU;AACrBwK,cAAAA,MAAKtH,aAAa;AAClBoR,mBAAK5V,WAAWmE,YAAY2H,KAAAA;AAAAA,YAE5B;AAAA,UACD;AAAA,QACN,WAAe8J,KAAKygB,gBAAe;AAC9B,cAAI8jC,iBAAiBvkD,KAAKwiD;AAC1BkjD,oBAAU9wG,OAAMksB,cAAcyjC,cAC9B;AAAA,cAAA,CAAKmhD,SAAQ;AACZ;AAAA,UACA;AACDusC,yBAAe9xH;AACf,mBAASxyB,KAAI,GAAGA,KAAIw3D,QAAQv3D,QAAQD,MAAK;AACxC,kBAAMgF,SAASwyD,QAAQx3D,EAAAA,EAAG+uG,SAASn4C,cACnC;AAAA,gBAAIkuF;AACJ,gBAAI9/I,UAAUA,OAAOlC,YAAW;AAC/BgiJ,yBAAW9/I,OAAO7C,cAAc,IAAI8E,OAAMuC,OAAO6pB,cAAAA,KAAmBhhB,KAAKlH,EAAAA,IAAAA;AAAAA,YACzE;AACD,gBAAI25I,UAAU;AAGb,oBAAMv8I,QAAOu8I,SAAS/6F,UAAU,IAAA;AAChC+6F,uBAASroJ,WAAWmE,YAAY2H,KAEhCtB;AAAAA,cAAAA,OAAM+8G,WAAWpjH,YAAYkkJ;AAC7BA,uBAAS5mJ,MAAMH,UAAU;AAKzBwmJ,uBAASrhJ,KAAK4hJ,QAEdA;AAAAA,yBAAW;AAAA,YACX;AAAA,UACD;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAAA,EACH;AAEA;AC1YA,SAASC,QAAAA;AAERl/I,UAAQ6jB,IAAI,4BAAA;AACb;AACA,SAASs7H,cACT;AAAA;AAGAA,YAAYnlJ,UAAU+J,SAASm7I;AAC/BC,YAAYnlJ,UAAUwzH,YAAY0xB;AAClCC,YAAYnlJ,UAAU0zH,YAAYwxB;AAClCC,YAAYnlJ,UAAU8vB,QAAQo1H;AAEf,SAAQE,eAACh+I,QACvB;AAAA,SAAO+9I;AACR;ACXe,SAAQE,2BAACj+I,QAAAA;AACvB,QAAM6vG,SAASquC;AAEf,WAASC,kBAAAA;AACR,QAAIjsF,OAAO29C,OAAO3yG,MAAMD,MAAM4G,SAAAA,KAAc5G;AAC5C,WAAOi1D;AAAAA,EACP;AAEDw9C,YAAUyuC,iBAAiBtuC,MAAAA;AAG3BsuC,kBAAgBvlJ,UAAU+J,SAAS,SAASy7I,KAC3C;AAAA,QAAIznJ,SAASynJ,IAAIznJ,SAAS,GAAGynJ,IAAIznJ,MAAa,OAAA;AAC9C,WAAO,gEAAgEynJ,IAAI9jJ,SAAS3D,SAAS,iBAAiBA,MAAa,OAAA,EAAA;AAAA,EAC7H;AAECwnJ,kBAAgBvlJ,UAAUwzH,YAAY,SAASv1H,MAAMmf,OAAAA;AACpDnf,SAAKyE,YAAY0a,SAAS;AAAA,EAC5B;AAECmoI,kBAAgBvlJ,UAAU0zH,YAAY,SAASz1H;AAC9C,WAAOA,KAAKyE,aAAa;AAAA,EAC3B;AAEC6iJ,kBAAgBvlJ,UAAU8vB,QAAQ;;AAElC,SAAOy1H;AACR;AC3Be,SAAQE,2BAACr+I,QACvB;AAAA,QAAM6vG,SAASquC,eAAAA;AAEf,WAASI,kBACR;AAAA,QAAIpsF,OAAO29C,OAAO3yG,MAAMD,MAAM4G,cAAc5G;AAE5C,WAAOi1D;AAAAA,EACP;AAEDw9C,YAAU4uC,iBAAiBzuC,MAE3ByuC;AAAAA,kBAAgB1lJ,UAAU+J,SAAS,SAASy7I,KAAAA;AAC3C,UAAMznJ,UAAUynJ,IAAIznJ,UAAU,SAAS;AACvC,UAAMk9B,cAAcuqH,IAAIvqH,cAAc,gBAAgBuqH,IAAIvqH,WAAiB,MAAA;AAC3E,WAAO,6CAA6CuqH,IAAI9jJ,uBAAuB3D,MAAYk9B,MAAAA,WAAAA;AAAAA,EAC7F;AAECyqH,kBAAgB1lJ,UAAUwzH,YAAY,SAASv1H,MAAMmf,OAAAA;AACpDhW,IAAAA,OAAMu+I,YAAYvmJ,SAASwmJ,WAAW3nJ,IAAMmf,EAAAA,QAAQA,SAAS;AAAA,EAC/D;AAECsoI,kBAAgB1lJ,UAAU0zH,YAAY,SAASz1H;AAC9C,WAAOmJ,OAAMu+I,YAAYvmJ,SAASwmJ,WAAW3nJ,MAAMmf;AAAAA,EACrD;AAECsoI,kBAAgB1lJ,UAAU8vB,QAAQ,SAAS7xB;AAC1C,QAAIW,IAAIwI,OAAMu+I,YAAYvmJ,SAASwmJ,WAAW3nJ;AAC9CmJ,IAAAA,OAAMy+I,OAAOjnJ,GAAG,IAAA;AAAA,EAClB;AAEC8mJ,kBAAgB1lJ,UAAU4lJ,aAAa,SAAS3nJ;AAC/C,WAAOA,KAAKqE,cAAc,UAC5B;AAAA,EAAA;AAEC,SAAOojJ;AACR;ACnCe,SAAQI,uBAAC1+I,QACvB;AAAA,QAAM6vG,SAASquC,eAAAA;AAEf,WAASS,cAAAA;AACR,QAAIzsF,OAAO29C,OAAO3yG,MAAMD,MAAM4G,SAAc5G,KAAAA;AAE5C,WAAOi1D;AAAAA,EACP;AAEDw9C,YAAUivC,aAAa9uC,MAAAA;AAEvB8uC,cAAY/lJ,UAAU+J,SAAS,SAAUy7I,KAAAA;AACxC,QAAIhnI,OAAOpX,OAAMu+I,YAAYK,cAAc9lJ,KAAKmE,MAAMmhJ,GACtD;AAAA,QAAIS,mBAAmB;AACvB,QAAIT,IAAI9jJ,SAAS,QAAO;AACvBukJ,0BAAoB,oBAAoBT,IAAI9jJ;AAAAA,IAC5C;AACD,QAAImgB,OAAO,8EAA8EokI,mBAAmB;AAC5GpkI,YAAQrD;AAER,QAAIgnI,IAAI7rG,aAAa;AACpBn7B,aAAOpX,OAAMu+I,YAAYK,cAAc9lJ,KAAKmE,MAAMmhJ,KAAK,IAAA;AACvD3jI,cAAQ;AAAA,IACX,OAAS;AACNA,cAAQ;AAAA,IACR;AAEDA,YAAQrD;AACRqD,YAAQ;AACR,WAAOA;AAAAA,EACT;AAECkkI,cAAY/lJ,UAAUwzH,YAAY,SAAUv1H,MAAMmf,OAAOtY,IAAI6E,SAAAA;AAC5D,QAAIkzD,MAAMlzD;AACV,QAAIi4C,IAAI3jD,KAAK0/C,qBAAqB;AAClC,QAAI/vC,MAAMjE,QAAOu8I;AAEjB,QAAIrpF,IAAIspF,eAAe;AACtB,UAAIC,0BAA0B,WAC7B5vI;AAAAA,qBAAa,IAAIuG,KAAK6kC,EAAEh0C,IAAI,CAAA,CAAA,EAAIwP,OAAOwkC,EAAEh0C,IAAI,CAAIwP,CAAAA,EAAAA,OAAOwkC,EAAEh0C,IAAI,CAAIwP,CAAAA,EAAAA,OAAO,GAAG,CAC5E3G;AAAAA,mBAAWrP,OAAMm5D,iBAAiB,EAAE/pD,YAAwBgqD,UAAU,GAAGhuD,MAAM1N,GAC/EsC,CAAAA;AAAAA,QAAAA,OAAMu+I,YAAYU,sBAAsBzkG,GAAGh0C,IAAI8nG,MAAMj/F,UAAU7I,KAAKivD;MACxE;AACG,eAAS18D,IAAI,GAAGA,IAAI,GAAGA,KAAK;AAC3ByhD,UAAEzhD,CAAGmmJ,EAAAA,WAAWF;AAAAA,MAChB;AAAA,IACD;AAED,QAAIjzB,UAAU/rH,OAAMm/I,yBAAyB58I;AAE7C,QAAI,OAAA,YAAqB,SAAUwpH,WAAU,EAAE38G,YAAY28G,QAE3D;AAAA,QAAI38G,aAAa1R,GAAGquH,QAAQ38G,UAAAA,KAAe,oBAAIuG;AAC/C,QAAItG,WAAW3R,GAAGquH,QAAQ18G,aAAarP,OAAMm5D,iBAAiB,EAC7D/pD,YACAgqD,UAAU,GACVhuD,MAAM1N,GAAAA,CAAAA;AAGPsC,IAAAA,OAAMu+I,YAAYU,sBAAsBzkG,GAAG,GAAGprC,YAAY5I,KAAKivD,GAC/Dz1D;AAAAA,IAAAA,OAAMu+I,YAAYU,sBAAsBzkG,GAAGh0C,IAAI8nG,MAAMj/F,UAAU7I,KAAKivD,GAAAA;AAAAA,EACtE;AAECkpF,cAAY/lJ,UAAU0zH,YAAY,SAAUz1H,MAAM6G,IAAI6E;AACrD,QAAI68I,UAAUvoJ,KAAK0/C,qBAAqB,QAAA;AACxC,QAAIy4B;AACJ,QAAIxoE,MAAMjE,QAAOu8I;AACjB,aAASO,YAAYD,UAAS54I,MAAKwoE;AAClC,UAAIC,UAAUjvE,OAAMu+I,YAAYe,mBAAmBF,UAAS78I,SAAQiE,KAAI8nG,IAAAA;AAExE,UAAIr/B,WAAWD,YAAW;AACzB,YAAIzsE,QAAOg9I,gBAAgB,SAASh9I,QAAOgwC,aAAa;AACvD,iBAAOvyC,OAAMsP,KAAK/F,IAAIylE,YAAWhvE,OAAMw/I,wBAAwB,QAC/D;AAAA,QAAA;AAAA,MACD;AACD,aAAOvwE;AAAAA,IACP;AAEDD,gBAAYhvE,OAAMu+I,YAAYe,mBAAmBF,SAAS78I,OAAAA;AAE1D,eAAWvC,OAAMm/I,yBAAyB58I,aAAY,UAAU;AAC/D,aAAOysE;AAAAA,IACP;AAED,WAAO,EACN5/D,YAAY4/D,WACZ3/D,UAAUgwI,YAAYD,SAAS54I,KAAKwoE,SAEvC,EAAA;AAAA,EAAA;AAEC2vE,cAAY/lJ,UAAU8vB,QAAQ,SAAU7xB;AACvCmJ,IAAAA,OAAMy+I,OAAO5nJ,KAAK0/C,qBAAqB,QAAU,EAAA,CAAA,CAAA;AAAA,EACnD;AAEC,SAAOooG;AACR;ACjGA,IAAIc,cAAc,EACjBC,eAAe,SAAS1vE,SAASsN,YAAYtnE,OAC5C;AAAA,MAAI1a,YAAY;AAChB,MAAIw0G,QAAQ7yG;AAEZ+yE,YAAUA,WAAW;AAErB5O,UAAgB4O,SAAS,SAAS/iC,OAAAA;AACjC,QAAI0yG,cAAc,CAAC,EAAErpI,KAAK,SAASN,OAAOi3B,MAAM32B,IAAAA,CAAAA;AAEhD,QAAIN,SAASi3B,MAAM32B,KAAK;AACvBqpI,kBAAYA,YAAY3mJ,MAAU,IAAA,EAAEsd,KAAK,YAAYN,OAAO,WAAA;AAAA,IAC5D;AACD,QAAIi3B,MAAMqwC,YAAY;AACrBqiE,oBAAcA,YAAYx6I,OAAO8nC,MAAMqwC,UAAAA;AAAAA,IACvC;AACDhiF,iBAAaw0G,MAAM8vC,cAAc,EAAEtkJ,WAAW2xC,MAAM95B,SAASwsI,WAChE;AAAA,EAAA,CAAA;AAEE,SAAOE,kBAAkB,UAAU,EAAEvkJ,UAAwBgiF,GAAAA,UAAAA;AAC7D,GACDsiE,eAAe,SAAS5vE,SAASsN,YAAc;AAAA,SAAOuiE,kBAAkB,UAAU7vE,SAASsN,UAAc;AAAA,GACzGwiE,eAAe,SAAS9vE,SAASsN,YAAc;AAAA,SAAOuiE,kBAAkB,UAAU7vE,SAASsN;AAAc,GACzGyiE,YAAY,SAAS/vE,SAASsN,YAAc;AAAA,SAAOuiE,kBAAkB,OAAO7vE,SAASsN,UAAc;AAAA,GACnG0iE,cAAc,SAAShwE,SAASsN,YAAc;AAAA,SAAOuiE,kBAAkB,SAAS7vE,SAASsN,UAAAA;AAAc,GACvG2iE,cAAc,SAAS3iE;AACtB,SAAO,WAAW4iE,mBAAmB5iE,cAAc,CAAA,CAAA,IAAM;AACzD,EAAA;AAGF,SAASuiE,kBAAkBj6E,KAAKoK,SAASsN,YAAAA;AACxC,MAAI7iE;AAEJu1D,YAAUA,WAAW;AAErBv1D,SAAO,MAAMmrD,MAAMs6E,mBAAmB5iE,cAAc,CAAA,CAAA,IAAM,OAAOtN,QAAQ10E,aAAa,MAAM,OAAOsqE,MAAK;AACxG,SAAOnrD;AAER;AAEA,SAASylI,mBAAmB5iE,YAAAA;AAC3B,MAAI7iE,OAAO;AAEX2mD,UAAgBkc,YAAY,SAASrwC,OAAAA;AACpCxyB,YAAQ,MAAMwyB,MAAM32B,MAAM,OAAO22B,MAAMj3B,QAAQ;AAAA,EACjD,CACC;AAAA,SAAOyE;AACR;AC5Ce,SAAQ0lI,4BAACngJ,QACvB;AAAA,QAAM6vG,SAASquC,eAAAA;AAEf,WAASkC,gBAAAA;AACR,QAAIluF,OAAO29C,OAAO3yG,MAAMD,MAAM4G,SAAAA,KAAc5G;AAE5C,WAAOi1D;AAAAA,EACP;AAEDw9C,YAAU0wC,eAAevwC,MAAAA;AAEzBuwC,gBAAcxnJ,UAAU+J,SAAS,SAASy7I,KACzC;AAAA,UAAMznJ,SAASynJ,IAAIznJ,SAAS,UAAUynJ,IAAIznJ,MAAc,QAAA;AACxD,QAAI8jB,OAAO,6CAA6C2jI,IAAI9jJ,IAAAA,KAAS3D,SAAS,UAAUA,YAAY,EAEpG8jB;AAAAA,YAAQglI,YAAYC,cAActB,IAAIpuE,SAAS,CAAC,EAAE15D,KAAK,SAASN,OAAO,cAAA,GAAiB,EAAEM,KAAK,SAASN,OAAOooI,IAAI9jJ,KACnHmgB,CAAAA,CAAAA;AAAAA,YAAQ;AACR,WAAOA;AAAAA,EACT;AAEC2lI,gBAAcxnJ,UAAUwzH,YAAY,SAASv1H,MAAMmf,OAAOtY,IAAI0gJ,KAAAA;AAC7D,QAAIrmJ,SAASlB,KAAK2E;AAClB,QAAA,CAAKzD,OAAOsoJ,iBAAiBjC,IAAIc,UAAU;AAC1CnnJ,aAAOmnJ,WAAWd,IAAIc;AACtBnnJ,aAAOsoJ,gBAAgB;AAAA,IACvB;AACD,QAAWrqI,OAAAA,UAAU,YACpBA,UAASje,OAAOi4E,QAAQ,CAAA,KAAM,CAAE,GAAEh6D;AACnCje,WAAOie,QAAQA,SAAS;AAAA,EAC1B;AAECoqI,gBAAcxnJ,UAAU0zH,YAAY,SAASz1H,MAAAA;AAC5C,WAAOA,KAAK2E,WAAWwa;AAAAA,EACzB;AAECoqI,gBAAcxnJ,UAAU8vB,QAAQ,SAAS7xB,MAAAA;AACxC,QAAIW,IAAIX,KAAK2E;AACbwE,IAAAA,OAAMy+I,OAAOjnJ,GAAG;EAClB;AAEC,SAAO4oJ;AACR;AC1Ce,SAAQE,2BAACtgJ,QACvB;AAAA,MAAI6vG,SAASmuC,eAAAA;AAEb,WAASuC,kBAAAA;AACR,QAAIruF,OAAO29C,OAAO3yG,MAAMD,MAAM4G,SAAc5G,KAAAA;AAE5C,WAAOi1D;AAAAA,EACP;AAEDw9C,YAAU6wC,iBAAiB1wC,MAE3B0wC;AAAAA,kBAAgB3nJ,UAAU+J,SAAS,SAASy7I;AAC3C,UAAMznJ,SAASynJ,IAAIznJ,SAAS,UAAUynJ,IAAIznJ,MAAAA,QAAc;AACxD,QAAI8jB,OAAO,iEAAiE2jI,IAAI9jJ,SAAS3D,SAAS,UAAUA,YAAY,EAExH;AAAA,QAAIynJ,IAAIpuE,WAAWouE,IAAIpuE,QAAQh3E,QAAQ;AACtC,eAASD,IAAI,GAAGA,IAAIqlJ,IAAIpuE,QAAQh3E,QAAQD,KAAK;AAC5C0hB,gBAAQ,0CAA0C2jI,IAAIpuE,QAAQj3E,CAAGud,EAAAA,MAAM,aAAa8nI,IAAI9jJ,OAAO,OAAO8jJ,IAAIpuE,QAAQj3E,CAAAA,EAAGoa,QAAQ;AAAA,MAC7H;AAAA,IACJ,OAAO;AACJirI,UAAIoC,eAAe;AACnB/lI,cAAQ,yCAAyC2jI,IAAI9jJ,OAAO;AAAA,IAC5D;AACDmgB,YAAQ;AACR,WAAOA;AAAAA,EACT;AAEC8lI,kBAAgB3nJ,UAAUwzH,YAAY,SAASv1H,MAAMmf,OAAOtY,IAAI0gJ,KAC/D;AAAA,QAAIqC,aAAa9nJ,MAAMC,UAAUC,MAAMC,KAAKjC,KAAK2B,iBAAiB,sBAElE,CAAA;AAAA,QAAA,CAAK3B,KAAKwpJ,iBAAiBjC,IAAIc,UAAU;AACxCroJ,WAAKqoJ,WAAWd,IAAIc;AACpBroJ,WAAKwpJ,gBAAgB;AAAA,IACrB;AAED,QAAGjC,IAAIoC,cAAa;AACnB,UAAIrrJ,MAAMsrJ,WAAW,CAAA;AACrBtrJ,UAAIurJ,UAAY1qI,CAAAA,CAAAA;AAAAA,IACnB,OAAO;AACJorD,cAAgBq/E,YAAY,SAASxzG,OACpCA;AAAAA,cAAMyzG,UAAU1qI,QAAQA,MAAM9b,QAAQ+yC,MAAMj3B,KAAU,KAAA,IAAI;AAAA,MAC9D,CACG;AAAA,IAAA;AAAA,EACH;AAECuqI,kBAAgB3nJ,UAAU0zH,YAAY,SAASz1H,MAAMuU,MAAMgzI;AAC1D,QAAGA,IAAIoC,cAAa;AACnB,UAAIrrJ,MAAM0B,KAAKqE,cAAc,sBAAA;AAC7B,aAAO/F,IAAIurJ;AAAAA,IACd,OAAO;AACJ,aAAOC,SAAiBhoJ,MAAMC,UAAUC,MAAMC,KAAKjC,KAAK2B,iBAAiB,8BAAA,CAAA,GAAkC,SAASy0C,OACnH;AAAA,eAAOA,MAAMj3B;AAAAA,MACjB,CAAA;AAAA,IACG;AAAA,EACH;AAECuqI,kBAAgB3nJ,UAAU8vB,QAAQ,SAAS7xB,MAAAA;AAC1CmJ,IAAAA,OAAMy+I,OAAO5nJ,KAAKqE,cAAc,sBAClC,CAAA;AAAA,EAAA;AAEC,SAAOqlJ;AACR;AC9De,SAAQK,wBAAC5gJ,QACvB;AAAA,QAAM6vG,SAASquC,eAEf;AAAA,WAAS2C;AACR,QAAI3uF,OAAO29C,OAAO3yG,MAAMD,MAAM4G,SAAc5G,KAAAA;AAE5C,WAAOi1D;AAAAA,EACP;AAEDw9C,YAAUmxC,cAAchxC,MAExBgxC;AAAAA,eAAajoJ,UAAU+J,SAAS,SAASy7I,KACxC;AAAA,UAAMznJ,SAASynJ,IAAIznJ,SAAS,GAAGynJ,IAAIznJ,MAAa,OAAA;AAChD,QAAI8jB,OAAO,8DAA8D2jI,IAAI9jJ,IAAS3D,KAAAA,SAAS,iBAAiBA,MAAAA,OAAa,EAE7H;AAAA,QAAIynJ,IAAIpuE,WAAWouE,IAAIpuE,QAAQh3E,QAAQ;AACtC,eAASD,IAAI,GAAGA,IAAIqlJ,IAAIpuE,QAAQh3E,QAAQD,KAAK;AAC5C0hB,gBAAQ,uCAAuC2jI,IAAIpuE,QAAQj3E,CAAGud,EAAAA,MAAM,aAAa8nI,IAAI9jJ,OAAO,OAAO8jJ,IAAIpuE,QAAQj3E,CAAAA,EAAGoa,QAAQ;AAAA,MAC1H;AAAA,IACD;AAEDsH,YAAQ;AACR,WAAOA;AAAAA,EACT;AAEComI,eAAajoJ,UAAUwzH,YAAY,SAASv1H,MAAMmf,OAAOtY,IAAI0gJ,KAAAA;AAC5D,QAAI0C;AAEJ,QAAA,CAAK1C,IAAIpuE,WAAAA,CAAYouE,IAAIpuE,QAAQh3E,OAAQ;AAEzC8nJ,YAAQjqJ,KAAKqE,cAAc,8BAA8B8a,QAAQ,IAC/Dnf,KAAAA,KAAKqE,cAAc,8BAA8BkjJ,IAAI2C,gBAAgB;AAEvE,QAAKD,CAAAA,MAAO;AAEZ,QAAKjqJ,CAAAA,KAAKwpJ,iBAAiBjC,IAAIc,UAAU;AACxCroJ,WAAKqoJ,WAAWd,IAAIc;AACpBroJ,WAAKwpJ,gBAAgB;AAAA,IACrB;AAEDS,UAAMJ,UAAU;AAAA,EAClB;AAECG,eAAajoJ,UAAU0zH,YAAY,SAASz1H,MAAM6G;AACjD,QAAIuD,SAASpK,KAAKqE,cAAc,2BAAA;AAEhC,WAAO+F,SAASA,OAAO+U,QAAQ;AAAA,EACjC;AAEC6qI,eAAajoJ,UAAU8vB,QAAQ,SAAS7xB,MACvCmJ;AAAAA,IAAAA,OAAMy+I,OAAO5nJ,KAAKqE,cAAc,mBAClC,CAAA;AAAA,EAAA;AAEC,SAAO2lJ;AACR;ACpDe,SAAQG,2BAAChhJ,QACvB;AAAA,MAAI6vG,SAASmuC,eAEb;AAAA,WAASiD;AACR,QAAI/uF,OAAO29C,OAAO3yG,MAAMD,MAAM4G,SAAAA,KAAc5G;AAE5C,WAAOi1D;AAAAA,EACP;AAED,WAASy7D,aAAaprH,SAAAA;AACrB,WAAOA,QAAOqrH,aAAa,IAAIl3C;AAAAA,EAC/B;AAEDg5B,YAAUuxC,iBAAiBpxC,MAE3BoxC;AAAAA,kBAAgBroJ,UAAU+J,SAAS,SAASy7I;AAC3C,QAAIhnI,OAAO,qCAAqCpX,OAAMu+I,YAAYK,cAAc9lJ,KAAKmE,MAAMmhJ,GAAAA,IAAO;AAClG,QAAIjrI,QAAQ,MAAKnT,OAAMoT,OAAOC,OAAOrT,OAAMuC,OAAO4sC,gBAAgB,OAAM;AACxE,QAAI+xG,aAAa9C,IAAI7rG,cAAc,0BAA0B;AAC7D,QAAI/jC,WAAW4vI,IAAI5vI,WAAW,yBAAyB;AACvD,QAAIouB,WAAW58B,OAAM08B,SAASykH,gCAAgC/C,GAAAA;AAE9D,QAAIgD,qBAAqB;AACzB,QAAGhD,IAAIxwB,WAAW;AACjBz6G,cAAQ;AACRiuI,4BAAsB;AAAA,IACtB;AAED,QAAIhoF,WAAW,iCAAiC8nF,aAAa,kGAEE1yI,WAAW,8CAC9B4yI,qBAAmB,MAAM5yI,WAAW,MAAMouB,WAAW,+DAClCpuB,WAAW,iDAEjC2E,QAAM;AAG/C,QAAI0rI,mBAAmB;AACvB,QAAIT,IAAI9jJ,SAAS,QAAO;AACvBukJ,0BAAoB,oBAAoBT,IAAI9jJ;AAAAA,IAC5C;AACD,QAAImgB,OAAO,4DAA4DokI,mBAAmB,OAAOznI,OAAO,MAAMgiD,WAAW;AACzH,WAAO3+C;AAAAA,EACT;AAECwmI,kBAAgBroJ,UAAUwzH,YAAY,SAASv1H,MAAMmf,OAAOtY,IAAI6E,SAC/D;AAAA,QAAIi4C,IAAI3jD,KAAK0/C,qBAAqB,QAClC;AAAA,QAAI8qG,OAAOxqJ,KAAK0/C,qBAAqB;AACrC,QAAI6iB,WAAWioF,KAAK,CAAA;AACpB,QAAIC,OAAO,CAACD,KAAK,CAAA,GAAIA,KAAK,CAC1B,CAAA;AAAA,QAAIE,UAAU1qJ,KAAK0/C,qBAAqB,MAAQ,EAAA,CAAA;AAChD,QAAI/vC,MAAMjE,QAAOu8I;AACjB,QAAI/yB;AACJ,QAAI38G;AACJ,QAAIC;AACJ,QAAImyI;AAEJ,aAASC,aAAAA;AACR,UAAIryI,cAAasyI,cAAc5oJ,KAAKkH,QAAOnJ,MAAM0L,OACjD;AAAA,UAAI62D,YAAWuoF,aAAa7oJ,KAAKkH,QAAOnJ,MAAM0L,OAC9C;AAAA,UAAI8M,YAAWrP,OAAMm5D,iBAAiB,EAAC/pD,YAAYA,aAAYgqD,UAAUA,WAAUhuD,MAAM1N,GAAAA,CAAAA;AAEzF,UAAIkW,WAAW5T,OAAMmS,UAAUmyC,iBAAiBtkD,OAAMmS,UAAUq/B;AAChE+vG,cAAQjmJ,YAAYsY,SAASvE,SAC7B;AAAA,IAAA;AAED,aAASuyI,iBAAiBllI,MACzB;AAAA,UAAI1G,SAAQojD,SAASpjD;AAErBA,MAAAA,SAAQ23G,aAAaprH,OAAQoS,EAAAA,MAAMqB;AACnC,UAAItgB,OAAO0B,MAAM4e,MAAAA,EAChBA,CAAAA,SAAQ;AACTA,MAAAA,UAAS0G;AACT,UAAI1G,SAAQ,EAAGA,CAAAA,SAAQ;AACvBojD,eAASpjD,QAAQ23G,aAAaprH,OAAAA,EAAQoa,OAAO3G,MAAAA;AAC7CyrI;IACA;AAEDH,SAAK,GAAG9/C,UAAUxhG,OAAM4E,KAAK,WAC5Bg9I;AAAAA,uBAAAA,KAAsB5hJ,OAAMuC,OAAOgvC,aAAAA;AAAAA,IACnC,GAAEt0C,IACHqkJ;AAAAA,SAAK,GAAG9/C,UAAUxhG,OAAM4E,KAAK,WAC5Bg9I;AAAAA,uBAAiB,IAAI5hJ,OAAMuC,OAAOgvC,aAAAA;AAAAA,IAClC,GAAEt0C,IACHu9C;AAAAA,MAAE,CAAG0kG,EAAAA,WAAWuC;AAChBjnG,MAAE,GAAG0kG,WAAWuC;AAChBjnG,MAAE,CAAA,EAAG0kG,WAAWuC;AAChB,QAAIjnG,EAAE,CAAA,EAAIA,GAAE,CAAG0kG,EAAAA,WAAWuC;AAE1BroF,aAASgoC,YAAYphG,OAAM4E,KAAK,SAASzI,GAAAA;AACxC,UAAIyb;AAEJzb,UAAIA,KAAKzG,OAAO4G;AAChBsb,aAAQzb,EAAE0lJ,YAAY1lJ,EAAE+nB,WAAW/nB,EAAEgpB;AAErC,UAAIvN,QAAQ5X,OAAMotC,UAAUC,UAAUE,MAAM;AAC3Cq0G,8BAAsB5hJ,OAAMuC,OAAOgvC,aAAAA;AACnC,eAAO;AAAA,MACP;AAED,UAAI35B,QAAQ5X,OAAMotC,UAAUC,UAAUC,IAAI;AACzCs0G,yBAAiB,IAAI5hJ,OAAMuC,OAAOgvC,aAClC;AAAA,eAAO;AAAA,MACP;AACD77C,aAAOmS,WAAW45I,YAAY,CAAA;AAAA,IAC9B,GAAExkJ,IAEHm8D;AAAAA,aAAS8lF,WAAWl/I,OAAM4E,KAAK68I,YAAYxkJ;AAE3C8uH,cAAU/rH,OAAMm/I,yBAAyB58I,OACzC;AAAA,QAAA,OAAI,YAAoB,SAAUwpH,WAAU,EAAC38G,YAAY28G,QAEzD38G;AAAAA,iBAAa1R,GAAGquH,QAAQ38G,UAAAA,KAAe,oBAAIuG;AAC3CtG,eAAW3R,GAAGquH,QAAQ18G,QAAAA,KAAarP,OAAMm5D,iBAAiB,EACzD/pD,YACAgqD,UAAU,GACVhuD,MAAM1N,GAAAA,CAAAA;AAEP8jJ,mBAAejrJ,KAAKC,MAAMkH,GAAGquH,QAAQ3yD,QAAcp5D,CAAAA,KAAAA,OAAMovE,kBAAkB,EAC1EhgE,YACAC,UACAjE,MAAM1N,GAAAA,CAAAA;AAEP8jJ,mBAAe7zB,aAAaprH,OAAAA,EAAQoa,OAAO6kI,YAAAA;AAE3CxhJ,IAAAA,OAAMu+I,YAAYU,sBAAsBzkG,GAAG,GAAGprC,YAAY5I,KAAKjE,OAC/D62D;AAAAA,aAASpjD,QAAQwrI;AACjBC,eAAAA;AAAAA,EACF;AAECR,kBAAgBroJ,UAAU0zH,YAAY,SAASz1H,MAAM6G,IAAI6E;AACxD,QAAIysE,YAAY0yE,cAAc7qJ,MAAM0L,OAAAA;AACpC,QAAI62D,WAAWuoF,aAAa9qJ,MAAM0L;AAClC,QAAI0sE,UAAUjvE,OAAMm5D,iBAAiB,EAAC/pD,YAAY4/D,WAAW5V,UAAoBhuD,MAAM1N,GAAAA,CAAAA;AAEvF,QAAWsC,OAAAA,OAAMm/I,yBAAyB58I,OAAW,KAAA,UAAU;AAC9D,aAAOysE;AAAAA,IACP;AAED,WAAO,EACN5/D,YAAY4/D,WACZ3/D,UAAU4/D,SACV7V,SAEH;AAAA,EAAA;AAEC6nF,kBAAgBroJ,UAAU8vB,QAAQ,SAAS7xB,MAC1CmJ;AAAAA,IAAAA,OAAMy+I,OAAO5nJ,KAAK0/C,qBAAqB,QAAA,EAAU;EACnD;AAGC,WAASmrG,cAAc7qJ,MAAM0L,SAAAA;AAC5B,QAAIi4C,IAAI3jD,KAAK0/C,qBAAqB,QAAA;AAClC,QAAI/vC,MAAMjE,QAAOu8I;AACjB,QAAI3nI,QAAQ;AACZ,QAAIL,UAAU;AAEd,QAAI9W,OAAMugC,QAAQ/5B,IAAI,CAAK,CAAA,GAAA;AAC1B,UAAI1O,QAAQ0iD,EAAEh0C,IAAI,CAClB,CAAA;AAAA,UAAI4Q,OAAOlhB,SAAS4B,MAAMke,OAAO,EAAA;AACjC,UAAI5e,MAAMggB,SAAStf,MAAMM,aAAa,eAAe;AACpDgf,eAAOlhB,SAAS4B,MAAMT,aAAa,YAAe,GAAA,EAAA;AAAA,MAClD;AAED8f,cAAQ5gB,KAAKkS,MAAM2O,OAAO;AAC1BN,gBAAUM,OAAO;AAAA,IACjB;AACD,WAAO,IAAIzB,KAAK6kC,EAAEh0C,IAAI,IAAIwP,OAAOwkC,EAAEh0C,IAAI,CAAA,CAAA,EAAIwP,OAAOwkC,EAAEh0C,IAAI,CAAIwP,CAAAA,EAAAA,OAAOmB,OAAOL,OAAAA;AAAAA,EAC1E;AAED,WAAS6qI,aAAa9qJ,MAAM0L,SAAAA;AAC3B,QAAI62D,WAAWviE,KAAK0/C,qBAAqB,OAAS,EAAA,CAAA;AAElD6iB,eAAWu0D,aAAaprH,OAAQoS,EAAAA,MAAMykD,SAASpjD,KAC/C;AAAA,QAAA,CAAKojD,YAAY1jE,OAAO0B,MAAMgiE,UAAWA,YAAW;AACpD,QAAIA,WAAW,EAAGA,aAAAA;AAClB,WAAOA;AAAAA,EACP;AAED,SAAO6nF;AACR;ACvLe,SAAQa,yBAAC9hJ,QACvB;AAAA,MAAI6vG,SAASuwC,4BAAcpgJ;AAE3B,WAAS+hJ,gBAAAA;AACR,QAAI7vF,OAAO29C,OAAO3yG,MAAMD,MAAM4G,SAAc5G,KAAAA;AAE5C,WAAOi1D;AAAAA,EACP;AAEDw9C,YAAUqyC,eAAelyC,MAGzBkyC;AAAAA,gBAAcnpJ,UAAU+J,SAAS,SAASy7I;AACzC,WAAO4D,SAAS5D,KAAK,KAAA;AAAA,EACvB;AAEC2D,gBAAcnpJ,UAAUwzH,YAAY,SAASv1H,MAAMmf,OAAOtY,IAAI6E,SAAAA;AAG7D,QAAIyT,UAAU,EAAGA,SAAQ;AAEzB,QAAIisI,SAAS5sJ,SAASoE,cAAc,KAAA;AACpCwoJ,WAAO3mJ,YAAY0mJ,SAASz/I,SAAQ7E,GAAGwG,EAAAA;AACvC,QAAIg+I,aAAaD,OAAOpoJ,YAAYooJ,OAAOzmJ,UAC3C3E;AAAAA,SAAKsrJ,WAAW;AAChBtrJ,SAAKrB,WAAWuzG,aAAam5C,YAAYrrJ,IAAAA;AAEzC,WAAOmJ,OAAMu+I,YAAYxmJ,OAAOq0H,UAAUlvH,MAAM8C,QAAO,CAACkiJ,YAAYlsI,OAAOtY,IAAI6E,OACjF,CAAA;AAAA,EAAA;AAEC,WAASy/I,SAASz/I,SAAQsmG,SAAAA;AACzB,QAAIv4F,SAAQ,CAAA,GACX0/D,UAAU,CACX;AAAA,QAAI64B,SAAS;AACZv4F,MAAAA,SAAQtQ,OAAM4K,cAAAA;AACd,UAAIrI,QAAO6/I,YAAY;AACtB9xI,QAAAA,OAAMwlD,QAAQ,EAAC5xD,IAAIlE,OAAMuC,OAAOuV,SAASQ,MAAM/V,QAAO8/I,cAAc,GAAA,CAAA;AAAA,MACpE;AACD/xI,MAAAA,SAAQgyI,QAAQhyI,QAAO/N,SAAQsmG,OAC/B;AAAA,UAAItmG,QAAOrJ,MAAM;AAChBoX,QAAAA,OAAMpX,KAAKqJ,QAAOrJ,IAAAA;AAAAA,MAClB;AAAA,IACD;AACD,QAAIof,OAAO/V,QAAOqR,YAAY5T,OAAMmS,UAAUoG;AAC9C,aAASxf,IAAI,GAAGA,IAAIuX,OAAMtX,QAAQD,KAAK;AACtC,UAAIoa,QAAQmF,KAAKpb,MAAM8C,QAAO,CAACsQ,OAAMvX,CAAGqW,EAAAA,YAAYkB,OAAMvX,CAAGsW,EAAAA,UAAUiB,OAAMvX,CAC7E,CAAA,CAAA;AAAA,UAAIoa,UAAU7V,QAAW;AACxB6V,gBAAQ;AAAA,MACR;AACD68D,cAAQ/zE,KAAK,EACZqa,KAAKhG,OAAMvX,CAAAA,EAAGmL,IACdiP;IAED;AACD5Q,IAAAA,QAAOytE,UAAUA;AACjBztE,IAAAA,QAAO6vC,SAAS7vC,QAAO6vC,UAAU;AACjC,WAAOpyC,OAAMu+I,YAAYxmJ,OAAO4K,OAAOzF,MAAMD,MAAM4G,SAAAA;AAAAA,EACnD;AAED,WAASy+I,QAAQtyE,SAASztE,SAAQsmG;AACjC,QAAI3pD,SAAS38C,QAAO28C,UAAU,WAAA;AAC7B,aAAO;AAAA,IACV;AAEE8wB,cAAUA,QAAQn3E,MAAM,CAAA;AAExB,aAASE,IAAI,GAAGA,IAAIi3E,QAAQh3E,QAAQD,KAAK;AACxC,UAAIqS,OAAO4kE,QAAQj3E,CAAAA;AACnB,UAAIqS,KAAKlH,MAAM2kG,WAAW7oG,OAAM9B,UAAUkN,KAAKlH,IAAI2kG,OAAAA,KAAY3pD,OAAO9zC,KAAKlH,IAAIkH,IAAU,MAAA,OAAO;AAC/F4kE,gBAAQ12E,OAAOP,GAAG,CAClBA;AAAAA;AAAAA,MACA;AAAA,IACD;AACD,WAAOi3E;AAAAA,EACP;AACD,SAAO+xE;AACR;AC1Ee,SAAQQ,6BAACviJ,QAAAA;AACvB,MAAI6vG,SAASmuC,eAAAA;AAEb,WAASwE,oBAAAA;AACR,QAAItwF,OAAO29C,OAAO3yG,MAAMD,MAAM4G,cAAc5G;AAC5C,WAAOi1D;AAAAA,EACP;AAEDw9C,YAAU8yC,mBAAmB3yC,MAAAA;AAE7B,WAAS4yC,qBAAqBzsI;AAC7B,QAAKA,CAAAA,SAASA,UAAUhW,OAAMuC,OAAOw2D,iBAAiBC,QAAQhjD,UAAUhW,OAAMuC,OAAOw2D,iBAAiBE,MAAM;AAC3G,aAAO;AAAA,IACV,OAAS;AACN,aAAO;AAAA,IACP;AAAA,EACD;AAED,WAASypF,iBAAiBC,aAAaC,WACtC;AAAA,QAAIC,aAAaJ,qBAAqBG,SAAAA;AACtC,aAAS7pJ,IAAI,GAAGA,IAAI4pJ,YAAY3pJ,QAAQD,KAAK;AAC5C4pJ,kBAAY5pJ,GAAG+pJ,WAAWD;AAAAA,IAC1B;AAAA,EACD;AAEDL,oBAAkB5pJ,UAAU+J,SAAS,SAAUy7I,KAC9C;AAAA,UAAMznJ,SAASynJ,IAAIznJ,SAAS,UAAUynJ,IAAIznJ,MAAc,QAAA;AACxD,QAAI8jB,OAAO,6CAA6C2jI,IAAI9jJ,IAAAA,KAAS3D,SAAS,UAAUA,MAAY,MAAA,EAAA;AAEpG,QAAIq5E,UAAU,CAAA;AACd,aAASj3E,KAAKiH,OAAMuC,OAAOw2D,kBAAkB;AAC5CiX,cAAQ/zE,KAAK,EAAEqa,KAAKtW,OAAMuC,OAAOw2D,iBAAiBhgE,CAAIoa,GAAAA,OAAOnT,OAAMoT,OAAOC,OAAOrT,OAAMuC,OAAOw2D,iBAAiBhgE,CAAAA,CAAAA,EAAAA,CAAAA;AAAAA,IAC/G;AAEDqlJ,QAAIpuE,UAAUouE,IAAIpuE,WAAWA;AAE7Bv1D,YAAQ,uCAAuCglI,YAAYC,cAActB,IAAIpuE,SAAS,CAAC,EAAE15D,KAAK,aAAaN,OAAO,kBAAA,CAAA,CAAA,IAAwB;AAE1I,QAAI+sI,YAAY/iJ,OAAMoT,OAAOC,OAAO,iBAAA,KAAsB;AAC1DoH,YAAQ,wCAAwCsoI,YAAY,OAAO/iJ,OAAMu+I,YAAYK,cAAc9lJ,KAAKmE,MAAMmhJ,GAAAA,IAAO;AAErH3jI,YAAQ;AACR,WAAOA;AAAAA,EACT;AAEC+nI,oBAAkB5pJ,UAAUwzH,YAAY,SAAUv1H,MAAMmf,OAAO5K,MAAM7I,SACpE;AAAA,QAAIygJ,aAAansJ,KAAKqE,cAAc,sCACpC;AAAA,QAAIynJ,cAAc9rJ,KAAK2B,iBAAiB;AACxC,QAAIgO,MAAMjE,QAAOu8I;AAEjB,QAAI/yB,UAAU/rH,OAAMm/I,yBAAyB58I,OAAAA;AAE7C,QAAKygJ,CAAAA,WAAWC,oBAAoB;AACnCD,iBAAWriH,iBAAiB,UAAU,SAAUxkC,GAAAA;AAC/CumJ,yBAAiBC,aAAaxmJ,EAAEI,OAAOyZ,KAAAA;AAAAA,MAC3C;AACGgtI,iBAAWC,qBAAqB;AAAA,IAChC;AAED,QAAIC,iBAAiB93I,KAAK2gH,QAAQ31G,eAAAA,KAAoB,oBAAIT;AAC1D3V,IAAAA,OAAMu+I,YAAYU,sBAAsB0D,aAAa,GAAGO,gBAAgB18I,KAAKjE,OAAAA;AAE7E,QAAI4gJ,iBAAiB/3I,KAAK2gH,QAAQjzD,oBAAoB94D,OAAMojJ,kBAAkBh4I;AAC9E43I,eAAWhtI,QAAQmtI;AACnBT,qBAAiBC,aAAaQ,cAChC;AAAA,EAAA;AAECX,oBAAkB5pJ,UAAU0zH,YAAY,SAAUz1H,MAAMuU,MAAM7I,SAAAA;AAC7D,QAAIygJ,aAAansJ,KAAKqE,cAAc,sCAAA;AACpC,QAAIynJ,cAAc9rJ,KAAK2B,iBAAiB;AAExC,QAAI2qJ,iBAAiBH,WAAWhtI;AAChC,QAAIktI,iBAAiB;AACrB,QAAA,CAAKT,qBAAqBU,cAAAA,GAAiB;AAC1CD,uBAAiBljJ,OAAMu+I,YAAYe,mBAAmBqD,aAAapgJ,OACnE;AAAA,IAAA;AAED,WAAO,EACNu2D,iBAAiBqqF,gBACjB/sI,iBAAiB8sI,eAEpB;AAAA,EAAA;AAECV,oBAAkB5pJ,UAAU8vB,QAAQ,SAAU7xB,MAC7CmJ;AAAAA,IAAAA,OAAMy+I,OAAO5nJ,KAAKqE,cAAc,QAClC,CAAA;AAAA,EAAA;AAEC,SAAOsnJ;AACR;ACxFe,SAAQa,6BAACrjJ,QACvB;AAAA,QAAM6vG,SAASquC,4BAAMl+I;AAErB,WAASsjJ,oBAAAA;AACR,QAAIpxF,OAAO29C,OAAO3yG,MAAMD,MAAM4G,SAAc5G,KAAAA;AAE5C,WAAOi1D;AAAAA,EACP;AAEDw9C,YAAU4zC,mBAAmBzzC,MAAAA;AAE7ByzC,oBAAkB1qJ,UAAU+J,SAAS,SAASy7I;AAC7C,QAAIxqH,QAAQ5zB,OAAMuC,OAAOqxB,OACxBxgB,UAASpT,OAAMoT,OAAOC,QACtB28D,UAAU,CAAA;AAEX,QAAI9wB,SAASk/F,IAAIl/F,UAAU,SAAUqkG,SAASX,WAC7C;AAAA,UAAA,CAAKhvH,MAAMC,eAAe+uH,cAAchvH,MAAMC,aAAa;AAC1D,eAAO;AAAA,MACP;AACD,aAAO;AAAA,IACV;AACE,aAAS96B,KAAK66B,OAAO;AACpB,UAAKsrB,CAAAA,OAAOnmD,GAAG66B,MAAM76B,QAAQ,OAAO;AACnCi3E,gBAAQ/zE,KAAK,EAAEqa,KAAKsd,MAAM76B,CAAAA,GAAIoa,OAAOC,QAAO,UAAUra,CAAAA,EAAAA,CAAAA;AAAAA,MACtD;AAAA,IACD;AACDqlJ,QAAIpuE,UAAUA;AAEd,QAAIwzE,cAAcpF,IAAIc;AACtBd,QAAIc,WAAW,WACdl/I;AAAAA,MAAAA,OAAMyjJ,yBAAyBxmJ,KAAK+Y;AACpChW,MAAAA,OAAM+5F,mBAAmB98F,KAAK+Y;AAC9B,UAAWwtI,OAAAA,eAAe,YAAY;AACrCA,oBAAYtmJ,MAAMD,MAAM4G,SACxB;AAAA,MAAA;AAAA,IACJ;AAEE,WAAOgsG,OAAOj3G,UAAU+J,OAAOzF,MAAMD,MAAM4G,SAC7C;AAAA,EAAA;AAEC,SAAOy/I;AACR;ACzCe,SAAQI,2BAAC1jJ;AACvB,MAAI6vG,SAASmuC;AAEb,WAASiD,kBAAAA;AACR,QAAI/uF,OAAO29C,OAAO3yG,MAAMD,MAAM4G,SAAc5G,KAAAA;AAE5C,WAAOi1D;AAAAA,EACP;AAED,WAASy7D,aAAaprH,SACrB;AAAA,WAAOA,QAAOqrH,aAAa,IAAIl3C;AAAAA,EAC/B;AAED,WAASitE,qBAAsB9sJ,MAAMqvD,UAAU96C,MAAM7I;AACpD,UAAM6U,OAAO,qCAAqCpX,OAAMu+I,YAAYK,cAAc9lJ,KAAKkH,QAAOuC,OAAAA,IAAU;AACxG,QAAIqhJ,gBAAgB,MAAK5jJ,OAAMoT,OAAOC,OAAOrT,OAAMuC,OAAO4sC,gBAAgB,GAAA,IAAM;AAChF,UAAM+xG,aAAa3+I,QAAOgwC,cAAc,0BAA0B;AAClE,UAAM/jC,WAAWjM,QAAOiM,WAAW,yBAAyB;AAC5D,UAAMouB,WAAW58B,OAAM08B,SAASykH,gCAAgC5+I,OAAAA;AAChE,UAAMshJ,cAAc7jJ,OAAMoT,OAAOC,OAAOypF;AAExC,QAAIskD,qBAAqB;AACzB,QAAG7+I,QAAOqrH,WAAW;AACpBg2B,sBAAgB;AAChBxC,4BAAsB;AAAA,IACtB;AAED,UAAM0C,aAAa,iCAAiC5C,aAAa,kGAEF1yI,WAAW,8CAC9B4yI,qBAAmB,MAAM5yI,WAAW,MAAMouB,WAAW,+DAClCpuB,WAAW,iDAEjCo1I,gBAAc;AAIvD,UAAMG,eAAe,gEAAgEF,WAAAA;AAErF,UAAMG,cAAc3uJ,SAASoE,cAAc,KAC3CuqJ;AAAAA,gBAAYhqJ,YAAY;AACxBgqJ,gBAAY/5H,aAAa,oBAAoBi8B,SAAShiD,EAAAA;AACtD8/I,gBAAY1oJ,YAAY8b,OAAO0sI,aAAaC,eAAe;AAC3DltJ,SAAK8C,YAAYqqJ,WAAAA;AAEjB,QAAIxpG,IAAIwpG,YAAYztG,qBAAqB;AACzC,QAAI8qG,OAAO2C,YAAYztG,qBAAqB,OAC5C;AAAA,QAAI6iB,WAAWioF,KAAK,CAAA;AACpB,QAAIC,OAAO,CAACD,KAAK,IAAIA,KAAK,CAAA,CAAA;AAC1B,QAAIE,UAAUyC,YAAYztG,qBAAqB,MAAQ,EAAA,CAAA;AACvD,QAAI/vC,MAAMjE,QAAOu8I;AAEjB,QAAI1vI;AACJ,QAAIC;AACJ,QAAImyI;AAEJ,UAAMyC,WAAWD,YAAY9oJ,cAAc,yBAAA;AAC3C+oJ,aAASziD,UAAU,SAASrlG,GAC3B;AAAA,YAAM+nJ,UAAUF,YAAYxuJ;AAC5BwuJ,kBAAY1oJ,YAAY;AACxB0oJ,kBAAYx2I,OAAAA;AACZ,UAAI02I,QAAQ5oJ,cAAc,IAAG;AAC5B4oJ,gBAAQ5oJ,YAAY0E,OAAMoT,OAAOC,OAAOupF;AAAAA,MACxC;AAAA,IACJ;AAGE,aAAS6kD,aACR;AAAA,UAAIryI,cAAasyI,cAAc5oJ,KAAKkH,QAAOgkJ,aAAazhJ,OAAAA;AACxD,UAAI62D,YAAWuoF,aAAa7oJ,KAAKkH,QAAOgkJ,aAAazhJ,OAAAA;AACrD,UAAI8M,YAAWrP,OAAMm5D,iBAAiB,EAAC/pD,YAAYA,aAAYgqD,UAAUA,WAAUhuD,KAEnF,CAAA;AAAA,UAAIwI,WAAW5T,OAAMmS,UAAUmyC,iBAAiBtkD,OAAMmS,UAAUq/B;AAChE+vG,cAAQjmJ,YAAYsY,SAASvE,SAAAA;AAAAA,IAC7B;AAED,aAASuyI,iBAAiBllI,MAAAA;AACzB,UAAI1G,QAAQojD,SAASpjD;AAErBA,cAAQ23G,aAAaprH,OAAAA,EAAQoS,MAAMqB,KACnC;AAAA,UAAItgB,OAAO0B,MAAM4e,KAChBA,EAAAA,SAAQ;AACTA,eAAS0G;AACT,UAAI1G,QAAQ,EAAGA,SAAQ;AACvBojD,eAASpjD,QAAQ23G,aAAaprH,OAAQoa,EAAAA,OAAO3G;AAC7CyrI,iBACA;AAAA,IAAA;AAEDH,SAAK,CAAG9/C,EAAAA,UAAUxhG,OAAM4E,KAAK,WAAA;AAC5Bg9I,uBAAkB,KAAI5hJ,OAAMuC,OAAOgvC;IACnC,GAAEvxC,MAAAA;AACHshJ,SAAK,CAAG9/C,EAAAA,UAAUxhG,OAAM4E,KAAK,WAAA;AAC5Bg9I,uBAAiB,IAAI5hJ,OAAMuC,OAAOgvC;IAClC,GAAEvxC,MAAAA;AACHw6C,MAAE,CAAA,EAAG0kG,WAAWuC;AAChBjnG,MAAE,CAAG0kG,EAAAA,WAAWuC;AAChBjnG,MAAE,CAAG0kG,EAAAA,WAAWuC;AAChB,QAAIjnG,EAAE,GAAIA,GAAE,CAAA,EAAG0kG,WAAWuC;AAE1BroF,aAASgoC,YAAYphG,OAAM4E,KAAK,SAASzI;AACxC,UAAIyb;AAEJzb,UAAIA,KAAKzG,OAAO4G;AAChBsb,aAAQzb,EAAE0lJ,YAAY1lJ,EAAE+nB,WAAW/nB,EAAEgpB;AAErC,UAAIvN,QAAQ5X,OAAMotC,UAAUC,UAAUE,MAAM;AAC3Cq0G,yBAAAA,KAAsB5hJ,OAAMuC,OAAOgvC,aAAAA;AACnC,eAAO;AAAA,MACP;AAED,UAAI35B,QAAQ5X,OAAMotC,UAAUC,UAAUC,IAAI;AACzCs0G,yBAAiB,IAAI5hJ,OAAMuC,OAAOgvC;AAClC,eAAO;AAAA,MACP;AACD77C,aAAOmS,WAAW45I,YAAY,CAC9B;AAAA,IAAA,GAAEzhJ,MAEHo5D;AAAAA,aAAS8lF,WAAWl/I,OAAM4E,KAAK68I,YAAYzhJ,MAAAA;AAEjCA,IAAAA,OAAMm/I,yBAAyB58I,OAAAA;AAGzC6M,iBAAa82C,SAAS92C,cAAc,oBAAIuG;AACxCtG,eAAW62C,SAAS72C,YAAYrP,OAAMm5D,iBAAiB,EACtD/pD,YACAgqD,UAAU,GACVhuD,KAAAA,CAAAA;AAEDo2I,mBAAexhJ,OAAMovE,kBAAkB,EACtChgE,YACAC,UACAjE,KAAAA,CAAAA;AAEDo2I,mBAAe7zB,aAAaprH,SAAQoa,OAAO6kI,YAAAA;AAE3CxhJ,IAAAA,OAAMu+I,YAAYU,sBAAsBzkG,GAAG,GAAGprC,YAAY5I,KAAKjE;AAC/D62D,aAASpjD,QAAQwrI;AACjBC,eACA;AAAA,EAAA;AAED/xC,YAAUuxC,iBAAiBpxC,MAE3BoxC;AAAAA,kBAAgBroJ,UAAU+J,SAAS,SAASy7I,KAC3C;AAAA,UAAM+F,kBAAkB,uBAAuB/F,IAAIznJ,UAAU,GAAA;AAC7D,WAAOwtJ;AAAAA,EACT;AAEClD,kBAAgBroJ,UAAUwzH,YAAY,SAASv1H,MAAMmf,OAAO5K,MAAM7I;AACjE,QAAI6I,KAAK8tD,WAAU;AAClBriE,WAAKyE,YAAY;AAEjB8P,WAAK8tD,UAAU9yD,QAAS8/C,cAAAA;AACvBy9F,6BAAqB9sJ,MAAMqvD,UAAU96C,MAAM7I,OAAAA;AAAAA,MAAO,CAEtD;AAAA,IAAA,OAAS;AACN1L,WAAKyE,YAAY0E,OAAMoT,OAAOC,OAAOupF;AAAAA,IACrC;AAAA,EAEH;AAECqkD,kBAAgBroJ,UAAU0zH,YAAY,SAASz1H,MAAMuU,MAAM7I;AAC1D,UAAM22D,aAAY;AAClB,UAAMkrF,eAAevtJ,KAAK2B,iBAAiB,oBAAA;AAC3C4rJ,iBAAah+I,QAASi+I,kBACrB;AAAA,YAAMC,aAAaD,aAAaE,QAAQD;AACxC,YAAMnjF,gBAAgBnhE,OAAMsoC,aAAa,WAAA;AACzC,UAAI4d,WAAWib,cAAcvqC,QAAQ0tH;AACrC,UAAIE;AACJ,UAAIt+F,UAAS;AACZs+F,0BAAkBxkJ,OAAMsB,KAAK4kD,QAAAA;AAAAA,MACjC,OAAU;AACNs+F,0BAAkB,EACjBtgJ,IAAIlE,OAAM01B,IAAAA,GACVoF,SAAS1vB,KAAKlH,IACdoU,MAAM,aAEP;AAAA,MAAA;AACDksI,sBAAgBp1I,aAAasyI,cAAc2C,cAAc9hJ;AACzDiiJ,sBAAgBprF,WAAWuoF,aAAa0C,cAAc9hJ,OAAAA;AACtDiiJ,sBAAgBn1I,WAAWrP,OAAMm5D,iBAAiB,EAAC/pD,YAAYo1I,gBAAgBp1I,YAAYgqD,UAAUorF,gBAAgBprF,UAAUhuD,KAE/H8tD,CAAAA;AAAAA,MAAAA,WAAUj9D,KAAKuoJ,eAAgB;AAAA,IAAA,CAAA;AAGhC,WAAOtrF;AAAAA,EACT;AAEC+nF,kBAAgBroJ,UAAU6rJ,eAAe,SAAUhhJ,OAAOjF,IAAI0lJ,SAASpoH,WAAAA;AACtE,QAAI97B,OAAMgF,UAAU,mBAAmB,CAAChF,OAAMmyF,cAAc+xD,cAAc,OAAO;AAChF;AAAA,IACA;AACD,QAAI1lJ,GAAGL,QAAQ,6CAAA,GAA+C;AAC7D29B,gBAAUxgC,YAAY0E,OAAMoT,OAAOC,OAAOupF;AAAAA,IAC1C;AACD,QAAIp+F,GAAGL,QAAQ,0CAA4C,GAAA;AAC1D,UAAI29B,UAAUxgC,aAAa0E,OAAMoT,OAAOC,OAAOupF,+BAA8B;AAC5E9gE,kBAAUxgC,YAAY;AAAA,MACtB;AACD,YAAM8P,OAAOpL,OAAMmc,QAAQnc,OAAMmyF;AACjC,YAAMjsC,WAAW,EAChBhiD,IAAIlE,OAAM01B,IAAAA,GACVoF,SAAS1vB,KAAKlH,IACdoU,MAAM,cACNlJ,YAAYhE,KAAKgE,YACjBC,UAAUjE,KAAKiE;AAEhB,YAAM9M,UAASvC,OAAM0kJ,2BAA6BjhJ,EAAAA,KAAAA;AAClDkgJ,2BAAqB7nH,WAAWoqB,UAAU96C,MAAM7I;IAChD;AAAA,EACH;AAEC0+I,kBAAgBroJ,UAAU8vB,QAAQ,SAAS7xB;AAC1CmJ,IAAAA,OAAMy+I,OAAO5nJ,KAAK0/C,qBAAqB,QAAU,EAAA,CAAA,CAAA;AAAA,EACnD;AAGC,WAASmrG,cAAc7qJ,MAAM0L,SAC5B;AAAA,QAAIi4C,IAAI3jD,KAAK0/C,qBAAqB,QAClC;AAAA,QAAI/vC,MAAMjE,QAAOu8I;AACjB,QAAI3nI,QAAQ;AACZ,QAAIL,UAAU;AAEd,QAAI9W,OAAMugC,QAAQ/5B,IAAI,CAAA,CAAA,GAAK;AAC1B,UAAI1O,QAAQ0iD,EAAEh0C,IAAI;AAClB,UAAI4Q,OAAOlhB,SAAS4B,MAAMke,OAAO,EACjC;AAAA,UAAI5e,MAAMggB,IAAAA,KAAStf,MAAMM,aAAa,YAAA,GAAe;AACpDgf,eAAOlhB,SAAS4B,MAAMT,aAAa,YAAA,GAAe,EAClD;AAAA,MAAA;AAED8f,cAAQ5gB,KAAKkS,MAAM2O,OAAO,EAAA;AAC1BN,gBAAUM,OAAO;AAAA,IACjB;AACD,WAAO,IAAIzB,KAAK6kC,EAAEh0C,IAAI,CAAA,CAAA,EAAIwP,OAAOwkC,EAAEh0C,IAAI,CAAIwP,CAAAA,EAAAA,OAAOwkC,EAAEh0C,IAAI,IAAIwP,OAAOmB,OAAOL,OAC1E;AAAA,EAAA;AAED,WAAS6qI,aAAa9qJ,MAAM0L,SAC3B;AAAA,QAAI62D,WAAWviE,KAAK0/C,qBAAqB,SAAS,CAElD6iB;AAAAA,eAAWu0D,aAAaprH,OAAAA,EAAQoS,MAAMykD,SAASpjD;AAC/C,QAAKojD,CAAAA,YAAY1jE,OAAO0B,MAAMgiE,QAAWA,EAAAA,YAAW;AACpD,QAAIA,WAAW,EAAGA,aAAAA;AAClB,WAAOA;AAAAA,EACP;AAED,SAAO6nF;AACR;ACzOe,SAAQ/uG,SAAElyC,QAGxB;AAAA,MAAIm+I,kBAAkBF,2BAAAA;AACtB,MAAIK,kBAAkBD,2BAA2Br+I,MACjD;AAAA,MAAI2+I,cAAcD,uBAAuB1+I,MACzC;AAAA,MAAIogJ,gBAAgBuE,4BAAyB3kJ,MAAAA;AAC7C,MAAIugJ,kBAAkBD,2BAA2BtgJ,MAAAA;AACjD,MAAI6gJ,eAAeD,wBAAwB5gJ;AAC3C,MAAIihJ,kBAAkBD,2BAA2BhhJ,MACjD;AAAA,MAAI+hJ,gBAAgBD,yBAAyB9hJ,MAC7C;AAAA,MAAI4kJ,mBAAmBzE,4BAA4BngJ,MAAAA;AACnD,MAAIwiJ,oBAAoBD,6BAA6BviJ;AACrD,MAAIsjJ,oBAAoBD,6BAA6BrjJ,MAAAA;AACrD,MAAI6kJ,kBAAkBnB,2BAA2B1jJ,MAEjDA;AAAAA,EAAAA,OAAM8kJ,oBAAoB;AAC1B9kJ,EAAAA,OAAMs0I,qBAAqB;AAC3Bt0I,EAAAA,OAAMs0I,qBAAqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAS3Bt0I,EAAAA,OAAM+kJ,iBAAiB/kJ,OAAMgC;AAC7B,WAASgjJ,gBAAAA;AACR,UAAMC,iBAAiBjlJ,OAAMuC,OAAOiyC,QAAQ;AAC5C,UAAM0wG,wBAA0BxvJ,CAAAA,CAAAA,OAAO,aAAaA,OAAO,IAAA,KAASA,OAAO,MAAY,KAAA,sBAAsBL,SAASD;AACtH,QAAI6vJ,kBAAkBC,uBAAuB;AAC5CllJ,MAAAA,OAAM+kJ,iBAAiB/kJ,OAAMgC;AAAAA,IAChC,OAAS;AACNhC,MAAAA,OAAM+kJ,iBAAiB1vJ,SAASD;AAAAA,IAChC;AAAA,EACD;AAGD,MAAIyL,QAAQb,OAAMc,UAAUC,WAAW,OAAA;AACvCF,QAAMG,iBAAiB,YAAY;AAClC,WAAO,EACNkxC,UAAUlyC,OAAMmyF,aAEnB;AAAA,EAAA,CAAA;AAECnyF,EAAAA,OAAM0uB,eAAe,SAAUxqB,IAC9B;AAAA,QAAIkH,OAAOnO,KAAKkf,QAAQjY,EACxB;AAAA,QAAA,CAAKjH,KAAK+H,UAAU,oBAAoB,CAACd,MAAM;AAC9C,UAAGlE,OAAM0d,aAAaxZ,EAAAA,KAAOlE,OAAMmc,QAAQjY,EAAAA,EAAI+tF,MAAK;AAEnDh1F,aAAK81B,MAAMC,WAAWs3B,aACtB;AAAA,MAAA;AACD;AAAA,IACA;AAED,QAAIn1D,MAAM8H,KAAKyyB,YAAYzyB,KAAKmhC,YAAYhzB,KAAK8D,IAAAA,CAAAA;AAEjDjS,SAAKkoJ,UAAUhwJ,GAAAA;AACf8H,SAAKmoJ,eAAelhJ,IAAI/O;AACxB8H,SAAKooJ,eAAelwJ,GACpB8H;AAAAA,SAAKy/B,SAAS4oH,oBAAoBnwJ;AAElC8H,SAAK+H,UAAU,cAAc,CAACd,EAChC,CAAA;AAAA,EAAA;AAEC,WAASqhJ,kBAAkBvlJ,QAAAA;AAC1B,QAAImM,WAAWnM,OAAMoM,IAAIC,QAAQ,UACjC;AAAA,QAAIF,YAAYA,SAASvV,UAAAA,GAAa;AACrC,aAAO;AAAA,IACV,OAAS;AACN,aAAO;AAAA,IACP;AAAA,EACD;AAEDoJ,EAAAA,OAAMw/I,uBAAuB,WAC5B;AAAA,QAAIviJ,KAAKsF,OAAOwuC,iBAAiB;AAChC,UAAIr0B;AACJ,UAAI6oI,kBAAkBtoJ,IAAO,GAAA;AAC5B,YAAIisB,QAAQlpB,OAAMsZ;AAClBoD,eAAQ29E,iBAAyBnxE,MAAM/iB,IAAAA,IAAQ+iB,MAAMxM,OAAQ;AAAA,MAC7D;AAED,UAAA,CAAKA,QAAQA,QAAQ,KAAK,IAAI;AAC7BA,eAAOzf,KAAKsF,OAAO+uC;AAAAA,MACnB;AACD,aAAO50B;AAAAA,IACP;AACD,WAAOzf,KAAKsF,OAAO+uC;AAAAA,EACrB;AACCtxC,EAAAA,OAAMwlJ,WAAW,SAAU9lF,UAAUppD,KACpC;AAAA,QAAI67B,WAAWl1C,KAAKynJ,2BAAAA;AACpB,aAAS3rJ,IAAI,GAAGA,IAAIo5C,SAASn5C,QAAQD,KAAK;AACzC,UAAIo5C,SAASp5C,CAAGq5C,EAAAA,UAAUstB,UAAU;AACnC,YAAIsQ,UAAU79B,SAASp5C,CAAAA,EAAGi3E;AAC1B,iBAAS5zD,IAAI,GAAGA,IAAI4zD,QAAQh3E,QAAQojB,KAAK;AACxC,cAAI4zD,QAAQ5zD,CAAG9F,EAAAA,OAAOA,KAAK;AAC1B,mBAAO05D,QAAQ5zD,GAAGjJ;AAAAA,UAClB;AAAA,QACD;AAAA,MACD;AAAA,IACD;AACD,WAAO;AAAA,EACT;AAECnT,EAAAA,OAAMkwE,mBAAmB,SAAUu1E,WAAWjpE;AAC7CA,iBAAaA,WAAW3jF,MAAM,CAAA;AAC9B,QAAIyM,OAAOtF,OAAMy8E,WAAWgpE,SAAAA;AAC5B,QAAKngJ,CAAAA,KAAM,QAAO;AAClBA,SAAKhM,OAAO,GAAGgM,KAAKtM,MACpBsM;AAAAA,SAAKrJ,KAAKiB,MAAMoI,MAAMk3E,cAAc,CAAA,CAAA;AACpCx8E,IAAAA,OAAMy6F,cAAAA;AAAAA,EACR;AACCz6F,EAAAA,OAAMg6F,kBAAkB,WACvB;AAAA,WAAO/8F,KAAKmhC,YAAYnhC,KAAKyoJ,cAC/B;AAAA,EAAA;AACC1lJ,EAAAA,OAAM0vB,cAAc,SAAUxgB,MAAAA;AAC7B,QAAIy2I;AACJ,QAAIC;AACJ,QAAInrI;AACJ,QAAI2jI;AACJ,QAAIyH;AACJ,QAAIC,aAAa;AACjBd;AAEA,QAAI91I,SAAS5R,OACZ4R,QAAOjS,KAAK+8F;AAEb,QAAK/8F,CAAAA,KAAK8oJ,aAAa9oJ,KAAK+8F,gBAAqB/8F,KAAAA,KAAKmhC,YAAYlvB,IAAO,GAAA;AACxEjS,WAAKyoJ,iBAAiBzoJ,KAAKmhC,YAAYlvB,IACvCy2I;AAAAA,oBAActwJ,SAASoE,cAAc,KACrCqsJ;AAAAA,mBAAa;AACbF,kBAAY3oJ,KAAK+oJ,wBAEjB;AAAA,UAAIhmJ,OAAMuC,OAAO0jJ,UAChBH,eAAc;AAEf,UAAIF,WAAW;AACdE,sBAAc;AAAA,MACd;AAEDH,kBAAY3rJ,YAAY8rJ;AAExBH,kBAAY1uJ,MAAMF,aAAa;AAC/B0jB,aAAOxd,KAAKq3I;AACZ75H,cAAQ;AACRA,cAAQyrI,eAAejpJ,KAAKsF,OAAOqvC,YACnCn3B;AAAAA,cAAQ;AACRA,cAAQyrI,eAAejpJ,KAAKsF,OAAO0vC,aACnCx3B;AAAAA,cAAQ;AAERkrI,kBAAYrqJ,YAAYmf;AAExBza,MAAAA,OAAM08B,SAASypH,aAAaR,WAE5B;AAAA,UAAI3lJ,OAAMuC,OAAOiwC,eAAe;AAC/BmzG,oBAAYnqJ,WAAW4qJ,cAAcpmJ,OAAMqmJ;AAC3CV,oBAAYnqJ,WAAW8qJ,eAAe,SAAUnqJ,GAAAA;AAC/C6D,UAAAA,OAAMqmJ,cAAclqJ,EAAE8mD,QAAQ;QACnC;AACI0iG,oBAAYnqJ,WAAW+qJ,gBAAgB,WAAA;AACtC,iBAAO;AAAA,QACZ;AACIZ,oBAAYnqJ,WAAWvE,MAAMuvJ,SAAS;AACtCxmJ,QAAAA,OAAMymJ,iBAAAA;AAAAA,MACN;AAGD,UAAIxpJ,KAAK8oJ,WAAU;AAClB9oJ,aAAKw9F,cACL;AAAA,MAAA;AACDisD,iBACAzpJ;AAAAA,WAAK0pJ,OAAOjlD,aAAaikD,aAAa1oJ,KAAK0pJ,OAAOnrJ,UAAAA;AAClDyB,WAAK8oJ,YAAYJ;AAEjBvH,YAAMnhJ,KAAKynJ,2BAA2Bx1I,IAAAA;AACtCuL,aAAOxd,KAAK2pJ,iBAAiBxI,GAE7ByH;AAAAA,WAAKF,YAAYzqJ,cAAc;AAG/B,UAAI2rJ,kBAAkBhB,GAAG5uJ,MAAM+pB;AAC/B6kI,SAAG5uJ,MAAM+pB,WAAW;AAEpB6kI,SAAGvqJ,YAAYmf;AAIfqsI,yBAAmB1I,GAEnByH;AAAAA,SAAG5uJ,MAAM+pB,WAAW6lI;AAEpB5pJ,WAAK8pJ,sBAAsB9pJ,IAC3B0oJ;AAAAA,kBAAY1uJ,MAAMH,UAAU;AAC5B6uJ,kBAAY1uJ,MAAMF,aAAa;AAAA,IAC/B;AACD,WAAOkG,KAAK8oJ;AAAAA,EACd;AAEC/lJ,EAAAA,OAAM4mJ,mBAAmB,SAAUxI,KAClC;AAAA,QAAI3jI,OAAO;AACX,aAAS1hB,IAAI,GAAGA,IAAIqlJ,IAAIplJ,QAAQD,KAAK;AACpC,UAAIiuJ,QAAQ/pJ,KAAKshJ,YAAYH,IAAIrlJ,CAAAA,EAAGmW,IACpC;AAAA,UAAA,CAAK83I,MAAO;AACZ5I,UAAIrlJ,CAAGmL,EAAAA,KAAK,UAAUjH,KAAKy4B,IAAAA;AAE3B,UAAI5+B,UAAUsnJ,IAAIrlJ,CAAGspG,EAAAA,SAAS,0BAA0B;AACxD,UAAIpqG,SAAS;AACb,UAAImmJ,IAAIrlJ,CAAAA,EAAGd,QAAQ;AAClBA,iBAAS,kDAAkDc,IAAI,uCAAuCqlJ,IAAIrlJ,GAAGd,SAAS,oDAAoDgF,KAAKmW,OAAOC,OAAO,YAAY+qI,IAAIrlJ,CAAAA,EAAGd,MAAU,IAAA;AAAA,MAC1N;AACD,UAAImmJ,IAAIrlJ,CAAGmW,EAAAA,QAAQ,aAAa;AAC/BjX,iBAAS,yEAAyEc,IAAI,sGAAsGkE,KAAKmW,OAAOC,OAAO0pF,8BAA8B,kFACvKhkG,IAAI,kGAAkGkE,KAAKmW,OAAOC,OAAOwpF,uBAAuB;AAAA,MACtN;AACD,UAAI5/F,KAAKsF,OAAO0jJ,WAAW;AAC1BxrI,gBAAQ,qCAAqC3jB,UAAU;AAAA,MACvD;AACD2jB,cAAQ,cAAc2jI,IAAIrlJ,CAAGmL,EAAAA,KAAK,yCAAyCjM,SAASgF,KAAKmW,OAAOC,OAAO,aAAa+qI,IAAIrlJ,CAAAA,EAAGuB,QAAQ,mBAAmB0sJ,MAAMrkJ,OAAO7J,KAAKmE,MAAMmhJ,IAAIrlJ;AAClL0hB,cAAQ;AAAA,IACR;AACD,WAAOA;AAAAA,EACT;AAECza,EAAAA,OAAMinJ,mBAAmB,SAAS9xJ,KACjC6K;AAAAA,IAAAA,OAAMqlJ,eAAelwJ,GAAAA;AAAAA,EACvB;AACC6K,EAAAA,OAAMqlJ,iBAAiB,SAASlwJ,KAC/B;AAAA,QAAA,CAAIA,KAAI;AACP;AAAA,IACA;AACD,UAAM+xJ,cAAclnJ,OAAM+kJ,kBAAkB/kJ,OAAMgC;AAClD7M,QAAI8B,MAAMnC,MAAMyB,KAAKuD,IAAIotJ,YAAYjxJ,eAAe,IAAId,IAAIc,eAAa,GAAG,CAAK,IAAA;AACjFd,QAAI8B,MAAMlC,OAAOwB,KAAKuD,IAAIotJ,YAAYlxJ,cAAc,IAAIb,IAAIa,cAAY,GAAG,CAAK,IAAA;AAAA,EAClF;AAECgK,EAAAA,OAAMmlJ,YAAY,SAAUhwJ;AAC3B,QAAIA,KAAI;AACPA,UAAI8B,MAAMH,UAAQ;AAElBmG,WAAKooJ,eAAelwJ;IACpB;AACDuxJ,eAAAA;AACAzpJ,SAAK0pJ,OAAO1vJ,MAAMH,UAAU;AAAA,EAC9B;AACC,QAAM4vJ,aAAW,WAChB;AAAA,QAAG1mJ,OAAM2mJ,QAAQ;AAChB;AAAA,IACA;AAED3mJ,IAAAA,OAAM2mJ,SAAOtxJ,SAASoE,cAAc,KACpCuG;AAAAA,IAAAA,OAAM2mJ,OAAO3sJ,YAAU;AACvBgG,IAAAA,OAAM2mJ,OAAO1vJ,MAAMH,UAAU;AAE7BkJ,IAAAA,OAAM1D,MAAM0D,OAAM2mJ,QAAQ,aAAa3mJ,OAAMmnJ,eAC7CnnJ;AAAAA,IAAAA,OAAM1D,MAAM0D,OAAM2mJ,QAAQ,WAAW3mJ,OAAMonJ,WAE3C;AAAA,UAAMF,cAAclnJ,OAAM+kJ,kBAAkB/kJ,OAAMgC;AAClDklJ,gBAAYvtJ,YAAYqG,OAAM2mJ,MAChC;AAAA,EAAA;AAEC3mJ,EAAAA,OAAM+mJ,wBAAwB,WAAA;AAC7B/mJ,IAAAA,OAAMqnJ,kBAAkB;AAGxBrnJ,IAAAA,OAAMqnJ,gBAAgB9mD,iBAAiB;AACtCvgG,MAAAA,OAAMsnJ,eAAAA;AAAAA,IACT;AAGEtnJ,IAAAA,OAAMqnJ,gBAAgB5mD,mBAAmB,WAAA;AACxCzgG,MAAAA,OAAMyjJ,yBAAyB;AAC/B,UAAKzjJ,CAAAA,OAAMgF,UAAU,oBAAoB,CAAChF,OAAMmyF,YAC/C,CAAA,EAAA;AAED,UAAInyF,OAAM0d,aAAa1d,OAAMmyF,eAAe;AAC3CnyF,QAAAA,OAAMwuB,OAAOC,QAAQ,QAAUzuB,EAAAA,OAAMmyF;MACzC,OAAU;AACNnyF,QAAAA,OAAM24F,aAAAA;AAAAA,MACN;AAAA,IAEJ;AAGE34F,IAAAA,OAAMqnJ,gBAAgB7mD,mBAAmB;AACxCxgG,MAAAA,OAAMunJ,iBAAAA;AAAAA,IACT;AAGEvnJ,IAAAA,OAAMqnJ,gBAAgB,SAAa,IAAA,SAAUlrJ,GAAGqpG,KAAAA;AAC/C,UAAIA,IAAInuG,aAAa,iBAAoB,GAAA;AACxC2I,QAAAA,OAAMgF,UAAU,oBAAoB,CAACwgG,IAAIxrG,WAAWwrG,KAAKrpG,CAC7D,CAAA;AAAA,MAAA,OAAU;AACN,YAAIsH,OAAOujJ,OAAOQ;AAElB,YAAIxtJ,YAAYugG,aAAwBiL,GAAAA;AACxC,YAAIxrG,UAAUE,QAAQ,qBAAA,KAAA,IAA8B;AACnD,cAAIF,UAAUE,QAAQ,sBAA4B,KAAA,IAAG;AACpDuJ,oBAAQ+hG,IAAIhwG,WAAW6B,aAAa,YACpCmwJ;AAAAA,kBAAMhiD;AACN,mBAAOgiD,OAAOjtD,aAAwBitD,GAAKttJ,EAAAA,QAAQ,6BAA6B;AAC/EstJ,oBAAMA,IAAIhyJ;AAAAA,YACV;AAAA,UACP,OAAY;AACNiO,oBAAQ+hG,IAAInuG,aAAa,YAAA;AACzBmwJ,kBAAMhiD,IAAIrnG,QAAQ,qBAClBqnG;AAAAA,kBAAMA,IAAIhqG;AAAAA,UACV;AAAA,QACD;AAED,YAAI22C,WAAWnyC,OAAM0kJ,2BAAAA;AAErB,YAAIjhJ,OAAO;AACVA,kBAAQA,QAAQ;AAChBujJ,kBAAQhnJ,OAAMu+I,YAAYpsG,SAAS1uC,QAAQ,CAAA,EAAGyL,IAC9C83I;AAAAA,gBAAMvC,aAAahhJ,OAAO+hG,KAAKgiD,KAAKA,IAAIj5F,WACxC;AAAA,QAAA;AAAA,MACD;AAAA,IACJ;AACEtxD,SAAKX,MAAM0D,OAAM0vB,YAAAA,GAAe,SAAS,SAAUvzB,GAAAA;AAClD,UAAGA,EAAEI,OAAO4B,QAAQ,gCAA+B;AAClD6B,QAAAA,OAAMunJ,iBACN;AAAA,MAAA;AACD,UAAI/hD,MAAMxiE,cAAyB7mC,CAEnC;AAAA,UAAInC,YAAYugG,aAAwBiL,GACxC;AAAA,UAAA,CAAKxrG,WAAW;AACfwrG,cAAMA,IAAI36E;AACV7wB,oBAAYugG,aAAwBiL,GACpC;AAAA,MAAA;AACD,UAAIA,OAAOxrG,aAAaA,UAAUE,QAAQ,eAAqB,MAAA,GAAG;AACjEsrG,cAAMA,IAAIhqG;AACVxB,oBAAYugG,aAAwBiL,GAAAA;AAAAA,MACpC;AACD,UAAIA,OAAOxrG,WAAW;AACrB,YAAI8C,OAAOkD,OAAMugC,QAAQvgC,OAAMqnJ,gBAAgB7hD,IAAIxrG,SAAAA,CAAAA,IAAcgG,OAAMqnJ,gBAAgB7hD,IAAIxrG,SAAAA,IAAagG,OAAMqnJ,gBAAgB,SAAA;AAC9H,eAAOvqJ,KAAKX,GAAGqpG;MACf;AACD,aAAO;AAAA,IACV,CAAA;AAEExlG,IAAAA,OAAM0vB,YAAAA,EAAc0xE,YAAY,SAAUjlG,GAAAA;AACzC,UAAIG,SAAQH,KAAKzG,OAAO4G;AACxB,UAAIC,SAASJ,EAAEI,UAAUJ,EAAEK;AAC3B,UAAIirJ,eAAeltD,aAAwBh+F,MAAAA,EAAQrC,QAAQ,eAAA,IAAA;AAE3D,eAASiC,KAAKG,QAAO4nB,SAAAA;AAAAA,QACpB,KAAKlkB,OAAMotC,UAAUC,UAAUK,OAAO;AACrC,eAAKvxC,KAAKG,QAAOyoB,SAAU;AAC3B,cAAI0iI,gBAAgBlrJ,OAAO6uB,OAAO;AACjC7uB,mBAAO6uB,MAAAA;AAAAA,UACP;AACD;AAAA,QACA;AAAA,QACD,KAAKprB,OAAMge,KAAKuhF;AACf,eAAKpjG,KAAKG,QAAOyoB,SAAU;AAC3B,cAAI0iI,gBAAgBlrJ,OAAO6uB,OAAO;AACjC7uB,mBAAO6uB,MAAAA;AAAAA,UACb,OAAY;AACNprB,YAAAA,OAAMsnJ,eAAAA;AAAAA,UACN;AACD;AAAA,QACD,KAAKtnJ,OAAMge,KAAKwhF;AACfx/F,UAAAA,OAAMunJ;AACN;AAAA,MAIL;AAAA,IAAA;AAAA,EACA;AAECvnJ,EAAAA,OAAMunJ,mBAAmB,WAAA;AACxB,QAAIn8I,OAAOnO,KAAKyqJ;AAChB1nJ,IAAAA,OAAMyjJ,yBAAyB;AAC/BxmJ,SAAK+H,UAAU,oBAAoB,CAAC/H,KAAKk1F,cAAc/mF,KAAK6mF,IAC5D,CAAA;AAAA,QAAIjyF,OAAM0d,aAAatS,KAAKlH,OAAOkH,KAAK6mF,MAAM;AAC7Ch1F,WAAKs7B,OAAO,WAAA;AACXv4B,QAAAA,OAAM+yB,MAAMC,WAAWiE,WAAW7rB,KAAKlH,EAAAA;AACvClE,QAAAA,OAAMizD,cAAc7nD,KAAKlH,IAAI,IAAA;AAAA,MACjC,CACGjH;AAAAA,WAAKu1D;IACL;AAEDv1D,SAAK07F,aACP;AAAA,EAAA;AAEC34F,EAAAA,OAAMsnJ,iBAAiB;AACtB,QAAIl8I,OAAOnO,KAAKyqJ,kBAAAA;AAChB1nJ,IAAAA,OAAMyjJ,yBAAyB;AAC/B,QAAKxmJ,CAAAA,KAAK+H,UAAU,kBAAkB,CAAC/H,KAAKk1F,cAAc/mF,MAAAA,CAAAA,CAAQA,KAAK6mF,IAAAA,CAAAA,EACtE;AAIDjyF,IAAAA,OAAM+yB,MAAMC,WAAW68B,yBAAyB;AAChD,QAAIzkD,KAAK6mF,MAAM;aACP7mF,KAAK6mF;AACZh1F,WAAKypD,QAAQt7C,MAAMA,KAAKrN,QAAQd,KAAKwuB,aAAargB,KAAKlH,EACvD,CAAA;AAAA,IAAA,WAAUjH,KAAKygB,aAAatS,KAAKlH,EAAAA,GAAK;AACtCjH,WAAKwS,MAAMxS,KAAKkf,QAAQ/Q,KAAKlH,EAAAA,GAAKkH,MAAM,IAAA;AACxCnO,WAAKi8B,YAAY9tB,KAAKlH,EACtBjH;AAAAA,WAAKmxB,WAAWhjB,KAAKlH;IACrB;AACDlE,IAAAA,OAAM+yB,MAAMC,WAAW68B,yBAAyB;AAChD5yD,SAAKu1D,YAAAA;AAGLv1D,SAAK07F,aAAAA;AAAAA,EACP;AAEC34F,EAAAA,OAAMm/I,2BAA2B,SAAU+E,SAAAA;AAC1C,QAAIn4B,UAAUm4B,QAAQ9xG;AACtB,QAAIu1G,gBAAgB,EAAEvwI,MAAQ,MAAMwwI,eAAiB,MAAMxuF,UAAY,MAAMyuF,mBAAqB,KAClG;AAAA,QAAIF,cAAczD,QAAQh1I,IAAAA,GAAO;AAChC,UAAIg1I,QAAQ9xG,UAAU,QAAQ;AAC7B25E,kBAAU,EAAE38G,YAAY,cAAcC,UAAU,YAAY+pD,UAAU,WAAA;AAAA,MACtE,WAAM,OAAY8qF,QAAc,WAAM,UAAU;AAChDn4B,kBAAU,EAAE38G,YAAY80I,QAAQ9xG;MAChC;AAAA,IACJ,WAAa8xG,QAAQh1I,SAAS,cAAc;AACzC,UAAKg1I,CAAAA,QAAQ9xG,iBAAkB8xG,QAAc,WAAM,UAAU;AAC5Dn4B,kBAAU,EAAEjzD,iBAAiB,mBAAmB1iD,iBAAiB;MACjE;AAAA,IACD;AAED,WAAO21G;AAAAA,EACT;AAEC/rH,EAAAA,OAAM0nJ,oBAAoB,WAAA;AACzB,QAAIt8I,OAAO,CAAA;AAEX,QAAIpL,OAAM0d,aAAazgB,KAAKk1F,YAAAA,GAAe;AAC1C/mF,aAAOnO,KAAKwS,MAAM,CAAE,GAAExS,KAAKkf,QAAQlf,KAAKk1F;IACxC;AAED,QAAIisD,MAAMnhJ,KAAKynJ,2BAAAA;AACf,aAAS3rJ,IAAI,GAAGA,IAAIqlJ,IAAIplJ,QAAQD,KAAK;AACpC,UAAIlC,OAAOmJ,OAAM+kJ,eAAe7pJ,cAAc,MAAMkjJ,IAAIrlJ,CAAGmL,EAAAA,EAAAA;AAC3DrN,aAAQA,OAAOA,KAAK03D,cAAc13D;AAClC,UAAImwJ,QAAQ/pJ,KAAKshJ,YAAYH,IAAIrlJ,CAAAA,EAAGmW,IACpC;AAAA,UAAA,CAAK83I,MAAO;AACZ,UAAIxnI,MAAMwnI,MAAM16B,UAAUxzH,KAAKmE,MAAMpG,MAAMuU,MAAMgzI,IAAIrlJ,CAAAA,CAAAA;AACrD,UAAIq5C,SAASpyC,OAAMm/I,yBAAyBf,IAAIrlJ,CAChD,CAAA;AAAA,UAAA,OAAWq5C,UAAU,YAAYA,UAAU,QAAQ;AAClDhnC,aAAKgnC,MAAU5yB,IAAAA;AAAAA,MACnB,WAAU,OAAW4yB,UAAU,UAAU;AACrC,iBAASstB,YAAYttB,QAAQ;AAC5B,cAAIA,OAAOstB,QACVt0D,EAAAA,MAAKgnC,OAAOstB,QAAAA,CAAAA,IAAalgD,IAAIkgD,QAC9B;AAAA,QAAA;AAAA,MACD;AAAA,IACD;AAGD,QAAI1/D,OAAMyjJ,wBAAwB;AACjCr4I,WAAK8D,OAAOlP,OAAMyjJ;AAAAA,IAClB;AAED,WAAOr4I;AAAAA,EACT;AAGCpL,EAAAA,OAAM24F,eAAe,WAAA;AACpB,QAAIxjG,MAAM8H,KAAKyyB,YACf;AAAA,QAAIv6B,IAAKA,KAAI8B,MAAMH,UAAU;AAE7BmG,SAAKy/B,SAASorH,mBAAmB3yJ;AACjC8H,SAAKk1F,eAAe;AAEpBl1F,SAAK8qJ,UAAU5yJ,GAAAA;AACf8H,SAAKw9F,cACLx9F;AAAAA,SAAK+H,UAAU,mBAAmB,CAAA,CAAA;AAAA,EACpC;AACChF,EAAAA,OAAM+nJ,YAAY,SAAU5yJ,KAAAA;AAC3B,QAAGA,KAAI;AACNA,UAAI8B,MAAMH,UAAU;AAAA,IACpB;AACD,QAAImG,KAAK0pJ,OACR1pJ,MAAK0pJ,OAAOnxJ,WAAWqE,YAAYoD,KAAK0pJ,MACzC1pJ;AAAAA,SAAK0pJ,SAAS;AAAA,EAChB;AAEC3mJ,EAAAA,OAAMy6F,gBAAgB,WACrB;AAAA,QAAIz6F,OAAM+lJ,aAAAA,CAAc/lJ,OAAMgoJ,iBAC7BhoJ,CAAAA,OAAM+lJ,UAAUv4I,OAAAA;AACjBxN,IAAAA,OAAM+lJ,YAAY;AAAA,EACpB;AACC/lJ,EAAAA,OAAMioJ,uBAAuB,SAAUv4I,OAAMva,KAC5C;AAAA,QAAIiW,OAAOsE;AACX,QAAI8qC,IAAIrlD,IAAIohD,qBAAqB;AACjC,QAAI2xG,iBAAiB,CACrB;AAAA,QAAIloJ,OAAMmS,UAAUg2I,iBAAiB;AACpCD,qBAAejsJ,KAAK,EACpBisJ;AAAAA,qBAAejsJ,KAAK+D,OAAMmS,UAAUg2I,gBAAgB/8I,KAAKgE,YAAYhE,KAAKiE,UAAUjE,IACpFovC,CAAAA;AAAAA,QAAE,CAAGl/C,EAAAA,YAAY;AACjBk/C,QAAE,GAAGl/C,YAAY0E,OAAMmS,UAAUg2I,gBAAgB/8I,KAAKgE,YAAYhE,KAAKiE,UAAUjE,IAAAA;AAAAA,IACpF,OAAS;AACN88I,qBAAejsJ,KAAKgB,KAAKkV,UAAUqtB,UAAUp0B,KAAKgE,YAAYhE,KAAKiE,UAAUjE,IAC7E88I,CAAAA;AAAAA,qBAAejsJ,KAAKc,OAAOE,KAAKkV,UAAUoG,UAAUnN,KAAKgE,YAAYhE,KAAKiE,UAAUjE,IAAAA,KAAS,IAAIk0B,OAAO,GAAG;AAC3Gkb,QAAE,CAAA,EAAGl/C,YAAY2B,KAAKkV,UAAUqtB,UAAUp0B,KAAKgE,YAAYhE,KAAKiE,UAAUjE,IAC1EovC;AAAAA,QAAE,CAAGl/C,EAAAA,YAAYyB,OAAOE,KAAKkV,UAAUoG,UAAUnN,KAAKgE,YAAYhE,KAAKiE,UAAUjE,IAAAA,KAAS,IAAIk0B,OAAO,GAAG;IACxG;AACDkb,MAAE,GAAGl/C,YAAY4sJ,eAAe,CAChC1tG;AAAAA,MAAE,CAAGl/C,EAAAA,YAAY4sJ,eAAe,CAEhCloJ;AAAAA,IAAAA,OAAM08B,SAASwrH,eAAe/yJ,KAAK+yJ,eAAezvJ,KAAK,GAEvD,CAAA;AAAA,QAAI2lJ,MAAMnhJ,KAAKynJ,2BAA2BznJ,KAAK+8F;AAC/C,aAASjhG,IAAI,GAAGA,IAAIqlJ,IAAIplJ,QAAQD,KAAK;AACpC,UAAImrJ,UAAU9F,IAAIrlJ;AAElB,UAAKkE,CAAAA,KAAKshJ,YAAY2F,QAAQh1I,IAAO,GAAA;AACpC;AAAA,MACA;AAGD,UAAIrY,OAAOmJ,OAAM+kJ,eAAe7pJ,cAAc,MAAMgpJ,QAAQhgJ,EAAAA,EAAIqqD;AAChE,UAAIy4F,QAAQ/pJ,KAAKshJ,YAAY2F,QAAQh1I,IACrC;AAAA,UAAIkjC,SAASpyC,OAAMm/I,yBAAyBf,IAAIrlJ,CAAAA,CAAAA;AAChD,UAAIid,QAAQ/Y,KAAKsjC,QAAQn1B,KAAKgnC,MAAAA,CAAAA,IAAWhnC,KAAKgnC,MAAAA,IAAU8xG,QAAQnD;AAChEiG,YAAM56B,UAAUtzH,KAAKkH,QAAOnJ,MAAMmf,OAAO5K,MAAM84I,OAE/C;AAAA,UAAIA,QAAQx7H,MACXs+H,OAAMt+H,MAAM5vB,KAAKkH,QAAOnJ,IAAAA;AAAAA,IACzB;AACD,QAAImJ,OAAM0d,aAAahO,MAAKxL,EAAI,GAAA;AAC/BlE,MAAAA,OAAMmyF,eAAeziF,MAAKxL;AAAAA,IAC1B;AAAA,EACH;AACClE,EAAAA,OAAMolJ,iBAAiB,SAAUlhJ,IAAI/O;AACpC,QAAIiW,OAAOnO,KAAKkf,QAAQjY,EACxBjH;AAAAA,SAAKgrJ,qBAAqB78I,MAAMjW,GAAAA;AAAAA,EAClC;AAGC6K,EAAAA,OAAMooJ,qBAAqB,SAAU9tJ;AACpC,QAAIiI,UAAStF,KAAKynJ,2BAAAA;AAClB,QAAI3rJ,IAAI;AACR,SAAKA,GAAGA,IAAIwJ,QAAOvJ,QAAQD,IAC1B,KAAIwJ,QAAOxJ,CAAGuB,EAAAA,QAAQA,KACrB;AACF,QAAI4pJ,UAAU3hJ,QAAOxJ,CACrB;AAAA,QAAA,CAAKmrJ,QACJ,QAAO;AAER,QAAKjnJ,CAAAA,KAAK8oJ,UACT9oJ,MAAKyyB,YACN;AAAA,QAAIvS,SAASnd,OAAM+kJ,eAAe7pJ,cAAc,MAAMgpJ,QAAQhgJ;AAC9D,QAAIrN,OAAOsmB,OAAOoxC;AAElB,QAAIttD,SAAS,EACZijJ,SACA/mI,QACAtmB,MACA65H,UAAU,SAAUhzH,IACnB;AAAA,aAAOsC,OAAMu+I,YAAY2F,QAAQh1I,IAAMo9G,EAAAA,UAAUxzH,KAAKkH,QAAOnJ,MAAO6G,MAAM,CAAE,GAAGwmJ,OAC/E;AAAA,IAAA,GACD1zB,UAAU,SAAUx6G,OAAOtY,IAC1B;AAAA,aAAOsC,OAAMu+I,YAAY2F,QAAQh1I,IAAAA,EAAMk9G,UAAUtzH,KAAKkH,QAAOnJ,MAAMmf,OAAQtY,MAAM,CAAE,GAAGwmJ,OACtF;AAAA,IAAA,EAAA;AAGF,QAAIngJ,UAAU9G,KAAK6nJ,kBAAkB,SAASZ,QAAQh1I,OAAO,UAAA;AAC7D,WAAOnL,UAAUA,QAAQ9C,MAAUA,IAAAA;AAAAA,EACrC;AAECjB,EAAAA,OAAM8kJ,kBAAkBuD,uBAAuB,SAAUpnJ,QACxDA;AAAAA,WAAOqnJ,UAAUrnJ,OAAOpK;AACxB,WAAOoK;AAAAA,EACT;AACCjB,EAAAA,OAAM8kJ,kBAAkByD,qBAAqB,SAAUtnJ;AACtDA,WAAOqnJ,UAAUrnJ,OAAOpK,KAAK0/C,qBAAqB,QAAA,EAAU;AAC5D,WAAOt1C;AAAAA,EACT;AACCjB,EAAAA,OAAM8kJ,kBAAkB0D,uBAAuB,SAAUvnJ,QACxDA;AAAAA,WAAOqnJ,UAAUrnJ,OAAOpK,KAAK0/C,qBAAqB,YAAY,CAC9D;AAAA,WAAOt1C;AAAAA,EACT;AACCjB,EAAAA,OAAM8kJ,kBAAkB2D,mBAAmB,SAAUxnJ,QACpDA;AAAAA,WAAOqnJ,UAAUrnJ,OAAOpK,KAAK0/C,qBAAqB,QAAA;AAClD,WAAOt1C;AAAAA,EACT;AAGCjB,EAAAA,OAAMymJ,mBAAmB,WAAA;AACxB,QAAI3kJ,eAAe9B,OAAM+kJ;AACzB9nJ,SAAKX,MAAMwF,cAAc,aAAa9B,OAAMmnJ,eAAAA;AAC5ClqJ,SAAKX,MAAMwF,cAAc,WAAW9B,OAAMonJ,WAC1CnqJ;AAAAA,SAAKX,MAAMwF,cAAc,aAAa,SAAU3F,GAAAA;AAC/C6D,MAAAA,OAAMmnJ,gBAAgBhrJ,EAAE8mD,QAAQ,CAAA,CAAA;AAAA,IACnC,CACEhmD;AAAAA,SAAKX,MAAMwF,cAAc,YAAY,SAAU3F,GAAAA;AAC9C6D,MAAAA,OAAMonJ,YAAYjrJ,EAAE8mD,QAAQ,CAC/B,CAAA;AAAA,IAAA,CAAA;AAAA,EAKA;AACCjjD,EAAAA,OAAMmnJ,kBAAkB,SAAU7qJ;AACjC,QAAI0D,OAAM0oJ,eAAe;AACxB,UAAA,CAAKrzJ,SAASszJ,oBAAoB;AACjC3oJ,QAAAA,OAAM+kJ,eAAe/qJ,aAAa;AAClC3E,iBAASszJ,qBAAqB;AAAA,MAC9B;AACD,UAAIC,KAAK5oJ,OAAM0vB,YACf;AAAA,UAAI+2G,MAAM,CAACnqI,OAAM+jD,OAAO/jD,OAAMgkD,KAC9BsoG;AAAAA,SAAG3xJ,MAAMnC,MAAMkL,OAAM6oJ,UAAU,KAAKpiB,IAAI,CAAA,IAAKzmI,OAAM0oJ,cAAc,CAAK,IAAA;AACtEE,SAAG3xJ,MAAMlC,OAAOiL,OAAM6oJ,UAAU,CAAA,IAAKpiB,IAAI,CAAKzmI,IAAAA,OAAM0oJ,cAAc,CAAA,IAAK;AAAA,IACvE;AAAA,EACH;AACC1oJ,EAAAA,OAAMqmJ,gBAAgB,SAAU/pJ,QAC/B;AAAA,QAAIssJ,KAAK5oJ,OAAM0vB,YAAAA;AACf1vB,IAAAA,OAAM6oJ,YAAY,CAACD,GAAGxyJ,YAAYwyJ,GAAGzyJ,SAAAA;AACrC6J,IAAAA,OAAM0oJ,gBAAgB,CAACpsJ,OAAM+jD,OAAO/jD,OAAMgkD,KAC5C;AAAA,EAAA;AACCtgD,EAAAA,OAAMonJ,cAAc;AACnB,QAAIpnJ,OAAM6oJ,WAAW;AACpB7oJ,MAAAA,OAAM6oJ,YAAY7oJ,OAAM0oJ,gBAAgB;AACxC1oJ,MAAAA,OAAM+kJ,eAAe/qJ,YAAYgG,OAAM+kJ,eAAe/qJ,UAAUU,QAAQ,uBAAuB,EAC/FrF;AAAAA,eAASszJ,qBAAqB;AAAA,IAC9B;AAAA,EACH;AAGC3oJ,EAAAA,OAAMy+I,SAAS,SAAU5nJ,MAAMkB,QAC9B;AAAA,QAAIlB,QAAQA,KAAK6xB,OAAO;AACvB,UAAI1oB,OAAMuC,OAAO0hC,MAEV;AAAA,WAAA;AACN,YACC;AAAA,cAAIlsC,UAAUlB,KAAKkB,OAAQlB,MAAKkB,OAChClB;AAAAA,eAAK6xB;QACL,SAAQvsB,GAER;AAAA,QAAA;AAAA,MACD;AAAA,IACD;AAAA,EACH;AAGC6D,EAAAA,OAAMu+I,cAAc,EACnBK,eAAe,SAAUR,KAAK/7C;AAC7B,QAAI5nF,OAAO;AACX,QAAIg7C,MAAMx4D,KAAKsF;AACf,QAAIxJ;AACJ,QAAIi3E;AACJ,QAAI26C;AACJ,QAAIn8G;AACJ,QAAI1X;AACJ,QAAIkN,WAAW,EACdyoC,OAAO,GACP/T,MAAM,KAAK,IACXppB,MAAMrS,KAAKqS,KAAKmrC,UAAU,IAAI9kC,KAAK3V,OAAMq5D,UAAU3uD,QACnDo+I,CAAAA,CAAAA,GAAAA,YAAYC,cAAc3K,GAI3BA,EAAAA;AAAAA,QAAIU,qBAAqB,EAAExwC,MAAM,EAEjC;AAAA,QAAItuG,OAAMuC,OAAOymJ,mBAAmB;AACnChlJ,eAASyoC,QAAQ,KAAKgpB,IAAIwzF;AAC1BjlJ,eAAS00B,OAAO,KAAK+8B,IAAIyzF,YAAY;AACrCllJ,eAASsL,KAAKorC,SAAS+a,IAAIwzF;IAC3B;AAED,SAAKlwJ,IAAI,GAAGA,IAAIiL,SAAS8kJ,WAAW9vJ,QAAQD,KAAK;AAEhD,UAAIA,IAAI,GAAG;AACV0hB,gBAAQ;AAAA,MACR;AAEDu1D,gBAAUm5E,yBAAyB/K,KAAKrlJ,GAAGiL,QAE3C;AAAA,UAAIgsE,SAAS;AACZ26C,oBAAY3qH,OAAM08B,SAAS0sH,yBAAyBplJ,SAAS8kJ,WAAW/vJ,CAAAA,CAAAA;AACxEyV,mBAAW4vI,IAAI5vI,WAAW,wBAAwB;AAClD1X,kBAAUurG,SAAS,2BAA2B;AAC9C5nF,gBAAQ,aAAajM,WAAW1X,UAAU6zH,YAAY,MAAM36C,UAAU;AAAA,MACtE;AAAA,IACD;AACD,WAAOv1D;AAAAA,EACP,GACD6kI,oBAAoB,SAAUF,SAAS78I,SAAQ46B,QAAAA;AAC9C,QAAI32B,MAAMjE,QAAOu8I;AACjB,QAAIuK,cAAcrpJ,OAAMugC,QAAQ/5B,IAAI,CAAA,CAAA;AAEpC,QAAI4Q;AACJ,QAAID,QAAQ;AACZ,QAAIL,UAAU;AAEd,QAAIwyI,YAAYnsH,UAAU;AAE1B,QAAIksH,aAAa;AAChBjyI,aAAOlhB,SAASkpJ,QAAQ54I,IAAI,CAAA,IAAK8iJ,WAAWtzI,OAAO,EAAA;AACnDmB,cAAQ5gB,KAAKkS,MAAM2O,OAAO;AAC1BN,gBAAUM,OAAO;AAAA,IACjB;AACD,WAAO,IAAIzB,KAAKypI,QAAQ54I,IAAI,KAAK8iJ,SAAWtzI,EAAAA,OAAOopI,QAAQ54I,IAAI,CAAA,IAAK8iJ,SAAWtzI,EAAAA,OAAOopI,QAAQ54I,IAAI,KAAK8iJ,SAAWtzI,EAAAA,OAAOmB,OAAOL,OAAAA;AAAAA,EAChI,GAEDmoI,uBAAuB,SAAUzkG,GAAGzhD,GAAG4E,GAAG6I,KAAAA;AACzCg0C,MAAEzhD,IAAIyN,IAAI,CAAIwP,CAAAA,EAAAA,QAAQrY,EAAEyJ,QACxBozC;AAAAA,MAAEzhD,IAAIyN,IAAI,CAAA,CAAA,EAAIwP,QAAQrY,EAAEwJ,SACxBqzC;AAAAA,MAAEzhD,IAAIyN,IAAI,CAAA,CAAA,EAAIwP,QAAQrY,EAAEuJ,YACxB;AAAA,QAAIlH,OAAMugC,QAAQ/5B,IAAI,CAAK,CAAA,GAAA;AAC1B,UAAI4jH,IAAIzsH,EAAE47C,SAAa,IAAA,KAAK57C,EAAE87C,WAC9B2wE;AAAAA,UAAI7zH,KAAKC,MAAM4zH,IAAIpqH,OAAMw/I,qBAAAA,CAAAA,IAA0Bx/I,OAAMw/I,qBAAAA;AACzD,UAAI1nJ,QAAQ0iD,EAAEzhD,IAAIyN,IAAI,CAAA,CAAA;AACtB1O,YAAMke,QAAQo0G;AAEdtyH,YAAMmyB,aAAa,cAAcmgG,CAAAA;AAAAA,IACjC;AAAA,EACD,GACDx2G,UAAU,IAAIuqI,mBACdnmJ,UAAU,IAAIsmJ,mBACdvmJ,QAAQ,IAAIqoJ,iBACZhpI,MAAM,IAAIunI,eACVvlF,UAAU,IAAI6nF,mBACdljJ,QAAQ,IAAIgkJ,iBACZjB,OAAO,IAAID,gBACX0I,UAAU,IAAIhJ,mBACdlgF,WAAW,IAAIukF,oBACf4E,YAAY,IAAIhH,qBAChBtpF,WAAW,IAAI2rF,mBACf4E,YAAY,IAAInG,oBAAAA;AAGjBtjJ,EAAAA,OAAMgmJ,0BAA0B;AAC/B,QAAIxrG,IAAIv9C,KAAKynJ,2BACb;AAAA,aAAS3rJ,IAAI,GAAGA,IAAIyhD,EAAExhD,QAAQD,IAC7B,KAAIyhD,EAAEzhD,CAAAA,EAAGuB,QAAQ,UAAUkgD,EAAEzhD,GAAGmW,QAAQ,OACvC,QAAO;AACT,WAAO;AAAA,EACT;AAEClP,EAAAA,OAAM04F,kBAAkB,SAAUla,SAASxtE,OAAOjM,UAAU+8F;AAC3D,QAAKtjB,CAAAA,QACJ,QAAOz5E,SAAAA;AACR,QAAIy4E,OAAO,EAAEllE,MAAMkmE,QAAAA;AACnB,QAAIxtE,MACHwsE,MAAKxsE,QAAQA;AACd,QAAI8wF,IAAI;AACPtkB,WAAKskB,KAAKA;AAAAA,IACV;AACD,QAAI/8F,UAAU;AACby4E,WAAKz4E,WAAW,SAAU9D,QAAAA;AACzB,YAAIA,OACH8D,UACL;AAAA,MAAA;AAAA,IACG;AACD/E,IAAAA,OAAMmjG,QAAQ3lB;EAChB;AAEC,WAASksE,eAAeC,YACvB;AAAA,aAAS5wJ,KAAKkE,KAAKsF,OAAOqxB,OAAO;AAChC,UAAI32B,KAAKsF,OAAOqxB,MAAM76B,CAAAA,KAAM4wJ,YAAY;AACvC,eAAO5wJ;AAAAA,MACP;AAAA,IACD;AACD,WAAO;AAAA,EACP;AAEDiH,EAAAA,OAAM0kJ,6BAA6B,SAAUx1I,MAAAA;AAC5C,QAAIA,SAAS5R,QAAW;AACvB4R,aAAOjS,KAAK+8F,gBAAAA;AAAAA,IACZ;AAED,QAAIhyC,QAAQ0hG,eAAe5wJ,KAAKmE,MAAMiS,IAAAA;AAEtC,QAAIlP,OAAMuC,OAAO2vC,SAAS8V,QAAQ,WAAc,GAAA;AAC/C,aAAOhoD,OAAMuC,OAAO2vC,SAAS8V,QAAQ,WAAA;AAAA,IACxC,OAAS;AACN,aAAOhoD,OAAMuC,OAAO2vC,SAASC;AAAAA,IAC7B;AAAA,EACH;AAECnyC,EAAAA,OAAMi6F,0BAA0B,SAAU/qF,MACzC;AAAA,QAAI06I,UAAU3sJ,KAAK+8F,gBAAAA;AAEnB,QAAI/8F,KAAKuN,SAAW0nC,EAAAA,UAAU;AAC7B,UAAI3mB,SAAStuB,KAAKuN,SAAW0nC,EAAAA;AAC7B,UAAIxgC,WAAWzU,KAAKyqJ,kBACnBt8I,GAAAA,OAAOnO,KAAKqE,KAAKrE,KAAKkf,QAAQoP,MAAAA,CAAAA;AAE/BtuB,WAAKw9F,cAEL;AAAA,UAAI/tD,UAAUzvC,KAAKwS,MAAMrE,MAAMsG,UAAU,IACzC;AAAA,UAAIvc,MAAM8H,KAAKyyB,YAAYxgB,OAAOA,OAAO5R,MAAAA;AACzCL,WAAKgrJ,qBAAqBv7G,SAASv3C,GACnC8H;AAAAA,WAAKkoJ,UAAUhwJ,GAAAA;AAAAA,IAClB,OAAS;AACN8H,WAAKw9F,cACLx9F;AAAAA,WAAKyyB,YAAYxgB,OAAOA,OAAO5R,MAC/B;AAAA,IAAA;AACDL,SAAK+H,UAAU,oBAAoB,CAAC4kJ,SAAS3sJ,KAAK+8F,gBAAAA,CAAAA,CAAAA;AAAAA,EACpD;AAEC,WAAS8sD,mBAAmB1I;AAC3B,QAAI8F;AACJ,QAAI/wI;AACJ,QAAI02I;AACJ,QAAIC;AACJ,QAAIhyJ;AACJ,QAAIiB;AAEJ,SAAKA,IAAI,GAAGA,IAAIqlJ,IAAIplJ,QAAQD,KAAK;AAChCmrJ,gBAAU9F,IAAIrlJ,CAAAA;AACd8wJ,mBAAa7pJ,OAAM+kJ,eAAe7pJ,cAAc,MAAMgpJ,QAAQhgJ,EAE9D;AAAA,UAAA,CAAKggJ,QAAQhgJ,MAAAA,CAAO2lJ,WAAY;AAEhC12I,cAAQ02I,WAAW3uJ,cAAc,OACjC4uJ;AAAAA,mBAAaD,WAAWt7F;AAExB,UAAA,CAAKu7F,WAAY;AAEjBhyJ,cAAQgyJ,WAAW5uJ,cAAc,yBACjC;AAAA,UAAIpD,OAAO;AACVA,cAAMoM,KAAKpM,MAAMoM,MAAM,WAAWlE,OAAM01B,IACxCwuH;AAAAA,gBAAQ6F,UAAUjyJ,MAAMoM;AACxBiP,cAAM8W,aAAa,OAAOi6H,QAAQ6F,OAClC;AAAA,MAAA;AAAA,IACD;AAAA,EACD;AAED,WAAS7D,eAAez3H,SAASu7H,YAChC;AAAA,QAAI/xJ;AACJ,QAAI2kC;AACJ,QAAIniB,OAAO;AACX,QAAI1hB;AAEJ,SAAKA,IAAI,GAAGA,IAAI01B,QAAQz1B,QAAQD,KAAK;AAEpCd,eAAS+H,OAAMuC,OAAOsvC,iBAAiBpjB,QAAQ11B,CAAAA,CAAAA,IAAMiH,OAAMuC,OAAOsvC,iBAAiBpjB,QAAQ11B,CAAAA,CAAAA,IAAM01B,QAAQ11B,CAEzG6jC;AAAAA,iBAAW58B,OAAM08B,SAASutH,yBAAyBhyJ,MACnDwiB;AAAAA,cAAQ,UAAUmiB,WAAW,8CAA8C3kC,SAAS,0DAA+DA,SAAS,kBAAkB+H,OAAMoT,OAAOC,OAAOpb,MAAAA,IAAU;AAAA,IAC5M;AACD,WAAOwiB;AAAAA,EACP;AAED,WAASsuI,cAAc3K;AACtB,QAAIl1H;AACJ,QAAI/iB;AACJ,QAAIlF;AAEJ,QAAIm9I,IAAI8L,YAAa,QAAO9L,IAAI8L;AAGhCjpJ,aAAS,CAAC,MAAM,MAAM;AACtBioB,YAAQlpB,OAAMsZ,SACdnT;AAAAA,WAAO+iB,QAAQA,MAAM/iB,OAAOnG,OAAMuC,OAAO4sC;AACzC,QAAIkrD,iBAAyBl0F,QAAQk0F,iBAAyB,KAAA,GAAQ;AACrEp5F,aAAOhF,KAAK,OAAA;AAAA,IACZ;AACD,WAAOgF;AAAAA,EACP;AAED,WAASkoJ,yBAAyB/K,KAAK36I,OAAOO,UAAAA;AAC7C,QAAI+S;AACJ,QAAIomB;AACJ,QAAIgtH;AACJ,QAAIC;AACJ,QAAIrxJ;AACJ,QAAIqe;AACJ,QAAI+2C;AACJ,QAAIk8F;AACJ,QAAI5vI,OAAO;AAEX,YAAQzW,SAAS8kJ,WAAWrlJ,KAC3B,GAAA;AAAA,MAAA,KAAK;AACJ26I,YAAIU,mBAAmB,CAAKr7I,IAAAA;AAC5B26I,YAAIU,mBAAmBxwC;AAGvB,YAAI8vC,IAAIkM,YAAY;AACnB,cAAA,CAAKlzJ,MAAMgnJ,IAAIkM,UAAAA,GAAa;AAC3BvzI,oBAAQqnI,IAAIkM;AAAAA,UAClB,WAAgBlM,IAAIkM,WAAWruJ,MAAM;AAE/BkuJ,yBAAa/L,IAAIkM,WAAW,CAC5BF;AAAAA,uBAAWhM,IAAIkM,WAAW;UAC1B;AAAA,QACD;AAEDvzI,gBAAQA,SAAS;AACjBomB,iBAASA,UAAU5mC,KAAKkS,MAAMsO,QAAQ,CACtCozI;AAAAA,qBAAaA,cAAcnmJ,SAASsL,KAAKpI,YAAgBi2B,IAAAA;AACzDitH,mBAAWA,YAAYpqJ,OAAMwK,SAAWC,EAAAA,SAASvD,YAAgBi2B,IAAAA;AAEjE,aAAKpkC,IAAIoxJ,YAAYpxJ,KAAKqxJ,UAAUrxJ,IACnC0hB,SAAQ,oBAAiB,IAAS,OAAQ,IAAK;AAChD;AAAA,MACD,KAAK;AACJ2jI,YAAIU,mBAAmB,CAAA,IAAKr7I;AAC5B26I,YAAIU,mBAAmBxwC;AAEvB,aAAKv1G,IAAI,GAAGA,IAAI,IAAIA,IACnB0hB,SAAQ,oBAAoB1hB,IAAI,OAAOiH,OAAMoT,OAAO9D,KAAK+pC,WAAWtgD,CAAAA,IAAK;AAC1E;AAAA,MACD,KAAK;AACJqlJ,YAAIU,mBAAmB,CAAA,IAAKr7I;AAC5B26I,YAAIU,mBAAmBxwC;AAEvB,aAAKv1G,IAAI,GAAGA,IAAI,IAAIA,IACnB0hB,SAAQ,oBAAoB1hB,IAAI,OAAOA,IAAI;AAC5C;AAAA,MACD,KAAK;AAEJqlJ,YAAIU,mBAAmB,CAAA,IAAKr7I;AAC5B26I,YAAIU,mBAAmBxwC;AAEvBv1G,YAAIiL,SAASyoC;AACb49G,gBAAQrmJ,SAASsL,KAAKlI,QACtBg3I;AAAAA,YAAImM,eAAe,CAAA;AAEnB,eAAOxxJ,IAAIiL,SAAS00B,MAAM;AACzBthB,iBAAOpX,OAAMmS,UAAUs/B,YAAYztC,SAASsL,IAAAA;AAC5CmL,kBAAQ,oBAAoB1hB,IAAI,OAAOqe,OAAO;AAC9CgnI,cAAImM,aAAatuJ,KAAKlD,CACtBiL;AAAAA,mBAASsL,KAAKsrC,QAAQ52C,SAASsL,KAAK5E,QAAAA,IAAY1K,OAAMw/I,qBAAAA,IAAyB,KAAK,GACpFrxF;AAAAA,iBAAQnqD,SAASsL,KAAKlI,QAAAA,KAAaijJ,QAAS,IAAI;AAChDtxJ,cAAIo1D,OAAO,KAAK,KAAKnqD,SAASsL,KAAKiqC,SAAAA,IAAa,KAAKv1C,SAASsL,KAAKmqC;QACnE;AACD;AAAA,IAAA;AAIF,WAAOh/B;AAAAA,EACP;AACF;ACp7Be,SAAQ+vI,uBAACxqJ,QAAAA;AAEvBA,EAAAA,OAAMyqJ,sBAAsB,SAAUC;AAErC,QAAItxF,WAAWsxF;AACf,QAAIC,gBAAgB,EACnBhoJ,QAAQy2D,SAASz2D,QACjB+lB,OAAO0wC,SAAS1wC,OAChB0jG,WAAW,SAAUv1H,MAAMmf,OAAO5K,MAAM84I,SAAAA;AACvC,UAAIn4B,UAAU/rH,OAAMm/I,yBAAyB+E,OAAAA;AAC7C,WAAK94I,KAAK2gH,QAAQ38G,eAAgB28G,QAAQ38G,cAAc,gBAAgBnS,KAAKy9D,0BAA0BtvD,IAAAA,GAAQ;AAC9Gu/I,sBAAcv6H,QAAQv5B,MAAMqtJ,OAAAA;AAC5B,YAAI9pI,MAAM,CAAA;AAEV,iBAASrhB,KAAKgzH,SAAS;AAEtB3xG,cAAI2xG,QAAQhzH,CAAAA,CAAAA,IAAMqS,KAAKrS,CACvB;AAAA,QAAA;AAED,eAAOqgE,SAASgzD,UAAUtzH,KAAKkH,QAAOnJ,MAAMmf,OAAOoE,KAAK8pI,OAC7D;AAAA,MAAA,OAAW;AACNyG,sBAAcz6H,OAAOr5B,MAAMqtJ;AAC3B,eAAO9qF,SAASgzD,UAAUtzH,KAAKkH,QAAOnJ,MAAMmf,OAAO5K,MAAM84I,OAAAA;AAAAA,MACzD;AAAA,IACD,GACD53B,WAAW,SAAUz1H,MAAMuU,MAAM84I,SAChC;AAAA,UAAIA,QAAQpB,UAAU;AACrB,eAAO,EAAC1zI,YAAY,KACzB;AAAA,MAAA,OAAW;AACN,eAAOgqD,SAASkzD,UAAUxzH,KAAKkH,QAAOnJ,MAAMuU,MAAM84I,OAClD;AAAA,MAAA;AAAA,IACD,GACD0G,cAAc,SAAU/zJ,MAAMqtJ,SAC7BlkJ;AAAAA,MAAAA,OAAMgF,UAAU,mBAAmB,CAAChF,OAAMmyF,cAAc+xD,OACxDrtJ,CAAAA;AAAAA,WAAKI,MAAMH,UAAUotJ,QAAQpB,WAAW,SAAS;AAEjD,UAAIoB,QAAQjsJ,QAAQ;AACnB,YAAIA,SAASpB,KAAKg0B,gBAAgB3vB,cAAc,4BAC/CmY,GAAAA,SAASrT,OAAMoT,OAAOC;AAEvB,YAAIw3I,cAAc3G,QAAQpB,WAAWzvI,OAAO6wI,QAAQ5pJ,OAAO,gBAAoB+Y,IAAAA,OAAO6wI,QAAQ5pJ,OAAO;AAErGrC,eAAOqD,YAAYuvJ;AAAAA,MACnB;AAAA,IACD,GACDz6H,SAAS,SAAUv5B,MAAMqtJ,SAAAA;AACxBA,cAAQpB,WAAW;AACnB6H,oBAAcC,aAAa/zJ,MAAMqtJ,OAEjC;AAAA,IAAA,GACDh0H,QAAQ,SAAUr5B,MAAMqtJ,SACvBA;AAAAA,cAAQpB,WAAW;AACnB6H,oBAAcC,aAAa/zJ,MAAMqtJ,OACjC;AAAA,IAAA,GACDO,cAAc,SAAUhhJ,OAAOjF,IAAI0lJ,SAASpoH,WAC3C;AAAA,UAAI97B,OAAMgF,UAAU,mBAAmB,CAAChF,OAAMmyF,cAAc+xD,OAAc,CAAA,MAAA,OAAO;AAChF;AAAA,MACA;AACD,UAAI3hJ,UAASvC,OAAM0kJ,2BAA6BjhJ,EAAAA,KAAAA;AAChD,UAAIlB,QAAOugJ,UAAU;AACpB6H,sBAAcz6H,OAAO4L,WAAWv5B;MACrC,OAAW;AACNooJ,sBAAcv6H,QAAQ0L,WAAWv5B;MACjC;AAAA,IACD,EAAA;AAEF,WAAOooJ;AAAAA,EACT;AAEC3qJ,EAAAA,OAAMu+I,YAAYsJ,oBAAoB7nJ,OAAMyqJ,oBAAoBzqJ,OAAMu+I,YAAYnlF,QAAAA;AAClFp5D,EAAAA,OAAMu+I,YAAYqJ,gBAAgB5nJ,OAAMyqJ,oBAAoBzqJ,OAAMu+I,YAAYnnI;AAE/E;ACxEe,SAAQ0zI,SAAC9qJ,QACvB;AAAA,MAAI+qJ,WAAW,IAAItwJ,OAAO,gBAAgB,IAAA;AAC1C,MAAIuwJ,cAAc,IAAIvwJ,OAAO,MAAM;AAEnC,WAASwwJ,cAAcC;AACtB,YAAQA,WAAW,IACjBxwJ,QAAQqwJ,UAAU,GAAA,EACnBrwJ,QAAQswJ,aAAa,GAAA;AAAA,EACtB;AAED,MAAIG,eAAe,IAAI1wJ,OAAO,KAAK,IACnC;AAAA,WAAS2wJ,aAAa9yI,MAAAA;AACrB,YAAQA,OAAO,IAAI5d,QAAQywJ,cAAc,OACzC;AAAA,EAAA;AAEDnrJ,EAAAA,OAAM08B,WAAW,EAChB2uH,oBAAoB,SAASxtE,MAC5B;AAAA,QAAIP,aAAa,CAAC,GAAA;AAClB,aAAQvkF,MAAK8kF,MAAK;AACjB,UAAIvlE,OAAO8yI,aAAaH,cAAcptE,KAAK9kF;AAC3CukF,iBAAWrhF,KAAKlD,KAAI,OAAOuf,OAAO;IAClC;AACDglE,eAAWrhF,KAAK,GAAA;AAChB,WAAOqhF,WAAW7kF,KAAK,GAEvB;AAAA,EAAA,GAEDwoH,qBAAoB,SAAStoE,YAAAA;AAE5B,WAAO34C,OAAM08B,SAAS2uH,mBAAmB,EAAC,cAAc1yG,WAAAA,CAAAA;AAAAA,EACxD,GAED2yG,iBAAiB,SAASlgJ,MAAM5R,KAAAA;AAE/B,QAAK4R,EAAAA,KAAKgE,cAAchE,KAAKiE,UAC5B;AAED7V,QAAIywB,aAAa,cAAcghI,cAAcjrJ,OAAMmS,UAAUiyB,aAAah5B,KAAKgE,YAAYhE,KAAKiE,UAAUjE,IAAAA,CAAAA,CAAAA;AAE1G,QAAGA,KAAKs2D,sBAAqB;AAC5BloE,UAAIywB,aAAa,aAAa,IAC9B;AAAA,IAAA;AAAA,EAED,GAEDkpG,gBAAgB,SAAS/nH,MAAM5R,KAAAA;AAC9ByD,SAAKquJ,gBAAgBlgJ,MAAM5R,GAAAA;AAG3BA,QAAIywB,aAAa,QAAQ;AAEzB,QAAIjqB,CAAAA,OAAMqrB,WAAWjgB,IAASpL,KAAAA,OAAMuC,OAAOouC,WAAU;AACpD,UAAGvlC,KAAKlH,MAAMlE,OAAMwK,SAAS,UAAA,EAAYm+B,SAAQ;AAChDnvC,YAAIywB,aAAa,gBAAgB,KACtC;AAAA,MAAA,OAAS;AACJzwB,YAAIywB,aAAa,gBAAgB,IAAA;AAAA,MACjC;AAAA,IACD;AAAA,EACD,GAEDkyG,aAAa,SAAS/wH,MAAM5R,KAE3ByD;AAAAA,SAAKquJ,gBAAgBlgJ,MAAM5R;AAE3B,QAAIwG,CAAAA,OAAMqrB,WAAWjgB,IAASpL,KAAAA,OAAMuC,OAAOqwC,cAAa;AACvDp5C,UAAIywB,aAAa,gBAAgB,KAAA;AAAA,IACjC;AAEDzwB,QAAIywB,aAAa,QAAQ,KAGzBzwB;AAAAA,QAAIywB,aAAa,iBAAiBjqB,OAAMquB,eAAejjB,KAAKlH,EAAM,IAAA,SAAS;AAG3E1K,QAAIywB,aAAa,cAAc7e,KAAKmO,SAAS,KAAK;AAElD,QAAGvZ,OAAMkY,SAAS9M,KAAKlH,EAAI,GAAA;AAC1B1K,UAAIywB,aAAa,iBAAiB7e,KAAKkP,QAAQ,SAAS;IACxD;AAAA,EACD,GAEDo+G,UAAU,SAASj7G,MAAMjkB,KAAAA;AAExB,QAAI+xJ,YAAYvrJ,OAAMuC,OAAOqY;AAE7B,QAAI4wI,UAAU/tI,KAAKvO,QAAQq8I,UAAU18G,mBAAmBpxB,KAAKvO,QAAQq8I,UAAUz8G;AAC/E,QAAI28G,YAAYhuI,KAAKvO,QAAQq8I,UAAUz8G,kBAAkBrxB,KAAKvO,QAAQq8I,UAAUv8G;AAEhF,QAAI/S,UAAUj8B,OAAMoT,OAAOC,OAAOoK,OAAO,MAAOzd,OAAMmS,UAAUqzC,UAAU/nC,KAAKE,QAAQ8tI,WAAWhuI,KAAKlhB,QAAQivJ,OAAAA;AAG/GhyJ,QAAIywB,aAAa,QAAQ;AAEzBzwB,QAAIywB,aAAa,cAAcghI,cAAchvH,OAAAA,CAAAA;AAC7C,QAAGj8B,OAAMqrB,WAAW5N,IAAAA,GAAM;AACzBjkB,UAAIywB,aAAa,iBAAiB,IAClC;AAAA,IAAA;AAAA,EACD,GAEDyhI,mBAAmB,SAASlyJ,KAE3BA;AAAAA,QAAIywB,aAAa,QAAQ;EACzB,GACDi0G,gBAAgB,SAAS1kI,KAExBA;AAAAA,QAAIywB,aAAa,QAAQ,KAAA;AAAA,EACzB,GAED69H,oBAAoB,SAAStuJ,KAAAA;AAC5BA,QAAIywB,aAAa,eAAe,MAChC;AAAA,EAAA,GAEDq7H,qBAAqB,SAAS9rJ;AAC7BA,QAAIywB,aAAa,eAAe,OAAA;AAAA,EAChC,GAEDk8H,cAAc,SAAS3sJ,KACtBA;AAAAA,QAAIywB,aAAa,QAAQ,QAAA;AACzBzwB,QAAIywB,aAAa,eAAe,MAChCzwB;AAAAA,QAAIgC,WAAWyuB,aAAa,QAAQ,SACpCzwB;AAAAA,QAAIgC,WAAWyuB,aAAa,cAAc,GAAA;AAAA,EAC1C,GAEDggI,0BAAyB,SAAS0B,YACjC;AAAA,WAAO1uJ,KAAKouJ,mBAAmB,EAACO,MAAO,UAAU,cAAa5rJ,OAAMoT,OAAOC,OAAOs4I,UAAaE,GAAAA,UAAW,IAC1G,CAAA;AAAA,EAAA,GAED3D,gBAAgB,SAAS1uJ,KAAKsyJ,YAC7BtyJ;AAAAA,QAAIywB,aAAa,cAAc6hI,UAC/B;AAAA,EAAA,GAED1C,0BAA0B,SAAS2C,aAAAA;AAClC,QAAI54I,QAAQ;AAEZ,YAAQ44I;MACP,KAAK;AACJ54I,gBAAQnT,OAAMoT,OAAOC,OAAOyoF;AAC5B;AAAA,MACD,KAAK;AACJ3oF,gBAAQnT,OAAMoT,OAAOC,OAAOwoF;AAC5B;AAAA,MACD,KAAK;AACJ1oF,gBAAQnT,OAAMoT,OAAOC,OAAO2jD;AAC5B;AAAA,MACD,KAAK;AACJ7jD,gBAAQnT,OAAMoT,OAAOC,OAAO8D,QAAQnX,OAAMoT,OAAOC,OAAOyD;AACxD;AAAA,IAAA;AAKF,WAAO9W,OAAM08B,SAAS2uH,mBAAmB,EAAC,cAAcl4I,MAAAA,CAAAA;AAAAA,EACxD,GAEDguI,iCAAiC,SAAS+C,SACzC;AAAA,WAAOjnJ,KAAKouJ,mBAAmB,EAC9B,cAAcrrJ,OAAMoT,OAAOC,OAAOioF,iBAClC,iBAAiB,KACjBswD,MAAQ,aAET,CAAA;AAAA,EAAA,GAED57B,kBAAkB,SAASx2H,KAC1BA;AAAAA,QAAIywB,aAAa,QAAQ,KAAA;AAAA,EACzB,GAED88F,gBAAgB,WAAA;AACf,WAAO,CAAC,oBAAoB/mH,OAAMuC,OAAO+0B,cAAc,gCAAgC,gCAAgC,GAAK7+B,EAAAA,KAAK;EACjI,GAGD0uH,wBAAwB;AACvB,WAAO;AAAA,EACP,GAEDyD,yBAAyB,SAASh4F,QAAQzf;AACzC,QAAIwqE,QAAQ;AACZ,QAAG/qD,OAAOt4B,QAAQ,OAAM;AAEvBqjF,cAAQ1gF,KAAKouJ,mBAAmB,EAACO,MAAO,gBAAgB,cAAc5rJ,OAAMoT,OAAOC,OAAO+hE,SAAAA,CAAAA;AAAAA,IAC9F,OAAQ;AAEJ,UAAIkI,aAAa,EAChBsuE,MAAO,gBACP,cAAcz4I,MAGf;AAAA,UAAGnT,OAAM64F,SAAS74F,OAAM64F,MAAMv+F,QAAQs4B,OAAOt4B,MAAK;AACjD,YAAG0F,OAAM64F,MAAMnM,aAAa,OAAM;AACjCpP,qBAAW,WAAA,IAAe;AAAA,QAChC,OAAU;AACJA,qBAAW,WAAA,IAAe;AAAA,QAC1B;AAAA,MACD;AAEDK,cAAQ1gF,KAAKouJ,mBAAmB/tE,UAAAA;AAAAA,IAChC;AACD,WAAOK;AAAAA,EACP,GAEDspC,oBAAoB,WACnB;AAAA,WAAO;AAAA,EACP,GAEDiY,mBAAmB,SAAS1lI,KAAAA;AAC3BA,QAAIywB,aAAa,QAAQ;AACzBzwB,QAAIgC,WAAWw2B,gBAAgB,YAAA;AAC/Bx4B,QAAIgC,WAAWyuB,aAAa,gBAAgB,MAAA;AAAA,EAC5C,GAED+xG,oBAAoB,SAASppG,QAAQ8oG,WAAWtwH,MAC/C;AAAA,QAAIkyE,aAAa,EAACsuE,MAAO,YAAY,cAAclwB,UACnD;AAAA,QAAA,CAAI9oG,OAAOtd,UAAUtV,OAAMqrB,WAAWjgB,IAAM,GAAA;AAC3CkyE,iBAAW,eAAA,IAAmB;AAAA,IAC9B;AAED,WAAOrgF,KAAKouJ,mBAAmB/tE,UAC/B;AAAA,EAAA,GAEDs+C,yBAAyB,SAAShpG;AACjC,WAAO31B,KAAKouJ,mBAAmB,EAACO,MAAO,UAAU,cAAc5rJ,OAAMoT,OAAOC,OAAO+hE,SACnF,CAAA;AAAA,EAAA,GAEDksB,yBAAyB,SAAS0qD,aAAAA;AACjC,WAAO,4CAA0CA,cAAY;AAAA,EAC7D,GAEDvqD,iBAAiB,SAASjoG;AACzBA,QAAIywB,aAAa,QAAQ,OAEzB;AAAA,EAAA,GAEDg4E,kBAAkB,SAASzoG,KAAKk8B,MAAAA;AAC/Bl8B,QAAIywB,aAAa,QAAQ;AACzB,QAAGyL,MAAI;AACNl8B,UAAIywB,aAAa,mBAAmByL,IAAAA;AAAAA,IACpC;AAAA,EAGD,GAEDsI,eAAe,SAASxkC,KAAAA;AACvBA,QAAIywB,aAAa,QAAQ,QAAA;AAAA,EACzB,GAEDgU,2BAA2B,WAAA;AAC1B,WAAO;AAAA,EACP,GAEDtB,iBAAiB,SAASnjC,KAAK2jB,QAAAA;AAC9B3jB,QAAIywB,aAAa,cAAc9M;EAC/B,GAED0f,2BAA2B,SAAS1pB,OAAAA;AACnC,WAAOnT,OAAM08B,SAAS2uH,mBAAmB,EAACO,MAAO,UAAU,cAAaz4I,OAAO04I,UAAW,IAC1F,CAAA;AAAA,EAAA,GAEDxqH,aAAa,SAAS7nC,KACrBA;AAAAA,QAAIywB,aAAa,QAAQ,SAAA;AAAA,EACzB,GAEDwX,oBAAoB,SAASjoC;AAC5BA,QAAIywB,aAAa,eAAe,OAAA;AAAA,EAChC,GAEDyX,mBAAmB,SAASloC,KAC3BA;AAAAA,QAAIywB,aAAa,eAAe,MAChC;AAAA,EAAA,EAAA;AAGF,WAASgiI,aACR;AAAA,WAAA,CAAQjsJ,OAAMuC,OAAO8xC;AAAAA,EACrB;AAED,WAAQt7C,KAAKiH,OAAM08B,UAAS;AAC3B18B,IAAAA,OAAM08B,SAAS3jC,CAAAA,IAAK,yBAAUsqE,SAAAA;AAC7B,aAAO,WAAA;AACN,YAAG4oF,WAAa,GAAA;AACf,iBAAO;AAAA,QACP;AACD,eAAO5oF,QAAQnmE,MAAMD,MAAM4G,SAAAA;AAAAA,MAC/B;AAAA,IACG,EAAE7D,OAAM08B,SAAS3jC;EAClB;AAGF;ACnQe,SAAQqrG,GAACpkG,QAAAA;AAEvB,MAAI00C,CAAAA,IAAIc,QAAO;AAEdx1C,IAAAA,OAAM2B,QAAQ,EACb+E,WACA9E,KAAKu2E,WAAAA;AAGN,QAAI4tB,YAAYmmD,YAAAA;AAChBlsJ,IAAAA,OAAM1D,QAAQypG,UAAUtkG;AACxBzB,IAAAA,OAAMqvB,cAAc02E,UAAUnjG;AAC9B5C,IAAAA,OAAMw6F,kBAAkBuL,UAAUljG;AAClC7C,IAAAA,OAAMI,uBAAuB2lG,UAAU7kE;AAEvCsiB,UAAYxjD,QAAO8iE,SAAS9iE,MAAAA,CAAAA;AAC5B,QAAImsJ,QAAQ/nD,KAAG7pD,KAAKv6C;AACpBA,IAAAA,OAAMoM,MAAM+/I,MAAM1sD;AAClBz/F,IAAAA,OAAMoM,IAAIkqB,SAAS61H,MAAMxpJ;AACzB3C,IAAAA,OAAMo4F,eAAe+zD,MAAMlmD;AAC3BjmG,IAAAA,OAAMc,UAAU0tC,WAAW,eAAe,WACzC;AAAA,aAAOxuC,OAAMo4F;AAAAA,IAChB,CAAA;AACEp4F,IAAAA,OAAMyP,MAAMzP,QAAOmsJ,MAAMtc;AAEzB3jC,eAAWlsG,MAAAA;AAEXA,IAAAA,OAAMc,UAAU0tC,WAAW,UAAU;AACpC,aAAO29G,MAAMnb;AAAAA,IAChB,CAEEhxI;AAAAA,IAAAA,OAAMyP,MAAMzP,QAAOkxI,mBAAAA,CAAAA;AACnB17H,SAAKxV,MAAAA;AACL80I,YAAQ90I,MAAAA;AACRu1I,SAAKv1I,MACLg1I;AAAAA,WAAOh1I;AACPi1I,YAAQj1I,MAAAA;AACRk1I,aAASl1I,MACTq1I;AAAAA,aAASr1I,MACTw1I;AAAAA,mBAAex1I,MACfy1I;AAAAA,mBAAez1I;AACf8oC,YAAQ9oC,MAAAA;AACRikC,UAAMjkC,MACNkyC;AAAAA,aAASlyC;AACTwqJ,2BAAuBxqJ,MAAAA;AACvB8qJ,aAAS9qJ,MAAAA;AAETA,IAAAA,OAAMisB,SAAS,SAAS9vB,GACvB;AAAA,UAAIC,MAAM4mC,cAAyB7mC,CAGnC;AAAA,UAAG+1B,QAAmB91B,KAAK,iBAAA,GAAmB;AAC7C,eAAO;AAAA,MACP;AAED,UAAIgwJ,kBAAkBvoJ,UAAU,MAAM5G,KAAKsF,OAAO6pB;AAElD,UAAIv1B,OAAOg4B,gBAA2BzyB,KAAKgwJ,eAC3C;AAAA,UAAGv1J,MAAK;AACP,eAAOA,KAAKQ,aAAa+0J,eAAAA;AAAAA,MAC7B,OAAQ;AACJ,eAAO;AAAA,MACP;AAAA,IACJ;AAEEpsJ,IAAAA,OAAM29I,cAAc,SAASxhJ,GAAGiB,WAAWC,QAC1C;AAAA,aAAOutB,gBAA2BzuB,GAAGiB,WAAWC,MACnD;AAAA,IAAA;AAEE2C,IAAAA,OAAMqsJ,cAAc,SAASlwJ,GAAGS,WAAAA;AAC/B,aAAOiyB,gBAA2B1yB,GAAGS,aAAaK,KAAKsF,OAAO6pB,cAAAA;AAAAA,IACjE;AAAA,EACE;AAEDpsB,EAAAA,OAAMyE,YAAY,WAAW,WAC5B;AAAA,QAAA,CAAIyrD,WAAWlwD,MAAO,GAAA;AACrBA,MAAAA,OAAMyE,YAAY,iBAAiB,WAClC;AAAA,YAAGzE,OAAMuC,OAAOowC,gBAAe;AAC9B,cAAI25G,YAAYtsJ,OAAMqL,eAAe;AACrC,cAAInH,KAAKooJ,YAAYA,UAAUpoJ,KAAKlE,OAAMuC,OAAOuV;AAEjD,cAAG9X,OAAM0d,aAAaxZ,EAAAA,KAAOlE,OAAMsN,SAAStN,OAAM2B,MAAMC,IAAI1D,UAAU8B,OAAMsN,OAAOtN,OAAMsM,UAAAA,GAAY;AACpGtM,YAAAA,OAAMkyF,SAAShuF,EAAAA;AAAAA,UACf;AAAA,QACD;AAAA,MACL,GAAM,EAACC,MAAM,KACV,CAAA;AAAA,IAAA;AAAA,EAEH;AAECnE,EAAAA,OAAMyE,YAAY,sBAAsB,WACvC;AAAA,QAAA,CAAKxH,KAAKsF,OAAO20G,YAChBj6G,MAAKsF,OAAO20G,cAAcq1C,cAAAA,KAA8B;AAEzD,QAAIr8F,CAAAA,WAAWlwD,MAAO,GAAA;AAErB/C,WAAKu9F,gBAAAA;AACLv9F,WAAKm7F,aAAa//D,MAAAA;AAElBp7B,WAAKw9F,cAAAA;AAAAA,IACL;AAAA,EAEH,CAAA;AAGCz6F,EAAAA,OAAMyE,YAAY,gBAAgB;AACjC,QAAIyrD,CAAAA,WAAWlwD,WAAUA,OAAMuC,OAAOmZ,KAAI;AACzC1b,MAAAA,OAAMm/B,QAAQkvC,eAAe,UAAYjoE,EAAAA,QAAQ,SAASwzB,MAAAA;AACzD,YAAI+3G,oBAAoB/3G,KAAKlsB,QAAQC;AACrC,YAAKgkI,CAAAA,kBAAmB;AAExB,YAAI34C,YAAYh5F,OAAMoM,IAAIC,QAAQslI,iBAClC;AAAA,YAAI34C,UAAWA,WAAUznF,SAASynF,UAAUtrF,QAAQqjG,YAAW,CAAA;AAAA,MAEnE;IACG;AAAA,EACH,CAAA;AAGC/wG,EAAAA,OAAMyE,YAAY,gBAAgB;AACjC,QAAIyrD,CAAAA,WAAWlwD,MAAO,GAAA;AAErB,UAAI6/F,gBAAgB7/F,OAAM8oC,QAE1B;AAAA,UAAI0jH,mBAAmB,EACtBjtI,iBAAiBvf,OAAM4uH,cACvB9iH,YAAY9L,OAAMoC,IAAIC,WACtBoqJ,eAAezsJ,OAAMu0H,gBACrB/xH,eAAexC,OAAMoC,IAAID,cACzB6M,YAAYhP,OAAM4f,aAClBQ,YAAYpgB,OAAMoC,IAAIge,YACtBssI,UAAU1sJ,OAAM2sJ,SAChB17H,qBAAqBjxB,OAAMoC,IAAIizB,oBAC/BC,QAAQt1B,OAAM62B,WACdS,aAAat3B,OAAM06B,kBACnBkyH,SAAS5sJ,OAAMoC,IAAIwqJ,SACnBxtH,YAAYp/B,OAAMmS,UAAUysB,oBAC5BkD,SAAS9hC,OAAMoC,IAAI2hC,UACnB1a,MAAMrpB,OAAMqpB,KAAAA;AAGb,eAASy2E,UAAU0sD,kBAAiB;AACnC,YAAIA,iBAAiB1sD,MAAYD,KAAAA,CAAAA,cAAcC,MAAQ,GAAA;AAEtDlhG,kBAAQq2D,KAAK,sBAAsB6qC,MAEnC;AAAA,wJAAA;AAAA,QAAA;AAAA,MACD;AAAA,IACD;AAAA,EACH,CACA;AAAA;ACjLe,SAAQ+sD,YAAC7sJ,QAAAA;AACvBA,EAAAA,OAAM0/C,OAAO,SAAUpsC,KAAKpE,MAAMnK,UACjC9H;AAAAA,SAAK6vJ,YAAYx5I;AACjBrW,SAAKotC,OAAOxmC,UAAU7K,QAAQ,wBAE9B;AAAA,QAAI+6H,KAAK,QAAQg5B,KAAK;AACtB,QAAIlpJ,UAAU7K,UAAU,GAAG;AAC1B+6H,WAAK7kH;AACL69I,WAAKhoJ;AAAAA,IACR,OAAS;AACN,iBAAWlB,UAAU,CAAA,KAAM,SAC1BkwH,MAAKlwH,UAAU;eACAA,OAAAA,UAAU,CAAM,KAAA,WAC/BkpJ,MAAKlpJ,UAAU;IAChB;AAED5G,SAAK+vJ,aAAaj5B;AAElB92H,SAAK+H,UAAU,eAAe,CAACsO,KAAKygH,EAEpC,CAAA;AAAA,WAAO92H,KAAKwW,KAAK83B,IAAIj4B,KAAKtT,OAAM4E,KAAK,SAAUswF,GAAAA;AAC9Cj4F,WAAK8+E,QAAQmZ,GAAG6+B,EAChB92H;AAAAA,WAAK+H,UAAU,aAAa,CAACsO,KAAKygH,EAAAA,CAAAA;AAClC,UAAWg5B,OAAAA,MAAM,WAChBA,IAAGj0J,KAAKmE,IACZ;AAAA,IAAA,GAAKA,IACL,CAAA;AAAA,EAAA;AACA;ACpBe,SAAQ0W,KAAC+rF,qBACvB;AAAA,MAAI1/F,SAAQy/F,QAAQC,mBAAAA;AAEpB,OAAI1/F,OAAM00C,IAAIc,QAAO;AACpB4uD,OAAGpkG,MAAAA;AACH6sJ,gBAAY7sJ,MAEZ;AAAA,EAAA;AAED,SAAOA;AACR;ACdA,MAAMA,QAASH,MAAcG,QAAQ2T,KAAKw5B,UAAAA;","x_google_ignoreList":[45]}