/*!
 * @license
 * 
 * dhtmlxGantt v.5.1.0 Stardard
 * This software is covered by GPL license. You also can obtain Commercial or Enterprise license to use it in non-GPL project - please contact sales@dhtmlx.com. Usage without proper license is prohibited.
 * 
 * (c) Dinamenta, UAB.
 * 
 */
!function(t){function n(e){if(a[e])return a[e].exports;var o=a[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,n),o.l=!0,o.exports}var a={};n.m=t,n.c=a,n.d=function(t,a,e){n.o(t,a)||Object.defineProperty(t,a,{configurable:!1,enumerable:!0,get:e})},n.n=function(t){var a=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(a,"a",a),a},n.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},n.p="",n(n.s=27)}({27:function(t,n,a){t.exports=a(28)},28:function(t,n){gantt.config.undo_steps=10,gantt.config.undo=!0,gantt.config.redo=!0,gantt.undo=function(){this._undo.undo()},gantt.getUndoStack=function(){return this._undo._undoStack},gantt.getRedoStack=function(){return this._undo._redoStack},gantt.redo=function(){this._undo.redo()},gantt.config.undo_types={link:"link",task:"task"},gantt.config.undo_actions={update:"update",remove:"remove",add:"add"},gantt._undo={_undoStack:[],_redoStack:[],maxSteps:10,undo_enabled:!0,redo_enabled:!0,_push:function(t,n){if(n.commands.length){for(t.push(n);t.length>this.maxSteps;)t.shift();return n}},_pop:function(t){return t.pop()},undo:function(){if(this.updateConfigs(),this.undo_enabled){var t=this._pop(this._undoStack);!1!==gantt.callEvent("onBeforeUndo",[t])&&t&&(this._applyAction(this.action.invert(t)),this._push(this._redoStack,gantt.copy(t))),gantt.callEvent("onAfterUndo",[])}},redo:function(){if(this.updateConfigs(),this.redo_enabled){var t=this._pop(this._redoStack);!1!==gantt.callEvent("onBeforeRedo",[t])&&t&&(this._applyAction(t),this._push(this._undoStack,gantt.copy(t))),gantt.callEvent("onAfterRedo",[])}},_applyAction:function(t){var n=null,a=this.command.entity,e=this.command.type,o={};o[a.task]={add:"addTask",update:"updateTask",remove:"deleteTask",isExists:"isTaskExists"},o[a.link]={add:"addLink",update:"updateLink",remove:"deleteLink",isExists:"isLinkExists"},gantt.batchUpdate(function(){for(var a=0;a<t.commands.length;a++){n=t.commands[a];var i=o[n.entity][n.type],s=o[n.entity].isExists;n.type==e.add?gantt[i](n.oldValue,n.oldValue.parent,n.oldValue.$index):n.type==e.remove?gantt[s](n.value.id)&&gantt[i](n.value.id):n.type==e.update&&gantt[i](n.value.id,n.value)}})},logAction:function(t){this._push(this._undoStack,t),this._redoStack=[]},action:{create:function(t){return{commands:t?t.slice():[]}},invert:function(t){for(var n=gantt.copy(t),a=gantt._undo.command,e=0;e<t.commands.length;e++){var o=n.commands[e]=a.invert(n.commands[e]);if(o.type==a.type.update){var i=o.value;o.value=o.oldValue,o.oldValue=i}}return n}},command:{create:function(t,n,a,e){return{entity:e,type:a,value:gantt.copy(t),oldValue:gantt.copy(n||t)}},invert:function(t){var n=gantt.copy(t);return n.type=this.inverseCommands(t.type),n},entity:null,type:null,inverseCommands:function(t){switch(t){case this.type.update:return this.type.update;case this.type.remove:return this.type.add;case this.type.add:return this.type.remove;case this.type.load:return this.type.clear;case this.type.clear:return this.type.load;default:return gantt.assert(!1,"Invalid command "+t),null}}},monitor:{_batchAction:null,_batchMode:!1,_ignore:!1,startIgnore:function(){this._ignore=!0},stopIgnore:function(){this._ignore=!1},startBatchAction:function(){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(function(){gantt._undo.monitor.stopBatchAction()},10),this._ignore||this._batchMode||(this._batchMode=!0,this._batchAction=gantt._undo.action.create())},stopBatchAction:function(){if(!this._ignore){var t=gantt._undo;this._batchAction&&t.logAction(this._batchAction),this._batchMode=!1,this._batchAction=null}},_storeCommand:function(t){var n=gantt._undo;if(n.updateConfigs(),n.undo_enabled)if(this._batchMode)this._batchAction.commands.push(t);else{var a=n.action.create([t]);n.logAction(a)}},_storeEntityCommand:function(t,n,a,e){var o=gantt._undo,i=o.command.create(t,n,a,e);this._storeCommand(i)},_storeTaskCommand:function(t,n){this._storeEntityCommand(t,this.getInitialTask(t.id),n,gantt._undo.command.entity.task)},_storeLinkCommand:function(t,n){this._storeEntityCommand(t,this.getInitialLink(t.id),n,gantt._undo.command.entity.link)},onTaskAdded:function(t){this._ignore||this._storeTaskCommand(t,gantt._undo.command.type.add)},onTaskUpdated:function(t){this._ignore||this._storeTaskCommand(t,gantt._undo.command.type.update)},onTaskDeleted:function(t){if(!this._ignore){if(this._storeTaskCommand(t,gantt._undo.command.type.remove),this._nestedTasks[t.id])for(var n=this._nestedTasks[t.id],a=0;a<n.length;a++)this._storeTaskCommand(n[a],gantt._undo.command.type.remove);if(this._nestedLinks[t.id])for(var e=this._nestedLinks[t.id],a=0;a<e.length;a++)this._storeLinkCommand(e[a],gantt._undo.command.type.remove)}},onLinkAdded:function(t){this._ignore||this._storeLinkCommand(t,gantt._undo.command.type.add)},onLinkUpdated:function(t){this._ignore||this._storeLinkCommand(t,gantt._undo.command.type.update)},onLinkDeleted:function(t){this._ignore||this._storeLinkCommand(t,gantt._undo.command.type.remove)},_initialTasks:{},_nestedTasks:{},_nestedLinks:{},_getLinks:function(t){return t.$source.concat(t.$target)},setNestedTasks:function(t,n){for(var a=null,e=[],o=this._getLinks(gantt.getTask(t)),i=0;i<n.length;i++)a=this.setInitialTask(n[i]),o=o.concat(this._getLinks(a)),e.push(a);for(var s={},i=0;i<o.length;i++)s[o[i]]=!0;var d=[];for(var i in s)d.push(this.setInitialLink(i));this._nestedTasks[t]=e,this._nestedLinks[t]=d},setInitialTask:function(t){if(!this._initialTasks[t]||!this._batchMode){var n=gantt.copy(gantt.getTask(t));n.$index=gantt.getTaskIndex(t),this._initialTasks[t]=n}return this._initialTasks[t]},getInitialTask:function(t){return this._initialTasks[t]},_initialLinks:{},setInitialLink:function(t){return this._initialLinks[t]&&this._batchMode||(this._initialLinks[t]=gantt.copy(gantt.getLink(t))),this._initialLinks[t]},getInitialLink:function(t){return this._initialLinks[t]}}},gantt._undo.updateConfigs=function(){gantt._undo.maxSteps=gantt.config.undo_steps,gantt._undo.command.entity=gantt.config.undo_types,gantt._undo.command.type=gantt.config.undo_actions,gantt._undo.undo_enabled=!!gantt.config.undo,gantt._undo.redo_enabled=!!gantt.config.undo&&!!gantt.config.redo},function(){function t(t){return d.setInitialTask(t),!0}function n(t,n,a){t&&(t.id==n&&(t.id=a),t.parent==n&&(t.parent=a))}function a(t,a,e){n(t.value,a,e),n(t.oldValue,a,e)}function e(t,n,a){t&&(t.source==n&&(t.source=a),t.target==n&&(t.target=a))}function o(t,n,a){e(t.value,n,a),e(t.oldValue,n,a)}function i(t,n,e){for(var i=gantt._undo,s=0;s<t.length;s++)for(var d=t[s],c=0;c<d.commands.length;c++)d.commands[c].entity==i.command.entity.task?a(d.commands[c],n,e):d.commands[c].entity==i.command.entity.link&&o(d.commands[c],n,e)}function s(t,n,a){for(var e=gantt._undo,o=0;o<t.length;o++)for(var i=t[o],s=0;s<i.commands.length;s++){var d=i.commands[s];d.entity==e.command.entity.link&&(d.value&&d.value.id==n&&(d.value.id=a),d.oldValue&&d.oldValue.id==n&&(d.oldValue.id=a))}}var d=gantt._undo.monitor,c={onBeforeUndo:"onAfterUndo",onBeforeRedo:"onAfterRedo"};for(var r in c)gantt.attachEvent(r,function(){d.startIgnore()}),gantt.attachEvent(c[r],function(){d.stopIgnore()});for(var u=["onTaskDragStart","onAfterTaskDelete","onBeforeBatchUpdate"],r=0;r<u.length;r++)gantt.attachEvent(u[r],function(){d.startBatchAction()});gantt.attachEvent("onBeforeTaskDrag",t),gantt.attachEvent("onLightbox",t),gantt.attachEvent("onBeforeTaskAutoSchedule",function(n){return t(n.id),!0}),gantt.attachEvent("onBeforeTaskDelete",function(n){t(n);var a=[];return gantt.eachTask(function(t){a.push(t.id)},n),d.setNestedTasks(n,a),!0}),gantt.attachEvent("onAfterTaskAdd",function(t,n){d.onTaskAdded(n)}),gantt.attachEvent("onAfterTaskUpdate",function(t,n){d.onTaskUpdated(n)}),gantt.attachEvent("onAfterTaskDelete",function(t,n){d.onTaskDeleted(n)}),gantt.attachEvent("onAfterLinkAdd",function(t,n){d.onLinkAdded(n)}),gantt.attachEvent("onAfterLinkUpdate",function(t,n){d.onLinkUpdated(n)}),gantt.attachEvent("onAfterLinkDelete",function(t,n){d.onLinkDeleted(n)}),gantt.attachEvent("onTaskIdChange",function(t,n){var a=gantt._undo;i(a._undoStack,t,n),i(a._redoStack,t,n)}),gantt.attachEvent("onLinkIdChange",function(t,n){var a=gantt._undo;s(a._undoStack,t,n),s(a._redoStack,t,n)}),gantt.attachEvent("onGanttReady",function(){gantt._undo.updateConfigs()})}()}});
//# sourceMappingURL=dhtmlxgantt_undo.js.map